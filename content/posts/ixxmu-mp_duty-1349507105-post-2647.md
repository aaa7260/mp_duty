---
title: "旧版本的R3.6安装最新版的ggplot2"
date: 2022-08-24T14:07:04Z
draft: false
tags: ["fetched","育种数据分析之放飞自我"]
---

https://mp.weixin.qq.com/s/9NdZQof1rsMfwMbIS-LXLA

---

旧版本的R3.6安装最新版的ggplot2 by 育种数据分析之放飞自我
------
<div><p>本来我这个段位，就不应该为安装包发愁了，毕竟统计学不会可以理解，编程学不好忍忍就过去了，但是说安装包出错，是可忍孰不可忍？</p><p><br></p><p>统计编程我惹不起就算了，你一个安装包我还搞不定了？？？<br></p><p><br></p><p>事实证明，包还是非常难安装的，一边安装，一边想着，一些收费的软件是有原因的……</p><p><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">目录：</p><ul><li><p>1. ggplot2包安装报错</p></li><li><p>2，安装rlange1.0.0</p></li><li><p>3. 安装Rtools3.6</p></li><li><p>4. 重新安装ggplot2</p></li><li><p>5. 安装ellipsis包</p></li><li><p>6. 安装pillar包</p></li><li><p>7. 重新安装ggplot2</p></li><li><p>8. 测试成功安装ggplot2</p></li></ul><p data-tool="mdnice编辑器"><br></p><p data-tool="mdnice编辑器">现在最新的R版本是4.2.1，因为有些包只能运行在3.6版本中，因此我需要安装3.6，这里安装常用的ggplot2时报错了，总结一下问题解决的方法。</p><h2 data-tool="mdnice编辑器"><span></span><span>1. ggplot2包安装报错</span><span> </span></h2><p data-tool="mdnice编辑器">本来，我安装R3.6，然后直接运行install.packages("ggplot2")，报错如下：</p><pre data-tool="mdnice编辑器"><span></span><code>** byte-<span>compile <span>and</span> prepare package <span>for</span> lazy loading<br>Error in <span>loadNamespace</span><span>(i, c(lib.loc, .libPaths()), versionCheck = vI[[i]])</span> : <br>  <span>namespace</span> 'rlang' 0.4.11 is already loaded, but &gt;</span>= <span>1.0</span><span>.2</span> is required<br>Calls: &lt;Anonymous&gt; ... withCallingHandlers -&gt; loadNamespace -&gt; namespaceImport -&gt; loadNamespace<br>停止执行<br>ERROR: lazy loading failed <span>for</span> package <span>'pillar'</span><br>* removing <span>'C:/Users/dave/Documents/R/win-library/3.6/pillar'</span><br>Warning in install.packages :<br>  installation of package ‘pillar’ had non-zero <span>exit</span> status<br>* installing *source* package <span>'scales'</span> ...<br>** 成功将<span>'scales'</span>程序包解包并MD5和检查<br>** <span>using</span> staged installation<br>** R<br>** byte-<span>compile <span>and</span> prepare package <span>for</span> lazy loading<br>Error in <span>loadNamespace</span><span>(i, c(lib.loc, .libPaths()), versionCheck = vI[[i]])</span> : <br>  <span>namespace</span> 'rlang' 0.4.11 is being loaded, but &gt;</span>= <span>1.0</span><span>.0</span> is required<br>Calls: &lt;Anonymous&gt; ... withCallingHandlers -&gt; loadNamespace -&gt; namespaceImport -&gt; loadNamespace<br>停止执行<br>ERROR: lazy loading failed <span>for</span> package <span>'scales'</span><br>* removing <span>'C:/Users/dave/Documents/R/win-library/3.6/scales'</span><br>Warning in install.packages :<br>  installation of package ‘scales’ had non-zero <span>exit</span> status<br>ERROR: dependency <span>'scales'</span> is <span>not</span> available <span>for</span> package <span>'ggplot2'</span><br>* removing <span>'C:/Users/dave/Documents/R/win-library/3.6/ggplot2'</span><br>Warning in install.packages :<br>  installation of package ‘ggplot2’ had non-zero <span>exit</span> status<br><br>The downloaded source packages are in<br> ‘C:\Users\dave\AppData\Local\Temp\Rtmpg3apRU\downloaded_packages’<br></code></pre><p data-tool="mdnice编辑器">看起来，主要是因为rlange这个包版本太低，应该是大于1.0.0，现在是0.4.11。问题来了，我有两个选择：</p><p data-tool="mdnice编辑器">第一个：下载旧版本的ggplot2，它支持rlang0.4.11版本，但是很多更新的函数我无法使用了。测试了一下，可以实现。但我要用第二个。</p><p data-tool="mdnice编辑器">第二个：下载rlang1.0，然后安装最新版的ggplot2，这条路很曲折，但是解决好之后就可以用最新的版本了，也算物有所值了。</p><p data-tool="mdnice编辑器">用第二个，搞起！<br></p><h2 data-tool="mdnice编辑器"><span></span><span>2，安装rlange1.0.0</span><span> </span></h2><p data-tool="mdnice编辑器">如果现在网上搜索R包的地址，包括其不同的版本，可以键入： </p><p data-tool="mdnice编辑器"><span>https://cran.r-project.org/src/contrib/Archive/</span></p><p data-tool="mdnice编辑器">如果知道包的名称，比如ggplot2，键入：</p><p data-tool="mdnice编辑器"><span>https://cran.r-project.org/src/contrib/Archive/ggplot2</span></p><p data-tool="mdnice编辑器"><span><span>可以看到，旧版本的ggplot2，下载到本地，然后安装就可以了。这里我们不用这种方法，我们要安装最新版的。</span></span></p><figure data-tool="mdnice编辑器"><img data-ratio="0.7856049004594181" data-src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daDzWMxJf1jLwOGsgmeTJ2oGee1xibiaAVw6Qpyz0enKhggu8ImziaibklGbWpeYzxQgfDiaLqTIF87kIsg/640?wx_fmt=png" data-type="png" data-w="653" src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daDzWMxJf1jLwOGsgmeTJ2oGee1xibiaAVw6Qpyz0enKhggu8ImziaibklGbWpeYzxQgfDiaLqTIF87kIsg/640?wx_fmt=png"><figcaption>在这里插入图片描述</figcaption></figure><p data-tool="mdnice编辑器">找到rlang包的链接：<span>https://cran.r-project.org/src/contrib/Archive/rlang/rlang_1.0.1.tar.gz</span></p><p data-tool="mdnice编辑器">然后复制包的链接，运行下面命令：</p><pre data-tool="mdnice编辑器"><span></span><code>install.packages(<span>"https://cran.r-project.org/src/contrib/Archive/rlang/rlang_1.0.1.tar.gz"</span>, repo=<span>NULL</span>, type=<span>"source"</span>)<br></code></pre><p data-tool="mdnice编辑器">相当于将包下载到本地安装，这里报错了，显示我没有make命令。</p><p data-tool="mdnice编辑器">所以，我要安装编译的工具Rtools。<br></p><pre data-tool="mdnice编辑器"><span></span><code>* installing *source* package <span>'rlang'</span> ...<br>** 成功将<span>'rlang'</span>程序包解包并MD5和检查<br>** <span><span>using</span> staged installation<br>** libs<br>Warning in <span>system</span><span>(cmd)</span> : 'make' <span>not</span> found<br>ERROR: compilation failed <span>for</span> package 'rlang'<br>* removing 'C:/Users/dave/Documents/R/win-library/3.6/rlang'<br>* restoring previous 'C:/Users/dave/Documents/R/win-library/3.6/rlang'<br>Warning in install.packages :<br>  installation of package ‘C:/Users/dave/AppData/Local/Temp/Rtmpg3apRU/downloaded_packages/rlang_1.0.1.tar.gz’ had non-zero <span>exit</span> status<br></span></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>3. 安装Rtools3.6</span><span> </span></h2><p data-tool="mdnice编辑器">安装Rtools3.6，然后加入到环境变量中，重启R语言，然后键入：</p><pre data-tool="mdnice编辑器"><span></span><code>install.packages(<span>"https://cran.r-project.org/src/contrib/Archive/rlang/rlang_1.0.1.tar.gz"</span>, repo=<span>NULL</span>, type=<span>"source"</span>)<br></code></pre><p data-tool="mdnice编辑器">成功，可以看到rlang1.0安装好了，重新本地编译安装是可以解决问题的。</p><pre data-tool="mdnice编辑器"><span></span><code>    <span>vector</span>-construction                     html  <br>    <span>vector</span>-old-<span>ctors                        html  <br>    with_env                                html  <br>    with_handlers                           html  <br>    wref_key                                html  <br>    zap                                     html  <br>    zap_srcref                              html  <br>*** copying figures<br>** building package indices<br>** testing <span>if</span> installed package can be loaded from temporary location<br>** testing <span>if</span> installed package can be loaded from <span>final</span> location<br>** testing <span>if</span> installed package keeps a record of temporary installation path<br>* <span>DONE</span> <span>(rlang)</span><br></span></code></pre><p data-tool="mdnice编辑器">测试：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; library(rlang)<br>&gt; sessionInfo()<br>R version <span>3.6</span><span>.3</span> (<span>2020</span><span>-02</span><span>-29</span>)<br>Platform: x86_64-w64-mingw32/x64 (<span>64</span>-bit)<br>Running under: Windows <span>10</span> x64 (build <span>22000</span>)<br><br>Matrix products: <span>default</span><br><br>locale:<br>[<span>1</span>] LC_COLLATE=Chinese (Simplified)_China<span>.936</span> <br>[<span>2</span>] LC_CTYPE=Chinese (Simplified)_China<span>.936</span>   <br>[<span>3</span>] LC_MONETARY=Chinese (Simplified)_China<span>.936</span><br>[<span>4</span>] LC_NUMERIC=C                              <br>[<span>5</span>] LC_TIME=Chinese (Simplified)_China<span>.936</span>    <br><br>attached base packages:<br>[<span>1</span>] stats     graphics  grDevices utils     datasets  methods   base     <br><br>other attached packages:<br>[<span>1</span>] rlang_1<span>.0</span><span>.1</span><br><br>loaded via a <span>namespace</span> (<span>and</span> <span>not</span> attached):<br>[<span>1</span>] compiler_3<span>.6</span><span>.3</span> cli_2<span>.5</span><span>.0</span>      tools_3<span>.6</span><span>.3</span>  <br></code></pre><p data-tool="mdnice编辑器">可以看到，上面的R版本是3.6.3，rlang的版本是1.0.1，搞定。</p><h2 data-tool="mdnice编辑器"><span></span><span>4. 重新安装ggplot2</span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>install.packages(<span>"ggplot2"</span>)<br></code></pre><p data-tool="mdnice编辑器">安装ggplot2，还是报错：</p><pre data-tool="mdnice编辑器"><span></span><code>** data<br>*** moving datasets to lazyload DB<br>** inst<br>** byte-<span>compile <span>and</span> prepare package <span>for</span> lazy loading<br>Error in <span>loadNamespace</span><span>(i, c(lib.loc, .libPaths()), versionCheck = vI[[i]])</span> : <br>  there is no package called 'ellipsis'<br>Calls: &lt;Anonymous&gt; ... loadNamespace -&gt; withRestarts -&gt; withOneRestart -&gt; doWithOneRestart<br>停止执行<br>ERROR: lazy loading failed <span>for</span> package 'ggplot2'<br>* removing 'C:/Users/dave/Documents/R/win-library/3.6/ggplot2'<br>Warning in install.packages :<br>  installation of package ‘ggplot2’ had non-zero <span>exit</span> status<br></span></code></pre><p data-tool="mdnice编辑器">从日志可以看到，是因为没有ellipsis这个包，那就单独安装试试。</p><h2 data-tool="mdnice编辑器"><span></span><span>5. 安装ellipsis包</span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>install.packages(<span>"ellipsis"</span>)<br></code></pre><p data-tool="mdnice编辑器">安装成功：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; install.packages(<span>"ellipsis"</span>)<br>Installing package into ‘C:/Users/dave/Documents/R/win-library/<span>3.6</span>’<br>(as ‘lib’ is unspecified)<br>trying URL <span>'https://mirrors.tuna.tsinghua.edu.cn/CRAN/bin/windows/contrib/3.6/ellipsis_0.3.2.zip'</span><br>Content type <span>'application/zip'</span> length <span>49192</span> bytes (<span>48</span> KB)<br>downloaded <span>48</span> KB<br><br>package ‘ellipsis’ successfully unpacked <span>and</span> MD5 sums checked<br><br>The downloaded binary packages are in<br> C:\Users\dave\AppData\Local\Temp\RtmpWqZTPD\downloaded_packages<br></code></pre><p data-tool="mdnice编辑器">再重新安装ggplot2：</p><pre data-tool="mdnice编辑器"><span></span><code>install.packages(<span>"ggplot2"</span>)<br></code></pre><p data-tool="mdnice编辑器">还是报错，显示pillar包没有安装好，那就继续单独安装。</p><pre data-tool="mdnice编辑器"><span></span><code>** byte-<span>compile <span>and</span> prepare package <span>for</span> lazy loading<br>Error in <span>loadNamespace</span><span>(j &lt;- i[[<span>1L</span>]], c(lib.loc, .libPaths()), versionCheck = vI[[j]])</span> : <br>  there is no package called 'pillar'<br>Calls: &lt;Anonymous&gt; ... loadNamespace -&gt; withRestarts -&gt; withOneRestart -&gt; doWithOneRestart<br>停止执行<br>ERROR: lazy loading failed <span>for</span> package 'ggplot2'<br>* removing 'C:/Users/dave/Documents/R/win-library/3.6/ggplot2'<br>Warning in install.packages :<br>  installation of package ‘ggplot2’ had non-zero <span>exit</span> status<br></span></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>6. 安装pillar包</span><span> </span></h2><p data-tool="mdnice编辑器">继续安装pillar，编译安装，安装成功后，继续安装ggplot2，如果哪个包报错，就安装哪个包。</p><p data-tool="mdnice编辑器">安装好之后，再安装ggplot2，如果还有包报错，就单独安装。<br></p><p data-tool="mdnice编辑器">一路走来，哪里报错安哪里，本来自动化安装依赖的R语言让我整成了手动。</p><h2 data-tool="mdnice编辑器"><span></span><span>7. 重新安装ggplot2</span><span> </span></h2><p data-tool="mdnice编辑器">安装成功，终于安装成功了：</p><pre data-tool="mdnice编辑器"><span></span><code>*** <span>copying figures<br>** building package indices<br>** installing vignettes<br>** testing <span>if</span> installed package can be loaded from temporary location<br>** testing <span>if</span> installed package can be loaded from <span>final</span> location<br>** testing <span>if</span> installed package keeps a record of temporary installation path<br>* <span>DONE</span> <span>(ggplot2)</span><br><br>The downloaded source packages are in<br> ‘C:\Users\dave\AppData\Local\Temp\RtmpMhrQc1\downloaded_packages’<br></span></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>8. 测试成功安装ggplot2</span><span> </span></h2><p data-tool="mdnice编辑器">测试，载入，然后看一下R的版本和ggplot2的版本：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; library(ggplot2)<br>&gt; sessionInfo()<br>R version <span>3.6</span><span>.3</span> (<span>2020</span><span>-02</span><span>-29</span>)<br>Platform: x86_64-w64-mingw32/x64 (<span>64</span>-bit)<br>Running under: Windows <span>10</span> x64 (build <span>22000</span>)<br><br>Matrix products: <span>default</span><br><br>locale:<br>[<span>1</span>] LC_COLLATE=Chinese (Simplified)_China<span>.936</span> <br>[<span>2</span>] LC_CTYPE=Chinese (Simplified)_China<span>.936</span>   <br>[<span>3</span>] LC_MONETARY=Chinese (Simplified)_China<span>.936</span><br>[<span>4</span>] LC_NUMERIC=C                              <br>[<span>5</span>] LC_TIME=Chinese (Simplified)_China<span>.936</span>    <br><br>attached base packages:<br>[<span>1</span>] stats     graphics  grDevices utils     datasets  methods   base     <br><br>other attached packages:<br>[<span>1</span>] ggplot2_3<span>.3</span><span>.6</span><br><br>loaded via a <span>namespace</span> (<span>and</span> <span>not</span> attached):<br> [<span>1</span>] fansi_0<span>.4</span><span>.2</span>      withr_2<span>.5</span><span>.0</span>      utf8_1<span>.2</span><span>.1</span>       grid_3<span>.6</span><span>.3</span>      <br> [<span>5</span>] R6_2<span>.5</span><span>.1</span>         lifecycle_1<span>.0</span><span>.1</span>  gtable_0<span>.3</span><span>.0</span>     magrittr_2<span>.0</span><span>.1</span>  <br> [<span>9</span>] scales_1<span>.2</span><span>.1</span>     pillar_1<span>.8</span><span>.1</span>     rlang_1<span>.0</span><span>.4</span>      cli_2<span>.5</span><span>.0</span>       <br>[<span>13</span>] vctrs_0<span>.3</span><span>.8</span>      ellipsis_0<span>.3</span><span>.2</span>   tools_3<span>.6</span><span>.3</span>      glue_1<span>.4</span><span>.2</span>      <br>[<span>17</span>] munsell_0<span>.5</span><span>.0</span>    compiler_3<span>.6</span><span>.3</span>   pkgconfig_2<span>.0</span><span>.3</span>  colorspace_2<span>.0</span><span>-1</span><br>[<span>21</span>] tibble_3<span>.1</span><span>.1</span> <br></code></pre><p data-tool="mdnice编辑器">可以看到，我的R版本是3.6.3，ggplot2的版本是3.3.6，搞定！</p></section><p><br></p><p>这种方法可以推广到R3.5，R4.0，R4.1，windows系统安装Rtools就是为了防止本地编译时出错，里面有C，C++，Fortran等各种编译器，一篮子满满的。有了它，就不怕R包安装了。</p><p><br></p><p>原则上来说，所有的包都可以被成功安装，多尝试几次就行了。<br></p><p><br></p><p><strong>资料推荐：</strong><br></p><p><span>这些资料的特点是：代码，数据，理论介绍都有包括，值得拥有：</span></p><p><br></p><p><span>1，<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0MTIzNjYwNQ==&amp;mid=2247489866&amp;idx=1&amp;sn=e8631d343a33ae956b23d97a6b2b3fe4&amp;chksm=e90ff658de787f4e3b52929c85adadbe8c6f54bf0943780ea94f9e19e4cc6ef8756e068761f9&amp;scene=21#wechat_redirect" textvalue="快来领取 | 飞哥的GWAS分析教程" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">快来领取 | 飞哥的GWAS分析教程</a><br></span></p><p><br></p><p>2，<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0MTIzNjYwNQ==&amp;mid=2247489124&amp;idx=1&amp;sn=923b2d827f0e4b6c70494ebd458bdfa5&amp;chksm=e90ff976de78706065f72955113db192e9f74682c503dc69c3ebf8d17e9b8726db82be1ffa0a&amp;scene=21#wechat_redirect" textvalue="飞哥汇总 | 入门数据分析资源推荐" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">飞哥汇总 | 入门数据分析资源推荐</a><br></p><p><br></p><p>3，<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0MTIzNjYwNQ==&amp;mid=2247488460&amp;idx=3&amp;sn=b3acd30a2ab34e10415dacc90f596e4a&amp;chksm=e90ffcdede7875c8ba669382e38e91f5d1e10960448a1b88dbbe60bde1e5c2880e8ab918e914&amp;scene=21#wechat_redirect" textvalue="数量遗传学，分享几本书的电子版" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">数量遗传学，分享几本书的电子版</a></p><p><br></p><p>4，<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0MTIzNjYwNQ==&amp;mid=2247490492&amp;idx=1&amp;sn=24434d7598cf1993bbece938b63cc7e8&amp;chksm=e90ff4aede787db837d5de895a24bb0cc055868d4345a5974a24534827aaff9882c86bbe6550&amp;scene=21#wechat_redirect" textvalue="R语言学习看最新版的电子书不香嘛？" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">R语言学习看最新版的电子书不香嘛？</a></p><p><br></p><p><br></p><p><span><strong><span>想要有人带的小伙伴，毕竟老司机带，不迷路，更快到达！</span></strong></span><strong><span>扫码加入知识星球：</span></strong></p><p><span><strong><span><img data-galleryid="" data-ratio="1.2462264150943396" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/XEicwVA08daCyoYQooxoH1tCzgN5xxevlQokBib7RiaStK9nPw4qo80OfqYAuRHsPAU4DJ2StOCUnHicqZNuG4fibow/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="jpeg" data-w="1060" src="https://mmbiz.qpic.cn/mmbiz_jpg/XEicwVA08daCyoYQooxoH1tCzgN5xxevlQokBib7RiaStK9nPw4qo80OfqYAuRHsPAU4DJ2StOCUnHicqZNuG4fibow/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></span></strong></span></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzI0MTIzNjYwNQ==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daBIrllkaO46sRRbb3FItjeuFJ8omwhsLeNMmlvBtiaE8o3Dpib2h7XaAiaViaGQVlD5ufeDGvia2WQMU8g/0?wx_fmt=png" data-nickname="育种数据分析之放飞自我" data-alias="R-breeding" data-signature="本公众号主要介绍动植物育种数据分析中的相关问题, 算法及程序代码." data-from="0" data-is_biz_ban="0"></mp-common-profile></section></div>