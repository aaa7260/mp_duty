---
title: "Supercell代码实操（二）：COVID-19数据的整合分析"
date: 2022-10-31T08:05:31Z
draft: ["false"]
tags: [
  "fetched",
  "生信宝库"
]
categories: ["Acdemic"]
---
Supercell代码实操（二）：COVID-19数据的整合分析 by 生信宝库
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>前言</span><span></span></h2><p data-tool="mdnice编辑器">在上一期推文：<a href="https://mp.weixin.qq.com/s?__biz=MzI4MjY5ODI1Nw==&amp;mid=2247486718&amp;idx=1&amp;sn=5b75eb09f2defae0666a988bc34a1429&amp;chksm=eb94bb80dce33296598d6af0114f0dd63a0542026aea6236dede0d16a7372631949c00f310c8&amp;token=1319862321&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">Supercell代码实操（一）：5种肿瘤细胞系的整合分析</a>中，Immugent已经初步带大家感受了一下基于Supercell流程的快捷，本期推文小编将会通过一个更大的数据集带大家更加深入的感受基于元细胞分析的重要性。</p><p data-tool="mdnice编辑器">说到大的单细胞数据集，除了各种大型图谱之外，就数新冠相关研究的数据了。说到新冠研究的相关数据集，小到几千个细胞的数量级，大到上百万的数量级。Immugent本来想为大家展示的是1.4 millions of cells distributed in 284 samples coming from 196 patients的数据。但考虑到有很多小伙伴没有服务器，于是Immugent退而求其次，下面就使用了其中26个样本的数据进行实操。</p><p data-tool="mdnice编辑器"><br></p><hr data-tool="mdnice编辑器"><h2 data-tool="mdnice编辑器"><span></span><span>主要内容</span><span></span></h2><p data-tool="mdnice编辑器">Analysis at the single cell level with Seurat</p><pre data-tool="mdnice编辑器"><code>library(SuperCell)<br>library(Seurat)<br>library(SingleCellExperiment)<br>library(ggplot2)<br>library(harmony)<br>library(reshape2)<br><br>gene_blacklist &lt;- readRDS(<span>"../data/gene_blacklist.rds"</span>)<br>pbmc &lt;- readRDS(<span>"../data/pbmc_COVID19_sce/S-S086-2_sce.rds"</span>)<br></code></pre><pre data-tool="mdnice编辑器"><code>sceRawToSeurat&lt;- <span>function</span>(pbmc,nfeatures = 1500) {<br>pbmc &lt;- CreateSeuratObject(counts = assay(pbmc),meta.data = data.frame(colData(pbmc)))<br>pbmc &lt;- FindVariableFeatures(pbmc,nfeatures = nfeatures)<br>VariableFeatures(pbmc) &lt;- VariableFeatures(pbmc)[!VariableFeatures(pbmc) %<span>in</span>% gene_blacklist]<br>pbmc &lt;- NormalizeData(pbmc)<br><span>return</span>(pbmc)<br>}<br><br>pbmc &lt;- sceRawToSeurat(pbmc)<br>pbmc &lt;- ScaleData(pbmc)<br>pbmc &lt;- RunPCA(pbmc, npcs = 20)<br>ElbowPlot(pbmc) <br>PCAPlot(pbmc,group.by = <span>"majorType"</span>)<br>pbmc &lt;-RunUMAP(pbmc, dims = c(1:20))<br>UMAPPlot(pbmc, group.by = <span>"majorType"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6YmiazZyTeGq9eAyMczhFftOzYriaBO9j5QtYkHt2MNgrq6nbPdZO2GPA/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6YmiazZyTeGq9eAyMczhFftOzYriaBO9j5QtYkHt2MNgrq6nbPdZO2GPA/640?wx_fmt=png"></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6icXvhY34NUABMEMkjWeWT1Kq9qiaQZAEbOm1kx8Q6963r8RSHibLrXCnQ/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6icXvhY34NUABMEMkjWeWT1Kq9qiaQZAEbOm1kx8Q6963r8RSHibLrXCnQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">We compute purity of metacells according to their assignment to the majorType annotation.</p><pre data-tool="mdnice编辑器"><code>makeSeuratMC &lt;- <span>function</span>(pbmc,<br>                         genes = NULL,<br>                         metaFields = c(<span>"majorType"</span>, <span>"sampleID"</span>, <span>"Age"</span>, <span>"Sex"</span>, <span>"celltype"</span>, <span>"PatientID"</span>, <span>"SARS.CoV.2"</span>, <span>"Outcome"</span>, <span>"datasets"</span>, <span>"CoVID.19.severity"</span>, <span>"Sample.time"</span>),<br>                         returnMC = F) {<br>  <br>  <span>if</span>(is.null(genes)) {<br>    genes &lt;- VariableFeatures(pbmc)<br>  }<br><br>MC &lt;- SCimplify(GetAssayData(pbmc,slot = <span>"data"</span>),  <span># normalized gene expression matrix </span><br>                 n.pc = 20,<br>                 k.knn = 5, <span># number of nearest neighbors to build kNN network</span><br>                 gamma = 20, <span># graining level</span><br>                 genes.use = genes )<span># will be the ones used for integration if input is seurat integrated data</span><br><br><br>MC<span>$purity</span> &lt;- supercell_purity(clusters = pbmc<span>$majorType</span>,<br>                           supercell_membership = MC<span>$membership</span>)<br><br><br><span>for</span> (m <span>in</span> metaFields) {<br>MC[[m]]&lt;- supercell_assign(clusters = pbmc@meta.data[,m], <span># single-cell assigment to cell lines (clusters)</span><br>                                    supercell_membership = MC<span>$membership</span>, <span># single-cell assignment to super-cells</span><br>                                    method = <span>"absolute"</span>)<br>}<br><br>GE &lt;- supercell_GE(as.matrix(GetAssayData(pbmc,slot = <span>"data"</span>)),groups = MC<span>$membership</span>)<br><br>seuratMC &lt;- supercell_2_Seurat(SC.GE = GE,MC,fields = c(metaFields,<span>"purity"</span>))<br><br>res &lt;- seuratMC<br><br><span>if</span> (returnMC) {<br>  res &lt;- list(seuratMC = seuratMC,SC = MC)<br>}<br><br><br><span>return</span>(res)<br>}<br><br>supercells &lt;- makeSeuratMC(pbmc,returnMC = T)<br>seuratMC &lt;- supercells<span>$seuratMC</span><br>seuratMC &lt;- RunUMAP(seuratMC,dims = c(1:20))<br>UMAPPlot(seuratMC,group.by = <span>"majorType"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6N8N83KXKb3JFibCrFBfvymsvHnlwxxrMtxo0BwqwjBFnjecOuHlzjwg/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6N8N83KXKb3JFibCrFBfvymsvHnlwxxrMtxo0BwqwjBFnjecOuHlzjwg/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><code>gene&lt;-as.matrix(GetAssayData(seuratMC)[<span>"CXCL8"</span>,])<br>correlations&lt;-apply(as.matrix(GetAssayData(seuratMC)),1,<span>function</span>(x){cor(gene,x)})<br><br>tf &lt;- read.table(<span>"../data/transcription.factor.activity.GO0003700.symbol.list"</span>)<br><br>correlations &lt;- correlations[names(correlations) %<span>in</span>% tf<span>$V1</span>]<br>head(sort(abs(correlations),decreasing = T),n = 10)<br><span>##     KLF10    ZNF467   ZNF385A      GAS7      KLF4      SPI1     CREB5       FOS </span><br><span>## 0.7478192 0.7443197 0.7143247 0.7117197 0.7097348 0.7096040 0.7070228 0.7046132 </span><br><span>##     CEBPD      LMO2 </span><br><span>## 0.6903713 0.6868367</span><br></code></pre><pre data-tool="mdnice编辑器"><code>FeatureScatter(object = pbmc, feature1 = <span>"CXCL8"</span>, feature2 = <span>'KLF10'</span>,group.by = <span>"majorType"</span>)<br>FeatureScatter(object = seuratMC, feature1 = <span>"CXCL8"</span>, feature2 = <span>'KLF10'</span>,group.by = <span>"majorType"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6ZAicNN17X9gk8sFlG1B6VCPpPGFibJFULwS5fibJvb3V1SNUwBE0IhqDg/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6ZAicNN17X9gk8sFlG1B6VCPpPGFibJFULwS5fibJvb3V1SNUwBE0IhqDg/640?wx_fmt=png"></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6icoe3DvCdtknMa0D0yvFXvm9WL5iayOVnVOQuiauz3AJh3s1yAaxabhrA/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6icoe3DvCdtknMa0D0yvFXvm9WL5iayOVnVOQuiauz3AJh3s1yAaxabhrA/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><code>supercell_GeneGenePlot(GetAssayData(seuratMC),<br>                       gene_x = <span>"CXCL8"</span>,gene_y = <span>"FOS"</span>,<br>                       supercell_size = seuratMC<span>$size</span>,<br>                       clusters = seuratMC<span>$majorType</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6icbicJZ6WHhWViaLYkwWLnLrCYmtscjmfaBE9yyrDQ18dws5J49vK3Sibw/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6icbicJZ6WHhWViaLYkwWLnLrCYmtscjmfaBE9yyrDQ18dws5J49vK3Sibw/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><code>files &lt;- list.files(<span>"../data/pbmc_COVID19_sce"</span>,full.names = T)<br><br><span># Uncomment if you have less than 20GB of memory</span><br> files &lt;- readRDS(<span>"../data/lowMemFileList.rds"</span>)<br><br><span># Uncomment if you less than 16GB of memory</span><br>files &lt;- files[c(1:6)]<br><br>MC.list &lt;- list()<br>MC.list[[<span>"S-S086-2"</span>]] &lt;- seuratMC<br><span>for</span> (f <span>in</span> files[<span>which</span>(files != <span>"../data/pbmc_COVID19_sce/S-S086-2_sce.rds"</span>)]) {<br>  smp &lt;- readRDS(f)<br>  smp &lt;- sceRawToSeurat(smp)<br>  seuratMC &lt;- makeSeuratMC(smp)<br>  MC.list[[seuratMC<span>$sampleID</span>[1]]] &lt;- seuratMC<br>}<br>features &lt;- SelectIntegrationFeatures(MC.list,nfeatures = 1500)<br>features &lt;- features[!features %<span>in</span>% gene_blacklist]<br>nSingleCells &lt;- 0<br><span>for</span> (i <span>in</span> 1:length(MC.list)) {<br>  MC.list[[i]] &lt;- RenameCells(MC.list[[i]],add.cell.id = unique(MC.list[[i]]<span>$sampleID</span>))<br>  MC.list[[i]] &lt;- ScaleData(MC.list[[i]],features = features)<br>  MC.list[[i]] &lt;- RunPCA(MC.list[[i]] ,features = features,npcs = 20)<br>  nSingleCells &lt;- nSingleCells + sum(MC.list[[i]]<span>$size</span>)<br>}<br>nSingleCells  <span>## [1] 51595</span><br></code></pre><pre data-tool="mdnice编辑器"><code>reference &lt;- <span>which</span>(c(<span>"S-S086-2"</span>,<span>"S-M064"</span>) %<span>in</span>% names(MC.list)) <br>  <br>anchors &lt;- FindIntegrationAnchors(object.list = MC.list,<br>                                  reference = reference, <br>                                  reduction = <span>"rpca"</span>,<br>                                  anchor.features = features,<br>                                  dims = 1:20)<br><br>integrated &lt;- IntegrateData(anchorset = anchors, dims = 1:20)<br>DefaultAssay(integrated) = <span>"integrated"</span><br>integrated &lt;- ScaleData(integrated, verbose = T)<br>integrated &lt;- RunPCA(integrated, verbose = FALSE)<br>integrated &lt;- RunUMAP(integrated, dims = 1:20)<br>UMAPPlot(integrated,group.by = <span>"sampleID"</span>)<br>UMAPPlot(integrated,group.by = <span>"majorType"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6oXx8nJlzZzSd3u4WclDnDMzf3IDDrGsML9HW06hGtP4Eq7XnCSOEcg/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6oXx8nJlzZzSd3u4WclDnDMzf3IDDrGsML9HW06hGtP4Eq7XnCSOEcg/640?wx_fmt=png"></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6ChnCUWGAbHPLMf3tp8QW6G6jIOKJb2GHRKD3W32QOlsIicWpbNsktNg/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6ChnCUWGAbHPLMf3tp8QW6G6jIOKJb2GHRKD3W32QOlsIicWpbNsktNg/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><code>majorTypeCounts &lt;- aggregate(integrated<span>$size</span>, by=list(majorType = integrated<span>$majorType</span>,Severity = integrated<span>$CoVID</span>.19.severity,Time = integrated<span>$Sample</span>.time), FUN=sum)<br><br>majorTypeCounts<span>$group</span> = paste(majorTypeCounts<span>$Severity</span>,majorTypeCounts<span>$Time</span>,sep = <span>"_"</span>)<br>contingencyTable &lt;- xtabs(x ~ group + majorType,data = majorTypeCounts)<br>res &lt;- chisq.test(contingencyTable)<br>Roe &lt;- res<span>$observed</span>/res<span>$expected</span><br><br>melted_Roe &lt;- melt(Roe, na.rm = TRUE)<br><span># Heatmap</span><br>ggplot(data = melted_Roe, aes(majorType,group,  fill = value))+<br> geom_tile() + scale_fill_gradient2(low = <span>"blue"</span>, high = <span>"red"</span>, mid = <span>"white"</span>, <br>   midpoint = 1, space = <span>"Lab"</span>,<br>   name=<span>"Ro/e"</span>) +<br>  theme_minimal()+ <br> theme(axis.text.x = element_text(angle = 45, vjust = 1, <br>    size = 12, hjust = 1))+<br> coord_fixed()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.32697947214076245" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm66R4mcviboDzH4YBVFjuNl09ZsLgSUgabNssbojebR1TVePkazWS9UIg/640?wx_fmt=png" data-type="png" data-w="682" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm66R4mcviboDzH4YBVFjuNl09ZsLgSUgabNssbojebR1TVePkazWS9UIg/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><code>Idents(integrated) &lt;- <span>"majorType"</span><br>markersMega &lt;- FindMarkers(integrated,ident.1 = <span>"Mega"</span>, only.pos = T)<br>markersMega &lt;- markersMega[markersMega<span>$p_val_adj</span> &lt; 0.05, ]<br>markersMega[order(markersMega<span>$avg_log2FC</span>, decreasing = T), ]<br>cytokines_Mega_ori_study &lt;- c(<span>"PDGFA"</span>, <span>"TGFB1"</span>, <span>"TNFSF4"</span>, <span>"PF4V1"</span>, <span>"PF4"</span>, <span>"PPBP"</span>)<br>cytokines_Mega_ori_study %<span>in</span>% rownames(markersMega)<br></code></pre><pre data-tool="mdnice编辑器"><code>Idents(integrated) &lt;- <span>"majorType"</span><br>VlnPlot(integrated, features = cytokines_Mega_ori_study, pt.size = 0.1)<br>Idents(MC.list[[<span>"S-S086-2"</span>]]) &lt;- <span>"majorType"</span><br><br>pbmc2 &lt;- pbmc[, pbmc<span>$majorType</span> %<span>in</span>% levels(MC.list[[<span>"S-S086-2"</span>]])] <span>#to have the same majorType in MC and single cell object see below</span><br>pbmc2<span>$majorType</span> &lt;- factor(pbmc2<span>$majorType</span>,levels = levels(MC.list[[<span>"S-S086-2"</span>]]))<br>Idents(pbmc2) &lt;- <span>"majorType"</span><br><br>VlnPlot(pbmc2, features = cytokines_Mega_ori_study, pt.size = 0.1)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6l4uyH281r1jekCawLj5tutktt8qJnyCC8plDkKzT0adlasZ1entic8Q/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6l4uyH281r1jekCawLj5tutktt8qJnyCC8plDkKzT0adlasZ1entic8Q/640?wx_fmt=png"></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6K2xYbjlM3WflG8fnnkzzgUIE3CkXvpQtU7TNXzQO9MhfetjVCCIAJw/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6K2xYbjlM3WflG8fnnkzzgUIE3CkXvpQtU7TNXzQO9MhfetjVCCIAJw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">About metacell purity</p><pre data-tool="mdnice编辑器"><code>Neu &lt;- colnames(pbmc[,pbmc<span>$majorType</span> == <span>"Neu"</span>])<br>Neu<br>supercells<span>$seuratMC</span><span>$majorType</span>[supercells<span>$SC</span><span>$membership</span>[Neu]]<br></code></pre><pre data-tool="mdnice编辑器"><code>MC_majorTypes &lt;- lapply(X = unique(supercells<span>$seuratMC</span><span>$majorType</span>), FUN = <span>function</span>(x){SC &lt;- SCimplify(GetAssayData(pbmc[,pbmc<span>$majorType</span> == x],slot = <span>"data"</span>),<br>       n.pc = 20,<br>       k.knn = 5, <span># number of nearest neighbors to build kNN network</span><br>       gamma = 20 <span># graining level</span><br>);SC<span>$majorType</span> = rep(x,SC<span>$N</span>.SC);<span>return</span>(SC)})<br><br><br><br>Neu_MC &lt;- SCimplify(GetAssayData(pbmc[,pbmc<span>$majorType</span> == <span>"Neu"</span>],slot = <span>"data"</span>),<br>       n.pc = 3,<br>       k.knn = 4, <span># number of nearest neighbors to build kNN network</span><br>       gamma = 1 <span># graining level</span><br>)<br><br>Neu_MC<span>$majorType</span> &lt;- rep(<span>"Neu"</span>,Neu_MC<span>$N</span>.SC)<br><br>MC_majorTypes &lt;- c(MC_majorTypes,list(Neu_MC))<br><br>MC_majorTypes2 &lt;- supercell_merge(MC_majorTypes, fields = <span>"majorType"</span>)<br><br>MC_majorTypes_GE &lt;- supercell_GE(as.matrix(GetAssayData(pbmc)[,names(MC_majorTypes2<span>$membership</span>)]),groups = MC_majorTypes2<span>$membership</span>)<br><br>MC_majorTypes2<span>$genes</span>.use &lt;- VariableFeatures(pbmc)<br><br>seuratPureMC &lt;- supercell_2_Seurat(SC.GE = MC_majorTypes_GE,<br>                                   SC = MC_majorTypes2,<br>                                   fields = c(<span>"majorType"</span>))<br></code></pre><p data-tool="mdnice编辑器"><br></p><p data-tool="mdnice编辑器">cell.split.condition option of the SCimplify function that is faster but lead to a less good separation of T, B and NK cells at the metacell level…</p><pre data-tool="mdnice编辑器"><code>seuratPureMC &lt;- RunUMAP(seuratPureMC,dims = c(1:20))<br>UMAPPlot(seuratPureMC,group.by = <span>"majorType"</span>)<br>pureMC &lt;- SCimplify(GetAssayData(pbmc,slot = <span>"data"</span>),  <span># normalized gene expression matrix</span><br>                 n.pc = 20,<br>                 k.knn = 5, <span># number of nearest neighbors to build kNN network</span><br>                 gamma = 20, <span># graining level</span><br>                 genes.use = VariableFeatures(pbmc),<br>                 cell.split.condition = pbmc<span>$majorType</span>)<br><br><br><br><br>pureMC[[<span>"majorType"</span>]]&lt;- supercell_assign(clusters = pbmc@meta.data[,<span>"majorType"</span>], <span># single-cell assignment to cell lines (clusters)</span><br>                                    supercell_membership = pureMC<span>$membership</span>, <span># single-cell assignment to super-cells</span><br>                                    method = <span>"absolute"</span>)<br><br><br>GE &lt;- supercell_GE(as.matrix(GetAssayData(pbmc,slot = <span>"data"</span>)),groups = pureMC<span>$membership</span>)<br><br><br>seuratPureMC &lt;- supercell_2_Seurat(SC.GE = GE,<br>                                   SC = pureMC,<br>                                   fields = c(<span>"majorType"</span>))<br>                                   <br>seuratPureMC &lt;- RunUMAP(seuratPureMC,dims = c(1:20))<br>UMAPPlot(seuratPureMC,group.by = <span>"majorType"</span>)                     <br><br>seuratPureMC &lt;- ScaleData(seuratPureMC)<br>seuratPureMC &lt;- RunPCA(seuratPureMC, npcs = 20)<br>seuratPureMC &lt;- RunUMAP(seuratPureMC,dims = c(1:20))<br>UMAPPlot(seuratPureMC,group.by = <span>"majorType"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6f7drxKglRIBcWs7iamibyPmRksUQv4pzSL9FwibC867MbzmNLL3kygNiaQ/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6f7drxKglRIBcWs7iamibyPmRksUQv4pzSL9FwibC867MbzmNLL3kygNiaQ/640?wx_fmt=png"></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6BZZawZ7UKs1YpoXTQJPUIfGJkZRqzlBCS4GQ966r2T3PAuQaLJeF9Q/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7dPbL2SFgicyoNYjWSzk5Xm6BZZawZ7UKs1YpoXTQJPUIfGJkZRqzlBCS4GQ966r2T3PAuQaLJeF9Q/640?wx_fmt=png"></figure><hr data-tool="mdnice编辑器"><h2 data-tool="mdnice编辑器"><span></span><span>展望</span></h2></section><p data-tool="mdnice编辑器">想必跟着今天的代码进行实操的小伙伴就会有更深刻的体会，使用原始数据跑seurat流程和使用supercell整合后的元细胞数据跑seurat流程有天差地别的时间体验。对于supercell整合后的元细胞数据的其它优点，Immugent在前面一篇推文中就已经介绍过了，这里就不再赘述。</p><p data-tool="mdnice编辑器">此外，我们还需要注意的是并不是所有的单细胞数据分析流程都是适合使用supercell进行整合的，很大一定程度上取决于要解决的科学问题。比如，想通过单细胞数据来找到一群占比很少的稀有细胞，那么就不能使用supercell进行整合，因为这样很可能就会丢失这部分细胞的信息。相反，如果只是想基于单细胞数据分析找到某一种处理或者疾病状态下对主要细胞类型的影响，那使用upercell进行数据整合是非常具有优势的。</p><p data-tool="mdnice编辑器">好啦，本期分享到这就结束了，我们下期再会~~</p><p data-tool="mdnice编辑器"><br></p><hr data-tool="mdnice编辑器"></section><p><img data-galleryid="" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/GL6g5Y3aR7f28iaAPOSZyaVreHSWoQket3gNW3WtOGwutAMDGYKSk6ZBOdhDUyS95mNMn5INvyOIibBSfHgzI6sQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="258" src="https://mmbiz.qpic.cn/mmbiz_jpg/GL6g5Y3aR7f28iaAPOSZyaVreHSWoQket3gNW3WtOGwutAMDGYKSk6ZBOdhDUyS95mNMn5INvyOIibBSfHgzI6sQ/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span>关注下方公众号下回更新不迷路</span></h3><section><mp-common-profile data-id="MzI4MjY5ODI1Nw==" data-pluginname="mpprofile" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7f28iaAPOSZyaVreHSWoQketIFUzNSiayMfvqbyCD0TNcBv06SGnkaO1gXRsN9icoQ23IjMJ5ta3Jia9w/0?wx_fmt=png" data-nickname="生信宝库" data-alias="sxbk2020" data-signature="用于生信知识的收集与传播，以及生信人之间学习交流。本公众号各小编平时忙于科研，更新文章较其它同类型公众号较慢，但保持宁缺毋滥的本心，只更新对大家有用的推文。" data-from="2" data-is_biz_ban="0"></mp-common-profile><span></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/z8XI5ql76ikKSJb9YKA6YQ",target="_blank" rel="noopener noreferrer">原文链接</a>
