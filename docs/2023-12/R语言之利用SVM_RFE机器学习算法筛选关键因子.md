---
title: "R语言之利用SVM-RFE机器学习算法筛选关键因子"
date: 2023-12-28T01:52:22Z
draft: ["false"]
tags: [
  "fetched",
  "蜡笔生信菌"
]
categories: ["Acdemic"]
---
R语言之利用SVM-RFE机器学习算法筛选关键因子 by 蜡笔生信菌
------
<div><section><section><section><section><section><img data-ratio="0.984" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/WDMBL81z7FQydR8TJ21TZp9N58PnNsykp7ic7v2zERpY8xAzMnOacdyqVN5p9e5th6nAIfnY7AGibhP7ibAKLaPuw/640?wx_fmt=png" data-type="png" data-w="500" src="https://mmbiz.qpic.cn/mmbiz_png/WDMBL81z7FQydR8TJ21TZp9N58PnNsykp7ic7v2zERpY8xAzMnOacdyqVN5p9e5th6nAIfnY7AGibhP7ibAKLaPuw/640?wx_fmt=png"></section></section></section><section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section><section><section><section><img data-ratio="0.69" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/WDMBL81z7FQydR8TJ21TZp9N58PnNsykiaicn0hPwkHBBqW0mr8yEYibXdmPiaeu5HW2kibStpNKz3MqEfZebfE034w/640?wx_fmt=png" data-type="png" data-w="500" src="https://mmbiz.qpic.cn/mmbiz_png/WDMBL81z7FQydR8TJ21TZp9N58PnNsykiaicn0hPwkHBBqW0mr8yEYibXdmPiaeu5HW2kibStpNKz3MqEfZebfE034w/640?wx_fmt=png"></section></section></section></section><section><section><section><p>今天介绍一篇最近发表在《Functional &amp; Integrative Genomics》上的文献《Identification of predictors for neurological outcome after cardiac arrest in peripheral blood mononuclear cells through integrated bioinformatics analysis and machine learning》</p><p><br></p></section><section><section><img data-ratio="0.26481481481481484" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/WDMBL81z7FQydR8TJ21TZp9N58PnNsykU5LpX3pjs4jUnc3OfK0oxZJVf4nMen0Be17BaKw26yuSVv9vJgwgWQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/WDMBL81z7FQydR8TJ21TZp9N58PnNsykU5LpX3pjs4jUnc3OfK0oxZJVf4nMen0Be17BaKw26yuSVv9vJgwgWQ/640?wx_fmt=png"></section></section><section><p><strong><br></strong></p><p><strong>摘要</strong></p><p>心脏骤停(CA)后的神经学预测是重要的，以避免因预后差而寻求徒劳的治疗，以及为获得良好结果而不适当地停止维持生命的治疗。为了通过外周血单核细胞中的生物标记物预测CA术后的神经学结果，从基因表达总库下载了四个数据集。使用GSE29546和GSE74198作为训练数据集，使用GSE92696和GSE34643作为验证数据集。利用多尺度嵌入式基因共表达网络分析(MEGENA)中的差异表达基因和HUB基因的交集进行机器学习筛选。关键基因的识别使用支持向量机递归特征消除(SVM-RFE)、最小绝对收缩和选择算子(LASSO)Logistic回归和随机森林(RF)。通过对接收机工作特性曲线的分析，对结果进行了验证。构建了mRNAmiRNA网络。免疫细胞的分布是通过估计RNA转录本的相对亚集来进行细胞类型鉴定的(Cibersorte)。有5个生物标志物被确定为CA后神经预后的预测指标，曲线下面积(AUC)大于0.7：Casp8和FADD样细胞凋亡调节因子(CFLAR)、人蛋白激酶X(PRKX)、miR-483-5p、let-7a-5p和let-7c-5p。有趣的是，CFLAR减去PRKX的组合显示出更高的AUC值，为0.814。MRNA-miRNA网络由30个节点和76条边组成。中性粒细胞、NK细胞活化、NK细胞静息、T细胞CD4记忆激活、T细胞CD4记忆静息、T细胞CD8、B细胞记忆、肥大细胞静息等免疫细胞分布在CA术后神经功能恢复好与差的个体间差异有统计学意义。总而言之，我们的研究确定了CA术后神经预后的新预测因子。还需要进一步的临床和实验室研究来验证我们的发现。</p><p><br></p><p><strong>方法：</strong><br></p><p>SVM-RFE主要是借助e1071包， 实现mSVM-REF识别并筛选关键基因，没有安装的小伙伴需要安装一下。</p></section><section><section><ul><li></ul><pre data-lang="r"><code><span>install.packages(<span>"e1071"</span>)</span></code></pre></section></section><section><p>mSVM-REF函数是John Colby教授写的链接（https://github.com/johncolby/SVM-RFE）。如无法上GitHub，也可在gitee仓库里下载（https://gitee.com/lzh23/GEO1）</p><p><br></p></section><section><section><img data-ratio="0.4547008547008547" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/WDMBL81z7FQydR8TJ21TZp9N58PnNsykpv5KTXNZ0nLpcOhZwTNQDfEbMUGe0km8ZkWTLNXCZDDnMDd5JLfIHw/640?wx_fmt=png" data-type="png" data-w="585" src="https://mmbiz.qpic.cn/mmbiz_png/WDMBL81z7FQydR8TJ21TZp9N58PnNsykpv5KTXNZ0nLpcOhZwTNQDfEbMUGe0km8ZkWTLNXCZDDnMDd5JLfIHw/640?wx_fmt=png"></section></section><section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="r"><code><span>set.seed(<span>2023</span>)</span></code><code><span>library(e1071)</span></code><code><span><br></span></code><code><span><span>#这里填写你存放的文件路径</span></span></code><code><span>source(<span>"D:\\ProgramFiles\\R\\Work\\msvmRFE.R"</span>)</span></code><code><span><br></span></code><code><span>nfold = <span>10</span> <span>#10倍交叉验证</span></span></code><code><span>nrows = nrow(input)</span></code><code><span>folds = <span>rep</span>(<span>1</span>:nfold, len=nrows)[sample(nrows)]</span></code><code><span>folds = lapply(<span>1</span>:nfold, <span>function</span>(x) which(folds == x))</span></code><code><span><br></span></code><code><span>results = lapply(folds, svmRFE.wrap, input, k=<span>10</span>, halve.above=<span>100</span>)</span></code><code><span>top.features = WriteFeatures(results, input, save=<span>F</span>)</span></code><code><span>featsweep = lapply(<span>1</span>:<span>5</span>, FeatSweep.wrap, results, input)</span></code><code><span><br></span></code><code><span>no.info = <span>min</span>(prop.table(table(input[,<span>1</span>])))</span></code><code><span>errors = sapply(featsweep, <span>function</span>(x) ifelse(<span>is.null</span>(x), <span>NA</span>, x$error))</span></code><code><span><br></span></code><code><span>pdf(<span>"svm_rfe.pdf"</span>, height = <span>8</span>, width = <span>10</span>)</span></code><code><span>PlotErrors(errors, no.info=no.info)</span></code><code><span>dev.off()</span></code><code><span>plot(top.features)<span>#这个图也可以保存</span></span></code></pre></section></section><section><p>另外还参考了的Maryam教授的并行代码链接（https://github.com/Maryam-Razmjouei/Parallel-SVM-RFE），并行计算，提高计算速度。前提是要在win10系统中需要安装Rmpi。如果没安装成功，就不要尝试了，用上面的代码让它慢慢跑也是可以出结果的。</p></section><section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="r"><code><span>set.seed(<span>2023</span>)</span></code><code><span><br></span></code><code><span>library(e1071)</span></code><code><span>library(Rmpi)</span></code><code><span>library(snow)</span></code><code><span>library(parallel)</span></code><code><span><br></span></code><code><span><span>#这里填写你存放的文件路径</span></span></code><code><span>source(<span>"D:\\ProgramFiles\\R\\Work\\msvmRFE.R"</span>)</span></code><code><span><br></span></code><code><span>nfold = <span>10</span> <span>#10倍交叉验证</span></span></code><code><span>nrows = nrow(input)</span></code><code><span>folds = <span>rep</span>(<span>1</span>:nfold, len=nrows)[sample(nrows)]</span></code><code><span>folds = lapply(<span>1</span>:nfold, <span>function</span>(x) which(folds == x))</span></code><code><span><br></span></code><code><span><span>#make a cluster</span></span></code><code><span>cl &lt;- makeMPIcluster(mpi.universe.size())</span></code><code><span><br></span></code><code><span>clusterExport(cl, <span>list</span>(<span>"input"</span>,<span>"svmRFE"</span>,<span>"getWeights"</span>,<span>"svm"</span>))</span></code><code><span>results &lt;-parLapply(cl,folds, svmRFE.wrap, input, k=<span>10</span>, halve.above=<span>100</span>)</span></code><code><span>top.features = WriteFeatures(results, input, save=<span>F</span>)</span></code><code><span><br></span></code><code><span>clusterExport(cl, <span>list</span>(<span>"top.features"</span>,<span>"results"</span>, <span>"tune"</span>,<span>"tune.control"</span>))</span></code><code><span>featsweep = parLapply(cl,<span>1</span>:<span>100</span>, FeatSweep.wrap, results, input)</span></code><code><span>stopCluster(cl)</span></code><code><span><br></span></code><code><span>no.info = <span>min</span>(prop.table(table(input[,<span>1</span>])))</span></code><code><span>errors = sapply(featsweep, <span>function</span>(x) ifelse(<span>is.null</span>(x), <span>NA</span>, x$error))</span></code><code><span><br></span></code><code><span>pdf(<span>"svm_rfe.pdf"</span>, height = <span>8</span>, width = <span>10</span>)</span></code><code><span>PlotErrors(errors, no.info=no.info)</span></code><code><span>dev.off()</span></code><code><span>plot(top.features)</span></code><code><span>mpi.exit()</span></code></pre></section></section><section><p><br></p><p>文章中所用的其他代码，包括下载数据、差异分析、lasso回归、随机森林等网上的攻略已经很多了，就不再重复，只是把实际使用的贴出来给大家做参考，可以点旁边这个链接访问（https://gitee.com/lzh23/GEO1）。<br></p><p><br></p><p><strong>Geo.R里的主要内容，针对bulk-seq数据：</strong></p><p>GEOquery包下载GEO中的数据。（有时候下不下来还是需要自己手动下载读取）</p><p>limma包对芯片数据进行差异分析。</p><p>DESeq2包对测序数据进行差异分析。</p><p>MEGENA包构建共表达图谱。</p><p>glmnet包实现lasso回归筛选</p><p>randomForest包实现随机森林筛选。</p><p>venn包绘制韦恩图。</p><p>pROC包检验预测效果。</p><p>CIBERSORT进行免疫浸润分析（函数代码http://rdrr.io/github/singha53/amritr/src/R/supportFunc_cibersort.R）。</p><p>用ggplot2，余叔的aplot等包进行了一些可视化。</p></section><section><p><br></p><p><strong>scRNA.R里的主要内容，针对scRNA-seq数据</strong></p><p>使用Seurat包进行单细胞数据的预处理，降维聚类，确定细胞类型，分析差异基因。</p><p>使用CellChat包进行细胞互作分析。</p><p>使用SCENIC包进行调控网络分析。</p><p>使用Monocle3包进行拟时序分析。</p><p>以及一些未使用，但测试可用，不知道用来干啥的代码。</p><p><br></p><p><strong>最后想说，其实这些代码都是别人写好的，我只是搬运过来。就好比人家花了好多时间养好的鱼被我买过来，再卖给大家，我是个香香的卖鱼的。</strong></p><p><strong>我不生产代码，只是代码的搬运工！</strong></p><p><br></p></section></section></section><section><section><section><section><img data-ratio="0.5343511450381679" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_gif/WDMBL81z7FQydR8TJ21TZp9N58PnNsyk3xx7MxTQiadDYbBvRlrPpdiaicia5IAticDtehvFr0DBzWO8icBqfLXMPQ2g/640?wx_fmt=gif" data-type="gif" data-w="393" src="https://mmbiz.qpic.cn/mmbiz_gif/WDMBL81z7FQydR8TJ21TZp9N58PnNsyk3xx7MxTQiadDYbBvRlrPpdiaicia5IAticDtehvFr0DBzWO8icBqfLXMPQ2g/640?wx_fmt=gif"></section></section></section><section><section><section><p><strong>你们点点<span>“分享”</span>，给我充点儿电吧~</strong></p></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/UT-Sa6I8T9BUA30tues6xQ",target="_blank" rel="noopener noreferrer">原文链接</a>
