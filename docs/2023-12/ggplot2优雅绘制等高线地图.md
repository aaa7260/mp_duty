---
title: "ggplot2优雅绘制等高线地图"
date: 2023-12-20T15:53:10Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
ggplot2优雅绘制等高线地图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节通过一个案例来介绍如何使用ggplot2来绘制二维密度地图，整个过程仅参考。希望对各位观众老爷能有所帮助。<strong>「数据代码已经整合上传到2023VIP交流群」</strong>，加群的观众老爷可自行下载，有需要的朋友可关注文末介绍加入VIP交流群。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关于永久群内容的说明</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>给予长期支持我们的忠实读者们一个特别待遇：凡是购买过小编2022年或2023年VIP会员文档的朋友们，<strong>「将自动获得2024年及以后更新的绘图文档代码，无需额外付费。」</strong>目前这两年的会员文档已累计卖出1500+，质量方面各位无需担忧。简要概括就是只要购买任意1年的会员内容，2024及后期公众号所更新的绘图文档均会在已经加入的会员群内分享。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br>install.packages(<span>"mapdata"</span>)<br>install.packages(<span>"stopwords"</span>)<br><span>library</span>(mapdata)<br><span>library</span>(ggtext)<br><span>library</span>(stopwords)<br><span>library</span>(tidytext)<br><span>library</span>(ggrepel)<br><span>library</span>(tidyverse)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>historical_markers &lt;- read_csv(<span>'historical_markers.csv'</span>) <br>no_markers &lt;- read_csv(<span>'no_markers.csv'</span>) <br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>combined &lt;- historical_markers %&gt;%<br>  filter(!(state_or_prov %<span>in</span>% c(<span>"Alaska"</span>, <span>"Hawaii"</span>, <span>"Puerto Rico"</span>))) %&gt;%  <span># 筛选出除阿拉斯加、夏威夷和波多黎各外的州或省</span><br>  group_by(state_or_prov) %&gt;%<br>  summarize(text = paste(title, collapse = <span>" "</span>))  <span># 按州或省分组，并将每组的标题合并成一个字符串</span><br>combined$words &lt;- str_replace_all(combined$text, <span>"[[:punct:]]"</span>, <span>""</span>)  <span># 移除所有的标点符号</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载地图数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>state_info &lt;- map_data(<span>"state"</span>)  <span># 加载美国各州的地图数据</span><br><br>state_labels &lt;- state_info %&gt;%<br>   group_by(region) %&gt;%<br>   summarise(min_long = min(long),max_long = max(long),<br>             min_lat = min(lat),max_lat = max(lat),<br>             range_long = max_long - min_long,<br>             range_lat = max_lat - min_lat,<br>             long = min_long + range_long/2,<br>             lat = min_lat + range_lat/2) %&gt;%<br>  mutate(long= case_when(region %<span>in</span>% c(<span>"michigan"</span>, <span>"florida"</span>) ~ long + 2,region == <span>"idaho"</span> ~ long -1,<br>                         region == <span>"virginia"</span> ~ long + 1,RUE ~ long)) %&gt;%<br>  mutate(lat = case_when(region == <span>"maryland"</span> ~ lat + 0.5,TRUE ~ lat)) %&gt;%<br>  select(region, long, lat) %&gt;%<br>  right_join(word_by_state, by = c(<span>"region"</span> = <span>"state_or_prov"</span>))  <span># 计算每个州的地理中心位置，并将其与词汇数据合并</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>historical_markers %&gt;%<br>  filter(!(state_or_prov %<span>in</span>% c(<span>"Alaska"</span>, <span>"Hawaii"</span>, <span>"Puerto Rico"</span>))) %&gt;%<br>  ggplot()+<br>  geom_polygon(aes(x=long, y=lat, group = group), data = state_info, fill = <span>NA</span>, color = <span>"black"</span>, linewidth = <span>0.15</span>)+<br>  coord_fixed(ratio = <span>1.3</span>) +<br>  geom_density2d_filled(aes(x=longitude_minus_w, y=latitude_minus_s), show.legend = <span>FALSE</span>, alpha=<span>0.4</span>, bins=<span>7</span>)+<br>  scale_fill_manual(values = c(<span>"white"</span>, <span>"#CEE9e9"</span>, <span>"#84BBD8"</span>, <span>"#F8F2BE"</span>, <span>"#FEC376"</span>, <span>"#F88A51"</span>, <span>"#A50026"</span>))+<br>  geom_text(data = state_labels %&gt;% filter(!(region %<span>in</span>% c(<span>"massachusetts"</span>, <span>"connecticut"</span>, <span>"new jersey"</span>, <span>"delaware"</span>,<br>                                                           <span>"maryland"</span>, <span>"district of columbia"</span>, <span>"new hampshire"</span>))), <br>            aes(x = long, y = lat, label = word), size =<span>2</span>, inherit.aes = <span>FALSE</span>)+<br>  geom_text_repel(data = state_labels %&gt;% filter(region %<span>in</span>% c(<span>"massachusetts"</span>, <span>"connecticut"</span>, <span>"new jersey"</span>, <span>"delaware"</span>,<br>                                                               <span>"maryland"</span>, <span>"district of columbia"</span>, <span>"new hampshire"</span>)), <br>                  aes(x=long, y=lat, label = word), nudge_x = c(<span>5</span>, <span>3</span>, <span>5</span>, <span>4</span>, <span>5</span>, <span>4</span>, <span>4</span>),<br>                  nudge_y = c(<span>0</span>, <span>0</span>, -<span>3</span>, <span>0</span>, <span>0</span>, <span>0</span>, <span>0</span>), size = <span>2</span>, min.segment.length = <span>0.2</span>)+<br>  theme_classic()+<br>  theme(axis.ticks = element_blank(),<br>        axis.line = element_blank(),<br>        axis.text = element_blank(),<br>        axis.title = element_blank(),<br>        plot.background = element_blank(),<br>        panel.background =element_blank())<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100025049" data-ratio="0.6407407407407407" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZhKDD835WjtlFAwqxZlEz8KGy0NTdSibDxmWn23iaCLWKSOZF49AOVqx9NckBbtBr2aYbRR8lnIYwg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZhKDD835WjtlFAwqxZlEz8KGy0NTdSibDxmWn23iaCLWKSOZF49AOVqx9NckBbtBr2aYbRR8lnIYwg/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节介绍到此结束，有需要学习数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>下单购买，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，无论购买那一年的会员文档都将获取<strong>「2024年及以后更新的绘图文档」</strong>，早买早享受，需要了解更多信息的朋友欢迎淘宝店铺交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝扫一扫</span><span></span></h3><p><img data-galleryid="" data-imgfileid="100025062" data-ratio="1.592920353982301" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZhKDD835WjtlFAwqxZlEz8ziaxakqMhN3JotAib1FSZgwasOkzyLeDtnax2dQGTtLDauTVcmyU5Ilw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="678" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZhKDD835WjtlFAwqxZlEz8ziaxakqMhN3JotAib1FSZgwasOkzyLeDtnax2dQGTtLDauTVcmyU5Ilw/640?wx_fmt=png&amp;from=appmsg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺(有需要欢迎关注)</span><span></span></h3><p><img data-galleryid="" data-imgfileid="100019415" data-ratio="1.0210420841683367" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg" data-type="jpeg" data-w="998" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/7ETkHXuPe9Pftk-7CbhLFg",target="_blank" rel="noopener noreferrer">原文链接</a>
