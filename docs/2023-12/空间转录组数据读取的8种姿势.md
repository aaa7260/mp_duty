---
title: "空间转录组数据读取的8种姿势"
date: 2023-12-16T12:55:47Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
空间转录组数据读取的8种姿势 by 生信菜鸟团
------
<div><section><section powered-by="xiumi.us"><section><section><section><section powered-by="xiumi.us"><section><section><p><strong><span>“</span></strong><span> <span>空间转录组测序主要包括5个步骤，我们着重下游分析部分：</span><strong>空转数据分析和可视化</strong>。本篇主分享如何使用python和R读取空转数据，主要使用python中的scanpy stlearn 和R中的seurat包<strong><span>”</span></strong></span></p><hr><p><span><strong><span></span></strong></span></p><p><span><strong><span><br></span></strong></span></p><h3><span>引言</span></h3><p><img data-galleryid="" data-imgfileid="100001459" data-ratio="0.5166666666666667" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktlWoKGrViac3hZddlJw5ibCLgia7IAXFp7zE9QCIrUc54oEDv8LGDKgnvhicUSopqc0cAAibatYrrSkfg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktlWoKGrViac3hZddlJw5ibCLgia7IAXFp7zE9QCIrUc54oEDv8LGDKgnvhicUSopqc0cAAibatYrrSkfg/640?wx_fmt=png&amp;from=appmsg"></p><hr><p><span><strong><span><strong><span></span></strong></span></strong></span></p><p><br></p><p><span><strong><span><strong><span>在正式开始之前，我们先看看cellranger流程跑完之后，空间转录组结果的数据组成，主要是两部分：</span></strong></span></strong></span></p><ul><li><p><span><strong><span><strong><span>1.表达<em>矩阵文件夹</em><br></span></strong></span></strong></span></p></li><li><p><span><strong><span><strong><span>2.空转</span></strong><em><span>图片文件夹</span></em><strong><span><br></span></strong></span></strong></span></p></li></ul><p><br></p><ul><li><p><span><strong><span><strong><span>1.表达<em>矩阵文件夹</em></span></strong></span></strong></span></p></li></ul><p><br></p><p><img data-galleryid="" data-imgfileid="100001461" data-ratio="0.25075225677031093" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktlWoKGrViac3hZddlJw5ibCL76Cic4oPzVnUuObjV2rzdyZdyunqG6oLXicAPqHHddQ8HkYCnGIaanEQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="997" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktlWoKGrViac3hZddlJw5ibCL76Cic4oPzVnUuObjV2rzdyZdyunqG6oLXicAPqHHddQ8HkYCnGIaanEQ/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><ul><li><p><span><strong><span><strong><span>2.表达<em>矩阵文件夹</em></span></strong></span></strong></span></p></li></ul><p><br></p><p><img data-galleryid="" data-imgfileid="100001457" data-ratio="0.4807502467917078" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktlWoKGrViac3hZddlJw5ibCLQAicicdDam3S3W5NfQVsr8kVoK9b5e4f0sCE3GouXcZVV5YYEqxbQjtg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1013" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktlWoKGrViac3hZddlJw5ibCLQAicicdDam3S3W5NfQVsr8kVoK9b5e4f0sCE3GouXcZVV5YYEqxbQjtg/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><ul><li><p><strong><span>另外：如果你对</span></strong><strong><span><span><em>单细胞数据读取</em></span></span></strong><strong><span>比较感兴趣，可以看我以前的贴</span></strong><span><strong><span>子</span></strong></span></p></li></ul><p><span><span><br></span></span></p><ul><li><section><span>1 </span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247484537&amp;idx=2&amp;sn=edec540d48d99a1697d622a9c8cdad82&amp;chksm=ce646a90f913e38660a2ae4090edbbcb0ed4b2eee12ad462c0a7cc96322d7547d9c68b6a9a18&amp;scene=21#wechat_redirect" textvalue="Seurat读取不同数据格式以创建Seurat单细胞对象" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>Seurat读取不同数据格式以创建Seurat单细胞对象</span></a></section><section><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247483911&amp;idx=1&amp;sn=6e65a8a473c2f83fff2ceb2d6669c88c&amp;chksm=ce646ceef913e5f869755571011f39ec44b4e8d442f2b22d68e68539ac671c23a65a0369d214&amp;scene=21#wechat_redirect" textvalue="GSE158055 covid19 肺组织60W单细胞细胞实战  wget -nd参数" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>2 GSE158055 covid19 肺组织60W单细胞细胞实战  wget -nd参数</span><span></span></a></section></li></ul><p><br></p></section></section></section></section></section></section></section></section><h3><span>代码实战</span></h3><ol><li><section><section powered-by="xiumi.us"><section><section><p><strong><span>python中读取空间转录组的方式，scanpy较常见</span></strong></p></section></section></section></section></li><li><section><section powered-by="xiumi.us"><section><section><p><strong><span>R中读取空间转录组的方式，seurat最常见</span></strong></p><hr><strong></strong><br><p><br></p></section></section></section></section></li></ol><p><span><br></span></p><section><section powered-by="xiumi.us"><section><section><p><span>01</span></p><p><span>—</span></p></section></section></section></section><section><strong><span>python中读取空间转录组的方式，scanpy较常见</span></strong><br></section><section><br></section><ul><li><p><strong><span>1.1使用scanpy读取空转数据</span></strong><strong><span></span></strong></p></li></ul><p><strong><span>在linux系统中的文件格式如下</span></strong><br></p><p><img data-galleryid="" data-imgfileid="100001460" data-ratio="0.6635730858468677" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktlWoKGrViac3hZddlJw5ibCLYBNNb7PlUnlZueorx5TmTDwVpgNKJSuyn1CRicQ11Rtf4mBw3mgfstA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="431" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktlWoKGrViac3hZddlJw5ibCLYBNNb7PlUnlZueorx5TmTDwVpgNKJSuyn1CRicQ11Rtf4mBw3mgfstA/640?wx_fmt=png&amp;from=appmsg"></p><p><span></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>import scanpy as sc</span></code><code><span><span>#方法一</span></span></code><code><span>ns7=sc.read_visium(path=<span>"./ns7/"</span>,count_file='./2.3.h5_files/filtered_feature_bc_matrix.h5',library_id=<span>"NS_7"</span></span></code><code><span>,load_images=True,source_image_path=<span>"./ns7/spatial/"</span>)</span></code><code><span> </span></code><code><span> <span>#方法二</span></span></code><code><span>adata=sc.read_visium(path=<span>"./ns56/"</span>,count_file='filtered_feature_bc_matrix.h5',library_id=<span>"NS_56"</span>,</span></code><code><span>load_images=True,source_image_path=<span>"./ns56/spatial/"</span>)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span>#读取之后，通常走一套组合拳，qc 可视化</span></span></code><code><span>sc.pp.calculate_qc_metrics(adata, inplace=True)</span></code><code><span>adata.var['mt'] = [gene.startswith('MT-') for gene in adata.var_names]</span></code><code><span>adata.obs['mt_frac'] = adata[:, adata.var['mt']].X.sum(1).A.squeeze()/adata.obs['total_counts']</span></code><code><span><br></span></code><code><span>fig, axs = plt.subplots(1,4, figsize=(15,4))</span></code><code><span>fig.suptitle('Covariates for filtering')</span></code><code><span>sb.distplot(adata.obs['total_counts'], kde=False, ax = axs[0])</span></code><code><span>sb.distplot(adata.obs['total_counts'][adata.obs['total_counts']&lt;10000], kde=False, bins=40, ax = axs[1])</span></code><code><span>sb.distplot(adata.obs['n_genes_by_counts'], kde=False, bins=60, ax = axs[2])</span></code><code><span>sb.distplot(adata.obs['n_genes_by_counts'][adata.obs['n_genes_by_counts']&lt;4000], kde=False, bins=60, ax = axs[3])</span></code><code><span><br></span></code><code><span>sc.pp.filter_cells(adata, min_counts = 5000)</span></code><code><span>print(f'Number of cells after min count filter: {adata.n_obs}')</span></code><code><span>sc.pp.filter_cells(adata, max_counts = 35000)</span></code><code><span>print(f'Number of cells after max count filter: {adata.n_obs}')</span></code><code><span>adata = adata[adata.obs['mt_frac'] &lt; 0.2]</span></code><code><span>print(f'Number of cells after MT filter: {adata.n_obs}')</span></code><code><span>sc.pp.filter_cells(adata, min_genes = 3000)</span></code><code><span>print(f'Number of cells after gene filter: {adata.n_obs}')</span></code><code><span>sc.pp.filter_genes(adata, min_cells=10)</span></code><code><span>print(f'Number of genes after cell filter: {adata.n_vars}')</span></code><code><span><br></span></code><code><span><span>#这里最重要！！！！！！！！！</span></span></code><code><span>sc.pp.normalize_total(adata, inplace = True)</span></code><code><span>sc.pp.log1p(adata)</span></code><code><span>sc.pp.highly_variable_genes(adata, flavor='seurat', n_top_genes=2000, inplace=True)</span></code><code><span><br></span></code><code><span><br></span></code><code><span>sc.pp.pca(adata, n_comps=50, use_highly_variable=True, svd_solver='arpack')</span></code><code><span>sc.pp.neighbors(adata)</span></code><code><span><br></span></code><code><span>sc.tl.umap(adata)</span></code><code><span>sc.tl.louvain(adata, key_added='clusters')</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span>#可视化</span></span></code><code><span>sc.pl.umap(adata, color=['total_counts', 'n_genes_by_counts'])</span></code><code><span>sc.pl.umap(adata, color='clusters', palette=sc.pl.palettes.default_20)</span></code><code><span><br></span></code><code><span>sc.pl.spatial(adata, img_key = <span>"hires"</span>,color=['total_counts', 'n_genes_by_counts'])</span></code><code><span><br></span></code><code><span>sc.pl.spatial(adata, img_key = <span>"hires"</span>, color=<span>"clusters"</span>, size=1.5)</span></code><code><span><br></span></code><code><span><span>#详细内容可以参考https://scanpy-tutorials.readthedocs.io/en/multiomics/analysis-visualization-spatial.html</span></span></code></pre></section><p><img data-galleryid="" data-imgfileid="100001458" data-ratio="0.8559322033898306" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktlWoKGrViac3hZddlJw5ibCLluyqmWnpgAyDajYFKCcrA1YXnsvlotJIzcqB7OD9MDiaAKaJcJdoKSQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="708" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktlWoKGrViac3hZddlJw5ibCLluyqmWnpgAyDajYFKCcrA1YXnsvlotJIzcqB7OD9MDiaAKaJcJdoKSQ/640?wx_fmt=png&amp;from=appmsg"></p><section><section powered-by="xiumi.us"><section><section><p><img data-galleryid="" data-imgfileid="100001466" data-ratio="0.9281553398058252" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktlWoKGrViac3hZddlJw5ibCLwaRYs7y0p9XDTpQtw1zNoU8HibbKQ0wvJQ6rPF6oeCRM5spic2IaUuicA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="515" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktlWoKGrViac3hZddlJw5ibCLwaRYs7y0p9XDTpQtw1zNoU8HibbKQ0wvJQ6rPF6oeCRM5spic2IaUuicA/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><img data-galleryid="" data-imgfileid="100001464" data-ratio="1.0051020408163265" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktlWoKGrViac3hZddlJw5ibCLicJ4oNVyI1dX1fDWeyVRuXtKjx9P7E0Mw7lcuvZfC6sxBtHZNaFlA8w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="588" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktlWoKGrViac3hZddlJw5ibCLicJ4oNVyI1dX1fDWeyVRuXtKjx9P7E0Mw7lcuvZfC6sxBtHZNaFlA8w/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><ul><li><p><span></span><strong><span>1.2 stlearn读取空转数据</span></strong></p></li></ul><p><br></p><p><strong><span>https://stlearn.readthedocs.io/en/latest/tutorials/Read_any_data.html</span></strong></p><p><br></p><p><strong><span>需要三个文件： </span></strong></p><ol><li><p><strong><span>count matrix</span></strong></p></li><li><p><strong><span>spatial location</span></strong></p></li><li><p><strong><span>image path (optional)</span></strong></p></li></ol><ul><li><p><br></p></li><li><p><br></p></li><li><p><strong><span>count</span></strong><br></p></li></ul><p><img data-galleryid="" data-imgfileid="100001463" data-ratio="0.4981481481481482" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksE8p3VMfF6euakubNENYjeeYUIR3AmHhlJZ8Tu2Fu2rTNx46cMcuiaC57S7TDUNiaVoMT07RjIOWWg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksE8p3VMfF6euakubNENYjeeYUIR3AmHhlJZ8Tu2Fu2rTNx46cMcuiaC57S7TDUNiaVoMT07RjIOWWg/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>空间坐标信息</span></strong><br></p><p><img data-galleryid="" data-imgfileid="100001462" data-ratio="0.4388888888888889" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksE8p3VMfF6euakubNENYjeLPZVHvdVAeNZLehVcmWSxvw5hhia0tsvElNI3od1da0TUfIo7ribkGqw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksE8p3VMfF6euakubNENYjeLPZVHvdVAeNZLehVcmWSxvw5hhia0tsvElNI3od1da0TUfIo7ribkGqw/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>图片信息为可选<br></span></strong></p><p><strong><span>The image path is optional. If you don’t provide any image, the background will be 'black' or 'white'</span></strong></p><section><ul><li><li></ul><pre data-lang="swift"><code><span><span>import</span> stlearn as st</span></code><code><span>adata = st.create_stlearn(<span>count</span>=count_matrix,spatial=spatial,library_id=<span>"Sample_test"</span>, scale=<span>1</span>,background_color=<span>"white"</span>)</span></code></pre></section><p><br></p><p><strong><span>质控qc</span></strong><br></p><section><ul><li></ul><pre data-lang="css"><code><span><span>st</span><span>.pl</span><span>.QC_plot</span>(<span>adata</span>)</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100001465" data-ratio="1.2534246575342465" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksE8p3VMfF6euakubNENYjeeDRX3aPbicRIiccgdkDaibchkCGeLv72htuEn0RdS58QllurHJrtDb3Kg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="584" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksE8p3VMfF6euakubNENYjeeDRX3aPbicRIiccgdkDaibchkCGeLv72htuEn0RdS58QllurHJrtDb3Kg/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><strong><span>如果你还想添加metadata信息，可以添加seurat的聚类信息或者celltype<br></span></strong></p><section><br></section><section><strong><span>stLearn core object is using AnnData then you can transfer the clustering results to adata.obs. For example, you have clustering results from Seurat seurat_results (should be a numpy array), and then you can plot it with stlearn.pl.cluster_plot and use_label == "seurat"</span></strong></section><section><ul><li></ul><pre data-lang="javascript"><code><span>adata.obs[<span>"seurat"</span>] = pd.Categorical(seurat_results)</span></code></pre></section><hr><p><span></span><br></p><p><br></p><p><br></p><p><br></p><section><section powered-by="xiumi.us"><section><section><p><span>02</span></p><p><span>—</span></p></section></section></section></section><section><strong><span>R中读取空间转录组的方式，seurat最常见</span></strong></section><ul><li><p><strong><span>2.1 如果你有h5文件+ spatial 文件夹</span></strong></p></li></ul><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="cs"><code><span><span>################################NS_7</span></span></code><code><span><span>#首先读取表达矩阵数据</span></span></code><code><span><span>#这里的blank是指使用空的spot，需要去掉。如果你没有空的spot，就不需要blank</span></span></code><code><span>NS_7_exp &lt;- Read10X_h5(filename = <span>"/data/biomath/Spatial_Transcriptome/silicosis/Spatial_transcriptome/A72-NS-7d/2.3.h5_files/filtered_feature_bc_matrix.h5"</span> ) <span>#1638</span></span></code><code><span>NS_7_blank &lt;- <span>as</span>.matrix(read.csv(<span>"/data/biomath/Spatial_Transcriptome/silicosis/Spatial_transcriptome/A72-NS-7d/A72.csv"</span>,sep=<span>","</span>,header=T)) <span>#283</span></span></code><code><span>NS_7_valid=setdiff(colnames(NS_7_exp),NS_7_blank[,<span>1</span>])</span></code><code><span>NS_7_exp_valid=NS_7_exp[,NS_7_valid] <span>#1355</span></span></code><code><span>NS_7=CreateSeuratObject(counts = NS_7_exp_valid, project = <span>'NS_7'</span>, assay = <span>'Spatial'</span>,min.cells=<span>3</span>) <span>#17433*1355</span></span></code><code><span> </span></code><code><span> </span></code><code><span><span>#读取image信息</span></span></code><code><span>NS_7_img &lt;- Read10X_Image(image.dir=<span>"/data/biomath/Spatial_Transcriptome/silicosis/Spatial_transcriptome/A72-NS-7d/spatial/"</span>)</span></code><code><span>DefaultAssay(<span>object</span> = NS_7_img) &lt;- <span>'Spatial'</span></span></code><code><span>NS_7_img &lt;- NS_7_img[colnames(NS_7)]</span></code><code><span>NS_7[[<span>'image'</span>]] &lt;- NS_7_img</span></code><code><span>NS_7$stim &lt;- <span>"NS_7"</span></span></code><code><span>save(NS_7,file=<span>"NS_7.rds"</span>)</span></code><code><span><br></span></code><code><span><span>#标准化 找高变基因 scale一条龙</span></span></code><code><span><span>#通常空转数据使用sct效果比seurat标准流程更好</span></span></code><code><span>NS_7_sct=SCTransform(NS_7, verbose = FALSE,,assay =<span>"Spatial"</span>)</span></code><code><span>save(NS_7_sct,file=<span>"NS_7_sct.rds"</span>)</span></code><code><span><br></span></code></pre></section><ul><li><p><strong><span>2.2 如果你有raw/filtered_feature_bc_matrix 的三个文件 + spatial 文件夹</span></strong></p></li></ul><p><br></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="ruby"><code><span><br></span></code><code><span><span>#首先读取表达矩阵数据</span></span></code><code><span>NS2 = Read10X(<span>"./outs/filtered_feature_bc_matrix/"</span>)</span></code><code><span><br></span></code><code><span><span>#读取image信息</span></span></code><code><span>image2 &lt;- Read10X_Image(image.dir = file.path(<span>"./outs/"</span>, </span></code><code><span>                                              <span>"spatial"</span>), filter.matrix = TRUE)</span></code><code><span><br></span></code><code><span><span>#这里如果你想要高清图片，可以指定的！</span></span></code><code><span>image2 = Read10X_Image(<span>"./outs/spatial/"</span>, </span></code><code><span>                    image.name = <span>"tissue_hires_image.png"</span>)</span></code><code><span><br></span></code><code><span><span>#创建seurat对象</span></span></code><code><span>NS2 &lt;- CreateSeuratObject(counts = NS2, assay = <span>"Spatial"</span>)</span></code><code><span><br></span></code><code><span><br></span></code><code><span>DefaultAssay(NS2 = image2) &lt;- <span>"Spatial"</span></span></code><code><span><span>#标准化 找高变基因 scale一条龙</span></span></code><code><span><span>#通常空转数据使用sct效果比seurat标准流程更好</span></span></code><code><span>NS2_sct=SCTransform(NS2, verbose = FALSE,,assay =<span>"Spatial"</span>)</span></code><code><span>save(NS_7_sct,file=<span>"NS2_sct.rds"</span>)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span>#如果多样本分析的时候记得改名字。</span></span></code><code><span>image2 &lt;- image2[Cells(x = NS2)]</span></code><code><span>NS2[[<span>"slice1"</span>]] &lt;- image2</span></code><code><span><span>#没有报错，无需转化.通常不会报错的</span></span></code><code><span><span>for</span> (i <span>in</span> colnames((NS2@images$slice1@coordinates))) {</span></code><code><span> NS2@images$slice1@coordinates[[i]] &lt;- as.integer(NS2@images$slice1@coordinates[[i]])</span></code><code><span>}</span></code><code><span><br></span></code><code><span><br></span></code></pre></section><p><br></p><ul><li><p><span></span><strong><span>2.3 一句话读取空转数据，这个通常是自己的空转数据可以这么读取。这是10x官网的数据</span></strong></p></li></ul><section><ul><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>test_data = Load10X_Spatial(data.dir = <span>"./input/"</span>,</span></code><code><span>                           filename = <span>"Visium_FFPE_Human_Normal_Prostate_filtered_feature_bc_matrix.h5"</span>,</span></code><code><span>                           assay = <span>"Spatial"</span>, </span></code><code><span>                           slice = <span>"test"</span>)</span></code><code><span>                           </span></code></pre></section><p><br></p><ul><li><p><strong><span>2.4 有的优秀作者会提供rds文件，这里主要注意版本问题，有时候用readRDS函数读取，有时候用load函数加载</span></strong></p></li></ul><p><span></span><span></span></p><section><ul><li><li></ul><pre data-lang="javascript"><code><span>pbmc=readRDS(<span>"./pbmc.rds"</span>)</span></code><code><span><br></span></code></pre></section><section><ul><li><li></ul><pre data-lang="javascript"><code><span><br></span></code><code><span>load(<span>"./pbmc.rds"</span>)</span></code></pre></section><p><br></p><p><br></p><ul><li><p><strong><span>2.5 非常规读取空转数据：有些奇葩作者不上传HE图片的，只给坐标信息</span></strong></p><p><br></p></li></ul><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span><span># 把空间数据当成单细胞数据读入</span></span></code><code><span><span>#1 读取表达矩阵</span></span></code><code><span>test_data2 = Read10X(<span>"./input/filtered_feature_bc_matrix/"</span>)</span></code><code><span>test_data2 &lt;- CreateSeuratObject(counts = test_data2, </span></code><code><span>                                min.features = 0, </span></code><code><span>                                project = <span>"test"</span>)</span></code><code><span><br></span></code><code><span><span># 2读入单细胞的位置信息</span></span></code><code><span>position = read.csv(<span>"./No_IHC/position_information.csv"</span>,header = T,row.names = 1)</span></code><code><span>head(position)</span></code><code><span>position = select(position,imagecol,imagerow)</span></code><code><span><br></span></code><code><span><span>#将位置信息合并入单细胞seurat对象</span></span></code><code><span>colnames(position) = paste0(<span>"Spatial_"</span>,1:ncol(position))</span></code><code><span>test_data2[[<span>"spatial"</span>]] &lt;- CreateDimReducObject(embeddings = as.matrix(position), </span></code><code><span>                                                    key = <span>"Spatial"</span>,assay = <span>"RNA"</span>)</span></code><code><span>                                                    </span></code></pre></section><p><br></p><p><br></p><ul><li><h6 name="3.2-%E7%BC%BA%E5%B0%91IHC%E5%9B%BE%E5%83%8F%E4%B9%9F%E5%8F%AF%E9%87%87%E7%94%A8Slide-seq%E7%9A%84%E6%96%B9%E6%B3%95"><strong><span>2.6 非常规读取空转数据：有些奇葩作者不上传HE图片的，只给坐标信息，可采用Slide-seq的方法</span></strong></h6></li></ul><pre tabindex="0"><code>test_data2 <span>=</span> <span>Read10X</span><span>(</span><span>"./input/filtered_feature_bc_matrix/"</span><span>)</span><br>test_data2 <span>&lt;</span><span>-</span> <span>CreateSeuratObject</span><span>(</span>counts <span>=</span> test_data2<span>,</span><br>                                min<span>.</span>features <span>=</span> <span>0</span><span>,</span><br>                                project <span>=</span> <span>"test"</span><span>,</span> <br>                                assay<span>=</span><span>"Spatial"</span><span>)</span><br>test_data2<br># An object <span>of</span> <span>class</span> <span>Seurat</span> <br># <span>17943</span> features across <span>2543</span> samples within <span>1</span> assay <br># Active assay<span>:</span> <span>RNA</span> <span>(</span><span>17943</span> features<span>,</span> <span>0</span> variable features<span>)</span><br><br>coord<span>.</span>df <span>=</span> read<span>.</span><span>csv</span><span>(</span><span>"./position_information.csv"</span><span>,</span>header <span>=</span> <span>T</span><span>,</span>row<span>.</span>names <span>=</span> <span>1</span><span>)</span><br>test_data2@images$image <span>=</span>  <span>new</span><span>(</span><br>  Class <span>=</span> <span>'SlideSeq'</span><span>,</span><br>  assay <span>=</span> <span>"Spatial"</span><span>,</span><br>  key <span>=</span> <span>"image_"</span><span>,</span><br>  coordinates <span>=</span> coord<span>.</span>df<br><span>)</span><strong><span></span></strong></code></pre><h3><span>后记</span></h3><p><strong><span>本文技术不难，更多的是一种思想方法，帮助大家去开拓自己的思路。只要你理解了空间数据的数据存储形式，便可一招鲜吃遍天~</span></strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg2NDcxMzYwNg==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sks7JhVxUX46ZKxPSob6ptqIZgnIEnHOn5VMwCX8sN6MQy1Pq4XXFEOJ6grAmsoQugyCDKOZictDBHA/0?wx_fmt=png" data-nickname="生信小博士" data-alias="bioinformatics_Dr" data-signature="【生物信息学】R语言，学习生信，seurat，单细胞测序，空间转录组。 Python，scanpy，cell2location，资料分享" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p><strong><span><br></span></strong></p><p><img data-imgfileid="100001468" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" data-type="gif" data-w="240" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"><br></p><p><img data-imgfileid="100001467" data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="other" data-w="341" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p><p><br></p><p><span></span></p></section></section></section></section><p><br></p><p><br></p><p><br></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/cCPc0TtEgOe-urFnwyffzg",target="_blank" rel="noopener noreferrer">原文链接</a>
