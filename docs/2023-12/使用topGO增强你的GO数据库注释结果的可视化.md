---
title: "使用topGO增强你的GO数据库注释结果的可视化"
date: 2023-12-11T03:20:20Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
使用topGO增强你的GO数据库注释结果的可视化 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>前些天我在 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526714&amp;idx=1&amp;sn=aba39bc658288a9f607b13bfdf0a0346&amp;scene=21#wechat_redirect" data-linktype="2">生物学功能注释三板斧</a>，提到了简单的超几何分布检验，复杂一点可以是gsea和gsva，更复杂一点的可以是DoRothEA和PROGENy类似的打分。</p></blockquote><p data-tool="mdnice编辑器">其中 GO（Gene Ontology）和KEGG（Kyoto Encyclopedia of Genes and Genomes）数据库是两个常用的生物学功能注释数据库，科学家通常是使用来<strong>超几何分布</strong>检验这个统计学算法做富集分析，即通过比较实际观察到的基因集合（几十个或者几百个）中特定功能或通路的基因数量与随机期望的数量来判断其是否富集。</p><p data-tool="mdnice编辑器">但是GO数据库 注释通常包括三个方面的信息：分子功能（Molecular Function）、细胞组分（Cellular Component）和生物过程（Biological Process）。而且它有一个特点是有向无环图（DAG），用一个简单的比喻来理解：</p><ol data-tool="mdnice编辑器"><li><section><strong>树状结构：</strong> 想象一棵大树，树干是GO的根节点，而树枝和叶子是各种不同的基因功能术语。</section></li><li><section><strong>节点和边：</strong> 在这个家谱树上，每一个节点代表一个特定的基因功能术语，例如“细胞分裂”、“代谢过程”等。而边（连接节点的线）表示这些术语之间的关系。</section></li><li><section><strong>层次关系：</strong> 树的不同层次代表了基因功能的层次关系。树干是一些更通用、更广泛的术语，而分支和叶子是更具体和详细的术语。</section></li><li><section><strong>无环：</strong> DAG是有向无环图，这意味着在图中你不会发现任何形成循环的路径。从根节点到任何一个节点都是沿着一个单一的方向，没有回头。</section></li></ol><h3 data-tool="mdnice编辑器"><span></span>普通的GO数据库注释<span></span></h3><h4 data-tool="mdnice编辑器"><span></span>简单的转录组差异分析<span></span></h4><p data-tool="mdnice编辑器">首先我们获取airway这个包里面的airway表达量矩阵，它有8个样品，分成了两组，我们命名为'control','case' ，如下所示代码：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(data.table)<br><span>library</span>(airway,quietly = <span>T</span>)<br>data(airway) <br>mat &lt;- assay(airway)  <br>keep_feature &lt;- rowSums (mat &gt; <span>1</span>) &gt; <span>1</span> <br>ensembl_matrix &lt;- mat[keep_feature, ]  <br><span>library</span>(AnnoProbe) <br>ids=annoGene(rownames(ensembl_matrix),<span>'ENSEMBL'</span>,<span>'human'</span>) <br>ids=ids[!duplicated(ids$SYMBOL),]<br>ids=ids[!duplicated(ids$ENSEMBL),]<br>symbol_matrix= ensembl_matrix[match(ids$ENSEMBL,rownames(ensembl_matrix)),] <br>rownames(symbol_matrix) = ids$SYMBOL <br>group_list = as.character(airway@colData$dex);group_list<br>group_list=ifelse(group_list==<span>'untrt'</span>,<span>'control'</span>,<span>'case'</span> ) <br>group_list = factor(group_list,levels = c(<span>'control'</span>,<span>'case'</span> ))  <br></code></pre><p data-tool="mdnice编辑器">然后针对上面的airway这个包里面的airway表达量矩阵，是一个简单的转录组测序后的count矩阵，可以走DESeq2进行转录组差异分析，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>(colData &lt;- data.frame(row.names=colnames(symbol_matrix), <br>                       group_list=group_list) )<br>dds &lt;- DESeqDataSetFromMatrix(countData = symbol_matrix,<br>                              colData = colData,<br>                              design = ~ group_list)<br>dds &lt;- DESeq(dds) <br>res &lt;- results(dds, <br>               contrast=c(<span>"group_list"</span>,<br>                          levels(group_list)[<span>2</span>],<br>                          levels(group_list)[<span>1</span>]))<br>resOrdered &lt;- res[order(res$padj),] <br>DEG =as.data.frame(resOrdered)<br>DEG_deseq2 = na.omit(DEG)<br></code></pre><p data-tool="mdnice编辑器">差异分析的结果矩阵比较简单：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; head(DEG_deseq2)  <br>          baseMean log2FoldChange      lfcSE     <span>stat</span>        pvalue          padj<br>SPARCL1   997.2841       4.601648 0.21173761 21.73278 1.005191e-104 1.751345e-100<br>STOM    11193.6206       1.450654 0.08458760 17.14973  6.314974e-66  5.501289e-62<br>PER1      776.4988       3.183045 0.20133158 15.80996  2.656240e-56  1.542656e-52<br>PHC2     2738.0273       1.386358 0.09161873 15.13182  9.988847e-52  4.350892e-48<br>MT2A     3656.0130       2.202678 0.14718400 14.96547  1.234488e-50  4.301697e-47<br>DUSP1    3408.8006       2.948154 0.20174509 14.61326  2.311720e-48  6.712850e-45<br></code></pre><p data-tool="mdnice编辑器">上面的这些列的简要介绍是：</p><ol data-tool="mdnice编辑器"><li><section><strong>baseMean：</strong></section></li></ol><ul><li><section>表达水平的均值，表示基因在不同条件或组合中的平均表达水平。</section></li></ul><li><section><strong>log2FoldChange：</strong></section></li><ul><li><section>表达差异的对数倍数变化，表示基因在两个条件或组合之间的表达变化倍数的对数。</section></li></ul><li><section><strong>lfcSE：</strong></section></li><ul><li><section>对数倍数变化的标准差，用于衡量差异的稳定性。</section></li></ul><li><section><strong>stat：</strong></section></li><ul><li><section>统计检验的值，通常是log2FoldChange除以lfcSE，用于判断基因表达的变化是否显著。</section></li></ul><li><section><strong>pvalue：</strong></section></li><ul><li><section>统计检验的p值，表示在零假设下观察到的差异或效应发生的概率。</section></li></ul><li><section><strong>padj：</strong></section></li><ul><li><section>经过多重检验校正后的p值，用于控制多重检验的误差，提高差异的可靠性。</section></li></ul><h4 data-tool="mdnice编辑器"><span></span>然后使用最流行的clusterProfiler进行GO数据库的注释<span></span></h4><p data-tool="mdnice编辑器">前面提到了，GO数据库 注释通常包括三个方面的信息：分子功能（Molecular Function）、细胞组分（Cellular Component）和生物过程（Biological Process）。我们这里先拿生物过程（Biological Process）举例子吧.</p><p data-tool="mdnice编辑器">前面的DESeq2进行转录组差异分析后的表格里面有两万多个基因，但是我们根据里面的log2FoldChange对基因排序后取 log2FoldChange 最大的1000个基因来使用<strong>超几何分布</strong>检验这个统计学算法做富集分析，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>DEG_deseq2=DEG_deseq2[order(DEG_deseq2$log2FoldChange),] <br>up_top_genes = AnnotationDbi::select(org.Hs.eg.db,keys=tail(rownames(DEG_deseq2),<span>1000</span>) ,<br>                      columns=<span>"ENTREZID"</span>,keytype = <span>"SYMBOL"</span>)[,<span>2</span>]<br><span>library</span>(clusterProfiler)<br><span>library</span>(org.Hs.eg.db)<br>go_BP_hyper &lt;- enrichGO(<br>  gene          = up_top_genes,<br>  keyType = <span>"ENTREZID"</span>,<br>  OrgDb         = org.Hs.eg.db,<br>  ont           = <span>"BP"</span>,<br>  pAdjustMethod = <span>"BH"</span>,<br>  pvalueCutoff  = <span>0.01</span>,<br>  qvalueCutoff  = <span>0.05</span>,<br>  readable      = <span>TRUE</span>)<br>head(go_BP_hyper@result)<br></code></pre><p data-tool="mdnice编辑器">可以看到这个结果表格非常的丰富：</p><p><img data-galleryid="" data-ratio="0.5138888888888888" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwRY7ZXSDScicuPsibMqcD2vGPQPKv2tBEezibqmkKs7MAf8809ISMG6WY59qZU2JsEqdIDSLpdnap4Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwRY7ZXSDScicuPsibMqcD2vGPQPKv2tBEezibqmkKs7MAf8809ISMG6WY59qZU2JsEqdIDSLpdnap4Q/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>GO数据库的注释</figcaption></figure><p data-tool="mdnice编辑器">在使用<code>clusterProfiler</code>进行GO（Gene Ontology）数据库的富集分析时，得到的结果表格通常包含以下列：</p><ol data-tool="mdnice编辑器"><li><section><strong>ID:</strong></section></li></ol><ul><li><section><strong>介绍：</strong> GO Term的唯一标识符，用于标识富集的功能术语。</section></li></ul><li><section><strong>Description:</strong></section></li><ul><li><section><strong>介绍：</strong> GO Term的文本描述，说明富集功能的意义。</section></li></ul><li><section><strong>GeneRatio:</strong></section></li><ul><li><section><strong>介绍：</strong> 在用户提供的基因集中与某GO Term相关的基因占比。</section></li></ul><li><section><strong>BgRatio:</strong></section></li><ul><li><section><strong>介绍：</strong> 在整个背景基因集中与某GO Term相关的基因占比。</section></li></ul><li><section><strong>pvalue:</strong></section></li><ul><li><section><strong>介绍：</strong> 富集分析的p值，表示GO Term富集的显著性。</section></li></ul><li><section><strong>p.adjust (或FDR):</strong></section></li><ul><li><section><strong>介绍：</strong> 校正后的p值，用于控制多重检验误差。</section></li></ul><li><section><strong>qvalue:</strong></section></li><ul><li><section><strong>介绍：</strong> 与p.adjust相似，也是校正后的p值。</section></li></ul><li><section><strong>geneID:</strong></section></li><ul><li><section><strong>介绍：</strong> 在GO Term下具有显著富集的基因的标识符，如果前面有  readable      = TRUE的参数，那么这个时候就是基因的symbol，如果没有那就是ENTREZID</section></li></ul><li><section><strong>Count:</strong></section></li><ul><li><section><strong>介绍：</strong> 在用户提供的基因集中与GO Term相关的基因数量。</section></li></ul><p data-tool="mdnice编辑器">那么我们通常是会如何可视化这个最流行的clusterProfiler进行GO数据库的注释：</p><pre data-tool="mdnice编辑器"><span></span><code>barplot(go_BP_hyper)<br></code></pre><p data-tool="mdnice编辑器">平平无奇的条形图，可以看到最显著的一些通路的名字以及其对应的富集信息：</p><p><img data-galleryid="" data-ratio="0.5166666666666667" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwRY7ZXSDScicuPsibMqcD2vGDVxNv5xlAG3qc4WLQZjjfffFwJRyhfjJ9OULQBdNeEatIuw8J3NZ2g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwRY7ZXSDScicuPsibMqcD2vGDVxNv5xlAG3qc4WLQZjjfffFwJRyhfjJ9OULQBdNeEatIuw8J3NZ2g/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>最显著的一些通路</figcaption></figure><p data-tool="mdnice编辑器">很明显的可以看到上面的通路是有层级关系的，就是前面提到的有向无环图（DAG），而topGO的高级可视化就是帮助我们展示这个有向无环图（DAG）的。</p><h3 data-tool="mdnice编辑器"><span></span>topGO的高级可视化<span></span></h3><p data-tool="mdnice编辑器">代码确实是非常简单啦，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(topGO)<br>goplot(go_BP_hyper,showCategory = <span>8</span>) <br></code></pre><p data-tool="mdnice编辑器">可以看到的是好几个通路的关系 ：</p><p><img data-galleryid="" data-ratio="0.6027777777777777" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwRY7ZXSDScicuPsibMqcD2vGMwj2ggW3FAQQI5h6K3aBQtzNtnRCcDXwOZVWEKulboEa0Mup5TVomA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwRY7ZXSDScicuPsibMqcD2vGMwj2ggW3FAQQI5h6K3aBQtzNtnRCcDXwOZVWEKulboEa0Mup5TVomA/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>好几个通路的关系</figcaption></figure><p data-tool="mdnice编辑器">当然了，<code>topGO</code> 是一个用于生物学的Gene Ontology（GO）富集分析的R包，不仅仅是可以展示上面提到的有向无环图（DAG），它还具有以下可视化方面的优点：</p><ol data-tool="mdnice编辑器"><li><section><strong>图形化展示：</strong></section></li></ol><ul><li><section><code>topGO</code> 提供了直观的图形化展示，例如饼图、条形图等，有助于用户更清晰地理解富集结果。</section></li></ul><li><section><strong>GO Term网络图：</strong></section></li><ul><li><section>可以生成GO Term之间的关系网络图，帮助用户理解GO Term的层次结构和相互关系。</section></li></ul><li><section><strong>直观的树状图：</strong></section></li><ul><li><section><code>topGO</code> 可以生成GO Term的树状图，以树状结构直观地展示GO Term之间的层次关系。</section></li></ul><li><section><strong>用户定制化：</strong></section></li><ul><li><section>允许用户对生成的图形进行定制，包括颜色、标签等，以满足用户个性化的可视化需求。</section></li></ul><li><section><strong>交互式可视化：</strong></section></li><ul><li><section>提供了交互式的可视化功能，用户可以通过交互式控件进行放大、缩小、导出等操作，增强用户体验。</section></li></ul><li><section><strong>基因与GO Term的关联图：</strong></section></li><ul><li><section>可以绘制基因与GO Term之间的关系图，帮助用户了解哪些基因与哪些功能术语关联紧密。</section></li></ul><li><section><strong>支持多种可视化输出：</strong></section></li><ul><li><section><code>topGO</code> 支持生成多种格式的图形输出，如PDF、PNG等，方便用户在出版物或报告中使用。</section></li></ul><li><section><strong>丰富的图例和注释：</strong></section></li><ul><li><section>生成的图形中包含丰富的图例和注释，使用户更容易理解和解释富集分析的结果。</section></li></ul><p data-tool="mdnice编辑器">这些可视化优点使得 <code>topGO</code> 成为生物学研究中进行GO富集分析时一个强大的工具，通过直观的图形展示，帮助研究人员更好地理解基因集与功能术语之间的关系。更多技巧当然是推荐看它的官网啦：</p><ul data-tool="mdnice编辑器"><li><section>https://bioconductor.org/packages/release/bioc/html/topGO.html</section></li></ul><p data-tool="mdnice编辑器">另外，其实上面的富集分析结果是可以精简的， 因为生物过程（Biological Process）有很多冗余，如下所示的代码：</p><pre data-tool="mdnice编辑器"><span></span><code>go_BP_simp &lt;- simplify(<br>  go_BP_hyper, <br>  cutoff=<span>0.5</span>, <br>  by=<span>"p.adjust"</span>, <br>  select_fun=min<br>) <br>head(go_BP_simp@result)<br>dim(go_BP_simp@result)<br>barplot(go_BP_simp) <br>goplot(go_BP_simp,showCategory = <span>8</span>) <br></code></pre><p data-tool="mdnice编辑器">另外，类似的增强GO数据库注释结果的可视化的包也非常多， 比如GOplot，可以把结果画出八卦图的样子，同样的也是推荐看官方文档代码啦：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggplot2)<br><span>library</span>(GOplot)<br>data(EC)<br>head(EC$david)<br>head(EC$genelist)<br><br>circ &lt;- circle_dat(EC$david, EC$genelist)<br>GOBar(subset(circ, category == <span>'BP'</span>))<br>GOBar(circ, display = <span>'multiple'</span>)<br><br><span># 加标题上色</span><br>GOBar(circ, display = <span>'multiple'</span>, title = <span>'Z-score coloured barplot'</span>, <br>      zsc.col = c(<span>'yellow'</span>, <span>'black'</span>, <span>'cyan'</span>))<br><span># 分区</span><br>GOBubble(circ, labels = <span>3</span>)<br><span># 加标题, 改变环的颜色, f分区， </span><br>GOBubble(circ, title = <span>'Bubble plot'</span>, colour = c(<span>'orange'</span>, <span>'darkred'</span>, <span>'gold'</span>), display = <span>'multiple'</span>, labels = <span>3</span>)  <br><span># Colour the background according to the category</span><br>GOBubble(circ, title = <span>'Bubble plot with background colour'</span>, display = <span>'multiple'</span>, bg.col = <span>T</span>, labels = <span>3</span>)  <br><span># Reduce redundant terms with a gene overlap &gt;= 0.75...</span><br>reduced_circ &lt;- reduce_overlap(circ, overlap = <span>0.75</span>)<br><span># ...and plot it</span><br>GOBubble(reduced_circ, labels = <span>2.8</span>)<br><span>#Generate a circular visualization of the results of gene- annotation enrichment analysis</span><br>GOCircle(circ)<br><br><span># Generate a circular visualization of selected terms</span><br>IDs &lt;- c(<span>'GO:0007507'</span>, <span>'GO:0001568'</span>, <span>'GO:0001944'</span>, <span>'GO:0048729'</span>, <span>'GO:0048514'</span>, <span>'GO:0005886'</span>, <span>'GO:0008092'</span>, <span>'GO:0008047'</span>)<br>GOCircle(circ, nsub = IDs)<br><span># Generate a circular visualization for 10 terms</span><br>GOCircle(circ, nsub = <span>10</span>)<br><br></code></pre><p data-tool="mdnice编辑器">如下所示的效果：</p><p><img data-galleryid="" data-ratio="0.4305555555555556" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwRY7ZXSDScicuPsibMqcD2vGZdgJP1DYicxXplqMstVKoVqSjdywPEpoU9Ne3pNS93rCTyphHB6sBzA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwRY7ZXSDScicuPsibMqcD2vGZdgJP1DYicxXplqMstVKoVqSjdywPEpoU9Ne3pNS93rCTyphHB6sBzA/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">上面的是超几何分布检验的结果的可视化的丰富，其实如果是gsea也有对应的包，后面我们会介绍使用aPEAR来增强clusterProfiler的GSEA分析结果。</p></section><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526646&amp;idx=1&amp;sn=d1728d9102f72d2ce5c425162549499d&amp;chksm=9b4b284dac3ca15b83972f3dcb45977fc78eb65b607e7961658f8586f8a4b7be2c2c43883684&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授‍课（买一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247522831&amp;idx=2&amp;sn=1744efdf428465425a145ff3a982198b&amp;chksm=9b4bdab4ac3c53a28fbecbbff4f254f470b54a7a20468bb753b295b930315e1ec45bcbabc10b&amp;scene=21#wechat_redirect" textvalue="144线程640Gb内存服务器共享一年‍仍然是仅需800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">144线程640Gb内存服务器共享一年仍然是仅需800</a></section></li></ul><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/j2UTrBrFzKn6eYe_X6-3_A",target="_blank" rel="noopener noreferrer">原文链接</a>
