---
title: "如何让Seurat_v4和Seurat_v5在R中共存及Seurat_v4转换为Seurat_v5对象"
date: 2023-12-28T05:34:49Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
如何让Seurat_v4和Seurat_v5在R中共存及Seurat_v4转换为Seurat_v5对象 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>因为群里有不少的小伙伴经常会提到更新V5以后遇到的小问题。我们本来是不打算修改代码，推荐大家继续使用V4的，但是发现Seurat_v5与Seurat_v4对象差别和数据处理步骤差别并不大，就打算更新一下<span>Seurat_v5版本的代码</span>。基于我之前已经用V4写过60多篇笔记推文了，也方便大家以后可以继续使用这个代码，所以在此介绍如何安装V5和如何将Seurat_v4对象转换为Seurat_v5对象。</p></blockquote><p data-tool="mdnice编辑器">而且最近生信技能树也发了几篇推文来针对更新到Seurat_v5的bug的解决办法，并且曾老师在生信技能树视频号开直播比较详细的介绍了这一情况。</p><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247518295&amp;idx=1&amp;sn=f97bd58d2c21122ba5c7d250f7fa709e&amp;scene=21#wechat_redirect" data-linktype="2">初试Seurat的V5版本</a></p><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247518314&amp;idx=1&amp;sn=b53feba8104cfb9a377518852e871c66&amp;scene=21#wechat_redirect" data-linktype="2">使用Seurat的v5来读取多个10x的单细胞转录组矩阵</a></p><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247527174&amp;idx=1&amp;sn=a062d9fc438756b4953fb0d71bfaee51&amp;scene=21#wechat_redirect" data-linktype="2">使用Seurat的v5来读取多个不是10x标准文件的单细胞项目</a></p><h4 data-tool="mdnice编辑器"><span></span>首先是安装 Seurat_v5包<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>#查看R包的路径</span><br>.libPaths()<br><span>###新建路径，存放seurat_v5</span><br>getwd()<br>dir.create(<span>"~/seurat_v5"</span>)<br><span>#https://satijalab.org/seurat/articles/install_v5.html</span><br><span>####在seurat_v5文件夹下安装v5###</span><br>.libPaths(c(<br>  <span>'/home/data/t140333/seurat_v5/'</span>, <br>  <span>"/home/data/t140333/R/x86_64-pc-linux-gnu-library/4.3"</span>,<br>  <span>"/usr/local/lib/R/library"</span> <br>))<br><span>###安装Seurat_V5###</span><br>install.packages(<span>'Seurat'</span>)<br><span>library</span>(Seurat)<br><br><span>##安装依赖包，这几个依赖包比较费时间，不过安装整体还是比较顺利的，没有遇到报错。</span><br>setRepositories(ind = <span>1</span>:<span>3</span>, addURLs = c(<span>'https://satijalab.r-universe.dev'</span>, <span>'https://bnprks.r-universe.dev/'</span>))<br>install.packages(c(<span>"BPCells"</span>, <span>"presto"</span>, <span>"glmGamPoi"</span>))<br><br><span>#我这里并没有安装下面这些包，官方比较推荐。</span><br><span>#官方还建议安装这些额外的软件包，它们会增强 Seurat 的功能：</span><br><span>#Signac：分析单细胞染色质数据</span><br><span>#SeuratData：自动加载预先打包为 Seurat 对象的数据集</span><br><span>#Azimuth：跨多个器官和组织的scRNA-seq和scATAC-seq查询的本地注释</span><br><span>#SeuratWrappers：支持使用额外的整合和差异表达方法</span><br><span>#install.packages('Signac')</span><br><span>#remotes::install_github("satijalab/seurat-data", quiet = TRUE)</span><br><span>#remotes::install_github("satijalab/azimuth", quiet = TRUE)</span><br><span>#remotes::install_github("satijalab/seurat-wrappers", quiet = TRUE)</span><br><br><span>#如果用户遇到任何与 Matrix 软件包相关的错误，请使用下面的命令重新安装 TFBSTools 软件包，并打开一个新的 R 会话：</span><br><span># BiocManager::install("TFBSTools", type = "source", force = TRUE)</span><br><br><span>###如何使用安装好的v5？###</span><br><span>#使用的时候加载下v5路径就好啦</span><br>.libPaths(c(<br>  <span>'/home/data/t140333/seurat_v5/'</span>, <br>  <span>"/home/data/t140333/R/x86_64-pc-linux-gnu-library/4.3"</span>,<br>  <span>"/usr/local/lib/R/library"</span> <br>))<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>如何将Seurat_v4对象转换为Seurat_v5对象<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>#确认一下所用的Seurat包版本</span><br>packageVersion(<span>'Seurat'</span>)<br><span>#####</span><br><span>library</span>(ggplot2)<br><span>#这里是找了一个之前的复现过的数据，将seuratv4对象转为v5对象。</span><br>sce=readRDS(<span>"./sce.all_int.rds"</span>)<br>sce_v4=sce<br></code></pre><p data-tool="mdnice编辑器">具体怎么转换可以看官方文档。</p><p data-tool="mdnice编辑器">https://satijalab.org/seurat/articles/seurat5_essential_commands</p><pre data-tool="mdnice编辑器"><span></span><code>sce[[<span>"RNA5"</span>]] &lt;- as(object = sce[[<span>"RNA"</span>]], Class = <span>"Assay5"</span>)<br>names(sce)<br>DefaultAssay(sce)=<span>'RNA5'</span><br><span>#不想要原来的RNA也可以删除，如果不删除的话，你会看到sce对象的大小是之前的一倍，分别是1.3G 和2.6G。</span><br><span>#sce[['RNA']]=NULL  </span><br><br><span>#同时检测一下数据是否和之前推文一致。</span><br>DimPlot(sce)<br>table(sce$group)<br>DimPlot(sce, reduction = <span>"umap"</span>,<br>      group.by = <span>"group"</span>,label = <span>F</span>)<br>ggsave(<span>'umap_by_RNA_snn_res.0.1_GFP.pdf'</span>,width=<span>6</span>,height=<span>5</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100035135" data-ratio="0.8327526132404182" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibmuv7yko6ibW8uxcaQxcVFE2XL1j6CpaOdQImyWRbvIJtibl89WvfVrQCWyuHqCCoqEmuyN5qTrQ7g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="861" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibmuv7yko6ibW8uxcaQxcVFE2XL1j6CpaOdQImyWRbvIJtibl89WvfVrQCWyuHqCCoqEmuyN5qTrQ7g/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>这是之前的复现推文，https://mp.weixin.qq.com/s/nsN5IBEtwhZ-xRK1xKGIYQ，对比看来没问题，说明转换对象这步没问题，大家如果用的V5版本，也可以直接用我之前的数据再继续进行细胞亚群命名。</strong></p><p data-tool="mdnice编辑器"><strong>我后续也会用V5版本继续进行单细胞转录组复现。大家比较着急的话推荐先去看曾老师的生信技能树视频号讲解</strong>。</p><p data-tool="mdnice编辑器"><strong>同时曾老师又建了一个SeuratV5的群，感兴趣的可以加入。</strong></p><img data-imgfileid="100035136" data-ratio="1.2592592592592593" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibmuv7yko6ibW8uxcaQxcVFEpeu3VO6MF42raSPC9rmghRhQ42ktGcdcFwBL5ic6wspzeRSzbT5JF6A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="702" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibmuv7yko6ibW8uxcaQxcVFEpeu3VO6MF42raSPC9rmghRhQ42ktGcdcFwBL5ic6wspzeRSzbT5JF6A/640?wx_fmt=png&amp;from=appmsg"><h3 data-tool="mdnice编辑器"><span></span><span></span><span>微信交流群</span><span></span></h3><p data-tool="mdnice编辑器">如果你也想参与到群里的讨论中，给我提出一些推文更新建议的话欢迎入群。同时你也可以得到我前期更新的所有数据及代码，在群里我会把代码分享给大家，而且大家可以在群里「提出自己感兴趣的单细胞文献」<strong>我们尽可能优先选择大家的数据集去复现和实战，也欢迎大家在群里分享更多其它资料，咱们一起进步，</strong>比较高级的单细胞分析 我们也会一起尝试，相信你肯定是会不虚此行哈。</p><p data-tool="mdnice编辑器">附上之前推文的链接 <a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247512238&amp;idx=1&amp;sn=e0c6dc2ea0e089aabb78133e50fb5d7f&amp;scene=21#wechat_redirect" data-linktype="2">为爱发电不可取（单细胞周更需要你的支持）</a></p><p data-tool="mdnice编辑器"><strong>「目前群里已有400多人，所以你想要进群的话就需要添加我的微信，私聊给我发99元的红包，我把你拉进群里。」</strong></p><p data-tool="mdnice编辑器">我们这个群是真正的付费交流群，提供数据，代码，学习资料。如果介意99元的门槛且不认可我们知识分享的理念，<strong>请不要加我好友</strong>。因个人时间有限，不能及时回复还请见谅，再说明一下<strong>群里并没有一对一答疑服务</strong>，只是知识分享相互交流。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100035134" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibmuv7yko6ibW8uxcaQxcVFElJAd6icNia1FRSiadKN9nOC6GlHHY5xOIWJnfkkibqVCrSSxBWsiaibdTeUg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="172" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibmuv7yko6ibW8uxcaQxcVFElJAd6icNia1FRSiadKN9nOC6GlHHY5xOIWJnfkkibqVCrSSxBWsiaibdTeUg/640?wx_fmt=png&amp;from=appmsg"></figure></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/OMVZAMIyrJIEJfF63iKySw",target="_blank" rel="noopener noreferrer">原文链接</a>
