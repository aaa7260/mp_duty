---
title: "python小白入门单细胞分析scanpy"
date: 2023-12-06T05:41:47Z
draft: ["false"]
tags: [
  "fetched",
  "生信小博士"
]
categories: ["Acdemic"]
---
python小白入门单细胞分析scanpy by 生信小博士
------
<div><p><span><strong><span><strong><span>大家好，今天我们分享scanpy的标准流程 </span></strong></span></strong></span></p><p><span>基本概念介绍</span><br></p><p data-pid="FQ1q2TjC"><span><strong><span><strong><span>Scanpy 和 Seurat 基本上完全一样，Scanpy 构建的对象叫做 AnnData 对象，他的数据存储是以4 个模块存储（如下图）</span></strong></span></strong></span></p><p data-pid="FQ1q2TjC"><img data-imgfileid="100001090" data-ratio="0.7720739219712526" data-src="https://mmbiz.qpic.cn/mmbiz_png/xVhD7345SktRRGFDlbJ5YDVM84xQwoLI8Ria94bLNK5w8gA1TVoHF5XrSiaT7wATomk3JSrPPIQmohmWTD6YGJ9g/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-w="974" src="https://mmbiz.qpic.cn/mmbiz_png/xVhD7345SktRRGFDlbJ5YDVM84xQwoLI8Ria94bLNK5w8gA1TVoHF5XrSiaT7wATomk3JSrPPIQmohmWTD6YGJ9g/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><p><span><strong><span><strong><span>如果你不理解scanpy这种数据结构的话，可以对比学习一下seurat中数据结构</span></strong></span></strong></span>  <a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247484627&amp;idx=4&amp;sn=95b0fc04c59cb2fafa481e66a452e2f5&amp;chksm=ce646a3af913e32c71b02593d1d016d85eb6884af7b54a372eab79e93606d965ef7f393a10f2&amp;scene=21#wechat_redirect" textvalue="单细胞直播三seurat数据结构与数据可视化" linktype="text" imgurl="" imgdata="null" data-itemshowtype="5" tab="innerlink" data-linktype="2">单细胞直播三seurat数据结构与数据可视化</a><br></p><p data-pid="jsm7tH2z"><span><strong><span><strong><span>其中X对象为count 矩阵。这里要注意一下，它和 R 语言的不同，Scanpy 中的行为样本，列为基因。这也和 python 的使用习惯相关</span></strong></span></strong></span></p><ul><li><section><span><strong><span><strong><span>obs 存储的是 seurat 对象中的 meta.data 矩阵</span></strong></span></strong></span></section></li><li><section><span><strong><span><strong><span>X 对象为count 矩阵，与 seurat 对象是转置关系</span></strong></span></strong></span></section></li><li><section><span><strong><span><strong><span>var 存储的是基因（特征）的信息</span></strong></span></strong></span></section></li><li><section><span><strong><span><strong><span>uns 存储的是后续添加的非结构信息</span></strong></span></strong></span></section></li></ul><section><br></section><h3>官方示例代码</h3><pre><code><span>import</span> <span>scanpy</span> <span>as</span> <span>sc</span><br><span>import</span> <span>os</span><br><span>import</span> <span>math</span><br><span>import</span> <span>itertools</span><br><span>import</span> <span>warnings</span><br><span>import</span> <span>numpy</span> <span>as</span> <span>np</span><br><span>import</span> <span>pandas</span> <span>as</span> <span>pd</span><br><span>import</span> <span>matplotlib.pyplot</span> <span>as</span> <span>plt</span><br><span>%</span>matplotlib inline<br><span>%</span>config InlineBackend<span>.</span>figure_format <span>=</span> <span>'svg'</span><br>warnings<span>.</span>filterwarnings(<span>"ignore"</span>)<br>plt<span>.</span>rc(<span>'font'</span>,family<span>=</span><span>'Times New Roman'</span>)<br>my_colors <span>=</span> [<span>"#1EB2A6"</span>,<span>"#ffc4a3"</span>,<span>"#e2979c"</span>,<span>"#F67575"</span>]<br>sc<span>.</span>settings<span>.</span>verbosity <span>=</span> <span>3</span>  <span># 输出提示信息         </span><br><span># ?sc.settings.verbosity</span><br>sc<span>.</span>logging<span>.</span>print_header()<br>sc<span>.</span>settings<span>.</span>set_figure_params(dpi<span>=</span><span>80</span>, facecolor<span>=</span><span>'white'</span>)<span># 设置输出图像格式</span><br>results_file <span>=</span> <span>'write/pbmc3k.h5ad'</span>  <span># 存储分析结果</span><br>scanpy<span>==</span><span>1.6</span><span>.</span><span>0</span> anndata<span>==</span><span>0.7</span><span>.</span><span>5</span> umap<span>==</span><span>0.4</span><span>.</span><span>6</span> numpy<span>==</span><span>1.19</span><span>.</span><span>2</span> scipy<span>==</span><span>1.4</span><span>.</span><span>1</span> pandas<span>==</span><span>1.1</span><span>.</span><span>3</span> scikit<span>-</span>learn<span>==</span><span>0.23</span><span>.</span><span>2</span> statsmodels<span>==</span><span>0.12</span><span>.</span><span>0</span></code></pre><p data-pid="bKiicEKv"><span><strong><span><strong><span>这里的读取文件的方式和R语言构造seurat对象基本一样 （按照官网分类有12中读取方式）<br>下面主要介绍两种方法<br>第一种方法是，文件下面要有3个初始文件包括：</span></strong></span></strong></span></p><ol><li><p><span><strong><span><strong><span>barcord</span></strong></span></strong></span></p></li><li><p><span><strong><span><strong><span>genes</span></strong></span></strong></span></p></li><li><p><span><strong><span><strong><span>matrix<br>然后使用输 sc.read_10_mtx 读取</span></strong></span></strong></span></p></li></ol><p data-pid="rya7PgaI"><span><strong><span><strong><span>第二种方法是直接构建AnnData对象<br>然后分别的将表达矩阵，细胞信息，基因信息读取，代码如下</span></strong></span></strong></span></p><pre><code><span># 这个是第二种方法</span><br><span># creat scanpy object</span><br><span>#df = pd.read_csv('processfile/count.csv', index_col=0)</span><br><span>#meta = pd.read_csv('processfile/metadata.csv', index_col=0)</span><br><span>#cellinfo = pd.DataFrame(df.index,index=df.index,columns=['sample_index'])</span><br><span>#geneinfo = pd.DataFrame(df.columns,index=df.columns,columns=['genes_index'])</span><br><span>#sce = sc.AnnData(df, obs=cellinfo, var = geneinfo)</span><br><span># 这个是第一种读取方法</span><br>adata <span>=</span> sc<span>.</span>read_10x_mtx(<br>    <span>'./filtered_gene_bc_matrices/hg19/'</span>,  <span># the directory with the `.mtx` file</span><br>    var_names<span>=</span><span>'gene_symbols'</span>,                <span># use gene symbols for the variable names (variables-axis index)</span><br>    cache<span>=</span><span>True</span>) <br>adata<span>.</span>var_names_make_unique()<br>adata</code></pre><blockquote data-pid="dN-L8UOp"><span><strong><span><strong><span>tips: pytho和R语言有点不同，通常情况下，行为样本， 列为特征</span></strong></span></strong></span></blockquote><pre><code>adata<span>.</span>obs<span>.</span>shape <span># 2700个细胞</span><br>adata<span>.</span>var<span>.</span>shape <span># 32738个基因</span><br>adata<span>.</span>to_df()<span>.</span>shape <span># 2700*32738</span><br>adata<span>.</span>obs<span>.</span>head()<br>adata<span>.</span>var<span>.</span>head()<br>adata<span>.</span>to_df()<span>.</span>iloc[<span>0</span>:<span>5</span>,<span>0</span>:<span>5</span>]</code></pre><h3>数据预处理</h3><p data-pid="zY34d4cL"><span><strong><span><strong><span>这里介绍一下scanpy中常用的组件</span></strong></span></strong></span></p><ol><li><p><span><strong><span><strong><span>pp: 数据预处理</span></strong></span></strong></span></p></li><li><p><span><strong><span><strong><span>tl: 添加额外信息</span></strong></span></strong></span></p></li><li><p><span><strong><span><strong><span>pl：可视化</span></strong></span></strong></span></p></li></ol><h3>统计基因在细胞中的占比并可视化</h3><pre><code>sc<span>.</span>pl<span>.</span>highest_expr_genes(adata, n_top<span>=</span><span>20</span>) <span># 每一个基因在所有细胞中的平均表达量（这里计算了百分比含量）</span><br>sc<span>.</span>pp<span>.</span>filter_cells(adata, min_genes<span>=</span><span>200</span>) <span># 每一个细胞至少表达200个基因</span><br>sc<span>.</span>pp<span>.</span>filter_genes(adata, min_cells<span>=</span><span>3</span>) <span># 每一个基因至少在3个细胞中表达</span></code></pre><p><br></p><figure data-size="normal"><img data-imgfileid="100001092" data-ratio="0.9805555555555555" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiajHjIDGHBuUb3ziaZh5GzibWN8uNH20Q36nkM6iarVicM6uO1ic6JJQI2aUw/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="720" height="779" width="794" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiajHjIDGHBuUb3ziaZh5GzibWN8uNH20Q36nkM6iarVicM6uO1ic6JJQI2aUw/640?wx_fmt=other&amp;from=appmsg"></figure><p><br></p><h3>过滤线粒体DNA</h3><blockquote data-pid="epi1nk2q"><span><strong><span><strong><span>str.startswith 不支持正则，如果要使用正则则使用.str.match</span></strong></span></strong></span></blockquote><pre><code>sce<span>.</span>var_names[sce<span>.</span>var_names<span>.</span>str<span>.</span>match(r<span>'^MT-'</span>)]<br>sce<span>.</span>var_names[sce<span>.</span>var_names<span>.</span>str<span>.</span>match(r<span>'^RP[SL0-9]'</span>)]<br>sce<span>.</span>var_names[sce<span>.</span>var_names<span>.</span>str<span>.</span>match(r<span>'^ERCC-'</span>)]<br><span># 抽取带有MT的字符串</span><br>adata<span>.</span>var[<span>'mt'</span>] <span>=</span> adata<span>.</span>var_names<span>.</span>str<span>.</span>startswith(<span>'MT-'</span>) <br><span># 数据过滤</span><br>sc<span>.</span>pp<span>.</span>calculate_qc_metrics(adata, qc_vars<span>=</span>[<span>'mt'</span>], percent_top<span>=</span><span>None</span>, log1p<span>=</span><span>False</span>, inplace<span>=</span><span>True</span>)<br><span># 过滤后可视化（官方文档真的骚到我头皮发麻）</span><br>sc<span>.</span>pl<span>.</span>violin(adata, [<span>'n_genes_by_counts'</span>],jitter<span>=</span><span>0.4</span>)<br>sc<span>.</span>pl<span>.</span>violin(adata, [<span>'total_counts'</span>],jitter<span>=</span><span>0.4</span>)<br>sc<span>.</span>pl<span>.</span>violin(adata, [<span>'pct_counts_mt'</span>],jitter<span>=</span><span>0.4</span>)</code></pre><p><br></p><pre><code>sc<span>.</span>pl<span>.</span>scatter(adata, x<span>=</span><span>'total_counts'</span>, y<span>=</span><span>'pct_counts_mt'</span>)<br>sc<span>.</span>pl<span>.</span>scatter(adata, x<span>=</span><span>'total_counts'</span>, y<span>=</span><span>'n_genes_by_counts'</span>)</code></pre><p><br></p><pre><code><span># 提取线粒体dna在5%以下</span><br>adata <span>=</span> adata[adata<span>.</span>obs<span>.</span>pct_counts_mt <span>&lt;</span> <span>5</span>, :]<br><span># 提取基因不超过2500的细胞</span><br>adata <span>=</span> adata[adata<span>.</span>obs<span>.</span>n_genes_by_counts <span>&lt;</span> <span>2500</span>, :]</code></pre><p data-pid="CWSRhPNG"><br></p><p data-pid="CWSRhPNG"><strong>下面就是scanpy的标准流程：</strong></p><ol><li><p><span><strong><span><strong><span>log : NormalizeData</span></strong></span></strong></span></p></li><li><p><span><strong><span><strong><span>找特征 : FindVariableFeatures</span></strong></span></strong></span></p></li><li><p><span><strong><span><strong><span>标准化 : ScaleData</span></strong></span></strong></span></p></li><li><p><span><strong><span><strong><span>pca : RunPCA</span></strong></span></strong></span></p></li><li><p><span><strong><span><strong><span>构建图 : FindNeighbors</span></strong></span></strong></span></p></li><li><p><span><strong><span><strong><span>聚类 : FindClusters</span></strong></span></strong></span></p></li><li><p><span><strong><span><strong><span>tsne /umap : RunTSNE RunUMAP</span></strong></span></strong></span></p></li><li><p><span><strong><span><strong><span>差异基因 : FindAllMarkers / FindMarkers</span></strong></span></strong></span></p></li></ol><pre><code>sc<span>.</span>pp<span>.</span>normalize_total(adata, target_sum<span>=</span><span>1e4</span>) <span># 不要和log顺序搞反了 ，这个是去文库的</span><br>sc<span>.</span>pp<span>.</span>log1p(adata)<br>sc<span>.</span>pp<span>.</span>highly_variable_genes(adata, min_mean<span>=</span><span>0.0125</span>, max_mean<span>=</span><span>3</span>, min_disp<span>=</span><span>0.5</span>)<br><span># 可视化</span><br>sc<span>.</span>pl<span>.</span>highly_variable_genes(adata)<br><span># 保存一下原始数据</span><br>adata<span>.</span>raw <span>=</span> adata</code></pre><pre><code><span># 提取高变基因</span><br>adata <span>=</span> adata[:, adata<span>.</span>var<span>.</span>highly_variable]<br><span># 过滤掉没用的东西</span><br>sc<span>.</span>pp<span>.</span>regress_out(adata, [<span>'total_counts'</span>, <span>'pct_counts_mt'</span>])<br><span># 中心化</span><br>sc<span>.</span>pp<span>.</span>scale(adata, max_value<span>=</span><span>10</span>)<br><span># pca</span><br>sc<span>.</span>tl<span>.</span>pca(adata, svd_solver<span>=</span><span>'arpack'</span>)<br>sc<span>.</span>pl<span>.</span>pca(adata, color<span>=</span><span>'CST3'</span>)<br>sc<span>.</span>pl<span>.</span>pca_variance_ratio(adata, log<span>=</span><span>True</span>)<br><span># 输出结果</span><br>adata<span>.</span>write(results_file)</code></pre><p><br></p><pre><code><span># 构建图</span><br>sc<span>.</span>pp<span>.</span>neighbors(adata, n_neighbors<span>=</span><span>10</span>, n_pcs<span>=</span><span>40</span>)<br>sc<span>.</span>tl<span>.</span>umap(adata)<br>sc<span>.</span>pl<span>.</span>umap(adata, color<span>=</span>[<span>'CST3'</span>, <span>'NKG7'</span>, <span>'PPBP'</span>])<br>sc<span>.</span>pl<span>.</span>umap(adata, color<span>=</span>[<span>'CST3'</span>, <span>'NKG7'</span>, <span>'PPBP'</span>], use_raw<span>=</span><span>False</span>)<br><br>sc<span>.</span>tl<span>.</span>tsne(adata)<br>sc<span>.</span>pl<span>.</span>tsne(adata, color<span>=</span>[<span>'CST3'</span>, <span>'NKG7'</span>, <span>'PPBP'</span>])<br></code><p><code>sc<span>.</span>pl<span>.</span>tsne(adata, color<span>=</span>[<span>'CST3'</span>, <span>'NKG7'</span>, <span>'PPBP'</span>], use_raw<span>=</span><span>False</span>)</code></p><p><code><img data-backh="171" data-backw="377" data-croporisrc="https://mmbiz.qlogo.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiagiczVXCMOpMeAyaLI7PWnVy6tyJ978WkzlzK7C8tk1ybPNqmufBQmNA/0?wx_fmt=jpeg&amp;from=appmsg" data-cropx1="0" data-cropx2="1313" data-cropy1="0" data-cropy2="595.551724137931" data-imgfileid="100001094" data-ratio="0.4527777777777778" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiam0WI4jxrvnrbmdEicLWYsHPiagUMbVqNIwVc3d8lD7IwuKolBIicW21bA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiam0WI4jxrvnrbmdEicLWYsHPiagUMbVqNIwVc3d8lD7IwuKolBIicW21bA/640?wx_fmt=jpeg"></code></p><p><code><br></code></p><p><code><br></code></p><pre><code>sc<span>.</span>pp<span>.</span>neighbors(adata, n_neighbors<span>=</span><span>10</span>, n_pcs<span>=</span><span>40</span>)<br>sc<span>.</span>tl<span>.</span>leiden(adata)<br>sc<span>.</span>pl<span>.</span>umap(adata, color<span>=</span>[<span>'leiden'</span>, <span>'CST3'</span>, <span>'NKG7'</span>])<br>sc<span>.</span>pl<span>.</span>tsne(adata, color<span>=</span>[<span>'leiden'</span>, <span>'CST3'</span>, <span>'NKG7'</span>])<br><span># 保存结果</span><br></code><p><code>adata<span>.</span>write(results_file)</code></p><p><code><img data-backh="163" data-backw="354" data-croporisrc="https://mmbiz.qlogo.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaySdMxAwDTw0goz6B79wbWlJ9FibWtib26Uy5uAKa830BnzBd1NSAfPuQ/0?wx_fmt=other&amp;from=appmsg" data-cropx1="0" data-cropx2="484.56273764258555" data-cropy1="0" data-cropy2="223.11787072243345" data-imgfileid="100001096" data-ratio="0.4607438016528926" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaWsF8q02HyMmwibZ7Tyia0k2RuY7sxoIgPJIicqI2Kam3hMHGMxJ4hnibWw/640?wx_fmt=jpeg" data-type="jpeg" data-w="484" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaWsF8q02HyMmwibZ7Tyia0k2RuY7sxoIgPJIicqI2Kam3hMHGMxJ4hnibWw/640?wx_fmt=jpeg"></code></p></pre><p><br></p><p><code><br></code></p><p><code><br></code></p><h3>找差异基因</h3><pre><code><span># 这里使用秩和检验</span><br>sc<span>.</span>tl<span>.</span>rank_genes_groups(adata, <span>'leiden'</span>, method<span>=</span><span>'wilcoxon'</span>)<br>sc<span>.</span>pl<span>.</span>rank_genes_groups(adata, n_genes<span>=</span><span>25</span>, sharey<span>=</span><span>False</span>)<br>adata<span>.</span>write(results_file)</code></pre><p><br></p><figure data-size="normal"><img data-croporisrc="https://mmbiz.qlogo.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTia6ec1iaT0n8NNJe1eVSNJ7o3JRDXxNWqpWkfnMibwkUVibaL2Mp5Lt8vnA/0?wx_fmt=other&amp;from=appmsg" data-cropx1="34.01574803149606" data-cropx2="541.4173228346457" data-cropy1="0" data-cropy2="380.86956521739125" data-imgfileid="100001098" data-ratio="0.7514792899408284" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiax7UmgGQz8jtMWeQiaNaFvRiaViaWJtRANZeEMVwOnrCpp8xOorz5XDTpg/640?wx_fmt=jpeg" data-type="jpeg" data-w="507" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiax7UmgGQz8jtMWeQiaNaFvRiaViaWJtRANZeEMVwOnrCpp8xOorz5XDTpg/640?wx_fmt=jpeg"></figure><p><code><br></code></p><pre><code>num <span>=</span> <span>2</span> <span># 通过这个控制marker基因的数量 </span><br>marker_genes <span>=</span> <span>list</span>(<span>set</span>(np<span>.</span>array(pd<span>.</span>DataFrame(adata<span>.</span>uns[<span>'rank_genes_groups'</span>][<span>'names'</span>])<span>.</span>head(num))<span>.</span>reshape(<span>-</span><span>1</span>)))<br><span>len</span>(marker_genes)<br><span># 看一下每一个组的特征基因</span><br><br>adata <span>=</span> sc<span>.</span>read(results_file) <br>result <span>=</span> adata<span>.</span>uns[<span>'rank_genes_groups'</span>]<br>groups <span>=</span> result[<span>'names'</span>]<span>.</span>dtype<span>.</span>names<br>pd<span>.</span>DataFrame(<br>    {group <span>+</span> <span>'_'</span> <span>+</span> key[:<span>1</span>]: result[key][group]<br>    <span>for</span> group <span>in</span> groups <span>for</span> key <span>in</span> [<span>'names'</span>, <span>'pvals'</span>]})<span>.</span>iloc[<span>0</span>:<span>6</span>,<span>0</span>:<span>6</span>]<br><span># 比较组别间差异</span><br>sc<span>.</span>tl<span>.</span>rank_genes_groups(adata, <span>'leiden'</span>, groups<span>=</span>[<span>'0'</span>], reference<span>=</span><span>'1'</span>, method<span>=</span><span>'wilcoxon'</span>)<br>sc<span>.</span>pl<span>.</span>rank_genes_groups(adata, groups<span>=</span>[<span>'0'</span>], n_genes<span>=</span><span>20</span>)<br>sc<span>.</span>pl<span>.</span>rank_genes_groups_violin(adata, groups<span>=</span><span>'0'</span>, n_genes<span>=</span><span>8</span>)<br><span># 这里需要重载一下结果，如果不重载的话结果会有差异的</span><br>adata <span>=</span> sc<span>.</span>read(results_file)<br>sc<span>.</span>pl<span>.</span>rank_genes_groups_violin(adata, groups<span>=</span><span>'0'</span>, n_genes<span>=</span><span>8</span>)</code></pre><p><br></p><p><br></p><p><code></code></p><p><code><img data-croporisrc="https://mmbiz.qlogo.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTia1t2FurEHV9cf75RvvHTx0EA8mmYV7sWsLLnMuwhIXNXkmicQQfiarDQg/0?wx_fmt=other&amp;from=appmsg" data-cropx1="0" data-cropx2="580.6352087114337" data-cropy1="0" data-cropy2="638.1560798548095" data-imgfileid="100001100" data-ratio="1.0982758620689654" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaK0KhTFaaID2lCFmmEwVicbHnAHgxM61lnlyCyYNBZLDvn81blWuxI2A/640?wx_fmt=jpeg" data-type="jpeg" data-w="580" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaK0KhTFaaID2lCFmmEwVicbHnAHgxM61lnlyCyYNBZLDvn81blWuxI2A/640?wx_fmt=jpeg"></code></p><p><code><br></code></p><p><code><br></code></p><p><code><br></code></p><p><code>sc<span>.</span>pl<span>.</span>violin(adata, [<span>'CST3'</span>, <span>'NKG7'</span>, <span>'PPBP'</span>], groupby<span>=</span><span>'leiden'</span>)</code></p><p><code><img data-backh="183" data-backw="359" data-croporisrc="https://mmbiz.qlogo.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaibF9SCwbGmyhst6xJTA8oU5hCMgKNCcDZq1nYF0slc0KRTCR65qkhhw/0?wx_fmt=other&amp;from=appmsg" data-cropx1="0" data-cropx2="491.40684410646384" data-cropy1="0" data-cropy2="250.49429657794676" data-imgfileid="100001102" data-ratio="0.5091649694501018" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaQS3J0aESPxHTESicVoTW63SHiaPWIGkUbFPByhicyr3fvseSTDF4B0xFQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="491" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaQS3J0aESPxHTESicVoTW63SHiaPWIGkUbFPByhicyr3fvseSTDF4B0xFQ/640?wx_fmt=jpeg"></code></p><p><br></p><hr><p><code></code></p><pre><code>new_cluster_names <span>=</span> [<br>    <span>'CD4 T'</span>, <span>'CD14 Monocytes'</span>,<br>    <span>'B'</span>, <span>'CD8 T'</span>,<br>    <span>'NK'</span>, <span>'FCGR3A Monocytes'</span>,<br>    <span>'Dendritic'</span>, <span>'Megakaryocytes'</span>]<br>adata<span>.</span>rename_categories(<span>'leiden'</span>, new_cluster_names)<br>sc<span>.</span>pl<span>.</span>umap(adata, color<span>=</span><span>'leiden'</span>, legend_loc<span>=</span><span>'on data'</span>, title<span>=</span><span>''</span>, frameon<span>=</span><span>False</span>, save<span>=</span><span>'.pdf'</span>)<br>sc<span>.</span>pl<span>.</span>dotplot(adata, marker_genes, groupby<span>=</span><span>'leiden'</span>);<br>sc<span>.</span>pl<span>.</span>stacked_violin(adata, marker_genes, groupby<span>=</span><span>'leiden'</span>, rotation<span>=</span><span>90</span>);<br>adata<span>.</span>raw<span>.</span>to_adata()<span>.</span>write(<span>'./write/pbmc3k_withoutX.h5ad'</span>)<br></code><p><code>WARNING: saving figure to <span>file</span> figures\umap<span>.</span>pdf</code></p><p><br></p><p><code><br></code></p></pre><figure data-size="normal"><img data-croporisrc="https://mmbiz.qlogo.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaibJ3K44ESzS6zXapJkk4sjqUxppGpca4AnGP91G2oITJcdTBtyLU2sQ/0?wx_fmt=other&amp;from=appmsg" data-cropx1="0" data-cropx2="427.6762402088773" data-cropy1="0" data-cropy2="473.89033942558746" data-imgfileid="100001105" data-ratio="1.1100702576112411" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaQicibltfADhwGNwJiaVUCOR0lg6rlw7d9PSHPDzd0xWnPsibAZHfQuZMJw/640?wx_fmt=jpeg" data-type="jpeg" data-w="427" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaQicibltfADhwGNwJiaVUCOR0lg6rlw7d9PSHPDzd0xWnPsibAZHfQuZMJw/640?wx_fmt=jpeg"></figure><figure data-size="normal"><img data-croporisrc="https://mmbiz.qlogo.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiahibobKWqTXWJRYTMO5N6P8omZhp7Wa68NYqib6cC6XH1w6fJzHgQQ7hw/0?wx_fmt=other&amp;from=appmsg" data-cropx1="60" data-cropx2="562.6086956521739" data-cropy1="0" data-cropy2="371.4667940754897" data-imgfileid="100001104" data-ratio="0.7390438247011952" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaYviaVbe5JlwSJuYWlk1c9e6jpseEP3Dn3ufjdQAYsbWOia3Cp4SQoNkQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="502" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaYviaVbe5JlwSJuYWlk1c9e6jpseEP3Dn3ufjdQAYsbWOia3Cp4SQoNkQ/640?wx_fmt=jpeg"></figure><figure data-size="normal"><img data-croporisrc="https://mmbiz.qlogo.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiae43TIOr7BGaOoIkPHGx5P8xbBvnbWsEUJnM3aeI5MniauQ18elkAC5w/0?wx_fmt=other&amp;from=appmsg" data-cropx1="0" data-cropx2="720" data-cropy1="0" data-cropy2="349.5652173913043" data-imgfileid="100001106" data-ratio="0.4847222222222222" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaGCf6YlIwdPic4MpHIsa5x3sBVs9tYJz5xNiatscZGrwbBLfs7e3HTLEg/640?wx_fmt=jpeg" data-type="jpeg" data-w="720" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaGCf6YlIwdPic4MpHIsa5x3sBVs9tYJz5xNiatscZGrwbBLfs7e3HTLEg/640?wx_fmt=jpeg"></figure><p><br></p><pre><p><strong>如果你能看到这里</strong></p><p><strong>那我再给你看下我是如何使用scanpy处理一个covid-19超大数据集的</strong><br></p><p><br><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247483911&amp;idx=1&amp;sn=6e65a8a473c2f83fff2ceb2d6669c88c&amp;chksm=ce646ceef913e5f869755571011f39ec44b4e8d442f2b22d68e68539ac671c23a65a0369d214&amp;scene=21#wechat_redirect" textvalue="GSE158055 covid19 肺组织60W单细胞细胞实战" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2">GSE158055 covid19 肺组织60W单细胞细胞实战</a></p><p><br></p><p><strong>应粉丝呼声，欢迎假如我们的生信技能互换群</strong><br></p><p><img data-croporisrc="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaic90FkFvOD5rV3xDcaRm4mbIvkOvozA6icykiaMeGHarfMCJXQ5fdGV8A/0?wx_fmt=jpeg&amp;from=appmsg" data-cropx1="0" data-cropx2="1031" data-cropy1="331.2528517110266" data-cropy2="1495.538022813688" data-galleryid="" data-imgfileid="100001113" data-ratio="1.1290009699321049" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaW2giczhrPdgr4o6Xx21NkQAQfAJ7RibwTNLpOCG764pIQxHAEnytn2rg/640?wx_fmt=jpeg" data-type="jpeg" data-w="1031" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345SktqRjaooLcw6jPibr1sqQkTiaW2giczhrPdgr4o6Xx21NkQAQfAJ7RibwTNLpOCG764pIQxHAEnytn2rg/640?wx_fmt=jpeg"></p><p></p><p><br></p></pre></pre><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Zr01SKxhDCd2iwH-prhPtg",target="_blank" rel="noopener noreferrer">原文链接</a>
