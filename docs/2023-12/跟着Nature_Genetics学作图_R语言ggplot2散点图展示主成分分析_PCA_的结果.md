---
title: "跟着Nature Genetics学作图：R语言ggplot2散点图展示主成分分析（PCA）的结果"
date: 2023-12-01T04:59:44Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Acdemic"]
---
跟着Nature Genetics学作图：R语言ggplot2散点图展示主成分分析（PCA）的结果 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><h2 data-tool="mdnice编辑器"><span></span><span>论文</span><span></span><span> </span></h2><blockquote data-tool="mdnice编辑器"><p>Pangenome analysis reveals genomic variations associated with domestication traits in broomcorn millet</p></blockquote><p data-tool="mdnice编辑器">https://doi.org/10.1038/s41588-023-01571-z</p><p data-tool="mdnice编辑器">论文中提供大部分图的原始作图数据，我们可以试着用论文中提供的原始数据来复现一下论文中的图</p><p data-tool="mdnice编辑器">今天的推文来复现一下论文中的figure1b 和figure1c</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100012803" data-ratio="0.4475945017182131" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk66W6zqxJfBX9NpDFqh8Wc7v83fS39ia7VfibhTQkKXaOETfWC4SvokwCBjxoZoYsGOhBa7grcxEe3Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1164" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk66W6zqxJfBX9NpDFqh8Wc7v83fS39ia7VfibhTQkKXaOETfWC4SvokwCBjxoZoYsGOhBa7grcxEe3Q/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>部分示例数据截图</span><span></span><span> </span></h2><figure data-tool="mdnice编辑器"><img data-imgfileid="100012805" data-ratio="0.7458100558659218" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk66W6zqxJfBX9NpDFqh8Wc7mvHm1fN9qEkLAbJSEkj9PQsGLhE7I371NzxaibhHMndx6ibYO3I1J6gQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="716" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk66W6zqxJfBX9NpDFqh8Wc7mvHm1fN9qEkLAbJSEkj9PQsGLhE7I371NzxaibhHMndx6ibYO3I1J6gQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100012806" data-ratio="0.5716510903426791" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk66W6zqxJfBX9NpDFqh8Wc75CHTsP7ibvPgdlO1kGAntsyKoib4iaZzvjBjRlSM72SwoqpMSCSmQawiaA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1284" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk66W6zqxJfBX9NpDFqh8Wc75CHTsP7ibvPgdlO1kGAntsyKoib4iaZzvjBjRlSM72SwoqpMSCSmQawiaA/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>读取数据</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(readxl)<br>library(tidyverse)<br><br>dat&lt;-read_excel(<span>"data/20231201/41588_2023_1571_MOESM3_ESM.xlsx"</span>,<br>                sheet = <span>"Supplementary Table 1"</span>,<br>                skip = 1)<br>dat<br><br>dat&lt;-dat %&gt;% <br>  mutate(Accession=str_replace(`Alternative sample name`,<span>"Clean_"</span>,<span>""</span>))<br><br>fig1b.dat&lt;-read_excel(<span>"data/20231201/41588_2023_1571_MOESM4_ESM.xlsx"</span>,<br>                      sheet = <span>"Fig. 1b"</span>,<br>                      skip = 1)<br>fig1b.dat<br><br>fig1c.dat&lt;-read_excel(<span>"data/20231201/41588_2023_1571_MOESM4_ESM.xlsx"</span>,<br>                      sheet = <span>"Fig. 1c"</span>,<br>                      skip = 1)<br><br>fig1c.dat<br></code></pre><p data-tool="mdnice编辑器">论文中给landrace还分为 Chinese landraces(landrace C) from the European and Central Asian landraces (landrace O)</p><p data-tool="mdnice编辑器">生成这个分组</p><pre data-tool="mdnice编辑器"><span></span><code>dat %&gt;% <br>  filter(str_count(Location,<span>"[A-Z]"</span>)&gt;=2) %&gt;% <br>  pull(Location) %&gt;% table() %&gt;% <br>  as.data.frame() %&gt;% <br>  rename(<span>"province"</span>=<span>"."</span>) %&gt;% <br>  filter(!(province==<span>"USA"</span>|province==<span>"Czech Republic"</span>|province==<span>"South Korea"</span>)) %&gt;% <br>  pull(province) %&gt;% <br>  as.character() -&gt; province.X<br></code></pre><p data-tool="mdnice编辑器">这个代码的作用是把中国的省份摘出来，思路是中国省份的拼音是最少2个大写字母，然后再去除其他</p><h2 data-tool="mdnice编辑器"><span></span><span>figure1b作图代码</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>fig1b.dat %&gt;% <br>  left_join(dat,by=c(<span>"Accession"</span>=<span>"Accession"</span>)) %&gt;% <br>  mutate(new.group=case_when(<br>    Location %<span>in</span>% province.X ~ <span>"C"</span>,<br>    TRUE ~ <span>"O"</span><br>  )) %&gt;% <br>  mutate(new.group02=case_when(<br>    Group == <span>"Landrace"</span> ~ paste(Group,new.group,sep=<span>" "</span>),<br>    TRUE ~ Group<br>  )) %&gt;% <br>  ggplot(aes(x=PC1,y=PC2))+<br>  geom_point(aes(color=new.group02),<br>             size=2)+<br>  scale_color_manual(values = c(<span>"Cultivar"</span>=<span>"#e86a10"</span>,<br>                                <span>"Landrace C"</span>=<span>"#3a78c4"</span>,<br>                                <span>"Landrace O"</span>=<span>"#56a4aa"</span>,<br>                                <span>"Wild"</span>=<span>"#f1ab00"</span>),<br>                     name=NULL)+<br>  theme_bw(base_size = 15)+<br>  theme(panel.border = element_blank(),<br>        panel.grid = element_blank(),<br>        axis.line = element_line(),<br>        legend.position = c(0.2,0.2))+<br>  labs(x=<span>"PC1 (27.9%)"</span>,y=<span>"PC2 (16.9%)"</span>)+<br>  guides(color=guide_legend(override.aes = list(size=5)))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100012804" data-ratio="0.6191780821917808" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk66W6zqxJfBX9NpDFqh8Wc7tiaZDKdHyem9c9haPpAGZo25YE0TSbqToF2HSE1OMib48xVVqxZADRsQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1460" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk66W6zqxJfBX9NpDFqh8Wc7tiaZDKdHyem9c9haPpAGZo25YE0TSbqToF2HSE1OMib48xVVqxZADRsQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>figure1c的作图代码，思路和1b基本一致</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>fig1c.dat %&gt;% <br>  left_join(dat,by=c(<span>"Accession"</span>=<span>"Accession"</span>)) %&gt;% <br>  mutate(new.group=case_when(<br>    Location %<span>in</span>% province.X ~ <span>"C"</span>,<br>    TRUE ~ <span>"O"</span><br>  )) %&gt;% <br>  mutate(new.group02=case_when(<br>    Group == <span>"Landrace"</span> ~ paste(Group,new.group,sep=<span>" "</span>),<br>    TRUE ~ Group<br>  )) %&gt;% <br>  ggplot(aes(x=PC1,y=PC3))+<br>  geom_point(aes(color=new.group02),<br>             size=2)+<br>  scale_color_manual(values = c(<span>"Cultivar"</span>=<span>"#e86a10"</span>,<br>                                <span>"Landrace C"</span>=<span>"#3a78c4"</span>,<br>                                <span>"Landrace O"</span>=<span>"#56a4aa"</span>,<br>                                <span>"Wild"</span>=<span>"#f1ab00"</span>),<br>                     name=NULL)+<br>  theme_bw(base_size = 15)+<br>  theme(panel.border = element_blank(),<br>        panel.grid = element_blank(),<br>        axis.line = element_line(),<br>        legend.position = c(0.2,0.2))+<br>  labs(x=<span>"PC1 (27.9%)"</span>,y=<span>"PC2 (12.8%)"</span>)+<br>  guides(color=guide_legend(override.aes = list(size=5)))<br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100012807" data-ratio="0.616643929058663" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk66W6zqxJfBX9NpDFqh8Wc7hKTaXfk0qdl0YjRSoCrIDbhwtK2FELRy1S5NNf6GgG6TYUPoZKlhKw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1466" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk66W6zqxJfBX9NpDFqh8Wc7hKTaXfk0qdl0YjRSoCrIDbhwtK2FELRy1S5NNf6GgG6TYUPoZKlhKw/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>组合图</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>p1b&lt;-fig1b.dat %&gt;% <br>  left_join(dat,by=c(<span>"Accession"</span>=<span>"Accession"</span>)) %&gt;% <br>  mutate(new.group=case_when(<br>    Location %<span>in</span>% province.X ~ <span>"C"</span>,<br>    TRUE ~ <span>"O"</span><br>  )) %&gt;% <br>  mutate(new.group02=case_when(<br>    Group == <span>"Landrace"</span> ~ paste(Group,new.group,sep=<span>" "</span>),<br>    TRUE ~ Group<br>  )) %&gt;% <br>  ggplot(aes(x=PC1,y=PC2))+<br>  geom_point(aes(color=new.group02),<br>             size=2)+<br>  scale_color_manual(values = c(<span>"Cultivar"</span>=<span>"#e86a10"</span>,<br>                                <span>"Landrace C"</span>=<span>"#3a78c4"</span>,<br>                                <span>"Landrace O"</span>=<span>"#56a4aa"</span>,<br>                                <span>"Wild"</span>=<span>"#f1ab00"</span>),<br>                     name=NULL)+<br>  theme_bw(base_size = 15)+<br>  theme(panel.border = element_blank(),<br>        panel.grid = element_blank(),<br>        axis.line = element_line(),<br>        legend.position = c(0.2,0.2))+<br>  labs(x=<span>"PC1 (27.9%)"</span>,y=<span>"PC2 (16.9%)"</span>)+<br>  guides(color=guide_legend(override.aes = list(size=5)))<br><br>p1b<br><br>p1c&lt;-fig1c.dat %&gt;% <br>  left_join(dat,by=c(<span>"Accession"</span>=<span>"Accession"</span>)) %&gt;% <br>  mutate(new.group=case_when(<br>    Location %<span>in</span>% province.X ~ <span>"C"</span>,<br>    TRUE ~ <span>"O"</span><br>  )) %&gt;% <br>  mutate(new.group02=case_when(<br>    Group == <span>"Landrace"</span> ~ paste(Group,new.group,sep=<span>" "</span>),<br>    TRUE ~ Group<br>  )) %&gt;% <br>  ggplot(aes(x=PC1,y=PC3))+<br>  geom_point(aes(color=new.group02),<br>             size=2)+<br>  scale_color_manual(values = c(<span>"Cultivar"</span>=<span>"#e86a10"</span>,<br>                                <span>"Landrace C"</span>=<span>"#3a78c4"</span>,<br>                                <span>"Landrace O"</span>=<span>"#56a4aa"</span>,<br>                                <span>"Wild"</span>=<span>"#f1ab00"</span>),<br>                     name=NULL)+<br>  theme_bw(base_size = 15)+<br>  theme(panel.border = element_blank(),<br>        panel.grid = element_blank(),<br>        axis.line = element_line(),<br>        legend.position = c(0.2,0.2))+<br>  labs(x=<span>"PC1 (27.9%)"</span>,y=<span>"PC2 (12.8%)"</span>)+<br>  guides(color=guide_legend(override.aes = list(size=5)))<br><br>p1c<br><br>library(patchwork)<br>p1c+p1b<br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100012812" data-ratio="0.4261111111111111" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk66W6zqxJfBX9NpDFqh8Wc7AIWwSGLJfn8mKZFLaJLTD21wGYe0pib0SZPyBdkYu85Ed6osibuVW53g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1800" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk66W6zqxJfBX9NpDFqh8Wc7AIWwSGLJfn8mKZFLaJLTD21wGYe0pib0SZPyBdkYu85Ed6osibuVW53g/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><blockquote data-tool="mdnice编辑器"><p>示例数据可以到论文中下载，或者给推文打赏1元获取我整理的示例数据和代码</p></blockquote><p data-tool="mdnice编辑器"><strong>欢迎大家关注我的公众号</strong></p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzI3NzQ3MTcxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5t1sOnM0iabvBhnfIj5YpyqrMib0E1MGCd9ibcYxaOPZd0GWhQBDvK2BPEwsicQxd6y5MHLfphnwHnow/0?wx_fmt=png" data-nickname="小明的数据分析笔记本" data-alias="" data-signature="分享R语言和python在生物信息领域做数据分析和数据可视化的简单小例子；偶尔会分享一些组学数据处理相关的内容" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"></p><blockquote data-tool="mdnice编辑器"><p>小明的数据分析笔记本 公众号 主要分享：1、R语言和python做数据分析和数据可视化的简单小例子；2、园艺植物相关转录组学、基因组学、群体遗传学文献阅读笔记；3、生物信息学入门学习资料及自己的学习笔记！</p></blockquote></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/jHVlmMZHAn_kWLHcO1oknQ",target="_blank" rel="noopener noreferrer">原文链接</a>
