---
title: "单细胞测序并不一定需要去除批次效应"
date: 2023-12-04T13:39:19Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
单细胞测序并不一定需要去除批次效应 by 生信菜鸟团
------
<div><section><strong><span>大家好，今天</span></strong><strong><span>我们分享的是单细胞的学习教程https://www.singlecellworkshop.com/analysis-tutorial.html  教程的作者使用了四个样本，但是没有使用harmony去整合 去除批次效应。</span></strong></section><hr><p><strong><span>主要内容：</span></strong></p><ul><li><p><strong><span>SCTransform流程代码<strong><span>及结果</span></strong></span></strong></p></li><li><p><strong><span>harmony流程代码及结果</span></strong></p></li><li><p><strong><span>seurat单样本标准流程代码<strong><span>及结果</span></strong></span></strong></p></li><li><p><strong><span>三种方法结果比较<br></span></strong></p></li></ul><p><strong><span><br></span></strong></p><p><strong><span>是不是这四个样本就不需要去批次效应呢？接下来我们探索一下</span></strong></p><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><p><strong><span>01</span></strong></p></section></section></section></section></section></section><section powered-by="xiumi.us"><section><img data-imgfileid="100034474" data-ratio="1.21580547112462" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/MVPvEL7Qg0EgrwdibaKqfTqpyFcSD7uE2JcEGETKYmdVA1UNUhbaXBa2qqazjc44k52ezTYYvRyoGAIOgrUNVhg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-w="329" width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/MVPvEL7Qg0EgrwdibaKqfTqpyFcSD7uE2JcEGETKYmdVA1UNUhbaXBa2qqazjc44k52ezTYYvRyoGAIOgrUNVhg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section><p><strong><span>1 首先是把教程的代码跑一遍</span></strong><br></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="kotlin"><code><span># load Seurat <span>package</span> </span></code><code><span>library(Seurat)</span></code><code><span><br></span></code><code><span>dir.create(<span>"~/gzh/harmony_sct"</span>,recursive = TRUE)</span></code><code><span>setwd(<span>"~/gzh/harmony_sct/"</span>)</span></code><code><span>getwd()</span></code><code><span>list.files()</span></code><code><span><br></span></code><code><span><br></span></code><code><span># <span>1</span> 不去除批次效应，教程的步骤----</span></code><code><span>{</span></code><code><span>  pfc2.<span>data</span> &lt;- Read10X(<span>data</span>.dir = <span>"raw-data/pfc-sample2"</span>)</span></code><code><span>  pfc3.<span>data</span> &lt;- Read10X(<span>data</span>.dir = <span>"raw-data/pfc-sample3"</span>)</span></code><code><span>  pfc5.<span>data</span> &lt;- Read10X(<span>data</span>.dir = <span>"raw-data/pfc-sample5"</span>)</span></code><code><span>  pfc7.<span>data</span> &lt;- Read10X(<span>data</span>.dir = <span>"raw-data/pfc-sample7"</span>)</span></code><code><span>  </span></code><code><span>  # create a new Seurat <span>object</span> <span>for</span> each sample</span></code><code><span>  # min.cells = <span>3</span>, only genes detected <span>in</span> at least <span>3</span> cells will be included</span></code><code><span>  # min.features = <span>200</span>, only cells with at least <span>200</span> genes detected will be included</span></code><code><span>  </span></code><code><span>  pfc2 &lt;- CreateSeuratObject(counts = pfc2.<span>data</span>, project = <span>"pfc-demo"</span>, min.cells = <span>3</span>, min.features = <span>200</span>)</span></code><code><span>  pfc3 &lt;- CreateSeuratObject(counts = pfc3.<span>data</span>, project = <span>"pfc-demo"</span>, min.cells = <span>3</span>, min.features = <span>200</span>)</span></code><code><span>  pfc5 &lt;- CreateSeuratObject(counts = pfc5.<span>data</span>, project = <span>"pfc-demo"</span>, min.cells = <span>3</span>, min.features = <span>200</span>)</span></code><code><span>  pfc7 &lt;- CreateSeuratObject(counts = pfc7.<span>data</span>, project = <span>"pfc-demo"</span>, min.cells = <span>3</span>, min.features = <span>200</span>)</span></code><code><span>  </span></code><code><span>  pfc2</span></code><code><span>  </span></code><code><span>  # remove the raw <span>data</span> to save processing space</span></code><code><span>  rm(pfc2.<span>data</span>, pfc3.<span>data</span>, pfc5.<span>data</span>, pfc7.<span>data</span>)</span></code><code><span>  </span></code><code><span>  # inspect the metadata <span>for</span> one of our objects using the <span>'head'</span> function</span></code><code><span>  head(<span>pfc2@</span>meta.<span>data</span>)</span></code><code><span>  </span></code><code><span>  </span></code><code><span>  <span>pfc2@</span>meta.<span>data</span>$sample_number &lt;- <span>"2"</span> </span></code><code><span>  <span>pfc3@</span>meta.<span>data</span>$sample_number &lt;- <span>"3"</span> </span></code><code><span>  <span>pfc5@</span>meta.<span>data</span>$sample_number &lt;- <span>"5"</span> </span></code><code><span>  <span>pfc7@</span>meta.<span>data</span>$sample_number &lt;- <span>"7"</span> </span></code><code><span>  </span></code><code><span>  # merge multiple Seurat objects</span></code><code><span>  pfc &lt;- merge(x = pfc2, y = list(pfc3, pfc5, pfc7))</span></code><code><span>  </span></code><code><span>  </span></code><code><span>  # remove individual objects to save processing space</span></code><code><span>  rm(pfc2, pfc3, pfc5, pfc7)</span></code><code><span>  </span></code><code><span>  </span></code><code><span>  # inpect our new combined <span>object</span></span></code><code><span>  pfc</span></code><code><span>  # an important metadata slot to add <span>in</span> every experiment <span>is</span> the ratio of mitochondrial genes</span></code><code><span>  # detected <span>in</span> each cell - <span>this</span> can be used <span>as</span> a proxy <span>for</span> cell quality <span>in</span> most preparations</span></code><code><span>  pfc[[<span>"percent.mt"</span>]] &lt;- PercentageFeatureSet(<span>object</span> = pfc, pattern = <span>"^mt-"</span>)</span></code><code><span>  </span></code><code><span>  # percent.mt cutoffs typically range from <span>5</span>-<span>10</span>% depending on the sample</span></code><code><span>  </span></code><code><span>  VlnPlot(pfc, features = c(<span>"percent.mt"</span>), pt.size=<span>0</span>, y.max=<span>15</span>) </span></code><code><span>  </span></code><code><span>  pfc &lt;- subset(pfc, subset = percent.mt &lt; <span>5</span>)</span></code><code><span>  </span></code><code><span>  </span></code><code><span>  VlnPlot(pfc, features = c(<span>"nFeature_RNA"</span>), pt.size=<span>0</span>, y.max=<span>2000</span>)</span></code><code><span>  </span></code><code><span>  pfc &lt;- subset(pfc, subset = nFeature_RNA &gt; <span>600</span>)</span></code><code><span>  # inspect our QC metrics again</span></code><code><span>  VlnPlot(pfc, features = c(<span>"nFeature_RNA"</span>,<span>"nCount_RNA"</span>,<span>"percent.mt"</span>), pt.size=<span>0</span>)</span></code><code><span>  </span></code><code><span>  </span></code><code><span>  # <span>this</span> may take several minutes to execute, and progress will display <span>in</span> the console</span></code><code><span>  pfc &lt;- SCTransform(pfc)</span></code><code><span>  </span></code><code><span>  </span></code><code><span>  pfc &lt;- RunPCA(pfc, npcs = <span>60</span>)</span></code><code><span>  </span></code><code><span>  </span></code><code><span>  pfc &lt;- FindNeighbors(pfc, dims = <span>1</span>:<span>60</span>) </span></code><code><span>  pfc &lt;- FindClusters(pfc, resolution = <span>0.7</span>)</span></code><code><span>  pfc &lt;- RunUMAP(pfc, dims = <span>1</span>:<span>60</span>)</span></code><code><span>  </span></code><code><span>  DimPlot(pfc, label=T)</span></code><code><span>  DimPlot(pfc, group.<span>by</span>=<span>"sample_number"</span>)</span></code><code><span>}</span></code><code><span><br></span></code><code><span>DefaultAssay(pfc)</span></code><code><span>Assays(pfc)</span></code><code><span><br></span></code></pre></section><p><img data-galleryid="" data-imgfileid="100034472" data-ratio="1.1985507246376812" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPhXn3DCxHibGt92nJ6wO4H0HRusBzSfT3Vte2pR36ldYg0tSRtyiaibA8Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="690" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPhXn3DCxHibGt92nJ6wO4H0HRusBzSfT3Vte2pR36ldYg0tSRtyiaibA8Q/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100034473" data-ratio="1.09375" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPXm8og5LrIsCtia2ibhoPxHL1ticqmcib0DvEkg3g8mCiatnd5n0sKRGUZnw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="704" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPXm8og5LrIsCtia2ibhoPxHL1ticqmcib0DvEkg3g8mCiatnd5n0sKRGUZnw/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>我们可以看到就算不去批次效应，结果也挺好的</span></strong></p><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><p><strong><span>02</span></strong></p></section></section></section></section></section></section><section powered-by="xiumi.us"><section><img data-imgfileid="100034475" data-ratio="1.21580547112462" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/MVPvEL7Qg0EgrwdibaKqfTqpyFcSD7uE2JcEGETKYmdVA1UNUhbaXBa2qqazjc44k52ezTYYvRyoGAIOgrUNVhg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-w="329" width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/MVPvEL7Qg0EgrwdibaKqfTqpyFcSD7uE2JcEGETKYmdVA1UNUhbaXBa2qqazjc44k52ezTYYvRyoGAIOgrUNVhg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section><p><strong><span>2 然后使用harmony去除批次效应 看看效果</span></strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><br></span></code><code><span><span>2</span><span># 2 harmony去除批次效应 流程---------</span></span></code><code><span><br></span></code><code><span>subset_data=pfc</span></code><code><span><br></span></code><code><span>DefaultAssay(subset_data)=<span>'RNA'</span></span></code><code><span><br></span></code><code><span>{</span></code><code><span>library(dplyr)</span></code><code><span><br></span></code><code><span><br></span></code><code><span>DimPlot(subset_data)</span></code><code><span><br></span></code><code><span><br></span></code><code><span>subset_data[[<span>"percent.mt"</span>]] &lt;- PercentageFeatureSet(subset_data, pattern = <span>"^mt-"</span>)</span></code><code><span>VlnPlot(subset_data, features = c(<span>"nFeature_RNA"</span>, <span>"nCount_RNA"</span>, <span>"percent.mt"</span>), ncol = <span>3</span>)</span></code><code><span><br></span></code><code><span><br></span></code><code><span>subset_data = subset_data %&gt;%</span></code><code><span>  Seurat::NormalizeData(verbose = <span>FALSE</span>) %&gt;%  </span></code><code><span>  FindVariableFeatures(selection.method = <span>"vst"</span>, nfeatures = <span>2000</span>) %&gt;%</span></code><code><span>  ScaleData(verbose = <span>FALSE</span>) %&gt;%</span></code><code><span>  RunPCA(npcs = <span>30</span>, verbose = <span>FALSE</span>)</span></code><code><span>ElbowPlot(subset_data, ndims = <span>30</span>)</span></code><code><span>VlnPlot(subset_data, features = c(<span>"nFeature_RNA"</span>, <span>"nCount_RNA"</span>, <span>"percent.mt"</span>), ncol = <span>3</span>)</span></code><code><span><br></span></code><code><span>head(subset_data@meta.data)</span></code><code><span>library(stringr)</span></code><code><span>table(str_split(colnames(subset_data),pattern = <span>"_"</span>,simplify = <span>TRUE</span>)[,<span>2</span>])</span></code><code><span>subset_data@meta.data$stim &lt;-paste0(<span>'mice'</span>,str_split(colnames(subset_data),pattern = <span>"_"</span>,simplify = <span>TRUE</span>)[,<span>2</span>])</span></code><code><span><span>#table(subset_data$stim)</span></span></code><code><span><br></span></code><code><span>library(<span>'harmony'</span>)</span></code><code><span><br></span></code><code><span>subset_data &lt;- subset_data %&gt;% RunHarmony(<span>"stim"</span>, plot_convergence = <span>TRUE</span>)</span></code><code><span>harmony_embeddings &lt;- Embeddings(subset_data, <span>'harmony'</span>) </span></code><code><span><span>#######################cluster</span></span></code><code><span>dims = <span>1</span>:<span>30</span></span></code><code><span>subset_data &lt;- subset_data %&gt;% </span></code><code><span>  RunUMAP(reduction = <span>"harmony"</span>, dims = dims) %&gt;% </span></code><code><span>  RunTSNE(reduction = <span>"harmony"</span>, dims = dims) %&gt;% </span></code><code><span>  FindNeighbors(reduction = <span>"harmony"</span>, dims = dims)</span></code><code><span><br></span></code><code><span>subset_data=FindClusters(subset_data,resolution =<span>0.7</span>)</span></code><code><span>DimPlot(subset_data,group)</span></code><code><span>head(subset_data@meta.data)</span></code><code><span>  head(pfc@meta.data)</span></code><code><span>  </span></code><code><span>  </span></code><code><span>}</span></code></pre></section><p><strong><span>同样的分辨率下对比两次的结果</span></strong><br></p><p><img data-galleryid="" data-imgfileid="100034476" data-ratio="0.5740740740740741" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPkSLqOQfR9t9e9jyXsCudystJ5dVGEWtmPiaVwEia2xwhz30iafhsxjPng/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPkSLqOQfR9t9e9jyXsCudystJ5dVGEWtmPiaVwEia2xwhz30iafhsxjPng/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100034481" data-ratio="0.562037037037037" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPaBuzMN6iaK4V0iacIWJZFpQOPwyhmgGlnFOAN7icgjAibWiaB4K4upXzlaw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPaBuzMN6iaK4V0iacIWJZFpQOPwyhmgGlnFOAN7icgjAibWiaB4K4upXzlaw/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>我们发现hamony之后多了两个亚群，但是样本总体分布好像影响并不大。所以我们看下harmony前后，每个亚群中的细胞数量变化</span></strong></p><p><img data-galleryid="" data-imgfileid="100034477" data-ratio="0.4975786924939467" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPmkpfbzbfGia2icPEdSkaJbqsOtV96icWB79SUiaBeCyIDEAgLkPrnnNTlA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="826" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPmkpfbzbfGia2icPEdSkaJbqsOtV96icWB79SUiaBeCyIDEAgLkPrnnNTlA/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>总体看上去，harmony前后对大多数亚群影响并不大，且harmony前后有很多亚群多是可以互相重合的。（个人觉得之所以教程作者不去除批次效应是因为他所选的四个样本都是control组）</span></strong></p><p><img data-galleryid="" data-imgfileid="100034478" data-ratio="0.07644882860665844" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPicEpwn6bHwFzich4rARtZ70naibmfrE3SasNOGBAibzkEuAKicyoLEej97A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="811" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPicEpwn6bHwFzich4rARtZ70naibmfrE3SasNOGBAibzkEuAKicyoLEej97A/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>如果想更详细的比较harmony前后的变化，我们可以从细胞命名、差异分析、拟时序分析等等结果来看啦~</span></strong><br></p><p><strong><span>那为什么作者只是使用了SCTtransform这个函数就可以?达到这么好的效果，是不是<strong><span>SCTtransform可以去除批次效应？——当然不是，不信你去看官网~<img data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Watermelon.png" data-ratio="1" data-w="128" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Watermelon.png"></span></strong></span></strong></p><p><span><span><strong>3 .不死心的话，我们不使用<strong><span>SCTtransform，也不去除批次效应，只使用seurat标准流程试试</span></strong></strong></span></span><strong><strong><span></span></strong></strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="kotlin"><code><span><span>3</span>#<span>3</span> 标准流程-----</span></code><code><span>head(<span>subset_data@</span>meta.<span>data</span>)</span></code><code><span>All=CreateSeuratObject(counts = <span>subset_data@</span>assays$<span>RNA@</span>counts,meta.<span>data</span> = <span>subset_data@</span>meta.<span>data</span>)</span></code><code><span><br></span></code><code><span>{</span></code><code><span>  </span></code><code><span>  VlnPlot(All, features = c(<span>"nFeature_RNA"</span>, <span>"nCount_RNA"</span>, <span>"percent.mt"</span>), ncol = <span>3</span>)</span></code><code><span>  All = All%&gt;%Seurat::NormalizeData(verbose = FALSE) %&gt;%  </span></code><code><span>    FindVariableFeatures(selection.method = <span>"vst"</span>    ) %&gt;%</span></code><code><span>    ScaleData(verbose = FALSE)</span></code><code><span>  All = RunPCA(All, npcs = <span>30</span>, verbose = FALSE)</span></code><code><span>  ElbowPlot(All, ndims = <span>30</span>)</span></code><code><span>  </span></code><code><span>  </span></code><code><span>  </span></code><code><span>#######################cluster</span></code><code><span>  All &lt;- All %&gt;% </span></code><code><span>    RunUMAP(reduction = <span>"pca"</span>, dims = <span>1</span>:<span>30</span>) %&gt;% </span></code><code><span>    RunTSNE(reduction = <span>"pca"</span>, dims = <span>1</span>:<span>30</span>) %&gt;% </span></code><code><span>    FindNeighbors(reduction = <span>"pca"</span>, dims = <span>1</span>:<span>30</span>)</span></code><code><span>  All&lt;-All%&gt;% FindClusters(resolution = <span>0.7</span>) %&gt;% identity()</span></code><code><span>  </span></code><code><span>  DimPlot(All,group.<span>by</span> =<span>'stim'</span> )+ggtitle(<span>"standard_pipeline"</span>)</span></code><code><span>  </span></code><code><span>}</span></code><code><span>head(<span>All@</span>meta.<span>data</span>)</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100034479" data-ratio="0.8507462686567164" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPpDiaCqMRoASfwPHqHQOqWnRibibIXiaBbyCHeiadQr1q8LLyDaQicibt4vydA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="938" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPpDiaCqMRoASfwPHqHQOqWnRibibIXiaBbyCHeiadQr1q8LLyDaQicibt4vydA/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>结果看上去也还可以吧</span></strong></p><hr><p><strong><span>我们对比一下三种方法：</span></strong><br></p><p><img data-galleryid="" data-imgfileid="100034480" data-ratio="0.4953027139874739" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPafWXn6zPMHA2DPareBsjbHjSib3vNp2DsHQ5WrB2R0th7bmEeM5n7ibw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1916" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPafWXn6zPMHA2DPareBsjbHjSib3vNp2DsHQ5WrB2R0th7bmEeM5n7ibw/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>肉眼看不出来有多大区别吧</span></strong></p><p><img data-galleryid="" data-imgfileid="100034485" data-ratio="0.49083289680460973" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPFe5hZdc2VmqzvO0eom2mxQJzkej2w8SrU5q0maDmRdBtCYp2ZsAeWw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1909" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPFe5hZdc2VmqzvO0eom2mxQJzkej2w8SrU5q0maDmRdBtCYp2ZsAeWw/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><span><span><strong>有意思的是sctransform和标准流程都能得到17个亚群<br></strong></span></span></p><p><br></p><p><img data-galleryid="" data-imgfileid="100034484" data-ratio="0.5614035087719298" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPficKsdShgBvPIODcKksCiaZiccRRvoLJdEvVYslot8Rf0n5Pq67P8UcoA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="741" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SksuH0KuDGkibk7Y0DghlgCpPficKsdShgBvPIODcKksCiaZiccRRvoLJdEvVYslot8Rf0n5Pq67P8UcoA/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><strong><span>所以大家觉得我们需要harmnoy去除批次效应吗？<br></span></strong></p><p><strong><span>4 结论： 虽然不去批次效应也能拿到很好的结果，个人还是建议使用harmony，你觉得呢？</span></strong></p><p>下面来源GPT: 尽管在某些情况下即使不去除批次效应也能得到看似合理的结果，但这可能是偶然的，并且存在风险。批次效应可能掩盖或模拟出实际的生物信号，导致错误的生物学结论。因此，建议使用诸如Harmony这样的算法来校正批次效应，以提高数据分析的可靠性和准确性。</p><p>Harmony是一种用于多组数据整合的算法，它可以在保留生物学变异的同时，减少技术变异，特别是批次效应。通过对数据进行校正，Harmony可以帮助研究者更好地识别真实的生物学差异，而不是由实验条件引起的差异。</p><p><strong><span><strong><span>如果想更详细的比较harmony前后的变化，我们可以从细胞命名、差异分析、拟时序分析等等结果来看啦~如果大家对这个话题感兴趣我们可以开个直播聊聊~</span></strong></span></strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg2NDcxMzYwNg==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sks7JhVxUX46ZKxPSob6ptqIZgnIEnHOn5VMwCX8sN6MQy1Pq4XXFEOJ6grAmsoQugyCDKOZictDBHA/0?wx_fmt=png" data-nickname="生信小博士" data-alias="bioinformatics_Dr" data-signature="【生物信息学】R语言，学习生信，seurat，单细胞测序，空间转录组。 Python，scanpy，cell2location，资料分享" data-from="2" data-is_biz_ban="0"></mp-common-profile></section><p><strong><span><strong><span></span></strong></span></strong></p><p><strong><span><strong><span>更多精彩，关注 生信小博士 的直播~</span></strong></span></strong></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247484687&amp;idx=1&amp;sn=8742f11a45f0b617b1bc1ec6c1e36dab&amp;chksm=ce646be6f913e2f0486cce8a6f702cc8fa2542557c9542ea551461f7502a65a424238eab3a3e&amp;scene=21#wechat_redirect" textvalue="seurat个性化细胞注释并把细分亚群放回总群" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">seurat个性化细胞注释并把细分亚群放回总群</a></p><p><span><strong><span>感谢Jimmy老师的分享，此次推文的灵感来自Jimmy老师</span></strong><img data-ratio="1" data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Cold.png" data-w="128" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Cold.png"></span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247484687&amp;idx=1&amp;sn=8742f11a45f0b617b1bc1ec6c1e36dab&amp;chksm=ce646be6f913e2f0486cce8a6f702cc8fa2542557c9542ea551461f7502a65a424238eab3a3e&amp;scene=21#wechat_redirect" textvalue="seurat个性化细胞注释并把细分亚群放回总群" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"></a><br></p><p><img data-imgfileid="100034483" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" data-type="gif" data-w="240" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"><br></p><p><img data-imgfileid="100034482" data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="other" data-w="341" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p><p><strong><span><br></span></strong></p><p><br></p><p><br></p><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Lv3zQWB_kjNCUy0ZIxCBUA",target="_blank" rel="noopener noreferrer">原文链接</a>
