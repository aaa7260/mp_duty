---
title: "ggSCvis 可视化 dot/heatmap/violin plot 示例"
date: 2023-12-21T14:07:03Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
ggSCvis 可视化 dot/heatmap/violin plot 示例 by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><h4 data-tool="mdnice编辑器"><span></span></h4><section><mp-common-profile data-pluginname="mpprofile" data-id="MzkyMTI1MTYxNA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usey42oX5qyLTVibLRO9dz8ic5G4TpEHQc9rICYlpS4MHg6Et8cgXrQDqibvibXombicTro8t9cekJRlDBcw/0?wx_fmt=png" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h4 data-tool="mdnice编辑器"><span></span></h4><h2 data-tool="mdnice编辑器"><span><span>1</span></span><span>引言</span><span></span></h2><blockquote data-tool="mdnice编辑器"><p><strong>ggplot 无法添加树图,替代的做法是单独画出聚类树然后进行拼图</strong>, 其它相关的包比如 <strong>ggh4x</strong> 和 <strong>ggside</strong> 都是在绘图前用矩阵数据进行聚类获得 <strong>dendrogram</strong> 的一个对象再传进去进行作图, <strong>其局限性并不便捷,此外对于分面时,便无法产生正常的结果</strong>。</p></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100028547" data-ratio="0.9007164790174002" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicv7cgxUP2OuGqsaxibDsRuIGiaetTQY9wiaKGgsFmWZLyiaqkzRSIZjl3pFA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="977" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicv7cgxUP2OuGqsaxibDsRuIGiaetTQY9wiaKGgsFmWZLyiaqkzRSIZjl3pFA/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><p>如果能够单独对每个 panel 进行聚类和绘制聚类树,那当然是最好了, <strong>我的想法是在 geom 图层里面将数据转为矩阵,然后进行聚类绘制热图</strong>, 因为聚类后对于的 x/y 的顺序不再是原来的了,我尝试过在 geom 里面修改 x/y 的顺序,但是失败了,所以替代的做法是重新绘制出 x/y 的标签,把原来的标签隐藏或者去掉。</p></blockquote><blockquote data-tool="mdnice编辑器"><p>最终的实现效果是可以勉强完成的,但是图的位置还是需要进一步微调的,这也是不太完美的地方。</p></blockquote><h2 data-tool="mdnice编辑器"><span><span>2</span></span><span>安装</span><span></span></h2><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("devtools")</span><br>devtools::install_github(<span>"junjunlab/ggSCvis"</span>)<br><br><span># or</span><br>remotes::install_github(<span>"junjunlab/ggSCvis"</span>)<br></code></pre><h2 data-tool="mdnice编辑器"><span><span>3</span></span><span>geom_scDot</span><span></span></h2><blockquote data-tool="mdnice编辑器"><p><strong>geom_scDot</strong> 用来绘制基因表达的散点图,比较常见。</p></blockquote><p data-tool="mdnice编辑器">准备数据:</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(SeuratData)<br><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(ggSCvis)<br><span>library</span>(dplyr)<br><br>data(<span>"pbmc3k"</span>)<br>pbmc &lt;- pbmc3k.final<br>pbmc &lt;- UpdateSeuratObject(object = pbmc)<br><br>pbmc.markers &lt;- FindAllMarkers(pbmc, only.pos = <span>TRUE</span>)<br>mk &lt;- pbmc.markers %&gt;%<br>  group_by(cluster) %&gt;%<br>  dplyr::filter(avg_log2FC &gt; <span>1</span>) %&gt;%<br>  group_by(cluster) %&gt;%<br>  arrange(p_val_adj ,avg_log2FC) %&gt;% slice_head(n = <span>5</span>)<br></code></pre><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">默认就是正常的散点图 (<strong>ggscplot</strong> 会自带计算 <strong>mean_exp</strong> 和 <strong>pct</strong>):</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         mapping = aes(y = gene_name,x = seurat_clusters,<br>                       fill = mean_exp,size = pct)) +<br>  geom_scDot() +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw()<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028549" data-ratio="1.159124087591241" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvBffgroYWyJDWR7cV2wIQR7WkUThunyphibzLZewHSIoibYbyzS6cPxJg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="685" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvBffgroYWyJDWR7cV2wIQR7WkUThunyphibzLZewHSIoibYbyzS6cPxJg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">分面:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(y = gene_name,x = seurat_clusters,<br>                       fill = mean_exp,size = pct)) +<br>  geom_scDot() +<br>  facet_new(facet_row = <span>"featureAnno"</span>,scales = <span>"free_y"</span>,<br>            strip.col = circlize::rand_color(<span>9</span>),<br>            <span>switch</span> = <span>"y"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028548" data-ratio="1.2301587301587302" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvWZ8BcUdC3k425Xlc2PrRp3xiaibRkK38GPMUw3KV3Q8r0pIGEqGa6sYQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="756" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvWZ8BcUdC3k425Xlc2PrRp3xiaibRkK38GPMUw3KV3Q8r0pIGEqGa6sYQ/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,size = pct)) +<br>  geom_scDot() +<br>  facet_new(facet_col = <span>"featureAnno"</span>,scales = <span>"free_x"</span>,<br>            strip.col = circlize::rand_color(<span>9</span>),<br>            x.angle = <span>90</span>,x.label.hjust = <span>1</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028545" data-ratio="0.32541133455210236" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvyYmeVyDiadvuicia082DAyGDN4YcWMoAHxXeg7TLXNHbTS6RxtLUTUqvw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1641" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvyYmeVyDiadvuicia082DAyGDN4YcWMoAHxXeg7TLXNHbTS6RxtLUTUqvw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">不分面,标注细胞:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,size = pct,exp = mean_exp,<br>                       celltype = featureAnno)) +<br>  geom_scDot() +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw() +<br>  theme(axis.text.x = element_text(angle = <span>90</span>,hjust = <span>1</span>),<br>        axis.text = element_text(colour = <span>"black"</span>),<br>        plot.margin = margin(t = <span>0.3</span>,unit = <span>"npc"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028546" data-ratio="0.34603421461897355" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvs6LNJx9o8vuial1MAw8ho1QfHOCDhjsHRibj9s3nep3BgI5eM3JlaEXg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1286" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvs6LNJx9o8vuial1MAw8ho1QfHOCDhjsHRibj9s3nep3BgI5eM3JlaEXg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">添加聚类树, <strong>注意这里我们取消了 ylab, 所以添加的是聚类后的顺序标签</strong>:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,size = pct,exp = mean_exp,<br>                       celltype = featureAnno)) +<br>  geom_scDot(add.tree = <span>T</span>,add.tree.y = <span>T</span>,tree.y.side = <span>"right"</span>,new.ylabel.x = <span>0</span>) +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw() +<br>  theme(axis.text.y = element_blank(),<br>        axis.text.x = element_text(angle = <span>90</span>,hjust = <span>1</span>),<br>        axis.text = element_text(colour = <span>"black"</span>),<br>        plot.margin = margin(t = <span>0.3</span>,r = <span>0.2</span>,l = <span>0.1</span>,unit = <span>"npc"</span>),<br>        legend.position = c(<span>1.15</span>,<span>0.5</span>)) +<br>  ylab(<span>""</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028550" data-ratio="0.35424940428911833" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvBVFNjycSrowibLjBx3JVmGHxl7fIYGTo9rInyN1R2G2EsoIHibJb0wwA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1259" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvBVFNjycSrowibLjBx3JVmGHxl7fIYGTo9rInyN1R2G2EsoIHibJb0wwA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">修改树的位置:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,size = pct,exp = mean_exp,<br>                       celltype = featureAnno)) +<br>  geom_scDot(branch.side = <span>"bottom"</span>,branch.shift = <span>0.35</span>) +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw() + xlab(<span>""</span>) +<br>  theme(axis.text.x = element_text(angle = <span>90</span>,hjust = <span>1</span>),<br>        axis.text = element_text(colour = <span>"black"</span>),<br>        plot.margin = margin(b = <span>0.3</span>,t = <span>0.1</span>,unit = <span>"npc"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028551" data-ratio="0.5167055167055167" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvF1AkNmfP0ttlU0ic4QciaYxIBWH6e8nZnyVhqKg2ArXegzQHSicibovpyA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1287" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvF1AkNmfP0ttlU0ic4QciaYxIBWH6e8nZnyVhqKg2ArXegzQHSicibovpyA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">添加到右边:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(y = gene_name,x = seurat_clusters,<br>                       fill = mean_exp,size = pct,exp = mean_exp,<br>                       celltype = featureAnno)) +<br>  geom_scDot(branch.side = <span>"right"</span>) +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw() +<br>  theme(legend.position = <span>"left"</span>,<br>        axis.text = element_text(colour = <span>"black"</span>),<br>        plot.margin = margin(t = <span>0.05</span>,r = <span>0.3</span>,unit = <span>"npc"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028555" data-ratio="1.2064606741573034" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvADgskkzBgAgsmbG1fLJZvCpLlkNicjebVkzOV7wqquJ3mpOUia5XJ81A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="712" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvADgskkzBgAgsmbG1fLJZvCpLlkNicjebVkzOV7wqquJ3mpOUia5XJ81A/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(y = gene_name,x = seurat_clusters,<br>                       fill = mean_exp,size = pct,exp = mean_exp,<br>                       celltype = featureAnno)) +<br>  geom_scDot(branch.side = <span>"right"</span>,<br>             add.tree = <span>T</span>,add.tree.x = <span>T</span>,tree.x.side = <span>"top"</span>,new.xlabel.y = <span>0</span>) +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw() +<br>  theme(axis.text.x = element_blank(),<br>        legend.position = <span>"left"</span>,<br>        axis.text = element_text(colour = <span>"black"</span>),<br>        plot.margin = margin(t = <span>0.1</span>,r = <span>0.3</span>,b = <span>0.1</span>,unit = <span>"npc"</span>)) +<br>  xlab(<span>""</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028554" data-ratio="1.1118881118881119" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvGpa5XQ65cBRWbxia84hJbmrpZSnbKF5TbPGpVLeHzaB1wjgeT9fFI3g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="715" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvGpa5XQ65cBRWbxia84hJbmrpZSnbKF5TbPGpVLeHzaB1wjgeT9fFI3g/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">分面的话,就对每个子 panel 分别添加聚类树:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(y = gene_name,x = seurat_clusters,<br>                       fill = mean_exp,size = pct,exp = mean_exp)) +<br>  geom_scDot(add.tree = <span>T</span>,add.tree.y = <span>T</span>,tree.y.side = <span>"right"</span>,new.ylabel.x = <span>0</span>) +<br>  facet_new(facet_row = <span>"featureAnno"</span>,scales = <span>"free_y"</span>,<br>            strip.col = circlize::rand_color(<span>9</span>),<br>            <span>switch</span> = <span>"y"</span>,<br>            r = <span>0.3</span>,no.ylabel = <span>T</span>,<br>            legend.position = c(<span>1.4</span>,<span>0.5</span>)) +<br>  theme(strip.switch.pad.grid = unit(<span>0.2</span>,<span>"npc"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028552" data-ratio="1.1983122362869199" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvjVPH3IyH3qJNsyv6opn36LtibUNC4CMmcp5YF7tMjEkBauztSaZ2Trg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="711" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvjVPH3IyH3qJNsyv6opn36LtibUNC4CMmcp5YF7tMjEkBauztSaZ2Trg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">XY 都添加聚类树:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,size = pct,exp = mean_exp)) +<br>  geom_scDot(add.tree = <span>T</span>,add.tree.x = <span>T</span>,tree.x.side = <span>"top"</span>,<br>             add.tree.y = <span>T</span>,tree.y.side = <span>"right"</span>,<br>             new.xlabel.y = <span>0</span>) +<br>  facet_new(facet_col = <span>"featureAnno"</span>,scales = <span>"free_x"</span>,<br>            strip.col = circlize::rand_color(<span>9</span>),<br>            b = <span>0.25</span>,l = <span>0</span>,<br>            no.xlabel = <span>T</span>,no.ylabel = <span>T</span>,<br>            legend.position = c(<span>1.05</span>,<span>0.5</span>)) +<br>  theme(strip.switch.pad.grid = unit(<span>0.08</span>,<span>"npc"</span>),<br>        panel.spacing = unit(<span>0.02</span>,<span>"npc"</span>)) +<br>  xlab(<span>""</span>) + ylab(<span>""</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028558" data-ratio="0.24789915966386555" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvvSWax9ZnrH42cibeSO4DxWCibicoHLwmjuIDJFJXQjaxru6vc9ZRHp0Bg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1904" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvvSWax9ZnrH42cibeSO4DxWCibicoHLwmjuIDJFJXQjaxru6vc9ZRHp0Bg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">你自己用 <strong>facet_wrap</strong> 也行:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,size = pct,exp = mean_exp)) +<br>  geom_scDot(add.tree = <span>T</span>,add.tree.x = <span>T</span>,tree.x.side = <span>"top"</span>,<br>             add.tree.y = <span>T</span>,tree.y.side = <span>"right"</span>,<br>             tree.y.width = <span>0.15</span>,<br>             tree.x.height = <span>0.1</span>,tree.y.shift = <span>0.125</span>,<br>             new.xlabel.y = <span>0</span>) +<br>  scale_fill_gradient(low = <span>"grey95"</span>,high = <span>"#990066"</span>) +<br>  facet_wrap(~featureAnno,scales = <span>"free"</span>,nrow = <span>2</span>) +<br>  theme(axis.text = element_blank(),<br>        panel.spacing.y = unit(<span>0.15</span>,<span>"npc"</span>),<br>        panel.spacing.x = unit(<span>0.05</span>,<span>"npc"</span>)) +<br>  xlab(<span>""</span>) + ylab(<span>""</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028560" data-ratio="0.5779761904761904" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvO9nkU5cE2Te8dZNefZ23oKIPB7nyZdJEAJ8AOr77BZHz4b58D5iaaWQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1680" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvO9nkU5cE2Te8dZNefZ23oKIPB7nyZdJEAJ8AOr77BZHz4b58D5iaaWQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">我们可以画个不聚类的对比看看:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,size = pct,exp = mean_exp)) +<br>  geom_scDot() +<br>  scale_fill_gradient(low = <span>"grey95"</span>,high = <span>"#990066"</span>) +<br>  facet_wrap(~featureAnno,scales = <span>"free"</span>,nrow = <span>2</span>) +<br>  theme(axis.text.x = element_text(angle = <span>90</span>,hjust = <span>1</span>)) +<br>  xlab(<span>""</span>) + ylab(<span>""</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028559" data-ratio="0.5552010210593491" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicviblv4lG6vhdSum4Pfo2CCg7mRfHAkicGdxGBflJbjCxd1WaibSoGXbxCg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1567" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicviblv4lG6vhdSum4Pfo2CCg7mRfHAkicGdxGBflJbjCxd1WaibSoGXbxCg/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span><span>4</span></span><span>geom_scTile</span><span></span></h2><blockquote data-tool="mdnice编辑器"><p><strong>geom_scTile</strong> 和 <strong>geom_scDot</strong> 基本一样,不过是用热图展示。</p></blockquote><p data-tool="mdnice编辑器">默认:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         mapping = aes(y = gene_name,x = seurat_clusters,<br>                       fill = mean_exp)) +<br>  geom_scTile() +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw()<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028557" data-ratio="1.3461538461538463" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvvtYJoOEjcB0xdPq2J6mqKhB54cgib7q2kTsQdvqtnzXJ3Bp8emia8hdw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="624" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvvtYJoOEjcB0xdPq2J6mqKhB54cgib7q2kTsQdvqtnzXJ3Bp8emia8hdw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">分面:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(y = gene_name,x = seurat_clusters,<br>                       fill = mean_exp)) +<br>  geom_scTile() +<br>  facet_new(facet_row = <span>"featureAnno"</span>,scales = <span>"free_y"</span>,<br>            strip.col = circlize::rand_color(<span>9</span>),<br>            <span>switch</span> = <span>"y"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028556" data-ratio="1.0038167938931297" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvR1q7fwN3acgtzZHmaCdFyQ5Eh0EniaibQibZjkmj2GOzAS1FNCib8XE6og/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="786" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvR1q7fwN3acgtzZHmaCdFyQ5Eh0EniaibQibZjkmj2GOzAS1FNCib8XE6og/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp)) +<br>  geom_scTile() +<br>  facet_new(facet_col = <span>"featureAnno"</span>,scales = <span>"free_x"</span>,<br>            strip.col = circlize::rand_color(<span>9</span>),<br>            x.angle = <span>90</span>,x.label.hjust = <span>1</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028561" data-ratio="0.27889908256880735" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicv7edu5yiaGCs9JpucUu7YsVJkzbT0RzMBR4tFBwAbzUQvsafrjhRxKvw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1635" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicv7edu5yiaGCs9JpucUu7YsVJkzbT0RzMBR4tFBwAbzUQvsafrjhRxKvw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">不分面添加细胞注释:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,exp = mean_exp,<br>                       celltype = featureAnno)) +<br>  geom_scTile() +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw() +<br>  theme(axis.text.x = element_text(angle = <span>90</span>,hjust = <span>1</span>),<br>        axis.text = element_text(colour = <span>"black"</span>),<br>        plot.margin = margin(t = <span>0.3</span>,unit = <span>"npc"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028564" data-ratio="0.4038972542072631" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvW95OWTakpvo3rvN0x29uRGX7o42VwFIrewep9DpzbawtlrEBJciafuw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1129" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvW95OWTakpvo3rvN0x29uRGX7o42VwFIrewep9DpzbawtlrEBJciafuw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">添加聚类树:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,exp = mean_exp,<br>                       celltype = featureAnno)) +<br>  geom_scTile(add.tree = <span>T</span>,add.tree.y = <span>T</span>,tree.y.side = <span>"right"</span>,new.ylabel.x = <span>0</span>) +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw() +<br>  theme(axis.text.y = element_blank(),<br>        axis.text.x = element_text(angle = <span>90</span>,hjust = <span>1</span>),<br>        axis.text = element_text(colour = <span>"black"</span>),<br>        plot.margin = margin(t = <span>0.3</span>,r = <span>0.2</span>,l = <span>0.1</span>,unit = <span>"npc"</span>),<br>        legend.position = c(<span>1.15</span>,<span>0.5</span>)) +<br>  ylab(<span>""</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028562" data-ratio="0.41020966271649956" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvz462m2JU0icj2jtakGaqzFWuIqxUNCLZNCMGbyiblxBQuV1GnR9pic27w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1097" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvz462m2JU0icj2jtakGaqzFWuIqxUNCLZNCMGbyiblxBQuV1GnR9pic27w/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,exp = mean_exp,<br>                       celltype = featureAnno)) +<br>  geom_scTile(branch.side = <span>"bottom"</span>,branch.shift = <span>0.35</span>) +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw() + xlab(<span>""</span>) +<br>  theme(axis.text.x = element_text(angle = <span>90</span>,hjust = <span>1</span>),<br>        axis.text = element_text(colour = <span>"black"</span>),<br>        plot.margin = margin(b = <span>0.3</span>,t = <span>0.1</span>,unit = <span>"npc"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028565" data-ratio="0.5775022143489814" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvHSl1Mz8M1QhpZziadVbR0e7Iiav5nOdd2OF3fhlLvMxZlEZvpFxKGETA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1129" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvHSl1Mz8M1QhpZziadVbR0e7Iiav5nOdd2OF3fhlLvMxZlEZvpFxKGETA/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(y = gene_name,x = seurat_clusters,<br>                       fill = mean_exp,exp = mean_exp,<br>                       celltype = featureAnno)) +<br>  geom_scTile(branch.side = <span>"right"</span>) +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw() +<br>  theme(legend.position = <span>"left"</span>,<br>        axis.text = element_text(colour = <span>"black"</span>),<br>        plot.margin = margin(t = <span>0.05</span>,r = <span>0.3</span>,unit = <span>"npc"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028563" data-ratio="1.0041608876560333" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvVylFOQnNLjfUMQ3yphU6icQ58tlqEMdq6Wibr4Jia5GMibYajOtsDakOMg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="721" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvVylFOQnNLjfUMQ3yphU6icQ58tlqEMdq6Wibr4Jia5GMibYajOtsDakOMg/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(y = gene_name,x = seurat_clusters,<br>                       fill = mean_exp,exp = mean_exp,<br>                       celltype = featureAnno)) +<br>  geom_scTile(branch.side = <span>"right"</span>,<br>             add.tree = <span>T</span>,add.tree.x = <span>T</span>,tree.x.side = <span>"top"</span>,new.xlabel.y = <span>0</span>) +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw() +<br>  theme(axis.text.x = element_blank(),<br>        legend.position = <span>"left"</span>,<br>        axis.text = element_text(colour = <span>"black"</span>),<br>        plot.margin = margin(t = <span>0.1</span>,r = <span>0.3</span>,b = <span>0.1</span>,unit = <span>"npc"</span>)) +<br>  xlab(<span>""</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028568" data-ratio="1.2666666666666666" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvuQ8yHTj1I8jkJHZ3ibvOQKpbVPbbFk62JhDse0Nn69uPUczjNrN40UQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="720" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvuQ8yHTj1I8jkJHZ3ibvOQKpbVPbbFk62JhDse0Nn69uPUczjNrN40UQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">分面:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(y = gene_name,x = seurat_clusters,<br>                       fill = mean_exp,exp = mean_exp)) +<br>  geom_scTile(add.tree = <span>T</span>,add.tree.y = <span>T</span>,tree.y.side = <span>"right"</span>,new.ylabel.x = <span>0</span>) +<br>  facet_new(facet_row = <span>"featureAnno"</span>,scales = <span>"free_y"</span>,<br>            strip.col = circlize::rand_color(<span>9</span>),<br>            <span>switch</span> = <span>"y"</span>,<br>            r = <span>0.3</span>,no.ylabel = <span>T</span>,<br>            legend.position = c(<span>1.4</span>,<span>0.5</span>)) +<br>  theme(strip.switch.pad.grid = unit(<span>0.2</span>,<span>"npc"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028566" data-ratio="1.1396648044692737" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvInk1ky9fGGPgn25IsI4orRy4XlFe3kRYbCrPIBSloiaXYiabs8fdvibMw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="716" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvInk1ky9fGGPgn25IsI4orRy4XlFe3kRYbCrPIBSloiaXYiabs8fdvibMw/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,exp = mean_exp)) +<br>  geom_scTile(add.tree = <span>T</span>,add.tree.x = <span>T</span>,tree.x.side = <span>"top"</span>,<br>             add.tree.y = <span>T</span>,tree.y.side = <span>"right"</span>,<br>             new.xlabel.y = <span>0</span>) +<br>  facet_new(facet_col = <span>"featureAnno"</span>,scales = <span>"free_x"</span>,<br>            strip.col = circlize::rand_color(<span>9</span>),<br>            b = <span>0.25</span>,l = <span>0</span>,<br>            no.xlabel = <span>T</span>,no.ylabel = <span>T</span>,<br>            legend.position = c(<span>1.05</span>,<span>0.5</span>)) +<br>  theme(strip.switch.pad.grid = unit(<span>0.08</span>,<span>"npc"</span>),<br>        panel.spacing = unit(<span>0.02</span>,<span>"npc"</span>)) +<br>  xlab(<span>""</span>) + ylab(<span>""</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028567" data-ratio="0.26054852320675104" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvPpARpA0l1bVV1ic4WoXm0nYwa6n0qLVdPxEQwv3TH1ZyeKoVI2FwyYw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1896" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvPpARpA0l1bVV1ic4WoXm0nYwa6n0qLVdPxEQwv3TH1ZyeKoVI2FwyYw/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,exp = mean_exp)) +<br>  geom_scTile(add.tree = <span>T</span>,add.tree.x = <span>T</span>,tree.x.side = <span>"top"</span>,<br>             add.tree.y = <span>T</span>,tree.y.side = <span>"right"</span>,<br>             tree.y.width = <span>0.15</span>,<br>             tree.x.height = <span>0.1</span>,tree.y.shift = <span>0.125</span>,<br>             new.xlabel.y = <span>0</span>) +<br>  scale_fill_gradient(low = <span>"grey95"</span>,high = <span>"#990066"</span>) +<br>  facet_wrap(~featureAnno,scales = <span>"free"</span>,nrow = <span>2</span>) +<br>  theme(axis.text = element_blank(),<br>        panel.spacing.y = unit(<span>0.15</span>,<span>"npc"</span>),<br>        panel.spacing.x = unit(<span>0.05</span>,<span>"npc"</span>)) +<br>  xlab(<span>""</span>) + ylab(<span>""</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028569" data-ratio="0.5710857828434314" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvqibic3yKUW4DfVFohFnXqlNc178QgpdYtia07z4kCoo2Cu2KnQO05pnEw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1667" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvqibic3yKUW4DfVFohFnXqlNc178QgpdYtia07z4kCoo2Cu2KnQO05pnEw/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span><span>5</span></span><span>geom_scViolin</span><span></span></h2><blockquote data-tool="mdnice编辑器"><p><strong>geom_scViolin</strong> 用来绘制小提琴图,类似于 scanpy 的这种:</p></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100028570" data-ratio="0.8430066603235015" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvEzricU15ickFgWfmItVEnGsibAnQVWUpOdW5cKnzsvRiaOTqV4ssnS6VFQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1051" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvEzricU15ickFgWfmItVEnGsibAnQVWUpOdW5cKnzsvRiaOTqV4ssnS6VFQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">默认:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         mapping = aes(y = gene_name,x = seurat_clusters,<br>                       fill = mean_exp,exp = value)) +<br>  geom_scViolin() +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw()<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028574" data-ratio="1.4573643410852712" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicv4iaxG9D6DuvQIlnyhsXdEnOyeELCC193EHhqLUP66X7cHK4hq8aCQCg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="645" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicv4iaxG9D6DuvQIlnyhsXdEnOyeELCC193EHhqLUP66X7cHK4hq8aCQCg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">分面</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(y = gene_name,x = seurat_clusters,<br>                       fill = mean_exp,exp = value)) +<br>  geom_scViolin() +<br>  facet_new(facet_row = <span>"featureAnno"</span>,scales = <span>"free_y"</span>,<br>            strip.col = circlize::rand_color(<span>9</span>),<br>            <span>switch</span> = <span>"y"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028571" data-ratio="1.186131386861314" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvIGNIWmicJLKxLrq65XXtiaI1tLY4zicm0SmdhbfmrwiajuLRl1nhcOTohA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="822" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvIGNIWmicJLKxLrq65XXtiaI1tLY4zicm0SmdhbfmrwiajuLRl1nhcOTohA/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,exp = value)) +<br>  geom_scViolin() +<br>  facet_new(facet_col = <span>"featureAnno"</span>,scales = <span>"free_x"</span>,<br>            strip.col = circlize::rand_color(<span>9</span>),<br>            x.angle = <span>90</span>,x.label.hjust = <span>1</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028572" data-ratio="0.3814747105423522" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvfAt2rM2mg5whGic8ARHaGWTY0Q6U1tjiccsZYcArUxbqdo6vvVvQJoqA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1641" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvfAt2rM2mg5whGic8ARHaGWTY0Q6U1tjiccsZYcArUxbqdo6vvVvQJoqA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">不分面添加注释:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = median_exp,exp = value,<br>                       celltype = featureAnno)) +<br>  geom_scViolin() +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw() +<br>  theme(axis.text.x = element_text(angle = <span>90</span>,hjust = <span>1</span>),<br>        axis.text = element_text(colour = <span>"black"</span>),<br>        plot.margin = margin(t = <span>0.3</span>,unit = <span>"npc"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028575" data-ratio="0.6061427280939476" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvpzIIOLWzHXTa5Jia3PSKjxw4k2B4XVXUJSu8FalAANGlJY09GqCJe1Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1107" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvpzIIOLWzHXTa5Jia3PSKjxw4k2B4XVXUJSu8FalAANGlJY09GqCJe1Q/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">添加聚类树:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = median_exp,exp = value,<br>                       celltype = featureAnno)) +<br>  geom_scViolin(add.tree = <span>T</span>,add.tree.y = <span>T</span>,tree.y.side = <span>"right"</span>,new.ylabel.x = <span>0</span>) +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw() +<br>  theme(axis.text.y = element_blank(),<br>        axis.text.x = element_text(angle = <span>90</span>,hjust = <span>1</span>),<br>        axis.text = element_text(colour = <span>"black"</span>),<br>        plot.margin = margin(t = <span>0.3</span>,r = <span>0.2</span>,l = <span>0.1</span>,unit = <span>"npc"</span>),<br>        legend.position = c(<span>1.15</span>,<span>0.5</span>)) +<br>  ylab(<span>""</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028573" data-ratio="0.4934640522875817" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicv0XCiarVNPPafFFkiccu3QT7GibiaiacgWObfMfYbDcAYAuND5k1zwGy4ZWw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1224" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicv0XCiarVNPPafFFkiccu3QT7GibiaiacgWObfMfYbDcAYAuND5k1zwGy4ZWw/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(y = gene_name,x = seurat_clusters,<br>                       fill = median_exp,exp = value,<br>                       celltype = featureAnno)) +<br>  geom_scViolin(branch.side = <span>"right"</span>,<br>              add.tree = <span>T</span>,add.tree.x = <span>T</span>,tree.x.side = <span>"top"</span>,new.xlabel.y = <span>0</span>) +<br>  scale_fill_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  theme_bw() +<br>  theme(axis.text.x = element_blank(),<br>        legend.position = <span>"left"</span>,<br>        axis.text = element_text(colour = <span>"black"</span>),<br>        plot.margin = margin(t = <span>0.1</span>,r = <span>0.3</span>,b = <span>0.1</span>,unit = <span>"npc"</span>)) +<br>  xlab(<span>""</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028577" data-ratio="1.1146341463414635" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvsBYIFupEzufcnnoiabDxCZ4h5ib9JT9EGJuchSajUAVKlQuUibsmkbBZg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="820" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvsBYIFupEzufcnnoiabDxCZ4h5ib9JT9EGJuchSajUAVKlQuUibsmkbBZg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">分面添加聚类树:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(y = gene_name,x = seurat_clusters,<br>                       fill = mean_exp,exp = value)) +<br>  geom_scViolin(add.tree = <span>T</span>,add.tree.y = <span>T</span>,tree.y.side = <span>"right"</span>,new.ylabel.x = <span>0</span>) +<br>  facet_new(facet_row = <span>"featureAnno"</span>,scales = <span>"free_y"</span>,<br>            strip.col = circlize::rand_color(<span>9</span>),<br>            <span>switch</span> = <span>"y"</span>,<br>            r = <span>0.3</span>,no.ylabel = <span>T</span>,<br>            legend.position = c(<span>1.4</span>,<span>0.5</span>)) +<br>  theme(strip.switch.pad.grid = unit(<span>0.2</span>,<span>"npc"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028576" data-ratio="1.20125" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvkicvXQmoLM8hJFiavbeNqdZaxpJiadYDvt5fw5yXC99PTQyaoWyTq4DbA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="800" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvkicvXQmoLM8hJFiavbeNqdZaxpJiadYDvt5fw5yXC99PTQyaoWyTq4DbA/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,exp = value)) +<br>  geom_scViolin(add.tree = <span>T</span>,add.tree.x = <span>T</span>,tree.x.side = <span>"top"</span>,<br>              add.tree.y = <span>T</span>,tree.y.side = <span>"right"</span>,<br>              new.xlabel.y = <span>0</span>) +<br>  facet_new(facet_col = <span>"featureAnno"</span>,scales = <span>"free_x"</span>,<br>            strip.col = circlize::rand_color(<span>9</span>),<br>            b = <span>0.25</span>,l = <span>0</span>,<br>            no.xlabel = <span>T</span>,no.ylabel = <span>T</span>,<br>            legend.position = c(<span>1.05</span>,<span>0.5</span>)) +<br>  theme(strip.switch.pad.grid = unit(<span>0.08</span>,<span>"npc"</span>),<br>        panel.spacing = unit(<span>0.02</span>,<span>"npc"</span>)) +<br>  xlab(<span>""</span>) + ylab(<span>""</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028578" data-ratio="0.270199370409234" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvFlXUU188GuskVZhBic1liaANebiarNlYIn0vEIwpXgYM3rsibFAiaKu0T4A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1906" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvFlXUU188GuskVZhBic1liaANebiarNlYIn0vEIwpXgYM3rsibFAiaKu0T4A/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,exp = value)) +<br>  geom_scViolin(add.tree = <span>T</span>,add.tree.x = <span>T</span>,tree.x.side = <span>"top"</span>,<br>              add.tree.y = <span>T</span>,tree.y.side = <span>"right"</span>,<br>              tree.y.width = <span>0.15</span>,<br>              tree.x.height = <span>0.1</span>,tree.y.shift = <span>0.125</span>,<br>              new.xlabel.y = <span>0</span>) +<br>  scale_fill_gradient(low = <span>"grey95"</span>,high = <span>"#990066"</span>) +<br>  facet_wrap(~featureAnno,scales = <span>"free"</span>,nrow = <span>2</span>) +<br>  theme(axis.text = element_blank(),<br>        panel.spacing.y = unit(<span>0.15</span>,<span>"npc"</span>),<br>        panel.spacing.x = unit(<span>0.05</span>,<span>"npc"</span>)) +<br>  xlab(<span>""</span>) + ylab(<span>""</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028580" data-ratio="0.5888480392156863" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvn9t3oAxMsazt3bZibC38cvqva3Tn6PW5c6dQJTicOHHLLVKg7WuydPZA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1632" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvn9t3oAxMsazt3bZibC38cvqva3Tn6PW5c6dQJTicOHHLLVKg7WuydPZA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">不聚类对比:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = mk$gene,<br>         featuresAnno = mk$cluster,<br>         mapping = aes(x = gene_name,y = seurat_clusters,<br>                       fill = mean_exp,exp = value)) +<br>  geom_scViolin() +<br>  scale_fill_gradient(low = <span>"grey95"</span>,high = <span>"#990066"</span>) +<br>  facet_wrap(~featureAnno,scales = <span>"free"</span>,nrow = <span>2</span>) +<br>  theme(axis.text.x = element_text(angle = <span>90</span>,hjust = <span>1</span>)) +<br>  xlab(<span>""</span>) + ylab(<span>""</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028579" data-ratio="0.52398753894081" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicv5zcpGZBX9S07h7fsHKaFBHpiax40GPLcrewsWRNkGQhd3B4ZANvfsVg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1605" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicv5zcpGZBX9S07h7fsHKaFBHpiax40GPLcrewsWRNkGQhd3B4ZANvfsVg/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><p>更多参数见函数帮助文档。</p></blockquote><h2 data-tool="mdnice编辑器"><span><span>6</span></span><span>结尾</span><span></span></h2><blockquote data-tool="mdnice编辑器"><p><strong>路漫漫其修远兮,吾将上下而求索。</strong></p></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">欢迎加入生信交流群。加我微信我也拉你进 <strong>微信群聊</strong> <strong>老俊俊生信交流群</strong> <strong>(微信交流群需收取 20 元入群费用,一旦交费,拒不退还!(防止骗子和便于管理))</strong> 。QQ 群可免费加入, 记得进群按格式修改备注哦。</p><section data-tool="mdnice编辑器"><section><p><strong>老俊俊微信：</strong></p><figure><img data-imgfileid="100028583" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvwPLBmMjl8Gp5XCB3bv2glrW1uYH97tBzmLiaicibibAXO7VYnkOiaOibyFDw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="430" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvwPLBmMjl8Gp5XCB3bv2glrW1uYH97tBzmLiaicibibAXO7VYnkOiaOibyFDw/640?wx_fmt=png&amp;from=appmsg"></figure><figure><img data-imgfileid="100028585" data-ratio="1.3668430335097002" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicv1LialKRAMkIFdWiaNtIunpESPLibsSc9Gib7PxWuBtn1EmHs1NQFv411AQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="567" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexkQg1HMZeTLibw6RGVlabicv1LialKRAMkIFdWiaNtIunpESPLibsSc9Gib7PxWuBtn1EmHs1NQFv411AQ/640?wx_fmt=png&amp;from=appmsg"></figure></section><section><p><strong>知识星球：</strong></p><figure><img data-imgfileid="100028584" data-ratio="1.5896226415094339" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvdlewI5gnyHvuMvTnaUiaBZdefrfQBbmnBJaC8tWWnTQl7cx4bdPQgsQ/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1060" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4usexkQg1HMZeTLibw6RGVlabicvdlewI5gnyHvuMvTnaUiaBZdefrfQBbmnBJaC8tWWnTQl7cx4bdPQgsQ/640?wx_fmt=jpeg&amp;from=appmsg"></figure></section></section><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><br></p><center data-tool="mdnice编辑器"><strong> 往期回顾目录 </strong></center><p data-tool="mdnice编辑器"><br></p><blockquote data-tool="mdnice编辑器"><p><br></p><center><strong><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247512189&amp;idx=1&amp;sn=1cc5cb6167f9d3960922dd691aa376db&amp;chksm=c1848a0cf6f3031a4b9b1ab4195d525269703553f84ef29ea312878c60accfec07ca3a3102d6&amp;token=864433526&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">给你的亚群添加编号</a></strong></center><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247512093&amp;idx=1&amp;sn=b44680cfccfa7c0bb0a59eef29b944fc&amp;chksm=c1848a6cf6f3037ad9e74e898575125b0cbd0d372c25805315559e5e41c9168c6e8612418896&amp;token=1185565850&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ggSCvis 让你的单细胞可视化 gg 起来</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247511755&amp;idx=1&amp;sn=b5758249eef3fdf4946aae0f4e7ef592&amp;chksm=c18494baf6f31dacdbf6e4a1ba0a05817b087a9bc1ad2a6b8b79959903ce5b96156e4e1a2faf&amp;token=1185565850&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">easylift 基因组坐标轻松转换</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247511683&amp;idx=1&amp;sn=289992da1c3a551a4e5b8236fe830e94&amp;chksm=c18494f2f6f31de444ff98d314f7bfea97ade3573babe625200dd89b1cf86ccb47f287548e61&amp;token=1910483679&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">CCPlotR: 细胞通讯可视化包</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247511206&amp;idx=1&amp;sn=30806bab4936d81aa5b626b3d69d828d&amp;chksm=c18496d7f6f31fc1b8993ebf3b36a9d8a1a5db32181a0cb85297c48016f5debcfb296cf58aa3&amp;token=1910483679&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">geom_genomicNestedZoom 放大视图</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247511175&amp;idx=1&amp;sn=d88e495e3ecb62a29931bab3cb51d804&amp;chksm=c18496f6f6f31fe0b5d599fb2a8e0c6f001feb8d93ea214ce2ae1a5ea9bf59845739af520c04&amp;token=1304327956&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">听说你想给 pheatmap 添加感兴趣基因?</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247510846&amp;idx=1&amp;sn=9483f23b436903fd4d74034a64e99e79&amp;chksm=c184914ff6f31859d557c2665f1e09b088ef716c5037f3030f7a12d9cbcd144aa9dd257f08d2&amp;token=843968300&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">给 heatmap 添加显著性标记</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247510758&amp;idx=1&amp;sn=6a1d78131792e297d7be33aceb4711ba&amp;chksm=c1849097f6f3198159bbb4d66d4d1424d11da9ea07e896128573ebc63860aa2985e31ea5331d&amp;token=843968300&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">没有文档的 R 包不算好包</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247510747&amp;idx=1&amp;sn=464460e587caf23d74ae7dde559a55c6&amp;chksm=c18490aaf6f319bc66e40f855881ff946d4cc6b2076868ffc18cb699fd89d4126ea2c1e941b8&amp;token=1323965478&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">听说你想用 ggcirclize 绘制和弦图?</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247510718&amp;idx=1&amp;sn=fb687cfb1316cf04edf4efd1bd4b8fec&amp;chksm=c18490cff6f319d96545ab5a9641a0a027b94436859af9778b052580a7e788df9538b6a77dce&amp;token=1323965478&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">连接线的高度控制</a></center></strong><p><br></p></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/wv1pnl01ALEWak1GgiUkkw",target="_blank" rel="noopener noreferrer">原文链接</a>
