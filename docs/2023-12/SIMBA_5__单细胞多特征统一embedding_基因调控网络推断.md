---
title: "SIMBA（5）-单细胞多特征统一embedding-基因调控网络推断"
date: 2023-12-26T23:30:21Z
draft: ["false"]
tags: [
  "fetched",
  "TOP生物信息"
]
categories: ["Acdemic"]
---
SIMBA（5）-单细胞多特征统一embedding-基因调控网络推断 by TOP生物信息
------
<div><h1><span><span data-raw-text-1697268228246="【" data-textnode-index-1697268228246="0" data-index-1697268228246="0" data-index-len-1697268228246="0">【</span><span data-raw-text-1697268228246="基" data-textnode-index-1697268228246="0" data-index-1697268228246="1" data-index-len-1697268228246="1">基</span><span data-raw-text-1697268228246="于" data-textnode-index-1697268228246="0" data-index-1697268228246="2" data-index-len-1697268228246="2">于</span><span data-raw-text-1697268228246="p" data-textnode-index-1697268228246="0" data-index-1697268228246="3" data-index-len-1697268228246="3">p</span><span data-raw-text-1697268228246="y" data-textnode-index-1697268228246="0" data-index-1697268228246="4" data-index-len-1697268228246="4">y</span><span data-raw-text-1697268228246="t" data-textnode-index-1697268228246="0" data-index-1697268228246="5" data-index-len-1697268228246="5">t</span><span data-raw-text-1697268228246="h" data-textnode-index-1697268228246="0" data-index-1697268228246="6" data-index-len-1697268228246="6">h</span><span data-raw-text-1697268228246="o" data-textnode-index-1697268228246="0" data-index-1697268228246="7" data-index-len-1697268228246="7">o</span><span data-raw-text-1697268228246="n" data-textnode-index-1697268228246="0" data-index-1697268228246="8" data-index-len-1697268228246="8">n</span><span data-raw-text-1697268228246="的" data-textnode-index-1697268228246="0" data-index-1697268228246="9" data-index-len-1697268228246="9">的</span><span data-raw-text-1697268228246="单" data-textnode-index-1697268228246="0" data-index-1697268228246="10" data-index-len-1697268228246="10">单</span><span data-raw-text-1697268228246="细" data-textnode-index-1697268228246="0" data-index-1697268228246="11" data-index-len-1697268228246="11">细</span><span data-raw-text-1697268228246="胞" data-textnode-index-1697268228246="0" data-index-1697268228246="12" data-index-len-1697268228246="12">胞</span><span data-raw-text-1697268228246="分" data-textnode-index-1697268228246="0" data-index-1697268228246="13" data-index-len-1697268228246="13">分</span><span data-raw-text-1697268228246="析" data-textnode-index-1697268228246="0" data-index-1697268228246="14" data-index-len-1697268228246="14">析</span><span data-raw-text-1697268228246="】" data-textnode-index-1697268228246="0" data-index-1697268228246="15" data-index-len-1697268228246="15">】</span><span data-raw-text-1697268228246="回" data-textnode-index-1697268228246="0" data-index-1697268228246="16" data-index-len-1697268228246="16">回</span><span data-raw-text-1697268228246="顾" data-textnode-index-1697268228246="0" data-index-1697268228246="17" data-index-len-1697268228246="17">顾</span><span data-raw-text-1697268228246="：" data-textnode-index-1697268228246="0" data-index-1697268228246="18" data-index-len-1697268228246="18">：</span></span></h1><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkzMzE5NTM4NA==&amp;mid=2247487099&amp;idx=1&amp;sn=2d843211c4b26610b232da20b4829c61&amp;chksm=c251756cf526fc7ae3502412cecd5e9737014cb53827e508875760bcdcbe1490cdc17023cacd&amp;scene=21#wechat_redirect" textvalue="基于Scanpy的单细胞数据质控、聚类、标注" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span data-raw-text-1697268228246="基" data-textnode-index-1697268228246="1" data-index-1697268228246="19" data-index-len-1697268228246="19">基</span><span data-raw-text-1697268228246="于" data-textnode-index-1697268228246="1" data-index-1697268228246="20" data-index-len-1697268228246="20">于</span><span data-raw-text-1697268228246="S" data-textnode-index-1697268228246="1" data-index-1697268228246="21" data-index-len-1697268228246="21">S</span><span data-raw-text-1697268228246="c" data-textnode-index-1697268228246="1" data-index-1697268228246="22" data-index-len-1697268228246="22">c</span><span data-raw-text-1697268228246="a" data-textnode-index-1697268228246="1" data-index-1697268228246="23" data-index-len-1697268228246="23">a</span><span data-raw-text-1697268228246="n" data-textnode-index-1697268228246="1" data-index-1697268228246="24" data-index-len-1697268228246="24">n</span><span data-raw-text-1697268228246="p" data-textnode-index-1697268228246="1" data-index-1697268228246="25" data-index-len-1697268228246="25">p</span><span data-raw-text-1697268228246="y" data-textnode-index-1697268228246="1" data-index-1697268228246="26" data-index-len-1697268228246="26">y</span><span data-raw-text-1697268228246="的" data-textnode-index-1697268228246="1" data-index-1697268228246="27" data-index-len-1697268228246="27">的</span><span data-raw-text-1697268228246="单" data-textnode-index-1697268228246="1" data-index-1697268228246="28" data-index-len-1697268228246="28">单</span><span data-raw-text-1697268228246="细" data-textnode-index-1697268228246="1" data-index-1697268228246="29" data-index-len-1697268228246="29">细</span><span data-raw-text-1697268228246="胞" data-textnode-index-1697268228246="1" data-index-1697268228246="30" data-index-len-1697268228246="30">胞</span><span data-raw-text-1697268228246="数" data-textnode-index-1697268228246="1" data-index-1697268228246="31" data-index-len-1697268228246="31">数</span><span data-raw-text-1697268228246="据" data-textnode-index-1697268228246="1" data-index-1697268228246="32" data-index-len-1697268228246="32">据</span><span data-raw-text-1697268228246="质" data-textnode-index-1697268228246="1" data-index-1697268228246="33" data-index-len-1697268228246="33">质</span><span data-raw-text-1697268228246="控" data-textnode-index-1697268228246="1" data-index-1697268228246="34" data-index-len-1697268228246="34">控</span><span data-raw-text-1697268228246="、" data-textnode-index-1697268228246="1" data-index-1697268228246="35" data-index-len-1697268228246="35">、</span><span data-raw-text-1697268228246="聚" data-textnode-index-1697268228246="1" data-index-1697268228246="36" data-index-len-1697268228246="36">聚</span><span data-raw-text-1697268228246="类" data-textnode-index-1697268228246="1" data-index-1697268228246="37" data-index-len-1697268228246="37">类</span><span data-raw-text-1697268228246="、" data-textnode-index-1697268228246="1" data-index-1697268228246="38" data-index-len-1697268228246="38">、</span><span data-raw-text-1697268228246="标" data-textnode-index-1697268228246="1" data-index-1697268228246="39" data-index-len-1697268228246="39">标</span><span data-raw-text-1697268228246="注" data-textnode-index-1697268228246="1" data-index-1697268228246="40" data-index-len-1697268228246="40">注</span><br></a></section><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkzMzE5NTM4NA==&amp;mid=2247487189&amp;idx=1&amp;sn=34279346e448e9735133af6a53ce7946&amp;chksm=c25175c2f526fcd4fa6db6109b0d456e20452aa9b5efa1eb35e948dedb55bd3bfc1257ef9b7a&amp;scene=21#wechat_redirect" textvalue="基于COSG的单细胞数据marker基因鉴定" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span data-raw-text-1697268228246="基" data-textnode-index-1697268228246="2" data-index-1697268228246="41" data-index-len-1697268228246="41">基</span><span data-raw-text-1697268228246="于" data-textnode-index-1697268228246="2" data-index-1697268228246="42" data-index-len-1697268228246="42">于</span><span data-raw-text-1697268228246="C" data-textnode-index-1697268228246="2" data-index-1697268228246="43" data-index-len-1697268228246="43">C</span><span data-raw-text-1697268228246="O" data-textnode-index-1697268228246="2" data-index-1697268228246="44" data-index-len-1697268228246="44">O</span><span data-raw-text-1697268228246="S" data-textnode-index-1697268228246="2" data-index-1697268228246="45" data-index-len-1697268228246="45">S</span><span data-raw-text-1697268228246="G" data-textnode-index-1697268228246="2" data-index-1697268228246="46" data-index-len-1697268228246="46">G</span><span data-raw-text-1697268228246="的" data-textnode-index-1697268228246="2" data-index-1697268228246="47" data-index-len-1697268228246="47">的</span><span data-raw-text-1697268228246="单" data-textnode-index-1697268228246="2" data-index-1697268228246="48" data-index-len-1697268228246="48">单</span><span data-raw-text-1697268228246="细" data-textnode-index-1697268228246="2" data-index-1697268228246="49" data-index-len-1697268228246="49">细</span><span data-raw-text-1697268228246="胞" data-textnode-index-1697268228246="2" data-index-1697268228246="50" data-index-len-1697268228246="50">胞</span><span data-raw-text-1697268228246="数" data-textnode-index-1697268228246="2" data-index-1697268228246="51" data-index-len-1697268228246="51">数</span><span data-raw-text-1697268228246="据" data-textnode-index-1697268228246="2" data-index-1697268228246="52" data-index-len-1697268228246="52">据</span><span data-raw-text-1697268228246="m" data-textnode-index-1697268228246="2" data-index-1697268228246="53" data-index-len-1697268228246="53">m</span><span data-raw-text-1697268228246="a" data-textnode-index-1697268228246="2" data-index-1697268228246="54" data-index-len-1697268228246="54">a</span><span data-raw-text-1697268228246="r" data-textnode-index-1697268228246="2" data-index-1697268228246="55" data-index-len-1697268228246="55">r</span><span data-raw-text-1697268228246="k" data-textnode-index-1697268228246="2" data-index-1697268228246="56" data-index-len-1697268228246="56">k</span><span data-raw-text-1697268228246="e" data-textnode-index-1697268228246="2" data-index-1697268228246="57" data-index-len-1697268228246="57">e</span><span data-raw-text-1697268228246="r" data-textnode-index-1697268228246="2" data-index-1697268228246="58" data-index-len-1697268228246="58">r</span><span data-raw-text-1697268228246="基" data-textnode-index-1697268228246="2" data-index-1697268228246="59" data-index-len-1697268228246="59">基</span><span data-raw-text-1697268228246="因" data-textnode-index-1697268228246="2" data-index-1697268228246="60" data-index-len-1697268228246="60">因</span><span data-raw-text-1697268228246="鉴" data-textnode-index-1697268228246="2" data-index-1697268228246="61" data-index-len-1697268228246="61">鉴</span><span data-raw-text-1697268228246="定" data-textnode-index-1697268228246="2" data-index-1697268228246="62" data-index-len-1697268228246="62">定</span></a></p><p><span data-raw-text-1697268228246="正" data-textnode-index-1697268228246="3" data-index-1697268228246="76" data-index-len-1697268228246="76"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkzMzE5NTM4NA==&amp;mid=2247487274&amp;idx=1&amp;sn=9ecd04a53f1f313c65e299bddb1705b2&amp;chksm=c251743df526fd2bdb2b36e1951b34e1c6d9fe00062644572c377b7beb28cfbc76ffcccc32c5&amp;scene=21#wechat_redirect" textvalue="【基于python的单细胞分析】使用scVI实现批次效应校正" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">【基于python的单细胞分析】使用scVI实现批次效应校正</a><br></span></p><p><span><span data-raw-text-1697268228246="如" data-textnode-index-1697268228246="4" data-index-1697268228246="77" data-index-len-1697268228246="77">如</span><span data-raw-text-1697268228246="何" data-textnode-index-1697268228246="4" data-index-1697268228246="78" data-index-len-1697268228246="78">何</span><span data-raw-text-1697268228246="进" data-textnode-index-1697268228246="4" data-index-1697268228246="79" data-index-len-1697268228246="79">进</span><span data-raw-text-1697268228246="行" data-textnode-index-1697268228246="4" data-index-1697268228246="80" data-index-len-1697268228246="80">行</span><span data-raw-text-1697268228246="细" data-textnode-index-1697268228246="4" data-index-1697268228246="81" data-index-len-1697268228246="81">细</span><span data-raw-text-1697268228246="胞" data-textnode-index-1697268228246="4" data-index-1697268228246="82" data-index-len-1697268228246="82">胞</span><span data-raw-text-1697268228246="类" data-textnode-index-1697268228246="4" data-index-1697268228246="83" data-index-len-1697268228246="83">类</span><span data-raw-text-1697268228246="型" data-textnode-index-1697268228246="4" data-index-1697268228246="84" data-index-len-1697268228246="84">型</span><span data-raw-text-1697268228246="注" data-textnode-index-1697268228246="4" data-index-1697268228246="85" data-index-len-1697268228246="85">注</span><span data-raw-text-1697268228246="释" data-textnode-index-1697268228246="4" data-index-1697268228246="86" data-index-len-1697268228246="86">释</span></span></p><p><span></span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkzMzE5NTM4NA==&amp;mid=2247489613&amp;idx=1&amp;sn=0b27c70cfa5c07b7f8860d9599d6c60a&amp;chksm=c251635af526ea4cd86465be7fbf478d4f3632484902d7b036608acc3d0cbf2cf7df4abf2a54&amp;scene=21#wechat_redirect" textvalue="scanpy绘图函数介绍-上" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">scanpy绘图函数介绍-上</a></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkzMzE5NTM4NA==&amp;mid=2247489664&amp;idx=1&amp;sn=d90f808b6654f3606ce6d08d55256855&amp;chksm=c2516397f526ea812452d47aff14f4ac4b5c42666912450f84e3e64c4c7ece5a164533add5f3&amp;scene=21#wechat_redirect" textvalue="scanpy绘图函数介绍-下" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">scanpy绘图函数介绍-下</a></p><p><br></p><h1><span><span data-raw-text-1697268228246="【" data-textnode-index-1697268228246="0" data-index-1697268228246="0" data-index-len-1697268228246="0"><span data-raw-text-1701741933156="【" data-textnode-index-1701741933156="76" data-index-1701741933156="131" data-index-len-1701741933156="131">【</span><span data-raw-text-1701741933156="S" data-textnode-index-1701741933156="76" data-index-1701741933156="132" data-index-len-1701741933156="132">S</span><span data-raw-text-1701741933156="I" data-textnode-index-1701741933156="76" data-index-1701741933156="133" data-index-len-1701741933156="133">I</span><span data-raw-text-1701741933156="M" data-textnode-index-1701741933156="76" data-index-1701741933156="134" data-index-len-1701741933156="134">M</span><span data-raw-text-1701741933156="B" data-textnode-index-1701741933156="76" data-index-1701741933156="135" data-index-len-1701741933156="135">B</span><span data-raw-text-1701741933156="A" data-textnode-index-1701741933156="76" data-index-1701741933156="136" data-index-len-1701741933156="136">A</span><span data-raw-text-1701741933156="系" data-textnode-index-1701741933156="76" data-index-1701741933156="137" data-index-len-1701741933156="137">系</span><span data-raw-text-1701741933156="列" data-textnode-index-1701741933156="76" data-index-1701741933156="138" data-index-len-1701741933156="138">列</span><span data-raw-text-1701741933156="教" data-textnode-index-1701741933156="76" data-index-1701741933156="139" data-index-len-1701741933156="139">教</span><span data-raw-text-1701741933156="程" data-textnode-index-1701741933156="76" data-index-1701741933156="140" data-index-len-1701741933156="140">程</span></span><span data-raw-text-1697268228246="】" data-textnode-index-1697268228246="0" data-index-1697268228246="15" data-index-len-1697268228246="15"><span data-raw-text-1701741933156="】" data-textnode-index-1701741933156="77" data-index-1701741933156="141" data-index-len-1701741933156="141">】</span></span><span data-raw-text-1697268228246="回" data-textnode-index-1697268228246="0" data-index-1697268228246="16" data-index-len-1697268228246="16"><span data-raw-text-1701741933156="回" data-textnode-index-1701741933156="78" data-index-1701741933156="142" data-index-len-1701741933156="142">回</span></span><span data-raw-text-1697268228246="顾" data-textnode-index-1697268228246="0" data-index-1697268228246="17" data-index-len-1697268228246="17"><span data-raw-text-1701741933156="顾" data-textnode-index-1701741933156="79" data-index-1701741933156="143" data-index-len-1701741933156="143">顾</span></span><span data-raw-text-1697268228246="：" data-textnode-index-1697268228246="0" data-index-1697268228246="18" data-index-len-1697268228246="18"><span data-raw-text-1701741933156="：" data-textnode-index-1701741933156="80" data-index-1701741933156="144" data-index-len-1701741933156="144">：</span></span></span></h1><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkzMzE5NTM4NA==&amp;mid=2247490431&amp;idx=1&amp;sn=8d9cf4db6377b4f5afff9fe40892137e&amp;chksm=c2516068f526e97e6bcadd938a345f137c32276d9eb322c64d0d0a807f6eb0050b3d43a9fa63&amp;scene=21#wechat_redirect" textvalue="系列教程：SIMBA（1）-单细胞多特征统一embedding-算法介绍" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">系列教程：SIMBA（1）-单细胞多特征统一embedding-算法介绍</a><br></p><p><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkzMzE5NTM4NA==&amp;mid=2247490469&amp;idx=1&amp;sn=8893ac036f982dc99732beef865e6ff7&amp;chksm=c25160b2f526e9a4eae804a6efc6ff9e0b1783890023bb984ba3b7f24ae8beb3f73ee3924ab3&amp;scene=21#wechat_redirect" textvalue="系列教程：SIMBA（2）-单细胞多特征统一embedding-scRNA-seq分析" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">系列教程：SIMBA（2）-单细胞多特征统一embedding-scRNA-seq分析</a><br></span></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkzMzE5NTM4NA==&amp;mid=2247490471&amp;idx=1&amp;sn=ba149e01dee92d5e49ce02d54a1422a8&amp;chksm=c25160b0f526e9a6ecbe8623c5e6335ebb33f3eef6764c980d33ee14260489b6f8cf1996470c&amp;scene=21#wechat_redirect" textvalue="系列教程：SIMBA（3）-单细胞多特征统一embedding-scATAC-seq分析" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">系列教程：SIMBA（3）-单细胞多特征统一embedding-scATAC-seq分析</a></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkzMzE5NTM4NA==&amp;mid=2247490543&amp;idx=1&amp;sn=258e31502a0cf76a73e7b3640a21bbc7&amp;chksm=c25160f8f526e9ee9674d38a2c354139bcb1af289b885a014e1ed7c264abea7ef337ee3f047a&amp;scene=21#wechat_redirect" textvalue="系列教程：SIMBA（4）-单细胞多特征统一embedding-双组学分析" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">系列教程：SIMBA（4）-单细胞多特征统一embedding-双组学分析</a><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span>文章简介</span></h2><p data-tool="mdnice编辑器">《SIMBA: single-cell embedding along with features》于今年5月29日发表在Nature Methods上。我们将用一期推送，介绍SIMBA的文章，然后使用6期推送，系统介绍SIMBA算法的相关应用，以及代码复现，<strong>包括scRNA-seq分析、scATAC-seq分析、scRNA+scATAC-seq分析、scRNA+scATAC-seq推断GRN</strong>、<strong>scRNA-seq批次效应校正和scRNA+scATAC-seq整合分析。</strong></p><hr data-tool="mdnice编辑器"><h2 data-tool="mdnice编辑器"><span></span><span>过去我们如何推断基因调控网络（GRN）</span></h2><p data-tool="mdnice编辑器">最早期，也是最简单的推断GRN的算法是基于<strong>加权基因共表达网络算法</strong>来推断GRN，这种算法它整个转录组范围内进行成对的相关性分析，以识别共表达基因模块。尽管这种策略有助于无监督地识别基因模块，但缺乏因果调控连接限制了其解释性，并且通常会产生大量的假阳性关联。</p><p data-tool="mdnice编辑器">再后来，GENIE3以及GRN-Boost方法首先以先验知识的方法从基因中识别出转录因子（TF），然后训练模型，仅基于转录因子的表达来预测目标基因的表达，从而显著减少了要考虑的相互作用数量。同时通过这样做，无向相互作用被转化为有向连接，从而引入了可能的因果关系。</p><p data-tool="mdnice编辑器">虽然基于bulk RNA-seq的方法可以有效推断出显著的GRN，但在混合样本（如组织）的情况下，它们无法捕捉到GRNs的细胞类型或状态特异性。<strong>单细胞测序使得细胞类型特异的TF-基因相互作用，以及这些GRNs在发育和条件下发生的动态变化推断成为可能。</strong></p><p data-tool="mdnice编辑器">然而，仅从转录组学数据进行推断会引入假阳性，因为许多参与基因调控的其他机制，如染色质可及性被忽略了。单细胞染色质可及性分析（如scATAC-seq）可与单细胞转录组学一起进行测序，双组学的结果可以更加有效地推断GRN。</p><p data-tool="mdnice编辑器">具体来说，它们<strong>从TF基因表达预测基因表达，利用结合Peaks信息将TF分配到开放的顺势调控元件（CREs），并将CREs与受基因组距离限制的目标基因联系起来</strong>。</p><p data-tool="mdnice编辑器">以上就是目前我们推断GRN的方法，不同方法之间大同小异，但是基本都是这套方法。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100007108" data-ratio="0.8083623693379791" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bSXgcPgTJ9m6tyjmEPFl2FFRicBVMFlVeW1LboYhXKibRNo0cQMAf9vW2UJ8K8Fcn6m1ZErMGuTGaA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="574" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bSXgcPgTJ9m6tyjmEPFl2FFRicBVMFlVeW1LboYhXKibRNo0cQMAf9vW2UJ8K8Fcn6m1ZErMGuTGaA/640?wx_fmt=png&amp;from=appmsg"></figure><hr data-tool="mdnice编辑器"><h2 data-tool="mdnice编辑器"><span></span><span>SIMBA如何推断GRN</span></h2><h3 data-tool="mdnice编辑器"><span></span><span></span><span>确定关键转录因子（TF）</span><span></span></h3><p data-tool="mdnice编辑器">为了先验地定义主调控因子，我们假定其 TF 基序和 TF 基因都应该是细胞类型特异性的，由于活性基因调控涉及 TF 的表达和其结合位点的可及性。因此，TF 基序和 TF 基因应该紧密嵌入在共享的embedding空间中。</p><p data-tool="mdnice编辑器">为了确定不同细胞类型的特异性的关键转录因子，对于每一个TF的motif，我们首先在embedding空间中计算它与其他所有基因的距离，<strong>然后我们可以得到这个TF的motif在所有基因（包括非TF基因）中的距离的排名</strong>，通过这个排名，我们可以衡量其显著性。排名越低，则TF和TF motif在embedding空间上的距离更加接近，则更加显著。</p><p data-tool="mdnice编辑器">此外，我们还可以使用SIMBA的相关指标鉴定细胞类型特异性的关键转录因子。</p><h3 data-tool="mdnice编辑器"><span></span><span></span><span>确定TF调控的靶基因</span><span></span></h3><p data-tool="mdnice编辑器">SIMBA根据以下假设确定TF调控的靶基因：（1）<strong>在共享的 SIMBA embedding空间中，靶基因接近 TF  motif和 TF 基因</strong>，表明靶基因的表达与 TF 的表达和 TF motif的可及性以细胞类型特异性的方式高度相关。<strong>（2）靶基因位点附近的可及区域(峰)必须接近 TF 基序和靶 TF 基因</strong>，表明靶基因位点附近的顺式调节元件的可及性与 TF 的表达和 TF 基序的可及性以细胞类型特异性的方式高度相关。</p><p data-tool="mdnice编辑器">对于一个给定的关键TF，SIMBA分别计算TF motif和TF周围k个（k=200）最近邻基因。这些相邻基因的交集是最初候选靶基因的集合，然后根据假定目标基因的 TSS 上游或下游100kb 内的开放区域(峰)必须含有 TF 基序的标准筛选这些基因。</p><p data-tool="mdnice编辑器">然后，对于每个候选靶基因，在 SIMBA 嵌入空间中计算4种类型的距离: (1)候选靶基因与 TF 基因的嵌入距离; (2)候选靶基因与 TF 基序的嵌入距离; (3)候选靶基因与 TF 基序基因座附近的峰值距离; (4)候选靶基因与候选基因基因座附近的峰值距离。所有的距离(默认的欧几里德距离)被转换为所有基因或所有峰值的等级，以使不同关键TF之间的计算得到距离具有可比性。</p><p data-tool="mdnice编辑器">目标基因的最终列表使用计算出的等级来决定，使用两个标准: (1)至少有一个与 TF 基因或 TF 基序最接近的峰在预定范围内(默认为前1,000个) ; 和(2)候选目标基因的平均等级在预定范围内(默认为前5,000个)。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100007109" data-ratio="0.9837251356238698" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bSXgcPgTJ9m6tyjmEPFl2F7aaHdhqp0Nnm1gDznlrZcolKab2De5gu9O0zYX4DR73Xl3grIS3sBQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="553" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bSXgcPgTJ9m6tyjmEPFl2F7aaHdhqp0Nnm1gDznlrZcolKab2De5gu9O0zYX4DR73Xl3grIS3sBQ/640?wx_fmt=png&amp;from=appmsg"></figure><hr data-tool="mdnice编辑器"><h2 data-tool="mdnice编辑器"><span></span><span>代码实战</span></h2><p data-tool="mdnice编辑器">首先我们下载SIMBA包及其依赖，导入这些包，并进行绘图参数设置</p><pre data-tool="mdnice编辑器"><code>!pip install git+https://github.com/pinellolab/simba_pbg.git<br>!pip install git+https://github.com/huidongchen/simba<br>import os <br>import simba as si<br><br>workdir = 'result_simba_atacseq'<br>si.settings.set_workdir(workdir)<br><br>si.settings.set_figure_params(dpi=80,<br>                              style='white',<br>                              fig_size=[5,5],<br>                              rc={'image.cmap': 'viridis'})<br><br># make plots prettier<br>from IPython.display import set_matplotlib_formats<br>set_matplotlib_formats('retina')<br></code></pre><p data-tool="mdnice编辑器">我们首先导入数据，adata_G代表生成的Gene的embedding，adata_M代表生成的Motif的embedding，而adata_cmp_CG和adata_cmp_CM则代表经过计算过相应指标的adata_G和adata_M，这些数据都是在第四次推送-多组学分析中计算得到的结果。</p><pre data-tool="mdnice编辑器"><code>adata_G = si.read_h5ad(os.path.join(workdir,'adata_G.h5ad'))<br>adata_M = si.read_h5ad(os.path.join(workdir,'adata_M.h5ad'))<br><br>adata_all = si.read_h5ad(os.path.join(workdir,'adata_all.h5ad'))<br><br>adata_cmp_CG = si.read_h5ad(os.path.join(workdir,'adata_cmp_CG.h5ad'))<br>adata_cmp_CM = si.read_h5ad(os.path.join(workdir,'adata_cmp_CM.h5ad'))<br></code></pre><p data-tool="mdnice编辑器">首先我们从这些数据中生成配对的Gene和Motif，这些配对的数据将被用于后续的下游分析。</p><pre data-tool="mdnice编辑器"><code># find paired TF motifs and TF genes<br>motifs_genes = pd.DataFrame(columns=['motif', 'gene'])<br>for x in adata_M.obs_names:<br>    x_split = x.split('_')<br>    for y in adata_G.obs_names:<br>        if y in x_split:<br>            motifs_genes.loc[motifs_genes.shape[0]] = [x,y]<br>            <br><br>print(motifs_genes.shape)<br>motifs_genes.head()<br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100007106" data-ratio="0.4420131291028446" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bSXgcPgTJ9m6tyjmEPFl2FqbyqYpYYlDDhqp9few70H9oHg8WPuhiaGF8Te5lFLWKWZbfgrN5ArHw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="457" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bSXgcPgTJ9m6tyjmEPFl2FqbyqYpYYlDDhqp9few70H9oHg8WPuhiaGF8Te5lFLWKWZbfgrN5ArHw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">我们提取出Gene和Motif的ID，以及这些feature的参数用于后续的分析。</p><pre data-tool="mdnice编辑器"><code>list_tf_motif = motifs_genes['motif'].tolist()<br>list_tf_gene = motifs_genes['gene'].tolist()<br><br>df_metrics_motif = adata_cmp_CM.var.copy()<br>df_metrics_gene = adata_cmp_CG.var.copy()<br></code></pre><p data-tool="mdnice编辑器">有了这些参数，<strong>我们就可以从adata_all文件里鉴定关键转录因子了</strong>，这里的adata_all就是双组学分析中所有特征的联合embedding。</p><p data-tool="mdnice编辑器">df_MR是一个dataframe，包含鉴定关键转录因子的函数计算出来的结果，即满足显著特异性的转录因子，此外也包含这些转录因子相应的指标信息，用于后续的分析。</p><pre data-tool="mdnice编辑器"><code>df_MR = si.tl.find_master_regulators(adata_all,<br>                                     list_tf_motif=list_tf_motif,<br>                                     list_tf_gene=list_tf_gene,<br>                                     cutoff_gene_max=1.5,<br>                                     cutoff_gene_gini=0.35,<br>                                     cutoff_motif_max=3,<br>                                     cutoff_motif_gini=0.7,<br>                                     metrics_gene=df_metrics_gene,<br>                                     metrics_motif=df_metrics_motif<br>                                    )<br><br>df_MR<br><br></code></pre><p data-tool="mdnice编辑器">接下来我们需要导入之前计算好的Peaks（adata_CP.h5ad）和K-mer（adata_PM.h5ad）的embedding，<strong>用于关键转录因子直接调节的基因的鉴定。</strong></p><pre data-tool="mdnice编辑器"><code>adata_CP = si.read_h5ad(os.path.join(workdir,'adata_CP.h5ad'))<br><br>adata_PM = si.read_h5ad(os.path.join(workdir,'adata_PM.h5ad'))<br>#make sure the indices of motifs are the same as in `motifs_genes`<br>adata_PM.var.index = 'M_' + adata_PM.var.index<br></code></pre><p data-tool="mdnice编辑器">为了减小计算量，这里我们手动指定用于后续计算直接调节的基因的关键转录因子，并计算其直接调节的基因。当然你要是对所有转录因子都感兴趣，你也可以都跑一遍。</p><p data-tool="mdnice编辑器">计算得到的dict_tf_targets是一个字典，键指的是关键转录因子的名字，而值则是这个关键转录因子直接调节的下游基因，且包含这些基因的顺序与显著性得分情况。</p><pre data-tool="mdnice编辑器"><code>master_regulators = ['Lef1', 'Hoxc13', 'Relb', 'Gata6', 'Nfatc1']<br>list_tf_motif = motifs_genes[np.isin(motifs_genes['gene'], master_regulators)]['motif'].tolist()<br>list_tf_gene = motifs_genes[np.isin(motifs_genes['gene'], master_regulators)]['gene'].tolist()<br><br># get the overlap between peaks and gene loci<br># the field `uns['gene_scores']['overlap']` will be added to adata_CP<br>_ = si.tl.gene_scores(adata_CP,genome='mm10',use_gene_weigt=True,use_top_pcs=False)<br><br>dict_tf_targets = si.tl.find_target_genes(adata_all,<br>                                          adata_PM,<br>                                          list_tf_motif=list_tf_motif,<br>                                          list_tf_gene=list_tf_gene,<br>                                          adata_CP=adata_CP,<br>                                          cutoff_gene=5000)<br><br></code></pre><p data-tool="mdnice编辑器">我们也可以手动查看关键转录因子直接调节的下游基因。</p><pre data-tool="mdnice编辑器"><code>dict_tf_targets['M_ENSMUSG00000001655_LINE1151_Hoxc13_D']<br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100007107" data-ratio="0.5153664302600472" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bSXgcPgTJ9m6tyjmEPFl2F61UbKfEx9ptLEabsErDuwboN4MueH8e6o013MuPCaicaElMtZaTG8RA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="846" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bSXgcPgTJ9m6tyjmEPFl2F61UbKfEx9ptLEabsErDuwboN4MueH8e6o013MuPCaicaElMtZaTG8RA/640?wx_fmt=png&amp;from=appmsg"></figure><hr data-tool="mdnice编辑器"><h2 data-tool="mdnice编辑器"><span></span><span>总结</span></h2><p data-tool="mdnice编辑器">本文介绍了SIMBA在解析基因调控网络中的应用，提供了实际操作的代码和相应的结果。作为小编，我很喜欢这篇文章用于推断基因调控网络的方法，我个人认为这篇文章的方法非常的直观，从前到后的逻辑非常的make sense，有很高的参考意义，值得大家学习。</p><p data-tool="mdnice编辑器">本文为《系列教程：SIMBA-单细胞多特征统一embedding》的第五篇文章，介绍了SIMBA在推断基因调控网络中的应用，在下一篇推送中，我们将介绍SIMBA在<strong>消除批次效应</strong>中的应用情况。<strong></strong></p></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/fEXomMV9_Q2JiXNwMvidFg",target="_blank" rel="noopener noreferrer">原文链接</a>
