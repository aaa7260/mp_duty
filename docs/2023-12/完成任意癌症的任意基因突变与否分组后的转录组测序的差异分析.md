---
title: "完成任意癌症的任意基因突变与否分组后的转录组测序的差异分析"
date: 2023-12-27T04:24:02Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
完成任意癌症的任意基因突变与否分组后的转录组测序的差异分析 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>一个月前（ <em>2023-12-01</em> ）的学徒作业：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526714&amp;idx=2&amp;sn=747b3efb692b4e808bc3db63ad4bb096&amp;scene=21#wechat_redirect" data-linktype="2">任意癌症的任意基因突变与否分组后的转录组测序的差异分析</a>，陆陆续续收到了一些反馈，有马拉松授课学员的也有学徒实习生的，发现<span>虽然说给大家指明了数据分析结题思路，但大家仍然是千奇百怪的错误。总体上就5个步骤，大家可以错十几处</span>：</p></blockquote><ul data-tool="mdnice编辑器"><li><section>从UCSC的XENA浏览器里面选择NSCLC的里面的LUAD数据集</section></li><li><section>然后下载LUAD的somatic的突变信息的maf文件</section></li><li><section>以及下载LUAD的表达量矩阵的counts文件</section></li><li><section>接着针对STK11基因把LUAD区分成为突变与否</section></li><li><section>最后根据STK11基因与否的分组信息进行差异分析，火山图和热图展示，富集分析等等</section></li></ul><h3 data-tool="mdnice编辑器"><span></span>两种maf文件处理方式<span></span></h3><p data-tool="mdnice编辑器">如何找到somatic的突变信息的maf文件，仍然是从UCSC的XENA浏览器里面选择NSCLC的里面的LUAD数据集即可，这个是网页里面的鼠标点击操作。值得注意的是网页里面关于同一个癌症有两个跳转链接哦（其中一个带有GDC的前缀）：</p><ul data-tool="mdnice编辑器"><li><section>[TCGA Lung Adenocarcinoma (LUAD)](https://xenabrowser.net/datapages/?cohort=TCGA Lung Adenocarcinoma (LUAD)&amp;removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443) (23 datasets)</section></li><li><section>[GDC TCGA Lung Adenocarcinoma (LUAD)](https://xenabrowser.net/datapages/?cohort=GDC TCGA Lung Adenocarcinoma (LUAD)&amp;removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443) (15 datasets)</section></li></ul><p data-tool="mdnice编辑器">首先可以看到不带GDC前缀的链接里面的突变主要是来源于mc3计划：</p><ul data-tool="mdnice编辑器"><li><section>https://tcga-xena-hub.s3.us-east-1.amazonaws.com/download/mc3_gene_level%2FLUAD_mc3_gene_level.txt.gz</section></li><li><section>TCGA Unified Ensemble "MC3" gene-level mutation calls. 1: non-silent mutation 0: wt</section></li></ul><p data-tool="mdnice编辑器">MC3（Multi-Center Mutation Calling in Multiple Cancers）计划则是TCGA（The Cancer Genome Atlas）项目中的一个子项目，专注于对多个癌症类型进行突变信息的分析和整理。以下是MC3计划的主要特点和工作内容：</p><ol data-tool="mdnice编辑器"><li><section><strong>突变信息整合：</strong> MC3计划旨在整合来自TCGA多个癌症类型的突变信息。这包括各种癌症样本中的单核苷酸变异（Single Nucleotide Variants，SNVs）、小型插入和缺失（Indels）等。</section></li><li><section><strong>标准化处理：</strong> 为了保证数据的一致性和可比性，MC3对从不同实验室和研究中心获得的数据进行了标准化处理。这涉及到对突变数据的质量控制、规范化和一致性检查。</section></li><li><section><strong>生物信息学方法：</strong> MC3采用了先进的生物信息学方法和工具，包括突变调用算法、数据处理流程等，以确保对基因组变异的准确和全面的分析。</section></li><li><section><strong>癌症类型涵盖：</strong> MC3覆盖了多个癌症类型，包括但不限于乳腺癌、肺癌、结肠癌等。这有助于研究者更全面地了解不同癌症类型的遗传变异。</section></li><li><section><strong>提供公共资源：</strong> MC3计划生成的数据被提供为公共资源，可以被科研机构、学者和生物信息学家免费使用。这种开放的数据共享有助于推动更广泛的癌症研究。</section></li><li><section><strong>突变谱分析：</strong> MC3对于突变的谱进行了分析，包括了基因的突变频率、突变类型的分布等，这对于了解癌症的遗传学机制和驱动突变具有重要意义。</section></li></ol><p data-tool="mdnice编辑器">有意思的是我读取这个MC3突变信息，发现本次作业涉及到的基因是没有的：</p><pre data-tool="mdnice编辑器"><span></span><code>mut= data.table::fread(<span>'input/mc3_gene_level_LUAD_mc3_gene_level.txt.gz'</span>,data.table = <span>F</span>)<br>mut[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>mut[mut$sample == <span>'STK11'</span>,]<br>mut[mut$sample == <span>'LKB1'</span>,]<br><br>&gt; mut[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>   sample TCGA-<span>05</span>-<span>4244</span>-<span>01</span> TCGA-<span>05</span>-<span>4249</span>-<span>01</span> TCGA-<span>05</span>-<span>4250</span>-<span>01</span><br><span>1</span>  UBE2Q2               <span>0</span>               <span>0</span>               <span>0</span><br><span>2</span>  CHMP1B               <span>0</span>               <span>0</span>               <span>0</span><br><span>3</span> PSMA2P1               <span>0</span>               <span>0</span>               <span>0</span><br><span>4</span>  SHQ1P1               <span>0</span>               <span>0</span>               <span>0</span><br><br>&gt; mut$sample[which.max(rowSums(mut[,-<span>1</span>]))]<br>[<span>1</span>] <span>"TP53"</span><br></code></pre><p data-tool="mdnice编辑器">大概率是因为这个MC3计划过于严格，过滤了绝大部分基因。不过突变病人数量最多的仍然是TP53基因，说明这个MC3信息本身是值得信赖的。</p><p data-tool="mdnice编辑器">其次可以看到那个带GDC的链接进去就有4个不同的软件产出的somatic突变信息，如下所示 ：</p><p><img data-galleryid="" data-imgfileid="100043577" data-ratio="0.4648148148148148" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzRGe0fyHIhD2a8vARyicm0QOsto0YexoD2kUvBJ2vQ1picw1VIt1FxwfV2BJ7qTarI8blwfhCCeSZA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzRGe0fyHIhD2a8vARyicm0QOsto0YexoD2kUvBJ2vQ1picw1VIt1FxwfV2BJ7qTarI8blwfhCCeSZA/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>4个不同的软件</figcaption></figure><p data-tool="mdnice编辑器">我在生信技能树发布的很多 <strong>找somatic mutation教程大概率是都过时</strong>了，如下：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247484967&amp;idx=1&amp;sn=1f4d549a10f641bf3ad34db4ad57c09f&amp;scene=21#wechat_redirect" data-linktype="2">TCGA计划的4个找somatic mutation的软件使用体验</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247485033&amp;idx=1&amp;sn=eb9865b92879e20c4afe285aeb8dc73c&amp;scene=21#wechat_redirect" data-linktype="2">肿瘤全外显子测序数据分析流程大放送</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247485061&amp;idx=1&amp;sn=5b1db56f520c3b69c89de6ee2e8d1782&amp;scene=21#wechat_redirect" data-linktype="2">肿瘤空间异质性探究</a></section></li></ul><p data-tool="mdnice编辑器">毕竟是六年多过去了，然后在<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247496179&amp;idx=2&amp;sn=ad63699e220dd469765d2181eb0cdd86&amp;scene=21#wechat_redirect" data-linktype="2">最新最全的mutect2教程</a><span>，提到了其实大家不必在一棵树上吊死，而且如果是TCGA这样的公共数据集大概率是不需要自己从零开始处理fq文件后拿到<strong>somatic mutation信息。</strong></span></p><p data-tool="mdnice编辑器">直接下载即可，比如这个时候我们测试了muse这个软件的结果文件；</p><pre data-tool="mdnice编辑器"><span></span><code>mut= data.table::fread(<span>'input/TCGA-LUAD.muse_snv.tsv.gz'</span>,data.table = <span>F</span>)<br>mut[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br><span># somatic，4个软件，交集很少。。。</span><br><span># 样品采集，送样，测序，到软件，参数，玄学。。。。</span><br><span># maftools  </span><br>mutSid = mut$Sample_ID[mut$gene==<span>'STK11'</span>]<br>head(mutSid)<br><br>&gt; mut[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>         Sample_ID     gene chrom    start<br><span>1</span> TCGA-<span>35</span>-<span>4122</span>-01A     AGRN  chr1  <span>1046540</span><br><span>2</span> TCGA-<span>35</span>-<span>4122</span>-01A   PRDM16  chr1  <span>3412324</span><br><span>3</span> TCGA-<span>35</span>-<span>4122</span>-01A PRAMEF11  chr1 <span>12825031</span><br><span>4</span> TCGA-<span>35</span>-<span>4122</span>-01A PRAMEF20  chr1 <span>13418296</span><br><br>&gt; head(mutSid)<br>[<span>1</span>] <span>"TCGA-44-7669-01A"</span> <span>"TCGA-44-7671-01A"</span> <br></code></pre><p data-tool="mdnice编辑器">可以看到的是已经是可以获取到那些有STK11基因突变的肺癌患者的id啦。</p><h3 data-tool="mdnice编辑器"><span></span>表达量矩阵的处理<span></span></h3><p data-tool="mdnice编辑器">仍然是从UCSC的XENA浏览器里面选择NSCLC的里面的LUAD数据集即可，值得注意的是选择带gdc前缀的哦，如下所示：</p><ul data-tool="mdnice编辑器"><li><section>log2(count+1)</section></li><li><section>https://gdc-hub.s3.us-east-1.amazonaws.com/download/TCGA-LUAD.htseq_counts.tsv.gz</section></li></ul><p data-tool="mdnice编辑器">其实也是可以根据上面的网页链接的规律去获取所有的其它癌症的下载链接啦，然后就是读取TCGA-LUAD.htseq_counts.tsv.gz文件后的简单的处理，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 魔幻操作，一键清空</span><br>rm(list = ls()) <br>options(stringsAsFactors = <span>F</span>)<br><span>library</span>(data.table)<br>a1=fread( <span>'TCGA-LUAD.htseq_counts.tsv.gz'</span> , <br>          data.table = <span>F</span>) <br>mat= a1[,<span>2</span>:ncol(a1)]  <br>mat=mat[<span>1</span>:(nrow(a1)-<span>4</span>),]<br>ensembl_matrix=ceiling(<span>2</span>^(mat)-<span>1</span>) <span>#log2(x+1) transformed. </span><br>rownames(ensembl_matrix) = gsub(<span>'[.][0-9]+'</span>,<span>''</span>,a1$Ensembl_ID[<span>1</span>:(nrow(a1)-<span>4</span>)])<br><span>library</span>(AnnoProbe) <br>ids=annoGene(rownames(ensembl_matrix),<span>'ENSEMBL'</span>,<span>'human'</span>) <br>ids=ids[!duplicated(ids$SYMBOL),]<br>ids=ids[!duplicated(ids$ENSEMBL),]<br>symbol_matrix= ensembl_matrix[match(ids$ENSEMBL,<br>                                    rownames(ensembl_matrix)),] <br>rownames(symbol_matrix) = ids$SYMBOL <br>save(symbol_matrix,file = <span>'symbol_matrix.Rdata'</span>) <br></code></pre><h3 data-tool="mdnice编辑器"><span></span>分组后差异分析<span></span></h3><p data-tool="mdnice编辑器">需要根据突变信息对上面的表达量矩阵进行分组，所以是：</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls()) <br><span>library</span>(data.table)<br>load(file = <span>'input/symbol_matrix.Rdata'</span>) <br>group_list=ifelse(substring(colnames(symbol_matrix),<span>14</span>,<span>15</span>)==<span>'11'</span>,<br>                  <span>'control'</span>,<span>'case'</span> )<br>table(group_list)<br>group_list = factor(group_list,levels = c(<span>'control'</span>,<span>'case'</span> ))<br>symbol_matrix=symbol_matrix[,group_list==<span>'case'</span>]<br><br>kp= !colnames(symbol_matrix) %<span>in</span>% unique(substring(mut$Sample_ID,<span>1</span>,<span>15</span>))<br>table(kp)<br>symbol_matrix=symbol_matrix[,kp]<br>group_list = ifelse(colnames(symbol_matrix) %<span>in</span>% mutSid,<span>'case'</span>,<span>'control'</span>)<br>table(group_list) <br>save(symbol_matrix,group_list,file = <span>'symbol_matrix.Rdata'</span>) <br></code></pre><p data-tool="mdnice编辑器">有了表达量矩阵和分组信息，差异分析就是常规代码即可：</p><pre data-tool="mdnice编辑器"><span></span><code>exprSet = symbol_matrix <br>(colData &lt;- data.frame(row.names=colnames(exprSet), <br>                       group_list=group_list) )<br>dds &lt;- DESeqDataSetFromMatrix(countData = exprSet,<br>                              colData = colData,<br>                              design = ~ group_list)<br>dds &lt;- DESeq(dds) <br>res &lt;- results(dds, <br>               contrast=c(<span>"group_list"</span>,<br>                          levels(group_list)[<span>2</span>],<br>                          levels(group_list)[<span>1</span>]))<br>resOrdered &lt;- res[order(res$padj),]<br>head(resOrdered)<br>DEG =as.data.frame(resOrdered)<br>DEG_deseq2 = na.omit(DEG)<br>   <br>save(DEG_deseq2, <br>     file =  <span>'DEG_deseq2.Rdata'</span> ) <br></code></pre><p data-tool="mdnice编辑器"><span><strong>大家赶快使用上面的代码去测试一下其它癌症吧，任意癌症的任意基因突变与否分组都可以。</strong></span></p><h3 data-tool="mdnice编辑器"><span></span>其它看癌症突变全景图的方式<span></span></h3><p data-tool="mdnice编辑器">下面的网页链接里面的癌症的缩略词替换即可访问任意癌症的突变全景图：</p><ul data-tool="mdnice编辑器"><li><section>http://firebrowse.org/iCoMut/?cohort=LAML</section></li></ul><p data-tool="mdnice编辑器">但是突变本身有很多不同的概念，germline和somatic，snv和indel，而且snv还根据是否影响蛋白质细分很多不同肿瘤。</p><ol data-tool="mdnice编辑器"><li><section><strong>Germline 和 Somatic 变异：</strong></section></li></ol><ul><li><section><strong>Germline 变异：</strong> 这些变异存在于生物个体的生殖细胞中（例如卵子和精子），并因此可以传递给后代。Germline 变异通常在个体的整个生命周期中存在，并影响其全部细胞。它们是个体遗传信息的一部分。</section></li><li><section><strong>Somatic 变异：</strong> 这些变异发生在个体的非生殖细胞（体细胞）中，只会影响个体的一部分细胞，而不会被传递给后代。Somatic 变异通常与<strong>癌症等疾病的发生有关</strong>，因为它们可能导致细胞生长和分裂的异常。</section></li></ul><li><section><strong>SNV 和 Indel：</strong></section></li><ul><li><section><strong>SNV（Single Nucleotide Variant）：</strong> 这是指单个核苷酸的变异，例如由于一个碱基被替换为另一个碱基而引起的变异。SNV 可以是点突变，包括单核苷酸替代、插入或缺失。</section></li><li><section><strong>Indel（Insertion/Deletion）：</strong> 这是指插入或删除一个或多个核苷酸的变异。Indel 可能导致基因框架的移位，影响蛋白质编码的读框，从而产生功能性影响。</section></li></ul><li><section><strong>蛋白质影响的 SNV 分类：</strong></section></li><ul><li><section><strong>Missense 变异：</strong> 单个氨基酸被替换为另一个氨基酸，这可能影响蛋白质功能。</section></li><li><section><strong>Nonsense 变异：</strong> 这种变异导致一个氨基酸被提前终止，导致蛋白质合成中止，通常会导致非功能性蛋白质的产生。</section></li><li><section><strong>Frameshift 变异：</strong> 插入或删除核苷酸导致读框发生改变，通常导致蛋白质合成的严重改变。</section></li><li><section><strong>Silent 变异：</strong> 核苷酸改变，但不会改变相应氨基酸的残基。</section></li></ul></section><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247527207&amp;idx=1&amp;sn=fb9ca814003fc24e9ec8b1bcecbd1d56&amp;chksm=9b4b2b9cac3ca28afc5b68047e5f0587b6636d52879051decd573009e38313c5f7d6b0d1927d&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授课（买一得‍五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课，春节前最后一次</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247522831&amp;idx=2&amp;sn=1744efdf428465425a145ff3a982198b&amp;chksm=9b4bdab4ac3c53a28fbecbbff4f254f470b54a7a20468bb753b295b930315e1ec45bcbabc10b&amp;scene=21#wechat_redirect" textvalue="144线程640Gb内存服务器共享一年‍仍然是仅需800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">144线程640Gb内存服务器共享一年仍然是仅需800</a></section></li></ul><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/ylbEAXo_8RMp0TA6JTvaMg",target="_blank" rel="noopener noreferrer">原文链接</a>
