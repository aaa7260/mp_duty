---
title: "单细胞文章复现-抗PD-1免疫治疗联合雄激素剥夺治疗可诱导转移性去势敏感前列腺癌的强免疫浸润"
date: 2023-12-11T00:46:38Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
单细胞文章复现-抗PD-1免疫治疗联合雄激素剥夺治疗可诱导转移性去势敏感前列腺癌的强免疫浸润 by 生信菜鸟团
------
<div><section><p>首先下载数据<br>https://data.mendeley.com/datasets/5nnw8xrh5m/1<br></p><figure><img data-imgfileid="100034684" data-ratio="0.2638888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXbfIuhbfQF3TP8Veg5DDIoJLhd5KRj7TsdMc7Ip0fyA4OA7MgXGPoKQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXbfIuhbfQF3TP8Veg5DDIoJLhd5KRj7TsdMc7Ip0fyA4OA7MgXGPoKQ/640?wx_fmt=png&amp;from=appmsg"></figure><br>记得先通读全文，虽然可以按照自己的方式做出来结果，但一不小心就会认为作者的样本血细胞污染，注释成上皮细胞，pDC注释成B细胞。但实际上作者考虑到了这个问题，使用了其他的注释方式。<br>①首先看看文中直接使用基因表达注释的细胞群<p><br></p><pre><code>rm(list=ls())<br>options(stringsAsFactors = F) <br>library(Seurat)<br>library(ggplot2)<br>library(clustree)<br>library(cowplot)<br>library(dplyr)<br><br><span>###### step1:导入数据 ######   </span><br>library(data.table)<br>scRNA=readRDS(<span>"primecut.integrated.geneexp.seurat.rds"</span>)<br>table(scRNA@meta.data$orig.ident)  <span>#查看每个样本的细胞数</span><br>head(scRNA@meta.data)<br>meta = scRNA@meta.data<br>colnames(meta)<br>table(meta$orig.ident)<br>table(meta$patient)<br>table(meta$treatment)<br>table(meta$tissue)<br>table(meta$hpca_labels)<br>table(meta$hpca_main_labels)<br>table(meta$blueprint_labels)<br>table(meta$blueprint_main_labels)<br><br>library(ggplot2) <br>sce.all = UpdateSeuratObject(object = scRNA)<br>table(Idents(sce.all))  <br>sce.all$celltype = Idents(sce.all)<br><br>mycolors &lt;-c(<span>'#E5D2DD'</span>, <span>'#53A85F'</span>, <span>'#F1BB72'</span>, <span>'#F3B1A0'</span>, <span>'#D6E7A3'</span>, <span>'#57C3F3'</span>, <span>'#F7F398'</span>,<br>                        <span>'#E95C59'</span>, <span>'#E59CC4'</span>, <span>'#AB3282'</span>, <span>'#91D0BE'</span>, <span>'#BD956A'</span>, <span>'#8C549C'</span>, <span>'#585658'</span>,<br>                        <span>'#9FA3A8'</span>, <span>'#E0D4CA'</span>, <span>'#5F3D69'</span>, <span>'#C5DEBA'</span>, <span>'#58A4C3'</span>, <span>'#E4C755'</span>, <br>                        <span>'#AA9A59'</span>, <span>'#E63863'</span>, <span>'#E39A35'</span>, <span>'#C1E6F3'</span>, <span>'#6778AE'</span>,  <span>'#B53E2B'</span>,<br>                        <span>'#712820'</span>, <span>'#DCC1DD'</span>, <span>'#CCE0F5'</span>,  <span>'#CCC9E6'</span>,  <span>'#68A180'</span>, <br>                        <span>'#968175'</span>)<br><br>DimPlot(sce.all, reduction = <span>"umap"</span>,<span>split</span>.by = <span>'orig.ident'</span>,<br>        group.by = <span>"celltype"</span>,label = T,cols = mycolors) <br></code></pre><figure><img data-imgfileid="100034687" data-ratio="0.7685185185185185" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXpicRyg5ia9uME1ELgvDDVt9KMibGbUtjbvnJ029Y0JogBhB2OPNxibE2ibg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXpicRyg5ia9uME1ELgvDDVt9KMibGbUtjbvnJ029Y0JogBhB2OPNxibE2ibg/640?wx_fmt=png&amp;from=appmsg"></figure><br>可以看到注释到一个上皮细胞，文中直接使用的SingleR，看看注释结果怎么样<p><br></p><pre><code>p &lt;- DotPlot(sce.all, features = genes_to_check,<br>             assay=<span>'RNA'</span> ,<span>group</span>.<span>by</span> = <span>'integrated_snn_res0.8'</span> )  + coord_flip()<br><br>p<br></code></pre><figure><img data-imgfileid="100034685" data-ratio="0.6398148148148148" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXnkibFYjPhRRPUHsDokHLT77cDhyDC10URSDO6RUmrBXgzZiaTlNlyysA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXnkibFYjPhRRPUHsDokHLT77cDhyDC10URSDO6RUmrBXgzZiaTlNlyysA/640?wx_fmt=png&amp;from=appmsg"></figure><pre><code>p1 <span>&lt;<span>-</span> <span>DotPlot</span>(<span>sce.all</span>, <span>features</span> = <span>genes_to_check,</span><br>              <span>assay</span>=<span>'RNA'</span> ,<span>group.by</span> = <span>'seurat_clusters'</span> ) +<br>  <span>coord_flip</span>() +<br>  <span>theme</span>(<span>axis.text.x</span> = <span>element_text(angle</span> = <span>45,</span> <span>hjust</span> = <span>1))</span><br><br><span>p1</span><br></span></code></pre><p>注释亚群的基因表达相符<br></p><figure><img data-imgfileid="100034686" data-ratio="0.637962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXibwme9us6iblXy7F9HJrwHInhnciajCxSDqUtu8yQia33u5Y5a0O0qPvRg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXibwme9us6iblXy7F9HJrwHInhnciajCxSDqUtu8yQia33u5Y5a0O0qPvRg/640?wx_fmt=png&amp;from=appmsg"></figure><pre><code><span>#2.热图</span><br><span>#remotes::install_github(repo = 'genecell/COSGR')</span><br>library(COSG)<br>marker_cosg &lt;- cosg(<br>  sce.all,<br>  groups=<span>'all'</span>,<br>  assay=<span>'RNA'</span>,<br>  slot=<span>'data'</span>,<br>  mu=<span>1</span>,<br>  n_genes_user=<span>30</span>)<br><br>top_genes &lt;- marker_cosg$names<br>table(gene %in% rownames(sce.all))<br>gene &lt;- unlist(lapply(top_genes, <span><span>function</span><span>(x)</span> <span>head</span><span>(intersect<span>(x, rownames<span>(sce.all)</span>)</span>, <span>5</span>)</span>))<br><br><span>DoHeatmap</span><span>(subset<span>(sce.all,downsample=<span>200</span>)</span>,gene,size=<span>3</span>)</span>+<span>scale_fill_gradientn</span><span>(colors=c<span>(<span>"#94C4E1"</span>,<span>"white"</span>,<span>"red"</span>)</span>)</span><br></span></code></pre><p>注释的还可以的，说明singleR值得一用呀<br></p><figure><img data-imgfileid="100034688" data-ratio="0.6351851851851852" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXldAUMxQV2RXmwcHHKs6C2OXKarYNafyUk2fSUnIWmrJtOLDMqVwnNA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXldAUMxQV2RXmwcHHKs6C2OXKarYNafyUk2fSUnIWmrJtOLDMqVwnNA/640?wx_fmt=png&amp;from=appmsg"></figure><br>但是文中突然就来这么一段话，scRNA达不到分析需求，所以用了VIPER(Virtual Inference of Protein-activity by Enriched Regulon analysis)算法，允许在单个样本的基础上，<strong>从基因表达谱数据计算蛋白质活性推断</strong>。它利用最直接受特定蛋白质调控的基因表达，如转录因子(TF)的靶标，作为其活性的准确推断手段。<em>大佬说的对大佬想咋样就咋样（小声bb：不会是正常分析分析不出什么花来了吧</em><blockquote><p>Due to high gene dropout levels, scRNA-seq analyses can typically monitor ~20% of all genes in each cell. To address this issue, we utilized an established single cell analysis pipeline,which leverages the <em>VIPER algorithm</em> to measure protein activity from single-cell gene expression data. By assessing protein activity based on the expression of 100 transcriptional targets of each protein, VIPER significantly mitigates gene dropout effects, thus allowing detection of proteins whose encoding gene is completely undetected.</p></blockquote><pre><code>rm(list=ls())<br>options(stringsAsFactors = F) <br>library(Seurat)<br>library(ggplot2)<br>library(clustree)<br>library(cowplot)<br>library(dplyr)<br><br><span>###### step1:导入数据 ######   </span><br>library(data.table)<br>scRNA=readRDS(<span>"primecut.integrated.VIPER.Seurat.rds"</span>)<br>table(scRNA@meta.data$orig.ident)  <span>#查看每个样本的细胞数</span><br>head(scRNA@meta.data)<br>meta = scRNA@meta.data<br>colnames(meta)<br>table(meta$orig.ident)<br>table(meta$patient)<br>table(meta$treatment)<br>table(meta$tissue)<br>table(meta$blueprint_labels)<br>table(meta$original_seurat_clusters)<br><br>library(ggplot2) <br>sce.all = UpdateSeuratObject(object = scRNA)<br>table(Idents(sce.all))  <br>sce.all$celltype = Idents(sce.all)<br><br>mycolors &lt;-c(<span>'#E5D2DD'</span>, <span>'#53A85F'</span>, <span>'#F1BB72'</span>, <span>'#F3B1A0'</span>, <span>'#D6E7A3'</span>, <span>'#57C3F3'</span>, <span>'#F7F398'</span>,<br>                      <span>'#E95C59'</span>, <span>'#E59CC4'</span>, <span>'#AB3282'</span>, <span>'#91D0BE'</span>, <span>'#BD956A'</span>, <span>'#8C549C'</span>, <span>'#585658'</span>,<br>                      <span>'#9FA3A8'</span>, <span>'#E0D4CA'</span>, <span>'#5F3D69'</span>, <span>'#C5DEBA'</span>, <span>'#58A4C3'</span>, <span>'#E4C755'</span>, <br>                      <span>'#AA9A59'</span>, <span>'#E63863'</span>, <span>'#E39A35'</span>, <span>'#C1E6F3'</span>, <span>'#6778AE'</span>,  <span>'#B53E2B'</span>,<br>                      <span>'#712820'</span>, <span>'#DCC1DD'</span>, <span>'#CCE0F5'</span>,  <span>'#CCC9E6'</span>,  <span>'#68A180'</span>, <br>                      <span>'#968175'</span>)<br><br>DimPlot(sce.all, reduction = <span>"umap"</span>,<span>split</span>.by = <span>'orig.ident'</span>,<br>        group.by = <span>"celltype"</span>,label = T,cols = mycolors) <br></code></pre><figure><img data-imgfileid="100034692" data-ratio="0.6398148148148148" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXiarBHu36fJgKK2APdj4AfUZG3zaNQYsWhIgzudbEn1TaRj0ibHHuITyA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXiarBHu36fJgKK2APdj4AfUZG3zaNQYsWhIgzudbEn1TaRj0ibHHuITyA/640?wx_fmt=png&amp;from=appmsg"></figure><br>SingleR不提供肿瘤细胞与正常细胞的分类；具有上皮起源的肿瘤细胞，如前列腺癌细胞，被标记为“上皮细胞”。根据前列腺肿瘤标志物基因（如KLK3）的表达，以及使用淋巴细胞和髓系细胞作为拷贝数正常参考的推断拷贝数变异分析，确认三群上皮细胞均为肿瘤细胞。<br><figure><img data-imgfileid="100034689" data-ratio="0.23580786026200873" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXVbTuGfYliaAAlF7COU0eXIvXmiaBLGhYTR2hHUTnBhMNE4K8X5lwmImw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="916" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXVbTuGfYliaAAlF7COU0eXIvXmiaBLGhYTR2hHUTnBhMNE4K8X5lwmImw/640?wx_fmt=png&amp;from=appmsg"></figure><br>真的假的，我下载作者提供的Rdata，这基因竟然没有。<br>我很迷，文中自带的处理数据的代码和文献表格对不上。<br><figure><img data-imgfileid="100034690" data-ratio="0.32592592592592595" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXNVBmsqicib8RXj3MH3N4wfPEZ12yIpCt8nOxljBRd2k8kxhib064DQTGQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXNVBmsqicib8RXj3MH3N4wfPEZ12yIpCt8nOxljBRd2k8kxhib064DQTGQ/640?wx_fmt=png&amp;from=appmsg"></figure><br><figure><img data-imgfileid="100034691" data-ratio="0.45092592592592595" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXVSwuhNfLkrnMCkJXdwDH3MSTKC2aKXXpqrxCRBE15oibs7Hib2Oa6MfA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXVSwuhNfLkrnMCkJXdwDH3MSTKC2aKXXpqrxCRBE15oibs7Hib2Oa6MfA/640?wx_fmt=png&amp;from=appmsg"></figure><br>我这里的处理是文中提供的数据，也得不到文中的结果😂比例图这种完全不需要改变的也对不上。原文基线期3个患者骨转移，2个患者肝转移，2个患者淋巴结转移，1个患者肺转移。<br><figure><img data-imgfileid="100034693" data-ratio="0.7350597609561753" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXLYDmbpMOgThwAboy1yyLH9sTHTWKXb7sqn7ib4sWRBbUoa3ZSxJowkA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1004" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXLYDmbpMOgThwAboy1yyLH9sTHTWKXb7sqn7ib4sWRBbUoa3ZSxJowkA/640?wx_fmt=png&amp;from=appmsg"></figure><br>文中提供的数据筛选基线期<p><br></p><pre><code>table(sce.all$treatment)<br>sce = sce.all<br><br>library(tidyr)<br>library(reshape2)<br>colnames(meta)<br>table(sce$patient)<br>table(sce$tissue)<br>table(sce$tissue, sce$patient)<br>meta = sce@meta.data<br>colnames(meta)<br>table(meta$orig.ident)<br>table(meta$patient)<br>table(meta$treatment)<br>table(meta$tissue)<br>table(meta$blueprint_labels)<br>table(meta$original_seurat_clusters)<br><br>sce$intecelltype = <span>'NA'</span><br>sce$intecelltype[sce$celltype %in% c(<span>'CD4 T-cell 1'</span>,<span>'CD4 T-cell 2'</span>) ] = <span>'CD4nonTreg'</span><br>sce$intecelltype[sce$celltype %in% c(<span>'CD4 T-cell 1'</span>,<span>'CD4 T-cell 2'</span>) ] = <span>'CD4nonTreg'</span><br>sce$intecelltype[sce$celltype %in% c(<span>'CD8 T-cell 1'</span>,   <span>'CD8 T-cell 2'</span>,  <span>'CD8 T-cell 3'</span>) ] = <span>'CD8'</span><br>sce$intecelltype[sce$celltype %in% c(<span>'B-cells 1'</span>, <span>'B-cells 2'</span>,<span>'B-cells 3'</span>,<span>'B-cells 4'</span>,<span>'B-cells 5'</span>,<span>'Plasma cells'</span>) ] = <span>'B-cell'</span><br>sce$intecelltype[sce$celltype %in% c(<span>'Treg 3'</span>,<span>'Treg 2'</span>,<span>'Treg 1'</span>) ] = <span>'Treg'</span><br>sce$intecelltype[sce$celltype %in% c(<span>'Epithelial 3'</span>,<span>'Epithelial 2'</span>,<span>'Epithelial 1'</span>) ] = <span>'Tumor'</span><br>sce$intecelltype[sce$celltype %in% c(<span>'Endothelial'</span>) ] = <span>'Endothelial'</span><br>sce$intecelltype[sce$celltype %in% c(<span>'Erythrocytes 1'</span>) ] = <span>'Erythrocytes'</span><br>sce$intecelltype[sce$celltype %in% c(<span>'Monocytes 1'</span>, <span>'Monocytes 2'</span>, <span>'Macrophages'</span>, <span>'Monocytes 3'</span>,<span>'Neutrophils'</span>) ] = <span>'Myeloid'</span><br>table(sce$intecelltype)<br><br>sce_pre = sce[, sce$treatment %in% c( <span>"Pre-Treatment"</span> )]<br>table(sce_pre$tissue, sce_pre$patient)<br></code></pre><p>就得到了基线期3个患者骨转移，2个患者肝转移，3个患者淋巴结转移，1个患者肺转移。为什么会多出来一个患者，明明文中也写的是8个基线期患者，我哪里出了问题<br></p><figure><img data-imgfileid="100034694" data-ratio="0.15555555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXicrEFI4NBVKkk7lYwic9etibYwk5hCNbG9caUiaEPuBkyKoEF70yiavGD1g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXicrEFI4NBVKkk7lYwic9etibYwk5hCNbG9caUiaEPuBkyKoEF70yiavGD1g/640?wx_fmt=png&amp;from=appmsg"></figure><br><figure><img data-imgfileid="100034696" data-ratio="0.37222222222222223" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXXjBicAfKyUX8zN4qlIkGHERgKkZjiclENuibypFCdj0XJOQPoBS70QpAQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXXjBicAfKyUX8zN4qlIkGHERgKkZjiclENuibypFCdj0XJOQPoBS70QpAQ/640?wx_fmt=png&amp;from=appmsg"></figure><pre><code>sce_pre$group = <span>'NA'</span><br>sce_pre$group[sce_pre$tissue == <span>'Bone'</span>&amp;sce_pre$patient == <span>'Patient1'</span>] = <span>'Bone1'</span><br>sce_pre$group[sce_pre$tissue == <span>'Bone'</span>&amp;sce_pre$patient == <span>'Patient3'</span>] = <span>'Bone2'</span><br>sce_pre$group[sce_pre$tissue == <span>'Bone'</span>&amp;sce_pre$patient == <span>'Patient8'</span>] = <span>'Bone3'</span><br>sce_pre$group[sce_pre$tissue == <span>'Liver'</span>&amp;sce_pre$patient == <span>'Patient13'</span>] = <span>'Liver1'</span><br>sce_pre$group[sce_pre$tissue == <span>'Liver'</span>&amp;sce_pre$patient == <span>'Patient14'</span>] = <span>'Liver2'</span><br>sce_pre$group[sce_pre$tissue == <span>'LN'</span>&amp;sce_pre$patient == <span>'Patient10'</span>] = <span>'LN1'</span><br>sce_pre$group[sce_pre$tissue == <span>'LN'</span>&amp;sce_pre$patient == <span>'Patient11'</span>] = <span>'LN2'</span><br>sce_pre$group[sce_pre$tissue == <span>'LN'</span>&amp;sce_pre$patient == <span>'Patient5'</span>] = <span>'LN3'</span><br>sce_pre$group[sce_pre$tissue == <span>'Lung'</span>&amp;sce_pre$patient == <span>'Patient7'</span>] = <span>'Lung'</span><br>table(sce_pre$group)<br><br>tb=table(sce_pre$group, sce_pre$intecelltype)<br>head(tb)<br>library (gplots) <br>balloonplot(tb)<br>bar_data &lt;- as.data.frame(tb)<br><br>bar_per &lt;- bar_data %&gt;% <br>  group_by(Var1) %&gt;%<br>  mutate(sum(Freq)) %&gt;%<br>  mutate(percent = Freq / <span>`sum(Freq)`</span>)<br>head(bar_per) <br>col =c(<span>"#3176B7"</span>,<span>"#F78000"</span>,<span>"#3FA116"</span>,<span>"#CE2820"</span>,<span>"#9265C1"</span>,<br>                <span>"#885649"</span>,<span>"#DD76C5"</span>,<span>"#BBBE00"</span>,<span>"#41BED1"</span>)<br>colnames(bar_per)<br><br>p2 = ggplot(bar_per, aes(<span>x</span> = percent, <span>y</span> = Var1)) +<br>  geom_bar(aes(fill = Var2) , <span>stat</span> = <span>"identity"</span>) + coord_flip() +<br>  theme(axis.ticks = element_line(linetype = <span>"blank"</span>),<br>        legend.position = <span>"top"</span>,<br>        panel.grid.minor = element_line(colour = NA,linetype = <span>"blank"</span>), <br>        panel.background = element_rect(fill = NA),<br>        plot.background = element_rect(colour = NA)) +<br>  labs(<span>y</span> = <span>" "</span>, fill = NULL)+labs(<span>x</span> = <span>'Relative proportion(%)'</span>)+<br>  scale_fill_manual(<span>values</span>=col)+<br>  theme_classic()+<br>  theme(plot.title = element_text(size=<span>12</span>,hjust=<span>0</span>.<span>5</span>))<br><br>p2<br></code></pre><p>将最初的24个VIPER细胞群合并成8个细胞群。肺样本的基线活检主要由肿瘤细胞组成。相比之下，骨、肝和肺基线活检样本含有更大比例的免疫细胞。<br></p><figure><img data-imgfileid="100034697" data-ratio="0.7277777777777777" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXJgf0uuXcuia0fF4Q10coTfXyL3YicYeGtljnibu6I1Gdib61TlHG9YPgWg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXJgf0uuXcuia0fF4Q10coTfXyL3YicYeGtljnibu6I1Gdib61TlHG9YPgWg/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><pre><code><span>####分组箱线图</span><br>tb=table(sce_pre$group, sce_pre$celltype)<br>head(tb)<br>library (gplots) <br>balloonplot(tb)<br>bar_data &lt;- as.data.frame(tb)<br><br>bar_per &lt;- bar_data %&gt;% <br>  group_by(Var1) %&gt;%<br>  mutate(sum(Freq)) %&gt;%<br>  mutate(percent = Freq / <span>`sum(Freq)`</span>)<br>head(bar_per) <br><br>bar_per$group = <span>'NA'</span><br>bar_per$group[str_detect(bar_per$Var1,<span>'Bone'</span>)] = <span>'Bone'</span><br>bar_per$group[str_detect(bar_per$Var1,<span>'Liver'</span>)] = <span>'Liver'</span><br>bar_per$group[str_detect(bar_per$Var1,<span>'LN'</span>)] = <span>'LN'</span><br>bar_per$group[str_detect(bar_per$Var1,<span>'Lung'</span>)] = <span>'Lung'</span><br>table(bar_per$group)<br><br><br>ggplot(bar_per, aes(<span>x</span> = Var2, <span>y</span> = percent))+ <br>  labs(<span>y</span>=<span>"Cell Proportion"</span>, <span>x</span> =  NULL)+  <br>  geom_boxplot(aes(fill = group), position = position_dodge(<span>0</span>.<span>5</span>), width = <span>0</span>.<span>5</span>, outlier.alpha = <span>0</span>)+ <br>  scale_fill_manual(<span>values</span> = c( <span>"#3176B7"</span>,<span>"#F78000"</span>,<span>"#3FA116"</span>,<span>"#CE2820"</span>)) +<br>  theme_bw() + <br>  theme(plot.title = element_text(size = <span>12</span>,color=<span>"black"</span>,hjust = <span>0</span>.<span>5</span>), <br>        axis.text.x = element_text(angle = <span>45</span>, hjust = <span>1</span> ),<br>        panel.grid = element_blank(),<br>        legend.position = <span>"top"</span>,<br>        legend.text = element_text(size= <span>12</span>),<br>        legend.title= element_text(size= <span>12</span>)) + <br>  guides(fill=guide_legend(title = <span>"Tissue"</span>))<br></code></pre><p>在骨转移中，浆细胞相对于其他部位高度富集，单核细胞1和2亚型的表达增加。在所有组织中，CD8 T细胞和常规（非Treg）CD4细胞占很大比例。<br></p><figure><img data-imgfileid="100034695" data-ratio="0.4564814814814815" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXb49iaqGWBKsDmDw0HJy52400qkJibh04nTRzpP6498oFD8UGnwn29hVA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXb49iaqGWBKsDmDw0HJy52400qkJibh04nTRzpP6498oFD8UGnwn29hVA/640?wx_fmt=png&amp;from=appmsg"></figure>接下来看看不同组织来源的样本和不同治疗阶段样本的细胞亚群差异<p><br></p><pre><code>table(sce$treatment)<br>table(sce$tissue)<br>table(sce$intecelltype)<br>sce_bone = sce[, sce$tissue %in% c( <span>"Bone"</span> )]<br>sce_Liver = sce[, sce$tissue %in% c( <span>"Liver"</span> )]<br>sce_LN = sce[, sce$tissue %in% c( <span>"LN"</span> )]<br>sce_Lung = sce[, sce$tissue %in% c( <span>"Lung"</span> )]<br><br>DimPlot(sce_bone, reduction = <span>"umap"</span>, <span>split</span>.by = <span>'treatment'</span>, group.by = <span>"celltype"</span>, label = T, <br>             cols = mycolors)<br></code></pre><figure><img data-imgfileid="100034698" data-ratio="0.5185185185185185" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXjicmFAFFU2D4BpjoqGeu2PR0wXCkzVCzDtibiaOtzLnUbFDkibuADFMhew/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXjicmFAFFU2D4BpjoqGeu2PR0wXCkzVCzDtibiaOtzLnUbFDkibuADFMhew/640?wx_fmt=png&amp;from=appmsg"></figure><pre><code><span>##堆积柱状图</span><br>poplot = <span><span>function</span><span>(sce,title)</span></span>{<br><br>  table(sce$treatment)<br>  tb=table(sce$treatment, sce$intecelltype)<br>  head(tb)<br>  library (gplots) <br>  balloonplot(tb)<br>  bar_data &lt;- <span>as</span>.data.frame(tb)<br><br>  bar_per &lt;- bar_data %&gt;% <br>    group_by(Var1) %&gt;%<br>    mutate(sum(Freq)) %&gt;%<br>    mutate(percent = Freq / `sum(Freq)`)<br>  head(bar_per) <br>  bar_per = na.omit(bar_per)<br>  col =c(<span>"#3176B7"</span>,<span>"#F78000"</span>,<span>"#3FA116"</span>,<span>"#CE2820"</span>,<span>"#9265C1"</span>,<br>                  <span>"#885649"</span>,<span>"#DD76C5"</span>,<span>"#BBBE00"</span>,<span>"#41BED1"</span>)<br>                  colnames(bar_per)<br><br>                  p2 = ggplot(bar_per, aes(x = percent, y = Var1)) +<br>                    geom_bar(aes(fill = Var2) , stat = <span>"identity"</span>) + coord_flip() +<br>                    theme(axis.ticks = element_line(linetype = <span>"blank"</span>),<br>                          legend.position = <span>"top"</span>,<br>                          panel.grid.minor = element_line(colour = NA,linetype = <span>"blank"</span>), <br>                          panel.background = element_rect(fill = NA),<br>                          plot.background = element_rect(colour = NA)) +<br>                    labs(y = <span>" "</span>, fill = <span>NULL</span>)+labs(x = <span>'Relative proportion(%)'</span>)+<br>                    scale_fill_manual(values=col)+<br>                    theme_classic()+<br>                    ggtitle(title) +<br>                    theme(plot.title = element_text(size=<span>20</span>,hjust=<span>0.5</span>))<br><br>                  p2<br><br><br>}<br>poplot(sce_bone,<span>'Bone'</span>)<br></code></pre><p>在骨转移中，ADT诱导髓系细胞增加，CD4 T细胞以及肿瘤细胞减少。相比之下，ADT+aPD-1降低了髓系细胞，同时增加了CD8 T细胞，但是肿瘤细胞竟然也变多了。<br></p><figure><img data-imgfileid="100034701" data-ratio="0.6555555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXIKHD0WQCB0VV5AwTgjSVjqVQJwsE9dDhqc1iaW7XeK7jIo3NwtWicbdg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXIKHD0WQCB0VV5AwTgjSVjqVQJwsE9dDhqc1iaW7XeK7jIo3NwtWicbdg/640?wx_fmt=png&amp;from=appmsg"></figure><pre><code><span>###肝</span><br>DimPlot(sce_Liver, reduction = <span>"umap"</span>, split.<span>by</span> = <span>'treatment'</span>, <span>group</span>.<span>by</span> = <span>"celltype"</span>, label = T, <br>        cols = mycolors)<br></code></pre><figure><img data-imgfileid="100034702" data-ratio="0.5703703703703704" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXXPdZFbanlbb63waP1DG0GUMZMGrzmqTbBqHLqrPDalMsscIGBiaptuQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXXPdZFbanlbb63waP1DG0GUMZMGrzmqTbBqHLqrPDalMsscIGBiaptuQ/640?wx_fmt=png&amp;from=appmsg"></figure><pre><code>poplot(sce_Liver,<span>'Liver'</span>)<br></code></pre><p>内脏（肝脏和肺）的联合治疗后肿瘤细胞组成显著减少，髓系几乎没有变化，CD8 T细胞显著增加。<br></p><figure><img data-imgfileid="100034700" data-ratio="0.9287037037037037" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yX4BtZcuUJJt15wHd4w7aotIibpwphRLXnJhG3O3favO9gKycXZsoormw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yX4BtZcuUJJt15wHd4w7aotIibpwphRLXnJhG3O3favO9gKycXZsoormw/640?wx_fmt=png&amp;from=appmsg"></figure><pre><code><span># ###肺</span><br><span># DimPlot(sce_Lung, reduction = "umap", split.by = 'treatment', group.by = "celltype", label = T, </span><br><span>#         cols = mycolors)</span><br><span># </span><br><span># poplot(sce_Lung,'Lung')</span><br><br><br><span>###淋巴结</span><br>DimPlot(sce_LN, reduction = <span>"umap"</span>, split.<span>by</span> = <span>'treatment'</span>, <span>group</span>.<span>by</span> = <span>"celltype"</span>, label = T, <br>        cols = mycolors)<br><br>poplot(sce_LN,<span>'LN'</span>)<br></code></pre><figure><img data-imgfileid="100034699" data-ratio="0.9259259259259259" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXu1lic0OaAkyy7WibgKk86GM37SMdPP2xGbEsjIRtYNGhSibngPrjPukgQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8ib7fQg0RibY1P1bmQFlk0yXu1lic0OaAkyy7WibgKk86GM37SMdPP2xGbEsjIRtYNGhSibngPrjPukgQ/640?wx_fmt=png&amp;from=appmsg"></figure><br><strong>当与ADT联合使用时，抗PD-1增加了CD8 T细胞浸润到转移部位的程度(骨、肝和肺转移是这样的趋势)，而单独使用 ADT时无法观察到。</strong><p><br></p></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/NZXZvBgTrDBy4Sg9Abjnkg",target="_blank" rel="noopener noreferrer">原文链接</a>
