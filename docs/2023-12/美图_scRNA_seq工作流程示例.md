---
title: "美图！scRNA-seq工作流程示例"
date: 2023-12-07T05:38:42Z
draft: ["false"]
tags: [
  "fetched",
  "生信碱移"
]
categories: ["Acdemic"]
---
美图！scRNA-seq工作流程示例 by 生信碱移
------
<div><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-ratio="1.0324675324675325" data-src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1" data-type="gif" data-w="154" src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1"></section></section></section></section></section><section><section powered-by="xiumi.us"><section><p><span>老铁们快点击蓝字 <strong>关注起来</strong></span></p></section></section></section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-ratio="1.0324675324675325" data-src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1" data-type="gif" data-w="154" src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1"></section></section></section></section></section></section></section></section></section><section data-mpa-powered-by="yiban.io" data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)" data-style='white-space: normal; max-width: 100%; letter-spacing: 0.544px; text-size-adjust: auto; background-color: rgb(255, 255, 255); font-family: "Helvetica Neue", Helvetica, "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;'><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-id="85660" data-custom="rgb(117, 117, 118)" data-color="rgb(117, 117, 118)" data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-id="85660" data-custom="rgb(117, 117, 118)" data-color="rgb(117, 117, 118)" data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)" data-style="margin-top: 2em; padding-top: 0.5em; padding-bottom: 0.5em; max-width: 100%; border-style: solid none; text-decoration: inherit; border-top-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-top-width: 1px; border-bottom-width: 1px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><p data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><span>生信碱移</span></p><section><strong>scRNA-seq工作流程示例</strong></section></section></section></section></section></section></section></section></section></section></section></section><blockquote data-type="2" data-url="" data-author-name="" data-content-utf8-length="68" data-source-title="" data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)" data-darkmode-color-16095509242984="rgba(163, 163, 163, 0.498)" data-darkmode-original-color-16095509242984="rgba(0, 0, 0, 0.498)" data-style='color: rgba(0, 0, 0, 0.498); white-space: normal; max-width: 100%; letter-spacing: 0.544px; font-family: -apple-system-font, system-ui, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif; background-color: rgb(255, 255, 255); box-sizing: border-box !important; overflow-wrap: break-word !important;'><section><span>近期，小编找到一篇基于 Seurat 分析框架的 scRNA-seq 工作流程示例，从转录本计数表到细胞类型注释进行了丰富的图表可视化，示例分析具体使用的是健康骨髓捐赠者公共数据集 GSE120221 中的三个样本。</span></section><section><span>这篇推文只是做一个分享，铁子们感兴趣话可以自取哈，链接如下：</span></section><section><span>https://romanhaa.github.io/projects/scrnaseq_workflow/#snn-graph</span></section></blockquote></section><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><h4 data-tool="markdown.com.cn编辑器"><span></span>KNN图<span></span></h4><pre data-tool="markdown.com.cn编辑器"><span></span><code><span>library</span>(ggnetwork)<br><br>SCT_snn &lt;- seurat@graphs$SCT_snn %&gt;%<br>  as.matrix() %&gt;%<br>  ggnetwork() %&gt;%<br>  left_join(seurat@meta.data %&gt;% mutate(vertex.names = rownames(.)), by = <span>'vertex.names'</span>)<br><br>p1 &lt;- ggplot(SCT_snn, aes(x = x, y = y, xend = xend, yend = yend)) +<br>  geom_edges(color = <span>'grey50'</span>, alpha = <span>0.05</span>) +<br>  geom_nodes(aes(color = sample), size = <span>0.5</span>) +<br>  scale_color_manual(<br>    name = <span>'Sample'</span>, values = custom_colors$discrete,<br>    guide = guide_legend(ncol = <span>1</span>, override.aes = list(size = <span>2</span>))<br>  ) +<br>  theme_blank() +<br>  theme(legend.position = <span>'left'</span>) +<br>  annotate(<br>    geom = <span>'text'</span>, x = <span>Inf</span>, y = -<span>Inf</span>,<br>    label = paste0(<span>'n = '</span>, format(nrow(seurat@meta.data), big.mark = <span>','</span>, trim = <span>TRUE</span>)),<br>    vjust = -<span>1.5</span>, hjust = <span>1.25</span>, color = <span>'black'</span>, size = <span>2.5</span><br>  )<br><br>p2 &lt;- ggplot(SCT_snn, aes(x = x, y = y, xend = xend, yend = yend)) +<br>  geom_edges(color = <span>'grey50'</span>, alpha = <span>0.05</span>) +<br>  geom_nodes(aes(color = seurat_clusters), size = <span>0.5</span>) +<br>  scale_color_manual(<br>    name = <span>'Cluster'</span>, values = custom_colors$discrete,<br>    guide = guide_legend(ncol = <span>1</span>, override.aes = list(size = <span>2</span>))<br>  ) +<br>  theme_blank() +<br>  theme(legend.position = <span>'right'</span>) +<br>  annotate(<br>    geom = <span>'text'</span>, x = <span>Inf</span>, y = -<span>Inf</span>,<br>    label = paste0(<span>'n = '</span>, format(nrow(seurat@meta.data), big.mark = <span>','</span>, trim = <span>TRUE</span>)),<br>    vjust = -<span>1.5</span>, hjust = <span>1.25</span>, color = <span>'black'</span>, size = <span>2.5</span><br>  )<br><br>ggsave(<br>  <span>'plots/snn_graph_by_sample_cluster.png'</span>,<br>  p1 + p2 + plot_layout(ncol = <span>2</span>),<br>  height = <span>5</span>, width = <span>11</span><br>)<br></code></pre><h4 data-tool="markdown.com.cn编辑器"><span></span></h4><p><img data-galleryid="" data-imgfileid="100007869" data-ratio="0.4681528662420382" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeUyyM2HsPcm8iasAKdLuDPkMWmLDKIu5cnEgU4RQcLUdmQiaoQvj4htFen5ChtQ4zZzYLYN2AtyWecw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="942" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeUyyM2HsPcm8iasAKdLuDPkMWmLDKIu5cnEgU4RQcLUdmQiaoQvj4htFen5ChtQ4zZzYLYN2AtyWecw/640?wx_fmt=png&amp;from=appmsg"></p><h4 data-tool="markdown.com.cn编辑器">细胞注释桑基图可视化<span></span></h4><pre data-tool="markdown.com.cn编辑器"><span></span><code>p1 &lt;- ggplot(data, aes(x, id = id, split = y, value = n)) +<br>  geom_parallel_sets(aes(fill = seurat_clusters), alpha = <span>0.75</span>, axis.width = <span>0.15</span>) +<br>  geom_parallel_sets_axes(aes(fill = y), color = <span>'black'</span>, axis.width = <span>0.1</span>) +<br>  geom_text(<br>    aes(y = n, split = y), stat = <span>'parallel_sets_axes'</span>, fontface = <span>'bold'</span>,<br>    hjust = data_labels$hjust, nudge_x = data_labels$nudge_x<br>  ) +<br>  scale_x_discrete(labels = c(<span>'Sample'</span>,<span>'Cluster'</span>)) +<br>  scale_fill_manual(values = color_assignments) +<br>  theme_bw() +<br>  theme(<br>    legend.position = <span>'none'</span>,<br>    axis.title = element_blank(),<br>    axis.text.x = element_text(face = <span>'bold'</span>, colour = <span>'black'</span>, size = <span>15</span>),<br>    axis.text.y = element_blank(),<br>    axis.ticks = element_blank(),<br>    panel.grid.major = element_blank(),<br>    panel.grid.minor = element_blank(),<br>    panel.border = element_blank()<br>  )<br><br>clusters &lt;- levels(seurat@meta.data$seurat_clusters)<br>cell_types &lt;- sort(unique(seurat@meta.data$cell_type_singler_blueprintencode_main))<br><br>color_assignments &lt;- setNames(<br>  c(custom_colors$discrete[<span>1</span>:length(clusters)], custom_colors$discrete[<span>1</span>:length(cell_types)]),<br>  c(clusters,cell_types)<br>)<br><br>data &lt;- seurat@meta.data %&gt;%<br>  dplyr::rename(cell_type = cell_type_singler_blueprintencode_main) %&gt;%<br>  dplyr::mutate(cell_type = factor(cell_type, levels = cell_types)) %&gt;%<br>  group_by(seurat_clusters, cell_type) %&gt;%<br>  tally() %&gt;%<br>  ungroup() %&gt;%<br>  gather_set_data(<span>1</span>:<span>2</span>) %&gt;%<br>  dplyr::mutate(<br>    x = factor(x, levels = unique(x)),<br>    y = factor(y, levels = c(clusters,cell_types))<br>  )<br><br>data_labels &lt;- tibble(<br>    group = c(<br>      rep(<span>'seurat_clusters'</span>, length(clusters)),<br>      rep(<span>'cell_type'</span>, length(cell_types))<br>    )<br> ) %&gt;%<br>  mutate(<br>    hjust = ifelse(group == <span>'seurat_clusters'</span>, <span>1</span>, <span>0</span>),<br>    nudge_x = ifelse(group == <span>'seurat_clusters'</span>, -<span>0.1</span>, <span>0.1</span>)<br>  )<br><br>p2 &lt;- ggplot(data, aes(x, id = id, split = y, value = n)) +<br>  geom_parallel_sets(aes(fill = seurat_clusters), alpha = <span>0.75</span>, axis.width = <span>0.15</span>) +<br>  geom_parallel_sets_axes(aes(fill = y), color = <span>'black'</span>, axis.width = <span>0.1</span>) +<br>  geom_text(<br>    aes(y = n, split = y), stat = <span>'parallel_sets_axes'</span>, fontface = <span>'bold'</span>,<br>    hjust = data_labels$hjust, nudge_x = data_labels$nudge_x<br>  ) +<br>  scale_x_discrete(labels = c(<span>'Cluster'</span>,<span>'Cell type'</span>)) +<br>  scale_fill_manual(values = color_assignments) +<br>  theme_bw() +<br>  theme(<br>    legend.position = <span>'none'</span>,<br>    axis.title = element_blank(),<br>    axis.text.x = element_text(face = <span>'bold'</span>, colour = <span>'black'</span>, size = <span>15</span>),<br>    axis.text.y = element_blank(),<br>    axis.ticks = element_blank(),<br>    panel.grid.major = element_blank(),<br>    panel.grid.minor = element_blank(),<br>    panel.border = element_blank()<br>  )<br></code></pre><h4 data-tool="markdown.com.cn编辑器"><span></span></h4><p><img data-galleryid="" data-imgfileid="100007870" data-ratio="0.7651966626936829" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeUyyM2HsPcm8iasAKdLuDPkMaWEpptiaJEY3pg8xuYsLc9keNgZ6DnpyJWVGtF5Nxpj2ibeLSicM1EkJw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="839" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeUyyM2HsPcm8iasAKdLuDPkMaWEpptiaJEY3pg8xuYsLc9keNgZ6DnpyJWVGtF5Nxpj2ibeLSicM1EkJw/640?wx_fmt=png&amp;from=appmsg"></p><h4 data-tool="markdown.com.cn编辑器">细胞降维图<span></span></h4><pre data-tool="markdown.com.cn编辑器"><span></span><code>UMAP_centers_cell_type &lt;- tibble(<br>    UMAP_1 = as.data.frame(seurat@reductions$UMAP@cell.embeddings)$UMAP_1,<br>    UMAP_2 = as.data.frame(seurat@reductions$UMAP@cell.embeddings)$UMAP_2,<br>    cell_type = seurat@meta.data$cell_type_singler_blueprintencode_main<br>  ) %&gt;%<br>  group_by(cell_type) %&gt;%<br>  summarize(x = median(UMAP_1), y = median(UMAP_2))<br><br>p &lt;- bind_cols(seurat@meta.data, as.data.frame(seurat@reductions$UMAP@cell.embeddings)) %&gt;%<br>  ggplot(aes(UMAP_1, UMAP_2, color = cell_type_singler_blueprintencode_main)) +<br>  geom_point(size = <span>0.2</span>) +<br>  geom_label(<br>    data = UMAP_centers_cell_type,<br>    mapping = aes(x, y, label = cell_type),<br>    size = <span>3.5</span>,<br>    fill = <span>'white'</span>,<br>    color = <span>'black'</span>,<br>    fontface = <span>'bold'</span>,<br>    alpha = <span>0.5</span>,<br>    label.size = <span>0</span>,<br>    show.legend = <span>FALSE</span><br>  ) +<br>  theme_bw() +<br>  expand_limits(x = c(-<span>22</span>,<span>15</span>)) +<br>  scale_color_manual(values = custom_colors$discrete) +<br>  labs(color = <span>'Cell type'</span>) +<br>  guides(colour = guide_legend(override.aes = list(size = <span>2</span>))) +<br>  theme(legend.position = <span>'right'</span>) +<br>  coord_fixed() +<br>  annotate(<br>    geom = <span>'text'</span>, x = <span>Inf</span>, y = -<span>Inf</span>,<br>    label = paste0(<span>'n = '</span>, format(nrow(seurat@meta.data), big.mark = <span>','</span>, trim = <span>TRUE</span>)),<br>    vjust = -<span>1.5</span>, hjust = <span>1.25</span>, color = <span>'black'</span>, size = <span>2.5</span><br>  )<br><br>ggsave(<br>  <span>'plots/umap_by_cell_type_singler_blueprintencode_main.png'</span>,<br>  p,<br>  height = <span>4</span>,<br>  width = <span>6</span><br>)<br></code></pre></section><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><h4 data-tool="markdown.com.cn编辑器"><span></span><img data-galleryid="" data-imgfileid="100007872" data-ratio="0.6090712742980562" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeUyyM2HsPcm8iasAKdLuDPkMc8GEtUDmdcsLibukagxbd1ZduGdKBJVJ0XDWNdHPtibb3ZSTyQ9VeVsQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="926" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeUyyM2HsPcm8iasAKdLuDPkMc8GEtUDmdcsLibukagxbd1ZduGdKBJVJ0XDWNdHPtibb3ZSTyQ9VeVsQ/640?wx_fmt=png&amp;from=appmsg"><span></span></h4></section><section><span><span><strong>简单分享到这<img data-ratio="1" data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Yellowdog.png" data-w="128" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Yellowdog.png"><img data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/Expression/Expression_64@2x.png" data-ratio="1" data-w="128" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/Expression/Expression_64@2x.png"></strong></span></span></section><section><mp-common-profile data-id="MzkyNTIzMzYyMA==" data-pluginname="mpprofile" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/LvUIqvYKCeXYZNMxRMnjiaicO2a27jDZ2FgQga8TdeQcsGRJRIn2IInkKtfcbbMXOBSViaPXpTOBulUlNzd11pzow/0?wx_fmt=png" data-nickname="生信碱移" data-alias="liudoufu307" data-signature="春来秋至，分享我的所见与所识" data-from="2" data-is_biz_ban="0" data-weui-theme="light"></mp-common-profile></section><section><strong><span><br></span></strong></section><section><strong><span>END~</span></strong><br></section><p><span><strong>仅供粉丝老铁们参考</strong></span></p><p><strong>如有侵权或错误，请联系删除改正～</strong></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/BAEbWloO759sPcW6fxDY6Q",target="_blank" rel="noopener noreferrer">原文链接</a>
