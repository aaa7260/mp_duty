---
title: "生物学功能注释三板斧"
date: 2023-12-01T10:40:20Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
生物学功能注释三板斧 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>生物学功能注释是对特定的数量（几十个或者几百个）基因或蛋白的合集的功能进行描述和分类的过程。GO（Gene Ontology）和KEGG（Kyoto Encyclopedia of Genes and Genomes）数据库是两个常用的生物学功能注释数据库，科学家通常是使用来<strong>超几何分布</strong>检验这个统计学算法做富集分析，即通过比较实际观察到的基因集合（几十个或者几百个）中特定功能或通路的基因数量与随机期望的数量来判断其是否富集。</p></blockquote><ul data-tool="mdnice编辑器"><li><section>超几何分布检验的核心思想是，如果我们的基因集合（几十个或者几百个）是随机抽取的，那么它在某个特定功能类别（go以及kegg）中的富集情况应该是符合期望的。期望值是基于全部的基因（2万个左右）的分布来计算的。</section></li><li><section>比方说，我们差异分析或者其它分析拿到了200个基因，而全部的基因（是2万个左右），而且我们关注的某个特定功能类别（go以及kegg）在比如细胞增值这个通路是 100个基因。如果我们的抽取是随机的，我们预期在这个抽样中有多少基因属于我们关注的功能类别呢？</section></li><li><section>超几何分布检验会考虑这样一个问题：如果我们拿到了的200个基因里面有10个都是细胞增值这个通路里面的，概率如何？如果这种可能性很低，那么我们就认为我们观察到的富集情况是显著的，而不太可能是随机发生的。</section></li></ul><p data-tool="mdnice编辑器">如下所示的小洁老师授课PPT也分享了：</p><p><img data-galleryid="" data-ratio="0.5638888888888889" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx2rcQXKQUkWyLgdppp7Q7sgNlVOfho8R6mvtnx9u181FyqHeCAH5wmJyszNwKau1NJveFvBxDZPg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx2rcQXKQUkWyLgdppp7Q7sgNlVOfho8R6mvtnx9u181FyqHeCAH5wmJyszNwKau1NJveFvBxDZPg/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>小洁老师授课PPT</figcaption></figure><p data-tool="mdnice编辑器">上面的案例里面的背景基因不到1万个，而差异基因是555个，有20倍的差距，理论上每个通路都是100左右数量级的基因理论上它们每个通路应该是就有5个左右的基因在差异基因列表里面。但是上面的通路的富集分析结果表格里面可以看到，绝大部分通路都是有十几个甚至二十多个基因在我们的差异基因列表里面，所以上面的通路都是被富集了。</p><h3 data-tool="mdnice编辑器"><span></span>最普通的就是go或者kegg数据库<span></span></h3><p data-tool="mdnice编辑器">其中GO注释通常包括三个方面的信息：分子功能（Molecular Function）、细胞组分（Cellular Component）和生物过程（Biological Process）。</p><p data-tool="mdnice编辑器">如果大家对代码不熟悉，甚至可以使用在线网页工具直接完成生物学功能数据库（go以及kegg）注释（富集分析），最常见的是 3大在线分析工具:<strong>Enrichr、WebGestalt、gprofiler</strong> ，还有大名鼎鼎的<strong>DAVID（Database for Annotation, Visualization, and Integrated Discovery）</strong>，以及后起之秀 Metascape，它们都可以用于功能富集分析的工具，帮助理解一组基因的生物学含义。</p><h3 data-tool="mdnice编辑器"><span></span>如果要更丰富就是MSigDB数据库啦<span></span></h3><p data-tool="mdnice编辑器">MSigDB（Molecular Signatures Database）数据库中定义了非常多的已知的基因集合，包括人类和小鼠的 ：</p><ul data-tool="mdnice编辑器"><li><section>http://software.broadinstitute.org/gsea/msigdb</section></li></ul><p data-tool="mdnice编辑器">需要简单的注册才能下载里面的gmt文件 ，其实就包含了前面提到的go和kegg数据库信息啦。这个gmt格式是broad研究所为他们开发的gsea分析定义的文本文件规范，就是每一行都是一个通路（基因集合），每个行所代表的通路可以是不限制的列。但是第一列必须是通路的名字或者ID，第二个是通路的描述，第三列以及之后的全部的列都是基因名字或者ID即可。</p><p><img data-galleryid="" data-ratio="1.037962962962963" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx2rcQXKQUkWyLgdppp7Q7sWBT2IsHuA0BaCMW6ia63NVsV1bw3PhaXyp4aCVgxYiccG2HicllNJTTicQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx2rcQXKQUkWyLgdppp7Q7sWBT2IsHuA0BaCMW6ia63NVsV1bw3PhaXyp4aCVgxYiccG2HicllNJTTicQ/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>需要简单的注册才能下载里面的gmt文件</figcaption></figure><p data-tool="mdnice编辑器">但是 msigdbr 这个R包 ，它内置了MSigDB（Molecular Signatures Database）数据库的全部基因集合。安装方法也非常简单：</p><pre data-tool="mdnice编辑器"><span></span><code>install.packages(<span>"msigdbr"</span>)<br></code></pre><p data-tool="mdnice编辑器">包括H和C1-C8八个系列（Collection），每个系列分别是：</p><ul data-tool="mdnice编辑器"><li><section>H: hallmark gene sets （癌症）特征基因集合，共50组，最常用；</section></li><li><section>C1: positional gene sets 位置基因集合，根据染色体位置，共326个，用的很少；</section></li><li><section>C2: curated gene sets：（专家）校验基因集合，基于通路、文献等：</section></li><li><section>C3: motif gene sets：模式基因集合，主要包括microRNA和转录因子靶基因两部分</section></li><li><section>C4: computational gene sets：计算基因集合，通过挖掘癌症相关芯片数据定义的基因集合；</section></li><li><section>C5: GO gene sets：Gene Ontology 基因本体论，包括BP（生物学过程biological process，细胞原件cellular component和分子功能molecular function三部分）</section></li><li><section>C6: oncogenic signatures：癌症特征基因集合，大部分来源于NCBI GEO  发表芯片数据</section></li><li><section>C7: immunologic signatures: 免疫相关基因集合。</section></li><li><section>C8: cell type 相关的基因列表</section></li></ul><p data-tool="mdnice编辑器">有了 msigdbr 这个R包 ，就不需要去下载gmt文件进行解析啦，直接把 msigdbr 这个R包 里面的基因集合制作成为 GeneSetCollection 对象即可。</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(msigdbr)<br>all_gene_sets = msigdbr(species = <span>"Homo sapiens"</span>,<br>                        category=<span>'H'</span>)<br>length(unique(table(all_gene_sets$gs_name)))<br>tail(table(all_gene_sets$gs_name))<br><br>gcSample = split(all_gene_sets$gene_symbol,<br>                 all_gene_sets$gs_name)<br>names(gcSample)<br><br>gs = lapply(gcSample, unique)<br>gsc &lt;- GeneSetCollection(mapply(<span>function</span>(geneIds, keggId) {<br>  GeneSet(geneIds, geneIdType=EntrezIdentifier(),<br>          collectionType=KEGGCollection(keggId),<br>          setName=keggId)<br>}, gs, names(gs)))<br>gsc<br></code></pre><p data-tool="mdnice编辑器">有了上面的这个gsc变量的  GeneSetCollection 对象 就可以很容易去做GSVA分析：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 需要一个普通的表达量矩阵，X </span><br>es.max &lt;- gsva(X, gsc, <br>               mx.diff=<span>FALSE</span>, verbose=<span>FALSE</span>, <br>               parallel.sz=<span>8</span>)<br></code></pre><p data-tool="mdnice编辑器">或者使用 clusterProfile 进行GSEA(GSEA analysis with clusterProfile) （前提是已获得排序好的genelist）(Assuming a well-range genelist )，这个时候不需要GeneSetCollection 对象 ，需要下载gmt文件，比如  h.all.v7.2.symbols.gmt文件，然后代码也是很简单：的</p><pre data-tool="mdnice编辑器"><span></span><code><span>### 对 MsigDB中的全部基因集 做GSEA分析。</span><br><span># http://www.bio-info-trainee.com/2105.html</span><br><span># http://www.bio-info-trainee.com/2102.html </span><br><span># https://www.gsea-msigdb.org/gsea/msigdb</span><br><span># https://www.gsea-msigdb.org/gsea/msigdb/collections.jsp</span><br>{ <br>  geneList= deg$avg_logFC <br>  names(geneList)= toupper(rownames(deg))<br>  geneList=sort(geneList,decreasing = <span>T</span>)<br>  head(geneList)<br>  <span>library</span>(ggplot2)<br>  <span>library</span>(clusterProfiler)<br>  <span>library</span>(org.Hs.eg.db)<br>  <span>#选择gmt文件（MigDB中的全部基因集）</span><br>  gmtfile =<span>'MSigDB/symbols/h.all.v7.2.symbols.gmt'</span><br>  <span># 31120 个基因集</span><br>  <span>#GSEA分析</span><br>  <span>library</span>(GSEABase) <span># BiocManager::install('GSEABase')</span><br>  geneset &lt;- clusterProfiler::read.gmt( gmtfile )  <br>  length(unique(geneset$term))<br>  egmt &lt;- GSEA(geneList, TERM2GENE=geneset, <br>               minGSSize = <span>1</span>,<br>               pvalueCutoff = <span>0.99</span>,<br>               verbose=<span>FALSE</span>)<br>  head(egmt)<br>  egmt@result <br>  gsea_results_df &lt;- egmt@result <br>  rownames(gsea_results_df)<br>  write.csv(gsea_results_df,file = <span>'gsea_results_df.csv'</span>)<br>  <span>library</span>(enrichplot)<br>  gseaplot2(egmt,geneSetID = <span>'HALLMARK_EPITHELIAL_MESENCHYMAL_TRANSITION'</span>,pvalue_table=<span>T</span>)<br>  gseaplot2(egmt,geneSetID = <span>'HALLMARK_MTORC1_SIGNALING'</span>,pvalue_table=<span>T</span>) <br>}<br><br></code></pre><h3 data-tool="mdnice编辑器"><span></span>更高级的是DoRothEA和PROGENy<span></span></h3><ul data-tool="mdnice编辑器"><li><section>Discriminant Regulon Expression Analysis (DoRothEA)</section></li><li><section>Pathway RespOnsive GENes for ac- tivity inference (PROGENy)</section></li></ul><p data-tool="mdnice编辑器">其实也可以仍然是理解为常规的gsea或者超几何分布检验，其中超几何分布检验是针对差异分析等拿到的基因集合（几十个或者几百个）进行生物学功能数据库注释，而常规的gsea或者gsva的分析是针对单个样品（需要有全部的两万多个基因）进行打分，所以会把表达量矩阵转为通路的打分矩阵。</p><p data-tool="mdnice编辑器">而DoRothEA和PROGENy也是针对单个样品（需要有全部的两万多个基因）进行打分，可以把表达量矩阵转为转录因子或者肿瘤相关通路的打分，然后样品本身有分组就可以对前面的打分进行差异分析后展示。</p><p data-tool="mdnice编辑器">让我们看看2023的文章《STK11/LKB1-Deficient Phenotype Rather Than Mutation Diminishes Immunotherapy Efficacy and Represents STING/Type I Interferon/CD8þ T-Cell Dysfunction in NSCLC》，是如何做这个分析的，如下所示：</p><p><img data-galleryid="" data-ratio="0.654945054945055" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx2rcQXKQUkWyLgdppp7Q7sQ9U9oX9vZEQQ7ribwDI5s7DoznE7BFyfHQ6MXEXGaicxo2ibz729bMImw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="910" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx2rcQXKQUkWyLgdppp7Q7sQ9U9oX9vZEQQ7ribwDI5s7DoznE7BFyfHQ6MXEXGaicxo2ibz729bMImw/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>DoRothEA和PROGENy</figcaption></figure><p data-tool="mdnice编辑器">就可以挑选有差异的地方去展示，如下所示：</p><p><img data-galleryid="" data-ratio="0.3055555555555556" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx2rcQXKQUkWyLgdppp7Q7szbcicg1tUpqm1ViaSJy9ibOAhIgvMZA46XFaawMl4aHcSUG8sQjkLTftQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx2rcQXKQUkWyLgdppp7Q7szbcicg1tUpqm1ViaSJy9ibOAhIgvMZA46XFaawMl4aHcSUG8sQjkLTftQ/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>挑选有差异的地方去展示</figcaption></figure><p data-tool="mdnice编辑器">This notion was further supported by the DoRothEA and PROGENy analyses, which revealed that IFN-I–related and other immunostimulatory transcrip- tional factors (STAT1, NFKB1, RELA, NFATC1, TCF7, RELA) and pathways (JAK-STAT, NFkB, tumor necrosis factor-a) were significantly deactivated in STK11-def tumors,</p><h3 data-tool="mdnice编辑器"><span></span>学徒作业<span></span></h3><p data-tool="mdnice编辑器">下载airway这个R包后使用里面的表达量矩阵，然后进行DoRothEA和PROGENy这样的针对单个样品（需要有全部的两万多个基因）进行打分，可以把表达量矩阵转为转录因子或者肿瘤相关通路的打分，然后airway这个R包后使用里面的表达量矩阵的样品本身有分组就可以对前面的打分进行差异分析后展示。</p></section><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526646&amp;idx=1&amp;sn=d1728d9102f72d2ce5c425162549499d&amp;chksm=9b4b284dac3ca15b83972f3dcb45977fc78eb65b607e7961658f8586f8a4b7be2c2c43883684&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授‍课（买一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247522831&amp;idx=2&amp;sn=1744efdf428465425a145ff3a982198b&amp;chksm=9b4bdab4ac3c53a28fbecbbff4f254f470b54a7a20468bb753b295b930315e1ec45bcbabc10b&amp;scene=21#wechat_redirect" textvalue="144线程640Gb内存服务器共享一年‍仍然是仅需800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">144线程640Gb内存服务器共享一年仍然是仅需800</a></section></li></ul><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/YVNOeYEIvh7adXb4nSOO5A",target="_blank" rel="noopener noreferrer">原文链接</a>
