---
title: "如何绘制功能富集网络图？"
date: 2023-12-28T04:05:55Z
draft: ["false"]
tags: [
  "fetched",
  "SCIPainter"
]
categories: ["Acdemic"]
---
如何绘制功能富集网络图？ by SCIPainter
------
<div><section data-mpa-powered-by="yiban.io"><span>今天分享一个绘制功能富集网络图的R包</span><strong><span><em>aPEAR</em></span></strong><span>，该R包可分析通路的基因列表、检测冗余重叠基因集群并绘制网络图，帮助我们快速从富集分析结果中发现最重要的生物学主题。</span></section><section><br></section><section><span>该R包可直接对接clusterProfiler包的富集分析结果，或按需整理对应格式富集数据。如果对clusterProfiler包富集分析还不熟悉，可戳往期教程：</span></section><section><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzIyOTY3MDA3MA==&amp;mid=2247530601&amp;idx=1&amp;sn=5ddbe9d7766f64c9e86dc302f2a49da7&amp;chksm=e8bd15b0dfca9ca651c95544b5bb4154e5ee03cd32edbd0710159429cc425d9dc17c31ebb9ff&amp;scene=21#wechat_redirect" textvalue="《一文拿捏KEGG功能富集与可视化（clusterProfiler版）！》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">《一文拿捏KEGG功能富集与可视化（clusterProfiler版）！》</a></span></section><section><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzIyOTY3MDA3MA==&amp;mid=2247530781&amp;idx=1&amp;sn=26ecc9ad3aafc616a10ad0e96b39a8d6&amp;chksm=e8bd14c4dfca9dd2838e1a6408b4490a57885e8f431dd764ca6630d057c1edac4fd6f9411295&amp;scene=21#wechat_redirect" textvalue="《一文拿捏GO功能富集与可视化（clusterProfiler版）！》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">《一文拿捏GO功能富集与可视化（clusterProfiler版）！》</a></span></section><section><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA5NzQzOTgzMw==&amp;mid=2651005004&amp;idx=1&amp;sn=2432c266946ab17d59324ba518b621e0&amp;chksm=8b57597abc20d06c4a388823f123eb09c3fc108c526b512b4809efce2c3f1efca96c7950461e&amp;scene=21#wechat_redirect" textvalue="《如何进行GSEA功能富集？clusterProfiler版来了！》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">《如何进行GSEA功能富集？clusterProfiler版来了！》</a></span></section><section><span><br></span></section><section><span>下面进入今日份学习！</span></section><section><span><br mpa-from-tpl="t"></span></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#相关R包安装与载入：</span><br mpa-from-tpl="t"><span>install</span>.packages('aPEAR')<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>library</span>(aPEAR)<br mpa-from-tpl="t"><span>library</span>(clusterProfiler)<br mpa-from-tpl="t"><span>library</span>(org.Hs.eg.db)<br mpa-from-tpl="t"><span>library</span>(DOSE)<br mpa-from-tpl="t"><span>library</span>(ggplot2)<br mpa-from-tpl="t"><span>library</span>(cols4all)<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>#测试数据集载入(来自DOSE包)：</span><br mpa-from-tpl="t"><span>data</span>(geneList)<br mpa-from-tpl="t"><span>dt</span> &lt;- geneList<br mpa-from-tpl="t"><span>head</span>(dt) <span>##entrez gene IDs和log2FC</span></code></pre></section><p><br></p><section><img data-imgfileid="100049396" data-ratio="0.11098265895953757" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btHBfQ9blVwGwsPFsSAclEdj20g2MHVdjekh5ybib0relQpcMcChNTQjQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="865" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btHBfQ9blVwGwsPFsSAclEdj20g2MHVdjekh5ybib0relQpcMcChNTQjQ/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#基于GO的GSEA富集分析：</span><br mpa-from-tpl="t"><span>set</span>.seed(123)<br mpa-from-tpl="t"><span>enrich</span> &lt;- gseGO(dt, OrgDb = org.Hs.eg.db, ont = 'CC')<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>#查看富集结果表：</span><br mpa-from-tpl="t"><span>View</span>(enrich@result)</code></pre></section><p><br></p><section><img data-imgfileid="100049398" data-ratio="0.42962962962962964" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1bt7MReC0S1Hz19zCUWBSHIE5Z4LqwIibvgI9icKE5lBVeiaOntbIbRgU0gg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1bt7MReC0S1Hz19zCUWBSHIE5Z4LqwIibvgI9icKE5lBVeiaOntbIbRgU0gg/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>colnames</span>(enrich@result)</code></pre></section><p><br></p><section><img data-imgfileid="100049397" data-ratio="0.10740740740740741" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btxQUu7icyhRYDgquCtdicoI8PMgW7hzfLVNphMtiah2ibyNl9LxibwB5ZKrQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btxQUu7icyhRYDgquCtdicoI8PMgW7hzfLVNphMtiah2ibyNl9LxibwB5ZKrQ/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#富集网络图绘制：</span><br mpa-from-tpl="t"><span>set</span>.seed(1)<br mpa-from-tpl="t"><span>p</span> &lt;- enrichmentNetwork(enrich@result,<br mpa-from-tpl="t">                       <span>colorBy</span> = 'NES',<br mpa-from-tpl="t">                       <span>colorType</span> = c(<span>"nes"</span>),<br mpa-from-tpl="t">                       <span>nodeSize</span> = 'setSize',<br mpa-from-tpl="t">                       <span>fontSize</span> = 4,<br mpa-from-tpl="t">                       <span>verbose</span> = TRUE) <br mpa-from-tpl="t"><span>p</span></code></pre></section><p><br></p><section><img data-imgfileid="100049399" data-ratio="0.7074074074074074" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btZianZQBlIPdI3LoAbOX9RBZ8Hjk3sibgrrMHWkLz2IhRml0NSxX0nLfw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btZianZQBlIPdI3LoAbOX9RBZ8Hjk3sibgrrMHWkLz2IhRml0NSxX0nLfw/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#添加椭圆置信区间：</span><br mpa-from-tpl="t"><span>set</span>.seed(1)<br mpa-from-tpl="t"><span>p1</span> &lt;- enrichmentNetwork(enrich@result,<br mpa-from-tpl="t">                        <span>colorBy</span> = 'NES',<br mpa-from-tpl="t">                        <span>colorType</span> = c(<span>"nes"</span>),<br mpa-from-tpl="t">                        <span>nodeSize</span> = 'setSize',<br mpa-from-tpl="t">                        <span>fontSize</span> = 4,<br mpa-from-tpl="t">                        <span>drawEllipses</span> = TRUE, <span>#是否绘制置信区间椭圆</span><br mpa-from-tpl="t">                        <span>verbose</span> = TRUE)<br mpa-from-tpl="t"><span>p1</span></code></pre></section><p><br></p><section><img data-imgfileid="100049400" data-ratio="0.7361111111111112" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btNMnVgCQIiaSBBSefDnjtFvWYZ1iaafQmSSe0xtT1L96lIglicxqk8QD2w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btNMnVgCQIiaSBBSefDnjtFvWYZ1iaafQmSSe0xtT1L96lIglicxqk8QD2w/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#选择使用pvalue为节点着色(如KEGG/GO等富集分析结果,无NES得分)：</span><br mpa-from-tpl="t"><span>set</span>.seed(1)<br mpa-from-tpl="t"><span>p2</span> &lt;- enrichmentNetwork(enrich@result,<br mpa-from-tpl="t">                        <span>colorBy</span> = 'pvalue',<br mpa-from-tpl="t">                        <span>colorType</span> = c(<span>"pval"</span>), <span>#选择pval,使用对数变换并调整颜色范围</span><br mpa-from-tpl="t">                        <span>nodeSize</span> = 'setSize',<br mpa-from-tpl="t">                        <span>fontSize</span> = 4,<br mpa-from-tpl="t">                        <span>drawEllipses</span> = TRUE,<br mpa-from-tpl="t">                        <span>pCutoff</span> = -10,<br mpa-from-tpl="t">                        <span>verbose</span> = TRUE)<br mpa-from-tpl="t"><span>p2</span></code></pre></section><p><br></p><section><img data-imgfileid="100049405" data-ratio="0.7361111111111112" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btUxCtA6xpia3qaKFMIs6QdzfnvXwq3le6kcibAkjFq8RTgEcGaX769skQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btUxCtA6xpia3qaKFMIs6QdzfnvXwq3le6kcibAkjFq8RTgEcGaX769skQ/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#配色自定义(基于ggplot2)：</span><br mpa-from-tpl="t"><span>c4a_gui</span>() <span>#色板查看(来自col4all配色包)</span><br mpa-from-tpl="t"><span>p1</span> + scale_color_continuous_c4a_div('benedictus', reverse = T)</code></pre></section><p><br></p><section><img data-imgfileid="100049404" data-ratio="0.7361111111111112" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btvHyA1bKwvY3nJPCaDwDBzmqPibUQ0blCbc2Aoqb8WLjCiaodibky5vWMQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btvHyA1bKwvY3nJPCaDwDBzmqPibUQ0blCbc2Aoqb8WLjCiaodibky5vWMQ/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section><span>以上是aPEAR直接对接clusterProfiler的GSEA富集结果的网络图绘制。下面我们看看对接本地富集分析结果表的格式要求：</span><br></section><section><span><br></span></section><section><img data-imgfileid="100049402" data-ratio="0.7324074074074074" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btO6gVSLwQMFJso5NOyDHnqWN1x5iaLaoAaG44ibMafa2JH1FJqUxPfD7g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btO6gVSLwQMFJso5NOyDHnqWN1x5iaLaoAaG44ibMafa2JH1FJqUxPfD7g/640?wx_fmt=png&amp;from=appmsg"></section><section><span><br></span></section><section><span>即数据框中所需内容至少有4列所需：</span></section><section><span><br></span></section><section><span>1）通路信息列（Description）；</span></section><section><span>2）geneID列，包含对应通路的基因列表，用于计算通路间的相似性。ID类型无限制，但所有通路的ID类型要保持一致，ID间用“/”作为分隔；</span></section><section><span>3）用于给节点着色的信息列：如NES、pvalue、qvalue等；</span></section><section><span>4）用于设置节点大小的信息列，一般为富集到通路的基因数目。</span></section><section><br></section><section><span>最后，我们再使用一个本地KEGG富集结果表进行测试：</span></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#载入本地KEGG富集结果表：</span><br mpa-from-tpl="t"><span>KEGG</span> &lt;- read.csv('TCGA-CHOL-KEGG-diff.csv',header = T, row.names = 1, check.names = F)<br mpa-from-tpl="t"><span>View</span>(KEGG)</code></pre></section><p><br></p><section><img data-imgfileid="100049403" data-ratio="0.4287037037037037" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1bt4Wz8Dbl1yAYW2vw1XHkG20EuSjKKb2xY72fvviaDJe0RSR1fc8Znriag/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1bt4Wz8Dbl1yAYW2vw1XHkG20EuSjKKb2xY72fvviaDJe0RSR1fc8Znriag/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>colnames</span>(KEGG)</code></pre></section><p><br></p><section><img data-imgfileid="100049401" data-ratio="0.14907407407407408" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btZ7PfmvvHDkAXAqQVf1AHKqYqlqe2BJ5BsnqlmQMqhmwVicpymMTjhFQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1btZ7PfmvvHDkAXAqQVf1AHKqYqlqe2BJ5BsnqlmQMqhmwVicpymMTjhFQ/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#提取显著富集结果表：</span><br mpa-from-tpl="t"><span>KEGG_sig</span> &lt;- KEGG[KEGG$pvalue &lt;= 0.05,]<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>#绘制富集网络图：</span><br mpa-from-tpl="t"><span>set</span>.seed(123)<br mpa-from-tpl="t"><span>p3</span> &lt;- enrichmentNetwork(KEGG_sig,<br mpa-from-tpl="t">                        <span>colorBy</span> = 'pvalue',<br mpa-from-tpl="t">                        <span>colorType</span> = c(<span>"pval"</span>), <br mpa-from-tpl="t">                        <span>nodeSize</span> = 'Count',<br mpa-from-tpl="t">                        <span>fontSize</span> = 4,<br mpa-from-tpl="t">                        <span>drawEllipses</span> = F,<br mpa-from-tpl="t">                        <span>pCutoff</span> = -10,<br mpa-from-tpl="t">                        <span>verbose</span> = TRUE) +<br mpa-from-tpl="t">  <span>scale_color_continuous_c4a_seq</span>('yl_gn_bu', reverse = T)<br mpa-from-tpl="t"><span>p3</span></code></pre></section><p><br></p><section><img data-imgfileid="100049406" data-ratio="0.6194444444444445" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1bt01GmtEu1yMwhkb0x0zKPuqFcfo2KMcU6jib1L90nZHicHJ1v9B6hlVqw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6ndRLkicMpicgF2LejHmEE1bt01GmtEu1yMwhkb0x0zKPuqFcfo2KMcU6jib1L90nZHicHJ1v9B6hlVqw/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section><span>关于其它主题参数、配置参数、算法等内容可使用下面两个命令查阅：</span></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#配置与参数查阅：</span><br mpa-from-tpl="t">?<span>aPEAR</span>.methods <span>#查看相关方法配置参数</span><br mpa-from-tpl="t">?<span>aPEAR</span>.theme <span>#查看有关主题参数</span></code></pre></section><p><br></p><p><span>更多内容可阅读作者说明文档。好啦 ，今日分享毕！</span></p><section data-mpa-template="t" mpa-from-tpl="t"><section data-mpa-template="t" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><br></section><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><p data-mid="" mpa-is-content="t"><span>参考资料</span></p></section></section></section></section></section></section><p><br></p><section><span>https://cloud.r-project.org/web/packages/aPEAR/vignettes/aPEAR-vignette.html</span></section><section><span>https://github.com/kerseviciute/aPEAR</span><span></span></section><section><br></section><section><br></section><p><strong><span>*未经许可，不得以任何方式复制或抄袭本篇文章之部分或全部内容。版权所有，侵权必究。</span></strong></p><p><br></p><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="105648"><section><section data-role="outer" label="Powered by 135editor.com"><section data-role="paragraph"><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="105648"><section><section><img data-ratio="0.8780487804878049" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJE8VibmibGU0Jxic9iabARVRH0FT6BNE8VAglWFXBPibFAU7a6tWGibSs8wyUg/640?wx_fmt=png" data-type="png" data-w="41" data-width="100%" data-imgfileid="100049409" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJE8VibmibGU0Jxic9iabARVRH0FT6BNE8VAglWFXBPibFAU7a6tWGibSs8wyUg/640?wx_fmt=png"></section><section><section><section data-width="35%"><section><section data-width="100%"><img data-imgfileid="100049408" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEv5etCBwHicqbEPwnVrkpaasxqaVibM4mT2JdIuN6yTlYWDD4mL5A427A/640?wx_fmt=jpeg" data-type="jpeg" data-w="860" data-width="100%" title="SCIPainter 30cm二维码.jpg" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEv5etCBwHicqbEPwnVrkpaasxqaVibM4mT2JdIuN6yTlYWDD4mL5A427A/640?wx_fmt=jpeg"></section></section></section><section data-width="50%"><section><section data-brushtype="text"><span><strong># SCIPainter</strong></span></section><section data-brushtype="text" hm_fix="361:593"><p>基迪奥旗下绘图公众号</p><p>分享科研绘图技能与工具</p><p>欢迎关注与转发~</p></section></section></section></section></section></section></section></section></section></section><section><br></section></section></section><section data-role="paragraph"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEgMd0aMPtmrDjiaX8sBhfhicVteeHf1JicexSpUbS3fdS9SiboUVN7guaPw/640?wx_fmt=gif" data-type="gif" data-w="400" data-imgfileid="100049410" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEgMd0aMPtmrDjiaX8sBhfhicVteeHf1JicexSpUbS3fdS9SiboUVN7guaPw/640?wx_fmt=gif"></section></section></section><section><section powered-by="xiumi.us"><section><p><span><strong>你的好友拍了拍你</strong></span></p><p><span><strong>并请你帮她点一下</strong></span><strong><span>“分享”</span></strong><span><strong><span>~</span></strong></span></p></section></section></section></section></section><p><br></p></section></section><section><br></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/c2ow1OEJ3jrJL3mhz4mcaQ",target="_blank" rel="noopener noreferrer">原文链接</a>
