---
title: "seurat个性化细胞注释并把细分亚群放回总群"
date: 2023-12-04T01:07:59Z
draft: ["false"]
tags: [
  "fetched",
  "生信小博士"
]
categories: ["Acdemic"]
---
seurat个性化细胞注释并把细分亚群放回总群 by 生信小博士
------
<div><p><strong><span>大家好，今天我们分享的是 </span></strong></p><ul><li><p><strong><span>1. 个性化细胞命名</span></strong></p></li><li><p><strong><span>2. 细分亚群</span></strong></p></li><li><p><strong><span>3. 把细分的亚群放回原来的总群</span></strong></p><hr><p><br></p><p><strong><span>公众号内回复冒号后面的关键字获取直播代码：</span></strong><strong><span>第四次直播</span></strong></p><p><br></p><p><span><strong><span>直播视频</span></strong><strong><span>已经上传到b站up主： 生信小博士</span></strong></span><strong><span>https://space.bilibili.com/1706877377</span></strong></p></li></ul><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><p><strong><span>01</span></strong></p></section></section></section></section></section></section><section powered-by="xiumi.us"><section><img data-imgfileid="100001008" data-ratio="1.21580547112462" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/MVPvEL7Qg0EgrwdibaKqfTqpyFcSD7uE2JcEGETKYmdVA1UNUhbaXBa2qqazjc44k52ezTYYvRyoGAIOgrUNVhg/640?wx_fmt=gif" data-w="329" width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/MVPvEL7Qg0EgrwdibaKqfTqpyFcSD7uE2JcEGETKYmdVA1UNUhbaXBa2qqazjc44k52ezTYYvRyoGAIOgrUNVhg/640?wx_fmt=gif"></section></section><ul><li><p><span><strong><span>1. 个性化细胞命名</span></strong></span></p></li></ul><p><strong><span>首先读入pbmc数据</span></strong><br></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span><br></span></code><code><span>.libPaths(c( "/home/data/t040413/R/x86_64-pc-linux-gnu-library/4.2",</span></code><code><span>             "/home/data/t040413/R/yll/usr/local/lib/R/site-library",  </span></code><code><span>             "/home/data/refdir/Rlib/", "/usr/local/lib/R/library"))</span></code><code><span><br></span></code><code><span>sessionInfo()</span></code><code><span>getwd()</span></code><code><span><br></span></code><code><span>dir.create('~/gzh/20231202_4_live_个性化注释')</span></code><code><span>setwd('~/gzh/20231202_4_live_个性化注释')</span></code><code><span><br></span></code><code><span><br></span></code><code><span>getwd()</span></code><code><span><br></span></code><code><span>library(Seurat)</span></code><code><span><br></span></code><code><span><br></span></code><code><span>pbmc=readRDS("~/gzh/featureplot_dotplot_vlnplot/pbmc3k_final.rds")</span></code><code><span>DimPlot(pbmc,label=TRUE)</span></code><code><span><br></span></code><code><span><br></span></code><code><span>pbmc$cell_type=pbmc$cell.type</span></code></pre></section><p><strong><span>未更改细胞id之前的umap图</span></strong><br></p><p><img data-galleryid="" data-imgfileid="100001023" data-ratio="0.6919191919191919" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktQhy9htaYapsqzYGbYD1s4mLIxHqEYEP9hMViayAuvF7ocdnicMajgNkJb4wgJ0FibylLjoAic40AbSA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="792" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktQhy9htaYapsqzYGbYD1s4mLIxHqEYEP9hMViayAuvF7ocdnicMajgNkJb4wgJ0FibylLjoAic40AbSA/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>然后我们进行单细胞个性化细胞命名</span></strong></p><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="cs"><code><span><br></span></code><code><span>1# 1 选定自己想要命名的细胞----</span></code><code><span>All.merge=pbmc</span></code><code><span>plot &lt;- DimPlot(All.merge, reduction = "umap") </span></code><code><span>library(dplyr)</span></code><code><span>plot$data %&gt;%head()</span></code><code><span><br></span></code><code><span>select.cells &lt;- CellSelector(plot = plot) #运行到这一步，可以交互式的选择自己想要的细胞</span></code><code><span><br></span></code><code><span><br></span></code></pre></section><p><img data-galleryid="" data-imgfileid="100001021" data-ratio="0.9023622047244094" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktQhy9htaYapsqzYGbYD1s4rON2WhpKc1KKrSxOF1ichibia9SicT9iaXv4gGib3bO8KDFDyiakqWFtXIlWA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="635" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktQhy9htaYapsqzYGbYD1s4rON2WhpKc1KKrSxOF1ichibia9SicT9iaXv4gGib3bO8KDFDyiakqWFtXIlWA/640?wx_fmt=png&amp;from=appmsg"></p><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="cs"><code><span>head(select.cells)</span></code><code><span><br></span></code><code><span># subset_data=subset(All.merge,cells=select.cells)</span></code><code><span># DimPlot(subset_data,label = TRUE)</span></code><code><span># </span></code><code><span># head(All.merge@meta.data)</span></code><code><span># head(subset_data@meta.data)</span></code><code><span><br></span></code><code><span>All.merge=SetIdent(object = All.merge,cells = select.cells ,value = 'B')</span></code><code><span><br></span></code></pre></section><p><strong><span>改完名称之后，结果如下</span></strong></p><p><img data-galleryid="" data-imgfileid="100001022" data-ratio="0.6813048933500627" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktQhy9htaYapsqzYGbYD1s4S5NJL8Uvoqk2xDeTuba1iaFUiaXoD3GIkhMZtawA0w17fR5YQsfUMhlA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="797" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktQhy9htaYapsqzYGbYD1s4S5NJL8Uvoqk2xDeTuba1iaFUiaXoD3GIkhMZtawA0w17fR5YQsfUMhlA/640?wx_fmt=png&amp;from=appmsg"></p><p><strong>这样就完成了单细胞个性化的细胞注释</strong></p><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><p>02</p></section></section></section></section></section></section><section powered-by="xiumi.us"><section><img data-ratio="1.21580547112462" data-s="300,640" data-w="329" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/MVPvEL7Qg0EgrwdibaKqfTqpyFcSD7uE2JcEGETKYmdVA1UNUhbaXBa2qqazjc44k52ezTYYvRyoGAIOgrUNVhg/640?wx_fmt=gif" width="100%" data-imgfileid="100001027" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/MVPvEL7Qg0EgrwdibaKqfTqpyFcSD7uE2JcEGETKYmdVA1UNUhbaXBa2qqazjc44k52ezTYYvRyoGAIOgrUNVhg/640?wx_fmt=gif"></section></section><ul><li><p><strong><span>2. 细分亚群</span></strong></p></li></ul><p><strong><span>紧接着我们演示如何细分亚群</span></strong></p><p><strong><span>这里假如我们想对b细胞进行细分亚群</span></strong></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="objectivec"><code><span>2 #2 细分亚群----</span></code><code><span><br></span></code><code><span>bcell=subset(pbmc,idents = 'B')</span></code><code><span><br></span></code><code><span>DimPlot(bcell,label = TRUE)|DimPlot(pbmc,label = TRUE)</span></code><code><span><br></span></code></pre></section><p><img data-galleryid="" data-imgfileid="100001024" data-ratio="0.5638888888888889" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktQhy9htaYapsqzYGbYD1s41IezyWkdqjnv5gLqpnvrve2MezEOYBHNjibzicp0sOsB8G3NWf4hSGdA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktQhy9htaYapsqzYGbYD1s41IezyWkdqjnv5gLqpnvrve2MezEOYBHNjibzicp0sOsB8G3NWf4hSGdA/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>细分亚群的代码如下</span></strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="perl"><code><span>pbmc=bcell</span></code><code><span><br></span></code><code><span><br></span></code><code><span>{</span></code><code><span><br></span></code><code><span><br></span></code><code><span>  2#2 将 QC 指标可视化为小提琴图----</span></code><code><span>  # [[ 运算符可以向对象 metadata 添加列。这是存储 QC 统计数据的好地方</span></code><code><span>  pbmc[["percent.mt"]] &lt;- PercentageFeatureSet(pbmc, pattern = "^MT-")</span></code><code><span><br></span></code><code><span>  pbmc[["ribosomal.mt"]] &lt;- PercentageFeatureSet(pbmc, pattern = "^RP[SL]")</span></code><code><span>  head(pbmc@meta.data)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span>  VlnPlot(pbmc, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)</span></code><code><span><br></span></code><code><span><br></span></code><code><span>  # FeatureScatter 通常用于可视化特征与特征之间的关系，但也可以用于由对象计算的任何内容，即对象 metadata 中的列、PC 分数等。</span></code><code><span><br></span></code><code><span>  plot1 &lt;- FeatureScatter(pbmc, feature1 = "nCount_RNA", feature2 = "percent.mt")</span></code><code><span>  plot2 &lt;- FeatureScatter(pbmc, feature1 = "nCount_RNA", feature2 = "nFeature_RNA")</span></code><code><span>  plot1 + plot2</span></code><code><span><br></span></code><code><span><br></span></code><code><span>  # 显示前 5 个细胞的 QC 指标</span></code><code><span>  head(pbmc@meta.data, 5)</span></code><code><span><br></span></code><code><span>  #nFeature_RNA is the number of genes detected in each cell.</span></code><code><span>  # nCount_RNA is the total number of molecules detected within a cell. </span></code><code><span>  2.1 #2.1 qc---------</span></code><code><span>  pbmc &lt;- subset(pbmc, subset = nFeature_RNA &gt; 200 &amp; nFeature_RNA &lt; 2500 &amp; percent.mt &lt; 5)</span></code><code><span><br></span></code><code><span><br></span></code><code><span>  3 #3 数据归一化----</span></code><code><span>  pbmc &lt;- NormalizeData(pbmc, normalization.method = "LogNormalize", scale.factor = 10000)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span>  4# 4 识别高变特征（特征选择）----</span></code><code><span>  pbmc &lt;- FindVariableFeatures(pbmc, selection.method = "vst", nfeatures = 2000)</span></code><code><span><br></span></code><code><span>  # 确定前 10 个变异最大的基因</span></code><code><span>  top10 &lt;- head(VariableFeatures(pbmc), 10)</span></code><code><span><br></span></code><code><span>  # 绘制带标签和不带标签的变异特征</span></code><code><span>  plot1 &lt;- VariableFeaturePlot(pbmc)</span></code><code><span>  plot2 &lt;- LabelPoints(plot = plot1, points = top10, repel = TRUE)</span></code><code><span>  plot1 + plot2</span></code><code><span><br></span></code><code><span><br></span></code><code><span>  5 # 5 标准化数据------</span></code><code><span>  all.genes &lt;- rownames(pbmc)</span></code><code><span>  pbmc &lt;- ScaleData(pbmc, features = all.genes)</span></code><code><span><br></span></code><code><span>  5.1</span></code><code><span>  pbmc &lt;- ScaleData(pbmc)</span></code><code><span><br></span></code><code><span>  5.2</span></code><code><span>  head(pbmc@meta.data)</span></code><code><span>  pbmc &lt;- ScaleData(pbmc, vars.to.regress = c('ribosomal.mt', 'percent.mt'))</span></code><code><span><br></span></code><code><span>  #SCTransform()</span></code><code><span><br></span></code><code><span>  6#6 线性降维----</span></code><code><span>  pbmc &lt;- RunPCA(pbmc, features = VariableFeatures(object = pbmc))</span></code><code><span><br></span></code><code><span><br></span></code><code><span>  # 通过几种不同的方式检查和可视化 PCA 结果</span></code><code><span>  print(pbmc[["pca"]], dims = 1:5, nfeatures = 5)</span></code><code><span><br></span></code><code><span>  VizDimLoadings(pbmc, dims = 1:2, reduction = "pca")</span></code><code><span><br></span></code><code><span>  7# 7 确定数据集的维度------</span></code><code><span><br></span></code><code><span>  # 注意：对于大数据集，此过程可能需要很长时间，为了方便起见，请注释掉。更多的近似技术，例如在 ElbowPlot() 中实现的技术，可用于减少计算时间</span></code><code><span>  pbmc &lt;- JackStraw(pbmc, num.replicate = 100)</span></code><code><span>  pbmc &lt;- ScoreJackStraw(pbmc, dims = 1:20)</span></code><code><span><br></span></code><code><span>  ElbowPlot(pbmc)</span></code><code><span><br></span></code><code><span><br></span></code><code><span>  8 #8 细胞聚类\分群-------</span></code><code><span><br></span></code><code><span>  pbmc &lt;- FindNeighbors(pbmc, dims = 1:15)</span></code><code><span>  pbmc &lt;- FindClusters(pbmc, resolution = 1)</span></code><code><span><br></span></code><code><span>  # 查看前 5 个细胞的 cluster IDs</span></code><code><span>  head(Idents(pbmc), 5)</span></code><code><span><br></span></code><code><span>  9#9 运行非线性降维 (UMAP/tSNE)----</span></code><code><span>  # 如果你还没有安装 UMAP，你可以通过 reticulate::py_install(packages = 'umap-learn')</span></code><code><span>  pbmc &lt;- RunUMAP(pbmc, dims = 1:15)</span></code><code><span>  pbmc &lt;- RunTSNE(pbmc, dims = 1:15)</span></code><code><span>  # 请注意，您可以设置 `label = TRUE` 或使用 LabelClusters 函数来帮助标记单个类群</span></code><code><span>  DimPlot(pbmc, reduction = "umap")</span></code><code><span><br></span></code><code><span>  bcell=pbmc</span></code><code><span><br></span></code><code><span><br></span></code><code><span>}</span></code><code><span><br></span></code><code><span><br></span></code></pre></section><p><strong></strong></p><p><strong><span>最后我们就获得了分好群的b细胞。    我们发现分辨率为1时，b细胞可以分为四个亚群，但是否每个亚群都有生物学意义，自行判断哦！</span></strong></p><p><img data-galleryid="" data-imgfileid="100001025" data-ratio="1.011342155009452" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktQhy9htaYapsqzYGbYD1s4ibjtcjsvwSGJEeaoWtzFK7FNS3IM04CHKBy0v5va8kO9Ew8ibvRMqOjw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="529" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktQhy9htaYapsqzYGbYD1s4ibjtcjsvwSGJEeaoWtzFK7FNS3IM04CHKBy0v5va8kO9Ew8ibvRMqOjw/640?wx_fmt=png&amp;from=appmsg"></p><hr><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><p>03</p></section></section></section></section></section></section><section powered-by="xiumi.us"><section><img data-ratio="1.21580547112462" data-s="300,640" data-w="329" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/MVPvEL7Qg0EgrwdibaKqfTqpyFcSD7uE2JcEGETKYmdVA1UNUhbaXBa2qqazjc44k52ezTYYvRyoGAIOgrUNVhg/640?wx_fmt=gif" width="100%" data-imgfileid="100001028" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/MVPvEL7Qg0EgrwdibaKqfTqpyFcSD7uE2JcEGETKYmdVA1UNUhbaXBa2qqazjc44k52ezTYYvRyoGAIOgrUNVhg/640?wx_fmt=gif"></section></section><ul><li><p><strong><span>3. 把细分的b细胞亚群放回原来的总群 （这一部分由于时间紧迫，没在视频里演示，这里我给出代码）</span></strong></p></li></ul><p><strong><span>——现在的问题其实就是如何把b细胞的4个亚群放回总群里</span></strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>#3 把细分的亚群放回原来的总群----</span></code><code><span><br></span></code><code><span>pbmc=readRDS("~/gzh/featureplot_dotplot_vlnplot/pbmc3k_final.rds")</span></code><code><span>dim(bcell)</span></code><code><span>dim(pbmc)</span></code><code><span><br></span></code><code><span>Idents(pbmc, cells = colnames(bcell)) &lt;- Idents(bcell)</span></code><code><span><br></span></code><code><span>DimPlot(pbmc,label = TRUE)</span></code><code><span><br></span></code><code><span><br></span></code></pre></section><p><strong></strong></p><p><img data-galleryid="" data-imgfileid="100001029" data-ratio="0.7805555555555556" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktQhy9htaYapsqzYGbYD1s4fgUsEaS0688evw6IWcTu0o7bP3ft3JGKlXSKapTA6G4GgL1SQBnGXw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktQhy9htaYapsqzYGbYD1s4fgUsEaS0688evw6IWcTu0o7bP3ft3JGKlXSKapTA6G4GgL1SQBnGXw/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>是不是特别简单~</span></strong></p><p><span><strong>如果你看不懂今天的教程，那你可以看下前三场视频热热身，再回来看哦~</strong></span></p><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247484627&amp;idx=2&amp;sn=ef098ff5ff88d4ef49304dad02ca351c&amp;chksm=ce646a3af913e32c23be312723f1fb92d8bb30de13ef990df94664247231bb6c1ff1f7e2f9b8&amp;scene=21#wechat_redirect" textvalue="单细胞直播一理解seurat数据结构与pbmc处理流程" linktype="text" imgurl="" imgdata="null" data-itemshowtype="5" tab="innerlink" data-linktype="2"><strong><span>单细胞直播一理解seurat数据结构与pbmc处理流程</span></strong></a><br></p><ul data-tool="mdnice编辑器"></ul><p><strong><span><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247484627&amp;idx=3&amp;sn=252dd1e2f90e789e8319767063461d48&amp;chksm=ce646a3af913e32cd743b0f885ae3e1d326ea2ac9cbc21b3cc391e496e490c354bf77cb545e1&amp;scene=21#wechat_redirect" textvalue="单细胞直播二从GSE104154中理解seurat结构" linktype="text" imgurl="" imgdata="null" data-itemshowtype="5" tab="innerlink" data-linktype="2">单细胞直播二从GSE104154中理解seurat结构</a></span></span></strong></p><p><strong><span><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247484627&amp;idx=4&amp;sn=95b0fc04c59cb2fafa481e66a452e2f5&amp;chksm=ce646a3af913e32c71b02593d1d016d85eb6884af7b54a372eab79e93606d965ef7f393a10f2&amp;scene=21#wechat_redirect" textvalue="单细胞直播三seurat数据结构与数据可视化" linktype="text" imgurl="" imgdata="null" data-itemshowtype="5" tab="innerlink" data-linktype="2">单细胞直播三seurat数据结构与数据可视化</a></span></span></strong></p><p><img data-imgfileid="100001036" data-ratio="1" data-type="gif" data-w="240" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"><br></p><p><img data-imgfileid="100001035" data-ratio="0.05278592375366569" data-type="other" data-w="341" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“赞”</span></strong></span><strong><span>哦！</span></strong></p><p><strong><br></strong></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/z2mPfyiETtQ_BqZA4E0YWQ",target="_blank" rel="noopener noreferrer">原文链接</a>
