---
title: "使用Seurat的v5来读取多个10x的单细胞转录组矩阵"
date: 2023-12-24T01:26:12Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
使用Seurat的v5来读取多个10x的单细胞转录组矩阵 by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>前面我们在 <a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247518295&amp;idx=1&amp;sn=f97bd58d2c21122ba5c7d250f7fa709e&amp;scene=21#wechat_redirect" data-linktype="2">初试Seurat的V5版本</a> 的推文里面演示了文章标题是：《CD36+ cancer-associated fibroblasts provide immunosuppressive microenvironment for hepatocellular carcinoma via secretion of macrophage migration inhibitory factor》，的数据集GSE202642的Seurat的v5读取方式。</p></blockquote><p data-tool="mdnice编辑器">它虽然说是多样品，但是被作者整理成为了一个10x的样品的3文件格式， 所以很容易读取。接下来我们演示真正的Seurat的v5来读取多个10x的单细胞转录组矩阵。数据集在 https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE162616 可以看到作者给出来的矩阵还算是<strong>10X文件的3个标准文件</strong>，但是在每个样品下面都是3个文件，就是需要合理的修改文件名字而已：</p><p><img data-galleryid="" data-imgfileid="100034656" data-ratio="1.0888888888888888" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTpxg5QsEJcurLhD5OVfkRqqZEiaEKhjQicFsoUAVaOXUzz8ASlcoJek5Giaakc6u61YOibUAjFAlCroQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTpxg5QsEJcurLhD5OVfkRqqZEiaEKhjQicFsoUAVaOXUzz8ASlcoJek5Giaakc6u61YOibUAjFAlCroQ/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>作者给出来的矩阵</figcaption></figure><p data-tool="mdnice编辑器">我们修改后是每个样品一个文件夹，每个文件夹里面的是<strong>10X文件的3个标准文件</strong>，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>$ tree -h GSE162616_RAW/outputs/<br>GSE162616_RAW/outputs/<br>|-- [   0]  HCC1<br>|   |-- [ 86K]  barcodes.tsv.gz<br>|   |-- [298K]  features.tsv.gz<br>|   `-- [ 84M]  matrix.mtx.gz<br>|-- [   0]  HCC2<br>|   |-- [ 51K]  barcodes.tsv.gz<br>|   |-- [298K]  features.tsv.gz<br>|   `-- [ 50M]  matrix.mtx.gz<br>`-- [   0]  HCC3<br>    |-- [ 77K]  barcodes.tsv.gz<br>    |-- [298K]  features.tsv.gz<br>    `-- [ 76M]  matrix.mtx.gz<br><br>3 directories, 9 files<br></code></pre><p data-tool="mdnice编辑器">如果我们按照之前Seurat的V4版本读取，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>dir=<span>'GSE162616_RAW/outputs/'</span> <br>samples=list.files( dir  )<br>samples <br><br><span>library</span>(data.table)<br>sceList = lapply(samples,<span>function</span>(pro){ <br>  <span># pro=samples[1] </span><br>  print(pro) <br>  sce=CreateSeuratObject(counts =  Read10X(file.path(dir,pro) ) ,<br>                         project =  pro ,<br>                         min.cells = <span>5</span>,<br>                         min.features = <span>300</span>,)<br>  <br>  <span>return</span>(sce)<br>})<br><br>names(sceList)  <br><span>library</span>(stringr)<br><span># samples=gsub('.txt.gz','',str_split(samples,'_',simplify = T)[,2])</span><br>samples<br><br>names(sceList) =  samples<br><br>sce.all &lt;- merge(sceList[[<span>1</span>]], y= sceList[ -<span>1</span> ] ,<br>                 add.cell.ids =  samples) <br><br>as.data.frame(sce.all@assays$RNA$counts[<span>1</span>:<span>10</span>, <span>1</span>:<span>2</span>])<br><span>#  only the first layer is used</span><br>head(sce.all@meta.data, <span>10</span>)<br>table(sce.all@meta.data$orig.ident) <br></code></pre><p data-tool="mdnice编辑器">上面的代码我写了有好多年了，一直没有更新或者改进，我们依赖于这个V4的版本的Seurat流程做出来了大量的公共数据集的单细胞转录组降维聚类分群流程，100多个公共单细胞数据集全部的处理，链接：https://pan.baidu.com/s/1MzfqW07P9ZqEA_URQ6rLbA?pwd=3heo但是最近其官方版本成为了V5……</p><p data-tool="mdnice编辑器">因为现在是Seurat的V5版本，多个文件如果是分开读取后的merge函数其实并没有把每个样品的表达量矩阵merge，如下所示：</p><p><img data-galleryid="" data-imgfileid="100034653" data-ratio="0.6204724409448819" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTpxg5QsEJcurLhD5OVfkRqVRqRTE9LiaMib7ibiaRPITXicFAaj8LO9Vic0yhsl8Maib91RW6F2dJwgPaRA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="635" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTpxg5QsEJcurLhD5OVfkRqVRqRTE9LiaMib7ibiaRPITXicFAaj8LO9Vic0yhsl8Maib91RW6F2dJwgPaRA/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">可以看到，在Seurat对象里面的每个样品仍然是独立的矩阵。。。。</p><p data-tool="mdnice编辑器">这样的话，后面的流程就走不下去了，我们这个时候有一个很简单的方法就可以避免分开读取后的merge ，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>tmp = list.dirs(<span>'GSE162616_RAW/outputs/'</span>)[-<span>1</span>]<br>tmp<br>ct = Read10X(tmp) <br>sce.all=CreateSeuratObject(counts = ct  , <br>                       min.cells = <span>5</span>,<br>                       min.features = <span>300</span>,)<br></code></pre><p data-tool="mdnice编辑器">其实是因为这个函数Read10X可以一次性读取多个合理的路径，所以我们的如下所示的3个样品就被统一读取成为了一个稀疏矩阵而不是每个样品独立的稀疏矩阵，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; tmp<br>[1] <span>"GSE162616_RAW/outputs/HCC1"</span><br>[2] <span>"GSE162616_RAW/outputs/HCC2"</span><br>[3] <span>"GSE162616_RAW/outputs/HCC3"</span><br></code></pre><p><img data-galleryid="" data-imgfileid="100034654" data-ratio="0.6843373493975904" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTpxg5QsEJcurLhD5OVfkRqDW7Z63jAH1qiakUtPGuiclAaYSNaCJMFkAQepAJFRrSboX2RdzkAfLwg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="830" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTpxg5QsEJcurLhD5OVfkRqDW7Z63jAH1qiakUtPGuiclAaYSNaCJMFkAQepAJFRrSboX2RdzkAfLwg/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>统一读取成为了一个稀疏矩阵</figcaption></figure><p data-tool="mdnice编辑器">如果是对函数或者Seurat对象结构不清晰，就会产生如下所示错误的读取方式：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; sce.all=CreateSeuratObject(counts = Read10X(<span>'GSE162616_RAW/outputs/'</span>)   , <br>+                            min.cells = 5,<br>+                            min.features = 300,)<br>Error <span>in</span> Read10X(<span>"GSE162616_RAW/outputs/"</span>) : <br>  Barcode file missing. Expecting barcodes.tsv.gz<br></code></pre><p data-tool="mdnice编辑器">这个 Read10X 函数能够接受一个或者多个合理的路径，合理的路径就是说里面有<strong>10X文件的3个标准文件</strong>，是不是很简单啊？</p><p data-tool="mdnice编辑器">后面我们还会演示如何读取多个单细胞转录组样品，但是这些样品的矩阵并不是10x的3文件格式，所以会更麻烦一点！</p></section><section data-style-type="5" data-tools="新媒体排版" data-id="2440476"><section><section><section><section><img data-imgfileid="100034661" data-ratio="0.9495798319327731" data-type="gif" data-w="119" data-width="100%" data-src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section><section data-brushtype="text">往期回顾</section><section><br></section></section></section></section><section><section data-autoskip="1"><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247518188&amp;idx=1&amp;sn=642101ab94e0053dbcf52543f0cef3c0&amp;chksm=ea1c816edd6b087802ca0171fab46d6bbc90b0f8aba6eee29082547259d8f72cff47c67faf9a&amp;scene=21#wechat_redirect" textvalue="单细胞和空间分析揭示在结直肠癌中FAP+成纤维细胞和SPP1+巨噬细胞的相互作用" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>单细胞和空间分析揭示在结直肠癌中FAP+成纤维细胞和SPP1+巨噬细胞的相互作用</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247518136&amp;idx=1&amp;sn=62a77b631a8ce12fc26a7bd76b15b06d&amp;chksm=ea1c813add6b082ca5fadf1e1d31f7597af38dc01d3c63e935e0b390bf196682bba1c148ef66&amp;scene=21#wechat_redirect" textvalue="这两个疾病的患者的PBMC跟正常人的在单细胞转录组水平差异很大吗" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>这两个疾病的患者的PBMC跟正常人的在单细胞转录组水平差异很大吗</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247518126&amp;idx=1&amp;sn=c6a3466c8ccb99bd26c0359b80d046e5&amp;chksm=ea1c812cdd6b083ac106ab6406a8d4d3e9d9ada3c5af67c90deaacea55e143d91b9bf4f4c82f&amp;scene=21#wechat_redirect" textvalue="这种级别的单细胞数据公开了也很难有人使用" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>这种级别的单细胞数据公开了也很难有人使用</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247518116&amp;idx=1&amp;sn=7368ea01c71d5da6d22c9098a493c147&amp;chksm=ea1c8126dd6b0830ef79f146f2b572994190d3d68a6adfd7e4d1916b58660c9423327756d4b4&amp;scene=21#wechat_redirect" textvalue="CellTypist进行免疫细胞注释" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1"><span>CellTypist进行免疫细胞注释</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247516824&amp;idx=1&amp;sn=86f24a931da03ccb5b5e60fc016bfc5c&amp;chksm=ea1c841add6b0d0c56b29df0031264a484f9f00feb5910438db2b5e2f5c7ef01a32eafbd0206&amp;scene=21#wechat_redirect" textvalue="端到端的单细胞管道SCP-标准流程" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>端到端的单细胞管道SCP-标准流程</span></a><br></p></section></section><hr><p><br></p></section><section data-style-type="5" data-tools="新媒体排版" data-id="2440475"><hr><p><br></p><hr><section><p>如果你对单细胞转录组研究感兴趣，但又不知道如何入门，也许你可以关注一下下面的课程<span></span></p><p><br></p><ul><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526646&amp;idx=1&amp;sn=d1728d9102f72d2ce5c425162549499d&amp;chksm=9b4b284dac3ca15b83972f3dcb45977fc78eb65b607e7961658f8586f8a4b7be2c2c43883684&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课12月班" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信入门&amp;数据挖掘线上直播课12月班</a><br></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526168&amp;idx=1&amp;sn=ebc4a9d53d675e3f7d20b1e2f97901b8&amp;chksm=9b4b27a3ac3caeb5ee0828c38f816c229067d1946be224bcaf4bac0dbdfc9eff863c621097e2&amp;scene=21#wechat_redirect" textvalue="生物信息学江湖的开创性产品-共享服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学江湖的开创性产品-共享服务器</a></p></li></ul><p><img data-imgfileid="100034657" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" data-type="gif" data-w="240" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"><br></p><p><img data-imgfileid="100034660" data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="other" data-w="341" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p></section><section><section data-id="93668"><section><section data-width="95%"><section><section><section data-width="38%"><section><section data-tools="135编辑器" data-id="93668"><section><section data-width="95%"><section><section><section data-width="61.8%"><section><section><section><p><br></p><span><strong data-burshtype="text"><img data-copyright="0" data-cropselx1="0" data-cropselx2="109" data-cropsely1="0" data-cropsely2="109" data-imgfileid="100034659" data-ratio="1" data-type="other" data-w="258" title="qrcode_for_gh_5a3c482ed99f_1280.jpg" data-src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"><strong data-burshtype="text">生物</strong><strong data-burshtype="text"> | 单细胞 | 转录组丨资料</strong></strong></span></section><section><span><strong data-burshtype="text">每天都精彩</strong></span></section></section></section><section><section><section><section><section><section><p><span>长按扫码可关注</span></p></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Lxnm0SdaPgA3a15HYbVZDw",target="_blank" rel="noopener noreferrer">原文链接</a>
