---
title: "让你的火山图加上蛋白互作信息"
date: 2023-12-20T14:53:41Z
draft: ["false"]
tags: [
  "fetched",
  "生信碱移"
]
categories: ["Acdemic"]
---
让你的火山图加上蛋白互作信息 by 生信碱移
------
<div><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-ratio="1.0324675324675325" data-src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1" data-type="gif" data-w="154" src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1"></section></section></section></section></section><section><section powered-by="xiumi.us"><section><p><span>老铁们快点击蓝字 <strong>关注起来</strong></span></p></section></section></section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-ratio="1.0324675324675325" data-src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1" data-type="gif" data-w="154" src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1"></section></section></section></section></section></section></section></section></section><section data-mpa-powered-by="yiban.io" data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)" data-style='white-space: normal; max-width: 100%; letter-spacing: 0.544px; text-size-adjust: auto; background-color: rgb(255, 255, 255); font-family: "Helvetica Neue", Helvetica, "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;'><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-id="85660" data-custom="rgb(117, 117, 118)" data-color="rgb(117, 117, 118)" data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-id="85660" data-custom="rgb(117, 117, 118)" data-color="rgb(117, 117, 118)" data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><section data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)" data-style="margin-top: 2em; padding-top: 0.5em; padding-bottom: 0.5em; max-width: 100%; border-style: solid none; text-decoration: inherit; border-top-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-top-width: 1px; border-bottom-width: 1px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><p data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)"><span>生信碱移</span></p><section><strong>火山图+PPI互作</strong></section></section></section></section></section></section></section></section></section></section></section></section><blockquote data-type="2" data-url="" data-author-name="" data-content-utf8-length="68" data-source-title="" data-darkmode-bgcolor-16095509242984="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16095509242984="rgb(255, 255, 255)" data-darkmode-color-16095509242984="rgba(163, 163, 163, 0.498)" data-darkmode-original-color-16095509242984="rgba(0, 0, 0, 0.498)" data-style='color: rgba(0, 0, 0, 0.498); white-space: normal; max-width: 100%; letter-spacing: 0.544px; font-family: -apple-system-font, system-ui, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif; background-color: rgb(255, 255, 255); box-sizing: border-box !important; overflow-wrap: break-word !important;'><section><span>火山图是差异分析的常见可视化方式，但它携带的信息实在是太少了，甚至没有放进论文组图的必要。在这里，小编考虑到火山图的散点比较多，估摸着能把蛋白互作 (PPI) 信息也一起放进去。</span></section></blockquote></section><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><h3 data-tool="markdown.com.cn编辑器"><span>一、数据准备与R包引用</span></h3><h5 data-tool="markdown.com.cn编辑器"><span>1.R 包引用</span>：</h5><pre data-tool="markdown.com.cn编辑器"><span></span><code><span>library</span>(ggplot2)<br><span>library</span>(ggsci)<br><span>library</span>(tidyverse)<br><span>library</span>(tidydr)<br></code></pre><h5 data-tool="markdown.com.cn编辑器"><span>2.输入数据</span>：</h5><pre data-tool="markdown.com.cn编辑器"><code><span># 差异表格数据读入</span><br>Diff &lt;- read.csv(file = <span>"Diff.csv"</span>, row.names = <span>1</span>)<br><span># ppi蛋白交互数据</span><br>ppiLink &lt;- read.table(<span>"9606.protein.links.v12.0.txt"</span>, header = <span>T</span>, sep = <span>" "</span>)<br>ppiAnn_fristP &lt;- read.table(<span>"9606.protein.info.v12.0.txt"</span>, header = <span>F</span>, sep = <span>"\t"</span>)[, c(<span>1</span>,<span>2</span>)]<br>colnames(ppiAnn_fristP) &lt;- c(<span>"protein1"</span>, <span>"geneName1"</span>)<br>ppiAnn_secondP &lt;- read.table(<span>"9606.protein.info.v12.0.txt"</span>, header = <span>F</span>, sep = <span>"\t"</span>)[, c(<span>1</span>,<span>2</span>)]<br>colnames(ppiAnn_secondP) &lt;- c(<span>"protein2"</span>, <span>"geneName2"</span>)<br>ppi_all &lt;- merge(ppiLink, ppiAnn_fristP, by = <span>"protein1"</span>) %&gt;% merge(ppiAnn_secondP, by = <span>"protein2"</span>)<br>ppi_all &lt;- ppi_all[,c(<span>4</span>, <span>5</span>, <span>3</span>)]<br>head(ppi_all)<br>rm(ppiLink, ppiAnn_fristP, ppiAnn_secondP)<br></code></pre><section>输入文件中9606开头的文件是来自PPI数据库的蛋白互作信息和注释，在示例文件中同样提供，铁子们可以直接copy使用。另外，示例使用的 <span>Diff.csv</span> 是 DESeq2差异分析的输出表格，其它差异分析方法的表格也基本一致，只需匹配好列名（表头如下）：</section><p><img data-galleryid="" data-imgfileid="100007976" data-ratio="0.6928934010152284" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeW7dtFG1dJq7n9niaYSTvwibfeWhQiaHYMcmy49sFwxp9dPW4lomRc8yDSgTRPGBGktXxhgKAf8au3Mw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="788" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeW7dtFG1dJq7n9niaYSTvwibfeWhQiaHYMcmy49sFwxp9dPW4lomRc8yDSgTRPGBGktXxhgKAf8au3Mw/640?wx_fmt=png&amp;from=appmsg"></p><h3 data-tool="markdown.com.cn编辑器"><span>二、可视化</span></h3><h5 data-tool="markdown.com.cn编辑器"><span>1.显著差异基因的阈值设置</span>：</h5><pre data-tool="markdown.com.cn编辑器"><span></span><code><span>#火山图差异标记颜色标准设置</span><br>adjPval &lt;- <span>0.05</span>         <span># 矫正p值</span><br>aflogFC &lt;- <span>1</span>             <span># logFC</span><br>Significant &lt;- ifelse((Diff$padj&lt;adjPval &amp; abs(Diff$log2FoldChange)&gt;aflogFC), ifelse(Diff$log2FoldChange&gt;aflogFC,<span>"Up"</span>,<span>"Down"</span>), <span>"Not"</span>)<br></code></pre><h5 data-tool="markdown.com.cn编辑器"><span>2.数据提取与可视化(见注释)</span>：</h5><pre data-tool="markdown.com.cn编辑器"><span></span><code><span># 提取在Diff中出现的基因</span><br>ppi_line &lt;- ppi_all[which(ppi_all$geneName1%<span>in</span>%rownames(Diff[!Significant==<span>"Not"</span>,]) &amp; ppi_all$geneName2%<span>in</span>%rownames(Diff[!Significant==<span>"Not"</span>,])), ]<br><span># 循环提取交互信息</span><br>line_res &lt;- sapply(as.list(<span>1</span>:nrow(ppi_line)), <span>function</span>(x, Diff, ppi_line){<br>  index1 &lt;- which(rownames(Diff)==ppi_line$geneName1[x])<br>  index2 &lt;- which(rownames(Diff)==ppi_line$geneName2[x])<br>  <span>return</span>(c(Diff$log2FoldChange[index1], -log10(Diff$padj)[index1], Diff$log2FoldChange[index2], -log10(Diff$padj)[index2]))<br>}, Diff=Diff[!Significant==<span>"Not"</span>,], ppi_line=ppi_line)<br><span># 计算DC值</span><br>ppi_all &lt;- ppi_all[ppi_all$geneName1 %<span>in</span>% rownames(Diff)[!Significant==<span>"Not"</span>],]<br>DC &lt;- as.data.frame(table(ppi_all$geneName1))<br>rownames(DC) &lt;- DC$Var1<br>DCnum &lt;- ifelse(rownames(Diff) %<span>in</span>% rownames(DC), <span>1</span>, <span>0</span>)<br>DCnum[which(rownames(Diff) %<span>in</span>% rownames(DC))] &lt;- (DC[rownames(Diff)[which(rownames(Diff) %<span>in</span>% rownames(DC))], ])[,<span>2</span>]<br>Diff$DCscore &lt;- DCnum<br>Diff$DCscore &lt;- (Diff$DCscore/max(Diff$DCscore))*<span>3</span><br><span>#write.csv(Diff, "Diff_result.csv", row.names = T)   # 将每个显著差异基因的dc值储存</span><br><span># 根据DC值标记名称</span><br>for_label &lt;- Diff[!Significant==<span>"Not"</span>,]<br>for_label &lt;- for_label[abs(for_label$log2FoldChange) &gt; <span>2</span> &amp; for_label$padj &lt; <span>1e-64</span>,] <span># 先根据logFC和padj进一步筛选</span><br>for_label &lt;- for_label[order(for_label$DCscore, decreasing = <span>T</span>)[<span>1</span>:<span>20</span>],]  <span># 剩余基因中前20个dc最大的基因</span><br>for_label$hubGene &lt;- rownames(for_label)<br>Diff$hubGene &lt;- rownames(Diff)<br><span># 进行绘图</span><br>rownames(line_res) &lt;- c(<span>"x"</span>, <span>"y"</span>, <span>"xend"</span>, <span>"yend"</span>)<br>line_res &lt;- t(line_res)%&gt;%as.data.frame()<br>line_res$combined_score &lt;- (ppi_line$combined_score/max(ppi_line$combined_score))*<span>0.5</span><br><span>#开始绘制</span><br>p  &lt;-  ggplot(Diff, aes(log2FoldChange, -log10(padj)))<br>p &lt;- p+geom_segment(data=line_res, aes(x=x, y=y, xend=xend, yend=yend), color=<span>"yellow3"</span>, size=<span>0.3</span>, alpha=<span>0.1</span>)<br>p &lt;- p+<br>  geom_point(aes(col=Significant, size=DCscore))+<br>  scale_color_manual(values=c(ggsci::pal_nejm()(<span>2</span>)[<span>2</span>], <span>"#838B8B"</span>, ggsci::pal_nejm()(<span>2</span>)[<span>1</span>]))+<br>  labs(title = <span>" "</span>)+<br>  theme(plot.title = element_text(size = <span>16</span>, hjust = <span>0.5</span>, face = <span>"bold"</span>))+<br>  geom_hline(aes(yintercept=-log10(adjPval)), colour=<span>"black"</span>, linetype=<span>"twodash"</span>,size=<span>0.5</span>)+<br>  geom_vline(aes(xintercept=aflogFC), colour=<span>"black"</span>, linetype=<span>"twodash"</span>,size=<span>0.5</span>)+<br>  geom_vline(aes(xintercept=-aflogFC), colour=<span>"black"</span>, linetype=<span>"twodash"</span>,size=<span>0.5</span>)+<br>  theme_dr(xlength = <span>0.1</span>, ylength = <span>0.1</span>) + theme(panel.grid=element_blank())+<br>  scale_size(range = c(<span>0.5</span>, <span>5</span>))+<br>  ggrepel::geom_text_repel(<br>    aes(label = hubGene),<br>    data = for_label,<br>    color=<span>"black"</span>,<br>    <span>#label.size =0.01, </span><br>    <span>#max.overlaps = Inf,</span><br>    size = <span>2.5</span>,<br>    force = <span>10</span><br>  )<br>p<br><span>#ggsave("Diff_volcanoPlot.pdf", width = 6, height = 5)    # 保存文件时需要去除井号键</span><span></span></code></pre></section><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><section><img data-backh="428" data-backw="518" data-galleryid="" data-imgfileid="100007983" data-ratio="0.8258655804480651" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeW7dtFG1dJq7n9niaYSTvwibfX0zuam5Ob45xPzO0T3GzxrsNE8e3KHrSGzB6wIUPiahJeJsUCia21fAQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="982" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeW7dtFG1dJq7n9niaYSTvwibfX0zuam5Ob45xPzO0T3GzxrsNE8e3KHrSGzB6wIUPiahJeJsUCia21fAQ/640?wx_fmt=png&amp;from=appmsg"></section><p><span><strong><span><strong><span><br></span></strong></span></strong></span></p><p><span><strong><span><strong><span>感兴趣的铁子可以试试</span></strong></span></strong></span></p><p><span><strong><span><strong><span>后台回复 </span></strong></span></strong></span><span><strong><span><strong>PPI火山图</strong></span></strong></span><span><strong><span><strong><span> </span></strong></span></strong></span><span><strong><span><strong><span></span></strong></span></strong></span></p><p><span><strong><span><strong><span><strong><span><strong><span>即可获得示例代码与文件</span></strong></span></strong></span></strong></span></strong></span></p><p><span><strong><span><strong><span><strong><span><strong><span>就分享到这<img data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Yellowdog.png" data-ratio="1" data-w="128" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Yellowdog.png"><img data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/smiley_83b.png" data-ratio="1" data-w="128" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/smiley_83b.png"><br></span></strong></span></strong></span></strong></span></strong></span></p><p><br></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzkyNTIzMzYyMA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/LvUIqvYKCeXYZNMxRMnjiaicO2a27jDZ2FgQga8TdeQcsGRJRIn2IInkKtfcbbMXOBSViaPXpTOBulUlNzd11pzow/300?wx_fmt=png&amp;wxfrom=19" data-nickname="生信碱移" data-alias="liudoufu307" data-signature="春来秋至，分享我的所见与所识" data-from="2" data-is_biz_ban="0" data-origin_num="265" data-isban="0" data-biz_account_status="0" data-index="0"></mp-common-profile></section><section><strong><span>END~</span></strong><br></section><p><span><strong>仅供粉丝老铁们参考</strong></span><strong></strong></p><p><strong>如转载请注明来源 ~</strong></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/6Bl24lA5HKRnDPpRPh5sCg",target="_blank" rel="noopener noreferrer">原文链接</a>
