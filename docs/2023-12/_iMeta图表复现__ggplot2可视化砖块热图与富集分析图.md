---
title: "[iMeta图表复现] ggplot2可视化砖块热图与富集分析图"
date: 2023-12-16T15:58:24Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
[iMeta图表复现] ggplot2可视化砖块热图与富集分析图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节通过iMeta上的一张图，来介绍如何使用ggbrick包来可视化实际数据，整个过程仅参考。希望对各位观众老爷能有所帮助。<strong>「数据代码已经整合上传到2023VIP交流群」</strong>，加群的观众老爷可自行下载，有需要的朋友可关注文末介绍加入VIP交流群。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>论文</span><span></span></h3><p data-tool="mdnice编辑器"><img data-imgfileid="100024916" data-ratio="0.29074074074074074" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPvmBkPQu9icrFiaFjiaf6Pfiane1QS5jwHM60dLfwbKPOLn7BnuB6Su6Gb8qaUYD1hJLMtbKia1M6Yfg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPvmBkPQu9icrFiaFjiaf6Pfiane1QS5jwHM60dLfwbKPOLn7BnuB6Su6Gb8qaUYD1hJLMtbKia1M6Yfg/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100024919" data-ratio="1.1814595660749507" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPvmBkPQu9icrFiaFjiaf6PfiasiadQ8icnd2QBowdE9JqXF5OvlSDhibRzxqJeoskul0JDVDH0GW3dNGHw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1014" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPvmBkPQu9icrFiaFjiaf6PfiasiadQ8icnd2QBowdE9JqXF5OvlSDhibRzxqJeoskul0JDVDH0GW3dNGHw/640?wx_fmt=png&amp;from=appmsg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关于永久群内容的说明</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>给予长期支持我们的忠实读者们一个特别待遇：凡是购买过小编2022年或2023年VIP会员文档的朋友们，<strong>「将自动获得2024年及以后更新的绘图文档代码，无需额外付费。」</strong>目前这两年的会员文档已累记卖出1500+，质量方面各位无需担忧。简要概括就是只要购买任意1年的会员内容，2024及后期公众号所更新的绘图文档均会在已经加入的会员群内分享。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(readxl)<br><span># devtools::install_github("doehm/ggbrick")</span><br><span>library</span>(ggbrick)<br><span>library</span>(scales)<br><span>library</span>(MetBrewer)<br><span>library</span>(patchwork)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>R包版本</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-imgfileid="100024917" data-ratio="0.1527777777777778" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPvmBkPQu9icrFiaFjiaf6Pfia9YBibHXVLJJV5qdWQftTawHM5YzxScrK3st96JWPlXFhg5MKicNhv9Vg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPvmBkPQu9icrFiaFjiaf6Pfia9YBibHXVLJJV5qdWQftTawHM5YzxScrK3st96JWPlXFhg5MKicNhv9Vg/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- read_excel(<span>"Source Data Figure 3.xlsx"</span>,sheet = <span>3</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>dff &lt;- df %&gt;% mutate(Cluster=str_replace_all(Cluster,c(<span>"Cluster"</span> = <span>"C"</span>)),<br>                     summit=summit/<span>10000000</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>定义因子</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>dff$Cluster &lt;- factor(dff$Cluster,levels=rev(c(<span>"C1"</span>,<span>"C2"</span>,<span>"C3"</span>,<span>"C4"</span>,<span>"C5"</span>,<br>                                           <span>"C6"</span>,<span>"C7"</span>,<span>"C8"</span>,<span>"C9"</span>,<span>"C10"</span>,<span>"C11"</span>,<span>"C12"</span>)))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>绘制华夫热图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>plot1 &lt;- dff %&gt;%<br>  ggplot(aes(Cluster,summit)) +   <br>  geom_brick(aes(Cluster,summit,fill =Type), colour = <span>NA</span>, size = <span>0.2</span>)  +<br>  scale_y_continuous(labels = label_number(),position = <span>"right"</span>,expand = c(<span>0</span>,<span>0</span>))+<br>  scale_x_discrete(expand = c(<span>0</span>,<span>0</span>))+<br>  labs(y=<span>"Number of OCRs"</span>,x=<span>NULL</span>,fill =<span>NULL</span>) +<br>  scale_fill_manual(values=c(<span>"#788FCE"</span>,<span>"#E6956F"</span>,<span>"#A6BA96"</span>))+<br>  coord_flip()+<br>  theme_classic()+<br>  theme(axis.text.x = element_text(color=<span>"black"</span>, size=<span>8</span>, face=<span>"bold"</span>),<br>        axis.text.y = element_text(color=<span>"black"</span>, size=<span>8</span>, face=<span>"bold"</span>),<br>        plot.background = element_rect(fill =<span>"white"</span>, colour =<span>"white"</span>),   <span># 设置图表背景为白色</span><br>        plot.margin = margin(b = <span>5</span>, t = <span>5</span>, r = <span>5</span>, l = <span>5</span>),   <span># 设置图表的边距</span><br>        legend.text = element_text(color=<span>"black"</span>,size=<span>8</span>, face=<span>"bold"</span>),<br>        legend.background = element_blank(),<br>        legend.key.height = unit(<span>0.5</span>,<span>"cm"</span>),<br>        legend.key.width = unit(<span>0.5</span>,<span>"cm"</span>),<br>        legend.position = c(<span>0.4</span>,<span>0.1</span>))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>p2 &lt;- read_excel(<span>"Source Data Figure 3.xlsx"</span>,sheet = <span>4</span>)<br><br>df &lt;-  p2 %&gt;% mutate(<span>"-log10(p.adjust)"</span>=-log10(p.adjust),<br>                     cluster=str_replace_all(cluster,c(<span>"Cluster"</span> = <span>"C"</span>))) %&gt;% <br>  select(<span>2</span>,<span>9</span>,<span>10</span>,<span>12</span>)<br><br>df$cluster &lt;- factor(df$cluster,levels=(c(<span>"C1"</span>,<span>"C2"</span>,<span>"C3"</span>,<span>"C4"</span>,<br>                                               <span>"C6"</span>,<span>"C7"</span>,<span>"C9"</span>,<span>"C10"</span>,<span>"C11"</span>)))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>绘制富集分析点图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>plot2 &lt;- df %&gt;% ggplot(.,aes(cluster,Description,size=Count,fill=`-log10(p.adjust)`))+<br>  geom_point(shape=<span>21</span>)+<br>  labs(x = <span>NULL</span>,y = <span>NULL</span>,color=<span>NULL</span>) +<br>  scale_fill_gradientn(colors=met.brewer(<span>"Cassatt1"</span>))+<br>  theme_bw()+<br>  theme(axis.text.x=element_text(color=<span>"black"</span>),<br>        axis.text.y=element_text(color=<span>"black"</span>),<br>        panel.background = element_blank(),<br>        panel.border = element_rect(fill=<span>NA</span>,color=<span>"grey80"</span>,size=<span>1</span>, linetype=<span>"solid"</span>))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>拼图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>plot1+plot2+plot_layout(width=c(<span>1.5</span>,<span>1</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100024918" data-ratio="0.8675925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPvmBkPQu9icrFiaFjiaf6PfiaYTKORbOsqwmbeqkAjPjfQ8qpdv7Fnyc3S4xTiclgdYP4KZwtiaqyibcCA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPvmBkPQu9icrFiaFjiaf6PfiaYTKORbOsqwmbeqkAjPjfQ8qpdv7Fnyc3S4xTiclgdYP4KZwtiaqyibcCA/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节介绍到此结束，有需要学习数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>下单购买，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，无论购买那一年的会员文档都将获取<strong>「2024年及以后更新的绘图文档」</strong>，早买早享受，需要了解更多信息的朋友欢迎淘宝店铺交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝扫一扫</span><span></span></h3><p><img data-galleryid="" data-imgfileid="100024943" data-ratio="1.5823529411764705" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPvmBkPQu9icrFiaFjiaf6Pfia3dgD0aOyYTGUVEWCn0tTsic0I3vmHWLsBWLcmMEQVT7zMoQ0JuA2QDw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="680" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPvmBkPQu9icrFiaFjiaf6Pfia3dgD0aOyYTGUVEWCn0tTsic0I3vmHWLsBWLcmMEQVT7zMoQ0JuA2QDw/640?wx_fmt=png&amp;from=appmsg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺(有需要欢迎关注)</span><span></span></h3><p><img data-galleryid="" data-imgfileid="100019415" data-ratio="1.0210420841683367" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg" data-type="jpeg" data-w="998" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/brXLA7xx716NzIwsRSCDGA",target="_blank" rel="noopener noreferrer">原文链接</a>
