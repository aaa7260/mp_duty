---
title: "基因UTR区域以及第1个exon长度分析"
date: 2022-10-14T02:36:04Z
draft: ["false"]
tags: [
  "fetched",
  "生信小知识"
]
categories: ["Acdemic"]
---
基因UTR区域以及第1个exon长度分析 by 生信小知识
------
<div><section><h2><span>基因UTR区域以及第1个exon长度分析</span></h2><blockquote><p>微信公众号：<strong>生信小知识</strong><br>关注可了解更多的生物信息学教程及知识。问题或建议，请公众号留言;</p></blockquote><h3><span>目录</span></h3><p><span><span>前言</span></span><span><span>1. gtf文件格式讲解</span></span><span><span>2. 5UTR和1st exon长度计算</span></span><span><span>后记</span></span></p><h3><span>前言</span></h3><p>在做基因区域注释时，我突然想到，根据基因的结构图：</p><p><img data-galleryid="" data-ratio="0.5392428439519852" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJrMTgM5rbKF5Puh3Hf3wCfkgYbJC3mJbwEfqjKHYsCQAMDJypCuMqHuZ5sXLMDFgb1ibOfyd1IvM0w/640?wx_fmt=png" data-type="png" data-w="1083" src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJrMTgM5rbKF5Puh3Hf3wCfkgYbJC3mJbwEfqjKHYsCQAMDJypCuMqHuZ5sXLMDFgb1ibOfyd1IvM0w/640?wx_fmt=png"></p><figure><figcaption>基因结构</figcaption></figure><p>如上图所示：</p><ul><li><p><span>5UTR在exon1上</span></p></li></ul><p>而根据常识，我们知道，exon非常短小，一般最多数百bp。所以我们在使用chipseeker进行注释时，当定义promoter区域为TSS±2kb时，理论上所有的5UTR以及1st exon应该大部分都在promoter区域才对，为什么注释时关于5UTR和1st exon区域却仍有一定数目呢？例如下图：</p><p><img data-galleryid="" data-ratio="0.49686520376175547" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJrMTgM5rbKF5Puh3Hf3wCfkq3vTgjn3Mu1Uhf6oQ3msQVOuGicI5e2X4tBIO8rvZIRyHlRaGjNtQqQ/640?wx_fmt=png" data-type="png" data-w="638" src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJrMTgM5rbKF5Puh3Hf3wCfkq3vTgjn3Mu1Uhf6oQ3msQVOuGicI5e2X4tBIO8rvZIRyHlRaGjNtQqQ/640?wx_fmt=png"></p><figure><figcaption>plotAnnoPie</figcaption></figure><p>为了回答上述问题，首先我对gtf文件进行了探索，再次解释一下gtf文件的构成原则。</p><p>然后我以转录本为单位，对全部转录本的5UTR以及exon1长度进行了探索。</p><h3><span>1. gtf文件格式讲解</span></h3><p>这里我以一个简单的例子进行讲解。</p><p>ENSG00000000005.6基因：</p><ul><li><p><span>chrX:100584936-100599885</span></p></li><li><p><span>有2个转录本，ENST00000373031.5和ENST00000485971.1。</span></p></li></ul><p>我们先从gtf文件中提取所有关于这个基因的信息，为了方便，我们只提取坐标，并对坐标进行处理，使其更加可读：</p><pre><code>$ zgrep <span>"ENSG00000000005.6"</span> gencode.v40.annotation.gtf.gz|awk -F<span>"\t"</span> <span>'{print $1,$2,$3,$4-100584936,$5-100584936,$7}'</span><br>chrX HAVANA gene 0 14949 +<br>chrX HAVANA transcript 0 14949 +<br>chrX HAVANA exon 0 130 +<br>chrX HAVANA CDS 83 130 +<br>chrX HAVANA start_codon 83 85 +<br>chrX HAVANA exon 295 426 +<br>chrX HAVANA CDS 295 426 +<br>chrX HAVANA exon 8959 9099 +<br>chrX HAVANA CDS 8959 9099 +<br>chrX HAVANA exon 9325 9426 +<br>chrX HAVANA CDS 9325 9426 +<br>chrX HAVANA exon 12568 12721 +<br>chrX HAVANA CDS 12568 12721 +<br>chrX HAVANA exon 14080 14246 +<br>chrX HAVANA CDS 14080 14246 +<br>chrX HAVANA exon 14572 14949 +<br>chrX HAVANA CDS 14572 14778 +<br>chrX HAVANA stop_codon 14779 14781 +<br>chrX HAVANA UTR 0 82 +<br>chrX HAVANA UTR 14779 14949 +<br>chrX HAVANA transcript 8688 12595 +<br>chrX HAVANA exon 8688 9099 +<br>chrX HAVANA exon 9325 9426 +<br>chrX HAVANA exon 12568 12595 +<br></code></pre><p>可以看到，gtf的数据信息结构是以基因为单位：</p><ul><li><p><span>第一个总是基因（gene），然后是转录本（transcript）</span></p></li><li><p><span>一个基因可以有多个转录本，因为存在有不同的可变剪接</span></p></li><li><p><span>每个转录本后面会紧跟不同的exon</span></p></li><li><p><span>第一个exon一般只有部分属于CDS，具体的cutoff点由后面紧跟的start_codon所决定</span></p></li><li><p><span>start_codon的起点和第一个CDS的起点保持一致</span></p></li><li><p><span>start_codon和stop_codon前一个CDS之间的所有CDS和exon坐标是一致的</span></p></li><li><p><span>stop_codon前一个CDS的坐标终点和stop_codon的起点紧邻</span></p></li><li><p><span>UTR记录在每个转录单位的最后</span></p></li><li><p><span>3UTR从转录本起点到start_codon前1个bp</span></p></li><li><p><span>5UTR从stop_codon起点到转录本终点</span></p></li><li><p><span>有的转录本可以没有CDS区域，一般属于ncRNA</span></p></li><li><p><span>没有CDS区域的转录本，同时也没有UTR、start_codon和stop_codon</span></p></li></ul><p>不过，需要注意的一点是，有时候，我们会发现一个转录本可以有多个5UTR，我们用换另外一个基因去检测一下大家就知道为什么了。</p><p>ENSG00000000457.14基因：</p><ul><li><p><span>chr1:169849631-169894267</span></p></li><li><p><span>有5个转录本，ENST00000367771.11；ENST00000367770.5；ENST00000367772.8；ENST00000423670.1；ENST00000470238.1</span></p></li></ul><p>我们先从gtf文件中提取所有关于这个基因的信息，为了方便，我们只提取坐标，并对坐标进行处理，使其更加可读：</p><pre><code>$ zgrep <span>"ENSG00000000457.14"</span> gencode.v40.annotation.gtf.gz|awk -F<span>"\t"</span> <span>'{print $1,$2,$3,$4-169849631,$5-169849631,$7}'</span><br>chr1 HAVANA gene 0 44636 -<br>chr1 HAVANA transcript 0 44265 -<br>chr1 HAVANA exon 44157 44265 -<br>chr1 HAVANA exon 39045 39259 -<br>chr1 HAVANA CDS 39045 39209 -<br>chr1 HAVANA start_codon 39207 39209 -<br>chr1 HAVANA exon 29003 29188 -<br>chr1 HAVANA CDS 29003 29188 -<br>chr1 HAVANA exon 26347 26460 -<br>chr1 HAVANA CDS 26347 26460 -<br>chr1 HAVANA exon 24065 24121 -<br>chr1 HAVANA CDS 24065 24121 -<br>chr1 HAVANA exon 20624 20726 -<br>chr1 HAVANA CDS 20624 20726 -<br>chr1 HAVANA exon 19297 19408 -<br>chr1 HAVANA CDS 19297 19408 -<br>chr1 HAVANA exon 17265 17342 -<br>chr1 HAVANA CDS 17265 17342 -<br>chr1 HAVANA exon 14738 14877 -<br>chr1 HAVANA CDS 14738 14877 -<br>chr1 HAVANA exon 12982 13166 -<br>chr1 HAVANA CDS 12982 13166 -<br>chr1 HAVANA exon 9410 9581 -<br>chr1 HAVANA CDS 9410 9581 -<br>chr1 HAVANA exon 4639 5333 -<br>chr1 HAVANA CDS 4639 5333 -<br>chr1 HAVANA exon 0 4141 -<br>chr1 HAVANA CDS 4085 4141 -<br>chr1 HAVANA stop_codon 4082 4084 -<br>chr1 HAVANA UTR 44157 44265 -<br>chr1 HAVANA UTR 39210 39259 -<br>chr1 HAVANA UTR 0 4084 -<br>chr1 HAVANA transcript 3443 39257 -<br>......<br></code></pre><p>我们以第一个转录本为例，可以看到其有3个UTR，从坐标位置我们可以知道：</p><ul><li><p><span>前两个都是5UTR，因为翻译起始点start_codon在第2个exon，所以导致第1个exon也是5UTR</span></p></li></ul><p>从这里也提示我们，如果我们看基因组上的分析，对于完整基因而言，真正的UTR区域我们应该从转录本起始区域到start_codon前1个bp，而非两个不连续区域。</p><h3><span>2. 5UTR和1st exon长度计算</span></h3><p>这里需要注意，因为注释是基于基因组进行的，而UTR是基于成熟mRNA进行的，所以<strong>UTR在基因组上的分布可能是一段段分离的区域，如果start codon位于非第1个exon时</strong>。</p><p>为了解决这个问题，下面的计算，我直接计算从TSS到start codon的距离，将其作为UTR的长度，这样和Promoter（TSS±2kb）就可以进行比较了。</p><pre><code><span># 载入环境</span><br><span>if</span> (<span>T</span>) {<br>  rm(list = ls())<br>  options(stringAsFactors = <span>F</span>)<br>  <span>library</span>(stringr)<br>  <span>library</span>(GenomicFeatures)<br>  <span>library</span>(ggplot2)<br>}<br><br><span># 载入环境和数据</span><br><span>if</span> (<span>T</span>) {<br>  <span># 使用gtf文件自行建立的注释txdb文件</span><br>  txdb &lt;- loadDb(<span>"gencode.v40.annotation.sqlite"</span>)<br>  txdb<br>}<br><br><span># 计算长度</span><br><span>if</span> (<span>T</span>) {<br>  utr5 &lt;- fiveUTRsByTranscript(txdb,use.names=<span>T</span>)<br>  exon &lt;- exonsBy(txdb,by = <span>"tx"</span>,use.names=<span>T</span>)<br>  <span># 计算过程非常慢,保存计算结果</span><br>  <span>if</span> (!file.exists(<span>"number.rdata"</span>)) {<br>    utr_length &lt;- sapply(utr5, <span>function</span>(x){<br>      width(range(x))<br>    })<br>    exon1 &lt;- sapply(exon, <span>function</span>(x){<br>      width(range(x[<span>1</span>]))<br>    })<br>    save(utr_length,exon1,file = <span>"number.rdata"</span>)<br>  }<br>  <span># 载入结果</span><br>  <span>if</span> (file.exists(<span>"number.rdata"</span>)) {<br>    load(<span>"number.rdata"</span>)<br>  }<br>}<br><br><span># plot</span><br><span>if</span> (<span>T</span>) {<br>  plot_distribution &lt;- <span>function</span>(x,title){<br>    length &lt;- data.frame(length=x,<br>                         log10=log10(x))<br>    ggplot(data=length,aes(log10)) +<br>      geom_histogram(binwidth=<span>0.005</span>) +<br>      ylab(label = <span>'Genes number'</span>) +<br>      xlab(label = <span>'Length'</span>) +<br>      geom_vline(xintercept = log10(<span>2000</span>))+<br>      labs(title = title)+<br>      geom_line(stat=<span>'density'</span>)<br>  }<br>  sum(exon1&gt;<span>2000</span>)<br>  sum(exon1&gt;<span>2000</span>)/length(exon1)<br><br>  sum(utr_length&gt;<span>2000</span>)<br>  sum(utr_length&gt;<span>2000</span>)/length(utr_length)<br><br>  title=<span>function</span>(x,y){<br>    paste0(<span>"Lenght of "</span>,x,<span>"\nlength&gt;2kb: "</span>,round(y*<span>100</span>,<span>2</span>),<span>"%"</span>)<br>  }<br><br>  plot_distribution(exon1,title(<span>"exon1"</span>,sum(exon1&gt;<span>2000</span>)/length(exon1)))<br>  ggsave(<span>"lenght of exon1.png"</span>)<br>  plot_distribution(utr_length,title(<span>"utr5"</span>,sum(utr_length&gt;<span>2000</span>)/length(utr_length)))<br>  ggsave(<span>"lenght of utr5.png"</span>)<br>}<br></code></pre><p><img data-galleryid="" data-ratio="0.7779527559055118" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJrMTgM5rbKF5Puh3Hf3wCfkvQA8Oxf2bSMqnLJuNGJIAoqiagmicmr0tQ6H6l1uBib5qRtgibdbwMia3Lg/640?wx_fmt=png" data-type="png" data-w="1905" src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJrMTgM5rbKF5Puh3Hf3wCfkvQA8Oxf2bSMqnLJuNGJIAoqiagmicmr0tQ6H6l1uBib5qRtgibdbwMia3Lg/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.7779527559055118" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJrMTgM5rbKF5Puh3Hf3wCfkNiabepNBicbvnqE1th0oZu7WfcPKqwNaU61xbrAz6QgMF2yJWdMOoMtQ/640?wx_fmt=png" data-type="png" data-w="1905" src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJrMTgM5rbKF5Puh3Hf3wCfkNiabepNBicbvnqE1th0oZu7WfcPKqwNaU61xbrAz6QgMF2yJWdMOoMtQ/640?wx_fmt=png"></p><p>这样来看，注释结果也就合理了。</p><h3><span>后记</span></h3><p>接下来还会对chipseeker的使用进行更多的笔记分享，试图将chipseeker工具的核心弄明白。<span></span></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/kLotKFcBXskevvAn2wibiQ",target="_blank" rel="noopener noreferrer">原文链接</a>
