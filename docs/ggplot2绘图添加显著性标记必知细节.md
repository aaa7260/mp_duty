---
title: "ggplot2绘图添加显著性标记必知细节"
date: 2022-10-23T02:35:32Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
ggplot2绘图添加显著性标记必知细节 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>最近看到群内有朋友在讨论如何在分面基础上添加显著性标记；本节就在原有代码的基础上再介绍一下如何使用<strong>「rstatix」</strong>进行统计性分析并自定义添加P值；希望对各位观众老爷有所帮助；<strong>「数据及代码已经上传VIP群，加群的观众老爷请自行下载」</strong></p><span>❞</span></blockquote><blockquote data-tool="mdnice编辑器"><span>❝</span><p><code>有需要学习数据可视化的朋友欢迎加入小编2022年度VIP群</code>，目前群内已经上传公众号文档<strong>「数据+代码约200篇」</strong>，<code>VIP交流群(1)已经500人满员</code>,随着内容不断增多，为了更好的创做内容现在进群需<strong>「付费149元」</strong>,若转发此文档到朋友圈集赞20个可优惠20元，早进早享受；<strong>「一定让你感受到物超所值」</strong></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>个性化绘图服务</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>最近有部分观众老爷找小编做个性化绘图，为了给观众老爷提供更加优质的服务；开通了 <strong>「淘宝店铺(R语言数据分析指南)」</strong> ，有特殊绘图需求的欢迎咨询</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(ggsci)<br><span>library</span>(ggprism)<br><span>library</span>(rstatix)<br><span>library</span>(ggpubr)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>gapminder &lt;- read_tsv(<span>"gapminder.xls"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- gapminder %&gt;%<br>  filter(year %<span>in</span>% c(<span>1957</span>,<span>2002</span>,<span>2007</span>),continent !=<span>"Oceania"</span>) %&gt;%<br>  select(country,year,lifeExp,continent)%&gt;%<br>  mutate(paired = rep(<span>1</span>:(n()/<span>3</span>),each=<span>3</span>),year=factor(year))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>统计分析</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df_p_val1 &lt;- df %&gt;% group_by(continent) %&gt;%<br>  wilcox_test(lifeExp  ~ year) %&gt;%<br>  adjust_pvalue(p.col = <span>"p"</span>, method = <span>"bonferroni"</span>) %&gt;%<br>  add_significance(p.col = <span>"p.adj"</span>) %&gt;% <br>  add_xy_position(x = <span>"year"</span>, dodge = <span>0.8</span>) <br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>绘制箱线图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>p &lt;- df %&gt;%<br>  ggplot(aes(year,lifeExp)) +<br>  stat_boxplot(aes(ymin = ..lower.., ymax = ..upper..),outlier.shape = <span>NA</span>,width=<span>0.5</span>) +<br>  stat_boxplot(geom = <span>"errorbar"</span>, aes(ymin = ..ymax..),width=<span>0.2</span>,size=<span>0.35</span>) +<br>  stat_boxplot(geom = <span>"errorbar"</span>, aes(ymax = ..ymin..),width=<span>0.2</span>,size=<span>0.35</span>) +<br>  geom_boxplot(aes(fill=year),color=<span>"black"</span>,outlier.shape = <span>NA</span>,linetype = <span>"dashed"</span>,width=<span>0.5</span>,size=<span>0.35</span>)+<br>  stat_summary(geom = <span>"crossbar"</span>, fun = <span>"median"</span>,width = <span>0.5</span>,color=<span>"black"</span>,size=<span>0.38</span>)+<br>  scale_size_continuous(range=c(<span>1</span>,<span>3</span>))+<br>  facet_wrap(.~continent,nrow=<span>1</span>)+<br>  scale_fill_npg()+<br>  scale_y_continuous(limits = c(<span>0</span>,<span>95</span>),breaks = seq(<span>0</span>,<span>95</span>,<span>15</span>),guide = <span>"prism_offset_minor"</span>)+<br>  labs(x=<span>NULL</span>,y=<span>NULL</span>)+<br>  theme(plot.margin=unit(c(<span>0.5</span>,<span>0.5</span>,<span>0.5</span>,<span>0.5</span>),units=,<span>"cm"</span>),<br>        strip.text = element_text(size=<span>12</span>),<br>        axis.line = element_line(color = <span>"black"</span>,size = <span>0.4</span>),<br>        panel.grid.minor = element_blank(),<br>        panel.grid.major = element_line(size = <span>0.2</span>,color = <span>"#e5e5e5"</span>),<br>        panel.background = element_blank(),<br>        axis.text.y = element_text(color=<span>"black"</span>,size=<span>10</span>),<br>        axis.text.x =element_blank(),<br>        axis.ticks.x=element_blank(),<br>        legend.position = <span>"none"</span>,<br>        panel.spacing = unit(<span>0.1</span>,<span>"lines"</span>))+<br>  coord_cartesian()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5874840357598978" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaVuWlyPqQIwmqia4k9cUsJYZMAibhdX6LAfKibnpL2C8bWQgaSf542oZbH0FianVXwEUldH8VTMarpGg/640?wx_fmt=png" data-type="png" data-w="783" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaVuWlyPqQIwmqia4k9cUsJYZMAibhdX6LAfKibnpL2C8bWQgaSf542oZbH0FianVXwEUldH8VTMarpGg/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>添加显著性标记</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>那么如何在上述图的基础上添加显著性标记，<strong>「df_p_val1」</strong>为所有数据进行<strong>「wilcox_test」</strong>分析，在此如果我们只需要在某几个分面上添加标记只需将要展示的数据从<strong>「df_p_val1」</strong>中过滤出来写入<strong>「stat_pvalue_manual」</strong>函数即可；相比其它方法真是简便不少</p><span>❞</span></blockquote><pre data-tool="mdnice编辑器"><span></span><code>p + stat_pvalue_manual(df_p_val1 %&gt;% filter(continent %<span>in</span>% c(<span>"Asia"</span>,<span>"Americas"</span>),group1==<span>"1957"</span>,group2==<span>"2002"</span>),<br>                     label = <span>"p.adj.signif"</span>,label.size=<span>5</span>,hide.ns = <span>F</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5874840357598978" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaVuWlyPqQIwmqia4k9cUsJYIF89EQHtE4ZIufGCtRwicfYAzI79IkzpYxznr3NaDJvkYJsicAXibtGCw/640?wx_fmt=png" data-type="png" data-w="783" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaVuWlyPqQIwmqia4k9cUsJYIF89EQHtE4ZIufGCtRwicfYAzI79IkzpYxznr3NaDJvkYJsicAXibtGCw/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节介绍到此结束，喜欢的观众老爷欢迎分享转发；<strong>「当然更推荐大家加入我的VIP交流群」</strong>扫描下方二维码加小编微信<strong>「付费149元」</strong>后邀请进群，<strong>「一定让你感受到物超所值」</strong>，<strong>「添加小编微信请备注来意，以便高效处理」</strong></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>小编微信</span><span></span></h3><p><img data-galleryid="" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg" data-type="jpeg" data-w="430" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile><p><br></p><section><section><section><section><p data-mid="">往期推荐</p></section></section><section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499061&amp;idx=1&amp;sn=19fe76fa4c488d9198de39049c3907a2&amp;chksm=cee2a5abf9952cbd9570a9402a106e1711f66dca88021d25849e920acd7c3ca7590c6a104454&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>浅谈ggplot2拼图必知的一些小细节</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499020&amp;idx=1&amp;sn=e32f2318a98f1db01d5bce97292dd8b6&amp;chksm=cee2a592f9952c849d98defffcc4b8f75e1ec8b9775e80750f80945ceb4ebddf84ba8e96e22d&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>[会员专享] circlize自定义绘制多组和弦图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498971&amp;idx=1&amp;sn=ae2cd964f4e1c9af50648dc79ba3751e&amp;chksm=cee2a445f9952d53d05b8383617fddded8d50e396cab64d17e8f7abe31c4b609c9b120d0d979&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>ggplot2优雅的给环状条形图添加新元素</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498953&amp;idx=1&amp;sn=e9431f9a9915816a9d69e5b625401786&amp;chksm=cee2a457f9952d4171cf0f356ffd7efcaa6ac1044f005d516222a030affb2ea7c06d80c5749f&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>ggtree优雅的绘制环状堆砌条形图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498929&amp;idx=1&amp;sn=dee541efc09db2dc978e7f303bfd9bcf&amp;chksm=cee2a42ff9952d39ea985ab4914975085719163894a2069a9a08fb8c02a0c1031ef745be6c86&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>ggbreak优雅的截断坐标轴</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498910&amp;idx=1&amp;sn=5edde61114b0c3ed20fb76817d675047&amp;chksm=cee2a400f9952d16438690987ded4239fc7e07d49ae521eb22a9aefdd02932ab12c9e934979a&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>[会员专享]ggplot2优雅绘制环状相关性热图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498861&amp;idx=1&amp;sn=fac22cef830567ffa26fcda705fa306b&amp;chksm=cee2a4f3f9952de58fd93b82cc2418f42ae1f90cbbd9940c257573b36d7910445ef63bb99de9&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>ggplot2优雅的绘制堆砌金字塔图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498845&amp;idx=1&amp;sn=38e6e5bf65a006493aa2aabbb8397f10&amp;chksm=cee2a4c3f9952dd532d9e6c1d69b57285ab8c8bfe705b9f353725b282061ececbd11be39d073&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>R优雅的制作组会汇报PPT</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498817&amp;idx=1&amp;sn=6becb281cb629c7810196ffe2671122b&amp;chksm=cee2a4dff9952dc929ddf05355d366533d1d0a3eb09ec794a15b6683c861bc57d4f085980ef7&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>R中优雅的生成gif动态图片</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498800&amp;idx=1&amp;sn=642ebf4a960a18ec1eb16553fb5ad569&amp;chksm=cee2a4aef9952db8c7c6c5e29c7ad6e8faee3896f2f5b9140fdd4a78f4b155ce516c8cd3e7d6&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>浅谈ggplot2中的group参数</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498785&amp;idx=1&amp;sn=9e8d90d1f5c9d3d51b0000b9ce9bc5ee&amp;chksm=cee2a4bff9952da94a524dc5769c202f85bbd05fd952caf95bc3d97ba06c715b630dc5421896&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>ggplot2绘制箱线图的完美小案例</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498765&amp;idx=1&amp;sn=5e5669f547df034be488f6728cf2bd7d&amp;chksm=cee2a493f9952d8519ea9ac2703311d917e9ee9ddb4491e4560ddd2ddaf330e0c6ca7a1b12b2&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>ggplot2对堆砌条形图添加误差线</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498741&amp;idx=1&amp;sn=fe00b4e5c5d0c3dbeafd94b5b79488f1&amp;chksm=cee2a36bf9952a7df79b51eb26f1fa749669fbd04ece0ec6b51403ce01fa2a9b72e8a2373c9f&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>[会员专享] ggplot2绘制多层注释散点图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498698&amp;idx=1&amp;sn=4709db61fc258a95833124c58eb2e208&amp;chksm=cee2a354f9952a42af98bef315d8fcef230559648d1c85a2364b0a891b98542a53bfdea42365&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>ggplot2优雅的绘制3D热图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498681&amp;idx=1&amp;sn=c9ed29ae057e9303991c8b7123077e2c&amp;chksm=cee2a327f9952a31ffb2a20994799b6dc11b2a316b2721e99227253a577739672b6503fd393c&amp;scene=21#wechat_redirect" data-linktype="2"></a><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498681&amp;idx=1&amp;sn=c9ed29ae057e9303991c8b7123077e2c&amp;chksm=cee2a327f9952a31ffb2a20994799b6dc11b2a316b2721e99227253a577739672b6503fd393c&amp;scene=21#wechat_redirect" data-linktype="2"></a><p><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498681&amp;idx=1&amp;sn=c9ed29ae057e9303991c8b7123077e2c&amp;chksm=cee2a327f9952a31ffb2a20994799b6dc11b2a316b2721e99227253a577739672b6503fd393c&amp;scene=21#wechat_redirect" data-linktype="2">[会员专享] 跟着GCB学绘图-高端系统发育树</a></p></section></section></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/El4M-dTGkPjvpWnpCXNvhQ",target="_blank" rel="noopener noreferrer">原文链接</a>
