---
title: "单细胞hdWGCNA-1：创建对象"
date: 2022-09-18T23:23:59Z
draft: ["false"]
tags: [
  "fetched",
  "YuYuFiSH"
]
categories: ["Acdemic"]
---
单细胞hdWGCNA-1：创建对象 by YuYuFiSH
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h1 data-tool="mdnice编辑器"><span></span>hdWGCNA</h1><p data-tool="mdnice编辑器">原来单细胞数据也能做WGCNA分析，</p><p data-tool="mdnice编辑器">即<span>高维high dimensional WGCNA（hdWGCNA）</span>，也称为scWGCNA</p><ul><li><p data-tool="mdnice编辑器"><strong>作用</strong>：使用单细胞加权基因相关网络分析（scWGCNA），鉴定共表达的基因模块和差异表达的中枢基因（hub gene），同时也可以揭示了细胞状态相关的基因调控网络（GRN）</p></li><li><p data-tool="mdnice编辑器"><strong>帮助文档</strong>：https://smorabit.github.io/hdWGCNA/index.html</p></li><li><p data-tool="mdnice编辑器"><strong>文献</strong>：https://www.nature.com/articles/s41588-021-00894-z</p></li><li><p data-tool="mdnice编辑器"><strong>数据</strong>：https://github.com/smorabit/hdWGCNA</p></li></ul><blockquote data-type="2" data-url="" data-author-name="" data-content-utf8-length="37" data-source-title=""><section><section>作为单细胞高级分析一种，目前使用的单细胞文章挺少的，可作为分析的后备方案~</section></section></blockquote><h2 data-tool="mdnice编辑器"><span></span>分析前</h2><p data-tool="mdnice编辑器">分析前的单细胞数据，需要先进行标准分析，如归一化标准化等直到降维聚类</p><ul><li><p>A single-cell or single-nucleus transcriptomics dataset in <code>Seurat format</code></p></li><li><p>Normalize the gene expression matrix <code>NormalizeData</code></p></li><li><p>Identify highly variable genes <code>VariableFeatures</code></p></li><li><p>Scale the normalized expression data <code>ScaleData</code></p></li><li><p>Perform dimensionality reduction <code>RunPCA</code> and batch correction if needed <code>RunHarmony</code></p></li><li><p>Non-linear dimensionality reduction <code>RunUMAP</code> for visualizations</p></li><li><p>Group cells into clusters (<code>FindNeighbors</code> and <code>FindClusters</code>)<span></span></p></li></ul><h2 data-tool="mdnice编辑器"><span>1. 下载数据</span></h2><p data-tool="mdnice编辑器">使用已处理过的人脑的单细胞数据作为例子分析</p><pre data-tool="mdnice编辑器"><span></span><code>wget https://swaruplab.bio.uci.edu/public_data/Zhou_2020.rds<br></code></pre><h2 data-tool="mdnice编辑器"><span>2. 加载R包</span></h2><pre data-tool="mdnice编辑器"><span></span><code><span># single-cell analysis package</span><br>library(Seurat)<br><br><span># plotting and data science packages</span><br>library(tidyverse)<br>library(cowplot)<br>library(patchwork)<br>library(devtools)<br>library(igraph)<br><br><span># co-expression network analysis packages:</span><br>library(WGCNA)<br><span># devtools::install_github('smorabit/hdWGCNA', ref='dev')</span><br>library(hdWGCNA)<br><br><span># using the cowplot theme for ggplot</span><br>theme_set(theme_cowplot())<br><br><span># set random seed for reproducibility</span><br>set.seed(12345)<br>setwd(<span>'/home/data/yulan/hdWGCNA'</span>)<br><br><span># load the Zhou et al snRNA-seq dataset</span><br>seurat_obj &lt;- readRDS(<span>'data/Zhou_2020.rds'</span>)<br>seurat_obj<br><span># An object of class Seurat </span><br><span># 36601 features across 36671 samples within 1 assay </span><br><span># Active assay: RNA (36601 features, 0 variable features)</span><br><span># 2 dimensional reductions calculated: harmony, umap</span><br><br>p &lt;- DimPlot(seurat_obj, group.by=<span>'cell_type'</span>, label=TRUE)+<br>  ggtitle(<span>'Zhou et al Control Cortex'</span>) + NoLegend()<br><br>p<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7776183644189383" data-src="https://mmbiz.qpic.cn/mmbiz_png/PsnauFhHibc4acSiczCM1hfmrIVzyRFIawicBiaM3HiaIQib6aHMgPXUrDiaayFkgH5X7EbYNaxNJxC8ic9xfhZ7R4WCvw/640?wx_fmt=png" data-type="png" data-w="697" src="https://mmbiz.qpic.cn/mmbiz_png/PsnauFhHibc4acSiczCM1hfmrIVzyRFIawicBiaM3HiaIQib6aHMgPXUrDiaayFkgH5X7EbYNaxNJxC8ic9xfhZ7R4WCvw/640?wx_fmt=png"></figure><h2 data-tool="mdnice编辑器"><span>3. 创建对象，选择基因</span></h2><ul><li><p data-tool="mdnice编辑器"><code><span>SetupForWGCNA</span></code>:创建对象，选择基因进行分析</p></li></ul><p data-tool="mdnice编辑器">在进行hdWGCNA分析前，需要建立Seurat对象，通常储存在对象的@misc中。并且可以储存多个hdWGCNA结果，就像在前面我们可以储存不同res的细胞降维聚类情况，同样道理这里可以调整参数储存多个hdWGCNA结果</p><p data-tool="mdnice编辑器">并且通常单细胞矩阵基因数量很多，此函数可以根据调整参数<code>gene_select</code>，筛选出一部分基因进行分析</p><pre data-tool="mdnice编辑器"><span></span><code>SetupForWGCNA(<br>  seurat_obj,<br>  wgcna_name,<br>  features = NULL,<br>  metacell_location = NULL,<br>  group = NULL,<br>  fraction = 0.05,<br>  group.by = NULL,<br>  gene_list = NULL<br>  ...<br>)<br>参数注释:<br>seurat_obj <br>A Seurat object<br><br>wgcna_name <br>name of the WGCNA experiment<br><br>features <br>list of features to use <span>for</span> WGCNA<br><br>metacell_location <br>name of the WGCNA experiment to copy the metacell object from<br><br>fraction <br>A numeric that determines the minimum cells that a gene must be expressed <span>in</span> order to be included. For example, fraction = 0.05 means that 5% of cells must express a gene (count &gt; 0) <span>for</span> it to be included.<br><br>gene_list <br>A character string of gene names, only used <span>if</span> <span>type</span> = <span>"custom"</span><br><br><span>type</span> <br>How to select genes? Select <span>"variable"</span>, <span>"fraction"</span>, <span>"all"</span>, or <span>"custom"</span>.<br></code></pre><p data-tool="mdnice编辑器"><code><span>gene_select</span></code>的三个选择：</p><ul><li><p data-tool="mdnice编辑器"><code>variable</code>: 使用储存在<code>VariableFeatures</code>的高变基因，默认2000</p></li><li><p data-tool="mdnice编辑器"><code>fraction</code>: 使用在整个数据集或每组细胞中以特定比例<code>fraction</code>细胞表达的基因,不同组别由<code>group.by</code>指定</p></li><li><p data-tool="mdnice编辑器"><code>custom</code>: 使用人为特定的基因</p></li></ul><pre data-tool="mdnice编辑器"><span></span><code>seurat_obj &lt;- SetupForWGCNA(<br>  seurat_obj,<br>  gene_select = <span>"fraction"</span>, <span># the gene selection approach</span><br>  fraction = 0.05, <span># fraction of cells that a gene needs to be expressed in order to be included</span><br>  wgcna_name = <span>"tutorial"</span> <span># the name of the hdWGCNA experiment</span><br>)<br>length(seurat_obj@misc<span>$tutorial</span><span>$wgcna_genes</span>) <span>#[1] 12639</span><br></code></pre><p data-tool="mdnice编辑器">这里挑选出1万多个基因进行后续分析</p><p data-tool="mdnice编辑器"><img data-ratio="0.5423111919927207" data-src="https://mmbiz.qpic.cn/mmbiz_png/PsnauFhHibc4acSiczCM1hfmrIVzyRFIaw7y8ce6AbtBdY7m1ZZ2ocwsPxGQDy0baNd5lPwO18ocRbeOtxagxUWw/640?wx_fmt=png" data-type="png" data-w="1099" src="https://mmbiz.qpic.cn/mmbiz_png/PsnauFhHibc4acSiczCM1hfmrIVzyRFIaw7y8ce6AbtBdY7m1ZZ2ocwsPxGQDy0baNd5lPwO18ocRbeOtxagxUWw/640?wx_fmt=png"></p></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/O2q9TZ7GmK1DQIsNn000yg",target="_blank" rel="noopener noreferrer">原文链接</a>
