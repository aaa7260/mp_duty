---
title: "生信技能树-day15 Linux脚本编程"
date: 2024-06-21T00:57:14Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
生信技能树-day15 Linux脚本编程 by 生信菜鸟团
------
<div><blockquote data-tool="mdnice编辑器"><p><span>从我们</span><span>生信技能树</span><span>历年的几千个马拉松授课学员里面募集了一些优秀的创作者，某种意义来说是传承了我们生信技能树的知识整理和分享的思想！</span></p></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">今天的是三周合计15天的数据挖掘授课学员一点一滴整理的授课知识点笔记哦，还有互动练习题哈，欢迎大家点击文末的阅读原文去关注我们学员的公众号哦！</p><p><img data-galleryid="" data-imgfileid="100039957" data-ratio="0.9869791666666666" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicZWFXx8AD2QqR5r26iaEib7iaTAeenkZojmCFn9w4mCdFoicJMx4AQ3q11rUoUaJn8lUjibicBWzLIhSAQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1536" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicZWFXx8AD2QqR5r26iaEib7iaTAeenkZojmCFn9w4mCdFoicJMx4AQ3q11rUoUaJn8lUjibicBWzLIhSAQ/640?wx_fmt=png&amp;from=appmsg"></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span>Linux 系统环境</span></h2><p data-tool="mdnice编辑器">Linux系统一般有4个主要部分：</p><ul data-tool="mdnice编辑器"><li><section>内核</section></li><li><section>shell</section></li><li><section>文件系统</section></li><li><section>应用程序</section></li></ul><p data-tool="mdnice编辑器">内核、shell、文件系统一起形成了基本的操作系统结构，使用户可以运行程序、管理文件，shell也是一门编程语言</p><h3 data-tool="mdnice编辑器"><span>文件系统结构</span></h3><pre data-tool="mdnice编辑器"><span></span><code>/   虚拟目录的根目录。通常不会在这里存储文件<br>/bin 二进制目录，存放许多用户级的GNU工具<br>/boot 启动目录，存放启动文件<br>/dev 设备目录，Linux在这里创建设备节点<br>/etc 系统配置文件目录<br>/home 主目录，Linux在这里创建用户目录<br>/lib 库目录，存放系统和应用程序的库文件<br>/media 媒体目录，可移动媒体设备的常用挂载点<br>/root root用户的主目录<br>/sbin 系统二进制目录，存放许多GNU管理员级工具<br>/run 运行目录，存放系统运作时的运行时数据<br>/tmp 临时目录，可以在该目录中创建和删除临时工作文件<br>/usr 用户二进制目录，大量用户级的GNU工具和数据文件都存储在这里<br><br></code></pre><h3 data-tool="mdnice编辑器"><span>查看系统资源</span></h3><p data-tool="mdnice编辑器">查看CPU信息：lscpu</p><ul data-tool="mdnice编辑器"><li><section>architecture：架构，x86_64等</section></li><li><section>CPU：几核</section></li><li><section>Thread per core：几线程</section></li><li><section>model name：CPU型号</section></li></ul><p data-tool="mdnice编辑器">查看内存信息：free  -h</p><p data-tool="mdnice编辑器">查看硬盘信息：df  -h</p><p data-tool="mdnice编辑器">查看文件大小：du  -h  -d  1</p><p data-tool="mdnice编辑器">查看文件大小：du  -h  -d  1</p><p data-tool="mdnice编辑器">查看系统进程：top 或者 ps -ef 或者 jobs或者htop（需要用conda安装）</p><h2 data-tool="mdnice编辑器"><span>变量</span></h2><p data-tool="mdnice编辑器">环境变量、状态变量、位置参数变量、自定义变量，调用变量时，要在变量前面加一个 <code>$ </code>符号</p><p data-tool="mdnice编辑器">环境变量：用于存储有关shell会话和工作环境的系统变量</p><p data-tool="mdnice编辑器">状态变量：用于记录命令的运行结果</p><pre data-tool="mdnice编辑器"><span></span><code>$? <span>## 获取上一个命令的执行状态返回值，0为执行成功，非0为执行失败</span><br>$$ <span>## 获取当前执行的shell脚本的进程号PID</span><br>$! <span>## 获取上一个后台工作的进程的进程号PID</span><br><span>$_</span> <span>## 获取在此之前执行的命令或脚本的最后一个参数</span><br></code></pre><p data-tool="mdnice编辑器">位置参数变量：用于用于向命令或程序脚本中传递信息</p><pre data-tool="mdnice编辑器"><span></span><code><span>$n</span> <span>## n为数字，$0为命令（脚本）本身，$1~9代表1~9个参数，10以上的参数需要{10}</span><br><span>## 比如，在脚本my.sh中写：</span><br>cat <span>$1</span><br><span>echo</span> <span>$2</span><br>ls <span>$3</span><br><span>## 保存并退出后，再写以下命令：</span><br>bash my.sh readme.txt <span>'hi'</span>  /home<br><span>## 运行的结果会返回cat readme.txt, 接着echo出hi，然后ls home</span><br>$* <span>## 代表命令行中所有参数，把所有参数看成一个整体</span><br><span>$@</span> <span>## 代表命令行中所有参数，不过把每个参数区别对待</span><br><span>$#</span> <span>## 代表命令行中所有参数的个数</span><br></code></pre><p data-tool="mdnice编辑器">自定义变量：由用户自行定义的变量，可用于用户编写的脚本，多个命令间的值传递等</p><pre data-tool="mdnice编辑器"><span></span><code><span># 赋值 =前后不能有空格</span><br>a=gene<br><span>echo</span> <span>'This is a $a'</span><br><span>echo</span> <span>"This is a <span>$a</span>"</span><br><span># 在Linux中，双引号里的$后面的变量会被展开为变量的值，单引号中间为直接打印字符串</span><br><br><span># 环境变量中存在系统已经设置好的别名alias</span><br>vim .bashrc<br>/<span>alias</span><br><span># 比如ls='ls --color=auto'</span><br><span># 也可以自己设置别名，在.bashrc中</span><br>G <span>#到行末</span><br>o <span>#进入下一行</span><br><span>#比如可以设置：</span><br><span>alias</span> le=<span>'less -SN'</span><br></code></pre><h2 data-tool="mdnice编辑器"><span>结构化语句</span></h2><h3 data-tool="mdnice编辑器"><span>条件语句 if</span></h3><p data-tool="mdnice编辑器">有头有尾，一个<code>if</code> 就要对应一个 <code>fi</code> 。有三种结构：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span> 1</span><br>if [ condition ] # 两个中括号左右都要有空格！！！<br>then<br> commands<br>fi ## 相当于结束代码块<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span> 2</span><br>if [ condition ]<br>then<br> commands<br>else<br> commands<br>fi<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span> 3</span><br>if [ condition ]<br>then<br> commands<br>else<br> if [ condition ]<br> then<br>  commands<br> fi<br>fi<br><span>#</span><span> (<span>else</span> <span>if</span> 可以缩写为 <span>elif</span> )</span><br>if [ condition ]<br>then<br> commands<br>elif [ condition ]<br> then<br>  commands<br> fi<br>fi<br></code></pre><p data-tool="mdnice编辑器">;和&amp;&amp;的区别</p><pre data-tool="mdnice编辑器"><span></span><code><span>pwd</span> ; ls <br><span>## 相当于室友的关系，执行完第一个之后执行第二个，没有利益相关</span><br><span>pwd</span> &amp;&amp; ls<br><span>## 有利益相关，只有第一个命令执行成功之后才会执行第二个命令，否则停下</span><br></code></pre><p data-tool="mdnice编辑器">数值判断的常用语句</p><pre data-tool="mdnice编辑器"><span></span><code>[ INT1 -eq INT2 ] <span># INT1 和 INT2 两数相等返回为真</span><br>[ INT1 -ne INT2 ] <span># INT1 和 INT2 两数不等返回为真</span><br>[ INT1 -gt INT2 ] <span># INT1 大于 INT2 返回为真</span><br>[ INT1 -ge INT2 ] <span># INT1 大于等于 INT2 返回为真</span><br>[ INT1 -lt INT2 ] <span># INT1 小于 INT2 返回为真</span><br>[ INT1 -le INT2 ] <span># INT1 小于等于 INT2 返回为真</span><br></code></pre><p data-tool="mdnice编辑器">字符串判断的常用语句</p><pre data-tool="mdnice编辑器"><span></span><code>[ -z STRING ] <span># 如果STRING的长度为零则返回为真，即空是真</span><br>[ -n STRING ] <span># 如果STRING的长度非零则返回为真，即非空是真</span><br>[ STRING1 ] <span># 如果字符串不为空则返回为真,与-n类似</span><br>[ STRING1 == STRING2 ] <span># 如果两个字符串相同则返回为真</span><br>[ STRING1 != STRING2 ] <span># 如果字符串不相同则返回为真</span><br>[ STRING1 &lt; STRING2 ] <span># 如果 STRING1字典排序在STRING2前面则返回为真。&gt; 同理</span><br></code></pre><p data-tool="mdnice编辑器">文件判断的常用语句</p><pre data-tool="mdnice编辑器"><span></span><code>[ -a FILE ] <span># 如果 FILE 存在则为真</span><br>[ -d FILE ] <span># 如果 FILE 存在且是一个目录则返回为真</span><br>[ -f FILE ] <span># 如果 FILE 存在且是一个普通文件则返回为真</span><br></code></pre><p data-tool="mdnice编辑器">示例：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span> 数值判断</span><br>if [ 1 -eq 1 ]<br>then<br>  echo  "Welcome to Biotrainee() !"<br>else<br>  echo  "**************"<br>fi<br><span><br>#</span><span> 结合状态参数 $?</span><br>if [ $? -eq 0 ]<br>then<br>  touch  ok.txt<br>fi<br><span><br>#</span><span> 文件判断</span><br>if [ ! -f ok.txt ]<br>then<br>  touch  ok.txt<br>fi<br><br></code></pre><h3 data-tool="mdnice编辑器"><span>循环语句</span></h3><p data-tool="mdnice编辑器">for 循环</p><pre data-tool="mdnice编辑器"><span></span><code>for i in  1 2 3 4 5 <br>do<br>  echo ${i} "Welcome to Biotrainee() !"<br>  sleep 3s<br>done<br><span>#</span><span> 每次执行完歇3秒</span><br><span>#</span><span> 变量最好加上{}，这样告诉linux里面的是变量</span><br><br>for i in {1..10}<br>do<br>  touch  file${i}<br>done<br><span>#</span><span> i赋值为1~10</span><br><br>list="CDS exon gene start_codon stop_codon transcript UTR"<br>for i in ${list}<br>do<br>  echo  "This feature is ${i}"<br>done<br><span>#</span><span> 也可以生成一个list，让i在list中循环</span><br></code></pre><p data-tool="mdnice编辑器">while 循环</p><pre data-tool="mdnice编辑器"><span></span><code>ls file* | while  read  id; # id只是一个代号，也可以是abcxyz<br>do <br>  mv ${id} ${id}.txt ; <br>done<br><br><br>ls  file* &gt; config<br>cat config | while  read id<br>do <br>  mv  ${id}  ${id%.txt}<br>done<br></code></pre><p data-tool="mdnice编辑器">参数扩展：掐头去尾</p><pre data-tool="mdnice编辑器"><span></span><code><span>${变量#关键字}</span> <span># 若变量内容从头开始的数据符合“关键字”，则将符合的最短数据删除</span><br><span>${变量##关键字}</span> <span># 若变量内容从头开始的数据符合“关键字”，则将符合的最长数据删除</span><br><span>${变量%%关键字}</span> <span># 若变量内容从尾开始的数据符合“关键字”，则将符合的最长数据删除</span><br></code></pre><p data-tool="mdnice编辑器">参数扩展：字符替换</p><pre data-tool="mdnice编辑器"><span></span><code><span>${变量/旧字符串/新字符串}</span> <span># 若变量内容符合“旧字符串”，则首个旧字符串会被新字符串替换</span><br><span>${变量//旧字符串/新字符串}</span> <span># 若变量内容符合“旧字符串”，则全部旧字符串会被新字符串替换。</span><br></code></pre><h3 data-tool="mdnice编辑器"><span>结构化语句练习题</span></h3><pre data-tool="mdnice编辑器"><span></span><code>id=example<br>fastqc ~/Data/${id}.fq<br>if [ $? -eq 0 ]<br>then<br>  echo "yes"<br>else <br>  echo "no"<br>fi<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>touch  file{1..10}<br><br>ls file* | while read id<br>do <br>  echo  "xxx"  &gt; ${id}<br>done<br><br></code></pre><h3 data-tool="mdnice编辑器"><span>shell 脚本</span></h3><p data-tool="mdnice编辑器">test.sh</p><pre data-tool="mdnice编辑器"><span></span><code><span>$</span><span> vim  test.sh</span><br><span>#</span><span>!/bin/bash</span><br>echo "Welcome to Biotrainee() !"<br><span>#</span><span> <span>#!为定义解释器，也可以定义其他的解释器，如Rscript</span></span><br><span>#</span><span> 使用<span>which</span> Rscript查看位置</span><br><span><br>$</span><span> bash  test.sh</span><br><span><br>#</span><span> 1标准输出  和  2标准误输出 是两条不同的管道</span><br><span>#</span><span> 标准输出流为打印到屏幕上的内容</span><br><span>$</span><span> bash  test.sh  1&gt;test.log  2&gt;&amp;1</span><br><span>#</span><span> 把标准日志输出到test.log中，再把标准误输出合并到1中，这样<span>log</span>中就保存了所有包括正常执行的和错误的日志信息</span><br><span><br>#</span><span> 可执行权限修改</span><br><span>$</span><span> ls -lh test.sh </span><br><span>$</span><span> chmod  764 test.sh </span><br><span>#</span><span> rwxrwxrwx：421421421</span><br><span>$</span><span> ls -lh test.sh </span><br><span><br>#</span><span> 路径调用可执行文件</span><br>./test.sh  <br><br></code></pre><p data-tool="mdnice编辑器">test2.sh</p><pre data-tool="mdnice编辑器"><span></span><code><span>$</span><span> cat  test2.sh</span><br><span>#</span><span>!/bin/bash</span><br>cat  $1<br><span><br>$</span><span> bash  test2.sh  readme.txt</span><br><br></code></pre><p data-tool="mdnice编辑器">test3.sh</p><p data-tool="mdnice编辑器">任务提交（重点）</p><pre data-tool="mdnice编辑器"><span></span><code>nohup # 不要挂断任务，即把任务提交到服务器上运行<br>&amp;      # 任务后台运行，通常与nohup连用，这样即使出现了网络问题也正常运行<br>top     # 实时显示系统中各个进程的资源占用情况，按q退出<br>htop    # 优化过的top，u可以选择users<br>ps      #process status列出当前系统中运行的进程列表，一般加上-ef，搭配grep进行搜索，如：<br>ps -ef | grep 用户名<br>kill    # 杀掉进程 kill -9 PID，第9种命令是指无条件停止<br><span><br>#</span><span> 比如：先写个脚本</span><br>vim test.sh<br><span>#</span><span> 写入：</span><br>for i in {1..600}<br>do<br> echo $i<br> sleep 3s<br>done<br><span>#</span><span> 退出vim</span><br>bash test.sh<br><span>#</span><span> 运行后就会开始在前台运行，窗口关掉后就无法运行了，但改成：</span><br>nohup bash test.sh &amp;<br><span>#</span><span> 这样就将任务挂在后台运行，会提示所有输出都放在nohup.out中，再次回车</span><br>cat nohup.out<br><span>#</span><span> 可以看到当前已经运行的输出结果</span><br>tail -f nohup.out<br><span>#</span><span> 不过当有好几个进程的时候，会把所有的结果都输出到nohup.out中，解决办法：</span><br>nohup bash test.sh &gt; test.log &amp;<br><span><br>#</span><span> 可以动态的查看结果，ctrl+c退出</span><br>htop<br><span>#</span><span> 查看目前的进程，按u可以选择users，只看自己的</span><br><span>#</span><span> 鼠标选中进程后选9（无条件<span>kill</span>），回车send就可以杀掉进程</span><br><span>#</span><span> 或者用<span>kill</span> -9 PID就可以杀掉进程，但需要知道PID</span><br><span>#</span><span> 怎么查询PID？</span><br>ps -ef | grep '用户名'<br><span>#</span><span> 找到PID后就可以用<span>kill</span>杀掉</span><br><span><br>$</span><span> cat  test3.sh</span><br><span>#</span><span>!/bin/bash</span><br>echo  "Start"<br>sleep  100s<br>echo  "End"<br><span><br>$</span><span> bash  test3.sh  </span><br><span><br>$</span><span> nohup  bash  test3.sh  &amp;</span><br><span><br>$</span><span> nohup  bash  test3.sh   1&gt;test3.log  2&gt;&amp;1  &amp;</span><br><span><br>$</span><span> top</span><br><span><br>$</span><span> ps -ef | grep test3</span><br><br><br></code></pre><h3 data-tool="mdnice编辑器"><span>其他脚本</span></h3><p data-tool="mdnice编辑器">在 Linux 中使用其他编程语言</p><p data-tool="mdnice编辑器">示例：</p><p data-tool="mdnice编辑器">R 语言脚本</p><pre data-tool="mdnice编辑器"><span></span><code><span>$</span><span> cat test.R </span><br><span>#</span><span>!/usr/bin/Rscript</span><br>a = 1:10<br>paste0("gene",a)<br><span><br>$</span><span> Rscript test.R </span><br> [1] "gene1"  "gene2"  "gene3"  "gene4"  "gene5"  <br> [6] "gene6"  "gene7"  "gene8"  "gene9"  "gene10"<br><br></code></pre><p data-tool="mdnice编辑器">Python 脚本</p><pre data-tool="mdnice编辑器"><span></span><code><span>$</span><span> cat test.py </span><br><span>#</span><span>!/usr/bin/python3</span><br><br>print("Hello World")<br><span><br>$</span><span> python3 test.py </span><br>Hello World<br><br></code></pre><h3 data-tool="mdnice编辑器"><span>扩展</span></h3><p data-tool="mdnice编辑器">一个自己写的命令：可以实现行列转换，功能类似 R 语言中的 <code>t( )</code> 函数</p><pre data-tool="mdnice编辑器"><span></span><code><span>$</span><span> cat  &gt; row2col</span><br>awk 'BEGIN{FS="\t";OFS="\t"}{i=1;while(i &lt;= NF){col[i]=col[i] $i "\t";i=i+1}} END {i=1;while(i&lt;=NF){print i,col[i];i=i+1}}'<br><span><br>$</span><span> chmod 764  row2col</span><br><span><br>$</span><span> mv  row2col  ~/bin</span><br><span><br>$</span><span> head -n 2 ~/Data/example.gtf  |  row2col</span><br></code></pre><blockquote data-tool="mdnice编辑器"><p>from 生信技能树</p></blockquote><span></span></section><p><br></p><p><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span>文末友情宣传</span></h3><p data-tool="mdnice编辑器"><strong>强烈建议你推荐给身边的博士后以及年轻生物学PI，多一点数据认知，让他们的科研上一个台阶：</strong></p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247530001&amp;idx=1&amp;sn=676dcf224f9be23b288189775292aeeb&amp;chksm=9b4b36aaac3cbfbc3e3bb0865bd789d5093e3a643f3f345332995f707b7f209ae924e9e9529e&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授课（买‍一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;scene=21#wechat_redirect" data-linktype="2">时隔5年，我们的生信技能树VIP学徒继续招生啦</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;scene=21#wechat_redirect" data-linktype="2">2024的共享服务器交个朋友福利价仍然是800</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;scene=21#wechat_redirect" data-linktype="2">千呼万唤始出来的独享生物信息学云服务器</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528144&amp;idx=1&amp;sn=be4d7e542d1077921024c86a4c130f16&amp;scene=21#wechat_redirect" data-linktype="2">永久免费的生信进阶培训（线下）</a></section></li></ul></section><p><br></p><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/CcBWw0qgcrlOG_wkJ7V5Mw",target="_blank" rel="noopener noreferrer">原文链接</a>
