---
title: "拆分你的百万级别单细胞数据集后做降维聚类分群"
date: 2024-06-26T07:12:15Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
拆分你的百万级别单细胞数据集后做降维聚类分群 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>有粉丝在交流群提问说看到了2022的一个泛癌文章但是数据量有点大以至于他自己的个人电脑或者课题组服务器都没办法hold住，标题是 ：《Pan-cancer single-cell analysis reveals the heterogeneity and plasticity of cancer- associated fibroblasts in the tumor microenvironment》，这个泛癌单细胞数据挖掘文章纳入了很多不同癌症的单细胞转录组数据集做了一个汇总的降维聚类分群，如下所示：</p></blockquote><p><img data-galleryid="" data-imgfileid="100047949" data-ratio="0.9342592592592592" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxQia5qFh1SOWDTd6y8ufHUx3yK7dUvCq11OlafpnnoiaHJ1QrnZ8TdE3uKWSwHzaiakxZs637BI8B5w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxQia5qFh1SOWDTd6y8ufHUx3yK7dUvCq11OlafpnnoiaHJ1QrnZ8TdE3uKWSwHzaiakxZs637BI8B5w/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>纳入了很多不同癌症的单细胞转录组数据集</figcaption></figure><p data-tool="mdnice编辑器">因为纳入的数据集有点多，来源于12篇文章：232 single cell transcriptome samples (normal = 31; adjacent = 54; tumor = 148) ，分别来源于：</p><ul data-tool="mdnice编辑器"><li><section>31 GSM samples were derived from GSE134355</section></li><li><section>11 GSM samples wererelated to GSE141445</section></li><li><section>49 samples were derived from the under accession numberE-MTAB-8107</section></li><li><section>2 GSM samples were associated with GSE157703</section></li><li><section>22 GSMsamples were derived from GSE131907</section></li><li><section>7 GSM samples were derived fromGSE138709</section></li><li><section>31 samples were derived from the    under accession number E-MTAB-6149 and E-MTAB-6653</section></li><li><section>32 CRR samples were related to GSA database underaccession number CRA001160</section></li><li><section>10 GSM samples were related to GSE154778</section></li><li><section>7 HRR samples were available in GSA-Human under the accession codeHRA000212</section></li><li><section>10 thyroid samples were derived from GSA-Human databaseunder accession number HRA000686</section></li><li><section>20 gastric samples were download from http://dna-discovery.stanford.edu/download/1401/;</section></li></ul><p data-tool="mdnice编辑器">并不需要自己去重新分析上面的12个文章的12个数据集了，因为作者直接就在 GSE210347 数据集给出来了表达量矩阵文件 （GSE210347_counts.Rds.gz  ），如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>GSE210347_counts.Rds.gz 2.4 Gb (ftp)(http) RDS<br>GSE210347_meta.txt.gz 18.5 Mb (ftp)(http) TXT<br>GSE210347_sample_information.txt.gz 632 b (ftp)(http) TXT<br>GSE210347_study_metadata.xls.gz 39.8 Kb (ftp)(http) XLS<br></code></pre><p data-tool="mdnice编辑器">其实这个甚至都不需要自己做降维聚类分群了，因为本来就是有对应的GSE210347_meta.txt.gz 18.5 Mb 文件，里面就给每个细胞一个身份了。如果假设作者没有提供，我们就需要加载作者的表达量矩阵文件 （GSE210347_counts.Rds.gz  ）然后走降维聚类分群流程啦。</p><h3 data-tool="mdnice编辑器"><span></span><span>拆分这个表达量矩阵</span><span></span></h3><p data-tool="mdnice编辑器">我做了一个简单的 操作：</p><pre data-tool="mdnice编辑器"><span></span><code>tmp = readRDS(<span>'../inputs/GSE210347_counts.Rds'</span>)<br>dim(tmp) <span># [1]  42113 855271</span><br>half_cols &lt;- ceiling(ncol(tmp) / <span>2</span>);half_cols<br><span>### part 1 </span><br>sce.all=CreateSeuratObject(<br>  counts = tmp[,<span>1</span>:half_cols]<br>)<br><span>### part 2</span><br>sce.all=CreateSeuratObject(<br>  counts = tmp[,(half_cols+<span>1</span>):ncol(tmp)]<br>)<br></code></pre><p data-tool="mdnice编辑器">上面的 855271 个细胞，被我平等的拆分成为了两个矩阵后各自构建了 Seurat对象，只需要对 两个 sce.all 变量 走我们的降维聚类分群流程即可。唯一的区别就是文章里面的分群UMAP图就是一个：</p><p><img data-galleryid="" data-imgfileid="100047951" data-ratio="0.6453703703703704" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxQia5qFh1SOWDTd6y8ufHUx7Nj816KX8F6Dw9OxQfP3BxOktUOPMDliardgKnf50twOVNxL8BA07bQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxQia5qFh1SOWDTd6y8ufHUx7Nj816KX8F6Dw9OxQfP3BxOktUOPMDliardgKnf50twOVNxL8BA07bQ/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>分群UMAP图就是一个</figcaption></figure><p data-tool="mdnice编辑器">但是我们把表达量矩阵拆分了，所以就会跑出来多个分群UMAP图，不过这个并不重要，因为我们之所以要跑降维聚类分群流程就是为了给细胞一个身份，这个过程甚至是可以免去降维聚类分群流程的，因为有很多自动化注释软件，它们是针对具体的每个单细胞本身独立的注释。</p><p data-tool="mdnice编辑器">比如，我们可以使用作者的降维聚类分群和细胞亚群命名结果来验证一下我们的拆分成为两个单细胞表达量矩阵之后的结果：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(data.table)<br>tmp = fread(<span>'../inputs/GSE210347_meta.txt.gz'</span>,<br>            data.table = <span>F</span>) <br><br>&gt; colnames(tmp)<br> [<span>1</span>] <span>"cellname"</span>        <span>"nCount_RNA"</span>      <span>"nFeature_RNA"</span>   <br> [<span>4</span>] <span>"SampleID"</span>        <span>"percent.mt"</span>      <span>"seurat_clusters"</span><br> [<span>7</span>] <span>"cluster"</span>         <span>"celltype"</span>        <span>"tissue"</span>         <br>[<span>10</span>] <span>"group"</span>          <br>&gt; table(tmp$celltype)<br><br>Endothelium  Epithelium Erythrocyte  Fibroblast  Lymphocyte     Myeloid <br>      <span>74102</span>      <span>268469</span>        <span>3295</span>      <span>104804</span>      <span>202077</span>      <span>151298</span> <br>     Plasma   undefined <br>      <span>37638</span>       <span>13588</span> <br></code></pre><p data-tool="mdnice编辑器">如下所示，哪怕是拆分了，结果仍然是还不错：</p><p><img data-galleryid="" data-imgfileid="100047950" data-ratio="1.2194444444444446" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxQia5qFh1SOWDTd6y8ufHUx37HIGP8yFI1HnZ7brOrGkTiaJnw5icdFFXugkYrMKbCtK6MyUJXIgFQw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxQia5qFh1SOWDTd6y8ufHUx37HIGP8yFI1HnZ7brOrGkTiaJnw5icdFFXugkYrMKbCtK6MyUJXIgFQw/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">而且绝大部分小伙伴拿到了主要的百万级别单细胞转录组数据集，其实并不会关心全局情况，<span><strong>应该是会挑选里面的具体的某个单细胞亚群，比如癌症相关成纤维细胞，</strong></span>然后对它继续细致的降维聚类分群后讨论它的临床意义。</p><p data-tool="mdnice编辑器">当然了，如果你想完成上面的操作，最好是有自己的计算机资源哦，比如我们的<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;scene=21#wechat_redirect" data-linktype="2">2024的共享服务器交个朋友福利价仍然是800</a>，而且还需要有基本的生物信息学基础，也可以看看我们的<a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247530001&amp;idx=1&amp;sn=676dcf224f9be23b288189775292aeeb&amp;chksm=9b4b36aaac3cbfbc3e3bb0865bd789d5093e3a643f3f345332995f707b7f209ae924e9e9529e&amp;scene=21#wechat_redirect" data-linktype="2">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课。</p><p data-tool="mdnice编辑器">如果你有了生物信息学基础，仅仅是感兴趣单细胞的细致分析，就看看SBC的 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247531593&amp;idx=1&amp;sn=83cf709e48a8cc2de5cebeadd138659b&amp;scene=21#wechat_redirect" data-linktype="2">Nature年度技术 | 单细胞及空间多组学实验技术与生信分析培训（暑期班）招生火热进行中</a></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Gp0g7idntfk0I9a08Q-dNA",target="_blank" rel="noopener noreferrer">原文链接</a>
