---
title: "肿瘤突变特征推断工具deconstructSigs"
date: 2024-06-19T23:44:28Z
draft: ["false"]
tags: [
  "fetched",
  "上海生物芯片"
]
categories: ["Acdemic"]
---
肿瘤突变特征推断工具deconstructSigs by 上海生物芯片
------
<div><p><img data-backh="91" data-backw="578" data-galleryid="" data-imgfileid="508569160" data-ratio="0.15666666666666668" data-src="https://mmbiz.qpic.cn/mmbiz_gif/YxibPYttzHV8eChu6IYmNtsGYsZiayjnymEPvBblaroSzAuOuyUMMzDpNxteNBaSWDMI6m4LyDJoSmmDIGaTmPEg/640?wx_fmt=gif" data-type="gif" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_gif/YxibPYttzHV8eChu6IYmNtsGYsZiayjnymEPvBblaroSzAuOuyUMMzDpNxteNBaSWDMI6m4LyDJoSmmDIGaTmPEg/640?wx_fmt=gif"></p><section><section><section><section><section><section><br></section></section></section><section><section><section><section><section><section><section><span>我们知道组成DNA序列的碱基总共有四种（A、T、C、G），而点突变（SNV）就是这四种碱基之间的替换，可以计算出替换类型为4*3=12种，考虑到碱基互补配对，我们将其归纳为六种突变类型：C&gt;A/G&gt;T，C&gt;G/G&gt;C，C&gt;T/G&gt;A，T&gt;A/A&gt;T，T&gt;C/A&gt;G，T&gt;G/A&gt;C。但仅仅考虑单个位点的突变难以形容生物体中复杂的功能，而功能基本单位氨基酸对应DNA序列上的密码子，密码子由三联碱基组成，根据点突变（SNV）碱基种类以及其上、下游 1bp 碱基种类，可以将点突变归纳分为 96 种（4x6x4）突变类型，我们把这96种碱基替换类型作为一种特征进行研究，以分析研究癌症的点突变类型的偏好和各种癌样本在点突变水平上的相似程度。</span></section><section><span></span><span>COSMIC统计了不同的肿瘤突变特征，并分析了各种突变特征的意义。</span></section></section></section><section><section><section><img data-imgfileid="508579110" data-ratio="0.44243792325056436" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6Nbiaw1OrdvjZOl7iamEdW46TrVcjibGgWrmjCpicwSX8m8ITrABaw1JTEg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="886" src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6Nbiaw1OrdvjZOl7iamEdW46TrVcjibGgWrmjCpicwSX8m8ITrABaw1JTEg/640?wx_fmt=png&amp;from=appmsg"></section></section></section><section><section><section><span>详情可参考网页：</span></section><section><span></span><span>http://cancer.sanger.ac.uk/cosmic/signatures</span></section></section></section><section><section><section><p><span>今天我们要介绍一种已知肿瘤突变特征推断工具deconstructSigs，这是一个R包，通过比非负矩阵分解（NMF），将样本突变特征映射到特征库中已知的特征矩阵上，从而获取该样本存在哪些特征，查询COSMIC网站获取特征含义。</span></p><p><span>简单说一下NMF原理：该算法同时输入 n 个样本突变频率的96*n阶矩阵V，以及k种已知特征突变频率的96*k阶矩阵 S，基于 T 和 S 的最小误差平方和 SSE 选取最能代表样本信息的突变特征，重构矩阵R，并依次进行迭代，直至前后两次迭代的 SSE&lt;0.001 为止，最终得到每种突变特征的权重矩阵W。</span></p><section><span>PS：理解不了的可略过，下面开始讲重点！</span></section></section></section></section><section><p><span>首先是软件的下载安装，这里推荐用conda安装，简单方便。支持最新版本R，小编就是在R 4.3.3下安装的。</span></p></section></section><section><section><section><section><section><section><section><section><section><p><span><em><span># 安装R包</span></em></span><span><br></span></p><p><span>conda install r-deconstructSigs</span></p><p><span><em><span># 安装基因组文件</span></em></span></p><p><span>BiocInstaller::biocLite('BSgenome')</span></p><p><span>BiocInstaller::biocLite('BSgenome.Hsapiens.UCSC.hg19')</span></p></section></section></section></section></section></section></section></section></section><section><section><span>PS：这个基因组文件后面用于构建96种突变特征矩阵，deconstructSigs提供了转换函数，当然也可以自己根据参考基因组构建。</span></section></section><section><section><section><section><section><section><p><em><span># 安装完成后导入</span></em><br></p><p>library("deconstructSigs")</p></section></section></section></section></section></section><section><section><section><p><span>先不急，我们看看R包内置的Signature数据库，软件内置了两套signature数据库，逐个打开看看：</span></p></section></section></section><section><section><section><p><span><em># 查看signatures.nature2013数据库</em></span><span><br></span></p><p>head(t(signatures.nature2013))</p></section></section></section><section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section><section><section><section><img data-imgfileid="508579111" data-ratio="0.22976878612716764" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6Je4iatSaqmlT0t7F31EY4v6S2ibFlA6fplkmJcbj9std7SN2iaXTsuicWQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="692" src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6Je4iatSaqmlT0t7F31EY4v6S2ibFlA6fplkmJcbj9std7SN2iaXTsuicWQ/640?wx_fmt=png&amp;from=appmsg"></section></section></section><section><section><section><section><section><section><p><em><span># 查看特征数</span></em></p><p>colnames(t(signatures.nature2013))</p></section></section></section></section></section></section><section><section><section><img data-imgfileid="508579109" data-ratio="0.1791907514450867" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6nHk4KVYkDfJUiaAmeoXCKiaJV73QdPghsGvtCBgJgGbQ5ZN2pDOUEUYA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="692" src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6nHk4KVYkDfJUiaAmeoXCKiaJV73QdPghsGvtCBgJgGbQ5ZN2pDOUEUYA/640?wx_fmt=png&amp;from=appmsg"></section></section></section><section><section><section><section><section><section><p><span><em><span># 查看signatures.cosmic数据库</span></em></span></p><p>head(t(signatures.cosmic))</p></section></section></section></section></section></section><section><section><section><img data-imgfileid="508579108" data-ratio="0.23699421965317918" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6MOFiaaTavMleUIxnFevVVC3icJJBA5Gc2TmhtQk92of2JMmJp7SBiap5A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="692" src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6MOFiaaTavMleUIxnFevVVC3icJJBA5Gc2TmhtQk92of2JMmJp7SBiap5A/640?wx_fmt=png&amp;from=appmsg"></section></section></section><section><section><section><section><section><section><p><span><em><span># 查看特征数</span></em></span></p><p>colnames(t(signatures.cosmic))</p></section></section></section></section></section></section><section><section><section><img data-imgfileid="508579114" data-ratio="0.1777456647398844" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6PnPDHG12qXBmmGhF9ZNSuB2NO5OVUmTZ9xUc8iaWGvwEicst2hE5Yciag/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="692" src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6PnPDHG12qXBmmGhF9ZNSuB2NO5OVUmTZ9xUc8iaWGvwEicst2hE5Yciag/640?wx_fmt=png&amp;from=appmsg"></section></section></section><section><section><section><span>可以看到每列对应一个signature，行数对应96种突变情况，中间的数值是每一个signature的96种突变情况的占比（每列和为1）；signatures.nature2013数据有27种signature，而signatures.cosmic数据有30种sginature，分析时可以选择某一个，软件默认用signatures.nature2013数据。</span><span>接下来，开始制作输入文件。通过肿瘤突变检测可以得到每个肿瘤样本的体细胞突变文件，如果是VCF文件，最好先进行注释，因为我们要根据注释信息进行突变位点筛选，只考虑对氨基酸有影响的点突变（SNV），这里用的是ANNOVAR注释结果，筛选标准如下：</span></section></section></section><section><section><section><p><span>（1）筛选Filter列，保留”PASS”</span></p><p><span>（2）筛选突变区域，保留”exonic”、”splicing”、“exonic;splicing”</span></p><p><span>（3）筛选非同义突变，去除“.”、”synonymous SNV”、”unknown”</span></p><p><span>（4）筛选DP&gt;=20、Nalt&gt;=3、AF&gt;0.01或0.05</span></p><p><span>（5）只保留snv</span></p></section></section></section><section><section><p><span>提取筛选后的突变结果信息，需要五列：Sample、chr、pos、ref、alt，如下所示：</span></p></section></section><section><section><section><p>##  Sample  chr  pos  ref  alt<br></p><p>##  T1_vs_N1  chr10  39948943   C  T</p><p>##  T1_vs_N1  chr10  41524064   T  C</p><p>##  T1_vs_N1  chr10  61107628   C  T</p></section></section></section><section><section><section><p><span>把该文件作为输入文件，通过<span lang="EN-US">mut.to.sigs.input</span>转换为<span lang="EN-US">96</span>种突变特征矩阵。</span><span lang="EN-US"><p></p></span></p></section></section></section><section><section><section><p><em><span># Using deconstructSigs</span></em><br></p><p>sample.mut.ref &lt;- read.table("T1.somatic.tsv", header = FALSE, sep = "\t")</p><p>head(sample.mut.ref)</p><p><br></p><p><em><span># mutfile, tsv format. ucsc.hg19</span></em></p><p>sigs.input &lt;- mut.to.sigs.input(mut.ref = sample.mut.ref,</p><p>sample.id = "T1_vs_N1",</p><p>    chr = "chr",</p><p>    pos = "pos",</p><p>    ref = "ref",</p><p>    alt = "alt",</p><p>    bsg = BSgenome.Hsapiens.UCSC.hg19)</p></section></section></section><section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section><section><section><p><span>PS：这里的sigs.input就是样本96种突变特征矩阵，可以自己制作，需要注意表头碱基替换类型保持一致。</span></p><p><span>我们可以将多个样本的sigs.input矩阵合并为一个，当然也可以不合并，文件格式如下：</span></p></section></section><section><section><section><img data-imgfileid="508579113" data-ratio="0.15606936416184972" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6y5iarNwvEiczuibtfxt4sTHWRRjrYHLOwqnUF0NzgiaNzkFfG5WVMCKOqg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="692" src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6y5iarNwvEiczuibtfxt4sTHWRRjrYHLOwqnUF0NzgiaNzkFfG5WVMCKOqg/640?wx_fmt=png&amp;from=appmsg"></section></section></section><section><section><section><span>现在我们可以进行样本signature推断了，使用whichSignatures函数：</span></section></section></section><section><section><section><p>sample.tumors = whichSignatures(tumor.ref = sigs.input, <br></p><p>signatures.ref = signatures.cosmic, </p><p>sample.id = sample, </p><p>contexts.needed = TRUE,</p><p>tri.counts.method = 'default')</p><p><span><em>参数说明：</em></span></p><p><span><em>tumor.ref：每个sample的96种三碱基突变序列signatures.ref：已知的signatures参考文件，可选signatures.nature2013和signatures.cosmicsample.id：对应tumor.ref文件中的样本名，每次只能运行一个样本contexts.needed ：是否需要突变上下文tri.counts.method：三核酸序列标准化方式，默认“default” 不进行标准化 ；或者选择exome,genome,exome2genome,genome2exome 来限定区域。</em></span></p></section></section></section><section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section><section><section><section><span>whichSignatures会输出5个元素的list文件：</span></section></section></section><section><section><section><p><span><em># 查看结果结构</em></span></p><p>class(sample.tumors)</p></section></section></section><section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section><section><section><section><img data-imgfileid="508579117" data-ratio="0.6459537572254336" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6lU8icgSYA028vUxqG41luia9jZg1onwib6fiar7tWabASvz2XzQiaEvt1dA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="692" src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6lU8icgSYA028vUxqG41luia9jZg1onwib6fiar7tWabASvz2XzQiaEvt1dA/640?wx_fmt=png&amp;from=appmsg"></section></section></section><section><section><p><span>weights：包含分配给输入签名矩阵的每个k个签名的权重的数据帧</span></p><p><span>tumor：作为输入的肿瘤样本的三核苷酸背景矩阵</span></p><p><span>product：当肿瘤矩阵乘以指定的权重时得到的矩阵</span></p><p><span>diff：表示肿瘤矩阵与乘积矩阵之差的矩阵</span></p><p><span>unknown：未分配给任何输入签名的数字权重</span></p></section></section><section><section><section><p><span>最后，为了更直观了解样本signature情况，使用plotSignatures函数可视化。</span></p></section></section></section><section><section><section><p><span><em># 绘制突变特征推断结果</em></span><br></p><p>plotSignatures(sample.tumors)</p></section></section></section><section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section><section><section><section><img data-imgfileid="508579116" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6SULekdTCweIk1pafuc4yUthHHqQKo9ia4nCL6a9c2iaSFP0gOOjxsZHQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="800" src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6SULekdTCweIk1pafuc4yUthHHqQKo9ia4nCL6a9c2iaSFP0gOOjxsZHQ/640?wx_fmt=png&amp;from=appmsg"></section></section></section><section><section><span>样本突变特征图</span></section></section><section><section><p><span>上图为该样本突变模式实际分布图，中图为由已知 cosmic signature构建出来的突变模式图，下图为两者的 sum-squared error，值越低越少。</span></p></section></section><section><section><section><p><span><em># 绘制突变特征权重饼图</em></span><br></p><p>makePie(sample.tumors)</p></section></section></section><section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section><section><section><section><img data-croporisrc="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6DsBO3ribMNC8UCMdR2KgQCXVawnJ0E7aRH5icVrkOkhAcfyicKVyr5Uyw/0?wx_fmt=png&amp;from=appmsg" data-cropx1="51.461988304093566" data-cropx2="800" data-cropy1="0" data-cropy2="686.1598440545808" data-imgfileid="508579115" data-ratio="0.9158878504672897" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ60zqhzKWGu2SIZsQAmznCbLvtGFY6YFbkORSrz7ahgcqgy80SpPrGgw/640?wx_fmt=jpeg" data-type="jpeg" data-w="749" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ60zqhzKWGu2SIZsQAmznCbLvtGFY6YFbkORSrz7ahgcqgy80SpPrGgw/640?wx_fmt=jpeg"></section></section></section><section><section><span>样本突变特征权重饼图</span></section></section><section><section><section><section><section><br></section></section></section></section></section><section><section><section><section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section><section><section><img data-imgfileid="508579118" data-ratio="0.69" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6GLTVPHsPs2XVBkPaFPlTmRhHic3qq9HQ1XVHlDH5J58FDMDStR85KOQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="500" src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHVibMuHdd3qasA9LCd8CdcEQ6GLTVPHsPs2XVBkPaFPlTmRhHic3qq9HQ1XVHlDH5J58FDMDStR85KOQ/640?wx_fmt=png&amp;from=appmsg"></section></section></section></section><section><section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section></section><section><section><section><section><span>这里是根据已知signature进行推断，那未知的signature是如何推断的呢？</span><span>下期再给大家分享。</span></section></section></section></section></section></section></section></section></section><section data-tools="135编辑器" data-id="117900"><section><section><section><section><section><section><section><section><br></section></section></section></section><section><section><strong>SBC中心实验室</strong></section></section></section></section><section><section><section data-autoskip="1"><p><span>SBC中心实验室聚焦单细胞、空间多组学前沿技术，围绕基因组、表观组、转录组、蛋白组、代谢组和微生物组等多维组学研究，以国际一流水平的技术平台，二十余年专业经验的技术团队，打造创新产品服务体系，高效助力科学发现产品研发。中心始终以严谨的科学态度，坚持创新，服务国家重大战略任务，推动技术成果转化应用和带动产业集群发展。长期举办学术论坛、专题研讨会、前沿技术培训，为数十家跨国制药企业和上千家国内科研机构、院校、医院提供系统全面一站式的科研与转化解决方案，日益发挥面向生物医药全行业功能效益和策源动力。</span></p></section></section></section></section></section></section></section><p><br></p><p powered-by="xiumi.us"><img data-imgfileid="508577564" data-ratio="0.5625" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/YxibPYttzHV93qUiajmIIjgqz174RGgl04hlvoMic9ppj1pGnqXicjFdTs6qiaAhZqlInGgX4oRQZOlbzqJCOMs3R2Q/640?wx_fmt=gif&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-w="640" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/YxibPYttzHV93qUiajmIIjgqz174RGgl04hlvoMic9ppj1pGnqXicjFdTs6qiaAhZqlInGgX4oRQZOlbzqJCOMs3R2Q/640?wx_fmt=gif&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/WIjvJ-MDSv7VERyESCTgtw",target="_blank" rel="noopener noreferrer">原文链接</a>
