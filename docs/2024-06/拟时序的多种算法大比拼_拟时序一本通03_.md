---
title: "拟时序的多种算法大比拼（拟时序一本通03）"
date: 2024-06-13T05:44:38Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
拟时序的多种算法大比拼（拟时序一本通03） by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>前面我们在 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528633&amp;idx=1&amp;sn=4a0b154bdc8ac4797c3d00f08f0eeeab&amp;scene=21#wechat_redirect" data-linktype="2">为什么做拟时序</a> 提到了其实可以把拟时序分析简化成为了主要是为了展示差异细节，然后在 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528643&amp;idx=1&amp;sn=f1ac855d3ac817ca3cef585ec019ebc0&amp;scene=21#wechat_redirect" data-linktype="2">拟时序的正确姿势</a> 我们3个案例来说明一下拟时序的正确姿势，错误示范，还有创新型的应用场景。</p></blockquote><p data-tool="mdnice编辑器">而且这些案例文献都不约而同的使用了monocle2这个软件，但是并不意味着它是金标准，也不意味着非monocle2不可。这个纯粹就是生物信息学领域的“马太效应”，大家都用monocle2做拟时序，所以后来者就简单的追随即可，而且绝大部分人其实并不关心算法细节，仅仅是为了做拟时序而做，那么就无所谓选择哪个软件了。实际上，做拟时序确实是有很多软件和算法的选择，我们可以来看看两个经典的综述，借此机会系统性梳理一下这方面背景知识。</p><h3 data-tool="mdnice编辑器"><span></span><span>首先看2016的综述对比10款算法软件</span><span></span></h3><p data-tool="mdnice编辑器">文章是：《<strong>Computational methods for trajectory inference from single-cell transcriptomics</strong>》，该综文章述对比10款算法软件并且列出来了各自的优缺点，可以看到那个时候monocle2做拟时序的突出就已经成定局了，而且它是引用率最高的！</p><p><img data-galleryid="" data-imgfileid="100045021" data-ratio="0.4752808988764045" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzkl3QXrrowx6IWwm0Ba1mTiarkjAFdqqh9oLaP0G2lgeBPQ6PKvcu0IUjrXh1g8eturibWkNP69jibw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1780" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzkl3QXrrowx6IWwm0Ba1mTiarkjAFdqqh9oLaP0G2lgeBPQ6PKvcu0IUjrXh1g8eturibWkNP69jibw/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>各自的优缺点</figcaption></figure><p data-tool="mdnice编辑器">总体上来说，这些软件首先区分成为了两个流派，就是专注于做Linear trajectories 的，以及可以做branched trajectories的。</p><p data-tool="mdnice编辑器">然后它们这些软件算法都包含了两个步骤，就是降维（Dimensionality reduction）和轨迹构建（Trajectory modelling），这两个步骤的不同算法的组合就确定了不同的软件。比如最经典的monocle2做拟时序就是independent component analysis (ICA）的降维处理，配合  a minimal spanning tree (MST) 的构建拟时序关系算法。而其它软件会选择各种降维算法，比如 principal compo- nent analysis (PCA），diffusion maps, and <em>t</em>-SNE等等，或者各种其它构建拟时序关系算法。</p><h3 data-tool="mdnice编辑器"><span></span><span>然后看2019的综述对比45款算法软件</span><span></span></h3><p data-tool="mdnice编辑器">文章是：《A comparison of single-cell trajectory inference methods》工作量就更大了：we evaluated the accuracy, scalability, stability and usability of 45 TI methods 。</p><p data-tool="mdnice编辑器">可以看到，前面的2016的综述还在使用Linear和branched分类，这次2019的综述就扩充到了7种不同轨迹形式：</p><ul data-tool="mdnice编辑器"><li><section>循环（Cycle）</section></li><li><section>线性（Linear）</section></li><li><section>二分支（Bifurcation）</section></li><li><section>多分支（Multifurcation）</section></li><li><section>树状（Tree）</section></li><li><section>连通图（Connected graph）</section></li><li><section>不连通图（Disconnect graph）</section></li></ul><p data-tool="mdnice编辑器">并且是提出来了4个评价指标来测评这些软件工具：</p><ul data-tool="mdnice编辑器"><li><section>HIM (Hamming-Ipsen-Mikhailov distance), F1 branches, F1 Milestones, and correlation metrics</section></li></ul><p data-tool="mdnice编辑器">如下所示：</p><p><img data-galleryid="" data-imgfileid="100045020" data-ratio="0.493099121706399" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzkl3QXrrowx6IWwm0Ba1mTu6HrbJ8uBPo5mHXzsKqia5JYSeMujPzK0k1OqJibpf3vRichJg3vDfiaww/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1594" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzkl3QXrrowx6IWwm0Ba1mTu6HrbJ8uBPo5mHXzsKqia5JYSeMujPzK0k1OqJibpf3vRichJg3vDfiaww/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>7种不同形式</figcaption></figure><p data-tool="mdnice编辑器">这个时候<strong>不同的拟时序软件工具就很难一次性覆盖这些全部的7种不同轨迹形式啦，不同的工具擅长不同的轨迹，这样的话对纯粹的工具使用者来说就很尴尬</strong>，因为大家不可能说在自己的单细胞项目去把这几十种工具全部测试一次，还得针对7种不同轨迹形式进行组合评价，工作量不可谓不大！</p><p data-tool="mdnice编辑器">所以这个时候其实生物学背景更加重要了，前面我们在 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528633&amp;idx=1&amp;sn=4a0b154bdc8ac4797c3d00f08f0eeeab&amp;scene=21#wechat_redirect" data-linktype="2">为什么做拟时序</a> 提到了其实可以把拟时序分析简化成为了主要是为了展示差异细节，比如CD14和CD16的两种单核细胞的差异细节，或者说说CD56和CD16这两种NK细胞的差异细节。<strong>我们的生物学背景让我们知道简单的两个细分亚群大概率上就是简单的Linear和branched形式的轨迹，不太可能是超级复杂的各种拟时序轨迹结果</strong>，除非你做的是完全陌生领域的陌生单细胞亚群的从零开始的真正的发育推断！</p><p data-tool="mdnice编辑器">既然绝大部分小伙伴都做的是普普通通的差异细节的展示，那么其实根据这个综述选择一两个比较好的软件工具即可：</p><p><img data-galleryid="" data-imgfileid="100045022" data-ratio="0.5343347639484979" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzkl3QXrrowx6IWwm0Ba1mTfbt0dwaEdGQ3Inz1zarqF9wr5mOFX43cRSUZLTQEzQYjw5W0APiahRQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1864" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzkl3QXrrowx6IWwm0Ba1mTfbt0dwaEdGQ3Inz1zarqF9wr5mOFX43cRSUZLTQEzQYjw5W0APiahRQ/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>选择一两个比较好的软件工具</figcaption></figure><p data-tool="mdnice编辑器">比如我们就分享了一下软件工具的实战笔记：</p><ul data-tool="mdnice编辑器"><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247510987&amp;idx=2&amp;sn=e57f26a7f86e2101ea5ab65b52db1277&amp;chksm=9b4beb70ac3c6266af103e1d3735cdc067dfc2906595f106ee11f21c411f550422c3f4574d29&amp;scene=21#wechat_redirect" data-linktype="2">简单直接的拟时序分析方法，R包SCORPIUS推荐</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247510054&amp;idx=1&amp;sn=4ad5a90afe5197c1c97f5d1cefdd7a70&amp;chksm=9b4be89dac3c618b07ee2c26247da0c608d54ba173ce0358af358a7c97eb46a7dc1024d0aad1&amp;scene=21#wechat_redirect" data-linktype="2">把基因表达量画在拟时序结果图上</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247509858&amp;idx=2&amp;sn=476461cd7b7b77febf32b14884bb7b6d&amp;chksm=9b4be7d9ac3c6ecf89dfd9cb40e2f2d569837549583a5168f325695661ecd0c8a0fd78a09f30&amp;scene=21#wechat_redirect" data-linktype="2">拟时序分析就是差异分析的细节剖析</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247502953&amp;idx=2&amp;sn=f2c5921407c59692bf1f8e8d18632e48&amp;chksm=9b4b8cd2ac3c05c452dc4f5abd655bb612bdb03fbcdfba1d505038da2561f093f591d31b2f9d&amp;scene=21#wechat_redirect" data-linktype="2">拟时序分析的10个步骤</a></section></li></ul><p data-tool="mdnice编辑器">另外，值得一提的是这个2019的综述其实还把他们的45个软件的测评过程和结果做成了一个易于使用的R包<strong>dynverse</strong> is a collection of <strong>R packages</strong> aimed at supporting the <strong>trajectory inference (TI)</strong> ：</p><ul data-tool="mdnice编辑器"><li><section>https://dynverse.org/</section></li><li><section>https://github.com/dynverse/dynmethods</section></li><li><section>https://github.com/dynverse/dyno</section></li></ul><h3 data-tool="mdnice编辑器"><span></span><span>新的算法仍然会持续不断出来</span><span></span></h3><p data-tool="mdnice编辑器">可以看到早在2016的拟时序综述就已经确定下来了monocle2的江湖地位，到后来的2019综述的几十块拟时序软件就足以让普通用户眼花缭乱了，而且每个软件工具也会自我进化，比如monocle2的团队就更新了monocle3。</p><p data-tool="mdnice编辑器">而且可以超脱表达量矩阵本身，引入全新信息来开发拟时序工具。比如可以引入具体的每个基因的转录本的未剪接和剪接 mRNA数值，就可以构建RNA 速率模型做分析，得到的发育顺序就有方向而且可靠啦，详见：<a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247511998&amp;idx=1&amp;sn=7d746ce3e6004f38ba134357bec4149b&amp;chksm=9b4bef05ac3c6613cb462ab43d00a555451ea5b6df6a77a75cdf2664d834fc330db90242a492&amp;scene=21#wechat_redirect" data-linktype="2">10x官网下载pbmc3k数据集走RNA速率上下游分析实战</a>。目前最经典的就是velocyto和scVelo啦，步骤是：</p><ul data-tool="mdnice编辑器"><li><section>velocyto pipeline (La Manno et al., Nature, 2018) to obtain the pre-mature (unspliced) and mature (spliced) transcript information based on Cell Ranger output.</section></li><li><section>然后基于上面的loom文件去运行scVelo</section></li></ul><p data-tool="mdnice编辑器">参考：https://www.10xgenomics.com/cn/analysis-guides/trajectory-analysis-using-10x-Genomics-single-cell-gene-expression-data</p><p data-tool="mdnice编辑器">但是这个基于基因的转录本的未剪接和剪接 mRNA数值的RNA速率推断也有缺点，首先是需要对测序的fastq文件重新分析，才能获取到未剪接和剪接 mRNA数值，<strong>其次在传统的基于二代测序数据的10x单细胞转录组其实仅仅是测了具体的每个mRNA的两端二选一而已，并没有把两个mRNA测通所以就很难获得准确的未剪接和剪接 mRNA数值</strong>。当然了，算法会一直有更新，全新的软件和工具也会被持续不断的开发出来，慢慢的就解决了以前的问题。比如2024新发表的scVelo，就不再依赖于剪接信息，而是通过引入基因调控数据 ，提供更准确的细胞轨迹信息和伪时间推断结果。详见</p><ul data-tool="mdnice编辑器"><li><section>文章：TFvelo: gene regulation inspired RNA velocity estimation. Nat Commun</section></li><li><section>github官网（Python软件）：https://github.com/xiaoyeye/TFvelo</section></li></ul><p data-tool="mdnice编辑器">值得一提的是拟时序一本通专辑的目录是：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528633&amp;idx=1&amp;sn=4a0b154bdc8ac4797c3d00f08f0eeeab&amp;scene=21#wechat_redirect" data-linktype="2">为什么做拟时序</a> （展示差异细节）</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528643&amp;idx=1&amp;sn=f1ac855d3ac817ca3cef585ec019ebc0&amp;chksm=9b4b3078ac3cb96e54cb9752dda836d59ed77fd37f5206c590039c11699470885dba95e73e10&amp;scene=21#wechat_redirect" textvalue="拟时序的正确姿势，错误示范，创新型拟时序" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">拟时序的正确姿势，错误示范，创新型拟时序</a></section></li><li><section>拟时序的多种算法大比拼</section></li><li><section>monocle2拟时序实战</section></li><ul><li><section>降维聚类分群</section></li><li><section>拟时序</section></li><li><section>多种基础可视化</section></li><li><section>正向特殊可视化（目标基因表达量，基因集打分）</section></li><li><section>反方向特殊可视化（5种可视化）</section></li></ul><li><section>monocle3拟时序实战</section></li><li><section>SCORPIUS实战</section></li><li><section>Slingshot实战</section></li><li><section>基于其它编程语言的拟时序分析</section></li></ul><p data-tool="mdnice编辑器">然而，本人的理解肯定是片面的，希望通过这10个推文的指引能让大家对单细胞转录组的明星分析方法拟时序有一个基础的认知。也欢迎大家提出来自己的不同的看法，或者自己对拟时序的疑惑之处，欢迎留言参与讨论哦！</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/j4zezzyiNRhZGKisUWPQ7w",target="_blank" rel="noopener noreferrer">原文链接</a>
