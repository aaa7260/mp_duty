---
title: "Phantompeakqualtools — 质量评估之cross correlation分析"
date: 2024-06-19T00:05:39Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
Phantompeakqualtools — 质量评估之cross correlation分析 by 生信菜鸟团
------
<div><section data-md5="d93a6" act="xmy"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><p data-md5="d93a6"><strong data-md5="d93a6">工欲善其事必先利其器</strong></p></section></section></section></section></section></section></section><p><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">链交叉相关性分析是ChIP-seq质量评估的一个重要指标，基于高质量ChIP-seq实验会在蛋白质结合位点周围产生显著的富集DNA序列标签富集这一事实。这些“真实信号”的序列标签位于结合位点中心的一定距离处，这个距离取决于片段大小分布（Kharchenko等人，2008年）。这使得开发出一种基于基因组范围内链密度相关性的片段聚集（IP富集）量度成为可能。这种量度是通过计算Crick链和Watson链之间的皮尔逊线性相关性来实现的，计算时会将Watson链移动k个碱基对。这通常在交叉相关图中产生两个峰：一个对应于主要片段长度的富集峰，另一个对应于读长的峰（“幽灵”峰）。</p><h2 data-tool="mdnice编辑器"><span><span>1</span></span><span>phantompeakqualtools</span></h2><p data-tool="mdnice编辑器">phantompeakqualtools是由 Anshul Kundaje开发的一款用于评估ChIP-seq和相关高通量测序数据的质量的工具，其具有以下功能</p><ul data-tool="mdnice编辑器"><li><section><strong>信号与噪声评估</strong>：Phantompeakqualtools可以计算样本中的信号与噪声比例，帮助研究人员评估数据的质量。这包括计算如NSC（Normalized Strand Coefficient）和RSC（Relative Strand Coefficient）等关键指标，这些指标能够反映样本中信号的清晰度和显著性。</section></li><li><section><strong>幽灵峰的识别</strong>：该工具能够识别数据中的幽灵峰（phantom peaks），这些通常是由于非特异性结合或实验操作错误产生的假阳性信号。</section></li><li><section><strong>峰值检测</strong>：Phantompeakqualtools还包含峰值检测功能，能够识别和分析数据中的信号峰，这对于确定蛋白质-DNA相互作用和其他基因组标记非常重要。</section></li></ul><p data-tool="mdnice编辑器">Github:</p><ul data-tool="mdnice编辑器"><li><section>https://github.com/kundajelab/phantompeakqualtools</section></li></ul><p data-tool="mdnice编辑器">编程语言：R</p><h2 data-tool="mdnice编辑器"><span><span>2</span></span><span>来源</span></h2><blockquote data-tool="mdnice编辑器"><p>题目：ChIP-seq guidelines and practices of the ENCODE and modENCODE consortia<br>期刊：Genome Research<br>日期：2012/9DOI：10.1101/gr.136184.111</p></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100039922" data-ratio="0.562037037037037" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicqlJOiaWkVgf5eeobKrJkNibEBZZ8PZVempziauThg41RycrYY7AVib6LAP3bmQw5dsFJ1aaumIU9sLg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicqlJOiaWkVgf5eeobKrJkNibEBZZ8PZVempziauThg41RycrYY7AVib6LAP3bmQw5dsFJ1aaumIU9sLg/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span><span>3</span></span><span>如何安装</span></h2><h3 data-tool="mdnice编辑器"><span></span><span>conda 安装</span><span></span></h3><p data-tool="mdnice编辑器">推荐使用conda安装，可以直接安装运行所需的依赖包，方便快捷</p><pre data-tool="mdnice编辑器"><span></span><code>conda activate chipseq<br>conda install bioconda::phantompeakqualtools<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100039921" data-ratio="0.3814814814814815" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicqlJOiaWkVgf5eeobKrJkNibIqZx0sblX7JIwmGKn6bkNWYtBkSnCGqSn0ta6KMuJbmc1o7dic597qw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicqlJOiaWkVgf5eeobKrJkNibIqZx0sblX7JIwmGKn6bkNWYtBkSnCGqSn0ta6KMuJbmc1o7dic597qw/640?wx_fmt=png&amp;from=appmsg"></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100039923" data-ratio="0.38425925925925924" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicqlJOiaWkVgf5eeobKrJkNib8ajPpnvjycZQ2Php5KjJjSGmibiaoA3NKSRBXTe6VKZj61Wmr7VY9WCQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicqlJOiaWkVgf5eeobKrJkNib8ajPpnvjycZQ2Php5KjJjSGmibiaoA3NKSRBXTe6VKZj61Wmr7VY9WCQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>依赖</figcaption></figure><h2 data-tool="mdnice编辑器"><span><span>4</span></span><span>使用示例</span></h2><h3 data-tool="mdnice编辑器"><span></span><span>计算cross correlation</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span><span>#激活环境</span></span><br>conda activate chipseq<br><br>run_spp.R -rf \<br>-c=/home/data/t020559/chip_seq/GSE205035_PRJNA843319/e_mkdup/SRR19436494_H3K27ac-OXA_mkdup.bam \<br>-p=8 \<br>-odir=/home/data/t020559/chip_seq/GSE205035_PRJNA843319/test \<br>-savp=SRR19436494_H3K27ac-OXA_mkdup.pdf \<br>-out=SRR19436494_H3K27ac-OXA_mkdup_cross.txt<br><span><br>#</span><span><span>#参数释义</span></span><br>-c=&lt;ChIP_alignFile&gt;：#ChIP测序数据文件的完整路径和名称，<br>-i=&lt;Input_alignFile&gt;：#输入对照（input control）文件的完整路径和名称<br>-p=&lt;num&gt; ：#设置线程，默认为0<br>-s=&lt;min&gt;:&lt;step&gt;:&lt;max&gt;：#评估交叉相关性的链移位范围，默认为-500:5:1500<br>-rf : #如果存在同名文件，则替换（覆盖输出结果）<br>-tmpdir=&lt;tempdir&gt;：#临时目录，如果未指定，则使用R函数 tempdir() 的结果<br>-filtchr=&lt;chrnamePattern&gt;：#用于移除映射到特定染色体的标签的模式，例如使用"chrM"将移除所有名称中包含"chrM"的染色体的标签<br>-odir=&lt;outputDirectory&gt;：#输出目录的名称，如果未设置，则使用当前目录<br>-savn=&lt;narrowpeakfilename&gt;：#保存NarrowPeak文件的名称<br>-savr=&lt;regionpeakfilename&gt;：#保存RegionPeak文件的名称<br>-savd=&lt;rdatafile&gt; ：#保存R数据文件<br>-savp=&lt;plotdatafile&gt; ：#保存交叉相关图的文件<br>-out=&lt;resultfile&gt;：#将peakshift/phantomPeak结果追加到文件中<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100039924" data-ratio="0.8333333333333334" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicqlJOiaWkVgf5eeobKrJkNibk0vAFBtbdWFnBLMrljPicBlKQD1eEIpOpTH8a3tHxWqSkrCyFDxnELg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicqlJOiaWkVgf5eeobKrJkNibk0vAFBtbdWFnBLMrljPicBlKQD1eEIpOpTH8a3tHxWqSkrCyFDxnELg/640?wx_fmt=png&amp;from=appmsg"><figcaption>运行示例</figcaption></figure><h2 data-tool="mdnice编辑器"><span><span>5</span></span><span>结果说明</span></h2><pre data-tool="mdnice编辑器"><span></span><code>cat SRR19436494_H3K27ac-OXA_mkdup_cross.txt<br>SRR19436494_H3K27ac-OXA_mkdup.bam       26755432        0,330,375       0.252146613583201,0.237250183628446,0.237133227855954   150     0.3129999       1500    0.2282759       1.10457   0.2817472       -1<br></code></pre><p data-tool="mdnice编辑器">结果共11列，分别为：</p><ul data-tool="mdnice编辑器"><li><section>Filename - 文件名，包含tagAlign或BAM格式的文件名。</section></li><li><section>numReads - 有效测序深度，即输入文件中映射读取的总数。</section></li><li><section>estFragLen - 逗号分隔的链交叉相关峰值，按相关度降序排列。</section></li><li><section>corr_estFragLen - 逗号分隔的链交叉相关值，也是按降序排列（与第3列的顺序相对应）。</section></li><li><section>phantomPeak - 读长/幽灵峰的链位移。</section></li><li><section>corr_phantomPeak - 在幽灵峰处的相关值。</section></li><li><section>argmin_corr - 交叉相关性最低时的链位移。</section></li><li><section>min_corr - 交叉相关性的最小值。</section></li><li><section>NSC - 标准化链交叉相关系数，计算公式为第4列值除以第8列值（NSC = COL4 / COL8）。</section></li><li><section>RSC - 相对链交叉相关系数，计算公式为（第4列值减第8列值）除以（第6列值减第8列值）（RSC = (COL4 - COL8) / (COL6 - COL8)）。</section></li><li><section>QualityTag - 基于阈值化的RSC的质量标记（编码：-2：非常低，-1：低，0：中等，1：高，2：非常高）。</section></li></ul><figure data-tool="mdnice编辑器"><img data-imgfileid="100039920" data-ratio="1.025" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicqlJOiaWkVgf5eeobKrJkNib6ibCYibtZicrqHUzWnCGYwiceQN3wuDGKQVwHDHoCtGGL8qnZCgFguo5dA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicqlJOiaWkVgf5eeobKrJkNib6ibCYibtZicrqHUzWnCGYwiceQN3wuDGKQVwHDHoCtGGL8qnZCgFguo5dA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">图中的黑线代表实验数据的交叉相关性，蓝色虚线代表片段长度峰，红色虚线表示主峰的真实位移。这些峰的位置说明了测序片段和可能的非特异性信号的分布。NSC值为1.10457，这个值大于1，表明相对于背景信号，片段长度峰有较好的信号强度。RSC值为0.28147，这个值低于常规的阈值1，说明信号与幽灵峰之间的对比度不是很高，信号与噪声的比例较低。</p><p data-tool="mdnice编辑器"><strong>NSC（Normalized Strand Coefficient）</strong> ：片段长度交叉相关峰与背景交叉相关的比值，是评估信号与噪声比的一个强有力的度量。</p><ul data-tool="mdnice编辑器"><li><section><strong>数值范围</strong>：NSC的值从1开始，可以达到更高的正数。数值1表示数据中信号与噪声的比例是平衡的，超过1表示信号强于噪声。</section></li><li><section><strong>临界阈值</strong>：1.1被认为是一个关键的临界点。NSC值大于或等于1.1通常表示数据具有相对较高的信号强度。</section></li><li><section><strong>低于阈值的含义</strong>：当NSC值远低于1.1（如小于1.05）时，可能表明数据中的信号与噪声比低，或峰值数量少。这种情况可能是生物学上合理的，例如某些转录因子在特定组织类型中仅绑定少数位点；也可能是由于样本质量不佳。</section></li></ul><p data-tool="mdnice编辑器"><strong>RSC（Relative Strand Coefficient）</strong>：片段长度峰与读长峰的比值，同样用于评估信号的质量</p><ul data-tool="mdnice编辑器"><li><section><strong>数值范围</strong>：RSC的值从0开始，可以增加到更高的正数。数值1是另一个关键的临界点。</section></li><li><section><strong>临界阈值</strong>：RSC值在1或以上通常表示样本中的信号较为清晰和显著。</section></li><li><section><strong>低于阈值的含义</strong>：当RSC值显著低于1（如小于0.8）时，同样可能表示数据中的信号与噪声比低。低RSC分数可能是由于ChIP实验失败、测序质量低、读取映射错误多、测序深度不足等原因造成的。同NSC一样，如果一个数据集中的结合位点数量很少（如少于200），并且这种现象在生物学上是合理的，也可能显示低RSC分数。</section></li></ul><h2 data-tool="mdnice编辑器"><span><span>6</span></span><span>Peak calling</span></h2><p data-tool="mdnice编辑器">其也有峰值检查的功能，示例代码如下。不过速度很慢。不是很建议使用。推荐使用：MACS 。见<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247522180&amp;idx=1&amp;sn=24935b227a35f734d4ba25797303db0f&amp;chksm=fa4552b9cd32dbaf8a9a0f158f62000ee1d3612285b3097cb35c80dbea1ceac8f2ead106227e&amp;scene=21#wechat_redirect" textvalue="MACS3—探索基因组调控的钥匙" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">MACS3—探索基因组调控的钥匙</a></p><pre data-tool="mdnice编辑器"><span></span><code>run_spp.R -rf \<br>-c=/home/data/t020559/chip_seq/GSE205035_PRJNA843319/e_mkdup/SRR19436494_H3K27ac-OXA_mkdup.bam \<br>-i=/home/data/t020559/chip_seq/GSE205035_PRJNA843319/e_mkdup/SRR19436498_Input-OXA_mkdup.bam \<br>-fdr=0.01 \<br>-odir=/home/data/t020559/chip_seq/GSE205035_PRJNA843319/test/OXA \<br>-savn -savr -savp -savd<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100039929" data-ratio="0.5555555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicqlJOiaWkVgf5eeobKrJkNib639ayGSm3xOSyYfzpeqf8hJRiaVd4HUKpj2H4mX4X8bHQRMAWStLPSQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicqlJOiaWkVgf5eeobKrJkNib639ayGSm3xOSyYfzpeqf8hJRiaVd4HUKpj2H4mX4X8bHQRMAWStLPSQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>运行示例</figcaption></figure></section><section><section act="xmy"><section data-id="123409" data-type="lspecial02,lspecial04" powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><br></section><section powered-by="xmyeditor.com" data-md5="8b46d"><img data-imgfileid="100039931" data-ratio="0.6940298507462687" data-type="gif" data-w="134" data-src="https://mmbiz.qpic.cn/mmbiz_gif/iaRJcrq2LosibrvQnXTV3PMktpwwmDsjia2JG4e3ibpLQ1G6M4nktW4PiaiaKfnpiaRmNbTT6St7QLfzAMAomKgWxQ4kA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp" src="https://mmbiz.qpic.cn/mmbiz_gif/iaRJcrq2LosibrvQnXTV3PMktpwwmDsjia2JG4e3ibpLQ1G6M4nktW4PiaiaKfnpiaRmNbTT6St7QLfzAMAomKgWxQ4kA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp"></section><section powered-by="xmyeditor.com" data-md5="8b46d"><br></section></section></section></section></section></section><p><span></span><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247531360&amp;idx=1&amp;sn=0d9f69babb961a0a728d929b91a5fe22&amp;chksm=9b4b3bdbac3cb2cd2bf0c1b1b36fdd5c17ec97b7b73047823bd461df6bf2bbcddd5230f1aa08&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课7月班" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">生信入门&amp;数据挖掘线上直播课7月班</a>，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;chksm=9b4b2f10ac3ca606c1c4bac8cf112bb9b0f18e3c4262f5f2b8c0dba3bfedf2ba201507247005&amp;scene=21#wechat_redirect" textvalue="2024的共享服务器交个朋友福利价仍然是800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">2024的共享服务器交个朋友福利价仍然是800</a></section></li></ul></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/VaP1apm3ERu6oZrLjP2NVw",target="_blank" rel="noopener noreferrer">原文链接</a>
