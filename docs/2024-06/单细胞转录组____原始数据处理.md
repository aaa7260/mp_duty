---
title: "单细胞转录组 —— 原始数据处理"
date: 2024-06-19T03:55:24Z
draft: ["false"]
tags: [
  "fetched",
  "生信杂货铺"
]
categories: ["Acdemic"]
---
单细胞转录组 —— 原始数据处理 by 生信杂货铺
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>前言</span><span></span></h2><p data-tool="mdnice编辑器">文章参考 <span>Single-cell best practices</span><sup>[1]</sup> 中原始数据处理部分。</p><p data-tool="mdnice编辑器">我们这里所说的 <code>sc/snRNA-seq</code> 原始数据处理涉及多个步骤，从测序仪下机产生的 <code>BCL</code> 文件到原始的 <code>FASTQ</code> 文件，再到序列比对，最后以 <code>reads</code> 计数矩阵结束。</p><p data-tool="mdnice编辑器">计数矩阵代表了每个细胞中每个基因所产生的不同分子数量的估计值，并可以根据每个分子推测的剪接状态对数据进行分层。</p><p data-tool="mdnice编辑器">整体流程如下图<img data-imgfileid="100013441" data-ratio="0.46333897349125774" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWJbeKbsX9iaBt7nOoNUABmJFfGQZZdobUexTY4weXIBFGYUeL53KVKKm8cJCGp8Dc1c2W5ibbE3mnEg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="3546" src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWJbeKbsX9iaBt7nOoNUABmJFfGQZZdobUexTY4weXIBFGYUeL53KVKKm8cJCGp8Dc1c2W5ibbE3mnEg/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">这个计数矩阵是所有下游分析的起点，包括数据归一化、整合和过滤方法，以及推断细胞类型、发育轨迹和表达动态的方法等。</p><p data-tool="mdnice编辑器">因此对该计数矩阵进行稳健而准确的评估，是实现准确可靠的后续分析的基础和关键步骤。</p><p data-tool="mdnice编辑器">在原始数据处理中的错误会导致后续分析中出现遗漏、削弱或扭曲原本存在的生物信息。</p><p data-tool="mdnice编辑器">我们主要介绍原始数据处理的基本步骤，包括序列比对、细胞条形码（<code>CB</code>）识别和校正，以及通过解析唯一分子标识符（<code>UMI</code>）估算分子数。</p><blockquote data-tool="mdnice编辑器"><span></span><p><strong>注意</strong></p><p>我们所说的原始数据一般指的是 <code>FASTQ</code> 文件，但是在 <code>FASTQ</code> 生成的上游也可能出现问题，如索引跳转，不过这些问题可以通过 <code>in silico</code> 方法和增强协议（如双索引）在很大程度上得到缓解。在本节中，我们将不考虑这些上游影响。</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>原始数据的质量控制</span><span></span></h2><p data-tool="mdnice编辑器">获得原始 <code>FASTQ</code> 文件后，可通过运行质量控制（<code>QC</code>）工具（如 <code>FastQC</code>）来评估读数质量、序列内容等，从而快速诊断 <code>reads</code> 的质量。</p><p data-tool="mdnice编辑器">如果运行成功，会为每个输入文件生成一份 <code>QC</code> 报告。该报告总结了质量得分、碱基含量和某些相关统计数据，以发现源于文库制备或测序的潜在问题。</p><p data-tool="mdnice编辑器">虽然现在的单细胞原始数据处理工具都会在内部评估一些对单细胞数据很重要的质量检查，如序列中 <code>N</code> 的含量和比对上序列的百分比等，但在处理数据前运行快速质量检查仍然是一个好习惯，因为它可以评估其他有用的质量控制指标。</p><h2 data-tool="mdnice编辑器"><span></span><span>序列比对</span><span></span></h2><p data-tool="mdnice编辑器">目前大部分序列比对算法都是基于 <code>bulk</code> 测序数据，但是单细胞测序的原始序列文件包含细胞的信息（如 <code>CB</code>、<code>UMI</code>）。</p><p data-tool="mdnice编辑器">使用这些比对工具之前，需要对这些数据进行拆分提取，使得用于比对序列只包含原始的序列片段，同时要保证比对后还包含这些细胞和分子的信息。</p><p data-tool="mdnice编辑器">这就需要使用单独的工具来执行比对前的处理，这种额外的开销可能会造成计算上的负担。此外，存储中间文件通常需要大量磁盘空间，而处理这些中间文件所需的额外输入和输出操作又进一步增加了运行时间开销。</p><p data-tool="mdnice编辑器">为此，人们开发了几种专门用于比对 <code>scRNA-seq</code> 数据的工具，它们能自动和/或在内部处理这些额外的处理要求。</p><p data-tool="mdnice编辑器">包括 <span>Cell Ranger</span><sup>[2]</sup>、<span>zUMIs</span><sup>[3]</sup>、<span>alevin</span><sup>[4]</sup>、<span>RainDrop</span><sup>[5]</sup>、<span>kallisto|bustools</span><sup>[6]</sup>、<span>STARsolo</span><sup>[7]</sup> 和 <span>alevin-fry</span><sup>[8]</sup> 等</p><p data-tool="mdnice编辑器">提供了专门的处理方式用于比对 <code>scRNA-seq</code> 数据，可以解析 <code>reads</code> 中的 <code>CBs</code> 和 <code>UMIs</code>，同时也可以对 <code>UMI</code> 进行解析和去重。</p><p data-tool="mdnice编辑器">这些工具在内部使用了各种不同的方法，有些工具生成传统的中间文件（如 <code>BAM</code> 文件）并随后对其进行处理，有些工具则完全在内存中工作，或使用简化的中间表示法以减轻输入/输出负担。</p><p data-tool="mdnice编辑器">虽然不同比对方法的具体算法、数据结构以及时间和空间权衡可能会有很大不同，但我们可以对现有方法进行粗略分类：</p><ul data-tool="mdnice编辑器"><li><section>比对的类型</section></li><li><section>参考序列的类型</section></li></ul><h3 data-tool="mdnice编辑器"><span></span><span>不同比对类型</span><span></span></h3><p data-tool="mdnice编辑器">常用的比对算法主要分为三类：剪切比对、连续比对和轻量级映射。</p><p data-tool="mdnice编辑器">比对方法使用各种启发式方法确定 <code>reads</code> 可能来源的潜在位置，然后在每个假定位置计算 <code>reads</code> 与参考序列之间的最佳核苷酸级别比对，通常使用动态规划算法。</p><p data-tool="mdnice编辑器">动态规划算法有多种类型，适用于不同类型的比对，例如全局比对、局部比对和半全局比对。</p><p data-tool="mdnice编辑器">全局比对适用于整个查询序列与参考序列对齐的情况，而局部比对则适用于查询序列的一个子序列与参考序列的一个子序列对齐的情况。半全局比对则是介于两者之间的情况，通常用于短读长比对。</p><p data-tool="mdnice编辑器">此外，剪切比对（<code>softclip</code>）允许忽略或减轻在 <code>reads</code> 序列开头或结尾处出现的不匹配、插入或删除的惩罚。</p><p data-tool="mdnice编辑器">为了提高比对过程的效率和实用性，设计了多种复杂的修改和启发式方法。例如，<span>Banded alignment</span><sup>[9]</sup> 通过限制动态规划表格中的计算区域，将计算范围缩小到对角线附近的一个带状区域，从而降低了计算量和内存使用。</p><p data-tool="mdnice编辑器">其他如 <span>X-drop</span><sup>[10]</sup> 和 <span>Z-drop</span><sup>[11]</sup> 启发式方法则在早期将不太可能成功的比对进行剪枝。</p><p data-tool="mdnice编辑器"><span>wavefront</span><sup>[12]</sup> 比对等最新算法能够在较短时间和较小空间内确定最佳比对。</p><p data-tool="mdnice编辑器">比对得分和实际比对的回溯通常以 <code>CIGAR</code> 字符串形式编码在 <code>SAM</code> 或 <code>BAM</code> 文件中。</p><p data-tool="mdnice编辑器"><code>CIGAR</code> 字符串是一种压缩的字母数字表示方式，描述了比对的具体情况，例如 <code>3M2D4M</code> 表示三个匹配或不匹配，随后有两个碱基中的删失，再就是四个匹配或不匹配。</p><p data-tool="mdnice编辑器">通过计算这些比对得分，能够过滤出与参考序列对齐良好的读取，避免低复杂度或假匹配。然而，这些方法计算量大，需要大量的计算资源和存储空间。</p><p data-tool="mdnice编辑器">两类方法的对比如图所示<img data-imgfileid="100013440" data-ratio="0.5625" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWJbeKbsX9iaBt7nOoNUABmJFc5AJ5LTYCqAHMnyicmBexRwgfa9asib7YEr1r86iavEMZva7X2Dj3Q9dw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1920" src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWJbeKbsX9iaBt7nOoNUABmJFc5AJ5LTYCqAHMnyicmBexRwgfa9asib7YEr1r86iavEMZva7X2Dj3Q9dw/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">比对方法可进一步分为剪接比对和连续比对。剪接比对能够将 <code>reads</code> 序列比对到参考序列的多个不同片段上，允许在参考序列的相应部分之间存在较大间隔。通常应用于将 <code>RNA-seq</code> 数据比对到基因组。</p><p data-tool="mdnice编辑器">连续比对则寻求将 <code>reads</code> 与参考序列的连续子串进行比对，具有较好的比对率，通常不允许存在大间隔。</p><p data-tool="mdnice编辑器">轻量级映射方法如<span>kallisto</span><sup>[13]</sup>、<span>RapMap</span><sup>[14]</sup> 和 <code>Alevin-fry</code>，通过避免核苷酸级别的比对，提高了速度和映射吞吐量。</p><p data-tool="mdnice编辑器">这些方法基于一组匹配的 <code>k-mer</code> 或其他类型的精确匹配以及它们在 <code>reads</code> 和参考序列中的相对位置和方向来确定比对位置。这大大提高了速度和映射效率，但也使得难以进行基于得分的评估，以判断读取与参考序列之间的匹配质量。</p><h3 data-tool="mdnice编辑器"><span></span><span>不同参考序列</span><span></span></h3><p data-tool="mdnice编辑器">处理比对算法的选择之外，也可以对参考序列做出不同的选择。比如</p><ul data-tool="mdnice编辑器"><li><section>完整的参考基因组</section></li><li><section>注释好的转录组</section></li><li><section>扩展的转录组</section></li></ul><p data-tool="mdnice编辑器">但并不是所有的比对算法都支持不同参考序列的选择。例如，基于轻量级映射的算法目前还不能根据参考基因组对 <code>reads</code> 进行剪切比对。</p><h4 data-tool="mdnice编辑器"><span></span><span>比对到基因组</span><span></span></h4><p data-tool="mdnice编辑器">这种方法将目标生物体的整个基因组作为参考，通常考虑转录本的注释信息。如 <code>zUMIs</code>、<code>Cell Ranger</code> 和 <code>STARsolo</code> 采用这种方法。</p><p data-tool="mdnice编辑器">由于很多 <code>reads</code> 都是来自剪接后的转录本，因此这种方法需要使用能够跨越一个或多个剪接点进行比对的算法。</p><p data-tool="mdnice编辑器">主要优点包括：</p><ul data-tool="mdnice编辑器"><li><section>能够处理来自基因组任何位置的序列，包括未注释的转录本。</section></li><li><section>构建全基因组索引后，比对内含子和已知剪接转录本的 <code>reads</code> 效率是一样的。</section></li><li><section>能够处理注释转录本、外显子和内含子之外的序列，提高基因检测和定量的灵敏度。</section></li></ul><p data-tool="mdnice编辑器">缺点是：</p><ul data-tool="mdnice编辑器"><li><section>比对工具需要大量内存</section></li><li><section>剪接比对的复杂性高，计算成本高。</section></li><li><section>需要目标生物体有完好的基因组，这对非模式生物来说可能是个问题。</section></li></ul><h4 data-tool="mdnice编辑器"><span></span><span>比对到转录组</span><span></span></h4><p data-tool="mdnice编辑器">为了减少剪接比对的计算开销，广泛采用的一种替代方法是仅使用注释好的转录本序列作为参考。</p><p data-tool="mdnice编辑器">由于大多数单细胞实验来自有良好注释转录组的模式生物（如小鼠或人类），这种基于转录组的定量方法可能提供与基于基因组方法类似的覆盖度。</p><p data-tool="mdnice编辑器">优点在于：</p><ul data-tool="mdnice编辑器"><li><section>与基因组相比，转录组序列大小较小，减少了运行比对管道所需的计算资源。</section></li><li><section>无需解决复杂的剪接比对问题，而只需搜索连续比对</section></li></ul><p data-tool="mdnice编辑器">但也有一些局限性：</p><ul data-tool="mdnice编辑器"><li><section>不能捕捉来自转录组外的序列，这在处理 <code>snRNA-seq</code> 数据时尤其不足。</section></li><li><section>即使在 <code>scRNA-seq</code> 实验中，来自转录组外的 <code>reads</code> 也可能占据很大比例，不应该丢弃。</section></li></ul><h4 data-tool="mdnice编辑器"><span></span><span>比对到扩展的转录组</span><span></span></h4><p data-tool="mdnice编辑器">为了解决 <code>reads</code> 可能来自剪接转录本之外的问题，可以将剪接转录序列与其他预期产生 <code>reads</code> 的参考序列（如全长未剪接转录本或剪除的内含子序列）合并，对参考序列进行扩展。</p><p data-tool="mdnice编辑器">扩展的转录组参考序列比全基因组所需的参考索引通常更小，同时保留了仅搜索连续读取比对的能力。</p><p data-tool="mdnice编辑器">能够更快且占用更少内存，同时仍能处理来自剪接转录组之外的许多读取。</p><p data-tool="mdnice编辑器">通过比对到扩展的参考序列，可以收集更多的位置，并在使用轻量级比对方法时，大大减少假比对。</p><p data-tool="mdnice编辑器"><code>Alevin-fry</code> 算法文章中提出，这种方法即使在处理标准 <code>scRNA-seq</code> 数据时也非常有价值，并建议构建增强的 <code>splici</code>（转录本+内含子）参考序列进行比对和定量。</p><p data-tool="mdnice编辑器"><code>splici</code> 参考序列使用剪接转录组序列以及对应于注释基因内含子合并区间的序列构建。每个参考序列都标注其剪接状态，并在比对过程中使用考虑剪接状态的方法进行 <code>UMI</code> 解析。</p><p data-tool="mdnice编辑器">这种方法的主要优点包括：</p><ul data-tool="mdnice编辑器"><li><section>允许使用轻量级比对方法，同时大大减少假比对。</section></li><li><section>能检测到来自剪接和未剪接来源的 <code>reads</code>，提高后续分析的灵敏度。</section></li><li><section>统一了单细胞、单核和 <code>RNA</code> 速率的预处理流程。</section></li></ul><h2 data-tool="mdnice编辑器"><span></span><span>细胞条形码矫正</span><span></span></h2><p data-tool="mdnice编辑器">基于液滴的单细胞分离系统，如 <code>10x Genomics</code> 系统，已成为研究细胞异质性原因及后果的重要工具。</p><p data-tool="mdnice编辑器">在这种分离系统中，每个捕获的细胞的 <code>RNA</code> 物质在一个水基液滴内提取，并与带条形码的磁珠一起封装。</p><p data-tool="mdnice编辑器">这些磁珠通过独特的寡核苷酸（称为 <code>cell barcode</code>，<code>CB</code>）标记每个细胞的 <code>RNA</code>，这些条形码随后与从 <code>RNA</code> 逆转录的 <code>cDNA</code> 片段一起测序。</p><p data-tool="mdnice编辑器">磁珠包含高多样性的 <code>DNA</code> 条形码，使得细胞的分子内容可以进行平行条形码标记，并在后续数据处理中将测序 <code>reads</code> 分配到各个细胞中。</p><p data-tool="mdnice编辑器">并不是所有与参考序列比对的测序片段都会被用于定量和条形码校正，一个常用的过滤标准是比对方向。</p><p data-tool="mdnice编辑器">具体来说，某些化学反应策略规定，比对的读取应该仅来自于特定方向的转录本。例如，在 <code>10x Genomics 3’ Chromium</code> 中，期望的是 <code>reads</code> 与转录本的正义链比对，但其实也存在反义链上的 <code>reads</code>。</p><p data-tool="mdnice编辑器">因此，如果测序方法遵循这样的链特异性协议，用户可以选择忽略或过滤反向互补方向比对的 <code>reads</code>。</p><h3 data-tool="mdnice编辑器"><span></span><span>条形码的错误类型</span><span></span></h3><p data-tool="mdnice编辑器">单细胞分析的标签、测序和去重方法通常表现良好。但是在基于液滴的文库中观察到的细胞条形码数量可能显著不同于最初封装的细胞数量。</p><p data-tool="mdnice编辑器">主要有以下几个错误来源：</p><ul data-tool="mdnice编辑器"><li><section>双重/多重（<code>Doublet</code>/<code>Multiplet</code>）：一个条形码可能与两个或更多细胞相关联，导致细胞计数不足。</section></li><li><section>空液滴：一个液滴中可能没有封装细胞，但环境中的 <code>RNA</code> 被条形码标记并测序，导致细胞计数过多。</section></li><li><section>测序错误：在 <code>PCR</code> 扩增或测序过程中可能出现碱基错误，导致细胞计数的过多或不足。</section></li></ul><p data-tool="mdnice编辑器">许多计算工具使用多种诊断指标来过滤非真实或低质量的数据。例如，许多方法用于去除环境 <code>RNA</code> 污染、检测 <code>Doublet</code> 和基于核苷酸序列相似性校正条形码错误等。</p><h3 data-tool="mdnice编辑器"><span></span><span>细胞条形码的校正策略</span><span></span></h3><ol data-tool="mdnice编辑器"><li><section>基于已知条形码列表的校正</section></li></ol><p data-tool="mdnice编辑器">某些化学反应（如 <code>10x Chromium</code>）从已知的潜在条形码序列库中提取 <code>CBs</code>。因此，任何样品中观察到的条形码集应是该已知列表的子集。</p><p data-tool="mdnice编辑器">常用策略是假定与已知列表中的某个序列完全匹配的每个条形码都是正确的，并校正所有其他条形码以匹配已知列表中的条形码。</p><p data-tool="mdnice编辑器">但也存在一个问题，当一个错误条形码在已知列表中有多个可能的校正结果时，会导致校正结果不准。</p><ol start="2" data-tool="mdnice编辑器"><li><section>基于拐点的方法：</section></li></ol><p data-tool="mdnice编辑器">如果潜在条形码集未知，或希望直接从观测的数据中进行校正，可以采用这种方法。这种方法基于观察到样品中真实或高质量条形码通常与最多的 <code>reads</code> 相关联。</p><p data-tool="mdnice编辑器">通过构建条形码的累积频率图（通常会出现一个拐点），可以识别频繁出现的条形码并将其视为有效条形码列表，其余条形码根据这个列表进行校正。</p><ol start="3" data-tool="mdnice编辑器"><li><section>基于预期细胞计数的过滤和校正：</section></li></ol><p data-tool="mdnice编辑器">这种方法适用于条形码频率分布没有明显拐点或存在技术伪影的情况。</p><p data-tool="mdnice编辑器">用户提供预期的细胞数量估计，然后根据频率排序条形码，获取接近预期细胞数量的频率，并将其附近的条形码视为有效条形码。</p><ol start="4" data-tool="mdnice编辑器"><li><section>强制细胞数量的过滤：</section></li></ol><p data-tool="mdnice编辑器">用户直接提供排序频率图中条形码被视为有效的索引。频率大于或等于所选索引处频率的所有条形码被视为有效，并根据这个列表进行校正。</p><h2 data-tool="mdnice编辑器"><span></span><span>UMI 解析</span><span></span></h2><p data-tool="mdnice编辑器">在细胞条形码校正之后，<code>reads</code> 要么被丢弃，要么被分配到校正后的 <code>CB</code>。接下来，我们希望在每个校正后的 <code>CB</code> 中量化每个基因的丰度。</p><p data-tool="mdnice编辑器">由于扩增偏差，必须根据 <code>UMI</code> 进行去重，以评估样本真实的分子数量。去重的目的是识别在 <code>PCR</code> 扩增前每个细胞中每个原始分子的序列片段数。</p><p data-tool="mdnice编辑器">这个过程的结果是为每个细胞中的每个基因分配一个分子计数，随后在下游分析中作为该基因的原始表达估算值。</p><h3 data-tool="mdnice编辑器"><span></span><span>UMI 解析的必要性</span><span></span></h3><p data-tool="mdnice编辑器">在理想情况下，正确的（未改变的）<code>UMI</code> 标记的 <code>reads</code>，可以唯一比对到一个共同的参考基因，并且<code>UMI</code> 与原始分子之间存在双射关系。</p><p data-tool="mdnice编辑器"><code>UMI</code> 去重过程就是：相同 <code>UMI</code> 的 <code>reads</code> 是来自同一个分子的 <code>PCR</code> 重复。每个基因捕获和测序的分子数量就是比对到该基因上的不同 <code>UMI</code> 数量。</p><p data-tool="mdnice编辑器">但实际遇到的问题使得上述简单规则不足以识别 <code>UMI</code> 的基因来源，需要开发更复杂的模型。</p><p data-tool="mdnice编辑器">主要有两个挑战：</p><ul data-tool="mdnice编辑器"><li><section><code>UMI</code> 错误：在 <code>PCR</code> 或测序过程中引入的 <code>UMI</code> 序列出现错误（如碱基错配等），可能会使估计的分子数量增多</section></li><li><section>多重比对：当一个 <code>reads</code> 或 <code>UMI</code> 比对到参考序列的多个位置或多个基因时，导致基因的分子估算不准</section></li></ul><h3 data-tool="mdnice编辑器"><span></span><span>基于图的 UMI 解析</span><span></span></h3><p data-tool="mdnice编辑器">目前开发了许多方法来解决 <code>UMI</code> 解析的问题，我们将重点介绍一种基于 <code>UMI</code> 图的框架。</p><p data-tool="mdnice编辑器">每个连通分量代表一个子问题，其中某些 <code>UMI</code> 的子集被折叠（即，可以认为是相同来源的）。</p><p data-tool="mdnice编辑器">许多流行的 <code>UMI</code> 解析方法可以通过简单地修改图的精炼方式和在图上执行的折叠或解析过程来解释。</p><p data-tool="mdnice编辑器">在单细胞数据的背景下，<code>UMI</code> 图是一个有向图，其节点集和边集定义了 <code>UMI</code> 之间的关系。<code>reads</code> 的等价关系基于它们的 <code>UMI</code> 和比对信息。</p><p data-tool="mdnice编辑器">我们所说的 <code>reads</code> 等价是，当且仅当它们具有相同的 <code>UMI</code> 标签并比对到相同的参考位置。</p><p data-tool="mdnice编辑器">定义 <code>UMI</code> 图后，可以应用许多不同的解析方法。一种解析方法可能是简单地找到连通分量、聚类图、贪婪算法等。</p><p data-tool="mdnice编辑器"><code>UMI</code> 解析的最后一步是使用解析后的 <code>UMI</code> 图量化每个基因的丰度。</p><p data-tool="mdnice编辑器">对于丢弃多基因等价类的方法，生成当前处理细胞中基因的分子计数向量，方法是计算每个基因标记的等价类数量。</p><p data-tool="mdnice编辑器">在这种模型中，折叠的等价类到基因的分配是潜变量，去重的基因分子计数是主要参数。通常，将基因唯一等价类的证据用于概率性地分配多基因等价类。</p><p data-tool="mdnice编辑器">上述 <code>UMI</code> 解析和定量过程通常对每个细胞（校正后的 <code>CB</code>）单独执行，以创建所有细胞中所有基因的完整计数矩阵。</p><p data-tool="mdnice编辑器">然而，高通量单细胞样本中每个细胞信息相对稀少，限制了 <code>UMI</code> 解析，反过来又限制了基于模型的解决方案的有效性。</p><h2 data-tool="mdnice编辑器"><span></span><span>计数矩阵质量控制</span><span></span></h2><p data-tool="mdnice编辑器">在生成计数矩阵后，进行质量控制（<code>QC</code>）评估是非常重要的。质量控制通常包括多个不同的评估，以帮助评估测序数据的整体质量。</p><p data-tool="mdnice编辑器">这些评估包括基本的全局指标，如整体比对率、每个细胞观察到的不同 <code>UMI</code> 的分布、<code>UMI</code> 去重率的分布、每个细胞检测到的基因数量的分布等。</p><p data-tool="mdnice编辑器">此外，还存在一些工具，如 <span>Loupe browser</span><sup>[15]</sup>, <span>alevinQC</span><sup>[16]</sup> 或 <span>kb_python report</span><sup>[17]</sup>、可以帮助组织和可视化这些基本指标。</p><h3 data-tool="mdnice编辑器"><span></span><span>空胞检测</span><span></span></h3><p data-tool="mdnice编辑器">质量控制的第一个步骤是确定哪些细胞条形码对应于高可信度测序的细胞。</p><p data-tool="mdnice编辑器">在基于液滴方法中，某些条形码与环境 <code>RNA</code> 而非捕获细胞的 <code>RNA</code> 相关联，这是因为液滴未能捕获到细胞。</p><p data-tool="mdnice编辑器">这些空液滴仍然会产生测序的 <code>reads</code>，但这些 <code>reads</code> 的特征与正确捕获的细胞条形码相关的读取有明显不同。</p><p data-tool="mdnice编辑器">有许多方法可以评估条形码是否可能对应于空液滴。一种简单的方法是检查条形码的累积频率图，其中条形码按与之关联的不同 <code>UMI</code> 的数量降序排序。该图通常包含一个拐点，可以作为区分正确捕获细胞和空液滴的可能点。</p><p data-tool="mdnice编辑器">虽然拐点的方法直观且通常能估计出合理的阈值，但也有一些缺点。例如，并非所有累积直方图都显示出明显的拐点，并且设计能够稳健地自动检测这些拐点的算法是非常困难的。</p><p data-tool="mdnice编辑器">最后，仅凭与细胞条形码关联的总 <code>UMI</code> 计数可能并不是判断条形码是否关联空或受损细胞的最佳信号。</p><p data-tool="mdnice编辑器">因此，开发了许多专门用于检测空或受损液滴或一般认为低质量细胞的工具，如 <span>DIEM</span><sup>[18]</sup>、<span>dropkick</span><sup>[19]</sup> 和 <span>miQC</span><sup>[20]</sup> 等。</p><p data-tool="mdnice编辑器">这些工具结合了多种细胞质量的度量，包括不同 <code>UMI</code> 的频率、检测到的基因数量和线粒体 <code>RNA</code> 的比例，通常通过应用统计模型将高质量细胞与假定的空液滴或受损细胞分类。</p><p data-tool="mdnice编辑器">这意味着通常可以对细胞进行评分，并根据估计的后验概率选择最终的过滤结果，确定细胞不是空的或受损的。</p><p data-tool="mdnice编辑器">虽然这些模型通常适用于 <code>scRNA-seq</code> 数据，但在 <code>snRNA-seq</code> 数据中可能需要应用多个额外的过滤或启发式方法，以获得稳健的过滤结果。</p><h3 data-tool="mdnice编辑器"><span></span><span>双胞检测</span><span></span></h3><p data-tool="mdnice编辑器">除了确定哪些细胞条形码对应于空液滴或受损细胞，还需要识别那些对应于双重体或多重体的细胞条形码。</p><p data-tool="mdnice编辑器">当一个液滴捕获两个（双胞）或多个（多胞）细胞时，这些细胞条形码在表示的 <code>reads</code> 数量和 <code>UMI</code> 数量以及基因表达谱方面会产生偏斜的分布。</p><p data-tool="mdnice编辑器">许多工具也已被开发出来，用于预测细胞条形码的双胞状态。如 <span>Scds</span><sup>[21]</sup>、<span>Solo</span><sup>[22]</sup> 和 <span>DoubletDecon</span><sup>[23]</sup></p><p data-tool="mdnice编辑器">一旦检测到双胞和多胞，可以在后续分析中移除或进行相应调整。</p><h2 data-tool="mdnice编辑器"><span></span><span>计数矩阵</span><span></span></h2><p data-tool="mdnice编辑器">当完成初步的原始数据处理和质量控制后，继续进行后续分析时要注意，细胞与基因的计数矩阵只能近似反映原始样本中的测序分子。</p><p data-tool="mdnice编辑器">在原始数据处理流程的多个阶段，采用了一些启发式方法和简化措施来生成这个计数矩阵。</p><p data-tool="mdnice编辑器">例如，数列比对并不完美，细胞条形码的校正也存在不足。特别是 <code>UMI</code> 的准确解析非常具有挑战性，与多重比对相关的 <code>UMI</code> 问题经常被忽略，同时多个引物位点，特别是在未剪接分子中，可能违反常假设的一分子对应一 <code>UMI</code> 的关系。</p><p data-tool="mdnice编辑器">鉴于这些挑战和为应对这些挑战而采用的简化措施，如何最好地表示预处理数据以供后续工具使用仍然是一个活跃的研究领域。</p><p data-tool="mdnice编辑器">例如，一些量化工具实现了可选的 <code>EM</code> 算法，该算法以概率方式分配与多个基因映射的读取相关联的 <code>UMI</code>。然而，这可能导致非整数计数矩阵，这可能不太符合某些下游工具的预期。</p><p data-tool="mdnice编辑器">另一种选择是将 <code>UMI</code> 解析到基因组而不是单个基因，保留预处理输出中的多重比对信息</p><p data-tool="mdnice编辑器">值得注意的是，类似的表示方式在转录本水平上已经被使用了十多年，用于 <code>bulk RNA-seq</code> 转录本定量工具的内部表示，并且这种转录本水平的表示方式也被提议用于全长 <code>scRNA-seq</code> 数据的聚类和降维分析以及 <code>scRNA-seq</code> 数据的差异表达分析。</p><p data-tool="mdnice编辑器">在这种情况下，生成的计数矩阵的维度将不再是 <span data-formula="C \times G"><span data-formula="C \times G"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -705 2768.4 727" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="43" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mo" transform="translate(982.2, 0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="mi" transform="translate(1982.4, 0)"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g></g></g><g></g></svg></span></span>（其中 <span data-formula="𝐺"><span data-formula="𝐺"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -705 786 727" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="1D43A" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g></g></g></g><g></g></svg></span></span> 是量化注释中的基因数量），而是 <span data-formula="C \times E"><span data-formula="C \times E"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -705 2746.4 727" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="43" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mo" transform="translate(982.2, 0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="mi" transform="translate(1982.4, 0)"><path data-c="45" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g></g></g><g></g></svg></span></span>（其中 <span data-formula="E"><span data-formula="E"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -680 764 680" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="45" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g></g></g><g></g></svg></span></span> 是给定样本中所有细胞的不同基因分组的数量，通常称为等价类标签）。</p><p data-tool="mdnice编辑器">通过将这些信息传播到输出计数矩阵，可以避免应用启发式或概率 <code>UMI</code> 解析方法，从而避免在下游分析中使用的计数数据中的数据丢失或偏差。</p><p data-tool="mdnice编辑器">当然，为了使用这些信息，下游分析方法必须期望以这种格式的信息。此外，这些下游方法通常必须有一种方法最终将这些计数解析到基因水平，因为缺乏对基因分组丰度的直观生物学可解释性。</p><p data-tool="mdnice编辑器">尽管如此，这种表示方式在向下游分析工具传递更完整和准确的信息方面提供的好处是显著的，并且正在开发利用这种表示方式的工具（如 <span>DifferentialRegulation</span><sup>[24]</sup>）。</p><h2 data-tool="mdnice编辑器"><span></span><span>讨论</span><span></span></h2><p data-tool="mdnice编辑器">具体工具的选择在很大程度上取决于手头的任务和可用计算资源的限制。</p><p data-tool="mdnice编辑器">如果要进行标准的单细胞分析，基于轻量级映射的方法是一个不错的选择，因为它们比现有的基于比对的工具更快（通常快得多）、更节省内存。</p><p data-tool="mdnice编辑器">如果要进行 <code>snRNA-seq</code> 分析，<code>levin-fry</code> 尤其是一个有吸引力的选择，因为它可以节省内存，而且即使转录组参考序列扩大到包括未剪接的参考序列，它的索引仍然相对较小。</p><p data-tool="mdnice编辑器">另一方面，如果需要比对到转录组之外的序列，或者 <code>reads</code> 的基因组比对位置对于相关下游工具或分析（例如，使用 <span>sierra</span><sup>[25]</sup> 等工具进行差异转录本分析）是必要的，则推荐使用基于比对的方法。</p><p data-tool="mdnice编辑器">根据 <span>Brüning</span><sup>[26]</sup> 等人的研究，在基于比对的流程中，<code>STARsolo</code> 比 <code>Cell Ranger</code> 更受青睐，因为前者比后者快得多，所需的内存也更少，同时还能产生几乎相同的结果。</p><section data-tool="mdnice编辑器"><span>参考资料</span></section><section data-tool="mdnice编辑器"><span><span>[1] </span><p>Single-cell best practices: <em>https://www.sc-best-practices.org/preamble.html</em></p></span><span><span>[2] </span><p>Cell Ranger: <em>https://doi.org/10.1038/ncomms14049</em></p></span><span><span>[3] </span><p>zUMIs: <em>https://doi.org/10.1093/gigascience/giy059</em></p></span><span><span>[4] </span><p>alevin: <em>https://genomebiology.biomedcentral.com/articles/10.1186/s13059-019-1670-y</em></p></span><span><span>[5] </span><p>RainDrop: <em>https://gitlab.rlp.net/stnieble/raindrop</em></p></span><span><span>[6] </span><p>kallisto|bustools: <em>https://doi.org/10.1038/s41587-021-00870-2</em></p></span><span><span>[7] </span><p>STARsolo: <em>https://www.biorxiv.org/content/10.1101/2021.05.05.442755v1</em></p></span><span><span>[8] </span><p>alevin-fry: <em>https://www.nature.com/articles/s41592-022-01408-3</em></p></span><span><span>[9] </span><p>Banded alignment: <em>https://doi.org/10.1093/bioinformatics/8.5.481</em></p></span><span><span>[10] </span><p>X-drop: <em>https://doi.org/10.1089/10665270050081478</em></p></span><span><span>[11] </span><p>Z-drop: <em>https://doi.org/10.1093/bioinformatics/bty191</em></p></span><span><span>[12] </span><p>wavefront: <em>https://doi.org/10.1101/2022.04.14.488380</em></p></span><span><span>[13] </span><p>kallisto: <em>http://pachterlab.github.io/kallisto/</em></p></span><span><span>[14] </span><p>RapMap: <em>https://github.com/COMBINE-lab/RapMap</em></p></span><span><span>[15] </span><p>Loupe browser: <em>https://support.10xgenomics.com/single-cell-gene-expression/software/visualization/latest/what-is-loupe-cell-browser</em></p></span><span><span>[16] </span><p>alevinQC: <em>https://github.com/csoneson/alevinQC</em></p></span><span><span>[17] </span><p>kb_python report: <em>https://github.com/pachterlab/kb_python</em></p></span><span><span>[18] </span><p>DIEM: <em>https://github.com/marcalva/diem</em></p></span><span><span>[19] </span><p>dropkick: <em>https://github.com/codyheiser/dropkick-manuscript</em></p></span><span><span>[20] </span><p>miQC: <em>https://bioconductor.org/packages/miQC</em></p></span><span><span>[21] </span><p>Scds: <em>https://academic.oup.com/bioinformatics/article/36/4/1150/5566507?login=false#394141724</em></p></span><span><span>[22] </span><p>Solo: <em>https://github.com/calico/solo</em></p></span><span><span>[23] </span><p>DoubletDecon: <em>https://github.com/EDePasquale/DoubletDecon</em></p></span><span><span>[24] </span><p>DifferentialRegulation: <em>https://github.com/SimoneTiberi/DifferentialRegulation</em></p></span><span><span>[25] </span><p>sierra: <em>https://doi.org/10.1186%2Fs13059-020-02071-7</em></p></span><span><span>[26] </span><p>Comparative analysis of common alignment tools for single-cell RNA sequencing: <em>https://doi.org/10.1093%2Fgigascience%2Fgiac001</em></p></span></section></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/x7al6cEMRMD_mHUaJDGrew",target="_blank" rel="noopener noreferrer">原文链接</a>
