---
title: "E-MTAB-1980数据下载及整理"
date: 2024-06-07T00:46:30Z
draft: ["false"]
tags: [
  "fetched",
  "学R时习之"
]
categories: ["Acdemic"]
---
E-MTAB-1980数据下载及整理 by 学R时习之
------
<div><p><span>肾透明细胞癌(ccRCC)作为最常见的肾细胞癌(RCC)亚型，是生信分析的热点。尤其是带预后的数据集更是验证时的重点。奈何好多时候卡在数据预处理阶段。下面针对常用的RCC数据集，总结下预处理过程，以备不时之需……</span><ne-clipboard source="https%3A%2F%2Fwww.yuque.com%2Fgaodashitou%2Ffomdu3%2Fpwa18dm6hnwe8gtz"></ne-clipboard></p><p><span>首先学习的是</span><code><span>E-MTAB-1980</span></code><span>数据集。该数据集大有来头，发表在2013的</span><code><span>Nature Genetics</span></code><span>，包含101名ccRCC的表达谱数据及预后信息。</span></p><p><img data-imgfileid="100003358" data-ratio="0.5" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2827PBHx0SSBNvYEL8rB44ib2a8zl71M33OjTRVLGBz3MsvvLQVcLakg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="734" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2827PBHx0SSBNvYEL8rB44ib2a8zl71M33OjTRVLGBz3MsvvLQVcLakg/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><span>官网上写的是该数据属于芯片数据，因此个人感觉可直接用下载处理好的数据分析即可。</span></p><p><img data-imgfileid="100003357" data-ratio="0.4537037037037037" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2cNibqIEE1oYqicuohbA9icDiaoVxqRJRSxTR8ZMIiarz4h4gMZ8fg8t621g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="688" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2cNibqIEE1oYqicuohbA9icDiaoVxqRJRSxTR8ZMIiarz4h4gMZ8fg8t621g/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100003359" data-ratio="0.7268518518518519" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2q0wo2qbxTSlibZKLczibxMEpHwdUKpLKgG3HO8GP4Br0b2wYvL2CeqQg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="835" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2q0wo2qbxTSlibZKLczibxMEpHwdUKpLKgG3HO8GP4Br0b2wYvL2CeqQg/640?wx_fmt=png&amp;from=appmsg"></p><h2><span>1 数据下载</span></h2><h1><span></span></h1><h1><span>首先是<strong><span>表达矩阵</span></strong>下载，咱们可以直接从</span><code><span>ArrayExpress</span></code><span>官网下载。</span></h1><p><img data-imgfileid="100003360" data-ratio="0.44814814814814813" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2qgtib7kDsbh6AulDul6tc8Pua4QUhsR57Ip2yFEv3mWPnA5xZo9XNcQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="1310" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2qgtib7kDsbh6AulDul6tc8Pua4QUhsR57Ip2yFEv3mWPnA5xZo9XNcQ/640?wx_fmt=png&amp;from=appmsg"></p><p><span>也可以用服务器下载，可能会快不少：</span><code><span>axel [目标地址]</span></code></p><p><span><strong><span>临床信息</span></strong>需要从原文附件</span><code><span>Supplementary Table1</span></code><span>中下载。</span><img data-imgfileid="100003356" data-ratio="0.7141057934508817" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2qbPydYlZPsAVs5uMvUPKfHT4dYDRvtlF7WjMmmqibdLESGGg8SsBrZA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="794" width="397" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2qbPydYlZPsAVs5uMvUPKfHT4dYDRvtlF7WjMmmqibdLESGGg8SsBrZA/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><span><strong><span>探针注释文件</span></strong>可以从UCSC上下载(具体参考【R&gt;&gt;探针ID转换】GB_ACC2SYMBOL(简书))。</span></p><p><img data-imgfileid="100003362" data-ratio="0.4325980392156863" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2AqcfRuUk5OseSsEm0UvcMUbXvRsYp5LVQQZMKurTqnZAYjpO05eBfQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="816" width="408" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2AqcfRuUk5OseSsEm0UvcMUbXvRsYp5LVQQZMKurTqnZAYjpO05eBfQ/640?wx_fmt=png&amp;from=appmsg"></p><hr><h1><span>2 数据整理</span></h1><p><span>通过上面下载表达矩阵、临床信息、探针注释文件，我们获得下面这些文件</span></p><p><img data-imgfileid="100003361" data-ratio="0.3074074074074074" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2dLdufacDUTxKqflUJSFmqWsHrSKKJeYL5q6WDeSmySX0ibQW1g2QFRA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="588" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2dLdufacDUTxKqflUJSFmqWsHrSKKJeYL5q6WDeSmySX0ibQW1g2QFRA/640?wx_fmt=png&amp;from=appmsg"></p><p><span>接下来进行数据预处理：</span></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><pre data-tool="mdnice编辑器"><span></span><code><span># Study typetranscription profiling by array</span><br><span># axel命令多线程下载，超快的。</span><br><span># ccRCC_eset_log_quantile_normalized.txt大小50.6MB</span><br><span># refGene.txt.gz大小8.3MB</span><br><span># GB_ACC2SYMBOL文件refGene.txt.gz来自https://hgdownload.soe.ucsc.edu/goldenPath/hg38/database/</span><br><span># esetressionSet对象的简写，eset</span><br><span># emtab1980_eset: E-MTAB-1980数据集的表达矩阵</span><br><span># emtab1980_pdata: E-MTAB-1980数据集的临床信息</span><br><br>rm(list = ls())<br>gc()<br>librarian::shelf(tidyverse)<br><span>#dir.create("./source")</span><br><span>#dir.create("results")</span><br><br><span># 表达矩阵</span><br>df &lt;- data.table::fread(<span>"./source/ccRCC_exp_log_quantile_normalized.txt"</span>,data.table = F) %&gt;% <br>  dplyr::select(-c(1:2))<br>names(df)[1] &lt;- <span>"acc"</span><br>df[1:4,1:4]<br><br><span># 注释文件</span><br>ids &lt;- data.table::fread(<span>"./source/refGene.txt.gz"</span>,data.table = F) %&gt;% <br>  dplyr::select(2,13)<br>head(ids)<br>names(ids) &lt;- c(<span>"acc"</span>,<span>"symbol"</span>)<br>ids &lt;- unique(ids)<br><br><span># 临床信息</span><br>cli &lt;- readxl::read_xlsx(<span>"./source/41588_2013_BFng2699_MOESM35_ESM.xlsx"</span>,skip = 1)<br>cli &lt;- cli %&gt;% <br>  dplyr::select(1:5, 8,9)<br>names(cli) &lt;- c(<span>"id"</span>, <span>"sex"</span>, <span>"age"</span>, <span>"stage"</span>, <span>"grade"</span>, <span>"os"</span>,<span>"os.time"</span>)<br>x &lt;- cli<span>$stage</span><br>cli1 &lt;- cli %&gt;% <br>  mutate(Tstage = gsub(<span>"(pT\\d[a-z]*)(N\\d)(M\\d)"</span>,<span>"\\1"</span>,stage),<br>         Nstage = gsub(<span>"(pT\\d[a-z]*)(N\\d)(M\\d)"</span>,<span>"\\2"</span>,stage),<br>         Mstage = gsub(<span>"(pT\\d[a-z]*)(N\\d)(M\\d)"</span>,<span>"\\3"</span>,stage))<br><br><span># 发现有1个漏网之鱼，"pT1ｂN0M0",应该是当时输入时格式的问题，稍微调整下</span><br>cli<span>$stage</span> &lt;- ifelse(cli<span>$stage</span>==<span>"pT1ｂN0M0"</span>,<span>"pT1bN0M0"</span>, cli<span>$stage</span>)<br>cli1 &lt;- cli %&gt;% <br>  mutate(Tstage = gsub(<span>"(pT\\d[a-z]*)(N\\d)(M\\d)"</span>,<span>"\\1"</span>,stage),<br>         Nstage = gsub(<span>"(pT\\d[a-z]*)(N\\d)(M\\d)"</span>,<span>"\\2"</span>,stage),<br>         Mstage = gsub(<span>"(pT\\d[a-z]*)(N\\d)(M\\d)"</span>,<span>"\\3"</span>,stage)) %&gt;% <br>  dplyr::select(-stage)<br>table(cli1<span>$Tstage</span>)<br><span># pT1a pT1b  pT2 pT3a pT3b pT3c  pT4 </span><br><span># 129   58   18   14   16    3    2 </span><br><br><span># N0  N1  N2 </span><br><span># 229   6   5</span><br><br><span># M0  M1 </span><br><span># 215  25</span><br><br><span># 数据合并-表达矩阵</span><br>eset &lt;- inner_join(ids,df,by=<span>"acc"</span>) %&gt;% <br>  dplyr::select(-acc) %&gt;% <br>  mutate(rowMean=rowMeans(.[,-1])) %&gt;% <br>  arrange(desc(rowMean)) %&gt;% <br>  distinct(symbol,.keep_all = T) %&gt;% <br>  dplyr::select(-rowMean) %&gt;% <br>  column_to_rownames(<span>"symbol"</span>)<br><br><span># 数据合并-临床信息</span><br>samples &lt;- intersect(colnames(eset),cli1<span>$id</span>)<br>eset &lt;- eset[,samples]<br>eset1 &lt;- eset %&gt;% <br>  rownames_to_column(<span>"symbol"</span>)<br>cli1 &lt;- cli1[cli1<span>$id</span> %<span>in</span>% samples,]<br>write.csv(eset1,<span>"results/emtab1980_eset.csv"</span>,row.names = F,quote = F)<br>write.csv(cli1,file = <span>"results/emtab1980_pdata.csv"</span>,row.names = F, quote = F)</code></pre></section><p><span>通过上面的一顿操作，咱们就获得了</span><code><span>emtab1980_eset.csv</span></code><span>和</span><code><span>emtab1980_pdata.csv</span></code><span>两个文件。大致看下这两个文件。</span></p><p><img data-galleryid="" data-imgfileid="100003367" data-ratio="0.5764075067024129" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2yfUbdx4NLZJxOdjd316PYliaUuiajKvWKlQ9nZyltm7HQV3WMVUfz0ibA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="746" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2yfUbdx4NLZJxOdjd316PYliaUuiajKvWKlQ9nZyltm7HQV3WMVUfz0ibA/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-imgfileid="100003363" data-ratio="0.39444444444444443" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic27dolK7IuDsMkr4hD0TRYo1cyGicd66RW3ibT9zGILic90S7xeCRQrTmvA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="768" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic27dolK7IuDsMkr4hD0TRYo1cyGicd66RW3ibT9zGILic90S7xeCRQrTmvA/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100003364" data-ratio="0.4685185185185185" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2wkmPykdc9zZvJZbYVhbicJ7FiaxHavtp6p1bK98vezEyYl9gaGaQlRJg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="705" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDGVkcpHrwuibpQMgHHHGNoic2wkmPykdc9zZvJZbYVhbicJ7FiaxHavtp6p1bK98vezEyYl9gaGaQlRJg/640?wx_fmt=png&amp;from=appmsg"></p><hr><p><span>声明：本文绝大部分代码均学习收集整理自网络(生信技能树、单细胞天地等)，仅供交流学习，禁止用于商业用途，如有侵权，请联系删除。鉴于本人水平有限，某些内容难免理解不到位，还请各位大佬多多指教。</span></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/s3a2dt29w8VhSfR3gcJ5fw",target="_blank" rel="noopener noreferrer">原文链接</a>
