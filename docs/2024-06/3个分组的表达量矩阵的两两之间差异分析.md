---
title: "3个分组的表达量矩阵的两两之间差异分析"
date: 2024-06-21T03:41:31Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
3个分组的表达量矩阵的两两之间差异分析 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>总是有粉丝询问多个分组的两两之间差异分析如何弄这样的问题，其实“师傅领进门，修行在个人”，我们讲解了方法并且给予的全部的学习资源，理论上后续应该是大家各凭本事，做好自己的科研。</p></blockquote><p data-tool="mdnice编辑器">limma包的说明书有200多页，它是有值得花时间的必要性！</p><h3 data-tool="mdnice编辑器"><span></span>首先创造一个有着3分组表达量矩阵<span></span></h3><p data-tool="mdnice编辑器">代码如下：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(limma)<br>y &lt;- matrix(rnorm(<span>10000</span>*<span>9</span>),<span>10000</span>,<span>9</span>)<br>fivenum(y)<br>(group=rep(LETTERS[<span>1</span>:<span>3</span>],each=<span>3</span>) )<br>y[sample(<span>1</span>:<span>10000</span>,<span>1000</span>),<span>1</span>:<span>3</span>]=y[sample(<span>1</span>:<span>10000</span>,<span>1000</span>),<span>1</span>:<span>3</span>]+<span>2</span><br>y[sample(<span>1</span>:<span>10000</span>,<span>1000</span>),<span>4</span>:<span>6</span>]=y[sample(<span>1</span>:<span>10000</span>,<span>1000</span>),<span>4</span>:<span>6</span>]+<span>2</span><br>y[sample(<span>1</span>:<span>10000</span>,<span>1000</span>),<span>7</span>:<span>9</span>]=y[sample(<span>1</span>:<span>10000</span>,<span>1000</span>),<span>7</span>:<span>9</span>]+<span>2</span><br><span>library</span>(pheatmap)<br><span># pheatmap(y )</span><br></code></pre><p data-tool="mdnice编辑器">可以看到，我给这3个分组的表达量各自随机挑选了1000个基因进行系统性的提高，如下所示：</p><p><img data-galleryid="" data-ratio="2.0714285714285716" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxO5AkYG4NwMI5nwrzMMjvXouD1Tdf2ku4ZGDUgyuT8ib36GPb2OM5nHb43jCShTibOdwGaAgaTRk4Q/640?wx_fmt=png" data-type="png" data-w="644" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxO5AkYG4NwMI5nwrzMMjvXouD1Tdf2ku4ZGDUgyuT8ib36GPb2OM5nHb43jCShTibOdwGaAgaTRk4Q/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><h3 data-tool="mdnice编辑器"><span></span>接下来进行3分组的两两之间差异分析<span></span></h3><p data-tool="mdnice编辑器">直接使用limma包即可：</p><pre data-tool="mdnice编辑器"><span></span><code>design &lt;- model.matrix(~<span>0</span>+group)<br>colnames(design) &lt;- gsub(<span>"group"</span>, <span>""</span>, colnames(design))<br>design<br>contr.matrix &lt;- makeContrasts(<br>  AVSB = A-B, <br>  AVSC = A-C, <br>  BVSC = B-C, <br>  levels = colnames(design))<br>contr.matrix<br><br>vfit &lt;- lmFit(y, design)<br>vfit &lt;- contrasts.fit(vfit, contrasts=contr.matrix)<br>efit &lt;- eBayes(vfit)<br>plotSA(efit)<br>colnames(efit)<br>summary(decideTests(efit))<br><br></code></pre><p data-tool="mdnice编辑器">可以看到， 各自的差异基因数量；</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; summary(decideTests(efit))<br>       AVSB AVSC BVSC<br>Down    311  250  278<br>NotSig 9418 9517 9419<br>Up      271  233  303<br></code></pre><p data-tool="mdnice编辑器">虽然我前面是统一给每个分组各自1000个基因的干扰，但是实际上，它的效应会被这个表达量矩阵本来的随机性给叠加，所以这样的结果是可以理解的。</p><p data-tool="mdnice编辑器">也可以随便挑选两个差异分析结果取交集看看：</p><pre data-tool="mdnice编辑器"><span></span><code>dt &lt;- decideTests(efit)<br>summary(dt)<br>de.common &lt;- which(dt[,<span>1</span>]!=<span>0</span> &amp; dt[,<span>2</span>]!=<span>0</span>)<br>length(de.common)<br>vennDiagram(dt[,<span>1</span>:<span>2</span>], circle.col=c(<span>"turquoise"</span>, <span>"salmon"</span>))<br></code></pre><p data-tool="mdnice编辑器">如下所示：</p><p><img data-galleryid="" data-ratio="0.8858131487889274" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxO5AkYG4NwMI5nwrzMMjvXCdWxJvGsnmYJ11qNVz1L70NZrtcqVrnA00FhTqBMGGI7OrGKZiaia5ZA/640?wx_fmt=png" data-type="png" data-w="" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxO5AkYG4NwMI5nwrzMMjvXCdWxJvGsnmYJ11qNVz1L70NZrtcqVrnA00FhTqBMGGI7OrGKZiaia5ZA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">这3次差异分析的结果都是可以独立取出来了：</p><pre data-tool="mdnice编辑器"><span></span><code><br>colnames(efit)<br><span># [1] "AVSB" "AVSC" "BVSC"</span><br>AVSB &lt;- topTreat(efit, coef=<span>1</span>, n=<span>Inf</span>)<br>AVSC &lt;- topTreat(efit, coef=<span>2</span>, n=<span>Inf</span>)<br>BVSC &lt;- topTreat(efit, coef=<span>3</span>, n=<span>Inf</span>)<br>head(AVSB)<br>head(AVSC)  <br><br></code></pre><p data-tool="mdnice编辑器">是不是很方便？</p><h3 data-tool="mdnice编辑器"><span></span>思考题<span></span></h3><p data-tool="mdnice编辑器">难道3个分组，仅仅是有两两组合的这样的3种形式的差异分析吗？</p><p data-tool="mdnice编辑器">上面的代码大量涉及到R基础知识：</p><ul data-tool="mdnice编辑器"><li><section>《<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247491094&amp;idx=1&amp;sn=3a8ececefdf5894f4ef98b0823f204b8&amp;scene=21#wechat_redirect" data-linktype="2">生信分析人员如何系统入门R(2019更新版)</a>》</section></li></ul><p data-tool="mdnice编辑器">需要把R的<strong>知识点路线图</strong>搞定，如下：</p><ul data-tool="mdnice编辑器"><li><section>了解常量和变量概念</section></li><li><section>加减乘除等运算（计算器）</section></li><li><section>多种数据类型（数值，字符，逻辑，因子）</section></li><li><section>多种数据结构（向量，矩阵，数组，数据框，列表）</section></li><li><section>文件读取和写出</section></li><li><section>简单统计可视化</section></li><li><section>无限量函数学习</section></li></ul></section><h3 data-tool="mdnice编辑器">文末友情推荐</h3><ul><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247502116&amp;idx=1&amp;sn=e9d07246245ebcc0839ab00821fee25d&amp;chksm=9b4b899fac3c0089b0c2ddb6ddb03518477fe8ba570fce13738d2b13e4881d4c0d97779a837f&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">明码标价之10X技术单细胞（2.5万每个）（标准100G测序数据）</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247502292&amp;idx=1&amp;sn=32fd8f5bd66f3b56d09c7f2350d6af83&amp;chksm=9b4b896fac3c0079fd93b8ccfd63f6c89b46088046fb02ac5be4d2ff841e654a4e01564ac95f&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">数据挖掘线下重启(长沙站)(周六日，5月22-23)</a></p></li></ul><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/XBXKoonUzlNZG_c3lCeFjA",target="_blank" rel="noopener noreferrer">原文链接</a>
