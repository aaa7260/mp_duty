---
title: "简单几步构建一个单细胞转录组浏览器"
date: 2024-06-14T23:54:48Z
draft: ["false"]
tags: [
  "fetched",
  "果子学生信"
]
categories: ["Acdemic"]
---
简单几步构建一个单细胞转录组浏览器 by 果子学生信
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">在我参与发表我的第一篇植物单细胞文章中，我用Shiny开发了一个简单的单细胞可视化网站，目前已经运行了5年了，有上万的访问，唯一的不足就是太简陋。我一直想着能不能找个一个更好的工具进行展示，最近发现了一个工具，ShinyCell，https://github.com/SGDDNB/ShinyCell。</p><p data-tool="mdnice编辑器">他的安装非常简单，就是安装如下的R包</p><pre data-tool="mdnice编辑器"><span></span><code>reqPkg = c(<span>"data.table"</span>, <span>"Matrix"</span>, <span>"hdf5r"</span>, <span>"reticulate"</span>, <span>"ggplot2"</span>, <br>           <span>"gridExtra"</span>, <span>"glue"</span>, <span>"readr"</span>, <span>"RColorBrewer"</span>, <span>"R.utils"</span>, <span>"Seurat"</span>)<br>newPkg = reqPkg[!(reqPkg %<span>in</span>% installed.packages()[,<span>"Package"</span>])]<br><span>if</span>(length(newPkg)){install.packages(newPkg)}<br><br><span># If you are using h5ad file as input, run the code below as well</span><br><span># reticulate::py_install("anndata")</span><br><br>reqPkg = c(<span>"shiny"</span>, <span>"shinyhelper"</span>, <span>"data.table"</span>, <span>"Matrix"</span>, <span>"DT"</span>, <span>"hdf5r"</span>, <br>           <span>"reticulate"</span>, <span>"ggplot2"</span>, <span>"gridExtra"</span>, <span>"magrittr"</span>, <span>"ggdendro"</span>)<br>newPkg = reqPkg[!(reqPkg %<span>in</span>% installed.packages()[,<span>"Package"</span>])]<br><span>if</span>(length(newPkg)){install.packages(newPkg)}<br><br><br>devtools::install_github(<span>"SGDDNB/ShinyCell"</span>)<br></code></pre><p data-tool="mdnice编辑器">然后，你读取你分析得到的Seurat文件，注意readySeu_rset.rds对应的是你使用Seura分析得到，并保存的Rds数据。接着，使用createConfig创建配配置，并用makeShinyApp制作shiny文件。</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(Seurat)<br><span>library</span>(ShinyCell)<br>getExampleData() <span>#案例数据</span><br>seu.obj = readRDS(<span>"readySeu_rset.rds"</span>)<br>scConf = createConfig(seu.obj )<br>makeShinyApp(seu.obj , scConf, gene.mapping = <span>TRUE</span>,<br>             shiny.title = <span>"ShinyCell Quick Start"</span>) <br></code></pre><p data-tool="mdnice编辑器">makeShinyApp 可以需要修改的参数如下</p><ul data-tool="mdnice编辑器"><li><section>gex.slot和gex.assay 用于定义展示的表达量数据的位置，比如说Seurat可以选择"RNA" 还是 "integrated"</section></li><li><section>gene.mapping: 一般是gene_id和gene symbol的对应关系。</section></li><li><section>shiny.dir  输出路径，默认是当前目录下的shinyApp。</section></li></ul><p data-tool="mdnice编辑器">最后输出的文件夹里包括ui.R, server.R 以及一系列的数据，可以通过Rstudio打开该文件夹，然后点开ui.R或者server.R 就可以看到Run App，用于启动。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="503253403" data-ratio="0.39068825910931176" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/NDy5aEnReX1Wia7OOxrqeStmYmDkdOSnCNsbjFp2YfhDayGQ9BSICD3rtBNaibLmXmVGQBrcHBHwiabUyeibSW0kxQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1482" src="https://mmbiz.qpic.cn/sz_mmbiz_png/NDy5aEnReX1Wia7OOxrqeStmYmDkdOSnCNsbjFp2YfhDayGQ9BSICD3rtBNaibLmXmVGQBrcHBHwiabUyeibSW0kxQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">如果需要在Shiny Server中展示，需要额外安装一个shiny server, 以ubuntu为例，在服务器上运行如下命令</p><pre data-tool="mdnice编辑器"><span></span><code>sudo apt-get install gdebi-core<br>wget https://download3.rstudio.org/ubuntu-<span>18.04</span>/x86_64/shiny-server-<span>1.5</span><span>.22</span><span>.1017</span>-amd64.deb<br>sudo gdebi shiny-server-<span>1.5</span><span>.22</span><span>.1017</span>-amd64.deb<br></code></pre><p data-tool="mdnice编辑器">此外，服务器的R至少需要配置如下R包</p><pre data-tool="mdnice编辑器"><span></span><code><span># 定义需要安装和加载的包列表</span><br>packages &lt;- c(<span>"shiny"</span>, <span>"shinyhelper"</span>, <span>"data.table"</span>, <span>"Matrix"</span>, <span>"DT"</span>, <span>"magrittr"</span>,<br>              <span>"ggplot2"</span>, <span>"ggrepel"</span>, <span>"hdf5r"</span>, <span>"ggdendro"</span>, <span>"gridExtra"</span>)<br><br><span># 安装未安装的包</span><br>install_all_packages &lt;- <span>function</span>(packages) {<br>  new_packages &lt;- packages[!(packages %<span>in</span>% installed.packages()[,<span>"Package"</span>])]<br>  <span>if</span> (length(new_packages)) install.packages(new_packages, dependencies = <span>TRUE</span>)<br>}<br><br><span># 调用函数安装任何未安装的包</span><br>install_all_packages(packages)<br><br><span># 测试：加载所有包</span><br>lapply(packages, <span>library</span>, character.only = <span>TRUE</span>)<br></code></pre><p data-tool="mdnice编辑器">接着，将输出的文件夹，例如shinyApp移动到/srv/shiny-server目录下， 你就可以通过浏览器访问对应的项目了，例如 http://服务器地址:3838/shiny-server</p><p data-tool="mdnice编辑器">参考资料</p><ul data-tool="mdnice编辑器"><li><section>https://posit.co/download/shiny-server/</section></li></ul></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/BkguN2rIR9bjescLIh_cjg",target="_blank" rel="noopener noreferrer">原文链接</a>
