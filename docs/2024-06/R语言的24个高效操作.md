---
title: "R语言的24个高效操作"
date: 2024-06-30T23:56:37Z
draft: ["false"]
tags: [
  "fetched",
  "基因学苑"
]
categories: ["Acdemic"]
---
R语言的24个高效操作 by 基因学苑
------
<div><section><section><blockquote>本次内容，我们将介绍R语言中的一些特殊技艺。</blockquote></section><hr><p><br></p><p><span>1 修改默认提示语言</span></p><section><p>R默认提示的语言有的人是英文，有的人是中文，这是因为每个人系统默认语言不同，可以通过下面方式进行修改</p><pre><code>Sys.getlocale() <span>#显示系统语言</span><br>Sys.setenv(LANG=<span>"en"</span>) <span># 更换默认语言为英文</span><br></code></pre><p><strong><span>2 查看R所消耗内存大小</span></strong><br>可以使用memory.size() #获取内存大小，不过该函数值只是和windows系统。</p><pre><code>memory.size() <span>#获取内存大小</span><br>[<span>1</span>] <span>341</span><br></code></pre><p><strong><span>3 查看某个数据集内存大小</span></strong></p><pre><code>&gt; <span>object</span>.size(mtcars)<br><span>7208</span> bytes<br>&gt; <span>object</span>.size(mtcars)/<span>1024</span> <span>#以kb显示</span><br><span>7</span> bytes  <br></code></pre><p><strong><span>4 代码中换行</span></strong><br>默认回车是运行代码，在Rstudio中有自动补齐，比如定义一个函数，直接自动补齐了{}，回车就运行了，可以使用shift+enter #换行</p><pre><code><span><span>function</span>(<span>x,y</span>) </span>{<br><br>}<br></code></pre><p><strong><span>5 边赋值边显示</span></strong><br>默认赋值完，直接敲变量名就打印数据，可以利用下面方式一步完成两个操作。</p><pre><code> (<span>x</span> &lt;<span>-</span> <span>runif</span>(10))<br> <span>[1]</span> 0<span>.5795985</span> 0<span>.4661326</span> 0<span>.9730974</span> 0<span>.6697417</span> 0<span>.2431985</span> 0<span>.3988545</span> 0<span>.4064351</span> 0<span>.8403910</span><br> <span>[9]</span> 0<span>.3136191</span> 0<span>.9979925</span><br></code></pre><p><strong><span>7 查看源代码</span></strong><br>如果想查看R函数的源代码，直接输入函数名，不加括号即可。</p><pre><code>&gt; mean<br><span><span>function</span> (<span>x, ...</span>) <br><span>UseMethod</span>(<span><span>"mean"</span></span>)<br>&lt;<span>bytecode</span>: 0<span>x0000023e3b8db998</span>&gt;<br>&lt;<span>environment</span>: <span>namespace</span>:<span>base</span>&gt;<br></span></code></pre><section><strong><span>8 利用函数修改镜像</span></strong></section><p>如果不设置R镜像，每次安装R包是都会弹出选择框，可以在安装之前通过函数进行设置，使用chooseCRANmirror()函数，给定ind选项一个数值即可。数值代表镜像编号。</p><pre><code>&gt; chooseCRANmirror()<br>Secure CRAN mirrors <br><br> 1: 0-Cloud [https]                       2: Australia (Canberra) [https]       <br> 3: Australia (Melbourne 1) [https]       4: Australia (Melbourne 2) [https]    <br> 5: Australia (Perth) [https]             6: Austria [https]                    <br> 7: Brazil (BA) [https]                   8: Brazil (PR) [https]                <br> 9: Brazil (RJ) [https]                  10: Brazil (SP 1) [https]              <br><span>11: Brazil (SP 2) [https]                12: Bulgaria [https]                   </span><br><span>13: Canada (MB) [https]                  14: Chile (Santiago) [https]           </span><br><span>15: China (Beijing 2) [https]            16: China (Hefei) [https]              </span><br><span>17: China (Hong Kong) [https]            18: China (Guangzhou) [https] </span><br>&gt; chooseCRANmirror(ind = 18)<br></code></pre><p><strong><span>9 显示更多数据</span></strong></p><p>默认R显示1000行数据，如果想显示更多，可以通过设置max.print选项。</p><pre><code><span>&gt;</span><span> options(<span>'max.print'</span>)</span><br><span>$</span><span>max.print</span><br>[1] 1000<br><span><br>&gt;</span><span> options(<span>'max.print'</span>=2000)</span><br><span>&gt;</span><span> options(<span>'max.print'</span>)</span><br><span>$</span><span>max.print</span><br>[1] 2000<br></code></pre><section><strong><span>10 默认保留小数点</span></strong></section><p><strong><span><span></span></span></strong>默认R显示7为小数，如果想默认保留两位小数，可以通过设置digits选项。</p><pre><code><span>&gt;</span><span> options(<span>'digits'</span>)</span><br><span>$</span><span>digits</span><br>[1] 7<br><span><br>&gt;</span><span> options(<span>'digits'</span>=2)</span><br><span>&gt;</span><span> options(<span>'digits'</span>)</span><br><span>$</span><span>digits</span><br>[1] 2<br></code></pre></section><section><p><span><strong><span>11 管道</span></strong></span></p><section><p>使用管道让代码更加简洁，无需定义过多中间变量。R中的管道符号为“%&gt;%”如果要使用管道，需要加载magrittr包。其实Rstudio出的各种包都默认支持管道，如果加载了tidyverse包也是可以。</p><pre><code><span>&gt; library(magrittr)</span><br><span>&gt; library(ggplot2)</span><br><span>&gt; mtcars %&gt;% ggplot(aes(x=cyl,y=mpg,group=cyl))+geom_boxplot()</span><br></code></pre><p><span><strong><span>12 拆分列数据</span></strong></span><br>有些时候记不住列名，或者容易拼错，想要列名也能够自动补齐，可以使用attach函数，这样每一列就变成一个独立的变量。</p><pre><code><span>attach</span>(<span>mtcars</span>)<br>&gt; <span>cyl</span><br> <span>[1]</span> 6 6 4 6 8 6 8 4 4 6 6 8 8 8 8 8 8 4 4 4 4 8 8 8 8 4 4 4 8 6 8 4<br>&gt; <span>mpg</span><br> <span>[1]</span> 21<span>.0</span> 21<span>.0</span> 22<span>.8</span> 21<span>.4</span> 18<span>.7</span> 18<span>.1</span> 14<span>.3</span> 24<span>.4</span> 22<span>.8</span> 19<span>.2</span> 17<span>.8</span> 16<span>.4</span> 17<span>.3</span> 15<span>.2</span> 10<span>.4</span> 10<span>.4</span><br><span>[17]</span> 14<span>.7</span> 32<span>.4</span> 30<span>.4</span> 33<span>.9</span> 21<span>.5</span> 15<span>.5</span> 15<span>.2</span> 13<span>.3</span> 19<span>.2</span> 27<span>.3</span> 26<span>.0</span> 30<span>.4</span> 15<span>.8</span> 19<span>.7</span> 15<span>.0</span> 21<span>.4</span><br></code></pre><p><span><strong><span>13 默认加载包</span></strong></span><br>如果一些包经常使用，想要启动R之后自动加载，可以在配置文件中进行设置，例如每期启动R，自动加载ggplot2包。</p><pre><code>file.edit(<span>"~/.Rprofile"</span>)<br>.First &lt;- <span><span>function</span>(<span></span>) </span>{<br>library(ggplot2)<br>}<br></code></pre><p><span><strong><span>14 为R添加额外扩展包加载路径</span></strong></span><br>默认R包的加载目录在.libPaths()目录中，当然可以为其添加更多的路径。</p><pre><code>&gt; .libPaths()<br>[<span>1</span>] <span>"C:/Users/genom/Documents/R/win-library/4.0"</span><br>[<span>2</span>] <span>"C:/Program Files/R/R-4.0.3/library"</span>        <br>&gt; .libPaths(<span>new</span> = <span>"C:/Users/genom/Desktop/nparFiles/"</span>)<br>&gt; .libPaths()<br>[<span>1</span>] <span>"C:/Users/genom/Desktop/nparFiles"</span>   <span>"C:/Program Files/R/R-4.0.3/library"</span><br></code></pre><p><span><strong><span>15 迁移R包</span></strong></span><br>如果需要将一台设备安装的R包，在另外一台设备上安装，首先保存A设备上的R包名字列表，在另外一台设备上写一个循环进行安装。</p><pre><code><span>#在A设备上保存名字列表</span><br>oldip &lt;- installed.packages()[,1]<br>save(oldip,file = <span>"installedPacckages.Rdata"</span>)<br><br><span>#在B设备上进行安装；</span><br>load(<span>"installedPacckages.Rdata"</span>)<br>newip &lt;- installed.packages()[,1]<br> <span>for</span> (i <span>in</span> setdiff(oldip,newip)) {<br>  install.packages(i)<br>}<br></code></pre><p><span><strong><span>16 列出R包中的函数</span></strong></span><br>如果想查看一个R包中全部函数，可以使用下面的语句。</p><pre><code>ls(package:<span>base</span>)<br></code></pre><p><span><strong><span>17 不加载包使用其中函数</span></strong></span><br>如果加载R包，还想使用其中的函数，需要使用“包名字::函数名”的方式。</p><pre><code>dplyr::filter()<br></code></pre><p><span><strong><span>18 快速获取颜色</span></strong></span><br>在绘图的时候，想要快速设置几个不同的颜色，又嫌生成颜色比较麻烦。可以使用rainbow()函数，给定一个数据，快速生成颜色。</p><pre><code>&gt; rainbow(<span>6</span>)<br>[<span>1</span>] <span>"#FF0000"</span> <span>"#FFFF00"</span> <span>"#00FF00"</span> <span>"#00FFFF"</span> <span>"#0000FF"</span> <span>"#FF00FF"</span><span></span></code></pre></section></section><section><section><p><span><strong><span>19 炸开数据</span></strong></span><br>前面介绍了attach函数可以将每一列变成一个单独变量，但这种方式并不推荐，因为会让变量环境很混乱。可以使用一个特殊管道符"%$%"实现同样的效果，我称之为把数据“炸开”</p><pre><code><span>&gt; library(magrittr)</span><br>Warning message:<br>程辑包‘magrittr’是用R版本3.6.3 来建造的 <br><span>&gt; women %$% plot(weight,height)</span><br></code></pre><p><span><strong><span>20 巧用example函数学习绘图</span></strong></span><br>example函数会帮助运行R帮助文档中的代码，有时候想看一个函数如何使用，可以直接运行这个example函数。</p><pre><code>&gt; library(pheatmap)<br>&gt; example(<span>"pheatmap"</span>)<br><br>phetmp&gt; <span># Create test matrix</span><br>phetmp&gt; test = matrix(rnorm(<span>200</span>), <span>20</span>, <span>10</span>)<br><br>phetmp&gt; test[<span>1</span>:<span>10</span>, se<span>q(1, 10, 2)</span>] = test[<span>1</span>:<span>10</span>, se<span>q(1, 10, 2)</span>] + <span>3</span><br><br>phetmp&gt; test[<span>11</span>:<span>20</span>, se<span>q(2, 10, 2)</span>] = test[<span>11</span>:<span>20</span>, se<span>q(2, 10, 2)</span>] + <span>2</span><br><br>phetmp&gt; test[<span>15</span>:<span>20</span>, se<span>q(2, 10, 2)</span>] = test[<span>15</span>:<span>20</span>, se<span>q(2, 10, 2)</span>] + <span>4</span><br><br>phetmp&gt; colnames(test) = paste(<span>"Test"</span>, <span>1</span>:<span>10</span>, sep = <span>""</span>)<br><br>phetmp&gt; rownames(test) = paste(<span>"Gene"</span>, <span>1</span>:<span>20</span>, sep = <span>""</span>)<br><br>phetmp&gt; <span># Draw heatmaps</span><br>phetmp&gt; pheatmap(test)<br></code></pre><p><span><strong><span>21 统计计算时间</span></strong></span><br>想统计一条代码运行时间，可以使用system.time()函数</p><pre><code>&gt; <span>system</span><span>.time</span>(<span>runif</span>(100000000))<br>用户 系统 流逝 <br>2<span>.75</span> 0<span>.08</span> 2<span>.83</span> <br></code></pre><p><span><strong><span>21 释放内存</span></strong></span><br>R有一套自己的内存回收机制，因此，即使删除了变量，内存不会立即变化，可以使用gc()函数释放内存。</p><pre><code><span>&gt; memory.size()</span><br>[1] 297.56<br><span>&gt; rm(list = ls())</span><br><span>&gt; memory.size()</span><br>[1] 298.54<br><span>&gt; gc()</span><br>          used (Mb) gc trigger  (Mb) max used  (Mb)<br>Ncells 1384255 74.0    4046672 216.2  4046672 216.2<br>Vcells 4288164 32.8   27057220 206.5 33821525 258.1<br><span>&gt; memory.size()</span><br>[1] 255.5<br></code></pre><p><span><strong><span>22 删除全部变量</span></strong></span></p><pre><code><span>#显示全部变量内容</span><br><span>&gt; ls()</span><br><span>#删除</span><br><span>&gt; rm(list=ls())</span><br><span>#释放内存</span><br><span>&gt; gc()</span><br></code></pre><p><span><strong><span>23 恢复默认数据集</span></strong></span><br>如果不小心将内置数据集删除了，或者新定义同名变量，就会替换原有数据集。</p><pre><code> head(mtcars)<br>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb<br>Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4<br>Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4<br>Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1<br>Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1<br>Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2<br>Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1<br><span>&gt;</span><span> mtcars=1:10</span><br><span>&gt;</span><span> mtcars</span><br> [1]  1  2  3  4  5  6  7  8  9 10<br><span>&gt;</span><span> data(<span>"mtcars"</span>)</span><br><span>&gt;</span><span> head(mtcars)</span><br>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb<br>Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4<br>Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4<br>Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1<br>Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1<br>Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2<br>Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1<br><span>&gt;</span><span> </span><br></code></pre><p><span><strong><span>24 快速获取函数选项参数</span></strong></span><br>R函数的选项参数非常多，如果每次都调出帮助文档很麻烦，可以使用args()函数，快速打印出函数的选项参数。</p><pre><code>&gt; args(heatmap)<br><span>function</span> (x, Rowv = <span>NULL</span>, Colv = <span>if</span> (symm) <span>"Rowv"</span> <span>else</span> <span>NULL</span>, <br>    distfun = dist, hclustfun = hclust, reorderfun = <span>function</span>(d, <br>        w) reorder(d, w), add.expr, symm = <span>FALSE</span>, revC = identical(Colv, <br>        <span>"Rowv"</span>), scale = c(<span>"row"</span>, <span>"column"</span>, <br>        <span>"none"</span>), na.rm = <span>TRUE</span>, margins = c(<span>5</span>, <span>5</span>), ColSideColors, <br>    RowSideColors, cexRow = <span>0.2</span> + <span>1</span>/log10(nr), cexCol = <span>0.2</span> + <br>        <span>1</span>/log10(nc), labRow = <span>NULL</span>, labCol = <span>NULL</span>, main = <span>NULL</span>, <br>    xlab = <span>NULL</span>, ylab = <span>NULL</span>, keep.dendro = <span>FALSE</span>, verbose = getOption(<span>"verbose"</span>), <br>    <span>...</span>) <br><span>NULL</span></code></pre></section></section><p><br></p></section><p><span><strong>基因学苑生物云计算平台</strong></span></p><p><img data-backh="373" data-backw="578" data-galleryid="" data-ratio="0.64609375" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/iaoCyajIqNPuLgNNr5doZDhL6SeDpZVqM4U45dpRGozRdibe3N6ic6OZmIO7W9Ueqtfwp7DnctrN9icYlr6HMrsr3Q/640?wx_fmt=png" data-type="png" data-w="1280" src="https://mmbiz.qpic.cn/sz_mmbiz_png/iaoCyajIqNPuLgNNr5doZDhL6SeDpZVqM4U45dpRGozRdibe3N6ic6OZmIO7W9Ueqtfwp7DnctrN9icYlr6HMrsr3Q/640?wx_fmt=png"></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/QIaZ1FT-9XVgeSks1MfXVQ",target="_blank" rel="noopener noreferrer">原文链接</a>
