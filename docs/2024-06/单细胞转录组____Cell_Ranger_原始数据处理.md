---
title: "单细胞转录组 —— Cell Ranger 原始数据处理"
date: 2024-06-27T06:23:03Z
draft: ["false"]
tags: [
  "fetched",
  "生信杂货铺"
]
categories: ["Acdemic"]
---
单细胞转录组 —— Cell Ranger 原始数据处理 by 生信杂货铺
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h1 data-tool="mdnice编辑器"><span></span><span><span>前言</span></span></h1><p data-tool="mdnice编辑器">我们前面介绍了单细胞转录组原始数据的处理步骤，以及每一步中涉及的各种问题及解决方案。下面我们将介绍几个常用的原始数据的处理流程。</p><h2 data-tool="mdnice编辑器"><span></span><span>参考基因组</span><span></span></h2><p data-tool="mdnice编辑器">首先是参考基因组的选择，大多数 <code>scRNA-seq</code> 实验都是利用人体或小鼠组织、器官组织或细胞培养物进行的。</p><p data-tool="mdnice编辑器">这些基因组组装和注释的更新比较频繁。有两种常用的组装文件来源：</p><ul data-tool="mdnice编辑器"><li><section><code>UCSC</code> 的组装文件名为 <code>hg19</code>、<code>hg38</code>、<code>mm10</code> 等</section></li><li><section><code>GRC</code>：如 <code>GRCh37</code>、<code>GRCh38</code>、<code>GRCm38</code> 等</section></li></ul><p data-tool="mdnice编辑器"><code>UCSC</code> 和 <code>GRC</code> 的主要版本在主要染色体上是一致的（如 <code>hg38</code> 中的 <code>chr1</code> 等于 <code>GRCh38</code> 中的 <code>chr1</code>），但在附加等位基因和所谓的 <code>ALT</code> 位点上有所不同，这些位点在次要版本（如 <code>GRCh38.p13</code>）之间会发生变化。</p><p data-tool="mdnice编辑器">更多信息请查阅 <span>Genome Reference Consortium</span><sup>[1]</sup> 和 <span>Heng Li's blog</span><sup>[2]</sup>。</p><p data-tool="mdnice编辑器">基因组注释文件定义了基因组（基因）的转录区，以及注释具有外显子内含子边界的确切转录本，并为新定义的特征分配类型--如蛋白质编码、非编码等。</p><p data-tool="mdnice编辑器">人类和小鼠基因组注释的常用来源是 <code>RefSeq</code>、<code>ENSEMBL</code> 和 <code>GENCODE</code>。</p><p data-tool="mdnice编辑器">其中 <code>RefSeq</code> 是这三个来源中最保守的一个，每个基因注释的转录本往往最少。<code>RefSeq</code> 转录本 <code>ID</code> 以 <code>NM_</code> 或 <code>NR</code> 开头，如 <code>NM_12345</code>。</p><p data-tool="mdnice编辑器"><code>ENSEMBL</code> 和 <code>GENCODE</code> 非常相似，可以互换使用。其中基因名称以 <code>ENSG</code>（人类）和 <code>ENSMUSG</code>（小鼠）开头；转录本分别以 <code>ENST</code> 和 <code>ENSMUST</code> 开头。</p><p data-tool="mdnice编辑器">除了基因 <code>ID</code>，大多数基因还有一个常用的名称（<code>gene symbol</code>）；例如，人肌动蛋白 <code>B</code> 的 <code>ID</code> 为 <code>ENSG00000075624</code>，<code>symbol</code> 为 <code>ACTB</code>。</p><p data-tool="mdnice编辑器">人类基因名称由 <span>HGNC</span><sup>[3]</sup> 定期更新和定义。老鼠的基因名称是由一个类似的组织 <span>MGI</span><sup>[4]</sup> 决定的。</p><p data-tool="mdnice编辑器">目前的 <code>ENSEMBL/GENCODE</code> 数据库中人类基因组注释包含约 <code>6</code> 万个基因，其中 <code>2</code> 万个为蛋白质编码基因，以及 <code>23.7</code> 万个转录本。</p><p data-tool="mdnice编辑器">大多数基因可按类型粗略地分为蛋白质编码基因、长非编码 <code>RNA</code>、短非编码 <code>RNA</code> 和假基因。</p><p data-tool="mdnice编辑器">如图所示，不同注释版本之间基因也不一样<img data-imgfileid="100014499" data-ratio="0.6091549295774648" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xhKqsVTSrqYKF8d6821MaOfw1qhfjwqLCWo4MZFxIpUGDP4IKNsZ6FA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1420" src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xhKqsVTSrqYKF8d6821MaOfw1qhfjwqLCWo4MZFxIpUGDP4IKNsZ6FA/640?wx_fmt=png&amp;from=appmsg"></p><h2 data-tool="mdnice编辑器"><span></span><span>数据处理流程</span><span></span></h2><p data-tool="mdnice编辑器"><code>scRNA-seq</code> 原始数据处理流程包括四个主要步骤：</p><ul data-tool="mdnice编辑器"><li><section>将 <code>cDNA</code> 片段映射到参考文献</section></li><li><section>将 <code>reads</code> 分配给基因</section></li><li><section>将 <code>reads</code> 分配到细胞（根据 <code>barcode</code>）</section></li><li><section>计算 <code>RNA</code> 分子的数量（无重复 <code>UMI</code> 数量）</section></li></ul><p data-tool="mdnice编辑器">处理的结果会产生一个基因与细胞的计数矩阵，用来估算每个细胞中每个基因的 <code>RNA</code> 分子数量。</p><h2 data-tool="mdnice编辑器"><span></span><span>Cell Ranger</span><span></span></h2><p data-tool="mdnice编辑器"><code>Cell Ranger</code> 是处理 <code>10x Genomics Chromium scRNAseq</code> 数据的默认工具。它使用 <code>STAR</code> 软件将 <code>reads</code> 与基因组进行剪接比对。</p><p data-tool="mdnice编辑器">它根据 <code>reads</code> 在基因组中的比对位置，将其分为外显子、内含子和基因间三类。即如果 <code>reads</code> 至少有 <code>50%</code> 的位置与外显子相交，则分为外显子类；如果为非外显子且与内含子相交，则分为内含子类；否则为基因间（如下图所示）。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100014496" data-ratio="0.5567970204841713" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xwMjJYialMdhGmk8chgZVviby9he1E3cNUcM9VcKQg3MuOnO9NKETykibg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1074" src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xwMjJYialMdhGmk8chgZVviby9he1E3cNUcM9VcKQg3MuOnO9NKETykibg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">在对 <code>reads</code> 进行类型分配后，会调整比对质量。即对于与一个外显子位点对齐但也与一个或多个非外显子位点对齐的 <code>reads</code>，外显子位点会被优先考虑，<code>reads</code> 会被认为有把握比对到外显子位点，并被赋予最高比对质量。</p><p data-tool="mdnice编辑器">通过检查外显子和内含子与转录组的兼容性，<code>Cell Ranger</code> 进一步将外显子和内含子定位到注释的转录本。</p><p data-tool="mdnice编辑器"><code>reads</code> 的分类基于它们是正的还是反义的，基于它们是外显子的还是内含子的，或者它们的剪接模式是否与该基因相关的转录本注释兼容。</p><p data-tool="mdnice编辑器">当输入的是细胞核数据时，会有很大一部分 <code>reads</code> 来自未剪接的转录本，比对到内含子上。为了计算这些内含子读数，在运行 <code>cellranger count</code> 和 <code>cellranger multi</code> 流程时，可以使用 <code>include-introns</code> 参数。</p><p data-tool="mdnice编辑器">如果使用了该参数，则任何比对到基因上的 <code>reads</code>（包括上图中标注为转录组（蓝色）、外显子（浅蓝色）和内含子（红色））都会纳入 <code>UMI</code> 数量的统计。</p><p data-tool="mdnice编辑器">如果一个 <code>reads</code> 只比对到一个基因，那么它就被认为是唯一比对的。只有唯一比对的 <code>reads</code> 才会被纳入 <code>UMI</code> 计数；多重比对的 <code>reads</code> 会被 <code>Cell Ranger</code> 丢弃。</p><h3 data-tool="mdnice编辑器"><span></span><span>软件安装</span><span></span></h3><p data-tool="mdnice编辑器">目前 <code>Cell Ranger</code> 不支持 <code>conda</code> 安装，可以通过容器（<code>docker</code> 或 <code>singularity</code>）安装。但是很多时候需要 <code>root</code> 权限，比较麻烦，好在下载就能用。</p><p data-tool="mdnice编辑器">进入软件 <span>下载页面</span><sup>[5]</sup>，可以看到下载方式。可以使用 <code>curl</code> 下载软件包</p><pre data-tool="mdnice编辑器"><span></span><code>curl -o cellranger-8.0.1.tar.gz <span>"https://cf.10xgenomics.com/releases/cell-exp/cellranger-8.0.1.tar.gz?Expires=1719433552&amp;Key-Pair-Id=APKAI7S6A5RYOXBWRPDA&amp;Signature=EFfBnQitglqkGEJroanvt-Y9kHHTyUk2NnbE~O6udqXJCYRE9SsNqe1akDBFcY2lhj0ywbgCdasdt87d4387Ra~z-S7uejBuAp4w6wq7dKkyKarczUQbMJQeL1vTizLBkUIIdcKxzNrLoY4E1hJgC1HDcFwNMRnDaDKIGJunkjurBW35grgskwAAMf6vkGq8adrO56WSXoLZA9PmPp2zx50Ih0GbKZ79CwvwRTC-f67DNAXCgHRtSYqA99jlVfqb-JAHPiqKrKcb7GlOtpmRYqLah63jlUnzKn0d18x1iC1-rI~lWVN1jQcISUN-GJvRZT4HNnxhap8TiCebyIP1gA__"</span><br></code></pre><p data-tool="mdnice编辑器">或者使用 <code>wget</code></p><pre data-tool="mdnice编辑器"><span></span><code>wget -O cellranger-8.0.1.tar.gz <span>"https://cf.10xgenomics.com/releases/cell-exp/cellranger-8.0.1.tar.gz?Expires=1719433552&amp;Key-Pair-Id=APKAI7S6A5RYOXBWRPDA&amp;Signature=EFfBnQitglqkGEJroanvt-Y9kHHTyUk2NnbE~O6udqXJCYRE9SsNqe1akDBFcY2lhj0ywbgCdasdt87d4387Ra~z-S7uejBuAp4w6wq7dKkyKarczUQbMJQeL1vTizLBkUIIdcKxzNrLoY4E1hJgC1HDcFwNMRnDaDKIGJunkjurBW35grgskwAAMf6vkGq8adrO56WSXoLZA9PmPp2zx50Ih0GbKZ79CwvwRTC-f67DNAXCgHRtSYqA99jlVfqb-JAHPiqKrKcb7GlOtpmRYqLah63jlUnzKn0d18x1iC1-rI~lWVN1jQcISUN-GJvRZT4HNnxhap8TiCebyIP1gA__"</span><br></code></pre><p data-tool="mdnice编辑器">解压</p><pre data-tool="mdnice编辑器"><span></span><code>tar -xf cellranger-8.0.1.tar.gz <br></code></pre><p data-tool="mdnice编辑器">可以将软件环境添加到环境变量中，例如</p><pre data-tool="mdnice编辑器"><span></span><code><span>export</span> PATH=<span>$PATH</span>:/path/to/cellranger<br></code></pre><p data-tool="mdnice编辑器">如果下面的测试成功，说明安装没有问题了</p><pre data-tool="mdnice编辑器"><span></span><code>cellranger testrun --id=tiny<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>构建索引</span><span></span></h3><p data-tool="mdnice编辑器">定量之前首先要构建索引，可以下载 <code>Cell Ranger</code> 构建好的人类和小鼠的索引，也可以使用比对好的参考基因组及注释文件来手动构建索引。</p><p data-tool="mdnice编辑器"><code>Cell Ranger</code> 所构建的索引，都是使用 <code>primary</code> 基因组装配版本（即不包括 <code>ALT</code> 位点）。注释的 <code>GTF</code> 文件经过过滤，具体的过滤脚本可以在 <span>RELEASE NOTES</span><sup>[6]</sup> 中找到。</p><p data-tool="mdnice编辑器">主要保留了蛋白质编码、长链非编码 <code>RNA</code>、反义 <code>RNA</code>，以及属于 <code>BCR</code>/<code>TCR</code>（即 <code>V/D/J</code>）基因（旧版可能不包括后者）。所有假基因和小非编码 <code>RNA</code> 都被移除。</p><p data-tool="mdnice编辑器">索引的版本大概有如下几个，<code>2020-A</code> 是最新的参考版本。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100014497" data-ratio="0.6403061224489796" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xm7TUxjQBQSHMcibD6qUGbwd1HSGPC1iaoVoqGJicbEuNC7giaicAGlDtYicA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1568" src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xm7TUxjQBQSHMcibD6qUGbwd1HSGPC1iaoVoqGJicbEuNC7giaicAGlDtYicA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">此外，<code>Cell Ranger</code> 还包含人类+小鼠组合参考索引，这对于涉及人类和小鼠细胞的实验非常有用。</p><h4 data-tool="mdnice编辑器"><span></span><span>下载索引</span><span></span></h4><p data-tool="mdnice编辑器">在下载页面中，可以找到对应构建好的索引的链接。例如，下载并解压人类 <code>GRCh38</code> 版的索引</p><pre data-tool="mdnice编辑器"><span></span><code>wget <span>"https://cf.10xgenomics.com/supp/cell-exp/refdata-gex-GRCh38-2024-A.tar.gz"</span><br>tar -xf refdata-cellranger-arc-GRCh38-2020-A-2.0.0.tar.gz<br></code></pre><h4 data-tool="mdnice编辑器"><span></span><span>构建索引</span><span></span></h4><p data-tool="mdnice编辑器">例如，从 <code>UCSC</code> 中下载小鼠 <code>mm10</code> 版的参考基因组及注释文件</p><pre data-tool="mdnice编辑器"><span></span><code>wget https://hgdownload.soe.ucsc.edu/goldenPath/mm10/bigZips/mm10.fa.gz<br>wget https://hgdownload.soe.ucsc.edu/goldenPath/mm10/bigZips/genes/mm10.refGene.gtf.gz<br></code></pre><p data-tool="mdnice编辑器">解压</p><pre data-tool="mdnice编辑器"><span></span><code>gunzip mm10.fa.gz<br>gunzip mm10.refGene.gtf.gz<br></code></pre><p data-tool="mdnice编辑器">这里我们没有对基因进行过滤，直接构建参考基因组</p><pre data-tool="mdnice编辑器"><span></span><code>cellranger mkref \<br>  --genome=mm10 \<br>  --fasta=mm10.fa \<br>  --genes=mm10.refGene.gtf \<br>  --output-dir mm10_index<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>定量</span><span></span></h3><h4 data-tool="mdnice编辑器"><span></span><span>barcode</span><span></span></h4><p data-tool="mdnice编辑器">细胞条形码（<code>cell barcode</code>，<code>CB</code>）序列是连接到珠子上的合成序列，用于识别单个细胞。</p><p data-tool="mdnice编辑器">独特序列库称为白名单，取决于 <code>Chromium</code> 库制备试剂盒的版本。白名单文件可从 <span> Cell Ranger repository</span><sup>[7]</sup> 中获取。</p><p data-tool="mdnice编辑器"><code>Chromium</code> 有三个白名单：</p><ul data-tool="mdnice编辑器"><li><section><code>737K-april-2014_rc.txt</code></section></li><li><section><code>737K-august-2016.txt</code></section></li><li><section><code>3M-february-2018.txt</code>。</section></li></ul><p data-tool="mdnice编辑器">第一个列表中的 <code>CB</code> 长度为 <code>14bp</code>，另外两个为 <code>16bp</code>。下表提供了常用 <code>10x</code> 单细胞测序试剂盒的 <code>CB</code> 和 <code>UMI</code> 长度，以及相应的白名单文件：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100014498" data-ratio="0.4318471337579618" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xbqsoxSIS0tLYZHmPma19IOTJrY7tJM1vaicQMWyus92DfrxYcuWx8Pw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1570" src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xbqsoxSIS0tLYZHmPma19IOTJrY7tJM1vaicQMWyus92DfrxYcuWx8Pw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><code>Cell Ranger</code> 使用以下算法根据白名单纠正假定的条形码序列</p><ol data-tool="mdnice编辑器"><li><section>计算数据集中每个白名单上的条形码的频率</section></li><li><section>对于数据集中未出现在白名单上的条形码，找到与之汉明距离为 <code>1</code> 的白名单序列。对于每个这样的序列</section></li></ol><ul><li><section>根据碱基的质量分数，计算观察到的条形码源自白名单条形码的后验概率</section></li><li><section>后验概率超过 <code>0.975</code> 的白名单条形码替换观察到的条形码</section></li></ul><p data-tool="mdnice编辑器">在输出的 <code>BAM</code> 文件中，原始未校正的条形码在 <code>CR</code> 标记中（<code>SAM</code> 比对记录中的 <code>TAG</code>），校正后的条形码序列在 <code>CB</code> 标记中。无法分配校正条形码的 <code>reads</code> 将不会有 <code>CB</code> 标记。</p><h4 data-tool="mdnice编辑器"><span></span><span>UMI 计数</span><span></span></h4><p data-tool="mdnice编辑器">在进行 <code>UMI</code> 计数之前，需要根据 <code>UMI</code> 序列进行 <code>PCR</code> 去重。<code>Cell Ranger</code> 会尝试纠正 <code>UMI</code> 序列中的测序错误。</p><p data-tool="mdnice编辑器">比对到转录组的 <code>reads</code> 会被放入具有相同 <code>CB</code>、<code>UMI</code> 和基因的分组中。如果两个分组具有相同的条形码和基因，但它们的 <code>UMI</code> 相差一个碱基（即汉明距离为 <code>1</code>），那么其中一个 <code>UMI</code> 很可能是由于测序中的置换错误造成的。在这种情况下，<code>reads</code> 数较低组的 <code>UMI</code> 会被修正为 <code>reads</code> 较高的 <code>UMI</code>。</p><p data-tool="mdnice编辑器"><code>Cell Ranger</code> 会再次根据 <code>CB</code>、<code>UMI</code>（可能已修正）和基因对 <code>reads</code> 进行分组。如果两组或更多组读数的 <code>CB</code> 和 <code>UMI</code> 相同，但基因不同，则保留 <code>reads</code> 数最多组比对上的基因来计算 <code>UMI</code>，其他组则被丢弃。</p><p data-tool="mdnice编辑器">在这两个过滤步骤之后，每个观察到的 <code>CB</code>、<code>UMI</code> 和基因组合都会作为 <code>UMI</code> 计数记录在未经过滤的计数矩阵中。</p><h4 data-tool="mdnice编辑器"><span></span><span>细胞过滤</span><span></span></h4><p data-tool="mdnice编辑器">未经过滤的原始矩阵包含许多实际上是空液滴的列，这些液滴中的基因表达计数并非为零，原因是存在技术噪音，例如存在来自破碎细胞的环境 <code>RNA</code>。不过，通常可以通过 <code>RNA</code> 的数量将它们与真正的细胞区分开来。</p><p data-tool="mdnice编辑器">在 <code>Cell Ranger</code> 中，有两种过滤细胞的算法，分别为 <code>Cell Ranger 2.2</code> 和 <code>Cell Ranger 3.0</code>。</p><p data-tool="mdnice编辑器">最初的算法（<code>2.2</code>）能识别<em>条形码数量与每个条形码的 UMI</em> 图中的第一个 <em>拐点</em>。而 <code>3.0</code> 引入了改进的细胞识别算法，能更好地识别低 <code>RNA</code> 含量细胞群，尤其是当低 <code>RNA</code> 含量细胞混入高 <code>RNA</code> 含量细胞群时。</p><p data-tool="mdnice编辑器">例如，肿瘤样本中往往混有大的肿瘤细胞和较小的肿瘤浸润淋巴细胞（<code>TIL</code>），研究人员可能会对 <code>TIL</code> 群体特别感兴趣。新算法基于 <span>EmptyDrops</span><sup>[8]</sup> 方法</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100014495" data-ratio="0.3736542115262825" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xAjH6K8pbsYz6z9coc2ZdmlbyGGKJq5IpFibaGbW4goDARUzdKN7aibaQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1579" src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xAjH6K8pbsYz6z9coc2ZdmlbyGGKJq5IpFibaGbW4goDARUzdKN7aibaQ/640?wx_fmt=png&amp;from=appmsg"></figure><h4 data-tool="mdnice编辑器"><span></span><span>计数矩阵</span><span></span></h4><p data-tool="mdnice编辑器">上面提到的功能都已经封装到软件中，只需要调用 <code>count</code> 子命令即可计算出技术矩阵。</p><p data-tool="mdnice编辑器">首先，获取 <code>10x</code> 的测序原始数据，可以从网上下载。比如，从 <code>SRA</code> 数据库中下载 <code>PRJNA666791</code> 项目的数据</p><pre data-tool="mdnice编辑器"><span></span><code>prefetch --option-file SRR_Acc_List.txt --output-directory sra<br></code></pre><p data-tool="mdnice编辑器">解压</p><pre data-tool="mdnice编辑器"><span></span><code>ls sra/*/*.sra | xargs fastq-dump --split-files --gzip -O raw<br></code></pre><p data-tool="mdnice编辑器">解压后每个 <code>sra</code> 会生成三个文件，后缀分别带有 <code>_1</code>、<code>_2</code> 和 <code>_3</code>，分别修改为 <code>R1</code>、<code>R2</code> 和 <code>I1</code> 文件。可以先确认一下文件中序列的长度再进行修改。</p><p data-tool="mdnice编辑器">其中样本索引文件（<code>I1</code> 或 <code>I2</code>）一般是不需要输入的，后面可以忽略。</p><p data-tool="mdnice编辑器">这套数据中包含两个样本，每个样本 <code>8</code> 个文件，修改文件名时可以看作是 <code>8</code> 条 <code>lane</code></p><pre data-tool="mdnice编辑器"><span></span><code>GSM4812353_S1_L001_R1_001.fastq.gz<br>GSM4812353_S1_L001_R2_001.fastq.gz<br>...<br>GSM4812353_S1_L008_R1_001.fastq.gz<br>GSM4812353_S1_L008_R2_001.fastq.gz<br></code></pre><p data-tool="mdnice编辑器">基本命令为</p><pre data-tool="mdnice编辑器"><span></span><code>cellranger count \<br>  --id run_count_GSM4812353 \<br>  --sample GSM4812353 \<br>  --fastqs input_dir \<br>  --transcriptome mm10_index \<br>  --localcores 20 \<br>  --output-dir GSM4812353 \<br>  --create-bam <span>true</span><br></code></pre><p data-tool="mdnice编辑器">分析结果主要存储在 <code>GSM4812353/outs</code> 中。例如</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100014501" data-ratio="0.7976539589442815" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xybyMAZx2zmTuDN1ibpLznmDia58oU38SGVocylywBjzblKia3x2dukFWg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="682" src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xybyMAZx2zmTuDN1ibpLznmDia58oU38SGVocylywBjzblKia3x2dukFWg/640?wx_fmt=png&amp;from=appmsg"></figure><h4 data-tool="mdnice编辑器"><span></span><span>结果解读</span><span></span></h4><p data-tool="mdnice编辑器">输出结果中包含三个文件夹</p><ul data-tool="mdnice编辑器"><li><section><code>analysis</code>：分析结果，包括降维、聚类和差异表达</section></li><li><section><code>filtered_feature_bc_matrix</code>：过滤后的计数结果</section></li><li><section><code>raw_feature_bc_matrix</code>：原始的计数结果</section></li></ul><p data-tool="mdnice编辑器">我们一般会选择过滤后的结果（<code>filtered_feature_bc_matrix</code>）用于下游分析。该文件夹下包含的三个文件</p><ul data-tool="mdnice编辑器"><li><section><code>barcodes.tsv.gz</code>：<code>CB</code> 信息</section></li><li><section><code>features.tsv.gz</code>：基因信息，来自于小鼠基因组的注释文件</section></li><li><section><code>matrix.mtx.gz</code>：计数矩阵，只存储了有值的行列索引及其对应的 <code>count</code></section></li></ul><p data-tool="mdnice编辑器">其中，<code>filtered_feature_bc_matrix</code> 和 <code>raw_feature_bc_matrix</code> 分别都有一个对应的 <code>h5</code> 格式文件，可以直接作为下游软件的输入数据格式。</p><p data-tool="mdnice编辑器"><code>molecule_info.h5</code> 文件是分子水平的信息，可以用于 <code>cellranger agrr</code> 合并多个样本</p><p data-tool="mdnice编辑器"><code>web_summary.html</code> 网页文件有详细的样本分析报告，方便查看</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100014503" data-ratio="0.7600749765698219" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xmNkY5qqia8bOv4WqzP5oo3w8qlO9z2R1PlbVVlM5menHKv2uLicq9TmA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="2134" src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xmNkY5qqia8bOv4WqzP5oo3w8qlO9z2R1PlbVVlM5menHKv2uLicq9TmA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>multi</span><span></span></h3><p data-tool="mdnice编辑器"><code>multi</code> 主要用于分析 <code>3' Cell Multiplexing</code> 数据，其他情况下，一般推荐使用 <code>count</code>。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100014502" data-ratio="0.35377358490566035" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xX7vzHq9uGKjgp0brpHpsYau0NI9E0sSrRYsVrWwicrf1gW7OjYZMfRQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1272" src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xX7vzHq9uGKjgp0brpHpsYau0NI9E0sSrRYsVrWwicrf1gW7OjYZMfRQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">什么是 <code>Cell Multiplexing</code> 呢？简单来说，<code>Cell Multiplexing</code> 是一种技术，通过对细胞或细胞核样本进行分子标签标记，然后将这些样本混合在一起进行处理。在测序后，利用分子标签信息将混合样本中的细胞进行区分。</p><p data-tool="mdnice编辑器">该技术的主要优点有：</p><ul data-tool="mdnice编辑器"><li><section>提高单次实验的样本通量</section></li><li><section>增加检测细胞的数量</section></li><li><section>提高实验的重复性</section></li><li><section>在分析前检测并去除多胞（<code>multiplets</code>）</section></li></ul><p data-tool="mdnice编辑器">更多信息可以参考官网的介绍 <span>What is Cell Multiplexing?</span><sup>[9]</sup></p><p data-tool="mdnice编辑器">运行 <code>cellranger multi</code> 需要一个 <code>CSV</code> 配置文件。例如</p><pre data-tool="mdnice编辑器"><span></span><code>cellranger multi --id=sample345 --csv=/home/jdoe/sample345.csv<br></code></pre><p data-tool="mdnice编辑器">不知道怎么填写这个配置文件，可以下载示例文件，然后修改对应的值</p><pre data-tool="mdnice编辑器"><span></span><code>cellranger multi-template --output=/path/to/FILE.csv<br></code></pre><p data-tool="mdnice编辑器">下面有几个官方的示例，具体参考 <span>Cell Multiplexing with cellranger multi</span><sup>[10]</sup>，其中红色字体为可修改部分。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100014505" data-ratio="1.1634349030470914" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xVibF8tVWF74nfkkwKWL2RkNSL9sGWqUZjhGrfCic3ric7y5D7uiceoiaK9g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1444" src="https://mmbiz.qpic.cn/sz_mmbiz_png/R14BjDEcNWId6hdfIrSbbNP2j4dO1k5xVibF8tVWF74nfkkwKWL2RkNSL9sGWqUZjhGrfCic3ric7y5D7uiceoiaK9g/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">配置文件主要包括 <code>4</code> 个部分</p><ul data-tool="mdnice编辑器"><li><section>[gene-expression]：两列，用于指定与基因表达数据分析相关的参数，如参考基因组和期望的细胞数，以及其他通用参数。</section></li><li><section>[feature]：两列，用于指定与分析 <code>Feature Barcode</code> 文库相关的参数。</section></li><li><section>[libraries]：三个必填列，用于指定输入 <code>FASTQ</code> 文件的位置。</section></li><li><section>[samples]：两个必填列，用于指定 <code>Cell Multiplexing</code> 的样本信息。</section></li></ul><h4 data-tool="mdnice编辑器"><span></span><span>count 与 multi 的区别</span><span></span></h4><p data-tool="mdnice编辑器"><code>count</code> 流程适用于</p><ul data-tool="mdnice编辑器"><li><section><p>单个样本测序：每个样本都是独立测序，没有合并多个样本的情况。例如，一个简单的单细胞 <code>RNA-seq</code> 实验，单次运行只处理一个样本的文库。</p></section></li><li><section><p>单一数据类型：测序数据只包含一种类型的数据，不涉及多种数据类型的整合分析。</p></section></li></ul><p data-tool="mdnice编辑器"><code>multi</code> 流程适用于</p><ul data-tool="mdnice编辑器"><li><section><p>多个样本合并测序：多个样本被混合在一个文库中进行测序。需要将多个样本的数据从一个测序数据中拆分并分别分析。</p></section></li><li><section><p>多种数据类型整合分析：同时包含多种类型的数据，如基因表达数据（<code>RNA-seq</code>）和细胞表面蛋白（<code>TCR/BCR</code>）。</p></section></li><li><section><p>多文库、多样本组合：复杂的实验设计，需要在一次测序中处理来自多个文库和样本的数据。例如，一个实验中有多个样本，每个样本都有多个文库（如不同的测序平台或不同的标记方法）。</p></section></li></ul><section data-tool="mdnice编辑器"><span>参考资料</span></section><section data-tool="mdnice编辑器"><span><span>[1]</span><p>GRC: <em>https://www.ncbi.nlm.nih.gov/grc/human</em></p></span><span><span>[2]</span><p>Which human reference genome to use?: <em>https://lh3.github.io/2017/11/13/which-human-reference-genome-to-use</em></p></span><span><span>[3]</span><p>HGNC: <em>https://www.genenames.org/</em></p></span><span><span>[4]</span><p>MGI: <em>https://www.informatics.jax.org/mgihome/nomen/</em></p></span><span><span>[5]</span><p>downloads: <em>https://www.10xgenomics.com/support/software/cell-ranger/downloads</em></p></span><span><span>[6]</span><p>RELEASE NOTES: <em>https://support.10xgenomics.com/single-cell-gene-expression/software/release-notes/build#header</em></p></span><span><span>[7]</span><p>Cell Ranger repository: <em>https://github.com/10XGenomics/cellranger/tree/master/lib/python/cellranger/barcodes</em></p></span><span><span>[8]</span><p>EmptyDrops: <em>https://genomebiology.biomedcentral.com/articles/10.1186/s13059-019-1662-y</em></p></span><span><span>[9]</span><p>[What is Cell Multiplexing?: <em>https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/what-is-cellplex</em></p></span><span><span>[10]</span><p>Cell Multiplexing with cellranger multi: <em>https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/using/multi#cmoreference</em></p></span></section></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/AyqdJp7abVtoxT5qdV8hag",target="_blank" rel="noopener noreferrer">原文链接</a>
