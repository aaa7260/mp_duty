---
title: "GSE167573数据下载及整理"
date: 2024-07-25T22:47:58Z
draft: ["false"]
tags: [
  "fetched",
  "学R时习之"
]
categories: ["Acdemic"]
---
GSE167573数据下载及整理 by 学R时习之
------
<div><p><span>学习肾透明细胞癌的数据集时发现另一个容易被遗漏的数据集</span><code><span>GSE167573</span></code><span>，已发现多篇文章用来作为外部验证集。下面咱们就来初步探索下该数据集。</span><ne-clipboard source="https%3A%2F%2Fwww.yuque.com%2Fgaodashitou%2Ffomdu3%2Fiafpw9yioio6w8ym"></ne-clipboard></p><p><code><span>GSE167573</span></code>包含63例肿瘤样本，14 例正常样本。其中 55 例有完整的预后数据(超赞👍)。</p><p><img data-imgfileid="100003546" data-ratio="0.4601851851851852" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDEiclTlqrPcmRZP9qxqDfNWJv4YicZnZY7uuIK9KCCnrw8sVGEp2EO6JHmKzIHSIRRhFDP7cvyAE4wQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="645" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDEiclTlqrPcmRZP9qxqDfNWJv4YicZnZY7uuIK9KCCnrw8sVGEp2EO6JHmKzIHSIRRhFDP7cvyAE4wQ/640?wx_fmt=png&amp;from=appmsg"></p><hr><p>之前咱们常规用<code>GEOmirror</code>下载整理数据，但<code>GEOmirror</code>仅能处理 2019 年前的数据。所以接下来咱们用<a href="https://mp.weixin.qq.com/s?__biz=MzU4NzcyNDMxOA==&amp;mid=2247487069&amp;idx=1&amp;sn=25ac46de051f6898337791f4576a8ddf&amp;scene=21#wechat_redirect" data-href="https://mp.weixin.qq.com/s?__biz=MzU4NzcyNDMxOA==&amp;mid=2247487069&amp;idx=1&amp;sn=25ac46de051f6898337791f4576a8ddf&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2">GSE29609数据下载及整理</a>的方法来进行分析。</p><h1><span>Part1 临床信息</span></h1><p>首先获取临床资料</p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br>library(limma)<br>library(tidyverse)<br>librarian::shelf(GEOquery)<br>librarian::shelf(GEOmirror)<br>librarian::shelf(AnnoProbe)<br><br><span>#dir.create("results")</span><br>gse=<span>"GSE167573"</span><br>gset &lt;- getGEO(gse, AnnotGPL = F, destdir = <span>"./source/"</span>)<br>gset &lt;- gset[[1]]<br><br><span>################################################################</span><br><span># 临床信息, 该部分可根据需要自行整理</span><br>pd &lt;- pData(gset) %&gt;%<br>dplyr::select(title,geo_accession, characteristics_ch1.2,characteristics_ch1.4:characteristics_ch1.8) %&gt;%<br>dplyr::filter(characteristics_ch1.2 != <span>""</span>)<br>colnames(pd) &lt;- c(<span>"title"</span>,<span>"geo_accession"</span>,<span>"gender"</span>,<span>"Tstage"</span>,<span>"Nstage"</span>,<span>"Mstage"</span>,<span>"OS.time.month"</span>,<span>"OS"</span>)<br>pd1 &lt;- pd %&gt;%<br>mutate(gender=ifelse(gender==<span>"genotype(1: male; 2: female): 1"</span>,<span>"male"</span>,<span>"female"</span>),<br>         Tstage=case_when(Tstage==<span>"t stage (1: t1; 2: t2; 3: t3; 4:t4): 1"</span>~<span>"T1"</span>,<br>                          Tstage==<span>"t stage (1: t1; 2: t2; 3: t3; 4:t4): 2"</span>~<span>"T2"</span>,<br>                          Tstage==<span>"t stage (1: t1; 2: t2; 3: t3; 4:t4): 3"</span>~<span>"T3"</span>,<br>                          Tstage==<span>"t stage (1: t1; 2: t2; 3: t3; 4:t4): 4"</span>~<span>"T4"</span>,<br>                          TRUE~<span>"other"</span>),<br>         Nstage=case_when(Nstage==<span>"n stage (0: n0; 1:n1): 0"</span>~<span>"N0"</span>,<br>                          Nstage==<span>"n stage (0: n0; 1:n1): 1"</span>~<span>"N1"</span>,<br>                          TRUE~<span>"other"</span>),<br>         Mstage=case_when(Mstage==<span>"m stage (0: m0; 1:m1): 0"</span>~<span>"M0"</span>,<br>                          Mstage==<span>"m stage (0: m0; 1:m1): 1"</span>~<span>"M1"</span>,<br>                          TRUE~<span>"other"</span>),<br>         OS.time.month=str_remove_all(OS.time.month,<span>"os time \\(months\\): "</span>),<br>         OS=str_remove_all(OS,<span>"OS status: "</span>)) %&gt;%<br>mutate(OS.time.month=case_when(OS.time.month==<span>"-"</span>~NA,<br>                                 TRUE~OS.time.month),<br>         OS=case_when(OS==<span>"-"</span>~NA,<br>                      TRUE~OS)) %&gt;%<br>na.omit()</code></pre></section><p><br></p><p>通过上面的操作，就得到了临床信息数据。接下来获取表达矩阵</p><p><img data-imgfileid="100003544" data-ratio="0.34074074074074073" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDEiclTlqrPcmRZP9qxqDfNWJtGxIiaCiaOndzlNEGkTWZQnVDQCmw69pbxfYQf8NeYzanwG52TEVzIRA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="748" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDEiclTlqrPcmRZP9qxqDfNWJtGxIiaCiaOndzlNEGkTWZQnVDQCmw69pbxfYQf8NeYzanwG52TEVzIRA/640?wx_fmt=png&amp;from=appmsg"></p><hr><h1><span>Part2 表达矩阵</span></h1><p>其实GEO里直接提供了重新分析的counts 数据，但是表达矩阵明显少一个样本，不知道为啥。推荐用Supplementary file 提供的<code><span>GSE167573_Processed_normalized_count_matrix.txt.gz</span></code>进行后续分析。</p><p><img data-imgfileid="100003545" data-ratio="0.44074074074074077" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDEiclTlqrPcmRZP9qxqDfNWJnkL9fPFGcw2sqKy5pzKJmicRcibLcLbhVibDQ3nClnwDX8K7icKfFNjzUg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="649" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDEiclTlqrPcmRZP9qxqDfNWJnkL9fPFGcw2sqKy5pzKJmicRcibLcLbhVibDQ3nClnwDX8K7icKfFNjzUg/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100003547" data-ratio="0.4064814814814815" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDEiclTlqrPcmRZP9qxqDfNWJh0ibS61e2PWUwRLacVG8e5ImnZ5MZ0ic0xekpVHOLjPmRdKSVxEGY1rA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="885" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDEiclTlqrPcmRZP9qxqDfNWJh0ibS61e2PWUwRLacVG8e5ImnZ5MZ0ic0xekpVHOLjPmRdKSVxEGY1rA/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100003543" data-ratio="0.3435185185185185" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDEiclTlqrPcmRZP9qxqDfNWJ8fSY0ibV78l6icPbibEb1Ed8BpN1K922yOoCZTukAM0oiaecWV0V7t3erQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="632" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDEiclTlqrPcmRZP9qxqDfNWJ8fSY0ibV78l6icPbibEb1Ed8BpN1K922yOoCZTukAM0oiaecWV0V7t3erQ/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p>随机点开一个临床样本，文档说明提示，<code><span>GSE167573_Processed_normalized_count_matrix.txt.gz</span></code>是经过 log2处理后的TPM数据。因此可以直接拿来用。</p><p><img data-imgfileid="100003548" data-ratio="0.8138888888888889" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDEiclTlqrPcmRZP9qxqDfNWJNS1DBnyJ9KuYlZslQqjaYoU6Uc57I3rlXvTTeXytXFXlFPtgq0cD8g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="617" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDEiclTlqrPcmRZP9qxqDfNWJNS1DBnyJ9KuYlZslQqjaYoU6Uc57I3rlXvTTeXytXFXlFPtgq0cD8g/640?wx_fmt=png&amp;from=appmsg"></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><pre data-tool="mdnice编辑器"><span></span><code><span># General expression data analysis</span><br>df &lt;- data.table::fread(<span>"source/GSE167573_Processed_normalized_count_matrix.txt.gz"</span>,data.table = F)<br>table(!duplicated(df<span>$GeneSymbol</span>))<br>df &lt;- df %&gt;%<br>  column_to_rownames(<span>"GeneSymbol"</span>)<br>samples &lt;- intersect(pd1<span>$title</span>, colnames(df))<br>gse167573_pdata &lt;- pd1[pd1<span>$title</span> %<span>in</span>% samples,]<br>gse167573_eset &lt;- log2(df[,colnames(df) %<span>in</span>% samples]+1) <span>#根据原文信息，此次应为 TPM的结果，</span><br><span>#Supplementary_files_format_and_content: tab-delimited text files include log2 transfomed TPM values for each Sample</span><br>range(gse167573_eset)<br>gse167573_eset &lt;- gse167573_eset %&gt;%<br>  rownames_to_column(<span>"symbol"</span>)<br>write.csv(gse167573_pdata,file = <span>"results/gse167573_pdata.csv"</span>,row.names = F,quote = F)<br> write.csv(gse167573_eset,file = <span>"results/gse167573_eset.csv"</span>,row.names = F,quote = F)</code></pre></section><p>运行上面内容得到了需要的表达矩阵。</p><p><img data-imgfileid="100003549" data-ratio="0.5953703703703703" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDEiclTlqrPcmRZP9qxqDfNWJe1DPXibXjj4zt8o4OLD34iateTZvbcFJibFwh0bseYpzyn4wACUU4dcgQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="791" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDEiclTlqrPcmRZP9qxqDfNWJe1DPXibXjj4zt8o4OLD34iateTZvbcFJibFwh0bseYpzyn4wACUU4dcgQ/640?wx_fmt=png&amp;from=appmsg"></p><hr><p>最后汇总下，经过咱们一顿猛如虎的操作，就得到了临床信息和表达矩阵的资料。</p><ul><li><p><code>gse167573_pdata.csv</code>: 临床信息</p></li><li><p><code>gse167573_eset.csv</code>: 表达矩阵</p></li></ul><p>后面就可以用该数据作为外部验证集进行验证。</p><hr><p>碎碎念：</p><ul><li><p>有大佬会问该数据集是TFE3易位肾细胞癌数据，不是纯粹的ccRCC数据，用来做验证可能不太好。其实顺带思考下，咱们用 ccRCC 数据集推算出来某个预测模型，都能推广到 ccRCC 之外的肾癌数据集中，说明咱们的预测模型实用性很好嘛。同理咱们也可以拿KIRP、KICH 等其他肾癌数据进一步说明模型的普适性。(个人观点，仅供参考)</p></li><li><p>case_when在 tidyverse 中连用时，右侧最好为文本。(<span>数字会报错</span>)</p></li></ul><p>声明：本文代码均学习收集整理自网络，仅供交流学习，禁止用于商业用途，如有侵权，请联系删除。鉴于本人水平有限，某些内容难免理解不到位，还请各位大佬多多指教。</p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/mJMtXLrxHxy8YOgfUYZJEA",target="_blank" rel="noopener noreferrer">原文链接</a>
