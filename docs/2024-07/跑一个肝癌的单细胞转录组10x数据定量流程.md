---
title: "跑一个肝癌的单细胞转录组10x数据定量流程"
date: 2024-07-25T08:33:33Z
draft: ["false"]
tags: [
  "fetched",
  "珠海健明生物医药科技"
]
categories: ["Acdemic"]
---
跑一个肝癌的单细胞转录组10x数据定量流程 by 珠海健明生物医药科技
------
<div><p><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>前面的教程里面 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247527907&amp;idx=1&amp;sn=5e2b4fa9b8f28f2169de87e057dde983&amp;scene=21#wechat_redirect" data-linktype="2">能从源头解决数据分析的瑕疵吗</a> ，我们重现了<strong>普通单细胞转录组</strong>数据分析的从fastq文件开始的走cellranger的定量流程。接下来，继续，应粉丝要求，跑一个肝癌的单细胞转录组10x数据定量流程！</p></blockquote><p data-tool="mdnice编辑器">在 https://www.ebi.ac.uk/ena/browser/view/PRJNA793914  可以看到这个项目详情，而且前些天我们演示了如何下载这个项目的fastq格式的测序数据原始文件，详见：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528470&amp;idx=1&amp;sn=246dfa88fac7c413ca102f2db676a515&amp;scene=21#wechat_redirect" data-linktype="2">aspera的高速下载确实很快吗</a>。但是从网络下载的单细胞转录组数据文件的样品名字别抹掉了，变成了顺序编号的id，而且呢，文件名字并不符合规则：</p><pre data-tool="mdnice编辑器"><span></span><code>7.1G 2月  23 02:24 SRR17418283_1.fastq.gz <br> 17G 2月  23 02:25 SRR17418283_2.fastq.gz<br>13G 2月  23 02:32 SRR17418284_1.fastq.gz<br>13G 2月  23 02:39 SRR17418284_2.fastq.gz<br>16G 2月  23 03:05 SRR17418295_1.fastq.gz<br>17G 2月  23 03:13 SRR17418295_2.fastq.gz<br>11G 2月  23 03:19 SRR17418296_1.fastq.gz<br>12G 2月  23 03:25 SRR17418296_2.fastq.gz<br>5.0G 2月  23 03:28 SRR17418297_1.fastq.gz<br> 12G 2月  23 03:34 SRR17418297_2.fastq.gz<br>12G 2月  23 03:40 SRR17418298_1.fastq.gz<br>12G 2月  23 03:46 SRR17418298_2.fastq.gz<br>9.4G 2月  23 03:51 SRR17418299_1.fastq.gz<br>9.7G 2月  23 03:55 SRR17418299_2.fastq.gz<br>18G 2月  23 04:04 SRR17418300_1.fastq.gz<br>18G 2月  23 04:13 SRR17418300_2.fastq.gz<br>5.8G 2月  23 04:16 SRR17418301_1.fastq.gz<br> 13G 2月  23 04:23 SRR17418301_2.fastq.gz<br>4.9G 2月  23 04:26 SRR17418302_1.fastq.gz<br> 11G 2月  23 04:32 SRR17418302_2.fastq.gz<br></code></pre><p data-tool="mdnice编辑器">所以是需要看网页里面的样品信息详情，然后构建一个 id.txt  的文本文件，内容如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>SRR17418283,PT1<br>SRR17418284,PT2<br>SRR17418295,PT3<br>SRR17418296,PT4<br>SRR17418297,PT5<br>SRR17418298,TT1<br>SRR17418299,TT2<br>SRR17418300,TT3<br>SRR17418301,TT4<br>SRR17418302,TT5<br></code></pre><p data-tool="mdnice编辑器">然后借助于chatGPT我简单的写一个脚本批量改名，这个shell脚本会读取上面的构建好的 id.txt  的文本文件：</p><pre data-tool="mdnice编辑器"><span></span><code><span>while</span> IFS=<span>','</span> <span>read</span> -r old_name new_name || [ -n <span>"<span>$old_name</span>"</span> ]; <span>do</span><br>    <span>if</span> [ -z <span>"<span>$old_name</span>"</span> ] || [ -z <span>"<span>$new_name</span>"</span> ]; <span>then</span><br>        <span>continue</span><br>    <span>fi</span><br>      mv <span>"<span>${old_name}</span>_1.fastq.gz"</span> <span>"<span>${new_name}</span>_S1_L001_R1_001.fastq.gz"</span><br>     mv <span>"<span>${old_name}</span>_2.fastq.gz"</span> <span>"<span>${new_name}</span>_S1_L001_R2_001.fastq.gz"</span><br>    <span>echo</span> <span>"Renamed <span>$old_name</span> files to <span>$new_name</span>"</span><br><span>done</span> &lt; id.txt <br></code></pre><p data-tool="mdnice编辑器">最后拿到了如下所示的文件名字：</p><pre data-tool="mdnice编辑器"><span></span><code>$  ls -lh *gz|cut -d<span>" "</span> -f 5-<br><br>4.9G 2月  24 09:19 PT1_S1_L001_R1_001.fastq.gz<br> 11G 2月  24 09:32 PT1_S1_L001_R2_001.fastq.gz<br> 13G 2月  21 03:54 PT2_S1_L001_R1_001.fastq.gz<br> 13G 2月  21 04:22 PT2_S1_L001_R2_001.fastq.gz<br> 16G 2月  21 05:21 PT3_S1_L001_R1_001.fastq.gz<br> 17G 2月  21 05:41 PT3_S1_L001_R2_001.fastq.gz<br> 11G 2月  21 05:56 PT4_S1_L001_R1_001.fastq.gz<br> 12G 2月  21 06:10 PT4_S1_L001_R2_001.fastq.gz<br>5.0G 2月  21 00:08 PT5_S1_L001_R1_001.fastq.gz<br> 12G 2月  21 00:45 PT5_S1_L001_R2_001.fastq.gz<br> 12G 2月  21 06:25 TT1_S1_L001_R1_001.fastq.gz<br> 12G 2月  21 06:40 TT1_S1_L001_R2_001.fastq.gz<br>9.4G 2月  21 06:53 TT2_S1_L001_R1_001.fastq.gz<br>9.7G 2月  21 07:02 TT2_S1_L001_R2_001.fastq.gz<br> 18G 2月  21 01:45 TT3_S1_L001_R1_001.fastq.gz<br> 18G 2月  21 02:18 TT3_S1_L001_R2_001.fastq.gz<br>5.8G 2月  21 02:29 TT4_S1_L001_R1_001.fastq.gz<br> 13G 2月  21 02:55 TT4_S1_L001_R2_001.fastq.gz<br>4.9G 2月  21 03:06 TT5_S1_L001_R1_001.fastq.gz<br> 11G 2月  21 03:28 TT5_S1_L001_R2_001.fastq.gz<br></code></pre><p data-tool="mdnice编辑器">也就是说，每个样品是2个文件，可以看到，有一些样品它的R1文件是远小于R2文件的，但是有一些样品的1文件和R2文件居然是大小一致的。这些文件名字就是符合要求的了，正常走cellranger的定量流程即可，代码我已经是多次分享了。参考：</p><ul data-tool="mdnice编辑器"><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247512340&amp;idx=3&amp;sn=1b9609a8870a0209dd27ffdcbc3cac87&amp;chksm=9b4bf1afac3c78b90674678fcec66365b9faaa275ff4b0a2255e0a05fa8b905e15222a643bea&amp;scene=21#wechat_redirect" data-linktype="2">10X单细胞转录组原始测序数据的Cell Ranger流程（仅需800元）</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247496813&amp;idx=1&amp;sn=4151bf2265618eff4e0123722c50e569&amp;scene=21#wechat_redirect" data-linktype="2">10X的单细胞转录组原始数据也可以在EBI下载</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247510920&amp;idx=1&amp;sn=c4561d34e984406693c014cdfe236c0f&amp;chksm=9b4beb33ac3c622542d894344c323ff7cca52f69119d02fc7aa4636af0cbe7df4b6c63dd5ba9&amp;scene=21#wechat_redirect" data-linktype="2">一个10x单细胞转录组项目从fastq到细胞亚群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513565&amp;idx=1&amp;sn=092e637017d176c43f00a295d3210592&amp;scene=21#wechat_redirect" data-linktype="2">一文打通单细胞上游：从软件部署到上游分析</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513605&amp;idx=1&amp;sn=e86a329c887745c6d00d3ededa39dcda&amp;chksm=9b4bf6beac3c7fa8523cef4e7189fb20b914460ddb61e6cd1dd520b5928e1b59a8b7827ce783&amp;scene=21#wechat_redirect" data-linktype="2">PRJNA713302这个10x单细胞fastq实战</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513968&amp;idx=1&amp;sn=f5a44a7bea0bdacd8af1a20c177763e5&amp;scene=21#wechat_redirect" data-linktype="2">一次曲折且昂贵的单细胞公共数据获取与上游处理</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514146&amp;idx=1&amp;sn=b9721433d49a2d963eeaab1ad47fc91b&amp;scene=21#wechat_redirect" data-linktype="2">只能下载bam文件的10x单细胞转录组项目数据处理</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247511452&amp;idx=2&amp;sn=83ec97cbc3334a6095e6d63e05e9fd6e&amp;scene=21#wechat_redirect" data-linktype="2">不知道10x单细胞转录组样品和fastq文件的对应关系</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247508521&amp;idx=2&amp;sn=2cf3158e74d37b3a741908d8bfc8f02f&amp;scene=21#wechat_redirect" data-linktype="2">10X单细胞转录组测序数据的 SRA转fastq踩坑那些事</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514395&amp;idx=2&amp;sn=96c505b76ae87dd0efa737c4c44e2270&amp;scene=21#wechat_redirect" data-linktype="2">10x的单细胞转录组fastq文件的R1和R2不能弄混哦</a></section></li></ul><p data-tool="mdnice编辑器">差不多几个小时就可以完成全部的样品的cellranger的定量流程。基础知识非常重要，我们在单细胞天地多次分享过<strong>cellranger</strong>流程的笔记（2019年5月），大家可以自行前往学习，如下：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484146&amp;idx=1&amp;sn=16e09b82d048eed1ff6100b22970abd5&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(一)数据下载</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484179&amp;idx=1&amp;sn=fe84f5243a6021fe6afea128e3ac273a&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(二) cell ranger使用前注意事项</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484206&amp;idx=1&amp;sn=edeebbdd092f79361aee87e9ce086d80&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(三) Cell Ranger使用初探</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484355&amp;idx=1&amp;sn=7860fe0c46073a55d2d3700822c3103b&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(四) Cell Ranger流程概览</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484402&amp;idx=1&amp;sn=95c2be0dc6499e4b1eb9a91d79e584d1&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(五) 理解cellranger count的结果</a></section></li></ul><p data-tool="mdnice编辑器">接下来我们就常规的跑一下它：</p><pre data-tool="mdnice编辑器"><span></span><code>bin=/home/jmzeng/x10/pipeline/cellranger-6.1.2/bin/cellranger<br><span># db=/home/bakdata/x10/pipeline/refdata-gex-mm10-2020-A </span><br>db=/home/jmzeng/x10/pipeline/refdata-gex-GRCh38-2020-A<br>ls <span>$bin</span>; ls <span>$db</span><br>fq_dir=/home/jmzeng/x10/jmzeng/hcc_patients_PRJNA793914/asp/raw <br><span>$bin</span> count --id=<span>$1</span> \<br>--localcores=4 \<br>--transcriptome=<span>$db</span> \<br>--fastqs=<span>$fq_dir</span> \<br>--sample=<span>$1</span>   \<br>--expect-cells=5000<br></code></pre><p data-tool="mdnice编辑器">有意思的是，上面的10个样品我同一时间（2024-02-24 09:33:21）开始运行cellranger的定量流程，但是大家的耗时其实是不一样的：</p><pre data-tool="mdnice编辑器"><span></span><code>log.cellranger.0.txt:2024-02-24 13:12:44 Shutting down.<br>log.cellranger.1.txt:2024-02-24 18:19:43 Shutting down.<br>log.cellranger.2.txt:2024-02-24 19:43:29 Shutting down.<br>log.cellranger.3.txt:2024-02-24 17:07:41 Shutting down.<br>log.cellranger.4.txt:2024-02-24 13:20:12 Shutting down.<br>log.cellranger.5.txt:2024-02-24 19:56:38 Shutting down.<br>log.cellranger.6.txt:2024-02-24 16:24:52 Shutting down.<br>log.cellranger.7.txt:2024-02-24 19:09:46 Shutting down.<br>log.cellranger.8.txt:2024-02-24 13:40:30 Shutting down.<br>log.cellranger.9.txt:2024-02-24 13:04:43 Shutting down.<br></code></pre><p data-tool="mdnice编辑器">也就是说有4个样品是三个半小时就跑完了cellranger的定量流程，但是另外的6个样品基本上耗时10个小时。区别在于有一些样品它的R1文件是远小于R2文件的，但是有一些样品的1文件和R2文件是大小一致的，是因为这些样品的fastq文件并没有在r1文件被trim，我们可以看2022的一个文章的示意图（The <em>cellBC</em> and UMI assigned Nanopore reads (median 28,120 /<em>cell</em>) reflect a median of 2427 genes and 6047 UMIs per <em>cell</em> with a good ）详见：https://www.nature.com/articles/s41467-020-17800-6：</p><p><img data-galleryid="" data-imgfileid="100000544" data-ratio="1.0851851851851853" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wyCjwaGbaIqcd245zIeBv2PDhYcT1R9EJERQ5sKK58taRT2uoC6MG7W0PWIg8TqsQfoiaYXy41bp0Q/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wyCjwaGbaIqcd245zIeBv2PDhYcT1R9EJERQ5sKK58taRT2uoC6MG7W0PWIg8TqsQfoiaYXy41bp0Q/640?wx_fmt=jpeg&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>官网示意图</figcaption></figure></section><p><span></span><br></p><p><span></span></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/_ozxLuDixsqQt-HudRuZaQ",target="_blank" rel="noopener noreferrer">原文链接</a>
