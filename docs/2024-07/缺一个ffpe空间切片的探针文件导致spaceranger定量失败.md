---
title: "缺一个ffpe空间切片的探针文件导致spaceranger定量失败"
date: 2024-07-22T08:00:59Z
draft: ["false"]
tags: [
  "fetched",
  "珠海健明生物医药科技"
]
categories: ["Acdemic"]
---
缺一个ffpe空间切片的探针文件导致spaceranger定量失败 by 珠海健明生物医药科技
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>前面我们演示了：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528608&amp;idx=2&amp;sn=eea4e9047d4710baf967c78389259a09&amp;scene=21#wechat_redirect" data-linktype="2">10x技术空间单细胞上游定量案例分享（E-MTAB-12043）</a>，但是spaceranger定量失败。幸运的是很多懂行的小伙伴留言指出来了问题所在， 就是缺一个ffpe空间切片的探针文件。<strong>探针文件对于spaceranger的定量过程至关重要，因为spaceranger需要知道哪些探针与哪些转录本相关联，以便对空间位置上的RNA进行定量。</strong></p></blockquote><p data-tool="mdnice编辑器">可以看到，官网上面说了它是 Input for spaceranger count pipeline</p><ul data-tool="mdnice编辑器"><li><section>https://cf.10xgenomics.com/supp/spatial-exp/probeset/Visium_Human_Transcriptome_Probe_Set_v1.0_GRCh38-2020-A.csv</section></li></ul><p data-tool="mdnice编辑器">还是同样的代码即可，每个样品对应的fastq文件如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>$  ls -lh *gz|cut -d<span>" "</span> -f 5-<br><br>1.1G 3月   4 21:33 Sample1_S1_L001_R1_001.fastq.gz<br>1.6G 3月   4 01:21 Sample1_S1_L001_R2_001.fastq.gz<br>1.2G 3月   4 04:02 Sample1_S2_L001_R1_001.fastq.gz<br>1.7G 3月   4 04:07 Sample1_S2_L001_R2_001.fastq.gz<br>1.2G 3月   4 02:48 Sample1_S3_L001_R1_001.fastq.gz<br>1.8G 3月   4 02:53 Sample1_S3_L001_R2_001.fastq.gz<br>1.1G 3月   4 02:56 Sample1_S4_L001_R1_001.fastq.gz<br>1.7G 3月   4 03:01 Sample1_S4_L001_R2_001.fastq.gz<br></code></pre><p data-tool="mdnice编辑器">写一个脚本文本文件（ run_sapceranger.sh ），如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#! /bin/bash -xe</span><br><span>##</span><br>bin=/home/jmzeng/x10/pipeline/spaceranger-2.1.1/spaceranger<br>db=/home/jmzeng/x10/pipeline/refdata-gex-GRCh38-2020-A<br>ls <span>$bin</span> <span>$db</span> <br>fq_dir=<span>${2}</span><br>/usr/bin/time -v <span>$bin</span> count --id=<span>${1}</span> \<br>--transcriptome=<span>$db</span> \<br>--fastqs=<span>$fq_dir</span> \<br>--probe-set=./Visium_Human_Transcriptome_Probe_Set_v1.0_GRCh38-2020-A.csv \<br>--sample=<span>${1}</span> \<br>--image=<span>${3}</span> \<br>--unknown-slide visium-1 \<br>--localcores=2 \<br>--localmem=80<br></code></pre><p data-tool="mdnice编辑器">上面的脚本文本文件（ run_sapceranger.sh ），可以接受3个参数，包括样品的fastq格式的测序数据文件前缀，样品的fastq格式的测序数据文件所在的文件夹路径，以及样品的图片。我们来运行第一个样品，就是单个样品跑上面的脚本文本文件（ run_sapceranger.sh ）的代码：</p><pre data-tool="mdnice编辑器"><span></span><code> nohup bash run_sapceranger.sh  Sample1  \<br>./rawdata    \<br>./Sample1.tif  \ <br>1&gt;log_Sample1.txt 2&gt;&amp;1 &amp;<br></code></pre><p data-tool="mdnice编辑器">我们是多个样品有规则的文件，所以可以写一个批处理：</p><pre data-tool="mdnice编辑器"><span></span><code><span>for</span> i <span>in</span> {1..7}; <span>do</span><br>    nohup bash run_sapceranger.sh <span>"Sample<span>${i}</span>"</span> ./rawdata <span>"./Sample<span>${i}</span>.tif"</span> 1&gt; <span>"log_Sample<span>${i}</span>.txt"</span> 2&gt;&amp;1 &amp;<br><span>done</span><br></code></pre><p data-tool="mdnice编辑器">当然了，这一切代码成功运行的前提是，文件是齐全并且完整的，空间单细胞转录组需要图片和fastq文件哦！这些文件都很大， 所以很容易下载失败，详见：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528470&amp;idx=1&amp;sn=246dfa88fac7c413ca102f2db676a515&amp;scene=21#wechat_redirect" data-linktype="2">aspera的高速下载确实很快吗</a>。</p><p data-tool="mdnice编辑器">这次是成功了，依然是根据前面演示的代码进行文件夹整理：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528608&amp;idx=2&amp;sn=eea4e9047d4710baf967c78389259a09&amp;scene=21#wechat_redirect" data-linktype="2">10x技术空间单细胞上游定量案例分享（E-MTAB-12043）</a>，如下所示我们成功的案例是：</p><p><img data-galleryid="" data-imgfileid="100045339" data-ratio="0.8305555555555556" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx7K49UwA4wy7vEc3PHMBrdlzxLZftfLBWX4vdVztkIAN6D49rSQCbicon9v68OyR3kmUEPicf65sLA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx7K49UwA4wy7vEc3PHMBrdlzxLZftfLBWX4vdVztkIAN6D49rSQCbicon9v68OyR3kmUEPicf65sLA/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">也就是说，仅仅是引入了一个 探针的csv文件，定量代码就ok了，这个探针文件如下所示；</p><p><img data-galleryid="" data-imgfileid="100045338" data-ratio="0.9787037037037037" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx7K49UwA4wy7vEc3PHMBrdsic9U2KAqtq6kTjf0CElNIHibGmXUdPHLtFW3V13TlamzLXVb9gelAdg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx7K49UwA4wy7vEc3PHMBrdsic9U2KAqtq6kTjf0CElNIHibGmXUdPHLtFW3V13TlamzLXVb9gelAdg/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">如果没有指定这个探针文件，就会失败了，如下所示是一个失败的案例：</p><p><img data-galleryid="" data-imgfileid="100045340" data-ratio="0.8592592592592593" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx7K49UwA4wy7vEc3PHMBrdRjOr2DfWsGml2WUTzlptSPpUx57ZwE00P12lKqiaNbENUficnTwLEAyw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx7K49UwA4wy7vEc3PHMBrdRjOr2DfWsGml2WUTzlptSPpUx57ZwE00P12lKqiaNbENUficnTwLEAyw/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">值得一提的是，<span>之前我们复现另外一个文章的时候，也是从fastq文件开始， 走spaceranger定量流程，详情请见：</span><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247519964&amp;idx=1&amp;sn=93af7c5c9e27279b0ddbefafad3ee782&amp;scene=21#wechat_redirect" data-linktype="2">空间单细胞的上游定量流程（spaceranger，10x技术）</a><span>，它就不需要同样的探针csv文件啦。</span></p></section><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528328&amp;idx=1&amp;sn=33055906f1dca6958238a84b48405cd5&amp;chksm=9b4b2f33ac3ca6255cdf3d9e1422c6610aebd2fdece36ea0bd9d1cf838cbf1521b599ae81abe&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授‍课（买一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528133&amp;idx=1&amp;sn=2fc6bf3e8455222628c9814d6509c74f&amp;chksm=9b4b2e7eac3ca7687d2f12b37fa48bfe1b060b3c204df87dbf6e277321cfaeb8f5e4d283ca1e&amp;scene=21#wechat_redirect" textvalue="月薪两万找生信练习生（线下）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">月薪两万找生信练习生（线下）</a><br></section></li><li><section> <a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;chksm=9b4b2f10ac3ca606c1c4bac8cf112bb9b0f18e3c4262f5f2b8c0dba3bfedf2ba201507247005&amp;scene=21#wechat_redirect" textvalue="2024的共享服务器交个朋友福利价仍然是800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">2024的共享服务器交个朋友福利价仍然是800</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">千呼万唤始出来的独享生物信息学云服务器</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528144&amp;idx=1&amp;sn=be4d7e542d1077921024c86a4c130f16&amp;chksm=9b4b2e6bac3ca77d87a0ae0c12ae028d10225db19c8d7fb92b1299fa12f572bb769bcd92889b&amp;scene=21#wechat_redirect" textvalue="永久免费的生信进阶培训（线下）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">永久免费的生信进阶培训（线下）</a></section></li></ul><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/bWifFd4unGYyEToZnVWdKg",target="_blank" rel="noopener noreferrer">原文链接</a>
