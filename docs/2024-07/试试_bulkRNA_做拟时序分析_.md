---
title: "试试 bulkRNA 做拟时序分析？"
date: 2024-07-07T15:53:13Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
试试 bulkRNA 做拟时序分析？ by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><section><mp-common-profile data-pluginname="mpprofile" data-id="MzkyMTI1MTYxNA==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezgsqIGqjITSMggCTSoViaYeoKe2xoZr1IIvNJoztibQxibYHLDDoiabwAc6Ggws3Tvdo8EPss2nLgaVQ/0?wx_fmt=png" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-from="0" data-is_biz_ban="0"></mp-common-profile></section></section><section><mp-common-clmusic data-pluginname="insertaudio" type="1" music_name="学不会" albumurl="http://wx.y.gtimg.cn/music/photo_new/T002R500x500M000002PQCmo2azasb_1.jpg" singer="林俊杰" duration="229000" username="" music_source="1" is_vip="1" listenid="78221544432097152"></mp-common-clmusic></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>引言</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p>最近看到一篇推文 <strong><a href="https://mp.weixin.qq.com/s?__biz=Mzg2NjAyNTE1OQ==&amp;mid=2247484318&amp;idx=1&amp;sn=f99ed97557431ea6a2c6b6a47a06ea40&amp;scene=21#wechat_redirect" data-linktype="2">普通的 Bulk 转录组也能做“拟时序”分析吗？</a></strong> 。觉得挺有意思，已经有三篇文献作为 <strong>bulk</strong> 拟时序的分析参考来源，去看看最初的文献思路方法如下：</p></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100030228" data-ratio="0.203125" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2c3TgscgE4iawmtgiaHMmG2TTUGxV9OuCiaEfTiciacxYcBwsOJWE1edasDg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="832" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2c3TgscgE4iawmtgiaHMmG2TTUGxV9OuCiaEfTiciacxYcBwsOJWE1edasDg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>什么是 bulk 拟时序？(来自上面推文)</strong></p><blockquote data-tool="mdnice编辑器"><span>❝</span><p>但是在 bulk 转录组中，拟时序的对象不再是细胞，而是基因（严格意义上来说，不清楚这种分析是否也能被称为拟时序分析，在本文中暂且将其称为拟时序分析）。在 bulk 转录组中，一般只有少数样本，最多可能 20-30 个样本点，其分辨率远远达不到单细胞转录组中的几千甚至上万个细胞的分辨率（在单细胞转录组中，1 个细胞即可被认为是一个样本点）。因此用 bulk 转录组进行拟时序分析时，首先需要将少数几个样本点变成 500 或者更多个样本点，这样才能更好地根据基因表达的峰值的时间点来对基因表达的先后顺序进行排序，进而得到“拟时序”的基因。</p><ul><li><section>恰好上面推文对过程进行了代码探索，这里对他的工作进行<strong>优化和整理，做成一个包来进行分享也是不错的。</strong> 感谢分享。</section></li></ul></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><strong>分析思路：</strong></p><ul data-tool="mdnice编辑器"><li><section><strong>Step1：</strong>对样本点进行 PCA 分析，并通过 PC1 和 PC2 计算样本点之间的欧式距离获得时间线，最终将时间线缩放到 0-10 之间。</section></li><li><section><strong>Step2：</strong>利用 modelr 中的 loess 函数，根据新时间线，产生时间点的表达值。</section></li><li><section><strong>Step3：</strong>利用 atan2 函数对基因表达进行排序，定义基因表达的先后顺序。</section></li></ul><h2 data-tool="mdnice编辑器"><span></span><span>安装</span><span></span></h2><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("devtools")</span><br>devtools::install_github(<span>"junjunlab/bulkPseudotime"</span>)<br><br><span># or</span><br>remotes::install_github(<span>"junjunlab/bulkPseudotime"</span>)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>介绍</span><span></span></h2><p data-tool="mdnice编辑器">输入数据还是标准化的 <strong>tpm/fpkm</strong> 类似的表达值：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(bulkPseudotime)<br><span>library</span>(ClusterGVis)<br><br><span># load test data</span><br>data(exps)<br><br><span># check</span><br>head(exps,<span>3</span>)<br><span>#           zygote  t2.cell  t4.cell  t8.cell   tmorula blastocyst</span><br><span># Oog4   1.3132282 1.237078 1.325978 1.262073 0.6549312  0.2067114</span><br><span># Psmd9  1.0917337 1.315989 1.174417 1.064756 0.8685598  0.4845448</span><br><span># Sephs2 0.9859232 1.201026 1.123076 1.084673 0.8878931  0.7174088</span><br></code></pre><p data-tool="mdnice编辑器">一个 <strong>bulkPseudotime</strong> 即可完成所有分析，输出一个 <strong>bulkPseudotimeClass</strong> 对象：</p><pre data-tool="mdnice编辑器"><span></span><code>psetime_res &lt;- bulkPseudotime(expMat = exps)<br></code></pre><p data-tool="mdnice编辑器">数据组成：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100030227" data-ratio="0.42138364779874216" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2j00ibpHnAJRwmicmOMg2BjzkQYWOnoUK1KeJ3dO0Cm4ibLfsJuK9MJkAg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="795" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2j00ibpHnAJRwmicmOMg2BjzkQYWOnoUK1KeJ3dO0Cm4ibLfsJuK9MJkAg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">查看样本间的距离热图：</p><pre data-tool="mdnice编辑器"><span></span><code>psetime_res@sample_dist_plot<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030230" data-ratio="0.8206896551724138" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2YnmbsHbiceX74EMHWYv7T6tD37GkfVS7FBm7jFFnEdj5ibDqHnzEdD6Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="580" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2YnmbsHbiceX74EMHWYv7T6tD37GkfVS7FBm7jFFnEdj5ibDqHnzEdD6Q/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">查看<strong>原始 PCA 分布</strong>和<strong>拟合产生的新的 PCA 分布</strong>：</p><pre data-tool="mdnice编辑器"><span></span><code>psetime_res@sample_pca_plot<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030229" data-ratio="0.7293729372937293" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2bzicibf1wVZObITiaTnKEZJtb8Fn0Dx8oIjibl7M2tZdw10zeQ9ibricxI9Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="606" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2bzicibf1wVZObITiaTnKEZJtb8Fn0Dx8oIjibl7M2tZdw10zeQ9ibricxI9Q/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">可以看到趋势还是很相近的，符合细胞分化的时间点。</p><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">查看排序组合的拟时序热图（4 种排列组合）：</p><pre data-tool="mdnice编辑器"><span></span><code>psetime_res@heatmap_list_group<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030231" data-ratio="0.5931372549019608" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j201YKSAWPYeOVkbv8npuIvO6NsOvOFNHd8FAElBcjqEHxkkIKoz1FIQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="816" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j201YKSAWPYeOVkbv8npuIvO6NsOvOFNHd8FAElBcjqEHxkkIKoz1FIQ/640?wx_fmt=png&amp;from=appmsg"></figure><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><strong>pseudotime_heatmap</strong> 可以针对选择的特定排序拟时序热图进行重新绘制，<strong>order</strong> 指定顺序，这里我们选择排序结果 1：</p><pre data-tool="mdnice编辑器"><span></span><code>pseudotime_heatmap(object = psetime_res,order = <span>1</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030233" data-ratio="1.1666666666666667" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2ibURVeq2wPKTyJTqjebtzduic7OypxPmxalwDGCQ5ca9Y9rBKwnw9KPg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="570" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2ibURVeq2wPKTyJTqjebtzduic7OypxPmxalwDGCQ5ca9Y9rBKwnw9KPg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">标记一些基因名：</p><pre data-tool="mdnice编辑器"><span></span><code>mark &lt;- sample(rownames(exps),<span>10</span>,replace = <span>F</span>)<br><br>pseudotime_heatmap(object = psetime_res,<br>                   order = <span>1</span>,<br>                   markGenes = mark)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030232" data-ratio="1.1751313485113835" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j28ZexCVm1xiczicavibEUlQGd6rGUkRruynmldF9icjgVUl6snibmictqJtuw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="571" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j28ZexCVm1xiczicavibEUlQGd6rGUkRruynmldF9icjgVUl6snibmictqJtuw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>heatmap_params</strong> 用来提供 <strong>comlexheatmap::Heatmap</strong> 的参数：</p><pre data-tool="mdnice编辑器"><span></span><code>pseudotime_heatmap(object = psetime_res,<br>                   order = <span>1</span>,<br>                   markGenes = mark,<br>                   heatmap_params = list(km = <span>3</span>,cluster_rows = <span>T</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030234" data-ratio="1.1713286713286712" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2koT9fM7SCKfLBnEiaeBAD47gx5Bcxs68EcRaibibvJ84UibnspPIRo2nog/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="572" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2koT9fM7SCKfLBnEiaeBAD47gx5Bcxs68EcRaibibvJ84UibnspPIRo2nog/640?wx_fmt=png&amp;from=appmsg"></figure><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><strong>pseudotime_line</strong> 绘制基因的拟时序曲线：</p><pre data-tool="mdnice编辑器"><span></span><code>genes &lt;- sample(rownames(exps),<span>6</span>,replace = <span>F</span>)<br><br>pseudotime_line(object = psetime_res,genes = genes)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030235" data-ratio="0.535840188014101" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2PcqwDrJuXicXSPu95BrMrH41lTQYUKqtYhibVeGJPiahCWkfcGRxMkAUg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="851" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2PcqwDrJuXicXSPu95BrMrH41lTQYUKqtYhibVeGJPiahCWkfcGRxMkAUg/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>结尾</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong>路漫漫其修远兮,吾将上下而求索。</strong></p></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">欢迎加入生信交流群。加我微信我也拉你进 <strong>微信群聊</strong> <strong>老俊俊生信交流群</strong> <strong>(微信交流群需收取 20 元入群费用,一旦交费,拒不退还!(防止骗子和便于管理))</strong> 。QQ 群可免费加入, 记得进群按格式修改备注哦。</p><section data-tool="mdnice编辑器"><section><p><strong>老俊俊微信：</strong></p><figure><img data-imgfileid="100030236" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j24yawibpibnAYtWHpjia6qRA73c3icUrkyf0Yg5GibfzjYoDowZdiaGZEJVWw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="430" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j24yawibpibnAYtWHpjia6qRA73c3icUrkyf0Yg5GibfzjYoDowZdiaGZEJVWw/640?wx_fmt=png&amp;from=appmsg"></figure><figure><img data-imgfileid="100030240" data-ratio="1.3668430335097002" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2JWplpSWeI0vkTQBVEu8RAoiafviawkaQsHW93APiblDWCQew7h1qPcvSg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="567" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useykcpgvErdhcZiapaxeIa2j2JWplpSWeI0vkTQBVEu8RAoiafviawkaQsHW93APiblDWCQew7h1qPcvSg/640?wx_fmt=png&amp;from=appmsg"></figure></section><section><p><strong>知识星球：</strong></p><figure><img data-imgfileid="100030239" data-ratio="1.5896226415094339" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4useykcpgvErdhcZiapaxeIa2j2QEDk4VHLSrvrN0AIoiaVt9yH8Ev1Z4fgf8xvLgyMx0WhHW8hnPzyhKw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1060" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4useykcpgvErdhcZiapaxeIa2j2QEDk4VHLSrvrN0AIoiaVt9yH8Ev1Z4fgf8xvLgyMx0WhHW8hnPzyhKw/640?wx_fmt=jpeg&amp;from=appmsg"></figure></section></section><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><strong></strong></p><center data-tool="mdnice编辑器"><strong> 往期回顾目录</strong></center><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong></strong></p><center><strong><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513809&amp;idx=1&amp;sn=05eb04b579b04ff5b20f3cab2f52406a&amp;chksm=c1848ca0f6f305b6005b1f9853a79843be0e582f7519c234350a6b22b81f7d07f5d749dbe87b&amp;token=350392803&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ClusterGVis 绘制 lineplot 的优化</a></strong></center><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513792&amp;idx=1&amp;sn=b71dffea7f6dd9ad8acaec98ee99678c&amp;chksm=c1848cb1f6f305a7c85b54cbc9f40e2aaffefbc119654d533cd0aef2480eda6e7946295d5008&amp;token=1799964631&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">RNAseqQC 给你的数据来个全面的 QC 检查</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513652&amp;idx=1&amp;sn=4750e40c39e055b0b8b6dae51d70c620&amp;chksm=c1848c45f6f30553044afacb5ea3544afd63287fd90f60858859b873db060019a569208590e9&amp;token=1799964631&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">如何 Pull Request 到 github 贡献你的代码</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513591&amp;idx=2&amp;sn=24c65a23ae46dfd31757b8e5a4c5908d&amp;chksm=c1848f86f6f30690024b4d74a8a4beadd5a4691ee30df9287ed42b24a9e1fd42f531adecde9e&amp;token=1130224323&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ggplot 添加分类型数据双坐标轴</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513571&amp;idx=1&amp;sn=65c28c7798caee6a68208c7f8c50cc2b&amp;chksm=c1848f92f6f3068409d1036f0b038d7d127cee7c897138b12ddc34dc13f7b019136342582d86&amp;token=1130224323&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">富集分析流星图?</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513557&amp;idx=1&amp;sn=0fdca9269c6def6c32006d1e8c29ac75&amp;chksm=c1848fa4f6f306b2fa7365b1cca4ea609ff0a3b11f1cdd1ca3badc9a4296ed636064fda727da&amp;token=1130224323&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">关于 ggplot2 分面的几点建议及补充</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513497&amp;idx=1&amp;sn=099c2c64ad62fbd0cfed434cf6c9efe6&amp;chksm=c1848fe8f6f306fe1a50d1c1e40edaad3b22940d5be76b87a78d3cf6b31d593d144c66a82640&amp;token=1130224323&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">关于 footprint 可视化总结</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513431&amp;idx=1&amp;sn=3817318720a1e6dec2274a9a5fdcabd9&amp;chksm=c1848f26f6f30630827c14c6ca2be924431b0f3844b28643a5d2880237774770d457e9c563f3&amp;token=1097809733&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">facet_sub 为 ggplot2 添加子图</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513411&amp;idx=1&amp;sn=bf63f98e52053ad1c150fa6e3772ba28&amp;chksm=c1848f32f6f30624f6d20e7a19a6d7844f35875938d6554ebc835f900c0a58e5ed72106d1d44&amp;token=1097809733&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">单细胞小提琴图添加注释标明细胞类型</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513387&amp;idx=1&amp;sn=13cb381408b3617b4fa4fb8f2b6a6b11&amp;chksm=c1848f5af6f3064c3159a7d7d3ce762fdca06a5699937ce747e9aa58ac9a23e3e5860b0e665a&amp;token=1953734631&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">蛋白序列无序区预测</a></center></strong><p><br></p></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/iYpS96rNgzs4B-DpCo8wgA",target="_blank" rel="noopener noreferrer">原文链接</a>
