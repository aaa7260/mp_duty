---
title: "oncoPredict：根据细胞系筛选数据预测体内或癌症患者药物反应和生物标志物"
date: 2024-07-26T23:46:49Z
draft: ["false"]
tags: [
  "fetched",
  "生信方舟"
]
categories: ["Acdemic"]
---
oncoPredict：根据细胞系筛选数据预测体内或癌症患者药物反应和生物标志物 by 生信方舟
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">在14年的时候，oncoPredict函数的开发团队在Genome Biology上发了一篇文章。</p><p data-tool="mdnice编辑器"><img data-imgfileid="100000894" data-ratio="0.36363636363636365" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFia0HzvqkYbnoePKhlFEcSjOdxcvIclnTLJiaPia5Spc7HIictbOmtiaIu1j0vv7OQeJB3ddcWicRDJuIQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="715" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFia0HzvqkYbnoePKhlFEcSjOdxcvIclnTLJiaPia5Spc7HIictbOmtiaIu1j0vv7OQeJB3ddcWicRDJuIQ/640?wx_fmt=png&amp;from=appmsg">这篇文章的核心目的是阐释了使用治疗前基线肿瘤基因表达数据去预测患者化疗反应。开发团队发现使用细胞系去预测临床样本的药物反应是可行的。</p><p data-tool="mdnice编辑器">鉴于之前的理论，该研究团队首先提出了pRRophetic算法用于评价不同药物治疗临床样本的敏感性。</p><p data-tool="mdnice编辑器"><img data-imgfileid="100000897" data-ratio="0.323037323037323" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFia0HzvqkYbnoePKhlFEcSjOne8EcZcMCAxL6EsUshdtDo9pIxNdfEH8XUrkUjo79s20NorCUAHGA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="777" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFia0HzvqkYbnoePKhlFEcSjOne8EcZcMCAxL6EsUshdtDo9pIxNdfEH8XUrkUjo79s20NorCUAHGA/640?wx_fmt=png&amp;from=appmsg">之后再原有的基础之上，该研究团队提出了R包oncoPredict。</p><p data-tool="mdnice编辑器"><img data-imgfileid="100000895" data-ratio="0.38239757207890746" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFia0HzvqkYbnoePKhlFEcSjWIqg7A6miaANNKGf8NDKfQJ0OaPYdFggtsQlFHibemtvBnGRaHCQ4MyA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="659" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFia0HzvqkYbnoePKhlFEcSjWIqg7A6miaANNKGf8NDKfQJ0OaPYdFggtsQlFHibemtvBnGRaHCQ4MyA/640?wx_fmt=png&amp;from=appmsg">该R包的优势主要有两个，分别是预测患者的临床药物反应和将这些预测与临床特征关联起来从而发现有价值的生物标志物。</p><p data-tool="mdnice编辑器"><img data-imgfileid="100000892" data-ratio="0.42244224422442245" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFia0HzvqkYbnoePKhlFEcSjhFlneVHl1hpFRJgC9hs4iaPtFqPwATvqlLp7wOnxHOSSdTIFvcibWURA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="606" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFia0HzvqkYbnoePKhlFEcSjhFlneVHl1hpFRJgC9hs4iaPtFqPwATvqlLp7wOnxHOSSdTIFvcibWURA/640?wx_fmt=png&amp;from=appmsg">其中使用最多的就是去预测患者的临床药物反应，其中的函数是calcPhenotype，这个功能是使用基线肿瘤基因表达数据，实现了预测临床药物反应。该函数使用了大规模基因表达和药物筛选数据(训练数据集)来构建了Ridge regression模型，然后将其应用于新的基因表达数据集(测试数据集)，以产生新的药物敏感性分析结果。</p><p data-tool="mdnice编辑器">开发团队也提示使用者除了可以用他们预打包的GDSC或CTRP数据作为训练数据集，也可以使用自己的训练数据从而预测任何表达矩阵情况下的药物反应。</p><p data-tool="mdnice编辑器">在使用该分析流程之前，需要去https://osf.io/c6tfx/ 下载DataFile文件夹下作者准备好的数据，用作药物预测的训练集。</p><p data-tool="mdnice编辑器"><img data-imgfileid="100000898" data-ratio="0.49166666666666664" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFia0HzvqkYbnoePKhlFEcSjlL5fxOMZC9LClSKQMf80c7c307kGsdqBBTzV9MFicGeZe1bUVHYWVtg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFia0HzvqkYbnoePKhlFEcSjlL5fxOMZC9LClSKQMf80c7c307kGsdqBBTzV9MFicGeZe1bUVHYWVtg/640?wx_fmt=png&amp;from=appmsg">这里边有两个重要的数据库的数据，分别是CTRP和GDSC。</p><p data-tool="mdnice编辑器">CTRP全称是癌症治疗反应门户(https://portals.broadinstitute.org/ctrp/)，其通过连接癌细胞系的基因、家族以及其他细胞特征与小分子药物敏感性信息进而加速与患者相匹配的癌症治疗药物的发现。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100000900" data-ratio="0.30925925925925923" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFia0HzvqkYbnoePKhlFEcSjribh4sgajKPcgIGNnUSdiaEKO82icic1QdL09b4tfLRf0sjgMxaSqJuFeQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFia0HzvqkYbnoePKhlFEcSjribh4sgajKPcgIGNnUSdiaEKO82icic1QdL09b4tfLRf0sjgMxaSqJuFeQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">GDSC全称是癌症药物敏感性基因组学数据库(https://www.cancerrxgene.org/)，该数据库时关于癌症细胞药物敏感性和分子标志物信息的最大公共数据库之一，该数据库整合了细胞、药物和分子的三个不同层次，阐述了不同肿瘤细胞对药物的敏感性。</p><h3 data-tool="mdnice编辑器"><span></span>分析步骤<span></span></h3><h4 data-tool="mdnice编辑器"><span></span>1、加载R包和数据<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br><span>library</span>(oncoPredict)<br><span>library</span>(data.table)<br><span>library</span>(gtools)<br><span>library</span>(reshape2)<br><span>library</span>(ggpubr)<br><span>library</span>(openxlsx)<br><br>dir.create(<span>"onco_drug"</span>)<br>setwd(<span>"onco_drug"</span>)<br><br>dir=<span>'~/Training Data/'</span><br>dir(dir)<br><br><span># [1] "CTRP2_Expr (RPKM, not log transformed).rds"         </span><br><span># [2] "CTRP2_Expr (TPM, not log transformed).rds"          </span><br><span># [3] "CTRP2_Res.rds"                                      </span><br><span># [4] "GDSC1_Expr (RMA Normalized and Log Transformed).rds"</span><br><span># [5] "GDSC1_Res.rds"                                      </span><br><span># [6] "GDSC2_Expr (RMA Normalized and Log Transformed).rds"</span><br><span># [7] "GDSC2_Res.rds"</span><br></code></pre><h4 data-tool="mdnice编辑器"><span></span>2、选择训练集数据<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span># GDSC2数据</span><br><span>#exp = readRDS(file=file.path(dir,'GDSC2_Expr (RMA Normalized and Log Transformed).rds'))</span><br><span>#exp[1:4,1:4]</span><br><span>#dim(exp)</span><br><span>#drug = readRDS(file = file.path(dir,"GDSC2_Res.rds"))</span><br><span>#drug &lt;- exp(drug) #下载到的数据是被log转换过的，用这句代码逆转回去</span><br><span>#drug[1:4,1:4]</span><br><span>#dim(drug)</span><br><span>#identical(rownames(drug),colnames(exp))</span><br><br><span>#CTRP2数据</span><br>exp &lt;- readRDS(file = file.path(dir,<span>"CTRP2_Expr (TPM, not log transformed).rds"</span>))<br>exp[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>dim(exp)<br>drug &lt;- readRDS(file = file.path(dir,<span>"CTRP2_Res.rds"</span>))<br>drug[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>identical(rownames(drug),colnames(exp))<br></code></pre><p data-tool="mdnice编辑器">两个数据库的数据都可以使用，CTRP2中的数据会多一点。</p><p data-tool="mdnice编辑器">drug是药物IC50值，exp是对应细胞系基因的表达矩阵。</p><h4 data-tool="mdnice编辑器"><span></span>3、导入表达矩阵数据并进行分析-这一步会耗费很长时间<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>load(<span>"~/TCGA-LIHC_sur_model.Rdata"</span>)<br>test = exprSet<br><br>calcPhenotype(trainingExprData = exp,<br>                trainingPtype = drug,<br>                testExprData = test,<br>                batchCorrect = <span>'standardize'</span>,  <span>#   "eb" for array,standardize  for rnaseq</span><br>                powerTransformPhenotype = <span>TRUE</span>,<br>                removeLowVaryingGenes = <span>0.2</span>,<br>                minNumSamples = <span>10</span>, <br>                printOutput = <span>TRUE</span>, <br>                removeLowVaringGenesFrom = <span>'rawData'</span> )<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>4、查看结果<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span># 运行之后的结果，被存在固定文件夹calcPhenotype_Output下。文件名也是固定的DrugPredictions.csv。</span><br>testPtype &lt;- read.csv(<span>'./calcPhenotype_Output/DrugPredictions.csv'</span>, <br>                      row.names = <span>1</span>,check.names = <span>F</span>)<br>testPtype[<span>1</span>:<span>4</span>, <span>1</span>:<span>4</span>]<br>dim(testPtype)<br>identical(colnames(testPtype),colnames(drug))<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>5、结合高低风险分组画图<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span># 需参照这个代码自行修改哦~ </span><br><br>load(<span>"~/model_parameters.Rdata"</span>)<br>TCGA_LIHC &lt;- rs[[<span>1</span>]]<br>identical(rownames(TCGA_LIHC),colnames(exprSet))<br>TCGA_LIHC$group &lt;- ifelse(TCGA_LIHC$RS &gt; median(TCGA_LIHC$RS),<span>"high"</span>,<span>"low"</span>)<br>TCGA_LIHC$group &lt;- factor(TCGA_LIHC$group,levels = c(<span>"low"</span>,<span>"high"</span>))<br>rsurv &lt;- TCGA_LIHC<br><br><br>identical(rownames(testPtype),rownames(rsurv))<br>a = apply(testPtype, <span>2</span>, <span>function</span>(x){<br>  <span>#x = testPtype[,1]</span><br>   wilcox.test(x~rsurv$group)$p.value<br>})<br>head(a)<br><span>#p值最小的10个药物</span><br>dg = names(head(sort(a),<span>10</span>))<br><br><span>library</span>(tinyarray)<br><span>library</span>(tidyr)<br><span>library</span>(dplyr)<br><span>library</span>(ggplot2)<br><span>library</span>(ggpubr)<br><span>library</span>(ggsci)<br><br>group &lt;- rsurv$group<br>testPtype[,dg] %&gt;% <br>  bind_cols(group = group) %&gt;% <br>  pivot_longer(<span>1</span>:<span>10</span>,names_to = <span>"drugs"</span>,values_to = <span>"ic50"</span>)  %&gt;% <br>ggplot(., aes(group,ic50))+<br>  geom_boxplot(aes(fill=group))+<br>  scale_fill_jama()+<br>  theme(axis.text.x = element_text(angle = <span>45</span>,hjust = <span>1</span>),<br>        axis.title.x = element_blank(),<br>        legend.position = <span>"none"</span>)+<br>  facet_wrap(vars(drugs),scales = <span>"free_y"</span>,nrow = <span>2</span>)+<br>  stat_compare_means()+<br>  theme_bw()<br>ggsave(<span>"box_drug.pdf"</span>,width = <span>14</span>,height = <span>9</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100000899" data-ratio="0.644" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFia0HzvqkYbnoePKhlFEcSjKAuLMPAibw8z81B3OxzmUVZ9IhHkd78lkHlZ7uLTM9afumr4aY5Qiagg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="750" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFia0HzvqkYbnoePKhlFEcSjKAuLMPAibw8z81B3OxzmUVZ9IhHkd78lkHlZ7uLTM9afumr4aY5Qiagg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>致谢</strong>：感谢曾老师，小洁老师以及生信技能树团队全体成员。</p><p data-tool="mdnice编辑器"><strong>注</strong>：若对内容有疑惑或者有发现明确错误的朋友，请联系后台(欢迎交流)。</p><span>- END -</span></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/xlT8gUnSI2JlEDooc9m8Ug",target="_blank" rel="noopener noreferrer">原文链接</a>
