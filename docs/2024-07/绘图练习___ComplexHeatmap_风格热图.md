---
title: "绘图练习 | ComplexHeatmap 风格热图"
date: 2024-07-23T01:59:05Z
draft: ["false"]
tags: [
  "fetched",
  "被炸熟的虾"
]
categories: ["Acdemic"]
---
绘图练习 | ComplexHeatmap 风格热图 by 被炸熟的虾
------
<div><p><span><span>数据与昨天更新内容一致：</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247487823&amp;idx=1&amp;sn=cce07822a491e8a5fa4187693115f3e2&amp;chksm=c086cd87f7f14491ed82aba3400547472dd4c8006fceaf7d656d6cc50cb85ebfbbd723f6b5b2&amp;scene=21#wechat_redirect" textvalue="绘图练习 | 使用ggplot2绘制热图" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><strong>绘图练习 | 使用ggplot2绘制热图</strong></a></span><span></span></p><p><img data-imgfileid="100004180" data-ratio="0.5981481481481481" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LlOpK2T3LfM2dVKCIm2W2525PUnVZUotdvFnkAkbYvibLjqcQKv9B0Qw1pOLibZjtSjD36R7zxKSPQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LlOpK2T3LfM2dVKCIm2W2525PUnVZUotdvFnkAkbYvibLjqcQKv9B0Qw1pOLibZjtSjD36R7zxKSPQ/640?wx_fmt=png&amp;from=appmsg"></p><p><code>ComplexHeatmap</code><span>包画图一直没认真学，参数真的太复杂了，当然，功能也是真的强大，这里只进行简单分段。</span></p><h3><span><strong><span>1、热图主体</span></strong></span></h3><p><span>主图部分还是很容易理解的，大部分参数都可以猜出含义</span></p><pre><code>exprSet &lt;- GSEAresults[-<span>13</span>,rev(colnames(GSEAresults))]<br><span>library</span>(ComplexHeatmap)<br>ComplexHeatmap &lt;- Heatmap(exprSet,<span>#画图矩阵</span><br>                          cluster_rows = <span>T</span>,<span>#行聚类</span><br>                          cluster_columns = <span>F</span>,<span>#列不聚类</span><br>                          show_column_names = <span>T</span>,<span>#展示列名</span><br>                          show_row_names = <span>T</span>,<span>#展示行名</span><br>                          row_names_side =  <span>'right'</span>,<span>#行名放在右边</span><br>                          column_title = <span>NULL</span>,<br>                          width = unit(<span>15</span>, <span>"cm"</span>),<span>#热图本体宽度</span><br>                          heatmap_legend_param = list(title = <span>'NES'</span>,<span>#图例参数</span><br>                                    grid_width = unit(<span>6</span>,<span>"mm"</span>),<br>                                    title_gp = gpar(fontsize = <span>15</span>),<br>                          labels_gp = gpar(fontsize = <span>15</span>)),<br>                          col = c(<span>'navy'</span>,<span>"white"</span>,<span>'red'</span>),<span>#映射颜色</span><br>                          rect_gp = gpar(col = <span>"white"</span>, lwd = <span>2</span>),<span>#色块白色描边</span><br>                          row_names_gp = gpar(fontsize = <span>15</span>),<br>                          column_names_gp = gpar(fontsize = <span>15</span>))<br></code></pre><p><span>图例与行名位置重叠了（添加完上方注释后更加明显），一直没找到很完美的通用方法处理。</span></p><p><img data-imgfileid="100004177" data-ratio="0.6166666666666667" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LlOpK2T3LfM2dVKCIm2W25KwmJBY98FNdWs8PEXqpHsUKmxF3C3zOBicb5YOVSyMayWShr6xWnCHw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LlOpK2T3LfM2dVKCIm2W25KwmJBY98FNdWs8PEXqpHsUKmxF3C3zOBicb5YOVSyMayWShr6xWnCHw/640?wx_fmt=png&amp;from=appmsg"></p><section><span></span></section><h3><span><strong><span>2、上方注释</span></strong></span></h3><p><span>使用</span><code>HeatmapAnnotation</code><span>函数构建上方注释，<strong>注意图例风格与主图一致！</strong></span></p><pre><code><span>library</span>(circlize)<br>rownames(Radio_list) &lt;- Radio_list$Sample_id<br>Radio_list &lt;- Radio_list[colnames(exprSet),]<br>top_anno &lt;- HeatmapAnnotation(<span># df = Radio_list[,c("PDL1","CTLA4","Score")],</span><br>                              PDL1 = Radio_list$PDL1,<br>                              CTLA4 = Radio_list$CTLA4,<br>                              Score = Radio_list$Score,<br>                              border = <span>T</span>,<span>#色块描边</span><br>                              show_annotation_name = <span>T</span>,<span>#显示注释行名称</span><br>                              annotation_name_gp = gpar(fontsize = <span>15</span>),<span>#注释名字体大小</span><br>                              annotation_legend_param = list(grid_width = unit(<span>6</span>,<span>"mm"</span>),<br>                                                             title_gp = gpar(fontsize = <span>15</span>),<br>                                                             labels_gp = gpar(fontsize = <span>15</span>)),<br>                              col = list(PDL1 = colorRamp2(c(-<span>2</span>,<span>3</span>),c(<span>"white"</span>,<span>"red"</span>)),<br>                                         CTLA4 = colorRamp2(c(<span>0</span>,<span>5</span>),c(<span>"white"</span>,<span>"blue"</span>)),<br>                                         Score = colorRamp2(c(-<span>4</span>,<span>0</span>,<span>4</span>), c(<span>"#053061"</span>, <span>"white"</span>, <span>"#67001f"</span>))))<br><span>#draw(top_anno)</span></code></pre><pre><code>ComplexHeatmap &lt;- Heatmap(exprSet,<br>                          cluster_rows = <span>T</span>,<br>                          cluster_columns = <span>F</span>,<br>                          show_column_names = <span>T</span>,<br>                          show_row_names = <span>T</span>,<br>                          row_names_side = <span>'right'</span>,<br>                          column_title = <span>NULL</span>,<br>                          width = unit(<span>15</span>, <span>"cm"</span>),<br>                          heatmap_legend_param = list(title = <span>'NES'</span>,<br>                                    grid_width = unit(<span>6</span>,<span>"mm"</span>),<br>                                    title_gp = gpar(fontsize = <span>15</span>),<br>                          labels_gp = gpar(fontsize = <span>15</span>)),<br>                          col = c(<span>'navy'</span>,<span>"white"</span>,<span>'red'</span>),<br>                          rect_gp = gpar(col = <span>"white"</span>, lwd = <span>2</span>),<br>                          row_names_gp = gpar(fontsize = <span>15</span>),<br>                          column_names_gp = gpar(fontsize = <span>15</span>),<br>                          top_annotation = top_anno)<br></code></pre><p><img data-imgfileid="100004179" data-ratio="0.6175925925925926" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LlOpK2T3LfM2dVKCIm2W25mUBOaBGjmj4X61A1MaXtN8GEDbIkMI2a6ic8jUxRGsjeQkzBI4PVXCQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LlOpK2T3LfM2dVKCIm2W25mUBOaBGjmj4X61A1MaXtN8GEDbIkMI2a6ic8jUxRGsjeQkzBI4PVXCQ/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>整理一下图例</span></strong><span>：既然图例与行名位置重叠，那么直接全部放在左侧，后续拼图再处理。</span></p><pre><code>draw(ComplexHeatmap, merge_legend = <span>TRUE</span>, <br>     heatmap_legend_side = <span>"left"</span>)<br></code></pre><p><img data-imgfileid="100004178" data-ratio="0.5666666666666667" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LlOpK2T3LfM2dVKCIm2W25XIH1gY5HjQm2f8tvNuIibicq39Hx3GTUAU0csXeBypFWx4CNe6h7kO2Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LlOpK2T3LfM2dVKCIm2W25XIH1gY5HjQm2f8tvNuIibicq39Hx3GTUAU0csXeBypFWx4CNe6h7kO2Q/640?wx_fmt=png&amp;from=appmsg"></p><p><span>很生疏的一个经典</span><span>R</span><span>包，果然，偷的懒总是要还的<img data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/Expression/Expression_9@2x.png" data-ratio="1" data-w="128" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/Expression/Expression_9@2x.png"></span></p><h3><span></span></h3><section><span></span></section><section><img data-imgfileid="100003752" data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-type="png" data-w="341" src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></section><section data-tools="135编辑器" data-id="116886" draggable="true"><section><section><section><section><strong data-brushtype="text">被炸熟的虾</strong></section></section></section><section><section><section data-width="35%"><section><img data-cropselx1="0" data-cropselx2="115" data-cropsely1="0" data-cropsely2="115" data-imgfileid="100003750" data-ratio="1" data-type="jpeg" data-w="258" data-width="100%" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></section></section><section data-width="63%"><section><section><strong>自己的摸索，发现问题麻烦告诉作者，光速回来改正</strong><strong><img data-imgfileid="100003751" data-ratio="1" data-type="png" data-w="64" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></strong></section></section></section></section></section></section></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/FJKKtz2YgdB3xox7-dKd8Q",target="_blank" rel="noopener noreferrer">原文链接</a>
