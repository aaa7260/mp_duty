---
title: "R数据的保存与读取：qs包"
date: 2024-07-30T08:00:00Z
draft: ["false"]
tags: [
  "fetched",
  "上海生物芯片"
]
categories: ["Acdemic"]
---
R数据的保存与读取：qs包 by 上海生物芯片
------
<div><p><img data-backh="91" data-backw="578" data-galleryid="" data-imgfileid="508579761" data-ratio="0.15666666666666668" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/YxibPYttzHV9HmrTbticqLsarY2NPtB2B6icNvAiasUSMNIPHYHDW8fsmam9jy6yWiahnylqHAk5m5lNNzZPZrKeibNg/640?wx_fmt=gif" data-type="gif" data-w="900" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/YxibPYttzHV9HmrTbticqLsarY2NPtB2B6icNvAiasUSMNIPHYHDW8fsmam9jy6yWiahnylqHAk5m5lNNzZPZrKeibNg/640?wx_fmt=gif"></p><section><p><br></p><section><section><section><p><strong>qs：R对象的快速序列化</strong></p></section></section></section><section><section><section><section><p>qs是一个R语言包，使用qs可以快速地从磁盘中保存和读取对象。它的主要目的是替换R中的saveRDS和readRDS函数，提供了一个更加快速而完整的数据读写方法。</p><p>受到fst的启发，qs通过lz4/zstd库使用了类似的块压缩设计。它的不同之处在于，对属性和对象的引用设计了更普适的方法。</p><p>一方面，saveRDS和readRDS是R数据序列化的标准，但是这些函数没有针对速度进行优化；另一方面，fst非常快，但只适用于部分数据类型如data.frame。qs结合了两者的优点，能够做到更加快速的储存数据，适用于各种类型的对象。</p></section></section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><p><br></p><section><section><section><p><strong>下载</strong></p></section></section></section><section><section><section><section><img data-imgfileid="508579868" data-ratio="0.23425925925925925" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHV8CtLEhvxr7FIqOOW7DQpRicAKePJTptWzyrSxaoSIqGRJFDrvdbYHAwqnDkRhU8ic6jL29FbPgRGSA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHV8CtLEhvxr7FIqOOW7DQpRicAKePJTptWzyrSxaoSIqGRJFDrvdbYHAwqnDkRhU8ic6jL29FbPgRGSA/640?wx_fmt=png&amp;from=appmsg"></section></section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><p><br></p><section><section><section><p><strong>使用方法</strong></p></section></section></section><section><section><section><section><img data-imgfileid="508579867" data-ratio="0.2361111111111111" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHV8CtLEhvxr7FIqOOW7DQpRicTWK3MY9zVJCZ92eG6mCNfHiaHMNWD4cSNImfTsOrl4BJs4ARWpuGNgw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHV8CtLEhvxr7FIqOOW7DQpRicTWK3MY9zVJCZ92eG6mCNfHiaHMNWD4cSNImfTsOrl4BJs4ARWpuGNgw/640?wx_fmt=png&amp;from=appmsg"></section></section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><p><br></p><section><section><section><p><strong>特征</strong></p></section></section></section><section><section><section><section><p>下表比较了R中不同序列化方法的特性</p></section></section><section><section><img data-imgfileid="508579870" data-ratio="1.0758293838862558" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHV8CtLEhvxr7FIqOOW7DQpRicu83ODyB67cvg26YVEBU9pVspsu0plxBvRJmW2G6DYms04tFNKqTEPA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="633" src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHV8CtLEhvxr7FIqOOW7DQpRicu83ODyB67cvg26YVEBU9pVspsu0plxBvRJmW2G6DYms04tFNKqTEPA/640?wx_fmt=png&amp;from=appmsg"></section></section><section><section><p>此外，qs还包括许多高级功能。</p></section></section><section><section><p><span>✅  对于字符向量，qs还可以选择使用新的ALTREP系统(R版本3.5)来快速读取字符串数据。</span></p><p><span>✅  对于数值数据(数值、整数、逻辑和复杂向量)，qs实现了字节变换过滤器(采用于blossom元压缩库)。这些过滤器利用扩展的CPU指令系统(SSE2或AVX2)。</span></p><p><span>✅  qs还可以有效地序列化S4对象、环境和其他复杂对象。</span></p></section></section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><p><br></p><section><section><section><p><strong>基准测试</strong></p></section></section></section><section><section><section><section><p>下面的基准测试使用了一个包含500万行的数据框（～115 Mb）比较了qs、fst和saveRDS/loadRDS的性能。</p></section></section><section><section><svg viewbox="0 0 1 1"></svg></section></section><section><section><section><p><strong>序列化</strong></p></section></section></section><section><section><img data-imgfileid="508579871" data-ratio="0.5385329619312906" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/YxibPYttzHV8CtLEhvxr7FIqOOW7DQpRicLpGxC9st3icu5eRleVPCG1JfaMg6zTfqrjW3g9XSTEonxykicvvNjJ2g/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1077" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/YxibPYttzHV8CtLEhvxr7FIqOOW7DQpRicLpGxC9st3icu5eRleVPCG1JfaMg6zTfqrjW3g9XSTEonxykicvvNjJ2g/640?wx_fmt=jpeg&amp;from=appmsg"></section></section><section><section><svg viewbox="0 0 1 1"></svg></section></section><section><section><section><p><strong>去序列化</strong></p></section></section></section><section><section><img data-imgfileid="508579869" data-ratio="0.537962962962963" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/YxibPYttzHV8CtLEhvxr7FIqOOW7DQpRicDrCHsB6NOV7QuMPStISHdzRQzre0BicETo4c1QR5rUvomkUV5jTs7qw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/YxibPYttzHV8CtLEhvxr7FIqOOW7DQpRicDrCHsB6NOV7QuMPStISHdzRQzre0BicETo4c1QR5rUvomkUV5jTs7qw/640?wx_fmt=jpeg&amp;from=appmsg"></section></section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><p><br></p><section><p><span>对读写速度进行基准测试会有点棘手，因为其高度依赖于许多因素，例如操作系统、运行的硬件、数据的分布，甚至是R实例的状态。读取数据还进一步受到各种硬件和软件内存缓存的影响。一般来说，无论使用单线程还是多线程压缩，qs和fst都比saveRDS快得多。qs还设法通过各种优化实现更高的压缩比，提供了多个可选参数，用户可以根据个人情况和需求来设置速度和压缩比。</span></p></section><p><br></p><section><section><section><p><strong>往期推荐：</strong></p><section><span>1、<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1NTA5MTY1MA==&amp;mid=2656063471&amp;idx=1&amp;sn=3ad27459d339a08f0fde101806668fac&amp;chksm=f19fd942c6e85054711e7cc0f34b48c6b8f9e36529db6674acc9e80a347af04859e2227b0cf0&amp;scene=21#wechat_redirect" textvalue="【Giotto系列】Giotto数据结构（下）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">【Giotto系列】Giotto数据结构（下）</a><strong><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1NTA5MTY1MA==&amp;mid=2656063471&amp;idx=1&amp;sn=3ad27459d339a08f0fde101806668fac&amp;chksm=f19fd942c6e85054711e7cc0f34b48c6b8f9e36529db6674acc9e80a347af04859e2227b0cf0&amp;scene=21#wechat_redirect" textvalue="【Giotto系列】Giotto数据结构（下）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"></a></strong></span><strong><br></strong></section><section><span>2、<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1NTA5MTY1MA==&amp;mid=2656063403&amp;idx=1&amp;sn=837c5b04cc1077bf21df940be5e09180&amp;chksm=f19fd906c6e850105565e68750d2db82c1a55af0e749885bb530319e5d62e3dbcd8aed45f6af&amp;scene=21#wechat_redirect" textvalue="【Giotto系列】Giotto数据结构（上）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">【Giotto系列】Giotto数据结构（上）</a><br></span></section><section>3、<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1NTA5MTY1MA==&amp;mid=2656063344&amp;idx=1&amp;sn=6f7c4565be4c82dc25f92bcce2cb7422&amp;chksm=f19fd9ddc6e850cb244abefcda43a2215132a4cf784b59714610134ac5f582ac06265a964d17&amp;scene=21#wechat_redirect" textvalue="【Giotto系列】软件介绍与下载" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">【Giotto系列】软件介绍与下载</a><br></section></section></section></section><p><br></p></section><p><img data-backh="929" data-backw="578" data-galleryid="" data-imgfileid="508579873" data-ratio="1.6074074074074074" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHV92Rr01071KGlFMlYUrEUGMIribnSKibXGF6v6untehXv7Kr28WZjVp98kLKaPciclzxb6IEhldDqJBw/640?wx_fmt=other&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/YxibPYttzHV92Rr01071KGlFMlYUrEUGMIribnSKibXGF6v6untehXv7Kr28WZjVp98kLKaPciclzxb6IEhldDqJBw/640?wx_fmt=other&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></p><p><img data-backh="325" data-backw="578" data-galleryid="" data-imgfileid="508579874" data-ratio="0.5625" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/YxibPYttzHVib0mkK1f42m2Z8j5w2LgQwV4icchhpMo9RjeGvGbS1zibsmGmqUx9wMibFtrWX71ibuaROrqdgCCWwkrA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-type="gif" data-w="640" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/YxibPYttzHVib0mkK1f42m2Z8j5w2LgQwV4icchhpMo9RjeGvGbS1zibsmGmqUx9wMibFtrWX71ibuaROrqdgCCWwkrA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/rr_7bfHprhfSuj6uNhLWKQ",target="_blank" rel="noopener noreferrer">原文链接</a>
