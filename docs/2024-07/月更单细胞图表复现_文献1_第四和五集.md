---
title: "月更单细胞图表复现-文献1-第四和五集"
date: 2024-07-01T02:51:17Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
月更单细胞图表复现-文献1-第四和五集 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span>我们组建了一个月更的单细胞图表复现交流群，目前是进行到了第二个文献：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247523009&amp;idx=1&amp;sn=91077d6307ae8811dff9ef97e40837fd&amp;chksm=9b4bda7aac3c536cd88f9cd3a1d87b65e5fb168829caceb451fa62786d417290a1bf47a48dc7&amp;scene=21#wechat_redirect" textvalue="文献复现-单细胞揭示新辅助治疗后NSCLC的免疫微环境变化" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">文献复现-单细胞揭示新辅助治疗后NSCLC的免疫微环境变化</a>，视频也剪辑好了在b站：<p><img data-galleryid="" data-imgfileid="100048059" data-ratio="0.2638888888888889" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwvKXSbdeVN5AtYjicpz09X3avkcaBicdjyzYALPrUicXKphE0Ufp9uZCW7icN92V8D4726jBXWYPBbkQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwvKXSbdeVN5AtYjicpz09X3avkcaBicdjyzYALPrUicXKphE0Ufp9uZCW7icN92V8D4726jBXWYPBbkQ/640?wx_fmt=png&amp;from=appmsg"></p><p>但是我们的文字版推文还在第一篇文献，前面已经分享了3个：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247531211&amp;idx=2&amp;sn=d7c1d48184c706eec9861fad648786c9&amp;chksm=9b4b3a70ac3cb366f015b3e7c3e937de1207cc98dd02915cd67388fe601cf333e01c6992b20e&amp;scene=21#wechat_redirect" textvalue="胃癌单细胞数据集GSE163558复现(二)：Seurat V5标准流程" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">胃癌单细胞数据集GSE163558复现(二)：Seurat V5标准流程</a>，接下来是图表美化和单细胞亚群比例探讨：<br></p></blockquote></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>第四集：图表美化</span><span></span></h2></section><h2 data-tool="mdnice编辑器"><span>背景介绍</span></h2><p data-tool="mdnice编辑器">绘图质量一定程度上会直接影响文章的发表。站在审稿人的角度，好看的图会令人赏心悦目，不好看的图会成为巨大的减分项。好看的图往往逻辑清晰、布局合理、配色协调。</p><p data-tool="mdnice编辑器">逻辑清晰与否主要体现在机制/流程图上。这张图是全文的重中之重，是作者科研能力、绘图水平和文章质量的集中体现。布局是否合理大图和小图都会涉及。小图需要我们去不断的调整坐标轴、标签、文字的位置、大小和粗细，还有图片的透明度、分组的顺序等等等等。配色协调考验的是绘图人的审美水平。笔者是直男审美，在学习R绘图的时候，数据和代码的问题往往能解决，但就是画的一手丑图。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100048020" data-ratio="0.9729166666666667" data-src="https://mmbiz.qpic.cn/mmbiz_gif/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKcUSWQcibtF0bm2iawmMnsmoEuzmYx4tQb091zIrS6PWic4LmD2jYdkDmSQ/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=13&amp;tp=wxpic" data-type="gif" data-w="480" src="https://mmbiz.qpic.cn/mmbiz_gif/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKcUSWQcibtF0bm2iawmMnsmoEuzmYx4tQb091zIrS6PWic4LmD2jYdkDmSQ/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=13&amp;tp=wxpic"></figure><p data-tool="mdnice编辑器">特别是配色一言难尽，只能找爱逛街的师妹帮忙配色，或者去找高分文章的配色然后直接copy。由于是审美不在线，因此本系列所有的颜色代码，我就老老实实的copy。</p><p data-tool="mdnice编辑器">看看第三期的图，配色是不是看着很舒服：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100048022" data-ratio="0.5212962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKcWvo9OhIFD6fKsszGIQgVpra6xZBdSlRgUX2xHkGNVSfOnsfhj8FnLg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKcWvo9OhIFD6fKsszGIQgVpra6xZBdSlRgUX2xHkGNVSfOnsfhj8FnLg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><h2 data-tool="mdnice编辑器"><span>2.可视化</span></h2><p data-tool="mdnice编辑器"><span>在分群注释之后，我们可以使用</span><span>DimPlot</span><span>、FeaturePlot、DoHeatmap、DotPlot等多种函数对细胞或基因可视化。</span></p><p data-tool="mdnice编辑器">在绘图之前，我们首先创建新的工作目录，并读取第三期亚群注释后的数据：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCxdArEP3NmMPHaaAribLqibxv16iaBRE9BF9ibjickwk2ib16xcfx9oVJYN2yUbc5RhkKSELMqPQmHhHCD/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>dir.create(<span>"4-plot"</span>)<br>setwd(<span>'4-plot/'</span>)<br>sce.all=readRDS( <span>"../3-Celltype/sce_celltype.rds"</span>)<br>sce.all<br></code></pre><p data-tool="mdnice编辑器">使用DimPlot函数展示T细胞（"0","1"）在tSNE图中的位置：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCxdArEP3NmMPHaaAribLqibxv16iaBRE9BF9ibjickwk2ib16xcfx9oVJYN2yUbc5RhkKSELMqPQmHhHCD/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>Idents(sce.all)<br>DimPlot(sce.all,label=T,<br>        reduction = <span>"tsne"</span>,pt.size = 0.2,<br>        cells.highlight=list(<br>          T=WhichCells(sce.all, idents = c(<span>"0"</span>,<span>"1"</span>))<br>        ),<br>        cols.highlight = c(<span>"red"</span>),cols = <span>"grey"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048023" data-ratio="0.7354260089686099" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKch5okyW5UIXavsdePxCicQsZZgic44Pl1pCZ4HaHEic5Q4fPb0AoIeYb0Q/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="892" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKch5okyW5UIXavsdePxCicQsZZgic44Pl1pCZ4HaHEic5Q4fPb0AoIeYb0Q/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器">使用FeaturePlot函数展示T细胞maker基因('CD3D', 'CD3E', 'CD8A', 'CD4','CD2')的表达情况：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCxdArEP3NmMPHaaAribLqibxv16iaBRE9BF9ibjickwk2ib16xcfx9oVJYN2yUbc5RhkKSELMqPQmHhHCD/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>T_marker &lt;- c(<span>'CD3D'</span>, <span>'CD3E'</span>, <span>'CD8A'</span>, <span>'CD4'</span>,<span>'CD2'</span>)<br>FeaturePlot(sce.all,features = T_marker,reduction = <span>"tsne"</span>,cols = c(<span>"lightgrey"</span> ,<span>"#DE1F1F"</span>),ncol=2,raster=FALSE)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048028" data-ratio="0.7363238512035011" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKc5GhlGibAm8FDDKocgZ5vP097XzwqJYvknibVYatjcDdPS1lxGw6mLqvA/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="914" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKc5GhlGibAm8FDDKocgZ5vP097XzwqJYvknibVYatjcDdPS1lxGw6mLqvA/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器">使用DimPlot函数展示上皮细胞("5","11","12")在tSNE图中的位置：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCxdArEP3NmMPHaaAribLqibxv16iaBRE9BF9ibjickwk2ib16xcfx9oVJYN2yUbc5RhkKSELMqPQmHhHCD/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>DimPlot(sce.all,label=T,<br>        reduction = <span>"tsne"</span>,pt.size = 0.2,<br>        cells.highlight=list(<br>          Epithelial=WhichCells(sce.all, idents = c(<span>"5"</span>,<span>"11"</span>,<span>"12"</span>))<br>        ),<br>          cols.highlight = c(<span>"red"</span>),cols = <span>"grey"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048026" data-ratio="0.7363238512035011" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKcZZg2PMIqibQVXV5AgvgibDy34WpMNbA2b5s2xfPAKMNRebLu7iaEwpVIw/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="914" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKcZZg2PMIqibQVXV5AgvgibDy34WpMNbA2b5s2xfPAKMNRebLu7iaEwpVIw/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器">使用FeaturePlot函数展示上皮细胞maker基因('EPCAM','KRT19','CLDN4')的表达情况：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCxdArEP3NmMPHaaAribLqibxv16iaBRE9BF9ibjickwk2ib16xcfx9oVJYN2yUbc5RhkKSELMqPQmHhHCD/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>Epithelial_marker &lt;- c(<span>'EPCAM'</span>,<span>'KRT19'</span>,<span>'CLDN4'</span>)<br>FeaturePlot(sce.all,features = Epithelial_marker,reduction = <span>"tsne"</span>,cols = c(<span>"lightgrey"</span> ,<span>"#DE1F1F"</span>),ncol=2,raster=FALSE)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048033" data-ratio="0.7363238512035011" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKcqKn9qsbyOhQeN2DLoB4g5TAVwYBIGMogYwvsc75icXDqfweIpWn03ww/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="914" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKcqKn9qsbyOhQeN2DLoB4g5TAVwYBIGMogYwvsc75icXDqfweIpWn03ww/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器">FeaturePlot函数展示maker基因的表达也可以帮助我们检查注释准确与否，因此，我们可以批量绘制多个maker基因：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCxdArEP3NmMPHaaAribLqibxv16iaBRE9BF9ibjickwk2ib16xcfx9oVJYN2yUbc5RhkKSELMqPQmHhHCD/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>genes_to_check = c(<span>'EPCAM'</span>,<span>'KRT19'</span>,<span>'CLDN4'</span>,  <span>#上皮</span><br>                   <span>'PECAM1'</span> , <span>'CLO1A2'</span>, <span>'VWF'</span>,  <span>#基质</span><br>                   <span>'CD3D'</span>, <span>'CD3E'</span>, <span>'CD8A'</span>, <span>'CD4'</span>,<span>'CD2'</span>, <span>#T</span><br>                   <span>'CDH5'</span>, <span>'PECAM1'</span>, <span>'VWF'</span>,  <span>#内皮</span><br>                   <span>'LUM'</span> , <span>'FGF7'</span>, <span>'MME'</span>,  <span>#成纤维</span><br>                   <span>'AIF1'</span>, <span>'C1QC'</span>,<span>'C1QB'</span>,<span>'LYZ'</span>,  <span>#巨噬</span><br>                   <span>'MKI67'</span>, <span>'STMN1'</span>, <span>'PCNA'</span>,  <span>#增殖</span><br>                   <span>'CPA3'</span> ,<span>'CST3'</span>, <span>'KIT'</span>, <span>'TPSAB1'</span>,<span>'TPSB2'</span>,<span>#肥大</span><br>                   <span>'GOS2'</span>, <span>'S100A9'</span>,<span>'S100A8'</span>,<span>'CXCL8'</span>, <span>#中性粒细胞</span><br>                   <span>'KLRD1'</span>, <span>'GNLY'</span>, <span>'KLRF1'</span>,<span>'AREG'</span>, <span>'XCL2'</span>,<span>'HSPA6'</span>, <span>#NK</span><br>                   <span>'MS4A1'</span>,<span>'CD19'</span>, <span>'CD79A'</span>,<span>'IGHG1'</span>,<span>'MZB1'</span>, <span>'SDC1'</span>,  <span>#B</span><br>                   <span>'CSF1R'</span>, <span>'CSF3R'</span>, <span>'CD68'</span>) <span>#髓系</span><br><br><span>##批量画基因</span><br>FeaturePlot(sce.all, features =genes_to_check, <br>            cols = c(<span>"lightgrey"</span>, <span>'red'</span>),<br>            reduction = <span>"tsne"</span>,<br>            ncol = 8 ) &amp; NoLegend() &amp; NoAxes() &amp; theme(<br>              panel.border = element_rect(color = <span>"black"</span>, size = 1)<br>            )<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048032" data-ratio="0.7363238512035011" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKc9Xef4UlIJ1TW08Q0RBEXLROojCmicPJXgnwfAia9Ttw9dI6e7JyIickKw/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="914" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKc9Xef4UlIJ1TW08Q0RBEXLROojCmicPJXgnwfAia9Ttw9dI6e7JyIickKw/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器">FeaturePlot除了可以展示单个基因，还可以把多个基因画在同一个图中。</p><p data-tool="mdnice编辑器">Featureplot把两个基因画在同一个图中,看右上角可以发现黄色越深的地方两个基因叠加越多。这样可以看两个基因的共表达，是不是和免疫荧光图比较类似：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCxdArEP3NmMPHaaAribLqibxv16iaBRE9BF9ibjickwk2ib16xcfx9oVJYN2yUbc5RhkKSELMqPQmHhHCD/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>FeaturePlot(sce.all, features = c(<span>'S100A9'</span>,<span>'S100A8'</span>),<br>            reduction = <span>"tsne"</span>,<br>            cols = c(<span>"lightgrey"</span>, <span>"green"</span>, <span>"orange"</span>),<br>            blend=T,blend.threshold=0)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048031" data-ratio="0.48055555555555557" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKcjNKBVunVqia97eGV2tQCMbiaibCZbicKyCKE8EAfnw6MqB5fKAw9jnicMhA/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKcjNKBVunVqia97eGV2tQCMbiaibCZbicKyCKE8EAfnw6MqB5fKAw9jnicMhA/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器">Featureplot还可以把三个基因画在同一个图中：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCxdArEP3NmMPHaaAribLqibxv16iaBRE9BF9ibjickwk2ib16xcfx9oVJYN2yUbc5RhkKSELMqPQmHhHCD/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code><span># 提取tsne坐标</span><br>tsne_df &lt;- as.data.frame(sce.all@reductions<span>$tsne</span>@cell.embeddings)<br>tsne_df<span>$cluster</span> &lt;- as.factor(sce.all<span>$celltype</span>)<br>head(tsne_df)<br><span># 提取基因表达数据并与tsne坐标合并</span><br>gene_df &lt;- as.data.frame(GetAssayData(object = sce.all, slot = <span>"data"</span>)[c(<span>'S100A9'</span>,<span>'S100A8'</span>,<span>'CXCL8'</span>), ])<br><br>library(ggnewscale)<br>merged_df &lt;- merge(t(gene_df), tsne_df, by = 0, all = TRUE)<br>head(merged_df)<br>colnames(merged_df)<br>ggplot(merged_df, vars = c(<span>"tSNE_1"</span>, <span>"tSNE_2"</span>, <span>'S100A9'</span>,<span>'S100A8'</span>,<span>'CXCL8'</span>), aes(x = tSNE_1, y = tSNE_2, colour = S100A9)) +<br>  geom_point(size=0.3, alpha=1) +<br>  scale_colour_gradientn(colours = c(<span>"lightgrey"</span>, <span>"green"</span>), limits = c(0, 0.3), oob = scales::squish) +<br>  new_scale_color() +<br>  geom_point(aes(colour = S100A8), size=0.3, alpha=0.7) +<br>  scale_colour_gradientn(colours = c(<span>"lightgrey"</span>, <span>"blue"</span>), limits = c(0.1, 0.2), oob = scales::squish) +<br>  new_scale_color() +<br>  geom_point(aes(colour = CXCL8), size=0.3, alpha=0.1) +<br>  scale_colour_gradientn(colours = c(<span>"lightgrey"</span>, <span>"red"</span>), limits = c(0, 0.3), oob = scales::squish)+<br>  theme_classic()<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048037" data-ratio="0.8277982779827798" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKc7ZsTN0yzpeEe4IY248ebz9XCnBnL0acPxLcY3TKRlJE6pOuW13Yq3A/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="813" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKc7ZsTN0yzpeEe4IY248ebz9XCnBnL0acPxLcY3TKRlJE6pOuW13Yq3A/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器">此外，我们还可以使用DoHeatmap函数绘制热图，展示每群细胞top基因：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCxdArEP3NmMPHaaAribLqibxv16iaBRE9BF9ibjickwk2ib16xcfx9oVJYN2yUbc5RhkKSELMqPQmHhHCD/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>Idents(sce.all)<br>Idents(sce.all) = sce.all<span>$celltype</span><br>sce.markers &lt;- FindAllMarkers(object = sce.all, only.pos = TRUE, <br>                              min.pct = 0.25, <br>                              thresh.use = 0.25)<br>write.csv(sce.markers,file=<span>'sce.markers.csv'</span>)<br><span>#sce.markers = read.csv('sce.markers.csv',row.names = 1)</span><br>library(dplyr) <br>top5 &lt;- sce.markers %&gt;% group_by(cluster) %&gt;% top_n(5, avg_log2FC)<br><span>#为了防止数据量太大不好出图，这里在每个亚群提取出来100个</span><br>DoHeatmap(subset(sce.all,downsample=100),top5<span>$gene</span>,size=3)+scale_fill_gradientn(colors=c(<span>"#94C4E1"</span>,<span>"white"</span>,<span>"red"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048038" data-ratio="0.8277982779827798" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKcOSMYMMERDVokrKOn568z3mv05wAzPSQWG1NibqB67REtvEFFzicxtfsQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="813" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKcOSMYMMERDVokrKOn568z3mv05wAzPSQWG1NibqB67REtvEFFzicxtfsQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器">使用DotPlot函数绘制气泡图：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCxdArEP3NmMPHaaAribLqibxv16iaBRE9BF9ibjickwk2ib16xcfx9oVJYN2yUbc5RhkKSELMqPQmHhHCD/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>top5_dotplot &lt;- DotPlot(sce.all, features = top5<span>$gene</span>)+<br>  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1))<br>top5_dotplot<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048039" data-ratio="0.8277982779827798" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKcjyPtGyFCCIE3zY0FQmbglHRFIHV2W2vE997d1pgdWCDicro8QjJEeEQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="813" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQ17iaiblGkZjLJhZ6TC0ibpKcjyPtGyFCCIE3zY0FQmbglHRFIHV2W2vE997d1pgdWCDicro8QjJEeEQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><h2 data-tool="mdnice编辑器"><span>结语</span></h2><p data-tool="mdnice编辑器">本期，我们使用了DimPlot、FeaturePlot、DoHeatmap、DotPlot等多种函数对细胞群和基因进行了可视化。下一期，我们将在此基础上，绘制饼图、堆积柱状图、箱线图、气泡图等，比较不同分组之间细胞比例差异。干货满满，欢迎大家持续追更，谢谢！</p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>第五集：细胞比例</span><span></span></h2></section><h2 data-tool="mdnice编辑器"><span>1.背景</span></h2><p data-tool="mdnice编辑器">在细胞分群命名完成之后，我们可以比较不同样本和分组之间细胞比例的差异。细胞发生癌变、肿瘤细胞转移、药物治疗等刺激因素，都会导致肿瘤微环境中细胞类型发生改变。不同类型的细胞执行不同的生物学功能，通过计算细胞比例，我们可以评估细胞类型的组内及组间分布情况。</p><h2 data-tool="mdnice编辑器"><span>2.可视化</span></h2><p data-tool="mdnice编辑器">在这里，我们将依次绘制饼图、堆积柱状图、气泡图。</p><h3 data-tool="mdnice编辑器"><span></span><span>2.1 饼图</span></h3><p data-tool="mdnice编辑器">饼图可以直观展示组内各细胞比例的差异。</p><p data-tool="mdnice编辑器">首先加载R包：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCicSdCgJgXNfCibuTJSrcQ9Dt9ID36OHFEmylJrF4Rj5XF39vjpthELFYDib9cF7aicCWO1pXcLZsxHH/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>rm(list=ls())<br>options(stringsAsFactors = F)<br>library(Seurat)<br>library(ggplot2)<br>library(clustree)<br>library(cowplot)<br>library(dplyr)<br>library(plotrix)<br>library(ggsci)<br>library(celldex)<br>library(singleseqgset)<br>library(devtools)<br></code></pre><p data-tool="mdnice编辑器">创建工作目录，并读取细胞分群注释后数据：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCicSdCgJgXNfCibuTJSrcQ9Dt9ID36OHFEmylJrF4Rj5XF39vjpthELFYDib9cF7aicCWO1pXcLZsxHH/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>getwd()<br>setwd()<br>dir.create(<span>"5-prop"</span>)<br>setwd(<span>'5-prop/'</span>)<br>sce.all=readRDS( <span>"../3-Celltype/sce_celltype.rds"</span>)<br>sce.all<br></code></pre><p data-tool="mdnice编辑器">绘制饼图：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCicSdCgJgXNfCibuTJSrcQ9Dt9ID36OHFEmylJrF4Rj5XF39vjpthELFYDib9cF7aicCWO1pXcLZsxHH/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>head(sce.all@meta.data)<br>table(sce.all<span>$celltype</span>)<br>mynames &lt;-   table(sce.all<span>$celltype</span>) %&gt;% names()<br>myratio &lt;-  table(sce.all<span>$celltype</span>) %&gt;% as.numeric()<br>pielabel &lt;- paste0(mynames,<span>" ("</span>, round(myratio/sum(myratio)*100,2), <span>"%)"</span>)<br><br>cols &lt;-c(<span>'#E64A35'</span>,<span>'#4DBBD4'</span> ,<span>'#01A187'</span>,<span>'#6BD66B'</span>,<span>'#3C5588'</span>  ,<span>'#F29F80'</span>  ,<br>         <span>'#8491B6'</span>,<span>'#91D0C1'</span>,<span>'#7F5F48'</span>,<span>'#AF9E85'</span>,<span>'#4F4FFF'</span>,<span>'#CE3D33'</span>,<br>         <span>'#739B57'</span>,<span>'#EFE685'</span>,<span>'#446983'</span>,<span>'#BB6239'</span>,<span>'#5DB1DC'</span>,<span>'#7F2268'</span>,<span>'#800202'</span>,<span>'#D8D8CD'</span><br>)<br>pie(myratio, labels=pielabel,<br>    radius = 1.0,clockwise=T,<br>    main = <span>"celltype"</span>,col = cols)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048044" data-ratio="0.8358585858585859" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4yr7VKtjia9aeaBbuRA4vZp8CNSXLcW4EzjBMOfPgNBJo1icDfKlk2r4Sw/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="792" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4yr7VKtjia9aeaBbuRA4vZp8CNSXLcW4EzjBMOfPgNBJo1icDfKlk2r4Sw/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器">绘制3D饼图：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCicSdCgJgXNfCibuTJSrcQ9Dt9ID36OHFEmylJrF4Rj5XF39vjpthELFYDib9cF7aicCWO1pXcLZsxHH/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>pie3D(myratio,labels = pielabel,explode = 0.1, <br>      main = <span>"Cell Proption"</span>,<br>      height = 0.3,<br>      labelcex  = 1)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048049" data-ratio="0.7649402390438247" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4ysKPZqDbWHEYXIRCHLr1tpN22VW3EU1kw3SLcptvK2BGUqic05FQun2g/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="753" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4ysKPZqDbWHEYXIRCHLr1tpN22VW3EU1kw3SLcptvK2BGUqic05FQun2g/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器"><strong>pie函数参数说明：</strong></p><p data-tool="mdnice编辑器"><code>x</code><span>: 数值向量，表示每个扇形的面积。</span><br><code>labels</code><span><span>: 字符型向量，表示各</span><span>扇形面积</span><span>标签。</span></span><br><code>edges</code>: 这个参数用处不大，指的是多边形的边数（圆的轮廓类似很多边的多边形）。<br><code>radius</code>: 饼图的半径。<br><code>main</code>: 饼图的标题。<br><code>clockwise</code>: 是一个逻辑值,用来指示饼图各个切片是否按顺时针做出分割。<br><code>angle</code>: 设置底纹的斜率。<br><code>density</code>: 底纹的密度。默认值为 NULL。<br><code>col</code>: 是表示每个扇形的颜色，相当于调色板。</p><h3 data-tool="mdnice编辑器"><span></span><span>2.2 堆积柱状图</span></h3><p data-tool="mdnice编辑器">堆积柱状图除了可以展示组内差异，还可以直观展示组间细胞比例差异。</p><p data-tool="mdnice编辑器">绘制堆积柱状图前，首先整理图形输入数据：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCicSdCgJgXNfCibuTJSrcQ9Dt9ID36OHFEmylJrF4Rj5XF39vjpthELFYDib9cF7aicCWO1pXcLZsxHH/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>library(tidyr)<br>library(reshape2)<br>tb=table(sce.all<span>$tissue</span>, sce.all<span>$celltype</span>)<br>head(tb)<br>library (gplots) <br>balloonplot(tb)<br>bar_data &lt;- as.data.frame(tb)<br>bar_per &lt;- bar_data %&gt;% <br>  group_by(Var1) %&gt;%<br>  mutate(sum(Freq)) %&gt;%<br>  mutate(percent = Freq / `sum(Freq)`)<br>head(bar_per) <br><span>#write.csv(bar_per,file = "celltype_by_group_percent.csv")</span><br>col =c(<span>"#3176B7"</span>,<span>"#F78000"</span>,<span>"#3FA116"</span>,<span>"#CE2820"</span>,<span>"#9265C1"</span>,<br>                <span>"#885649"</span>,<span>"#DD76C5"</span>,<span>"#BBBE00"</span>,<span>"#41BED1"</span>)<br>colnames(bar_per)<br></code></pre><p data-tool="mdnice编辑器">可视化：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCicSdCgJgXNfCibuTJSrcQ9Dt9ID36OHFEmylJrF4Rj5XF39vjpthELFYDib9cF7aicCWO1pXcLZsxHH/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>library(ggthemes)<br>p1 = ggplot(bar_per, aes(x = percent, y = Var1)) +<br>  geom_bar(aes(fill = Var2) , <span>stat</span> = <span>"identity"</span>) + coord_flip() +<br>  theme(axis.ticks = element_line(linetype = <span>"blank"</span>),<br>        legend.position = <span>"top"</span>,<br>        panel.grid.minor = element_line(colour = NA,linetype = <span>"blank"</span>), <br>        panel.background = element_rect(fill = NA),<br>        plot.background = element_rect(colour = NA)) +<br>  labs(y = <span>" "</span>, fill = NULL)+labs(x = <span>'Relative proportion(%)'</span>)+<br>  scale_fill_manual(values=col)+<br>  theme_few()+<br>  theme(plot.title = element_text(size=12,hjust=0.5))<br><br>p1<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048048" data-ratio="0.42592592592592593" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4yibgiayt1tSE5DXicJdY25whiaic5fIrnHUgbpQvPFUSqIIkDUAUQ8T4nOWA/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4yibgiayt1tSE5DXicJdY25whiaic5fIrnHUgbpQvPFUSqIIkDUAUQ8T4nOWA/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器">上图是按样本类型（M、NT、PT）分组比较的，我们也可以按患者进行比较：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCicSdCgJgXNfCibuTJSrcQ9Dt9ID36OHFEmylJrF4Rj5XF39vjpthELFYDib9cF7aicCWO1pXcLZsxHH/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>bar_data &lt;- as.data.frame(tb)<br>bar_per &lt;- bar_data %&gt;% <br>  group_by(Var1) %&gt;%<br>  mutate(sum(Freq)) %&gt;%<br>  mutate(percent = Freq / `sum(Freq)`)<br>head(bar_per) <br><span>#write.csv(bar_per,file = "celltype_by_group_percent.csv")</span><br>col =c(<span>"#3176B7"</span>,<span>"#F78000"</span>,<span>"#3FA116"</span>,<span>"#CE2820"</span>,<span>"#9265C1"</span>,<br>       <span>"#885649"</span>,<span>"#DD76C5"</span>,<span>"#BBBE00"</span>,<span>"#41BED1"</span>)<br>colnames(bar_per)<br><br>library(ggthemes)<br>p2 = ggplot(bar_per, aes(x = percent, y = Var1)) +<br>  geom_bar(aes(fill = Var2) , <span>stat</span> = <span>"identity"</span>) + coord_flip() +<br>  theme(axis.ticks = element_line(linetype = <span>"blank"</span>),<br>        legend.position = <span>"top"</span>,<br>        panel.grid.minor = element_line(colour = NA,linetype = <span>"blank"</span>), <br>        panel.background = element_rect(fill = NA),<br>        plot.background = element_rect(colour = NA)) +<br>  labs(y = <span>" "</span>, fill = NULL)+labs(x = <span>'Relative proportion(%)'</span>)+<br>  scale_fill_manual(values=col)+<br>  theme_few()+<br>  theme(plot.title = element_text(size=12,hjust=0.5)) + <br>  theme(axis.text.x = element_text(angle = 45, hjust = 1))<br><br><br>p2<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048054" data-ratio="0.5953703703703703" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4yRpkG50Jx5oOHmLwd8a3NLmwuLeRS21TH84hGoEkFsHExESIsQE4viag/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4yRpkG50Jx5oOHmLwd8a3NLmwuLeRS21TH84hGoEkFsHExESIsQE4viag/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器">X、Y轴转换一下：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCicSdCgJgXNfCibuTJSrcQ9Dt9ID36OHFEmylJrF4Rj5XF39vjpthELFYDib9cF7aicCWO1pXcLZsxHH/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>p3 &lt;- ggplot(bar_per, aes(y = percent, x = Var1)) +<br>  geom_bar(aes(fill = Var2) , <span>stat</span> = <span>"identity"</span>) + coord_flip() +<br>  theme(axis.ticks = element_line(linetype = <span>"blank"</span>),<br>        legend.position = <span>"top"</span>,<br>        panel.grid.minor = element_line(colour = NA,linetype = <span>"blank"</span>), <br>        panel.background = element_rect(fill = NA),<br>        plot.background = element_rect(colour = NA)) +<br>  labs(y = <span>" "</span>, fill = NULL)+labs(x = <span>'Relative proportion(%)'</span>)+<br>  scale_fill_manual(values=col)+<br>  theme_few()+<br>  theme(plot.title = element_text(size=12,hjust=0.5)) + <br>  theme(axis.text.x = element_text(angle = 45, hjust = 1))<br>p3<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048051" data-ratio="0.5601851851851852" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4ylicl24LZ3KQ1uMficHVicF8O2s6ysxUIDN5lqyxwUHia3QAicnZ8w9zdchA/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4ylicl24LZ3KQ1uMficHVicF8O2s6ysxUIDN5lqyxwUHia3QAicnZ8w9zdchA/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器"><strong>ggplot函数参数说明：</strong></p><p data-tool="mdnice编辑器">原文链接：https://blog.csdn.net/a11113112/article/details/135091751</p><p data-tool="mdnice编辑器"><code>data</code>：要用于绘图的数据集。<br><code>mapping</code> 或 <code>aes</code>：美学映射，用于将数据变量映射到图形属性，例如 x、y、color、size、shape 等。<br><code>geom</code>：几何对象，确定图形类型，比如 geom_point()（散点图）、geom_line()（折线图）、geom_bar()（条形图）等。<br><code>x</code>、<code>y</code>：指定 x 轴和 y 轴的数据变量。<br><code>color、fill、shape、size</code>：用于指定颜色、填充、形状和大小的变量。<br><code>alpha</code>：指定颜色透明度。<br><code>group</code>：指定分组变量。<br><code>facet</code>：面板分组，允许在一个图中绘制多个小图（facet_wrap() 或 facet_grid()）。<br><code>theme</code>：用于设置图形的主题样式。<br><code>labs</code>：用于设置 x、y 轴标签和图例标签的文本。<br><code>scale</code>：用于调整比例尺和美学属性的尺度。<br><code>coord</code>：坐标系变换，例如 coord_flip() 可以交换 x 和 y 轴。<br><code>position</code>：用于调整图形中元素的位置，例如 position_dodge() 用于避免重叠的条形或点。<br><code>xlim、ylim</code>：控制 x 轴和 y 轴的绘图范围。<br><code>coord_cartesian()</code>：类似于 xlim 和 ylim，但不会删除超出范围的数据点。<br><code>labs()</code>：设置图形的标题、坐标轴标签和图例标题。<br><code>ggtitle()</code>：设置图形的主标题。<br><code>theme()</code>：调整图形的外观和布局，如背景、网格线、标签样式等。<br><code>guides()</code>：控制图例的外观，如标题、标签和图例键的位置和样式。<br><code>scale_x_continuous()、scale_y_continuous()</code>：调整 x 轴和 y 轴的连续变量的比例尺和标签。</p><p data-tool="mdnice编辑器">.......</p><h3 data-tool="mdnice编辑器"><span></span><span>2.3 气泡图</span></h3><p data-tool="mdnice编辑器">气泡图则可以展示每组样本不同类型细胞的具体数量。</p><p data-tool="mdnice编辑器">绘制气泡图：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCicSdCgJgXNfCibuTJSrcQ9Dt9ID36OHFEmylJrF4Rj5XF39vjpthELFYDib9cF7aicCWO1pXcLZsxHH/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code><br>unique(sce.all@meta.data<span>$patient</span>)<br>tb=table(sce.all<span>$patient</span>, sce.all<span>$celltype</span>)<br>head(tb)<br>library (gplots) <br>balloonplot(tb)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048053" data-ratio="0.5833333333333334" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4yMVpHTSNuezGMibwibdFTap7X8aTLK3Mf6s5tfDyGHlKpkFbkias2WVuqQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4yMVpHTSNuezGMibwibdFTap7X8aTLK3Mf6s5tfDyGHlKpkFbkias2WVuqQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器">可以调整字体大小：</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/47CicbLQOxtUymt6MRygkCicSdCgJgXNfCibuTJSrcQ9Dt9ID36OHFEmylJrF4Rj5XF39vjpthELFYDib9cF7aicCWO1pXcLZsxHH/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>balloonplot(tb, text.size=0.8,label.size=0.8)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100048056" data-ratio="0.6027777777777777" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4y4o2OcJon6icPUJdtChAGuz06PlsGWDrRHsDFAbFSzhjVSISLJxs2Kow/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4y4o2OcJon6icPUJdtChAGuz06PlsGWDrRHsDFAbFSzhjVSISLJxs2Kow/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器">还可以调整X/Y标签的角度：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100048058" data-ratio="0.608286252354049" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4yRb3bDcRdqHJXS77YpScqLPeUkc718ZicbmPCic5KdaHDYrQrJsqENMAA/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="1062" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4yRb3bDcRdqHJXS77YpScqLPeUkc718ZicbmPCic5KdaHDYrQrJsqENMAA/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器">以及标签字体的颜色：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100048057" data-ratio="0.615606936416185" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4y28ER80EgrHxwibJFGAh9iaFSO2AhQUJZVew9UD7bmM0ibLTS3EK0R30Sw/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="1038" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRuyUnpjViapfDNdFiau4jZ4y28ER80EgrHxwibJFGAh9iaFSO2AhQUJZVew9UD7bmM0ibLTS3EK0R30Sw/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><p data-tool="mdnice编辑器"><strong>balloonplot函数参数说明：</strong></p><p data-tool="mdnice编辑器"><code>x</code> : 一个表对象，或一个向量或几个类别向量的列表，其中包含打印矩阵的第一个（x）边距的分组变量。<br><code>y</code> : 矢量或矢量列表，用于对绘制矩阵的第二（y）维变量进行分组。<code>z</code> : 打印矩阵中点大小的值向量。<br><code>xlab</code> : x维度的文本标签。这将显示在X轴和绘图标题中。<br><code>ylab</code> : y标注的文本标签。这将显示在坐标轴和绘图标题中。<br><code>zlab</code> : 点大小的文本标签。这将包含在地块标题中。<br><code>dotsize</code> : 最大点大小。可能需要为不同的打印设备和布局调整此值。<br><code>dotchar</code> : 用于点的绘图符号或字符。有关符号代码的points函数，请参见帮助页。<br><code>dotcolor</code> : 指定绘图点颜色的标量或向量。<br><code>text.size, text.color</code> : 行和列标题的字符大小和颜色</p><p data-tool="mdnice编辑器">.......</p><h2 data-tool="mdnice编辑器"><span>结语</span></h2><p data-tool="mdnice编辑器"><span>本期，我们绘制饼图、堆积柱状图、箱线图、气泡图等，比较不同分组之间细胞比例差异。</span><strong><span>下一期，我们将利用胃癌</span><span>bulk</span><span>数据（TCGA-STAD）协助区分正常上皮和恶性上皮，其中还将涵盖差异分析、富集分析、KM生存分析等bulk RNA-seq数据的常规分析。干货满满，欢迎大家持续追更，谢谢！</span></strong><span></span></p><h3 data-tool="mdnice编辑器"><span>单细胞文献复现交流群</span></h3><p data-tool="mdnice编辑器">视频剪辑分享出来后，大家对单细胞文献复现的内容都很感兴趣，所以我们组建了一个交流群。<span>本次交流群会有两到三次的公开课，或者更多，相当于是月更啦。 </span><span><strong>提供收集整理好的单细胞文献复现相关全部代码和视频资料哦！</strong></span><span>群聊组建费用99元，因为可以参与直播互动交流，运营成本比较高。因为活动是一个月前举办了，所以现在看到推文的小伙伴肯定是</span><span>错过了群聊</span><span><strong>二维码</strong></span><span>进群的方式，</span><strong>也可以联系我们生信技能树的官方拉群小助手帮忙拉群哦！！！</strong><span></span></p><p data-tool="mdnice编辑器">（而且名额有限，微信群上限是500人，所以先到先得！！！另外，因为每次人数太多，<strong> 所以是每天上午十点准时拉群，务必发99元红包或者转账给生信技能树的官方拉群小助手哈</strong>，其他时间不予回复，望见谅）</p><p><span><strong><span>长按识别二维码</span></strong></span></p><p><br></p><p><span><strong><span>烦请备注</span></strong></span><span><strong><span>姓名+学校单位+月更<strong></strong></span></strong></span></p><p><img data-galleryid="" data-imgfileid="100048060" data-ratio="0.7980769230769231" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzZlicMJljba38tGHwh2ntW7heB67BzJHD8ePXyeCIicbQ39fmoFtXkXoKDy307r2RElWghJY09pdLA/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=wxpic" data-type="png" data-w="416" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzZlicMJljba38tGHwh2ntW7heB67BzJHD8ePXyeCIicbQ39fmoFtXkXoKDy307r2RElWghJY09pdLA/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=wxpic"></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/wF4ZiPZRwCZ9EupvWnXlUw",target="_blank" rel="noopener noreferrer">原文链接</a>
