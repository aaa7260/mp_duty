---
title: "如何整理好10x技术的单细胞转录组的表达量矩阵3文件"
date: 2024-07-23T08:16:28Z
draft: ["false"]
tags: [
  "fetched",
  "珠海健明生物医药科技"
]
categories: ["Acdemic"]
---
如何整理好10x技术的单细胞转录组的表达量矩阵3文件 by 珠海健明生物医药科技
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>今天的单细胞天地公众号分享了：<a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247520030&amp;idx=1&amp;sn=4aceee4581b1b33965f145c35008cf46&amp;scene=21#wechat_redirect" data-linktype="2">scanpy怎么分开读取GEO数据库的10X单细胞3个文件</a>，使用Python的scanpy分别读取3个文件后，再组合起来。在R也是可以这样操作，但是会很麻烦。之前在在单细胞天地教程：<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247490226&amp;idx=1&amp;sn=4fb0e8e871478acbd0fbfda504e7fa26&amp;scene=21#wechat_redirect" data-linktype="2">表达矩阵逆转为10X的标准输出3个文件</a>，详细介绍过 <strong>10X文件的3个标准文件</strong>。比如SRR7722939数据集里面，文件<code>barcodes.tsv</code> 和 <code>genes.tsv</code>，就是表达矩阵的行名和列名：</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code>jmzengdeMacBook-Pro:SRR7722939 jmzeng$ head barcodes.tsv<br>AAACCTGAGCGAAGGG-1<br>AAACCTGAGGTCATCT-1<br>AAACCTGAGTCCTCCT-1<br>AAACCTGCACCAGCAC-1<br>AAACCTGGTAACGTTC-1<br>AAACCTGGTAAGGATT-1<br>AAACCTGGTTGTCGCG-1<br>AAACCTGTCCTGCCAT-1<br>AAACGGGAGTCATCCA-1<br>AAACGGGCATGGATGG-1<br>jmzengdeMacBook-Pro:SRR7722939 jmzeng$ head genes.tsv<br>hg38_ENSG00000243485    hg38_RP11-34P13.3<br>hg38_ENSG00000237613    hg38_FAM138A<br>hg38_ENSG00000186092    hg38_OR4F5<br>hg38_ENSG00000238009    hg38_RP11-34P13.7<br>hg38_ENSG00000239945    hg38_RP11-34P13.8<br>hg38_ENSG00000239906    hg38_RP11-34P13.14<br>hg38_ENSG00000241599    hg38_RP11-34P13.9<br>hg38_ENSG00000279928    hg38_FO538757.3<br>hg38_ENSG00000279457    hg38_FO538757.2<br>hg38_ENSG00000228463    hg38_AP006222.2<br></code></pre><p data-tool="mdnice编辑器">但是<code>matrix.mtx</code>，就稍微复杂一点，仔细看：</p><pre data-tool="mdnice编辑器"><span></span><code>jmzengdeMacBook-Pro:SRR7722939 jmzeng$ head matrix.mtx<br>%%MatrixMarket matrix coordinate <span>integer</span> general<br>%<br>33694 2049 1878957<br>28 1 1<br>55 1 2<br>59 1 1<br>60 1 1<br>62 1 1<br>78 1 2<br>111 1 1<br></code></pre><p data-tool="mdnice编辑器">如果你关注这3个文件的行数：</p><pre data-tool="mdnice编辑器"><span></span><code>    2049 barcodes.tsv<br>   33694 genes.tsv<br> 1878960 matrix.mtx<br></code></pre><p data-tool="mdnice编辑器">就会发现，<code>matrix.mtx</code>文件里面的33694、2049、1878957数值，分别是细胞数量，基因数量，以及有表达量的值的数量（全部的值应该是33694X2049接近7000万，但是有值的仅仅是不到200万，所以单细胞矩阵里面只有3%左右的值大于0 ）。每个10X样本都是走流程拿到10x单细胞转录组数据的3个文件的表达矩阵。</p><p data-tool="mdnice编辑器">也就是说，我们拿到了的每个单细胞转录组项目的每个样品的文件名字通常是不符合规则，比如2022-GSE201048-羊癫疯患者大脑，如下所示：https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE201048</p><p data-tool="mdnice编辑器">每个样品的文件名字前面有前缀：</p><p><img data-galleryid="" data-imgfileid="100044702" data-ratio="1.0712962962962962" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx8tiaCRKgw4nvUrrmkMN50LYaokk3Z1x6Tzqr1RoTagyfNcQocp5sA3qibN9cxvuqoJl6SMibV7hz6Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx8tiaCRKgw4nvUrrmkMN50LYaokk3Z1x6Tzqr1RoTagyfNcQocp5sA3qibN9cxvuqoJl6SMibV7hz6Q/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>前面有前缀</figcaption></figure><p data-tool="mdnice编辑器">规则每个样品应该是有一个独立的文件夹，而文件夹里面的才是样品的3文件，而且文件名字需要是稳定的：文件名为 <code>features.tsv.gz</code>、<code>matrix.mtx.gz</code> 和 <code>barcodes.tsv.gz</code>。不能有自定义的稀奇古怪的名字！所以我们分享了一个简单的r代码整理它，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code> <br>fs=list.files(<span>'./'</span>,<span>'features.tsv.gz'</span>)<br>fs<br>samples1=gsub(<span>'_features.tsv.gz'</span>,<span>''</span>,fs)<br>samples1<br><br><span>library</span>(stringr)<br>samples2=str_split(samples1,<span>'_'</span>,simplify = <span>T</span>)[,<span>1</span>]<br>samples2 =samples1<br>length(unique(samples2))<br>samples2<br><br><span>#samples2 = samples1</span><br><br>lapply(<span>1</span>:length(samples2), <span>function</span>(i){<br>  x=samples2[i]<br>  y=samples1[i]<br>  dir.create(x,recursive = <span>T</span>)<br>  file.copy(from=paste0(y,<span>'_features.tsv.gz'</span>),<br>            to=file.path(x,  <span>'features.tsv.gz'</span> )) <br>  file.copy(from=paste0(y,<span>'_matrix.mtx.gz'</span>),<br>            to= file.path(x, <span>'matrix.mtx.gz'</span> ) ) <br>  file.copy(from=paste0(y,<span>'_barcodes.tsv.gz'</span>),<br>            to= file.path(x, <span>'barcodes.tsv.gz'</span> )) <br>  <br>})<br>  <br></code></pre><p data-tool="mdnice编辑器">然后让chatGPT帮我解释了一下：</p><p><img data-galleryid="" data-imgfileid="100044703" data-ratio="0.5407407407407407" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx8tiaCRKgw4nvUrrmkMN50Llkxzu8wgicEfUQB45OsiaBQPqFCkOC7IBmmhkhtlAsMzVCcglhCwFbMg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx8tiaCRKgw4nvUrrmkMN50Llkxzu8wgicEfUQB45OsiaBQPqFCkOC7IBmmhkhtlAsMzVCcglhCwFbMg/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">最后的结果很完美，每个单细胞样品都是一个独立的文件夹，然后每个文件夹里面都是 文件名为 <code>features.tsv.gz</code>、<code>matrix.mtx.gz</code> 和 <code>barcodes.tsv.gz</code>的3个文件，接下来就很容易读取啦！</p><p><img data-galleryid="" data-imgfileid="100044704" data-ratio="0.30648148148148147" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx8tiaCRKgw4nvUrrmkMN50LaKibqliasFW4dUYpLecQ06qicfLLQHlOUmJClF4aruQZ192yqyuuonxnA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx8tiaCRKgw4nvUrrmkMN50LaKibqliasFW4dUYpLecQ06qicfLLQHlOUmJClF4aruQZ192yqyuuonxnA/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">读取这个单细胞转录组项目的代码是：</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br>options(stringsAsFactors = <span>F</span>) <br><span>source</span>(<span>'scRNA_scripts/lib.R'</span>)<br>getwd()<br><br><span>###### step1: 导入数据 ######    </span><br>dir=<span>'GSE201048_RAW/outputs/'</span><br>samples=list.files( dir )<br>samples <br>sceList = lapply(samples,<span>function</span>(pro){ <br>  <span># pro=samples[1] </span><br>  print(pro)  <br>  tmp = Read10X(file.path(dir,pro )) <br>  <span>if</span>(length(tmp)==<span>2</span>){<br>    ct = tmp[[<span>1</span>]] <br>  }<span>else</span>{ct = tmp}<br>  sce =CreateSeuratObject(counts =  ct ,<br>                          project =  pro  ,<br>                          min.cells = <span>5</span>,<br>                          min.features = <span>300</span> )<br>  <span>return</span>(sce)<br>}) <br>do.call(rbind,lapply(sceList, dim))<br>sce.all=merge(x=sceList[[<span>1</span>]],<br>              y=sceList[ -<span>1</span> ],<br>              add.cell.ids = samples  ) <br>names(sce.all@assays$RNA@layers)<br>sce.all[[<span>"RNA"</span>]]$counts <br><span># Alternate accessor function with the same result</span><br>LayerData(sce.all, assay = <span>"RNA"</span>, layer = <span>"counts"</span>)<br>sce.all &lt;- JoinLayers(sce.all)<br>dim(sce.all[[<span>"RNA"</span>]]$counts )<br> <br>as.data.frame(sce.all@assays$RNA$counts[<span>1</span>:<span>10</span>, <span>1</span>:<span>2</span>])<br>head(sce.all@meta.data, <span>10</span>)<br>table(sce.all$orig.ident) <br><span>library</span>(stringr)<br>sce.all$orig.ident=str_split(colnames(sce.all),<span>'[-_]'</span>,simplify = <span>T</span>)[,<span>2</span>]<br>table(sce.all$orig.ident) <br>sce.all<br>  <br></code></pre></section><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528328&amp;idx=1&amp;sn=33055906f1dca6958238a84b48405cd5&amp;chksm=9b4b2f33ac3ca6255cdf3d9e1422c6610aebd2fdece36ea0bd9d1cf838cbf1521b599ae81abe&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授‍课（买一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528133&amp;idx=1&amp;sn=2fc6bf3e8455222628c9814d6509c74f&amp;chksm=9b4b2e7eac3ca7687d2f12b37fa48bfe1b060b3c204df87dbf6e277321cfaeb8f5e4d283ca1e&amp;scene=21#wechat_redirect" textvalue="月薪两万找生信练习生（线下）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">月薪两万找生信练习生（线下）</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247522831&amp;idx=2&amp;sn=1744efdf428465425a145ff3a982198b&amp;chksm=9b4bdab4ac3c53a28fbecbbff4f254f470b54a7a20468bb753b295b930315e1ec45bcbabc10b&amp;scene=21#wechat_redirect" textvalue="144线程640Gb内存服务器共享一年‍仍然是仅需800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">144线程640Gb内存服务器共享一年仍然是仅需800</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">千呼万唤始出来的独享生物信息学云服务器</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528144&amp;idx=1&amp;sn=be4d7e542d1077921024c86a4c130f16&amp;chksm=9b4b2e6bac3ca77d87a0ae0c12ae028d10225db19c8d7fb92b1299fa12f572bb769bcd92889b&amp;scene=21#wechat_redirect" textvalue="永久免费的生信进阶培训（线下）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">永久免费的生信进阶培训（线下）</a></section></li></ul><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/5isV907UEZFQ8ocFURwfKQ",target="_blank" rel="noopener noreferrer">原文链接</a>
