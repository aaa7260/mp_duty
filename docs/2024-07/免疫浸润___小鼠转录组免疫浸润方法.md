---
title: "免疫浸润 | 小鼠转录组免疫浸润方法"
date: 2024-07-16T04:17:25Z
draft: ["false"]
tags: [
  "fetched",
  "被炸熟的虾"
]
categories: ["Acdemic"]
---
免疫浸润 | 小鼠转录组免疫浸润方法 by 被炸熟的虾
------
<div><p><span>去年整理记录过一些常见的免疫浸润分析工具：</span><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><ul><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247485011&amp;idx=1&amp;sn=e460d01d02352b1bae0d9e6cb926f7ce&amp;chksm=c086da9bf7f1538d34b74d8191786036c6a38ce510b56e01152420fe02a469828aa11d4f65e7&amp;cur_album_id=3061444313034866693&amp;scene=21#wechat_redirect" data-linktype="2">免疫浸润 | ESTIMATE 原理与实践</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247485049&amp;idx=1&amp;sn=28403a5e99b3386e2d2fc77803a12c27&amp;chksm=c086dab1f7f153a7466668ee3af336eea122370a133948fdecbb24aebb629b6726840cff84b1&amp;scene=21&amp;cur_album_id=3061444313034866693#wechat_redirect" data-linktype="2">免疫浸润 | CIBERSORT 简述与实践</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247485054&amp;idx=1&amp;sn=922208eff01d132ba9c2ad78e76c74b7&amp;chksm=c086dab6f7f153a05d99b55921a545b72542c1898aacf9a50d1f026bb0ab6a9259e5d309e7a1&amp;scene=21&amp;cur_album_id=3061444313034866693#wechat_redirect" data-linktype="2">免疫浸润 | ssGSEA 简述与实践</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247485109&amp;idx=1&amp;sn=c4c552193ad73fa6b3ea59087ff823c2&amp;chksm=c086da7df7f1536bee846009561843d076b15d73de7bbfcf45ee7bd0bee3563bf3366e5f90b6&amp;scene=21&amp;cur_album_id=3061444313034866693#wechat_redirect" data-linktype="2">免疫浸润 | MCP-counter 简述与实践</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247485172&amp;idx=1&amp;sn=7243cfa554dc7b26f96fafe639acc53c&amp;chksm=c086da3cf7f1532adbe5d4ae05f23467c123f3a4df9e5e25fed65c5fd2bb94a65780b6820a6f&amp;scene=21&amp;cur_album_id=3061444313034866693#wechat_redirect" data-linktype="2">免疫浸润 | xCell 简述与实践</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247485451&amp;idx=1&amp;sn=a6e0a543baa1ae85935ad283c34b4e72&amp;chksm=c086d4c3f7f15dd56f5dbfbe0d0be6603e19a09d247c4cd39db69c6faf8f53d7683dcb4931db&amp;scene=21&amp;cur_album_id=3061444313034866693#wechat_redirect" data-linktype="2">TIMER 数据库的基础用法</a></section></li></ul><p><span>最近有小伙伴提醒才发现，上述整理都是针对人的，如果是小鼠的转录组数据应该如何操作呢？第一反应是做<strong>同源基因转换</strong>，全部转录组数据转换太麻烦，可以转换参考数据集啊！对于基于富集分析原理的免疫浸润方法应该可以试试，毕竟</span><span>MsigDB</span><span>推出小鼠基因集之前，大部分时候都是这么操作的，但是基于反卷积的方法可能还是需要斟酌一下。</span></p><h2><span>一、CIBERSORT</span></h2><section><span>CIBERSORT</span><span>基于线性支持向量回归（</span><span>linear support vector regression</span><span>）的原理进行<strong>反卷积分析</strong>。输入数据需要两个文件：</span></section><section><span><strong><span>1、表达矩阵文件：</span></strong></span></section><ul><li><section><span>不可以有缺失值和负数；</span></section></li><li><section><span>不可以</span><span>取</span><span>log</span><span>（</span><span>CIBERSORT</span><span>对于数据是否取过</span><span>log</span><span>会</span><span>有一个判断，如果取了</span><span>log</span><span>也会给你去掉）；</span></section></li><li><section><span>芯片数据不同平台有不同的要求，</span><span>Affymetrix</span><span>芯片建议进行</span><span>RMA</span><span>标准化，</span><span>illumina</span><span>芯片与</span><span>Agilent</span><span>芯片建议使用</span><code>limma</code><span>包进行标准化处理；</span></section></li><li><section><span>对于测序数据，不支持原始数据，而是建议使用</span><span>TPM</span><span>或</span><span>者</span><span>FPKM</span><span>。</span></section></li></ul><section><span><strong><span>2、参考数据集文件：</span></strong></span></section><p><span>之前的介绍中，我们使用了包自带的经典参考数据集：</span><span>LM22</span><span>。这个数据集来自下面的文章，包括</span><span>22</span><span>种免疫细胞类型。</span></p><blockquote><section><span>Robust enumeration of cell subsets from tissue expression profiles. Nat Methods. 2015 May. PMID: 25822800.</span></section><section><span>we designed and validated a leukocyte gene signature matrix, termed LM22. It contains 547 genes that distinguish 22 human hematopoietic cell phenotypes, including seven T cell types, naïve and memory B cells, plasma cells, NK cells, and myeloid subsets</span></section></blockquote><p><span>如果更换参考数据集，就可以进行不同物种的免疫浸润分析了。</span></p><p><span>文章</span><span>Inference of immune cell composition on the expression profiles of mouse tissue</span><span>提供了一个包含</span><span>2</span><span>5</span><span>种免疫细胞类型的参考数据集（记为</span><span>mi</span><span>c</span><span>e</span><span>），并提出了一个可以用于小鼠免疫浸润分析的新方法</span><span><strong><span>ImmuCC</span></strong></span><span>（原理与</span><span>CIBERSORT</span><span>类似</span><span>）。</span></p><pre><code>rm(list = ls())<br>setwd(<span>"D:/bioinformatics/R/7 Immune cell infiltration/CIBERSORT-raw"</span>)<br>load(<span>"D:/bioinformatics/R/7 Immune cell infiltration/data/GSE34378-Mice.Rdata"</span>)<br>pd &lt;- pd[pd$Tissue == <span>"liver"</span>,]<span>##保留肝组织</span><br>mixed_expr &lt;- <span>2</span>^exprSet[,pd$GSE]<br><br>Mice &lt;- read.csv(<span>"mice-signature.csv"</span>,row.names = <span>1</span>)<br><span>library</span>(CIBERSORT)<br>Miceresults &lt;- cibersort(sig_matrix = as.matrix(Mice), <br>                         mixture_file = as.matrix(mixed_expr),<br>                         perm = <span>100</span>,<br>                         QN = <span>T</span>)</code></pre><p><img data-galleryid="" data-imgfileid="100004152" data-ratio="1.0104529616724738" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KMhO4ux3R6Doq3IKzlDwqN2DEKoklqlKmPWzWdcv6OGibLGrqe8TLv98KKdYwRn8yaG612vib2SEfw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="861" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KMhO4ux3R6Doq3IKzlDwqN2DEKoklqlKmPWzWdcv6OGibLGrqe8TLv98KKdYwRn8yaG612vib2SEfw/640?wx_fmt=png&amp;from=appmsg"></p><h2><span>二、ssGSEA分析</span></h2><p><span>ssGSEA</span><span>分析即单样本基因富集分析，利用预定义的免疫细胞相关基因集，计算样本中各免疫细胞类型的富集得分。<strong>因此决定我们的分析是否可以应用于肿瘤或者非肿瘤、人或者小鼠的前提其实就是参考基因集的类型</strong>。</span></p><p><span>之前的笔记中，我们介绍了两个最常用的参考基因集：</span></p><ul><li><section><span>包括</span><span>28</span><span>种免疫细胞的基因集</span></section></li></ul><blockquote><p><span>Local mutational diversity drives intratumoral immune heterogeneity in non-small cell lung cancer. Nat Commun. 2018 Dec 18.PMID: 30560866.</span></p><p><span>Pan-cancer Immunogenomic Analyses Reveal Genotype-Immunophenotype Relationships and Predictors of Response to Checkpoint Blockade. Cell Rep. 2017 Jan 3. PMID: 28052254.</span></p></blockquote><ul><li><section><span><span>包括</span>16</span><span>种免疫细胞和</span><span>1</span><span>3</span><span>种免疫功能评分的基因集</span></section></li></ul><blockquote><p><span>Classification of triple-negative breast cancers based on Immunogenomic profiling. J Exp Clin Cancer Res. 2018 Dec 29. PMID: 30594216.</span></p></blockquote><p><span>此外</span><span>TISIDB</span><span>数据库也提供了很多不同类别的基因集：</span></p><p><span></span><span>http://cis.hku.hk/TISIDB/download.php</span></p><p><span>既然通路富集分析中经常使用同源基因转换后的基因集分析小鼠数据，个人观点，方法应该也可以迁移到这里</span></p><ul><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247486052&amp;idx=1&amp;sn=e4a85f6643194b9d70e2ce4df9899223&amp;scene=21#wechat_redirect" data-linktype="2">同源基因ID转换R包 homologene / babelgene</a><span></span></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAwMjY4MDE2Mg==&amp;mid=2247558880&amp;idx=1&amp;sn=a60077156d7fda2f02349947a9d6cde0&amp;scene=21#wechat_redirect" data-linktype="2">biomarRt 包</a></section></li></ul><p><span>注意转换并不是</span><span>100%</span><span>的，会有部分基因无法转换，部分基因出现一对多的情况。需要谨慎检查！！</span></p><pre><section><span># 9606     10090 9606_ID  10090_ID</span><br><span># 27   BCL2A1   Bcl2a1a     597     12044</span><br><span># 28   BCL2A1   Bcl2a1b     597     12045</span><br><span># 29   BCL2A1   Bcl2a1d     597     12047</span><br></section></pre><h2><span>三、MCPcounter分析</span></h2><p><span>MCPcounter</span><span>（</span><span>Microenvironment Cell Populations counter</span><span>）通过基因表达数据对肿瘤组织中的免疫和非免疫细胞进行定量估计。其原理是基于免疫和非免疫细胞类型的基因表达特征，通过线性回归模型，估计肿瘤组织中不同细胞类型的含量。</span></p><p><span>作者后续又开发了一个专门针对小鼠的版本：</span><span>mMCP-counter</span><span>！！</span></p><blockquote><p><span>The murine Microenvironment Cell Population counter method to estimate abundance of tissue-infiltrating immune and stromal cell populations in murine samples using gene expression. Genome Med. 2020 Oct 6. PMID: 33023656.</span></p></blockquote><pre><code><span>library</span>(devtools)<br>devtools::install_github(<span>"cit-bioinfo/mMCP-counter"</span>)<br></code></pre><p><span>MCPcounter</span><span>可评估</span><span>8</span><span>个免疫细胞和</span><span>2</span><span>个基质细胞的丰度，包括</span><span>T</span><span>细胞、</span><span>CD8+T</span><span>细胞、细胞毒性淋巴细胞、</span><span>NK</span><span>细胞、</span><span>B</span><span>淋巴细胞、单核细胞、髓系树突状细胞、中性粒细胞以及内皮细胞和成纤维细胞。</span><span>mMCP-counter</span><span>则可以鉴定</span><span>16</span><span>种细胞亚群丰度，包括</span><span>12</span><span>种免疫细胞（</span><span>T cells, CD8+ T cells, NK cells, B-derived cells, memory B cells, monocytes/macrophages, monocytes, granulocytes, mast cells, eosinophils, neutrophils, </span><span>和</span><span>basophils</span><span>），和</span><span>4</span><span>种基质细胞（</span><span>vessels, lymphatics, endothelial cells</span><span>,</span><span> 和</span><span>fibroblasts</span><span>）</span></p><p><span>mMCP-counter</span><span>只需要输入表达矩阵即可，所有的参数都是与</span><span>MCPcounter</span><span>类似的，但</span><span>mMCP-count</span><span>er</span><span>帮助文档明确指出分析前需要进行<strong>标准化</strong>并进行<strong>对数转换</strong>！！！</span></p><blockquote><p><span>To evaluate the various scoring algorithms, 24 mixtures were simulated with random proportions of each cell population. For the comparisons between mMCP-counter and other methods, 50 sets of mixtures were generated from the Haemopedia data (accessed as TPM-normalized data from www.haemosphere.org and log2-transformed) and ImmGen ULI data (accessed as raw counts from Gene Expression Omnibus (accession code GSE109125), normalized at the 75th percentile and log2-transformed).</span></p><p><span>exp: data frame containing the expression data. Genes must be in lines and samples in columns. Gene symbols must be specified as rownames. Gene expression data should be normalized and expressed in log scale.</span></p></blockquote><pre><code>load(<span>"D:/bioinformatics/R/7 Immune cell infiltration/data/GSE34378-Mice.Rdata"</span>)<br>pd &lt;- pd[pd$Tissue == <span>"liver"</span>,]<span>##保留肝组织</span><br>expressionData &lt;- exprSet[,pd$GSE]<br><br><span>library</span>(mMCPcounter)<br>?mMCPcounter::mMCPcounter.estimate<br>Results &lt;- mMCPcounter.estimate(exp = expressionData, <br>                                features = c(<span>"Gene.Symbol"</span>,<span>"ENSEMBL.ID"</span>,<span>"Probes"</span>)[<span>1</span>])<br><span>#Warning message:</span><br><span>#In mMCPcounter.estimate(expressionData, features = c("Gene.Symbol",  :</span><br><span>#  No genes were found for population(s): Eosinophils, Basophils, Monocytes, Memory B cells, Granulocytes. #Please ensure the genomeVersion argument is correct.</span></code></pre><h2><span>四、ImmuCellAI</span></h2><p><span>免疫浸润在线分析平台</span><span>ImmuCellAI</span><span>分别提供了人和小鼠的分析网站：</span></p><ul><li><section><span><span>ImmuCellAI</span><span>：</span></span></section></li></ul><section><span>https://guolab.wchscu.cn/ImmuCellAI/#!/</span></section><p><img data-imgfileid="100004150" data-ratio="0.5" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KMhO4ux3R6Doq3IKzlDwqNJvIOTicxcdTTVhRJLYkfYYqN6vAdBicw61a5CQfaZPUPrUhZ8jrXxkLQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KMhO4ux3R6Doq3IKzlDwqNJvIOTicxcdTTVhRJLYkfYYqN6vAdBicw61a5CQfaZPUPrUhZ8jrXxkLQ/640?wx_fmt=png&amp;from=appmsg"></p><ul><li><section><span><span>ImmuCellAI_mouse</span><span>：</span></span></section></li></ul><section><span>https://guolab.wchscu.cn/ImmuCellAI-mouse/#!/</span></section><p><img data-imgfileid="100004151" data-ratio="0.6101851851851852" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KMhO4ux3R6Doq3IKzlDwqN2RdqNIHUz2JyZosu2EgHYz2aPktcf9bYg4kZ4LfrUIqDibFpI01am6w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KMhO4ux3R6Doq3IKzlDwqN2RdqNIHUz2JyZosu2EgHYz2aPktcf9bYg4kZ4LfrUIqDibFpI01am6w/640?wx_fmt=png&amp;from=appmsg"></p><h3>参考文章：</h3><p><span><strong><span>1、挑圈联靠：</span></strong></span><a href="https://mp.weixin.qq.com/s?__biz=MzAwMjY4MDE2Mg==&amp;mid=2247582548&amp;idx=1&amp;sn=2f00dc741ec5cf3c0fb26d57fd15e21e&amp;scene=21#wechat_redirect" data-linktype="2"><span><strong><span>揭秘！小鼠和人的免疫浸润分析有何区别？看这篇就够了！</span></strong></span></a></p><p><span><strong><span>2、劝人学医TDLP：</span></strong></span><a href="https://mp.weixin.qq.com/s?__biz=MzkzNzMxNjgxMA==&amp;mid=2247492597&amp;idx=1&amp;sn=ede70adecdffdd164d6473ed90b620e4&amp;scene=21#wechat_redirect" data-linktype="2"><span><strong><span>R学习|基于基因表达数据通过mMCP-counter估计小鼠样本组织浸润免疫和基质细胞组成</span></strong></span></a></p><p><br></p><h3><span></span></h3></section><section><span></span></section><section><img data-imgfileid="100003752" data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-type="png" data-w="341" src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></section><section data-tools="135编辑器" data-id="116886" draggable="true"><section><section><section><section><strong data-brushtype="text">被炸熟的虾</strong></section></section></section><section><section><section data-width="35%"><section><img data-cropselx1="0" data-cropselx2="115" data-cropsely1="0" data-cropsely2="115" data-imgfileid="100003750" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-type="jpeg" data-w="258" data-width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></section></section><section data-width="63%"><section><section><strong>自己的摸索，发现问题麻烦告诉作者，光速回来改正</strong><strong><img data-imgfileid="100003751" data-ratio="1" data-type="png" data-w="64" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></strong></section></section></section></section></section></section></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/EpGZW90MN8yBGaJwRmKRgQ",target="_blank" rel="noopener noreferrer">原文链接</a>
