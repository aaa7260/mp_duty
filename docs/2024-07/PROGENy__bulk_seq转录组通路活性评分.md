---
title: "PROGENy--bulk-seq转录组通路活性评分"
date: 2024-07-29T09:05:59Z
draft: ["false"]
tags: [
  "fetched",
  "生信小博士"
]
categories: ["Acdemic"]
---
PROGENy--bulk-seq转录组通路活性评分 by 生信小博士
------
<div><h3 data-tool="mdnice编辑器"><strong><span>写在开头</span></strong></h3><p><span>前面我们已经完成了三次内容的分享，今天</span><span>今天写第三部分。</span><span></span></p><ul><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247486732&amp;idx=1&amp;sn=e7fdb946204fbcd19764c189019979eb&amp;chksm=ce6463e5f913eaf38f3a14e90f33b3aa4f417ac0cd7520ff495a5f37f80538f5dab7f5e4de74&amp;scene=21#wechat_redirect" textvalue="1.DoRothEA--单细胞转录因子评分" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>1.DoRothEA--单细胞转录因子评分</span></a><span></span></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247486720&amp;idx=1&amp;sn=448a51fb82b5262aa0a6c57268afe67e&amp;chksm=ce6463e9f913eaffe7082a2f1b44e4e85e78f66969982d7352f9b9e6ae39a0ccea54f9c3f39d&amp;scene=21#wechat_redirect" textvalue="2.PROGENy--单细胞通路活性评分" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>2.PROGENy--单细胞通路活性评分</span></a><span></span></p></li><li><p><span>3.PROGENy--转录组通路活性评分</span><span></span></p></li><li><p><span>4.<span>DoRothEA--转录组转录因子评分</span></span></p><hr><p><br></p></li></ul><p><span>正文部分</span><br></p><p>通常我们都是利用基因集合去做单细胞评分，那么是否可以通过<strong>有权重的基因集</strong><strong>来计算样本的通路活性</strong>？<span>这就</span>是PROGENy<span>开发出来的意义。之前我们分析了</span><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247486732&amp;idx=1&amp;sn=e7fdb946204fbcd19764c189019979eb&amp;chksm=ce6463e5f913eaf38f3a14e90f33b3aa4f417ac0cd7520ff495a5f37f80538f5dab7f5e4de74&amp;scene=21#wechat_redirect" textvalue="PROGENy在单细胞里的应用" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>PROGENy在单细胞里的应用</span></a></span><span>，</span>今天我们看看在bulk-seq转录组中，如何使用<span>PROGENy</span>。</p><p><span><br></span></p><h2 data-tool="mdnice编辑器"><span>加载r包和示例数据</span></h2><pre data-tool="mdnice编辑器"></pre><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="http"><code><span>rm(list=ls())</span></code><code><span>library(airway)</span></code><code><span>library(DESeq2)</span></code><code><span>data(airway)</span></code><code><span><br></span></code><code><span>library(data.table)</span></code><code><span>library(airway,quietly = T)</span></code><code><span>data(airway)</span></code><code><span><br></span></code></pre></section><h2 data-tool="mdnice编辑器"><span>获取表达矩阵和分组信息</span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="perl"><code><span>#1首先我们获取airway这个包里面的airway表达量矩阵，它有8个样品，分成了两组，我们命名为'control','case' ----</span></code><code><span>mat &lt;- assay(airway)  ;mat[1:4,1:8];colnames(mat)</span></code><code><span>mat=mat[,c('SRR1039513',"SRR1039517","SRR1039521",'SRR1039509',</span></code><code><span>           'SRR1039508', 'SRR1039520', 'SRR1039512', 'SRR1039516')]</span></code><code><span>keep_feature &lt;- rowSums (mat &gt; 1) &gt; 1 </span></code><code><span>ensembl_matrix &lt;- mat[keep_feature, ]  </span></code><code><span>library(AnnoProbe) </span></code><code><span>ids=annoGene(rownames(ensembl_matrix),'ENSEMBL','human') </span></code><code><span>ids=ids[!duplicated(ids$SYMBOL),]</span></code><code><span>ids=ids[!duplicated(ids$ENSEMBL),]</span></code><code><span>symbol_matrix= ensembl_matrix[match(ids$ENSEMBL,rownames(ensembl_matrix)),] </span></code><code><span>rownames(symbol_matrix) = ids$SYMBOL </span></code><code><span><br></span></code><code><span>data.frame(row.names = colnames(airway),grouplist=as.character(airway@colData$dex))</span></code><code><span>group_list = as.character(airway@colData$dex);group_list</span></code><code><span>group_list=ifelse(group_list=='untrt','control','case' ) </span></code><code><span>group_list = factor(group_list,levels = c('control','case' ))  </span></code><code><span><br></span></code><code><span>#其实可以使用下述的对应关系进行基因名称转换，防止AnnoProbe的滞后性</span></code><code><span>head(   as.data.frame(airway@rowRanges@elementMetadata@listData)  )</span></code><code><span><br></span></code><code><span>group_list</span></code><code><span>symbol_matrix[1:4,1:6]</span></code></pre></section><p><span><strong>表达矩阵，行为基因，列为样本</strong></span></p><p><img data-galleryid="" data-imgfileid="100003102" data-ratio="0.2506811989100817" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzOtfQC7hzhX7SBRCoEWEQTlleDfYxB5F9IASsRlgjz70A6K2RkOwmZVA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="734" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzOtfQC7hzhX7SBRCoEWEQTlleDfYxB5F9IASsRlgjz70A6K2RkOwmZVA/640?wx_fmt=png&amp;from=appmsg"></p><h2 data-tool="mdnice编辑器"><span>DEseq2差异分析（可选）</span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="properties"><code><span>#2如果做差异分析的话------</span></code><code><span>if (F)  {</span></code><code><span>  (colData &lt;- data.frame(row.names=colnames(symbol_matrix), </span></code><code><span>                         group_list=group_list) )</span></code><code><span>  dds &lt;- DESeqDataSetFromMatrix(countData = symbol_matrix,</span></code><code><span>                                colData = colData,</span></code><code><span>                                design = ~ group_list)</span></code><code><span>  dds &lt;- DESeq(dds) </span></code><code><span>  res &lt;- results(dds, </span></code><code><span>                 contrast=c("group_list",</span></code><code><span>                            levels(group_list)[2],</span></code><code><span>                            levels(group_list)[1]))</span></code><code><span>  resOrdered &lt;- res[order(res$padj),] </span></code><code><span>  DEG =as.data.frame(resOrdered)</span></code><code><span>  DEG_deseq2 = na.omit(DEG)</span></code><code><span>  head(DEG_deseq2)</span></code><code><span>}</span></code><code><span><br></span></code><code><span><br></span></code></pre></section><p><strong>差异分析结果：</strong></p><p><img data-galleryid="" data-imgfileid="100003085" data-ratio="0.20905459387483355" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzO3dTRXVXlt3wIEx2WDUX736RvHrLagickrz3P2gvAT5xibdhT2hjFHrPw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="751" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzO3dTRXVXlt3wIEx2WDUX736RvHrLagickrz3P2gvAT5xibdhT2hjFHrPw/640?wx_fmt=png&amp;from=appmsg"></p><h2 data-tool="mdnice编辑器"><span>progeny通路分析</span></h2><pre data-tool="mdnice编辑器"></pre><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="xml"><code><span><br></span></code><code><span>#3progeny通路分析--</span></code><code><span>library(progeny)</span></code><code><span>pathways &lt;- progeny(symbol_matrix,scale = TRUE, organism = "Human", top = 100,</span></code><code><span>                    perm = 1, verbose = FALSE)</span></code><code><span><br></span></code><code><span>pathways;colnames(airway)</span></code></pre></section><p><br></p><p><strong>获取的通路活性矩阵。注意：矩阵的行为样本，列为通路：</strong></p><p><img data-galleryid="" data-imgfileid="100003095" data-ratio="0.41086186540731995" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzOKiauPueSYK7bnLica87RYiaMic3vH67qyN9KibLibx8umTmSXlHEedw2S6Ng/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="847" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzOKiauPueSYK7bnLica87RYiaMic3vH67qyN9KibLibx8umTmSXlHEedw2S6Ng/640?wx_fmt=png&amp;from=appmsg"></p><p><span><strong><span>得到通路得分矩阵之后，后续的可视化就各显神通了！<br></span></strong></span></p><h2 data-tool="mdnice编辑器"><span>通路可视化 </span></h2><p><br></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>library(pheatmap)</span></code><code><span>myColor = colorRampPalette(c("Darkblue", "white","red"))(100)</span></code><code><span>pheatmap(pathways,fontsize=14, show_rownames = F, </span></code><code><span>         color=myColor, main = "PROGENy", angle_col = 45, treeheight_col = 0,  </span></code><code><span>         border_color = NA)</span></code><code><span><br></span></code></pre></section><p><strong>下面热图的行为样本，不符合常规，所以需要转置下矩阵<br></strong></p><p><img data-galleryid="" data-imgfileid="100003100" data-ratio="0.7203703703703703" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzOazfOPxKVngiaUyLqzF1BoGkrG2aIjwKh9x2CWchsmaOEyJraV7QSaBA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzOazfOPxKVngiaUyLqzF1BoGkrG2aIjwKh9x2CWchsmaOEyJraV7QSaBA/640?wx_fmt=png&amp;from=appmsg"></p><h2 data-tool="mdnice编辑器"><span>转置矩阵之后，再可视化</span></h2><p><br></p><section><ul><li><li><li><li><li></ul><pre data-lang="kotlin"><code><span><br></span></code><code><span>pheatmap(t(pathways),fontsize=14, show_rownames = T,scale = 'row', </span></code><code><span>         annotation_col  = data.frame(row.names = colnames(airway),grouplist=as.character(airway@colData$dex)) ,</span></code><code><span>         color=myColor, main = "PROGENy", angle_col = 45, treeheight_col = 0,  </span></code><code><span>         border_color = NA)</span></code></pre></section><p><strong><span>这个热图横轴就是PROGENy分析的14个与肿瘤发生发展的信号了，纵轴是各个样本。在实际应用中，只需要提供自己数据的基因表达矩阵即可。</span></strong><span></span></p><p><img data-galleryid="" data-imgfileid="100003097" data-ratio="0.7064814814814815" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzOv9PaiaUt1icmV75o1VB6BwGQuyCU2ibkXWq06KUZeAILlPn0nNPHRbABg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzOv9PaiaUt1icmV75o1VB6BwGQuyCU2ibkXWq06KUZeAILlPn0nNPHRbABg/640?wx_fmt=png&amp;from=appmsg"></p><p><strong>加上组别信息<br></strong></p><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span>pheatmap(t(pathways)[,c('SRR1039513',"SRR1039517","SRR1039521",'SRR1039509',</span></code><code><span>                        'SRR1039508', 'SRR1039520', 'SRR1039512', 'SRR1039516')],</span></code><code><span>         fontsize=14, show_rownames = T,scale = 'row', cluster_rows = T,</span></code><code><span>         cluster_cols = FALSE,</span></code><code><span>          annotation_col  = data.frame(row.names = colnames(airway),grouplist=as.character(airway@colData$dex)) ,</span></code><code><span>         color=myColor, main = "PROGENy", angle_col = 45, treeheight_col = 0,  </span></code><code><span>         border_color = NA)</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100003101" data-ratio="0.7175925925925926" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzOJ77FZWDkLvTNQBMNqaGlnb2n842O03icS2pvs37oiaHnkibvYBAkKjQ7Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzOJ77FZWDkLvTNQBMNqaGlnb2n842O03icS2pvs37oiaHnkibvYBAkKjQ7Q/640?wx_fmt=png&amp;from=appmsg"></p><h2 data-tool="mdnice编辑器"><span>结尾</span></h2><p><span></span><br></p><p><strong>从我的示例数据的热图结果上看。progeny通路分析对此数据集的效果不是很好，control 和treat组别之间的区别不是非常明显。</strong><br></p><p>但是！是否可以把<span>control 和treated</span><span>组别的值取个平均值，再进行可视化，效果是否会好些呢？这个问题就留给读者吧。</span></p><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg2NDcxMzYwNg==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sks7JhVxUX46ZKxPSob6ptqIZgnIEnHOn5VMwCX8sN6MQy1Pq4XXFEOJ6grAmsoQugyCDKOZictDBHA/0?wx_fmt=png" data-nickname="生信小博士" data-alias="bioinformatics_Dr" data-signature="【生物信息学】R语言开始，学习生信。Seurat，单细胞测序，空间转录组。 Python，scanpy，cell2location。资料分享" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><section><ul><li><li><li><li></ul><pre data-lang="javascript"><code><span>参考：</span></code><code><span>https:<span>//saezlab.github.io/progeny/articles/ProgenySingleCell.html</span></span></code><code><span>https:<span>//www.jianshu.com/p/4058050d546e</span></span></code><code><span>https:<span>//saezlab.github.io/progeny/articles/progeny.html</span></span></code></pre></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/KXhQc_S4oQ4VoAd7IX1uUw",target="_blank" rel="noopener noreferrer">原文链接</a>
