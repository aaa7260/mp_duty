---
title: "听说你想画个月亮富集图？"
date: 2024-07-29T16:24:15Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
听说你想画个月亮富集图？ by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><section><mp-common-profile data-pluginname="mpprofile" data-id="MzkyMTI1MTYxNA==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezgsqIGqjITSMggCTSoViaYeoKe2xoZr1IIvNJoztibQxibYHLDDoiabwAc6Ggws3Tvdo8EPss2nLgaVQ/0?wx_fmt=png" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-from="0" data-is_biz_ban="0"></mp-common-profile></section></section><section><mp-common-clmusic data-pluginname="insertaudio" type="1" music_name="%E8%B0%81%E6%98%8E%E6%B5%AA%E5%AD%90%E5%BF%83" albumurl="http://wx.y.gtimg.cn/music/photo_new/T002R500x500M000003mwGsZ4OHBk4_4.jpg" singer="王杰" duration="301000" username="" music_source="1" is_vip="1" listenid="78221634042953856"></mp-common-clmusic></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>引言</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p>尝试一下这个富集分析图形，由两种条件下的富集结果组成，由两个半圆形表示两组数据：</p></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100030399" data-ratio="0.9875690607734806" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewnErQDYSniaJ2jem3E7WpCoaQQcQhvVut7x39NzjxXArbQ6vBlWJYiaFfOS5voQqkZEV3eSFrAs5hQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="724" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewnErQDYSniaJ2jem3E7WpCoaQQcQhvVut7x39NzjxXArbQ6vBlWJYiaFfOS5voQqkZEV3eSFrAs5hQ/640?wx_fmt=png&amp;from=appmsg"></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100030398" data-ratio="1.3171428571428572" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewnErQDYSniaJ2jem3E7WpCod4RSoHJEdWzZj09Ya2593VmKQKmYeqQEN8L7TlXxZGRBPxrrWgzuJw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="350" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewnErQDYSniaJ2jem3E7WpCod4RSoHJEdWzZj09Ya2593VmKQKmYeqQEN8L7TlXxZGRBPxrrWgzuJw/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>测试</span><span></span></h2><p data-tool="mdnice编辑器">先来个测试数据：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggplot2)<br><span>library</span>(org.Hs.eg.db)<br><span>library</span>(gggibbous)<br><span>library</span>(clusterProfiler)<br><span>library</span>(dplyr)<br><br><span># load test data</span><br>data(geneList, package=<span>"DOSE"</span>)<br><br><span># check</span><br>head(geneList)<br><span># 4312     8318    10874    55143    55388      991</span><br><span># 4.572613 4.514594 4.418218 4.144075 3.876258 3.677857</span><br></code></pre><p data-tool="mdnice编辑器">然后两波富集分析，注意一定要同时设置 <strong>qvalueCutoff = 1 pvalueCutoff = 1</strong> 才能获取所有富集结果：</p><pre data-tool="mdnice编辑器"><span></span><code><span># enrichment for control</span><br>ego1 &lt;- enrichGO(gene = names(geneList)[<span>1</span>:<span>500</span>],<br>                 OrgDb = org.Hs.eg.db,<br>                 keyType = <span>"ENTREZID"</span>,<br>                 ont = <span>"ALL"</span>,<br>                 qvalueCutoff = <span>1</span>,<br>                 pvalueCutoff = <span>1</span>,<br>                 readable = <span>T</span>)<br><br><span># get top 6 terms for visualization</span><br>ego1_df &lt;- data.frame(ego1) %&gt;%<br>  group_by(ONTOLOGY) %&gt;%<br>  arrange(pvalue) %&gt;%<br>  slice_head(n = <span>6</span>) %&gt;%<br>  mutate(type = <span>"control"</span>)<br><br><span># enrichment for treat</span><br>ego2 &lt;- enrichGO(gene = names(geneList)[<span>501</span>:<span>1000</span>],<br>                 OrgDb = org.Hs.eg.db,<br>                 keyType = <span>"ENTREZID"</span>,<br>                 ont = <span>"ALL"</span>,<br>                 qvalueCutoff = <span>1</span>,<br>                 pvalueCutoff = <span>1</span>,<br>                 readable = <span>T</span>)<br><br>ego2_df &lt;- data.frame(ego2) %&gt;%<br>  filter(Description %<span>in</span>% ego1_df$Description) %&gt;%<br>  mutate(type = <span>"treat"</span>)<br></code></pre><p data-tool="mdnice编辑器">合并一下结果：</p><pre data-tool="mdnice编辑器"><span></span><code><span># combine data</span><br>cb &lt;- rbind(ego1_df,ego2_df) %&gt;%<br>  rowwise() %&gt;%<br>  mutate(fc = eval(parse(text = GeneRatio))/eval(parse(text = BgRatio)),<br>         side = ifelse(type == <span>"control"</span>,<span>TRUE</span>,<span>FALSE</span>))<br></code></pre><p data-tool="mdnice编辑器">最后就是画图，学废了吗：</p><pre data-tool="mdnice编辑器"><span></span><code><span># PLOT</span><br>ggplot(cb) +<br>  geom_moon(aes(x = fc,y = Description,<br>                ratio = <span>0.5</span>,<br>                right = side,<br>                size = Count,<br>                fill = type)) +<br>  facet_wrap(~ONTOLOGY,ncol = <span>1</span>,<br>             strip.position = <span>"right"</span>) +<br>  theme_bw() +<br>  theme(panel.grid = element_blank(),<br>        axis.text = element_text(color = <span>"black"</span>),<br>        strip.text = element_text(face = <span>"bold"</span>,size = rel(<span>1</span>))) +<br>  scale_fill_manual(values = c(<span>"#FF0033"</span>,<span>"#0066CC"</span>)) +<br>  ylab(<span>""</span>) + xlab(<span>"Fold Enrichment"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030400" data-ratio="1.2616690240452617" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewnErQDYSniaJ2jem3E7WpCo5JZ5iaUFEJsRgicIItnOviblpiaPp3mic64oJjfUvpnsy5E3duQ8HTwj6QQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="707" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewnErQDYSniaJ2jem3E7WpCo5JZ5iaUFEJsRgicIItnOviblpiaPp3mic64oJjfUvpnsy5E3duQ8HTwj6QQ/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>结尾</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong>路漫漫其修远兮,吾将上下而求索。</strong></p></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">欢迎加入生信交流群。加我微信我也拉你进 <strong>微信群聊</strong> <strong>老俊俊生信交流群</strong> <strong>(微信交流群需收取 20 元入群费用,一旦交费,拒不退还!(防止骗子和便于管理))</strong> 。QQ 群可免费加入, 记得进群按格式修改备注哦。</p><section data-tool="mdnice编辑器"><section><p><strong>老俊俊微信：</strong></p><figure><img data-imgfileid="100030397" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewnErQDYSniaJ2jem3E7WpCo9tHrZzPGvDm3brtFQLiaSKqw3y60iaUqsgSwsVJS8BSTX3X5HJobqIYQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="430" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewnErQDYSniaJ2jem3E7WpCo9tHrZzPGvDm3brtFQLiaSKqw3y60iaUqsgSwsVJS8BSTX3X5HJobqIYQ/640?wx_fmt=png&amp;from=appmsg"></figure><figure><img data-imgfileid="100030401" data-ratio="1.3668430335097002" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewnErQDYSniaJ2jem3E7WpCoGyWTqL3gicqucBAYGnLdYKCnZb6Pyr7madQI5KPmzQs8L8gRdMV4Vqg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="567" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewnErQDYSniaJ2jem3E7WpCoGyWTqL3gicqucBAYGnLdYKCnZb6Pyr7madQI5KPmzQs8L8gRdMV4Vqg/640?wx_fmt=png&amp;from=appmsg"></figure></section><section><p><strong>知识星球：</strong></p><figure><img data-imgfileid="100030406" data-ratio="1.5896226415094339" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4usewnErQDYSniaJ2jem3E7WpCogZXQIYwuM53pAnhKmxrCnB0jyMYtKcBzbic5wHNcxGoejuD5c48d1CA/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1060" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4usewnErQDYSniaJ2jem3E7WpCogZXQIYwuM53pAnhKmxrCnB0jyMYtKcBzbic5wHNcxGoejuD5c48d1CA/640?wx_fmt=jpeg&amp;from=appmsg"></figure></section></section><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><strong></strong></p><center data-tool="mdnice编辑器"><strong> 往期回顾目录</strong></center><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong></strong></p><center><strong><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247514040&amp;idx=1&amp;sn=3d7005394edf920db316a4afceda3d01&amp;chksm=c1848dc9f6f304df5624b8e0177c543fb210a07a0daa47efcb9b1520fba166c6c070860480a3&amp;token=736408649&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">enrichCluster 关于非模式物种富集分析的使用</a></strong></center><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513973&amp;idx=1&amp;sn=00ce573d81657bf2c985abc8bb6c8422&amp;chksm=c1848d04f6f3041222971f1933b4de0a7f99766ef99982c2560d5d4ff7ad0d0006a29fb7f56e&amp;token=1438488422&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">tidyCoverage 计算 bigwig 文件在目标区域的信号</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513953&amp;idx=1&amp;sn=7c9eb4545986fa9187cdd66cae8b1456&amp;chksm=c1848d10f6f30406d0bc3a86b3aa0150eb7191aea24bc4b9e366e0c04bc0be13a0a382253dfa&amp;token=1202987559&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">桑基图加富集图一行代码出图?</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513935&amp;idx=1&amp;sn=7149af238f8ae9ef1750349fef7e79e9&amp;chksm=c1848d3ef6f3042892939e2ddee645b405c6a007fc290ff8e67f5cceeb7af37ff2cb11f1df93&amp;token=1267815615&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">GEO 上传数据最新教程</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513903&amp;idx=1&amp;sn=7406e159002c4f5a11dffb74cd8bc16c&amp;chksm=c1848d5ef6f304485adeb4927b95318412d1f2d3aaddc21a6a60d58c4f4cac9d2c02340421e3&amp;token=350392803&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">试试 bulkRNA 做拟时序分析？</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513809&amp;idx=1&amp;sn=05eb04b579b04ff5b20f3cab2f52406a&amp;chksm=c1848ca0f6f305b6005b1f9853a79843be0e582f7519c234350a6b22b81f7d07f5d749dbe87b&amp;token=350392803&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ClusterGVis 绘制 lineplot 的优化</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513792&amp;idx=1&amp;sn=b71dffea7f6dd9ad8acaec98ee99678c&amp;chksm=c1848cb1f6f305a7c85b54cbc9f40e2aaffefbc119654d533cd0aef2480eda6e7946295d5008&amp;token=1799964631&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">RNAseqQC 给你的数据来个全面的 QC 检查</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513652&amp;idx=1&amp;sn=4750e40c39e055b0b8b6dae51d70c620&amp;chksm=c1848c45f6f30553044afacb5ea3544afd63287fd90f60858859b873db060019a569208590e9&amp;token=1799964631&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">如何 Pull Request 到 github 贡献你的代码</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513591&amp;idx=2&amp;sn=24c65a23ae46dfd31757b8e5a4c5908d&amp;chksm=c1848f86f6f30690024b4d74a8a4beadd5a4691ee30df9287ed42b24a9e1fd42f531adecde9e&amp;token=1130224323&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ggplot 添加分类型数据双坐标轴</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513571&amp;idx=1&amp;sn=65c28c7798caee6a68208c7f8c50cc2b&amp;chksm=c1848f92f6f3068409d1036f0b038d7d127cee7c897138b12ddc34dc13f7b019136342582d86&amp;token=1130224323&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">富集分析流星图?</a></center></strong><p><br></p></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/zo6mIFmGA9nQcaKID0lrew",target="_blank" rel="noopener noreferrer">原文链接</a>
