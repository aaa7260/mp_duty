---
title: "GO 富集结果可视化优化笔记"
date: 2024-07-11T11:42:05Z
draft: ["false"]
tags: [
  "fetched",
  "seqyuan"
]
categories: ["Acdemic"]
---
GO 富集结果可视化优化笔记 by seqyuan
------
<div><section><ul><li><li><li><li><li></ul><pre data-lang="R"><code><span>library(clusterProfiler)</span></code><code><span>library(ggplot2)</span></code><code><span>library(dplyr)</span></code><code><span>library(org.Hs.eg.db)</span></code><code><span>library(viridis)</span></code></pre></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="R"><code><span>genes_df &lt;- read.table('genes.txt') # 一列基因，SYMBOL格式</span></code><code><span><br></span></code><code><span>geneID &lt;- bitr(genes_df$V1, fromType = "SYMBOL", </span></code><code><span>               toType = c("ENTREZID", "SYMBOL"),</span></code><code><span>               OrgDb = org.Hs.eg.db) </span></code><code><span><br></span></code><code><span>all.GO &lt;- enrichGO(gene = geneID$ENTREZID,</span></code><code><span>                    OrgDb = org.Hs.eg.db,</span></code><code><span>                    keyType = "ENTREZID",</span></code><code><span>                    ont = "ALL",</span></code><code><span>                    pAdjustMethod = "BH",</span></code><code><span>                    pvalueCutoff = 0.01,</span></code><code><span>                    qvalueCutoff = 0.05,</span></code><code><span>                    readable = T)</span></code><code><span><br></span></code><code><span>allgg &lt;- as.data.frame(all.GO)</span></code><code><span><br></span></code><code><span># 按照pvalue取每个ONTOLOGY的前5</span></code><code><span>top5 &lt;- allgg %&gt;%</span></code><code><span>  group_by(ONTOLOGY) %&gt;%</span></code><code><span>  arrange(pvalue) %&gt;%</span></code><code><span>  slice_head(n = 5)</span></code><code><span><br></span></code><code><span># 我这里设置的只取CC和MF</span></code><code><span>df_top5 &lt;- rbind(subset(top5, ONTOLOGY=="CC"), subset(top5, ONTOLOGY=="MF"))</span></code><code><span><br></span></code><code><span>df_top5$ONTOLOGY &lt;- factor(df_top5$ONTOLOGY, levels=c('CC', 'MF'))</span></code><code><span>df_top5$Description &lt;- factor(df_top5$Description, levels = rev(df_top5$Description))</span></code></pre></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="R"><code><span>options(repr.plot.width=7, repr.plot.height=6.5)</span></code><code><span><br></span></code><code><span>mycol3 &lt;- c('#6BA5CE', '#F5AA5F')</span></code><code><span>cmap &lt;- c("viridis", "magma", "inferno", "plasma", "cividis", "rocket", "mako", "turbo")</span></code><code><span><br></span></code><code><span>p &lt;- ggplot(data = df_top5, aes(x = Count, y = Description, fill=ONTOLOGY)) +</span></code><code><span>     geom_bar(width = 0.5,stat = 'identity') +</span></code><code><span>     theme_classic() + </span></code><code><span>     scale_x_continuous(expand = c(0,0.5)) +</span></code><code><span>     scale_fill_manual(values = alpha(mycol3, 0.66))</span></code><code><span><br></span></code><code><span>p &lt;- p + theme(axis.text.y = element_blank()) + </span></code><code><span>     geom_text(data = df_top5,</span></code><code><span>            aes(x = 0.1, y = Description, label = Description),</span></code><code><span>            size = 4.8,</span></code><code><span>            hjust = 0) </span></code><code><span><br></span></code><code><span>p &lt;- p + geom_text(data = df_top5,</span></code><code><span>            aes(x = 0.1, y = Description, label = geneID , color=-log10(pvalue)),</span></code><code><span>            size = 4,</span></code><code><span>            fontface = 'italic',</span></code><code><span>            hjust = 0,</span></code><code><span>            vjust = 2.7) +</span></code><code><span>          scale_colour_viridis(option=cmap[7], direction=-1) </span></code><code><span><br></span></code><code><span>p &lt;- p + labs(title = 'Enriched top 5 CC and MF') +</span></code><code><span>     theme(</span></code><code><span>      plot.title = element_text(size = 14, face = 'bold'),</span></code><code><span>      axis.title = element_text(size = 13),</span></code><code><span>      axis.text = element_text(size = 11),</span></code><code><span>      axis.ticks.y = element_blank())</span></code><code><span><br></span></code><code><span><br></span></code><code><span>ggsave("gene_GO.pdf", p, w=7, h=6.5)</span></code><code><span><br></span></code></pre></section><p><img data-galleryid="" data-imgfileid="100000769" data-ratio="0.9465648854961832" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/SiacuSjV1nDyG17fpco6bc6xvw2gHSmqicF5k18z1iaWyU9r34fcp8TSicaqEV1c4nxy5a5q4CicTwnkVChk77bcvSQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="655" src="https://mmbiz.qpic.cn/mmbiz_png/SiacuSjV1nDyG17fpco6bc6xvw2gHSmqicF5k18z1iaWyU9r34fcp8TSicaqEV1c4nxy5a5q4CicTwnkVChk77bcvSQ/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/VsAHJhuhbUBe1EJUA8Vy9Q",target="_blank" rel="noopener noreferrer">原文链接</a>
