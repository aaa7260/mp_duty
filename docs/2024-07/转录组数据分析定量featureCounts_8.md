---
title: "转录组数据分析定量featureCounts-8"
date: 2024-07-09T04:38:50Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
转录组数据分析定量featureCounts-8 by 生信菜鸟团
------
<div><blockquote data-tool="mdnice编辑器"><p><span>从我们</span><span>生信技能树</span><span>历年的几千个马拉松授课学员里面募集了一些优秀的创作者，某种意义来说是传承了我们生信技能树的知识整理和分享的思想！</span></p></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">今天的是三周合计15天的数据挖掘授课学员一点一滴整理的授课知识点笔记哦，还有互动练习题哈，欢迎大家点击文末的阅读原文去关注我们学员的公众号哦！</p><p data-tool="mdnice编辑器"><br></p><p><span>生信技能树学习笔记</span><span></span></p><p><span>         <br></span></p><p><span>         <shape type="#_x0000_t75" filled="f"><imagedata title="image1"></imagedata></shape><img data-ratio="0.5361010830324909" data-type="png" data-w="554" data-src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibEjHbYRbp3CriabKapLBpH8kjaibIW9Pl3L4YyVdZEF274ZcUexjicVwxA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-imgfileid="100040339" src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibEjHbYRbp3CriabKapLBpH8kjaibIW9Pl3L4YyVdZEF274ZcUexjicVwxA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></span><span></span></p><p><span>官网：</span><span>http://bioinf.wehi.edu.au/featureCounts/</span></p><p><span><img data-ratio="0.5667870036101083" data-type="png" data-w="554" data-src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibM4I0CiclSH7UsoFeods1ctvibru7befgrYauD7IGD1dYGL1OOSMjfyoQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-imgfileid="100040338" src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibM4I0CiclSH7UsoFeods1ctvibru7befgrYauD7IGD1dYGL1OOSMjfyoQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></span><span>featureCounts 需要两个输入文件：</span></p><p><span>1.比对产生的BAM/ SAM文件</span></p><p><span>2.区间注释文件（GTF格式，SAF格式）</span></p><p><span><img data-ratio="0.40794223826714804" data-type="png" data-w="554" data-src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibnkgpenhRs5RRyPkc22GDiaVLgPy5oMe644aofJQFZhKsHDWTONAo48Q/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-imgfileid="100040336" src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibnkgpenhRs5RRyPkc22GDiaVLgPy5oMe644aofJQFZhKsHDWTONAo48Q/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></span><span></span></p><p><span>使用featureCounts对bam文件进行定量</span><span>具体流程</span><span></span></p><table cellspacing="0" cellpadding="0" width="677"><tbody><tr><td width="339" valign="top"><p><span>cd $HOME/project/Human-16-Asthma-Trans/Expression/featureCounts</span></p><p><span>                 <br></span></p><p><span>## 定义输入输出文件夹</span></p><p><span>gtf=/home/t_rna/database/GRCh38.104/Homo_sapiens.GRCh38.104.chr.gtf.gz</span></p><p><span>inputdir=$HOME/project/Human-16-Asthma-Trans/Mapping/Hisat2/</span></p><p><span>                 <br></span></p><p><span># featureCounts对bam文件进行计数</span></p><p><span>featureCounts -T 6 -p -t exon -g gene_id -a $gtf -o all.id.txt $inputdir/*.sorted.bam</span></p><p><span>                 <br></span></p><p><span># 对定量结果质控</span></p><p><span>multiqc all.id.txt.summary</span></p><p><span>                 <br></span></p><p><span># 得到表达矩阵</span></p><p><span># 处理表头，/home/rna/要换成自己的路径</span></p><p><span>less -S all.id.txt |grep -v '#' |cut -f 1,7- |sed 's#/home/rna/project/Human-16-Asthma-Trans/Mapping/Hisat2//##g' |sed 's#.Hisat_aln.sorted.bam##g' &gt;raw_counts.txt</span></p><p><span>                 <br></span></p><p><span>sed s///</span></p><p><span>sed s###</span></p><p><span>sed s%%%</span></p><p><span>                 <br></span></p><p><span>                 <br></span></p><p><span># 列对齐显示</span></p><p><span>head raw_counts.txt<span>  </span>|column -t</span><span></span></p></td></tr></tbody></table><p><span><img data-ratio="0.22743682310469315" data-type="png" data-w="554" data-src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ib2h8FahpTYhFmR6J8ckIxZb8hYXXWicJQLa8wy549KrOj6wx0QdmrQPQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-imgfileid="100040337" src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ib2h8FahpTYhFmR6J8ckIxZb8hYXXWicJQLa8wy549KrOj6wx0QdmrQPQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></span><span></span></p><p><span>featureCounts的结果解析</span></p><p><span><img data-ratio="0.5252707581227437" data-type="png" data-w="554" data-src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibK8J8584MzmZI8Ck2CyL16bPMqsft58gzcKQVXJhia1BYeO9sPZUpFWg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-imgfileid="100040335" src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibK8J8584MzmZI8Ck2CyL16bPMqsft58gzcKQVXJhia1BYeO9sPZUpFWg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></span><span></span></p><p><span><img data-ratio="0.05595667870036101" data-type="png" data-w="554" data-src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ib8RUG8sRYokCcn7DDDDicXH756fvJIJa6JJxM4iazGDeqZ9gHBK0vkX6g/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-imgfileid="100040340" src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ib8RUG8sRYokCcn7DDDDicXH756fvJIJa6JJxM4iazGDeqZ9gHBK0vkX6g/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></span><span></span></p><p><span><img data-ratio="0.5180505415162455" data-type="png" data-w="554" data-src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ib4LaOJDK5A06waMu0CKF7ZHsqhH8NsHLZuaXmMpvQqR9CpelrrV5ibww/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-imgfileid="100040343" src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ib4LaOJDK5A06waMu0CKF7ZHsqhH8NsHLZuaXmMpvQqR9CpelrrV5ibww/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></span><span></span></p><p><span>         <br></span></p><p><span>另一个定量软件——salmon</span><span></span></p><p><span>官网：</span><span>http://combine-lab.github.io/salmon/</span></p><p><span><img data-ratio="0.41335740072202165" data-type="png" data-w="554" data-src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibJmibz6nbXRiblk2gnJAXgLqO1hlicQzVUic3u3kjsmiagPfCpn06PKaGpWw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-imgfileid="100040341" src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibJmibz6nbXRiblk2gnJAXgLqO1hlicQzVUic3u3kjsmiagPfCpn06PKaGpWw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></span><span></span></p><p><span>salmon：alignment-free的定量</span></p><p><span>Salmon可以快速从fastq快速得到基因表达</span></p><p><span>Salmon参考文档：</span><span>https://salmon.readthedocs.io/en/latest/</span><span></span></p><p><span># 构建salmon索引</span></p><p><span>salmon<span>  </span>index<span>   </span>-t Homo_sapiens.GRCh38.cdna.all.fa<span>  </span>-i salmon_index</span></p><p><span>-t：参考基因组fasta文件，可以接受压缩格式</span></p><p><span>-i：存储索引的文件夹名</span></p><p><span><img data-ratio="0.23433874709976799" data-type="png" data-w="431" data-src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibvHBUvibvULp7C8hMe1aYyeVR3iaYUzsRvEV3e6oaESGbibWOBlliatVAmw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-imgfileid="100040342" src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibvHBUvibvULp7C8hMe1aYyeVR3iaYUzsRvEV3e6oaESGbibWOBlliatVAmw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></span><span></span></p><p><span><img data-ratio="1.0451977401129944" data-type="png" data-w="177" data-src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibkCjDDyuun8pY2GPlG9ER9BFkQ8eotmHNpO9vYibJ9k5gxicD1gzUpZcg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-imgfileid="100040344" src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibkCjDDyuun8pY2GPlG9ER9BFkQ8eotmHNpO9vYibJ9k5gxicD1gzUpZcg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></span><span></span></p><p><span><img data-ratio="0.6787564766839378" data-type="png" data-w="386" data-src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibPuIvvLkzQeDf8a9mial3Swky8hnbiaibosvQm4PsYEgJwiarMBAOhjnWCQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-imgfileid="100040345" src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibPuIvvLkzQeDf8a9mial3Swky8hnbiaibosvQm4PsYEgJwiarMBAOhjnWCQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></span><span></span></p><p><span>分析流程</span><span></span></p><table cellspacing="0" cellpadding="0" width="677"><tbody><tr><td width="332" valign="top"><p><span>##----构建索引</span></p><p><span>## 后续索引可直接使用服务器上已经构建好的进行练习</span></p><p><span>cd $HOME/database/GRCh38.105</span></p><p><span>nohup salmon index -t Homo_sapiens.GRCh38.cdna.all.fa -i salmon_index &gt;salmon-index.log &amp;</span></p><p><span>cd $HOME/project/Human-16-Asthma-Trans/Expression/Salmon</span></p><p><span>                 <br></span></p><p><span>##----运行</span></p><p><span># 编写脚本，使用salmon批量对目录下所有fastq文件进行定量</span></p><p><span># vim salmon.sh</span></p><p><span>index=/home/t_rna/database/GRCh38.104/salmon_index</span></p><p><span>input=$HOME/project/Human-16-Asthma-Trans/data/cleandata/trim_galore</span></p><p><span>outdir=$HOME/project/Human-16-Asthma-Trans/Expression/Salmon</span></p><p><span>cat ../../data/cleandata/trim_galore/ID |while read id</span></p><p><span>do</span></p><p><span><span>  </span>salmon<span> </span>quant -i ${index} -l A -1 ${input}/${id}_1_val_1.fq.gz -2 ${input}/${id}_2_val_2.fq.gz -p 5 -o ${outdir}/${id}.quant</span></p><p><span>done</span></p><p><span>                 <br></span></p><p><span>##----合并表达矩阵</span></p><p><span># 原始count值矩阵</span></p><p><span># --quants：ls -d *quant |tr '\n' ',' |sed 's/,$//' |awk '{print "{" $0 "}" }'</span></p><p><span># --quants：ls -d *quant |sed ':a;N;s/\n/,/;t a;'|awk '{print "{"$0"}"}'</span></p><p><span># --quants：ls -d *quant |xargs<span>  </span>|tr ' ' ',' |awk '{print "{"$0"}"}'</span></p><p><span># --names：ls -d *quant |tr '\n' ',' |sed 's/,$//' |awk '{print "{"$0"}"}' |sed 's/.quant//g'</span></p><p><span>                 <br></span></p><p><span>## 完整版：ls -d *quant |tr '\n' ',' |sed 's/,$//' |awk '{print "{"$0"}"}'<span>  </span>| perl -ne 'chomp;$a=$_;$a=~s/\.quant//g;print"salmon quantmerge --quants $_ --names $a --column numreads<span>  </span>--output raw_count.txt \n";'</span></p><p><span>                 <br></span></p><p><span>salmon quantmerge --quants {SRR1039510.quant,SRR1039511.quant,SRR1039512.quant} --names {SRR1039510,SRR1039511,SRR1039512} --column numreads<span>  </span>--output raw_count.txt</span></p><p><span>                 <br></span></p><p><span># tpm矩阵</span></p><p><span>salmon quantmerge --quants {SRR1039510.quant,SRR1039511.quant,SRR1039512.quant} --names {SRR1039510,SRR1039511,SRR1039512} --column tpm<span>  </span>--output tpm.txt</span></p><p><span>                 <br></span></p><p><span># 后台运行脚本</span></p><p><span>nohup sh salmon.sh &gt;salmon.log &amp;</span><span></span></p></td></tr></tbody></table><p><span><img data-imgfileid="100040346" data-ratio="0.51985559566787" data-src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibCAYk88IheRC2YsXtaI0sBy1JrfWpBwVEnYWVibScYfkvtnNyOibl2LzQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="554" src="https://mmbiz.qpic.cn/mmbiz_png/GZQAk2yOQM94ibwn053MZ8dkbKH8mib29ibCAYk88IheRC2YsXtaI0sBy1JrfWpBwVEnYWVibScYfkvtnNyOibl2LzQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></span></p><p><br></p><h3 data-tool="mdnice编辑器"><span>文末友情宣传</span></h3><p data-tool="mdnice编辑器"><strong>强烈建议你推荐给身边的博士后以及年轻生物学PI，多一点数据认知，让他们的科研上一个台阶：</strong></p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247530001&amp;idx=1&amp;sn=676dcf224f9be23b288189775292aeeb&amp;chksm=9b4b36aaac3cbfbc3e3bb0865bd789d5093e3a643f3f345332995f707b7f209ae924e9e9529e&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授课（买‍一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;scene=21#wechat_redirect" data-linktype="2">时隔5年，我们的生信技能树VIP学徒继续招生啦</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;scene=21#wechat_redirect" data-linktype="2">2024的共享服务器交个朋友福利价仍然是800</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;scene=21#wechat_redirect" data-linktype="2">千呼万唤始出来的独享生物信息学云服务器</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528144&amp;idx=1&amp;sn=be4d7e542d1077921024c86a4c130f16&amp;scene=21#wechat_redirect" data-linktype="2">永久免费的生信进阶培训（线下）</a></section></li></ul><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/ttMPI3iz_BbM9o5RPijo5w",target="_blank" rel="noopener noreferrer">原文链接</a>
