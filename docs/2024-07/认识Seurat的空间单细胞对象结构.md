---
title: "认识Seurat的空间单细胞对象结构"
date: 2024-07-22T08:00:31Z
draft: ["false"]
tags: [
  "fetched",
  "珠海健明生物医药科技"
]
categories: ["Acdemic"]
---
认识Seurat的空间单细胞对象结构 by 珠海健明生物医药科技
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>前面我们提到了空间单细胞约等于10x技术，就比较方便理解，虽然说也有其它空间单细胞技术可以产出各式各样的数据。详见：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247527318&amp;idx=1&amp;sn=31b9b7edfc17ce302eb5f77b3e345e7c&amp;scene=21#wechat_redirect" data-linktype="2">10x的空间单细胞文件格式详解</a></p></blockquote><p data-tool="mdnice编辑器"><strong>但是对初学者来说，重要的是如何把不同技术产出的表达量矩阵导入到R或者Python这样的编程语言环境里面</strong>。今天我们来介绍的是在R语言里面的最流行的Seurat的单细胞流程，第一步就是理解Seurat的空间单细胞对象结构。值得注意的是我们接下来（2023年12月30日之后）的教程都是基于Seurat的V5版本哦：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247518295&amp;idx=1&amp;sn=f97bd58d2c21122ba5c7d250f7fa709e&amp;scene=21#wechat_redirect" data-linktype="2">初试Seurat的V5版本</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247518314&amp;idx=1&amp;sn=b53feba8104cfb9a377518852e871c66&amp;scene=21#wechat_redirect" data-linktype="2">使用Seurat的v5来读取多个10x的单细胞转录组矩阵</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247527174&amp;idx=1&amp;sn=a062d9fc438756b4953fb0d71bfaee51&amp;scene=21#wechat_redirect" data-linktype="2">使用Seurat的v5来读取多个不是10x标准文件的单细胞项目</a></section></li></ul><h3 data-tool="mdnice编辑器"><span></span>示范数据（10x技术）<span></span></h3><p data-tool="mdnice编辑器">来源于：https://satijalab.org/seurat/articles/spatial_vignette.html#x-visium</p><p data-tool="mdnice编辑器">因为我们要介绍的是Seurat的空间单细胞对象结构，所以理论上使用Seurat的官方数据是最好的，但是它依赖于一个github包，对很多人来说因为在中国大陆地区，所以访问它会有一点点难度。</p><p data-tool="mdnice编辑器">首先安装这个SeuratData包，它在satijalab的github上面，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>  <span>library</span>(devtools) <span>#本地安装需要devtools </span><br>  devtools::install_github(<span>'satijalab/seurat-data'</span>)<br>  <span>library</span>(SeuratData)<br></code></pre><p data-tool="mdnice编辑器">如果因为在中国大陆地区上面的代码失败了，就需要想办法找人帮你下载上面的seurat-data离线本地安装包然后本地安装也是一样的效果哈。</p><p data-tool="mdnice编辑器">然后有了SeuratData包， 就可以使用它来安装任意示例数据集啦。</p><pre data-tool="mdnice编辑器"><span></span><code>  <span>library</span>(SeuratData)<br>  options(timeout=<span>100000</span>)<br>  AvailableData()<br>  InstallData(<span>"stxBrain"</span>)<br>  <span># https://github.com/satijalab/seurat-data </span><br>  <br>  <span># trying URL 'http://seurat.nygenome.org/src/contrib/stxBrain.SeuratData_0.1.1.tar.gz'</span><br>  <span># Content type 'application/octet-stream' length 110346050 bytes (105.2 MB)</span><br></code></pre><p data-tool="mdnice编辑器">上面的代码其实就是参考 https://github.com/satijalab/seurat-data  的代码后给你去 http://seurat.nygenome.org/ 下载一个 离线本地安装包然后本地安装也是一样的效果哈，比如上面的 stxBrain.SeuratData_0.1.1.tar.gz ，因为有 (105.2 MB)，如果你在中国大陆地区上，那么面的代码失败也是很正常的。</p><p data-tool="mdnice编辑器">安装示例数据成功之后就可以载入它然后查看这个，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>brain &lt;- LoadData(<span>"stxBrain"</span>, type = <span>"anterior1"</span>)<br>brain<br><br>&gt; brain<br>An object of class Seurat <br><span>31053</span> features across <span>2696</span> samples within <span>1</span> assay <br>Active assay: Spatial (<span>31053</span> features, <span>0</span> variable features)<br> <span>2</span> layers present: counts, data<br> <span>1</span> image present: anterior1<br></code></pre><p data-tool="mdnice编辑器">上面的示例数据是31053个基因在2696个样品（10个左右的细胞，spot等）里面的表达量矩阵的空间单细胞数据。</p><p><img data-galleryid="" data-imgfileid="100043690" data-ratio="0.8699186991869918" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx4hfNb3liaVd1uk9xj5gmXoviaqAG5IJvibbMbmnpibVJ5eibkWMlDUQAH26zKJicos6h3JMpoX91iahQww/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="738" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx4hfNb3liaVd1uk9xj5gmXoviaqAG5IJvibbMbmnpibVJ5eibkWMlDUQAH26zKJicos6h3JMpoX91iahQww/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">它里面的自带了一个图片信息， 一个表达量矩阵哦。简单的看看里面的结构发现第一层就有13个子对象，我们可以一个个来看看</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; str(brain)<br>Formal class <span>'Seurat'</span> [package <span>"SeuratObject"</span>] with 13 slots<br>  ..@ assays      :List of 1<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>首先看对象里面的每个sample的属性（meta.data元素）<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>&gt; dim(brain@meta.data)<br>[1] 2696    5<br>&gt; head(brain@meta.data)<br>                   orig.ident nCount_Spatial nFeature_Spatial slice<br>AAACAAGTATCTCCCA-1  anterior1          13069             4242     1<br>AAACACCAATAACTGC-1  anterior1          37448             7860     1<br>AAACAGAGCGACTCCT-1  anterior1          28475             6332     1<br>AAACAGCTTTCAGAAG-1  anterior1          39718             7957     1<br>AAACAGGGTCTATATT-1  anterior1          33392             7791     1<br>AAACATGGTGAGAGGA-1  anterior1          20955             6291     1<br></code></pre><p data-tool="mdnice编辑器">对这个meta.data元素可以做各种各样的统计，因为它就是一个普通的数据框而已。</p><h4 data-tool="mdnice编辑器"><span></span>然后看表达量矩阵（assays相关元素）<span></span></h4><p data-tool="mdnice编辑器">它里面存储着最原始的表达量矩阵，以及不同算法处理过程的各种中间过程矩阵</p><p><img data-galleryid="" data-imgfileid="100043692" data-ratio="0.42314814814814816" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx4hfNb3liaVd1uk9xj5gmXojhLzdImvjniah2LnHxO7P8Lw96ZY2JI88wAaydulsLmhHlibdRo70x3w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx4hfNb3liaVd1uk9xj5gmXojhLzdImvjniah2LnHxO7P8Lw96ZY2JI88wAaydulsLmhHlibdRo70x3w/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">另外就是，如果经过了SCT的算法处理，会在assays下面多一个：</p><pre data-tool="mdnice编辑器"><span></span><code>brain &lt;- SCTransform(brain, assay = <span>"Spatial"</span>, verbose = <span>FALSE</span>)<br><span>#它构建基因表达的正则化负二项式模型，以便在保留生物学差异的同时考虑技术伪影</span><br><br><br>&gt; brain@assays$SCT<br>SCTAssay data with <span>17668</span> features <span>for</span> <span>2696</span> cells, and <span>1</span> SCTModel(s) <br>Top <span>10</span> variable features:<br> Ttr, Hbb-bs, Mbp, Plp1, Hba-a1, Ptgds, Penk, Hba-a2, S100a5,<br>Fabp7 <br></code></pre><p data-tool="mdnice编辑器">目前看到的绝大部分文档都是说SCT的算法比较适合空间单细胞转录组的表达量矩阵的处理哦。</p><h4 data-tool="mdnice编辑器"><span></span>然后看看空间信息（images元素）<span></span></h4><p data-tool="mdnice编辑器">它里面存储的全部的空间信息，里面的元素也可以打开一个个探索：</p><p><img data-galleryid="" data-imgfileid="100043691" data-ratio="0.5053304904051172" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx4hfNb3liaVd1uk9xj5gmXoVib8QmfzHIygB884ePujXcicY3ZZ2n4HI9DVV6YxPEptrLWaQNT38mDA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="938" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx4hfNb3liaVd1uk9xj5gmXoVib8QmfzHIygB884ePujXcicY3ZZ2n4HI9DVV6YxPEptrLWaQNT38mDA/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">比如样品的空间切片坐标信息：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; head(brain@images<span>$anterior1</span>@coordinates)<br>                   tissue row col imagerow imagecol<br>AAACAAGTATCTCCCA-1      1  50 102     7475     8501<br>AAACACCAATAACTGC-1      1  59  19     8553     2788<br>AAACAGAGCGACTCCT-1      1  14  94     3164     7950<br>AAACAGCTTTCAGAAG-1      1  43   9     6637     2099<br>AAACAGGGTCTATATT-1      1  47  13     7116     2375<br>AAACATGGTGAGAGGA-1      1  62   0     8913     1480<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>然后看看降维聚类等信息（reductions元素）<span></span></h4><p data-tool="mdnice编辑器">其中reductions可以是pca，tsne，umap等等，前提是需要对这个对象跑相关的降维代码。比如如果我们跑了代码：</p><pre data-tool="mdnice编辑器"><span></span><code><span>### 我们可以继续对 RNA 表达数据进行降维和聚类，使用与 scRNA-seq 分析相同的工作流程。</span><br>brain &lt;- RunPCA(brain, assay = <span>"SCT"</span>, verbose = <span>FALSE</span>)<br>brain &lt;- FindNeighbors(brain, reduction = <span>"pca"</span>, dims = <span>1</span>:<span>30</span>)<br>brain &lt;- FindClusters(brain, verbose = <span>FALSE</span>)<br>brain &lt;- RunUMAP(brain, reduction = <span>"pca"</span>, dims = <span>1</span>:<span>30</span>)<br></code></pre><p data-tool="mdnice编辑器">就可以看到下面的pca和umap的降维结果啦 ：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; brain@reductions<br><span>$pca</span><br>A dimensional reduction object with key PC_ <br> Number of dimensions: 50 <br> Number of cells: 2696 <br> Projected dimensional reduction calculated:  FALSE <br> Jackstraw run: FALSE <br> Computed using assay: SCT <br><br><span>$umap</span><br>A dimensional reduction object with key umap_ <br> Number of dimensions: 2 <br> Number of cells: 2696 <br> Projected dimensional reduction calculated:  FALSE <br> Jackstraw run: FALSE <br> Computed using assay: SCT<br></code></pre><p data-tool="mdnice编辑器">如果有了降维信息的Seurat的空间对象，就可以可视化啦。如下所示的代码：</p><pre data-tool="mdnice编辑器"><span></span><code>p1 &lt;- DimPlot(brain, reduction = <span>"umap"</span>, label = <span>TRUE</span>)<br>p1<br>p2 &lt;- SpatialDimPlot(brain, label = <span>TRUE</span>, label.size = <span>3</span>)<br>p2<br>p1 + p2<br></code></pre><p data-tool="mdnice编辑器">效果如下所示（坐标是UMAP的二维坐标散点图，右边是该样品的空间切片坐标）：</p><p><img data-galleryid="" data-imgfileid="100043693" data-ratio="0.4425925925925926" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx4hfNb3liaVd1uk9xj5gmXoDnNyVBt1bUPbxozTBsUuquCMpyMjxxZTpPic0nwy2TMSXmAGoEfLkWA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx4hfNb3liaVd1uk9xj5gmXoDnNyVBt1bUPbxozTBsUuquCMpyMjxxZTpPic0nwy2TMSXmAGoEfLkWA/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>空间可视化</figcaption></figure><h4 data-tool="mdnice编辑器"><span></span>其它简单信息<span></span></h4><p data-tool="mdnice编辑器">比如记录了这个对象在操作过程中（降维聚类分群等等）每个步骤的函数和参数（其实大部分情况下都是默认参数）：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; brain@commands<br><span>$SCTransform</span>.Spatial<br>Command: SCTransform(brain, assay = <span>"Spatial"</span>, verbose = FALSE)<br>Time: 2023-12-30 16:36:40.493752<br>assay : Spatial <br>new.assay.name : SCT <br>do.correct.umi : TRUE <br>ncells : 5000 <br>variable.features.n : 3000 <br>variable.features.rv.th : 1.3 <br></code></pre><p data-tool="mdnice编辑器">再比如版本信息：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; brain@version<br>[1] ‘5.0.1’<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>如果是两个数据对象的合并<span></span></h4><p data-tool="mdnice编辑器">代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><span>## 老鼠大脑的这个数据集包含另一个对应于大脑另一半的切片。在这里，我们将其读入并执行相同的初始归一化。</span><br>brain2 &lt;- LoadData(<span>"stxBrain"</span>, type = <span>"posterior1"</span>) <span>#直接读取另一半大脑的数据</span><br>brain2 &lt;- SCTransform(brain2, assay = <span>"Spatial"</span>, verbose = <span>FALSE</span>) <span>#直接用SCTransform代替标准化、找高变与归一化三步</span><br><br><span># 为了在同一个 Seurat 对象中处理多个切片，我们提供了该merge函数。</span><br>brain.merge &lt;- merge(brain, brain2) <span>#校正后的数据，两个脑切片一起整合</span><br><br><span># 然后，这可以对基础 RNA 表达数据进行联合降维和聚类。</span><br>DefaultAssay(brain.merge) &lt;- <span>"SCT"</span><br>VariableFeatures(brain.merge) &lt;- c(VariableFeatures(brain), VariableFeatures(brain2))<br>brain.merge &lt;- RunPCA(brain.merge, verbose = <span>FALSE</span>)<br>brain.merge &lt;- FindNeighbors(brain.merge, dims = <span>1</span>:<span>30</span>)<br>brain.merge &lt;- FindClusters(brain.merge, verbose = <span>FALSE</span>)<br>brain.merge &lt;- RunUMAP(brain.merge, dims = <span>1</span>:<span>30</span>)<br>DimPlot(brain.merge, reduction = <span>"umap"</span>, group.by = c(<span>"ident"</span>, <span>"orig.ident"</span>))<br>SpatialDimPlot(brain.merge)<br></code></pre><p data-tool="mdnice编辑器">当然了，绝大部分情况下没有必要合并，因为每个样品自己的空间切片坐标信息是自己的。所以它最后的可视化仍然是每个样品独立，如下所示：</p><p><img data-galleryid="" data-imgfileid="100043694" data-ratio="0.43703703703703706" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx4hfNb3liaVd1uk9xj5gmXon7icon5ykwiazPmDTc894yBDkWlzG3CyUQSJibv8lSUN13pR6al0QtN5Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wx4hfNb3liaVd1uk9xj5gmXon7icon5ykwiazPmDTc894yBDkWlzG3CyUQSJibv8lSUN13pR6al0QtN5Q/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>每个样品独立的空间信息</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span>示范数据（Slide-seq技术）<span></span></h3><p data-tool="mdnice编辑器">来源于：https://satijalab.org/seurat/articles/spatial_vignette.html#slide-seq</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(SeuratData)<br>options(timeout=<span>100000</span>)<br>InstallData(<span>"ssHippo"</span>)<br>slide.seq &lt;- LoadData(<span>"ssHippo"</span>)<br>slide.seq<br></code></pre><p data-tool="mdnice编辑器">因为也是Seurat的空间单细胞对象，所以基本上跟上面介绍的小鼠的大脑的空间切片单细胞转录组同样的数据分析思路。</p><h3 data-tool="mdnice编辑器"><span></span>标准10x技术空间单细胞文件的导入后的对象结构<span></span></h3><p data-tool="mdnice编辑器">需要理解Seurat包的一些跟10x技术空间单细胞文件的导入相关的函数，比如：</p><pre data-tool="mdnice编辑器"><span></span><code>Read10X Load <span>in</span> data from 10X<br>Read10X_h5 Read 10X hdf5 file<br>Read10X_Image Load a 10X Genomics Visium Image <br>Load10X_Spatial Load a 10x Genomics Visium Spatial Experiment into a <span>'Seurat'</span> object <br></code></pre><p data-tool="mdnice编辑器">这些细节都可以在：https://rdrr.io/github/satijalab/seurat/src/R/preprocessing.R 里面找到。</p><p data-tool="mdnice编辑器">如果是标准10x技术空间单细胞文件，只需要 Load10X_Spatial 函数即可一步到位，所以就不再赘述啦。如果想搞清楚什么是标准10x技术空间单细胞文件，详见：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247527318&amp;idx=1&amp;sn=31b9b7edfc17ce302eb5f77b3e345e7c&amp;scene=21#wechat_redirect" data-linktype="2">10x的空间单细胞文件格式详解</a></p></section><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247527207&amp;idx=1&amp;sn=fb9ca814003fc24e9ec8b1bcecbd1d56&amp;chksm=9b4b2b9cac3ca28afc5b68047e5f0587b6636d52879051decd573009e38313c5f7d6b0d1927d&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授课（买一得‍五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课，春节前最后一次</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247522831&amp;idx=2&amp;sn=1744efdf428465425a145ff3a982198b&amp;chksm=9b4bdab4ac3c53a28fbecbbff4f254f470b54a7a20468bb753b295b930315e1ec45bcbabc10b&amp;scene=21#wechat_redirect" textvalue="144线程640Gb内存服务器共享一年‍仍然是仅需800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">144线程640Gb内存服务器共享一年仍然是仅需800</a></section></li></ul><p><span>空间单细胞</span><span><span>3</span></span></p><p><span>空间单细胞 · 目录</span></p><p><span role="button"><span><span>上一篇</span><span><span>学正宗的空间单细胞就得跟着10x官网</span></span></span></span></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Z8xVeuWV8h_kf-E0r86cjw",target="_blank" rel="noopener noreferrer">原文链接</a>
