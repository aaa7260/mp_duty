---
title: "网络爬虫 —— xml2 和 lxml"
date: 2024-07-02T10:46:23Z
draft: ["false"]
tags: [
  "fetched",
  "生信杂货铺"
]
categories: ["Acdemic"]
---
网络爬虫 —— xml2 和 lxml by 生信杂货铺
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>xml2</span><span></span></h2><p data-tool="mdnice编辑器"><code>xml2</code> 包是对 <code>libxml2</code> （<code>C</code> 编写的库）的封装，可以很方法快速地在 <code>R</code> 中解析 <code>XML</code> 和 <code>HTML</code> 文件，前面我们也使用了两个读取函数和两个解析函数。</p><p data-tool="mdnice编辑器"><code>read_xml</code> 和 <code>read_html</code> 基本上是一样的，都可以读取字符串、文件或在线网址</p><pre data-tool="mdnice编辑器"><span></span><code>content &lt;- <span>'&lt;gene type="protein coding" id="7157"&gt;<br>    &lt;name alias="P53"&gt;TP53&lt;/name&gt;<br>    &lt;position base="0"&gt;<br>        &lt;chrom&gt;chr17&lt;/chrom&gt;<br>        &lt;start&gt;7571720&lt;/start&gt;<br>        &lt;end&gt;7590868&lt;/end&gt;<br>    &lt;/position&gt;<br>&lt;/gene&gt;'</span><br><br>tree &lt;- read_xml(content)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>结点信息</span><span></span></h3><p data-tool="mdnice编辑器">每个结点对象都有一些保存了一些该结点的基本信息，可使用下面的函数来获取</p><section data-tool="mdnice编辑器"><table><thead><tr><th>函数</th><th>功能</th><th>函数</th><th>功能</th></tr></thead><tbody><tr><td><code>xml_attrs</code></td><td>获取所有属性的值</td><td><code>xml_attr</code></td><td>获取指定属性的值</td></tr><tr><td><code>xml_has_attr</code></td><td>是否存在某一属性</td><td><code>xml_name</code></td><td>属性标签</td></tr><tr><td><code>xml_text</code></td><td>获取结点包含的所有文本信息</td><td><code>xml_structure</code></td><td>展示结点的结构</td></tr><tr><td><code>xml_type</code></td><td>获取结点的类型</td><td><code>xml_path</code></td><td>获取结点的 <code>XPath</code> 表达式</td></tr></tbody></table></section><p data-tool="mdnice编辑器">获取结点的属性</p><pre data-tool="mdnice编辑器"><span></span><code>xml_attrs(tree)<br><span>#             type               id </span><br><span># "protein coding"           "7157" </span><br>xml_attr(tree, <span>'id'</span>)<br><span># [1] "7157"</span><br>xml_has_attr(tree, <span>"id"</span>)<br><span># [1] TRUE</span><br>xml_has_attr(tree, <span>"name"</span>)<br><span># [1] FALSE</span><br></code></pre><p data-tool="mdnice编辑器">获取结点对应的标签</p><pre data-tool="mdnice编辑器"><span></span><code>xml_name(tree)<br><span># [1] "gene"</span><br></code></pre><p data-tool="mdnice编辑器">获取结点的所有文本信息，会将子结点的信息也合并在一起</p><pre data-tool="mdnice编辑器"><span></span><code>xml_text(tree)<br><span># [1] "TP53chr1775717207590868"</span><br></code></pre><p data-tool="mdnice编辑器">获取结点的结构化信息</p><pre data-tool="mdnice编辑器"><span></span><code>xml_structure(tree)<br><span># &lt;gene [type, id]&gt;</span><br><span>#   &lt;name [alias]&gt;</span><br><span>#     {text}</span><br><span>#   &lt;position [base]&gt;</span><br><span>#     &lt;chrom&gt;</span><br><span>#       {text}</span><br><span>#     &lt;start&gt;</span><br><span>#       {text}</span><br><span>#     &lt;end&gt;</span><br><span>#       {text}</span><br></code></pre><p data-tool="mdnice编辑器">获取 <code>position</code> 结点的类型以及 <code>XPath</code> 表达式</p><pre data-tool="mdnice编辑器"><span></span><code>pos &lt;- html_elements(tree, xpath = <span>"position"</span>)<br>xml_type(pos)<br><span># [1] "element"</span><br>xml_path(pos)<br><span># [1] "/gene/position"</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>结点关系</span><span></span></h3><p data-tool="mdnice编辑器">结点一般都会单独存在，都会与其他节点构成不同层级的关系，如子结点、父节点和兄弟节点等，获取结点关系的函数有</p><section data-tool="mdnice编辑器"><table><thead><tr><th>函数</th><th>功能</th><th>函数</th><th>功能</th></tr></thead><tbody><tr><td><code>xml_children</code></td><td>获取所有元素结点</td><td><code>xml_child</code></td><td>获取指定位置的子结点</td></tr><tr><td><code>xml_contents</code></td><td>获取所有子结点</td><td><code>xml_parents</code></td><td>获取所有祖先结点</td></tr><tr><td><code>xml_siblings</code></td><td>获取所有兄弟结点</td><td><code>xml_parent</code></td><td>返回结点的父结点</td></tr><tr><td><code>xml_length</code></td><td>返回子结点的数量</td><td><code>xml_root</code></td><td>获取根结点</td></tr></tbody></table></section><p data-tool="mdnice编辑器">获取指定位置的子结点</p><pre data-tool="mdnice编辑器"><span></span><code>xml_child(pos, <span>2</span>)<br><span># {xml_node}</span><br><span># &lt;start&gt;</span><br>xml_child(pos, <span>3</span>)<br><span># {xml_node}</span><br><span># &lt;end&gt;</span><br>xml_length(pos)<br><span># [1] 3</span><br></code></pre><p data-tool="mdnice编辑器">获取所有元素子结点</p><pre data-tool="mdnice编辑器"><span></span><code>test &lt;- <span>'&lt;test&gt;<br>  Hello &lt;br/&gt;<br>  &lt;bold&gt;<br>    World<br>  &lt;/bold&gt;<br>&lt;/test&gt;'</span><br>x &lt;- read_xml(test)<br>xml_children(x)<br><span># {xml_nodeset (2)}</span><br><span># [1] &lt;br/&gt;</span><br><span># [2] &lt;bold&gt;\n    World\n  &lt;/bold&gt;</span><br></code></pre><p data-tool="mdnice编辑器"><code>xml_contents</code> 会获取所有子结点，包含元素子结点和字符串结点</p><pre data-tool="mdnice编辑器"><span></span><code>xml_contents(x)<br><span># {xml_nodeset (5)}</span><br><span># [1] \n  Hello </span><br><span># [2] &lt;br/&gt;</span><br><span># [3] \n  </span><br><span># [4] &lt;bold&gt;\n    World\n  &lt;/bold&gt;</span><br><span># [5] \n</span><br>sapply(xml_contents(x), xml_type)<br><span># [1] "text"    "element" "text"    "element" "text" </span><br></code></pre><p data-tool="mdnice编辑器">获取元素的父结点</p><pre data-tool="mdnice编辑器"><span></span><code>chrom &lt;- html_element(tree, xpath = <span>"//chrom"</span>)<br>p1 &lt;- xml_parent(chrom)<br>xml_name(p1)<br><span># [1] "position"</span><br>p2 &lt;- xml_parents(chrom)<br>xml_name(p2)<br><span># [1] "position" "gene" </span><br></code></pre><p data-tool="mdnice编辑器">获取元素的所有兄弟结点和根结点</p><pre data-tool="mdnice编辑器"><span></span><code>xml_siblings(chrom)<br><span># {xml_nodeset (2)}</span><br><span># [1] &lt;start&gt;7571720&lt;/start&gt;</span><br><span># [2] &lt;end&gt;7590868&lt;/end&gt;</span><br>xml_name(xml_root(chrom))<br><span># [1] "gene"</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>结点搜索</span><span></span></h3><p data-tool="mdnice编辑器"><code>xml2</code> 也提供了类似于 <code>html_elements</code> 的搜索函数，但是只支持 <code>XPath</code> 语法，根据不同的搜索方式和值的类型，可分为</p><section data-tool="mdnice编辑器"><table><thead><tr><th>函数</th><th>功能</th><th>函数</th><th>功能</th></tr></thead><tbody><tr><td><code>xml_find_all</code></td><td>返回所有匹配结果</td><td><code>xml_find_first</code></td><td>返回第一个匹配结果</td></tr><tr><td><code>xml_find_num</code></td><td>返回数值型匹配结果</td><td><code>xml_find_chr</code></td><td>返回字符串型匹配结果</td></tr><tr><td><code>xml_find_lgl</code></td><td>返回逻辑型匹配结果</td><td><code>xml_find_one</code></td><td>同 <code>xml_find_first</code> ，已弃用</td></tr></tbody></table></section><p data-tool="mdnice编辑器">返回所有的属性值</p><pre data-tool="mdnice编辑器"><span></span><code>xml_find_all(tree, xpath = <span>"//@*"</span>)<br><span># {xml_nodeset (4)}</span><br><span># [1]  type="protein coding"</span><br><span># [2]  id="7157"</span><br><span># [3]  alias="P53"</span><br><span># [4]  base="0"</span><br></code></pre><p data-tool="mdnice编辑器">返回 <code>position</code> 标签下的第一个子结点</p><pre data-tool="mdnice编辑器"><span></span><code>xml_find_first(tree, xpath = <span>"position/child::*"</span>)<br><span># {xml_node}</span><br><span># &lt;chrom&gt;</span><br></code></pre><p data-tool="mdnice编辑器">而对于另外三个和类型相关的函数，一般都要搭配 <code>XPath</code> 函数使用，例如</p><pre data-tool="mdnice编辑器"><span></span><code>xml_find_num(tree, xpath = <span>"count(position/child::*)"</span>)<br><span># [1] 3</span><br>xml_find_chr(tree, xpath = <span>"string(position/chrom/text())"</span>)<br><span># [1] "chr17"</span><br>xml_find_lgl(tree, xpath = <span>"boolean(//@id &gt; 10)"</span>)<br><span># [1] TRUE</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>rvest 补充</span><span></span></h3><p data-tool="mdnice编辑器">虽然前面介绍的这些函数已经提供了足够丰富的功能了，但是既然我们也使用到了 <code>rvest</code> 包，何不顺便介绍一下该包提供的一些功能函数呢？</p><p data-tool="mdnice编辑器">该包提供的函数不是很多，除了上面介绍的 <code>html_element</code> 和 <code>html_elements</code> 之外，常用的函数还有</p><section data-tool="mdnice编辑器"><table><thead><tr><th>函数</th><th>功能</th><th>函数</th><th>功能</th></tr></thead><tbody><tr><td><code>html_attr</code></td><td>获取指定属性的值</td><td><code>html_attrs</code></td><td>获取所有属性的值</td></tr><tr><td><code>html_children</code></td><td>获取所有子结点</td><td><code>html_name</code></td><td>获取结点对应的标签</td></tr><tr><td><code>html_text</code></td><td>获取结点的文本</td><td><code>html_text2</code></td><td>获取的文本保留了网页上看到的效果</td></tr><tr><td><code>html_table</code></td><td>将表格内容转换为数据框</td><td><code>minimal_html</code></td><td>从字符串构造结点树</td></tr></tbody></table></section><p data-tool="mdnice编辑器">获取结点的属性</p><pre data-tool="mdnice编辑器"><span></span><code>html_attr(tree, <span>'name'</span>)<br><span># [1] NA</span><br>html_attr(tree, <span>'type'</span>)<br><span># [1] "protein coding"</span><br>html_attrs(tree)<br><span>#             type               id </span><br><span># "protein coding"           "7157"</span><br></code></pre><p data-tool="mdnice编辑器">获取所有子结点</p><pre data-tool="mdnice编辑器"><span></span><code>html_children(pos)<br><span># {xml_nodeset (3)}</span><br><span># [1] &lt;chrom&gt;chr17&lt;/chrom&gt;</span><br><span># [2] &lt;start&gt;7571720&lt;/start&gt;</span><br><span># [3] &lt;end&gt;7590868&lt;/end&gt;</span><br></code></pre><p data-tool="mdnice编辑器">获取结点中的文本，<code>html_text</code> 会原样输出而 <code>html_text2</code> 和网页上看到的效果一致</p><pre data-tool="mdnice编辑器"><span></span><code>x &lt;- minimal_html(<br>  <span>"&lt;p&gt; This is a <br>  paragraph &lt;br&gt; This is a <br>  new line"</span><br>)<br>html_text(x)<br><span># [1] " This is a \n  paragraph  This is a \n  new line"</span><br>html_text2(x)<br><span># [1] "This is a paragraph\nThis is a new line"</span><br></code></pre><p data-tool="mdnice编辑器">将网页中的表格转换为数据框类型</p><pre data-tool="mdnice编辑器"><span></span><code>t &lt;- <span>'<br>&lt;table border="1"&gt;<br>&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Symbol&lt;/th&gt;&lt;th&gt;ID&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;<br>&lt;tbody&gt;<br>  &lt;tr&gt;&lt;td&gt;TP53&lt;/td&gt;&lt;td&gt;7157&lt;/td&gt;&lt;/tr&gt;<br>  &lt;tr&gt;&lt;td&gt;KRAS&lt;/td&gt;&lt;td&gt;3845&lt;/td&gt;&lt;/tr&gt;<br>&lt;/tbody&gt;&lt;/table&gt;'</span><br>x &lt;- minimal_html(t)<br>html_table(html_element(x, <span>"table"</span>))<br><span># # A tibble: 2 × 2</span><br><span>#   Symbol    ID</span><br><span>#   &lt;chr&gt;  &lt;int&gt;</span><br><span># 1 TP53    7157</span><br><span># 2 KRAS    3845</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>lxml</span><span></span></h2><p data-tool="mdnice编辑器"><code>lxml</code> 是两个 <code>C</code> 库：<code>libxml2</code> 和 <code>libxslt</code> 的 <code>Python</code> 封装，其相较于 <code>R</code> 中的 <code>xml2</code> 包具有更多的功能，并且兼顾文件的解析速度及操作的灵活性，主要使用的是 <code>lxml.etree</code> 模块进行解析。。</p><h3 data-tool="mdnice编辑器"><span></span><span>属性操作</span><span></span></h3><p data-tool="mdnice编辑器">一般 <code>XML</code> 树结构都是使用 <code>Element</code> 函数来创建对应的结点对象，该对象相当于一个容器，能够不断为其添加不同的子结点，子结点也可以是另一个结点。我们可以创建一个结点，可以在创建的同时为 <code>attrib</code> 参数指定一个字典，字典的键为属性名，值为属性值，并返回一个结点对象</p><pre data-tool="mdnice编辑器"><span></span><code>genes = etree.Element(_tag=<span>'genes'</span>, attrib={<span>'type'</span>: <span>'protein coding'</span>})<br>type(genes)<br><span># lxml.etree._Element</span><br>etree.tostring(genes)  <span># 返回结点的字符串表示</span><br><span># b'&lt;genes type="protein coding"/&gt;'</span><br>genes.tag<br><span># 'genes'</span><br></code></pre><p data-tool="mdnice编辑器">或者以关键字参数的方式来指定</p><pre data-tool="mdnice编辑器"><span></span><code>genes = etree.Element(_tag=<span>'genes'</span>, attrib={<span>'type'</span>: <span>'protein coding'</span>}, <br>                      ref=<span>'hg19'</span>, id=<span>'0'</span>)<br>etree.tostring(genes)<br><span># b'&lt;genes ref="hg19" id="0" type="protein coding"/&gt;'</span><br></code></pre><p data-tool="mdnice编辑器">标签内的属性是无序的键-值对，因此通常可将结点对象作为字典来使用</p><pre data-tool="mdnice编辑器"><span></span><code>genes.items()<br><span># [('ref', 'hg19'), ('id', '0'), ('type', 'protein coding')]</span><br>genes.keys()<br><span># ['ref', 'id', 'type']</span><br>genes.get(<span>'type'</span>)<br><span># 'protein coding'</span><br>genes.set(<span>'type'</span>, <span>'Protein-Coding'</span>)<br>etree.tostring(genes)<br><span># b'&lt;genes ref="hg19" id="0" type="Protein-Coding"/&gt;'</span><br></code></pre><p data-tool="mdnice编辑器">或者使用计算属性 <code>attrib</code> 来访问标签的属性，其返回的是结点自身的属性，在修改其值时，也会影响结点对应的属性值</p><pre data-tool="mdnice编辑器"><span></span><code>attr = genes.attrib<br>attr<br><span># {'ref': 'hg19', 'id': '0', 'type': 'Protein-Coding'}</span><br>attr[<span>'ref'</span>] = <span>'hg38'</span><br>genes.get(<span>'ref'</span>)<br><span># 'hg38'</span><br></code></pre><p data-tool="mdnice编辑器">一般来说同一个标签内的文本存储在 <code>text</code> 属性中，例如</p><pre data-tool="mdnice编辑器"><span></span><code>genes.text = <span>"genes list"</span><br>etree.tostring(genes)<br><span># b'&lt;genes ref="hg38" id="0" type="Protein-Coding"&gt;genes list&lt;/genes&gt;'</span><br></code></pre><p data-tool="mdnice编辑器">而文本也可以放在不同标签之间，该文本会存储在 <code>tail</code> 属性中，例如在 <code>HTML</code> 中，使用 <code>&lt;br/&gt;</code> 标签在文本之间添加换行符</p><pre data-tool="mdnice编辑器"><span></span><code>html = etree.Element(<span>"html"</span>)<br>body = etree.SubElement(html, <span>"body"</span>)  <span># 添加子结点</span><br>body.text = <span>"A line"</span><br>br = etree.SubElement(body, <span>"br"</span>)<br>br.tail = <span>"A new line"</span><br>etree.tostring(html)<br><span># b'&lt;html&gt;&lt;body&gt;A line&lt;br/&gt;A new line&lt;/body&gt;&lt;/html&gt;'</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>结点操作</span><span></span></h3><p data-tool="mdnice编辑器">对于单个结点来说，它就是一个根结点，不存在其父结点或子结点，我们可以使用不同的函数为其添加各种关系，如添加或删除子结点、兄弟结点等。我们可以使用 <code>SubElement</code> 函数为其添加子结点</p><pre data-tool="mdnice编辑器"><span></span><code>g1 = etree.SubElement(genes, _tag=<span>'gene'</span>, name=<span>'TP53'</span>, id=<span>'7157'</span>)<br>g2 = etree.SubElement(genes, _tag=<span>'gene'</span>, name=<span>'KRAS'</span>, id=<span>'3845'</span>)<br>len(genes)  <span># 计算子结点的数量</span><br><span># 2</span><br>type(g1)<br><span># lxml.etree._Element</span><br></code></pre><p data-tool="mdnice编辑器">调用该函数会返回一个结点对象，我们可以用这种方式不断为结点树添加更多的结点。除了这种方式之外，还可以使用其他函数来操作结点，主要包括</p><section data-tool="mdnice编辑器"><table><thead><tr><th>函数</th><th>功能</th><th>函数</th><th>功能</th></tr></thead><tbody><tr><td><code>append</code></td><td>在末尾添加一个子结点</td><td><code>insert</code></td><td>在指定位置插入子结点</td></tr><tr><td><code>replace</code></td><td>替换子结点</td><td><code>remove</code></td><td>根据结点地址删除一个子结点</td></tr><tr><td><code>clear</code></td><td>删除所有子结点及其属性值</td><td><code>index</code></td><td>获取子结点的索引位置</td></tr><tr><td><code>addprevious</code></td><td>在该结点之前添加一个兄弟结点</td><td><code>addnext</code></td><td>在该结点之后添加一个兄弟结点</td></tr></tbody></table></section><p data-tool="mdnice编辑器">从这些函数名称可以看出，操作结点看起来像是在操作一个列表，即将所有的子结点归结为一个列表，可以不断为其添加新的结点，并给每个节点添加了顺序索引，方便访问。例如，结点的添加和删除</p><pre data-tool="mdnice编辑器"><span></span><code>genes.remove(g2)<br>len(genes)<br><span># 1</span><br>genes.append(g2)<br>etree.tostring(genes[<span>0</span>])<br><span># b'&lt;gene name="TP53" id="7157"/&gt;'</span><br>genes.insert(<span>1</span>, etree.Element(_tag=<span>'gene'</span>, name=<span>'BRAF'</span>, id=<span>'673'</span>))<br>len(genes)<br><span># 3</span><br>etree.tostring(genes[<span>1</span>])<br><span># b'&lt;gene name="BRAF" id="673"/&gt;'</span><br><br></code></pre><p data-tool="mdnice编辑器">替换子结点</p><pre data-tool="mdnice编辑器"><span></span><code>old = etree.SubElement(genes, _tag=<span>'gene'</span>, name=<span>'ROS'</span>, id=<span>'6089'</span>)<br>new = etree.Element(_tag=<span>'gene'</span>, name=<span>'ALK'</span>, id=<span>'238'</span>)<br>genes.replace(old, new)<br>etree.tostring(genes[<span>-1</span>])<br><span># b'&lt;gene name="ALK" id="238"/&gt;'</span><br></code></pre><p data-tool="mdnice编辑器">在结点的前后添加兄弟节点</p><pre data-tool="mdnice编辑器"><span></span><code>genes.index(g2)<br><span># 2</span><br>g3 = etree.Element(<span>'gene'</span>, name=<span>'EGFR'</span>, id=<span>'1956'</span>, <br>                   type=<span>'epidermal growth factor receptor'</span>)<br>g4 = etree.Element(<span>'gene'</span>, name=<span>'PIK3CA'</span>, id=<span>'5290'</span>, type=<span>'subunit'</span>)<br>g2.addnext(g4)      <span># 添加在后一个</span><br>g2.addprevious(g3)  <span># 添加在前一个</span><br>len(genes)<br><span># 6</span><br></code></pre><p data-tool="mdnice编辑器">最后，打印结点内容，可以使用 <code>pretty_print</code> 美化输出，并使用 <code>decode</code> 将 <code>bytes</code> 字符串转换为 <code>str</code> 类型</p><pre data-tool="mdnice编辑器"><span></span><code>print(etree.tostring(genes, pretty_print=<span>True</span>).decode())<br><span># &lt;genes ref="hg19" id="0" type="protein coding"&gt;</span><br><span>#   &lt;gene name="TP53" id="7157"/&gt;</span><br><span>#   &lt;gene name="BRAF" id="673"/&gt;</span><br><span>#   &lt;gene name="EGFR" id="1956" type="epidermal growth factor receptor"/&gt;</span><br><span>#   &lt;gene name="KRAS" id="3845"/&gt;</span><br><span>#   &lt;gene name="PIK3CA" id="5290" type="subunit"/&gt;</span><br><span>#   &lt;gene name="ALK" id="238"/&gt;</span><br><span># &lt;/genes&gt;</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>迭代搜索</span><span></span></h3><p data-tool="mdnice编辑器">该包也提供了类似于 <code>XPath</code> 语法的路径搜索方法，可以使用这些方法来搜索结点</p><section data-tool="mdnice编辑器"><table><thead><tr><th>方法</th><th>功能</th><th>方法</th><th>功能</th></tr></thead><tbody><tr><td><code>iterfind</code></td><td>遍历所有匹配路径表达式的结点</td><td><code>findall</code></td><td>返回所有匹配的结点列表</td></tr><tr><td><code>find</code></td><td>返回第一个匹配的结点</td><td><code>findtext</code></td><td>返回第一个匹配的 <code>text</code> 属性</td></tr></tbody></table></section><p data-tool="mdnice编辑器">获取所有的子结点，可以传入标签名称或者使用路径表达式返回一个列表</p><pre data-tool="mdnice编辑器"><span></span><code><span>for</span> g <span>in</span> genes.iterfind(path=<span>'gene'</span>):<br>    print(g.get(<span>'name'</span>), end=<span>' '</span>)<br><span># TP53 BRAF EGFR KRAS PIK3CA ALK</span><br>genes.findall(<span>'./gene[@type]'</span>)<br><span># [&lt;Element gene at 0x7fdd32853cc0&gt;, &lt;Element gene at 0x7fdd3251e800&gt;]</span><br></code></pre><p data-tool="mdnice编辑器">而 <code>iter</code> 则只能传入标签名称</p><pre data-tool="mdnice编辑器"><span></span><code>next(genes.iter(<span>'gene'</span>)).tag<br><span># 'gene'</span><br>next(genes.iter(<span>'gene'</span>)).attrib<br><span># {'name': 'TP53', 'id': '7157'}</span><br></code></pre><p data-tool="mdnice编辑器">搜索第一个匹配的结点</p><pre data-tool="mdnice编辑器"><span></span><code>genes.find(<span>'./gene[@type]'</span>).get(<span>'name'</span>)<br><span># 'EGFR'</span><br>genes.findtext(<span>'./gene[@type]'</span>)<br><span># ''</span><br>g3.text = <span>'receptor'</span><br>genes.findtext(<span>'./gene[@type]'</span>)<br><span># 'receptor'</span><br></code></pre><p data-tool="mdnice编辑器">对于某一个结点来说，我们可以使用一些方法来获取与其相关的其他结点的信息</p><section data-tool="mdnice编辑器"><table><thead><tr><th>方法</th><th>功能</th><th>方法</th><th>功能</th></tr></thead><tbody><tr><td><code>getchildren</code></td><td>该结点的所有直接子结点</td><td><code>iterchildren</code></td><td>该结点的所有子结点迭代器</td></tr><tr><td><code>getnext</code></td><td>该结点的后一个兄弟结点</td><td><code>getprevious</code></td><td>该结点的前一个兄弟结点</td></tr><tr><td><code>getparent</code></td><td>该结点的父结点</td><td><code>getroottree</code></td><td>返回整个结点树</td></tr><tr><td><code>iterancestors</code></td><td>该结点的祖先结点迭代器</td><td><code>getiterator</code></td><td>该结点的深度优先遍历迭代器</td></tr><tr><td><code>iterdescendants</code></td><td>该结点的子孙结点迭代器</td><td><code>itersiblings</code></td><td>该结点之前或之后的所有结点迭代器</td></tr></tbody></table></section><p data-tool="mdnice编辑器">结点的 <code>XPath</code> 路径表示，可以先获取整个结点树，然后使用 <code>getpath</code> 来获取对应结点的路径表示</p><pre data-tool="mdnice编辑器"><span></span><code>genes.getroottree().getpath(g3)<br><span># '/genes/gene[3]'</span><br></code></pre><p data-tool="mdnice编辑器">遍历所有子结点</p><pre data-tool="mdnice编辑器"><span></span><code><span>for</span> e <span>in</span> genes.iterchildren():<br>    print(e.get(<span>'name'</span>), end=<span>' '</span>)<br><span># TP53 BRAF EGFR KRAS PIK3CA ALK</span><br><span>for</span> e <span>in</span> genes.getchildren():<br>    print(e.get(<span>'id'</span>), end=<span>' '</span>)<br><span># 7157 673 1956 3845 5290 238</span><br></code></pre><p data-tool="mdnice编辑器">结点的父结点</p><pre data-tool="mdnice编辑器"><span></span><code>g1.getparent().tag<br><span># 'genes'</span><br></code></pre><p data-tool="mdnice编辑器">获取相邻的两个兄弟结点</p><pre data-tool="mdnice编辑器"><span></span><code>g2.getnext().attrib<br><span># {'name': 'PIK3CA', 'id': '5290', 'type': 'subunit'}</span><br>g2.getprevious().attrib<br><span># {'name': 'EGFR', 'id': '1956', 'type': 'epidermal growth factor receptor'}</span><br></code></pre><p data-tool="mdnice编辑器">对结点之前或之后的兄弟结点进行遍历，主要通过 <code>preceding</code> 参数来控制方向</p><pre data-tool="mdnice编辑器"><span></span><code><span>for</span> g <span>in</span> g3.itersiblings():<br>    print(g.attrib)<br><span># {'name': 'KRAS', 'id': '3845'}</span><br><span># {'name': 'PIK3CA', 'id': '5290', 'type': 'subunit'}</span><br><span># {'name': 'ALK', 'id': '238'}</span><br><span>for</span> g <span>in</span> g3.itersiblings(preceding=<span>True</span>):<br>    print(g.attrib)<br><span># {'name': 'BRAF', 'id': '673'}</span><br><span># {'name': 'TP53', 'id': '7157'}</span><br></code></pre><p data-tool="mdnice编辑器">这些方法完全可以替代前面介绍的两种选择器语法，以调用对象方法的方式来获取对应的结点。在编写代码时，完全可以结合三者优势之处混合使用，以最快最简便的方式来实现数据的提取。</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/yPQycMk664Ydq63zGFdYhA",target="_blank" rel="noopener noreferrer">原文链接</a>
