---
title: "代谢物富集分析怎么做(二)？——KEGG篇"
date: 2024-07-04T00:18:55Z
draft: ["false"]
tags: [
  "fetched",
  "生信益站"
]
categories: ["Acdemic"]
---
代谢物富集分析怎么做(二)？——KEGG篇 by 生信益站
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><figure data-tool="mdnice编辑器"><img data-imgfileid="100028358" data-ratio="0.278125" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFz1BvuMtboGoq2iapKLEylZQHpDPSYV0mLQicOlyYkup3hiaybyWUoeibyQ/640?wx_fmt=gif&amp;from=appmsg" data-type="gif" data-w="640" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFz1BvuMtboGoq2iapKLEylZQHpDPSYV0mLQicOlyYkup3hiaybyWUoeibyQ/640?wx_fmt=gif&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><code>生信益站，一点就有益</code>！<strong>祝友友们天天开心，月月发 CNS~</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzU1NTk0MTUxMg==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib8n88v0Cj6koLMO8nOuGacicngmJdb0zgmMpxaXYnrB7sjV5iar1cTzTDLsicoyNKrjic1Hgric41HObSQ/0?wx_fmt=png" data-nickname="生信益站" data-alias="" data-signature="生物信息或基因测序数据分析、软件算法、科研绘图、Python/Perl/R代码分享。" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"><strong></strong></p><hr data-tool="mdnice编辑器"><figure data-tool="mdnice编辑器"><img data-imgfileid="100028355" data-ratio="0.3768518518518518" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFGibGNQJ0s8hRUdSeUzaNp2ocGgribVBcC2pXF08teNDsia28MkiagTj0rg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFGibGNQJ0s8hRUdSeUzaNp2ocGgribVBcC2pXF08teNDsia28MkiagTj0rg/640?wx_fmt=png&amp;from=appmsg"><figcaption>设我为🌟星标，每天就能第一时间看到推送啦~</figcaption></figure><h1 data-tool="mdnice编辑器"><span></span><span>代谢物富集分析怎么做（二）？</span><span></span></h1><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong>首先要拿到背景注释</strong>。今天站长的的分享是——如何从<strong>KEGG数据库</strong><span>爬取</span><span><strong>代谢物</strong></span><span>的</span><span><strong>通路注释</strong></span><span>信息。</span></p></blockquote><p data-tool="mdnice编辑器"><em><strong>富集分析可视化：</strong></em></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100028356" data-ratio="0.6175925925925926" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFpWq5FqM2buLtPmXxD4Q0DyPbUKX5Qe8EypLPTL3Sj7g3uJnwqRdqZw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFpWq5FqM2buLtPmXxD4Q0DyPbUKX5Qe8EypLPTL3Sj7g3uJnwqRdqZw/640?wx_fmt=png&amp;from=appmsg"></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100028359" data-ratio="0.4740740740740741" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFMIArJmcCafaiaLibuGZ5d8IcXvKdsIiaxjichHicmtykB1nfTvdyu7GTAmQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFMIArJmcCafaiaLibuGZ5d8IcXvKdsIiaxjichHicmtykB1nfTvdyu7GTAmQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">图片来源：<em>Gu Z (2024). GSEAtraining: Training materials for the GSEA course. R package version 0.99.1, https://github.com/jokergoo/GSEAtraining</em>.</p><h1 data-tool="mdnice编辑器"><span></span><span>1、下载人的全部通路 id</span><span></span></h1><p data-tool="mdnice编辑器">一共 <code>359</code> 个。</p><pre data-tool="mdnice编辑器"><span></span><code>curl -s https://rest.kegg.jp/list/pathway/hsa -o hsa.ko<br><br>wc -l hsa.ko<br><span># 359 hsa.ko</span><br><br>head -10 hsa.ko<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028357" data-ratio="0.3212962962962963" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFxrllUkNF9gZSwI6JfOr9MnJnupITod2dUSz35bvpIJh2Eu1xiayRDRw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFxrllUkNF9gZSwI6JfOr9MnJnupITod2dUSz35bvpIJh2Eu1xiayRDRw/640?wx_fmt=png&amp;from=appmsg"></figure><h1 data-tool="mdnice编辑器"><span></span><span>2、得到人的全部代谢通路 id</span><span></span></h1><p data-tool="mdnice编辑器">一共 <code>92</code> 个。</p><pre data-tool="mdnice编辑器"><span></span><code><span># alias les='less -S'</span><br>curl -s <span>"https://www.genome.jp/kegg-bin/show_organism?menu_type=pathway_maps&amp;org=hsa"</span> -o hsa.ko.html<br><br>les hsa.ko.html \<br>    | grep <span>"href=\"/pathway/hsa"</span> \<br>    | cut -d<span>"&amp;"</span> -f 1 \<br>    | head -92 \<br>    | fgrep -f - hsa.ko &gt; hsa.met.ko<br><br><span># $ wc -l hsa.met.ko</span><br><span># 92 hsa.met.ko</span><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028364" data-ratio="0.31666666666666665" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFEVJV8CBorOaAHadoND4GsAxwwbDAH5JdKX5rmV9gbiabR37zuSFaq7Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFEVJV8CBorOaAHadoND4GsAxwwbDAH5JdKX5rmV9gbiabR37zuSFaq7Q/640?wx_fmt=png&amp;from=appmsg"></figure><h1 data-tool="mdnice编辑器"><span></span><span>3、下载 92 个代谢通路的【通路-化合物】字典</span><span></span></h1><figure data-tool="mdnice编辑器"><img data-imgfileid="100028365" data-ratio="1.0842592592592593" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFibkvpjhltnwRAqW6MtxX4XvFZiaOQobPZZhj4tAo8cyM3xZKIG88goPA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFibkvpjhltnwRAqW6MtxX4XvFZiaOQobPZZhj4tAo8cyM3xZKIG88goPA/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code><span># https://rest.kegg.jp/list/compound</span><br><span># https://www.genome.jp/dbget-bin/www_bget?pathway+hsa00010</span><br><br>cat hsa.met.ko |<span>while</span> IFS=$<span>'\t'</span> <span>read</span> -r ko koname;<br><span>do</span><br>    curl -s http://togows.dbcls.jp/entry/pathway/<span>${ko}</span>/compounds \<br>    | sed <span>'s/\t/\n/g'</span> \<br>    | sed <span>'s/[ ]\+/\t/'</span> \<br>    | awk -v k1=<span>"<span>$ko</span>"</span> -v k2=<span>"<span>$koname</span>"</span> <span>'{<br>          print k1"\t"k2"\t"$0 }'</span> &gt;&gt; hsa.ko2cpd.tsv<br>    sleep 3<br><span>done</span><br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>head -10 hsa.ko2cpd.tsv<br><span># hsa00010 Glycolysis / Gluconeogenesis - Homo sapiens (human) C00022 Pyruvate</span><br><span># hsa00010 Glycolysis / Gluconeogenesis - Homo sapiens (human) C00024 Acetyl-CoA</span><br><span># hsa00010 Glycolysis / Gluconeogenesis - Homo sapiens (human) C00031 D-Glucose</span><br><span># hsa00010 Glycolysis / Gluconeogenesis - Homo sapiens (human) C00033 Acetate</span><br><span># hsa00010 Glycolysis / Gluconeogenesis - Homo sapiens (human) C00036 Oxaloacetate</span><br><span># hsa00010 Glycolysis / Gluconeogenesis - Homo sapiens (human) C00068 Thiamin diphosphate</span><br><span># hsa00010 Glycolysis / Gluconeogenesis - Homo sapiens (human) C00074 Phosphoenolpyruvate</span><br><span># hsa00010 Glycolysis / Gluconeogenesis - Homo sapiens (human) C00084 Acetaldehyde</span><br><span># hsa00010 Glycolysis / Gluconeogenesis - Homo sapiens (human) C00085 D-Fructose 6-phosphate</span><br><span># hsa00010 Glycolysis / Gluconeogenesis - Homo sapiens (human) C00103 D-Glucose 1-phosphate</span><br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>les hsa.ko2cpd.tsv|cut -f 1|sort -u|wc -l<br><span># 81</span><br></code></pre><p data-tool="mdnice编辑器">但是呢，有 <code>11</code> 个代谢通路没有代谢物信息。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100028362" data-ratio="0.3" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFnzyT0JaAbRZTqmENE6AZSc9zYlNF5acwq2MWWnrrpoUZmhNczfEvGQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFnzyT0JaAbRZTqmENE6AZSc9zYlNF5acwq2MWWnrrpoUZmhNczfEvGQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><span><strong><span>所以这 </span></strong><strong><code><span>92</span></code><span> 个代谢通路，最终得到 cpd 注释的只有 </span><code><span>81</span></code><span> 个。</span></strong></span></p><h1 data-tool="mdnice编辑器"><span></span><span>4、下载非代谢通路的【通路-化合物】字典</span><span></span></h1><blockquote data-tool="mdnice编辑器"><span>❝</span><p>因为部分非代谢通路也含有化合物。</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code>les hsa.met.ko \<br>    | cut -f 1 \<br>    | fgrep -v -w -f - hsa.ko &gt; hsa.other.ko<br><br>wc -l hsa.other.ko<br><span># 267 hsa.other.ko</span><br></code></pre><p data-tool="mdnice编辑器">爬取剩余（359-92=）<code>267</code>个通路的代谢物信息。</p><pre data-tool="mdnice编辑器"><span></span><code>cat hsa.other.ko |<span>while</span> IFS=$<span>'\t'</span> <span>read</span> -r ko koname;<br><span>do</span><br>    curl -s http://togows.dbcls.jp/entry/pathway/<span>${ko}</span>/compounds \<br>    | sed <span>'s/\t/\n/g'</span> \<br>    | sed <span>'s/[ ]\+/\t/'</span> \<br>    | awk -v k1=<span>"<span>$ko</span>"</span> -v k2=<span>"<span>$koname</span>"</span> <span>'{<br>          print k1"\t"k2"\t"$0 }'</span> &gt;&gt; hsa.other.ko2cpd.tsv<br>    sleep 3<br><span>done</span><br></code></pre><p data-tool="mdnice编辑器">最终<code>207个非代谢通路</code>得到了代谢物映射信息。</p><pre data-tool="mdnice编辑器"><span></span><code>les hsa.other.ko2cpd.tsv|cut -f 1|sort -u|wc -l<br><span># 207</span><br></code></pre><h1 data-tool="mdnice编辑器"><span></span><span>5、合并代谢、非代谢通路 - 化合物字典</span><span></span></h1><p data-tool="mdnice编辑器">一共（81+207=）<code>288</code>个通路。</p><pre data-tool="mdnice编辑器"><span></span><code>cat hsa.ko2cpd.tsv hsa.other.ko2cpd.tsv \<br>    | awk -F <span>'\t'</span> <span>'{if($4==""){print $0"\tUnknown"}else{print}}'</span> \<br>    | csvtk cut -t -f 3,4,1,2 \<br>    | sed <span>'1i\Cpd_id\tCpd_name\tPathway_id\tPathway_name'</span> &gt; hsa.metabolite.cpd2ko.tsv<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100028363" data-ratio="0.2851851851851852" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFwQYk9bdDQtfDdf3NcNxqITW3hGIcBApicFfOvC0jibTo5gUFklfhkkow/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFwQYk9bdDQtfDdf3NcNxqITW3hGIcBApicFfOvC0jibTo5gUFklfhkkow/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">这<code>288</code>个通路和<code>3546</code>个化合物建立了映射关系（<span>我下载的也不一定完整</span>，<span>遇到网络甚至数据库更新，最终结果也不一样</span>）。</p><pre data-tool="mdnice编辑器"><span></span><code>les hsa.metabolite.cpd2ko.240703.tsv \<br>    | cut -f 1 |sort -u|wc -l<br><span># 3546</span><br></code></pre><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong>注意</strong>：这里<span><strong>用到的</strong><strong><code>代码</code>都是<code>linux命令</code>行，需要在<code>linux环境运行</code></strong></span>。我这里只教大家思路和方法（不一定对），<span>具体需要什么格式的文件，您需要根据自己的数据进行调整、或者重新下载</span>。</p></blockquote><h1 data-tool="mdnice编辑器"><span></span><span>拿到背景注释就可以做富集啦，可参考以下教程：</span><span></span></h1><p data-tool="mdnice编辑器">1、<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU1NTk0MTUxMg==&amp;mid=2247488746&amp;idx=1&amp;sn=6c78f8249dd1ac963f804083b3c35dd2&amp;chksm=fbcdff0dccba761b4c8fd44e7259e931a6f75381366f8e93ad88b75142fba91792902aa103b9&amp;scene=21#wechat_redirect" textvalue="GSEA第4弹！超级简单的clusterProfiler包GSEA富集教程" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">GSEA第4弹！超级简单的clusterProfiler包GSEA富集教程</a></p><p data-tool="mdnice编辑器">2、<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU1NTk0MTUxMg==&amp;mid=2247511953&amp;idx=1&amp;sn=54c4420d9243946810dcd4a923f5a92a&amp;chksm=fbce4476ccb9cd60272771ef6ed039b97b412ae86b41c7547b2aeb74422ad97238aa29c61027&amp;scene=21#wechat_redirect" textvalue="代谢物富集分析怎么做（一）？" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">代谢物富集分析怎么做（一）？</a></p><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">OK，今天的分享到此为止。咱们明天见~</p><h1 data-tool="mdnice编辑器"><span></span><span>益站可以评论、留言啦。赶紧发表您的看法吧~</span><span></span></h1><h1 data-tool="mdnice编辑器"><span></span><span>联系站长</span><span></span></h1><blockquote data-tool="mdnice编辑器"><span>❝</span><p>对<code>本篇文章有疑问</code>，或者有<code>科研服务需求</code>的友友可以在益站<code>发消息留言</code>，也欢迎各位童鞋<code>扫下面的二维码</code>加入我们的 <code>QQ</code> 交流群。</p></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100028361" data-ratio="1.5" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFFYGSgUBeKicdicu4Rd07GOgR608s84e3g4PrNlRn0Tfqiaos75FGtzIEg/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="512" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFFYGSgUBeKicdicu4Rd07GOgR608s84e3g4PrNlRn0Tfqiaos75FGtzIEg/640?wx_fmt=jpeg&amp;from=appmsg"><figcaption>最新QQ群</figcaption></figure><hr data-tool="mdnice编辑器"><figure data-tool="mdnice编辑器"><img data-imgfileid="100028370" data-ratio="0.7277777777777777" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFhyicQyTGh19EjS5xL1SDQ6zeDbH3O2YuwdvtffDhWK6acJIdOKfhZYA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFhyicQyTGh19EjS5xL1SDQ6zeDbH3O2YuwdvtffDhWK6acJIdOKfhZYA/640?wx_fmt=png&amp;from=appmsg"><figcaption>科研服务</figcaption></figure><hr data-tool="mdnice编辑器"><figure data-tool="mdnice编辑器"><img data-imgfileid="100028369" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFYRv9ichnY1QUNufyVwEqUdPqTtia2hLIxZTlZ0TVnkA8nBnEQd6ibRIHw/640?wx_fmt=gif&amp;from=appmsg" data-type="gif" data-w="240" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/mhoJzVKWSibib0oChEQQMm2bJkQlMKh0OFYRv9ichnY1QUNufyVwEqUdPqTtia2hLIxZTlZ0TVnkA8nBnEQd6ibRIHw/640?wx_fmt=gif&amp;from=appmsg"><figcaption>您的<code>关注、点赞、在看、转发</code>是对益站最大的<code>鼓励和支持</code>哈</figcaption></figure><hr data-tool="mdnice编辑器"></section><section><mp-common-profile data-pluginname="mpprofile" data-id="MzU1NTk0MTUxMg==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib8n88v0Cj6koLMO8nOuGacicngmJdb0zgmMpxaXYnrB7sjV5iar1cTzTDLsicoyNKrjic1Hgric41HObSQ/0?wx_fmt=png" data-nickname="生信益站" data-alias="" data-signature="生物信息或基因测序数据分析、软件算法、科研绘图、Python/Perl/R代码分享。" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Q9qN5rJw6CORmi_QopQR6A",target="_blank" rel="noopener noreferrer">原文链接</a>
