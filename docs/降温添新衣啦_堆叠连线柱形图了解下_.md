---
title: "降温添新衣啦！堆叠连线柱形图了解下？"
date: 2022-11-03T11:13:51Z
draft: ["false"]
tags: [
  "fetched",
  "SCIPainter"
]
categories: ["Acdemic"]
---
降温添新衣啦！堆叠连线柱形图了解下？ by SCIPainter
------
<div><p data-mpa-powered-by="yiban.io"><span><strong><span>堆叠柱形图</span></strong></span><span>和</span><strong><span>堆叠面积图（河流图）</span></strong><span>在各类组学中的应用都非常广泛，类似展示微生物群落组成、单细胞不同亚群细胞比例等。</span></p><p><span><br></span></p><p><span>常规堆叠柱形图和河流图两类我们往期也绘制过，详情可戳：</span></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzIyOTY3MDA3MA==&amp;mid=2247488042&amp;idx=1&amp;sn=48c7c221701edf07640aaba812baed86&amp;chksm=e8be7ff3dfc9f6e5534cd1c78080fe7082918c90a5f9f1feb2576f56e172061ea180f34d8f8b&amp;scene=21#wechat_redirect" textvalue="《给堆叠图加聚类树！拿来吧你！！》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>《给堆叠图加聚类树！拿来吧你！！》</span></a><span></span></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA5NzQzOTgzMw==&amp;mid=2650904454&amp;idx=1&amp;sn=24d1f6bd9502be2a6c7bf8a41fb886c2&amp;chksm=8b55eeb0bc2267a6564d4a261cf1e430d023d9f737e4ff42066864a8cd4145b5473ef304324f&amp;scene=21#wechat_redirect" textvalue="《如何绘制Science文章的“花式”河流图？》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>《如何绘制Science文章的“花式”河流图？》</span></a><span></span></p><p><span><br></span></p><p><span>无需代码也可直接在OmicShare云平台绘制，样式多达</span><strong><span>9种</span></strong><span>任你挑选：</span></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzIyOTY3MDA3MA==&amp;mid=2247486969&amp;idx=1&amp;sn=7323b5b3fb27a5cdfafd1a20911c12ea&amp;chksm=e8be6020dfc9e9362e9f80b84f51fe584f660c236e4b77510b58fe42284719e44f2b63cb8701&amp;scene=21#wechat_redirect" textvalue="《轻松get炫酷河流图的9大画法！》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>《轻松get炫酷河流图的9大画法！》</span></a><span></span></p><p><br></p><p><span>然而，普通的堆叠柱形图对于不同样本/分组的增减变化关系感受不如河流图直观，而河流图虽能直观感受到梯度变化，但没有堆叠柱形图的准确度。</span></p><p><span><br></span></p><p><img data-ratio="0.5437743190661478" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GuJicI2rt2QQ1veDPashd2GNIyshKIZrHdOKE2VZV4JuffwpFBaEfckQg/640?wx_fmt=png" data-type="png" data-w="1028" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GuJicI2rt2QQ1veDPashd2GNIyshKIZrHdOKE2VZV4JuffwpFBaEfckQg/640?wx_fmt=png"></p><p><span>Fig1-堆叠面积图/河流图（<em>Science</em>，2017）</span></p><p><span><br></span></p><p><img data-ratio="0.64198606271777" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GuZHh0SBAGBribCwAoQgrqYjt2B9R3icZibCq3oyKfYDkqhicbW2etd1QXZw/640?wx_fmt=png" data-type="png" data-w="1148" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GuZHh0SBAGBribCwAoQgrqYjt2B9R3icZibCq3oyKfYDkqhicbW2etd1QXZw/640?wx_fmt=png"></p><p><span>Fig2-堆叠柱形图（<em>Nat Biotechnol</em>，2021）</span></p><p><span><br></span></p><p><span>那么如果想要同时拥有准确度+直</span><strong><span>观感受增减变化，可以试试下面这种堆叠连线柱形图</span></strong><span>：</span></p><p><span><br></span></p><p><img data-ratio="0.7576099210822999" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GuNE5dlWoaWfGoWl8WXQq8Zf2ibs5SfrRCWMjwKw3u55CPGDCpX2H2eJw/640?wx_fmt=png" data-type="png" data-w="887" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GuNE5dlWoaWfGoWl8WXQq8Zf2ibs5SfrRCWMjwKw3u55CPGDCpX2H2eJw/640?wx_fmt=png"></p><p><span>Fig3-堆叠连线柱形图（<em>cell</em>，2021）</span></p><p><span><br></span></p><p><span>类似普通堆叠柱形图+河流图的组合版，也带点桑基图的影子……因此可以巧借桑基图的绘制R包</span><strong><span>ggalluvial</span></strong><span>来完成这个图表。</span></p><p><span><br></span></p><p><span>话不多说，下面就来画画看！</span></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#相关R包载入：</span><br mpa-from-tpl="t"><span>library</span>(ggplot2)<br mpa-from-tpl="t"><span>library</span>(ggalluvial)<br mpa-from-tpl="t"><span>library</span>(tidyverse)<br mpa-from-tpl="t"><span>library</span>(cols4all)<br mpa-from-tpl="t"><span>#本地数据读入：</span><br mpa-from-tpl="t"><span>df</span> &lt;- read.csv('OTUs-Group.csv',header = T)<br mpa-from-tpl="t"><span>head</span>(df)</p></pre></section><p><img data-ratio="0.3054448871181939" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3Guh03IdWibX1fmmLvHJicdjSNsibaZR9ZmE3lwib9tVHnVmRlxnjFlldlZibA/640?wx_fmt=png" data-type="png" data-w="753" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3Guh03IdWibX1fmmLvHJicdjSNsibaZR9ZmE3lwib9tVHnVmRlxnjFlldlZibA/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#转换为因子，指定绘图顺序：</span><br mpa-from-tpl="t"><span>df</span>$Phylum &lt;- factor(df$Phylum,levels = unique(df$Phylum))<br mpa-from-tpl="t"><span>c4a_gui</span>() <span>#查看/挑选色板</span><br mpa-from-tpl="t"><span>mycol</span> &lt;- c4a('vivid',12) <span>#选取配色</span><br mpa-from-tpl="t"><span>mycol</span></p></pre></section><p><img data-ratio="0.07263922518159806" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GuEOCJnmwnm2uoKIDQK7iaKAtwJ7Xa8TXcyoiafZ0a5Jk9a0RjHDfAzV7Q/640?wx_fmt=png" data-type="png" data-w="1239" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GuEOCJnmwnm2uoKIDQK7iaKAtwJ7Xa8TXcyoiafZ0a5Jk9a0RjHDfAzV7Q/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#常规堆叠柱形图绘制：</span><br mpa-from-tpl="t"><span>p</span> &lt;- ggplot(df, aes(x = Groups, y = OTUs, fill = Phylum)) +<br mpa-from-tpl="t"><span>geom_bar</span>(position = <span>"fill"</span>, stat=<span>"identity"</span>, color = 'white', alpha = 1, width = 0.95) +<br mpa-from-tpl="t"><span>scale_fill_manual</span>(values = mycol) +<br mpa-from-tpl="t"><span>scale_y_continuous</span>(expand = c(0,0)) +<br mpa-from-tpl="t"><span>theme_classic</span>()<br mpa-from-tpl="t"><span>p</span></p></pre></section><p><img data-ratio="0.8361581920903954" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GueqyXufOkicN6Lw18DFppsm3qwQK5mXmAAyJkfdt5vlXDIEwaDTLcB9w/640?wx_fmt=png" data-type="png" data-w="1416" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GueqyXufOkicN6Lw18DFppsm3qwQK5mXmAAyJkfdt5vlXDIEwaDTLcB9w/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#堆叠连线柱形图绘制：</span><br mpa-from-tpl="t"><span>##建立映射关系+基本主题/颜色设置:</span><br mpa-from-tpl="t"><span>pp</span> &lt;- ggplot(df, aes(x = Groups, y=OTUs, fill = Phylum,<br mpa-from-tpl="t"><span>stratum</span> = Phylum, alluvium = Phylum)) +<br mpa-from-tpl="t"><span>scale_fill_manual</span>(values = mycol) +<br mpa-from-tpl="t"><span>scale_y_continuous</span>(expand = c(0,0)) +<br mpa-from-tpl="t"><span>theme_classic</span>()<br mpa-from-tpl="t"><span>p1</span> &lt;- pp +<br mpa-from-tpl="t"><span>geom_col</span>(width = 0.6, color = NA) +<br mpa-from-tpl="t"><span>geom_flow</span>(width = 0.6, alpha = 0.22, knot.pos = 0) <span>#knot.pos控制连线的曲直，等于0时为直线连线；</span><br mpa-from-tpl="t"><span>#geom_alluvium(width = 0.6, alpha = 0.22, knot.pos = 0)效果相同</span><br mpa-from-tpl="t"><span>p1</span></p></pre></section><p><img data-ratio="0.8361581920903954" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3Gu69gnBVAC9rI8KFXohibjlDf5SZgAOSrfpagmuvaZdsPQHDuxHdHUmYA/640?wx_fmt=png" data-type="png" data-w="1416" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3Gu69gnBVAC9rI8KFXohibjlDf5SZgAOSrfpagmuvaZdsPQHDuxHdHUmYA/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#细节美化：</span><br mpa-from-tpl="t"><span>p2</span> &lt;- pp +<br mpa-from-tpl="t"><span>geom_col</span>(width = 0.6,<br mpa-from-tpl="t"><span>color</span> = 'white', size = 0.5) + <span>#同时赋予白色描边，适当加粗</span><br mpa-from-tpl="t"><span>geom_flow</span>(width = 0.6, alpha = 0.22, knot.pos = 0,<br mpa-from-tpl="t"><span>color</span> = 'white', size = 0.5)<span> #同时赋予白色描边，适当加粗</span><br mpa-from-tpl="t"><span>p2</span></p></pre></section><p><img data-ratio="0.8361581920903954" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GuiaGiatCBANkuOTI6k0f0libwvmVeF4NrP54MljJjWiaUpoD4wufMR2ChKA/640?wx_fmt=png" data-type="png" data-w="1416" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GuiaGiatCBANkuOTI6k0f0libwvmVeF4NrP54MljJjWiaUpoD4wufMR2ChKA/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#曲线连线效果：</span><br mpa-from-tpl="t"><span>p3</span> &lt;- pp +<br mpa-from-tpl="t"><span>geom_col</span>(width = 0.6,<br mpa-from-tpl="t"><span>color</span> = 'white', size = 0.5) +<br mpa-from-tpl="t"><span>geom_flow</span>(width = 0.6, alpha = 0.22, knot.pos = 0.4,<br mpa-from-tpl="t"><span>color</span> = 'white', size = 0.5)<br mpa-from-tpl="t"><span>p3</span></p></pre></section><p><img data-ratio="0.8361581920903954" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3Guz3zlenQKpxv6qeicZoy6YuKPecf0Jibz5Euec2qotG0KZLHdX7yZvTrg/640?wx_fmt=png" data-type="png" data-w="1416" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3Guz3zlenQKpxv6qeicZoy6YuKPecf0Jibz5Euec2qotG0KZLHdX7yZvTrg/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>p4</span> &lt;- pp +<br mpa-from-tpl="t"><span>geom_col</span>(width = 0.6,<br mpa-from-tpl="t"><span>color</span> = NA, size = 0.5) +<span> #去掉柱子的描边</span><br mpa-from-tpl="t"><span>geom_flow</span>(width = 0.6, alpha = 0.22, knot.pos = 0.35,<br mpa-from-tpl="t"><span>color</span> = 'white', size = 0.5) +<br mpa-from-tpl="t"><span>geom_alluvium</span>(width = 0.6, alpha = 1, knot.pos = 0.35,<br mpa-from-tpl="t"><span>fill</span> = NA, color = 'white', size = 0.5) <span>#再叠加一层白色描边加强一下效果</span><br mpa-from-tpl="t"><span>p4</span></p></pre></section><p><img data-ratio="0.8361581920903954" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GuljibReMS5nNxScqyu4q5JptfmP8YSD47MlIz9OrRQotfMOoARXHB2FA/640?wx_fmt=png" data-type="png" data-w="1416" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GuljibReMS5nNxScqyu4q5JptfmP8YSD47MlIz9OrRQotfMOoARXHB2FA/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#换个配色：</span><br mpa-from-tpl="t"><span>mycol2</span> &lt;- c4a('bold',12)<br mpa-from-tpl="t"><span>ppp</span> &lt;- ggplot(df, aes(x = Groups, y=OTUs, fill = Phylum,<br mpa-from-tpl="t"><span>stratum</span> = Phylum, alluvium = Phylum)) +<br mpa-from-tpl="t"><span>scale_fill_manual</span>(values = mycol2) +<br mpa-from-tpl="t"><span>scale_y_continuous</span>(expand = c(0,0)) +<br mpa-from-tpl="t"><span>theme_classic</span>()<br mpa-from-tpl="t"><span>p5</span> &lt;- ppp +<br mpa-from-tpl="t"><span>geom_col</span>(width = 0.6,<br mpa-from-tpl="t"><span>color</span> = NA, size = 0.5) +<br mpa-from-tpl="t"><span>geom_flow</span>(width = 0.6, alpha = 0.22, knot.pos = 0, <span>#直线连线效果</span><br mpa-from-tpl="t"><span>color</span> = 'white', size = 0.5) +<br mpa-from-tpl="t"><span>geom_alluvium</span>(width = 0.6, alpha = 1, knot.pos = 0,<br mpa-from-tpl="t"><span>fill</span> = NA, color = 'white', size = 0.5)<br mpa-from-tpl="t"><span>p5</span></p></pre></section><p><img data-ratio="0.8361581920903954" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GuIfCYEG8EC4iaYbuYaVQb3P733xDvTiaFKia2p2YRgQyZN3a3tDqBxSbLQ/640?wx_fmt=png" data-type="png" data-w="1416" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6mwwEBfD4cgLZKXMOXJl3GuIfCYEG8EC4iaYbuYaVQb3P733xDvTiaFKia2p2YRgQyZN3a3tDqBxSbLQ/640?wx_fmt=png"></p><p><br></p><p><span>其它主题美化大家根据自己的实际需求和喜好修改就好~</span></p><p><span><br></span></p><p><span>好啦，今天的分享就到这里！</span></p><p><span><br></span></p><p><span><strong><span>*未经许可，不得以任何方式复制或抄袭本篇文章之部分或全部内容。版权所有，侵权必究。</span></strong></span></p><p><span><br></span></p><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="105648"><section><section data-role="outer" label="Powered by 135editor.com"><section data-role="paragraph"><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="105648"><section><section><img data-ratio="0.8928571428571429" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJE8VibmibGU0Jxic9iabARVRH0FT6BNE8VAglWFXBPibFAU7a6tWGibSs8wyUg/640?wx_fmt=png" data-type="png" data-w="41" data-width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJE8VibmibGU0Jxic9iabARVRH0FT6BNE8VAglWFXBPibFAU7a6tWGibSs8wyUg/640?wx_fmt=png"></section><section><section><section data-width="35%"><section><section data-width="100%"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEv5etCBwHicqbEPwnVrkpaasxqaVibM4mT2JdIuN6yTlYWDD4mL5A427A/640?wx_fmt=jpeg" data-type="jpeg" data-w="860" data-width="100%" title="SCIPainter 30cm二维码.jpg" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEv5etCBwHicqbEPwnVrkpaasxqaVibM4mT2JdIuN6yTlYWDD4mL5A427A/640?wx_fmt=jpeg"></section></section></section><section data-width="50%"><section><section data-brushtype="text"><strong># SCIPainter</strong></section><section data-brushtype="text" hm_fix="361:593"><p>基迪奥旗下绘图公众号</p><p>分享科研绘图技能与工具</p><p>欢迎关注与转发~</p></section></section></section></section></section></section></section></section></section></section><section><br></section></section></section><section data-role="paragraph"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEgMd0aMPtmrDjiaX8sBhfhicVteeHf1JicexSpUbS3fdS9SiboUVN7guaPw/640?wx_fmt=gif" data-type="gif" data-w="400" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEgMd0aMPtmrDjiaX8sBhfhicVteeHf1JicexSpUbS3fdS9SiboUVN7guaPw/640?wx_fmt=gif"></section></section></section><section><section powered-by="xiumi.us"><section><p><span><strong>你的好友拍了拍你</strong></span></p><p><span><strong>并请你帮她点一下</strong></span><span><strong><span>“分享”</span></strong></span><span><strong><span>~</span></strong></span></p></section></section></section></section></section><p><br></p></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/mLv_lbsFWjn428sZboVBvQ",target="_blank" rel="noopener noreferrer">原文链接</a>
