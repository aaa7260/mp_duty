---
title: "ccle数据下载和整理"
date: 2023-01-28T02:19:57Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
ccle数据下载和整理 by 生信星球
------
<div><section data-mpa-powered-by="yiban.io"><img data-ratio="1" data-type="png" data-w="20" width="20px" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"><img data-ratio="1" data-type="png" data-w="20" width="20px" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png"><span> 今天是生信星球陪你的<span><strong>第894天</strong></span></span><img data-ratio="1" data-type="png" data-w="20" width="20px" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"></section><hr><p><span><span>   </span><span>大神一句话，菜鸟跑半年。我不是大神，但我可以缩短你走弯路的半年~</span></span></p><p><span>   就像歌儿唱的那样，如果你不知道该往哪儿走，就留在这学点生信好不好~</span></p><p><span>   这里有豆豆和花花的学习历程，从新手到进阶，生信路上有你有我!</span></p><section><h4><span>0.数据下载</span></h4><p>网址：https://sites.broadinstitute.org/ccle</p><p>Datasets-Broad DepMap Portal-CCLE2019-Allfiles，选择tpm和annotation文件下载。</p><figure><img data-ratio="0.6725806451612903" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPR20KM8P3DXW9IlCYwvS1KZ8QY8P3wib5sVJpYzHVwDG3UBE2h3n7ujJWJ1AmiaB0nic1swicvZW2eA/640?wx_fmt=png" data-type="png" data-w="1240" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPR20KM8P3DXW9IlCYwvS1KZ8QY8P3wib5sVJpYzHVwDG3UBE2h3n7ujJWJ1AmiaB0nic1swicvZW2eA/640?wx_fmt=png"></figure><figure><img data-ratio="0.6943548387096774" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPR20KM8P3DXW9IlCYwvS10Z62TrdN4ry5UwkVs6MxWQHmicjiaibondU57cYdsgTxLRKcAa3E3eT5A/640?wx_fmt=png" data-type="png" data-w="1240" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPR20KM8P3DXW9IlCYwvS10Z62TrdN4ry5UwkVs6MxWQHmicjiaibondU57cYdsgTxLRKcAa3E3eT5A/640?wx_fmt=png"></figure><figure><img data-ratio="0.4588709677419355" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPR20KM8P3DXW9IlCYwvS1X5p8eVic2eBMsjS7gLn0RG7YRuAdGTaD2aibraIiajre4AFX2MCHpvjeQ/640?wx_fmt=png" data-type="png" data-w="1240" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPR20KM8P3DXW9IlCYwvS1X5p8eVic2eBMsjS7gLn0RG7YRuAdGTaD2aibraIiajre4AFX2MCHpvjeQ/640?wx_fmt=png"></figure><figure><img data-ratio="0.49838709677419357" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPR20KM8P3DXW9IlCYwvS1rNkwOIibkhFUbaGBBRMYibDaj2emX0fVTPkURcJYwsPukmRNRpAV9sPA/640?wx_fmt=png" data-type="png" data-w="1240" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPR20KM8P3DXW9IlCYwvS1rNkwOIibkhFUbaGBBRMYibDaj2emX0fVTPkURcJYwsPukmRNRpAV9sPA/640?wx_fmt=png"></figure><h4><span>1.读取表达矩阵</span></h4><pre><code>rm(list = ls())<br>dat = data.table::fread(<span>"CCLE_RNAseq_rsem_genes_tpm_20180929.txt.gz"</span>,data.table = F)<br><span>dat[1:4,1:4]</span><br></code></pre><pre><code><span>#</span><span><span>#              gene_id</span></span><br><span>#</span><span><span># 1 ENSG00000000003.10</span></span><br><span>#</span><span><span># 2  ENSG00000000005.5</span></span><br><span>#</span><span><span># 3  ENSG00000000419.8</span></span><br><span>#</span><span><span># 4  ENSG00000000457.9</span></span><br><span>#</span><span><span>#                                                                                                                  transcript_ids</span></span><br><span>#</span><span><span># 1                                                                         ENST00000373020.4,ENST00000494424.1,ENST00000496771.1</span></span><br><span>#</span><span><span># 2                                                                                           ENST00000373031.4,ENST00000485971.1</span></span><br><span>#</span><span><span># 3 ENST00000371582.4,ENST00000371583.5,ENST00000371584.4,ENST00000371588.5,ENST00000413082.1,ENST00000466152.1,ENST00000494752.1</span></span><br><span>#</span><span><span># 4                                     ENST00000367770.1,ENST00000367771.6,ENST00000367772.4,ENST00000423670.1,ENST00000470238.1</span></span><br><span>#</span><span><span>#   22RV1_PROSTATE 2313287_STOMACH</span></span><br><span>#</span><span><span># 1           5.28            7.01</span></span><br><span>#</span><span><span># 2           0.00            0.00</span></span><br><span>#</span><span><span># 3          73.38          108.99</span></span><br><span>#</span><span><span># 4           9.76           16.76</span></span><br><br>exp = as.matrix(dat[,-(1:2)])<br>library(stringr)<br>rownames(exp) = str_split(dat$gene_id,"\\.",simplify = T)[,1]<br>exp = log2(exp+1)<br>exp[1:4,1:4]<br><span><br>#</span><span><span>#                 22RV1_PROSTATE 2313287_STOMACH 253JBV_URINARY_TRACT</span></span><br><span>#</span><span><span># ENSG00000000003       2.650765        3.001802             4.572890</span></span><br><span>#</span><span><span># ENSG00000000005       0.000000        0.000000             0.000000</span></span><br><span>#</span><span><span># ENSG00000000419       6.216843        6.781229             5.845741</span></span><br><span>#</span><span><span># ENSG00000000457       3.427606        4.150560             1.839960</span></span><br><span>#</span><span><span>#                 253J_URINARY_TRACT</span></span><br><span>#</span><span><span># ENSG00000000003           4.577731</span></span><br><span>#</span><span><span># ENSG00000000005           0.000000</span></span><br><span>#</span><span><span># ENSG00000000419           5.535742</span></span><br><span>#</span><span><span># ENSG00000000457           2.087463</span></span><br><span><br>#</span><span> 转换行名</span><br>library(AnnoProbe)<br>library(tinyarray)<br>an = annoGene(rownames(exp),ID_type = "ENSEMBL")<br>exp = trans_array(exp,ids = an,from = "ENSEMBL",to = "SYMBOL")<br>exp[1:4,1:4]<br><span><br>#</span><span><span>#             22RV1_PROSTATE 2313287_STOMACH 253JBV_URINARY_TRACT</span></span><br><span>#</span><span><span># DDX11L1          0.1634987       0.0000000           0.02856915</span></span><br><span>#</span><span><span># WASH7P           4.5422580       4.1667154           3.79285535</span></span><br><span>#</span><span><span># MIR1302-2HG      0.0000000       0.1505597           0.00000000</span></span><br><span>#</span><span><span># FAM138A          0.0000000       0.0000000           0.95605665</span></span><br><span>#</span><span><span>#             253J_URINARY_TRACT</span></span><br><span>#</span><span><span># DDX11L1              0.0000000</span></span><br><span>#</span><span><span># WASH7P               3.5861642</span></span><br><span>#</span><span><span># MIR1302-2HG          0.0000000</span></span><br><span>#</span><span><span># FAM138A              0.5753123</span></span><br></code></pre><h4><span>2. 读取注释信息</span></h4><pre><code>clinical = read.delim(<span>"Cell_lines_annotations_20181226.txt"</span>)<br>colnames(clinical)[c(1,5)] = c(<span>"id"</span>,<span>"site"</span>)<br></code></pre><h4><span>3.表达矩阵和临床信息对应起来</span></h4><pre><code>a = intersect(colnames(<span>exp</span>),clinical$id)<br><span>exp</span> = <span>exp</span>[,a]<br>clinical = clinical[match(a,clinical$id),]<br>identical(clinical$id,colnames(<span>exp</span>))<br><br><span>## [1] TRUE</span><br></code></pre><h4><span>4. 单基因表达量画图</span></h4><pre><code>library(dplyr)<br><span>#"METTL3","SETD2","TP53"</span><br>g = <span>"METTL3"</span><br>pdat = cbind(gene = exp[g,],clinical[,c(1,5)])<br>library(tidyr)<br>pdat = drop_na(pdat,site)<br>su = group_by(pdat,site) %&gt;% <br>  summarise(a = median(gene)) %&gt;% <br>  arrange(desc(a))<br>pdat$site = factor(pdat$site,levels = su$site)<br>library(ggplot2)<br>library(RColorBrewer)<br>mypalette &lt;- colorRampPalette(brewer.pal(8,<span>"Set1"</span>))<br>ggplot(pdat,aes(x = site,y = gene,fill = site))+<br>  geom_boxplot()+<br>  theme_bw()+<br>  theme(axis.text.x = element_text(vjust = 1,hjust = 1,angle = 70),legend.position = <span>"bottom"</span>)+<br>  scale_fill_manual(values = mypalette(25))+<br>  guides (fill=guide_legend (nrow=3, byrow=TRUE))<br></code></pre><figure><img data-ratio="0.714516129032258" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPR20KM8P3DXW9IlCYwvS1xu7QOAv0zcDHibibLCFFEqvK84EpowKCpTmrCK8l909sVRpdEKpchbDw/640?wx_fmt=png" data-type="png" data-w="1240" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPR20KM8P3DXW9IlCYwvS1xu7QOAv0zcDHibibLCFFEqvK84EpowKCpTmrCK8l909sVRpdEKpchbDw/640?wx_fmt=png"></figure></section><section><blockquote><section><span>如果因为代码看不懂，而跟不上正文的节奏，可以来找我，系统学习。我的</span><span>课程都是循环开课。</span><span>下一期的时间，点进去咨询微信咯</span><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247492627&amp;idx=1&amp;sn=614671537676eece45244aa1cbe94b15&amp;chksm=fdfbac51ca8c25475c71ed3b7b3506391a8d08149acfd62d0666193e382b33634382bef4f80d&amp;scene=21#wechat_redirect" textvalue="产假结束，核酸尚阴，期待遇见2023年的你" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">产假结束，核酸尚阴，期待遇见2023年的你</a><br></section></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/15T9VKcji9lO1RnyWaae2A",target="_blank" rel="noopener noreferrer">原文链接</a>
