---
title: "探索TCGA的临床特征分组——做差异分析前你有没有忘记它"
date: 2022-10-17T11:17:49Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
探索TCGA的临床特征分组——做差异分析前你有没有忘记它 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">上次我们说到把代谢基因做差异分析，由于TCGA中上传整理的并不是严格的tumor-normal实验设计，我们前期一直探索的LAML数据，就是没有normal样本的，那么就得选取别的分组做差异分析。而在差异分析前不能忘记的就是——<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247507260&amp;idx=3&amp;sn=5e8bc0208ee6d37181b6dbf79c653a73&amp;scene=21#wechat_redirect" data-linktype="2">再次强调表达量矩阵分析一定要三张图</a>，根据老师的要求先尝试质控三张图的pca图，我们最关心的生存结局，在这个时候就是没有显著差异的——这时我们会很自然地想到用其他临床特征来分组。</p><h4 data-tool="mdnice编辑器"><span></span>数据准备<span></span></h4><p data-tool="mdnice编辑器">导入我们在 <a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247505792&amp;idx=1&amp;sn=9a9b2d7293402c472ae6d91599908380&amp;scene=21#wechat_redirect" data-linktype="2">TCGA的XENA的转录组测序表达量矩阵预处理</a> 中，id转换之后的LAML表达量矩阵：</p><pre data-tool="mdnice编辑器"><span></span><code>load(file = 'output/rdata/0.expr.all.Rdata')<br>n_t_exp = dat<br>dim(n_t_exp)<br>#[1] 38953   151<br>n_t_exp[1:4,1:4]#没有运行colnames(n_t_exp) = substring(colnames(n_t_exp),1,15)，n_t_exp列名还是16位，我们后面的临床特征矩阵样本名也是16位<br>#       TCGA-AB-2949-03B TCGA-AB-2918-03A TCGA-AB-2943-03A TCGA-AB-2851-03A<br>#ZZZ3               3290             2830             4059             2087<br>#ZZEF1              7002             7297             6663             7688<br>#ZYX               10026            15461            10270            27210<br>#ZYG11B             1810             1645             1919             1718<br><br>dat=log(edgeR::cpm(n_t_exp)+1)<br></code></pre><p data-tool="mdnice编辑器">lncRNA和代谢基因表达矩阵：</p><pre data-tool="mdnice编辑器"><span></span><code>load( file = 'output/rdata/0.lncRNA_target_expression_data.Rdata') <br>lnc_dat[1:4, 1:4] <br>#            TCGA-AB-2949-03 TCGA-AB-2851-03 TCGA-AB-2822-03 TCGA-AB-2939-03<br>#ZSWIM8-AS1               15              14              21              11<br>#ZSCAN16-AS1             277             163             214             170<br>#ZRANB2-AS1               36              26             100              15<br>#ZNRD1-AS1              1880             929            1909            1663<br><br>target_dat[1:4, 1:4] #代谢基因<br>#         TCGA-AB-2949-03 TCGA-AB-2851-03 TCGA-AB-2822-03 TCGA-AB-2939-03<br>#ZACN                 104             117             137              93<br>#XYLT2                919            1305            1525            1214<br>#XDH                    1               1               1               5<br>#VKORC1L1            1578             954            1818            1473<br><br>lnc_g = rownames(lnc_dat)<br>prg_g = rownames(target_dat)<br>dat &lt;- t(dat[prg_g,])   #取的是基因不是样本<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>分组准备<span></span></h4><p data-tool="mdnice编辑器">导入生存信息和其他临床信息：</p><pre data-tool="mdnice编辑器"><span></span><code>load( file = <span>'output/rdata/0.survival.Rdata'</span>) <span>#之前处理好的生存信息</span><br>head(survdata)<br><span>#                event      time</span><br><span>#TCGA-AB-2802-03     1 1.0000000</span><br><span>#TCGA-AB-2803-03     1 2.1698630</span><br><span>#TCGA-AB-2804-03     0 7.0054795</span><br><span>#TCGA-AB-2805-03     1 1.5808219</span><br><span>#TCGA-AB-2806-03     1 2.5890411</span><br><span>#TCGA-AB-2807-03     1 0.4958904</span><br><br><span>library</span>(stringr)  <br><span>library</span>(data.table) <br>n1 &lt;- fread(<span>'input/TCGA-LAML.GDC_phenotype.tsv.gz'</span>, <span>#其他临床信息</span><br>            data.table = <span>F</span>) <br>dim(n1)  <span>#很多冗余信息</span><br><span>#[1] 697  98</span><br><br>head(colnames(n1),<span>15</span>)<br><span># [1] "submitter_id.samples"         "acute_myeloid_leukemia_calgb_cytogenetics_risk_category"</span><br><span># [3] "age_at_initial_pathologic_diagnosis"                     "atra_exposure"          # [5] "batch_number"                                            "bcr"                   </span><br><span># [7] "submitter_id"         "cumulative_agent_total_dose"</span><br><span># [9] "cytogenetic_abnormality_other"         "cytogenetic_analysis_performed_ind"    </span><br><span># [11] "day_of_dcc_upload"         "days_to_initial_pathologic_diagnosis"               </span><br><span># [13] "disease_detection_molecular_analysis_method_type"        "file_uuid"           </span><br><span># [15] "fish_evaluation_performed_ind"</span><br></code></pre><p data-tool="mdnice编辑器">见曾老师的基础教学：<a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247485416&amp;idx=1&amp;sn=068c72f52dcba98ea5e6c171d034e73b&amp;scene=21#wechat_redirect" data-linktype="2">对表型数据框进行去冗余</a></p><pre data-tool="mdnice编辑器"><span></span><code>rownames(n1) = n1[,<span>1</span>]<br>n2 = n1[colnames(n_t_exp), ] <span>#取临床特征矩阵和表达量矩阵的交集</span><br>n2=n2[,apply(n2,<span>2</span>,<span>function</span>(x) length(unique(x)) &gt; <span>1</span> )] <span>#去掉在所有样本里记录都一致的列</span><br>n2=n2[,apply(n2,<span>2</span>,<span>function</span>(x) length(unique(x)) &lt; <span>5</span> )] <span>#但是分组不要超过5个，这是自定的</span><br>             <br>dim(n2) <span>#这时候就只剩下23个特征了</span><br><span>#[1] 151  23</span><br>head(colnames(n2))<br><span># [1] "acute_myeloid_leukemia_calgb_cytogenetics_risk_category"               </span><br><span># [2] "atra_exposure"                                                         </span><br><span># [3] "cytogenetic_analysis_performed_ind"                                    </span><br><span># [4] "disease_detection_molecular_analysis_method_type"                      </span><br><span># [5] "fish_evaluation_performed_ind"                                         </span><br><span># [6] "fluorescence_in_situ_hybridization_abnormal_result_indicator"</span><br></code></pre><h4 data-tool="mdnice编辑器"><span></span>开始画图<span></span></h4><p data-tool="mdnice编辑器">生存结局的分组pca图：</p><pre data-tool="mdnice编辑器"><span></span><code>gp = as.factor(survdata$event) <br>table(gp)  <br><br>p1=fviz_pca_ind(dat.pca,<br>                geom.ind = <span>"point"</span>, <span># show points only (nbut not "text")</span><br>                col.ind = gp, <span># color by groups</span><br>                <span># alette = c("#00AFBB", "#E7B800"),</span><br>                addEllipses = <span>TRUE</span>, <span># Concentration ellipses</span><br>                legend.title = <span>"Tissue Type"</span>,<br>                <span>#title = 'Paired Samples',</span><br>                ggtheme = theme_minimal()<br>)<br>p1  <br>ggsave(p1,filename = paste0(pro,<span>'_'</span>,<span>'output/plot/step1.pca-surv.pdf'</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7480769230769231" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicBgdwcYECf0ibwpv0XcWg8OnpOJD5EfpjUr411vW7jHKQk681p3gETKkFv5bZJMjXiaz5CNl68iauiaw/640?wx_fmt=png" data-type="png" data-w="1040" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicBgdwcYECf0ibwpv0XcWg8OnpOJD5EfpjUr411vW7jHKQk681p3gETKkFv5bZJMjXiaz5CNl68iauiaw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">用两个临床特征的分组画pca看看：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#1---- prior_malignancy.diagnoses</span><br>table(n2$prior_malignancy.diagnoses)<br><span># no yes </span><br><span>#138  13 </span><br>gp = n2$prior_malignancy.diagnoses<br><br><span>library</span>(<span>"FactoMineR"</span>)<br><span>library</span>(<span>"factoextra"</span>) <br><br>dat.pca &lt;- PCA(dat , graph = <span>FALSE</span>)<br>p1=fviz_pca_ind(dat.pca,  <span>#看看样本和分组是否对应</span><br>                geom.ind = <span>"point"</span>, <span># show points only (nbut not "text")</span><br>                col.ind = gp, <span># color by groups</span><br>                <span># alette = c("#00AFBB", "#E7B800"),</span><br>                addEllipses = <span>TRUE</span>, <span># Concentration ellipses</span><br>                legend.title = <span>"prior_malignancy.diagnoses"</span>,<br>                <span>#title = 'Paired Samples',</span><br>                ggtheme = theme_minimal()<br>)<br>p1  <br>ggsave(p1,filename = <span>'output/plot/step1.pca-prior_malignancy.diagnoses.pdf'</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5296875" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicBgdwcYECf0ibwpv0XcWg8OHNWGs3icQveONjH8vymxgmMTjkroicDA8PUtzsRbHEPyd779rtRRoibibw/640?wx_fmt=png" data-type="png" data-w="1920" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicBgdwcYECf0ibwpv0XcWg8OHNWGs3icQveONjH8vymxgmMTjkroicDA8PUtzsRbHEPyd779rtRRoibibw/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code><span>#2---- fish_evaluation_performed_ind</span><br>table(n2$fish_evaluation_performed_ind)<br><span>#     NO YES </span><br><span>#  3  26 122</span><br>gp = n2$fish_evaluation_performed_ind<br><br><span>library</span>(<span>"FactoMineR"</span>)<br><span>library</span>(<span>"factoextra"</span>) <br><br>dat.pca &lt;- PCA(dat , graph = <span>FALSE</span>)<br>p1=fviz_pca_ind(dat.pca,  <span>#看看样本和分组是否对应</span><br>                geom.ind = <span>"point"</span>, <span># show points only (nbut not "text")</span><br>                col.ind = gp, <span># color by groups</span><br>                <span># alette = c("#00AFBB", "#E7B800"),</span><br>                addEllipses = <span>TRUE</span>, <span># Concentration ellipses</span><br>                legend.title = <span>"fish_evaluation_performed_ind"</span>,<br>                <span>#title = 'Paired Samples',</span><br>                ggtheme = theme_minimal()<br>)<br>p1  <br>ggsave(p1,filename = <span>'output/plot/step1.pca-fish_evaluation_performed_ind.pdf'</span>,)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5296875" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicBgdwcYECf0ibwpv0XcWg8OxqibTEVdAaqK9IdTH3s6yuc5Pvgez3cuvpvibvK0iapIHVBP2ldCA5thQ/640?wx_fmt=png" data-type="png" data-w="1920" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicBgdwcYECf0ibwpv0XcWg8OxqibTEVdAaqK9IdTH3s6yuc5Pvgez3cuvpvibvK0iapIHVBP2ldCA5thQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">小洁老师说过，当一个代码需要复制粘贴三次，就应该写成函数或使用循环：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#尝试写成循环</span><br>ftp = as.data.frame(colnames(n2))<br>n2 = n2[,-<span>11</span>] <span>#第11列是na</span><br>groupl = colnames(n2)<br>dat.pca &lt;- PCA(dat , graph = <span>FALSE</span>)<br><br><span>library</span>(<span>"FactoMineR"</span>)<br><span>library</span>(<span>"factoextra"</span>) <br><br>pca_list &lt;- lapply(groupl, <span>function</span>(i){<br>  <span>#i = groupl[3]</span><br>  gp = n2[,i]<br>  gp = as.factor(gp)<br>  <br>  p1=fviz_pca_ind(dat.pca, <br>                  geom.ind = <span>"point"</span>, <span># show points only (nbut not "text")</span><br>                  col.ind = gp, <span># color by groups</span><br>                  <span># alette = c("#00AFBB", "#E7B800"),</span><br>                  addEllipses = <span>TRUE</span>, <span># Concentration ellipses</span><br>                  legend.title = <span>'group'</span>,<br>                  title = i,<br>                  ggtheme = theme_minimal()<br>  )}) <br><br><span>#拼图</span><br><span>library</span>(patchwork)<br>p2 = wrap_plots(pca_list,nrow=<span>5</span>)<br>p2<br>ggsave(p2,filename = <span>'output/plot/step1.pca.png'</span>,<br>       width = <span>20</span>,height = <span>10</span>,<br>       limitsize = <span>FALSE</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicBgdwcYECf0ibwpv0XcWg8O6Ixwba6olRgatkJolIdk6a309bpfLYpdYfGKLJQUGyCHsW2k6A6aHQ/640?wx_fmt=png" data-type="png" data-w="6000" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicBgdwcYECf0ibwpv0XcWg8O6Ixwba6olRgatkJolIdk6a309bpfLYpdYfGKLJQUGyCHsW2k6A6aHQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">可以看到稍微能分开的是vital_number，分组是A-冷冻样本，B-石蜡包埋，那么肯定是不能当作差异分析的分组了，但是也许向我们展示了技术处理造成的误差，现在确实有很多做TCGA<span>技术</span>处理的研究。</p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/klTM3-pUWTUhcDC9LRqjQQ",target="_blank" rel="noopener noreferrer">原文链接</a>
