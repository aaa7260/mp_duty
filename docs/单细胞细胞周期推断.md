---
title: "单细胞细胞周期推断"
date: 2022-10-27T01:06:16Z
draft: ["false"]
tags: [
  "fetched",
  "生信随笔"
]
categories: ["Acdemic"]
---
单细胞细胞周期推断 by 生信随笔
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">最近我在进行单细胞分析时遇到一种亚群有较高的G2/M期占比，因此查阅了一些资料，在此探讨一下细胞周期相关的知识，特别是单细胞的细胞周期分析方法。下文主要介绍两种推测细胞周期的分析方法：R包<code>Seurat</code>和<code>tricycle</code>。</p><h3 data-tool="mdnice编辑器">一. 细胞周期的类型及功能</h3><p data-tool="mdnice编辑器">参考：https://hbctraining.github.io/scRNA-seq/lessons/cell_cycle_scoring.html</p><figure data-tool="mdnice编辑器"><img data-ratio="0.9736842105263158" data-src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZTRE9z8aN9NIQfWNNLr4jzKUYcVsyqeZVzpibTt7yZAEl4z9GaGPezvA/640?wx_fmt=other" data-type="other" data-w="228" src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZTRE9z8aN9NIQfWNNLr4jzKUYcVsyqeZVzpibTt7yZAEl4z9GaGPezvA/640?wx_fmt=other"></figure><ul data-tool="mdnice编辑器"><li><section><p><strong>G0:</strong> G0期是静息期或静息期细胞没有积极分裂，这在完全分化的细胞中很常见。有些类型的细胞可以长时间进入G0（特别是许多神经元细胞），而另一些类型的细胞则不会通过持续分裂进入G0（上皮细胞）。</p><p>Quiescence or resting phase. The cell is not actively dividing, which is common for cells that are fully differentiated. Some types of cells enter G0 for long periods of time (many neuronal cells), while other cell types never enter G0 by continuously dividing (epithelial cells).</p></section></li><li><section><p><strong>G1:</strong> G1期相代表“beginning of interphase”。在G1期，细胞的非染色体成分生长。从这个阶段开始，细胞可能进入G0或S期。</p><p>Gap 1 phase represents the <strong>beginning of interphase</strong>. During G1 there is growth of the non-chromosomal components of the cells. From this phase, the cell may enter G0 or S phase.</p></section></li><li><section><p><strong>S:</strong> 染色体复制的合成阶段(也是间期的一部分)。</p><p>Synthesis phase for the replication of the chromosomes (also part of interphase).</p></section></li><li><section><p><strong>G2:</strong> G2期是“end of interphase”，在进入有丝分裂期之前。<strong>在这个阶段，细胞生长为有丝分裂和纺锤形的形成做准备</strong>。</p><p>Gap 2 phase represents the <strong>end of interphase</strong>, prior to entering the mitotic phase. During this phase th cell grows in preparation for mitosis and the spindle forms.</p></section></li><li><section><p>M: M期是细胞的核分裂(包括前期、中期、后期和末期)。</p><p>M phase is the nuclear division of the cell (consisting of prophase, metaphase, anaphase and telophase).</p></section></li></ul><p data-tool="mdnice编辑器">在体内根据细胞的分裂能力可把他们分为三类：</p><ul data-tool="mdnice编辑器"><li><section><p>周期中细胞，即<strong>增殖细胞群</strong>，机体内某些组织需要不断地更新,组成这些组织的细胞就必须通过不断分裂产生新细胞。此类细胞的分裂周期非常正常, 有丝分裂的活性很高。如性细胞(包括卵母细胞和精原细胞)，造血干细胞（需要不断地产生红细胞和白细胞），表皮与胃肠粘膜上皮的干细胞（需要通过分裂不断补充表面老化死亡的细胞）。这类细胞始终保持活跃的分裂能力，连续进入细胞周期循环，持续分裂；</p></section></li><li><section><p>终末分化细胞（end cell），即不再增殖细胞群，这些细胞都是高度特化的细胞，如成熟的红细胞、神经细胞、心肌细胞等高度分化的细胞，它们永久性丧失了分裂能力，它们不可逆地脱离了细胞周期, 但保持了生理活性机能，这些细胞一旦分化,就永远保持这种不分裂状态直到死亡，又称终末细胞；</p></section></li><li><section><p>静止期细胞（G0细胞，休眠细胞），即<strong>暂不增殖细胞群</strong>，不进行DNA复制和分裂，如肝细胞、肾小管上皮细胞、甲状腺滤泡上皮细胞。<strong>它们是分化的，并执行特定功能的细胞，在通常情况下处于G0期，故又称G0期细胞</strong>。在某种刺激下，这些细胞重新进入细胞周期，重新开始DNA合成, 进行细胞分裂，如肝部分切除术后，剩余的肝细胞迅速分裂。成熟后便不再分裂的细胞有：骨细胞、红细胞、淋巴细胞（淋巴细胞可通过与抗原的相互作用诱导增殖）、消化道上皮细胞（如胰腺细胞）、神经细胞、心肌细胞、肌肉细胞等。分化终端的细胞通常都不再分裂。在胚胎发育早期（卵裂期），所有的细胞均为周期性细胞，以后随着发育成熟，某些细胞进入了G0期，某些细胞分化后丧失分裂能力。到成体时，只有少数细胞处于增殖状态, 它们的增殖仅作为补充丢失的细胞，或对外界刺激的反应。</p></section></li></ul><h3 data-tool="mdnice编辑器">二. 单细胞数据推测细胞周期</h3><h4 data-tool="mdnice编辑器">2.1 Seurat的方法</h4><p data-tool="mdnice编辑器">Seurat官方教程有计算细胞周期的方法（https://satijalab.org/seurat/articles/cell_cycle_vignette.html），本质上是根据单个细胞G2/M和S期标记的表达给每个细胞打分。</p><p data-tool="mdnice编辑器">Seurat提供了人类细胞周期阶段标记基因的列表，并根据 Tirosh, I. et al.. 等人的论文进行周期评分。进行细胞周期阶段的评分后，我们可以使用细胞周期基因的表达进行PCA。如果在PCA中细胞按细胞周期分组，那么我们会想要回归出细胞周期变化，除非细胞正在分化。</p><blockquote data-tool="mdnice编辑器"><p>这里可以参考我写的：<a href="https://mp.weixin.qq.com/s?__biz=Mzg5MjcxNzg1NA==&amp;mid=2247483968&amp;idx=1&amp;sn=ec13abc2b635574e613eba2006419050&amp;scene=21#wechat_redirect" data-linktype="2">单细胞归一化注意事项：校正变异源</a></p></blockquote><p data-tool="mdnice编辑器">Seurat自带的细胞周期得分，具体教程如下：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(Seurat)<br><span>library</span>(dplyr)<br><span>library</span>(SeuratData)<br>data(<span>"pbmc3k"</span>)<br>pbmc3k<br><span># An object of class Seurat </span><br><span># 13714 features across 2700 samples within 1 assay </span><br><span># Active assay: RNA (13714 features, 0 variable features)</span><br><br><span># A list of cell cycle markers, from Tirosh et al, 2015, is loaded with Seurat.  We can</span><br><span># segregate this list into markers of G2/M phase and markers of S phase</span><br>s.genes &lt;- cc.genes$s.genes<br>g2m.genes &lt;- cc.genes$g2m.genes<br><br>s.genes<br>g2m.genes<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.165625" data-src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZ0FZ0BpCnIic8eFvHgUCjA6agErlszFfJWRSLMKqGSEPusPYQtLMV62Q/640?wx_fmt=other" data-type="other" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZ0FZ0BpCnIic8eFvHgUCjA6agErlszFfJWRSLMKqGSEPusPYQtLMV62Q/640?wx_fmt=other"></figure><p data-tool="mdnice编辑器">常规的降维聚类：</p><pre data-tool="mdnice编辑器"><span></span><code>pbmc3k &lt;- pbmc3k %&gt;% NormalizeData(verbose = <span>F</span>) %&gt;%<br>  FindVariableFeatures(selection.method = <span>"vst"</span>, nfeatures = <span>2000</span>, verbose = <span>F</span>) %&gt;% <br>  ScaleData(verbose = <span>F</span>) %&gt;%<br>  RunPCA(npcs = <span>30</span>, verbose = <span>F</span>)<br><br>pbmc3k &lt;- pbmc3k %&gt;% <br>  RunUMAP(reduction = <span>"pca"</span>, dims = <span>1</span>:<span>30</span>, verbose = <span>F</span>) %&gt;% <br>  FindNeighbors(reduction = <span>"pca"</span>, k.param = <span>10</span>, dims = <span>1</span>:<span>30</span>)<br>pbmc3k &lt;- FindClusters(pbmc3k,resolution = <span>0.5</span>, algorithm = <span>1</span>)<br></code></pre><p data-tool="mdnice编辑器">这个测试数据是已经注释好的：</p><pre data-tool="mdnice编辑器"><span></span><code>DimPlot(pbmc3k,group.by = <span>"seurat_annotations"</span>,label = <span>T</span>)<br></code></pre><img data-ratio="0.6675062972292192" data-src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZOEYnm8AuHbNhPDQOvWan13sPfdgjjMRsiaQ4ugCcKdhg9VUEKEEwHHA/640?wx_fmt=other" data-type="other" data-w="794" src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZOEYnm8AuHbNhPDQOvWan13sPfdgjjMRsiaQ4ugCcKdhg9VUEKEEwHHA/640?wx_fmt=other"><p data-tool="mdnice编辑器">一行代码计算细胞周期：</p><pre data-tool="mdnice编辑器"><span></span><code>pbmc3k &lt;- CellCycleScoring(pbmc3k, s.features = s.genes, g2m.features = g2m.genes, set.ident = <span>TRUE</span>)<br>head(select(pbmc3k@meta.data,S.Score:old.ident))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.29391304347826086" data-src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZQvF73As9KyicakD0icTaXQV3E87ibEAVsooI87qzSa9lAhmxpZkk3GgmA/640?wx_fmt=other" data-type="other" data-w="575" src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZQvF73As9KyicakD0icTaXQV3E87ibEAVsooI87qzSa9lAhmxpZkk3GgmA/640?wx_fmt=other"></figure><p data-tool="mdnice编辑器">这里可以用我之前写的函数画一个barplot进行可视化，参考 <a href="https://mp.weixin.qq.com/s?__biz=Mzg5MjcxNzg1NA==&amp;mid=2247484055&amp;idx=1&amp;sn=acae137120cc651b1530b8764ae324d9&amp;scene=21#wechat_redirect" data-linktype="2">单细胞高级绘图：百分比条图</a></p><pre data-tool="mdnice编辑器"><span></span><code><span>source</span>(<span>"./custom_seurat_functions.R"</span>)<br>plot.clusters.group(data = pbmc3k,<br>                    clusters = <span>"seurat_annotations"</span>,<br>                    legend.position = <span>"right"</span>,<br>                    group = <span>"Phase"</span>,<br>                    widths = c(<span>2</span>,<span>1</span>),<br>                    text.size = <span>12</span>,<br>                    legend.title = <span>"Group"</span>,<br>                    color = <span>1</span>,<br>                    xlab = <span>""</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.45625" data-src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZWOT5U0YmBjChoOzLLALEqVNvTag6eYmoU844g2905BnSVtehohpiaIg/640?wx_fmt=other" data-type="other" data-w="800" src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZWOT5U0YmBjChoOzLLALEqVNvTag6eYmoU844g2905BnSVtehohpiaIg/640?wx_fmt=other"></figure><p data-tool="mdnice编辑器">当然也可以画小提琴图可视化得分：</p><pre data-tool="mdnice编辑器"><span></span><code>VlnPlot(pbmc3k,features = c(<span>"S.Score"</span>,<span>"G2M.Score"</span>),group.by = <span>"seurat_annotations"</span>,pt.size = <span>0</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6321112515802781" data-src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZtib1IyN8febmVBhK4PpaibDstmUHUNDwBkPQarShBTPO5wUfzGSRIDNw/640?wx_fmt=other" data-type="other" data-w="791" src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZtib1IyN8febmVBhK4PpaibDstmUHUNDwBkPQarShBTPO5wUfzGSRIDNw/640?wx_fmt=other"></figure><h4 data-tool="mdnice编辑器">2.2 R包tricycle</h4><p data-tool="mdnice编辑器">接下来重点介绍一下R包tricycle。</p><ul data-tool="mdnice编辑器"><li><section>github: https://github.com/hansenlab/tricycle/</section></li><li><section>文章：发表在Genome Biology, https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8802487/</section></li></ul><h5 data-tool="mdnice编辑器">Step0. 安装及测试数据准备：</h5><pre data-tool="mdnice编辑器"><span></span><code><span>if</span> (!requireNamespace(<span>"BiocManager"</span>, quietly = <span>TRUE</span>))<br>    install.packages(<span>"BiocManager"</span>)<br>BiocManager::install(<span>"tricycle"</span>, dependencies = <span>TRUE</span>)<br></code></pre><p data-tool="mdnice编辑器">示例数据：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tricycle)<br>data(neurosphere_example)<br></code></pre><p data-tool="mdnice编辑器">请注意，在运行tricycle前，用户应该标准化文库的大小。可以通过scater包中的<code>normalizeCounts</code>函数或通过计算CPM值来完成。</p><blockquote data-tool="mdnice编辑器"><p>或者是Seurat的<code>NormalizeData</code>函数也可。</p></blockquote><p data-tool="mdnice编辑器">这里我们不用示例数据，而是用上述<code>2.1 seurat</code>中处理好的pbmc3k数据：</p><pre data-tool="mdnice编辑器"><span></span><code>pbmc3k<br><span># An object of class Seurat </span><br><span># 13714 features across 2700 samples within 1 assay </span><br><span># Active assay: RNA (13714 features, 2000 variable features)</span><br><span># 2 dimensional reductions calculated: pca, umap</span><br></code></pre><p data-tool="mdnice编辑器">这个包推荐用SingleCellExperiment流程，所以我们要将Seurat数据转为SingleCellExperiment对象：</p><pre data-tool="mdnice编辑器"><span></span><code>pbmc3k.sce = as.SingleCellExperiment(pbmc3k)<br>pbmc3k.sce<br><span># class: SingleCellExperiment </span><br><span># dim: 13714 2700 </span><br><span># metadata(0):</span><br><span>#   assays(2): counts logcounts</span><br><span># rownames(13714): AL627309.1 AP006222.2 ... PNRC2.1 SRSF10.1</span><br><span># rowData names(0):</span><br><span>#   colnames(2700): AAACATACAACCAC AAACATTGAGCTAC ... TTTGCATGAGAGGC TTTGCATGCCTCAC</span><br><span># colData names(11): orig.ident nCount_RNA ... old.ident ident</span><br><span># reducedDimNames(2): PCA UMAP</span><br><span># mainExpName: RNA</span><br><span># altExpNames(0):</span><br></code></pre><h5 data-tool="mdnice编辑器">Step1. 将单个细胞数据集投射到预学习的细胞周期空间</h5><p data-tool="mdnice编辑器">该方法基于获取一个新的数据集并将其投影到表示细胞周期的嵌入中。这种嵌入是使用参考数据集构造的。也许令人惊讶的是，我们发现同样的嵌入适用于我们看过的所有实验，包括跨物种、细胞类型和数据集。我们将这个嵌入空间作为包的一部分提供，并且我们不期望用户更改这个嵌入(尽管包中的函数支持其他嵌入)。</p><blockquote data-tool="mdnice编辑器"><p>意思是作者做了一个参考数据集，他们认为这个参考数据集比较“万能”。</p></blockquote><p data-tool="mdnice编辑器">Project_cycle_space()将自动将具有名称logcount的检测投射到细胞周期嵌入中，而不需要任何其他参数输入。如果需要基因定位，可以指定物种(默认为mouse)、基因ID、基因ID类型和AnnotationDb对象。有关详细信息，请参阅man(project_cycle_space)。</p><blockquote data-tool="mdnice编辑器"><p>这里需要指定一下species和gname.type参数，不然会报错：</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code>pbmc3k.sce &lt;- project_cycle_space(pbmc3k.sce,<br>                                  species = c(<span>"human"</span>),<br>                                  gname.type = <span>"SYMBOL"</span>)<br>pbmc3k.sce<br><span># class: SingleCellExperiment </span><br><span># dim: 13714 2700 </span><br><span># metadata(0):</span><br><span>#   assays(2): counts logcounts</span><br><span># rownames(13714): AL627309.1 AP006222.2 ... PNRC2.1 SRSF10.1</span><br><span># rowData names(0):</span><br><span>#   colnames(2700): AAACATACAACCAC AAACATTGAGCTAC ... TTTGCATGAGAGGC TTTGCATGCCTCAC</span><br><span># colData names(11): orig.ident nCount_RNA ... old.ident ident</span><br><span># reducedDimNames(3): PCA UMAP tricycleEmbedding</span><br><span># mainExpName: RNA</span><br><span># altExpNames(0):</span><br></code></pre><p data-tool="mdnice编辑器">该函数会在<code>reducedDimNames</code>下生成一个“tricycleEmbedding”，和UMAP，PCA放在一起。</p><p data-tool="mdnice编辑器">可视化一下：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggplot2)<br><span>library</span>(scattermore)<br><span>library</span>(scater)<br>scater::plotReducedDim(pbmc3k.sce, dimred = <span>"tricycleEmbedding"</span>) +<br>  labs(x = <span>"Projected PC1"</span>, y = <span>"Projected PC2"</span>) +<br>  ggtitle(sprintf(<span>"Projected cell cycle space (n=%d)"</span>,<br>                  ncol(pbmc3k.sce))) +<br>  theme_bw(base_size = <span>14</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.928698752228164" data-src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZKTcPGXAibKW3Hje7L9S0gp1BECqZWkgSCqPx0Lw7IZxR2jZvnvUURXQ/640?wx_fmt=other" data-type="other" data-w="561" src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZKTcPGXAibKW3Hje7L9S0gp1BECqZWkgSCqPx0Lw7IZxR2jZvnvUURXQ/640?wx_fmt=other"></figure><h5 data-tool="mdnice编辑器">Step2. 推断细胞周期位置</h5><p data-tool="mdnice编辑器">下一步我们使用<code>estimate_cycle_position()</code>估计细胞周期位置。新的数据储存为了<code>tricyclePosition</code></p><pre data-tool="mdnice编辑器"><span></span><code>pbmc3k.sce &lt;- estimate_cycle_position(pbmc3k.sce)<br>names(colData(pbmc3k.sce))<br><span># [1] "orig.ident"         "nCount_RNA"         "nFeature_RNA"       "seurat_annotations" "RNA_snn_res.0.5" # [6] "seurat_clusters"    "S.Score"            "G2M.Score"          "Phase"              "old.ident"       # [11] "ident"              "tricyclePosition" </span><br></code></pre><p data-tool="mdnice编辑器">估计的细胞周期位置在0到2pi之间。注意，我们努力获得细胞周期状态的高分辨率，我们认为连续位置在描述细胞周期时更合适。但是，为了帮助用户理解位置变量，我们也注意到，<strong>用户可以近似地将</strong><strong>0.5pi关联为S阶段的开始，pi关联为G2M阶段的开始，1.5pi关联为M阶段的中间，1.75pi-0.25pi关联为G1/G0阶段</strong>。</p><h5 data-tool="mdnice编辑器">Step3. 性能评估</h5><p data-tool="mdnice编辑器">作者提供了2种方法评估TriCycle是否有效：</p><ul data-tool="mdnice编辑器"><li><section><p>Look at the projection of the data into the cell cycle embedding.</p></section></li><li><section><p>Look at the expression of key genes as a function of cell cycle position.</p></section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>fit.l &lt;- fit_periodic_loess(pbmc3k.sce$tricyclePosition,<br>                            assay(pbmc3k.sce, <span>'logcounts'</span>)[<span>"TOP2A"</span>,],<br>                            plot = <span>TRUE</span>,<br>                            x_lab = <span>"Cell cycle position \u03b8"</span>, y_lab = <span>"log2(TOP2A)"</span>,<br>                            fig.title = paste0(<span>"Expression of TOP2A along \u03b8 (n="</span>,<br>                                               ncol(pbmc3k.sce), <span>")"</span>))<br>names(fit.l)<br><span>#&gt; [1] "fitted"   "residual" "pred.df"  "loess.o"  "rsquared" "fig"</span><br>fit.l$fig + theme_bw(base_size = <span>14</span>)<br></code></pre><img data-ratio="0.8328690807799443" data-src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZF1bj01kWPsNFkibU2rOoBxW0MD2gbBibfic9gvH0P65j1s9SiaywWI9JBQ/640?wx_fmt=other" data-type="other" data-w="718" src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZF1bj01kWPsNFkibU2rOoBxW0MD2gbBibfic9gvH0P65j1s9SiaywWI9JBQ/640?wx_fmt=other"><p data-tool="mdnice编辑器">对于TOP2A，作者预计峰值表达在π（3.14）附近。可以看到，PBMC3K这个数据因为都是外周血的免疫细胞，增殖相关的细胞的确很少。</p><h5 data-tool="mdnice编辑器">Step4. 推断细胞周期阶段</h5><p data-tool="mdnice编辑器">尽管作者认为细胞周期应该是连续性的，但是用户往往还是想统计有多少细胞在S期，多少细胞在G2/M期，因此，除了定量的周期得分值的计算，作者还提供了推断细胞周期阶段的方法。该方法由Schwabe等人(2020)提出。作者做了一些小的修改来减少NA分配。但平均而言，性能与Revelio包非常相似。简单地说，作者计算高表达的细胞周期标记基因的Z-score，并将细胞分配到Z-score最大的周期阶段。</p><pre data-tool="mdnice编辑器"><span></span><code>pbmc3k.sce &lt;- estimate_Schwabe_stage(pbmc3k.sce,<br>                                              gname.type = <span>'SYMBOL'</span>,<br>                                              species = <span>'human'</span>)<br><span># No gname input. Rownames of x will be used.</span><br><span># Batch 1 phase G1.S gene:4</span><br><span># Batch 1 phase S gene:8</span><br><span># Batch 1 phase G2 gene:11</span><br><span># Batch 1 phase G2.M gene:17</span><br><span># Batch 1 phase M.G1 gene:7</span><br><br>scater::plotReducedDim(pbmc3k.sce, dimred = <span>"tricycleEmbedding"</span>,<br>                       colour_by = <span>"CCStage"</span>) +<br>  labs(x = <span>"Projected PC1"</span>, y = <span>"Projected PC2"</span>,<br>       title = paste0(<span>"Projected cell cycle space (n="</span>, ncol(pbmc3k.sce), <span>")"</span>)) +<br>  theme_bw(base_size = <span>14</span>)<br></code></pre><img data-ratio="0.8056206088992974" data-src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZNujd4YBVvyXEOMp3dmd4iciaWLicjdBUf8QGtG3pIrksEl0jklMgY3W6g/640?wx_fmt=other" data-type="other" data-w="854" src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZNujd4YBVvyXEOMp3dmd4iciaWLicjdBUf8QGtG3pIrksEl0jklMgY3W6g/640?wx_fmt=other"><pre data-tool="mdnice编辑器"><span></span><code>table(pbmc3k.sce$CCStage)<br><span># G1.S    S   G2 G2.M M.G1 </span><br><span># 219  208  264  215  271 </span><br><br>table(pbmc3k.sce$CCStage %&gt;% is.na())<br><span># FALSE  TRUE </span><br><span># 1177  1523 </span><br></code></pre><p data-tool="mdnice编辑器">可以看到细胞周期阶段可以推断为5种，G1.S期，S期，G2期，G2/M期和M.G1期，另外还有一半的细胞周期未知（NA），或属于暂不增殖的细胞群。</p><h5 data-tool="mdnice编辑器">Step5. 绘制核密度图</h5><p data-tool="mdnice编辑器">另一个有用的函数是<code>plot_ccposition_den</code>，它根据von Mises分布计算θ的核密度。输出图形有两种形式，极坐标和笛卡尔坐标。这里可以比较多分组间的差异（但是示例数据只有单个样本）。</p><pre data-tool="mdnice编辑器"><span></span><code>plot_ccposition_den(pbmc3k.sce$tricyclePosition,<br>                    pbmc3k.sce$orig.ident, <span>'sample'</span>,<br>                    bw = <span>10</span>, fig.title = <span>"PBMC3K density of \u03b8"</span>) +<br>  theme_bw(base_size = <span>14</span>)<br></code></pre><img data-ratio="0.7964743589743589" data-src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZsrjeOHXh0ickciaM2mmgkMBl9icoKZV2P1RZlviacprcu3851slUUDVbQw/640?wx_fmt=other" data-type="other" data-w="624" src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZsrjeOHXh0ickciaM2mmgkMBl9icoKZV2P1RZlviacprcu3851slUUDVbQw/640?wx_fmt=other"><pre data-tool="mdnice编辑器"><span></span><code>plot_ccposition_den(pbmc3k.sce$tricyclePosition,<br>                    pbmc3k.sce$orig.ident, <span>'sample'</span>, type = <span>"circular"</span>,<br>                    bw = <span>10</span>,  fig.title = <span>"PBMC3K density of \u03b8"</span>) +<br>  theme_bw(base_size = <span>14</span>)<br></code></pre><img data-ratio="0.9083469721767594" data-src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZeGF25D9mibiaj4r7H1NWeEc1bOLDDNiaTREiatjYw3BOKJFn7CibfkUibtMg/640?wx_fmt=other" data-type="other" data-w="611" src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZeGF25D9mibiaj4r7H1NWeEc1bOLDDNiaTREiatjYw3BOKJFn7CibfkUibtMg/640?wx_fmt=other"><h5 data-tool="mdnice编辑器">Step6. 绘制以细胞周期位置着色的嵌入散射图</h5><p data-tool="mdnice编辑器">为了可视化细胞周期位置θ，作者提供了一个比较炫酷的可视化函数：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(cowplot)<br>p &lt;- plot_emb_circle_scale(pbmc3k.sce, dimred = <span>1</span>,<br>                           point.size = <span>3.5</span>, point.alpha = <span>0.9</span>) +<br>  theme_bw(base_size = <span>14</span>)<br>legend &lt;- circle_scale_legend(text.size = <span>5</span>, alpha = <span>0.9</span>)<br><br>plot_grid(p, legend, ncol = <span>2</span>, rel_widths = c(<span>1</span>, <span>0.4</span>))<br></code></pre><p data-tool="mdnice编辑器"><code>dimred=1</code>是PCA图：</p><img data-ratio="0.82398753894081" data-src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZBJgEgyklYascwC0FszpOmoXWJdwY1IKBnCFErhJFvWxYicBTeecAU9A/640?wx_fmt=other" data-type="other" data-w="642" src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZBJgEgyklYascwC0FszpOmoXWJdwY1IKBnCFErhJFvWxYicBTeecAU9A/640?wx_fmt=other"><p data-tool="mdnice编辑器">调整<code>dimred</code>可以设置可视化为UMAP/TSNE，下面是UMAP图<code>dimred=2</code>：</p><pre data-tool="mdnice编辑器"><span></span><code>p &lt;- plot_emb_circle_scale(pbmc3k.sce, dimred = <span>2</span>,<br>                           point.size = <span>3.5</span>, point.alpha = <span>0.9</span>) +<br>  theme_bw(base_size = <span>14</span>)<br>legend &lt;- circle_scale_legend(text.size = <span>5</span>, alpha = <span>0.9</span>)<br><br>plot_grid(p, legend, ncol = <span>2</span>, rel_widths = c(<span>1</span>, <span>0.4</span>))<br></code></pre><img data-ratio="0.7409326424870466" data-src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZk2CIYoJCvHs34uWudvJyBedSclbwwiaHicSFE8y4mlEIYq8JQpvd1JUA/640?wx_fmt=other" data-type="other" data-w="579" src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqXRUDYYW4bWxS3ibzCXz39NZk2CIYoJCvHs34uWudvJyBedSclbwwiaHicSFE8y4mlEIYq8JQpvd1JUA/640?wx_fmt=other"><p data-tool="mdnice编辑器">最后可以把SCE数据对象转为Seurat：</p><pre data-tool="mdnice编辑器"><span></span><code><span>### 把数据转换为Seurat</span><br>pbmc3k = as.Seurat(pbmc3k.sce)<br></code></pre><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">画小提琴图：</p><pre data-tool="mdnice编辑器"><span></span><code>VlnPlot(pbmc3k,features = c(<span>"tricyclePosition"</span>),group.by = <span>"seurat_annotations"</span>,pt.size = <span>0</span>)<br></code></pre><img data-ratio="0.7263610315186246" data-src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqUlenffXCIW1Wq4kEvtSLxsfyw1WsumfJiaibLmLtvUYt1iaGv99czYxFJvevpGZqO5GzXUPU7Ydtic6A/640?wx_fmt=other" data-type="other" data-w="698" src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqUlenffXCIW1Wq4kEvtSLxsfyw1WsumfJiaibLmLtvUYt1iaGv99czYxFJvevpGZqO5GzXUPU7Ydtic6A/640?wx_fmt=other"><p data-tool="mdnice编辑器">依然是可以画一个柱状图进行可视化：</p><pre data-tool="mdnice编辑器"><span></span><code><span>source</span>(<span>"./custom_seurat_functions.R"</span>)<br>plot.clusters.group(data = pbmc3k,<br>                    clusters = <span>"seurat_annotations"</span>,<br>                    legend.position = <span>"right"</span>,<br>                    group = <span>"CCStage"</span>,<br>                    widths = c(<span>2</span>,<span>1</span>),<br>                    text.size = <span>12</span>,<br>                    legend.title = <span>"Group"</span>,<br>                    color = <span>1</span>,<br>                    xlab = <span>""</span>)<br></code></pre><img data-ratio="0.49668141592920356" data-src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqUlenffXCIW1Wq4kEvtSLxsDzsppUZFAxVz3uVQjHGnN23hv43UpaUSuIHc6QDTpQ7nuVzECd3VTA/640?wx_fmt=other" data-type="other" data-w="904" src="https://mmbiz.qpic.cn/mmbiz/fTW9zRI3eqUlenffXCIW1Wq4kEvtSLxsDzsppUZFAxVz3uVQjHGnN23hv43UpaUSuIHc6QDTpQ7nuVzECd3VTA/640?wx_fmt=other"><p data-tool="mdnice编辑器">这个结果实际上与Seurat的结果出入有一些大。</p></section><h4 data-tool="mdnice编辑器">2.3 DeepCycle：使用 RNA 速率和深度学习进行细胞周期分析</h4><p data-tool="mdnice编辑器">在检索单细胞细胞周期分析的时候，我注意到一个2022年5月份发表在NC上的Python包，主要基于RNA 速率和深度学习进行细胞周期分析原理。</p><ul data-tool="mdnice编辑器"><li><section>github https://github.com/andreariba/DeepCycle</section></li><li><section>文献：https://www.nature.com/articles/s41467-022-30545-8</section></li></ul><p data-tool="mdnice编辑器">使用看起来很简单：</p><pre data-tool="mdnice编辑器"><span></span><code>python DeepCycle.py \<br>  --input_adata adata_mESC.h5ad \<br>  --gene_list go_annotation/GO_cell_cycle_annotation_mouse.txt \<br>  --base_gene Nusap1 \<br>  --expression_threshold <span>0.5</span> \<br>  --gpu --hotelling \<br>  --output_adata adata_mESC_DeepCycle.h5ad<br></code></pre><p data-tool="mdnice编辑器">不过我觉得前述的两种R包已经能满足正常的细胞周期分析，有机会我再写一个DeepCycle包的测评贴。</p><span>- END -</span></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/cYFS4paYEZfHmC_Yalnslw",target="_blank" rel="noopener noreferrer">原文链接</a>
