---
title: "使用Hilbert曲线可视化CPAN上Perl模块分布"
date: 2023-01-09T23:30:52Z
draft: ["false"]
tags: [
  "fetched",
  "方圆之处"
]
categories: ["Acdemic"]
---
使用Hilbert曲线可视化CPAN上Perl模块分布 by 方圆之处
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">在网站http://mapofcpan.org/上有一个非常好看的对于CPAN Perl模块可视化的例子，如下图：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.72552783109405" data-type="png" data-w="2084" data-src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibdJN06UTIicSaVyvzkzZOmaSBs7YkJzBQ1g3p2P6eHYKeic2oQT48hDJwAVqhnwhl0r3jCoavUNzb7A/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibdJN06UTIicSaVyvzkzZOmaSBs7YkJzBQ1g3p2P6eHYKeic2oQT48hDJwAVqhnwhl0r3jCoavUNzb7A/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">在这篇文章中，我将展示如何使用R包<strong>HilbertCurve</strong>来绘制这样的图。</p><p data-tool="mdnice编辑器">我们首先读入CPAN上所有模块的名字，这个可以在https://www.cpan.org/modules/02packages.details.txt中找到。下面我们直接将这个文件读入：</p><pre data-tool="mdnice编辑器"><code>df = read.table(url(<span>"https://www.cpan.org/modules/02packages.details.txt"</span>), skip = <span>9</span>)<br>head(df)<br><span>##                     V1    V2                                            V3</span><br><span>## 1            A1z::Html  0.04              C/CE/CEEJAY/A1z-Html-0.04.tar.gz</span><br><span>## 2 A1z::HTML5::Template  0.22    C/CE/CEEJAY/A1z-HTML5-Template-0.22.tar.gz</span><br><span>## 3      A_Third_Package undef           C/CL/CLEMBURG/Test-Unit-0.13.tar.gz</span><br><span>## 4            AAA::Demo undef      J/JW/JWACH/Apache-FastForward-1.1.tar.gz</span><br><span>## 5            AAA::eBay undef      J/JW/JWACH/Apache-FastForward-1.1.tar.gz</span><br><span>## 6                 AAAA undef P/PR/PRBRENAN/Data-Table-Text-20210818.tar.gz</span><br></code></pre><p data-tool="mdnice编辑器">模块的名字在第一列中，同时我们将其排序。</p><pre data-tool="mdnice编辑器"><code>all_modules = sort(df[, <span>1</span>])<br></code></pre><p data-tool="mdnice编辑器">我们取每个模块的“命名空间”。命名空间是第一个<code>::</code>前面的字符串。注意，在Perl中，这可能不叫做命名空间，在这篇文章，为方便起见，我们称之为命名空间。</p><pre data-tool="mdnice编辑器"><code>ns = gsub(<span>"::.*$"</span>, <span>""</span>, all_modules)<br></code></pre><p data-tool="mdnice编辑器">现在<code>ns</code>是一个字符串向量，下面我们将其中的每一个值对应到一条Hilbert曲线上。我们首次将其转换为一个<code>Rle</code>对象。</p><pre data-tool="mdnice编辑器"><code><span>library</span>(IRanges)<br>r = Rle(ns)<br></code></pre><p data-tool="mdnice编辑器"><code>Rle</code>是一个很简单的类，定义在<strong>IRanges</strong>包中。在变量<code>r</code>中，每一个元素对应着<code>ns</code>中一个单独的命名空间，在向量<code>ns</code>中，每一个命名空间的位置和长度也被计算出。在下面的代码中，我们提取出这些信息：</p><pre data-tool="mdnice编辑器"><code>s = start(r)          <span># start position of each ns in r</span><br>e = end(r)            <span># end position of each ns in r</span><br>w = width(r)          <span># width of each ns in r</span><br>labels = runValue(r)  <span># corresponding labels</span><br>nr = nrun(r)          <span># number of levels of ns</span><br></code></pre><p data-tool="mdnice编辑器">现在我们可以进行Hilbert曲线可视化了。我们额外的将最大的30个命名空间高亮和加上名字。</p><pre data-tool="mdnice编辑器"><code><span>library</span>(HilbertCurve)<br><br>ind = order(w, decreasing = <span>TRUE</span>)[<span>1</span>:<span>30</span>]<br>w_cutoff = w[ ind[<span>30</span>] ] <span># 第30大的命名空间的长度</span><br><br>set.seed(<span>123</span>)  <span># because we have randomm colors</span><br>hc = HilbertCurve(<span>0</span>, length(all_modules), level = <span>8</span>, mode = <span>"pixel"</span>)<br>hc_layer(hc, x1 = s, x2 = e, <br>  col = circlize::rand_color(nr, transparency = ifelse(w &gt;= w_cutoff, <span>0</span>, <span>0.8</span>)))<br>hc_text(hc, x1 = s[ind], x2 = e[ind], labels = labels[ind], <br>  gp = gpar(fontsize = <span>9</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1" data-type="png" data-w="1536" data-src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibdJN06UTIicSaVyvzkzZOmaSVNp0bLrcHj1xqZUngSpGP8LOfWZ4QZuoCuTWmhETOHJuq5W14XHWmQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibdJN06UTIicSaVyvzkzZOmaSVNp0bLrcHj1xqZUngSpGP8LOfWZ4QZuoCuTWmhETOHJuq5W14XHWmQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">注意，部分文字的位置不是非常好，这以后可以改进。</p><p data-tool="mdnice编辑器">具体的关于<strong>HilbertCurve</strong>包的使用，请见相关文档，里面写的很清楚。</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/h-AdlY-qQVmYN0Z7vwMWZw",target="_blank" rel="noopener noreferrer">原文链接</a>
