---
title: "monaLisa: motif 富集分析"
date: 2024-05-05T23:05:38Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
monaLisa: motif 富集分析 by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><section><mp-common-profile data-pluginname="mpprofile" data-id="MzkyMTI1MTYxNA==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezgsqIGqjITSMggCTSoViaYeoKe2xoZr1IIvNJoztibQxibYHLDDoiabwAc6Ggws3Tvdo8EPss2nLgaVQ/0?wx_fmt=png" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h2 data-tool="mdnice编辑器"><span></span><span>引言</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p>一般我们对得到的 <strong>peaks</strong> 文件根据研究目的也许会进行 <strong>motif</strong> 分析, 来揭示目的蛋白所结合的序列特征。常见的软件有 <strong>homer, meme</strong>。这次我们使用 <strong>monaLisa</strong> 来进行 motif 分析。</p></blockquote><p data-tool="mdnice编辑器"><strong>参考文档:</strong></p><p data-tool="mdnice编辑器"><strong><em>https://bioconductor.org/packages/release/bioc/vignettes/monaLisa/inst/doc/monaLisa.html#1_Introduction</em></strong></p><h2 data-tool="mdnice编辑器"><span></span><span>安装</span><span></span></h2><pre data-tool="mdnice编辑器"><span></span><code>BiocManager::install(<span>"monaLisa"</span>)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>使用</span><span></span></h2><p data-tool="mdnice编辑器">读取获得的 <strong>peaks 的 bed 文件</strong>, 注意需要让它们长度一致, 然后获取对应的序列:</p><pre data-tool="mdnice编辑器"><span></span><code>BiocManager::install(<span>"monaLisa"</span>)<br>pacman::p_install_gh(<span>"da-bar/JASPAR2020"</span>)<br><br>setwd(<span>"~/JunJun/8.atacSeq_proj/7.motif-data/"</span>)<br><br><span>library</span>(monaLisa)<br><span>library</span>(JASPAR2020)<br><span>library</span>(rtracklayer)<br><span>library</span>(TFBSTools)<br><span>library</span>(BSgenome.Hsapiens.UCSC.hg19)<br><br><span># load peaks</span><br>rawpeak &lt;- import.bed(<span>"../5.peak-data/CTL_overlap.bed"</span>)<br><br><span># we would recommend to use regions of similar or even equal lengths to avoid a length bias</span><br>singleSet &lt;- resize(rawpeak, width = median(width(rawpeak)), fix = <span>"center"</span>)<br><br><span># check</span><br>head(singleSet,<span>3</span>)<br><span># GRanges object with 3 ranges and 0 metadata columns:</span><br><span>#        seqnames          ranges strand</span><br><span>#           &lt;Rle&gt;       &lt;IRanges&gt;  &lt;Rle&gt;</span><br><span>#   [1]     chr1   948979-949278      *</span><br><span>#   [2]     chr1 1051386-1051685      *</span><br><span>#   [3]     chr1 1057464-1057763      *</span><br><span>#   -------</span><br><span>#   seqinfo: 37 sequences from an unspecified genome; no seqlengths</span><br></code></pre><p data-tool="mdnice编辑器">提取序列:</p><pre data-tool="mdnice编辑器"><span></span><code><span># extract sequence</span><br>singleseqs &lt;- getSeq(BSgenome.Hsapiens.UCSC.hg19, singleSet)<br><br><span># check</span><br>head(singleseqs,<span>3</span>)<br><span># DNAStringSet object of length 3:</span><br><span>#   width seq</span><br><span># [1]   300 GGGGAGGTGGGCTCTGTGCCAGCCAATTTTCGTCTCCCTCCC...GGATGTAGAGGACAGACAGGAGGGAGCACTGTCCCTGGGTA</span><br><span># [2]   300 GACCCCAGCGCCCCAACCCGCTACCCTCACGCCTGCCCCCAG...CGGGGCGCGAAGCGCCCTGGGAAATGTAGTCCTAGAAGAAC</span><br><span># [3]   300 AGGAGGCTGGGGGGCCTCTGTCCCGCCATGGCTTCCCCGGGA...TCCGACTCCTGCCCGGGAAGTCAGGCAGTGTGGCCGGGACC</span><br></code></pre><p data-tool="mdnice编辑器">准备 motif 数据库文件:</p><pre data-tool="mdnice编辑器"><span></span><code><span># Prepare motif enrichment analysis,</span><br><span># extract all vertebrate motifs from the</span><br><span># JASPAR2020 package as positional weight matrices (PWMs)</span><br>pwms &lt;- getMatrixSet(JASPAR2020,<br>                     opts = list(matrixtype = <span>"PWM"</span>,<br>                                 tax_group = <span>"vertebrates"</span>))<br></code></pre><p data-tool="mdnice编辑器">富集分析:</p><pre data-tool="mdnice编辑器"><span></span><code><span># Single set motif enrichment analysis:</span><br><span># comparing a set of sequences to a suitable background</span><br>sinse &lt;- calcBinnedMotifEnrR(seqs = singleseqs,<br>                             pwmL = pwms,<br>                             background = <span>"genome"</span>,<br>                             genome = BSgenome.Hsapiens.UCSC.hg19,<br>                             genome.regions = <span>NULL</span>, <span># sample from full genome</span><br>                             genome.oversample = <span>2</span>,<br>                             BPPARAM = BiocParallel::SerialParam(RNGseed = <span>42</span>),<br>                             verbose = <span>TRUE</span>)<br><br><span># Filtering sequences ...</span><br><span># in total filtering out 0 of 12335 sequences (0%)</span><br><span># Scanning sequences for motif hits...</span><br><span># Create motif hit matrix...</span><br><span># starting analysis of bin 1</span><br><span># Defining background sequence set (genome)...</span><br><br><br><span># When we visualize motifs that are enriched with an adjusted p value of less than 10−4</span><br>pv &lt;- data.frame(tf = names(assay(sinse, <span>"negLog10Padj"</span>)[, <span>1</span>]),<br>                 p = assay(sinse, <span>"negLog10Padj"</span>)[, <span>1</span>]) %&gt;%<br>  na.omit() %&gt;%<br>  dplyr::filter(p &gt; <span>4</span>) %&gt;%<br>  dplyr::arrange(desc(p))<br></code></pre><p data-tool="mdnice编辑器">绘图:</p><pre data-tool="mdnice编辑器"><span></span><code><span># plot</span><br>plotMotifHeatmaps(x = sinse[pv$tf[<span>1</span>:<span>50</span>],],<br>                  which.plots = c(<span>"log2enr"</span>, <span>"negLog10Padj"</span>),<br>                  width = <span>1.8</span>, maxEnr = <span>2</span>, maxSig = <span>10</span>,<br>                  cluster = <span>T</span>,<br>                  show_dendrogram = <span>TRUE</span>,<br>                  show_seqlogo = <span>TRUE</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100029557" data-ratio="1.0261780104712042" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useyyvZ706ibQCxdrTZojyAMSibD276g0gqYwk6tQGNDeibaUBvcUiayKicUA8C3GZMciblWzMEHS5arCarUw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="764" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useyyvZ706ibQCxdrTZojyAMSibD276g0gqYwk6tQGNDeibaUBvcUiayKicUA8C3GZMciblWzMEHS5arCarUw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">我们用 <strong>homer</strong> 也看看 <strong>known motif</strong> 结果:</p><pre data-tool="mdnice编辑器"><span></span><code>findMotifsGenome.pl ../5.peak-data/CTL_overlap.bed hg19 CTL_motif -mask<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100029556" data-ratio="0.7963636363636364" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useyyvZ706ibQCxdrTZojyAMSib51sVDkrX7SbXrZxF09oEiarj7tBfU5hx5mz39TnW1qlmdByVUKDSOHA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1100" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useyyvZ706ibQCxdrTZojyAMSib51sVDkrX7SbXrZxF09oEiarj7tBfU5hx5mz39TnW1qlmdByVUKDSOHA/640?wx_fmt=png&amp;from=appmsg"></figure><hr data-tool="mdnice编辑器"><blockquote data-tool="mdnice编辑器"><span>❝</span><p>此外,这个包还可以根据 bed 文件一列的数值型变量,可以分成不同的 <strong>bin</strong>, r 然后进行富集分析, 包里举的例子是代表不同甲基化的水平, 图像下面这样,每一列是一个数值区间:</p></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100029558" data-ratio="1.25" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useyyvZ706ibQCxdrTZojyAMSibIttSwpMwiaxMvuQa6JzMg94A585vOyhj2xn1z1fLu4FJU1hFUMfCA7g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1536" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useyyvZ706ibQCxdrTZojyAMSibIttSwpMwiaxMvuQa6JzMg94A585vOyhj2xn1z1fLu4FJU1hFUMfCA7g/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>结尾</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong>路漫漫其修远兮,吾将上下而求索。</strong></p></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">欢迎加入生信交流群。加我微信我也拉你进 <strong>微信群聊</strong> <strong>老俊俊生信交流群</strong> <strong>(微信交流群需收取 20 元入群费用,一旦交费,拒不退还!(防止骗子和便于管理))</strong> 。QQ 群可免费加入, 记得进群按格式修改备注哦。</p><section data-tool="mdnice编辑器"><section><p><strong>老俊俊微信：</strong></p><figure><img data-imgfileid="100029555" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useyyvZ706ibQCxdrTZojyAMSibHiawWld5IXWTZxSkqSADwxLaJbhEyibRZMkD5ia8xASWLSKkFoNI9q4eA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="430" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useyyvZ706ibQCxdrTZojyAMSibHiawWld5IXWTZxSkqSADwxLaJbhEyibRZMkD5ia8xASWLSKkFoNI9q4eA/640?wx_fmt=png&amp;from=appmsg"></figure><figure><img data-imgfileid="100029559" data-ratio="1.3668430335097002" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useyyvZ706ibQCxdrTZojyAMSibC6xsLAdmOkKkibibmLfiaCXFPiaL4h63CkvmvabROnTdWx2pcxycZ5W5MQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="567" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4useyyvZ706ibQCxdrTZojyAMSibC6xsLAdmOkKkibibmLfiaCXFPiaL4h63CkvmvabROnTdWx2pcxycZ5W5MQ/640?wx_fmt=png&amp;from=appmsg"></figure></section><section><p><strong>知识星球：</strong></p><figure><img data-imgfileid="100029564" data-ratio="1.5896226415094339" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4useyyvZ706ibQCxdrTZojyAMSibaguoeviaU672bcXEFjanVcgXDh0GyrasW8Ea5ickS9NWnUCP0XQZ2QKA/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1060" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4useyyvZ706ibQCxdrTZojyAMSibaguoeviaU672bcXEFjanVcgXDh0GyrasW8Ea5ickS9NWnUCP0XQZ2QKA/640?wx_fmt=jpeg&amp;from=appmsg"></figure></section></section><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><strong></strong></p><center data-tool="mdnice编辑器"><strong> 往期回顾目录 </strong></center><p data-tool="mdnice编辑器"><br></p><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong></strong></p><center><strong><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513202&amp;idx=1&amp;sn=4c96ea0db4628f354a349420525f9809&amp;chksm=c1848e03f6f307151fdc3d0571471f50fec9448b77807a2a9b92546006e1c2b08eb05d871d4d&amp;token=1368479419&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">rgt-hint 转录因子预测结果可视化(续)</a></strong></center><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513180&amp;idx=1&amp;sn=51e30d1b04182f55bb0c23901a37a36a&amp;chksm=c1848e2df6f3073bb4f5c00f60cd1c6725fe08992431cf0aadee3563bb8db3a2c0cf170c634e&amp;token=896011679&amp;lang=zh_CN&amp;poc_token=HP5gMmajxs0JmmG1VFdSTh9aDqshMc0eJZ_Jp5Av&amp;scene=21#wechat_redirect" data-linktype="2">rgt-hint 转录因子预测结果可视化</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513159&amp;idx=1&amp;sn=832b6c709d2df7a32d8fc64c609e4ac4&amp;chksm=c1848e36f6f3072035a95da9f10234e5b162ca058bb7bbb041ddd5d44bca17c143279246de21&amp;token=635906193&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">绘图时如何处理 Input 样本</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513137&amp;idx=1&amp;sn=ffd1d42ce1174494bc53d58726a93778&amp;chksm=c1848e40f6f3075653a6849b9525d40a682a89231053f076f03a7026aed5ddab7509f89f0121&amp;token=635906193&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ATAC-seq 数据分析实操教程</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513054&amp;idx=1&amp;sn=e87d34b1b715ff2a00628e4bb0886ba3&amp;chksm=c18489aff6f300b9ab3cdda646acb3a02914b79c3f28433b9a05722625ac65175318d0f8e7c2&amp;token=1860740043&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ATAC-seq 分析方法一览</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513016&amp;idx=1&amp;sn=902232584345e1435aade90821238a9e&amp;chksm=c18489c9f6f300dfe8e7e436f76c891eb8234ec40a388f361f7838dc6dc61fd17ccb33f96bac&amp;token=1218322320&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">locuszoomr 可视化 GWAS 结果</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247512947&amp;idx=1&amp;sn=87d8684deca7bcf68ec887e067449ce5&amp;chksm=c1848902f6f30014f25b1e24e98e8ec4edf704bf70a037d4d291d3e5c7aae7e826635926e345&amp;token=538711716&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">2024 了,听说你还在用 dplyr 处理数据?</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247512936&amp;idx=1&amp;sn=53d5444bfa7e6028c169578cd6fc873d&amp;chksm=c1848919f6f3000f297af5def286cf09caad0898d6598277f610b9563116c7c4000f34d79daf&amp;token=1008140360&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">计算 motif 到 peak center 的距离</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247512922&amp;idx=1&amp;sn=247004f40306ea4e555fb6e32480a42f&amp;chksm=c184892bf6f3003d132a9779834b2d4df5c3f1b52ec9c3a04041d7398f3ec155560efe6eb578&amp;token=2004442534&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">写个包 metaplot 绘制 m6A peak 分布</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247512856&amp;idx=1&amp;sn=7f9fd9406d4768535450ef9e2df44890&amp;chksm=c1848969f6f3007fb1e0010b0ce49fd5738fa5fd8f4759ffea56cfbe89ffaaf29e1016ed149e&amp;token=709285857&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">当 ggSCvis 遇到 ggmagnify</a></center></strong><p><br></p></blockquote></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/nJJrH46Vg1a4v4vYVK0RhA",target="_blank" rel="noopener noreferrer">原文链接</a>
