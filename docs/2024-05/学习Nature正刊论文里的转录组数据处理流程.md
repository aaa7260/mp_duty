---
title: "学习Nature正刊论文里的转录组数据处理流程"
date: 2024-05-26T14:08:46Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Acdemic"]
---
学习Nature正刊论文里的转录组数据处理流程 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>论文</span><span></span><span> </span></h2><blockquote data-tool="mdnice编辑器"><span></span><p>Temporal dynamics of the multi-omic response to endurance exercise training</p></blockquote><p data-tool="mdnice编辑器">https://www.nature.com/articles/s41586-023-06877-w</p><p data-tool="mdnice编辑器">这个论文很有意思，有时间的话可以仔细看看研究思路和研究内容。</p><p data-tool="mdnice编辑器">论文中提供的转录组数据处理代码链接</p><p data-tool="mdnice编辑器">https://github.com/MoTrPAC/motrpac-rna-seq-pipeline/tree/master</p><p data-tool="mdnice编辑器">这里代码是 wdl 这个格式，wdl具体是啥暂时还没有搞明白。能把里面的代码逐行摘出来。</p><p data-tool="mdnice编辑器"><strong>今天推文的练习内容需要用到linux操作系统。如果自己课题组没有的话可以购买阿里云服务器。购买链接</strong></p><p data-tool="mdnice编辑器">https://www.aliyun.com/daily-act/ecs/activity_selection?source=5176.11533457&amp;userCode=3enjgk6n</p><p data-tool="mdnice编辑器"><strong>配置是2核2G内存和40G存储空间。99元每年。可以续费一次。</strong></p><p data-tool="mdnice编辑器">今天推文的示例数据我用到的是拟南芥转录组数据。为了减小数据量。我把5号染色体和对应的测序数据单独摘出来，以供练习使用。如果你通过以上链接购买了阿里云服务器。可以添加我的微信 <strong>mingyan24 </strong>。我发送对应的练习数据。</p><p data-tool="mdnice编辑器"><strong>购买了云服务器后首先是配置linux操作系统，参考推文</strong></p><p data-tool="mdnice编辑器"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI3NzQ3MTcxMg==&amp;mid=2247497114&amp;idx=1&amp;sn=7d77f87f9df224812da59c62722f19c8&amp;chksm=eb677d15dc10f403cf60d6bfb76c3c5461a46f61a2b9d1f902971bf5d8bad8e805489dadbced&amp;scene=21#wechat_redirect" textvalue="生物信息学入门~购买99元1年的云服务器用于练习linux系统使用" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">生物信息学入门~购买99元1年的云服务器用于练习linux系统使用</a><br></p><p data-tool="mdnice编辑器"><strong>接下来是安装xshell和xftp远程链接和上传下载文件，参考推文</strong></p><p data-tool="mdnice编辑器"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI3NzQ3MTcxMg==&amp;mid=2247497338&amp;idx=2&amp;sn=4a2085cc54c5f481f3bf435b753bf648&amp;chksm=eb677ef5dc10f7e3b55a8d87473c19cb4f655f21ca85d25d1beb2b25a760558d933b0df5c8eb&amp;scene=21#wechat_redirect" textvalue="生物信息学入门- Xshell 和 Xftp 的安装 远程链接云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">生物信息学入门- Xshell 和 Xftp 的安装 远程链接云服务器</a><br></p><p data-tool="mdnice编辑器"><strong>接下来是在云服务器上安装anaconda3用来安装转录组数据处理需要用到的软件，参考推文</strong></p><p data-tool="mdnice编辑器"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI3NzQ3MTcxMg==&amp;mid=2247497338&amp;idx=1&amp;sn=28a68958407e5f5d72765179fa5f78fa&amp;chksm=eb677ef5dc10f7e3ad4c41286181afc309b2ae587006bbfc9130c6d350879ec2bbd52cdbd514&amp;scene=21#wechat_redirect" textvalue="生物信息学入门~在购买的云服务器上安装anaconda3用于常用的软件安装" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">生物信息学入门~在购买的云服务器上安装anaconda3用于常用的软件安装</a><br></p><p data-tool="mdnice编辑器"><strong>论文中转录组数据的处理流程包括：</strong></p><ul data-tool="mdnice编辑器"><li><section>1、用fastqc软件查看测序数据的质量</section></li><li><section>2、使用multiqc软件将fastqc软件的结果合并方便查看</section></li><li><section>3、cutadapter软件对测序数据进行去接头</section></li><li><section>4、star软件对参考基因组构建索引</section></li><li><section>5、star软件将测序数据比对到参考基因组</section></li><li><section>6、samtools将比对文件做格式转换（star软件可以指定输出格式，这一步可以省略）</section></li><li><section>7、featurecounts软件计算每个基因的count值</section></li><li><section>8、使用R语言的DESeq2包做差异表达分析</section></li></ul><p data-tool="mdnice编辑器">今天的推文内容只介绍4、5、6、7的步骤，先把基础的流程跑下来然后再去研究1、2、3步</p><p data-tool="mdnice编辑器">这些软件都可以通过conda进行安装，安装命令</p><pre data-tool="mdnice编辑器"><span></span><code>conda install star -c bioconda<br>conda install samtools -c bioconda<br>conda install subread -c subread<br></code></pre><p data-tool="mdnice编辑器">featurecounts是subread这个软件里的子软件，直接安装subread就可以了</p><h2 data-tool="mdnice编辑器"><span></span><span>对参考基因组构建索引</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code><span>cd</span> ref<br>mkdir atChr5<br>STAR --runMode genomeGenerate --genomeDir atChr5 --genomeFastaFiles chr5.fna --sjdbGTFfile chr5.gtf --sjdbOverhang 100 --runThreadN 1 --limitGenomeGenerateRAM 500000000 --genomeSAindexNbases 11 <br><span>cd</span> ../<br><br></code></pre><p data-tool="mdnice编辑器">运行命令输出</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100013769" data-ratio="0.49224806201550386" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk77GH7neLCDmMrSj7qey4ic3jsLfiaKIA2wd09AfVf3MVcSh6wyQSNia7UoEOP73YUgTRFkewRrslh4Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="774" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk77GH7neLCDmMrSj7qey4ic3jsLfiaKIA2wd09AfVf3MVcSh6wyQSNia7UoEOP73YUgTRFkewRrslh4Q/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>测序数据与参考基因组进行比对</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>mkdir 02.star.output.sam<br>STAR --genomeDir ref/atChr5 --readFilesIn 01.reads/ERR1886187.r1.fq 01.reads/ERR1886187.r2.fq --outFileNamePrefix 02.star.output.sam/ERR1886187 --readFilesCommand cat --outSAMattributes NH HI AS NM MD nM --runThreadN 1 --outSAMtype BAM SortedByCoordinate --quantMode TranscriptomeSAM<br><span>## 这一步数据量非常小，运行速度很快，真实数据需要一些时间，再依次运行剩下的5组数据</span><br><br>STAR --genomeDir ref/atChr5 --readFilesIn 01.reads/ERR1886193.r1.fq 01.reads/ERR1886193.r2.fq --outFileNamePrefix 02.star.output.sam/ERR1886193 --readFilesCommand cat --outSAMattributes NH HI AS NM MD nM --runThreadN 1 --outSAMtype BAM SortedByCoordinate --quantMode TranscriptomeSAM<br>STAR --genomeDir ref/atChr5 --readFilesIn 01.reads/ERR1886283.r1.fq 01.reads/ERR1886283.r2.fq --outFileNamePrefix 02.star.output.sam/ERR1886283 --readFilesCommand cat --outSAMattributes NH HI AS NM MD nM --runThreadN 1 --outSAMtype BAM SortedByCoordinate --quantMode TranscriptomeSAM<br>STAR --genomeDir ref/atChr5 --readFilesIn 01.reads/ERR1886289.r1.fq 01.reads/ERR1886289.r2.fq --outFileNamePrefix 02.star.output.sam/ERR1886289 --readFilesCommand cat --outSAMattributes NH HI AS NM MD nM --runThreadN 1 --outSAMtype BAM SortedByCoordinate --quantMode TranscriptomeSAM<br><br>STAR --genomeDir ref/atChr5 --readFilesIn 01.reads/ERR1886352.r1.fq 01.reads/ERR1886352.r2.fq --outFileNamePrefix 02.star.output.sam/ERR1886352 --readFilesCommand cat --outSAMattributes NH HI AS NM MD nM --runThreadN 1 --outSAMtype BAM SortedByCoordinate --quantMode TranscriptomeSAM<br><br>STAR --genomeDir ref/atChr5 --readFilesIn 01.reads/ERR1886358.r1.fq 01.reads/ERR1886358.r2.fq --outFileNamePrefix 02.star.output.sam/ERR1886358 --readFilesCommand cat --outSAMattributes NH HI AS NM MD nM --runThreadN 1 --outSAMtype BAM SortedByCoordinate --quantMode TranscriptomeSAM<br></code></pre><p data-tool="mdnice编辑器">运行命令输出</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100013768" data-ratio="0.2402088772845953" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk77GH7neLCDmMrSj7qey4ic3hMBQXOqCfvviczPxGGAGgeCKdibCsfAF5BVGRMgtRiao09AlZvNWRuz0A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="766" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk77GH7neLCDmMrSj7qey4ic3hMBQXOqCfvviczPxGGAGgeCKdibCsfAF5BVGRMgtRiao09AlZvNWRuz0A/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>计算每个基因的count值</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>mkdir 03.fc.output<br>featureCounts -a ref/chr5.gtf -o 03.fc.output/ERR1886187.out -p -M --fraction 02.star.output.sam/ERR1886187Aligned.sortedByCoord.out.bam<br>featureCounts -a ref/chr5.gtf -o 03.fc.output/ERR1886193.out -p -M --fraction 02.star.output.sam/ERR1886193Aligned.sortedByCoord.out.bam<br><br>featureCounts -a ref/chr5.gtf -o 03.fc.output/ERR1886283.out -p -M --fraction 02.star.output.sam/ERR1886283Aligned.sortedByCoord.out.bam<br><br>featureCounts -a ref/chr5.gtf -o 03.fc.output/ERR1886289.out -p -M --fraction 02.star.output.sam/ERR1886289Aligned.sortedByCoord.out.bam<br>featureCounts -a ref/chr5.gtf -o 03.fc.output/ERR1886352.out -p -M --fraction 02.star.output.sam/ERR1886352Aligned.sortedByCoord.out.bam<br>featureCounts -a ref/chr5.gtf -o 03.fc.output/ERR1886358.out -p -M --fraction 02.star.output.sam/ERR1886358Aligned.sortedByCoord.out.bam<br></code></pre><p data-tool="mdnice编辑器">输出内容</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100013772" data-ratio="0.759825327510917" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk77GH7neLCDmMrSj7qey4ic3xewkGkh22lIwjHkcudNxUmLVXa2VUnicQ6YRggCHgJh4DJW7OMXSNKA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="916" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk77GH7neLCDmMrSj7qey4ic3xewkGkh22lIwjHkcudNxUmLVXa2VUnicQ6YRggCHgJh4DJW7OMXSNKA/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>将6个样本计算的count值合并为一个表格</span><span></span><span> </span></h2><p data-tool="mdnice编辑器">直接用论文中提供的脚本</p><p data-tool="mdnice编辑器">https://github.com/MoTrPAC/motrpac-rna-seq-pipeline/blob/master/wdl/merge_results/merge_fc.py</p><p data-tool="mdnice编辑器">这里发现一个小bug</p><p data-tool="mdnice编辑器">代码31行 一个/ 需要改成两个 //</p><p data-tool="mdnice编辑器">（突然发现这个不是bug，输入文件夹最后不能包括/，不用改原始脚本）</p><pre data-tool="mdnice编辑器"><span></span><code>mkdir 04.fc.collect.out</code><code>cp <span>03.fc.output/*.out <span>04.fc.collect.out</span></span></code><code><span>python merge_fc.py --fc_dir 04.fc.collect.out</span></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100013770" data-ratio="0.3665338645418327" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk77GH7neLCDmMrSj7qey4ic3P3Mu2CUGn0aYX0zryBtfXiaNh1kqt8CXXAy97yoDj1N8psRnBWddNaQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1004" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk77GH7neLCDmMrSj7qey4ic3P3Mu2CUGn0aYX0zryBtfXiaNh1kqt8CXXAy97yoDj1N8psRnBWddNaQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">输出文件是 featureCounts.txt</p><p data-tool="mdnice编辑器">这里绝大部分都是0，可能是因为数据太少了</p><p data-tool="mdnice编辑器">我用之前用所有染色体的数据再跑一下featureCounts流程</p><pre data-tool="mdnice编辑器"><span></span><code>gffread at.col0.chr.gff -T -o at.col0.chr.gtf<br>featureCounts -a ref/at.col0.chr.gtf -o 05.fc.out/ERR1886187.out -p -M --fraction 03.sorted.bam/ERR1886187.sorted.bam<br>featureCounts -a ref/at.col0.chr.gtf -o 05.fc.out/ERR1886193.out -p -M --fraction 03.sorted.bam/ERR1886193.sorted.bam<br>featureCounts -a ref/at.col0.chr.gtf -o 05.fc.out/ERR1886283.out -p -M --fraction 03.sorted.bam/ERR1886283.sorted.bam<br><br>featureCounts -a ref/at.col0.chr.gtf -o 05.fc.out/ERR1886289.out -p -M --fraction 03.sorted.bam/ERR1886289.sorted.bam<br>featureCounts -a ref/at.col0.chr.gtf -o 05.fc.out/ERR1886352.out -p -M --fraction 03.sorted.bam/ERR1886352.sorted.bam<br><br>featureCounts -a ref/at.col0.chr.gtf -o 05.fc.out/ERR1886358.out -p -M --fraction 03.sorted.bam/ERR1886358.sorted.bam<br><br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>python ../Nature.RNAseq/merge_fc.py --fc_dir 05.fc.out/<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100013771" data-ratio="0.2914669223394056" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk77GH7neLCDmMrSj7qey4ic3oKvW62t295OMnKb8tmsQ582RvhpNAed12srAoAecZKI8cmfNzpr0ew/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1043" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk77GH7neLCDmMrSj7qey4ic3oKvW62t295OMnKb8tmsQ582RvhpNAed12srAoAecZKI8cmfNzpr0ew/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100013777" data-ratio="0.42592592592592593" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk77GH7neLCDmMrSj7qey4ic38WuupMedjanRndBpMTGAmUcBcYZCn2l8nicH6qvzMY0vibicqyaCqf8PQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk77GH7neLCDmMrSj7qey4ic38WuupMedjanRndBpMTGAmUcBcYZCn2l8nicH6qvzMY0vibicqyaCqf8PQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器"><strong>欢迎大家关注我的公众号</strong></p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzI3NzQ3MTcxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5t1sOnM0iabvBhnfIj5YpyqrMib0E1MGCd9ibcYxaOPZd0GWhQBDvK2BPEwsicQxd6y5MHLfphnwHnow/0?wx_fmt=png" data-nickname="小明的数据分析笔记本" data-alias="" data-signature="分享R语言和python在生物信息领域做数据分析和数据可视化的简单小例子；偶尔会分享一些组学数据处理相关的内容" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"><strong></strong></p><blockquote data-tool="mdnice编辑器"><span></span><p>小明的数据分析笔记本 公众号 主要分享：1、R语言和python做数据分析和数据可视化的简单小例子；2、园艺植物相关转录组学、基因组学、群体遗传学文献阅读笔记；3、生物信息学入门学习资料及自己的学习笔记！</p></blockquote></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/bTGvbm2Jv2Tkrc55NExo-w",target="_blank" rel="noopener noreferrer">原文链接</a>
