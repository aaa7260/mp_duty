---
title: "如何去掉数据中的离群样本？"
date: 2024-05-11T09:20:44Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
如何去掉数据中的离群样本？ by 生信菜鸟团
------
<div><section><section><section><p><strong>点击蓝字</strong></p></section></section><section><section><section><img data-imgfileid="100038178" data-ratio="2.221436984687868" data-s="300,640" data-type="png" data-w="849" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdwxTBGh0aRAJRWe40ynfniby86DJtHerDFdNj8mzsaPL7dnjgxCIenOg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdwxTBGh0aRAJRWe40ynfniby86DJtHerDFdNj8mzsaPL7dnjgxCIenOg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section><section><section><p><strong>关注我们</strong></p></section></section></section><section><section><section><section><section><section data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdIOLy94vlA839fOSgblYPNv1YM3PHT6IJMAetqCjvAsibFDkU1qU04aA/640?wx_fmt=png&amp;from=appmsg" data-fail="0"><section><section><p><br></p></section></section></section></section><section><section><img data-imgfileid="100038177" data-ratio="2.221436984687868" data-s="300,640" data-type="png" data-w="849" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdwxTBGh0aRAJRWe40ynfniby86DJtHerDFdNj8mzsaPL7dnjgxCIenOg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdwxTBGh0aRAJRWe40ynfniby86DJtHerDFdNj8mzsaPL7dnjgxCIenOg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section><section><section><p><span>引</span></p><p>言</p></section></section></section></section><section><section><section><section><section><section><section><p>       当我们拿到一组数据想要开始分析时，做的第一件事情就是质控，看一下数据怎么样，是否适用于我们的分析流程，以及某些低表达或极端表达的基因和样本是否应该删除更利于分析结果。<strong>今天分享一下如何删除离群样本，并探索一下是否有生物学意义。</strong></p><p><br></p></section></section></section></section></section></section></section></section><section><section><section><section><img data-imgfileid="100038180" data-ratio="2.221436984687868" data-s="300,640" data-type="png" data-w="849" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdwxTBGh0aRAJRWe40ynfniby86DJtHerDFdNj8mzsaPL7dnjgxCIenOg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdwxTBGh0aRAJRWe40ynfniby86DJtHerDFdNj8mzsaPL7dnjgxCIenOg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section><section><section><p>01</p></section><section><p><strong>绘制PCA图观察样本分布</strong></p></section></section><section><section><section><section><img data-imgfileid="100038179" data-ratio="1.314" data-s="300,640" data-type="png" data-w="500" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdaCEtyC2FYr1IBPQbfksc1g11C8qLhwkS1UtTlP9XpPanD86EpsNr4A/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdaCEtyC2FYr1IBPQbfksc1g11C8qLhwkS1UtTlP9XpPanD86EpsNr4A/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section></section><section><section><section><section><p>     首先用自己的表达量矩阵数据绘制主成分分析图<span></span></p></section></section></section></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="shell"><code><span><span>#</span>加载R包</span></code><code><span>library("FactoMineR")</span></code><code><span>library("factoextra")  </span></code><code><span><span>#</span>载入数据</span></code><code><span>load(file = 'symbol_matrix.Rdata') </span></code><code><span>symbol_matrix[1:4,1:4] ## 基因名字的样品，癌症转录组count矩阵     </span></code><code><span><span>#</span><span># TCGA-97-7938-01A TCGA-55-7574-01A TCGA-05-4250-01A</span></span></code><code><span><span>#</span><span># A1BG                   15               17               18</span></span></code><code><span><span>#</span><span># A1BG-AS1              191               90              104</span></span></code><code><span><span>#</span><span># A1CF                    4                5                0</span></span></code><code><span><span>#</span><span># A2M                 87438            61893            55347</span></span></code><code><span><span>#</span><span># TCGA-95-A4VK-01A</span></span></code><code><span><span>#</span><span># A1BG                   17</span></span></code><code><span><span>#</span><span># A1BG-AS1               53</span></span></code><code><span><span>#</span><span># A1CF                    2</span></span></code><code><span><span>#</span><span># A2M                 42664</span></span></code><code><span><span>#</span>转换成cpm数据</span></code><code><span>dat = log2(edgeR::cpm(symbol_matrix)+1)</span></code><code><span>dat[1:4,1:4]</span></code><code><span><span>#</span><span># TCGA-97-7938-01A TCGA-55-7574-01A</span></span></code><code><span><span>#</span><span># A1BG            0.4834302        0.6586411</span></span></code><code><span><span>#</span><span># A1BG-AS1        2.6013824        2.0225987</span></span></code><code><span><span>#</span><span># A1CF            0.1455475        0.2267243</span></span></code><code><span><span>#</span><span># A2M            11.1807753       11.0413363</span></span></code><code><span><span>#</span><span># TCGA-05-4250-01A TCGA-95-A4VK-01A</span></span></code><code><span><span>#</span><span># A1BG            0.3420593       0.45300345</span></span></code><code><span><span>#</span><span># A1BG-AS1        1.3481920       1.10437674</span></span></code><code><span><span>#</span><span># A1CF            0.0000000       0.06129024</span></span></code><code><span><span>#</span><span># A2M             9.6860041       9.85607747</span></span></code><code><span>table(group_list)</span></code><code><span><span>#</span><span># group_list</span></span></code><code><span><span>#</span><span># Squamous_cell_carcinoma          Adenocarcinoma </span></span></code><code><span><span>#</span><span># 501                     526 </span></span></code><code><span>pro = 'test'</span></code><code><span>exp=t(dat)#画PCA图时要求是行名时样本名，列名时探针名，因此此时需要转换</span></code><code><span>exp=as.data.frame(exp)#将matrix转换为data.frame </span></code><code><span><span>#</span>主成分分析</span></code><code><span>dat.pca &lt;- PCA(exp , graph = FALSE)</span></code><code><span>this_title &lt;- paste0(pro,'_PCA')</span></code><code><span>p&lt;-fviz_pca_ind(dat.pca,</span></code><code><span>                   geom.ind = "point",  #c( "point", "text" ), # show points only (nbut not "text")</span></code><code><span>                   col.ind = group_list, # color by groups</span></code><code><span>                   palette = "Dark2",</span></code><code><span>                   addEllipses = TRUE, # Concentration ellipses</span></code><code><span>                   legend.title = "Groups")+</span></code><code><span>  ggtitle(this_title)+ </span></code><code><span>  theme(plot.title = element_text(size=12,hjust = 0.5))</span></code><code><span>p</span></code></pre></section><section><section><section><section><img data-imgfileid="100038185" data-ratio="1.0046242774566474" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdyBCIia4v1b8fjZ4iaV1YjicgE27OAeUhMXVVicvHxbFcr2zfPyE51PZ4EQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="865" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdyBCIia4v1b8fjZ4iaV1YjicgE27OAeUhMXVVicvHxbFcr2zfPyE51PZ4EQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section><section><section><section><section><p>我们可以看到有几个样本很明显散在椭圆之外，<strong>我们现在通过第一次pca分析的结果将其删除，看是否会对后续的分析有影响。</strong></p></section></section></section></section><section><section><section><section><img data-imgfileid="100038181" data-ratio="2.221436984687868" data-s="300,640" data-type="png" data-w="849" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdwxTBGh0aRAJRWe40ynfniby86DJtHerDFdNj8mzsaPL7dnjgxCIenOg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdwxTBGh0aRAJRWe40ynfniby86DJtHerDFdNj8mzsaPL7dnjgxCIenOg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section><section><section><p>02</p></section><section><p><strong>PCA删除离群样本</strong></p></section></section><section><section><section><section><img data-imgfileid="100038184" data-ratio="1.314" data-s="300,640" data-type="png" data-w="500" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdaCEtyC2FYr1IBPQbfksc1g11C8qLhwkS1UtTlP9XpPanD86EpsNr4A/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdaCEtyC2FYr1IBPQbfksc1g11C8qLhwkS1UtTlP9XpPanD86EpsNr4A/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section></section><section><section><section><section><p><span>      删除距离太远的样本，上面的<strong>pca绘图的时候其实也返回来了横纵坐标信息：</strong></span></p></section></section></section></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span>#筛选离群样本名称</span></span></code><code><span><span>name</span>&lt;-as.character(p2$data$name[p$data$x&gt;600|p$data$x&gt;600])#PCA图中x或y轴大于600的视为离群样本</span></code><code><span><span>name</span></span></code><code><span><span>## [1] "TCGA-44-5645-01B" "TCGA-44-3918-01B" "TCGA-44-2656-01B"</span></span></code><code><span><span>## [4] "TCGA-44-6775-01C" "TCGA-44-6146-01B" "TCGA-44-2662-01B"</span></span></code><code><span><span>## [7] "TCGA-44-3917-01B" "TCGA-44-2668-01B" "TCGA-44-4112-01B"</span></span></code><code><span><span>## [10] "TCGA-44-2666-01B" "TCGA-44-6147-01B" "TCGA-21-5782-01A"</span></span></code><code><span><span>name_index</span> &lt;- which(rownames(exp) %in% name)</span></code><code><span><span>#在基因矩阵及分组中删除离群样本</span></span></code><code><span><span>exp1</span> &lt;- exp[-name_index, ]</span></code><code><span><span>group_list1</span>&lt;-group_list[-name_index]</span></code><code><span><span>#重新绘制PCA图</span></span></code><code><span><span>dat</span>.pca1 &lt;- PCA(exp1 , graph = FALSE)</span></code><code><span><span>this_title1</span> &lt;- paste0(pro,'1_PCA')</span></code><code><span><span>p1</span>&lt;- fviz_pca_ind(dat.pca1,</span></code><code><span>                   <span>geom</span>.ind = <span>"point"</span>,  #c( <span>"point"</span>, <span>"text"</span> ), # show points only (nbut not <span>"text"</span>)</span></code><code><span>                   <span>col</span>.ind = group_list1, # color by groups</span></code><code><span>                   <span>palette</span> = <span>"Set1"</span>,</span></code><code><span>                   <span>addEllipses</span> = TRUE, # Concentration ellipses</span></code><code><span>                   <span>legend</span>.title = <span>"Groups"</span>)+</span></code><code><span>  <span>ggtitle</span>(this_title)+ </span></code><code><span>  <span>theme</span>(plot.title = element_text(size=12,hjust = 0.5))</span></code><code><span><span>p1</span></span></code></pre></section><section><section><section><section><img data-imgfileid="100038183" data-ratio="1.009501187648456" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdlJWnUAh2ibEboYpPNFeNibOVUrfqvJKbKpwryOjNfaqzyNdEnS1ddicXQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="842" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdlJWnUAh2ibEboYpPNFeNibOVUrfqvJKbKpwryOjNfaqzyNdEnS1ddicXQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section><section><section><section><section><p>删除离群样本重新绘图之后已经没有距离很远的样本了，也更好看一些。</p><p><br></p><p><br></p><p>      其实除了PCA图，还有<strong>WGCNA的层次聚类</strong>也可以实现这一过程。<br></p></section></section></section></section><section><section><section><section><img data-imgfileid="100038182" data-ratio="2.221436984687868" data-s="300,640" data-type="png" data-w="849" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdwxTBGh0aRAJRWe40ynfniby86DJtHerDFdNj8mzsaPL7dnjgxCIenOg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdwxTBGh0aRAJRWe40ynfniby86DJtHerDFdNj8mzsaPL7dnjgxCIenOg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section><section><section><p>03</p></section><section><p><strong>层次聚类可视化</strong></p></section></section><section><section><section><section><img data-imgfileid="100038186" data-ratio="1.314" data-s="300,640" data-type="png" data-w="500" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdaCEtyC2FYr1IBPQbfksc1g11C8qLhwkS1UtTlP9XpPanD86EpsNr4A/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdaCEtyC2FYr1IBPQbfksc1g11C8qLhwkS1UtTlP9XpPanD86EpsNr4A/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section></section><section><section><section><section><p data-sider-select-id="d60f31d4-1465-4769-832e-17d82f87fae7">      绘制层次聚类图</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span><span>#hclust</span></span></code><code><span>library(WGCNA)</span></code><code><span>EXP&lt;-exp</span></code><code><span>rownames(EXP)&lt;-str_sub(rownames(EXP), 6, 16)<span>#简化一下样本名称</span></span></code><code><span>sampleTree = hclust(dist(EXP), method = <span>"average"</span>)</span></code><code><span><span>#绘图</span></span></code><code><span>png(file = <span>"sampleClustering.png"</span>, width = 26000, height =1500,res = 300)</span></code><code><span>par(cex = 0.6)</span></code><code><span>par(mar = c(0,4,2,0))</span></code><code><span>plot(sampleTree, main = <span>"Sample clustering to detect outliers"</span>, sub=<span>""</span>, xlab=<span>""</span>, cex.lab = 1.5,</span></code><code><span>     cex.axis = 1.5, cex.main = 2)</span></code><code><span>dev.off()</span></code></pre></section></section></section></section></section><section><section><section><section><img data-imgfileid="100038187" data-ratio="0.6905537459283387" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdkEIp4YjL7gGmXmsibF1MKIZibHLicJF2SnxwCickRg8Ahxs0RogeiabYqHg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="921" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdkEIp4YjL7gGmXmsibF1MKIZibHLicJF2SnxwCickRg8Ahxs0RogeiabYqHg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section><section><section><section><section><p>数据样本量较大，所以截取一部分，<strong>只有这几个样本是单独一个分支，我们可以把这些异常样本的分支切除。</strong></p></section></section></section></section><section><section><section><section><p data-sider-select-id="48b100a0-413a-4507-a1a8-3129fbe0d2a2">     增加切除线</p><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span>png</span>(file = <span>"sampleClustering1.png"</span>, width = 26000, height =1500,res = 300)</span></code><code><span><span>par</span>(cex = 0.6)</span></code><code><span><span>par</span>(mar = c(0,4,2,0))</span></code><code><span><span>plot</span>(sampleTree, main = <span>"Sample clustering to detect outliers"</span>, sub=<span>""</span>, xlab=<span>""</span>, cex.lab = 1.5,</span></code><code><span>     <span>cex</span>.axis = 1.5, cex.main = 2)</span></code><code><span><span>abline</span>(h = 270, col = <span>"red"</span>)</span></code><code><span><span>dev</span>.<span>off</span>()</span></code></pre></section></section></section></section></section><section><section><section><section><img data-imgfileid="100038190" data-ratio="0.8072805139186295" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdzpEjwsa1JFUMz2VIzKibfItQucqHgS2cG61iboYdWHticYkHVmoialp69Q/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="467" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdzpEjwsa1JFUMz2VIzKibfItQucqHgS2cG61iboYdWHticYkHVmoialp69Q/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section><section><section><section><section><p data-sider-select-id="4f76c67d-3529-4488-9c64-6a0a4674f04d">      切除分支</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="objectivec"><code><span>clust = cutreeStatic(sampleTree, cutHeight = <span>270</span>,minSize = <span>10</span>)<span>#切除高度设置为270</span></span></code><code><span>  table(clust) <span># 2代表切除的，1代表保留的</span></span></code><code><span><span>## clust</span></span></code><code><span><span>## 1    2 </span></span></code><code><span><span>## 1016   11 </span></span></code><code><span>  keepSamples = (clust!=<span>2</span>)</span></code><code><span>  EXP1 = EXP[keepSamples, ]</span></code><code><span><span>#看一下被切除的样本分支</span></span></code><code><span>rownames(EXP)[!keepSamples]</span></code><code><span><span>## [1] <span>"44-5645-01B"</span> <span>"44-3918-01B"</span> <span>"44-2656-01B"</span> <span>"44-6775-01C"</span></span></span></code><code><span><span>## [5] <span>"44-6146-01B"</span> <span>"44-2662-01B"</span> <span>"44-3917-01B"</span> <span>"44-2668-01B"</span></span></span></code><code><span><span>## [9] <span>"44-4112-01B"</span> <span>"44-2666-01B"</span> <span>"44-6147-01B"</span> </span></span></code><code><span><span>#重新绘制层次聚类图</span></span></code><code><span>sampleTree1 = hclust(dist(EXP1), method = <span>"average"</span>)</span></code><code><span>png(file = <span>"sampleClustering2.png"</span>, width = <span>26000</span>, height =<span>1500</span>,res = <span>300</span>)</span></code><code><span>par(cex = <span>0.6</span>)</span></code><code><span>par(mar = c(<span>0</span>,<span>4</span>,<span>2</span>,<span>0</span>))</span></code><code><span>plot(sampleTree, main = <span>"Sample clustering to detect outliers"</span>, sub=<span>""</span>, xlab=<span>""</span>, cex.lab = <span>1.5</span>,</span></code><code><span>     cex.axis = <span>1.5</span>, cex.main = <span>2</span>)</span></code><code><span>dev.off()</span></code></pre></section></section></section></section></section><section><section><section><section><img data-imgfileid="100038188" data-ratio="0.4215189873417722" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdVQVnaKEibVZsFhkMezRXQ1VUibeubOMVXQM594Okjgvwnl8luSXQ9Z6Q/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="790" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdVQVnaKEibVZsFhkMezRXQ1VUibeubOMVXQM594Okjgvwnl8luSXQ9Z6Q/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section><section><section><section><section><p>现在就没有单独分支的样本啦~而且和PCA图删除的样本几乎是一样的。</p><p>    <strong>  那么这个步骤到底有没有生物学意义呢？我们接下来继续探究。</strong></p><p><br></p></section></section></section></section><section><section><section><section><img data-imgfileid="100038189" data-ratio="2.221436984687868" data-s="300,640" data-type="png" data-w="849" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdwxTBGh0aRAJRWe40ynfniby86DJtHerDFdNj8mzsaPL7dnjgxCIenOg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdwxTBGh0aRAJRWe40ynfniby86DJtHerDFdNj8mzsaPL7dnjgxCIenOg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section><section><section><p>04</p></section><section><p><strong>差异分析结果比较</strong></p></section></section><section><section><section><section><img data-imgfileid="100038195" data-ratio="1.314" data-s="300,640" data-type="png" data-w="500" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdaCEtyC2FYr1IBPQbfksc1g11C8qLhwkS1UtTlP9XpPanD86EpsNr4A/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdaCEtyC2FYr1IBPQbfksc1g11C8qLhwkS1UtTlP9XpPanD86EpsNr4A/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section></section><section><section><section><section><p><span>      两组数据分别用的DESeq2包进行差异分析（这个代码省略，因为太简单了），有了差异结果矩阵，就可以比较一下删除离群样本之后是否会对</span><span>差异分析的结果产生影响。</span><span></span></p></section></section></section></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="sql"><code><span><span>#导入差异分析结果</span></span></code><code><span><span>load</span>(<span>file</span> = <span>'DEG_deseq2.Rdata'</span>)<span>#原始数据</span></span></code><code><span>summary(DEG_deseq2)</span></code><code><span>deg_DESeq2 = na.omit(as.data.frame(DEG_deseq2[<span>order</span>(DEG_deseq2$padj),]))  </span></code><code><span><span>load</span>(<span>file</span> = <span>'DEG1_deseq2.Rdata'</span>)<span>#去除样本之后</span></span></code><code><span>summary(DEG1_deseq2)</span></code><code><span>deg1_DESeq2 = na.omit(as.data.frame(DEG1_deseq2[<span>order</span>(DEG1_deseq2$padj),]))  </span></code><code><span><span>#绘制散点图比较一下两者的log2FoldChange</span></span></code><code><span>colnames(deg1_DESeq2)</span></code><code><span>ids=<span>intersect</span>(rownames(deg_DESeq2),</span></code><code><span>              rownames(deg1_DESeq2))</span></code><code><span>df= data.frame(</span></code><code><span>  deg_DESeq2 = deg_DESeq2[ids,<span>'log2FoldChange'</span>],</span></code><code><span>  deg1_DESeq2 = deg1_DESeq2[ids,<span>'log2FoldChange'</span>]</span></code><code><span>)</span></code><code><span><span>library</span>(ggpubr)</span></code><code><span>ggscatter(df, x = <span>"deg_DESeq2"</span>, y = <span>"deg1_DESeq2"</span>,</span></code><code><span>          color = <span>"black"</span>, shape = <span>21</span>, <span>size</span> = <span>3</span>, <span># Points color, shape and size</span></span></code><code><span>          <span>add</span> = <span>"reg.line"</span>,  <span># Add regressin line</span></span></code><code><span>          add.params = <span>list</span>(color = <span>"blue"</span>, fill = <span>"lightgray"</span>), <span># Customize reg. line</span></span></code><code><span>          conf.int = <span>TRUE</span>, <span># Add confidence interval</span></span></code><code><span>          cor.coef = <span>TRUE</span>, <span># Add correlation coefficient. see ?stat_cor</span></span></code><code><span>          cor.coeff.args = <span>list</span>(method = <span>"pearson"</span>,  label.sep = <span>"\n"</span>))</span></code></pre></section><section><section><section><section><img data-imgfileid="100038193" data-ratio="0.7718550106609808" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdC1RkuDLKYh3WIxgcMMb8iacicANezYL393HcvAgRPayqQ1zbicCZReFIw/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="938" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdC1RkuDLKYh3WIxgcMMb8iacicANezYL393HcvAgRPayqQ1zbicCZReFIw/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section><section><section><section><section><p>      使用的数据有1027个样本，只是删除了PCA中的12个样本，所以看起来影响不大，<strong>那么我们再考虑他的统计学意义，结合P值看一下对差异基因是否有影响。</strong></p></section></section></section></section><section><section><section><section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><span>#设置阈值</span></span></code><code><span>pvalue_t=<span>0.05</span></span></code><code><span>logFC_t = <span>1</span></span></code><code><span>deg_DESeq2$g=ifelse(deg_DESeq2$padj &gt; pvalue_t,<span>'stable'</span>, <span>#if 判断：如果这一基因的P.Value&gt;0.01，则为stable基因</span></span></code><code><span>                    ifelse( deg_DESeq2$log2FoldChange &gt; logFC_t,<span>'up'</span>, <span>#接上句else 否则：接下来开始判断那些P.Value&lt;0.01的基因，再if 判断：如果logFC &gt;1.5,则为up（上调）基因</span></span></code><code><span>                            ifelse( deg_DESeq2$log2FoldChange &lt; -logFC_t,<span>'down'</span>,<span>'stable'</span>) )<span>#接上句else 否则：接下来开始判断那些logFC &lt;1 的基因，再if 判断：如果logFC &lt;1，则为down（下调）基因，否则为stable基因</span></span></code><code><span>) </span></code><code><span>deg1_DESeq2$g=ifelse(deg1_DESeq2$padj &gt; pvalue_t,<span>'stable'</span>, <span>#if 判断：如果这一基因的P.Value&gt;0.01，则为stable基因</span></span></code><code><span>                    ifelse( deg1_DESeq2$log2FoldChange &gt; logFC_t,<span>'up'</span>, <span>#接上句else 否则：接下来开始判断那些P.Value&lt;0.01的基因，再if 判断：如果logFC &gt;1.5,则为up（上调）基因</span></span></code><code><span>                            ifelse( deg1_DESeq2$log2FoldChange &lt; -logFC_t,<span>'down'</span>,<span>'stable'</span>) )<span>#接上句else 否则：接下来开始判断那些logFC &lt;1 的基因，再if 判断：如果logFC &lt;1，则为down（下调）基因，否则为stable基因</span></span></code><code><span>) </span></code><code><span>pdf(<span>'figures/balloonplot.pdf'</span>,width = <span>6</span>,h=<span>4</span>)</span></code><code><span>gplots::balloonplot(</span></code><code><span>  table(  deg_DESeq2[ids,<span>'g'</span>],</span></code><code><span>          deg1_DESeq2[ids,<span>'g'</span>])</span></code><code><span>)</span></code><code><span>dev.off()</span></code></pre></section><p><br></p></section></section></section></section><section><section><section><section><img data-imgfileid="100038191" data-ratio="0.7232704402515723" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdByiclOxoBib0ibbHKTwJbwZA7kDn5y0JiaKlut9F49ZgPYcCvX1XEJ5AxQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="795" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdByiclOxoBib0ibbHKTwJbwZA7kDn5y0JiaKlut9F49ZgPYcCvX1XEJ5AxQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section><section><section><section><section><p>从比较的表格中可以看出删除样本之后<strong>上调的差异基因减少了将近一半，</strong>下调的差异基因相差不大，那么删除的样本影响了什么导致的这个结果呢？</p></section></section></section></section><section><section><section><section><p><span>      以我们最常研究的编码mRNA为起点，看一下是否也是有同样的结果</span><span>。</span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span>library(AnnoProbe) </span></code><code><span>ids=annoGene( ids,<span>'SYMBOL'</span>,<span>'human'</span>)</span></code><code><span>head(ids) </span></code><code><span>tail(sort(table(ids$biotypes)))</span></code><code><span><span>#筛选编码基因</span></span></code><code><span>pbGenes = unique(ids[ids$biotypes==<span>'protein_coding'</span>,<span>1</span>])</span></code><code><span>deg_DESeq2_pb&lt;-deg_DESeq2[pbGenes,]</span></code><code><span>deg1_DESeq2_pb&lt;-deg1_DESeq2[pbGenes,]</span></code><code><span>pdf(<span>'figures/balloonplot3.pdf'</span>,width = <span>6</span>,h=<span>4</span>)</span></code><code><span>gplots::balloonplot(</span></code><code><span>  table(  deg_DESeq2_pb[,<span>'g'</span>],</span></code><code><span>          deg1_DESeq2_pb[,<span>'g'</span>])</span></code><code><span>   )</span></code><code><span>dev.off()</span></code></pre></section><p><br></p></section></section></section></section><section><section><section><section><img data-imgfileid="100038192" data-ratio="0.6578599735799208" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtd2unP5XDStIoNqEPLh4DCVnwa7NhX81I6lo0FsTkD03ZAF2icfr5EKxg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="757" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtd2unP5XDStIoNqEPLh4DCVnwa7NhX81I6lo0FsTkD03ZAF2icfr5EKxg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section><section><section><section><section><p>上下调基因列表重合度很好，可见，<strong>异常样本基本上只是影响了非编码mRNA,对编码mRNA并没有太大的影响。</strong></p></section></section></section></section><section><section data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtd9lXnGmpgK4aaKD7yF1al1QVPvWCsOft4CLU5pesRnzGibHujCGYPufw/640?wx_fmt=png&amp;from=appmsg" data-fail="0"><section><section><section><section><img data-imgfileid="100038194" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtd7uicibUQjlGHCNCXCzXgW1dqLdJE1vopkA4viceOB1OQBh1waCo2pmIMQ/640?wx_fmt=jpeg&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="jpeg" data-w="132" src="https://mmbiz.qpic.cn/mmbiz_jpg/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtd7uicibUQjlGHCNCXCzXgW1dqLdJE1vopkA4viceOB1OQBh1waCo2pmIMQ/640?wx_fmt=jpeg&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section><section><section><section><img data-imgfileid="100038196" data-ratio="1" data-s="300,640" data-type="jpeg" data-w="132" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdY8fiaQiaWxlanCUEsia8g16AASribce21fibygSoVcQuNJhUTKMJoZRcA2g/640?wx_fmt=jpeg&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_jpg/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdY8fiaQiaWxlanCUEsia8g16AASribce21fibygSoVcQuNJhUTKMJoZRcA2g/640?wx_fmt=jpeg&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section><section><section><section><section><section><section data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdIOLy94vlA839fOSgblYPNv1YM3PHT6IJMAetqCjvAsibFDkU1qU04aA/640?wx_fmt=png&amp;from=appmsg" data-fail="0"><section><section><p><br></p></section></section></section></section><section><section><img data-imgfileid="100038199" data-ratio="2.221436984687868" data-s="300,640" data-type="png" data-w="849" data-src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdwxTBGh0aRAJRWe40ynfniby86DJtHerDFdNj8mzsaPL7dnjgxCIenOg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/sSQBMGFfmTQIxue4sBUiabasaUpYTSJtdwxTBGh0aRAJRWe40ynfniby86DJtHerDFdNj8mzsaPL7dnjgxCIenOg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section><section><section><p>结</p><p>束</p><p>语</p></section></section></section></section><section><section><section><p> </p><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section> <a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247530001&amp;idx=1&amp;sn=676dcf224f9be23b288189775292aeeb&amp;chksm=9b4b36aaac3cbfbc3e3bb0865bd789d5093e3a643f3f345332995f707b7f209ae924e9e9529e&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课5月班" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信入门&amp;数据挖掘线上直播课5月班</a>，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;chksm=9b4b2f10ac3ca606c1c4bac8cf112bb9b0f18e3c4262f5f2b8c0dba3bfedf2ba201507247005&amp;scene=21#wechat_redirect" textvalue="2024的共享服务器交个朋友福利价仍然是800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">2024的共享服务器交个朋友福利价仍然是800</a></section></li></ul><p><br></p></section></section></section></section></section></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/OBZ45B9MrSJRj8ESY5rimw",target="_blank" rel="noopener noreferrer">原文链接</a>
