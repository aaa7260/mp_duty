---
title: "一行命令跑转录组上游分析代码"
date: 2024-05-20T00:32:24Z
draft: ["false"]
tags: [
  "fetched",
  "东林的扯淡小屋"
]
categories: ["Acdemic"]
---
一行命令跑转录组上游分析代码 by 东林的扯淡小屋
------
<div><p><span>自动跑人类的转录组分析代码</span><span></span><span>：</span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span><span>#!/bin/bash</span></span></code><code><span><br></span></code><code><span><span># 读取目录下的所有fastq文件</span></span></code><code><span><span>for</span> file <span>in</span> *_1.fq.gz; <span>do</span></span></code><code><span>    <span># 提取文件名部分</span></span></code><code><span>    base=$(basename <span>"<span>$file</span>"</span> <span>"_1.fq.gz"</span>)</span></code><code><span><br></span></code><code><span>    <span># 执行cutadapt</span></span></code><code><span>    cutadapt --pair-filter=any --minimum-length 15 --max-n 8 \</span></code><code><span>    -a AGATCGGAAGAGCACACGTCTGAACTCCAGTCAC \</span></code><code><span>    -A AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTAGATCTCGGTGGTCGCCGTATCATT \</span></code><code><span>    -o <span>"./clean/<span>${base}</span>_rmadp_1.fq.gz"</span> -p <span>"./clean/<span>${base}</span>_rmadp_2.fq.gz"</span> \</span></code><code><span>    <span>"<span>${base}</span>_1.fq.gz"</span> <span>"<span>${base}</span>_2.fq.gz"</span> &gt;&gt;filter.txt 2&gt;&amp;1</span></code><code><span><br></span></code><code><span>    <span># 执行trimmomatic</span></span></code><code><span>    trimmomatic PE -threads 40 -phred33 \</span></code><code><span>    <span>"./clean/<span>${base}</span>_rmadp_1.fq.gz"</span> <span>"./clean/<span>${base}</span>_rmadp_2.fq.gz"</span> \</span></code><code><span>    -baseout <span>"./clean/<span>${base}</span>_fliter.fq.gz"</span> AVGQUAL:20 SLIDINGWINDOW:4:15 MINLEN:15 \</span></code><code><span>    1&gt;&gt;filter.txt 2&gt;&amp;1</span></code><code><span><br></span></code><code><span>    <span># 执行hisat2</span></span></code><code><span>    hisat2 --threads 35 -x /data/yudonglin/reference/human/hg19/hisat2/hg19 \</span></code><code><span>    -1 <span>"./clean/<span>${base}</span>_fliter_1P.fq.gz"</span> -2 <span>"./clean/<span>${base}</span>_fliter_2P.fq.gz"</span> \</span></code><code><span>    -S <span>"./hisat/<span>${base}</span>.sam"</span></span></code><code><span><br></span></code><code><span>    <span># 转换为bam格式</span></span></code><code><span>    samtools view -S <span>"./hisat/<span>${base}</span>.sam"</span> -b &gt; <span>"./hisat/<span>${base}</span>.bam"</span> -@ 40</span></code><code><span>    </span></code><code><span>    <span># 删除sam文件</span></span></code><code><span>    rm <span>"./hisat/<span>${base}</span>.sam"</span></span></code><code><span><br></span></code><code><span>    <span># 排序和索引bam文件</span></span></code><code><span>    samtools sort <span>"./hisat/<span>${base}</span>.bam"</span> -o <span>"./hisat/<span>${base}</span>_sorted.bam"</span> -@ 40</span></code><code><span>    samtools index <span>"./hisat/<span>${base}</span>_sorted.bam"</span> -@ 40</span></code><code><span><br></span></code><code><span>    <span># 执行featureCounts</span></span></code><code><span>    featureCounts -T 30 -t exon -g gene_id \</span></code><code><span>    -a /data/yudonglin/reference/human/hg19/Homo_sapiens.GRCh37.75.gtf \</span></code><code><span>    -o <span>"./count/<span>${base}</span>.count"</span> <span>"./hisat/<span>${base}</span>_sorted.bam"</span> &gt;&gt;~/count.txt 2&gt;&amp;1</span></code><code><span><br></span></code><code><span>    <span># 生成bamCoverage</span></span></code><code><span>    bamCoverage --bam <span>"./hisat/<span>${base}</span>_sorted.bam"</span> -o <span>"./hisat/<span>${base}</span>_sorted.bam.bw"</span> \</span></code><code><span>    --binSize 10 -p 40</span></code><code><span><br></span></code><code><span>    <span># 删除原始bam文件</span></span></code><code><span>    <span># rm "./hisat/${base}.bam"</span></span></code><code><span><span>done</span></span></code><code><span><br></span></code><code><span><br></span></code></pre></section><p>自动跑小鼠的转录组分析代码：<br></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span><span>#!/bin/bash</span></span></code><code><span><br></span></code><code><span><span># 读取目录下的所有fastq文件</span></span></code><code><span><span>for</span> file <span>in</span> *_1.fq.gz; <span>do</span></span></code><code><span>    <span># 提取文件名部分</span></span></code><code><span>    base=$(basename <span>"<span>$file</span>"</span> <span>"_1.fq.gz"</span>)</span></code><code><span>    </span></code><code><span>    <span># 执行cutadapt</span></span></code><code><span>    cutadapt --pair-filter=any --minimum-length 15 --max-n 8 \</span></code><code><span>    -a AGATCGGAAGAGCACACGTCTGAACTCCAGTCAC \</span></code><code><span>    -A AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTAGATCTCGGTGGTCGCCGTATCATT \</span></code><code><span>    -o <span>"./clean/<span>${base}</span>_rmadp_1.fq.gz"</span> -p <span>"./clean/<span>${base}</span>_rmadp_2.fq.gz"</span> \</span></code><code><span>    <span>"<span>${base}</span>_1.fq.gz"</span> <span>"<span>${base}</span>_2.fq.gz"</span> &gt;&gt;filter.txt 2&gt;&amp;1</span></code><code><span><br></span></code><code><span>    <span># 执行trimmomatic</span></span></code><code><span>    trimmomatic PE -threads 40 -phred33 \</span></code><code><span>    <span>"./clean/<span>${base}</span>_rmadp_1.fq.gz"</span> <span>"./clean/<span>${base}</span>_rmadp_2.fq.gz"</span> \</span></code><code><span>    -baseout <span>"./clean/<span>${base}</span>_fliter.fq.gz"</span> AVGQUAL:20 SLIDINGWINDOW:4:15 MINLEN:15 \</span></code><code><span>    1&gt;&gt;filter.txt 2&gt;&amp;1</span></code><code><span><br></span></code><code><span>    <span># 执行hisat2</span></span></code><code><span>    hisat2 --threads 35 -x /data/yudonglin/reference/mouse/mm10/hisat2/mm10 \</span></code><code><span>    -1 <span>"./clean/<span>${base}</span>_fliter_1P.fq.gz"</span> -2 <span>"./clean/<span>${base}</span>_fliter_2P.fq.gz"</span> \</span></code><code><span>    -S <span>"./hisat/<span>${base}</span>.sam"</span></span></code><code><span><br></span></code><code><span>    <span># 转换为bam格式</span></span></code><code><span>    samtools view -S <span>"./hisat/<span>${base}</span>.sam"</span> -b &gt; <span>"./hisat/<span>${base}</span>.bam"</span></span></code><code><span>    </span></code><code><span>    <span># 删除sam文件</span></span></code><code><span>    rm <span>"./hisat/<span>${base}</span>.sam"</span></span></code><code><span><br></span></code><code><span>    <span># 排序和索引bam文件</span></span></code><code><span>    samtools sort <span>"./hisat/<span>${base}</span>.bam"</span> -o <span>"./hisat/<span>${base}</span>_sorted.bam"</span></span></code><code><span>    samtools index <span>"./hisat/<span>${base}</span>_sorted.bam"</span></span></code><code><span><br></span></code><code><span>    <span># 执行featureCounts</span></span></code><code><span>    featureCounts -T 30 -t exon -g gene_id \</span></code><code><span>    -a /data/yudonglin/reference/mouse/mm10/Mus_musculus.GRCm38.102.gtf \</span></code><code><span>    -o <span>"./count/<span>${base}</span>.count"</span> <span>"./hisat/<span>${base}</span>_sorted.bam"</span> &gt;&gt;~/count.txt 2&gt;&amp;1</span></code><code><span><br></span></code><code><span>    <span># 生成bamCoverage</span></span></code><code><span>    bamCoverage --bam <span>"./hisat/<span>${base}</span>_sorted.bam"</span> -o <span>"./hisat/<span>${base}</span>_sorted.bam.bw"</span> \</span></code><code><span>    --binSize 10 -p 40</span></code><code><span><br></span></code><code><span>    <span># 删除原始bam文件</span></span></code><code><span>    <span># rm "./hisat/${base}.bam"</span></span></code><code><span><span>done</span></span></code><code><span><br></span></code></pre></section><p><img data-galleryid="" data-imgfileid="100024739" data-ratio="0.5935185185185186" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpTnXvag2IqMa2E6MjIiaSdQEpdiaAepUqShqpZlicFLkB2SlXzMheV9x0bzIC2sGeNxHQJ9YiaBR4waA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpTnXvag2IqMa2E6MjIiaSdQEpdiaAepUqShqpZlicFLkB2SlXzMheV9x0bzIC2sGeNxHQJ9YiaBR4waA/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100024738" data-ratio="0.2577777777777778" data-s="300,640" data-type="png" data-w="225" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpTnXvag2IqMa2E6MjIiaSdQAjCPFYkr0mrBoicvGaoBx15YEBZ7jlibm2yQAugx7EPTNBfUYChbvTfQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpTnXvag2IqMa2E6MjIiaSdQAjCPFYkr0mrBoicvGaoBx15YEBZ7jlibm2yQAugx7EPTNBfUYChbvTfQ/640?wx_fmt=png&amp;from=appmsg"></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/ZBjzwW5iYYk5XDuwMn7GjQ",target="_blank" rel="noopener noreferrer">原文链接</a>
