---
title: "PRJNA705464-Seurat数据下载及分析"
date: 2024-05-26T02:07:20Z
draft: ["false"]
tags: [
  "fetched",
  "学R时习之"
]
categories: ["Acdemic"]
---
PRJNA705464-Seurat数据下载及分析 by 学R时习之
------
<div><p><code><span>PRJNA705464</span></code><span>是肾透明细胞癌的大样本数据集，包含scRNA-seq和TCR数据。组织来源分为Normal、Tumor、PBMC和淋巴结，同时还有药物治疗等，内容是相当丰富。</span><ne-clipboard source="https%3A%2F%2Fwww.yuque.com%2Fgaodashitou%2Fxggbo7%2Fgnx6oc9epub1g394"></ne-clipboard></p><p><img data-imgfileid="100003322" data-ratio="0.5879629629629629" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKweSn2TI7MUibn31IWecmhVzGbunbNwJuCiaJ4JnnicicLVqUh4OzQ2qHuJzA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="896" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKweSn2TI7MUibn31IWecmhVzGbunbNwJuCiaJ4JnnicicLVqUh4OzQ2qHuJzA/640?wx_fmt=png&amp;from=appmsg"></p><p>这么大的数据量咱们怎么用呢？</p><p>从上游直接分析？还是找人帮忙分析？</p><p>上游分析数据量太大：<img data-imgfileid="100003320" data-ratio="0.37222222222222223" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKwekibywcMbVcgz86uGWIe4Um1fGwSboBFALniaCrXmM5h2kkMlZC4xwA7A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="658" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKwekibywcMbVcgz86uGWIe4Um1fGwSboBFALniaCrXmM5h2kkMlZC4xwA7A/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p>找人分析…………一言难尽，还是先自己摸索下吧。</p><p>惊奇的发现作者竟然提供了<code>Seurat</code>对象数据，而且生信技能树大神还分享过该数据集《<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247502953&amp;idx=1&amp;sn=322d6dd9226059534b6f008966b49230&amp;scene=21#wechat_redirect" data-href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247502953&amp;idx=1&amp;sn=322d6dd9226059534b6f008966b49230&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2">构建seurat对象之初就应该是把基因名字转换好</a>》，简直完美。下面跟着大神的教程认真学习下：</p><p><img data-imgfileid="100003323" data-ratio="0.5342592592592592" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKwegXBEuarhOVr9x9oChEjbu0HjIHdL1EKRpu0q8BWSPYBO7196S5fzGA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="1322" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKwegXBEuarhOVr9x9oChEjbu0HjIHdL1EKRpu0q8BWSPYBO7196S5fzGA/640?wx_fmt=png&amp;from=appmsg"></p><h2><span>数据分析</span></h2><p><span>首先从</span><code><span>SRP308561</span></code><span>相关链接下载</span><code><span>ccRCC_6pat_Seurat</span></code><span>和</span><code><span>ccRCC_6pat_cell_annotations.txt</span></code><span>文件。(数据有点大)</span></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br>librarian::shelf(Seurat)<br><span># sce &lt;- readRDS("rawdata/ccRCC_6pat_Seurat")</span><br><span># sce</span><br><span># sce &lt;- UpdateSeuratObject(sce)</span><br><span># sce</span><br><span># save(sce,file = "sce_0raw.Rdata")</span><br><br><span># 基因转换</span><br><span>if</span>(F){<br>  load(<span>"sce_0raw.Rdata"</span>)<br>  DimPlot(sce)<br>  sce  <span># 16323 features across 167283 samples within 1 assay</span><br><br><br>  <span># 基因转换</span><br>  library(org.Hs.eg.db)<br>  head(rownames(sce))<br>  ids=AnnotationDbi::select(org.Hs.eg.db,keys = rownames(sce),<br>                            columns = c(<span>'ENSEMBL'</span>,<span>'SYMBOL'</span>),<br>                            keytype = <span>'ENSEMBL'</span>)<br>  head(ids)<br>  dim(ids) <span># [1] 16458</span><br>  ids=na.omit(ids)<br>  dim(ids) <span># [1] 15527</span><br>  length(unique(ids<span>$SYMBOL</span>)) <span># [1] 15516</span><br>  <span># 这里的关系超级乱，互相之间都不是一对一</span><br>  <span># 凡是混乱的ID一律删除即可</span><br>  ids=ids[!duplicated(ids<span>$SYMBOL</span>),]<br>  ids=ids[!duplicated(ids<span>$ENSEMBL</span>),]<br>  pos=match(ids<span>$ENSEMBL</span>,rownames(sce) )<br>  sce=sce[pos,]<br>  sce <span># 15388 features</span><br>  <span>#rownames(sce) = ids$SYMBOL</span><br>  head(rownames(sce)); head(ids)<br><br>  <span># https://github.com/satijalab/seurat/issues/2617</span><br>  <span># RenameGenesSeurat  ------------------------------------------------------------------------------------</span><br>  RenameGenesSeurat &lt;- <span>function</span>(obj ,<br>                                newnames ) {<br>    <span># Replace gene names in different slots of a Seurat object. Run this before integration. Run this before integration.</span><br>    <span># It only changes obj@assays$RNA@counts, @data and @scale.data.</span><br>    <span>print</span>(<span>"Run this before integration. It only changes obj@assays<span>$RNA</span>@counts, @data and @scale.data."</span>)<br>    RNA &lt;- obj@assays<span>$RNA</span><br><br>    <span>if</span> (nrow(RNA) == length(newnames)) {<br>      <span>if</span> (length(RNA@counts)) RNA@counts@Dimnames[[1]]            &lt;- newnames<br>      <span>if</span> (length(RNA@data)) RNA@data@Dimnames[[1]]                &lt;- newnames<br>      <span>if</span> (length(RNA@scale.data)) RNA@scale.data@Dimnames[[1]]    &lt;- newnames<br>    } <span>else</span> {<span>"Unequal gene sets: nrow(RNA) != nrow(newnames)"</span>}<br>    obj@assays<span>$RNA</span> &lt;- RNA<br>    <span>return</span>(obj)<br>  }<br>  obj=RenameGenesSeurat(obj = sce,<br>                        newnames = ids<span>$SYMBOL</span>)<br>  sce &lt;- obj; rm(obj)<br>  save(sce,file = <span>'first_sce.Rdata'</span>)<br>}<br><br><span># 细胞注释</span><br><span>if</span>(F){<br>  load(<span>"first_sce.Rdata"</span>)<br><br>  library(ggplot2)<br>  genes_to_check = c(<span>'PTPRC'</span>, <span>'CD3D'</span>, <span>'CD3E'</span>, <span>'CD4'</span>,<span>'CD8A'</span>,<span>'CD19'</span>, <span>'CD79A'</span>, <span>'MS4A1'</span> ,<br>                     <span>'IGHG1'</span>, <span>'MZB1'</span>, <span>'SDC1'</span>,<br>                     <span>'CD68'</span>, <span>'CD163'</span>, <span>'CD14'</span>,<br>                     <span>'TPSAB1'</span> , <span>'TPSB2'</span>,  <span># mast cells,</span><br>                     <span>'RCVRN'</span>,<span>'FPR1'</span> , <span>'ITGAM'</span> ,<br>                     <span>'FGF7'</span>,<span>'MME'</span>, <span>'ACTA2'</span>,<br>                     <span>'PECAM1'</span>, <span>'VWF'</span>,<br>                     <span>'EPCAM'</span> , <span>'KRT19'</span>, <span>'PROM1'</span>, <span>'ALDH1A1'</span> )<br>  library(stringr)<br>  p_all_markers &lt;- DotPlot(sce , features = genes_to_check,<br>                           assay=<span>'RNA'</span>  )  + coord_flip()<br><br>  p_all_markers<br>  ggsave(plot=p_all_markers, filename=<span>"check_all_marker_by_seurat_cluster.pdf"</span>,width = 12, height = 10)<br><br><br>  <span># 需要自行看图，定细胞亚群：</span><br>  celltype=data.frame(ClusterID=0:34,<br>                      celltype=<span>'unkown'</span>)<br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 0,2:4,6:8,10,15,17,17,19,31,32),2]=<span>'Tcells'</span><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 24 ),2]=<span>'plasma'</span><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 22 ),2]=<span>'naive-Bcells'</span><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c(21),2]=<span>'mast'</span><br><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 1,5,12:14,18,23,27,33,34),2]=<span>'myeloid'</span><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 9,16,26 ),2]=<span>'epithelial'</span><br><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 11),2]=<span>'endo'</span><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c(20),2]=<span>'fibo'</span><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c(25 ),2]=<span>'SMC'</span><br><br>  head(celltype)<br>  celltype<br>  table(celltype<span>$celltype</span>)<br>  sce<span>$celltype</span> &lt;- plyr::mapvalues(sce<span>$cluster</span>,<br>                                  from = 0:34,<br>                                  to=celltype<span>$celltype</span>)<br>  p1 &lt;- DimPlot(sce,group.by = <span>"celltype"</span>,label = T)<br>  ggsave(p1,filename=<span>"DimPlot_by_seurat_cluster.pdf"</span>,width = 12, height = 10)<br>  save(sce, file = <span>"first_sce.Rdata"</span>)<br>}</code></pre></section><p><img data-imgfileid="100003319" data-ratio="0.825925925925926" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKwe9PJmuUaibH6HibJu98icKbR4iceIk8mhAe2d0aLklzw2K2In0CJgbWePRQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="702" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKwe9PJmuUaibH6HibJu98icKbR4iceIk8mhAe2d0aLklzw2K2In0CJgbWePRQ/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100003321" data-ratio="0.8314814814814815" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKwe6ZmZIibV3DFW623jY8WcIFWs3icdF7xvianwzRasQng45l2XeJ0GDpMvQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="664" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKwe6ZmZIibV3DFW623jY8WcIFWs3icdF7xvianwzRasQng45l2XeJ0GDpMvQ/640?wx_fmt=png&amp;from=appmsg"></p><hr><h1><span>实战1-PMID34804944-Fig5A</span></h1><p>接下来看看大佬们的神来之笔，首先是<code><span>PMID34804944Fig5A</span></code>。</p><p><img data-imgfileid="100003326" data-ratio="1.049074074074074" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKwee02nbyj8lHQukFlN7Z2qpltLHmX2mpTDpbeJ928fBsunh7AIlLtEbA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="635" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKwee02nbyj8lHQukFlN7Z2qpltLHmX2mpTDpbeJ928fBsunh7AIlLtEbA/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p>作者是这样进行分析的：</p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>PRJNA705464, which is a large database containing cells totally, was applied to investigate the role of pyroptosis-related genes in cell–cell interaction in ccRCC TME. Only untreated tumor samples from PRJNA705464 were applied for further analysis.</p></blockquote></section><p>下面咱们就提取<code>untreated</code>样本进行后续分析，果然可完美复现Figure5A。</p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><pre data-tool="mdnice编辑器"><span></span><code><span># meatdata</span><br>library(tidyverse)<br>metadata &lt;- data.table::fread(<span>"rawdata/ccRCC_6pat_cell_annotations.txt"</span>,data.table = F) %&gt;%<br>  column_to_rownames(<span>"cell"</span>)<br>metadata &lt;- metadata[sce<span>$cell</span>,]<br>metadata1 &lt;- metadata[,c(<span>"Sample_name"</span>,<span>"cluster_name"</span>)]<br>sce1 &lt;- AddMetaData(object = sce,<br>                    metadata = metadata1)<br>DimPlot(sce1, group.by = <span>"cluster_name"</span>,label = T)+ NoLegend()<br>rm(sce)<br><br><span>#仅提取 untreated 样本</span><br>sce_sub &lt;- subset(sce1, (Sample_name==<span>"Untreated 1"</span>| Sample_name==<span>"Untreated 2"</span>) &amp; <span>type</span> == <span>"Tumor"</span>)<br>sce_sub <span>#29799 samples</span><br><br>DimPlot(sce_sub, reduction = <span>"tsne"</span>) <span># PMID: 34804944 Figure5A</span><br>DimPlot(sce_sub, reduction = <span>"tsne"</span>,group.by = <span>"celltype"</span>)</code></pre></section><p><img data-imgfileid="100003327" data-ratio="0.487962962962963" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKwenKMk5g9vMcsGTibgzyRjTK8zBY1ia7xP97U8xA8IWbIBQ2EStItB1Bsw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="1121" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKwenKMk5g9vMcsGTibgzyRjTK8zBY1ia7xP97U8xA8IWbIBQ2EStItB1Bsw/640?wx_fmt=png&amp;from=appmsg"></p><hr><h1><span>实战2-PMID35592316</span></h1><p>同样作者在<code>PMID35592316</code>的FiguresS9A-D也对<code>PRJNA705464</code>进行再次分析，有兴趣的大佬可以下载下来进行复习学习。</p><p><img data-imgfileid="100003325" data-ratio="1.235408560311284" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKwew2CQfDXBSwoZibsJ1vOFeREINu2RoWmHzENPViaVMOkd0MnoHYWtSibMg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1028" width="514" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKwew2CQfDXBSwoZibsJ1vOFeREINu2RoWmHzENPViaVMOkd0MnoHYWtSibMg/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100003324" data-ratio="0.6259259259259259" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKweDdHM8ibn7stAjckxicPsic39Yh7pHzPI2AeYe84HNWw6ibj0WhXOTLAflw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="596" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDHwW12mtlh9IQ1nStdFhKweDdHM8ibn7stAjckxicPsic39Yh7pHzPI2AeYe84HNWw6ibj0WhXOTLAflw/640?wx_fmt=png&amp;from=appmsg"></p><hr><p>参考链接：</p><ul><li><p><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247502953&amp;idx=1&amp;sn=322d6dd9226059534b6f008966b49230&amp;scene=21#wechat_redirect" data-href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247502953&amp;idx=1&amp;sn=322d6dd9226059534b6f008966b49230&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2">构建seurat对象之初就应该是把基因名字转换好</a></p></li><li><p>Identification and Verification of m7G Modification Patterns and Characterization of Tumor Microenvironment Infiltration via Multi-Omics Analysis in Clear Cell Renal Cell Carcinoma.</p></li><li><p>Establishment of a prognosis Prediction Model Based on Pyroptosis-Related Signatures Associated With the Immune Microenvironment and Molecular Heterogeneity in Clear Cell Renal Cell Carcinoma.</p></li></ul><p>声明：</p><p>本文绝大部分代码均学习整理自生信技能树、单细胞天地等，仅供交流学习，禁止用于商业用途，如有侵权，请联系删除。鉴于本人水平有限，某些内容难免理解不到位，还请各位大佬多多指教。</p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/GRjOw4TNhLrOiSHdhqX4pQ",target="_blank" rel="noopener noreferrer">原文链接</a>
