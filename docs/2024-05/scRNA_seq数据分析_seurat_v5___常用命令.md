---
title: "scRNA-seq数据分析（seurat v5）——常用命令"
date: 2024-05-16T01:07:17Z
draft: ["false"]
tags: [
  "fetched",
  "被炸熟的虾"
]
categories: ["Acdemic"]
---
scRNA-seq数据分析（seurat v5）——常用命令 by 被炸熟的虾
------
<div><p><span>哈喽小伙伴们，seurat官网整理了一些常用命令，方便我们调用。一起来看看吧！</span></p><section><span>https://github.com/satijalab/seurat/blob/HEAD/vignettes/essential_commands.Rmd</span></section><h2 data-toc-skip=""><span>Contents</span></h2><ul><li><p><span>Standard Seurat workflow（Seurat标准工作流程）</span></p></li><li><p><span>Seurat Object Data Access（Seurat对象数据访问）</span></p></li><li><p><span>Subsetting and merging（</span><span>子集和合并</span><span>）</span></p></li><li><p><span>Pseudobulk analysis（Pseudobulk分析）</span></p></li><li><p><span>Visualization in Seurat（Seurat的可视化）</span></p></li><li><p><span>Multi-Assay Features（多检测特性）</span></p></li><li><p><span>Additional resources（其他资源）</span></p></li></ul><h2><strong><span>一、</span></strong><strong><span>Seurat</span></strong><strong><span>标准工作流程</span></strong></h2><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="cs"><code><span>pbmc &lt;- NormalizeData(<span>object</span> = pbmc)</span></code><code><span>pbmc &lt;- FindVariableFeatures(<span>object</span> = pbmc)</span></code><code><span>pbmc &lt;- ScaleData(<span>object</span> = pbmc)</span></code><code><span>pbmc &lt;- RunPCA(<span>object</span> = pbmc)</span></code><code><span>pbmc &lt;- FindNeighbors(<span>object</span> = pbmc, dims = <span>1</span>:<span>30</span>)</span></code><code><span>pbmc &lt;- FindClusters(<span>object</span> = pbmc)</span></code><code><span>pbmc &lt;- RunUMAP(<span>object</span> = pbmc, dims = <span>1</span>:<span>30</span>)</span></code><code><span>DimPlot(<span>object</span> = pbmc, reduction = <span>"umap"</span>)</span></code></pre></section><p><span><strong><span> </span></strong></span><strong><span>SCtransform 版本</span></strong></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="cs"><code><span>pbmc &lt;- SCTransform(<span>object</span> = pbmc)</span></code><code><span>pbmc &lt;- RunPCA(<span>object</span> = pbmc)</span></code><code><span>pbmc &lt;- FindNeighbors(<span>object</span> = pbmc, dims = <span>1</span>:<span>30</span>)</span></code><code><span>pbmc &lt;- FindClusters(<span>object</span> = pbmc)</span></code><code><span>pbmc &lt;- RunUMAP(<span>object</span> = pbmc, dims = <span>1</span>:<span>30</span>)</span></code><code><span>DimPlot(<span>object</span> = pbmc, reduction = <span>"umap"</span>)</span></code></pre></section><section><ul><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span>#可以使用%&gt;%将多个命令链接在一起</span></span></code><code><span><span>pbmc</span> &lt;- SCTransform(pbmc) %&gt;%</span></code><code><span>    RunPCA() %&gt;%</span></code><code><span>    FindNeighbors(dims = <span>1</span>:<span>30</span>) %&gt;%</span></code><code><span>    FindClusters() %&gt;%</span></code><code><span>    RunUMAP(dims = <span>1</span>:<span>30</span>)</span></code></pre></section><h2><strong><span>二、Seurat对象数据访问</span></strong></h2><p><span><span><strong><span> <strong><span>1. </span></strong></span></strong></span></span><span><strong><span>细胞、基因</span></strong></span><strong><span>和layer名</span></strong><strong><span>称</span></strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span>#获取细胞和基因名以及总数的多种方法</span></span></code><code><span><span>colnames</span>(pbmc)</span></code><code><span><span>Cells</span>(pbmc)</span></code><code><span><br></span></code><code><span><span>#基因名称</span></span></code><code><span><span>Features</span>(pbmc)</span></code><code><span><span>rownames</span>(pbmc)</span></code><code><span><br></span></code><code><span><span>#细胞/基因的数量</span></span></code><code><span><span>num_cells</span> &lt;- ncol(pbmc)</span></code><code><span><span>num_features</span> &lt;- nrow(pbmc)</span></code><code><span><br></span></code><code><span><span>#对象层列表</span></span></code><code><span><span>Layers</span>(pbmc)</span></code><code><span><br></span></code><code><span><span>#使用多模态对象列表分析</span></span></code><code><span><span>Assays</span>(cbmc)</span></code><code><span><br></span></code><code><span><span>#检测特异性特征(基因/ADT)</span></span></code><code><span><span>Features</span>(cbmc[[<span>"RNA"</span>]])</span></code><code><span><span>Features</span>(cbmc[[<span>"ADT"</span>]])</span></code><code><span><br></span></code><code><span><span>#可变基因名称</span></span></code><code><span><span>VariableFeatures</span>(pbmc)</span></code></pre></section><section><ul><li><li><li><li><li></ul><pre data-lang="php"><code><span><span>#设置可变基因</span></span></code><code><span>VariableFeatures(cbmc) &lt;- <span>var</span>.gene.names</span></code><code><span><br></span></code><code><span><span>#设置一个特定的assay</span></span></code><code><span>VariableFeatures(cbmc[[<span>"ADT"</span>]]) &lt;- <span>var</span>.gene.names</span></code></pre></section><p><span><strong><span><span> </span></span></strong></span><span><strong><span><span><span><span><strong><span> </span></strong></span></span></span></span></strong></span><span><strong><span><span><span><strong><span>2. 确</span></strong></span></span></span></strong></span><span><strong><span><span><span><strong><span>定分类标签</span></strong></span></span></span></strong></span><span><strong><span><span><span><strong><span></span></strong></span></span></span></strong></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><span>#设置和检索细胞标识</span></span></code><code><span><span>#将标识类设置为metadata中的现有列</span></span></code><code><span>Idents(object = pbmc) &lt;- <span>"seurat_annotations"</span></span></code><code><span><span>#查看细胞标识，获取汇总表</span></span></code><code><span>Idents(pbmc)</span></code><code><span>table(Idents(pbmc))</span></code><code><span><br></span></code><code><span><span>#将所有细胞的标识设置为CD4 T细胞</span></span></code><code><span>Idents(pbmc) &lt;- <span>"CD4 T cells"</span></span></code><code><span><br></span></code><code><span><span>#为选定的细胞组设置</span></span></code><code><span>pbmc.cells &lt;- Cells(pbmc)</span></code><code><span>Idents(object = pbmc, cells = pbmc.cells[<span>1</span>:<span>10</span>]) &lt;- <span>"CD4 T cells"</span></span></code><code><span><br></span></code><code><span><span>#获取细胞标识类</span></span></code><code><span>Idents(object = pbmc)</span></code><code><span>levels(x = pbmc)</span></code><code><span><br></span></code><code><span><span>#将细胞标识类存储在metadata中</span></span></code><code><span>pbmc[[<span>"old.ident"</span>]] &lt;- Idents(object = pbmc)</span></code><code><span>pbmc &lt;- StashIdent(object = pbmc, save.name = <span>"old.ident"</span>)</span></code><code><span><br></span></code><code><span><span>#重命名标识类</span></span></code><code><span>pbmc &lt;- RenameIdents(object = pbmc, `CD4 T cells` = <span>"T Helper cells"</span>)</span></code></pre></section><p><span><strong><span> </span></strong></span><strong><span>3. 细</span></strong><strong><span>胞</span></strong><strong><span>metadata</span></strong><span></span></p><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><span>#查看存储在object@meta.data中的meta.data数据框</span></span></code><code><span>pbmc[[]]</span></code><code><span><br></span></code><code><span><span>#从metadata中检索特定的值</span></span></code><code><span>pbmc$nCount_RNA</span></code><code><span>pbmc[[c(<span>"percent.mito"</span>, <span>"nFeature_RNA"</span>)]]</span></code><code><span><br></span></code><code><span><span>#添加metadata，参见?AddMetaData</span></span></code><code><span>random_group_labels &lt;- sample(x = c(<span>"g1"</span>, <span>"g2"</span>), size = ncol(x = pbmc), replace = <span>TRUE</span>)</span></code><code><span>pbmc$groups &lt;- random_group_labels</span></code></pre></section><p><strong><span><span><strong><span> </span></strong></span></span></strong><strong><span>4. 表</span></strong><strong><span>达式数据（在 Seurat v5 中作为</span></strong><strong><span>layers存储</span></strong><strong><span>）</span></strong><strong><span></span></strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span><span>#检索表达矩阵RNA计数矩阵中的数据</span></span></code><code><span>pbmc[[<span>"RNA"</span>]]<span>$counts</span></span></code><code><span><br></span></code><code><span><span>#具有相同结果的备用函数</span></span></code><code><span>LayerData(pbmc, assay = <span>"RNA"</span>, layer = <span>"counts"</span>)</span></code><code><span><br></span></code><code><span><span>#仍然支持来自Seurat v4的GetAssayData</span></span></code><code><span>GetAssayData(object = pbmc, assay = <span>"RNA"</span>, slot = <span>"counts"</span>)</span></code><code><span><br></span></code><code><span><span>#ADT计数矩阵(多模态对象)</span></span></code><code><span>cbmc[[<span>"ADT"</span>]]<span>$counts</span></span></code></pre></section><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><span>#设置表达式数据假设为new.data 是一种新的表达式矩阵</span></span></code><code><span>pbmc[[<span>"RNA"</span>]]$counts &lt;- <span>new</span>.data</span></code><code><span><br></span></code><code><span><span>#具有相同结果的备用setter函数</span></span></code><code><span>LayerData(pbmc, assay = <span>"RNA"</span>, layer = <span>"counts"</span>) &lt;- <span>new</span>.data</span></code><code><span><br></span></code><code><span><span>#仍然支持来自Seurat v4的SetAssayData</span></span></code><code><span>pbmc &lt;- SetAssayData(object = pbmc, slot = <span>"counts"</span>, <span>new</span>.data = <span>new</span>.data</span></code></pre></section><p><strong><span><strong><span><span><strong><span> </span></strong></span></span></strong></span></strong><strong><span>5. 降</span></strong><strong><span>维</span></strong></p><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="ruby"><code><span><span>#获取存储在pbmc上的细胞嵌入和基因加载[['pca']]<span>@cell</span>.embeddings</span></span></code><code><span>Embeddings(pbmc, reduction = <span>"pca"</span>)</span></code><code><span><br></span></code><code><span><span>#存储在pbmc[['pca]]<span>@feature</span>.loadings中</span></span></code><code><span>Loadings(pbmc, reduction = <span>"pca"</span>)</span></code><code><span><span>#创建自定义尺寸缩减加载矩阵是可选的</span></span></code><code><span>new_reduction &lt;- CreateDimReducObject(embeddings = new.embeddings, loadings = new.loadings, key = <span>"custom_pca"</span>)</span></code><code><span>pbmc[[<span>"custom_pca"</span>]] &lt;- new_reduction</span></code></pre></section><p><strong><span><strong><span><strong><span><span><strong><span> </span></strong></span></span></strong></span></strong></span></strong><strong><span>6. Fet</span></strong><strong><span>chData （获取数据）</span></strong><strong><span><strong><span></span></strong></span></strong></p><section><ul><li><li><li></ul><pre data-lang="apache"><code><span><span>#FetchData可以访问表达式矩阵、细胞嵌入或metadata中的任何内容</span></span></code><code><span><span>#使用FetchData访问单个/小组变量</span></span></code><code><span><span>FetchData</span>(object = pbmc, vars = c(<span>"PC_1"</span>, <span>"nFeature_RNA"</span>, <span>"MS4A1"</span>), layer = <span>"counts"</span>)</span></code></pre></section><p><strong><span>三、子集和合并</span></strong></p><p><span><strong><span> </span></strong></span><strong><span>1. Seu</span></strong><strong><span>rat对象的子集</span></strong><strong><span></span></strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><span>#基于标识类的子集Seurat对象，参见?SubsetData</span></span></code><code><span>subset(x = pbmc, idents = <span>"B"</span>)</span></code><code><span>subset(x = pbmc, idents = c(<span>"Naive CD4 T"</span>, <span>"CD8 T"</span>), invert = <span>TRUE</span>)</span></code><code><span><br></span></code><code><span><span>#基因/特征表达水平上的子集</span></span></code><code><span>subset(x = pbmc, subset = MS4A1 &gt; <span>2.5</span>)</span></code><code><span><br></span></code><code><span><span>#标准的组合上的子集</span></span></code><code><span>subset(x = pbmc, subset = MS4A1 &gt; <span>2.5</span> &amp; PC_1 &gt; <span>5</span>)</span></code><code><span>subset(x = pbmc, subset = MS4A1 &gt; <span>2.5</span>, idents = <span>"B"</span>)</span></code><code><span><br></span></code><code><span><span>#对象metadata中的子集</span></span></code><code><span>subset(x = pbmc, subset = groups == <span>"g1"</span>)</span></code><code><span><br></span></code><code><span><span>#下采样每个标识类的细胞数量</span></span></code><code><span>subset(x = pbmc, downsample = <span>100</span>)</span></code></pre></section><p><strong><span><span><strong><span> </span></strong></span></span></strong><strong><span>2. 分</span></strong><strong><span>层</span></strong></p><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="perl"><code><span><span>#在Seurat v5中，用户现在可以将对象直接拆分为不同的层，将表达式数据保留在一个对象中，但是</span></span></code><code><span><span>#将多个样本拆分成层后可以直接进入整合工作流程</span></span></code><code><span>ifnb[[<span>"RNA"</span>]] &lt;- <span>split</span>(ifnb[[<span>"RNA"</span>]], f = ifnb$stim)</span></code><code><span>Layers(ifnb)</span></code><code><span><br></span></code><code><span><span>#如果需要，例如在整合之后，这些层可以再次连接在一起</span></span></code><code><span>ifnb &lt;- JoinLayers(ifnb)</span></code></pre></section><p><strong><span><strong><span><strong><span><span><strong><span> </span></strong></span></span></strong></span></strong></span></strong><strong><span><strong><span><strong><span>3. 拆分对象</span></strong></span></strong></span></strong><strong><span><strong><span><strong><span></span></strong></span></strong></span></strong></p><section><ul><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span>#可以根据metadata将对象拆分为多个对象的列表</span></span></code><code><span><span>#创建两个对象的列表</span></span></code><code><span><span>ifnb_list</span> &lt;- SplitObject(ifnb, split.by = <span>"stim"</span>)</span></code><code><span>ifnb_list<span>$CTRL</span></span></code><code><span>ifnb_list<span>$STIM</span></span></code></pre></section><p><strong><span><strong><span><strong><span><strong><span><span><strong><span> </span></strong></span></span></strong></span></strong></span></strong></span></strong><strong><span>4. </span></strong><strong><span>合并</span></strong><strong><span>对象（没有</span></strong><strong><span>integration）</span></strong></p><section><span>在Seurat v5 中，合并会创建一个对象，但会将表达式信息拆分为不同的层进行</span><span><code>integration</code></span><span>。如果不继续</span><span><code>integration</code></span><span>，请在合并后重新加入</span><span><code>layers</code></span><span>。</span><strong><span></span></strong></section><section><ul><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span>#合并两个Seurat对象</span></span></code><code><span><span>merged_obj</span> &lt;- merge(x = ifnb_list<span>$CTRL</span>, y = ifnb_list<span>$STIM</span>)</span></code><code><span>merged_obj[[<span>"RNA"</span>]] &lt;- JoinLayers(merged_obj)</span></code><code><span><br></span></code><code><span><span>#合并两个以上的Seurat对象</span></span></code><code><span>merge(x = pbmc1, y = list(pbmc2, pbmc3))</span></code></pre></section><p><strong><span><strong><span><strong><span><strong><span><strong><span><span><strong><span> </span></strong></span></span></strong></span></strong></span></strong></span></strong></span></strong><strong><span>5. 合</span></strong><strong><span>并对象（<strong><span>有</span></strong><strong><span>integration</span></strong>）</span></strong><strong><span><strong><span></span></strong></span></strong></p><p><span><code>https://satijalab.org/seurat/articles/integration_introduction</code></span></p><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span>merged_obj &lt;- merge(x = ifnb_list$CTRL, y = ifnb_list$STIM)</span></code><code><span>merged_obj &lt;- NormalizeData(merged_obj)</span></code><code><span>merged_obj &lt;- FindVariableFeatures(merged_obj)</span></code><code><span>merged_obj &lt;- ScaleData(merged_obj)</span></code><code><span>merged_obj &lt;- RunPCA(merged_obj)</span></code><code><span>merged_obj &lt;- IntegrateLayers(object = obj, method = RPCAIntegration, orig.reduction = <span>"pca"</span>, <span>new</span>.reduction = <span>"integrated.rpca"</span>,</span></code><code><span>    verbose = <span>FALSE</span>)</span></code><code><span><br></span></code><code><span><span>#现在整合已经完成，重新加入layers</span></span></code><code><span>merged_obj[[<span>"RNA"</span>]] &lt;- JoinLayers(merged_obj)</span></code></pre></section><h2><strong><span>四</span></strong><strong><span>、Pseudobulk分析</span></strong></h2><section><section data-id="71774" data-type="lspecial02,lspecial04" data-tools="速排小蚂蚁编辑器" powered-by="xmyeditor.com" data-md5="cadaa"><section powered-by="xmyeditor.com" data-md5="cadaa"><section powered-by="xmyeditor.com" data-md5="cadaa"><section powered-by="xmyeditor.com" data-md5="cadaa"><br></section><section powered-by="xmyeditor.com" data-md5="cadaa"><br></section><section powered-by="xmyeditor.com" data-md5="cadaa"><br></section><section powered-by="xmyeditor.com" data-md5="cadaa"><br></section></section><section powered-by="xmyeditor.com" data-md5="cadaa"><section powered-by="xmyeditor.com" data-md5="cadaa"><p><span>为</span><span>了从高通量单细胞mRNA数据中增加基因数量和基因表达相关性，我们从同一细胞群中的多个细胞中收集数据，制作假细胞（Pseudocell）用于网络解释。看来这个Pseudocell概念是为了弥补稀疏矩阵在计算相关性上的缺陷，毕竟零值太多，影响相关性的计算。</span></p><section><span>在高通</span><span>量单细胞转录组数据上应用bulk RNA 的分析方法的时候，采用这种局部bulk的方法还是有必要的，一方面是维度缩减，一方面是提高模型的适应性</span><span>。</span></section></section><section powered-by="xmyeditor.com" data-md5="cadaa"><br></section></section><section powered-by="xmyeditor.com" data-md5="cadaa"><section powered-by="xmyeditor.com" data-md5="cadaa"><br></section><section powered-by="xmyeditor.com" data-md5="cadaa"><br></section><section powered-by="xmyeditor.com" data-md5="cadaa"><br></section><section powered-by="xmyeditor.com" data-md5="cadaa"><br></section></section></section></section></section><p><span><strong><span> </span></strong></span><strong><span>基于多个类</span></strong><strong><span>别将细胞分组</span></strong><strong><span>在一起</span></strong></p><p><span>有关如何将列添</span><span>加</span><span>到</span><span><code>metadata</code></span><span>的信息，请参阅</span><span><code>https://satijalab.org/seurat/articles/de_vignette</code></span><span>。</span><span>donor_id</span><br></p><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span>#pseudobulk细胞仅按细胞类型区分</span></span></code><code><span><span>bulk</span> &lt;- AggregateExpression(ifnb, group.by = <span>"seurat_annotations"</span>, return.seurat = TRUE)</span></code><code><span>Cells(bulk)</span></code><code><span><br></span></code><code><span><span>#pseudobulk细胞受刺激条件和细胞类型的影响</span></span></code><code><span>bulk &lt;- AggregateExpression(ifnb, group.by = c(<span>"stim"</span>, <span>"seurat_annotations"</span>), return.seurat = TRUE)</span></code><code><span>Cells(bulk)</span></code><code><span><br></span></code><code><span><span>#pseudobulk细胞与刺激条件、细胞类型和供体有关</span></span></code><code><span>bulk &lt;- AggregateExpression(ifnb, group.by = c(<span>"stim"</span>, <span>"seurat_annotations"</span>, <span>"donor_id"</span>), return.seurat = TRUE)</span></code><code><span>Cells(bulk)</span></code></pre></section><section><span></span></section><h2><strong><span>五</span></strong><strong><span>、Seurat的可视化</span></strong></h2><p><span>Seurat 有一个庞大的、基于 ggplot2 的绘图库。默认情况下，所有绘图函数都将返回一个 ggplot2 绘图，从而允许使用 ggplot2 轻松自定义。</span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span>#降维图</span></span></code><code><span>DimPlot(<span>object</span> = pbmc, reduction = <span>"pca"</span>)</span></code><code><span><br></span></code><code><span><span>#维度缩减图 细胞由定量特征着色 如果可用，默认为UMAP</span></span></code><code><span>FeaturePlot(object = pbmc, features = <span>"MS4A1"</span>)</span></code><code><span><br></span></code><code><span><span>#单个细胞的散点图</span></span></code><code><span>FeatureScatter(object = pbmc, feature1 = <span>"MS4A1"</span>, feature2 = <span>"PC_1"</span>)</span></code><code><span>FeatureScatter(object = pbmc, feature1 = <span>"MS4A1"</span>, feature2 = <span>"CD3D"</span>)</span></code><code><span><br></span></code><code><span><span>#散点图跨越各个特征 取代CellPlot</span></span></code><code><span>CellScatter(object = pbmc, cell1 = <span>"AGTCTACTAGGGTG"</span>, cell2 = <span>"CACAGATGGTTTCT"</span>)</span></code><code><span><br></span></code><code><span>VariableFeaturePlot(object = pbmc)</span></code><code><span><br></span></code><code><span><span>#小提琴和山脊图</span></span></code><code><span>VlnPlot(object = pbmc, features = c(<span>"LYZ"</span>, <span>"CCL5"</span>, <span>"IL32"</span>))</span></code><code><span>RidgePlot(object = pbmc, feature = c(<span>"LYZ"</span>, <span>"CCL5"</span>, <span>"IL32"</span>))</span></code></pre></section><section><span></span></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span>#热图(可视化scale.data) </span></span></code><code><span>DimHeatmap(<span>object</span> = pbmc, reduction = <span>"pca"</span>, cells = <span>200</span>)</span></code><code><span><br></span></code><code><span><span>#标准工作流程</span></span></code><code><span>pbmc &lt;- ScaleData(pbmc, features = heatmap_markers)</span></code><code><span>DoHeatmap(object = pbmc, features = heatmap_markers)</span></code><code><span><br></span></code><code><span><span>#sctransform工作流程</span></span></code><code><span>pbmc &lt;- GetResidual(pbmc, features = heatmap_markers)</span></code><code><span>DoHeatmap(object = pbmc, features = heatmap_markers)</span></code><code><span><br></span></code><code><span><span>#热图 每组最多100个细胞</span></span></code><code><span>DoHeatmap(pbmc, heatmap_markers, cells = subset(pbmc, downsample = <span>100</span>)</span></code></pre></section><section><span></span></section><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span>#尝试新事物!注意，绘图函数现在返回ggplot2对象</span></span></code><code><span><span>#因此可以向其添加主题、标题和选项</span></span></code><code><span>VlnPlot(<span>object</span> = pbmc, features = <span>"MS4A1"</span>, split.by = <span>"groups"</span>)</span></code><code><span>DotPlot(object = pbmc, features = c(<span>"LYZ"</span>, <span>"CCL5"</span>, <span>"IL32"</span>), split.by = <span>"groups"</span>)</span></code><code><span>FeaturePlot(object = pbmc, features = c(<span>"MS4A1"</span>, <span>"CD79A"</span>), blend = TRUE)</span></code><code><span>DimPlot(object = pbmc) + DarkTheme()</span></code><code><span>DimPlot(object = pbmc) + labs(title = <span>"2,700 PBMCs clustered using Seurat and viewed\non a two-dimensional UMAP"</span>)</span></code></pre></section><p><span>Seurat 提供了许多预构建的主题，可以添加到 ggplot2 绘图中以便快速自定义。</span></p><table width="847"><thead><tr><th msttexthash="5885113" msthash="832">主题</th><th msttexthash="5358925" msthash="833">功能</th></tr></thead><tbody><tr><td><code>DarkTheme</code></td><td msttexthash="67589171" msthash="834">设置带有白色文本的黑色背景</td></tr><tr><td><code>FontSize</code></td><td msttexthash="62856430" msthash="835">设置绘图中各种元素的字体大小</td></tr><tr><td><code>NoAxes</code></td><td msttexthash="26797368" msthash="836">删除轴和轴文本</td></tr><tr><td><code>NoLegend</code></td><td msttexthash="27995747" msthash="837">删除所有图例元素</td></tr><tr><td><code>RestoreLegend</code></td><td msttexthash="21817848" msthash="838">删除后恢复图例</td></tr><tr><td><code>RotatedAxis</code></td><td msttexthash="19718010" msthash="839">旋转 x 轴标签</td></tr></tbody></table><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span>#绘图辅助函数用于基于ggplot2的散点图</span></span></code><code><span><span>#如DimPlot, FeaturePlot, CellScatter和FeatureScatter</span></span></code><code><span><span>plot</span> &lt;- DimPlot(object = pbmc) + NoLegend()</span></code><code><span><br></span></code><code><span><span>#HoverLocator取代了以前的`do.hover`</span></span></code><code><span><span>#它还可以通过' information '参数显示额外的数据 旨在与FetchData一起顺利工作</span></span></code><code><span>HoverLocator(plot = plot, information = FetchData(object = pbmc, vars = c(<span>"ident"</span>, <span>"PC_1"</span>, <span>"nFeature_RNA"</span>)))</span></code><code><span><br></span></code><code><span><span>#FeatureLocator取代了之前的`do.identify`</span></span></code><code><span><span>select</span>.cells &lt;- FeatureLocator(plot = plot)</span></code><code><span><br></span></code><code><span><span>#在ggplot对象上标记点</span></span></code><code><span>LabelPoints(plot = plot, points = TopCells(object = pbmc[[<span>"pca"</span>]]), repel = TRUE)</span></code></pre></section><h2><strong><span>六、多检测特性</span></strong></h2><p><span>使用Seurat，您可以轻松地在单细胞水平的不同检测方法之间切换（例如来自CITE-seq的ADT计数，或整合/批量校正的数据）。大多数函数现在都采用检测参数，但您可以设置默认检测以避免重复语句。</span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span>cbmc</span> &lt;- CreateSeuratObject(counts = cbmc.rna)</span></code><code><span><span>#添加ADT数据</span></span></code><code><span>cbmc[[<span>"ADT"</span>]] &lt;- CreateAssayObject(counts = cbmc.adt)</span></code><code><span><span>#通过指定要使用的assay来运行分析</span></span></code><code><span>NormalizeData(object = cbmc, assay = <span>"RNA"</span>)</span></code><code><span>NormalizeData(object = cbmc, assay = <span>"ADT"</span>, method = <span>"CLR"</span>)</span></code><code><span><br></span></code><code><span><span>#检索并设置默认assay</span></span></code><code><span>DefaultAssay(object = cbmc)</span></code><code><span>DefaultAssay(object = cbmc) &lt;- <span>"ADT"</span></span></code><code><span>DefaultAssay(object = cbmc)</span></code><code><span><br></span></code><code><span><span>#使用keys从两个assays中提取特征表达式</span></span></code><code><span>FetchData(object = cbmc, vars = c(<span>"rna_CD3E"</span>, <span>"adt_CD3"</span>))</span></code><code><span><br></span></code><code><span><span>#使用keys绘制来自多个assays的数据</span></span></code><code><span>FeatureScatter(object = cbmc, feature1 = <span>"rna_CD3E"</span>, feature2 = <span>"adt_CD3"</span>)</span></code></pre></section><h2><strong><span>七、其他资源</span></strong></h2><p><span>对 Seurat v5 中数据存储的一些技术更改特别感兴趣的用户可以浏览以下资源：</span></p><section><span>https://mojaveazure.github.io/seurat-object/</span></section><section><span>https://satijalab.org/seurat/articles/seurat5_essential_commands</span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/3tmjRv9290VR2akkI3GBOQ",target="_blank" rel="noopener noreferrer">原文链接</a>
