---
title: "甲基化探针相对于基因来说太多了怎么办"
date: 2023-01-03T06:13:27Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
甲基化探针相对于基因来说太多了怎么办 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>如果是表达量芯片，探针数量很明显是比标准的2万多个蛋白质编码基因多不少， 很容易理解嘛，因为每个基因长度那么给力，在上面设计多个探针很正常。</p></blockquote><p data-tool="mdnice编辑器">针对表达量芯片，我们会有一个很常规的操作，就是相当于基因来说的去冗余操作，如果一个基因对应多个探针我们会仅仅是保留表达量最大的探针作为那个基因的唯一表达量，这样之前的五六万个探针的表达量矩阵去冗余操作后就是两三万个基因的表达量矩阵啦。但是这样的操作并不是万无一失，仅仅是一个优先选择而已。之前就学员提出来了一个蛮古老的表达量芯片数据集的讨论，因为 它是做了这个PPARα的基因敲除，但是学员在分析表达量矩阵做差异的时候发现PPARα本身其实并没有统计学显著的差异表达。数据集是：https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE8292</p><p data-tool="mdnice编辑器">学员选取的样品是control条件下，而不是 a single dose of WY14643 (400 μl of 10 mg/ml WY14643)  药物处理的 ：</p><pre data-tool="mdnice编辑器"><span></span><code>GSM205769 liver_wildtype_WY14643_6h_rep1<br>GSM205770 liver_wildtype_WY14643_6h_rep2<br>GSM205771 liver_wildtype_WY14643_6h_rep3<br>GSM205772 liver_wildtype_WY14643_6h_rep4 <br>GSM205778 liver_PPARa-knockout_WY14643_6h_rep1<br>GSM205779 liver_PPARa-knockout_WY14643_6h_rep2<br>GSM205780 liver_PPARa-knockout_WY14643_6h_rep3<br>GSM205781 liver_PPARa-knockout_WY14643_6h_rep4<br>GSM205782 liver_PPARa-knockout_WY14643_6h_rep5<br></code></pre><p data-tool="mdnice编辑器">同样的control条件下，我们比较 野生型和PPARα的基因敲除两个分组， 理论上肯定是PPARα的基因表达量应该是有统计学显著的差异。但是如果一个基因对应多个探针我们会仅仅是保留表达量最大的探针作为那个基因的唯一表达量，我们就会发现PPARα的基因表达量没有统计学显著的差异，因为这个基因有多个探针。详见：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514903&amp;idx=1&amp;sn=705fadb6b09388e7fc65e20d26e5558a&amp;scene=21#wechat_redirect" data-linktype="2">一个基因上面有多个探针最后只能选一个吗</a></p><p data-tool="mdnice编辑器">如果是甲基化芯片，那么探针数量会更多，从27K到450K再到850K的探针数量，但是基因仍然是标准的2万多个蛋白质编码基因，基因不仅仅是很长而且基因这个时候有结构，启动子区域，外显子，内含子，这些不同元件的生物学意义不一样，所以每个基因设计十几个甚至几十个探针都有可能。这个时候就国家的不可能简简单单去冗余了，因为同一个基因的不同位置的甲基化探针的信号值的生物学意义是不一样的。</p><h3 data-tool="mdnice编辑器"><span></span><span>查看champ包的450k芯片的注释信息</span><span></span></h3><p data-tool="mdnice编辑器">champ包是目前甲基化芯片数据处理的集大成者：</p><p><img data-galleryid="" data-ratio="1.1828125" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzBG3r3n6TUnJXTuFChfZ4DsIrzMq1DSFutqQeU0m4NPX1koQK3vU5y7FxLqbKapKr3FmBc95l7Ew/640?wx_fmt=png" data-type="png" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzBG3r3n6TUnJXTuFChfZ4DsIrzMq1DSFutqQeU0m4NPX1koQK3vU5y7FxLqbKapKr3FmBc95l7Ew/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>甲基化芯片数据处理的集大成者</figcaption></figure><p data-tool="mdnice编辑器">也是我们推荐给大家的首选流程：</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())   <br>options(stringsAsFactors = F)<br>library(<span>"ChAMP"</span>)<br>library(<span>"minfi"</span>)<br>require(GEOquery)<br>require(Biobase)<br><br>  data(hm450.manifest.hg19)<br>  data(probe.features)<br>  head(hm450.manifest.hg19)<br>  head(probe.features) <br>  sort(table(probe.features<span>$feat</span>.cgi))<br>  sort(table(probe.features<span>$feature</span>))<br><br></code></pre><p data-tool="mdnice编辑器">可以看到甲基化探针确实是有非常多的属性 ：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; sort(table(probe.features<span>$feat</span>.cgi))<br><br>  1stExon-shelf    TSS200-shelf   TSS1500-shelf     3<span>'UTR-shelf    3'</span>UTR-island <br>            368             857            1685            1802            1992 <br>  1stExon-shore     3<span>'UTR-shore     5'</span>UTR-shelf 1stExon-opensea  TSS200-opensea <br>           2506            3426            3789            4282            9058 <br>   TSS200-shore     5<span>'UTR-shore   3'</span>UTR-opensea   5<span>'UTR-opensea TSS1500-opensea <br>           9372            9460           10274           11855           14667 <br> 1stExon-island    5'</span>UTR-island       IGR-shelf      Body-shelf       IGR-shore <br>          15581           17581           18390           20253           21121 <br> TSS1500-island      IGR-island   TSS1500-shore   TSS200-island      Body-shore <br>          21610           22392           31022           32996           35160 <br>    Body-island     IGR-opensea    Body-opensea <br>          38102           57814           68162 <br>&gt; sort(table(probe.features<span>$feature</span>))<br><br>  3<span>'UTR 1stExon   5'</span>UTR  TSS200 TSS1500     IGR    Body <br>  17494   22737   42685   52283   68984  119717  161677 <br></code></pre><p data-tool="mdnice编辑器">而且450K的探针里面有接近120K的探针甚至是没有注释到基因本身：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; table(probe.features<span>$gene</span>!=<span>''</span>)<br><br> FALSE   TRUE <br>119717 365860 <br></code></pre><p data-tool="mdnice编辑器">可以看到这119717个没有注释到基因的就是IGR的属性啦，也是可以细分成为：</p><pre data-tool="mdnice编辑器"><span></span><code>IGR-shore      IGR-island     IGR-opensea <br>21121           22392           57814 <br>IGR-shelf  <br>18390<br></code></pre><p data-tool="mdnice编辑器">需要对表观背景知识有一点了解才能理解上面的450K芯片的探针的分布情况。</p><p data-tool="mdnice编辑器">既然一个基因会设计十几个探针甚至几十个探针，如何量化这个基因的甲基化信号值就需要考虑生物学背景啦。</p><h3 data-tool="mdnice编辑器"><span></span><span>单个基因的启动子区域全部甲基化探针的平均值</span><span></span></h3><p data-tool="mdnice编辑器">比如2018的文章：《Deep Learning–Based Multi-Omics Integration Robustly Predicts Survival in Liver Cancer》就是对单个基因的启动子区域全部甲基化探针的平均值的处理：</p><blockquote data-tool="mdnice编辑器"><p><strong>For the DNA methylation, we mapped CpG islands within 1,500 base pairs (bp) ahead of transcription start sites (TSS) of genes and averaged their methylation values.</strong></p></blockquote><p data-tool="mdnice编辑器">也就是说仅仅是考虑了  TSS1500-island  的21610个探针，可以看到， 这两万多个探针并不意味有两万多个基因，因为仍然是一个基因有好多个探针：</p><p><img data-galleryid="" data-ratio="0.5027995520716685" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzBG3r3n6TUnJXTuFChfZ4Dr8rmjbT8icH5PRiaKWFYK4yOHZI5NHu5ZcDFWVk0dgqFo9IJVTEFgvdg/640?wx_fmt=png" data-type="png" data-w="1786" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzBG3r3n6TUnJXTuFChfZ4Dr8rmjbT8icH5PRiaKWFYK4yOHZI5NHu5ZcDFWVk0dgqFo9IJVTEFgvdg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>一个基因有好多个探针</figcaption></figure><p data-tool="mdnice编辑器">ChAMP包中包括了两个测试集。</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(<span>"ChAMP"</span>)<br><span># HumanMethylation450 data (.idat) </span><br>testDir=system.file(<span>"extdata"</span>,package=<span>"ChAMPdata"</span>)<br>myLoad &lt;- champ.load(testDir,arraytype=<span>"450K"</span>)<br><span># simulated EPIC data</span><br>data(EPICSimData)<br></code></pre><p data-tool="mdnice编辑器">我们可以针对这个数据集来做单个基因的启动子区域全部甲基化探针的平均值：</p><pre data-tool="mdnice编辑器"><span></span><code><br><span>library</span>(<span>"ChAMP"</span>)<br>data(EPICSimData)<br>head(myLoad$pd)<br>myLoad$beta[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>data(probe.features)<br>sort(table(probe.features$cgi))<br>sort(table(probe.features$feature))<br>sort(table(probe.features$feat.cgi))<br>cg = probe.features[probe.features$feat.cgi==<span>'TSS1500-island'</span>,]<br>length(unique(cg$gene))<br>cg=cg[rownames(cg) %<span>in</span>% rownames(myLoad$beta), ]<br>lt= split(rownames(cg),as.character(cg$gene)) <br>TSS1500_beta &lt;- do.call(rbind,<br>        lapply( lt , <span>function</span>(x){<br>          colMeans(myLoad$beta[x,,drop=<span>F</span>])<br>        }))<br><br></code></pre><p data-tool="mdnice编辑器">居然就六千多个基因了，唉，代码很漂亮，就是运行起来好慢啊。我号召大家帮忙改写最后一句代码：</p><p data-tool="mdnice编辑器">第一个方案是并行：</p><p><img data-galleryid="" data-ratio="0.4578313253012048" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzBG3r3n6TUnJXTuFChfZ4DeCicQHoFgibhPphYBY7R6eqPLJc3kAbiaAeJXpEsbN3VIe5GSibXIicnVrQ/640?wx_fmt=png" data-type="png" data-w="747" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzBG3r3n6TUnJXTuFChfZ4DeCicQHoFgibhPphYBY7R6eqPLJc3kAbiaAeJXpEsbN3VIe5GSibXIicnVrQ/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>并行并不是真正的加速</figcaption></figure><p data-tool="mdnice编辑器">之前是耗时3分钟，哪怕是并行1000000个线程也不可能很快。但是真正的改写代码可以造成百倍的加速：</p><p><img data-galleryid="" data-ratio="0.30697674418604654" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzBG3r3n6TUnJXTuFChfZ4D9AA3ibNdXg0Lc5uSKfoMlfkPMWicRNO6K1eWjvicsNujYhqTJpRTTPGsA/640?wx_fmt=png" data-type="png" data-w="645" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzBG3r3n6TUnJXTuFChfZ4D9AA3ibNdXg0Lc5uSKfoMlfkPMWicRNO6K1eWjvicsNujYhqTJpRTTPGsA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>百倍的加速</figcaption></figure><p data-tool="mdnice编辑器">原来的方案需要3min，现在只需要1.26秒，真正的百倍加速！！！</p><h3 data-tool="mdnice编辑器"><span></span><span>学徒作业</span><span></span></h3><p data-tool="mdnice编辑器">大家可以尝试自己的方式来改写这个代码！</p></section><h4 data-tool="mdnice编辑器"><span>文末友情宣传</span></h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519083&amp;idx=1&amp;sn=61f07b390469617ca2e9924f5b3929ab&amp;scene=21#wechat_redirect" data-linktype="2">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li></ul><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/_3OMqRbluJ9sWSBVoETNmg",target="_blank" rel="noopener noreferrer">原文链接</a>
