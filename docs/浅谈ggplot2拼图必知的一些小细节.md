---
title: "浅谈ggplot2拼图必知的一些小细节"
date: 2022-10-22T00:24:30Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
浅谈ggplot2拼图必知的一些小细节 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>最近有朋友问R中拼图的方法，对于在R中如何拼图小编颇有体会，本节就来详细介绍一下R中一些<strong>「高阶的拼图方法」</strong>希望对各位观众老爷有所帮助；<strong>「数据及代码已经上传VIP群，加群的观众老爷请自行下载」</strong>主要介绍 <strong>「cowplot与patchwork」</strong>这两款包，当然也会用到<strong>「ggpubr」</strong></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>参考文档</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>https://patchwork.data-imaginist.com/<br></code></pre><blockquote data-tool="mdnice编辑器"><span>❝</span><p><code>有需要学习数据可视化的朋友欢迎加入小编2022年度VIP群</code>，目前群内已经上传公众号文档<strong>「数据+代码约200篇」</strong>，<code>VIP交流群(1)已经500人满员</code>,随着内容不断增多，为了更好的创做内容现在进群需<strong>「付费149元」</strong>,若转发此文档到朋友圈集赞20个可优惠20元，早进早享受；<strong>「一定让你感受到物超所值」</strong></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(patchwork)<br><span>library</span>(cowplot)<br><span>library</span>(ggpubr)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>定义颜色</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>my3cols &lt;- c(<span>"#E7B800"</span>, <span>"#2E9FDF"</span>, <span>"#FC4E07"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>ToothGrowth$dose &lt;- as.factor(ToothGrowth$dose)<br><br>p &lt;- ggplot(ToothGrowth, aes(x = dose, y = len))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建拼图素材</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>bxp &lt;- p + geom_boxplot(aes(color = dose)) +<br>  scale_color_manual(values = my3cols)<br><br>dp &lt;- p + geom_dotplot(aes(color = dose, fill = dose), <br>                       binaxis=<span>'y'</span>, stackdir=<span>'center'</span>) +<br>  scale_color_manual(values = my3cols) + <br>  scale_fill_manual(values = my3cols)<br>  <br>lp &lt;- ggplot(economics, aes(x = date, y = psavert)) + <br>  geom_line(color = <span>"#E46726"</span>) <br><br>dens &lt;- ggplot(iris, aes(Sepal.Length)) +<br>  geom_density(aes(color = Species)) +<br>  scale_color_manual(values = my3cols)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>拼图</span><span></span></h3><p data-tool="mdnice编辑器">patchwork同时提供 <strong>「|」</strong> 和 <strong>「/」</strong> 分别用于水平和垂直布局</p><pre data-tool="mdnice编辑器"><span></span><code>bxp+dp+lp+dens<br>(bxp+lp)/(dp+dens)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5547850208044383" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36yqtOvbox1bVyxthIkoTL8aG9esF3ibibia6liaglpfHVq6KxfqicibXhicN1nA/640?wx_fmt=png" data-type="png" data-w="721" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36yqtOvbox1bVyxthIkoTL8aG9esF3ibibia6liaglpfHVq6KxfqicibXhicN1nA/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>自定义布局</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section>plot_layout()来指定布局</section></li><li><section>guides = 'collect'合并相同图例</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>bxp+bxp+bxp+plot_spacer()+<br>  plot_layout(nrow=<span>2</span>,ncol=<span>2</span>,widths = c(<span>2</span>,<span>1</span>),guides = <span>'collect'</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7366863905325444" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36y5FlicSUlrCGleob4SUicjuSlSv8HxHHlBJCvt0GNpLQDCEdJAgdmG1Kg/640?wx_fmt=png" data-type="png" data-w="676" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36y5FlicSUlrCGleob4SUicjuSlSv8HxHHlBJCvt0GNpLQDCEdJAgdmG1Kg/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>通过上图看到合并图例后位置不合适，可以通过添加guide_area()函数来将图例调整到空白位置</p><span>❞</span></blockquote><pre data-tool="mdnice编辑器"><span></span><code>bxp+bxp+bxp + guide_area() + <br>  plot_layout(nrow=2,ncol=2,<br>              widths = c(2,1),<br>              guides = <span>'collect'</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7366863905325444" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36yYk7PSfAUtnR02sib7U2iaSIyyyo1qjfkRYQXkxAGOxtQdklKPNb0eaPA/640?wx_fmt=png" data-type="png" data-w="676" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36yYk7PSfAUtnR02sib7U2iaSIyyyo1qjfkRYQXkxAGOxtQdklKPNb0eaPA/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>嵌套布局</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>lp + {<br>  dens + {<br>    bxp +<br>      dp +<br>      plot_layout(ncol = <span>1</span>)<br>  }<br>} +<br>  plot_layout(ncol = <span>1</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.0380710659898478" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36yRJ58bdz2ymEwFsWibPQVmibsxY6oNJ1tfHBp7emATfcLG2YThxQxXgZQ/640?wx_fmt=png" data-type="png" data-w="788" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36yRJ58bdz2ymEwFsWibPQVmibsxY6oNJ1tfHBp7emATfcLG2YThxQxXgZQ/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>添加注释文本</span><span></span></h3><p data-tool="mdnice编辑器">通过<strong>「plot_annotation」</strong>自定义添加标题或角标，使用&amp;或 * 向所有子图添加元素，而不必单独修改所有图。两者的不同之处 * 仅在于将影响当前嵌套级别上的图：</p><pre data-tool="mdnice编辑器"><span></span><code>bxp+dp+lp+dens+plot_layout(nrow=<span>3</span>,ncol=<span>2</span>)+<br>  plot_annotation(tag_levels =<span>'A'</span>,<br>                  title = <span>'The surprising truth about mtcars'</span>,<br>                  subtitle = <span>'These 3 plots will reveal yet-untold secrets about our beloved data-set'</span>,<br>                  caption = <span>'Disclaimer: None of these plots are insightful'</span>)&amp; theme_gray()&amp;<br>  theme(plot.tag = element_text(size =<span>10</span>,color=<span>"red"</span>,hjust=<span>0.5</span>,vjust=<span>0.5</span>),<br>        plot.tag.position = c(<span>0</span>,<span>1</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.0380710659898478" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36yuxyTxAUATdlJzvagiaIia6c6ibg4dNBBcJ3bkm9oewa9r0pDjsa8S6dCw/640?wx_fmt=png" data-type="png" data-w="788" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36yuxyTxAUATdlJzvagiaIia6c6ibg4dNBBcJ3bkm9oewa9r0pDjsa8S6dCw/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code>(patchwork &lt;- bxp+dp+lp+dens+plot_layout(nrow=<span>3</span>,ncol=<span>2</span>)+<br>  plot_annotation(tag_levels=<span>"A"</span>)&amp; theme_gray()&amp;<br>  theme(plot.tag = element_text(size =<span>10</span>,color=<span>"red"</span>)) <br>  )<br><br>patchwork[[<span>1</span>]] &lt;- patchwork[[<span>1</span>]] + plot_layout(tag_level = <span>'new'</span>)<br>patchwork+plot_annotation(tag_levels = c(<span>'A'</span>,<span>'1'</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.939150401836969" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36yysxoNse2iau4xxibP1icyl3I4nZsGgE6ms9jmmUJAKicQcroO6ib1A2IKKw/640?wx_fmt=png" data-type="png" data-w="871" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36yysxoNse2iau4xxibP1icyl3I4nZsGgE6ms9jmmUJAKicQcroO6ib1A2IKKw/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code>(bxp + (dp + dens) + lp + plot_layout(ncol = <span>1</span>))* theme_minimal()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.1039136302294197" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36y7g7yYNNDnrHib7enGHcia51FcOgx5wwGEPnevbnEia7DiaIbtaibJwx7p4g/640?wx_fmt=png" data-type="png" data-w="741" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36y7g7yYNNDnrHib7enGHcia51FcOgx5wwGEPnevbnEia7DiaIbtaibJwx7p4g/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>上面介绍了<strong>「patchwork」</strong>的拼图方式基本满足了一些常规的需求，但是如果有特殊的需求patchwork也许无法满足，此时就需要用到<strong>「cowplot」</strong>包含的<strong>「ggdraw」</strong>等相关函数，在ggplot上再设置绘图层</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>案例一</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>p &lt;- bxp+dp+lp+dens+plot_layout(nrow=<span>3</span>,ncol=<span>2</span>)<br>p %&gt;% ggdraw()+<br>  draw_plot(bxp,scale=<span>0.3</span>,x=<span>0</span>,y=-<span>0.35</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.8748663101604278" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36y3K0jUqoWByMRlTactd4PkuL8EvHcXeB113c113MI31yO6pahhiaHRmw/640?wx_fmt=png" data-type="png" data-w="935" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36y3K0jUqoWByMRlTactd4PkuL8EvHcXeB113c113MI31yO6pahhiaHRmw/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>案例二</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>通过<strong>「ggdraw」</strong>函数设置后续可以跟ggplot绘图一样再图层之上再添加新的图层，主要使用<strong>「draw_」</strong> 等系列函数将所要添加的元素以图层的形式进行叠加，如下所示可以自定义添加各种元素</p><span>❞</span></blockquote><pre data-tool="mdnice编辑器"><span></span><code>p &lt;- bxp+dp+lp+dens+plot_layout(nrow=3,ncol=2)<br><br>p %&gt;% ggdraw()+<br>  theme(plot.margin=unit(c(1,0,0,0),units=<span>"cm"</span>))+<br>  draw_plot(bxp,scale=0.3,x=0,y=-0.35)+<br>  draw_grob(grid::grid.rect(gp=grid::gpar(fill=<span>"#E64B35B2"</span>,col=<span>"#E64B35B2"</span>)),<br>            x=0.076,y=0.98,height = 0.05,width=0.75)+<br>  draw_line(x = c(0.076,0.82), y = c(1,1), arrow=arrow(), lineend = <span>"butt"</span>,<br>            size = 1, col = <span>"black"</span>)+<br>  draw_label(label=<span>"2000"</span>,x=0.1,y=0.95,color=<span>"#E64B35B2"</span>,size=15,fontface =<span>"bold"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.8748663101604278" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36y3KCfnWJavjwTWNQM6RcEZWgdUFQmicIpCUicD9S85v20xiaI6pfqO5tRg/640?wx_fmt=png" data-type="png" data-w="935" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAanS4B4N2KBvh9cF53HM36y3KCfnWJavjwTWNQM6RcEZWgdUFQmicIpCUicD9S85v20xiaI6pfqO5tRg/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节介绍到此结束，主要想介绍<strong>「cowplot」</strong>的两个案例；喜欢的观众老爷欢迎分享转发；<strong>「当然更推荐大家加入我的VIP交流群」</strong>扫描下方二维码加小编微信<strong>「付费149元」</strong>后邀请进群，<strong>「一定让你感受到物超所值」</strong>，<strong>「添加小编微信请备注来意，以便高效处理」</strong></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>小编微信</span><span></span></h3><p><img data-galleryid="" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg" data-type="jpeg" data-w="430" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/qycXFTSt0VtHmm7z3NQcpg",target="_blank" rel="noopener noreferrer">原文链接</a>
