---
title: "代谢基因和lncRNA表达量矩阵的相关性"
date: 2022-10-03T05:10:54Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
代谢基因和lncRNA表达量矩阵的相关性 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">上两讲中，我们拿到了长非编码基因的基因集和表达量矩阵，以及TCGA数据挖掘常见基因集合，见：<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247506005&amp;idx=1&amp;sn=ad5adf2195e084492cfdb21c4fe2435c&amp;scene=21#wechat_redirect" data-linktype="2">把转录组测序表达量矩阵拆分成为编码与非编码</a>、<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247505792&amp;idx=1&amp;sn=9a9b2d7293402c472ae6d91599908380&amp;scene=21#wechat_redirect" data-linktype="2">TCGA的XENA的转录组测序表达量矩阵预处理</a>，这次我们用lncRNA和代谢相关基因的表达量矩阵做相关性计算，并解析一下它的结果。</p><h4 data-tool="mdnice编辑器"><span></span>1. 获得表达矩阵<span></span></h4><p data-tool="mdnice编辑器">从LAML表达量矩阵拿出lncRNA和代谢相关基因的表达量矩阵：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#lncRNA表达矩阵</span><br>load( file = <span>'output/rdata/0.lnc_protein_expression_data.Rdata'</span>)<br>lnc_dat[<span>1</span>:<span>4</span>, <span>1</span>:<span>4</span>]<br><span>#             TCGA-AB-2949-03 TCGA-AB-2918-03 TCGA-AB-2943-03 TCGA-AB-2851-03</span><br><span># ZSWIM8-AS1               15              10              10              14</span><br><span># ZSCAN16-AS1             277             282             216             163</span><br><span># ZRANB2-AS1               36              42              23              26</span><br><span># ZNRD1-AS1              1880            1561            1744             929</span><br><br><span>#metabolism代谢表达矩阵</span><br>genes_target &lt;- read.table(<span>'input/metabolism-genes-list.txt'</span>)[,<span>1</span>] <br>kp &lt;- intersect(rownames(dat), genes_target)<br>target_dat &lt;- dat[kp,]<br>target_dat[<span>1</span>:<span>4</span>, <span>1</span>:<span>4</span>]<br><span>#          TCGA-AB-2949-03 TCGA-AB-2918-03 TCGA-AB-2943-03 TCGA-AB-2851-03</span><br><span># ZACN                 104             103             128             117</span><br><span># XYLT2                919            1633             839            1305</span><br><span># XDH                    1               3               1               1</span><br><span># VKORC1L1            1578            1712            1436             954</span><br><br>save(lnc_dat, <br>     genes_target, <br>     file = <span>'output/rdata/0.lnc_metabolism_expression_data.Rdata'</span>)<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>2. 计算相关性<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>load( file = <span>'output/rdata/0.lnc_metabolism_expression_data.Rdata'</span>)<br>identical(colnames(lnc_dat), colnames(target_dat))<br><span>#[1] TRUE</span><br><br>m1=target_dat  <span>#代谢</span><br>m2=lnc_dat<br><br><span>#定义计算相关性的函数</span><br>cor_2_matrix &lt;- <span>function</span>(m1,m2){<br>  apply(m2 , <span>1</span>, <span>function</span>(x){<br>    <span>#  x = m2[2,]</span><br>    unlist(apply(m1, <span>1</span>,<span>function</span>(y){<br>      <span># y  = m1[1,]</span><br>      cor(as.numeric(x), <span>#cor</span><br>          as.numeric(y))<br>    }))<br>  })<br>}<br><br>rdf[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br><span>#           ZSWIM8-AS1 ZSCAN16-AS1  ZRANB2-AS1   ZNRD1-AS1</span><br><span>#ZACN      0.006748374  0.02089440  0.09556742  0.31465553</span><br><span>#XYLT2     0.215282382  0.27156587 -0.01498975  0.19231130</span><br><span>#XDH      -0.062246960 -0.04867204  0.05621079 -0.02622855</span><br><span>#VKORC1L1 -0.272115650  0.15826855  0.24478046  0.35947612</span><br><br><span>if</span>(<span>F</span>){  <span>#运行时间比较久，下面保存结果，避免重复运行</span><br>  rdf=cor_2_matrix( m1  , m2 ) <br>}<br><br><span>#得到相关性p值的矩阵</span><br>corP_2_matrix &lt;- <span>function</span>(m1,m2){<br>  apply(m2 , <span>1</span>, <span>function</span>(x){<br>    <span>#  x = m2[2,]</span><br>    unlist(apply(m1, <span>1</span>,<span>function</span>(y){<br>      <span># y  = m1[1,]</span><br>      cor.test(as.numeric(x),          <span>#cor.test</span><br>               as.numeric(y))$p.value  <span>#cor.test()$p.value</span><br>    }))<br>  })<br>}<br><br><span>if</span>(<span>F</span>){<br>  pdf=corP_2_matrix( m1 , m2 ) <br>}<br><br>pdf[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br><span>#           ZSWIM8-AS1 ZSCAN16-AS1  ZRANB2-AS1    ZNRD1-AS1</span><br><span>#ZACN     0.9344580531 0.798994257 0.243102469 8.325045e-05</span><br><span>#XYLT2    0.0079389954 0.000743695 0.855051633 1.799850e-02</span><br><span>#XDH      0.4476827269 0.552864022 0.493008150 7.492120e-01</span><br><span>#VKORC1L1 0.0007247521 0.052267187 0.002452533 5.813088e-06</span><br><br><span>if</span>(<span>F</span>){<br>save(rdf,pdf,file = <span>'output/rdata/step1_cor_results1.Rdata'</span>)<br>}<br></code></pre><h5 data-tool="mdnice编辑器"><span></span>设置阈值<span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>cor_thred &lt;- <span>0.7</span>            <br>pvalue_thred  &lt;- <span>0.01</span><br><br><span>library</span>(reshape2)<br>pdfm = melt(pdf) <span>#将数据宽边长</span><br>head(pdfm)<br><span>#      Var1       Var2        value</span><br><span>#1     ZACN ZSWIM8-AS1 0.9344580531</span><br><span>#2    XYLT2 ZSWIM8-AS1 0.0079389954</span><br><span>#3      XDH ZSWIM8-AS1 0.4476827269</span><br><span>#4 VKORC1L1 ZSWIM8-AS1 0.0007247521</span><br><span>#5    VDAC2 ZSWIM8-AS1 0.3495754229</span><br><span>#6    VDAC1 ZSWIM8-AS1 0.0120853025</span><br><br>rdfm = melt(rdf)<br>head(rdfm)<br><span>#      Var1       Var2        value</span><br><span>#1     ZACN ZSWIM8-AS1  0.006748374</span><br><span>#2    XYLT2 ZSWIM8-AS1  0.215282382</span><br><span>#3      XDH ZSWIM8-AS1 -0.062246960</span><br><span>#4 VKORC1L1 ZSWIM8-AS1 -0.272115650</span><br><span>#5    VDAC2 ZSWIM8-AS1  0.076647718</span><br><span>#6    VDAC1 ZSWIM8-AS1 -0.203777611</span><br><br>table(pdfm$value  &lt; pvalue_thred )<br><span>#   FALSE    TRUE </span><br><span># 5875071 1128795 </span><br><br>table(abs(rdfm$value) &gt; cor_thred )<br><span>#   FALSE    TRUE </span><br><span># 7001719    2147 </span><br><br><span>#设置筛选条件</span><br>kp = (pdfm$value  &lt; pvalue_thred ) &amp; (abs(rdfm$value) &gt; cor_thred )<br>table(kp)<br><span>#   FALSE    TRUE </span><br><span># 7001719    2147</span><br><br>cor_df =  rdfm[kp,]<br>head(cor_df)<br><span>#         Var1        Var2     value</span><br><span>#15333 SLC38A4 ZNF385D-AS2 0.7822774</span><br><span>#29392   EPHX2    ZIM2-AS1 0.7123947</span><br><span>#29443 CYP4F12    ZIM2-AS1 0.7473137</span><br><span>#29500    CDO1    ZIM2-AS1 0.8504875</span><br><span>#29666  ABCB11    ZIM2-AS1 0.7221485</span><br><span>#38112  HS3ST2  ZBTB20-AS3 0.7256150</span><br><br>colnames(cor_df)[<span>1</span>:<span>2</span>]=c(<span>'target'</span>,<span>'lncRNA'</span> )<br>cor_df$Regulation = ifelse(cor_df$value &gt; <span>0</span> ,<span>'pos'</span>,<span>'neg'</span>)<br>table(cor_df$Regulation ) <span>#此时相关性全是pos正相关</span><br><span># pos </span><br><span>#2147 </span><br><br><span>#save data</span><br>save(cor_df,file = <span>'output/rdata/step1_cor_results.Rdata'</span>)<br>length(unique(cor_df$lncRNA))<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>3. 可视化<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggalluvial)<br><span>library</span>(ggplot2)<br><span>library</span>(ggsci)<br><span>library</span>(RColorBrewer)<br><br>data &lt;- cor_df<br>length(unique(data$target))<br><span>#[1] 271</span><br>length(unique(data$lncRNA))<br><span>#[1] 775</span><br>head(data)<br><span>#       target      lncRNA     value Regulation</span><br><span>#15333 SLC38A4 ZNF385D-AS2 0.7822774        pos</span><br><span>#29392   EPHX2    ZIM2-AS1 0.7123947        pos</span><br><span>#29443 CYP4F12    ZIM2-AS1 0.7473137        pos</span><br><span>#29500    CDO1    ZIM2-AS1 0.8504875        pos</span><br><span>#29666  ABCB11    ZIM2-AS1 0.7221485        pos</span><br><span>#38112  HS3ST2  ZBTB20-AS3 0.7256150        pos</span><br><br>colourCount &lt;- length(unique(data$target))<br>getPalette &lt;- colorRampPalette(brewer.pal(<span>12</span>, <span>"Paired"</span>))<br></code></pre><h5 data-tool="mdnice编辑器"><span></span>3.1 ggalluvium<span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>ggplot(data, aes(axis1 = lncRNA, axis2 = target,<br>               axis3 = Regulation,<br>               y = value)) +<br>scale_x_discrete(limits = c(<span>"lncRNA"</span>, <span>"target"</span>, <span>"Regulation"</span>), expand = c(<span>.2</span>, <span>.05</span>))+<br>xlab(<span>"CorGraph"</span>) +<br>geom_alluvium(aes(fill = Regulation),width = <span>1</span>/<span>12</span>, alpha = <span>1</span>, knot.pos = <span>0.1</span>, reverse = <span>FALSE</span>)+<br>scale_fill_aaas()+<br>geom_stratum(width= <span>1</span>/<span>12</span>, reverse = <span>FALSE</span>)+<br><span># geom_text(stat = "stratum", aes(label = after_stat(stratum)))+</span><br>theme_bw() + <br>theme(axis.line = element_blank(),<br>      axis.ticks = element_blank(),<br>      axis.text.y = element_blank(),<br>      panel.grid = element_blank(),<br>      panel.border = element_blank())+ <br>ggtitle(<span>"Correlation between lncRNAs and target genes"</span>,<br>        <span>"stratified by regulation"</span>) <br>ggsave( filename = <span>'output/plot/step1.doCor_ggalluvium.pdf'</span>), <br>      width = <span>10</span>, height = <span>6</span>)<br></code></pre><p data-tool="mdnice编辑器">可以看到在我们选定的阈值下，相关性都为正相关。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5775225594749795" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibfpu4SsiaYwSicZ9jCEnAuaCPicXrrRibEYDqic6REwzN9pyaXNQDC9TWXJ7kykG5agO1uR8W5KiahVRpQ/640?wx_fmt=png" data-type="png" data-w="1219" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibfpu4SsiaYwSicZ9jCEnAuaCPicXrrRibEYDqic6REwzN9pyaXNQDC9TWXJ7kykG5agO1uR8W5KiahVRpQ/640?wx_fmt=png"></figure><h5 data-tool="mdnice编辑器"><span></span>3.2 barplot<span></span></h5><p data-tool="mdnice编辑器">查看的是代谢基因（横坐标）所对应的lncRNA的数量（纵坐标）。</p><pre data-tool="mdnice编辑器"><span></span><code>ggplot(data) + <br>geom_bar(aes(factor(target), fill=factor(target))) + <br>scale_fill_manual(values = getPalette(colourCount))+<br>xlab("") + ylab("")+<br>theme_bw()+<br>theme(axis.text.x = element_text(angle = 45, vjust = 0.6))<br><br>ggsave( filename = 'output/plot/step1.doCor_barplot.pdf',   <br>      width = 10, height = 8)<br><br>colnames(data)<br>ggplot(data) + <br>geom_bar(aes(factor(target), fill=factor(target))) + <br>scale_fill_manual(values = getPalette(colourCount))+<br>xlab("") + ylab("")+<br>theme_bw()+<br>theme(axis.text.x = element_text(angle = 45, vjust = 0.6)) + facet_wrap(~Regulation,nrow=2)  #加上正负相关性的分组，不过这里只有正相关<br><br>ggsave(filename = 'output/plot/step1.doCor_barplot_split.pdf',<br>     width = 10, height = 8)<br></code></pre><figure data-tool="mdnice编辑器"><br></figure><figure data-tool="mdnice编辑器"><br><img data-ratio="0.6" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibfpu4SsiaYwSicZ9jCEnAuaC06FdLDaLia6Z6FY1GCaGhZT9ibqIG3SOOzlFeCiadCUeVVblsbSRQ8LgA/640?wx_fmt=png" data-type="png" data-w="6000" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibfpu4SsiaYwSicZ9jCEnAuaC06FdLDaLia6Z6FY1GCaGhZT9ibqIG3SOOzlFeCiadCUeVVblsbSRQ8LgA/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">所有基因的基因名图例非常多，下面基因名也看不清了。</p><p data-tool="mdnice编辑器">挑选相关性前一百个基因看一下。但其实对应的lncRNA会不全，没有什么意义。</p><pre data-tool="mdnice编辑器"><span></span><code><span>#相关性前100个基因（有重复）</span><br>data1 &lt;- data[order(data$value,decreasing = <span>T</span>),]<br>data1 = data[<span>1</span>:<span>100</span>,]<br><br>colourCount &lt;- length(unique(data1$target))<br><br>ggplot(data1) + <br>  geom_bar(aes(factor(target), fill=factor(target))) + <br>  scale_fill_manual(values = getPalette(colourCount))+<br>  xlab(<span>""</span>) + ylab(<span>""</span>)+<br>  theme_bw()+<br>  theme(axis.text.x = element_text(angle = <span>45</span>, vjust = <span>0.6</span>)) + facet_wrap(~Regulation,nrow=<span>2</span>)<br>ggsave(filename = <span>'output/plot/step1.100doCor_barplot_split.png'</span>),<br>       width = <span>20</span>, height = <span>12</span>)<br></code></pre><figure data-tool="mdnice编辑器"><br></figure><figure data-tool="mdnice编辑器"><br><img data-ratio="0.6" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibfpu4SsiaYwSicZ9jCEnAuaC214rztKrrbrT7fUzZdhriaRvnmOoiagpBGL6ibInmn9cbUic42NsibLFYJQ/640?wx_fmt=png" data-type="png" data-w="6000" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibfpu4SsiaYwSicZ9jCEnAuaC214rztKrrbrT7fUzZdhriaRvnmOoiagpBGL6ibInmn9cbUic42NsibLFYJQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">那看一下对应lncRNA数量前50的基因：</p><pre data-tool="mdnice编辑器"><span></span><code>a=names(sort(table(data$target),decreasing = <span>T</span>)[<span>1</span>:<span>50</span>])<br>data2=data[data$target%<span>in</span>%a,]<br><br>colourCount &lt;- length(unique(data2$target))<br><br>ggplot(data2) + <br>  geom_bar(aes(factor(target), fill=factor(target))) + <br>  scale_fill_manual(values = getPalette(colourCount))+<br>  xlab(<span>""</span>) + ylab(<span>""</span>)+<br>  theme_bw()+<br>  theme(axis.text.x = element_text(angle = <span>45</span>, vjust = <span>0.6</span>))<br>ggsave(filename = paste0(pro,<span>'_'</span>,<span>'output/plot/step1.50doCor_barplot_split.png'</span>),<br>       width = <span>20</span>, height = <span>12</span>)<br></code></pre><figure data-tool="mdnice编辑器"><br></figure><figure data-tool="mdnice编辑器"><br><img data-ratio="0.6" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibfpu4SsiaYwSicZ9jCEnAuaCf0Q42PlBQr0LibbBbp1SnLUNRkkemTRxu0JA95xHTibUNiaYGCm5XTAjQ/640?wx_fmt=png" data-type="png" data-w="6000" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibfpu4SsiaYwSicZ9jCEnAuaCf0Q42PlBQr0LibbBbp1SnLUNRkkemTRxu0JA95xHTibUNiaYGCm5XTAjQ/640?wx_fmt=png"></figure></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Oa-Adfbgw-K59jeAMz1Abw",target="_blank" rel="noopener noreferrer">原文链接</a>
