---
title: "如何整合多个单细胞数据集"
date: 2024-02-23T02:43:08Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
如何整合多个单细胞数据集 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>学员表示他在处理这个数据集（GSE152938）的时候，因为数据集里面是5个样品，但是只有一个是正常组织的样品，分组是不平衡的，所以需要联合其它数据集的正常组织，但是不知道如何在r编程语言里面操作。</p></blockquote><p><img data-galleryid="" data-imgfileid="100044722" data-ratio="0.38055555555555554" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzkCGVH5W9kppicrd1Sq1c843QkaT6AXDtyX0XDvSgskhwzo6pA1xCun0IeWE2H7iaW7CJqkeINblVQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzkCGVH5W9kppicrd1Sq1c843QkaT6AXDtyX0XDvSgskhwzo6pA1xCun0IeWE2H7iaW7CJqkeINblVQ/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>数据集（GSE152938）</figcaption></figure><p data-tool="mdnice编辑器">如下所示的数据集（GSE152938）文件形式 ：</p><p><img data-galleryid="" data-imgfileid="100044720" data-ratio="0.25" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzkCGVH5W9kppicrd1Sq1c84XLbe4UwFeZdFGH3v3BU5ng84oC12qMPJCtZX5RfThdPZGnbZxGQHxQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzkCGVH5W9kppicrd1Sq1c84XLbe4UwFeZdFGH3v3BU5ng84oC12qMPJCtZX5RfThdPZGnbZxGQHxQ/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>文件形式</figcaption></figure><p data-tool="mdnice编辑器">对于这个数据集（GSE152938），可以使用下面的代码进行批量读取哈：</p><pre data-tool="mdnice编辑器"><span></span><code>dir=<span>'GSE152938_RAW'</span><br>samples=list.files( dir )<br>samples <br>sceList = lapply(samples,<span>function</span>(pro){ <br>  <span># pro=samples[1] </span><br>  print(pro)  <br>  tmp = Read10X(file.path(dir,pro )) <br>  <span>if</span>(length(tmp)==<span>2</span>){<br>    ct = tmp[[<span>1</span>]] <br>  }<span>else</span>{ct = tmp}<br>  sce =CreateSeuratObject(counts =  ct ,<br>                          project =  pro  ,<br>                          min.cells = <span>5</span>,<br>                          min.features = <span>300</span> )<br>  <span>return</span>(sce)<br>}) <br>do.call(rbind,lapply(sceList, dim))<br>sce.all=merge(x=sceList[[<span>1</span>]],<br>              y=sceList[ -<span>1</span> ],<br>              add.cell.ids = samples  ) <br>names(sce.all@assays$RNA@layers)<br>sce.all[[<span>"RNA"</span>]]$counts <br><span># Alternate accessor function with the same result</span><br>LayerData(sce.all, assay = <span>"RNA"</span>, layer = <span>"counts"</span>)<br>sce.all &lt;- JoinLayers(sce.all)<br>dim(sce.all[[<span>"RNA"</span>]]$counts )<br></code></pre><p data-tool="mdnice编辑器">学员给了一个正常人的肾脏组织数据集（GSE131685），同时我们读取它，如下所示的文件形式：</p><p><img data-galleryid="" data-imgfileid="100044721" data-ratio="0.37777777777777777" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzkCGVH5W9kppicrd1Sq1c84RZzV71U4KUE4Gb2SCSqyI2HL27GWaE5ORAt1SC6aDl206ONzVjVp4A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzkCGVH5W9kppicrd1Sq1c84RZzV71U4KUE4Gb2SCSqyI2HL27GWaE5ORAt1SC6aDl206ONzVjVp4A/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>数据集（GSE131685）</figcaption></figure><p data-tool="mdnice编辑器">也是同样的读取方式：</p><pre data-tool="mdnice编辑器"><span></span><code>dir=<span>'GSE131685_RAW/outputs/'</span><br>samples=list.files( dir )<br>samples <br></code></pre><p data-tool="mdnice编辑器">上面的这两个数据集走我们给大家的标准代码后各自独立的降维聚类分群，就会有  2-harmony/sce.all_int.rds 文件夹和文件。</p><p data-tool="mdnice编辑器">然后就可以使用下面的代码，合并两个数据集：</p><pre data-tool="mdnice编辑器"><span></span><code>GSE131685 = readRDS(<span>'../2020-GSE131685-3个正常人的肾单细胞/2-harmony/sce.all_int.rds'</span>) <br>GSE131685$study = <span>'GSE131685'</span><br>table(GSE131685$orig.ident)<br>GSE152938 = readRDS(<span>'../2021-GSE152938-肾癌/2-harmony/sce.all_int.rds'</span>)<br>GSE152938$study = <span>'GSE152938'</span><br>table(GSE152938$orig.ident)<br>sceList = list(<br>  GSE131685 = CreateSeuratObject(<br>    counts = GSE131685@assays$RNA$counts<br>  ), <br>  GSE152938 = CreateSeuratObject(<br>    counts = GSE152938@assays$RNA$counts<br>  )<br>)<br>sce.all=merge(x=sceList[[<span>1</span>]],<br>              y=sceList[ -<span>1</span> ],<br>              add.cell.ids = c(<span>'GSE131685'</span>,<span>'GSE152938'</span>)  ) <br>names(sce.all@assays$RNA@layers)<br>sce.all[[<span>"RNA"</span>]]$counts <br><span># Alternate accessor function with the same result</span><br>LayerData(sce.all, assay = <span>"RNA"</span>, layer = <span>"counts"</span>)<br>sce.all &lt;- JoinLayers(sce.all)<br>dim(sce.all[[<span>"RNA"</span>]]$counts )<br></code></pre><p data-tool="mdnice编辑器">可以看到这两个数据集都有不同数量的样品，合并后就是一个大的对象了：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; table(GSE131685<span>$orig</span>.ident)<br><br>kidney1 kidney2 kidney3 <br>   6856    5134   10532 <br>   <br>&gt; table(GSE152938<span>$orig</span>.ident)<br><br>ccRCC1 ccRCC2  chRCC Normal   pRCC <br>  9478   9317   5187   1395  11395 <br>  <br>&gt; table(sce.all<span>$orig</span>.ident) <br><br>GSM4145204 GSM4145205 GSM4145206 GSM4630027 GSM4630028 GSM4630029 GSM4630030 GSM4630031 <br>      6856       5134      10532      11395       9478       9317       5187       1395   <br></code></pre><p data-tool="mdnice编辑器">这个合并后的对象当然是可以继续<span><strong>走我们给大家的标准代码后各自独立的降维聚类分群啦。(</strong></span></p><p><span>链接: https://pan.baidu.com/s/1pKEnPmWXi-pTab0WZUWzgg?pwd=a7s1</span></p><p data-tool="mdnice编辑器"><span><strong>)</strong></span></p><p data-tool="mdnice编辑器">所以，理论上使用这个技巧是可以处理无限多个不同来源的单细胞转录组数据集啦，而且无需担心大家的文件格式的问题，反正每个数据集都自己的内部处理好，然后外部构建成为sceList合并即可。</p></section><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528328&amp;idx=1&amp;sn=33055906f1dca6958238a84b48405cd5&amp;chksm=9b4b2f33ac3ca6255cdf3d9e1422c6610aebd2fdece36ea0bd9d1cf838cbf1521b599ae81abe&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授‍课（买一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528133&amp;idx=1&amp;sn=2fc6bf3e8455222628c9814d6509c74f&amp;chksm=9b4b2e7eac3ca7687d2f12b37fa48bfe1b060b3c204df87dbf6e277321cfaeb8f5e4d283ca1e&amp;scene=21#wechat_redirect" textvalue="月薪两万找生信练习生（线下）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">月薪两万找生信练习生（线下）</a><br></section></li><li><section> <a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;chksm=9b4b2f10ac3ca606c1c4bac8cf112bb9b0f18e3c4262f5f2b8c0dba3bfedf2ba201507247005&amp;scene=21#wechat_redirect" textvalue="2024的共享服务器交个朋友福利价仍然是800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">2024的共享服务器交个朋友福利价仍然是800</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">千呼万唤始出来的独享生物信息学云服务器</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528144&amp;idx=1&amp;sn=be4d7e542d1077921024c86a4c130f16&amp;chksm=9b4b2e6bac3ca77d87a0ae0c12ae028d10225db19c8d7fb92b1299fa12f572bb769bcd92889b&amp;scene=21#wechat_redirect" textvalue="永久免费的生信进阶培训（线下）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">永久免费的生信进阶培训（线下）</a></section></li></ul><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/zt0BzAmqzsxNqhPnDky0gA",target="_blank" rel="noopener noreferrer">原文链接</a>
