---
title: "snakemake的初步尝试"
date: 2024-02-24T01:32:43Z
draft: ["false"]
tags: [
  "fetched",
  "东林的扯淡小屋"
]
categories: ["Acdemic"]
---
snakemake的初步尝试 by 东林的扯淡小屋
------
<div><p><img data-galleryid="" data-ratio="1.0185185185185186" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSTN3vRx5O02jegGzTUKotX2ut8rHChf0d2x17kNYV8zIjduoqiaVwFPw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSTN3vRx5O02jegGzTUKotX2ut8rHChf0d2x17kNYV8zIjduoqiaVwFPw/640?wx_fmt=png"></p><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span>conda config --<span>set</span> channel_priority flexible</span></code><code><span><span>#https://github.com/rapidsai/cuml/issues/4016</span></span></code><code><span><br></span></code><code><span>conda install -c conda-forge mamba</span></code><code><span>mamba create -c conda-forge -c bioconda -n snakemake snakemake</span></code><code><span>conda activate snakemake</span></code><code><span>snakemake --<span>help</span></span></code></pre></section><p><img data-galleryid="" data-ratio="0.5962962962962963" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaS3ES3Ea1oPnI6pcicXzFK3lS7FJnNXib4mVW9HSsmrJYnwJtIzNuSjbJA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaS3ES3Ea1oPnI6pcicXzFK3lS7FJnNXib4mVW9HSsmrJYnwJtIzNuSjbJA/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.5962962962962963" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSiamWXofJf5sjuwQUx1mAbCibEXEPpkKx2ZMiboctIss7kcQ0ZRIwEUxcw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSiamWXofJf5sjuwQUx1mAbCibEXEPpkKx2ZMiboctIss7kcQ0ZRIwEUxcw/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.17314814814814813" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSD13jQ6mRoXPPyvflRAiagNMmxf5cHDpjKMJQuAcglC5WibnYjeZnoqZw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSD13jQ6mRoXPPyvflRAiagNMmxf5cHDpjKMJQuAcglC5WibnYjeZnoqZw/640?wx_fmt=png"></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="javascript"><code><span>strings /usr/lib/x86_64-linux-gnu<span>//libstdc++.so.6 | grep CXXABI</span></span></code><code><span>ll /usr/lib/x86_64-linux-gnu<span>//libstdc++.so.6</span></span></code><code><span>sudo find / -name <span>"libstdc++.so.*"</span></span></code><code><span><br></span></code><code><span>sudo cp /data/yudonglin/software/HiC-Pro-master/hic/lib/libstdc++.so<span>.6</span><span>.0</span><span>.30</span> /usr/lib/x86_64-linux-gnu/</span></code><code><span><br></span></code><code><span>cd /usr/lib/x86_64-linux-gnu</span></code><code><span>sudo rm libstdc++.so<span>.6</span></span></code><code><span>sudo ln -s libstdc++.so<span>.6</span><span>.0</span><span>.30</span> libstdc++.so<span>.6</span></span></code><code><span>strings /usr/lib/x86_64-linux-gnu/libstdc++.so<span>.6</span> | grep CXXABI</span></code><code><span>#参考资料：https:<span>//blog.csdn.net/wenroudebaozi/article/details/107564647</span></span></code><code><span><br></span></code></pre></section><p><img data-galleryid="" data-ratio="0.38981481481481484" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaS6FQ0mBX9iaQKEIE6UzvqJnibwHAyudTWNoI4AnSMONdgCT9ZicUNYQrpA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaS6FQ0mBX9iaQKEIE6UzvqJnibwHAyudTWNoI4AnSMONdgCT9ZicUNYQrpA/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.5962962962962963" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaShian3ufs1bMab1KOfgmoJEe0YVqrW4UxcIj5bzF3jIjnkxLrYbIWrcg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaShian3ufs1bMab1KOfgmoJEe0YVqrW4UxcIj5bzF3jIjnkxLrYbIWrcg/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.6148148148148148" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaS27iamYsy5u9ribIe0s5pKzWsjVkYuREdic36hZTibYGSh9HgiaJJmlolV5A/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaS27iamYsy5u9ribIe0s5pKzWsjVkYuREdic36hZTibYGSh9HgiaJJmlolV5A/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.5120370370370371" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSLhfuNAOVicpGSkwOiaUT5oahAYOpJDBVwPK4OkQCzZgYibnk7cQKKrztQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSLhfuNAOVicpGSkwOiaUT5oahAYOpJDBVwPK4OkQCzZgYibnk7cQKKrztQ/640?wx_fmt=png"></p><p>终于成功安装！</p><p><img data-galleryid="" data-ratio="0.5962962962962963" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSN3l0jTP9h7826ja5m4wshTbc5st6zLlFWImwjT16d6DTf11ujibbdicA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSN3l0jTP9h7826ja5m4wshTbc5st6zLlFWImwjT16d6DTf11ujibbdicA/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.5962962962962963" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSNwns7jo1Bianao8U0HTphf0XmiaQwbwwMPfzWNmWuQqdcwzFUE2PicGFg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSNwns7jo1Bianao8U0HTphf0XmiaQwbwwMPfzWNmWuQqdcwzFUE2PicGFg/640?wx_fmt=png"></p><p><br></p><p>初步尝试：</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span>#首先我们建立两个文件</span></span></code><code><span><span>echo</span> <span>"Here is hello."</span> &gt; hello.txt</span></code><code><span>echo <span>"Here is world."</span> &gt; world.txt</span></code><code><span><br></span></code><code><span>vi Snakefile</span></code><code><span><span>#接下来开始编写我们的Snakefile</span></span></code><code><span>rule concat:  <span># 这里的rule可视为snakemake定义的关键字，concat使我们自定义的这一步任务的名称</span></span></code><code><span>    input:   <span># input同样是snakemake的关键字，定义了在这个任务中的输入文件 </span></span></code><code><span>        expand(<span>"{file}.txt"</span>, file=[<span>"hello"</span>, <span>"world"</span>]) <span>#expand是一个snakemake定义的替换命令</span></span></code><code><span>    output:   <span># output也是snakemake的关键字，定义输出结果的保存文件</span></span></code><code><span>        <span>"merged.txt"</span></span></code><code><span>    shell:  <span># 这里表示我们下面的命令将在命令行中执行</span></span></code><code><span>        <span>"cat {input} &gt; {output}"</span></span></code><code><span><br></span></code><code><span><span>#最后就可以在Snakefile的路径执行snakemake命令即可</span></span></code><code><span><span>#https://www.jianshu.com/p/14b9eccc0c0e</span></span></code><code><span>snakemake --cores <span>20</span></span></code><code><span>cat merge.txt</span></code></pre></section><p><img data-galleryid="" data-ratio="0.5962962962962963" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSLpalibrhAiaNuiaZyd9pKtiaWu02WodLa0mJn3Dyywa9OJ8sjeRXvPSGgw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSLpalibrhAiaNuiaZyd9pKtiaWu02WodLa0mJn3Dyywa9OJ8sjeRXvPSGgw/640?wx_fmt=png"></p><p><br></p><p>代码文件命名最好为Snakefile, snakefile, workflow/Snakefile, workflow/snakefile。</p><p>snakemake的第一步实战就是修改文件的名字，如果直接就是fq.gz，就不用改，如果是fastq.gz就改为fq.gz。</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span><span># -*- coding: utf-8 -*-</span></span></code><code><span><span>"""</span></span></code><code><span>Created on Thu Jan  5 15:57:26 2023</span></code><code><span><br></span></code><code><span>@author: yudonglin</span></code><code><span>"""</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span>#统一输入的文件是fq.gz格式</span></span></code><code><span>new_fq = [</span></code><code><span>        <span>"data/HA-Vector-1_L3_1.fq.gz"</span>,</span></code><code><span>        <span>"data/HA-Vector-1_L3_2.fq.gz"</span>,</span></code><code><span>        <span>"data/HA-Vector-2_L3_1.fq.gz"</span>,</span></code><code><span>        <span>"data/HA-Vector-2_L3_2.fq.gz"</span></span></code><code><span>]</span></code><code><span><br></span></code><code><span>rule all:</span></code><code><span>    input:</span></code><code><span>        new_fq</span></code><code><span>rule change_suffix:</span></code><code><span>    input:</span></code><code><span>        <span>"rawdata/{sample}.fastq.gz"</span></span></code><code><span>    output:</span></code><code><span>        <span>"data/{sample}.fq.gz"</span></span></code><code><span>    shell:</span></code><code><span>        <span>"cp {input} {output}"</span></span></code><code><span><br></span></code><code><span><br></span></code></pre></section><p><img data-galleryid="" data-ratio="1.196808510638298" data-s="300,640" data-type="png" data-w="940" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSLFXqlzHnlnNNfB3CGVxMJ3GSPSAKDQt6MW7YVmp4Fho9NgBJdKxicFQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSLFXqlzHnlnNNfB3CGVxMJ3GSPSAKDQt6MW7YVmp4Fho9NgBJdKxicFQ/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="1.2057877813504823" data-s="300,640" data-type="png" data-w="933" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSicZFZKERYTN9RgQLpDmaGvscX6aM02Fqt3mSdghTp2CsPQa1RSs1J2g/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBrlGfn0c5XVUOE1ce5eaiaiaSicZFZKERYTN9RgQLpDmaGvscX6aM02Fqt3mSdghTp2CsPQa1RSs1J2g/640?wx_fmt=png"></p><p>很复杂，也可以用shell来写：<br></p><section><ul><li></ul><pre data-lang="ruby"><code><span><span>for</span> i <span>in</span> $(ls data/*.fastq.gz);<span>do</span> cp $i data/$(basename $i fastq.gz)fq.gz; done</span></code></pre></section><p><br></p><p><br></p><p>参考资料：<br></p><p>https://snakemake.readthedocs.io/en/stable/getting_started/installation.html</p><p><br>https://cloud.tencent.com/developer/article/2032005</p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/65f1_s_yURhLBAe1UXsVFw",target="_blank" rel="noopener noreferrer">原文链接</a>
