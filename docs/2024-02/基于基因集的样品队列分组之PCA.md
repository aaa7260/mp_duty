---
title: "基于基因集的样品队列分组之PCA"
date: 2024-02-13T15:34:51Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
基于基因集的样品队列分组之PCA by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>随着ngs价格的持续走低，转录组测序项目早就走入了大样品时代，当然了，早在芯片价格亲民的时候就有这样的趋势，目前单细胞转录组价格也是在走这个老路。</p></blockquote><p data-tool="mdnice编辑器">那么，对于大样品队列的转录组，很多时候是没有已知的合理的分组， 这个时候会人为的去分组后看队列异质性，比如根据免疫高低进行分组。</p><p data-tool="mdnice编辑器">那么这个根据免疫高低进行分组就有多种实现方式，我们这里简单的演示一下PCA和热图的层次聚类以及gsea或者gsva这样的打分的分组，看看是否有区别。</p><h3 data-tool="mdnice编辑器"><span></span>首先看看目标基因集的PCA分组<span></span></h3><p data-tool="mdnice编辑器">需要载入 step1-output.Rdata 这个文件里面的表达量矩阵哦，如果你不知道 step1-output.Rdata 如果得到，看文末的代码。</p><p data-tool="mdnice编辑器">首先，我们需要提前免疫基因集的小表达量矩阵，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>load(file = <span>'step1-output.Rdata'</span>)<br>cg=c(<span>'CD3D'</span>,<span>'CD3G CD247'</span>,<span>'IFNG'</span>,<span>'IL2RG'</span>,<span>'IRF1'</span>,<span>'IRF4'</span>,<span>'LCK'</span>,<span>'OAS2,STAT1'</span>)<br>cg<br>cg=cg[cg %<span>in</span>% rownames(dat)]<br><span>library</span>(<span>"FactoMineR"</span>) <span>#画主成分分析图需要加载这两个包</span><br><span>library</span>(<span>"factoextra"</span>)  <br>dat.pca &lt;- PCA(as.data.frame(t(dat[cg,]))  )<br>fviz_pca_ind(dat.pca,<br>             geom.ind = <span>"point"</span>, <span># show points only (nbut not "text")</span><br>             <span># col.ind =  group_list, # color by groups </span><br>             addEllipses = <span>T</span>,<br>             legend.title = <span>"Groups"</span><br>)<br>dat.pca$ind$coord<br></code></pre><p data-tool="mdnice编辑器">如下所示：</p><p data-tool="mdnice编辑器">可以看到，每个样品在这个主成分分析图表上面都是有坐标的：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; head(dat.pca<span>$ind</span><span>$coord</span>[,1:2])<br>                Dim.1      Dim.2<br>GSM1419942 -1.5307665  0.1820390<br>GSM1419943  0.2224343  0.9908672<br>GSM1419944 -2.1294537  0.3075360<br>GSM1419945  0.0745490  0.2147092<br>GSM1419946 -4.8646160 -0.2016098<br>GSM1419947  0.9149908  0.2421981<br></code></pre><p data-tool="mdnice编辑器">我们可以简单的根据PC1去划分样品成为两个组，也可以根据PC1和PC2合起来分成4个组，这个步骤很随意。我们先试试看简单的根据PC1去划分样品成为两个组，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>group_list=ifelse(dat.pca$ind$coord[,<span>1</span>] &lt; <span>0</span> ,<span>'neg'</span>,<span>'pos'</span>)<br>table(group_list) <br>pca_gl = group_list<br><span># 其中 hclust_gl 来自于前面的教程哦</span><br>table(pca_gl,hclust_gl)<br></code></pre><p data-tool="mdnice编辑器">可以看到前面的层次聚类的样品分组跟现在的PCA的PC1的分组，还是有差异的：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; table(pca_gl,hclust_gl)<br>      hclust_gl<br>pca_gl high low<br>   neg    1  59<br>   pos   37  10<br></code></pre><p data-tool="mdnice编辑器">但是它们可视化相关却没有太大的区别：</p><p><img data-ratio="0.40078125" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwxj7LS0URl4tNXcZq1F2IQ77seia7VemYrYq8YNzELtLWBzpH3Sd2O611G6HqrfkwwmwS0icYpVQAA/640?wx_fmt=png" data-type="png" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwxj7LS0URl4tNXcZq1F2IQ77seia7VemYrYq8YNzELtLWBzpH3Sd2O611G6HqrfkwwmwS0icYpVQAA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>两个分组的差异</figcaption></figure><p data-tool="mdnice编辑器">肉眼基本上看不出来差异，区别应该是横坐标为0附近的那些样品吧！</p><p data-tool="mdnice编辑器">代码是：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(patchwork)<br>fviz_pca_ind(dat.pca,<br>             geom.ind = <span>"point"</span>, <span># show points only (nbut not "text")</span><br>             col.ind =  pca_gl, <span># color by groups </span><br>             addEllipses = <span>T</span>,<br>             legend.title = <span>"Groups"</span><br>)+ <br>  fviz_pca_ind(dat.pca,<br>               geom.ind = <span>"point"</span>, <span># show points only (nbut not "text")</span><br>               col.ind =  hclust_gl, <span># color by groups </span><br>               addEllipses = <span>T</span>,<br>               legend.title = <span>"Groups"</span><br>  )<br><br><br></code></pre><p data-tool="mdnice编辑器">蛮有意思的， 两个方法出现冲突的免疫高低分类的样品应该是有它特殊的意义吧！</p><h3 data-tool="mdnice编辑器"><span></span>关于  step1-output.Rdata 这个文件<span></span></h3><p data-tool="mdnice编辑器">上面的代码载入 step1-output.Rdata 这个文件，下面给出来这个文件的制作方式，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())  <span>## 魔幻操作，一键清空~</span><br>options(stringsAsFactors = <span>F</span>)<br><br><span>library</span>(AnnoProbe)<br><span>library</span>(GEOquery) <br>gset &lt;- geoChina(<span>"GSE58812"</span>)<br>gset<br>gset[[<span>1</span>]]<br>a=gset[[<span>1</span>]] <span>#</span><br>dat=exprs(a) <span>#a现在是一个对象，取a这个对象通过看说明书知道要用exprs这个函数</span><br>dim(dat)<span>#看一下dat这个矩阵的维度</span><br><span>#   GPL570 [HG-U133_Plus_2] Affymetrix Human Genome U133 Plus 2.0 Array</span><br>dat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>] <span>#查看dat这个矩阵的1至4行和1至4列，逗号前为行，逗号后为列</span><br>boxplot(dat[,<span>1</span>:<span>4</span>],las=<span>2</span>)  <br>dat=log2(dat)<br>boxplot(dat[,<span>1</span>:<span>4</span>],las=<span>2</span>)  <br><span>library</span>(limma)<br>dat=normalizeBetweenArrays(dat)<br>boxplot(dat[,<span>1</span>:<span>4</span>],las=<span>2</span>)  <br>pd=pData(a) <br><span>#通过查看说明书知道取对象a里的临床信息用pData</span><br><span>## 挑选一些感兴趣的临床表型。</span><br><span>library</span>(stringr) <br>table(pd$`meta:ch1`)<br>group_list= ifelse(pd$`meta:ch1` == <span>'0'</span> ,<span>'stable'</span>,<span>'meta'</span>)<br>table(group_list)<br> <br>dat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]  <br>dim(dat)<br>a  <br>ids=idmap(<span>'GPL570'</span>,<span>'soft'</span>)<br>head(ids)<br>ids=ids[ids$symbol != <span>''</span>,]<br>dat=dat[rownames(dat) %<span>in</span>% ids$ID,]<br>ids=ids[match(rownames(dat),ids$ID),]<br>head(ids) <br>colnames(ids)=c(<span>'probe_id'</span>,<span>'symbol'</span>)  <br>ids$probe_id=as.character(ids$probe_id)<br>rownames(dat)=ids$probe_id<br>dat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>] <br><br>ids=ids[ids$probe_id %<span>in</span>%  rownames(dat),]<br>dat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]   <br>dat=dat[ids$probe_id,] <br><br>ids$median=apply(dat,<span>1</span>,median) <span>#ids新建median这一列，列名为median，同时对dat这个矩阵按行操作，取每一行的中位数，将结果给到median这一列的每一行</span><br>ids=ids[order(ids$symbol,ids$median,decreasing = <span>T</span>),]<span>#对ids$symbol按照ids$median中位数从大到小排列的顺序排序，将对应的行赋值为一个新的ids</span><br>ids=ids[!duplicated(ids$symbol),]<span>#将symbol这一列取取出重复项，'!'为否，即取出不重复的项，去除重复的gene ，保留每个基因最大表达量结果s</span><br>dat=dat[ids$probe_id,] <span>#新的ids取出probe_id这一列，将dat按照取出的这一列中的每一行组成一个新的dat</span><br>rownames(dat)=ids$symbol<span>#把ids的symbol这一列中的每一行给dat作为dat的行名</span><br>dat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]  <span>#保留每个基因ID第一次出现的信息</span><br><br>dat[<span>'ACTB'</span>,]<br>dat[<span>'GAPDH'</span>,]<br>save(dat,group_list,<br>     file = <span>'step1-output.Rdata'</span>)<br><br></code></pre><h3 data-tool="mdnice编辑器"><span></span>写在文末<span></span></h3><p data-tool="mdnice编辑器">我在《生信技能树》，《生信菜鸟团》，《单细胞天地》的大量推文教程里面共享的代码都是复制粘贴即可使用的， 有任何疑问欢迎留言讨论，也可以发邮件给我，详细描述你遇到的困难的前因后果给我，我的邮箱地址是 jmzeng1314@163.com</p><p data-tool="mdnice编辑器">如果你确实觉得我的教程对你的科研课题有帮助，让你茅塞顿开，或者说你的课题大量使用我的技能，烦请日后在发表自己的成果的时候，加上一个简短的致谢，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>We thank Dr.Jianming Zeng(University of Macau), and all the members of his bioinformatics team, biotrainee, <span>for</span> generously sharing their experience and codes.<br></code></pre><p data-tool="mdnice编辑器">十年后我环游世界各地的高校以及科研院所（当然包括中国大陆）的时候，如果有这样的情谊，我会优先见你。</p></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/ifgIN_7t_Y1pE-1WeFrFuA",target="_blank" rel="noopener noreferrer">原文链接</a>
