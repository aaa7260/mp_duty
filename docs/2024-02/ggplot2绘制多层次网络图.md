---
title: "ggplot2绘制多层次网络图"
date: 2024-02-23T07:43:14Z
draft: ["false"]
tags: [
  "fetched",
  "生信宝库"
]
categories: ["Acdemic"]
---
ggplot2绘制多层次网络图 by 生信宝库
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来如何通过R代码多层次网络图，在以往代码的基础上叠加部分内容。有此需求的朋友可以参考使用，整个过程仅参考。希望对各位观众老爷能有所帮助。<strong>「数据代码已经整合上传到会员交流群」</strong>，购买过小编VIP的朋友可在所加的会员群内获取数据下载链接，有需要的朋友可关注文末介绍加入VIP交流群。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关于永久群内容的说明</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>给予长期支持我们的忠实读者们一个特别待遇：凡是购买过小编2022年或2023年VIP会员文档的朋友们，将自动获得2024年及以后更新的绘图文档代码，无需额外付费。</p><span>❞</span></blockquote><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(janitor)<br><span>library</span>(tidygraph)<br><span>library</span>(ggraph)<br><span>library</span>(ggtext)<br><span>library</span>(readxl)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100025823" data-ratio="0.1537037037037037" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYjPecDHP6Gba2vWo5GntJiabugDTaTcJRZJ1Fq4nlAJGfic7IjMdysM5MrhIqT6ftUpdmSbBhwZrVA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYjPecDHP6Gba2vWo5GntJiabugDTaTcJRZJ1Fq4nlAJGfic7IjMdysM5MrhIqT6ftUpdmSbBhwZrVA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>sharks &lt;- read_excel(<span>"data.xlsx"</span>) %&gt;% <br>  clean_names() %&gt;% <br>  select(superorder = superorder_sharks_and_rays_subclass_chimaera,<br>         order, family, genus, species) %&gt;% <br>  mutate(species = paste(genus, species)) %&gt;% <br>  sample_frac(<span>0.1</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建边文件</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>origin_superorder_connections &lt;- <br>  tibble(from = <span>"origin"</span>,to = unique(sharks<span>$superorder</span>))<br><br>superorder_order_connections &lt;- <br>  sharks %&gt;% distinct(from = superorder, to = order)<br><br>order_family_connections &lt;- <br>  sharks %&gt;% distinct(from = order, to = family)<br><br>family_genus_connections &lt;- <br>  sharks %&gt;% distinct(from = family, to = genus)<br><br>genus_species_connections &lt;- <br>  sharks %&gt;% distinct(from = genus, to = species)<br><br>edges &lt;- bind_rows(<br>  superorder_order_connections,<br>  order_family_connections,<br>  family_genus_connections,<br>  genus_species_connections,<br>  origin_superorder_connections<br>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建点文件</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>nodes &lt;- distinct(edges, name = to, group = from) %&gt;% <br>  mutate(<br>    is_main = !str_detect(name, <span>"\\ "</span>),<br>    label = ifelse(is_main, name, NA)) %&gt;% <br>  add_row(name = <span>"origin"</span>, is_main = FALSE) %&gt;% <br>  arrange(group, name)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建文本角度</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>nodes$id &lt;- <span>NA</span><br>is_leaf &lt;- nodes$group != <span>"origin"</span> &amp; nodes$name != <span>"origin"</span><br>is_leaf &lt;- nodes$group != <span>"origin"</span> &amp; nodes$name != <span>"origin"</span><br>nleaves &lt;- nrow(nodes[is_leaf, ])<br>nodes$id[is_leaf] &lt;- seq_len(nleaves)<br>nodes$angle &lt;- <span>90</span> - <span>360</span> * nodes$id / nleaves<br><br>nodes$hjust &lt;- ifelse(nodes$angle &lt; -<span>90</span>, <span>1</span>, <span>0</span>)<br><br>nodes$angle &lt;- ifelse(nodes$angle &lt; -<span>90</span>, nodes$angle + <span>180</span>, nodes$angle)<br>nodes &lt;- nodes %&gt;% mutate(angle = replace_na(angle, <span>0</span>),<br>         hjust = replace_na(hjust, <span>0</span>))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>整合边点文件</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>graph &lt;- igraph::graph_from_data_frame(edges, vertices = nodes)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>绘制网络图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>ggraph(graph, layout = <span>"dendrogram"</span>, circular = <span>TRUE</span>) +<br>  geom_node_point(aes(fill = group,color=group),shape = <span>21</span>, stroke = <span>NA</span>,<br>    show.legend = <span>F</span>) +<br>  geom_edge_diagonal(color = <span>"#00A08A"</span>,edge_width = <span>0.1</span>)+<br>  geom_node_text(aes(label = label),check_overlap = <span>TRUE</span>,size = <span>3</span>,color = <span>"black"</span>) +<br>  guides(fill = <span>"none"</span>, size = <span>"none"</span>)+<br>  theme(plot.margin = margin(b=<span>3</span>,t=<span>3</span>,r=<span>3</span>,l=<span>3</span>),<br>        legend.position = <span>"none"</span>,<br>        plot.background =element_blank(),<br>        panel.background = element_blank())<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100025824" data-ratio="0.9972222222222222" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYjPecDHP6Gba2vWo5GntJiaUQ0tVEktFHjYYUPR2QHCicHs8DrmDZuJ4Pd4m7egltTic0tJQyFTHQSg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYjPecDHP6Gba2vWo5GntJiaUQ0tVEktFHjYYUPR2QHCicHs8DrmDZuJ4Pd4m7egltTic0tJQyFTHQSg/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节介绍到此结束，有需要学习数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>下单购买，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码。购买会员文档后微信发小编订单号即邀请进新的会员交流群</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺(有需要欢迎关注)</span><span></span></h3><p><img data-galleryid="" data-imgfileid="100019415" data-ratio="1.0210420841683367" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg" data-type="jpeg" data-w="998" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3></section><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/5ow_3-nxH53eGMLYOkajKA",target="_blank" rel="noopener noreferrer">原文链接</a>
