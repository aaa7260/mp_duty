---
title: "使用 R 语言的 `ggstream` 包来绘制流图（streamgraphs）的教程"
date: 2024-02-06T09:56:06Z
draft: ["false"]
tags: [
  "fetched",
  "生信七点半"
]
categories: ["Acdemic"]
---
使用 R 语言的 `ggstream` 包来绘制流图（streamgraphs）的教程 by 生信七点半
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>流图是一种数据可视化方法，常用于显示随时间变化的分类数据。</p></blockquote><h1 data-tool="mdnice编辑器"><span></span><span>1. 样本数据</span><span></span></h1><p data-tool="mdnice编辑器">使用了 <code>ggstream</code> 包中的 <code>blockbusters</code> 数据集，包含年份（<code>year</code>）、类型（<code>genre</code>）和票房收入（<code>box_office</code>）。</p><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("ggstream")</span><br>library(ggstream)<br><br>blockbusters<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100004551" data-ratio="0.6676783004552352" data-type="png" data-w="659" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlC31V0J5xYhmCtpQ8jzv37TJrJQSEIsXoN1HLDQZjnTtdAGdAwoKmnzA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlC31V0J5xYhmCtpQ8jzv37TJrJQSEIsXoN1HLDQZjnTtdAGdAwoKmnzA/640?wx_fmt=png&amp;from=appmsg"></figure><h1 data-tool="mdnice编辑器"><span></span><span>2. 创建流图</span><span></span></h1><ul data-tool="mdnice编辑器"><li><section>使用 <code>geom_stream</code> 函数创建基本的流图。</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("ggstream")</span><br>library(ggstream)<br><span># install.packages("ggplot2")</span><br>library(ggplot2)<br><br>ggplot(blockbusters, aes(x = year, y = box_office, fill = genre)) +<br>  geom_stream() <br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100004548" data-ratio="0.8" data-type="png" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCwSB09tib7DlUNJaTAwN0ib3gQjHR9GVkoPtRmL5fCsMtia3BSFyiaQmFrQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCwSB09tib7DlUNJaTAwN0ib3gQjHR9GVkoPtRmL5fCsMtia3BSFyiaQmFrQ/640?wx_fmt=png&amp;from=appmsg"></figure><ul data-tool="mdnice编辑器"><li><section>可以添加 <code>geom_stream_label</code> 函数来在流图的每个区域上添加标签。</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("ggstream")</span><br>library(ggstream)<br><span># install.packages("ggplot2")</span><br>library(ggplot2)<br><br>ggplot(blockbusters, aes(x = year, y = box_office, fill = genre)) +<br>  geom_stream() +<br>  geom_stream_label(aes(label = genre)) <br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100004550" data-ratio="0.8" data-type="png" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlC8kPibOkDI1OP2bSlCQlHC20d623ahWZUuA9X8YoubericLpbzsPOpwibA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlC8kPibOkDI1OP2bSlCQlHC20d623ahWZUuA9X8YoubericLpbzsPOpwibA/640?wx_fmt=png&amp;from=appmsg"></figure><h1 data-tool="mdnice编辑器"><span></span><span>3. 流图类型</span><span></span></h1><ul data-tool="mdnice编辑器"><li><section><p>默认情况下，<code>geom_stream</code> 使用“mirror”类型，将流线对称堆叠在 X 轴周围。</p></section></li><li><section><p>“ridge”类型从 X 轴开始堆叠流线。</p></section></li><li><section><p>“proportional”类型使流线加起来等于 1。</p></section></li></ul><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("ggstream")</span><br>library(ggstream)<br><span># install.packages("ggplot2")</span><br>library(ggplot2)<br><br>ggplot(blockbusters, aes(x = year, y = box_office, fill = genre)) +<br>geom_stream(<span>type</span> = <span>"ridge"</span>) <br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100004549" data-ratio="0.8" data-type="png" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCYst5kP3yoduibnmfeu3MSau1VbzUSV4riaL2bNc6GiaR2CbL5L6QCa8aw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCYst5kP3yoduibnmfeu3MSau1VbzUSV4riaL2bNc6GiaR2CbL5L6QCa8aw/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("ggstream")</span><br>library(ggstream)<br><span># install.packages("ggplot2")</span><br>library(ggplot2)<br><br>ggplot(blockbusters, aes(x = year, y = box_office, fill = genre)) +<br>  geom_stream(<span>type</span> = <span>"proportional"</span>) <br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100004552" data-ratio="0.8" data-type="png" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCL76VYicliaV35wTI8wgqQwWouUoQXjRHEiaiaRbwBIV976ibtvM0P5RaVCA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCL76VYicliaV35wTI8wgqQwWouUoQXjRHEiaiaRbwBIV976ibtvM0P5RaVCA/640?wx_fmt=png&amp;from=appmsg"></figure><h1 data-tool="mdnice编辑器"><span></span><span>4. 颜色自定义</span><span></span></h1><ul data-tool="mdnice编辑器"><li><section>可以通过 <code>scale_fill_manual</code> 函数或等效函数来改变流图的填充颜色。</section></li><li><section>默认情况下，区域没有边框，但可以通过 <code>geom_stream</code> 函数的 <code>color</code> 参数添加边框颜色，并用 <code>lwd</code> 修改宽度。</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("ggstream")</span><br>library(ggstream)<br><span># install.packages("ggplot2")</span><br>library(ggplot2)<br><br>cols &lt;- c(<span>"#FFB400"</span>, <span>"#FFC740"</span>, <span>"#C20008"</span>, <span>"#FF020D"</span>, <span>"#13AFEF"</span>)<br><br>ggplot(blockbusters, aes(x = year, y = box_office, fill = genre)) +<br>  geom_stream() +<br>  scale_fill_manual(values = cols) <br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100004557" data-ratio="0.8" data-type="png" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCnv4PiatUQV63hdpLGnTPOW7O6B4Zcyuv7Ctz7fE502ias2SrDczetZ3w/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCnv4PiatUQV63hdpLGnTPOW7O6B4Zcyuv7Ctz7fE502ias2SrDczetZ3w/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("ggstream")</span><br>library(ggstream)<br><span># install.packages("ggplot2")</span><br>library(ggplot2)<br><br>cols &lt;- c(<span>"#FFB400"</span>, <span>"#FFC740"</span>, <span>"#C20008"</span>, <span>"#FF020D"</span>, <span>"#13AFEF"</span>)<br><br>ggplot(blockbusters, aes(x = year, y = box_office, fill = genre)) +<br>  geom_stream(color = 1, lwd = 0.25) +<br>  scale_fill_manual(values = cols) <br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100004556" data-ratio="0.8" data-type="png" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCu939BGu8NK4ereXJiapWRibk8xReuvg25hibWdRtR0cMO5N5WBoQKuUPw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCu939BGu8NK4ereXJiapWRibk8xReuvg25hibWdRtR0cMO5N5WBoQKuUPw/640?wx_fmt=png&amp;from=appmsg"></figure><h1 data-tool="mdnice编辑器"><span></span><span>5. 主题更改</span><span></span></h1><ul data-tool="mdnice编辑器"><li><section>可以更改主题以修改图表的外观。</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("ggstream")</span><br>library(ggstream)<br><span># install.packages("ggplot2")</span><br>library(ggplot2)<br><br>cols &lt;- c(<span>"#FFB400"</span>, <span>"#FFC740"</span>, <span>"#C20008"</span>, <span>"#FF020D"</span>, <span>"#13AFEF"</span>)<br><br>ggplot(blockbusters, aes(x = year, y = box_office, fill = genre)) +<br>  geom_stream(color = 1, lwd = 0.25) +<br>  scale_fill_manual(values = cols) +<br>  theme_minimal() <br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100004554" data-ratio="0.8" data-type="png" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCqibQHKECIS4QHx6chZ4I1CTf1o8IDa1vqcoZEkib5mKuygkr57C6BYFQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCqibQHKECIS4QHx6chZ4I1CTf1o8IDa1vqcoZEkib5mKuygkr57C6BYFQ/640?wx_fmt=png&amp;from=appmsg"></figure><h1 data-tool="mdnice编辑器"><span></span><span>6. 高级参数</span><span></span></h1><ul data-tool="mdnice编辑器"><li><section>可以修改带宽（<code>bw</code>）和 X 轴的网格值（<code>n_grid</code>）。</section></li><li><section>使用额外范围（<code>extra_span</code>）进行估算，默认值为 0.01（1%）。</section></li><li><section>可以指定在可视化中使用数据的真实范围还是估算范围（<code>true_range</code>）。</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("ggstream")</span><br>library(ggstream)<br><span># install.packages("ggplot2")</span><br>library(ggplot2)<br><br>cols &lt;- c(<span>"#FFB400"</span>, <span>"#FFC740"</span>, <span>"#C20008"</span>, <span>"#FF020D"</span>, <span>"#13AFEF"</span>)<br><br>ggplot(blockbusters, aes(x = year, y = box_office, fill = genre)) +<br>  geom_stream(color = 1, lwd = 0.25,<br>              bw = 1) +<br>  scale_fill_manual(values = cols) +<br>  theme_minimal() <br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100004553" data-ratio="0.8" data-type="png" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCTRZteXrEZLwkdzPfLvicK4sqUkibczABaib7Lp1FQhEV3ZsiaGMraFEd6w/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCTRZteXrEZLwkdzPfLvicK4sqUkibczABaib7Lp1FQhEV3ZsiaGMraFEd6w/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("ggstream")</span><br>library(ggstream)<br><span># install.packages("ggplot2")</span><br>library(ggplot2)<br><br>cols &lt;- c(<span>"#FFB400"</span>, <span>"#FFC740"</span>, <span>"#C20008"</span>, <span>"#FF020D"</span>, <span>"#13AFEF"</span>)<br><br>ggplot(blockbusters, aes(x = year, y = box_office, fill = genre)) +<br>  geom_stream(color = 1, lwd = 0.25,<br>              n_grid = 100) +<br>  scale_fill_manual(values = cols) +<br>  theme_minimal() <br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100004555" data-ratio="0.8" data-type="png" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCImYRj8Ikp6ibC2sGoT2JmqZ8TDib5Lx4PK6YX0aAQP1PU0o700cbRYgw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCImYRj8Ikp6ibC2sGoT2JmqZ8TDib5Lx4PK6YX0aAQP1PU0o700cbRYgw/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("ggstream")</span><br>library(ggstream)<br><span># install.packages("ggplot2")</span><br>library(ggplot2)<br><br>cols &lt;- c(<span>"#FFB400"</span>, <span>"#FFC740"</span>, <span>"#C20008"</span>, <span>"#FF020D"</span>, <span>"#13AFEF"</span>)<br><br>ggplot(blockbusters, aes(x = year, y = box_office, fill = genre)) +<br>  geom_stream(extra_span = 0.2) +<br>  geom_stream(extra_span = 0.2, true_range = <span>"none"</span>,<br>              alpha = 0.3) +<br>  scale_fill_manual(values = cols) +<br>  theme_minimal() <br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100004559" data-ratio="0.8" data-type="png" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCQJYyeHrnquoLxzAZyIj7HKrMqC9C9fuk3RosiaENMM8khCBLPPyW2xQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCQJYyeHrnquoLxzAZyIj7HKrMqC9C9fuk3RosiaENMM8khCBLPPyW2xQ/640?wx_fmt=png&amp;from=appmsg"></figure><h1 data-tool="mdnice编辑器"><span></span><span>7. 图例自定义</span><span></span></h1><ul data-tool="mdnice编辑器"><li><section>可以更改图例的标题、关键标签，改变位置或移除图例。</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("ggstream")</span><br>library(ggstream)<br><span># install.packages("ggplot2")</span><br>library(ggplot2)<br><br>cols &lt;- c(<span>"#FFB400"</span>, <span>"#FFC740"</span>, <span>"#C20008"</span>, <span>"#FF020D"</span>, <span>"#13AFEF"</span>)<br><br>ggplot(blockbusters, aes(x = year, y = box_office, fill = genre)) +<br>  geom_stream(extra_span = 0.2) +<br>  geom_stream(extra_span = 0.2, true_range = <span>"none"</span>,<br>              alpha = 0.3) +<br>  scale_fill_manual(values = cols) +<br>  theme_minimal() +<br>  guides(fill = guide_legend(title = <span>"Title"</span>)) <br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100004561" data-ratio="0.8" data-type="png" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlChoV74gaOhlYZwrbuaLjc1EnXcGHZbaBxHJjQXOITWgj98LBrzsgbqQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlChoV74gaOhlYZwrbuaLjc1EnXcGHZbaBxHJjQXOITWgj98LBrzsgbqQ/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("ggstream")</span><br>library(ggstream)<br><span># install.packages("ggplot2")</span><br>library(ggplot2)<br><br>cols &lt;- c(<span>"#FFB400"</span>, <span>"#FFC740"</span>, <span>"#C20008"</span>, <span>"#FF020D"</span>, <span>"#13AFEF"</span>)<br><br>ggplot(blockbusters, aes(x = year, y = box_office, fill = genre)) +<br>  geom_stream(color = 1, lwd = 0.25) +<br>  scale_fill_manual(values = cols, labels = LETTERS[1:5]) +<br>  theme_minimal() <br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100004560" data-ratio="0.8" data-type="png" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlC8YlN40jHtkdJQhvQ22MMIdfIob45p5HnfunVoEC65fMicUc6r64rgjA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlC8YlN40jHtkdJQhvQ22MMIdfIob45p5HnfunVoEC65fMicUc6r64rgjA/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("ggstream")</span><br>library(ggstream)<br><span># install.packages("ggplot2")</span><br>library(ggplot2)<br><br>cols &lt;- c(<span>"#FFB400"</span>, <span>"#FFC740"</span>, <span>"#C20008"</span>, <span>"#FF020D"</span>, <span>"#13AFEF"</span>)<br><br>ggplot(blockbusters, aes(x = year, y = box_office, fill = genre)) +<br>  geom_stream(color = 1, lwd = 0.25) +<br>  scale_fill_manual(values = cols) +<br>  theme_minimal() +<br>  theme(legend.position = <span>"none"</span>) <br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100004563" data-ratio="1" data-type="png" data-w="768" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlC6sia5BL5ct8hO1HtbVxqr56E5tY4GHQibVu3ic6sY6F0cFZBTtGcN3EJQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlC6sia5BL5ct8hO1HtbVxqr56E5tY4GHQibVu3ic6sY6F0cFZBTtGcN3EJQ/640?wx_fmt=png&amp;from=appmsg"></figure></section><p><img data-galleryid="" data-imgfileid="100004582" data-ratio="0.40370370370370373" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCdxpeGmpU2zgm6ibhV9R0g4Fdic4mibdia7ZnibkJmaOp88N7K9AcXjeYLDg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9sib1bvtftdpTzxDCZGQ9SqlCdxpeGmpU2zgm6ibhV9R0g4Fdic4mibdia7ZnibkJmaOp88N7K9AcXjeYLDg/640?wx_fmt=png&amp;from=appmsg"></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/FXtpP6Lts-CT7FykeIfuyw",target="_blank" rel="noopener noreferrer">原文链接</a>
