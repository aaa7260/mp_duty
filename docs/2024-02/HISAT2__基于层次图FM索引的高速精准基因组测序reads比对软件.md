---
title: "HISAT2— 基于层次图FM索引的高速精准基因组测序reads比对软件"
date: 2024-02-28T04:13:44Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
HISAT2— 基于层次图FM索引的高速精准基因组测序reads比对软件 by 生信菜鸟团
------
<div><section data-md5="d93a6" act="xmy"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><p data-md5="d93a6"><strong data-md5="d93a6">工欲善其事必先利其器</strong></p></section></section></section></section></section></section></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span><span>1</span></span><span>HISAT2</span></h2><p data-tool="mdnice编辑器">HISAT2是一款是由Daehwan Kim、Christopher Bennett和Steven Salzberg（Johns Hopkins University）等人开发的高效的基因组比对软件，专为高通量测序数据设计，用于比对大规模RNA序列数据到参考基因组。HISAT2是HISAT的升级版，引入了几个关键技术，如使用分层索引（hierarchical indexing）和全局Ferragina-Manzini (FM)索引结合多个局部FM索引，这些技术使得HISAT2能够以极高的速度和较低的内存消耗完成大规模数据集的比对任务。其优势主要包括：</p><ol data-tool="mdnice编辑器"><li><section><strong>高效性</strong>：HISAT2能够在几小时内处理数百个样本的数据，相比其他比对工具如Bowtie2和BWA，它在处理时间和内存使用上更加高效。</section></li><li><section><strong>低内存消耗</strong>：由于其创新的索引策略，HISAT2在运行时的内存需求相对较低，这使得它能够在标准配置的计算机上运行大规模数据集。</section></li><li><section><strong>灵活性</strong>：支持多种测序平台和数据类型，包括单端和双端测序数据。</section></li><li><section><strong>强大的比对能力</strong>：HISAT2特别擅长处理基因组中的变异和间隙，如SNPs（单核苷酸多态性）和小型插入缺失（indels），从而能够提供更精确的比对结果。</section></li></ol><ul data-tool="mdnice编辑器"><li><section>官网：https://daehwankimlab.github.io/hisat2/</section></li><li><section>多平台：支持Linux和MacOS</section></li><li><section>编程语言：C++</section></li></ul><h2 data-tool="mdnice编辑器"><span><span>2</span></span><span>发表文章</span></h2><blockquote data-tool="mdnice编辑器"><p><strong>题目</strong>: Graph-based genome alignment and genotyping with HISAT2 and HISAT-genotype<br><strong>期刊</strong>：Nat Biotechnol<br><strong>日期</strong>：2019/8<br><strong>作者&amp;单位</strong>：Daehwan Kim &amp; University of Texas Southwestern Medical Center、Johns Hopkins University, Baltimore<br><strong>DOI</strong>：https://doi.org/10.1038/s41587-019-0201-4</p></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100036778" data-ratio="0.49074074074074076" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiclrrjnbUAMKpLRB4aicp79Pql5W1MHJw6IXxNaaA38fib0PvHdo2ArFzdu8134iaQrenBzAicoZN9yQQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiclrrjnbUAMKpLRB4aicp79Pql5W1MHJw6IXxNaaA38fib0PvHdo2ArFzdu8134iaQrenBzAicoZN9yQQ/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span><span>3</span></span><span>如何安装</span></h2><h3 data-tool="mdnice编辑器"><span></span><span>conda 安装</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>conda create -n RNAseq<br>conda activate RNAseq<br>conda install -y hisat2<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100036777" data-ratio="0.4305555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiclrrjnbUAMKpLRB4aicp79PWbrw3KFBvliaEYicXcRvPiaV2jrJUdbYrL6wkcEmutZF5H6ibyLtfcEmiaQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiclrrjnbUAMKpLRB4aicp79PWbrw3KFBvliaEYicXcRvPiaV2jrJUdbYrL6wkcEmutZF5H6ibyLtfcEmiaQ/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>二进制包安装</span><span></span></h3><p data-tool="mdnice编辑器">除了源码包，官网也提供了Linux和MacOS的二进制版，推荐采用预编译二进制安装，下载解压即可使用。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100036775" data-ratio="0.27037037037037037" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiclrrjnbUAMKpLRB4aicp79PRB0MzrkvTTVQ2nSIYl6rS75Dvaq3ImIw9IesMtYevkkYpVvdrYckNg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiclrrjnbUAMKpLRB4aicp79PRB0MzrkvTTVQ2nSIYl6rS75Dvaq3ImIw9IesMtYevkkYpVvdrYckNg/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>wget -c https://cloud.biohpc.swmed.edu/index.php/s/oTtGWbWjaxsQ2Ho/download<br><span>#</span><span>修改下载的文件名</span><br>mv download hisat2_2.21.zip<br><span>#</span><span> 解压</span><br>unzip hisat2_2.21.zip <br><span><br>#</span><span><span>#测试</span></span><br>cd hisat2-2.2.1/<br>./hisat2 -h<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100036779" data-ratio="0.32407407407407407" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiclrrjnbUAMKpLRB4aicp79PvJXKicAYcYGAiaVZibibbDZgOcvQ3LySozAGopKibbicJibVL9L2rCWdvb25A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiclrrjnbUAMKpLRB4aicp79PvJXKicAYcYGAiaVZibibbDZgOcvQ3LySozAGopKibbicJibVL9L2rCWdvb25A/640?wx_fmt=png&amp;from=appmsg"><figcaption>解压即可使用</figcaption></figure><h2 data-tool="mdnice编辑器"><span><span>4</span></span><span>最小化使用</span></h2><p data-tool="mdnice编辑器">比对软件通常分为两步</p><ul data-tool="mdnice编辑器"><li><section>构建参考基因组索引</section></li><li><section>比对</section></li></ul><p data-tool="mdnice编辑器">参考基因组文件下载见：<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247519561&amp;idx=1&amp;sn=4ccdc3c97f7aa1f7bfda81f7ad43f027&amp;scene=21#wechat_redirect" data-linktype="2">bowtie2 | 一种快速且节约内存的比对工具</a></p><h3 data-tool="mdnice编辑器"><span></span><span>构建索引</span><span></span></h3><p data-tool="mdnice编辑器">HISAT2可以为任意大小的参考基因组构建索引，这是进行高效比对的关键步骤。根据基因组的大小，HISAT2会构建不同类型的索引：</p><ol data-tool="mdnice编辑器"><li><section><strong>小索引（Small indexes）</strong>：当参考基因组的长度小于大约40亿核苷酸时，<code>hisat2-build</code>会构建一个所谓的“小索引”。在这种索引中，各个部分使用32位数字来表示。小索引的文件扩展名为<code>.ht2</code>。</section></li><li><section><strong>大索引（Large indexes）</strong>：对于长度超过40亿核苷酸的基因组，<code>hisat2-build</code>会构建一个“大索引”，在这种索引中使用64位数字。大索引的文件扩展名为<code>.ht2l</code>。</section></li></ol><p data-tool="mdnice编辑器">而这种大小索引的构建，无需用户指定，HISAT2会根据参考基因组的大小自动选择合适的索引类型进行构建和使用</p><pre data-tool="mdnice编辑器"><span></span><code>mkdir hisat2_indx<br>hisat2-build -p 6 ~/reference/human/CRCh38/GRCh38.p14.genome.fa  ./GRCh38_genome<br><br>-p #线程数<br>&lt;reference_in&gt; #指定参考基因组位置<br>&lt;ht2_index_base&gt; #指定输出文件位置及文件前缀名<br><span><br>#</span><span><span>#生成的索引文件</span></span><br>1000M 2月  19 18:33 GRCh38_genome.1.ht2<br> 747M 2月  19 18:33 GRCh38_genome.2.ht2<br>  18K 2月  19 18:13 GRCh38_genome.3.ht2<br> 747M 2月  19 18:13 GRCh38_genome.4.ht2<br> 1.3G 2月  19 18:36 GRCh38_genome.5.ht2<br> 760M 2月  19 18:36 GRCh38_genome.6.ht2<br>   12 2月  19 18:13 GRCh38_genome.7.ht2<br>    8 2月  19 18:13 GRCh38_genome.8.ht2<br><span>#</span><span><span># 6个线程耗时23:22 ,内存占用约7G</span></span><br></code></pre><p data-tool="mdnice编辑器">构建索引这一步除了自己构建索引，Hisat2还提供了人、小鼠、大鼠、果蝇等常见模式生物的已经构建好的索引，可以直接下载使用</p><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span>下载已经构建好的参考基因组索引文件</span><br>wget -c https://genome-idx.s3.amazonaws.com/hisat/grch38_genome.tar.gz<br><span><br>#</span><span><span>#提交后台下载</span></span><br>nohup  wget -c https://genome-idx.s3.amazonaws.com/hisat/grch38_genome.tar.gz 1&gt;hisat2_index_down.log 2&gt;&amp;1 &amp;<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>比对</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span><span># 单端比对</span></span><br>~/software/test/hisat2-2.2.1/hisat2  -p 2  \<br>-x ~/reference/human/hisat2_indx/GRCh38_genome \<br>-U ~/hisat_test/SRR7707754.fastq.gz \<br>-S ./test_single.sam<br><span><br>#</span><span><span># 双端比对</span></span><br>~/software/test/hisat2-2.2.1/hisat2  -p 2  \<br>-x ~/reference/human/hisat2_indx/GRCh38_genome \<br>-1 ~/hisat_test/sample_1.fastq.gz \<br>-2 ~/hisat_test/sample_2.fastq.gz \<br>-S ./test.sam<br><span><br>#</span><span><span>#运行耗时：22:58.47</span></span><br><span><br>#</span><span><span>#参数释义</span></span><br>-x &lt;hisat2-idx&gt; #参考基因组索引文件的前缀。<br>-1 &lt;m1&gt; #双端测序结果的第一个文件。若有多组数据，使用逗号将文件分隔。Reads的长度可以不一致。<br>-2 &lt;m2&gt; #双端测序结果的第二个文件。若有多组数据，使用逗号将文件分隔，并且文件顺序要和-1参数对应。Reads的长度可以不一致。<br>-U &lt;r&gt; #单端数据文件。若有多组数据，使用逗号将文件分隔。可以和-1、-2参数同时使用。Reads的长度可以不一致。<br>–sra-acc &lt;SRA accession number&gt;  #输入SRA登录号，比如SRR353653，SRR353654。多组数据之间使用逗号分隔。HISAT将自动下载并识别数据类型，进行比对。<br>-S &lt;hit&gt;  #指定输出为SAM文件,若不指定HISAT2默认会将比对结果输出到标准输出。<br></code></pre><p data-tool="mdnice编辑器">由于Sam文件太占服务器空间，通常会和samtools联用将输出结果转为bam文件</p><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span><span># 比对输出为bam文件</span></span><br>~/software/test/hisat2-2.2.1/hisat2  -p 2  \<br>-x ~/reference/human/hisat2_indx/GRCh38_genome \<br>-1 ~/hisat_test/sample_1.fastq.gz \<br>-2 ~/hisat_test/sample_2.fastq.gz | samtools sort -@ 2 -o ./test.sort.bam <br><span><br>#</span><span><span>#运行耗时24:18.18</span></span><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100036776" data-ratio="0.26150121065375304" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiclrrjnbUAMKpLRB4aicp79PekrvTObicdfR2OZ1aTbBqgYrQBhkQ1ul0xCZ7ZoS9CuWw9iaoRH2hveQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="826" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiclrrjnbUAMKpLRB4aicp79PekrvTObicdfR2OZ1aTbBqgYrQBhkQ1ul0xCZ7ZoS9CuWw9iaoRH2hveQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>输出文件大小对比</figcaption></figure><h2 data-tool="mdnice编辑器"><span><span>5</span></span><span>输出</span></h2><h3 data-tool="mdnice编辑器"><span></span><span>比对摘要</span><span></span></h3><p data-tool="mdnice编辑器"><strong>对于单端测序数据的比对</strong></p><pre data-tool="mdnice编辑器"><span></span><code>20000 reads; of these:  #总共处理了20000个读段<br>  20000 (100.00%) were unpaired; of these: #所有读段都是未配对的<br>    1247 (6.24%) aligned 0 times  #1247个读段没有任何比对<br>    18739 (93.69%) aligned exactly 1 time  #18739个读段精确地比对了一次<br>    14 (0.07%) aligned &gt;1 times #14个读段比对了多次<br>93.77% overall alignment rate #总体比对率为93.77%<br></code></pre><p data-tool="mdnice编辑器"><strong>对于双端测试数据的比对</strong></p><pre data-tool="mdnice编辑器"><span></span><code>10000 reads; of these: #总共处理了10000读段对（即20000个读段）<br>  10000 (100.00%) were paired; of these: #所有读段都是成对的<br>    650 (6.50%) aligned concordantly 0 times #650个读段对没有任何双端一致的比对【未必对上的】<br>    8823 (88.23%) aligned concordantly exactly 1 time #8823个读段对双端一致地精确比对了一次【精确比对一次的】<br>    527 (5.27%) aligned concordantly &gt;1 times #527个读段对双端一致地比对了多次 【多次比对的】<br>    ----<br>    650 pairs aligned concordantly 0 times; of these:<br>      34 (5.23%) aligned discordantly 1 time #650个读段对中，有34对虽然没有双端一致的比对，但是有1次单端的比对<br>    ----<br>    616 pairs aligned 0 times concordantly or discordantly; of these:<br>      1232 mates make up the pairs; of these:<br>        660 (53.57%) aligned 0 times<br>        571 (46.35%) aligned exactly 1 time<br>        1 (0.08%) aligned &gt;1 times #对于那些既没有双端一致比对也没有单端比对的616个读段对，它们共有1232个单独读段，其中660个没有任何比对，571个精确比对了一次，1个比对了多次<br>96.70% overall alignment rate #总体比对率为96.70%<br></code></pre><blockquote data-tool="mdnice编辑器"><p>更多用法参见：https://daehwankimlab.github.io/hisat2/manual/</p></blockquote></section><section><section act="xmy"><section data-id="123409" data-type="lspecial02,lspecial04" powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><br></section><section powered-by="xmyeditor.com" data-md5="8b46d"><img data-imgfileid="100036788" data-ratio="0.6940298507462687" data-src="https://mmbiz.qpic.cn/mmbiz_gif/iaRJcrq2LosibrvQnXTV3PMktpwwmDsjia2JG4e3ibpLQ1G6M4nktW4PiaiaKfnpiaRmNbTT6St7QLfzAMAomKgWxQ4kA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" data-type="gif" data-w="134" src="https://mmbiz.qpic.cn/mmbiz_gif/iaRJcrq2LosibrvQnXTV3PMktpwwmDsjia2JG4e3ibpLQ1G6M4nktW4PiaiaKfnpiaRmNbTT6St7QLfzAMAomKgWxQ4kA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section><section powered-by="xmyeditor.com" data-md5="8b46d"><br></section></section></section></section></section></section><p><span></span><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247520318&amp;idx=1&amp;sn=151736ce8e8575acfe6bd57beb55293b&amp;chksm=fa455503cd32dc15ece63fd830a069b79ce643f6ddafed0c27aa1ac70a871a4f6acb3bc70e81&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授课（买一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">生物信息学马拉松授课（买一得五 3月班）</a> ，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;chksm=9b4b2f10ac3ca606c1c4bac8cf112bb9b0f18e3c4262f5f2b8c0dba3bfedf2ba201507247005&amp;scene=21#wechat_redirect" textvalue="2024的共享服务器交个朋友福利价仍然是800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">2024的共享服务器交个朋友福利价仍然是800</a></section></li></ul></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/QqGLn2ZCarjthnbPCjiJTg",target="_blank" rel="noopener noreferrer">原文链接</a>
