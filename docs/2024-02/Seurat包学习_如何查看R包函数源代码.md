---
title: "Seurat包学习：如何查看R包函数源代码"
date: 2024-02-21T23:43:12Z
draft: ["false"]
tags: [
  "fetched",
  "生信小博士"
]
categories: ["Acdemic"]
---
Seurat包学习：如何查看R包函数源代码 by 生信小博士
------
<div><p><span><strong>我们很多时候都很好奇作者的r包是如何写出来的，手痒的时候就想学习一下源码，顺便改一改</strong></span></p><h3><span>问题来源</span></h3><p><strong><span>为什么要写今天这个推文呢？</span></strong></p><p><strong><span>起因是因为我想使</span></strong>用seurat自带函数画热图，奈何这个图不是那么好看</p><section><ul><li></ul><pre data-lang="objectivec"><code><span> DoHeatmap(pbmc,features = features,draw.lines = FALSE )</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002359" data-ratio="0.49537037037037035" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl0XGshnnrOss3BgibTODLickzNV786Q8l7wpQz5EnBME1GvoXcmId3iaiaEw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl0XGshnnrOss3BgibTODLickzNV786Q8l7wpQz5EnBME1GvoXcmId3iaiaEw/640?wx_fmt=png&amp;from=appmsg"></p><p data-pid="lYTZvdDG"><strong><span>于是，我想自己手动改一下这个热图</span></strong><br></p><section><ul><li><li></ul><pre data-lang="perl"><code><span>   p= DoHeatmap(pbmc,features = features  )    </span></code><code><span>   p$data  %&gt;%head()</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002361" data-ratio="0.3036144578313253" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl00oKRJQp7Y5FfPByPBnJ5InJpFNI6cU63qsVHv4UmEjGv4pDVeqgeibA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="415" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl00oKRJQp7Y5FfPByPBnJ5InJpFNI6cU63qsVHv4UmEjGv4pDVeqgeibA/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>提取p中的数据，这个时候我们就可以自己利用提取到的数据，去个性化的画图。这里可能用到长数据和宽数据转换的技巧</span></strong><strong><span>：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247485531&amp;idx=1&amp;sn=a3b8477a073a71f0d2d9151683fb2715&amp;chksm=ce6466b2f913efa4ef3f38cca4c36a8490b47faff699f2d06840a7fbb2295db3d871fa4f89ed&amp;scene=21#wechat_redirect" textvalue="ggplot2画图精髓——宽数据转为长数据" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">ggplot2画图精髓——宽数据转为长数据</a></span></strong></p><p><strong>或者你可以直接看我之前另外一种画单细胞热图的方法：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247485468&amp;idx=1&amp;sn=f1955d6d4b5bf01778564e970ce9ed6a&amp;chksm=ce6466f5f913efe3d92e8a8151a56ad27e9d1ac783e790f89bb16cf7f317c90da7a3dc15fba1&amp;scene=21#wechat_redirect" textvalue="20万单细胞的热图要这么画吗？" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">20万单细胞的热图要这么画吗？</a><br></strong></p><p><span><strong><span>但是</span></strong></span><span><strong><span>我发现环境栏中的p和通常的p好像不太一样（就是感觉</span></strong></span></p><p><img data-galleryid="" data-imgfileid="100002360" data-ratio="0.355" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl0IVsfTthse2ss623HWxh4H0gys3KVN72Ao2tyaslJ3NPX4QaPdl2KDQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="400" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl0IVsfTthse2ss623HWxh4H0gys3KVN72Ao2tyaslJ3NPX4QaPdl2KDQ/640?wx_fmt=png&amp;from=appmsg"></p><p><strong>为什么我有这个感觉呢，于是我自己画了一下热图</strong></p><p><img data-galleryid="" data-imgfileid="100002363" data-ratio="0.2106951871657754" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl0cX5wmnEox0SwKexRFThwxBYkqxmR59FicY6cia837wiab6cIfeIO5sI2Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="935" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl0cX5wmnEox0SwKexRFThwxBYkqxmR59FicY6cia837wiab6cIfeIO5sI2Q/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100002364" data-ratio="0.7045454545454546" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl0icJqhKU3a29R8mBBdwEZW3zh2zKQsYqG7IE24KU56tOpzfM1a3S8HwQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="660" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl0icJqhKU3a29R8mBBdwEZW3zh2zKQsYqG7IE24KU56tOpzfM1a3S8HwQ/640?wx_fmt=png&amp;from=appmsg"></p><p><strong>结果发现，我的p2和seurat的p在环境栏中确实不一样<br></strong></p><p><img data-croporisrc="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl0DUly7ibgZndr0h3iadXatORwMDEAwnemib83Gn0F1pcoC8neTiavvKTd6A/0?wx_fmt=png&amp;from=appmsg" data-cropx1="0" data-cropx2="650" data-cropy1="0" data-cropy2="647.750865051903" data-galleryid="" data-imgfileid="100002365" data-ratio="0.9953846153846154" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345Skuezibr4yibrLLAF81IZ92gl0rPoLV9ezKXGA9uy1cZnS4eyPhvXBIzy8gyrdrexicItSTtxmxxL72hA/640?wx_fmt=jpeg" data-type="jpeg" data-w="650" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/xVhD7345Skuezibr4yibrLLAF81IZ92gl0rPoLV9ezKXGA9uy1cZnS4eyPhvXBIzy8gyrdrexicItSTtxmxxL72hA/640?wx_fmt=jpeg"></p><p><strong></strong></p><p><strong>于是就有了今天的故事，我就很想知道这究竟是什么原因，顺便学习一下</strong></p><h3><span>查找DoHeatmap源代码</span></h3><ul><li><p data-pid="lYTZvdDG"><strong>查找源码，方法如下</strong>：</p></li></ul><blockquote data-type="2" data-url="" data-author-name="" data-content-utf8-length="113" data-source-title=""><section><section><p data-pid="lYTZvdDG">源码在github上：https://github.com/satijalab/seurat/tree/release/5.0.2<br></p><p><span>依次单击 master - Tags - v5.0.2，下载zip并解压到本地</span></p><p><span>可以看到它的主要文件夹如下</span></p></section></section></blockquote><p><img data-galleryid="" data-imgfileid="100002350" data-ratio="1.2803468208092486" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl0IWjJlp3oYr4cW3NE213cH74IzBF5B3ia6xujWibNq5HzeNPJuaR7dzAA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="346" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl0IWjJlp3oYr4cW3NE213cH74IzBF5B3ia6xujWibNq5HzeNPJuaR7dzAA/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100002349" data-ratio="0.9339263024142312" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl0H6sIXdCdXcCQhaQxTQEf7xhNwibibbIDQP1g0D7iceuZOP0j7Xdh01HsA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="787" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl0H6sIXdCdXcCQhaQxTQEf7xhNwibibbIDQP1g0D7iceuZOP0j7Xdh01HsA/640?wx_fmt=png&amp;from=appmsg"><br></p><ul><li><p><strong>通过正则表达式来查询感兴趣的函数</strong><br></p></li></ul><section><ul><li></ul><pre data-lang="cpp"><code><span>find . | grep "R$" | xargs grep -n "DoHeatmap" --color=auto</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002351" data-ratio="0.20185185185185187" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl0BS9URGWn9emnA4icA0tCo2X6XHxGNVxC9PF7YDqPf1dTp8Ps8d6Pic9Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skuezibr4yibrLLAF81IZ92gl0BS9URGWn9emnA4icA0tCo2X6XHxGNVxC9PF7YDqPf1dTp8Ps8d6Pic9Q/640?wx_fmt=png&amp;from=appmsg"></p><p><strong>发现， DoHeatmap函数在visualization.R 和mixscape.R都出现了，感觉是visualization.R定义了DoHeatmap函数</strong><span>。</span></p><p><span><br></span></p><ul><li><p><strong>我们接下来使用r，打开两个文件看一下看一下</strong></p></li></ul><section><ul><li><li><li><li></ul><pre data-lang="sql"><code><span>file.edit('~/gzh/seurat_codes_learning/seurat-release-5.0.2/R/mixscape.R')</span></code><code><span><br></span></code><code><span>file.edit('~/gzh/seurat_codes_learning/seurat-release-5.0.2/R/visualization.R')</span></code><code><span><br></span></code></pre></section><p><br></p><p><strong>最后就顺利找到了</strong><strong>源代码，可以看到DoHeatmap的画图功能其实来自于另外一个函数SingleRasterMap，同时作者还是用其他几个自定义的函数，最终达成了DoHeatmap的画图功能。</strong></p><h3><span>那为什么两个p不一样呢</span></h3><p><strong>主要还是因为两个数据格式不一样嘛，一个是seurat产生的对象，另外一个是pheatmap产生的对象。如果感兴趣，可以去看看pheatmap的源码是什么，然后比较一下。在此不表。<br></strong></p><p><strong>最后，附源代码于下一篇推文，供参考</strong></p><p><img data-imgfileid="100002369" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" data-type="gif" data-w="240" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"><br></p><p><img data-imgfileid="100002368" data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="other" data-w="341" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p><p><span><strong></strong></span></p><blockquote data-type="2" data-url="" data-author-name="" data-content-utf8-length="101" data-source-title=""><section><section><p><span>参考：</span></p><p><span>https://blog.csdn.net/qq_52813185/article/details/122003446</span></p><p><span>https://zhuanlan.zhihu.com/p/463532779</span><strong></strong></p></section></section></blockquote><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/6CHG8UievgjpJIqbZOBFEg",target="_blank" rel="noopener noreferrer">原文链接</a>
