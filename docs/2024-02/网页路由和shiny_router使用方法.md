---
title: "网页路由和shiny.router使用方法"
date: 2024-02-20T11:26:05Z
draft: ["false"]
tags: [
  "fetched",
  "优雅R"
]
categories: ["Acdemic"]
---
网页路由和shiny.router使用方法 by 优雅R
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h1 data-tool="mdnice编辑器"><span></span><span>什么是路由？</span><span></span></h1><p data-tool="mdnice编辑器">路由描述的是 URL 与 UI 之间的映射关系，这种映射是单向的，即 URL 变化引起 UI 更新（无需刷新页面）。</p><h2 data-tool="mdnice编辑器"><span></span><span>route 和router区别</span><span></span></h2><ul data-tool="mdnice编辑器"><li><section>route就是一条路由，它将一个URL路径和一个函数进行映射，例如 <code>/users  -&gt;  getAllUsers()</code> <code>/users/count  -&gt;  getUsersCount()</code>，当访问 <code>/users</code> 的时候，会执行 <code>getAllUsers()</code> 函数；当访问 <code>/users/count</code> 的时候，会执行 <code>getUsersCount()</code> 函数。</section></li><li><section>router 可以理解为一个容器，或者说一种机制，它管理了一组 route。简单来说，route 只是进行了URL和函数的映射。而在当接收到一个URL之后，去路由映射表中查找相应的函数，这个过程是由 router 来处理的。</section></li></ul><h2 data-tool="mdnice编辑器"><span></span><span>服务器端路由</span><span></span></h2><ul data-tool="mdnice编辑器"><li><section>对于服务器来说，当接收到客户端发来的HTTP请求，会根据请求的URL，来找到相应的映射函数，然后执行该函数，并将函数的返回值发送给客户端。</section></li><li><section>对于最简单的静态资源服务器，可以认为，所有URL的映射函数就是一个文件读取操作。对于动态资源，映射函数可能是一个数据库读取操作，也可能是进行一些数据的处理。</section></li><li><section><code>route("/", shiny::tags$div(shiny::tags$span("Hello world")))</code>和<code>route("main", shiny::tags$div(h1("Main page"), p("Lorem ipsum.")))</code>这里定义了两条路由：当访问 <code>/</code> 的时候，会返回一个包含 <code>"Hello world"</code> 文本，当访问<code>main</code>时，返回一个包含一个主标题和一个段落的 <code>&lt;div&gt;</code> 元素。</section></li></ul><h1 data-tool="mdnice编辑器"><span></span><span>实现shiny的路由包shiny.router</span><span></span></h1><h2 data-tool="mdnice编辑器"><span></span><span>下载和安装</span><span></span></h2><pre data-tool="mdnice编辑器"><span></span><code>install.packages(<span>"shiny.router"</span>)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>常用函数</span><span></span></h2><h3 data-tool="mdnice编辑器"><span></span><span>（1）change_page</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section><p>说明：向客户端reactive input binding发送一条消息，告诉page.js相应地更新窗口URL，然后告诉客户端shiny的reactive input binding已经更改，router会收到这个变化的通知，<code>get_page()</code>等相似函数也会收到该通知。在链接中添加 <code>"/#!/"</code> 前缀</p></section></li><li><section><p>用法：</p></section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>change_page(page, session = shiny::getDefaultReactiveDomain(), mode = <span>"push"</span>)<br><span># mode ("replace" or "push")</span><br><span># session指shiny的用户参数</span><br></code></pre><ul data-tool="mdnice编辑器"><li><section>示例：</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>observeEvent(input$go_to_table, {<br>      change_page(<span>"table"</span>)<br>    })<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（2）disable_bootstrap_on_bookmark</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section><p>说明：当用户打开指定的书签时，此函数会动态删除引导依赖项。它应该插入到引导页面的头部。</p></section></li><li><section><p>用法：</p></section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>disable_bootstrap_on_bookmark(bookmark)<br><span># 在书签上抑制 Bootstrap 依赖项。</span><br></code></pre><ul data-tool="mdnice编辑器"><li><section>示例：</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>observe({<br>disable_bootstrap_on_bookmark(<span>"home_page"</span>)<br>})<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（3）get_page</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section><p>说明：该函数提取的是哈希后面的虚拟路径（virtual path）部分。如果输入没有值，即当前页面信息不可用，函数将返回 FALSE。</p></section></li><li><section><p>用法：</p></section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>get_page(session = shiny::getDefaultReactiveDomain())<br></code></pre><ul data-tool="mdnice编辑器"><li><section>示例：</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code> observe({<br>        get_page(session)<br>        })<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（4）get_query_param</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section><p>说明：检索作为请求页面一部分的任何参数的便利函数。返回的参数值来自<span>http::parse_url()</span><sup>[1]</sup>也正由于这个原因，只有在url变化后，该函数才能查询在url上变化的参数</p></section></li><li><section><p>用法：</p></section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>get_query_param(field = <span>NULL</span>, session = shiny::getDefaultReactiveDomain())<br><span># field | If provided, retrieve only a param with this name. (Otherwise, return all params)</span><br><span># session | The Shiny session</span><br></code></pre><ul data-tool="mdnice编辑器"><li><section>示例：</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>observe({<br>page_size &lt;- get_query_param(<span>"pageSize"</span>)<br>})<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（5）is_page</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section><p>说明：如果我们不在指定的页面上，告诉反应链停止。这会帮助我们确保不会浪费时间为当前未显示的页面重新渲染UI。</p></section></li><li><section><p>用法：</p></section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>is_page(page, session = shiny::getDefaultReactiveDomain(), <span>...</span>)<br><span># page 参数： 检查当前页面是否为该页面</span><br></code></pre><ul data-tool="mdnice编辑器"><li><section>示例：</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>observe({<br>      <span>if</span>(is_page(<span>"cohort"</span>)){<br>         age_1 &lt;- get_query_param(<span>"Age"</span>)<br>      }<br><br>      })<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（6）route_link</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section><p>说明：链接中添加 "/#!/" 前缀</p></section></li><li><section><p>用法：</p></section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>route_link(path)<br></code></pre><ul data-tool="mdnice编辑器"><li><section>示例：</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>menu &lt;- tags$ul(<br>    tags$li(a(class = <span>"item"</span>, href = route_link(<span>"/"</span>), <span>"Main"</span>)),<br>    tags$li(a(class = <span>"item"</span>, href = route_link(<span>"another"</span>), <span>"Another page"</span>)),<br>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（7）router_ui</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section><p>说明：创建shiny的ui</p></section></li><li><section><p>用法：</p></section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>router_ui(default, <span>...</span>, page_404 = page404(), env = parent.frame())<br></code></pre><ul data-tool="mdnice编辑器"><li><section>示例：</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code> router_ui(<br>      route(<span>"table"</span>, table$ui(ns(<span>"table"</span>))),<br>      route(<span>"chart"</span>, chart$ui(ns(<span>"chart"</span>))),<br>      route(<span>"chart"</span>, chart$ui(ns(<span>"chart"</span>)))，<br>      page_404 = page_404$ui(ns(<span>"page_404"</span>))<br>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（8）router_server</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section><p>说明：设置shiny的主页面的server和环境</p></section></li><li><section><p>用法：</p></section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>router_server(root_page = <span>"/"</span>, env = parent.frame())<br></code></pre><ul data-tool="mdnice编辑器"><li><section>示例：</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code> router_server(<span>"Home"</span>) <span># 主页面</span><br>    Home$server(<span>"Home"</span>)<br>    cohort$server(<span>"cohort"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（9）route</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section><p>说明：创建单独路由</p></section></li><li><section><p>用法：</p></section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>route(path, ui, server = <span>NA</span>)<br></code></pre><ul data-tool="mdnice编辑器"><li><section>示例：</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code> route(<span>"Home"</span>, Home$ui(ns(<span>"Home"</span>)))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（10）parse_url_path</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section><p>说明：提取有关URL路径和跟在问号（?）符号后面的参数的信息。</p></section></li><li><section><p>用法：</p></section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>parse_url_path(url_path)<br><span># 查询的出现在#!的参数可能会导致浏览器刷新</span><br><span># 返回结果是一个列表，其中包含两个元素：path 和 query。</span><br></code></pre><ul data-tool="mdnice编辑器"><li><section>示例：</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>parse_url_path(<span>"?a=1&amp;b=foo"</span>)<br><span># $path：这里是一个空字符串，因为在输入的 URL 中没有指定路径部分</span><br>$path<br>[<span>1</span>] <span>""</span><br><span># $query：是一个包含参数的列表。在这个例子中，有两个参数：a 和 b。</span><br>$query<br>$query$a<br>[<span>1</span>] <span>"1"</span><br>$query$b<br>[<span>1</span>] <span>"foo"</span><br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>parse_url_path(<span>"?a=1&amp;b[1]=foo&amp;b[2]=bar/#!/"</span>)<br>$path<br>[<span>1</span>] <span>""</span><br><br>$query<br>$query$a<br>[<span>1</span>] <span>"1"</span><br><br>$query$b<br>$query$b$`1`<br>[<span>1</span>] <span>"foo"</span><br><br>$query$b$`2`<br>[<span>1</span>] <span>"bar"</span><br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>parse_url_path(<span>"?a=1&amp;b[1]=foo&amp;b[2]=bar/#!/other_page"</span>)<br>$path<br>[<span>1</span>] <span>"other_page"</span><br><br>$query<br>$query$a<br>[<span>1</span>] <span>"1"</span><br><br>$query$b<br>$query$b$`1`<br>[<span>1</span>] <span>"foo"</span><br><br>$query$b$`2`<br>[<span>1</span>] <span>"bar"</span><br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>parse_url_path(<span>"www.foo.bar/#!/other_page"</span>)<br>$path<br>[<span>1</span>] <span>"other_page"</span><br><br>$query<br><span>NULL</span><br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>parse_url_path(<span>"www.foo.bar?a=1&amp;b[1]=foo&amp;b[2]=bar/#!/other"</span>)<br>$path<br>[<span>1</span>] <span>"other"</span><br><br>$query<br>$query$a<br>[<span>1</span>] <span>"1"</span><br><br>$query$b<br>$query$b$`1`<br>[<span>1</span>] <span>"foo"</span><br><br>$query$b$`2`<br>[<span>1</span>] <span>"bar"</span><br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>parse_url_path(<span>"#!/?a=1&amp;b[1]=foo&amp;b[2]=bar"</span>)<br>$path<br>[<span>1</span>] <span>""</span><br><br>$query<br>$query$a<br>[<span>1</span>] <span>"1"</span><br><br>$query$b<br>$query$b$`1`<br>[<span>1</span>] <span>"foo"</span><br><br>$query$b$`2`<br>[<span>1</span>] <span>"bar"</span><br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>parse_url_path(<span>"www.foo.bar/#!/other?a=1&amp;b[1]=foo&amp;b[2]=bar"</span>)<br>$path<br>[<span>1</span>] <span>"other"</span><br><br>$query<br>$query$a<br>[<span>1</span>] <span>"1"</span><br><br>$query$b<br>$query$b$`1`<br>[<span>1</span>] <span>"foo"</span><br><br>$query$b$`2`<br>[<span>1</span>] <span>"bar"</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（11）PAGE_404_ROUTE</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section><p>说明：默认的404页面</p></section></li><li><section><p>用法：</p></section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>PAGE_404_ROUTE<br></code></pre><ul data-tool="mdnice编辑器"><li><section>示例：</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code><span># app/main.R</span><br>box::use(<br>  shiny[a, fluidPage, moduleServer, tags, NS],<br>  shiny.router[router_ui, router_server, route, route_link, PAGE_404_ROUTE ],<br>)<br><br>router_ui(<br>      route(<span>"/"</span>, intro$ui(ns(<span>"intro"</span>))),<br>      route(<span>"table"</span>, table$ui(ns(<span>"table"</span>))),<br>      route(<span>"chart"</span>, chart$ui(ns(<span>"chart"</span>))),<br>      page_404 = PAGE_404_ROUTE<br>    )<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（12）page404</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section><p>说明：router_ui里的404页面</p></section></li><li><section><p>用法：</p></section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>page404(page = <span>NULL</span>, message404 = <span>NULL</span>)<br></code></pre><ul data-tool="mdnice编辑器"><li><section>示例：</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>router_ui(<br>      route(<span>"table"</span>, table$ui(ns(<span>"table"</span>))),<br>      route(<span>"chart"</span>, chart$ui(ns(<span>"chart"</span>))),<br>      page_404 = page_404$ui(ns(<span>"page_404"</span>))<br>)<br><br><span># app/view/page_404.R</span><br><br>box::use(<br>  shiny[a, div, h1, moduleServer, NS],<br>  shiny.router[route_link],<br>)<br><br><span>#' @export</span><br>ui &lt;- <span>function</span>(id) {<br>  ns &lt;- NS(id)<br><br>  div(<br>    h1(<span>"Whoops! Something went wrong!"</span>),<br>    a(<span>"Back to home page"</span>, href = route_link(<span>"/"</span>), class = <span>"btn btn-primary btn-lg"</span>)<br>  )<br>}<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>实例</span><span></span></h2><h3 data-tool="mdnice编辑器"><span></span><span>（1）创建初始应用程序</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>install.packages(<span>"rhino"</span>)<br>rhino::init(<span>"show"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（2）安装并添加依赖项</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>rhino::pkg_install(c(<span>"shiny.router"</span>,<span>"shiny"</span>,<span>"UCSCXenaTools"</span>,<span>"shinyjs"</span>,<span>"data.table"</span>)) <br><span>#rhino::pkg_remove()删除包与依赖</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（3）填充内容</span><span></span></h3><h4 data-tool="mdnice编辑器"><span></span><span>从UCSCXena下载Lung Cancer (Raponi 2006)的phenotype数据集，处理后转换为RData文件，保存于<code>app/logic/Lung Cancer.RData</code></span><span></span></h4><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100010653" data-ratio="0.5222222222222223" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mPqFmhtlSJztqDnOkjf6EQIqB0s9pqrvhciaiaR7dxmedUFAySE5jxyCKofHeLricNHffkAaQHkicBicS2NmkjSRxfA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mPqFmhtlSJztqDnOkjf6EQIqB0s9pqrvhciaiaR7dxmedUFAySE5jxyCKofHeLricNHffkAaQHkicBicS2NmkjSRxfA/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code><span># app/logic/aml</span><br><span># 加载数据文件</span><br><br>a2 &lt;- <span>function</span>() {<br>  name_data &lt;- paste0(getwd(),<span>"/app/logic/Lung Cancer.RData"</span>)<br>  load(name_data)<br>  loaded_data &lt;- get(<span>"public_clinical"</span>)  <span># 请替换为实际的变量名</span><br>  <span>return</span>(loaded_data)<br>}<br></code></pre><h4 data-tool="mdnice编辑器"><span></span><span>创建首页</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span># app/view/home.R</span><br><br>box::use(<br>  shiny[moduleServer, NS,tags,icon,tabPanel,br,column,div, tagList,wellPanel,fluidRow,h2,strong,h5],<br>  shiny.router[route_link,change_page],<br>)<br><br><br><span>#' @export</span><br>ui &lt;- <span>function</span>(id) {<br>   ns &lt;- NS(id)<br>   tabPanel(<span>"Home1"</span>, icon = icon(<span>"house"</span>),<br>           column(<span>2</span>),<br>           column(<span>8</span>, tags$h2(<br>             strong(<span>"Welcome to the Show!"</span>, style = <span>"font-size: 1.5em;"</span>)<br>           )),<br>           column(<span>2</span>),<br>           br(),<br>           fluidRow(<br>             br(),<br>             br(),<br>             br(),<br>             column(<span>2</span>),<br>             column(<span>6</span>, tagList(<br>                    wellPanel(h5(<span>"Guide"</span>,<br>                                    style = <span>"font-size: 1.2em;"</span>),<br>                                    align = <span>"left"</span>),<br>                    wellPanel(h5(<span>"RECENT CONTENTS"</span>,<br>                                 style = <span>"font-size: 1.2em;"</span>),<br>                                 align = <span>"left"</span>),<br>                    wellPanel(h5(<span>"Citation"</span>,<br>                          style = <span>"font-size: 1.2em;"</span>), align = <span>"left"</span>))))),            <br>}<br><span>#' @export</span><br>server &lt;- <span>function</span>(id) {<br>  moduleServer(id, <span>function</span>(input, output, session) {<br>    ns &lt;- session$ns<br>  })}<br><br></code></pre><h4 data-tool="mdnice编辑器"><span></span><span>cohort页面，使用a2函数读取数据</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span># app/view/cohort.R</span><br><br><span># app/view/cohort.R</span><br>box::use(<br>  shiny[moduleServer, NS, fluidRow,column, tags, observeEvent,actionButton, observe,tagList,h3, wellPanel, br, selectInput, h5, p, reactive],<br>  shiny.router[route_link, get_query_param, parse_url_path,change_page,router_server,get_page,is_page],<br>)<br>box::use(<br>  app/logic/aml1[a2]<br>)<br><br><span>#' @export</span><br>ui &lt;- <span>function</span>(id) {<br>  ns &lt;- NS(id)<br>  public_clinical &lt;- a2()<br>  fluidRow(<br>    column(<span>3</span>,<br>           wellPanel(<br>             h5(<span>"Analysis Controls"</span>),<br>             br(),<br>             p(<span>"Select dataset:"</span>),<br>             p(<span>"Analysis Type"</span>),<br>             selectInput(<br>               ns(<span>"analysis_type1"</span>),<br>               selected = <span>"IIb"</span>,<br>               label = <span>NULL</span>,<br>               choices = public_clinical$Age<br>             ),<br>             selectInput(<br>               ns(<span>"analysis_type2"</span>),<br>               label = <span>NULL</span>,<br>               choices = public_clinical$OS.time<br>             ),<br>             actionButton(inputId = ns(<span>"caretdown7"</span>), label = <span>"Change query path"</span>),<br>           )<br>    ))<br>}<br><br><span>#' @export</span><br>server &lt;- <span>function</span>(id) {<br>  moduleServer(id, <span>function</span>(input, output, session) {<br>    ns &lt;- session$ns<br>      })}<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（4）添加404页</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># app/view/page_404.R</span><br><br>box::use(<br>  shiny[a, div, h1, moduleServer, NS],<br>  shiny.router[route_link],<br>)<br><br><span>#' @export</span><br>ui &lt;- <span>function</span>(id) {<br>  ns &lt;- NS(id)<br>  <br>  div(<br>    h1(<span>"Whoops! Something went wrong!"</span>),<br>    a(<span>"Back to home page"</span>, href = route_link(<span>"/"</span>), class = <span>"btn btn-primary btn-lg"</span>)<br>  )<br>}<br><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（5）将 UI 模块包装</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># app/main.R</span><br><br>box::use(<br>  shiny[moduleServer, tagList, sidebarLayout, NS, tabPanel,bootstrapPage,tags,HTML,icon,mainPanel, sidebarPanel,fluidPage],<br>  shiny.router[route_link, router_ui,route,router_server]<br>)<br><br>box::use(<br>  app/view/Home,<br>  app/view/page_404,<br>  app/view/cohort<br>)<br><br><span>#' @export</span><br>ui &lt;- <span>function</span>(id) {<br>  ns &lt;- NS(id)<br>  fluidPage(<br>    sidebarLayout(<br>      sidebarPanel(<br>        tags$nav(<br>          class = <span>"navbar"</span>,<br>    tags$ul(<br>      class = <span>"nav navbar-nav"</span>,<br>    tags$a(href = route_link(<span>"/"</span>), HTML(paste0(icon(<span>"home"</span>), <span>"Home"</span>))),<br>    tags$a(href = route_link(<span>"cohort"</span>), HTML(paste0(icon(<span>"people-group"</span>), <span>"cohort"</span>)))<br>    )),<br>    ),<br>    mainPanel(<br>      width = <span>7.5</span>,<br>      router_ui(<br>        route(<span>"Home"</span>, Home$ui(ns(<span>"Home"</span>))),<br>        route(<span>"cohort"</span>, cohort$ui(ns(<span>"cohort"</span>)))<br>      ),<br>      )<br>    ))<br>}<br><br><span>#' @export</span><br>server &lt;- <span>function</span>(id) {<br>  moduleServer(id, <span>function</span>(input, output, session) {<br>    router_server(<span>"Home"</span>) <span># 主页面</span><br>    Home$server(<span>"Home"</span>)<br>    cohort$server(<span>"cohort"</span>)<br>  })<br>}<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（6）添加按钮跳转导航</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># app/view/Home.R</span><br><br>box::use(<br>  shiny[moduleServer, NS,tags,icon,tabPanel,br,column,div,tagList,observeEvent,actionButton,wellPanel,fluidRow,h2,strong,h5,selectInput],<br>  shiny.router[route_link,change_page],<br>)<br><br><br><span>#' @export</span><br>ui &lt;- <span>function</span>(id) {<br>   ns &lt;- NS(id)<br>   tabPanel(<span>"Home1"</span>, icon = icon(<span>"house"</span>),<br>           column(<span>2</span>),<br>           column(<span>8</span>, tags$h2(<br>             strong(<span>"Welcome to the Show!"</span>, style = <span>"font-size: 1.5em;"</span>)<br>           )),<br>           column(<span>2</span>),<br>           br(),<br>           fluidRow(<br>             br(),<br>             br(),<br>             br(),<br>             column(<span>2</span>),<br>             column(<span>6</span>, tagList(<br>                    wellPanel(h5(<span>"Guide"</span>,<br>                                    style = <span>"font-size: 1.2em;"</span>),<br>                                    align = <span>"left"</span>),<br>                    wellPanel(h5(<span>"RECENT CONTENTS"</span>,<br>                                 style = <span>"font-size: 1.2em;"</span>),<br>                                 align = <span>"left"</span>),<br>                    wellPanel(h5(<span>"Citation"</span>,<br>                          style = <span>"font-size: 1.2em;"</span>), align = <span>"left"</span>)))),<br><br>             fluidRow(<br>             div(<br>                 class = <span>"jumbotron"</span>,<br>                 h2(<span>"Click this button to check out the table:"</span>),<br>                 actionButton(<br>                   inputId = ns(<span>"go_to_table"</span>),<br>                   label = <span>"cohort"</span>,<br>                   class = <span>"btn-primary btn-lg"</span><br>               )<br>               )<br>               ))<br>}<br><span>#' @export</span><br>server &lt;- <span>function</span>(id) {<br>  moduleServer(id, <span>function</span>(input, output, session) {<br>    ns &lt;- session$ns<br>    observeEvent(input$go_to_table, {<br>      change_page(<span>"cohort"</span>)<br>    })<br>  })}<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>（7）读取并显示参数</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># app/view/cohort.R</span><br>box::use(<br>  shiny[moduleServer, NS, fluidRow, textOutput,column, renderText,tags, observeEvent,actionButton, observe,tagList,h3, wellPanel, br, selectInput, h5, p, reactive, updateSelectInput],<br>  shiny.router[route_link, get_query_param, parse_url_path,change_page,router_server,get_page,is_page],<br>)<br>box::use(<br>  app/logic/aml1[a2]<br>)<br><br><br><span>#' @export</span><br>ui &lt;- <span>function</span>(id) {<br>  ns &lt;- NS(id)<br>  public_clinical &lt;- a2()<br>  fluidRow(<br>    column(<span>3</span>,<br>           wellPanel(<br>             h5(<span>"Analysis Controls"</span>),<br>             br(),<br>             p(<span>"Select dataset:"</span>),<br>             p(<span>"Analysis Type"</span>),<br>             selectInput(<br>               ns(<span>"analysis_type1"</span>),<br>               selected = <span>"IIb"</span>,<br>               label = <span>NULL</span>,<br>               choices = public_clinical$Age<br>             ),<br>             selectInput(<br>               ns(<span>"analysis_type2"</span>),<br>               label = <span>NULL</span>,<br>               choices = public_clinical$OS.time<br>             ),<br>             actionButton(inputId = ns(<span>"caretdown7"</span>), label = <span>"Change query path"</span>),<br>           )<br>    ))<br>}<br><br><span>#' @export</span><br>server &lt;- <span>function</span>(id) {<br>  moduleServer(id, <span>function</span>(input, output, session) {<br>    ns &lt;- session$ns<br><br>    router_server()<br><br>    observeEvent(input$caretdown7, {<br><br>      url_name &lt;- paste0(<span>"#!/cohort?"</span>,<span>"Age="</span>,input$analysis_type1,<span>"&amp;OS.time="</span>,input$analysis_type2)<br>      change_page(page = url_name)<br>      <br>      print(parse_url_path(url_name))<br>      print(get_page())<br>      output$text2 &lt;- renderText({ parse_url_path(url_name)$query$Age })<br>      <span>#parse_url_path必须有一个"url_path"</span><br>      output$text3 &lt;- renderText({ get_query_param(<span>"Age"</span>)})<br>      output$text4 &lt;- renderText({ get_query_param()[[<span>1</span>]]})<br>    })<br>  }<br>    )}<br></code></pre><p><img data-galleryid="" data-imgfileid="100010654" data-ratio="0.9474835886214442" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mPqFmhtlSJztqDnOkjf6EQIqB0s9pqrvjnqXhp7qA4GuCxx4QrB2zyEpu2BwfiawLib7khQR5QxptibfDgzf9uuuQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="914" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mPqFmhtlSJztqDnOkjf6EQIqB0s9pqrvjnqXhp7qA4GuCxx4QrB2zyEpu2BwfiawLib7khQR5QxptibfDgzf9uuuQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100010655" data-ratio="0.6758793969849246" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mPqFmhtlSJztqDnOkjf6EQIqB0s9pqrvJoWAdxmHmAG0VOGlGWHUjaj4rPzf4lvOe5o9TkEXn4qH711wZGoIlw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="796" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mPqFmhtlSJztqDnOkjf6EQIqB0s9pqrvJoWAdxmHmAG0VOGlGWHUjaj4rPzf4lvOe5o9TkEXn4qH711wZGoIlw/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption><br></figcaption></figure><h4 data-tool="mdnice编辑器"><span></span><span>在该页面如何change_page都返回"cohort"</span><span></span></h4><h3 data-tool="mdnice编辑器"><span></span><span>（8）在url改变参数时改变selectinput</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># app/view/cohort.R</span><br><br>box::use(<br>  shiny[moduleServer, NS, fluidRow, textOutput,column, renderText,tags, observeEvent,actionButton, observe,tagList,h3, wellPanel, br, selectInput, h5, p, reactive, updateSelectInput],<br>  shiny.router[route_link, get_query_param, parse_url_path,change_page,router_server,get_page,is_page],<br>)<br>box::use(<br>  app/logic/aml1[a2]<br>)<br><span>#' @export</span><br>ui &lt;- <span>function</span>(id) {<br>  ns &lt;- NS(id)<br>  public_clinical &lt;- a2()<br>  fluidRow(<br>    column(<span>3</span>,<br>           wellPanel(<br>             h5(<span>"Analysis Controls"</span>),<br>             br(),<br>             p(<span>"Select dataset:"</span>),<br>             p(<span>"Analysis Type"</span>),<br>             selectInput(<br>               ns(<span>"analysis_type1"</span>),<br>               selected = <span>"IIb"</span>,<br>               label = <span>NULL</span>,<br>               choices = public_clinical$Age<br>             ),<br>             selectInput(<br>               ns(<span>"analysis_type2"</span>),<br>               label = <span>NULL</span>,<br>               choices = public_clinical$OS.time<br>             ),<br>             actionButton(inputId = ns(<span>"caretdown7"</span>), label = <span>"Change query path"</span>),<br>           )<br>    ))<br>}<br><br><span>#' @export</span><br>server &lt;- <span>function</span>(id) {<br>  moduleServer(id, <span>function</span>(input, output, session) {<br>    ns &lt;- session$ns<br><br>    router_server()<br><br>    observeEvent(input$caretdown7, {<br>      age_data &lt;- input$analysis_type1<br>      OS.time_data &lt;- input$analysis_type2<br>      url_name &lt;- paste0(<span>"#!/cohort?"</span>,<span>"Age="</span>,age_data,<span>"&amp;OS.time="</span>,OS.time_data)<br>      change_page(page = url_name)<br>       print(parse_url_path(url_name))<br>       print(get_page())<br>      output$text2 &lt;- renderText({ parse_url_path(url_name)$query$Age })<br>      <span>#parse_url_path必须有一个"url_path"</span><br>      output$text3 &lt;- renderText({ get_query_param(<span>"Age"</span>)})<br><br>      output$text4 &lt;- renderText({ get_query_param()[[<span>1</span>]]})<br><br>    })<br><br>    observe({<br>      age_1 &lt;- get_query_param(<span>"Age"</span>)<br>      print(age_1)<br>      updateSelectInput(session, <span>"analysis_type1"</span>, selected = age_1)<br>    })<br>  }<br>    )}<br><br></code></pre><figure data-tool="mdnice编辑器"><br></figure><h3 data-tool="mdnice编辑器"><span>（9）减少输出</span><span></span></h3><h4 data-tool="mdnice编辑器"><span></span><span>该情况下，处于home页面时也会执行该函数并输出</span><span></span></h4><p><img data-galleryid="" data-imgfileid="100010656" data-ratio="0.6518518518518519" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mPqFmhtlSJztqDnOkjf6EQIqB0s9pqrvl7OMdMo5ibRJsNQL8JYGsZAFAX5VYnzFKBCWGDsibTd8tCicwKInbBoag/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mPqFmhtlSJztqDnOkjf6EQIqB0s9pqrvl7OMdMo5ibRJsNQL8JYGsZAFAX5VYnzFKBCWGDsibTd8tCicwKInbBoag/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption><br></figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code><span># app/view/cohort.R</span><br><br>observe({<br>        age_1 &lt;- get_query_param(<span>"Age"</span>)<br>       updateSelectInput(session,<span>"analysis_type1"</span>, selected = age_1)<br>    })<br>    <br></code></pre><h4 data-tool="mdnice编辑器"><span></span><span>添加is_page后在cohort页面才执行该函数并输出</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span># app/view/cohort.R</span><br><br><span>#' @export</span><br>server &lt;- <span>function</span>(id) {<br>  moduleServer(id, <span>function</span>(input, output, session) {<br>    ns &lt;- session$ns<br><br>    router_server()<br><br>    observeEvent(input$caretdown7, {<br>      age_data &lt;- input$analysis_type1<br>      OS.time_data &lt;- input$analysis_type2<br>      url_name &lt;- paste0(<span>"#!/cohort?"</span>,<span>"Age="</span>,age_data,<span>"&amp;OS.time="</span>,OS.time_data)<br><br>      change_page(page = url_name)<br><br>      print(parse_url_path(url_name))<br>      print(get_page())<br>      output$text2 &lt;- renderText({ parse_url_path(url_name)$query$Age })<br>      <span>#parse_url_path必须有一个"url_path"</span><br>      output$text3 &lt;- renderText({ get_query_param(<span>"Age"</span>)})<br>      output$text4 &lt;- renderText({ get_query_param()[[<span>1</span>]]})<br>    })<br>    observe({<br>      <span>if</span>(is_page(<span>"cohort"</span>)){<br>        age_1 &lt;- get_query_param(<span>"Age"</span>)<br>        print(age_1)<br>        updateSelectInput(session, <span>"analysis_type1"</span>, selected = age_1)}<br>    })<br>  }<br>    )}<br></code></pre><section data-tool="mdnice编辑器"><span>参考资料</span></section><section data-tool="mdnice编辑器"><span><span>[1]</span><p>http::parse_url(): <em>https://www.php.net/manual/zh/function.parse-url.php</em></p></span></section></section><p><br></p><p><span>编辑/指导/发布：王诗翔</span></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/kEkclYzqrWz2lDCc0uG7Dw",target="_blank" rel="noopener noreferrer">原文链接</a>
