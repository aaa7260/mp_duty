---
title: "bam文件的相关性的比较"
date: 2023-07-01T00:55:03Z
draft: ["false"]
tags: [
  "fetched",
  "东林的扯淡小屋"
]
categories: ["Acdemic"]
---
bam文件的相关性的比较 by 东林的扯淡小屋
------
<div><p>#样本之间的相关性</p><p>#根据igv可视化的结果可以初步判断样本之间的相关性很高，所以，我们现在想定量的去计算样本之间的相关性。如何全基因组范围内检查测序数据之间的相关性呢？</p><p>#我偏好的方法是按照2000bp划分基因组，然后统计每一个划分模块里面的reads数目，最后做相关性分析，从而定量的检查样本之间的相关性。</p><p>cd /data/yudonglin/reference/human/hg19</p><p>## 利用samtools统计每一个染色体碱基数目</p><p>samtools faidx hg19.fa</p><p>## 结果生成一个.fai的文件，其中第一列染色体，第二列是每个染色体碱基的数目</p><p>less hg19.fa.fai</p><p>awk '{printf $1 "\t" $2 "\n"}' hg19.fa.fai &gt; hg19.genome</p><p>## 查看genome文件</p><p>head hg19.genome</p><p>## 以2000bp为bin划分基因组</p><p>bedtools makewindows -g hg19.genome -w 2000 &gt; hg19.windows</p><p>## 查看hg19.windows文件，可以看到该文件每行的第二列和第三列之间相差2000，第一列表示染色体</p><p>head hg19.windows</p><p>## 使用deeptools里面的multiBamSummary功能，统计之前划分的每一个区域在所有样本里面的reads数目</p><p>## --numberOfProcessors 4是调用4个线程的意思</p><p>multiBamSummary BED-file  --BED /data/yudonglin/reference/human/hg19/hg19.windows --bamfiles S1-1_trimmed_sorted.bam S1-2_trimmed_sorted.bam S1-3_trimmed_sorted.bam early1_trimmed_sorted.bam early2_trimmed_sorted.bam early3_trimmed_sorted.bam  --numberOfProcessors 40 -out ./readCounts.npz --outRawCounts ./readCounts.tab</p><p><br></p><p>## 查看readCounts.tab文件，我们就可以看到三个SRR样本在每一个区间里面的reads数目都被统计出来了，所以接下来我们就可以对这个表格进行相关性分析和PCA分析</p><p>less ./readCounts.tab</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="ruby"><code><span><span>## 首先下载相关性可视化的包</span></span></code><code><span><span>#install.packages("corrplot")</span></span></code><code><span><span>## 然后载入这个包</span></span></code><code><span>library(<span>"corrplot"</span>)</span></code><code><span><br></span></code><code><span><span>## 将我们刚才计算得到的数目读进R内（见图28），一共有59837行，6列。第一列是染色体，第二列到第三列是划分的区域，第四列到第五列是之前统计的bam文件名</span></span></code><code><span>atac_seq &lt;- read.csv(<span>"/data1/yudonglin/Rawdata/bowtie2/wang/readCounts.tab"</span>,sep = <span>"\t"</span>,stringsAsFactors = F)</span></code><code><span>head(atac_seq)</span></code><code><span><span>## 把前三列删除（这三列不需要，计算相关性只需后面的reads数目就好）</span></span></code><code><span>atac_seq &lt;- atac_seq[,-<span>1</span><span>:-</span><span>3</span>]</span></code><code><span><br></span></code><code><span><span>## 将剩余的三列的名字重新命名，之前的名字太长了</span></span></code><code><span>colnames(atac_seq) &lt;- c(<span>"S1-1"</span>, <span>"S1-2"</span> , <span>"S1-3"</span> , <span>"early1"</span> ,<span>"early2"</span>,  <span>"early3"</span>)</span></code><code><span><br></span></code><code><span><span>## 计算样本之间相关性，可以看到样本相关性很强，都在0.99以上（见图29）</span></span></code><code><span>cor(atac_seq)</span></code><code><span><br></span></code><code><span><span>## 接着我们使用corrplot包对数据进行可视化，然后将图片以PDF格式输出到本地，然后用AI进行简单的修改就可以放在文章里面了（图30）</span></span></code><code><span>corrplot(cor(atac_seq))</span></code><code><span><br></span></code><code><span>a&lt;-cor(atac_seq)</span></code><code><span>pheatmap::pheatmap(cor(atac_seq),,scale = <span>"row"</span>,</span></code><code><span>                   cluster_rows = T,show_rownames = F,</span></code><code><span>                   cluster_cols = F)</span></code></pre></section><p><img data-galleryid="" data-ratio="0.9629629629629629" data-s="300,640" data-type="jpeg" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBoKoQFe6xKdJveTVO3tvHoXcACicHJzibScF7R75cBNpiaIjt8VTJJNVCJibNJugTP9pckicTGnt97nbpw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBoKoQFe6xKdJveTVO3tvHoXcACicHJzibScF7R75cBNpiaIjt8VTJJNVCJibNJugTP9pckicTGnt97nbpw/640?wx_fmt=png"></p><p><br></p><p>另一种方法：</p><p>#样本相似性</p><p>conda activate cutandtag</p><p>multiBamSummary bins --bamfiles hT-GT_sorted.bam hT-PBS_sorted.bam  --binSize 10000 --verbose --extendReads --labels hT-GT hT-PBS  -out readCounts.npz  --outRawCounts readCounts.tab -p 50</p><p>plotCorrelation -in readCounts.npz --removeOutliers --corMethod spearman --skipZeros  --whatToPlot heatmap --colorMap jet --plotNumbers -o Corr_readCounts.pdf  --outFileCorMatrix Corr_readCounts.tab  --plotFileFormat pdf</p><p>plotPCA -in readCounts.npz \</p><p>-o PCA_readCounts.pdf \</p><p>-T "PCA of read counts"</p><p><img data-galleryid="" data-ratio="0.6666666666666666" data-s="300,640" data-type="jpeg" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/kZ1wdgAscBoKoQFe6xKdJveTVO3tvHoXN7mLprHcTfbbf3bW1ImCMvOicZ8DrcgQ7f1Kuy5bpIO8IkMAfDiatic8g/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/mmbiz_jpg/kZ1wdgAscBoKoQFe6xKdJveTVO3tvHoXN7mLprHcTfbbf3bW1ImCMvOicZ8DrcgQ7f1Kuy5bpIO8IkMAfDiatic8g/640?wx_fmt=jpeg"></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/bPHe4dQFs97y9L-jpgOUYw",target="_blank" rel="noopener noreferrer">原文链接</a>
