---
title: "奔向自由的富集分析"
date: 2023-07-07T02:59:01Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
奔向自由的富集分析 by 生信星球
------
<div><p data-mpa-powered-by="yiban.io"><span>‍</span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png"><span> 今天是生信星球陪你的<span><strong>第919天</strong></span></span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"></p><hr><section><span><span>   </span><span>大神一句话，菜鸟跑半年。我不是大神，但我可以缩短你走弯路的半年~</span></span></section><section><span>   就像歌儿唱的那样，如果你不知道该往哪儿走，就留在这学点生信好不好~</span></section><section><span>   这里有豆豆和花花的学习历程，从新手到进阶，生信路上有你有我！</span></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h4 data-tool="mdnice编辑器"><span>0.单细胞的marker基因</span><span><span> </span></span></h4><p data-tool="mdnice编辑器">啥基因都可以，富集分析只需要一组基因名字。</p><p data-tool="mdnice编辑器">不想要线粒体核糖体红细胞的基因，直接去掉。</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br>library(clusterProfiler)<br>library(org.Hs.eg.db)<br>library(stringr)<br>load(<span>"makers.Rdata"</span>)<br>k = grepl(<span>"^RP[SL]|^MT-|^HB[^(P)]"</span>,rownames(markers));table(k)<br><br><span>## k</span><br><span>## FALSE  TRUE </span><br><span>## 16827   577</span><br><br>markers = markers[!k,]<br>g &lt;- markers[markers<span>$cluster</span> == 6 &amp; <br>               markers<span>$avg_log2FC</span> &gt; 3, <span>'gene'</span> ]<br>g<br><br><span>##  [1] "CTSW"     "XCL2"     "GZMK"     "CD247"    "CD2"      "LCK"     </span><br><span>##  [7] "CD3E"     "CST7"     "PTPRCAP"  "PRF1"     "GZMA"     "CXCR3"   </span><br><span>## [13] "GZMH"     "XCL1"     "NKG7"     "KLRD1"    "ITM2A"    "GZMM"    </span><br><span>## [19] "KLRB1"    "LAT"      "CD3D"     "ZAP70"    "MATK"     "CD96"    </span><br><span>## [25] "KLRC1"    "TBC1D10C" "CD7"      "TMIGD2"   "IL2RG"    "HOPX"    </span><br><span>## [31] "EVL"      "IL2RB"    "GIMAP7"   "TRAF3IP3" "SELL"     "CCL5"    </span><br><span>## [37] "SEPT1"    "CCR7"     "ACAP1"    "CD69"     "CORO1A"   "LIMD2"   </span><br><span>## [43] "RHOH"     "GZMB"     "GNLY"     "IL32"     "PLAC8"    "STK17A"  </span><br><span>## [49] "S1PR4"    "RAC2"     "TNFRSF18" "ICAM3"    "SEPT6"    "CXCR4"   </span><br><span>## [55] "PTPN7"    "APOBEC3G" "PTPRC"    "CDKN2D"   "HLA-F"    "HMGB2"   </span><br><span>## [61] "PCSK7"    "FDFT1"    "SYNCRIP"</span><br></code></pre><h4 data-tool="mdnice编辑器"><span><span> </span></span><span><span> </span>1.常规的富集分析</span><span><span> </span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>library(msigdbr)<br>ego &lt;- enrichGO(<br>  gene = g,<br>  OrgDb = org.Hs.eg.db,<br>  keyType = <span>"SYMBOL"</span>,<br>  ont = <span>"ALL"</span><br>)<br>dotplot(ego)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7138888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHq6lJXM93NconqHToApbHmvwiccvibfLZp2Aj9OxTXJR0rcrqXRia9RoiaRHpyH1ccNlT11Xl9nL6zAVQ/640?wx_fmt=other" data-type="other" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHq6lJXM93NconqHToApbHmvwiccvibfLZp2Aj9OxTXJR0rcrqXRia9RoiaRHpyH1ccNlT11Xl9nL6zAVQ/640?wx_fmt=other"></figure><pre data-tool="mdnice编辑器"><span></span><code>ego@result<span>$Description</span>[1:10]<br><br><span>##  [1] "T cell activation"                                  </span><br><span>##  [2] "regulation of T cell activation"                    </span><br><span>##  [3] "leukocyte migration"                                </span><br><span>##  [4] "leukocyte mediated cytotoxicity"                    </span><br><span>##  [5] "T cell mediated cytotoxicity"                       </span><br><span>##  [6] "cell killing"                                       </span><br><span>##  [7] "positive regulation of T cell activation"           </span><br><span>##  [8] "leukocyte cell-cell adhesion"                       </span><br><span>##  [9] "positive regulation of leukocyte cell-cell adhesion"</span><br><span>## [10] "positive regulation of leukocyte activation"</span><br></code></pre><h4 data-tool="mdnice编辑器"><span><span> </span></span><span><span> </span>2.细胞基因集</span><span><span> </span></span></h4><p data-tool="mdnice编辑器">自从有了msigdbr这个好东西，就不再需要研究gmt了哦。新加上的C8就是各种细胞的marker基因。</p><p data-tool="mdnice编辑器">那么难道msigdb的基因集只能做GSEA吗？</p><p data-tool="mdnice编辑器">那还真不是。</p><p data-tool="mdnice编辑器">Y叔叔写的函数enrichr，只要你拿到基因与通路/分类名称之间的对应关系，自定义的富集分析，你值得拥有。</p><pre data-tool="mdnice编辑器"><span></span><code>C8 &lt;- msigdbr(species = <span>"Homo sapiens"</span>,<br>                      category = <span>"C8"</span>) %&gt;% <br>  dplyr::select(gs_name,gene_symbol )<br><br>C8<span>$gs_name</span> = C8<span>$gs_name</span> %&gt;% <br>  str_replace(<span>"_"</span>,<span>"///"</span>) %&gt;% <br>  str_split(<span>"///"</span>,simplify = T) %&gt;% <br>  .[,2] %&gt;% <br>  str_to_lower() %&gt;% <br>  str_replace_all(<span>"_"</span>,<span>" "</span>)<br><br>head(C8)<br><br><span>## # A tibble: 6 × 2</span><br><span>##   gs_name           gene_symbol</span><br><span>##   &lt;chr&gt;             &lt;chr&gt;      </span><br><span>## 1 liver c10 mvecs 1 A2M        </span><br><span>## 2 liver c10 mvecs 1 ACKR1      </span><br><span>## 3 liver c10 mvecs 1 ACP5       </span><br><span>## 4 liver c10 mvecs 1 ACVRL1     </span><br><span>## 5 liver c10 mvecs 1 ADAM15     </span><br><span>## 6 liver c10 mvecs 1 ADAMTS1</span><br><br>x &lt;- enricher(g, TERM2GENE = C8)<br>head(x@result<span>$Description</span>,10)<br><br><span>##  [1] "adult olfactory neuroepithelium nk cells"   </span><br><span>##  [2] "embryonic ctx brain effector t cell"        </span><br><span>##  [3] "developing heart c9 b t cell"               </span><br><span>##  [4] "liver c1 nk nkt cells 1"                    </span><br><span>##  [5] "fetal adrenal lymphoid cells"               </span><br><span>##  [6] "fetal intestine lymphoid cells"             </span><br><span>##  [7] "fetal placenta lymphoid cells"              </span><br><span>##  [8] "fetal lung lymphoid cells"                  </span><br><span>##  [9] "adult olfactory neuroepithelium cd8 t cells"</span><br><span>## [10] "fetal stomach lymphoid cells"</span><br><br>dotplot(x)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7138888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHq6lJXM93NconqHToApbHmvL8G9KXtnCoej2LyVzCiaq0RBicibfUlw4l02ibXddl7AYO6y5K2HadqdEQ/640?wx_fmt=other" data-type="other" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHq6lJXM93NconqHToApbHmvL8G9KXtnCoej2LyVzCiaq0RBicibfUlw4l02ibXddl7AYO6y5K2HadqdEQ/640?wx_fmt=other"></figure><p data-tool="mdnice编辑器">天高任鸟飞，只要能做出TERM2GENE，就可以实现富集分析自由了。</p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><figure data-tool="mdnice编辑器"><span></span></figure></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><figure data-tool="mdnice编辑器"></figure></section><section><blockquote><section><span>如果因为代码看不懂，而跟不上正文的节奏，可以来找我，系统学习。我的</span><span>课程都是循环开课。</span><span>下一期的时间，点进去咨询微信咯</span><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247493194&amp;idx=1&amp;sn=5ddfe9dc5c0096c64364fbcd824fa4e6&amp;chksm=fdfbae08ca8c271eb1808717502255c15754e35832f04d374cf7e6bd25783407fa1f80a35fc1&amp;scene=21#wechat_redirect" textvalue="新的一年，你要不要来找我们学习‍生信" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">新的一年，你要不要来找我<span>‍</span>们学习生信</a><br></section></blockquote></section><section><br></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/hMlLjJha27XSXcMf0hRLOQ",target="_blank" rel="noopener noreferrer">原文链接</a>
