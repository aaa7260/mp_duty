---
title: "CellMiner药物敏感性分析"
date: 2023-07-07T02:58:43Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
CellMiner药物敏感性分析 by 生信星球
------
<div><p data-mpa-powered-by="yiban.io"><span>‍</span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png"><span> 今天是生信星球陪你的<span><strong>第918天</strong></span></span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"></p><hr><section><span><span>   </span><span>大神一句话，菜鸟跑半年。我不是大神，但我可以缩短你走弯路的半年~</span></span></section><section><span>   就像歌儿唱的那样，如果你不知道该往哪儿走，就留在这学点生信好不好~</span></section><section><span>   这里有豆豆和花花的学习历程，从新手到进阶，生信路上有你有我！</span></section><section><span><br></span></section><section>今天是2023年7月6号，曾老板终于结束了6年的博士生涯，顺利完成毕业答辩，恭喜他！这个是我的小小号，可以留言👇</section><section>👇👇</section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU0NjA0NzEyMA==&amp;mid=2247483915&amp;idx=1&amp;sn=7d50261be01fdfac778efa2e72511008&amp;chksm=fb62d7f4cc155ee212f78f81e9e79994a987ad218124ff6cbdc35f6cdd179f052b600a2573c3&amp;scene=21#wechat_redirect" textvalue="恭喜曾老板喜提博士学位" linktype="text" imgurl="" imgdata="null" data-itemshowtype="8" tab="innerlink" data-linktype="2">👉👉恭喜曾老板喜提博士学位</a>👈👈<br></section><section>👆👆</section><section>---进入正题分割线----</section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h4 data-tool="mdnice编辑器"><span><span> </span></span><span><span> </span>1.数据下载</span><span><span> </span></span></h4><p data-tool="mdnice编辑器">https://discover.nci.nih.gov/cellminer/home.do<img data-ratio="0.5101851851851852" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHq6lJXM93NconqHToApbHmvicYTMzqD83PJM9sgAtuOLB5nzH4BmN0JhIZJyk4lQKwaFPHpvLsLDuA/640?wx_fmt=other" data-type="other" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHq6lJXM93NconqHToApbHmvicYTMzqD83PJM9sgAtuOLB5nzH4BmN0JhIZJyk4lQKwaFPHpvLsLDuA/640?wx_fmt=other"><img data-ratio="0.55" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHq6lJXM93NconqHToApbHmviaD3qHvn3Sk6DHu3sGlk6A6yWPibWb2xTCmFDrm2vM1ibYkeUOHFBN4ow/640?wx_fmt=other" data-type="other" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHq6lJXM93NconqHToApbHmviaD3qHvn3Sk6DHu3sGlk6A6yWPibWb2xTCmFDrm2vM1ibYkeUOHFBN4ow/640?wx_fmt=other">下载并解压，放在工作目录下</p><h4 data-tool="mdnice编辑器"><span><span> </span></span><span><span> </span>2.药物数据整理</span><span><span> </span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br>library(stringr)<br>library(rio)<br>drug0 = rio::import(<span>"DTP_NCI60_ZSCORE.xlsx"</span>, skip = 8)<br>drug0 = drug0[,-c(67,68)]<br>k1 = drug0$`Drug name`!=<span>"-"</span>;table(k1)<br><br><span>## k1</span><br><span>## FALSE  TRUE </span><br><span>##  3766 21087</span><br><br>table(drug0$`FDA status`)<br><br><span>## </span><br><span>##              - Clinical trial   FDA approved </span><br><span>##          23993            546            314</span><br><br>k2 = drug0$`FDA status`!=<span>"-"</span>;table(k2)<br><br><span>## k2</span><br><span>## FALSE  TRUE </span><br><span>## 23993   860</span><br><br>drug0 = drug0[k1&amp;k2,]<br>drug = apply(drug0[,-(1:6)],2,as.numeric)<br>rownames(drug)= drug0$`Drug name`<br><br>drug[1:4,1:4]<br><br><span>##                  BR:MCF7 BR:MDA-MB-231 BR:HS 578T BR:BT-549</span><br><span>## METHOTREXATE        0.70         -1.22      -1.89     -0.88</span><br><span>## 6-THIOGUANINE       0.48         -0.31      -1.09     -0.44</span><br><span>## 6-MERCAPTOPURINE    0.70         -0.44      -0.55     -1.44</span><br><span>## Colchicine          0.32            NA         NA        NA</span><br><br><span># 缺失值处理</span><br><br>library(impute)<br>library(limma)<br><br>drug = impute.knn(drug)<span>$data</span> <span>#报错</span><br><br><span>## Error in impute.knn(drug): a column has more than 80 % missing values!</span><br><br>a = apply(drug, 2, <span>function</span>(x){sum(is.na(x))/length(x)})<br>tail(sort(a),10) <span># 确实有超过80%NA 的列，要删掉</span><br><br><span>##    RE:A498  RE:CAKI-1 BR:HS 578T   LE:K-562  LC:HOP-92  BR:BT-549   BR:T-47D </span><br><span>## 0.04651163 0.04883721 0.05348837 0.05465116 0.05697674 0.06046512 0.06860465 </span><br><span>##      LE:SR    LC:EKVX   ME:MDA-N </span><br><span>## 0.07906977 0.19186047 0.84534884</span><br><br>drug = drug[,-which.max(a)]<br>drug = impute.knn(drug)<span>$data</span> <br>drug = avereps(drug)<br></code></pre><h4 data-tool="mdnice编辑器"><span><span> </span></span><span><span> </span>3.表达矩阵整理</span><span><span> </span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>exp0 = rio::import(<span>"RNA__RNA_seq_composite_expression.xls"</span>,skip = 10)<br>exp = as.matrix(exp0[,-(1:6)])<br>rownames(exp) = exp0$`Gene name d`<br>exp = avereps(exp)<br>exp = exp[,-which.max(a)] <span>#上面删掉了一列，这里也必须删掉</span><br>identical(colnames(exp),colnames(drug))<br><br><span>## [1] TRUE</span><br></code></pre><h4 data-tool="mdnice编辑器"><span><span> </span></span><span><span> </span>5.药敏分析</span><span><span> </span></span></h4><p data-tool="mdnice编辑器">其实本质上就是基因表达量与药物IC50值的相关性分析</p><p data-tool="mdnice编辑器">tinyarray 里的cor.one函数支持一列与所有列的相关性分析</p><pre data-tool="mdnice编辑器"><span></span><code>g = <span>"EGFR"</span><br>dat = t(rbind(exp[g,],drug))<br>colnames(dat)[1] = g<br>dat[1:4,1:4]<br><br><span>##                EGFR METHOTREXATE 6-THIOGUANINE 6-MERCAPTOPURINE</span><br><span>## BR:MCF7       0.242         0.70          0.48             0.70</span><br><span>## BR:MDA-MB-231 3.913        -1.22         -0.31            -0.44</span><br><span>## BR:HS 578T    2.428        -1.89         -1.09            -0.55</span><br><span>## BR:BT-549     3.215        -0.88         -0.44            -1.44</span><br><br>library(tinyarray)<br>re = cor.one(dat,g)<br>k = re<span>$p</span>.value&lt;0.05 &amp; abs(re<span>$cor</span>)&gt;0.5;table(k)<br><br><span>## k</span><br><span>## FALSE  TRUE </span><br><span>##   752    15</span><br><br>remini = re[k,]<br>remini<br><br><span>##                    p.value        cor obsnumber</span><br><span>## Noscapine     1.740620e-05 -0.5278020        59</span><br><span>## Tamoxifen     1.920620e-06 -0.5748512        59</span><br><span>## ciclosporin   2.433162e-05 -0.5199893        59</span><br><span>## auranofin     1.013795e-07 -0.6280054        59</span><br><span>## Staurosporine 6.910490e-06  0.5483959        59</span><br><span>## Dasatinib     5.932590e-07  0.5972467        59</span><br><span>## XAV-939       3.766265e-05  0.5095013        59</span><br><span>## Sapitinib     1.906967e-05  0.5256921        59</span><br><span>## Pipamperone   1.515924e-05 -0.5309705        59</span><br><span>## BMS-690514    3.847482e-06  0.5607794        59</span><br><span>## Bafetinib     3.823063e-05 -0.5091358        59</span><br><span>## spebrutinib   8.142489e-07  0.5913741        59</span><br><span>## S-63845       5.427220e-06 -0.5535653        59</span><br><span>## AZD-5991      5.042577e-05 -0.5022987        59</span><br><span>## BLU-667       5.958846e-07  0.5971656        59</span><br></code></pre><p data-tool="mdnice编辑器">可以根据相关系数与p值筛选药物-基因对啦，obsnumber列请忽略</p><h4 data-tool="mdnice编辑器"><span><span> </span></span><span><span> </span>6.可视化</span><span><span> </span></span></h4><p data-tool="mdnice编辑器">相关性点图</p><pre data-tool="mdnice编辑器"><span></span><code>library(ggpubr)<br>pdat = data.frame(dat[,c(<span>"Tamoxifen"</span>,<span>"EGFR"</span>)],<br>                  check.names = F)<br>colnames(pdat)<br><br><span>## [1] "Tamoxifen" "EGFR"</span><br><br>sp1 &lt;- ggscatter(pdat, x = <span>"Tamoxifen"</span>, y = <span>"EGFR"</span>,<br>                 add = <span>"reg.line"</span>,  <span># Add regressin line </span><br>                 add.params = list(color = <span>"blue"</span>, fill = <span>"lightgray"</span>), <span># Customize reg. line</span><br>                 conf.int = TRUE <span># Add confidence interval</span><br>) + stat_cor(method = <span>"pearson"</span>)<br>sp1<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7138888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHq6lJXM93NconqHToApbHmviaFkUAqficP1L5VtIdVPibcUXV1bvWzYtXZ8tRqGKFlgOwl8CBDa7qUZw/640?wx_fmt=other" data-type="other" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHq6lJXM93NconqHToApbHmviaFkUAqficP1L5VtIdVPibcUXV1bvWzYtXZ8tRqGKFlgOwl8CBDa7qUZw/640?wx_fmt=other"></figure><p data-tool="mdnice编辑器">箱线图</p><pre data-tool="mdnice编辑器"><span></span><code>pdat<span>$group</span> = ifelse(pdat<span>$EGFR</span>&gt;median(pdat<span>$EGFR</span>),<span>"high"</span>,<span>"low"</span>)<br><br>ggboxplot(pdat,<span>"group"</span>,<span>"Tamoxifen"</span>,fill = <span>"group"</span>)+<br>  stat_compare_means(comparisons = list(c(<span>"high"</span>,<span>"low"</span>)),<br>                     aes(label = after_stat(p.signif)))+<br>  scale_fill_manual(values = c(<span>"#2874C5"</span>, <span>"#f87669"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7138888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHq6lJXM93NconqHToApbHmvvfSicTYmAQ0ia0QvPuRHojicUibjPXm4U73toPqCJ5WqBffMAWKnSOF8icg/640?wx_fmt=other" data-type="other" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHq6lJXM93NconqHToApbHmvvfSicTYmAQ0ia0QvPuRHojicUibjPXm4U73toPqCJ5WqBffMAWKnSOF8icg/640?wx_fmt=other"></figure></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><figure data-tool="mdnice编辑器"><span></span></figure></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><figure data-tool="mdnice编辑器"></figure></section><section><blockquote><section><span>如果因为代码看不懂，而跟不上正文的节奏，可以来找我，系统学习。我的</span><span>课程都是循环开课。</span><span>下一期的时间，点进去咨询微信咯</span><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247493194&amp;idx=1&amp;sn=5ddfe9dc5c0096c64364fbcd824fa4e6&amp;chksm=fdfbae08ca8c271eb1808717502255c15754e35832f04d374cf7e6bd25783407fa1f80a35fc1&amp;scene=21#wechat_redirect" textvalue="新的一年，你要不要来找我们学习‍生信" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">新的一年，你要不要来找我<span>‍</span>们学习生信</a><br></section></blockquote></section><section><br></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/tXUPHgBD0bUbmJ6PZ_RhQA",target="_blank" rel="noopener noreferrer">原文链接</a>
