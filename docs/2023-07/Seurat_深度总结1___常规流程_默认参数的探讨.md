---
title: "Seurat 深度总结1---常规流程+默认参数的探讨"
date: 2023-07-04T03:49:32Z
draft: ["false"]
tags: [
  "fetched",
  "TOP生物信息"
]
categories: ["Acdemic"]
---
Seurat 深度总结1---常规流程+默认参数的探讨 by TOP生物信息
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><section><mp-common-profile data-pluginname="mpprofile" data-id="MzkzMzE5NTM4NA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2aJMzXzvekL6pv5hnSGnwsxWcOUF8av7a9VEiaicBGia4CRy0DUOeaFuFZY2BPLmRQSf4lkibg5l31Ttw/0?wx_fmt=png" data-nickname="TOP生物信息" data-alias="" data-signature="生信人，当自强。" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><ul><li><p>1. 为什么写这篇帖子</p></li><ul><li><p>1.1 Seurat 的重要性</p></li><li><p>1.2 网络上教程的局限性</p></li></ul><li><p>2. Setup the Seurat Object</p></li><li><p>3. Standard pre-processing workflow</p></li><ul><li><p>3.1 QC and selecting cells for further analysis</p></li></ul><li><p>4. Normalizing the data</p></li><ul><li><p>4.1 标准化的方法</p></li><li><p>4.2 scale.factor 的选择</p></li></ul><li><p>5. Identification of highly variable features (feature selection)</p></li><ul><li><p>5.1 找高变基因的方法</p></li><li><p>5.2 vst 的参数 loess span 选择</p></li><li><p>5.3 调整高变基因数据</p></li></ul><li><p>6. Scaling the data</p></li><li><p>小结一下</p></li><li><p>往期回顾</p></li></ul><p data-tool="mdnice编辑器"><br></p><h2 data-tool="mdnice编辑器"><span></span><span>1. 为什么写这篇帖子</span></h2><h3 data-tool="mdnice编辑器"><span></span>1.1 Seurat 的重要性<span></span></h3><ul data-tool="mdnice编辑器"><li><section>单细胞分析最流行的 R 包</section></li><li><section>全网教程最多的单细胞分析的流程</section></li></ul><h3 data-tool="mdnice编辑器"><span></span>1.2 网络上教程的局限性<span></span></h3><ul data-tool="mdnice编辑器"><li><section>Seurat 官网流程的搬运工（即 NormalizeData ---&gt; FindVariableFeatures ---&gt; ScaleData ---&gt; RunPCA ---&gt; FindNeighbors ---&gt; FindClusters ---&gt; RunUMAP/RunTSNE），或者分享 Seurat 的进阶流程 SCTransform</section></li><li><section>没有真正探讨各个默认参数对于分析的影响，例如：</section></li><ul><li><section>FindVariableFeatures 除了 2000，能否选择 1000?3000?5000？</section></li><li><section>ScaleData 是否应该做回归？如果回归，要回归什么参数？</section></li><li><section>PC 数目应该如何选择？</section></li><li><section>分辨率选择多少？</section></li></ul></ul><p data-tool="mdnice编辑器">本篇推文，笔者将基于</p><ul data-tool="mdnice编辑器"><li><section>Seurat 的官网流程(https://satijalab.org/seurat/articles/pbmc3k_tutorial.html)</section></li><li><section>自己对于单细胞分析的经验</section></li><li><section>数篇参考文献抛砖引玉，讨论一下单细胞 Seuat 的流程中，NormalizeData---&gt;FindVariableFeatures ---&gt; ScaleData 的参数选择情况</section></li></ul><figure data-tool="mdnice编辑器"><img data-ratio="0.48703703703703705" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAg8KYEzYWXtl4RWdRxw8quLVX4HSWNm1dtNlC2W6AK1FAHtgnwSZzsw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAg8KYEzYWXtl4RWdRxw8quLVX4HSWNm1dtNlC2W6AK1FAHtgnwSZzsw/640?wx_fmt=png"></figure><center data-tool="mdnice编辑器"></center><center data-tool="mdnice编辑器">图1 Seurat流程</center><blockquote data-tool="mdnice编辑器"><p>Schneider et al. J <em>Transl Genet Genom</em>. 2021;5:37-49</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>2. Setup the Seurat Object</span></h2><p data-tool="mdnice编辑器">官网中的第一步，使用的是PBMC 的数据(https://cf.10xgenomics.com/samples/cell/pbmc3k/pbmc3k_filtered_gene_bc_matrices.tar.gz)，读取标准的 Cellranger 下机的文件，然后建立 Seurat 对象。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.1989795918367347" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAvCj5OHUlXUrozL31A6kib0Sn1E3LaRia9KVvFcmwFgPhTGIhDwnwLjag/640?wx_fmt=png" data-type="png" data-w="980" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAvCj5OHUlXUrozL31A6kib0Sn1E3LaRia9KVvFcmwFgPhTGIhDwnwLjag/640?wx_fmt=png"></figure><center data-tool="mdnice编辑器">图2 PBMC的数据</center><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(dplyr)<br><span>library</span>(Seurat)<br><span>library</span>(patchwork)<br><br><span># Load the PBMC dataset</span><br>pbmc.data &lt;- Read10X(data.dir = <span>"../data/pbmc3k/filtered_gene_bc_matrices/hg19/"</span>)<br><span># Initialize the Seurat object with the raw (non-normalized data).</span><br>pbmc &lt;- CreateSeuratObject(counts = pbmc.data, project = <span>"pbmc3k"</span>, min.cells = <span>3</span>, min.features = <span>200</span>)<br>pbmc<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>3. Standard pre-processing workflow</span></h2><h3 data-tool="mdnice编辑器"><span></span>3.1 QC and selecting cells for further analysis<span></span></h3><h4 data-tool="mdnice编辑器"><span></span>3.2.1 细胞层面过滤<span></span></h4><p data-tool="mdnice编辑器">在单细胞分析中，最常见的质控指标包括：</p><ul data-tool="mdnice编辑器"><li><section>UMI counts/cell: 即 nCount_RNA，每个细胞的 UMI 数目</section></li><ul><li><section>太大：可能是双细胞或者多细胞的集合</section></li></ul><li><section>genes/cell: 即 nFeature_RNA，每个细胞所检测到的基因数目</section></li><ul><li><section>太小：可能是无效细胞</section></li><li><section>太大：可能是双细胞或者多细胞的集合</section></li></ul><li><section>percent.mt: 映射到线粒体基因组的读数百分比</section></li><ul><li><section>低质量/垂死的细胞往往表现出广泛的线粒体污染</section></li></ul></ul><pre data-tool="mdnice编辑器"><span></span><code><span># The [[ operator can add columns to object metadata. This is a great place to stash QC stats</span><br>pbmc[[<span>"percent.mt"</span>]] &lt;- PercentageFeatureSet(pbmc, pattern = <span>"^MT-"</span>)<br><br><span># Visualize QC metrics as a violin plot</span><br>VlnPlot(pbmc, features = c(<span>"nFeature_RNA"</span>, <span>"nCount_RNA"</span>, <span>"percent.mt"</span>), ncol = <span>3</span>)<br><br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5388888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAtPl5RHsDGTQiaU6xDBtYCAEx1pWlngRnamtAMkgKBpzyQmBRKVrMiaBg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAtPl5RHsDGTQiaU6xDBtYCAEx1pWlngRnamtAMkgKBpzyQmBRKVrMiaBg/640?wx_fmt=png"></figure><center data-tool="mdnice编辑器">图 3 质控小提琴图</center><pre data-tool="mdnice编辑器"><span></span><code><span># FeatureScatter is typically used to visualize feature-feature relationships, but can be used</span><br><span># for anything calculated by the object, i.e. columns in object metadata, PC scores etc.</span><br><br>plot1 &lt;- FeatureScatter(pbmc, feature1 = <span>"nCount_RNA"</span>, feature2 = <span>"percent.mt"</span>)<br>plot2 &lt;- FeatureScatter(pbmc, feature1 = <span>"nCount_RNA"</span>, feature2 = <span>"nFeature_RNA"</span>)<br>plot1 + plot2<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5388888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAHTs6UhFXxGjjiaZlang9WKUMicwWGzNuicdN1b6vTsOhyX0GSYlXsNVGg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAHTs6UhFXxGjjiaZlang9WKUMicwWGzNuicdN1b6vTsOhyX0GSYlXsNVGg/640?wx_fmt=png"></figure><center data-tool="mdnice编辑器">图 4 质控散点图</center><pre data-tool="mdnice编辑器"><span></span><code>pbmc &lt;- subset(pbmc, subset = nFeature_RNA &gt; <span>200</span> &amp; nFeature_RNA &lt; <span>2500</span> &amp; percent.mt &lt; <span>5</span>)<br></code></pre><p data-tool="mdnice编辑器">在这一步中，最为关键的就是如何选择质控的标准。质控的标准一般是结合小提琴图 [图 3] + 散点图 [图 4]+既往文献确定</p><h4 data-tool="mdnice编辑器"><span></span>3.2.2 基因层面过滤 (optional)<span></span></h4><p data-tool="mdnice编辑器">在质控这一步，也可以进行基因方便的质控，例如删除0表达值的基因和在少于10个细胞中表达的基因</p><pre data-tool="mdnice编辑器"><span></span><code><span># Output a logical vector for every gene on whether the more than zero counts per cell</span><br><span># Extract counts</span><br>counts &lt;- GetAssayData(object = pbmc, slot = <span>"counts"</span>)<br><br><span># Output a logical vector for every gene on whether the more than zero counts per cell</span><br>nonzero &lt;- counts &gt; <span>0</span><br><br><span># Sums all TRUE values and returns TRUE if more than 10 TRUE values per gene</span><br>keep_genes &lt;- Matrix::rowSums(nonzero) &gt;= <span>10</span><br><br><span># Only keeping those genes expressed in more than 10 cells</span><br>pbmc_filtered_counts &lt;- counts[keep_genes, ]<br><br><span># Reassign to filtered Seurat object</span><br>pbmc_filtered_seurat &lt;- CreateSeuratObject(pbmc_filtered_counts, meta.data = pbmc@meta.data)<br></code></pre><blockquote data-tool="mdnice编辑器"><p>参考：Single-cell RNA-seq analysis workshop ( https://github.com/hbctraining/scRNA-seq )</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>4. Normalizing the data</span></h2><p data-tool="mdnice编辑器">标准化的代码很容易:</p><pre data-tool="mdnice编辑器"><span></span><code>pbmc &lt;- NormalizeData(pbmc, normalization.method = <span>"LogNormalize"</span>, scale.factor = <span>10000</span>)<br></code></pre><p data-tool="mdnice编辑器">但是其实<code>NormalizeData</code>这个函数中，normalization.method 和 scale.factor 都是可以设置的参数。</p><h3 data-tool="mdnice编辑器"><span></span>4.1 标准化的方法<span></span></h3><p data-tool="mdnice编辑器">normalization.method 有三种方法：</p><ul data-tool="mdnice编辑器"><li><section>LogNormalize：Feature counts for each cell are divided by the total counts for that cell and multiplied by the scale.factor. This is then natural-log transformed using log1p</section></li><li><section>CLR：Applies a centered log ratio transformation</section></li><li><section>RC: Relative counts. Feature counts for each cell are divided by the total counts for that cell and multiplied by the scale.factor. No log-transformation is applied. For counts per million (CPM) set <code>scale.factor = 1e6</code></section></li></ul><figure data-tool="mdnice编辑器"><img data-ratio="0.5046296296296297" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAvpd3FL08xfib7ezfVfawOaolhHSFpw4PyhOg2B2ibl9ej0ey4icuxNjZA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAvpd3FL08xfib7ezfVfawOaolhHSFpw4PyhOg2B2ibl9ej0ey4icuxNjZA/640?wx_fmt=png"></figure><center data-tool="mdnice编辑器">图 5 三种标准化方法的聚类情况</center><p data-tool="mdnice编辑器">从 [图 5] 可以看出，三种方法中，LogN 相对于 CLR 和 RC 两种方法而言，能够有更多的 cluster [图 5A]。但是三种方法注释出来的 cluster 是相似的 [图 5B]。但是，三种方法标准化后，cluster 会略有不同 [图 5C]。</p><blockquote data-tool="mdnice编辑器"><p>ARI: ARI 值是衡量两个聚类方案之间的相似性/不相似性的指标，值为 1 代表完全相似，值为 0 代表完全不相似。</p></blockquote><figure data-tool="mdnice编辑器"><img data-ratio="0.549074074074074" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyA29hV4sKvpzy40n3uaTPO7YwG6ibpkcJaRdXbx0uoHicElmkkUZeRmykw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyA29hV4sKvpzy40n3uaTPO7YwG6ibpkcJaRdXbx0uoHicElmkkUZeRmykw/640?wx_fmt=png"></figure><center data-tool="mdnice编辑器">图 6 三种标准化方法的 UMAP 降维及注释结果</center><blockquote data-tool="mdnice编辑器"><p>备注：BCL_bc: B cells; END_en: endothelial cells; EPI_ep: epithelial cancer cells; FIB_fi: fibroblasts; MAC_ma: macrophages</p></blockquote><p data-tool="mdnice编辑器">在降维图上，三种不同方法产生的 cluster 方案之间出现一些差异：</p><ul data-tool="mdnice编辑器"><li><section>cluster 的识别上：有些 cluster 被一种方法识别出来，而其他方法则没有（[图 6A] 中的 cluster 3 和 cluster 12 以及[图 6C] 中的 cluster 10）</section></li><li><section>相同 cluster 的细分上：某些方法会将一组细胞定义为一个 cluster，但是另外的方法可能会将这群 cluster 分开，例如，成纤维细胞在 LogNormalize 方法中被分成三组，但在 RC 和 CLR 方法中只有两组，而且 RC 和 CLR 方法产生的两组也不相同 [图 6 A-F]。</section></li></ul><h3 data-tool="mdnice编辑器"><span></span>4.2 scale.factor 的选择<span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="0.4898148148148148" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAejJtSodC3bFQNwThXgztIoyfV9Z5OJ4PwIriasFiaakIB3356RBs9r4A/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAejJtSodC3bFQNwThXgztIoyfV9Z5OJ4PwIriasFiaakIB3356RBs9r4A/640?wx_fmt=png"></figure><center data-tool="mdnice编辑器">图 7 三种 Scale Factor 的聚类情况</center><p data-tool="mdnice编辑器">相较于 10000 的默认值来说，增加 10 倍或者减少 10 倍产生的结果变化不大，主要变化的地方在于细胞亚群的数量上。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.7546296296296297" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAaowfNU5bj6aphOV7jECmFj8c7z5G88gEC8cr4zEAZ7k76A2KCopLEA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAaowfNU5bj6aphOV7jECmFj8c7z5G88gEC8cr4zEAZ7k76A2KCopLEA/640?wx_fmt=png"></figure><center data-tool="mdnice编辑器">图 8 三种 Scale Factor 的 UMAP 降维及注释结果</center><p data-tool="mdnice编辑器">在降维图上，不同比例因子产生的聚类方案之间出现一些差异，例如：</p><ul data-tool="mdnice编辑器"><li><section>当比例因子降低时，产生的额外的 cluster（cluster 14 [图 8B]）是一小群最初在基线分析中被确定为巨噬细胞的细胞（cluster 2 [图 8 A]）。在新的方案下，这些细胞转而注释为 B 细胞 [图 8A-B]；</section></li><li><section>比例因子增加时丢失的 cluster（cluster 12 [图 8A, D]）被重新归类为内皮细胞（cluster 10  [图 8C, F]）。</section></li><li><section>这种变化细胞类型名字（如：原来的注释信息为巨噬，后来为 B 细胞）的 cluster 比例很小 [图 7B] 。新的 cluser 方案与基线相比，ARI 降低 [图 7C]。</section></li></ul><blockquote data-tool="mdnice编辑器"><p>备注：</p><ol><li><section>[图 8C] 中的红线作者标偏了，应该指向 cluster 10</section></li><li><section>作者使用的注释方法为，使用了预先设定的 gene list, 并把这些 gene list 存储为 txt 格式。再根据现有 cluster 的基因与设定的基因集的相似性来进行注释。</section></li></ol></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>5. Identification of highly variable features (feature selection)</span></h2><pre data-tool="mdnice编辑器"><span></span><code>pbmc &lt;- FindVariableFeatures(pbmc, selection.method = <span>"vst"</span>, nfeatures = <span>2000</span>)<br><br><span># Identify the 10 most highly variable genes</span><br>top10 &lt;- head(VariableFeatures(pbmc), <span>10</span>)<br><br><span># plot variable features with and without labels</span><br>plot1 &lt;- VariableFeaturePlot(pbmc)<br>plot2 &lt;- LabelPoints(plot = plot1, points = top10, repel = <span>TRUE</span>)<br>plot1 + plot2<br></code></pre><h3 data-tool="mdnice编辑器"><span></span>5.1 找高变基因的方法<span></span></h3><p data-tool="mdnice编辑器">在 Seurat 中，有三种找高变基因的方法，分别是 vst、mean.var.plot 和 dispersion。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.30185185185185187" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyA35ibDpzssSOutvWM8qPbEAOcm4R0ibaZPODUh0eiboZIRkaIP4ZNJK2jQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyA35ibDpzssSOutvWM8qPbEAOcm4R0ibaZPODUh0eiboZIRkaIP4ZNJK2jQ/640?wx_fmt=png"></figure><center data-tool="mdnice编辑器">图 9 三种寻找高变基因方法的基因及聚类情况</center><figure data-tool="mdnice编辑器"><img data-ratio="0.3787037037037037" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAN7mVJ6Z0RbNvuXfoaIHjE3M70z0fJNLia4hRNPvLag0P1M3JxXqvd2w/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAN7mVJ6Z0RbNvuXfoaIHjE3M70z0fJNLia4hRNPvLag0P1M3JxXqvd2w/640?wx_fmt=png"></figure><center data-tool="mdnice编辑器">图 10 三种寻找高变基因方法的降维聚类情况</center><ul data-tool="mdnice编辑器"><li><section>三种方法能够找到的高变基因各不相同（vst: 1125、 mean.var.plot: 818、dispersion: 1125），其中三种方法共同找到的基因数为 439 (25%) ，有一半被确定为可变的基因只能被一种方法确定（871/1750=50%） [图 9A]。</section></li><li><section>即使有这些不同的可变基因集，检测到的 cluster 数目是相似的[图 9B]，只有 2%的细胞被不一致地注释 [图 9C]。</section></li><li><section>[图 9D]显示，mean.var.plot 和 dispersion 相较于 vst 的 ARI 较低，根据[图 10] 的 TSNE 降维图可以看出，细胞分配到 cluster 的情况确实不同。基于 TSNE 的可视化，我们根据它们之间的视觉接近程度，手动将 cluster 分配到大的分群中[图 10A-C]。超过 96%的细胞被置于一致的大的 cluster 中。</section></li></ul><h3 data-tool="mdnice编辑器"><span></span>5.2 vst 的参数 loess span 选择<span></span></h3><p data-tool="mdnice编辑器">因为 vst 方法使用局部多项式回归（loess），所以需要一个输入参数是 loess span。在这里对比了 loess span 的默认值 0.3，以及 0.1 和 0.5 的区别。同时也比较了不同的分箱策略的影响：</p><figure data-tool="mdnice编辑器"><img data-ratio="1.2008995502248876" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAe6gib3wLricxh9aEfWNlmGs3b02dJ9s1oYoCOFQ69IlN1nqjUKCeAQUw/640?wx_fmt=png" data-type="png" data-w="667" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAe6gib3wLricxh9aEfWNlmGs3b02dJ9s1oYoCOFQ69IlN1nqjUKCeAQUw/640?wx_fmt=png"></figure><center data-tool="mdnice编辑器">图 11 不同参数选择对于聚类数目、亚群数量和异质性的比较</center><p data-tool="mdnice编辑器">[图 11]中 A，D，G 为 cluster 数；B，E，H 为细胞注释相似度；C，F，I 为 ARI 值</p><ul data-tool="mdnice编辑器"><li><section>A, B, C 比较 loess span 为 0.3（基线）到 0.1 和 0.5 的差异</section></li><li><section>D, E, F 比较了 bin 数为 20（基线）到 1，10 和 100 的差异</section></li><li><section>G, H, I 比较了使用等宽（基线）到等频的分箱方法</section></li></ul><p data-tool="mdnice编辑器">结果显示，loess span、bin 数以及分箱方法对于 cluster 数目、细胞注释和 ARI 的值没有明显的影响。</p><h3 data-tool="mdnice编辑器"><span></span>5.3 调整高变基因数据<span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="0.3855421686746988" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyA2ia44SCJGun7ic196TdmakkqIJjq5w3ukovmCwKXxRL6hgHxbHTicGMxA/640?wx_fmt=png" data-type="png" data-w="996" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyA2ia44SCJGun7ic196TdmakkqIJjq5w3ukovmCwKXxRL6hgHxbHTicGMxA/640?wx_fmt=png"></figure><center data-tool="mdnice编辑器">图 12 不同高变基因数目对于聚类数目、亚群数量和异质性的比较</center><p data-tool="mdnice编辑器">作者在这里，使用了三种不同的高变基因数目，分别为所有检测到的基因的 6.7%、1%和 20%。原因为，如果检测到15,000个基因，6.7% 就会产生一个约1000个可变基因的列表，但是这种选择没有生物学依据，只是为了对比不同数目的可变基因对于聚类的影响。</p><p data-tool="mdnice编辑器">[图 12] 条形图显示了使用 1,125 （6.7%）的可变基因列表与 168 个基因（1%）和 3,358 个基因（20%）相比在 cluster 数目、相似度和 ARI 的差异。结果提示：</p><ul data-tool="mdnice编辑器"><li><section>可变基因列表减少到总基因的1%对聚类有很大影响 [图 12B-C]</section></li><li><section>将可变基因列表增加到所有基因的20%，产生了与使用6.7%基因的基线分析类似的 cluster 方案 [图 12A-C]</section></li></ul><h2 data-tool="mdnice编辑器"><span></span><span>6. Scaling the data</span></h2><p data-tool="mdnice编辑器">ScaleData 也是一句代码：</p><pre data-tool="mdnice编辑器"><span></span><code>all.genes &lt;- rownames(pbmc)<br>pbmc &lt;- ScaleData(pbmc, features = all.genes)<br></code></pre><p data-tool="mdnice编辑器">因为使用 all.genes 来做<code>ScaleData</code>的话，占用内存非常多。<code>ScaleData</code>的主要是为了后续的 PCA 降维和使用<code>DoHeatmap</code>画图，但是画热图一般后续使用 ComplexHeatmap 或者 Pheatmap 会比较多，因此只需要对高变基因进行 Scale 即可：</p><pre data-tool="mdnice编辑器"><span></span><code><span>## 默认就是使用高变基因</span><br>pbmc &lt;- ScaleData(pbmc)<br></code></pre><p data-tool="mdnice编辑器">在<code>ScaleData</code>这一步，比较困扰的就是 vars.to.regress 这个参数，到底什么样的参数需要回归是困扰新手的一个重要问题，在不同文章中也存在不同的设置，例如：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.1592920353982301" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAX00SrG06uib2EoMcjBvLIubpJQ7SHAzrrtPjIaz1sZV8noA6iaXpUT6Q/640?wx_fmt=png" data-type="png" data-w="904" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAX00SrG06uib2EoMcjBvLIubpJQ7SHAzrrtPjIaz1sZV8noA6iaXpUT6Q/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><p>Jin SZ et al. <em>Cell Res</em>. 2020</p></blockquote><figure data-tool="mdnice编辑器"><img data-ratio="0.15526601520086863" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyA6gIyicdXEJmv1ZdLDhpkem40Giae9b26vcBOV00BVPjTwVA0jHvhibnYg/640?wx_fmt=png" data-type="png" data-w="921" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyA6gIyicdXEJmv1ZdLDhpkem40Giae9b26vcBOV00BVPjTwVA0jHvhibnYg/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><p>Chen YP et al. <em>Cell Res</em>. 2020</p></blockquote><figure data-tool="mdnice编辑器"><img data-ratio="0.2611336032388664" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAotepanzDKAC9jMpanZRicLVP3LWV1kLUmCCcWKVObylad5EVOiaOkLCg/640?wx_fmt=png" data-type="png" data-w="988" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAotepanzDKAC9jMpanZRicLVP3LWV1kLUmCCcWKVObylad5EVOiaOkLCg/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><p>Bassez A et al. <em>Nat Med</em>. 2021</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code>pbmc &lt;- ScaleData(pbmc, vars.to.regress = <span>"percent.mt"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.4363438520130577" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyA3x901wYE8xsUia5SPlk1ISIojATfmsmml1AAp1V3uw1r89LuuzdN1wQ/640?wx_fmt=png" data-type="png" data-w="919" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyA3x901wYE8xsUia5SPlk1ISIojATfmsmml1AAp1V3uw1r89LuuzdN1wQ/640?wx_fmt=png"></figure><center data-tool="mdnice编辑器">图10 回归参数选择对于聚类数目、亚群数量和异质性的比较</center><p data-tool="mdnice编辑器">在文章中，作者比较了不回归参数、回归 total UMI count、线粒体基因以及回归 total UMI count 和线粒体基因的区别，结果显示得到的 cluster 数目非常类似，且97%的细胞都可以被指定都同一个细胞类型[图 10A 和图 10B]。但是，[图 10C]显示，相比于回归 total UMI count、线粒体基因两项来说，回归线粒体和不回归参数的 ARI 低于 0.8，且回归线粒体和不回归的聚类情况、分群数目都比较相似，因此这提示了<span>增加回归线粒体基因并不会对结果有太大的影响</span>。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.4369230769230769" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAh1RGA2qKGQ7ex2lfdKcaF3Fn2HMS2ceAuwcyicSiaTXYviaNeFGCiaDeFg/640?wx_fmt=png" data-type="png" data-w="650" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAh1RGA2qKGQ7ex2lfdKcaF3Fn2HMS2ceAuwcyicSiaTXYviaNeFGCiaDeFg/640?wx_fmt=png"></figure><center data-tool="mdnice编辑器">图11 scale值的选择对于聚类数目、亚群数量和异质性的比较</center><p data-tool="mdnice编辑器"><code>ScaleData</code>中需要一个 maximum scale value，默认为 10 或 50。作者比较发现，10 和 100 对于聚类没有太大的影响 [图 11]。</p><h2 data-tool="mdnice编辑器"><span></span><span>小结一下</span></h2><ul data-tool="mdnice编辑器"><li><section>标准化的方法会显著影响聚类结果，且显著高于改变 scale factor 的结果；</section></li><li><section>增加高变基因数目并不会显著影响聚类效果（~1000 到~3000）,但是降低到~1000 到~125 会影响聚类效果；</section></li><li><section>回归 UMI count 对于结果有比较大的影响，但是回归线粒体数的影响较小；</section></li><li><section>改变 maximum scale value 不会显著影响聚类效果</section></li></ul><p data-tool="mdnice编辑器">后续 RunPCA---&gt;FindNeighbors---&gt;FindClusters---&gt;RunUMAP 中，还有几个非常重要的参数会影响实际的聚类效果，包括 PC 数、k-parameter、prune parameter 和 resolution parameter，考虑到这些参数在后续的降维聚类中息息相关，因此，我将在<code>下一篇帖子</code>中统一进行讨论。</p><h2 data-tool="mdnice编辑器"><span></span><span>往期回顾</span></h2><figure data-tool="mdnice编辑器"><img data-ratio="0.38372093023255816" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAYgHq3gDWswjRREEADnroBZ8otNxYy1L5iadO6PO96PBj9xd5sheccaw/640?wx_fmt=png" data-type="png" data-w="774" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAYgHq3gDWswjRREEADnroBZ8otNxYy1L5iadO6PO96PBj9xd5sheccaw/640?wx_fmt=png"><figcaption>服务器推荐</figcaption></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.3619550858652576" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAfyctWNr4bYkAD4xVuFNA7hsEEoxzBTn0srMnK2gj73Cc42MBmlqadw/640?wx_fmt=png" data-type="png" data-w="757" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAfyctWNr4bYkAD4xVuFNA7hsEEoxzBTn0srMnK2gj73Cc42MBmlqadw/640?wx_fmt=png"><figcaption>论文润色与查重</figcaption></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.4465909090909091" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAqanVCYceINDvvqLw2Y8Trg2MF6jQ6qOR2icg2s1hj5JcAesYOXv2NjA/640?wx_fmt=png" data-type="png" data-w="880" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAqanVCYceINDvvqLw2Y8Trg2MF6jQ6qOR2icg2s1hj5JcAesYOXv2NjA/640?wx_fmt=png"><figcaption>免费视频教程</figcaption></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.4502868068833652" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAOX0iaeKZEzlK39nOvhvNQYrT5rdbibopibE8Ppic8o41tHeAdM2ykpicHiag/640?wx_fmt=png" data-type="png" data-w="1046" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2YTHUh0lWgfZweTn8k9yYyAOX0iaeKZEzlK39nOvhvNQYrT5rdbibopibE8Ppic8o41tHeAdM2ykpicHiag/640?wx_fmt=png"><figcaption>400页免费资源</figcaption></figure></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/VJ4lHzjXcJwefmVlJAi0ig",target="_blank" rel="noopener noreferrer">原文链接</a>
