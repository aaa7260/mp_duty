---
title: "tRFdb-tsRNA数据库爬虫下载fa序列"
date: 2023-07-08T23:41:46Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
tRFdb-tsRNA数据库爬虫下载fa序列 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">目前大多数的tsRNA数据库基本上都没有提供数据下载的接口，比如 <span>tRFdb：http://genome.bioch.virginia.edu/trfdb/</span></p><p data-tool="mdnice编辑器">官网如下：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.6759259259259259" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9XdefXI9CrKgSkypZMoyqibHtRE1onhynibAhicjeLOsTaARic3ybCn235x2jiaG1rUEKPicjGlibnibeL6Q/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9XdefXI9CrKgSkypZMoyqibHtRE1onhynibAhicjeLOsTaARic3ybCn235x2jiaG1rUEKPicjGlibnibeL6Q/640?wx_fmt=png"><figcaption>image-20230708124006708</figcaption></figure><p data-tool="mdnice编辑器">此数据库主要使用GEO与NCBI SRA数据库的small RNA high-throughput sequencing data进行tsRNA鉴定，提供了八大物种：</p><ul data-tool="mdnice编辑器"><li><section>Rhodobacter sphaeroides (Bacteria;ATCC 17025) 类球红细菌</section></li><li><section>Schizosaccharomyces pombe (schiPomb1) 粟酒裂殖酵母</section></li><li><section>Drosophila (dm3) 果蝇</section></li><li><section>Caenorhabditis elegans (ce6)</section></li><li><section>秀丽隐杆线虫Xenopus(xenTro3)</section></li><li><section>爪蟾zebra fish (Zv9) 斑马鱼</section></li><li><section>mouse (mm9) 小鼠</section></li><li><section>human(hg19) 人</section></li></ul><p data-tool="mdnice编辑器">的tsRNA数据可以进行查询。目前数据库可以提供以下几种查询方式：tRF类型，tRF ID以及一段序列。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.36663524976437323" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9XdefXI9CrKgSkypZMoyqibfPNC8ib0SweTQPcNlNDdAqJ3W27oFXYQTKDibAp4ibOLUicXUt0icZvOicCg/640?wx_fmt=png" data-type="png" data-w="1061" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9XdefXI9CrKgSkypZMoyqibfPNC8ib0SweTQPcNlNDdAqJ3W27oFXYQTKDibAp4ibOLUicXUt0icZvOicCg/640?wx_fmt=png"><figcaption>image-20230708125449480</figcaption></figure><p data-tool="mdnice编辑器">此次，我们的目的就是从这个数据库里以Human为例，把数据库中的tRF ID与Sequence提取下来。</p><p data-tool="mdnice编辑器">首先，tRF Type选择tRF-5，物种选择Human，然后点击Get tRFs，就会得到以下页面：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.7129629629629629" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9XdefXI9CrKgSkypZMoyqibd3BbOEjLwpEhuDuFf81dgTHngDNtGkibnAKsGYGdFiag2ouBI9TbMXyw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9XdefXI9CrKgSkypZMoyqibd3BbOEjLwpEhuDuFf81dgTHngDNtGkibnAKsGYGdFiag2ouBI9TbMXyw/640?wx_fmt=png"><figcaption>image-20230708125744208</figcaption></figure><p data-tool="mdnice编辑器">此页面，单击鼠标右键，查看网页源码：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.562962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9XdefXI9CrKgSkypZMoyqibFO5hdf7DpZHF3D8ajSnMe5k6xojY0dLvCzySzHHShOwCWuf2lKvkXw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9XdefXI9CrKgSkypZMoyqibFO5hdf7DpZHF3D8ajSnMe5k6xojY0dLvCzySzHHShOwCWuf2lKvkXw/640?wx_fmt=png"><figcaption>image-20230708130044227</figcaption></figure><p data-tool="mdnice编辑器">得到下面源码页面：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.524074074074074" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9XdefXI9CrKgSkypZMoyqibnNxicCdIj47AQiaDfQAR1ViacBJNS1wFnojzibrohbBdEwSxjRH4FbcTCw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9XdefXI9CrKgSkypZMoyqibnNxicCdIj47AQiaDfQAR1ViacBJNS1wFnojzibrohbBdEwSxjRH4FbcTCw/640?wx_fmt=png"><figcaption>image-20230708152320756</figcaption></figure><p data-tool="mdnice编辑器">将此页面保存下来，ctrl+s，另存为：view-source_genome.bioch.virginia.edu_trfdb_search.php-Human-tRF-5.html</p><p data-tool="mdnice编辑器">上面的搜索页面，选择一个Sequence，点击进去，页面如下，可以看到我们想要的信息都在这里，然后观察这个页面可以看到网址的特点：http://genome.bioch.virginia.edu/trfdb/sequence_display.php?seq_id=15011</p><p data-tool="mdnice编辑器">由固定的http://genome.bioch.virginia.edu/trfdb/sequence_display.php?seq_id=加上seq_id。</p><p data-tool="mdnice编辑器">在结合上面那个表格，就可以把所有数据都薅下来了。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.31203703703703706" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9XdefXI9CrKgSkypZMoyqibGKO2V5FCTic32pYjB1uIvefGJaWFFo0avbBh3Bg7texALOMnBFvLxYQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9XdefXI9CrKgSkypZMoyqibGKO2V5FCTic32pYjB1uIvefGJaWFFo0avbBh3Bg7texALOMnBFvLxYQ/640?wx_fmt=png"><figcaption>image-20230708125815235</figcaption></figure><p data-tool="mdnice编辑器">下面是代码部分：</p><pre data-tool="mdnice编辑器"><code>rm(list=ls())<br><span># R 里面重要的一个读取网页的扩展包</span><br>library(RCurl) <br>library(dplyr) <br>library(rvest)<br>library(tidyverse)<br><br>opt &lt;- list(html = <span>"view-source_genome.bioch.virginia.edu_trfdb_search.php-Human-tRF-5.html"</span>,<br>            organism = <span>"human"</span>,<br>            <span>type</span> = <span>"trf-5"</span>,<br>            od = <span>"./"</span>)<br><br>html &lt;- read_html(opt<span>$html</span>)<br>html &lt;- html_text(html)<br><br><span>#提取出所有匹配的内容</span><br><span>#以矩阵形式返回所有匹配到的内容，并将每一行元素个数统一，不够的用""空字符串表示</span><br><span>#此处的正则表达式有小改动，以便演示能匹配到多个的情况</span><br><span>type</span> &lt;- opt<span>$type</span><br>trf_id &lt;- t(str_extract_all(html,<span>"trf_id=[0-9]+[a-z]*"</span>,simplify = T))<br>Organism &lt;- t(str_extract_all(html,<span>"organism=[a-z]+"</span>,simplify = T))<br>tRNA_Gene_Coordinates &lt;- t(str_extract_all(html,<span>"chr.{1,2}-[0-9]+-[0-9]+"</span>,simplify = T))<br>tRNA_Name &lt;- t(str_extract_all(html,<span>"chr.{1,2}\\.trna[0-9]+-.{1,6}"</span>,simplify = T))<br>seq_id &lt;- t(str_extract_all(html,<span>"seq_id=[0-9]+"</span>,simplify = T))<br>seq_id_1 &lt;- gsub(<span>"seq_id="</span>, <span>""</span>, seq_id)<br>url &lt;- paste0(<span>"http://genome.bioch.virginia.edu/trfdb/sequence_display.php?"</span>, seq_id)<br><br><span>## combine the result</span><br>res &lt;- data.frame(trf_id, Organism, <span>type</span>, tRNA_Gene_Coordinates, tRNA_Name, seq_id=seq_id_1, url, check.names = F)<br>res &lt;- unique(res)<br><br><span>## get trf fastq and id from seq_id_url</span><br>tRF_ID &lt;- NULL<br>Organism_1 &lt;- NULL<br>Sequence &lt;- NULL<br>Map_Position &lt;- NULL<br><br><span>for</span>(i <span>in</span> 1:nrow(res)){<br>  dir.create(paste0(opt<span>$od</span>, <span>"seq_id/"</span>))<br>  out &lt;- paste0(opt<span>$od</span>, <span>"./seq_id/"</span>, res<span>$seq_id</span>[i])<br>  <span>if</span>(!file.exists(out)){<br>    download.file(res<span>$url</span>[i], cacheOK = T, destfile=out, method = <span>"curl"</span>)<br>  }<br>  <br>  b &lt;- html_text(read_html(out))<br>  tRF_ID[i] &lt;- str_extract(b,<span>"tRF ID: [0-9]+[a-z]*"</span>)<br>  Organism_1[i] &lt;- str_extract(b,<span>"Organism: [a-z]{1,5}"</span>)<br>  Sequence[i] &lt;- str_extract(b,<span>"Sequence: [ATGCN]+"</span>)<br>  Map_Position[i] &lt;- str_extract(b,<span>"Map Position: [0-9]+-[0-9]+"</span>)<br>}<br><br><span>## final result</span><br>res_final &lt;- cbind(res, tRF_ID, Organism_1, Sequence, Map_Position)<br><br>out_file &lt;- paste0(opt<span>$od</span>, <span>"/tRFdb_"</span>, opt<span>$organism</span>, <span>"_"</span>, opt<span>$type</span>, <span>"_infor.txt"</span>)<br>write.table(res_final, file = out_file, row.names = F,sep = <span>"\t"</span>,quote = F)<br></code></pre><p data-tool="mdnice编辑器">结果如下：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.2037037037037037" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9XdefXI9CrKgSkypZMoyqibodRS8lQzbibM5jPcsyujoLDTOZCnb3icDVRlMian7v7dSfr8jnibXYm6XQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9XdefXI9CrKgSkypZMoyqibodRS8lQzbibM5jPcsyujoLDTOZCnb3icDVRlMian7v7dSfr8jnibXYm6XQ/640?wx_fmt=png"><figcaption>image-20230708154152626</figcaption></figure><p data-tool="mdnice编辑器">此外，tRF-3与tRF-1的结果也可类似，愉快的下载下来了~</p></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/E0esWkyuA50MsgEsQfcwTg",target="_blank" rel="noopener noreferrer">原文链接</a>
