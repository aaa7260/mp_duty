---
title: "精彩！洲更的Linux服务器管理直播课来了！"
date: 2023-07-24T02:47:25Z
draft: ["false"]
tags: [
  "fetched",
  "果子学生信"
]
categories: ["Acdemic"]
---
精彩！洲更的Linux服务器管理直播课来了！ by 果子学生信
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">很早之前，在群里问了下希望我直播展示什么技能，大部分都提到Linux的管理课，加上最近果子老师的忙前忙后的帮一部分学员解决了服务器问题。但是不能光有服务器，而没有服务器管理的能力，因此就有了做完这次直播课。</p><p data-tool="mdnice编辑器">这次直播长达4个小时，一直从8点到了12点，我个人觉得全程都是干货，即便是一些等待时间，也是分享了很多小技巧，也非常感谢那些一直陪伴到下播的小伙伴。</p><p data-tool="mdnice编辑器">为了帮助大家复习，我赶紧的整理了下我昨晚的直播内容</p><p data-tool="mdnice编辑器">第一部分，是回顾了大家所想要了解的问题（下述的几点内容由大语言模型汇总）</p><ol data-tool="mdnice编辑器"><li><section>服务器的基本概念：</section></li><ol><li><section>如服务器的基本结构，节点，端口的概念等。</section></li></ol><li><section>服务器的基本设置和管理：</section></li><ol><li><section>如何配置新服务器，</section></li><li><section>如何管理服务器，如何分配账户并确保他们互不访问，</section></li><li><section>如何全局安装软件让所有人都可以使用，</section></li><li><section>以及服务器管理员的常用操作等。</section></li></ol><li><section>软件的安装和使用：安装和版本管理</section></li><ol><li><section>如何在服务器上安装和使用各种软件，如R, Rstudio, Jupyter notebook等，</section></li><li><section>如何在服务器上使用不同版本的R和Python等。</section></li></ol><li><section>数据管理：</section></li><ol><li><section>如何下载和安装各种数据，</section></li><li><section>如何在Linux下进行相关分析，</section></li><li><section>如何在Linux下挂载后台运行及查看进度，</section></li><li><section>如何管理大量数据集等。</section></li></ol><li><section>工作环境的搭建：</section></li><ol><li><section>如何搭建生信分析或者对接课程的工作环境，</section></li><li><section>如何搭建单细胞下游分析工作环境，</section></li><li><section>如何创建网页版Rstudio和Python notebook以供外人访问等。</section></li></ol><li><section>文件传输和存储：</section></li><ol><li><section>如何用FileZilla或其他工具上传文件到服务器，</section></li><li><section>上传的文件在Python中如何找到</section></li><li><section>数据文件如何存储和管理等。</section></li></ol></ol><p data-tool="mdnice编辑器">实际上关键点就两个，一个是怎么管理好多个用户，一个是怎么安装好软件。因此昨晚的直播课也就是侧重这两点。</p><h2 data-tool="mdnice编辑器"><span></span><span>第一部分：服务器和Linux的了解</span></h2><p data-tool="mdnice编辑器">在这一部分，我主要给大家简答科普了目前的服务器的类型，以及与我们当前用到的笔记本、台式机的区别。</p><p data-tool="mdnice编辑器">需要知道的几点</p><ol data-tool="mdnice编辑器"><li><section>服务器性能不一定比台式机强</section></li><li><section>服务器一般来说都是为了完成某个特定目标，比如说网页服务器，而我们用的电脑则是常用来执行多种不同的任务</section></li><li><section>服务器有物理服务器和虚拟服务器两类，虚拟服务器一般指的是将一个物理服务器的资源虚拟化，有效利用资源的一种。</section></li><li><section>大厂的云服务器比较贵。不建议购买云服务器做计算任务。</section></li><li><section>Linux是服务器上最常用的一种操作系统</section></li><li><section>Linux有两种主要发行版本，一种是CentOS，一种是ubuntu。</section></li><li><section>从后续的直播结果来看，请大家在装服务器系统的时候，尽量装最新的Ubuntu。云服务器的CentOS可能还是7，因此除非你对自己的管理能力很自信，否则慎选。</section></li></ol><h2 data-tool="mdnice编辑器"><span></span><span>第二部分：服务器的交互</span></h2><p data-tool="mdnice编辑器">服务器访问三要素是</p><ol data-tool="mdnice编辑器"><li><section>用户名</section></li><li><section>IP地址，或者域名</section></li><li><section>端口号</section></li></ol><p data-tool="mdnice编辑器">即便很多时候你没有写端口，那也是有一个默认端口22的。</p><p data-tool="mdnice编辑器">我觉得经过我很多次强调，上过我Linux课的人，都知道这三要素了。</p><p data-tool="mdnice编辑器">与服务器交互的两种最常见方式是：SSH登录和SFTP数据传输。</p><p data-tool="mdnice编辑器">在Windows上，我认为的最佳组合就是XSHELL和XFTP</p><figure data-tool="mdnice编辑器"><img data-ratio="0.6583333333333333" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/NDy5aEnReX2gFzMvA6pHS2lLsQzE0xsPCV8Yu2q46icsTK3pQzqvTibTZ495auPNvubXR4pRhx3dicEZbdwH29LFA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/NDy5aEnReX2gFzMvA6pHS2lLsQzE0xsPCV8Yu2q46icsTK3pQzqvTibTZ495auPNvubXR4pRhx3dicEZbdwH29LFA/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">而在MacOS和Linux上，我自己偏好自带终端和FileZilla。由于FileZilla是跨平台的软件，所以实际上我在Windows上也会用。</p><figure data-tool="mdnice编辑器"><img data-ratio="1.0018796992481203" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/NDy5aEnReX2gFzMvA6pHS2lLsQzE0xsPhuwjr9pUYkK68RFm4tVhVNeueseMr10riaKBz3LbEqbODzdjicVB2XwQ/640?wx_fmt=png" data-type="png" data-w="532" src="https://mmbiz.qpic.cn/sz_mmbiz_png/NDy5aEnReX2gFzMvA6pHS2lLsQzE0xsPhuwjr9pUYkK68RFm4tVhVNeueseMr10riaKBz3LbEqbODzdjicVB2XwQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">当然，还有其他一些东西可选，例如FinalShell。</p><h2 data-tool="mdnice编辑器"><span></span><span>第三部分：权限管理</span></h2><p data-tool="mdnice编辑器">这部分知识，在我们Linux实战课虽然提到过，但实际上大家都没有什么特别的感悟，因此这里，我给了一个非常复杂的例子</p><p data-tool="mdnice编辑器">需求：</p><ul data-tool="mdnice编辑器"><li><section>创建三个用户，xzg1, xzg2,xzg3, 位于/home/xzg下， 属于xzg组</section></li><li><section>创建三个用户，gsp1, gsp2, gsp3，位于/home/gsp下，属于gsp组</section></li><li><section>创建1个用户，visitor，位于/home/visitor下，属于visitor组</section></li><li><section>创建一个组，叫做gzdlab, xzg1, xzg2,xzg3, gsp1,gsp2,gsp3都属于gzdlab</section></li><li><section>xzg组之间可以相互访问，gsp组之间可以相互访问，xzg和gsp之间不能相互访问</section></li><li><section>创建一个私人目录，/data/private_data,  gzdlab组的人可以访问，并编辑里面的内容，其他用户可以访问，但是不能编辑内容</section></li><li><section>创建一个公共目录，/data/public_data, 所有人都可以访问，都可以编辑内容</section></li></ul><p data-tool="mdnice编辑器">这个例子在直播课有了非常好的演示。只不过在操作同时，还演示了一些内容外的东西，这要是我就觉得直播课相对于我写文字教程，有趣的地方。</p><p data-tool="mdnice编辑器">我在用xzg1使用sudo时候，遇到了权限的问题，于是我带了大家学习用户让一个普通用户能够使用sudo。在Ubuntu和CentOS中，添加sudo用户是不太一样的操作。Ubuntu用的是<code>usermod</code>把用户加到sudo组中，而CentOS则是用visudo在配置文件中加上用户。</p><p data-tool="mdnice编辑器">遇到之前的需求，我们解决方法如下</p><p data-tool="mdnice编辑器">第一步，创建用户和用户组：</p><pre data-tool="mdnice编辑器"><span></span><code>sudo groupadd xzg<br>sudo groupadd gsp<br><br>sudo mkdir /home/xzg<br>sudo mkdir /home/gsp<br><br>sudo useradd -m -d /home/xzg/xzg1 -g xzg xzg1<br>passwd xzg1<br><br>sudo useradd -m -d /home/xzg/xzg2 -g xzg xzg2<br>sudo useradd -m -d /home/xzg/xzg3 -g xzg xzg3<br><br>sudo useradd -m -d /home/gsp/gsp1 -g gsp gsp1<br>sudo useradd -m -d /home/gsp/gsp2 -g gsp gsp2<br>sudo useradd -m -d /home/gsp/gsp3 -g gsp gsp3<br></code></pre><p data-tool="mdnice编辑器">创建合作组，gzdlab，用于加上xzg和gsp的成员。</p><pre data-tool="mdnice编辑器"><span></span><code><span># 创建组</span><br>sudo  groupadd gzdlab<br><br><span># 将用户添加到组</span><br><span>for</span> user <span>in</span> xzg1 xzg2 xzg3 gsp1 gsp2 gsp3; <span>do</span><br>    sudo  usermod -a -G gzdlab <span>${user}</span><br><span>done</span><br></code></pre><p data-tool="mdnice编辑器">之后，设置xzg和gsp用户组的访问权限：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 更改所有者</span><br><span># 前面的冒号表示只更改所属组，而不更改所有者。</span><br>sudo chown -R :xzg /home/xzg<br>sudo chown -R :gsp /home/gsp<br><br>sudo chmod -R 770 /home/xzg<br>sudo chmod -R 770 /home/gsp<br></code></pre><p data-tool="mdnice编辑器">为了方便数据的管理，我们创建了两个文件夹：</p><pre data-tool="mdnice编辑器"><span></span><code>sudo mkdir -p /data/private_data<br>sudo mkdir -p /data/public_data<br></code></pre><p data-tool="mdnice编辑器">设置文件夹权限：</p><pre data-tool="mdnice编辑器"><span></span><code>sudo chown -R :gzdlab /data/private_data<br>sudo chmod -R 770 /data/private_data<br>sudo chmod -R 777 /data/public_data<br></code></pre><p data-tool="mdnice编辑器">当然上述一般来说，可能都是管理非常复杂的情况，更多的是帮助我们理解什么叫做用户权限。但是在真实世界中，我们可能就只会做两步，</p><p data-tool="mdnice编辑器">第一步，创建用户，给他分配一些资源。</p><pre data-tool="mdnice编辑器"><span></span><code>useradd -m -d /home/用户名 用户名<br>passwd 用户名<br></code></pre><p data-tool="mdnice编辑器">第二步，创建一个公共的目录，放数据，让他去复制</p><pre data-tool="mdnice编辑器"><span></span><code>mkdir /data/public_data<br>chmod -R 777 /data/public_data<br></code></pre><p data-tool="mdnice编辑器">简单的说，就是把数据分成自己的和公共的两类。</p><p data-tool="mdnice编辑器">这一部分交给大家的作业就是，回顾整理下用户管理、用户组管理和权限管理的几个Linux命令。</p><h2 data-tool="mdnice编辑器"><span></span><span>第四部分：软件安装</span></h2><p data-tool="mdnice编辑器">这部分，我强烈推荐大家去看我之前录制的一个课程，【生物信息必修课之软件安装】(https://www.bilibili.com/video/BV1JJ411p7fX/)，</p><p data-tool="mdnice编辑器"><br></p><p data-tool="mdnice编辑器">那个实际上就是我在2016-2017 搞服务器的软件安装的折腾历史。虽然时间有点久了，但是我觉得底层的思想还是没变的。希望大家搭配这直播课共同食用。</p><p data-tool="mdnice编辑器">回到我们直播课，我们先强调了环境变量，PATH的重要性，可执行文件都是通过这个PATH来找到执行路径的。</p><p data-tool="mdnice编辑器">但是PATH是如何加载的呢？我们介绍了配置文件的加载过程，特别的，我们强调了 为什么有些时候，你已经把PATH添加到<code>~/.bashrc</code>  中，但是依旧不起作用的原因。</p><p data-tool="mdnice编辑器">这里我找到了一张更好的图（来源：https://youngstone89.medium.com/unix-introduction-bash-startup-files-loading-order-562543ac12e9），来说明这个加载过程。</p><figure data-tool="mdnice编辑器"><img data-ratio="1.0473856209150327" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/NDy5aEnReX2gFzMvA6pHS2lLsQzE0xsP3O5h2mib6kRdmlQADicUyicCwwrChaAMxFLgyUyRibKKGxltoibfeeibeqhA/640?wx_fmt=png" data-type="png" data-w="612" src="https://mmbiz.qpic.cn/sz_mmbiz_png/NDy5aEnReX2gFzMvA6pHS2lLsQzE0xsP3O5h2mib6kRdmlQADicUyicCwwrChaAMxFLgyUyRibKKGxltoibfeeibeqhA/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">通常来说，如果我们用的是终端登录，我们就是以 <code>/ect/profile</code>→<code>~/.bash_profile</code> 来启动配置文件，而<code>~/.bashrc</code>通常是由<code>~/.bash_profile</code>调用。</p><p data-tool="mdnice编辑器">接着，为了介绍如何全局安装软件，我们讲了两个例子</p><ul data-tool="mdnice编辑器"><li><section>CellRanger</section></li><li><section>seqkit</section></li></ul><p data-tool="mdnice编辑器">大家可以自己回去练习下</p><p data-tool="mdnice编辑器">当然，软件安装的重头戏还是R语言和RStudio的配置。</p><p data-tool="mdnice编辑器">在R语言的安装上，我推荐的是用编译的方式安装，这样子，你可以保证，你自己安装多个版本的R，并保持他们共存。</p><p data-tool="mdnice编辑器">直播课中，我介绍4.1.3和4.3.1的编译安装</p><pre data-tool="mdnice编辑器"><span></span><code><span># 4.3.1</span><br>wget https://mirrors.tuna.tsinghua.edu.cn/CRAN/src/base/R-4/R-4.3.1.tar.gz<br>tar xf R-4.3.1.tar.gz<br>./configure --prefix=/opt/R-4.3.1 --<span>enable</span>-R-shlib --with-blas --with-lapack<br>make -j<br>sudo make install<br><br><span>#4.1.3</span><br>wget https://mirrors.tuna.tsinghua.edu.cn/CRAN/src/base/R-4/R-4.1.3.tar.gz<br>tar xf R-4.1.3.tar.gz<br>./configure --prefix=/opt/R-4.1.3 --<span>enable</span>-R-shlib --with-blas --with-lapack <br>make -j <br>sudo make install<br><br><br></code></pre><p data-tool="mdnice编辑器">不过在安装过程中，我们出现了几个意外（放心，都在我的掌控之中）</p><p data-tool="mdnice编辑器">首先，依赖环境不全，因此在configure的过程中，反复报错，我这里总结了CentOS和Ubuntu的一些必装的内容CentOS</p><pre data-tool="mdnice编辑器"><span></span><code>yum group install <span>"Development tools"</span><br>yum install libX11-devel <br>yum install libXt-devel <br>yum install readline-devel<br>yum install xz xz-devel <br>yum install pcre pcre-devel<br>yum install libcurl-devel<br>yum install texlive<br>yum install java-1.8.0-openjdk<br>yum install *gfortran*<br>yum install zlib*<br>yum install bzip2-*<br></code></pre><p data-tool="mdnice编辑器">Ubuntu</p><pre data-tool="mdnice编辑器"><span></span><code><br><br>sudo apt-get update<br>sudo apt-get install build-essential<br>sudo apt-get install zlib1g-dev libreadline-dev libcurl4-openssl-dev \<br>    libpcre2-dev libbz2-dev liblzma-dev \<br>    libxml2-dev libcairo2-dev<br>sudo apt-get install xorg-dev<br>sudo apt-get install texlive-base texlive-latex-extra texlive-fonts-recommended<br><br><span># java支持, 可以不用</span><br>sudo apt-get install default-jdk<br><br></code></pre><p data-tool="mdnice编辑器">还有一个意外的就是，centOS7因为太老了，安装4.3.1的时候，还得加上<code> --with-pcre1</code>参数，不能用最新的pcre2</p><pre data-tool="mdnice编辑器"><span></span><code>./configure --prefix=/opt/R-4.3.1 --<span>enable</span>-R-shlib --with-blas --with-lapack  --with-pcre1<br>make -j<br>sudo make install <br><br></code></pre><p data-tool="mdnice编辑器">另外要强调的一点事，因为后续要RStudio调用R，所以<code>--enable-R-shlib</code>参数必须有。</p><p data-tool="mdnice编辑器">之后我们用CentOS演示了RStudio安装</p><pre data-tool="mdnice编辑器"><span></span><code>wget https://download2.rstudio.org/server/centos7/x86_64/rstudio-server-rhel<span>-2023.06</span><span>.1</span><span>-524</span>-x86_64.rpm<br>sudo yum install rstudio-server-rhel<span>-2023.06</span><span>.1</span><span>-524</span>-x86_64.rpm<br><br></code></pre><p data-tool="mdnice编辑器">实际上Ubuntu也类似，到https://posit.co/download/rstudio-server/ 选择合适版本就好</p><p data-tool="mdnice编辑器">需要注意的是，此时安装的Rstudio是不会成功启动的，因为我们没有安装在它默认搜索的位置，因此我们需要没指定R的位置</p><p data-tool="mdnice编辑器">我们需要编辑 <code> /etc/rstudio/rserver.conf</code> ,添加如下的内容</p><pre data-tool="mdnice编辑器"><span></span><code>rsession-which-r=/opt/R-4.3.1/bin/R<br></code></pre><p data-tool="mdnice编辑器">然后用<code>sudo rstudio-server restart</code>重启，使用<code>rstudio-server status</code>确认运行状态。</p><p data-tool="mdnice编辑器">默认端口是8787，你需要通过 IP地址:端口来访问。</p><p data-tool="mdnice编辑器">但是，如果你用的云服务器，或者你服务器有防火墙的设置，你还需要允许这个端口的放行。这部分内容参考直播课的演示。</p><p data-tool="mdnice编辑器">接下来，我们介绍了R包的编译，需要强调的是，R默认是单线程编译。我们需要先运行这两个配置，让R执行编译时能够快一点。</p><pre data-tool="mdnice编辑器"><span></span><code>options(Ncpus=<span>20L</span>)<br>Sys.setenv(MAKEFLAGS=<span>"-j 20"</span>)<br></code></pre><p data-tool="mdnice编辑器">在R包的安装过程中，充满了意外，例如，学员让我们演示CytoTRACE_0.3.3的安装，经过不断的排查，发现可能需要gcc7才能编译，而我的centos7只有gcc4.8。虽然我能给大家展现一下，如何在旧系统上编译新的GCC，但是考虑直播时长，我们还是冷静下，暂时在这里结束了，不然我们真的要决战到天明了。</p><p data-tool="mdnice编辑器">最后，感谢昨晚4个小时陪伴学习，希望能够帮助到大家，我们下次直播见！</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/tZ5HlTLKgDZCu-l7DmgodA",target="_blank" rel="noopener noreferrer">原文链接</a>
