---
title: "介绍篇23年的 NC 芯片数据提取(Nanostring)"
date: 2023-07-17T05:19:29Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
介绍篇23年的 NC 芯片数据提取(Nanostring) by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h1 data-tool="mdnice编辑器"><span></span><span>半年芯片答疑腾讯会议</span><span></span></h1><figure data-tool="mdnice编辑器"><img data-ratio="1.4431486880466473" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfr5Za7w1hPbQcLnvTvnu96xVgeRich7XoRjw7EV6TUdnawq5MwUXPwUA/640?wx_fmt=jpeg" data-type="jpeg" data-w="686" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfr5Za7w1hPbQcLnvTvnu96xVgeRich7XoRjw7EV6TUdnawq5MwUXPwUA/640?wx_fmt=jpeg"></figure><h1 data-tool="mdnice编辑器"><span></span><span>1 背景</span><span></span></h1><p data-tool="mdnice编辑器">收到了曾大佬发来的任务~<img data-ratio="0.8649851632047477" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfpIJTuic50RKbSwOamjL6bQyQ8myZOYXBlk5ugyzzlrbKMTqPKO8GMAw/640?wx_fmt=png" data-type="png" data-w="674" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfpIJTuic50RKbSwOamjL6bQyQ8myZOYXBlk5ugyzzlrbKMTqPKO8GMAw/640?wx_fmt=png"></p><h1 data-tool="mdnice编辑器"><span></span><span>2 文献&amp;数据集简介</span><span></span></h1><h3 data-tool="mdnice编辑器"><span></span><span>2.1- 文献</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.40555555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfdVJfeh4Y4Dibm8TGk8wF7dMX9zv37ia2UkBCk6SNl1Hic9OHldeT0pKvw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfdVJfeh4Y4Dibm8TGk8wF7dMX9zv37ia2UkBCk6SNl1Hic9OHldeT0pKvw/640?wx_fmt=png">是一个鼻咽癌临床相关疗效的研究。PMID: <strong>37188668</strong>作者将患者一共分成了4组PR SD PD NE，还分成post 和 pre<img data-ratio="0.37056737588652483" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfsXR7xnBfsrT23ojlQ2RnqypDKMQIyYLwCzm6OrN2TrwicS2ZNTZibrng/640?wx_fmt=png" data-type="png" data-w="564" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfsXR7xnBfsrT23ojlQ2RnqypDKMQIyYLwCzm6OrN2TrwicS2ZNTZibrng/640?wx_fmt=png"></p><h3 data-tool="mdnice编辑器"><span></span><span>2.2- 数据集</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.1731266149870801" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfFQAicCTSQaFosO0u1aZe2JtWFxCcwjqhLxIsYiaHs0iacpJMUoY6PEhHg/640?wx_fmt=png" data-type="png" data-w="774" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfFQAicCTSQaFosO0u1aZe2JtWFxCcwjqhLxIsYiaHs0iacpJMUoY6PEhHg/640?wx_fmt=png">41个样本，外加一个自己之前没见过的芯片公司 Nanostring</p><h3 data-tool="mdnice编辑器"><span></span><span>2.3- 补充代码</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.1925925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfnZMiceGNP3Fo1EaO0aB0FyxOoIp7xduntBJvxabjYTEUna33zwHfw0Q/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfnZMiceGNP3Fo1EaO0aB0FyxOoIp7xduntBJvxabjYTEUna33zwHfw0Q/640?wx_fmt=png">链接如下：https://github.com/nccsCancerTherapeuticsLab/NPC_IpiNivoTrialAnalysis大致每个都看了一眼<img data-ratio="0.5592592592592592" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCftIJqZmXryTzCocBXVVic8C2OzFUiber29AR0LFcN9Q97V4kpA2iaQgicMQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCftIJqZmXryTzCocBXVVic8C2OzFUiber29AR0LFcN9Q97V4kpA2iaQgicMQ/640?wx_fmt=png">只看到画图的代码，没有看到原始数据提取的代码。</p><p data-tool="mdnice编辑器">看来需要再次上网搜索才能搞定它的原始数据提取代码了。搜到了大佬的文章：《Nanostring的表达矩阵分析也是大同小异》https://zhuanlan.zhihu.com/p/111575283顺带也发现了一个学徒任务，Mark一下，什么时候把它搞定。</p><h3 data-tool="mdnice编辑器"><span></span><span>2.4- 学徒作业标记</span><span></span></h3><p data-tool="mdnice编辑器">欢迎大家踊跃尝试~<img data-ratio="0.17478152309612985" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCf4WSewfENQ8fI1Bz2ILRDtdc3glpbNvq3FgVH6UNaroKZjJjy03IuFw/640?wx_fmt=png" data-type="png" data-w="801" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCf4WSewfENQ8fI1Bz2ILRDtdc3glpbNvq3FgVH6UNaroKZjJjy03IuFw/640?wx_fmt=png"></p><h1 data-tool="mdnice编辑器"><span></span><span>3 NC原始数据表达矩阵提取</span><span></span></h1><p data-tool="mdnice编辑器">先看一下数据格式.RCC<img data-ratio="0.3046272493573265" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfSRhC23bJfx8fNjias4QoaiarqCVpg0UTwIH6bCAJVIibAHFTEbiaaPIg2A/640?wx_fmt=png" data-type="png" data-w="778" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfSRhC23bJfx8fNjias4QoaiarqCVpg0UTwIH6bCAJVIibAHFTEbiaaPIg2A/640?wx_fmt=png">搜索一下<br>找到了一个nanostringr包以及R包说明书《Read NanoString RCC files》https://search.r-project.org/CRAN/refmans/nanostringr/html/rcc.html一共3个函数<img data-ratio="0.32191069574247144" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfBHwXfAiaJ5zvxNzNuOFjrrGJmJMIHqD0zibsZu5LHkXibcv0de9Q3xBmw/640?wx_fmt=png" data-type="png" data-w="963" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfBHwXfAiaJ5zvxNzNuOFjrrGJmJMIHqD0zibsZu5LHkXibcv0de9Q3xBmw/640?wx_fmt=png">第一个可以批量读取后两个只能单个读取那读取原始数据的核心函数应该就是以下这个了。</p><pre data-tool="mdnice编辑器"><code>read_rcc() <span>#reads in a directory of RCC files and outputs a list with two elements</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>3.1 原始数据下载&amp;解压</span><span></span></h2><p data-tool="mdnice编辑器">链接：https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE224450<img data-ratio="0.3268186753528773" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCf1Uibvk0OJvQx52EvVhuUjmlKqntLriawPsicKXydcTmMnmZgNx2sgDibibw/640?wx_fmt=png" data-type="png" data-w="921" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCf1Uibvk0OJvQx52EvVhuUjmlKqntLriawPsicKXydcTmMnmZgNx2sgDibibw/640?wx_fmt=png">下载完后解压<img data-ratio="0.5056497175141242" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfDoca31BibP3jaZOx1LMTW3txeYlSPDR0G9j3B6fWzV6NWXNCGVJ3Etg/640?wx_fmt=png" data-type="png" data-w="354" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfDoca31BibP3jaZOx1LMTW3txeYlSPDR0G9j3B6fWzV6NWXNCGVJ3Etg/640?wx_fmt=png">尝试读取..</p><pre data-tool="mdnice编辑器"><code>list=read_rcc(path = <span>"./GSE224450_RAW/"</span>)<br><span># Error in `purrr::reduce()`:</span><br><span>#   ! Must supply `.init` when `.x` is empty.</span><br><span># Run `rlang::last_trace()` to see where the error occurred.</span><br></code></pre><p data-tool="mdnice编辑器">稍微看了一下示例代码，RCC.gz应该是读取不了的，应该要继续解压..<img data-ratio="0.16453382084095064" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfhJLmzxBbXu6Y9ib9ZF2u6lbHXxPPgpkQBAULiaJxibn8aMVnkVs9yBeqg/640?wx_fmt=png" data-type="png" data-w="547" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfhJLmzxBbXu6Y9ib9ZF2u6lbHXxPPgpkQBAULiaJxibn8aMVnkVs9yBeqg/640?wx_fmt=png">解压代码~</p><pre data-tool="mdnice编辑器"><code>rm(list=ls())<br>options(warn = -1)<br>library(nanostringr)<br>library(R.utils)<br><span>#gunzip("./GSE224450_RAW/GSM7024384_1001Post.RCC.gz")</span><br>filenames=dir(path = <span>"./GSE224450_RAW/"</span>,pattern = <span>".RCC.gz$"</span>)<br>filenames=paste0(<span>"./GSE224450_RAW/"</span>,filenames)<br>sapply(filenames, gunzip)<br></code></pre><p data-tool="mdnice编辑器">解压完成<img data-ratio="0.5494505494505495" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfxzH5KXcIw2TuUHNnAdJ1GBGwm7EfLhc6d4GuVsWwFZdKkIJ73HdpaQ/640?wx_fmt=png" data-type="png" data-w="364" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfxzH5KXcIw2TuUHNnAdJ1GBGwm7EfLhc6d4GuVsWwFZdKkIJ73HdpaQ/640?wx_fmt=png"></p><h2 data-tool="mdnice编辑器"><span></span><span>3.2原始文件读取</span><span></span></h2><pre data-tool="mdnice编辑器"><code>list=read_rcc(path = <span>"./GSE224450_RAW/"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.19224806201550387" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfibyR6a1q5mRIteHcmjHqD2YDjDSZxbG6uMvTD13BQgZfMBYB4spsbow/640?wx_fmt=png" data-type="png" data-w="645" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfibyR6a1q5mRIteHcmjHqD2YDjDSZxbG6uMvTD13BQgZfMBYB4spsbow/640?wx_fmt=png"></figure><h2 data-tool="mdnice编辑器"><span></span><span>3.3 获取表达矩阵</span><span></span></h2><pre data-tool="mdnice编辑器"><code>exp=list[[<span>"raw"</span>]]<br>exp[1:4,1:4]<br><span># Code.Class  Name   Accession GSM7024384_1001Post</span><br><span># 1 Endogenous  CCNO NM_021147.4                 130</span><br><span># 2 Endogenous   MYC NM_002467.3                 647</span><br><span># 3 Endogenous CD79A NM_001783.3                2782</span><br><span># 4 Endogenous FSTL3 NM_005860.2                  10</span><br></code></pre><p data-tool="mdnice编辑器">能看到里面还有别的信息<img data-ratio="0.16685082872928178" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfEp4vydibOP4LQ9R0v5ic2TPNHxM61uaTe9aE8ADGtufztzFLyTqHvib7g/640?wx_fmt=png" data-type="png" data-w="905" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfEp4vydibOP4LQ9R0v5ic2TPNHxM61uaTe9aE8ADGtufztzFLyTqHvib7g/640?wx_fmt=png">需要删除</p><pre data-tool="mdnice编辑器"><code>exp=exp[,c(-1,-3)]<br>exp[1:4,1:4]<br><span># Name GSM7024384_1001Post GSM7024385_1001Pre GSM7024386_1002Post</span><br><span># 1  CCNO                 130                107                  30</span><br><span># 2   MYC                 647                767                 534</span><br><span># 3 CD79A                2782               1387                  43</span><br><span># 4 FSTL3                  10                 31                   6</span><br>rownames(exp)=exp<span>$Name</span><br>exp=exp[,-1]<br>exp[1:4,1:4]<br><span># GSM7024384_1001Post GSM7024385_1001Pre GSM7024386_1002Post GSM7024387_1002Pre</span><br><span># CCNO                  130                107                  30                 17</span><br><span># MYC                   647                767                 534                356</span><br><span># CD79A                2782               1387                  43                 85</span><br><span># FSTL3                  10                 31                   6                  5</span><br></code></pre><p data-tool="mdnice编辑器">最终得到的矩阵长这样~<img data-ratio="0.9049034175334324" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfpwspj3ZKfns9icoCtpuiaBQHSK2fQqs7p9sNXnPibWMZibqibTlQ8SXER5A/640?wx_fmt=png" data-type="png" data-w="673" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfpwspj3ZKfns9icoCtpuiaBQHSK2fQqs7p9sNXnPibWMZibqibTlQ8SXER5A/640?wx_fmt=png"></p><h2 data-tool="mdnice编辑器"><span></span><span>3.4 获取分组</span><span></span></h2><p data-tool="mdnice编辑器">下载SOFT文件<img data-ratio="0.17048346055979643" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfM8X3eQSGrp3Gnwa6SaNPy6nly7VEPdw9VOzMVuDO072Lx0j88IwnVQ/640?wx_fmt=png" data-type="png" data-w="786" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfM8X3eQSGrp3Gnwa6SaNPy6nly7VEPdw9VOzMVuDO072Lx0j88IwnVQ/640?wx_fmt=png">读取SOFT文件</p><pre data-tool="mdnice编辑器"><code>library(GEOquery)<br>list_group=getGEO(filename = <span>"./GSE224450_family.soft.gz"</span>,getGPL = F)<br><span># Reading file....</span><br><span># Parsing....</span><br><span># Found 42 entities...</span><br><span># GPL33087 (1 of 43 entities)</span><br><span># GSM7024384 (2 of 43 entities)</span><br><span># GSM7024385 (3 of 43 entities)</span><br><span># GSM7024386 (4 of 43 entities)</span><br><span># GSM7024387 (5 of 43 entities)</span><br><span># GSM7024388 (6 of 43 entities)</span><br><span># GSM7024389 (7 of 43 entities)</span><br><span># GSM7024390 (8 of 43 entities)</span><br><span># GSM7024391 (9 of 43 entities)</span><br><span># GSM7024392 (10 of 43 entities)</span><br><span># GSM7024393 (11 of 43 entities)</span><br><span># GSM7024394 (12 of 43 entities)</span><br><span># GSM7024395 (13 of 43 entities)</span><br><span># GSM7024396 (14 of 43 entities)</span><br><span># GSM7024397 (15 of 43 entities)</span><br><span># GSM7024398 (16 of 43 entities)</span><br><span># GSM7024399 (17 of 43 entities)</span><br><span># GSM7024400 (18 of 43 entities)</span><br><span># GSM7024401 (19 of 43 entities)</span><br><span># GSM7024402 (20 of 43 entities)</span><br><span># GSM7024403 (21 of 43 entities)</span><br><span># GSM7024404 (22 of 43 entities)</span><br><span># GSM7024405 (23 of 43 entities)</span><br><span># GSM7024406 (24 of 43 entities)</span><br><span># GSM7024407 (25 of 43 entities)</span><br><span># GSM7024408 (26 of 43 entities)</span><br><span># GSM7024409 (27 of 43 entities)</span><br><span># GSM7024410 (28 of 43 entities)</span><br><span># GSM7024411 (29 of 43 entities)</span><br><span># GSM7024412 (30 of 43 entities)</span><br><span># GSM7024413 (31 of 43 entities)</span><br><span># GSM7024414 (32 of 43 entities)</span><br><span># GSM7024415 (33 of 43 entities)</span><br><span># GSM7024416 (34 of 43 entities)</span><br><span># GSM7024417 (35 of 43 entities)</span><br><span># GSM7024418 (36 of 43 entities)</span><br><span># GSM7024419 (37 of 43 entities)</span><br><span># GSM7024420 (38 of 43 entities)</span><br><span># GSM7024421 (39 of 43 entities)</span><br><span># GSM7024422 (40 of 43 entities)</span><br><span># GSM7024423 (41 of 43 entities)</span><br><span># GSM7024424 (42 of 43 entities)</span><br></code></pre><p data-tool="mdnice编辑器">稍微看一下分组信息在哪里</p><pre data-tool="mdnice编辑器"><code>list.g=list_group@gsms<br><span># &gt; list_group@gsms[["GSM7024385"]]@header[["characteristics_ch1"]]</span><br><span># [1] "Sex: M"                             "age: 53"                           </span><br><span># [3] "ethnic group: Chinese"              "smoking status: Ex-smoker"         </span><br><span># [5] "staging (who): 3"                   "staging (ajcc): 4C"                </span><br><span># [7] "metastasis?: Yes"                   "best overall response: PR"         </span><br><span># [9] "baseline ebv dna (copies/ml): 2883"</span><br><span>#"best overall response: PR"        #第8个</span><br></code></pre><p data-tool="mdnice编辑器">提取PR SD 分组信息</p><pre data-tool="mdnice编辑器"><code>group.1=lapply(list.g, <span>function</span>(n)<br>  {<br>  n@header[[<span>"characteristics_ch1"</span>]][8]<br>  })<br>  group.1[1:4]<br>  <span># $GSM7024384</span><br><span># [1] "best overall response: PR"</span><br><span># </span><br><span># $GSM7024385</span><br><span># [1] "best overall response: PR"</span><br><span># </span><br><span># $GSM7024386</span><br><span># [1] "best overall response: SD"</span><br><span># </span><br><span># $GSM7024387</span><br><span># [1] "best overall response: SD"</span><br></code></pre><p data-tool="mdnice编辑器">提取Post和Pre信息</p><pre data-tool="mdnice编辑器"><code>col.name=colnames(exp)<br><span># col.name</span><br><span># [1] "GSM7024384_1001Post" "GSM7024385_1001Pre"  "GSM7024386_1002Post" "GSM7024387_1002Pre" </span><br><span># [5] "GSM7024388_1003Post" "GSM7024389_1003Pre"  "GSM7024390_1004Post" "GSM7024391_1004Pre" </span><br><span># [9] "GSM7024392_1005Pre"  "GSM7024393_1007Post" "GSM7024394_1007Pre"  "GSM7024395_1008Post"</span><br><span># [13] "GSM7024396_1008Pre"  "GSM7024397_1010Post" "GSM7024398_1010Pre"  "GSM7024399_1012Post"</span><br><span># [17] "GSM7024400_1012Pre"  "GSM7024401_1013Post" "GSM7024402_1013Pre"  "GSM7024403_1014Post"</span><br><span># [21] "GSM7024404_1014Pre"  "GSM7024405_1016Pre"  "GSM7024406_1018Post" "GSM7024407_1018Pre" </span><br><span># [25] "GSM7024408_1019Post" "GSM7024409_1019Pre"  "GSM7024410_1020Post" "GSM7024411_1020Pre" </span><br><span># [29] "GSM7024412_1021Post" "GSM7024413_1021Pre"  "GSM7024414_1023Pre"  "GSM7024415_1028Post"</span><br><span># [33] "GSM7024416_1028Pre"  "GSM7024417_1029Post" "GSM7024418_1029Pre"  "GSM7024419_1032Post"</span><br><span># [37] "GSM7024420_1032Pre"  "GSM7024421_1033Post" "GSM7024422_1033Pre"  "GSM7024423_1040Post"</span><br><span># [41] "GSM7024424_1040Pre" </span><br></code></pre><p data-tool="mdnice编辑器">双重条件提取分组</p><pre data-tool="mdnice编辑器"><code>library(stringr)<br>group.2=ifelse(str_detect(col.name,<span>"Post"</span>),<span>"Post"</span>,<span>"Pre"</span>)<br>group.1=unlist(group.1)<br>group.all=data.frame(group.2,group.1)<br>group.all<span>$group</span>.3=ifelse(str_detect(group.all<span>$group</span>.1,<span>"PR"</span>),<span>"PR"</span>,<br>                         ifelse(str_detect(group.all<span>$group</span>.1,<span>"SD"</span>),<span>"SD"</span>,<span>"PD"</span>))<br><span># 写个循环</span><br>group.all<span>$fin</span>=<span>""</span><br><span>for</span> (i <span>in</span> 1:length(group.2)){<br>  <span>if</span> (group.all<span>$group</span>.2[i]==<span>"Post"</span>){<br>    <span>if</span> (group.all<span>$group</span>.3[i]==<span>"PR"</span>){<br>      group.all<span>$fin</span>[i]=<span>"Post_PR"</span><br>    }<br>    <span>if</span> (group.all<span>$group</span>.3[i]==<span>"PD"</span>){<br>      group.all<span>$fin</span>[i]=<span>"Post_PD"</span><br>    }<br>    <span>if</span> (group.all<span>$group</span>.3[i]==<span>"SD"</span>){<br>      group.all<span>$fin</span>[i]=<span>"Post_SD"</span><br>    }<br>  }<br>  <span>if</span> (group.all<span>$group</span>.2[i]==<span>"Pre"</span>){<br>    <span>if</span> (group.all<span>$group</span>.3[i]==<span>"PR"</span>){<br>      group.all<span>$fin</span>[i]=<span>"Pre_PR"</span><br>    }<br>    <span>if</span> (group.all<span>$group</span>.3[i]==<span>"PD"</span>){<br>      group.all<span>$fin</span>[i]=<span>"Pre_PD"</span><br>    }<br>    <span>if</span> (group.all<span>$group</span>.3[i]==<span>"SD"</span>){<br>      group.all<span>$fin</span>[i]=<span>"Pre_SD"</span><br>    }<br>  }}<br><br>group=group.all<span>$fin</span><br><br><span># &gt; group</span><br><span># [1] "Post_PR" "Pre_PR"  "Post_SD" "Pre_SD"  "Post_PD" "Pre_PD"  "Post_PR" "Pre_PR"  "Pre_PD" </span><br><span># [10] "Post_PD" "Pre_PD"  "Post_SD" "Pre_SD"  "Post_PR" "Pre_PR"  "Post_PR" "Pre_PR"  "Post_PR"</span><br><span># [19] "Pre_PR"  "Post_PR" "Pre_PR"  "Pre_PR"  "Post_SD" "Pre_SD"  "Post_PD" "Pre_PD"  "Post_PD"</span><br><span># [28] "Pre_PD"  "Post_SD" "Pre_SD"  "Pre_PD"  "Post_PD" "Pre_PD"  "Post_PR" "Pre_PR"  "Post_SD"</span><br><span># [37] "Pre_SD"  "Post_SD" "Pre_SD"  "Post_PR" "Pre_PR" </span><br>table(group)<br><span># group</span><br><span># Post_PD Post_PR Post_SD  Pre_PD  Pre_PR  Pre_SD </span><br><span># 5       8       6       7       9       6 </span><br></code></pre><p data-tool="mdnice编辑器">没有NE组。</p><h1 data-tool="mdnice编辑器"><span></span><span>4 画个PCA看一下样本分布</span><span></span></h1><pre data-tool="mdnice编辑器"><code>library(FactoMineR)<br>library(factoextra)<br><span>#做PCA分析，第五列为物种，非数值属性需要去除</span><br>pca &lt;- PCA(t(exp), graph = F)<br>pca_plot &lt;- fviz_pca_ind(pca,<br>                         geom.ind = <span>"point"</span>,  <span># 在c("point", "arrow", "text")选，可以选多种</span><br>                         col.ind = group,   <span># 按照分组标记颜色</span><br>                         palette = c(<span>"#0000FF"</span>, <span>"#8A2BE2"</span>, <span>"#BCEE68"</span>,<span>"#000000"</span>,<span>"#EEAD0E"</span>,<span>"#999999"</span>),  <span>#几组就要提供几种颜色</span><br>                         addEllipses = TRUE, <span># 要不要框椭圆线</span><br>                         legend.title = <span>"Groups"</span> <span>#加个分组标题</span><br>)<br><br>pca_plot<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7703703703703704" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfpKa1Q8wurMF6GWx6nlHvRQqtDGo7oM0hAjH7nUXFLhTibjibbZGF9mNg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfpKa1Q8wurMF6GWx6nlHvRQqtDGo7oM0hAjH7nUXFLhTibjibbZGF9mNg/640?wx_fmt=png"><figcaption><br></figcaption></figure><h1 data-tool="mdnice编辑器"><span></span><span>5-差异分析 Pre_PD VS Post_PD</span><span></span></h1><p data-tool="mdnice编辑器">数据检查</p><pre data-tool="mdnice编辑器"><code><span>#选择2组做差异分析Pre_PD VS Post_PD</span><br>rm(list = ls()) <br>load(file = <span>"step1_exp_multi_gpl.Rdata"</span>)<br><span>#筛选数据</span><br>range(exp)<br>exp=log2(exp+1)<br>exp=normalizeBetweenArrays(exp)<br>boxplot(exp[,1:4],las=2)<br><br>new.group= group[group== <span>"Pre_PD"</span> | group== <span>"Post_PD"</span>]<br>new.group <span>#7+5=12</span><br>new.exp=exp[,group== <span>"Pre_PD"</span> | group== <span>"Post_PD"</span>]<br>new.exp<br>library(limma)<br>design &lt;- model.matrix(~0+new.group)<br>fit &lt;- lmFit(new.exp,design)<br>fit &lt;- eBayes(fit,trend=TRUE,robust=TRUE)<br>summary(decideTests(fit))<br><span>#绘制差异基因箱线图</span><br>deg = topTable(fit,coef=2)<br>dat=deg<br></code></pre><p data-tool="mdnice编辑器">差异分析结果<img data-ratio="0.5684647302904564" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfsvlNhDibEVNy7aiacyh60XRaebOFtRFAmNkeibXBnCuu4oEc4zhNQWU2Q/640?wx_fmt=png" data-type="png" data-w="482" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicPUknT2a83IsIcduCRaJCfsvlNhDibEVNy7aiacyh60XRaebOFtRFAmNkeibXBnCuu4oEc4zhNQWU2Q/640?wx_fmt=png">整体来说差异基因的数量不多</p><h1 data-tool="mdnice编辑器"><span></span><span>致谢</span><span></span></h1><p data-tool="mdnice编辑器">最后询问大佬，得知nanostring的芯片算是定制，不便宜，另外通过这次练习也知道芯片技术只是没有之前那么流行了，并不是真的完全淘汰了。</p><p data-tool="mdnice编辑器">感谢曾老师的帮助~</p></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/pPDfwvcfftXvS0qBAF_nQw",target="_blank" rel="noopener noreferrer">原文链接</a>
