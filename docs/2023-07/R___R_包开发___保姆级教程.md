---
title: "R · R 包开发 | 保姆级教程"
date: 2023-07-26T11:01:06Z
draft: ["false"]
tags: [
  "fetched",
  "生信小白要知道"
]
categories: ["Acdemic"]
---
R · R 包开发 | 保姆级教程 by 生信小白要知道
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h1 data-tool="mdnice编辑器"><span></span><span>R · R 包开发</span></h1><p><span><strong><span>如需视频讲解，请移步哔哩哔哩 —— </span></strong></span><span><strong><span>一只小蛮要</span></strong></span><span><strong><span><br></span></strong></span></p><p><img data-backh="305" data-backw="305" data-galleryid="" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXN5MjJS9LDfrdet9FESY3zxT7IBNqNDDy2Atp1UUiayYSHPbeY7MmiaHA/640?wx_fmt=jpeg" data-type="png" data-w="960" src="https://mmbiz.qpic.cn/mmbiz_jpg/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXN5MjJS9LDfrdet9FESY3zxT7IBNqNDDy2Atp1UUiayYSHPbeY7MmiaHA/640?wx_fmt=jpeg"></p><p><span></span></p><blockquote data-tool="mdnice编辑器"><p><span>一般在初始阶段我们都是使用别人的函数来完成大部分任务，那些函数大多来自 R 标准安装的包或者可以从 CRAN 下载的包。</span></p></blockquote><blockquote data-tool="mdnice编辑器"><p>安装新的包可以<strong>拓展 R 的功能</strong>。比如说，安装 ggplot2 包提供了可视化数据的方法。R 中很多强大的功能都来自开发者贡献的包。</p></blockquote><h1 data-tool="mdnice编辑器"><span></span><span>什么是包</span></h1><p data-tool="mdnice编辑器">技术上，包只不过是<strong>一套函数、文档和数据的合集</strong>，以一种标准的格式保存。包让我们能以一种定义良好的完整文档化方式来组织我们的函数，而且便于我们将程序分享给他人。</p><h1 data-tool="mdnice编辑器"><span></span><span>为什么要开发包</span></h1><ul data-tool="mdnice编辑器"><li><section>让一套常用函数及其使用说明文档更加容易取用。</section></li><li><section>创造一个能解决重要分析问题（比如数据可视化）的程序（一套相关函数）。</section></li><li><section>传世之作，福泽天下！</section></li><li><section>方便自己！</section></li><li><section>……</section></li></ul><p data-tool="mdnice编辑器">包可以直接分享，或者通过如 CRAN 和 GitHub 的在线软件库分享。R 包开发与 Git/GitHub 结合使用更佳。</p><h1 data-tool="mdnice编辑器"><span></span><span>开发必备工具</span></h1><ul data-tool="mdnice编辑器"><li><section>RStudio</section></li><li><section>usethis 包 —— 有超多的工具函数。</section></li><li><section>devtools 包 —— 通过提供简化常见任务的R函数来简化包的开发。</section></li><li><section>roxygen2 包 —— 再也不用为复杂的注释而头疼，可以一边写函数，一边写注释，将精力集中到写代码中，最后运行<code>devtools::document()</code>命令，就可以直接将所有注释写入 R 的说明文档。</section></li></ul><p data-tool="mdnice编辑器">准备就绪后，我们可以使用命令<code>devtools::has_devel()</code>来进行检查。运行这行命令，返回<code>“Your system is ready to build packages! ”</code>表示一切准备就绪，可以开始啦！</p><pre data-tool="mdnice编辑器"><span></span><code><span># 安装并加载开发包所需包</span><br>install.packages(<span>"usethis"</span>, <span>"devtools"</span>, <span>"roxygen2"</span>)<br><br>library(usethis)<br>library(devtools)<br>library(roxygen2)<br><br><span># 检查</span><br>has_devel()<br>Your system is ready to build packages!<br></code></pre><h1 data-tool="mdnice编辑器"><span></span><span>开发 R 包</span></h1><h2 data-tool="mdnice编辑器"><span></span><span>1 命名规则</span></h2><p data-tool="mdnice编辑器">R包的命名主要有以下几个规则：</p><ul data-tool="mdnice编辑器"><li><section><strong>必须以字母开头</strong>(大写或小写)，如：ggplot2，不能写成 2ggplot</section></li><li><section><strong>只能包含字母</strong>(大写或小写)，<strong>数字和点</strong>，如：covid19.analytics</section></li><li><section><strong>不能和已有的包名称冲突</strong>，已有的包指 CRAN 和 bioconductor 上的包</section></li></ul><p data-tool="mdnice编辑器">CRAN 上已有的包可以在</p><p data-tool="mdnice编辑器">https://cran.r-project.org/web/packages/available_packages_by_name.html 中查找；</p><p data-tool="mdnice编辑器">bioconductor 上已有的包可以在</p><p data-tool="mdnice编辑器">https://bioconductor.org/packages/release/BiocViews.html#___Software 中查找。</p><p data-tool="mdnice编辑器">也可以使用命令<code>available.packages()</code>查看 CRAN 上的包，<code>bioManager::available()</code>来查看 bioconductor 上已有的包。</p><p data-tool="mdnice编辑器">在创建R包前，不仅需要确保自己的包名是有效的，而且还有起一个好名字。好名字的特点包括：</p><h2 data-tool="mdnice编辑器"><span></span><span>2 开发 R 包</span></h2><ul data-tool="mdnice编辑器"><li><section><strong>和功能相关</strong>：比如做稳健 cox 回归的包叫做 coxrobust</section></li><li><section><strong>易记</strong>：包的名字不宜全部使用小写字母，可以使用驼峰式如 MaN，或 aBa，或者可以加入点，如 gg.gap</section></li><li><section><strong>注意版权</strong>：比如说 TCGA 是知名网站的名字，那么 R 包的名字应尽量避免重复，可以加入 r，如 rTCGA。</section></li><li><section><strong>不宜太长</strong>：很多人会把包的名字起的过长，在 CRAN 和 bioconductor 上，大部分R包的名字在 4 到 9 个字符之间，<strong>6 个字符最佳</strong>，过长的包名拼写起来十分困难，无疑增加了使用的难度。</section></li></ul><p data-tool="mdnice编辑器">首先，我们使用命令<code>dir.create()</code>在d盘下新建文件夹 mypkg，并使用命令<code>setwd()</code>设置工作目录至 mypkg 文件夹下，之后创建的所有R包都将会在这个目录中。</p><pre data-tool="mdnice编辑器"><span></span><code>dir.create(<span>"d:/Desktop/OneDrive-shanghaitech.edu.cn/RStudio/mypkg"</span>)<br>setwd(<span>"d:/Desktop/OneDrive-shanghaitech.edu.cn/RStudio/mypkg"</span>)<br></code></pre><p data-tool="mdnice编辑器">接着使用 usethis 包中的<code>create_package()</code>函数来创建R包，usethis 包会随着 devtools 包的安装而安装，随着 devtools 包的调用而调用。</p><pre data-tool="mdnice编辑器"><span></span><code>usethis::create_package(<span>"xmypkg"</span>)<br>v Creating <span>'xmypkg/'</span><br>v Setting active project to <span>'D:/Desktop/OneDrive-shanghaitech.edu.cn/RStudio/mypkg/xmypkg'</span><br>v Creating <span>'R/'</span><br>v Writing <span>'DESCRIPTION'</span><br>Package: xmypkg<br>Title: What the Package Does (One Line, Title Case)<br>Version: 0.0.0.9000<br>Authors@R (parsed):<br>    * First Last &lt;first.last@example.com&gt; [aut, cre] (YOUR-ORCID-ID)<br>Description: What the package does (one paragraph).<br>License: `use_mit_license()`, `use_gpl3_license()` or friends to<br>    pick a license<br>Encoding: UTF-8<br>Roxygen: list(markdown = TRUE)<br>RoxygenNote: 7.2.0<br>v Writing <span>'NAMESPACE'</span><br>v Writing <span>'xmypkg.Rproj'</span><br>v Adding <span>'^xmypkg\\.Rproj$'</span> to <span>'.Rbuildignore'</span><br>v Adding <span>'.Rproj.user'</span> to <span>'.gitignore'</span><br>v Adding <span>'^\\.Rproj\\.user$'</span> to <span>'.Rbuildigno**re'</span><br>v Opening <span>'D:/Desktop/OneDrive-shanghaitech.edu.cn/RStudio/mypkg/xmypkg/'</span> <span>in</span> new RStudio session<br>v Setting active project to <span>'&lt;no active project&gt;'</span>**<br></code></pre><p data-tool="mdnice编辑器"><code>create_package('xmypkg')</code>命令在 mypkg 文件夹下创建了 xmypkg 文件夹，这个就是我们的 R 包了，并且自动打开了一个新的界面：xmypkg.Rproj，可以直接关闭它。xmypkg 文件夹(也就是 xmypkg 包)默认创建了以下几个文件：</p><ul data-tool="mdnice编辑器"><li><section><p><strong>R文件夹</strong>：存放R代码文件夹，<strong>重要</strong></p></section></li><ul><li><section>一个函数</section></li><li><section>一个函数和它的辅助函数</section></li><li><section>一个函数家族</section></li><li><section>R包的心脏（我们写的所有函数都在此处）</section></li><li><section>里面的文件都是R脚本，也就是扩展名为.R的文件</section></li><li><section>每个文件包含什么嘞</section></li></ul><li><section><p>.<strong>gitignore文件</strong>：存放git信息的文件，<strong>会被忽略</strong></p></section></li><li><section><p><strong>.Rbuildignore文件</strong>：顾名思义就是build包时会忽略的文件，<strong>会被忽略</strong></p></section></li><li><section><p><strong>DESCRIPTION文件</strong>：R包的说明文档，<strong>重要</strong></p></section></li><ul><li><section>人类和机器都能读取的格式</section></li><li><section>会展示在CRAN</section></li><li><section>是包的灵魂</section></li><li><section>包含包的描述信息</section></li><li><section>一个有格式的文本文件（DFC：Debian control format）</section></li><li><section>每行由字段名称、冒号和后面的值组成</section></li></ul><li><section><p><strong>xmypkg.Rproj文件</strong>：RStudio的项目文件，我们以后编辑R包的时候，都是通过打开它来编辑的，因为这个文件包含了创建R包的菜单，<strong>重要</strong></p></section></li><li><section><p><strong>NAMESPACE文件</strong>：存放R包函数命名空间的文件，不需要手动编辑，<strong>极其重要</strong></p></section></li><ul><li><section>一行一个</section></li><li><section>通常由 Roxygen2 完成</section></li><li><section>一个文本文件，无需手动编辑</section></li><li><section>一个 list</section></li></ul><li><section><p>R包中的其他文件夹</p><p>R包中可以包含很多文件夹，不同的文件功能不同，常用的除了上面提到的R文件夹，还有data文件夹和vignette文件夹。</p></section></li><ul><li><section>R文件夹是存放R脚本的地方，也就是我们所有的R代码</section></li><li><section>data文件夹不像R文件夹会自动产生，你可以使用函数<code>use_data()</code>来添加R数据，也可以手动新建</section></li><li><section>vignette文件夹是用来添加markdown格式的说明文档，可以使用函数<code>use_vignette()</code>来创建，需要注意的是，如果你要添加vignette文件夹，需要安装knitr包、rmarkdowan包和pandoc。前两者的安装可以使用命令<code>install.packages()</code>来安装即可，pandoc的安装参考它的网站https://pandoc.org/installing.html</section></li></ul><li><section><p>R包文件夹的小缺陷</p><p>R包内的文件夹不支持二级目录，也就是R文件夹下不能再有下一级目录，这个也是R包的缺陷，因为如果函数过多，打理起来会比较麻烦。</p></section></li></ul><h2 data-tool="mdnice编辑器"><span></span><span>3 封装 R 包</span></h2><p data-tool="mdnice编辑器">到现在为止，我们创建了一个空包，名字叫 xmypkg。接下来，为了对 R 包的制作过程有更直观的认识，我们对其直接进行封装。</p><p data-tool="mdnice编辑器">封装R包主要有2个步骤：<strong>写入注释和建包</strong>。有 3 种实现方式：<strong>菜单、命令和快捷键</strong>。</p><h3 data-tool="mdnice编辑器"><span></span><span>3.1 打开项目文件</span><span></span></h3><p data-tool="mdnice编辑器">上面我们介绍了R包内的常用文件，有一个特别重要的项目文件 xmypkg.Rproj，现在我们打开它。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5578583765112263" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXoqm3EVsoA3w1iapqCOmvbZ5xaSb5icguJug4KPSvM8kybe3wEvyECktg/640?wx_fmt=png" data-type="png" data-w="579" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXoqm3EVsoA3w1iapqCOmvbZ5xaSb5icguJug4KPSvM8kybe3wEvyECktg/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">和 RStudio 平常的界面不同，在菜单栏多了可下拉的 Build 菜单项，这里包含了封装 R 包常用的能。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5956006768189509" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXYpDXxQ9z2c7qv5mIBt2bqHf8cYClBaz8jJQkl08R5hoS4C6Nvc86uA/640?wx_fmt=png" data-type="png" data-w="591" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXYpDXxQ9z2c7qv5mIBt2bqHf8cYClBaz8jJQkl08R5hoS4C6Nvc86uA/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>3.2 通过菜单封装包</span><span></span></h3><p data-tool="mdnice编辑器">3.2.1 写入注释</p><p data-tool="mdnice编辑器">首先是<strong>写入注释</strong>，在 Build 菜单下，单击 <strong>Document</strong> 项。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5765407554671969" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXuCWbtc5h5iaAicicPyAMK09n2dGHdBiaZgicuUicDCcwicXgen91d0Dg7LxHA/640?wx_fmt=png" data-type="png" data-w="503" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXuCWbtc5h5iaAicicPyAMK09n2dGHdBiaZgicuUicDCcwicXgen91d0Dg7LxHA/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">在 Build 窗口中，我们可以看到：更新文档，载入 xmypkg 包，最后完成更新。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5370370370370371" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXmVmMIJA7UwRZAmmDDiaGq0DZSvDoPWWZicYiaXZWibbibP0g6E62Q2WdDBw/640?wx_fmt=png" data-type="png" data-w="702" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXmVmMIJA7UwRZAmmDDiaGq0DZSvDoPWWZicYiaXZWibbibP0g6E62Q2WdDBw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">3.2.2 建包</p><p data-tool="mdnice编辑器">写好注释后，就是建包了，使用 Build 菜单下的 <strong>Install and Restart</strong> 或者 <strong>Clean and Rebuild</strong>均可，选择任意一个单击即可，这里我们选择 <strong>Install and Restart</strong>。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5708661417322834" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXTHFZibgqecXcoIibYqd2MibDUkAXf3pqNOal8VA5xozHGCIuYY4ZaicgQQ/640?wx_fmt=png" data-type="png" data-w="508" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXTHFZibgqecXcoIibYqd2MibDUkAXf3pqNOal8VA5xozHGCIuYY4ZaicgQQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">选择 <strong>Install and Restart</strong> 之后，在 build 窗口，就可以看到：xmypkg 包被安装到 library 文件夹下，最后提示 <strong>Done (xmypkg)</strong> 表示安装成功。在 R 的控制台中，我们可以看到已经使用<code>library()</code>命令调用了 xmypkg 包，xmypkg 已经可以使用了。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.6552217453505007" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWX4RiaP2SOzvhictnRrrrsyOC3iaBqNmNPHZ29FWHTCf3ybhtHmY29HFX5Q/640?wx_fmt=png" data-type="png" data-w="699" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWX4RiaP2SOzvhictnRrrrsyOC3iaBqNmNPHZ29FWHTCf3ybhtHmY29HFX5Q/640?wx_fmt=png"></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.5253940455341506" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXT262m1uAY1fDrXnOywXyMhAP0fSyeaTQ84ntibFT9XH45Kmzdhg940A/640?wx_fmt=png" data-type="png" data-w="571" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXT262m1uAY1fDrXnOywXyMhAP0fSyeaTQ84ntibFT9XH45Kmzdhg940A/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>3.3 通过快捷键封装包</span><span></span></h3><p data-tool="mdnice编辑器">使用快捷键封装包超简单！</p><ul data-tool="mdnice编辑器"><li><section><strong>写入注释：Ctrl/Command + Shift + D，D —— document</strong></section></li><li><section><strong>建包：Ctrl/Command + Shift + B，B —— build</strong></section></li></ul><h3 data-tool="mdnice编辑器"><span></span><span>3.4 通过命令封装包</span><span></span></h3><p data-tool="mdnice编辑器">不论是快捷键还是菜单，本质上都是调用 devtools 包中的<code>document()</code>函数和<code>build()</code>函数。</p><p data-tool="mdnice编辑器">学会使用命令封装非常重要，因为有一些信息仅在使用命令的时候才会给出。</p><ul data-tool="mdnice编辑器"><li><section>写入注释：<code>devtools::document()</code></section></li><li><section>建包：<code>devtools::build()</code></section></li></ul><p data-tool="mdnice编辑器">使用命令封装包后的信息，不会再 Build 窗口中显示，而是在控制台中显示。</p><pre data-tool="mdnice编辑器"><span></span><code><span># 写入注释</span><br>devtools::document()<br>i Updating xmypkg documentation<br>i Loading xmypkg<br><span># 建包</span><br>devtools::build()<br>√  checking <span>for</span> file <span>'D:\Desktop\OneDrive - shanghaitech.edu.cn\RStudio\mypkg\xmypkg/DESCRIPTION'</span> ... <br>-  preparing <span>'xmypkg'</span>:<br>√  checking DESCRIPTION meta-information ... <br>-  checking <span>for</span> LF line-endings <span>in</span> <span>source</span> and make files and shell scripts<br>-  checking <span>for</span> empty or unneeded directories<br>   Removed empty directory <span>'xmypkg/man'</span><br>-  building <span>'xmypkg_0.0.0.9000.tar.gz'</span><br>   <br>[1] <span>"D:/Desktop/OneDrive - shanghaitech.edu.cn/RStudio/mypkg/xmypkg_0.0.0.9000.tar.gz"</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>3.5 调用 R 包</span><span></span></h3><p data-tool="mdnice编辑器">封装完R包后，我们就可以使用<code>library()</code>命令来调用我们的包啦！</p><p data-tool="mdnice编辑器">没有任何报错信息，说明 xmypkg 包制作成功。</p><p data-tool="mdnice编辑器">在 Package 窗口中，也可以找到我们的 xmypkg 包。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5169230769230769" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXsIKHjAssGZ5tmlaMh4OMQBUUlyDdL78uibuXIj8InL7tQUWwh2KQXicw/640?wx_fmt=png" data-type="png" data-w="650" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXsIKHjAssGZ5tmlaMh4OMQBUUlyDdL78uibuXIj8InL7tQUWwh2KQXicw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">现在我们已经学会如何创建、封装R包了，但是 xmypkg 还只是个空包，没有任何内容，不过一般在封装包之前，大家肯定就已经把函数搞定啦，所以这里就不讲解创建函数的过程了，让我们直接进入函数注释部分！</p><h2 data-tool="mdnice编辑器"><span></span><span>4 函数注释</span></h2><p data-tool="mdnice编辑器"><strong>roxygen2 ！！！！！</strong></p><h3 data-tool="mdnice编辑器"><span></span><span>4.1 <strong>插入注释框架</strong></span><span></span></h3><p data-tool="mdnice编辑器">双击打开我们的项目文件 xmypkg.Rproj。</p><p data-tool="mdnice编辑器">首先，我们写1个标准函数，并将它<strong>保存在R文件夹</strong>下，文件名为XXX.R，R语言代码文件的<strong>扩展名必须是R</strong>，而文件名不一定要和函数名一样，可以是XXXO.R，也可以是XX.R，但不能是中文。</p><pre data-tool="mdnice编辑器"><span></span><code><span># eg.</span><br>add &lt;- <span>function</span>(x, y){<br>  x + y<br>}<br></code></pre><p data-tool="mdnice编辑器">插入注释框架主要有2种方法：菜单插入、快捷键插入，不管哪一种，都要先将<strong>光标定位在函数内部</strong>，只有在函数内部，RStudio才能识别这是1个函数。</p><p data-tool="mdnice编辑器">4.1.1 菜单插入</p><p data-tool="mdnice编辑器">首先，将光标定位在函数内部，然后依次点击菜单栏的 Code、Insert Roxygen Skeleton，就插入了注释框架。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.7389885807504079" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXl77jcsKelHNrLKc3ObkebuFSTh5fYb8o9aBl0XsrIaGwTxzGPpocyA/640?wx_fmt=png" data-type="png" data-w="613" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXl77jcsKelHNrLKc3ObkebuFSTh5fYb8o9aBl0XsrIaGwTxzGPpocyA/640?wx_fmt=png"></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.6502636203866432" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWX3hmF25a6hUBXNAxJ5HuaYzxwCx6z5MG45PNULXVEqWibJiasC7Rn66iaQ/640?wx_fmt=png" data-type="png" data-w="569" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWX3hmF25a6hUBXNAxJ5HuaYzxwCx6z5MG45PNULXVEqWibJiasC7Rn66iaQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">4.1.2 快捷键插入</p><p data-tool="mdnice编辑器">首先，将光标定位在函数内部，然后使用快捷键 Ctrl+Alt+Shift+R 即可插入。</p><h3 data-tool="mdnice编辑器"><span></span><span>4.2 注释撰写</span><span></span></h3><p data-tool="mdnice编辑器">普通的注释以 <strong>井号#</strong> 开头，而函数注释以 <strong>井号和单引号 #'</strong> 开头，并且后接1个空格。每一个区域的指定，都是以 @ 开头。</p><p data-tool="mdnice编辑器">4.2.1 标题</p><p data-tool="mdnice编辑器">第1行如果不指定，默认是标题 title，也可以自己使用 <strong>@title</strong> 指定。</p><p data-tool="mdnice编辑器">书写标题时，需要在**@title** 后空1格，标题要能准确反映出函数的功能，要注意首字母大写。</p><p data-tool="mdnice编辑器">4.2.2 描述</p><p data-tool="mdnice编辑器">函数的描述部分并不是必须的，所以默认是不会插入这部分的，如果缺少了描述部分，R会自动用标题来代替。</p><p data-tool="mdnice编辑器">使用 <strong>@description</strong> 来指定描述区域。描述部分必须是一整个段落，这意味着必须以句号也就是点来结尾。如果内容多，可以换行，每行最好不要超过80个字符，并且换行后要以4个空格开头。</p><p data-tool="mdnice编辑器">如果 description 部分写得不够爽，还可以在 <strong>@details</strong> 部分进一步详细书写。</p><p data-tool="mdnice编辑器">4.2.3 参数</p><p data-tool="mdnice编辑器">使用 <strong>@param</strong> 来指定参数部分，**@param** 后空1格，写参数的名称，再空1格，写参数的解释，参数的解释不能为空。</p><p data-tool="mdnice编辑器">4.2.4 链接到其它函数</p><p data-tool="mdnice编辑器">有时候，或许我们并不需要把某一个参数的注释写的过于详细，因为其它地方有非常完备的说明，那么我们就可以使用 \code{\link[pkg]{rdname}} 这种形式来进行引用（如果是base环境下的函数，直接把包名写成base就可以啦！）。</p><p data-tool="mdnice编辑器">4.2.5 返回</p><p data-tool="mdnice编辑器">使用 <strong>@return</strong> 来说明函数的返回内容。</p><p data-tool="mdnice编辑器">4.2.6 导出函数</p><p data-tool="mdnice编辑器">如果函数是要分享出来和别人一起使用的，那么就需要将函数从包内导出，在注释部分添加 <strong>@export</strong> 即可，后面不需要写任何内容。</p><p data-tool="mdnice编辑器">如果函数仅在包内使用，那么就不需要添加 <strong>@export</strong>，删除即可。</p><p data-tool="mdnice编辑器">4.2.7 引用函数</p><p data-tool="mdnice编辑器">如果想引用其它包中函数，那么需要使用 <strong>@importFrom</strong>，写法是 **@importFrom+包名+函数名(一个或多个)**，如要引用 base 包中的 sum 函数，那么就可以这样写 —— <strong>@importFrom base sum。</strong></p><p data-tool="mdnice编辑器">如果我们还想引用 base 包中的其他函数，那么可以分开写两个 @importFrom，也可以写成一行。</p><p data-tool="mdnice编辑器">4.2.8 示例</p><p data-tool="mdnice编辑器">每个函数都应该有1个示例，这样更加方便用户来理解它（众所周知，说明文档垃圾还不如不写！）。</p><p data-tool="mdnice编辑器">使用 <strong>@examples</strong> 来指定示例部分，如加入示例 sum2(1, 2)，那么就可以在 <strong>@examples</strong> 后面写上。</p><p data-tool="mdnice编辑器">如果示例不能够被运行，或者运行时间过长，在CRAN检测时不能被通过，可以使用 *<em>donttest{}</em>* 来使得示例在检测时自动被忽略。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5430916552667578" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXpXOyFmPdXgMrPRNy2cwErtsRaibytBFlxOqPJFMGt7bbKVvgkpwSiciaA/640?wx_fmt=png" data-type="png" data-w="731" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXpXOyFmPdXgMrPRNy2cwErtsRaibytBFlxOqPJFMGt7bbKVvgkpwSiciaA/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>4.3 转义注释</span><span></span></h3><p data-tool="mdnice编辑器">函数的注释写完了之后，它并不能被R自动识别，需要将其转义才可以。转义的方法我们在前面 <strong>封装包</strong> 中已经讲解，可以使用快捷键 Ctrl/Command+Shift+D，也可以使用命令 <code>devtools::document()</code>，还可以使用菜单 Build、Document，这里我推荐使用 <code>devtools::document()</code>。</p><pre data-tool="mdnice编辑器"><span></span><code>devtools::document()<br>i Updating xmypkg documentation<br>i Loading xmypkg<br>Writing NAMESPACE<br>Writing NAMESPACE<br>Writing add.Rd<br></code></pre><p data-tool="mdnice编辑器">我们可以看到，写入了一个 Rd 文件，也就 R document 文件，文件名是 add.Rd。</p><p data-tool="mdnice编辑器">点击 man 文件夹下的 add.Rd文件，可以看到略微复杂的内容，这就是最开始写 R 包时最痛苦的地方。</p><p data-tool="mdnice编辑器">转义完之后，再次封装包即可（使用<code>devtools::build()</code>）。</p><p data-tool="mdnice编辑器">至此，创建包、写函数、写注释、转义注释、封装包，bingo！</p><h2 data-tool="mdnice编辑器"><span></span><span>5 引用 R 包函数</span></h2><p data-tool="mdnice编辑器">不同函数可以进行复杂的合作，并不是所有函数都需要我们从头写起，借用他人的函数，可以使我们的工作变得更加简单。</p><h3 data-tool="mdnice编辑器"><span></span><span>5.1 引用 CRAN 包</span><span></span></h3><p data-tool="mdnice编辑器">我们使用 usethis 包中的<code>use_package()</code>函数来指定引用包，<code>use_package()</code>函数中总共有3个参数package、type 和 min_version，package 表示我们要引用包的名称，type 表示引用的类型，常用的引用类型有 Imports、Depends 和 Suggests，min_version 表示包的最小版本号。</p><p data-tool="mdnice编辑器">例如，在 xmypkg 包引用 stats 包，那么 package 就等于"stats"。</p><p data-tool="mdnice编辑器">如果我们只需要使用 stats 包中的某个函数，而不是整个 stats 包，那么引用类型就是 Imports，命令如下：</p><pre data-tool="mdnice编辑器"><span></span><code>usethis::use_package(package = <span>"stats"</span>, <span>type</span> = <span>"Imports"</span>)<br>√ Adding <span>'stats'</span> to Imports field <span>in</span> DESCRIPTION<br>* Refer to <span>functions</span> with `stats::fun()`<br></code></pre><p data-tool="mdnice编辑器">我们看到 Adding "stats" to Imports field in DESCRIPTION，意思是将 stats 包添加在 DESCRIPTION 文件中的 Imports 部分，打开 DESCRIPTION 文件，可以看到多了 Imports 部分，而且下面有 stats。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.48676470588235293" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXTbapHJ9Qd3GYVDibDc7so1Dsia6MVIuiaLIdFSJw8nHBbRibScJEVxD5Xw/640?wx_fmt=png" data-type="png" data-w="680" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXTbapHJ9Qd3GYVDibDc7so1Dsia6MVIuiaLIdFSJw8nHBbRibScJEVxD5Xw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">如果我们需要使用整个 stats 包，也就是 xmypkg 包功能的实现完全依赖于 stats 包，而不是仅仅使用某个函数，type 等于“Depends”，命令如下：</p><pre data-tool="mdnice编辑器"><span></span><code>usethis::use_package(package = <span>"stats"</span>, <span>type</span> = <span>"Depends"</span>)<br>√ Moving <span>'stats'</span> from Imports to Depends field <span>in</span> DESCRIPTION<br>* Are you sure you want Depends? Imports is almost always the better choice.<br></code></pre><p data-tool="mdnice编辑器">stats 被从 Imports 转移到了 Depends 部分，并且告诉我们尽量不用使用 Depends，Imports 是最多且更好的选择。之所以有这样的建议，那是因为当 xmypkg 包对 stats 的关系是 Depends 时，<code>library(xmypkg)</code>时，会同时<code>library(stats)</code>，这样就增加了函数名称冲突的风险，而当 xmypkg 包对 stats 的关系是 Imports，<code>library(xmypkg)</code>包的时候，不会运行<code>library(stats)</code>，也就不会载入 stats 包，从而避免了不必要的函数名冲突，仅引用我们想引用的函数。</p><p data-tool="mdnice编辑器">可以看到，在 DESCRIPTION 文件中，出现了 Depends 部分，并且下面有了 stats。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5330330330330331" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXPcDrTbDGz8C0EBZ5892wCZuIGaZl0Jp9ialSBK1cwJwJtKu9vXTPvDA/640?wx_fmt=png" data-type="png" data-w="666" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXPcDrTbDGz8C0EBZ5892wCZuIGaZl0Jp9ialSBK1cwJwJtKu9vXTPvDA/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">如果 xmypkg 包对 stats 包没有引用和依赖关系，仅仅在例子中使用了该包，那么我们会建议安装这个包，来实现我们的例子，这个时候的关系是“建议”，type 等于“Suggests”。</p><p data-tool="mdnice编辑器">所以，DESCRIPTION文件中的 <strong>Imports、Depends 和 Suggests 分别表示：引用、依赖和建议</strong>。</p><h3 data-tool="mdnice编辑器"><span></span><span>5.2 <strong>引用 Bioconductor 包</strong></span><span></span></h3><p data-tool="mdnice编辑器">单独使用 Imports、Depends 和 Suggests 引用的都是 CRAN 上的包，如果想引用 Bioconductor 上的包，需要在前面加上 <strong>biocViews:</strong> ，例如，我们想在 xmypkg 包中引用 limma 包，我们需要将 limma 写在 Imports 下面，并在 Imports 前加 biocViews: 。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5367316341829086" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXpBmL0KJudINibXiaibvuKPoUkZJJDiaoYjtmbwDRZzQDPpy2YWwSrhPWzA/640?wx_fmt=png" data-type="png" data-w="667" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXpBmL0KJudINibXiaibvuKPoUkZJJDiaoYjtmbwDRZzQDPpy2YWwSrhPWzA/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>5.3 引用函数</span><span></span></h3><p data-tool="mdnice编辑器">引用包是引用函数的前提，如果想引用某个函数，必须先引用该函数所属的R包。引用函数有2种形式：通过 双冒号:: 直接引用；通过 roxygen2 注释引用。</p><p data-tool="mdnice编辑器">例如，我们要引用do包中的join_inner函数，通过双冒号来引用的方式为<code>do::join_inner()</code>；通过注释来引用的方式为<code>#' @importFrom do join_inner</code>。</p><p data-tool="mdnice编辑器">引用函数的方式比较简单，但是有一点需要注意：只能引用R包导出的函数，也就是只能引用双冒号能够访问的函数，如果不能就要用三冒号啦！</p><h2 data-tool="mdnice编辑器"><span></span><span>6 DESCRIPTION 文件撰写</span></h2><p data-tool="mdnice编辑器">DESCRIPTION  文件是 R 包的说明文件，使用者通过阅读该文件，可以快速了解你的 R 包，DESCRIPTION <strong>主要包含</strong>了<strong>标题、说明、作者、通讯方式、版本号</strong>等几个部分，现在我们来介绍一下如何撰写 DESCRIPTION 文件。</p><h3 data-tool="mdnice编辑器"><span></span><span>6.1 Title</span><span></span></h3><p data-tool="mdnice编辑器">标题一般有字数、内容和大小写的要求</p><ol data-tool="mdnice编辑器"><li><section><strong>字数不宜过长</strong>，一般不要超过20个词，过长的标题不宜阅读</section></li><li><section><strong>标题要能够体现包的功能</strong></section></li><li><section>标题的<strong>首字母需要大写</strong>，<strong>注意冠词、连词、介词的首字母需要小写</strong></section></li></ol><h3 data-tool="mdnice编辑器"><span></span><span>6.2 Description</span><span></span></h3><p data-tool="mdnice编辑器">描述部分是一段文字，要以句号结束。描述部分要求详细详细再详细！<strong>描述部分一定要详尽描述包的功能</strong>。这部分可以分多个段落来写，另起一段的时候，要以4个空格起写。<strong>注意不能以 This package 或者 This function 开头，切记！</strong></p><h3 data-tool="mdnice编辑器"><span></span><span>6.3 Authors</span><span></span></h3><p data-tool="mdnice编辑器">需要使用<code>person()</code>函数来创建。在<code>person()</code>函数中，主要有几项是需要写的。</p><p data-tool="mdnice编辑器"><strong>given</strong>：名</p><p data-tool="mdnice编辑器"><strong>family</strong>：姓</p><p data-tool="mdnice编辑器"><strong>middle</strong>：中间的名字</p><p data-tool="mdnice编辑器"><strong>email</strong>：邮件，并不需要每个人的emial，仅给出包的拥有者即可。</p><p data-tool="mdnice编辑器"><strong>role</strong>：角色</p><p data-tool="mdnice编辑器">注意！每个包可以有多个作者，但是拥有者只能有1个。</p><p data-tool="mdnice编辑器"><span>role 的取值如下：</span></p><ul data-tool="mdnice编辑器"><li><p data-tool="mdnice编辑器"><strong>aut：</strong><span>作者author</span></p></li><li><p><strong>com：</strong><span>编译者compiler</span><br></p></li><li><p><strong>cph：</strong><span>版权拥有者copyright holder</span></p></li><li><p><strong>cre：</strong><span>包拥有者creator或者maintainer</span><br></p></li><li><p><strong>ctb：</strong><span>贡献者contributor</span><br></p></li><li><p><strong>ctr：</strong><span>承包者/公司contractor</span><br></p></li><li><p><strong>dtc：</strong><span>贡献数据这data contrbutor</span><br></p></li><li><p><strong>fnd：</strong><span>资助人/组织funder</span><br></p></li><li><p><strong>rev：</strong><span>评论者reviewer</span><br></p></li><li><p><strong>ths：</strong><span>指导者thesis advisor</span><br></p></li><li><p><strong>trl：</strong><span>翻译者translator</span><br></p></li></ul><h3 data-tool="mdnice编辑器"><span></span><span>6.4 Version</span><span></span></h3><p data-tool="mdnice编辑器">R 包必须有版本号，每次更新 R 包必须有不同的版本号，非正式发布的 R 包，版本号可以是零点几的版本，例如 0.9，正式的 R 包建议使用一点几以上的版本，R 包的版本可以是 1.0, 1.01，1.0.0.1。</p><h3 data-tool="mdnice编辑器"><span></span><span>6.5 Example</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="0.9689298043728424" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXl3LTIZYCP3D0lb1vRsYuKkQUdciaN1AoY5VMlMOwYibh56pAtW5PuAicw/640?wx_fmt=png" data-type="png" data-w="869" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLrBIpO8BicamRFCrH3cLrTWXl3LTIZYCP3D0lb1vRsYuKkQUdciaN1AoY5VMlMOwYibh56pAtW5PuAicw/640?wx_fmt=png"></figure><h1 data-tool="mdnice编辑器"><span></span><span>参考资料</span></h1><ol data-tool="mdnice编辑器"><li><section>https://www.jianshu.com/p/8e0db63fcbff</section></li><li><section>https://www.bilibili.com/video/BV1rf4y157ue</section><p><br></p><p><br></p><section><br></section><p><br></p></li></ol></section><section><mp-common-profile data-pluginname="mpprofile" data-weui-theme="light" data-id="Mzg5NjE1NTc1OA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLpicdicvWNnpcaTbejCVgKe4FsicHqo48FOkqJTkziaengudibCF8AW86uyjgee0pxhmhM8JoylYDkSXug/0?wx_fmt=png" data-nickname="生信小白要知道" data-alias="Bioidiot" data-signature="主打小白保姆级教程，因为自己淋过雨，所以想给大家撑把伞！ 记录从小白到现在小灰的过程，希望以后可以成为小黑！" data-from="1" data-is_biz_ban="0"></mp-common-profile></section><section><br></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/d-QEJP0aD8Xz7IiHyQDO2Q",target="_blank" rel="noopener noreferrer">原文链接</a>
