---
title: "单细胞测序 | 细胞周期分析"
date: 2023-07-28T13:39:44Z
draft: ["false"]
tags: [
  "fetched",
  "生信控"
]
categories: ["Acdemic"]
---
单细胞测序 | 细胞周期分析 by 生信控
------
<div><p><img data-ratio="0.15625" data-src="https://mmbiz.qpic.cn/mmbiz_gif/GXnBwOcM857kicu3mN7sf73m53xRalJjvkd6jjlWBRqHTic97up9smWS7lZjB6py0O5l0hus3g6lyiaCBdc6fCkcQ/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" data-w="640" src="https://mmbiz.qpic.cn/mmbiz_gif/GXnBwOcM857kicu3mN7sf73m53xRalJjvkd6jjlWBRqHTic97up9smWS7lZjB6py0O5l0hus3g6lyiaCBdc6fCkcQ/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></p><blockquote><p>Cell cycle variation is a common source of uninteresting variation in single-cell RNA-seq data. To examine cell cycle variation in our data, we assign each cell a score, based on its expression of G2/M and S phase markers.</p></blockquote><p><span>https://hbctraining.github.io/scRNA-seq/lessons/cell_cycle_scoring.html</span></p><p>基本原理是基于 G2/M 和 S 期的 markers 基因表达情况，对各细胞进行打分，判断其所处阶段（phase），常用工具包括Seurat、scran等。</p><p>Seurat 包中内置了一组 markers：</p><p><span>https://satijalab.org/seurat/reference/cc.genes.html</span></p><pre><span></span><code>library(Seurat) <br>str(cc.genes) <span># Seurat 内置的细胞周期 markers</span><br>cc.genes$s.genes <span># S 期 markers, 43个</span><br>cc.genes$g2m.genes <span># G2M 期 markers, 54个</span></code></pre><p>markers 来源于文献 doi: 10.1126/science.aad0501，在 2019 年做过一次更新：</p><p><span>https://satijalab.org/seurat/reference/cc.genes.updated.2019.html</span></p><pre><span></span><code>cc.genes.updated.2019</code></pre><p>markers 个数未变，更新的只是 Symbol...</p><p>另外，由于只有人的markers，故如果分析其他物种，需要使用BioMart等工具进行同源匹配。这里可以使用别人造好的轮子：</p><p><span>https://github.com/hbc/tinyatlas/tree/master/cell_cycle</span></p><p>包含四个物种：</p><p><span>Danio_rerio</span>、<span>Drosophila_melanogaster</span>、<span>Homo_sapiens</span>、<span>Mus_musculus</span></p><p>由于收录的是 Ensembl ID，故而不再需要考虑 Symbol 更新的问题，只需要实时转换就行，以人为例：</p><pre><code><span># 从上示链接下载文件到本地再读取</span><br>cell_cycle_genes = read.csv(<span>"Homo_sapiens.csv"</span>)<br><br><span># BiocManager::install("AnnotationHub")</span><br><span># BiocManager::install("ensembldb")</span><br>library(AnnotationHub)<br>library(tidyverse)<br>ah = AnnotationHub() <span># 连接数据库</span><br>ahDb = query(ah, pattern = <span>c</span>(<span>"Homo sapiens"</span>, <span>"EnsDb"</span>), ignore.case = <span>TRUE</span>) <span># 物种</span><br>id = ahDb %&gt;% mcols() %&gt;% rownames() %&gt;% tail(n = <span>1</span>) <span># 最新版本</span><br>edb = ah[[id]] <span># 下载</span><br>annotations = genes(edb, return.type = <span>"data.frame"</span>) %&gt;% dplyr::select(gene_id, gene_name, gene_biotype, description) <span># 提取基因信息</span><br><span># ID转换</span><br>cell_cycle_markers = left_join(cell_cycle_genes, annotations, by = <span>c</span>(<span>"geneID"</span> = <span>"gene_id"</span>))<br><span># S markers</span><br>s_genes = cell_cycle_markers %&gt;% filter(phase == <span>"S"</span>) %&gt;% pull(<span>"gene_name"</span>)<br><span># G2M markers</span><br>g2m_genes = cell_cycle_markers %&gt;% filter(phase == <span>"G2/M"</span>) %&gt;% pull(<span>"gene_name"</span>)</code></pre><p>使用 pbmc3k 数据进行测试：</p><pre><span></span><code>library(magrittr)<br>library(SeuratData)<br>library(Seurat) <br>data(<span>"pbmc3k"</span>)<br><span># 预处理，否则 CellCycleScoring 会报错！</span><br>pbmc3k %&lt;&gt;% NormalizeData() %&gt;% FindVariableFeatures() %&gt;% ScaleData() %&gt;% RunPCA() <br><span># 打分</span><br><span>#s_genes = cc.genes.updated.2019$s.genes</span><br><span>#g2m_genes = cc.genes.updated.2019$g2m.genes</span><br>pbmc3k = CellCycleScoring(pbmc3k, s.features = s_genes, g2m.features = g2m_genes)</code></pre><p>打分结果及判定的 phase 信息存储于 <code>pbmc3k@meta.data</code>，一般用PCA可视化查看细胞是否按 phase 分组：</p><blockquote><p>After scoring each gene for cell cycle phase, we can perform PCA using the expression of cell cycle genes. If the cells group by cell cycle in the PCA, then we would want to <strong>regress out</strong> cell cycle variation, <strong>unless cells are differentiating</strong>.</p></blockquote><pre><span></span><code><span># 可视化（基于markers的PCA）</span><br>pbmc3k = RunPCA(pbmc3k, features = <span>c</span>(s_genes, g2m_genes))<br>DimPlot(pbmc3k, reduction = <span>"pca"</span>, group.by = <span>"Phase"</span>)</code></pre><p>当然，也可以将细胞周期信息显示在UMAP图上，便于比较分析：</p><pre><span></span><code>pbmc3k %&lt;&gt;% RunPCA(verbose = <span>F</span>) %&gt;% RunUMAP(dims = <span>1</span>:<span>30</span>, verbose = <span>F</span>)<br><br>library(ggplot2)<br>p1 = DimPlot(pbmc3k, group.by=<span>'seurat_annotations'</span>, label = <span>F</span>, reduction=<span>'umap'</span>) + ggtitle(<span>'CellType'</span>) + theme(plot.title = element_text(hjust = <span>0.5</span>))<br>p2 = DimPlot(pbmc3k, group.by=<span>'Phase'</span>, label = <span>F</span>, reduction = <span>"umap"</span>) + ggtitle(<span>'Phase'</span>) + theme(plot.title = element_text(hjust = <span>0.5</span>))<br>p = p1 + p2</code></pre><figure><img data-ratio="0.4351851851851852" data-src="https://mmbiz.qpic.cn/mmbiz_png/GXnBwOcM855eILa2eQCeurZx96BbCOa0pATCqGrs6aJZ1dHIt77UuhTH4r2Wh5QqE7HeoDXvCJfR41ptvuBtqw/640?wx_fmt=png" data-type="png" data-w="1080" title="null" src="https://mmbiz.qpic.cn/mmbiz_png/GXnBwOcM855eILa2eQCeurZx96BbCOa0pATCqGrs6aJZ1dHIt77UuhTH4r2Wh5QqE7HeoDXvCJfR41ptvuBtqw/640?wx_fmt=png"></figure><p><span>注意！</span>上图可见，细胞并未按照不同的 phase 进行分组，而是G1/G2M/S混杂在一起，意味着细胞周期因素并未对细胞类型的鉴定带来明显的负面影响，反过来，如果细胞在图中按不同的 phase 分组，除非是明确样本中确实存在该现象，否则需要进行<strong>回归校正（regress out）</strong>，该过程在 <code>ScaleData()</code> 中实现：</p><p><span>https://satijalab.org/seurat/articles/cell_cycle_vignette.html</span></p><pre><span></span><code>pbmc3k = ScaleData(pbmc3k, vars.to.regress = <span>c</span>(<span>"S.Score"</span>, <span>"G2M.Score"</span>))</code></pre><p>校正之后，可以再次使用 PCA 或 UMAP 结果进行确认。</p><p><span>注意！</span>由于 <code>ScaleData()</code> 属于预处理的步骤，也就意味着确实需要校正的情况下，其后的分析也都会连带受影响...</p><section data-darkmode-bgcolor="rgb(36, 36, 36)"><section data-darkmode-bgcolor="rgb(36, 36, 36)"><img data-ratio="0.3208955223880597" data-src="https://mmbiz.qpic.cn/mmbiz_gif/GXnBwOcM854H437mZXWZCJTqTQZhyDcYEQ1bk43JRXIlfjwwevW2rqZ8vibL9sSVlToSrLNtSjpJqxkHic4E8UAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" data-type="gif" data-w="134" width="4em" src="https://mmbiz.qpic.cn/mmbiz_gif/GXnBwOcM854H437mZXWZCJTqTQZhyDcYEQ1bk43JRXIlfjwwevW2rqZ8vibL9sSVlToSrLNtSjpJqxkHic4E8UAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section><section data-darkmode-bgcolor="rgb(36, 36, 36)"><br data-darkmode-bgcolor="rgb(36, 36, 36)"></section></section><section data-darkmode-bgcolor="rgb(36, 36, 36)"><br></section><section data-tools="135编辑器" data-id="93199" data-darkmode-bgcolor="rgb(36, 36, 36)" data-style='white-space: normal; max-width: 100%; box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgba(255, 255, 255, 0.8); font-family: -apple-system-font, system-ui, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif; letter-spacing: 0.544px; border-width: 0px; border-style: none; border-color: initial; overflow-wrap: break-word !important;'><section><section data-darkmode-bgcolor="rgb(36, 36, 36)"><section data-darkmode-bgcolor="rgb(36, 36, 36)"><section data-darkmode-bgcolor="rgb(36, 36, 36)" data-style="margin-left: 5px; padding-right: 15px; padding-left: 15px; max-width: 100%; box-sizing: border-box; border-color: rgb(0, 0, 0); border-width: 1px; border-style: solid; background: rgb(255, 181, 2); display: inline-block; font-size: 12px; overflow-wrap: break-word !important;"><p data-darkmode-bgcolor="rgb(36, 36, 36)"><span data-darkmode-bgcolor="rgb(36, 36, 36)">绘图系列·往期精彩</span></p></section></section></section></section><section data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-color="rgb(167, 167, 167)" data-style="margin-top: -5.5px; padding: 1em 0.8em; max-width: 100%; box-sizing: border-box; border-color: rgb(0, 0, 0); font-size: 14px; letter-spacing: 1.5px; line-height: 1.75em; border-width: 1px; border-style: solid; overflow-wrap: break-word !important;"><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzIyNzk1NjUxOA==&amp;mid=2247485588&amp;idx=1&amp;sn=90e63fd25ef01135b2a9da8e0421f467&amp;chksm=e8580adddf2f83cbda5183fd68bd0c05db60fb933beae300c9f673edd47056f8c555e01ca4db&amp;scene=21#wechat_redirect" textvalue="单细胞测序 | 拟时序分析 Monocle3 接 seurat" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">单细胞测序 | 拟时序分析 Monocle3 接 seurat</a><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzIyNzk1NjUxOA==&amp;mid=2247485586&amp;idx=1&amp;sn=e152cea40bfee7d16291be5a4ed30c5c&amp;chksm=e8580adbdf2f83cd9b161687f68ea30440786b7659eabe23c7565c5459005015fd1ef3ce56fa&amp;scene=21#wechat_redirect" textvalue="单细胞测序 | cellranger 细胞识别" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">单细胞测序 | cellranger 细胞识别</a><br></section></section></section><section><br></section><section><img data-ratio="0.593939393939394" data-src="https://mmbiz.qpic.cn/mmbiz_png/GXnBwOcM854H437mZXWZCJTqTQZhyDcYqmIeAAMEcFe5NZQ9YmGwbRQibdWzd6P26ibllZtaVzicc5IzBj9ibW2xqA/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="jpeg" data-w="825" src="https://mmbiz.qpic.cn/mmbiz_png/GXnBwOcM854H437mZXWZCJTqTQZhyDcYqmIeAAMEcFe5NZQ9YmGwbRQibdWzd6P26ibllZtaVzicc5IzBj9ibW2xqA/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/yanrXoGox9kpH9-FIGQSwA",target="_blank" rel="noopener noreferrer">原文链接</a>
