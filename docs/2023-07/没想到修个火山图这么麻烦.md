---
title: "没想到修个火山图这么麻烦"
date: 2023-07-24T12:57:58Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
没想到修个火山图这么麻烦 by 生信菜鸟团
------
<div><p data-tool="mdnice编辑器">看到了曾老师于20年布置的学徒作业~</p><p data-tool="mdnice编辑器"><br><img data-ratio="0.5166666666666667" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDZpTxssYBSeJGB46L0D2a4O9oiaUGF1HibStV0G8TeF1S7KC0juQc8xhQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDZpTxssYBSeJGB46L0D2a4O9oiaUGF1HibStV0G8TeF1S7KC0juQc8xhQ/640?wx_fmt=png"> </p><p data-tool="mdnice编辑器"><img data-ratio="1.2702188392007612" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDEw2wRUlia96un1wEAZd3VdIcmcXmWRSKs6NfQvRnnbAaGnibrJlb4GMA/640?wx_fmt=png" data-type="png" data-w="1051" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDEw2wRUlia96un1wEAZd3VdIcmcXmWRSKs6NfQvRnnbAaGnibrJlb4GMA/640?wx_fmt=png">就是需要复现上图~ 草草一看应该是提取原始数据，取差异基因然后绘图吧。</p><p data-tool="mdnice编辑器"><strong>这个文章的补充材料里面给的 是counts和P值...</strong><br></p><p data-tool="mdnice编辑器">先做了除法，就是两个实验组标准化counts分别除以除以对照组标准化counts</p><pre data-tool="mdnice编辑器"><code>rm(list=ls())<br>options(warn = -1)<br><span>##结果发现人家可能只是用了除法</span><br>library(dplyr)<br>author.matrix=read.delim(file=<span>"nanostring_author_gene.txt"</span>, header = T,sep = <span>"\t"</span>,quote = <span>"\""</span>,<br>                         row.names = 1)<br>colnames(author.matrix)<br>colnames(author.matrix)=c(<span>"Cont"</span>,<span>"STING.activated"</span>,<span>"STING.deficient"</span>,<span>"Cont.vs.activated_Pvalue"</span>,<span>"Cont.vs.deficient_Pvalue"</span>)<br><span>##添加除法列,判断谁除谁</span><br>author.matrix[<span>"Cdh5"</span>,] <span>#"Cdh5""STING.activated"高表达，"STING.deficient"低表达</span><br><span># Cont STING.activated STING.deficient Cont.vs.activated_Pvalue Cont.vs.deficient_Pvalue</span><br><span># Cdh5 50.954         143.587          34.814                    0.045                    0.014</span><br><span># Cont作为分母</span><br>author.matrix<span>$de</span>.vs.Cont=author.matrix<span>$STING</span>.deficient / author.matrix<span>$Cont</span><br>author.matrix<span>$acti</span>.vs.Cont=author.matrix<span>$STING</span>.activated / author.matrix<span>$Cont</span><br>author.matrix[<span>"Cdh5"</span>,]<span>#检验一下</span><br><span># Cont STING.activated STING.deficient Cont.vs.activated_Pvalue Cont.vs.deficient_Pvalue</span><br><span># Cdh5 50.954         143.587          34.814                    0.045                    0.014</span><br><span># de.vs.Cont acti.vs.Cont</span><br><span># Cdh5  0.6832437     2.817973</span><br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.2843488649940263" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDCbavpsgJw7mhAu13ACUQbffDvMNsSEBwHwxH9JKaCguUs3dEzCiaHJw/640?wx_fmt=png" data-type="png" data-w="837" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDCbavpsgJw7mhAu13ACUQbffDvMNsSEBwHwxH9JKaCguUs3dEzCiaHJw/640?wx_fmt=png"><figcaption> </figcaption></figure><h2 data-tool="mdnice编辑器"><span>9.2 整理矩阵</span><span></span></h2><p data-tool="mdnice编辑器">再把两部分数据结合，按照数据来源进行分组</p><pre data-tool="mdnice编辑器"><code><span>##整理矩阵</span><br>draw.data=data.frame(gene=c(rownames(author.matrix),rownames(author.matrix)),<br>                     fold=c(author.matrix<span>$acti</span>.vs.Cont,author.matrix<span>$de</span>.vs.Cont),<br>                     p_value=c(author.matrix<span>$Cont</span>.vs.activated_Pvalue,<br>                               author.matrix<span>$Cont</span>.vs.deficient_Pvalue),<br>                     group=factor(c(rep(1,750),rep(2,750))))<br><br>draw.data[750:751,] <span># 核对</span><br><span># gene      fold p_value group</span><br><span># 750 Map2k2 1.0014670    0.98     1</span><br><span># 751    Itk 0.6636043    0.19     2</span><br> author.matrix[c(750,1),]<br><span># Cont STING.activated STING.deficient Cont.vs.activated_Pvalue</span><br><span># Map2k2 481.946         482.653         462.779                     0.98</span><br><span># Itk      6.531          23.041           4.334                     0.00</span><br><span># Cont.vs.deficient_Pvalue de.vs.Cont acti.vs.Cont</span><br><span># Map2k2                    0.395  0.9602300     1.001467</span><br><span># Itk                       0.190  0.6636043     3.527944</span><br><span># draw.data$Pvalue_log10=log10(draw.data$p_value)</span><br><span># draw.data=draw.data[-(1:10),]</span><br><span># draw.data=draw.data[draw.data$Pvalue_log10 != "-Inf",]</span><br><span># #save(draw.data,file = "drawdata.Rdata")</span><br></code></pre><p data-tool="mdnice编辑器">最后得到用于绘图的矩阵如下~找到图示基因与计算结果核对，发现能对的上。</p><section><img data-ratio="1.6785714285714286" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDicxt2c5xpzhACJ1iaiapDVYicHiaOVcbgrMgl3H0pDGjs1bc3LhsKYd8qkw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-w="308" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDicxt2c5xpzhACJ1iaiapDVYicHiaOVcbgrMgl3H0pDGjs1bc3LhsKYd8qkw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><h1 data-tool="mdnice编辑器"><span>10 绘图</span><span></span></h1><h2 data-tool="mdnice编辑器"><span>10.1 先绘一张基础图</span><span></span></h2><p data-tool="mdnice编辑器"><strong>emmmm，外部链接难以复制到公众号内部，请有需要的各位自行检索</strong><span></span></p><p data-tool="mdnice编辑器">问了师弟在网上找了和这个图长的差不多的图像， </p><p data-tool="mdnice编辑器">《MAplot转录组差异基因表达展示》</p><p data-tool="mdnice编辑器"> MAplot转录组差异基因表达展示_maplot r语言_TS的美梦的博客-CSDN博客自己也顺着这线索另外找了教程 </p><p data-tool="mdnice编辑器"><span>《</span><span>RNA-Seq分析中（二）——用R画带基因名标签的MA图》</span></p><p data-tool="mdnice编辑器">RNA-Seq分析中（二）——用R画带基因名标签的MA图 - 知乎 (zhihu.com)另外</p><p data-tool="mdnice编辑器">上面算是模板吧。</p><p data-tool="mdnice编辑器">其实引起我最大注意的还是，看到横坐标是科学计数法显示的 </p><p data-tool="mdnice编辑器">于是就搜索的教程 </p><p data-tool="mdnice编辑器">《如何使用ggplot更改轴上数字的格式？》</p><p data-tool="mdnice编辑器">如何使用ggplot更改轴上数字的格式？- 问答 - 腾讯云开发者社区-腾讯云 (tencent.com)发现作者给了个函数</p><pre data-tool="mdnice编辑器"><code><span>#####科学记数法显示x轴坐标</span><br> fancy_scientific &lt;- <span>function</span>(l) {<br>   <span># turn in to character string in scientific notation</span><br>   l &lt;- format(l, scientific = TRUE)<br>   l &lt;- gsub(<span>"0e\\+00"</span>,<span>"0"</span>,l)<br>   <span># quote the part before the exponent to keep all the digits</span><br>   l &lt;- gsub(<span>"^(.*)e"</span>, <span>"'\\1'e"</span>, l)<br>   <span># remove "+" after exponent, if exists. E.g.: (3x10^+2 -&gt; 3x10^2) </span><br>   l &lt;- gsub(<span>"e\\+"</span>,<span>"e"</span>,l)<br>   <span># turn the 'e+' into plotmath format</span><br>   l &lt;- gsub(<span>"e"</span>, <span>"%*%10^"</span>, l)<br>   <span># convert 1x10^ or 1.000x10^ -&gt; 10^ </span><br>   l &lt;- gsub(<span>"\\'1[\\.0]*\\'\\%\\*\\%"</span>, <span>""</span>, l)<br>   <span># return this as an expression</span><br>   parse(text=l)<br> }<br></code></pre><p data-tool="mdnice编辑器">结合一下， 另外使用scale_x_reverse函数使x轴从大到小，并且使用breaks和labels指定要显示的数值和对应的标签</p><pre data-tool="mdnice编辑器"><code><span>## 绘图</span><br> library(ggpubr)<br> library(ggthemes)<br> ggscatter(draw.data, <br>           x = <span>"p_value"</span>, y = <span>"fold"</span>,<br>           color = <span>"group"</span>) + <br>   theme_base()+<br>   scale_x_reverse(breaks = c(1,0.1,0.01,0.001,0.0001,0.00001,0.000001,0.0000001),<br>                   labels=fancy_scientific)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.850925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDpKXZKSG3qlv3WgMWZhcaopR26icgaEcdf0uP1jiczJH9HYLlJicparBjw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDpKXZKSG3qlv3WgMWZhcaopR26icgaEcdf0uP1jiczJH9HYLlJicparBjw/640?wx_fmt=png"><figcaption><br></figcaption></figure><h2 data-tool="mdnice编辑器"><span>10.2 加y轴拉伸</span><span></span></h2><p data-tool="mdnice编辑器">然后我发现目标图像的y轴比例是调整过的 于是坐标轴拉伸教程：《R画图y轴范围太大时，如何局部压缩坐标轴？》R画图y轴范围太大时，如何局部压缩坐标轴？- 知乎 (zhihu.com)</p><p data-tool="mdnice编辑器">文章里作者给了个函数</p><pre data-tool="mdnice编辑器"><code> <span>###拉伸缩小坐标的函数</span><br> library(scales)<br> squash_axis &lt;- <span>function</span>(from, to, factor) { <br>   <span># Args:</span><br>   <span>#   from: left end of the axis</span><br>   <span>#   to: right end of the axis</span><br>   <span>#   factor: the compression factor of the range [from, to]</span><br>   <br>   trans &lt;- <span>function</span>(x) {    <br>     <span># get indices for the relevant regions</span><br>     isq &lt;- x &gt; from &amp; x &lt; to<br>     ito &lt;- x &gt;= to<br>     <br>     <span># apply transformation</span><br>     x[isq] &lt;- from + (x[isq] - from)/factor<br>     x[ito] &lt;- from + (to - from)/factor + (x[ito] - to)<br>     <br>     <span>return</span>(x)<br>   }<br>   <br>   inv &lt;- <span>function</span>(x) {<br>     <span># get indices for the relevant regions</span><br>     isq &lt;- x &gt; from &amp; x &lt; from + (to - from)/factor<br>     ito &lt;- x &gt;= from + (to - from)/factor<br>     <br>     <span># apply transformation</span><br>     x[isq] &lt;- from + (x[isq] - from) * factor<br>     x[ito] &lt;- to + (x[ito] - (from + (to - from)/factor))<br>     <br>     <span>return</span>(x)<br>   }<br>   <br>   <span># return the transformation</span><br>   <span>return</span>(trans_new(<span>"squash_axis"</span>, trans, inv))<br> }<br></code></pre><p data-tool="mdnice编辑器">于是我对y轴0.05-1.5范围的坐标轴拉伸了20倍，并且顺带指定了scale_y_continuous函数中的breaks和labels参数 绘图代码如下</p><pre data-tool="mdnice编辑器"><code> ggscatter(draw.data, <br>           x = <span>"p_value"</span>, y = <span>"fold"</span>,<br>           color = <span>"group"</span>) + <br>   theme_base()+<br>   coord_trans(y = squash_axis(0.05, 1.5, 0.05))+<br>   scale_y_continuous(breaks = c(0.05,0.5,1,5,50),<br>                      labels = c(0.05,0.5,1,5,50))+<br>   scale_x_reverse(breaks = c(1,0.1,0.01,0.001,0.0001,0.00001,0.000001,0.0000001),<br>                   labels=fancy_scientific)<br></code></pre><p data-tool="mdnice编辑器">图像如下~，能看到开始以1为轴进行分布了。<img data-ratio="0.850925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDcqOXuiaDp6g7y8d13GSleFoEZHCyibgFH8cdkmOuXJGKr9hmtKfRI95Q/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDcqOXuiaDp6g7y8d13GSleFoEZHCyibgFH8cdkmOuXJGKr9hmtKfRI95Q/640?wx_fmt=png">很明显这张图的x轴和作者的图还有较大的差距<img data-ratio="0.1675925925925926" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDTIrBNWo4Wlq3u0LzzRlhGEic9opzsFjykOXTgIibxoxsiaL1W2w0OUnwA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDTIrBNWo4Wlq3u0LzzRlhGEic9opzsFjykOXTgIibxoxsiaL1W2w0OUnwA/640?wx_fmt=png">因为人家的x轴长这样，是均匀分布的 我想到一种可能，就是作者自己先计算了log10然后再和横坐标的标记进行对应。虽然显示的是10^-1，但实际上对应的数值是经过计算之后的0.1。</p><h2 data-tool="mdnice编辑器"><span>10.3 计算log10，加一列</span><span></span></h2><p data-tool="mdnice编辑器">x轴可能需要的是经过log后的数据，只不过标记的数值用的是科学计数法，相当于加了个标签 那就，调整X轴数据，取个log10，然后标签加成科学计数法 给表达矩阵加一列</p><pre data-tool="mdnice编辑器"><code> draw.data<span>$Pvalue_log10</span>=log10(draw.data<span>$p_value</span>)<br>draw.data=draw.data[-(1:10),]<br>draw.data=draw.data[draw.data<span>$Pvalue_log10</span> != <span>"-Inf"</span>,]<br><span>#save(draw.data,file = "drawdata.Rdata")</span><br></code></pre><p data-tool="mdnice编辑器">用于绘图的表达矩阵长这样~<img data-ratio="1.3504901960784315" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDXlaZSzPp5FUGVBohLsZ5WMFPrBadCiaiaasZKFSImicxuPU6AlID2uWag/640?wx_fmt=png" data-type="png" data-w="408" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDXlaZSzPp5FUGVBohLsZ5WMFPrBadCiaiaasZKFSImicxuPU6AlID2uWag/640?wx_fmt=png">看见表达矩阵里面有Inf值，测试了一下虽然加着也能画，但强迫症到最后的最后还是删掉了...<img data-ratio="0.899074074074074" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDDfju5UxCicwiaF3OlKhN1nVx4Pb1p4Glt1M4gIepKkTmle5BnsPZWLMw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDDfju5UxCicwiaF3OlKhN1nVx4Pb1p4Glt1M4gIepKkTmle5BnsPZWLMw/640?wx_fmt=png"></p><h2 data-tool="mdnice编辑器"><span>10.4 更换x轴数值，调整x、y轴显示范围</span><span></span></h2><p data-tool="mdnice编辑器">coord_trans函数的ylim、xlim参数</p><pre data-tool="mdnice编辑器"><code> ggscatter(draw.data, <br>           x = <span>"Pvalue_log10"</span>, y = <span>"fold"</span>,<br>           color = <span>"group"</span>) + <br>   theme_base()+<br>   <span>#coord_cartesian(ylim = c(0.05, 50))+</span><br>   coord_trans(y = squash_axis(0.05, 1.4, 0.01),x=squash_axis(0,3,1),<br>               ylim = c(0.05,50),xlim = c(0,-5))+<br>   scale_y_continuous(breaks = c(0.05,0.5,1,5,50),<br>                      labels = c(0.05,0.5,1,5,50))+<br>   scale_x_reverse(breaks = c(0,-1,-2,-3,-4,-5,-6),<br>                   labels=c(expression(10^-0),expression(10^-1),<br>                            expression(10^-2),expression(10^-3),<br>                            expression(10^-4),expression(10^-5),<br>                            expression(10^-5)))<br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.850925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDpiaUtZbc4ogdUY3FOrgB7gCp88Lwvdu7JtHDVicDHCvLRav1iaL4hrenQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDpiaUtZbc4ogdUY3FOrgB7gCp88Lwvdu7JtHDVicDHCvLRav1iaL4hrenQ/640?wx_fmt=png">这下X轴标签对了 看到整体上面有一团点 我觉得可能是因为excle的表格数值精度有限，所以计算出来的P值的log10值对应的也是非常密集。从10.3部分可以看到有一堆-0.3000000，所以我觉得是正常的。</p><h2 data-tool="mdnice编辑器"><span>10.5 调整Y轴，更换图像主题</span><span></span></h2><pre data-tool="mdnice编辑器"><code> ggscatter(draw.data, <br>           x = <span>"Pvalue_log10"</span>, y = <span>"fold"</span>,<br>           color = <span>"group"</span>) + <br>   geom_point(alpha=0.1, size=0.5, shape=2,<br>              aes(color=group)) +<br>   <span>#scale_color_manual(values=c("blue","red"))+</span><br>   theme_classic()+<br>   <span>#coord_cartesian(ylim = c(0.05, 50))+</span><br>   coord_trans(y = squash_axis(0.05, 2.5, 0.008),x=squash_axis(0,3,1),<br>               ylim = c(0.05,50),xlim = c(0,-5))+<br>   scale_y_continuous(breaks = c(0.05,0.5,1,5,50),<br>                      labels = c(0.05,0.5,1,5,50))+<br>   scale_x_reverse(breaks = c(0,-1,-2,-3,-4,-5,-6),<br>                   labels=c(expression(10^-0),expression(10^-1),<br>                            expression(10^-2),expression(10^-3),<br>                            expression(10^-4),expression(10^-5),<br>                            expression(10^-5)))<br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.850925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDgWRmRwUaQNeBflI8ibibQeEynS9jb42QqReZre6aKVzUSGdIqc1fXm0A/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDgWRmRwUaQNeBflI8ibibQeEynS9jb42QqReZre6aKVzUSGdIqc1fXm0A/640?wx_fmt=png">差不多，加个注释线</p><h2 data-tool="mdnice编辑器"><span>10.6 添加注释线</span><span></span></h2><pre data-tool="mdnice编辑器"><code> ggscatter(draw.data, <br>           x = <span>"Pvalue_log10"</span>, y = <span>"fold"</span>,<br>           color = <span>"group"</span>) + <br>   geom_point(alpha=0.1, size=0.5, shape=2,<br>              aes(color=group)) +<br>   <span>#scale_color_manual(values=c("blue","red"))+</span><br>   theme_classic()+<br>   <span>#coord_cartesian(ylim = c(0.05, 50))+</span><br>   coord_trans(y = squash_axis(0.05, 2, 0.01),x=squash_axis(0,3,1),<br>               ylim = c(0.05,50),xlim = c(0,-5))+<br>   scale_y_continuous(breaks = c(0.05,0.5,1,5,50),<br>                      labels = c(0.05,0.5,1,5,50))+<br>   scale_x_reverse(breaks = c(0,-1,-2,-3,-4,-5,-6),<br>                   labels=c(expression(10^-0),expression(10^-1),<br>                            expression(10^-2),expression(10^-3),<br>                            expression(10^-4),expression(10^-5),<br>                            expression(10^-5)))+<br>   geom_vline(xintercept=-1.5,lty=4,col=<span>"grey"</span>,linewidth=0.8)+<br>   geom_hline(yintercept = 1,lty=1,col=<span>"black"</span>,linewidth=0.4)  <span>##加横线</span><br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.7268518518518519" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDicCztLmyNds1icPA7jGSfmIBDibcF497iaJOKrLnV884yhgRlvgIsADBzw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDicCztLmyNds1icPA7jGSfmIBDibcF497iaJOKrLnV884yhgRlvgIsADBzw/640?wx_fmt=png">好的注释线也加好了 继续观察图像 发现作者x\y轴的是相交的，不像我这个还有空余</p><h2 data-tool="mdnice编辑器"><span>10.7 让x轴的最小值和y轴相交</span><span></span></h2><p data-tool="mdnice编辑器">教程：《ggplot2中我如何让y轴与x轴相交0？- 优文库》 http://www.uwenku.com/question/p-cmjyklfm-uk.html 设置expand=c(0,0) 调整x\y轴</p><pre data-tool="mdnice编辑器"><code> ggscatter(draw.data, <br>           x = <span>"Pvalue_log10"</span>, y = <span>"fold"</span>,<br>           color = <span>"group"</span>) + <br>   geom_point(alpha=0.1, size=0.5, shape=2,<br>              aes(color=group)) +<br>   <span>#scale_color_manual(values=c("blue","red"))+</span><br>   theme_classic()+<br>   <span>#coord_cartesian(ylim = c(0.05, 50))+</span><br>   coord_trans(y = squash_axis(0.05, 2, 0.01),x=squash_axis(0,3,1),<br>               ylim = c(0.05,50),xlim = c(0,-5))+<br>   scale_y_continuous(breaks = c(0.05,0.5,1,5,50),<br>                      labels = c(0.05,0.5,1,5,50),expand=c(0,0))+<br>   scale_x_reverse(breaks = c(0,-1,-2,-3,-4,-5,-6),<br>                   labels=c(expression(10^-0),expression(10^-1),<br>                            expression(10^-2),expression(10^-3),<br>                            expression(10^-4),expression(10^-5),<br>                            expression(10^-5)),expand=c(0,0))+<br>   geom_vline(xintercept=-1.5,lty=4,col=<span>"grey"</span>,linewidth=0.8)+<br>   geom_hline(yintercept = 1,lty=1,col=<span>"black"</span>,linewidth=0.4)  <span>##加横线</span><br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.850925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDmR4vKWj4A0b9jiaHlXM5al87megK1SazeOFZPmyYCWyxRTibia1fHco9A/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDmR4vKWj4A0b9jiaHlXM5al87megK1SazeOFZPmyYCWyxRTibia1fHco9A/640?wx_fmt=png">到目前已经让x轴和y轴中间没有保留了~ 嗯~长的已经比较像了，稍微美化一下吧</p><h2 data-tool="mdnice编辑器"><span>10.8 修改边框、图注、颜色...美化</span><span></span></h2><p data-tool="mdnice编辑器">用到的参考资料 《玩转数据可视化之R语言ggplot2：（七）对图形添加注释和标签（包含标题、坐标轴、参考线和高亮等注释方法）》 https://blog.csdn.net/weixin_45052363/article/details/124153241#74__446 找到了一个设置主题的代码</p><pre data-tool="mdnice编辑器"><code>   theme(axis.ticks.y = element_blank(),<br>         axis.text.y = element_text(size = 15, colour = <span>"black"</span> ),<br>         axis.text.x = element_text(size = 15, colour = <span>"black"</span> ),<br>         axis.ticks=element_blank(),<br>         axis.title.x=element_blank(),<br>         axis.title.y=element_blank())<br></code></pre><p data-tool="mdnice编辑器">直接加入</p><pre data-tool="mdnice编辑器"><code> ggscatter(draw.data, <br>           x = <span>"Pvalue_log10"</span>, y = <span>"fold"</span>,<br>           color = <span>"group"</span>,ylab=<span>"Fold change(vs. PBS)"</span>,rug = F,<br>           shape = 20,size = 3) +<br>     scale_color_manual(values=c( <span>"#ff4757"</span>,<span>"#546de5"</span>))+<br>   theme(axis.ticks.y = element_blank(),<br>         axis.text.y = element_text(size = 15, colour = <span>"black"</span> ),<br>         axis.text.x = element_text(size = 15, colour = <span>"black"</span> ),<br>         axis.ticks=element_blank(),<br>         axis.title.x=element_blank(),<br>         axis.title.y=element_blank())+<br>   coord_trans(y = squash_axis(0.05, 2, 0.01),x=squash_axis(0,3,1),<br>               ylim = c(0.05,50),xlim = c(0,-4.1))+<br>   scale_y_continuous(breaks = c(0.05,0.5,1,5,50),<br>                      labels = c(0.05,0.5,1,5,50),expand=c(0,0))+<br>   scale_x_reverse(breaks = c(0,-1,-2,-3),<br>                   labels=c(expression(10^-0),expression(10^-1),                      expression(10^-2),expression(10^-3)),expand=c(0,0))+geom_vline(xintercept=-1.301029995663981,lty=4,col=<span>"grey"</span>,linewidth=1)+<br>geom_hline(yintercept = 1,lty=1,col=<span>"black"</span>,linewidth=0.4)<br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.850925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDHqa1SmOYDYIvur8iaDvqQPqEFIXsYWfrkx9ib6mPDLiaqarVOibIcKXaFQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDHqa1SmOYDYIvur8iaDvqQPqEFIXsYWfrkx9ib6mPDLiaqarVOibIcKXaFQ/640?wx_fmt=png">好的，是时候加个基因标注了</p><h2 data-tool="mdnice编辑器"><span>10.9 加基因标注-geom_text_repel报错处理</span><span></span></h2><p data-tool="mdnice编辑器">需要标注哪些基因我得告诉R 所以先构建了新的矩阵</p><pre data-tool="mdnice编辑器"><code> library(ggstatsplot)<br> library(ggrepel)<br> up.article=c( <span>"Angpt1"</span>,<span>"Pdgfrb"</span>,<span>"Cdh5"</span>,<span>"Sell"</span>,<span>"Ccr7"</span>,<span>"Cd86"</span>)<br> down.article=c( <span>"Cdh5"</span>,<span>"Mcam"</span>,<span>"Angpt1"</span>,<span>"Sell"</span>,<span>"Vegfa"</span>)<br> up.gene=draw.data[draw.data<span>$fold</span> &gt;1,][draw.data[draw.data<span>$fold</span> &gt;1,]<span>$gene</span> %<span>in</span>% up.article,]<br> down.gene=draw.data[draw.data<span>$fold</span> &lt; 1,][draw.data[draw.data<span>$fold</span> &lt; 1,]<span>$gene</span> %<span>in</span>% down.article,]<br> diff.gene=rbind(up.gene,down.gene)<br> diff.gene=diff.gene[!is.na(diff.gene),]<br> diff.gene=na.omit(diff.gene)<br> rownames(diff.gene)=1:11<br></code></pre><p data-tool="mdnice编辑器">其实之前在火山图里面看到过标注基因的代码 于是上网找教程R语言实战：使用ggplot2包绘制个性化火山图 - 知乎 (zhihu.com)其实找了好几个教程,大佬们给的模板都大差不差，就不太多展示了。模板如下：</p><pre data-tool="mdnice编辑器"><code>geom_text_repel(data = filter(data, abs(logFC) &gt; 1 &amp; -log10(adj.P.Val) &gt; 38),<br>                  max.overlaps = getOption(<span>"ggrepel.max.overlaps"</span>, default = 20),<br>                  aes(label = gene, <br>                      color = change),<br>                  size = 2)<br></code></pre><p data-tool="mdnice编辑器">用的是geom_text_repel函数 但...报错了...</p><pre data-tool="mdnice编辑器"><code>Error <span>in</span> `geom_label_repel()`:<br>! Problem <span>while</span> converting geom to grob.<br>ℹ Error occurred <span>in</span> the 2nd layer.<br>Caused by error <span>in</span> `x[isq] &lt;- from + (x[isq] - from) / factor`:<br>! NAs are not allowed <span>in</span> subscripted assignments<br>Run `rlang::last_trace()` to see <span>where</span> the error occurred.<br></code></pre><p data-tool="mdnice编辑器">网上找了一圈，没有进展 去看geom_text_repel说明书，结合报错里面也有NA<img data-ratio="0.3574468085106383" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodD6kNeQAwQLOhet1CAg3dsViarrhJgWlvsGyeXhlSBMQib4U9v8a9JYjpg/640?wx_fmt=png" data-type="png" data-w="235" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodD6kNeQAwQLOhet1CAg3dsViarrhJgWlvsGyeXhlSBMQib4U9v8a9JYjpg/640?wx_fmt=png">看到了这个参数里面有NA 于是就试了试，把xlim和ylim设置了一下</p><pre data-tool="mdnice编辑器"><code>ggscatter(draw.data, <br>           x = <span>"Pvalue_log10"</span>, y = <span>"fold"</span>,<br>           color = <span>"group"</span>,ylab=<span>"Fold change(vs. PBS)"</span>,rug = F,<br>           shape = 20,size = 3) +<br>     <span>#geom_point(alpha=0.4, size=3.5) +</span><br>     scale_color_manual(values=c( <span>"#ff4757"</span>,<span>"#546de5"</span>))+<br>   <span>##加横线</span><br>   geom_label_repel(data = diff.gene, aes(x = diff.gene<span>$Pvalue_log10</span>,<br>                                          y = diff.gene<span>$fold</span>,<br>                                          label = gene),<br>                    size = 3, box.padding = unit(0.4, <span>"lines"</span>),<br>                    point.padding = unit(0.8, <span>"lines"</span>),<br>                    segment.color = <span>"black"</span>,<br>                    show.legend = FALSE,<br>                    na.rm = T,<br>                    ylim = c(0.05,50),xlim = c(3,4),<br>                    direction = <span>"y"</span>) +<br>   <span>#directlabels::geom_dl(aes(label = group), method = "smart.grid")+</span><br>   <span>#scale_colour_discrete(guide="none")</span><br>   theme(axis.ticks.y = element_blank(),<br>         axis.text.y = element_text(size = 15, colour = <span>"black"</span> ),<br>         axis.text.x = element_text(size = 15, colour = <span>"black"</span> ),<br>         axis.ticks=element_blank(),<br>         axis.title.x=element_blank(),<br>         axis.title.y=element_blank())+<br>   coord_trans(y = squash_axis(0.05, 2, 0.01),x=squash_axis(0,3,1),<br>               ylim = c(0.05,50),xlim = c(0,-4.1))+<br>   scale_y_continuous(breaks = c(0.05,0.5,1,5,50),<br>                      labels = c(0.05,0.5,1,5,50),expand=c(0,0))+<br>   scale_x_reverse(breaks = c(0,-1,-2,-3),<br>                   labels=c(expression(10^-0),expression(10^-1),<br>                   expression(10^-2),expression(10^-3)),expand=c(0,0))+geom_vline(xintercept=-1.301029995663981,lty=4,col=<span>"grey"</span>,linewidth=1)+<br>   geom_hline(yintercept = 1,lty=1,col=<span>"black"</span>,linewidth=0.4)<br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.850925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDWXSQ7m4wZbficQ1BYkzKdjzgehN7SiadeIqEDiakD9Cg4C9rXrTVwZtRg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDWXSQ7m4wZbficQ1BYkzKdjzgehN7SiadeIqEDiakD9Cg4C9rXrTVwZtRg/640?wx_fmt=png">？？x和y轴的名称不知道什么时候没有了，<img data-ratio="0.4020442930153322" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDYJxXzPJvC1crrzYLiaabRYgLrZeUaWsN6f2PXeURHIaQN4vPwzoEy4g/640?wx_fmt=png" data-type="png" data-w="587" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDYJxXzPJvC1crrzYLiaabRYgLrZeUaWsN6f2PXeURHIaQN4vPwzoEy4g/640?wx_fmt=png">原来是theme这里覆盖了.. 修改代码</p><pre data-tool="mdnice编辑器"><code>ggscatter(draw.data, <br>           x = <span>"Pvalue_log10"</span>, y = <span>"fold"</span>,<br>           color = <span>"group"</span>,ylab=<span>"Fold change(vs. PBS)"</span>,rug = F,<br>           shape = 20,size = 3) +<br>     <span>#geom_point(alpha=0.4, size=3.5) +</span><br>     scale_color_manual(values=c( <span>"#ff4757"</span>,<span>"#546de5"</span>))+<br>   <span>##加横线</span><br>   geom_label_repel(data = diff.gene, aes(x = diff.gene<span>$Pvalue_log10</span>,<br>                                          y = diff.gene<span>$fold</span>,<br>                                          label = gene),<br>                    size = 3, box.padding = unit(0.4, <span>"lines"</span>),<br>                    point.padding = unit(0.8, <span>"lines"</span>),<br>                    segment.color = <span>"black"</span>,<br>                    show.legend = FALSE,<br>                    na.rm = T,<br>                    ylim = c(0.05,50),xlim = c(3,4),<br>                    direction = <span>"y"</span>) +<br>   <span>#directlabels::geom_dl(aes(label = group), method = "smart.grid")+</span><br>   <span>#scale_colour_discrete(guide="none")</span><br>   theme(axis.ticks.y = element_blank(),<br>         axis.text.y = element_text(size = 15, colour = <span>"black"</span> ),<br>         axis.text.x = element_text(size = 15, colour = <span>"black"</span> ),<br>         axis.ticks=element_blank())+<br>   coord_trans(y = squash_axis(0.05, 2, 0.01),x=squash_axis(0,3,1),<br>               ylim = c(0.05,50),xlim = c(0,-4.1))+<br>   scale_y_continuous(breaks = c(0.05,0.5,1,5,50),<br>                      labels = c(0.05,0.5,1,5,50),expand=c(0,0))+<br>   scale_x_reverse(breaks = c(0,-1,-2,-3),<br>                   labels=c(expression(10^-0),expression(10^-1),<br>                   expression(10^-2),expression(10^-3)),expand=c(0,0))+geom_vline(xintercept=-1.301029995663981,lty=4,col=<span>"grey"</span>,linewidth=1)+<br>   geom_hline(yintercept = 1,lty=1,col=<span>"black"</span>,linewidth=0.4)<br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.850925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDjsP7Uic1yDahNUp6fibjYPz59IfMnmcMO6oMJ5KdnC1KuKcDTOdNAHdA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDjsP7Uic1yDahNUp6fibjYPz59IfMnmcMO6oMJ5KdnC1KuKcDTOdNAHdA/640?wx_fmt=png">但我发现<img data-ratio="0.15254237288135594" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDyhMohMZ2rEoq1dkQIKv0ic5vy6RkrqSLd3XTe6slm6ZicZoc1pyZCstA/640?wx_fmt=png" data-type="png" data-w="708" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDyhMohMZ2rEoq1dkQIKv0ic5vy6RkrqSLd3XTe6slm6ZicZoc1pyZCstA/640?wx_fmt=png">我的刻度线也不见了，就上面这个家伙... 继续搜索教程~</p><h2 data-tool="mdnice编辑器"><span>10.10 修改坐标轴刻度</span><span></span></h2><p data-tool="mdnice编辑器">让我康康这样的刻度要怎么才能让它再度出现， 上网搜，教程如下 https://blog.csdn.net/qq_42458954/article/details/112604443 《6.7 坐标轴：移除刻度标签、刻度线和主网格线（关于刻度的逻辑）》 https://zhuanlan.zhihu.com/p/111896783 找到个具体名称介绍的<img data-ratio="0.5148148148148148" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDF8kVtA3jeMTjChV4JeqMRGZTrVwVxOQ5m27Fciau5bNviclauUan75ibA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDF8kVtA3jeMTjChV4JeqMRGZTrVwVxOQ5m27Fciau5bNviclauUan75ibA/640?wx_fmt=png">但搜到的资料显示，通过主题的修改，刻度标签和刻度线总是需要同时出现的.. 那么，作者是如何做到部分有刻度线但没有刻度标签的.. 修改的时候发现自己设置的主题是没有刻度线的，于是修改了主题 难道...等等我有一个大胆的猜测<img data-ratio="0.7681818181818182" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDTLtpibBDfHMYL73ESaIu5qt9OY93THfBH9MulLwrSFOTsTW00jQXib2A/640?wx_fmt=png" data-type="png" data-w="440" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDTLtpibBDfHMYL73ESaIu5qt9OY93THfBH9MulLwrSFOTsTW00jQXib2A/640?wx_fmt=png">在设置scale_y_continuous，scale_x_reverse两个函数的时候label的可以直接为空？试一下</p><pre data-tool="mdnice编辑器"><code> ggscatter(draw.data, <br>           x = <span>"Pvalue_log10"</span>, y = <span>"fold"</span>,<br>           color = <span>"group"</span>,ylab=<span>"Fold change(vs. PBS)"</span>,xlab = <span>"P-value"</span>,rug = F,<br>           shape = 20,size = 3) +<br>     scale_color_manual(values=c( <span>"#ff4757"</span>,<span>"#546de5"</span>))+<br>   geom_label_repel(data = diff.gene, aes(x = diff.gene<span>$Pvalue_log10</span>,<br>                                          y = diff.gene<span>$fold</span>,<br>                                          label = gene),<br>                    size = 3, box.padding = unit(0.4, <span>"lines"</span>),<br>                    point.padding = unit(0.8, <span>"lines"</span>),<br>                    segment.color = <span>"black"</span>,<br>                    show.legend = FALSE,<br>                    na.rm = T,<br>                    ylim = c(0.05,50),xlim = c(3,4),<br>                    direction = <span>"y"</span>) +<br>   theme_classic()+<br>   theme(<br>         axis.text.y = element_text(size = 10, colour = <span>"black"</span> ),<br>         axis.text.x = element_text(size = 10, colour = <span>"black"</span> ))+<br>   coord_trans(y = squash_axis(0.05, 2, 0.01),x=squash_axis(0,3,1),<br>               ylim = c(0.05,50),xlim = c(0,-4.1))+<br>   scale_y_continuous(breaks = c(0.05,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,<br>                                 1,5,50),<br>                      labels = c(0.05,<span>""</span>,<span>""</span>,<span>""</span>,<span>""</span>,0.5,<span>""</span>,<span>""</span>,<span>''</span>,<span>''</span>,<br>                                 1,5,50),expand=c(0,0))+<br>   scale_x_reverse(breaks = c(0,-0.1,-0.2,-0.3,-0.4,-0.5,-0.6,-0.7,-0.8,<br>                              -1,-2,-3),<br>                   labels=c(expression(10^-0),<span>''</span>,<span>''</span>,<span>''</span>,<span>''</span>,<span>''</span>,<span>''</span>,<span>''</span>,<span>''</span>,<br>                            expression(10^-1),<br>                            expression(10^-2),expression(10^-3)),expand=c(0,0))+geom_vline(xintercept=-1.301029995663981,lty=4,col=<span>"grey"</span>,linewidth=1)+<br>   geom_hline(yintercept = 1,lty=1,col=<span>"black"</span>,linewidth=0.4)<br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.850925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDJ0L25DiaO4Yo6VhpicCV4ueMpkY4ZHaZDYAhX0897cRxibAUF49zRb0RA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDJ0L25DiaO4Yo6VhpicCV4ueMpkY4ZHaZDYAhX0897cRxibAUF49zRb0RA/640?wx_fmt=png">好耶，刻度线这不就加上了嘛 是时候删除右边的图例了..</p><h2 data-tool="mdnice编辑器"><span>10.11 删图例，加注释（分组\P值）</span><span></span></h2><p data-tool="mdnice编辑器">删除图例教程：</p><p data-tool="mdnice编辑器">https://blog.csdn.net/LeaningR/article/details/114576555 legend.title=element_blank() </p><p data-tool="mdnice编辑器"><strong>但是....没有发现不同的分组可以用不同颜色的字来表示。</strong></p><p data-tool="mdnice编辑器">感觉分组是作者另外加的注释 </p><p data-tool="mdnice编辑器">找到的教程：《ggplot中的注释图层annotate》</p><p data-tool="mdnice编辑器">ggplot中的注释图层</p><p data-tool="mdnice编辑器">annotate_zoujiahui_2018的博客-CSDN博客《R语言ggplot2包之注释》</p><p data-tool="mdnice编辑器">R语言ggplot2包之注释_r语言 ggplot annotate parse_zx403413599的博客-CSDN博客</p><p data-tool="mdnice编辑器">P值的注释是竖的，所以，搜到的教程~ </p><p data-tool="mdnice编辑器"><strong>修改注释字的角度 </strong></p><p data-tool="mdnice编辑器">《如何在ggplot2中旋转图中的注释文本（附实例）》 https://juejin.cn/post/7117025583959113764 </p><p data-tool="mdnice编辑器"><strong>而且这个P一看就是斜体，所以还要知道怎么样设置字体 </strong></p><p data-tool="mdnice编辑器">设置字体 </p><p data-tool="mdnice编辑器">《ggplot2|theme主题设置，详解绘图优化-“精雕细琢”》</p><p data-tool="mdnice编辑器">ggplot2|theme主题设置，详解绘图优化-“精雕细琢” - 知乎 (zhihu.com)</p><p data-tool="mdnice编辑器"><strong>分组的注释是两行的，我该如何表示换行？</strong></p><p data-tool="mdnice编辑器">于是搜索的教程：双""中间表示换行 《 R中转义符》 https://www.douban.com/note/512515819/?_i=9842178-fjctlC</p><p data-tool="mdnice编辑器">综合以上的信息 我设置了三个annotate函数</p><pre data-tool="mdnice编辑器"><code>ggscatter(draw.data, <br>           x = <span>"Pvalue_log10"</span>, y = <span>"fold"</span>,<br>           color = <span>"group"</span>,ylab=<span>"Fold change(vs. PBS)"</span>,xlab = <span>"P-value"</span>,rug = F,<br>           shape = 20,size = 3) +<br>     scale_color_manual(values=c( <span>"#ff4757"</span>,<span>"#546de5"</span>))+<br>   geom_label_repel(data = diff.gene, aes(x = diff.gene<span>$Pvalue_log10</span>,<br>                                          y = diff.gene<span>$fold</span>,<br>                                          label = gene),<br>                    size = 3, box.padding = unit(0.4, <span>"lines"</span>),<br>                    point.padding = unit(0.8, <span>"lines"</span>),<br>                    segment.color = <span>"black"</span>,<br>                    show.legend = FALSE,<br>                    na.rm = T,<br>                    ylim = c(0.05,50),xlim = c(3,4),<br>                    direction = <span>"y"</span>) +<br>   theme_classic()+<br>   theme(axis.text.y = element_text(size = 10, colour = <span>"black"</span> ),<br>         axis.text.x = element_text(size = 10, colour = <span>"black"</span> ),<br>         <span>#legend.title=element_blank(),</span><br>         legend.position = <span>"none"</span>)+<br>   coord_trans(y = squash_axis(0.05, 2, 0.01),x=squash_axis(0,3,1),<br>               ylim = c(0.05,50),xlim = c(0,-6.1))+<br>   scale_y_continuous(breaks = c(0.05,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,<br>                                 1,5,50),<br>                      labels = c(0.05,<span>""</span>,<span>""</span>,<span>""</span>,<span>""</span>,0.5,<span>""</span>,<span>""</span>,<span>''</span>,<span>''</span>,<br>                                 1,5,50),expand=c(0,0))+<br>   scale_x_reverse(breaks = c(0,-0.1,-0.2,-0.3,-0.4,-0.5,-0.6,-0.7,-0.8,<br>                              -1,-2,-3,-4,-5,-6),<br>                   labels=c(expression(10^-0),<span>''</span>,<span>''</span>,<span>''</span>,<span>''</span>,<span>''</span>,<span>''</span>,<span>''</span>,<span>''</span>,<br>                            expression(10^-1),<br>                            expression(10^-2),<br>                            expression(10^-3),<br>                            expression(10^-4),<br>                            expression(10^-5),<br>                            expression(10^-6)),<br>                   expand=c(0,0))+geom_vline(xintercept=-1.301029995663981,lty=4,col=<span>"grey"</span>,linewidth=1)+<br>   geom_hline(yintercept = 1,lty=1,col=<span>"black"</span>,linewidth=0.4)+<br>   annotate(<span>'text'</span>,x=-5,y=40,label=<span>"STING \n activated"</span>,color=<span>"#ff4757"</span>)+<br>   annotate(<span>'text'</span>,x=-5,y=0.2,label=<span>"STING \n deficient"</span>,color=<span>"#546de5"</span>)+<br>annotate(<span>'text'</span>,x=-1,y=34,label=<span>"P=0.05"</span>,color=<span>"black"</span>,angle=90,fontface=<span>"italic"</span>)<br></code></pre><p data-tool="mdnice编辑器">得到的图如下：</p><p data-tool="mdnice编辑器"><img data-ratio="0.850925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDqBuBvuHYPazNSTC3Z6iboliaUphfNPYRZ1iavbDKomLDKQ8kZ1IWL4VXQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDqBuBvuHYPazNSTC3Z6iboliaUphfNPYRZ1iavbDKomLDKQ8kZ1IWL4VXQ/640?wx_fmt=png">这个时候跟大家再提一嘴原图，不然可能都忘了..<img data-ratio="1.1444444444444444" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDicrQ3cKAlKiauJsFUryia2ElcCL59L2Sj8RuD4KR1HTC6S7ytdGXYt5Ng/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDicrQ3cKAlKiauJsFUryia2ElcCL59L2Sj8RuD4KR1HTC6S7ytdGXYt5Ng/640?wx_fmt=png">很明显，原图是没有x轴的</p><h2 data-tool="mdnice编辑器"><span>10.12 去x轴，加线段</span><span></span></h2><p data-tool="mdnice编辑器">于是又开始搜教程，如何去掉x轴，然后怎么样才能给注释线加上标尺... 找到的教程5.4 添加注释：添加线段(segment) - 知乎 (zhihu.com)《ggplot2作图：隐去坐标轴标签（xlab、ylab）》ggplot2作图：隐去坐标轴标签（xlab、ylab） - 知乎 (zhihu.com)《# ggplot2 line types : How to change line types of a graph in R software?》线型 http://www.sthda.com/english/wiki/ggplot2-line-types-how-to-change-line-types-of-a-graph-in-r-software 综合以上教程，以下代码我一共做了2件事 1-我把theme函数里面所有关于x轴的参数全部设置为空 2-然后我把线段标注当成坐标刻度绘制在注释线上..</p><pre data-tool="mdnice编辑器"><code> ggscatter(draw.data, <br>           x = <span>"Pvalue_log10"</span>, y = <span>"fold"</span>,<br>           color = <span>"group"</span>,ylab=<span>"Fold change(vs. PBS)"</span>,xlab = <span>""</span>,rug = F,<br>           shape = 20,size = 3,show.legend.text = T,ggtheme = theme_void()) +<br>     scale_color_manual(values=c( <span>"#ff4757"</span>,<span>"#546de5"</span>))+<br>   <span>##加标签</span><br>   geom_label_repel(data = diff.gene, aes(x = diff.gene<span>$Pvalue_log10</span>,<br>                                          y = diff.gene<span>$fold</span>,<br>                                          label = gene),<br>                    size = 3, box.padding = unit(0.4, <span>"lines"</span>),<br>                    point.padding = unit(0.8, <span>"lines"</span>),<br>                    segment.color = <span>"black"</span>,<br>                    show.legend = FALSE,<br>                    na.rm = T,<br>                    ylim = c(0.05,50),xlim = c(3,4),<br>                    direction = <span>"y"</span>) +<br>   theme_classic()+<br>   theme(<span>#axis.text.y = element_text(size = 10, colour = "black" ),</span><br>         <span>#axis.text.x = element_text(size = 10, colour = "black" ),</span><br>         <span>#legend.title=element_blank(),</span><br>         legend.position = <span>"none"</span>,<br>         axis.ticks.x = element_blank(),<br>         axis.text.x=element_blank(),<br>         axis.line.x=element_blank()<br>         )+<br>   coord_trans(y = squash_axis(0.05, 2, 0.01),x=squash_axis(0,3,1),<br>               ylim = c(0.05,50),xlim = c(0,-6))+<br>   scale_y_continuous(breaks = c(0.05,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,<br>                                 1,5,50),<br>                      labels = c(0.05,<span>""</span>,<span>""</span>,<span>""</span>,<span>""</span>,0.5,<span>""</span>,<span>""</span>,<span>''</span>,<span>''</span>,<br>                                 1,5,50),expand=c(0,0))+<br>   scale_x_reverse(<span>#breaks = c(0,-0.1,-0.2,-0.3,-0.4,-0.5,-0.6,-0.7,-0.8,-1,-2,-3,-4,-5,-6),</span><br>                   <span># labels=c(expression(10^-0),'','','','','','','','',</span><br>                   <span>#          expression(10^-1),</span><br>                   <span>#          expression(10^-2),</span><br>                   <span>#          expression(10^-3),</span><br>                   <span>#          expression(10^-4),</span><br>                   <span>#          expression(10^-5),</span><br>                   <span>#          expression(10^-6)),</span><br>                   expand=c(0,0),<br>                   breaks = NULL)+geom_vline(xintercept=-1.301029995663981,lty=4,col=<span>"grey"</span>,linewidth=1)+<br>   geom_hline(yintercept = 1,lty=1,col=<span>"black"</span>,linewidth=0.4)+<br>   annotate(<span>'text'</span>,x=-4.3,y=40,label=<span>"STING \n activated"</span>,color=<span>"#ff4757"</span>)+<br>   annotate(<span>'text'</span>,x=-4.3,y=0.2,label=<span>"STING \n deficient"</span>,color=<span>"#546de5"</span>)+<br>   annotate(<span>'text'</span>,x=-1.2,y=34,label=<span>"P=0.05"</span>,color=<span>"black"</span>,angle=90,fontface=<span>"italic"</span>)+<br>   annotate(<span>'segment'</span>,x = -0.1, xend = -0.1, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -0.15, xend = -0.15, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -0.22, xend = -0.22, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -0.31, xend = -0.31, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -0.25, xend = -0.25, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -0.28, xend = -0.28, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'text'</span>,x=-0.2,y=0.94,label=expression(10^-0),color=<span>"black"</span>,fontface=<span>"bold"</span>)+<br>   annotate(<span>'text'</span>,x=-1.1,y=0.94,label=expression(10^-1),color=<span>"black"</span>,fontface=<span>"bold"</span>)+<br>   annotate(<span>'segment'</span>,x = -1, xend = -1, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -1.2, xend = -1.2, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'text'</span>,x=-2.1,y=0.94,label=expression(10^-2),color=<span>"black"</span>,fontface=<span>"bold"</span>)+<br>   annotate(<span>'segment'</span>,x = -2, xend = -2, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -2.2, xend = -2.2, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'text'</span>,x=-3.1,y=0.94,label=expression(10^-3),color=<span>"black"</span>,fontface=<span>"bold"</span>)+<br>   annotate(<span>'segment'</span>,x = -3, xend = -3, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -3.2, xend = -3.2, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'text'</span>,x=-4.1,y=0.94,label=expression(10^-4),color=<span>"black"</span>,fontface=<span>"bold"</span>)+<br>   annotate(<span>'segment'</span>,x = -4, xend = -4, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -4.2, xend = -4.2, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'text'</span>,x=-5.1,y=0.94,label=expression(10^-5),color=<span>"black"</span>,fontface=<span>"bold"</span>)+<br>   annotate(<span>'segment'</span>,x = -5, xend = -5, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -5.2, xend = -5.2, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'text'</span>,x=-5.85,y=0.94,label=expression(10^-6),color=<span>"black"</span>,fontface=<span>"bold"</span>)+<br>   annotate(<span>'segment'</span>,x = -6, xend = -6, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)<br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.8561151079136691" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodD97os9btFxpT0TRuQoaFrVwib2bW76wATO9VABd36hriaq9XPP93FtYZg/640?wx_fmt=png" data-type="png" data-w="695" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodD97os9btFxpT0TRuQoaFrVwib2bW76wATO9VABd36hriaq9XPP93FtYZg/640?wx_fmt=png">终于..标上了 再对照了一下作者的图，发现颜色是渐变的</p><h2 data-tool="mdnice编辑器"><span>10.13 加渐变色...</span><span></span></h2><p data-tool="mdnice编辑器">...看起来是渐变色，其实是4个颜色.. 于是就先先添加用于分组的列</p><pre data-tool="mdnice编辑器"><code> draw.data<span>$color_4</span> = ifelse(draw.data<span>$fold</span> &gt;= 1 &amp; draw.data<span>$p_value</span> &lt; 0.05,<span>"goodup"</span>,<br>                             ifelse(draw.data<span>$fold</span> &gt;= 1 &amp; draw.data<span>$p_value</span> &gt;= 0.05,<span>"up"</span>,<br>                                    ifelse(draw.data<span>$fold</span> &lt;= 1 &amp; draw.data<span>$p_value</span> &gt;= 0.05,<span>"down"</span>,<br>                                           <span>"gooddown"</span>)))<br>head(draw.data)<br> <span># gene      fold p_value           group Pvalue_log10  color_4</span><br> <span># 11   Klrd1 2.9291279   0.001 STING activated           -3   goodup</span><br> <span># 12 Tnfsf11 2.2882951   0.001 STING activated           -3   goodup</span><br> <span># 13    Gbp5 4.3578296   0.001 STING activated           -3   goodup</span><br> <span># 14   Pdcd1 2.9417155   0.001 STING activated           -3   goodup</span><br> <span># 15    Cd40 3.2617735   0.001 STING activated           -3   goodup</span><br> <span># 16   Birc5 0.7692822   0.001 STING activated           -3 gooddown</span><br></code></pre><p data-tool="mdnice编辑器">修改分组列 修改scale_color_manual函数</p><pre data-tool="mdnice编辑器"><code>ggscatter(draw.data, <br>           x = <span>"Pvalue_log10"</span>, y = <span>"fold"</span>,<br>           color = <span>"color_4"</span>,ylab=<span>"Fold change(vs. PBS)"</span>,xlab = <span>""</span>,rug = F,<br>           shape = 20,size = 3,show.legend.text = T,ggtheme = theme_void()) +<br>     scale_color_manual(values=c( <span>"#96a6ef"</span>,<span>"#546de5"</span>,<span>"#ff4757"</span>,<span>"#ffbdc2"</span>))+<br>   <span>##加标签</span><br>   geom_label_repel(data = diff.gene, aes(x = diff.gene<span>$Pvalue_log10</span>,<br>                                          y = diff.gene<span>$fold</span>,<br>                                          label = gene),<br>                    size = 3, box.padding = unit(0.4, <span>"lines"</span>),<br>                    point.padding = unit(0.8, <span>"lines"</span>),<br>                    segment.color = <span>"black"</span>,<br>                    show.legend = FALSE,<br>                    na.rm = T,<br>                    ylim = c(0.05,50),xlim = c(3,4),<br>                    direction = <span>"y"</span>) +<br>   theme_classic()+<br>   theme(<span>#axis.text.y = element_text(size = 10, colour = "black" ),</span><br>         <span>#axis.text.x = element_text(size = 10, colour = "black" ),</span><br>         <span>#legend.title=element_blank(),</span><br>         legend.position = <span>"none"</span>,<br>         axis.ticks.x = element_blank(),<br>         axis.text.x=element_blank(),<br>         axis.line.x=element_blank()<br>         )+<br>   coord_trans(y = squash_axis(0.05, 2, 0.01),x=squash_axis(0,3,1),<br>               ylim = c(0.05,50),xlim = c(0,-6))+<br>   scale_y_continuous(breaks = c(0.05,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,<br>                                 1,5,50),<br>                      labels = c(0.05,<span>""</span>,<span>""</span>,<span>""</span>,<span>""</span>,0.5,<span>""</span>,<span>""</span>,<span>''</span>,<span>''</span>,<br>                                 1,5,50),expand=c(0,0))+<br>   scale_x_reverse(<span>#breaks = c(0,-0.1,-0.2,-0.3,-0.4,-0.5,-0.6,-0.7,-0.8,-1,-2,-3,-4,-5,-6),</span><br>                   <span># labels=c(expression(10^-0),'','','','','','','','',</span><br>                   <span>#          expression(10^-1),</span><br>                   <span>#          expression(10^-2),</span><br>                   <span>#          expression(10^-3),</span><br>                   <span>#          expression(10^-4),</span><br>                   <span>#          expression(10^-5),</span><br>                   <span>#          expression(10^-6)),</span><br>                   expand=c(0,0),<br>                   breaks = NULL)+<br>   geom_vline(xintercept=-1.301029995663981,lty=4,col=<span>"grey"</span>,linewidth=1)+<br>   geom_hline(yintercept = 1,lty=1,col=<span>"black"</span>,linewidth=0.4)+<br>   annotate(<span>'text'</span>,x=-4.3,y=40,label=<span>"STING \n activated"</span>,color=<span>"#ff4757"</span>)+<br>   annotate(<span>'text'</span>,x=-4.3,y=0.2,label=<span>"STING \n deficient"</span>,color=<span>"#546de5"</span>)+<br>   annotate(<span>'text'</span>,x=-1.2,y=34,label=<span>"P=0.05"</span>,color=<span>"black"</span>,angle=90,fontface=<span>"italic"</span>)+<br>   annotate(<span>'text'</span>,x=-5.5,y=1.099,label=<span>"P-value"</span>,color=<span>"black"</span>,fontface=<span>"italic"</span>)+<br>   annotate(<span>'segment'</span>,x = -0.1, xend = -0.1, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -0.15, xend = -0.15, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -0.22, xend = -0.22, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -0.31, xend = -0.31, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -0.25, xend = -0.25, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -0.28, xend = -0.28, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'text'</span>,x=-0.2,y=0.94,label=expression(10^-0),color=<span>"black"</span>,fontface=<span>"bold"</span>)+<br>   annotate(<span>'text'</span>,x=-1.1,y=0.94,label=expression(10^-1),color=<span>"black"</span>,fontface=<span>"bold"</span>)+<br>   annotate(<span>'segment'</span>,x = -1, xend = -1, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -1.2, xend = -1.2, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'text'</span>,x=-2.1,y=0.94,label=expression(10^-2),color=<span>"black"</span>,fontface=<span>"bold"</span>)+<br>   annotate(<span>'segment'</span>,x = -2, xend = -2, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -2.2, xend = -2.2, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'text'</span>,x=-3.1,y=0.94,label=expression(10^-3),color=<span>"black"</span>,fontface=<span>"bold"</span>)+<br>   annotate(<span>'segment'</span>,x = -3, xend = -3, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -3.2, xend = -3.2, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'text'</span>,x=-4.1,y=0.94,label=expression(10^-4),color=<span>"black"</span>,fontface=<span>"bold"</span>)+<br>   annotate(<span>'segment'</span>,x = -4, xend = -4, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -4.2, xend = -4.2, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'text'</span>,x=-5.1,y=0.94,label=expression(10^-5),color=<span>"black"</span>,fontface=<span>"bold"</span>)+<br>   annotate(<span>'segment'</span>,x = -5, xend = -5, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'segment'</span>,x = -5.2, xend = -5.2, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)+<br>   annotate(<span>'text'</span>,x=-5.85,y=0.94,label=expression(10^-6),color=<span>"black"</span>,fontface=<span>"bold"</span>)+<br>   annotate(<span>'segment'</span>,x = -6, xend = -6, y = 0.98, yend = 1,color=<span>"black"</span>,size=0.001)<br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.8188512518409425" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDk2QSN0ecRV2bYsH2lnUpa7Nwr5sias88euSZUkotZNFkicSanSSoL1GQ/640?wx_fmt=png" data-type="png" data-w="679" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDk2QSN0ecRV2bYsH2lnUpa7Nwr5sias88euSZUkotZNFkicSanSSoL1GQ/640?wx_fmt=png">终于...</p><p data-tool="mdnice编辑器">展示一下作者的图和我的图~<img data-ratio="0.524074074074074" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDaXAUUyZOOyVb61qDmSLCX4c9vPIC3ibTllwB9AEnK4UTXJRib90n9ujA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDaXAUUyZOOyVb61qDmSLCX4c9vPIC3ibTllwB9AEnK4UTXJRib90n9ujA/640?wx_fmt=png">基本上吧，最后x轴的上移还是用代码实现了，要说细节肯定还有很多没有修改</p><h1 data-tool="mdnice编辑器"><span>11 如果使用差异基因作图呢？</span><span></span></h1><p data-tool="mdnice编辑器">再次回到知乎文章，发现作者其实还提供了另一个已经标准化过的矩阵，<img data-ratio="0.5851851851851851" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDGhlnUlvcia6ZUoLDk0ia5l8iciaqbTcQVbOLlJD3fdPcyaXia5EypIYhRNA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDGhlnUlvcia6ZUoLDk0ia5l8iciaqbTcQVbOLlJD3fdPcyaXia5EypIYhRNA/640?wx_fmt=png">我想，他用于绘图的数据不会就是平均标准化后的数据得到的吧..<img data-ratio="0.5990740740740741" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodD0WwRX4sQp0gWQNnVxabKXvvcTzM3kQPBqOXSCdticXJkqV2AK86MwBg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodD0WwRX4sQp0gWQNnVxabKXvvcTzM3kQPBqOXSCdticXJkqV2AK86MwBg/640?wx_fmt=png">打算试一下A2m这个基因 用于绘图的值是6.128<img data-ratio="0.0980952380952381" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDu3ppl46KcWtqxQvrhWzUrWT2G60mw4qIToahwKgKYgMxMgOIEKuWibQ/640?wx_fmt=png" data-type="png" data-w="1050" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDu3ppl46KcWtqxQvrhWzUrWT2G60mw4qIToahwKgKYgMxMgOIEKuWibQ/640?wx_fmt=png">我平均一下标准化之后的值， 得到..<img data-ratio="0.16621253405994552" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDnXyrzoPdjuE5RB73GET32X1vAgZ18oZH7x2TR09Jstk3LG9ctZ20Bg/640?wx_fmt=png" data-type="png" data-w="367" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDnXyrzoPdjuE5RB73GET32X1vAgZ18oZH7x2TR09Jstk3LG9ctZ20Bg/640?wx_fmt=png">我猜可能是因为精度的缘故，所以有点差异.. </p><p data-tool="mdnice编辑器">另外试了几个..也是同样的情况<br></p><p data-tool="mdnice编辑器">破案了，作者的数据来源就是先给矩阵做了标准化然后再使用倍数变化绘图.. 大概理解了文章里面的描述<img data-ratio="0.22551020408163266" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDe2RibibeUNZfvSLAcjmicoNZukGQALycaOru5dLfFEXVI7U8bI0ldXtCg/640?wx_fmt=png" data-type="png" data-w="980" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDe2RibibeUNZfvSLAcjmicoNZukGQALycaOru5dLfFEXVI7U8bI0ldXtCg/640?wx_fmt=png">那y轴如果是logFC的话，这张图应该长什么样呢？另外花时间试了一下， 这是整理好的矩阵：<img data-ratio="1.3280788177339902" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDEQjv5iaFGaEQ33BzozPcuMXibq1LNK8ISxt5hNDFy0DG5czwhwVgEmag/640?wx_fmt=png" data-type="png" data-w="1015" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDEQjv5iaFGaEQ33BzozPcuMXibq1LNK8ISxt5hNDFy0DG5czwhwVgEmag/640?wx_fmt=png">只修改矩阵和必要参数，结果如下图<img data-ratio="0.687037037037037" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDBLcWc8YSzDiajNf5vbdIia7bZAZrcnccDA96e0KibZpoaLAAnImXNNt9Q/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDBLcWc8YSzDiajNf5vbdIia7bZAZrcnccDA96e0KibZpoaLAAnImXNNt9Q/640?wx_fmt=png">调整一下代码，还原原本的图像<img data-ratio="0.5407407407407407" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDIUhKTkPVqPf5lNmGEtVjPIvQ3NYQicUSvWsRicLyBYDypLqhTGlvyU9g/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDIUhKTkPVqPf5lNmGEtVjPIvQ3NYQicUSvWsRicLyBYDypLqhTGlvyU9g/640?wx_fmt=png">有些P值非常小，所以整张图有点长..</p><p data-tool="mdnice编辑器"><strong>而且，红色一组就很奇怪所有的基因都是上调的？</strong></p><p data-tool="mdnice编辑器"><strong>虽然一共就检测了750个基因，但还是觉得有点奇怪...</strong></p><p data-tool="mdnice编辑器"><strong>可能作者想营造一种两个实验组相较于对照组在基因表达上完全对称的感觉吧。</strong></p><p data-tool="mdnice编辑器">对比一下原图，整体的基因的变化趋势于文章作者保持一致，但仍旧有差异..</p><p data-tool="mdnice编辑器">比如CCR7这个基因，在差异分析中呈现不明显的下调，但在作者的图像中呈现明显的上调.. </p><p data-tool="mdnice编辑器">两图对比图<img data-ratio="0.42962962962962964" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDic0QuuJFRQXV6qiczOaPeFEVxcBA7VDLz9rus1rVy4FKRBV0YS5dTzibw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDic0QuuJFRQXV6qiczOaPeFEVxcBA7VDLz9rus1rVy4FKRBV0YS5dTzibw/640?wx_fmt=png"></p><h1 data-tool="mdnice编辑器"><span>12 Raw.data VS Normalized data</span><span></span></h1><p data-tool="mdnice编辑器">总之就是觉得奇怪， 于是最后我还是把作者标准化后的表达矩阵下载下来与原始数据进行对比了...<img data-ratio="0.30185185185185187" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDXAo8sNHjB7lic8DCdX2GTsPcGyaEh5Fuorqt86TuCrcSrj49GFX4gcQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDXAo8sNHjB7lic8DCdX2GTsPcGyaEh5Fuorqt86TuCrcSrj49GFX4gcQ/640?wx_fmt=png">数值一模一样，<strong>他给的Raw.data其实并不Raw... 怪不得原始数据的格式不是RCC是txt...</strong><img data-ratio="0.15462962962962962" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDFhXP78nYCGpVNQwu65D15ia0OKnuTUoicdpdwjiaEESkicJZxw7fcTOrog/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8u2t7zSibqia7le6IzXByodDFhXP78nYCGpVNQwu65D15ia0OKnuTUoicdpdwjiaEESkicJZxw7fcTOrog/640?wx_fmt=png"><br></p><p data-tool="mdnice编辑器">破案了.<strong>.我整的原来本就不是Raw数据..我至今都不知道这个原数数据长啥样.</strong></p><p data-tool="mdnice编辑器">还有一个问题，</p><p data-tool="mdnice编辑器">所以作者补充材料里面的P值是咋来的...??</p><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/NaOL9hvshwufVLkiy1aZAw",target="_blank" rel="noopener noreferrer">原文链接</a>
