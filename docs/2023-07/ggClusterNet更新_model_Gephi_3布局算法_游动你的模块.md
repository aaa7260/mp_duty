---
title: "ggClusterNet更新：model_Gephi.3布局算法，游动你的模块"
date: 2023-07-23T02:31:07Z
draft: ["false"]
tags: [
  "fetched",
  "微生信生物"
]
categories: ["Acdemic"]
---
ggClusterNet更新：model_Gephi.3布局算法，游动你的模块 by 微生信生物
------
<div><p>[toc]</p><h3>数据和相关性计算</h3><ul><li><p>数据是内置的，为phylsoeq对象，大家自己导入如果不会操作，可以在网上直接搜索：</p><p><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzUzMjYyMDE2OQ==&amp;mid=2247487063&amp;idx=2&amp;sn=3abc492a6d6f8a75647fd4a7f78eca2d&amp;scene=21#wechat_redirect" textvalue="如何构建phyloseq对象。" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2">如何构建phyloseq对象。</a></p></li></ul><pre><code>rm(list=ls())<br>library(ggClusterNet)<br>library(tidyverse)<br>library(phyloseq)<br>#----------计算相关#----<br>result = cor_Big_micro(ps = ps,<br>                       N = 2000,<br>                       # method.scale = "TMM",<br>                       r.threshold=0.5,<br>                       p.threshold=0.05,<br>                       method = "spearman"<br>)<br><br>#--提取相关矩阵<br>cor = result[[1]]</code></pre><h3>model_Gephi.3算法</h3><pre><code>#--使用model Gephi3算法展示网络#------<br>tab = model_Gephi.3(<br>  cor = cor,<br>  t0 = 0.98, # 取值范围为0到1，表示位于两个已知点之间的中间位置<br>  t2 = 1.2, # 每个聚类中心的缩放<br>  t3 = 8) # 聚类取哪个点，数值越大，取点越靠近00点<br><br>tem3 = tab[[1]]<br>node.p = tab[[2]]<br>head(tem3)<br>aa = node.p$group %&gt;% table() %&gt;% as.data.frame() %&gt;%<br>  rename(  "group" = ".")<br><br>tid = aa$group[aa$Freq &lt; 60] %&gt;% as.character()<br>tem3$group = as.character(tem3$group)<br>tem3$group[(tem3$group) %in% tid] = "miniModule"<br>test_color5 &lt;- RColorBrewer::brewer.pal(n = 12,name = "Set3")<br>head(tem3)<br>tem3$ID = NULL<br>colnames(tem3)[5] = "Group"<br>head(node.p)<br><br>nodef = node.p %&gt;% left_join(tem3,by = c("ID" = "OTU"))<br>head(nodef)</code></pre><h3>邓老师GCB文章结果网络布局算法复现</h3><pre><code>#-邓老师GCB文章结果复现#-----<br><br>p2 &lt;- ggplot() +<br>  # geom_segment(aes(x = X1, y = Y1, xend = X2, yend = Y2,color = as.factor(cor)),<br>  #                               data = edge, size = 0.5,alpha = 0.01) +<br>  geom_point(aes(X1, X2,fill = Group),pch = 21, data = nodef,<br>             color= "white",size = 6<br>  ) +<br>  scale_colour_brewer(palette = "Set1") +<br>  scale_fill_hue() +<br>  scale_fill_manual(values  =<br>                      c(<br>                        "#4DAF4A","#A65628","#FDAE61" ,"#FEE08B","#3288BD","grey80","grey90")<br>  )+<br>  scale_x_continuous(breaks = NULL) +<br>  scale_y_continuous(breaks = NULL) +<br>  scale_size(range = c(3, 20)) +<br>  # labs( title = paste(layout,"network",sep = "_"))+<br>  # geom_text_repel(aes(X1, X2,label=Phylum),size=4, data = plotcord)+<br>  # discard default grid + titles in ggplot2<br>  theme(panel.background = element_blank()) +<br>  # theme(legend.position = "none") +<br>  theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +<br>  theme(legend.background = element_rect(colour = NA)) +<br>  theme(panel.background = element_rect(fill = "white",  colour = NA)) +<br>  theme(panel.grid.minor = element_blank(), panel.grid.major = element_blank())<br>p2<br><br>ggsave("cs0.pdf",p2,width = 15,height = 14)</code></pre><p><img data-galleryid="" data-ratio="0.8949671772428884" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/wJzLDA3fpphkeAJuMI7kuTE6WXXYPSgBYdRReKLQA1cQFZboASIHvm4cd0Ia02MlMWgM2xP3I9g37wC63MOsUg/640?wx_fmt=png" data-type="png" data-w="914" src="https://mmbiz.qpic.cn/sz_mmbiz_png/wJzLDA3fpphkeAJuMI7kuTE6WXXYPSgBYdRReKLQA1cQFZboASIHvm4cd0Ia02MlMWgM2xP3I9g37wC63MOsUg/640?wx_fmt=png"></p><h3>使用模块度进行填充</h3><pre><code>#--使用大小填充#-----<br><br>p2 &lt;- ggplot() +<br>  # geom_segment(aes(x = X1, y = Y1, xend = X2, yend = Y2,color = as.factor(cor)),<br>  #                               data = edge, size = 0.5,alpha = 0.01) +<br>  geom_point(aes(X1, X2,fill = Group,<br>                 size = igraph.degree),pch = 21, data = nodef,color= "grey80"<br>  ) +<br>  scale_colour_brewer(palette = "Set1") +<br>  scale_fill_hue() +<br>  scale_fill_manual(values  =<br>                      c(<br>                        "#4DAF4A","#A65628","#FDAE61" ,"#FEE08B","#3288BD","grey80","grey90")<br>  )+<br>  scale_x_continuous(breaks = NULL) +<br>  scale_y_continuous(breaks = NULL) +<br>  scale_size(range = c(3, 20)) +<br>  # labs( title = paste(layout,"network",sep = "_"))+<br>  # geom_text_repel(aes(X1, X2,label=Phylum),size=4, data = plotcord)+<br>  # discard default grid + titles in ggplot2<br>  theme(panel.background = element_blank()) +<br>  # theme(legend.position = "none") +<br>  theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +<br>  theme(legend.background = element_rect(colour = NA)) +<br>  theme(panel.background = element_rect(fill = "white",  colour = NA)) +<br>  theme(panel.grid.minor = element_blank(), panel.grid.major = element_blank())<br>p2<br><br>ggsave("cs1.pdf",p2,width = 20,height = 19)</code></pre><p><img data-galleryid="" data-ratio="0.9319196428571429" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/wJzLDA3fpphkeAJuMI7kuTE6WXXYPSgBha8rlHMKXO2AABrlLZ9oeMXVOyvdibwxSloIb93s7iasb2HlRJr3PKkQ/640?wx_fmt=png" data-type="png" data-w="896" src="https://mmbiz.qpic.cn/sz_mmbiz_png/wJzLDA3fpphkeAJuMI7kuTE6WXXYPSgBha8rlHMKXO2AABrlLZ9oeMXVOyvdibwxSloIb93s7iasb2HlRJr3PKkQ/640?wx_fmt=png"></p><h3>展示节点扰动对布局样式的影响</h3><pre><code>library(igraph)<br><br>#--展示扰动点对聚类布局的影响#----------<br>plots = list()<br>id = c(0,0.2,0.4,0.6,0.8,1)<br>for (j in 1:length(id)) {<br>  i = id[j]<br>  tab = model_Gephi.3(<br>    cor = cor,<br>    t0 = 0.98, # 取值范围为0到1，表示位于两个已知点之间的中间位置<br>    t2 = 1.2, # 每个聚类中心的缩放<br>    t3 = 8) # 聚类取哪个点，数值越大，取点越靠近00点<br><br>  tem3 = tab[[1]]<br>  node.p = tab[[2]]<br>  head(tem3)<br><br>  aa = node.p$group %&gt;% table() %&gt;% as.data.frame() %&gt;%<br>    rename(  "group" = ".")<br><br>  tid = aa$group[aa$Freq &lt; 60] %&gt;% as.character()<br>  tem3$group = as.character(tem3$group)<br>  tem3$group[(tem3$group) %in% tid] = "miniModule"<br>  test_color5 &lt;- RColorBrewer::brewer.pal(n = 12,name = "Set3")<br>  head(tem3)<br>  tem3$ID = NULL<br>  colnames(tem3)[5] = "Group"<br>  head(node.p)<br><br>  nodef = node.p %&gt;% left_join(tem3,by = c("ID" = "OTU"))<br>  head(nodef)<br><br>  p2 &lt;- ggplot() +<br>    # geom_segment(aes(x = X1, y = Y1, xend = X2, yend = Y2,color = as.factor(cor)),<br>    #                               data = edge, size = 0.5,alpha = 0.01) +<br>    geom_point(aes(X1, X2,fill = Group,size = igraph.degree),pch = 21, data = nodef,color= "grey80",<br>               position=position_jitter(width=i,height=i)<br>    ) +<br>    scale_colour_brewer(palette = "Set1") +<br>    scale_fill_hue() +<br>    scale_fill_manual(values  =<br>                        c(<br>                          "#4DAF4A","#A65628","#FDAE61" ,"#FEE08B" ,"#3288BD","grey80","grey90")<br>    )+<br>    scale_x_continuous(breaks = NULL) +<br>    scale_y_continuous(breaks = NULL) +<br>    scale_size(range = c(3, 20)) +<br>    # labs( title = paste(layout,"network",sep = "_"))+<br>    # geom_text_repel(aes(X1, X2,label=Phylum),size=4, data = plotcord)+<br>    # discard default grid + titles in ggplot2<br>    theme(panel.background = element_blank()) +<br>    # theme(legend.position = "none") +<br>    theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +<br>    theme(legend.background = element_rect(colour = NA)) +<br>    theme(panel.background = element_rect(fill = "white",  colour = NA)) +<br>    theme(panel.grid.minor = element_blank(), panel.grid.major = element_blank())<br>  p2<br>  plots[[j]] = p2<br>}<br><br>p1  = ggpubr::ggarrange(plotlist = plots,<br>                        common.legend = FALSE, legend="right",ncol = 3,nrow = 2)<br>p1<br>ggsave("cs2.pdf",p1,width = 20*3,height = 19*2,limitsize = FALSE)</code></pre><p><img data-galleryid="" data-ratio="0.625" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/wJzLDA3fpphkeAJuMI7kuTE6WXXYPSgBgich6Om9sxG9EqJAibX1rDcibvxvXZw9NEBJl86opsEenCOPj9MaCKcGw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/wJzLDA3fpphkeAJuMI7kuTE6WXXYPSgBgich6Om9sxG9EqJAibX1rDcibvxvXZw9NEBJl86opsEenCOPj9MaCKcGw/640?wx_fmt=png"></p><h3>展示模块游动对网络布局的影响</h3><pre><code>#--展示游动模块#-----<br>plots = list()<br><br>id = c(1,1.5,2,2.5,3.0,3.5,4)<br><br>for (j in 1:length(id)) {<br><br>  i = 0.2<br>  tab = model_Gephi.3(<br>    cor = cor,<br>    t0 = 0.98, # 取值范围为0到1，表示位于两个已知点之间的中间位置<br>    t2 = id[j], # 每个聚类中心的缩放<br>    t3 = 8) # 聚类取哪个点，数值越大，取点越靠近00点<br><br><br>  tem3 = tab[[1]]<br>  node.p = tab[[2]]<br>  head(tem3)<br><br><br>  aa = node.p$group %&gt;% table() %&gt;% as.data.frame() %&gt;%<br>    rename(  "group" = ".")<br><br>  tid = aa$group[aa$Freq &lt; 60] %&gt;% as.character()<br>  tem3$group = as.character(tem3$group)<br>  tem3$group[(tem3$group) %in% tid] = "miniModule"<br>  test_color5 &lt;- RColorBrewer::brewer.pal(n = 12,name = "Set3")<br>  head(tem3)<br>  tem3$ID = NULL<br>  colnames(tem3)[5] = "Group"<br>  head(node.p)<br><br>  nodef = node.p %&gt;% left_join(tem3,by = c("ID" = "OTU"))<br>  head(nodef)<br><br>  # p1 &lt;- ggplot() +<br>  #   # geom_segment(aes(x = X1, y = Y1, xend = X2, yend = Y2),<br>  #   #                             data = edge, size = 1) +<br>  #   geom_point(aes(X1, X2,fill = group), data = tem3,pch = 21,<br>  #              position=position_jitter(width=0.15,height=0.15)<br>  #<br>  #              ) +<br>  #   theme_void()<br>  # p1<br><br>  # "#E41A1C" "#377EB8" "#4DAF4A" "#984EA3" "#FF7F00" "#FFFF33" "#A65628" "#F781BF" "#999999"<br>  p2 &lt;- ggplot() +<br>    # geom_segment(aes(x = X1, y = Y1, xend = X2, yend = Y2,color = as.factor(cor)),<br>    #                               data = edge, size = 0.5,alpha = 0.01) +<br>    geom_point(aes(X1, X2,fill = Group,size = igraph.degree),pch = 21, data = nodef,color= "grey80",<br>               position=position_jitter(width=i,height=i)<br>    ) +<br>    scale_colour_brewer(palette = "Set1") +<br>    scale_fill_hue() +<br>    scale_fill_manual(values  =<br>                        c(<br>                          "#4DAF4A","#A65628","#FDAE61" ,"#FEE08B" ,"#3288BD","grey80","grey90")<br>    )+<br>    scale_x_continuous(breaks = NULL) +<br>    scale_y_continuous(breaks = NULL) +<br>    scale_size(range = c(3, 20)) +<br>    # labs( title = paste(layout,"network",sep = "_"))+<br>    # geom_text_repel(aes(X1, X2,label=Phylum),size=4, data = plotcord)+<br>    # discard default grid + titles in ggplot2<br>    theme(panel.background = element_blank()) +<br>    # theme(legend.position = "none") +<br>    theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +<br>    theme(legend.background = element_rect(colour = NA)) +<br>    theme(panel.background = element_rect(fill = "white",  colour = NA)) +<br>    theme(panel.grid.minor = element_blank(), panel.grid.major = element_blank())<br>  p2<br>  plots[[j]] = p2<br>}<br><br>p1  = ggpubr::ggarrange(plotlist = plots,<br>                        common.legend = FALSE, legend="right",ncol = 4,nrow = 2)<br>p1<br>ggsave("cs3.pdf",p1,width = 20*4,height = 19*2,limitsize = FALSE)</code><p><img data-galleryid="" data-ratio="0.46944444444444444" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/wJzLDA3fpphkeAJuMI7kuTE6WXXYPSgBCmQWbB7COYibdLef5ku2CGKFbMOaPCPgSY1Wyibia1N0cX7nYFOibcibwBg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/wJzLDA3fpphkeAJuMI7kuTE6WXXYPSgBCmQWbB7COYibdLef5ku2CGKFbMOaPCPgSY1Wyibia1N0cX7nYFOibcibwBg/640?wx_fmt=png"></p><pre><pre><h3>根际互作生物学研究室 简介</h3><p><strong>根际互作生物学研究室</strong>是沈其荣院士土壤微生物与有机肥团队下的一个关注于根际互作的研究小组。本小组由袁军副教授带领，主要关注：1.植物和微生物互作在抗病过程中的作用；2 环境微生物大数据整合研究；3 环境代谢组及其与微生物过程研究体系开发和应用。团队在过去三年中在 <em>Nature Communication，</em><em>ISME J，Microbiome，SCLS，<em>New Phytologist，<em>iMeta，</em></em>Fundamental Research， PCE，SBB，JAFC（封面），Horticulture Research，SEL（封面），BMC plant biology</em>等期刊上发表了多篇文章。欢迎关注 微生信生物 公众号对本研究小组进行了解。</p><p><br></p><p>撰写：文涛<span></span><span></span></p><p>修改：<span>文</span><span>涛</span></p><p>审核：袁军</p></pre><pre><h3>团队工作及其成果 （点击查看）</h3><h3>了解 交流 合作</h3><p><br></p><p><img data-galleryid="" data-ratio="0.4601851851851852" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/wJzLDA3fppgUZPTlXP1TQM7NTibagGMMCj7PRykL4td1lvfT9RL3R30lZcadYPBlibcia1GhWSJUP2lrrRgSS44TA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/wJzLDA3fppgUZPTlXP1TQM7NTibagGMMCj7PRykL4td1lvfT9RL3R30lZcadYPBlibcia1GhWSJUP2lrrRgSS44TA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"><br></p></pre></pre></pre><ul><ul><li><p>团队成员邮箱 袁军：junyuan@njau.edu.cn；文涛：taowen@njau.edu.cn</p></li><li><p>团队公众号：微生信生物 添加主编微信，或者后台留言。</p></li><li><p>点击查看团队github主页</p></li><li><p>点击查看南京农业大学资源于环境科学学院主页</p></li><h3><br></h3><h3><br></h3><h3>加主编微信 加入群聊</h3><p><strong>目前营销人员过多，为了维护微生信生物3年来维护的超5000人群聊，目前更新进群要求：</strong></p><ul><li><p><strong>1</strong>.仅限相关专业或研究方向人员添加，必须实名，不实名则默认忽略。</p></li><li><p><strong>2</strong>.非相关专业的其他人员及推广宣传人员禁止添加。</p></li><li><p><strong>3</strong>.添加主编微信需和简单聊一聊专业相关问题，等待主编判断后，可拉群。</p></li><li><p><strong>4 </strong>微生信生物VIP微信群不受限制，费用为60一位，红包发主编即可（群里发送推文代码+高效协助解决推文运行等问题+日常问题咨询回复）。</p></li></ul><li><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1629781174103441409&amp;__biz=MzUzMjYyMDE2OQ==#wechat_redirect" data-linktype="2">团队关注</a></p></li><li><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1629787949699563523&amp;__biz=MzUzMjYyMDE2OQ==#wechat_redirect" data-linktype="2">团队文章成果</a></p></li><li><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1398834972110487553&amp;__biz=MzUzMjYyMDE2OQ==#wechat_redirect" data-linktype="2">团队成果-EasyStat专题</a></p></li><li><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1408207832063016960&amp;__biz=MzUzMjYyMDE2OQ==#wechat_redirect" data-linktype="2">ggClusterNet专题</a></p></li><li><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1463992472430051330&amp;__biz=MzUzMjYyMDE2OQ==#wechat_redirect" data-linktype="2">袁老师小小组</a></p></li></ul></ul><code><br></code><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/YtuxOSxahVJa-SYSXvaO4w",target="_blank" rel="noopener noreferrer">原文链接</a>
