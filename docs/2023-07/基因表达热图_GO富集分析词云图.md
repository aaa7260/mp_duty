---
title: "基因表达热图+GO富集分析词云图"
date: 2023-07-06T22:10:29Z
draft: ["false"]
tags: [
  "fetched",
  "方圆之处"
]
categories: ["Acdemic"]
---
基因表达热图+GO富集分析词云图 by 方圆之处
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">首先感谢大家昨天的回复！第一次真切的感受到大家的支持！可能是因为每天一瓶啤酒对大脑持续的改造，对这些头衔已经看的云淡风轻了。</p><p data-tool="mdnice编辑器">今天要分享的是如何将GO富集的结果和热图结合起来，在今天的分析工作中正好用到，感觉对于探索性分析或者与同事分享时会很有用。我下面用一个基因表达矩阵作为例子来展示如何绘制这样的图。</p><p data-tool="mdnice编辑器">基因表达矩阵可以通过下面这个Dropbox链接获取。</p><p data-tool="mdnice编辑器"><span>https://www.dropbox.com/s/lik3glkmj4mrt54/sig_mat.rds?dl=0</span></p><pre data-tool="mdnice编辑器"><code>sig_mat = readRDS(<span>"~/sig_mat.rds"</span>)<br></code></pre><p data-tool="mdnice编辑器">这个数据其实是来自于Bioconductor上的<strong>golubEsets</strong>数据包。我将其原始的探针ID转换为了Entrez ID。在这个矩阵中，一共有一千多个基因。</p><pre data-tool="mdnice编辑器"><code>dim(sig_mat)<br></code></pre><pre data-tool="mdnice编辑器"><code>[1] 1752   72<br></code></pre><p data-tool="mdnice编辑器">通常作为探索性分析，我们会绘制热图。下面这张图显示，基因至少可以被分为两类。</p><pre data-tool="mdnice编辑器"><code><span>library</span>(ComplexHeatmap)<br>scaled_mat = t(scale(t(sig_mat)))<br>Heatmap(scaled_mat, name = <span>"z-score"</span>,<br>    show_row_names = <span>FALSE</span>, show_column_names = <span>FALSE</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9787234042553191" data-src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeHhwz02kjCMXia5AHXpa7c8JibjopYnRdEX2LRCYH7Vx6icfSDg1yic2NyiaIdHbw3NwnWEa6TcVqm7NA/640?wx_fmt=png" data-type="png" data-w="752" src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeHhwz02kjCMXia5AHXpa7c8JibjopYnRdEX2LRCYH7Vx6icfSDg1yic2NyiaIdHbw3NwnWEa6TcVqm7NA/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">经过几次试验后，我发现分成三类是更好的选择，其中每一个都有独特的pattern。我们加上<code>row_km = 3</code>来看看。同时在热图上我去除了聚类树，因此线条太密集了，没有什么意义。</p><pre data-tool="mdnice编辑器"><code>Heatmap(scaled_mat, name = <span>"z-score"</span>, row_km = <span>3</span>,<br>    show_row_names = <span>FALSE</span>, show_column_names = <span>FALSE</span>,<br>    show_row_dend = <span>FALSE</span>, show_column_dend = <span>FALSE</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9787234042553191" data-src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeHhwz02kjCMXia5AHXpa7c8OyMYL6M8ib69tk0WsicKsfib3mqCIMjibLOiaHsPltgib23VKuWIicmQ2uXKA/640?wx_fmt=png" data-type="png" data-w="752" src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeHhwz02kjCMXia5AHXpa7c8OyMYL6M8ib69tk0WsicKsfib3mqCIMjibLOiaHsPltgib23VKuWIicmQ2uXKA/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">现在我们能够把这些基因分为三类，作为基因表达值数据，很自然的下一步是进行GO富集分析。现在有三组基因，我们需要对每一组单独进行GO富集分析，然后就会有三张GO富集的表格，那么如何有效的把GO富集的结果简要的提取出来并且集成到热图上呢。</p><p data-tool="mdnice编辑器">我们先获取k均值聚类的结果。这里<code>km</code>就是一个向量，其中的值就是每个基因所处的类。</p><pre data-tool="mdnice编辑器"><code>set.seed(<span>123</span>)<br>km = kmeans(scaled_mat, centers = <span>3</span>)$cluster<br>head(km)<br></code></pre><pre data-tool="mdnice编辑器"><code>  7037   2597     60   7443 317648   6047<br>     3      1      1      2      1      2<br></code></pre><p data-tool="mdnice编辑器">然后基于<code>km</code>，我们将所有的基因分为三组。这里我们可以用<code>split()</code>函数将基因对<code>km</code>进行切分，其返回一个简单列表。</p><pre data-tool="mdnice编辑器"><code>gene_list = split(rownames(scaled_mat), km)<br>str(gene_list)<br></code></pre><pre data-tool="mdnice编辑器"><code>List of 3<br> $ 1: chr [1:649] <span>"2597"</span> <span>"60"</span> <span>"317648"</span> <span>"360"</span> ...<br> $ 2: chr [1:796] <span>"7443"</span> <span>"6047"</span> <span>"5718"</span> <span>"8317"</span> ...<br> $ 3: chr [1:307] <span>"7037"</span> <span>"9870"</span> <span>"6813"</span> <span>"8837"</span> ...<br></code></pre><p data-tool="mdnice编辑器">然后我们对这三个基因列表分别作GO富集。在下面的代码中，匿名函数返回显著的GO条目的ID。</p><pre data-tool="mdnice编辑器"><code><span>library</span>(clusterProfiler)<br>go_list = lapply(gene_list, <span>function</span>(g) {<br>    tb = enrichGO(g, OrgDb = <span>"org.Hs.eg.db"</span>, <br>        keyType = <span>"ENTREZID"</span>, ont = <span>"BP"</span>)<br>    tb$ID[tb$p.adjust &lt; <span>0.01</span>]<br>})<br></code></pre><p data-tool="mdnice编辑器">我们可以看一下每组中显著GO条目的数目。</p><pre data-tool="mdnice编辑器"><code>sapply(go_list, length)<br></code></pre><pre data-tool="mdnice编辑器"><code>  1   2   3<br>472 429 522<br></code></pre><p data-tool="mdnice编辑器"><code>go_list</code>只是一个简单的包含了三个GO ID向量的列表。</p><pre data-tool="mdnice编辑器"><code>str(go_list)<br></code></pre><pre data-tool="mdnice编辑器"><code>List of 3<br> $ 1: chr [1:472] <span>"GO:0043270"</span> <span>"GO:0043410"</span> <span>"GO:0023061"</span> <span>"GO:0006936"</span> ...<br> $ 2: chr [1:429] <span>"GO:0000375"</span> <span>"GO:0000377"</span> <span>"GO:0000398"</span> <span>"GO:0008380"</span> ...<br> $ 3: chr [1:522] <span>"GO:0032496"</span> <span>"GO:0002237"</span> <span>"GO:0071222"</span> <span>"GO:0071219"</span> ...<br></code></pre><p data-tool="mdnice编辑器">现在我们有了显著的GO条目，下面我们使用<strong>simplifyEnrichment</strong>包中的<code>anno_word_cloud_from_GO()</code>函数。这是一个热图注释函数（heatmap annotation function）。其接受一个包含多个GO ID向量的列表，然后绘制词云图（word cloud）。</p><pre data-tool="mdnice编辑器"><code><span>library</span>(simplifyEnrichment)<br>Heatmap(scaled_mat, name = <span>"z-score"</span>, row_split = km,<br>    show_row_names = <span>FALSE</span>, show_column_names = <span>FALSE</span>,<br>    show_row_dend = <span>FALSE</span>, show_column_dend = <span>FALSE</span>) +<br>rowAnnotation(go = anno_word_cloud_from_GO(km, go_list, <br>    max_words = <span>30</span>))<br></code></pre><p data-tool="mdnice编辑器">在词云图中，每个关键字其实也进行了富集分析，其中字体的大小表示这个关键词在所有的GO词汇中的over-representation。大家可以参考<code>simplifyEnrichment::anno_word_cloud_from_GO()</code>的帮助文档对词云进行更多的控制。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5672131147540984" data-src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeHhwz02kjCMXia5AHXpa7c8dlXPKYBxmW3RZ9hC0o1icnVWkLEs8c4BCR6g1Poddx1lVSywMbPlwAw/640?wx_fmt=png" data-type="png" data-w="1220" src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeHhwz02kjCMXia5AHXpa7c8dlXPKYBxmW3RZ9hC0o1icnVWkLEs8c4BCR6g1Poddx1lVSywMbPlwAw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">最后，这个主题好像我以前发过？</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/87E8DzQ93wKFXyCTuEFR9w",target="_blank" rel="noopener noreferrer">原文链接</a>
