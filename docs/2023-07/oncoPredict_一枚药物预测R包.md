---
title: "oncoPredict：一枚药物预测R包"
date: 2023-07-22T10:04:34Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
oncoPredict：一枚药物预测R包 by 生信星球
------
<div><p data-mpa-powered-by="yiban.io"><span>‍</span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png"><span> 今天是生信星球陪你的<span><strong>第920天</strong></span></span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"></p><hr><section><span><span>   </span><span>大神一句话，菜鸟跑半年。我不是大神，但我可以缩短你走弯路的半年~</span></span></section><section><span>   就像歌儿唱的那样，如果你不知道该往哪儿走，就留在这学点生信好不好~</span></section><section><span>   这里有豆豆和花花的学习历程，从新手到进阶，生信路上有你有我！</span></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h4 data-tool="mdnice编辑器"><span><span> </span></span><span><span> </span>0.背景知识一点点</span><span><span> </span></span></h4><p data-tool="mdnice编辑器">oncoPredict是根据基因表达量来预测药物敏感性的R包。也就是说它可以根据你的样本基因表达量来告诉你每个药物的IC50值，这个值越低就说明药物越管用。</p><p data-tool="mdnice编辑器">提到药物预测，还有一个pRRophetic包，建议不用看了，因为oncoPredict是它的plus版本。</p><p data-tool="mdnice编辑器">还有一个cellMiner网站，之前写过，可以翻翻看。</p><h4 data-tool="mdnice编辑器"><span><span> </span></span><span><span> </span>1.载入数据</span><span><span> </span></span></h4><p data-tool="mdnice编辑器">代码参考自：<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247507376&amp;idx=1&amp;sn=6993a13200be452c9dfa527e9fdc8ae4&amp;scene=21#wechat_redirect" textvalue="曾老板的资料" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2">曾老板的资料</a>，一些背景知识也可以补充下.</p><p data-tool="mdnice编辑器">在Training Data文件夹下存放着R包作者准备好的数据，用作药物预测的训练集。下载自：https://osf.io/c6tfx/</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br>library(oncoPredict)<br>library(data.table)<br>library(gtools)<br>library(reshape2)<br>library(ggpubr)<br>dir=<span>'./DataFiles/DataFiles/Training Data/'</span><br>dir(dir)<br><br><span>## [1] "CTRP2_Expr (RPKM, not log transformed).rds"         </span><br><span>## [2] "CTRP2_Expr (TPM, not log transformed).rds"          </span><br><span>## [3] "CTRP2_Res.rds"                                      </span><br><span>## [4] "GDSC1_Expr (RMA Normalized and Log Transformed).rds"</span><br><span>## [5] "GDSC1_Res.rds"                                      </span><br><span>## [6] "GDSC2_Expr (RMA Normalized and Log Transformed).rds"</span><br><span>## [7] "GDSC2_Res.rds"</span><br></code></pre><p data-tool="mdnice编辑器">可以看到其中包括了Cancer Therapeutics Response Portal (CTRP)和Genomics of Drug Sensitivity in Cancer (GDSC)，我们直接用v2</p><p data-tool="mdnice编辑器">两个数据库的数据，都是提供了基因表达矩阵和药物IC50表格。</p><pre data-tool="mdnice编辑器"><span></span><code>exp = readRDS(file=file.path(dir,<span>'GDSC2_Expr (RMA Normalized and Log Transformed).rds'</span>))<br>exp[1:4,1:4]<br><br><span>##        COSMIC_906826 COSMIC_687983 COSMIC_910927 COSMIC_1240138</span><br><span>## TSPAN6      7.632023      7.548671      8.712338       7.797142</span><br><span>## TNMD        2.964585      2.777716      2.643508       2.817923</span><br><span>## DPM1       10.379553     11.807341      9.880733       9.883471</span><br><span>## SCYL3       3.614794      4.066887      3.956230       4.063701</span><br><br>dim(exp)<br><br><span>## [1] 17419   805</span><br><br>drug = readRDS(file = file.path(dir,<span>"GDSC2_Res.rds"</span>))<br>drug &lt;- exp(drug) <span>#下载到的数据是被log转换过的，用这句代码逆转回去</span><br>drug[1:4,1:4]<br><br><span>##                Camptothecin_1003 Vinblastine_1004 Cisplatin_1005</span><br><span>## COSMIC_906826          0.3158373      0.208843106     1116.05899</span><br><span>## COSMIC_687983          0.2827342      0.013664227       26.75839</span><br><span>## COSMIC_910927          0.0295671      0.006684071       12.09379</span><br><span>## COSMIC_1240138         7.2165789               NA             NA</span><br><span>##                Cytarabine_1006</span><br><span>## COSMIC_906826       18.5038719</span><br><span>## COSMIC_687983       16.2943594</span><br><span>## COSMIC_910927        0.3387418</span><br><span>## COSMIC_1240138              NA</span><br><br>dim(drug)<br><br><span>## [1] 805 198</span><br><br>identical(rownames(drug),colnames(exp))<br><br><span>## [1] TRUE</span><br></code></pre><p data-tool="mdnice编辑器">drug是药物IC50值，exp是对应细胞系基因的表达矩阵。可以看到二者的样本名称是对应的。</p><h4 data-tool="mdnice编辑器"><span><span> </span></span><span><span> </span>2.操练一下</span><span><span> </span></span></h4><p data-tool="mdnice编辑器">搞一个示例数据，从矩阵里面直接随机取了4个样本。</p><pre data-tool="mdnice编辑器"><span></span><code><span>test</span>&lt;- exp[,sample(1:ncol(exp),4)]<br><span>test</span>[1:4,1:4]  <br><br><span>##        COSMIC_1290797 COSMIC_906830 COSMIC_907314 COSMIC_907068</span><br><span>## TSPAN6       8.196623      5.542645      6.960978      6.896404</span><br><span>## TNMD         2.692706      2.736643      3.038283      2.774103</span><br><span>## DPM1        10.829487      9.890112      9.912911     10.757162</span><br><span>## SCYL3        3.840380      3.346422      3.845654      4.490674</span><br><br>colnames(<span>test</span>)=paste0(<span>'test'</span>,colnames(<span>test</span>))<br>dim(<span>test</span>)<br><br><span>## [1] 17419     4</span><br></code></pre><p data-tool="mdnice编辑器">运行时间很长，所以if(F)注释掉。</p><pre data-tool="mdnice编辑器"><span></span><code><span>if</span>(F){<br>  calcPhenotype(trainingExprData = exp,<br>                trainingPtype = drug,<br>                testExprData = <span>test</span>,<br>                batchCorrect = <span>'eb'</span>,  <span>#   "eb" for array,standardize  for rnaseq</span><br>                powerTransformPhenotype = TRUE,<br>                removeLowVaryingGenes = 0.2,<br>                minNumSamples = 10, <br>                printOutput = TRUE, <br>                removeLowVaringGenesFrom = <span>'rawData'</span> )<br>}<br></code></pre><p data-tool="mdnice编辑器">R包Vignette里关于batchCorrect参数的说明</p><blockquote data-tool="mdnice编辑器"><p>batchCorrect options: “eb” for ComBat, “qn” for quantiles normalization, “standardize”, or “none”</p><p>“eb” is good to use when you use microarray training data to build models on microarray testing data.</p></blockquote><blockquote data-tool="mdnice编辑器"><p>“standardize is good to use when you use microarray training data to build models on RNA-seq testing data (this is what Paul used in the 2017 IDWAS paper that used GDSC microarray to impute in TCGA RNA-Seq data, see methods section of that paper for rationale)</p></blockquote><p data-tool="mdnice编辑器">R包Vignette里关于removeLowVaringGenesFrom参数的说明</p><blockquote data-tool="mdnice编辑器"><p>#Determine method to remove low varying genes. #Options are ‘homogenizeData’ and ‘rawData’ #homogenizeData is likely better if there is ComBat batch correction, raw data was used in the 2017 IDWAS paper that used GDSC microarray to impute in TCGA RNA-Seq data.</p></blockquote><p data-tool="mdnice编辑器">也就是说，芯片数据就用上面代码里的参数，转录组数据的话，就将batchCorrect改为standardize</p><p data-tool="mdnice编辑器">removeLowVaringGenesFrom,作者说的也模糊啊。随便吧。</p><h4 data-tool="mdnice编辑器"><span><span> </span></span><span><span> </span>3.看看结果</span><span><span> </span></span></h4><p data-tool="mdnice编辑器">这是运行之后的结果，被存在固定文件夹calcPhenotype_Output下。文件名也是固定的DrugPredictions.csv。因此一个工作目录只能计算一个数据，你可别混着用哦。</p><pre data-tool="mdnice编辑器"><span></span><code>library(data.table)<br>testPtype &lt;- read.csv(<span>'./calcPhenotype_Output/DrugPredictions.csv'</span>, row.names = 1,check.names = F)<br>testPtype[1:4, 1:4]<br><br><span>##                    Camptothecin_1003 Vinblastine_1004 Cisplatin_1005</span><br><span>## testCOSMIC_688011         0.10760213       0.11167741       38.54915</span><br><span>## testCOSMIC_687586         0.07044805       0.01858011       20.74525</span><br><span>## testCOSMIC_1290795        0.10672687       0.02699725       43.80543</span><br><span>## testCOSMIC_909709         0.14925178       0.03303756       36.73508</span><br><span>##                    Cytarabine_1006</span><br><span>## testCOSMIC_688011         8.099842</span><br><span>## testCOSMIC_687586         4.612872</span><br><span>## testCOSMIC_1290795       13.370822</span><br><span>## testCOSMIC_909709        10.393066</span><br><br>dim(testPtype)<br><br><span>## [1]   4 198</span><br><br>identical(colnames(testPtype),colnames(drug))<br><br><span>## [1] TRUE</span><br></code></pre><p data-tool="mdnice编辑器">198种药物IC50的预测结果就在这个表格里啦。</p><p data-tool="mdnice编辑器">可以画个图比较一下预测结果与真实数据，可以肉眼计算相关性系数基本是1，也就知道了计算的结果确实是IC50值，而且计算的还挺准。（当然准啦，因为数据是从矩阵里面截取的）</p><pre data-tool="mdnice编辑器"><span></span><code>library(stringr)<br>p = str_remove(rownames(testPtype),<span>"test"</span>)<br>a = t(rbind(drug[p,],testPtype))<br>a = a[,c(1,5,2,6,3,7,4,8)]<br>par(mfrow = c(2,2))<br>plot(a[,1],a[,2])<br>plot(a[,3],a[,4])<br>plot(a[,5],a[,6])<br>plot(a[,7],a[,8])<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7138888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHooUCwyDBR59HS1iczACqZgAnc635bdzoVrwZ1SOekCJEIiaWmeEL9kC9J2vRqZyQJhqXFugc8VFCMA/640?wx_fmt=other" data-type="other" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHooUCwyDBR59HS1iczACqZgAnc635bdzoVrwZ1SOekCJEIiaWmeEL9kC9J2vRqZyQJhqXFugc8VFCMA/640?wx_fmt=other"></figure></section></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><figure data-tool="mdnice编辑器"><span></span></figure></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><figure data-tool="mdnice编辑器"></figure></section><section><blockquote><section><span>如果因为代码看不懂，而跟不上正文的节奏，可以来找我，系统学习。我的</span><span>课程都是循环开课。</span><span>下一期的时间，点进去咨询微信咯</span><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247493441&amp;idx=1&amp;sn=95e2cc24fda53117ae312d6644c1b221&amp;chksm=fdfbaf03ca8c2615d80969e56cf8863219c0afd2efd0dca01b907a3c815b73ef9f77d90bdb0c&amp;scene=21#wechat_redirect" textvalue="新的一年，你要不要来找我‍们学‍习生信" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">新的一年，你要不要来找我<span>‍</span>们学习生信</a><br></section></blockquote></section><section><br></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/tcUEmJNftbTXR8jrztJ8_g",target="_blank" rel="noopener noreferrer">原文链接</a>
