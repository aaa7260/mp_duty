---
title: "跟着Nature microbiology学作图：R语言ggplot2热图展示离散数据"
date: 2023-07-09T15:12:59Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Acdemic"]
---
跟着Nature microbiology学作图：R语言ggplot2热图展示离散数据 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><h2 data-tool="mdnice编辑器"><span></span><span>论文</span><span></span><span> </span></h2><blockquote data-tool="mdnice编辑器"><p>A high-quality genome compendium of the human gut microbiome of Inner Mongolians</p></blockquote><p data-tool="mdnice编辑器">https://www.nature.com/articles/s41564-022-01270-1</p><p data-tool="mdnice编辑器"><code>2023Naturemicrobiology--Ahigh-qualitygenomecompendiumofthehumangutmicrobiomeofInnerMongolians4.pdf</code></p><p data-tool="mdnice编辑器">论文中大部分作图数据都有，争取把论文中的图都复现一下</p><p data-tool="mdnice编辑器">今天的推文我们试着复现一下论文中的Figure4C 下半部分的热图</p><figure data-tool="mdnice编辑器"><img data-ratio="0.9271428571428572" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk5UWlzv7Lj6txvhj34zMEZKdJDfKyxk8dXwict3uGlFk1RAbfYX4OUP8QecwFexGj0f70BXe7WPRXw/640?wx_fmt=other" data-type="other" data-w="700" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk5UWlzv7Lj6txvhj34zMEZKdJDfKyxk8dXwict3uGlFk1RAbfYX4OUP8QecwFexGj0f70BXe7WPRXw/640?wx_fmt=other"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>部分示例数据截图</span><span></span><span> </span></h2><figure data-tool="mdnice编辑器"><img data-ratio="0.2816666666666667" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk5UWlzv7Lj6txvhj34zMEZKLyQJiaqMbbAcLs8lHxQGNQhyHgH6SsG3fuv48pXMl3QMR8nD8f5kp0A/640?wx_fmt=other" data-type="other" data-w="1200" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk5UWlzv7Lj6txvhj34zMEZKLyQJiaqMbbAcLs8lHxQGNQhyHgH6SsG3fuv48pXMl3QMR8nD8f5kp0A/640?wx_fmt=other"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>读取数据</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(readxl)<br>library(tidyverse)<br><br>fig4cb&lt;-read_excel(<span>"D:/R_4_1_0_working_directory/env001/data/20230305/41564_2022_1270_MOESM7_ESM.xlsx"</span>,<br>                   sheet = <span>"Fig 4c bottom"</span>,<br>                   col_types = <span>"text"</span>)<br>fig4cb %&gt;% dim()<br>fig4cb<br><br>colnames(fig4cb)[1]&lt;-<span>"y"</span><br>colnames(fig4cb)[-1]<br>fig4cb<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>宽格式转换为长格式数据</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>fig4cb %&gt;% <br>  pivot_longer(!y,names_to = <span>"x"</span>) %&gt;% <br>  mutate(y=factor(y,levels = fig4cb %&gt;% pull(y) %&gt;% rev()),<br>         x=factor(x,levels = colnames(fig4cb)[-1])) -&gt; new.fig4cb<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>构造右侧的颜色条数据</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>df&lt;-data.frame(x=16,xend=16,<br>               y=c(0.6,1.6,2.6,3.6,4.6,5.6,8.6),<br>               yend=c(1.4,2.4,3.4,4.4,5.4,8.4,20.4),<br>               group=c(<span>"A"</span>,<span>"B"</span>,<span>"D"</span>,<span>"E"</span>,<span>"F"</span>,<span>"G"</span>,<span>"H"</span>))<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>作图代码</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>p1&lt;-ggplot(data = new.fig4cb,aes(x=x,y=y))+<br>  geom_tile(aes(fill=value),<br>            color=<span>"white"</span>,<br>            width=0.8,height=0.8)+<br>  theme_bw()+<br>  theme(panel.grid = element_blank(),<br>        panel.border = element_blank(),<br>        axis.ticks = element_blank(),<br>        axis.text.x = element_text(angle = 60,<br>                                   hjust=1,vjust = 1),<br>        legend.position = <span>"bottom"</span>,<br>        legend.box = <span>"vertical"</span>)+<br>  guides(color=guide_legend(nrow = 1,title.position = <span>"top"</span>,<br>                            title.hjust = 0.5),<br>         fill=guide_legend(title.position = <span>"top"</span>,<br>                           title.hjust = 0.5))+<br>  scale_fill_manual(values = c(<span>"0"</span>=<span>"#eaeaea"</span>,<br>                               <span>"1"</span>=<span>"#8fb3d3"</span>,<br>                               <span>"2"</span>=<span>"#699bc3"</span>,<br>                               <span>"3"</span>=<span>"#4682b4"</span>),<br>                    breaks = c(<span>"3"</span>,<span>"2"</span>,<span>"1"</span>,<span>"0"</span>),<br>                    labels=c(<span>"100"</span>,<span>"50-90"</span>,<span>"0-50"</span>,<span>"0"</span>),<br>                    name=<span>"The prevalence of\nSCFA MGC (%)"</span>)+<br>  coord_equal()+<br>  labs(x=NULL,y=NULL)+<br>  scale_y_discrete(position = <span>"right"</span>)+<br>  geom_segment(data=df,<br>               aes(x=x,xend=xend,y=y,yend=yend,<br>                   color=group),<br>               size=5)+<br>  scale_color_manual(values = c(<span>"#606060"</span>,<span>"#3a75a7"</span>,<span>"#cb1a00"</span>,<br>                                <span>"#9c6586"</span>,<span>"#ff9309"</span>,<span>"#4682b4"</span>,<br>                                <span>"#ce8889"</span>),<br>                     name=<span>"Order"</span>)<br><br>p1<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9983235540653814" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk5UWlzv7Lj6txvhj34zMEZKCQDXpWgKHbk5JF1kaPoqf5iaibLCO1ZZ5Vdrv9iceIEiaWLMzDPVZx1ZKg/640?wx_fmt=other" data-type="other" data-w="1193" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk5UWlzv7Lj6txvhj34zMEZKCQDXpWgKHbk5JF1kaPoqf5iaibLCO1ZZ5Vdrv9iceIEiaWLMzDPVZx1ZKg/640?wx_fmt=other"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>上侧的图思路也是一样的</span><span></span><span> </span></h2><p data-tool="mdnice编辑器">代码</p><pre data-tool="mdnice编辑器"><span></span><code>fig4ct&lt;-read_excel(<span>"D:/R_4_1_0_working_directory/env001/data/20230305/41564_2022_1270_MOESM7_ESM.xlsx"</span>,<br>                   sheet = <span>"Fig 4c top"</span>,<br>                   col_types = <span>"text"</span>)<br>fig4ct %&gt;% dim()<br>fig4ct<br><br>colnames(fig4ct)[1]&lt;-<span>"y"</span><br>colnames(fig4ct)[-1]<br>fig4ct<br><br>fig4ct %&gt;% <br>  pivot_longer(!y,names_to = <span>"x"</span>) %&gt;% <br>  mutate(y=factor(y,levels = fig4ct %&gt;% pull(y) %&gt;% rev()),<br>         x=factor(x,levels = colnames(fig4ct)[-1])) -&gt; new.fig4ct<br><br><br><br>p2&lt;-ggplot(data = new.fig4ct,aes(x=x,y=y))+<br>  geom_tile(aes(fill=value),<br>            color=<span>"white"</span>,<br>            width=0.8,height=0.8,<br>            show.legend = FALSE)+<br>  theme_bw()+<br>  theme(panel.grid = element_blank(),<br>        panel.border = element_blank(),<br>        axis.ticks = element_blank(),<br>        axis.text.x = element_text(angle = 60,<br>                                   hjust=1,vjust = 1))+<br>  scale_fill_manual(values = c(<span>"0"</span>=<span>"#eaeaea"</span>,<br>                               <span>"1"</span>=<span>"#8fb3d3"</span>,<br>                               <span>"2"</span>=<span>"#699bc3"</span>,<br>                               <span>"3"</span>=<span>"#4682b4"</span>),<br>                    breaks = c(<span>"3"</span>,<span>"2"</span>,<span>"1"</span>,<span>"0"</span>))+<br>  coord_equal()+<br>  labs(x=NULL,y=NULL)+<br>  scale_y_discrete(position = <span>"right"</span>)<br><br>p2<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9845288326300985" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk5UWlzv7Lj6txvhj34zMEZK5Jw0HwL3NicNtiaKRiaVa0oUXJMOQyld1njoovK42LGbCic2JRRI8JGv3g/640?wx_fmt=other" data-type="other" data-w="711" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk5UWlzv7Lj6txvhj34zMEZK5Jw0HwL3NicNtiaKRiaVa0oUXJMOQyld1njoovK42LGbCic2JRRI8JGv3g/640?wx_fmt=other"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>把两个图拼到一起</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(patchwork)  <br><br>p2+p1+<br>  plot_layout(guides = <span>"collect"</span>)+<br>  plot_annotation(theme = theme(legend.position = <span>"bottom"</span>,<br>                                legend.box = <span>"vertical"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.425" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk5UWlzv7Lj6txvhj34zMEZKvMXAVCZajkpGXicP5xYuPWkVhcd4xnNRZTkNUvjzs7enfOZDFFticCpg/640?wx_fmt=other" data-type="other" data-w="1200" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk5UWlzv7Lj6txvhj34zMEZKvMXAVCZajkpGXicP5xYuPWkVhcd4xnNRZTkNUvjzs7enfOZDFFticCpg/640?wx_fmt=other"><figcaption>image.png</figcaption></figure><blockquote data-tool="mdnice编辑器"><p>推文记录的是自己的学习笔记，很可能存在错误，请大家批判着看</p></blockquote><blockquote data-tool="mdnice编辑器"><p>示例数据和代码可以给推文打赏1元获取</p></blockquote><p data-tool="mdnice编辑器">欢迎大家关注我的公众号</p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzI3NzQ3MTcxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5t1sOnM0iabvBhnfIj5YpyqrMib0E1MGCd9ibcYxaOPZd0GWhQBDvK2BPEwsicQxd6y5MHLfphnwHnow/0?wx_fmt=png" data-nickname="小明的数据分析笔记本" data-alias="" data-signature="分享R语言和python在生物信息领域做数据分析和数据可视化的简单小例子；偶尔会分享一些组学数据处理相关的内容" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"></p><blockquote data-tool="mdnice编辑器"><p>小明的数据分析笔记本 公众号 主要分享：1、R语言和python做数据分析和数据可视化的简单小例子；2、园艺植物相关转录组学、基因组学、群体遗传学文献阅读笔记；3、生物信息学入门学习资料及自己的学习笔记！</p></blockquote></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Tk4X366jN7BqMZgS9mnJjA",target="_blank" rel="noopener noreferrer">原文链接</a>
