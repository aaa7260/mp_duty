---
title: "Dotplot美化"
date: 2023-07-08T14:55:01Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
Dotplot美化 by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span>❝</span><p>Dotplot在单细胞转录组测序发表文章中用于cluster-marker_gene 和celltype-marker_gene的展示方式在正文中出现的频率并没有那么高，可能常常放在补充材料中，但是也需要美化一下。</p><p>另外此篇推文也适用于富集分析，常规气泡图可以以同样的方式进行展示。</p><span>❞</span></blockquote><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br>options(stringsAsFactors = <span>F</span>) <br><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(clustree)<br><span>library</span>(cowplot)<br><span>library</span>(dplyr)<br><br>getwd()<br>dir.create(<span>"./figure"</span>)<br>setwd(<span>"./figure"</span>)  <br>sce.all&lt;-readRDS(<span>"../3-cell/sce.all_int_0.5.rds"</span>)<br><br>load(<span>"../3-cell/sce.all_by_celltype.Rdata"</span>)<br><br><br><span>library</span>(ggplot2) <br>genes_to_check = c(<span>'PTPRC'</span>, <span>'CD3D'</span>, <span>'CD3E'</span>, <span>'CD4'</span>,<span>'CD8A'</span>,<span>'CD19'</span>, <span>'CD79A'</span>, <span>'MS4A1'</span> ,<br>                   <span>'IGHG1'</span>, <span>'MZB1'</span>, <span>'SDC1'</span>,<br>                   <span>'CD68'</span>, <span>'CD163'</span>, <span>'CD14'</span>, <br>                   <span>'TPSAB1'</span> , <span>'TPSB2'</span>,  <span># mast cells,</span><br>                   <span>'MKI67'</span>,<span>'TOP2A'</span>,<span>'KLRC1'</span>,<br>                   <span>'RCVRN'</span>,<span>'FPR1'</span> , <span>'ITGAM'</span> ,<br>                   <span>'FGF7'</span>,<span>'MME'</span>, <span>'ACTA2'</span>,<br>                   <span>'PECAM1'</span>, <span>'VWF'</span>,    <br>                   <span>'KLRB1'</span>,<span>'NCR1'</span>, <br>                   <span>'EPCAM'</span> , <span>'KRT19'</span>, <span>'PROM1'</span>, <span>'ALDH1A1'</span>,<br>                   <span>'MKI67'</span> ,<span>'TOP2A'</span> )<br><span>library</span>(stringr)  <br>genes_to_check=str_to_upper(unique(genes_to_check))<br>genes_to_check<br><br>th=theme(axis.text.x = element_text(angle = <span>45</span>, vjust = <span>0.5</span>, hjust=<span>0.5</span>))<br>p_all_markers &lt;- DotPlot(sce.all, features = genes_to_check,<br>                         assay=<span>'RNA'</span> ,group.by = <span>'celltype'</span> )  + coord_flip()+th<br>p_all_markers<br><br>ggsave(p_all_markers, filename=<span>"check_all_marker_by_seurat_celltype.pdf"</span>,height = <span>7</span>,width = <span>9</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7760416666666666" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8CRxHCxG5tZHBzLupV52zy8Y31Cc8kafrkxlkiagJUmicU703uokddqKs5Pz85xoTPMpt6IB0Z2l9g/640?wx_fmt=png" data-type="png" data-w="768" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8CRxHCxG5tZHBzLupV52zy8Y31Cc8kafrkxlkiagJUmicU703uokddqKs5Pz85xoTPMpt6IB0Z2l9g/640?wx_fmt=png"><figcaption>图1</figcaption></figure><h4 data-tool="mdnice编辑器"><span></span>用ggplot美化<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>####提取数据####</span><br>data&lt;-p_all_markers$data<br><br>colnames(data)<br><br>colnames(data)&lt;-c(<span>"AverageExpression_unscaled"</span>,<span>"Precent Expressed"</span>,<span>"Features"</span>,<span>"celltype"</span>,<span>"Average Expression"</span>)<br><br>unique(data$`Precent Expressed`)<br><br><span>####用ggplot画图####</span><br>p = ggplot(data,aes(celltype,Features,size = `Precent Expressed` ))+<br>  geom_point(shape=<span>21</span>,aes(fill= `Average Expression`),position =position_dodge(<span>0</span>))+<br>  theme_minimal()+xlab(<span>NULL</span>)+ylab(<span>NULL</span>) +<br>  scale_size_continuous(range=c(<span>1</span>,<span>10</span>))+theme_bw()+<br>  scale_fill_gradient(low = <span>"grey"</span>, high = <span>"#E54924"</span>)+<br>  theme(legend.position = <span>"right"</span>,legend.box = <span>"vertical"</span>, <span>#图例位置</span><br>        legend.margin=margin(t= <span>0</span>, unit=<span>'cm'</span>),<br>        legend.spacing = unit(<span>0</span>,<span>"in"</span>),<br>        axis.text.x  = element_text(color=<span>"black"</span>,size=<span>16</span>,angle = <span>45</span>, <br>                                    vjust = <span>0.5</span>, hjust=<span>0.5</span>),<span>#x轴</span><br>        axis.text.y  = element_text(color=<span>"black"</span>,size=<span>12</span>),<span>#y轴</span><br>        legend.text = element_text(size =<span>12</span>,color=<span>"black"</span>),<span>#图例</span><br>        legend.title = element_text(size =<span>12</span>,color=<span>"black"</span>),<span>#图例</span><br>        axis.title.y=element_text(vjust=<span>1</span>,  <br>                                  size=<span>16</span>)<br>  )+labs(x=<span>" "</span>,y = <span>"Features"</span>);p<br><br><br>p1 = ggplot(data,aes(celltype,Features,size = `Precent Expressed` ))+<br>  geom_point(shape=<span>21</span>,aes(fill= `Average Expression`),position =position_dodge(<span>0</span>))+<br>  theme_minimal()+xlab(<span>NULL</span>)+ylab(<span>NULL</span>) +<br>  scale_size_continuous(range=c(<span>1</span>,<span>10</span>))+theme_bw()+<br>  scale_fill_gradient(low = <span>"#E54924"</span>, high = <span>"#498EA4"</span>)+<br>  theme(legend.position = <span>"right"</span>,legend.box = <span>"vertical"</span>,<br>        legend.margin=margin(t= <span>0</span>, unit=<span>'cm'</span>),<br>        legend.spacing = unit(<span>0</span>,<span>"in"</span>),<br>        axis.text.x  = element_text(color=<span>"black"</span>,size=<span>16</span>,angle = <span>45</span>, <br>                                    vjust = <span>0.5</span>, hjust=<span>0.5</span>),<br>        axis.text.y  = element_text(color=<span>"black"</span>,size=<span>12</span>),<br>        legend.text = element_text(size =<span>12</span>,color=<span>"black"</span>),<br>        legend.title = element_text(size =<span>12</span>,color=<span>"black"</span>),<br>        axis.title.y=element_text(vjust=<span>1</span>,  <br>                                  size=<span>16</span>)<br>  )+labs(x=<span>" "</span>,y = <span>"Features"</span>)<br><br>p1<br><span># 保存</span><br><span>library</span>(patchwork)<br>p+p1<br>ggsave(file=<span>"dotplot_celltype.pdf"</span>,height= <span>10</span>,width = <span>14</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7046296296296296" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8CRxHCxG5tZHBzLupV52zyTveloLlxVM0icVHdibAxxQb9QNzpBLLgSsJicO6xMErbnGuWhkY0iblteQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8CRxHCxG5tZHBzLupV52zyTveloLlxVM0icVHdibAxxQb9QNzpBLLgSsJicO6xMErbnGuWhkY0iblteQ/640?wx_fmt=png"><figcaption>图2</figcaption></figure><h4 data-tool="mdnice编辑器"><span></span>分面画图<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>#factor因子对cluster排序</span><br><br>table(sce.all$RNA_snn_res.0.8)<br><br>My_levels&lt;-c(<span>"0"</span>,<span>"1"</span>,<span>"2"</span>,<span>"3"</span>,<span>"4"</span>,<span>"5"</span>,<span>"6"</span>,<span>"7"</span>,<span>"8"</span>,<span>"9"</span>,<span>"10"</span>,<span>"11"</span>,<span>"12"</span>,<span>"13"</span>,<span>"14"</span>,<span>"15"</span>,<span>"16"</span>,<span>"17"</span>,<span>"18"</span>,<span>"19"</span>,<span>"20"</span>,<span>"21"</span>,<span>"22"</span>,<span>"23"</span>,<span>"24"</span>,<span>"25"</span>)<br>sce.all$RNA_snn_res.0.8<br>sce.all$RNA_snn_res.0.8&lt;-factor(sce.all$RNA_snn_res.0.8,levels= My_levels)<br>table(sce.all$RNA_snn_res.0.8)<br><br><br><span>#分面画图</span><br>Mac=c(<span>"CD14"</span>, <span>"CD163"</span>, <span>"APOE"</span>, <span>"C1QA"</span>, <span>"C1QB"</span>, <span>"C1QC"</span>)<br>pDC=c(<span>"LILRA4"</span>, <span>"IL3RA"</span>,<span>"TCF4"</span>,<span>"TCL1A"</span>,<span>"CLEC4C"</span>)<br>DC1=c(<span>"CLEC9A"</span>, <span>"XCR1"</span>, <span>"BATF3"</span>)  <br>DC2=c(<span>"CD1A"</span>, <span>"FCER1A"</span>, <span>"CD1C"</span>,<span>"CD1E"</span>,<span>"CLEC10A"</span>)<br>DC3=c(<span>"CCR7"</span>, <span>"LAMP3"</span>, <span>"FSCN1"</span>,<span>"CCL22"</span>,<span>"BIRC3"</span>)<br>Mono=c(<span>"VCVN"</span>, <span>"FCN1"</span>, <span>"S100A12"</span>, <span>"S100A8"</span>, <span>"S100A9"</span>,<span>'FCGR3A'</span>)<br>genes_to_check =list(<br>  Mac=Mac,<br>  pDC=pDC,<br>  DC1=DC1, <br>  DC2=DC2,<br>  DC3=DC3 ,<br>  Mono=Mono<br>)<br><span>library</span>(stringr)<br>genes_to_check = lapply(genes_to_check, str_to_upper)<br>p_all_markers=DotPlot(sce.all , <br>                      features = genes_to_check,<br>                      scale = <span>T</span>,assay=<span>'RNA'</span>,group.by = <span>"RNA_snn_res.0.8"</span> )+<br>  theme_bw()+<br>  scale_color_continuous(low=<span>"grey"</span>,high =  <span>"red"</span>)+<br>   theme(legend.position = <span>"right"</span>,legend.box = <span>"vertical"</span>,<br>   legend.margin=margin(t= <span>0</span>, unit=<span>'cm'</span>),<br>    <span>#legend.spacing = unit(0,"in"),</span><br>   axis.text.x  = element_text(color=<span>"black"</span>,size=<span>12</span>,angle = <span>45</span>,vjust = <span>0.5</span>, hjust=<span>0.5</span>),<br>    axis.text.y  = element_text(color=<span>"black"</span>,size=<span>12</span>),<br>   legend.text = element_text(size =<span>12</span>,color=<span>"black"</span>),<br>    legend.title = element_text(size =<span>12</span>,color=<span>"black"</span>)<br>  ) ;p_all_markers<br><span>#ggsave('check_paper_markers_cluster_1.pdf',height = 9,width = 10)</span><br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.900373599003736" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8CRxHCxG5tZHBzLupV52zypaQJa1HiccaibKBI2fibvoNVr0KQFjW2ibRLYB6AMUOM7fDeiaZgTrR2oXQ/640?wx_fmt=png" data-type="png" data-w="803" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8CRxHCxG5tZHBzLupV52zypaQJa1HiccaibKBI2fibvoNVr0KQFjW2ibRLYB6AMUOM7fDeiaZgTrR2oXQ/640?wx_fmt=png"><figcaption>图3</figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code><span># p1=DotPlot(sce.all,</span><br><span>#            features=genes_to_check,cols = c("grey", "red"),group.by = "RNA_snn_res.0.8")+</span><br><span>#   theme(</span><br><span>#     axis.text.x  = element_text(color="black",size=12,angle = 45,vjust = 0.5, hjust=0.5),</span><br><span>#     panel.border = element_rect(color="black"), #面板边框</span><br><span>#     panel.spacing = unit(2, "mm"), #面板间距</span><br><span>#     axis.line = element_blank(),</span><br><span>#   )+labs(x="", y=""); p1</span><br><br>p1=DotPlot(sce.all,<br>           features=genes_to_check,cols = c(<span>"#E54924"</span>, <span>"#498EA4"</span>),group.by = <span>"RNA_snn_res.0.8"</span>)+<br>  theme(<br>    axis.text.x  = element_text(color=<span>"black"</span>,size=<span>12</span>,angle = <span>45</span>,vjust = <span>0.5</span>, hjust=<span>0.5</span>),<br>    panel.border = element_rect(color=<span>"black"</span>), <span>#面板边框</span><br>    panel.spacing = unit(<span>2</span>, <span>"mm"</span>), <span>#面板间距</span><br>    axis.line = element_blank(),<br>  )+labs(x=<span>""</span>, y=<span>""</span>); p1<br><br><span>#ggsave('check_paper_markers_cluster_2.pdf',height = 9,width = 10)</span><br><br>p_all_markers+p1<br><br>ggsave(<span>'check_paper_markers_cluster.pdf'</span>,height = <span>11</span>,width = <span>18</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.8907168037602821" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8CRxHCxG5tZHBzLupV52zyDw7XsUdPA4rG90ibae28wAoZ87z5KUQSV9rmpCVfOLH9I2icBkZfXZtw/640?wx_fmt=png" data-type="png" data-w="851" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8CRxHCxG5tZHBzLupV52zyDw7XsUdPA4rG90ibae28wAoZ87z5KUQSV9rmpCVfOLH9I2icBkZfXZtw/640?wx_fmt=png"><figcaption>图4</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span><span>微信交流群</span><span></span></h3><p data-tool="mdnice编辑器">如果你也想参与到群里的讨论中，给我提出一些推文更新建议的话欢迎入群。同时你也可以得到我前期更新的所有数据及代码，在群里我会把代码分享给大家，而且大家可以在群里<strong>「「提出自己感兴趣的单细胞文献」」</strong>我们尽可能优先选择大家的数据集去复现和实战，也欢迎大家在群里分享更多其它资料，咱们一起进步，<strong>「「比较高级的单细胞分析」」</strong>我们也会一起尝试， 相信你肯定是会不虚此行哈。</p><p data-tool="mdnice编辑器">附上之前推文的链接 <a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247512238&amp;idx=1&amp;sn=e0c6dc2ea0e089aabb78133e50fb5d7f&amp;scene=21#wechat_redirect" data-linktype="2">为爱发电不可取（单细胞周更需要你的支持）</a></p><p data-tool="mdnice编辑器">我们这个群是真正的付费交流群，不仅提供数据，代码，学习资料，而且也会跟大家互动交流，还会坚持进行创作至少一年。</p><p data-tool="mdnice编辑器"><strong>「「目前群里已经有200多人，所以你想要进群的话就需要添加我的微信，私聊给我发99元的红包，我把你拉进群里。」」</strong></p><p data-tool="mdnice编辑器">是真正的付费交流群，因为提供数据，代码，学习资料，并且跟大家互动交流，而且会坚持进行创作至少一年。所以，如果介意99元的门槛且不认可我们知识分享的理念，<strong>「请不要加我好友」</strong>。。。</p><figure data-tool="mdnice编辑器"><img data-ratio="1.0068181818181818" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8CRxHCxG5tZHBzLupV52zygUc5rQHO3I1OEBkZwmObm94M58AwuAv6bYt7K2gIM2HKhd5JF69YwQ/640?wx_fmt=png" data-type="png" data-w="440" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8CRxHCxG5tZHBzLupV52zygUc5rQHO3I1OEBkZwmObm94M58AwuAv6bYt7K2gIM2HKhd5JF69YwQ/640?wx_fmt=png"></figure></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/J5ZqvGQittN1vQtYIsuV1Q",target="_blank" rel="noopener noreferrer">原文链接</a>
