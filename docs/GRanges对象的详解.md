---
title: "GRanges对象的详解"
date: 2022-10-13T05:46:42Z
draft: ["false"]
tags: [
  "fetched",
  "生信小知识"
]
categories: ["Acdemic"]
---
GRanges对象的详解 by 生信小知识
------
<div><section><section><h2><span>GRanges对象的详解</span></h2><blockquote><p>微信公众号：<strong>生信小知识</strong><br>关注可了解更多的生物信息学教程及知识。问题或建议，请公众号留言;</p></blockquote><h3><span>目录</span></h3><p><span><span>前言</span></span><span><span>0. 一些过去的图</span></span><span><span>1. IRanges和GRanges的基础知识</span></span><span><span><span>1.1 IRanges和GRanges的区别</span></span></span><span><span><span>1.2 IRanges和GRanges的构建</span></span></span><span><span>2. 获取对象本身属性常用函数</span></span><span><span><span>2.1 两种对象通用的函数</span></span></span><span><span><span>2.2 GRanges对象专有的函数</span></span></span><span><span>3. 对象本身进行操作</span></span><span><span><span>3.1 两种对象通用的函数</span></span></span><span><span><span><span>3.1.1 移动</span></span></span></span><span><span><span><span>3.1.2 取子集</span></span></span></span><span><span><span><span>3.1.3 长度范围修改</span></span></span></span><span><span><span><span>3.1.4 同一对象内不同range间操作</span></span></span></span><span><span><span><span>3.1.5 拆分合并</span></span></span></span><span><span><span>3.2 相同函数在不同对象中具有不同作用</span></span></span><span><span><span>3.3 GRanges对象专有的函数</span></span></span><span><span><span><span>3.3.1 取子集</span></span></span></span><span><span><span><span>3.3.2 拆分合并</span></span></span></span><span><span>4. 不同对象间的集合运算</span></span><span><span><span>4.1 并集，差集及交集</span></span></span><span><span><span>4.2 得到是否有交集的逻辑值</span></span></span><span><span><span>4.3 findOverlaps函数</span></span></span><span><span>后记</span></span></p><h3><span>前言</span></h3><p>很早很早之前其实写过关于IRanges和GRanges对象的介绍：</p><ul><li><p><a href="https://mp.weixin.qq.com/s?__biz=MjM5NTk0Mzg2Nw==&amp;mid=2247483787&amp;idx=1&amp;sn=f4e15077059f65306562fde01256042d&amp;scene=21#wechat_redirect" data-linktype="2">IRanges对象和GRanges对象的介绍</a></p></li></ul><p>无奈近些年主要做转录组分析，在R中很少分析基因数据。而如今转做表观分析，涉及到的内容主要都来自基因组数据，这就不得不再次重新学习下相关知识了。</p><p>此次参考资料包括：</p><ul><li><p><span>https://www.jianshu.com/p/b473a1ba95b2</span></p></li><li><p><span>https://www.jianshu.com/p/02d9cd8059f1</span></p></li></ul><h3><span>0. 一些过去的图</span></h3><p>在笔记开始，先放上多年前我自己制作的一些帮助理解的图。</p><p><img data-galleryid="" data-ratio="0.4414029084687767" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJraQPh7bU979ymxQWQH7u9lGsxyJY1mkia13jENwciaRy283mz9ADkEK1VfZQFZFE835279s3kHLG2A/640?wx_fmt=png" data-type="png" data-w="1169" src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJraQPh7bU979ymxQWQH7u9lGsxyJY1mkia13jENwciaRy283mz9ADkEK1VfZQFZFE835279s3kHLG2A/640?wx_fmt=png"></p><figure><figcaption>Fig1</figcaption></figure><p><img data-galleryid="" data-ratio="0.30206254158349966" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJraQPh7bU979ymxQWQH7u9ln70VUwCMiccNiaq93veuyagZticzfzKl33Oibq6oeDdmag6jNSntJic7Leg/640?wx_fmt=png" data-type="png" data-w="1503" src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJraQPh7bU979ymxQWQH7u9ln70VUwCMiccNiaq93veuyagZticzfzKl33Oibq6oeDdmag6jNSntJic7Leg/640?wx_fmt=png"></p><figure><figcaption><span>Fig2</span></figcaption></figure><p><img data-galleryid="" data-ratio="0.31742738589211617" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJraQPh7bU979ymxQWQH7u9lVxwqYiadCR0FzVKC0vCTHL2MtlfFt5e5HDN1Fg2puqxB4jX5hAmIgpw/640?wx_fmt=png" data-type="png" data-w="1446" src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJraQPh7bU979ymxQWQH7u9lVxwqYiadCR0FzVKC0vCTHL2MtlfFt5e5HDN1Fg2puqxB4jX5hAmIgpw/640?wx_fmt=png"></p><figure><figcaption><span>Fig1</span></figcaption></figure><p>此外，还有一个<strong>很重要的思维导图</strong>，记录了关于IRanges和GRanges对象中比较重要的一些函数，以及这些函数中比较重要的参数理解。有了这个导图，基本上就知道了整个推文的内容。如下图所示。</p><blockquote><p>可能因为内容太多，看不太清楚，所以这里也放到网盘一份，有需要的自取。</p><p>公众号回复 <span><strong>“GRanges对象结构”</strong></span> 即可获取。</p></blockquote><p><img data-galleryid="" data-ratio="2.2681958535509485" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJraQPh7bU979ymxQWQH7u9lA5YGzEL3N5ickLFL33v1gvDhMhzHDiavrUiaMNRdcNwChLIGm2UebKiaibA/640?wx_fmt=png" data-type="png" data-w="2267" src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJraQPh7bU979ymxQWQH7u9lA5YGzEL3N5ickLFL33v1gvDhMhzHDiavrUiaMNRdcNwChLIGm2UebKiaibA/640?wx_fmt=png"></p><h3><span>1. IRanges和GRanges的基础知识</span></h3><h4><span>1.1 IRanges和GRanges的区别</span></h4><p>个人认为，<strong>GRanges可以理解为IRanges的高级拓展</strong>，<strong>对IRanges可以使用的函数，均可以用于GRanges。</strong></p><p>而<strong>GRanges</strong>相比于IRanges而言，则是<strong>多了可以自定义的metadata信息</strong>。</p><h4><span>1.2 IRanges和GRanges的构建</span></h4><p>知道如何自行构建IRanges和GRanges对象，一定程度上也可以帮助我们理解IRanges和GRanges中的内容包括哪些。</p><p><strong>IRanges构建语法</strong>：<code>IRanges(start=NULL, end=NULL, width=NULL, names=NULL)</code></p><ul><li><p>start：一个<strong>数字向量</strong>，记录起点。这里也可以为空白，而在end和width中规定。</p></li><li><p>end：一个<strong>数字向量</strong>，记录终点。这里也可以为空白，而在start和width中规定。</p></li><li><p>width：一个<strong>数字向量</strong>，记录长度。这里也可以为空白，而在start和end中规定。</p></li><li><p>names：一个<strong>向量</strong>，记录行名。默认为数字</p></li></ul><p>实例：</p><pre><code>IRanges(start=c(<span>4</span>,<span>7</span>,<span>2</span>,<span>20</span>), end=c(<span>13</span>,<span>7</span>,<span>5</span>,<span>23</span>), names = letters[<span>1</span>:<span>4</span>])<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         4        13        10</span><br><span>##   b         7         7         1</span><br><span>##   c         2         5         4</span><br><span>##   d        20        23         4</span><br></code></pre><p><strong>GRanges构建语法</strong>：<code>GRanges(seqnames=NULL, ranges=NULL, strand=NULL, ...)</code></p><ul><li><p>seqnames：一个<strong>rle对象</strong>或者<strong>向量</strong>，记录染色体号。</p></li><li><p>ranges：一个<strong>IRanges对象</strong>，记录坐标范围。</p></li><li><p>strand：一个<strong>rle对象</strong>或者<strong>向量</strong>，记录正负链。</p></li><li><p>…：可以以<code>名字=向量</code>的形式，记录其他不同的metadata信息。</p></li></ul><blockquote><p>rle对象和向量之间的转换关系：</p><p>一串字符如果用向量表示，可以写作：</p><p><code>c(1,1,1,2,2,2,3,3,4,3,3)</code></p><p>相同的字符，如果用rle对象，则可以写作：</p><p><code>Rle(c(1,1,1,2,2,2,3,3,4,3,3))</code><br><code>## numeric-Rle of length 11 with 5 runs</code><br><code>##   Lengths: 3 3 2 1 2</code><br><code>##   Values : 1 2 3 4 3</code></p></blockquote><p>实例：</p><pre><code>GRanges(seq = c(<span>"chr1"</span>,<span>"chr1"</span>,<span>"chr2"</span>,<span>"chr1"</span>),<br>        ranges = IRanges(start = c(<span>5</span>:<span>8</span>),width = <span>10</span>),<br>        strand = rep(<span>"+"</span>,<span>4</span>),<br>        score = <span>1</span>:<span>4</span>,<br>        GC = seq(<span>1</span>, <span>0</span>, length=<span>4</span>))<br><span>## GRanges object with 4 ranges and 2 metadata columns:</span><br><span>##       seqnames    ranges strand |     score        GC</span><br><span>##          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;integer&gt; &lt;numeric&gt;</span><br><span>##   [1]     chr1      5-14      + |         1  1.000000</span><br><span>##   [2]     chr1      6-15      + |         2  0.666667</span><br><span>##   [3]     chr2      7-16      + |         3  0.333333</span><br><span>##   [4]     chr1      8-17      + |         4  0.000000</span><br><span>##   -------</span><br><span>##   seqinfo: 2 sequences from an unspecified genome; no seqlengths</span><br></code></pre><h3><span>2. 获取对象本身属性常用函数</span></h3><h4><span>2.1 两种对象通用的函数</span></h4><ul><li><p><code>start(x)</code>：查询开始位置</p></li><li><p><code>end(x)</code>：查询结束位置</p></li><li><p><code>width(x)</code>：查询宽度，其值等于<code>end-start+1</code></p></li><li><p><code>length(x)</code>：查询一共有多少条记录</p></li><li><p><code>names(x)</code>：查询行名</p></li></ul><p>实例：</p><pre><code>x &lt;- IRanges(start=c(<span>4</span>,<span>7</span>,<span>2</span>,<span>20</span>), end=c(<span>13</span>,<span>7</span>,<span>5</span>,<span>23</span>), names = letters[<span>1</span>:<span>4</span>])<br>y &lt;- GRanges(seq = c(<span>"chr1"</span>,<span>"chr1"</span>,<span>"chr2"</span>,<span>"chr1"</span>),<br>             ranges = IRanges(start = c(<span>5</span>:<span>8</span>),width = <span>10</span>),<br>             strand = rep(<span>"+"</span>,<span>4</span>),<br>             score = <span>1</span>:<span>4</span>,<br>             GC = seq(<span>1</span>, <span>0</span>, length=<span>4</span>))<br>start(x)<br><span>## [1]  4  7  2 20</span><br>end(x)<br><span>## [1] 13  7  5 23</span><br>width(x)<br><span>## [1] 10  1  4  4</span><br>length(x)<br><span>## [1] 4</span><br>names(x)<br><span>## [1] "a" "b" "c" "d"</span><br></code></pre><h4><span>2.2 GRanges对象专有的函数</span></h4><ul><li><p><code>seqnames(x)</code>：查询染色体号</p></li><li><p><code>strand(x)</code>：查询链信息</p></li><li><p><code>mcols(x)</code>：查询所有的metadata数据</p></li><li><p><code>granges(x)</code>：查询去除metadata后的数据，即seqnames，ranges，strand这3种信息。</p></li></ul><pre><code>x &lt;- IRanges(start=c(<span>4</span>,<span>7</span>,<span>2</span>,<span>20</span>), end=c(<span>13</span>,<span>7</span>,<span>5</span>,<span>23</span>), names = letters[<span>1</span>:<span>4</span>])<br>y &lt;- GRanges(seq = c(<span>"chr1"</span>,<span>"chr1"</span>,<span>"chr2"</span>,<span>"chr1"</span>),<br>             ranges = IRanges(start = c(<span>5</span>:<span>8</span>),width = <span>10</span>),<br>             strand = rep(<span>"+"</span>,<span>4</span>),<br>             score = <span>1</span>:<span>4</span>,<br>             GC = seq(<span>1</span>, <span>0</span>, length=<span>4</span>))<br><br>seqnames(y)<br><span>## factor-Rle of length 4 with 3 runs</span><br><span>##   Lengths:    2    1    1</span><br><span>##   Values : chr1 chr2 chr1</span><br><span>## Levels(2): chr1 chr2</span><br><br>strand(y)<br><span>## factor-Rle of length 4 with 1 run</span><br><span>##   Lengths: 4</span><br><span>##   Values : +</span><br><span>## Levels(3): + - *</span><br><br>mcols(y)<br><span>## DataFrame with 4 rows and 2 columns</span><br><span>##       score        GC</span><br><span>##   &lt;integer&gt; &lt;numeric&gt;</span><br><span>## 1         1  1.000000</span><br><span>## 2         2  0.666667</span><br><span>## 3         3  0.333333</span><br><span>## 4         4  0.000000</span><br><br>granges(y)<br><span>## GRanges object with 4 ranges and 0 metadata columns:</span><br><span>##       seqnames    ranges strand</span><br><span>##          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;</span><br><span>##   [1]     chr1      5-14      +</span><br><span>##   [2]     chr1      6-15      +</span><br><span>##   [3]     chr2      7-16      +</span><br><span>##   [4]     chr1      8-17      +</span><br><span>##   -------</span><br><span>##   seqinfo: 2 sequences from an unspecified genome; no seqlengths</span><br></code></pre><h3><span>3. 对象本身进行操作</span></h3><p>这里的一些函数理解可以参考【0. 一些过去的图】。</p><h4><span>3.1 两种对象通用的函数</span></h4><h5><span>3.1.1 移动</span></h5><ul><li><p><code>shift(x, shift=0)</code>：整体移动，shift为正则向前移动，反之则向后移动</p></li></ul><p>实例：</p><pre><code>x &lt;- IRanges(start=c(<span>4</span>,<span>4</span>,<span>2</span>,<span>20</span>), end=c(<span>13</span>,<span>7</span>,<span>5</span>,<span>23</span>), names = letters[<span>1</span>:<span>4</span>])<br>x<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         4        13        10</span><br><span>##   b         4         7         4</span><br><span>##   c         2         5         4</span><br><span>##   d        20        23         4</span><br><br>shift(x, shift=<span>1</span>)<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         5        14        10</span><br><span>##   b         5         8         4</span><br><span>##   c         3         6         4</span><br><span>##   d        21        24         4</span><br>shift(x, shift=-<span>1</span>)<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         3        12        10</span><br><span>##   b         3         6         4</span><br><span>##   c         1         4         4</span><br><span>##   d        19        22         4</span><br></code></pre><h5><span>3.1.2 取子集</span></h5><ul><li><p><code>x[2:3]</code>：取出第2-3行数据</p></li></ul><p>实例：</p><pre><code>x &lt;- IRanges(start=c(<span>4</span>,<span>4</span>,<span>2</span>,<span>20</span>), end=c(<span>13</span>,<span>7</span>,<span>5</span>,<span>23</span>), names = letters[<span>1</span>:<span>4</span>])<br>x<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         4        13        10</span><br><span>##   b         4         7         4</span><br><span>##   c         2         5         4</span><br><span>##   d        20        23         4</span><br><br>x[<span>2</span>:<span>3</span>]<br><span>## IRanges object with 2 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   b         4         7         4</span><br><span>##   c         2         5         4</span><br></code></pre><p>此外，我们也可以通过设定条件，进行挑选，例如：</p><pre><code>x &lt;- IRanges(start=c(<span>4</span>,<span>4</span>,<span>2</span>,<span>20</span>), end=c(<span>13</span>,<span>7</span>,<span>5</span>,<span>23</span>), names = letters[<span>1</span>:<span>4</span>])<br>x<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         4        13        10</span><br><span>##   b         4         7         4</span><br><span>##   c         2         5         4</span><br><span>##   d        20        23         4</span><br><br>x[start(x)&gt;<span>2</span> &amp; end(x)&lt;<span>7</span>]<br><span>## IRanges object with 2 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   b         4         7         4</span><br></code></pre><h5><span>3.1.3 长度范围修改</span></h5><ul><li><p><code>resize(x, width, fix="start")</code>：width确定宽度，fix设置固定位置（start/end/center）</p></li><li><p><span>加减运算：</span></p></li><li><p><code>x+1</code>：起始和终止同时向外扩张1个单位</p></li><li><p><code>x-1</code>：起始和终止同时向内扩张1个单位</p></li><li><p><span>乘除运算：</span></p></li><li><p><code>x*2</code>：宽度变为原来1/2倍，中心不变</p></li><li><p><code>x*-2</code>：宽度变为原来2倍，中心不变</p></li><li><p><code>promoters(x, upstream, downstream)</code>：主要是用来取上游宽度为upstream+downstream的一段序列。注意：这里的上下游均是<strong>针对起点</strong>而言。</p></li><li><p><code>flank(x, width, start=TRUE)</code>：主要是用来取上下游宽度为width的一段序列。其中，width为正数表示上游，负数为下游。start为TRUE表示从起点计算，FALSE表示从终点计算。使用起来比较麻烦，<strong>不建议使用</strong>，可以用<code>resize</code>函数替代。</p></li></ul><p>实例：</p><pre><code>x &lt;- IRanges(start=c(<span>4</span>,<span>4</span>,<span>2</span>,<span>20</span>), end=c(<span>13</span>,<span>7</span>,<span>5</span>,<span>23</span>), names = letters[<span>1</span>:<span>4</span>])<br>x<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         4        13        10</span><br><span>##   b         4         7         4</span><br><span>##   c         2         5         4</span><br><span>##   d        20        23         4</span><br><br>resize(x, width=<span>4</span>, fix=<span>"start"</span>)<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         4         7         4</span><br><span>##   b         4         7         4</span><br><span>##   c         2         5         4</span><br><span>##   d        20        23         4</span><br>resize(x, width=<span>4</span>, fix=<span>"end"</span>)<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a        10        13         4</span><br><span>##   b         4         7         4</span><br><span>##   c         2         5         4</span><br><span>##   d        20        23         4</span><br>resize(x, width=<span>4</span>, fix=<span>"center"</span>)<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         7        10         4</span><br><span>##   b         4         7         4</span><br><span>##   c         2         5         4</span><br><span>##   d        20        23         4</span><br><br><span>## x+1</span><br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         3        14        12</span><br><span>##   b         3         8         6</span><br><span>##   c         1         6         6</span><br><span>##   d        19        24         6</span><br><span>## x-1</span><br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         5        12         8</span><br><span>##   b         5         6         2</span><br><span>##   c         3         4         2</span><br><span>##   d        21        22         2</span><br><span>## x*2</span><br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         6        10         5</span><br><span>##   b         5         6         2</span><br><span>##   c         3         4         2</span><br><span>##   d        21        22         2</span><br><span>## x*-2</span><br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a        -1        18        20</span><br><span>##   b         2         9         8</span><br><span>##   c         0         7         8</span><br><span>##   d        18        25         8</span><br><br>promoters(x, <span>4</span>, <span>4</span>)<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         0         7         8</span><br><span>##   b         0         7         8</span><br><span>##   c        -2         5         8</span><br><span>##   d        16        23         8</span><br><br>flank(x, <span>4</span>, start=<span>TRUE</span>)<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         0         3         4</span><br><span>##   b         0         3         4</span><br><span>##   c        -2         1         4</span><br><span>##   d        16        19         4</span><br>flank(x, -<span>4</span>, start=<span>TRUE</span>)<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         4         7         4</span><br><span>##   b         4         7         4</span><br><span>##   c         2         5         4</span><br><span>##   d        20        23         4</span><br>flank(x, <span>4</span>, start=<span>FALSE</span>)<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a        14        17         4</span><br><span>##   b         8        11         4</span><br><span>##   c         6         9         4</span><br><span>##   d        24        27         4</span><br>flank(x, -<span>4</span>, start=<span>FALSE</span>)<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a        10        13         4</span><br><span>##   b         4         7         4</span><br><span>##   c         2         5         4</span><br><span>##   d        20        23         4</span><br></code></pre><h5><span>3.1.4 同一对象内不同range间操作</span></h5><ul><li><p><code>range(x)</code>：获取IRanges对象所包括的整个区域（包括间隔区）</p></li><li><p><code>reduce(x)</code>：将重叠区域合并</p></li><li><p><code>gaps(x)</code>：获取间隔区域</p></li><li><p><code>disjoin(x)</code>：将所有区段进行区分，将重合的与未重合的进行区分</p></li></ul><p>实例：</p><pre><code>x &lt;- IRanges(start=c(<span>4</span>,<span>4</span>,<span>2</span>,<span>20</span>), end=c(<span>13</span>,<span>7</span>,<span>5</span>,<span>23</span>), names = letters[<span>1</span>:<span>4</span>])<br>x<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         4        13        10</span><br><span>##   b         4         7         4</span><br><span>##   c         2         5         4</span><br><span>##   d        20        23         4</span><br><br>range(x)<br><span>## IRanges object with 1 range and 0 metadata columns:</span><br><span>##           start       end     width</span><br><span>##       &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   [1]         2        23        22</span><br>reduce(x)<br><span>## IRanges object with 2 ranges and 0 metadata columns:</span><br><span>##           start       end     width</span><br><span>##       &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   [1]         2        13        12</span><br><span>##   [2]        20        23         4</span><br>gaps(x)<br><span>## IRanges object with 1 range and 0 metadata columns:</span><br><span>##           start       end     width</span><br><span>##       &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   [1]        14        19         6</span><br>disjoin(x)<br><span>## IRanges object with 5 ranges and 0 metadata columns:</span><br><span>##           start       end     width</span><br><span>##       &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   [1]         2         3         2</span><br><span>##   [2]         4         5         2</span><br><span>##   [3]         6         7         2</span><br><span>##   [4]         8        13         6</span><br><span>##   [5]        20        23         4</span><br></code></pre><h5><span>3.1.5 拆分合并</span></h5><p>拆分后得到的是<code>GRangesList</code>对象</p><ul><li><p><code>y=split(x, index)</code>：index是一个向量或者因子，长度和x一致。按照index的分类进行数据拆分。</p></li><li><p><code>c(y[[1]],y[[2]])</code>：合并两个Ranges对象。</p></li></ul><p>实例：</p><pre><code>x &lt;- IRanges(start=c(<span>4</span>,<span>4</span>,<span>2</span>,<span>20</span>), end=c(<span>13</span>,<span>7</span>,<span>5</span>,<span>23</span>), names = letters[<span>1</span>:<span>4</span>])<br>x<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         4        13        10</span><br><span>##   b         4         7         4</span><br><span>##   c         2         5         4</span><br><span>##   d        20        23         4</span><br><br>y &lt;- split(x, c(<span>1</span>,<span>4</span>,<span>1</span>,<span>4</span>))<br>y<br><span>## IRangesList object of length 2:</span><br><span>## $`1`</span><br><span>## IRanges object with 2 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         4        13        10</span><br><span>##   c         2         5         4</span><br><span>## </span><br><span>## $`4`</span><br><span>## IRanges object with 2 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   b         4         7         4</span><br><span>##   d        20        23         4</span><br><br>c(y[[<span>1</span>]],y[[<span>2</span>]])<br><span>## IRanges object with 4 ranges and 0 metadata columns:</span><br><span>##         start       end     width</span><br><span>##     &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   a         4        13        10</span><br><span>##   c         2         5         4</span><br><span>##   b         4         7         4</span><br><span>##   d        20        23         4</span><br></code></pre><h4><span>3.2 相同函数在不同对象中具有不同作用</span></h4><ul><li><p><code>range(x)</code>：在<strong>IRanges对象</strong>中，用于确定两端的范围，结果只有<strong>1行3个数字</strong>，即start和end以及width。在<strong>GRanges对象</strong>中，单纯提取start和end以及width，<strong>GRanges对象有多少行，结果就有多少行</strong>。</p></li></ul><p>实例：</p><pre><code>x &lt;- IRanges(start=c(<span>4</span>,<span>7</span>,<span>2</span>,<span>20</span>), end=c(<span>13</span>,<span>7</span>,<span>5</span>,<span>23</span>), names = letters[<span>1</span>:<span>4</span>])<br>y &lt;- GRanges(seq = c(<span>"chr1"</span>,<span>"chr1"</span>,<span>"chr2"</span>,<span>"chr1"</span>),<br>             ranges = IRanges(start = c(<span>5</span>:<span>8</span>),width = <span>10</span>),<br>             strand = rep(<span>"+"</span>,<span>4</span>),<br>             score = <span>1</span>:<span>4</span>,<br>             GC = seq(<span>1</span>, <span>0</span>, length=<span>4</span>))<br><br>range(x)<br><span>## IRanges object with 1 range and 0 metadata columns:</span><br><span>##           start       end     width</span><br><span>##       &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   [1]         2        23        22</span><br><br>range(y)<br><span>## GRanges object with 2 ranges and 0 metadata columns:</span><br><span>##       seqnames    ranges strand</span><br><span>##          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;</span><br><span>##   [1]     chr1      5-17      +</span><br><span>##   [2]     chr2      7-16      +</span><br><span>##   -------</span><br><span>##   seqinfo: 2 sequences from an unspecified genome; no seqlengths</span><br></code></pre><h4><span>3.3 GRanges对象专有的函数</span></h4><h5><span>3.3.1 取子集</span></h5><ul><li><p><code>x[2:3, "GC"]</code>：取出第2-3行数据以及其后面metadata的GC部分。</p></li></ul><p>实例：</p><pre><code>x &lt;- GRanges(seq = c(<span>"chr1"</span>,<span>"chr1"</span>,<span>"chr2"</span>,<span>"chr1"</span>),<br>             ranges = IRanges(start = c(<span>5</span>:<span>8</span>),width = <span>10</span>),<br>             strand = rep(<span>"+"</span>,<span>4</span>),<br>             score = <span>1</span>:<span>4</span>,<br>             GC = seq(<span>1</span>, <span>0</span>, length=<span>4</span>))<br>x<br><span>## GRanges object with 4 ranges and 2 metadata columns:</span><br><span>##       seqnames    ranges strand |     score        GC</span><br><span>##          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;integer&gt; &lt;numeric&gt;</span><br><span>##   [1]     chr1      5-14      + |         1  1.000000</span><br><span>##   [2]     chr1      6-15      + |         2  0.666667</span><br><span>##   [3]     chr2      7-16      + |         3  0.333333</span><br><span>##   [4]     chr1      8-17      + |         4  0.000000</span><br><span>##   -------</span><br><span>##   seqinfo: 2 sequences from an unspecified genome; no seqlengths</span><br><br>x[<span>2</span>:<span>3</span>, <span>"GC"</span>]<br><span>## GRanges object with 2 ranges and 1 metadata column:</span><br><span>##       seqnames    ranges strand |        GC</span><br><span>##          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;numeric&gt;</span><br><span>##   [1]     chr1      6-15      + |  0.666667</span><br><span>##   [2]     chr2      7-16      + |  0.333333</span><br><span>##   -------</span><br><span>##   seqinfo: 2 sequences from an unspecified genome; no seqlengths</span><br></code></pre><p>此外，我们也可以通过设定条件，进行挑选，例如：</p><pre><code>x &lt;- GRanges(seq = c(<span>"chr1"</span>,<span>"chr1"</span>,<span>"chr2"</span>,<span>"chr1"</span>),<br>             ranges = IRanges(start = c(<span>5</span>:<span>8</span>),width = <span>10</span>),<br>             strand = rep(<span>"+"</span>,<span>4</span>),<br>             score = <span>1</span>:<span>4</span>,<br>             GC = seq(<span>1</span>, <span>0</span>, length=<span>4</span>))<br>x<br><span>## GRanges object with 4 ranges and 2 metadata columns:</span><br><span>##       seqnames    ranges strand |     score        GC</span><br><span>##          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;integer&gt; &lt;numeric&gt;</span><br><span>##   [1]     chr1      5-14      + |         1  1.000000</span><br><span>##   [2]     chr1      6-15      + |         2  0.666667</span><br><span>##   [3]     chr2      7-16      + |         3  0.333333</span><br><span>##   [4]     chr1      8-17      + |         4  0.000000</span><br><span>##   -------</span><br><span>##   seqinfo: 2 sequences from an unspecified genome; no seqlengths</span><br><br>x[x$GC&gt;<span>0.5</span> &amp; x$score&lt;<span>3</span> &amp; start(x)&lt;<span>10</span> &amp; end(x)&gt;<span>14</span>, <span>"GC"</span>]<br><span>## GRanges object with 1 range and 1 metadata column:</span><br><span>##       seqnames    ranges strand |        GC</span><br><span>##          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;numeric&gt;</span><br><span>##   [1]     chr1      6-15      + |  0.666667</span><br><span>##   -------</span><br><span>##   seqinfo: 2 sequences from an unspecified genome; no seqlengths</span><br></code></pre><h5><span>3.3.2 拆分合并</span></h5><p>除了通用的，可以<strong>指定index进行拆分</strong>外，还可以<strong>按照注释信息metadata拆分</strong>。</p><p>拆分后得到的是<code>GRangesList</code>对象。</p><ul><li><p><code>split(x, ~ strand)</code>：这里的<code>strand</code><strong>不加引号</strong>，不做字符处理</p></li></ul><p>实例：</p><pre><code>x &lt;- GRanges(seq = c(<span>"chr1"</span>,<span>"chr1"</span>,<span>"chr2"</span>,<span>"chr1"</span>),<br>             ranges = IRanges(start = c(<span>5</span>:<span>8</span>),width = <span>10</span>),<br>             strand = rep(<span>"+"</span>,<span>4</span>),<br>             score = <span>1</span>:<span>4</span>,<br>             GC = seq(<span>1</span>, <span>0</span>, length=<span>4</span>))<br>x<br><span>## GRanges object with 4 ranges and 2 metadata columns:</span><br><span>##       seqnames    ranges strand |     score        GC</span><br><span>##          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;integer&gt; &lt;numeric&gt;</span><br><span>##   [1]     chr1      5-14      + |         1  1.000000</span><br><span>##   [2]     chr1      6-15      + |         2  0.666667</span><br><span>##   [3]     chr2      7-16      + |         3  0.333333</span><br><span>##   [4]     chr1      8-17      + |         4  0.000000</span><br><span>##   -------</span><br><span>##   seqinfo: 2 sequences from an unspecified genome; no seqlengths</span><br><br>split(x,~)<br><span>## GRangesList object of length 3:</span><br><span>## $`+`</span><br><span>## GRanges object with 4 ranges and 2 metadata columns:</span><br><span>##       seqnames    ranges strand |     score        GC</span><br><span>##          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;integer&gt; &lt;numeric&gt;</span><br><span>##   [1]     chr1      5-14      + |         1  1.000000</span><br><span>##   [2]     chr1      6-15      + |         2  0.666667</span><br><span>##   [3]     chr2      7-16      + |         3  0.333333</span><br><span>##   [4]     chr1      8-17      + |         4  0.000000</span><br><span>##   -------</span><br><span>##   seqinfo: 2 sequences from an unspecified genome; no seqlengths</span><br><span>## </span><br><span>## $`-`</span><br><span>## GRanges object with 0 ranges and 2 metadata columns:</span><br><span>##    seqnames    ranges strand |     score        GC</span><br><span>##       &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;integer&gt; &lt;numeric&gt;</span><br><span>##   -------</span><br><span>##   seqinfo: 2 sequences from an unspecified genome; no seqlengths</span><br><span>## </span><br><span>## $`*`</span><br><span>## GRanges object with 0 ranges and 2 metadata columns:</span><br><span>##    seqnames    ranges strand |     score        GC</span><br><span>##       &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;integer&gt; &lt;numeric&gt;</span><br><span>##   -------</span><br><span>##   seqinfo: 2 sequences from an unspecified genome; no seqlengths</span><br></code></pre><h3><span>4. 不同对象间的集合运算</span></h3><p>该部分内容在两种对象中操作<strong>一致</strong>。</p><h4><span>4.1 并集，差集及交集</span></h4><ul><li><p>并集：<code>union(x,y)</code></p></li><li><p><span>差集：</span></p></li><li><p><code>setdiff(x,y)</code>：x中除去y区域</p></li><li><p><code>setdiff(y,x)</code>：y中除去x区域</p></li><li><p>交集：<code>intersect(x,y)</code></p></li></ul><p>实例：</p><pre><code>x &lt;- IRanges(c(<span>1</span>,<span>10</span>),c(<span>5</span>,<span>15</span>))<br>y &lt;- IRanges(c(<span>3</span>,<span>16</span>),c(<span>7</span>,<span>19</span>))<br><br>x<br><span>## IRanges object with 2 ranges and 0 metadata columns:</span><br><span>##           start       end     width</span><br><span>##       &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   [1]         1         5         5</span><br><span>##   [2]        10        15         6</span><br>y<br><span>## IRanges object with 2 ranges and 0 metadata columns:</span><br><span>##           start       end     width</span><br><span>##       &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   [1]         3         7         5</span><br><span>##   [2]        16        19         4</span><br><br>union(x,y)<br><span>## IRanges object with 2 ranges and 0 metadata columns:</span><br><span>##           start       end     width</span><br><span>##       &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   [1]         1         7         7</span><br><span>##   [2]        10        19        10</span><br>setdiff(x,y)<br><span>## IRanges object with 2 ranges and 0 metadata columns:</span><br><span>##           start       end     width</span><br><span>##       &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   [1]         1         2         2</span><br><span>##   [2]        10        15         6</span><br>setdiff(y,x)<br><span>## IRanges object with 2 ranges and 0 metadata columns:</span><br><span>##           start       end     width</span><br><span>##       &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   [1]         6         7         2</span><br><span>##   [2]        16        19         4</span><br>intersect(x,y)<br><span>## IRanges object with 1 range and 0 metadata columns:</span><br><span>##           start       end     width</span><br><span>##       &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   [1]         3         5         3</span><br></code></pre><h4><span>4.2 得到是否有交集的逻辑值</span></h4><ul><li><p><code>x%over%y</code>：x中哪些与y有交集，目标在x，y是被比较对象</p></li><li><p><code>y%over%x</code>：y中哪些与x有交集，目标在y，x是被比较对象</p></li></ul><p>实例：</p><pre><code>x &lt;- IRanges(c(<span>1</span>,<span>10</span>,<span>3</span>),c(<span>5</span>,<span>15</span>,<span>5</span>))<br>y &lt;- IRanges(c(<span>3</span>,<span>16</span>),c(<span>7</span>,<span>19</span>))<br><br>x<br><span>## IRanges object with 3 ranges and 0 metadata columns:</span><br><span>##           start       end     width</span><br><span>##       &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   [1]         1         5         5</span><br><span>##   [2]        10        15         6</span><br><span>##   [3]         3         5         3</span><br>y<br><span>## IRanges object with 2 ranges and 0 metadata columns:</span><br><span>##           start       end     width</span><br><span>##       &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span><br><span>##   [1]         3         7         5</span><br><span>##   [2]        16        19         4</span><br><br>x%over%y<br><span>## [1]  TRUE FALSE  TRUE</span><br>y%over%x<br><span>## [1]  TRUE FALSE</span><br></code></pre><h4><span>4.3 findOverlaps函数</span></h4><p>这个函数单独讲，其实都可以讲好一会了，功能非常强大。</p><p>我们前面讲到，如果要找交集，使用 <code>intersect</code> 函数就可以了。但是 <code>intersect</code> 函数太过于简单，无法准确处理我们在生物学上的问题。</p><p>例如，我们在做peak注释时，如果一个peak长10kb，只有50bp与一个基因的promoter区域重合，而剩下9950bp都处于基因body区域，那么此时我们难道判断这个peak落在了promoter区吗？</p><p>也就是在某些情况下，我们可能需要定义，当两个区域<strong>重叠程度</strong>，例如<strong>重叠多少bp，或者重叠的区域占总区域的百分之多少时</strong>，我们才说他们归于某个区域。</p><p>而这个则需要我们使用 <code>findOverlaps</code> 进行详细定义。</p><p>下面我们先对 <code>findOverlaps</code> 函数进行学习：</p><pre><code>findOverlaps(query, subject,<br>    maxgap=-1L, minoverlap=0L,<br>    type=c("any", "<span>start</span><span>", "</span><span>end</span><span>", "</span><span>within</span><span>", "</span>equal<span>"),<br>    select=c("</span>all<span>", "</span><span>first</span><span>", "</span><span>last</span><span>", "</span>arbitrary<span>"),<br>    ignore.strand=FALSE)<br></span></code></pre><ul><li><p><code>query</code>, <code>subject</code>：一个IRanges或者GRanges对象</p></li><li><p><code>maxgap</code>：<strong>大于等于-1</strong>的一个数字。表示2个区域之间可以相隔 <code>maxgap</code> 个距离。当两个区域处于邻接状态时，例如【1-4】和【5-6】，其gap=0。对于一个区域的终点是另外一个区域的起点，例如【1-4】和【4-6】，其gap=-1</p></li><li><p><code>minoverlap</code>：一个非负数字，默认为0。表示2个区域之间最少要重合 <code>minoverlap</code> 单位时，才被认为是重合。例如当 <code>minoverlap=2</code> 时，【1-4】和【4-6】不算重合，因为他们之间只重叠了1个单位。</p></li><li><p><code>type</code>：<code>any</code> 表示只要有1个单位重叠即可；<code>start</code> 和 <code>end</code> 表示两个区域必须有相同的起点/终点；<code>equal</code> 表示两个区域必须完全相同，具有相同的起点和终点；<code>within</code> 表示query对象一定要在subject对象之内，这也包括当两者完全相同 <code>equal</code> 时的状态【<strong>此处注意函数使用时query和subject的顺序</strong>】。</p></li></ul><p>实例：</p><pre><code><span># 构建数据</span><br><span>if</span> (<span>T</span>) {<br>  x &lt;- IRanges(start=c(<span>1</span>,<span>6</span>,<span>3</span>),end=c(<span>5</span>,<span>10</span>,<span>6</span>),names = letters[<span>1</span>:<span>3</span>])<br>  y &lt;- IRanges(start=c(<span>5</span>,<span>6</span>,<span>8</span>,<span>6</span>),end=c(<span>7</span>,<span>7</span>,<span>10</span>,<span>10</span>),names = letters[<span>4</span>:<span>7</span>])<br>  x<br>  y<br>}<br><br><span>if</span> (<span>T</span>) {<br>  <span># default 'any'</span><br>  findOverlaps(x,y)<br><br>  <span># 默认为maxgap=-1,表示一个的终点是另外一个的起点</span><br>  findOverlaps(x,y,maxgap = -<span>1</span>)<br>  <span># 紧邻的两个,gap=0(数字上相减=1)</span><br>  findOverlaps(x,y,maxgap = <span>0</span>)<br><br>  <span># 端点重合，overlap=0</span><br>  findOverlaps(x,y,minoverlap = <span>0</span>)<br>  findOverlaps(x,y,minoverlap = <span>1</span>)<br>  findOverlaps(x,y,minoverlap = <span>2</span>)<br><br>  <span># type, default 'any'</span><br>  findOverlaps(x,y,type=<span>"any"</span>)<br>  findOverlaps(x,y,type=<span>"start"</span>)<br>  findOverlaps(x,y,type=<span>"end"</span>)<br>  findOverlaps(x,y,type=<span>"equal"</span>)<br>  <span># query在subject之内,包括"within"</span><br>  findOverlaps(x,y,type=<span>"within"</span>)<br>  findOverlaps(y,x,type=<span>"within"</span>)<br>}<br></code></pre><h3><span>后记</span></h3><p>基本上常用的应该就这些吧，如果后面有新需求再做补充~</p></section><h2><br></h2></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/mYYs7oDyfso-ds_oJ6xpuA",target="_blank" rel="noopener noreferrer">原文链接</a>
