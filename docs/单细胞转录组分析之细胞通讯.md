---
title: "单细胞转录组分析之细胞通讯"
date: 2023-01-04T01:30:36Z
draft: ["false"]
tags: [
  "fetched",
  "医学僧的科研日记"
]
categories: ["Acdemic"]
---
单细胞转录组分析之细胞通讯 by 医学僧的科研日记
------
<div><section><section>单细胞测序解决了Bulk测序无法回避的细胞间异质性问题，近年来已成为各大课题组逐渐涉足的领域。作为单细胞家族的基石，这两年更新了很多关于单细胞转录组的分析工具和算法，也将发文章的level从之前的景观提高到了越来越丰富的以解决临床问题为主要导向的<span>下游</span><span>分析</span>。今后的一段时间，小王子将围绕如何从单细胞出发讲好一个生物学故事聚焦单细胞的下游分析，感兴趣的小伙伴可以锁定医学僧。今天，让我们一起学习下单细胞转录组分析之细胞通讯。</section><section powered-by="xiumi.us"><section><img data-backh="734" data-backw="578" data-ratio="1.2697917" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVx2v2iadu768SIP70sdd3cguGwLmSoQkic9m2tNw2IzoicBaPbZFic174PKg/640?wx_fmt=jpeg" data-type="jpeg" data-w="960" src="https://mmbiz.qpic.cn/mmbiz_jpg/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVx2v2iadu768SIP70sdd3cguGwLmSoQkic9m2tNw2IzoicBaPbZFic174PKg/640?wx_fmt=jpeg"></section></section><section><iframe data-vidtype="2" data-mpvid="wxv_2448987238412648450" data-cover="http%3A%2F%2Fmmbiz.qpic.cn%2Fmmbiz_jpg%2FeBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVxKSXmxjPJ1hlMBdPFfVMpdutesxiboxefhLEcDBUt2wtV4HGAJsTV70A%2F0%3Fwx_fmt%3Djpeg" allowfullscreen="" frameborder="0" data-ratio="2" data-w="2160" data-src="https://mp.weixin.qq.com/mp/readtemplate?t=pages/video_player_tmpl&amp;action=mpvideo&amp;auto=0&amp;vid=wxv_2448987238412648450"></iframe></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section></section></section></section></section><section><section powered-by="xiumi.us"><section><p><strong>1.什么是细胞通讯？</strong></p></section></section></section></section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section powered-by="xiumi.us"><section> 大家可以回忆下我们在《细胞生物学》中学到的概念：细胞通讯即体内一部分细胞发出信号，靶细胞接收信号并将其转变为细胞功能变化的过程。细胞有三种主要的通讯方式:</section><section><span>①.细胞通过分泌化学信号进行细胞间通讯:内分泌、旁分泌、自分泌等；</span></section><section>②.细胞间接触依赖性通讯：细胞间直接接触，信号分子与受体等;</section><section>③.间隙连接实现代谢偶联或电偶联。</section><section>单细胞分析主要通过不同细胞间受体-配体的表达进行细胞通讯分析：常见的工具有<strong>celltalker</strong>、<strong>iTALK</strong>、<strong>CellChat</strong> 、<strong>CellPhoneDB</strong>、和SingleCellSignalR等。</section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section></section></section></section></section><section><section powered-by="xiumi.us"><section><p><strong>2.文献中怎么用细胞通讯？</strong></p></section></section></section></section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><p powered-by="xiumi.us"><strong>1.一篇20年的揭示肾透明细胞癌瘤内异质性的文章：</strong></p><section powered-by="xiumi.us"><section><img data-ratio="0.2546296" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVxfkEwDkMWDzYhpgmpx4WtlCjucEOk6zhzNwKyF2VnsVCe7xZPUUYP2w/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVxfkEwDkMWDzYhpgmpx4WtlCjucEOk6zhzNwKyF2VnsVCe7xZPUUYP2w/640?wx_fmt=png"></section></section><section powered-by="xiumi.us"><section><img data-backh="207" data-backw="578" data-ratio="0.3574074" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVx5t3IjJamsQEnib0gnbVlQvLwTIYeMvGeUhgc1APZ3Jbjmu5GFMNwKKg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVx5t3IjJamsQEnib0gnbVlQvLwTIYeMvGeUhgc1APZ3Jbjmu5GFMNwKKg/640?wx_fmt=png"></section></section><section><span>在细胞注释完成后，作者用CellPhoneDB（基于pathon的工具，适用物种是人，可网页工具可代码）进行了不同亚群之间的细胞通讯，发现巨噬细胞亚群在ccRCC中发挥重要作用，随机进行了巨噬细胞亚群的再分群和进一步分析。</span></section><p powered-by="xiumi.us"><strong>2.一篇22年的阐释肢端黑色素瘤（黑色素瘤中免疫治疗比较差）的单细胞特征：</strong></p><section powered-by="xiumi.us"><section><img data-backh="167" data-backw="578" data-ratio="0.2898148" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVxmy57hicvu5ibeWSWRxHNXz3lPEHJjRnWd7U79XmbYtR91jE9mzsPX5aQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVxmy57hicvu5ibeWSWRxHNXz3lPEHJjRnWd7U79XmbYtR91jE9mzsPX5aQ/640?wx_fmt=png"></section></section><section powered-by="xiumi.us"><section><img data-backh="317" data-backw="578" data-ratio="0.5490741" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVx6FMywUibvUlSSNOkylgGE9FPwYTyD6oPUpEnxWwCaGMPHnMYwTFLmVw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVx6FMywUibvUlSSNOkylgGE9FPwYTyD6oPUpEnxWwCaGMPHnMYwTFLmVw/640?wx_fmt=png"></section></section><section>在完成细胞注释后，其对自测的肢端黑色素瘤样本和对照组进行了免疫相关分子的细胞通讯分析，发现与肢端黑色素瘤（免疫治疗不好）相比，其他类型黑色素瘤在免疫相关的通讯上显著富集，这就部分解释了其免疫治疗不好的原因。</section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section></section></section></section></section><section><section powered-by="xiumi.us"><section><p><strong>3.该如何进行细胞通讯？</strong></p></section></section></section></section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section>由于篇幅有限，这里着重给大家介绍3种细胞通讯实现方法，其他的小王子这里也给大家介绍几个比较实用的学习资料贴，需要的小伙伴可以自取。</section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section></section></section></section></section></section></section><section><section powered-by="xiumi.us"><section><p><strong>1.celltalker</strong></p></section></section></section></section></section></section><section powered-by="xiumi.us"><section>celltalker比较简单，官方教程链接如下：https://arc85.github.io/celltalker/articles/celltalker.html，代码实战如下：</section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="properties"><code><span><span>#1.celltalker-----------------------------------------------------------------------</span></span></code><code><span><span>#library(devtools)</span></span></code><code><span><span>#install_github("arc85/celltalker")</span></span></code><code><span><span>#devtools::install_github('satijalab/seurat-data')</span></span></code><code><span><span>suppressMessages({</span></span></code><code><span>  <span>library(celltalker)</span></span></code><code><span>  <span>library(Seurat)</span></span></code><code><span>  <span>suppressWarnings(</span></span></code><code><span>  <span>library(SeuratData))</span></span></code><code><span>  <span>library(dplyr)</span></span></code><code><span>  <span>library(magrittr)</span></span></code><code><span><span>})</span></span></code><code><span><br></span></code><code><span><span>data("hcabm40k")</span></span></code><code><span><span>#使用HCA数据库中的SeuratData(Bone Marrow)</span></span></code><code><span><span>#官方提供的代码这里好像运行不下来，解决办法就是下载rda文件load</span></span></code><code><span><span>#http://seurat.nygenome.org/src/contrib/hcabm40k.SeuratData_3.0.0.tar.gz</span></span></code><code><span><span>#这里下载解压缩即可</span></span></code><code><span><span>load('hcabm40k.rda')</span></span></code><code><span><span>hca_bm</span> <span>&lt;- hcabm40k[,rownames(hca_bm_umap_cell_types)]</span></span></code><code><span><span>#数据库中hcabm40k有40000个细胞，但只有33839个细胞有亚群注释信息，提取一下</span></span></code><code><span><span>hca_bm[["cell_types"]]</span> <span>&lt;- hca_bm_umap_cell_types$cell_types</span></span></code><code><span><br></span></code><code><span><span>#Process data</span></span></code><code><span><span>hca_bm</span> <span>&lt;- NormalizeData(hca_bm)</span></span></code><code><span><br></span></code><code><span><span>#Add UMAP coordinates</span></span></code><code><span><span>hca_bm[["umap"]]</span> <span>&lt;- CreateDimReducObject(embeddings=as.matrix(hca_bm_umap_cell_types[,1:2]),</span></span></code><code><span>                                         <span>key</span>=<span>"UMAP_",assay="RNA")</span></span></code><code><span><span>#View cell types</span></span></code><code><span><span>DimPlot(hca_bm,group.by</span>=<span>"cell_types")</span></span></code><code><span><br></span></code><code><span><span>##Run celltalker</span></span></code><code><span><span>hca_bm_interactions</span> <span>&lt;- celltalk(input_object=hca_bm,</span></span></code><code><span>                                <span>metadata_grouping</span>=<span>"cell_types",</span></span></code><code><span>                                <span>ligand_receptor_pairs</span>=<span>ramilowski_pairs,</span></span></code><code><span>                                <span>number_cells_required</span>=<span>100,</span></span></code><code><span>                                <span>min_expression</span>=<span>1000,</span></span></code><code><span>                                <span>max_expression</span>=<span>20000,</span></span></code><code><span>                                <span>scramble_times</span>=<span>10)</span></span></code><code><span><br></span></code><code><span><span>##统计分析确定最重要的细胞通讯</span></span></code><code><span><span>top_stats</span> <span>&lt;- hca_bm_interactions %&gt;%</span></span></code><code><span>  <span>mutate(fdr</span>=<span>p.adjust(p_val,method="fdr")) %&gt;%</span></span></code><code><span>  <span>filter(fdr&lt;0.05)</span> <span>%&gt;%</span></span></code><code><span>  <span>group_by(cell_type1)</span> <span>%&gt;%</span></span></code><code><span>  <span>top_n(3,interact_ratio)</span> <span>%&gt;%</span></span></code><code><span><span>  ungroup()</span></span></code><code><span><span> </span></span></code><code><span><span>## Generate a circos plot</span></span></code><code><span><span>colors_use</span> <span>&lt;- RColorBrewer::brewer.pal(n=length(unique(hca_bm$cell_types)),"Set2")</span></span></code><code><span><span>circos_plot(ligand_receptor_frame</span>=<span>top_stats,</span></span></code><code><span>            <span>cell_group_colors</span>=<span>colors_use,</span></span></code><code><span>            <span>ligand_color</span>=<span>"blue",</span></span></code><code><span>            <span>receptor_color</span>=<span>"red",</span></span></code><code><span>            <span>cex_outer</span>=<span>0.5,</span></span></code><code><span>            <span>cex_inner</span>=<span>0.4)</span></span></code></pre></section></section><p powered-by="xiumi.us"><strong>示例结果展示：</strong></p><section powered-by="xiumi.us"><section><img data-backh="262" data-backw="578" data-ratio="0.4527778" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVx7xK7ZyQU8EmA2e7gXDxqu9JpBLXGj43OcP2yynppIjtprA8bECQHWg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVx7xK7ZyQU8EmA2e7gXDxqu9JpBLXGj43OcP2yynppIjtprA8bECQHWg/640?wx_fmt=png"></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section></section></section></section></section></section></section><section><section powered-by="xiumi.us"><section><p><strong>2.iTALK</strong></p></section></section></section></section></section></section><section powered-by="xiumi.us"><section>关于iTALK，这篇帖子介绍的比较好：细胞通讯-iTALK使用方法 - 云+社区 - 腾讯云https://cloud.tencent.com/developer/article/1654784，输入文件主要为行为细胞，列为基因的矩阵文件，主要代码如下：</section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="ruby"><code><span><span>#2.iTALK(参考单细胞天地：细胞通讯-iTALK使用方法)-----------------------------------------------------------------------</span></span></code><code><span><span>#if(!require(devtools)) install.packages("devtools");</span></span></code><code><span><span>#devtools::install_github("Coolgenome/iTALK", build_vignettes = TRUE)</span></span></code><code><span>rm(list = ls())</span></code><code><span>library(iTALK)</span></code><code><span>library(Seurat)</span></code><code><span>library(Matrix)</span></code><code><span>library(dplyr)</span></code><code><span><br></span></code><code><span>sdata &lt;- readRDS(file = <span>"iTALK/Seurat.rds"</span>)</span></code><code><span>iTalk_data &lt;- as.data.frame(t(sdata@assays$RNA@counts))</span></code><code><span><span>#提取iTALK要求的矩阵: 行为细胞，列为基因</span></span></code><code><span><br></span></code><code><span>iTalk_data$cell_type &lt;- sdata@meta.data$seurat_cluster</span></code><code><span>iTalk_data$compare_group &lt;- sdata@meta.data$Group</span></code><code><span><span>#按iTALK要求，添加矩阵中添加cell_type列和compare_group列（多样本）</span></span></code><code><span>unique(iTalk_data$cell_type)</span></code><code><span>unique(iTalk_data$compare_group)</span></code><code><span><br></span></code><code><span>library(ggsci)</span></code><code><span>mycolors &lt;- pal_nejm()(<span>8</span>)</span></code><code><span>highly_exprs_genes &lt;- rawParse(iTalk_data, top_genes=<span>50</span>, stats=<span>"mean"</span>)</span></code><code><span><span>#这一步对电脑要求还挺高，我跑hcabm40k数据集内存不够</span></span></code><code><span><span>#通讯类型</span></span></code><code><span>comm_list&lt;-c(<span>'checkpoint'</span>,<span>'cytokine'</span>,<span>'growth factor'</span>,<span>'other'</span>)</span></code><code><span>cell_types &lt;- unique(iTalk_data$cell_type)</span></code><code><span>cell_col &lt;- structure(mycolors[<span>1</span><span>:length</span>(cell_types)], names=cell_types)</span></code><code><span><br></span></code><code><span>iTalk_res &lt;- NULL</span></code><code><span><span>for</span>(comm_type <span>in</span> comm_list){</span></code><code><span>  res_cat &lt;- FindLR(highly_exprs_genes, datatype=<span>'mean count'</span>, comm_type=comm_type)</span></code><code><span>  iTalk_res &lt;- rbind(iTalk_res, res_cat)</span></code><code><span>}</span></code><code><span><br></span></code><code><span>iTalk_res &lt;- iTalk_res[order(iTalk_res$cell_from_mean_exprs*iTalk_res$cell_to_mean_exprs,decreasing=T),][<span>1</span><span>:</span><span>20</span>,]</span></code><code><span><br></span></code><code><span>NetView(iTalk_res,col=cell_col,vertex.label.cex=<span>1</span>,arrow.width=<span>1</span>,edge.max.width=<span>5</span>)</span></code><code><span>unique(iTalk_res$cell_from)</span></code><code><span><br></span></code><code><span>gc()</span></code><code><span>LRPlot(iTalk_res[<span>1</span><span>:</span><span>20</span>,],datatype=<span>'mean count'</span>,cell_col=cell_col,link.arr.lwd=iTalk_res$cell_from_mean_exprs[<span>1</span><span>:</span><span>20</span>],link.arr.width=iTalk_res$cell_to_mean_exprs[<span>1</span><span>:</span><span>20</span>])</span></code></pre></section><p><strong>示例结果展示：</strong></p></section><section powered-by="xiumi.us"><section><img data-backh="314" data-backw="578" data-ratio="0.5435185" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVx6VndAm6SHq4RWuUvGMX6ViabceWrecfKiaz95DQNS9kTWRudP5e7MAZg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVx6VndAm6SHq4RWuUvGMX6ViabceWrecfKiaz95DQNS9kTWRudP5e7MAZg/640?wx_fmt=png"></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section></section></section></section></section></section></section><section><section powered-by="xiumi.us"><section><p><strong>3.CellChat</strong></p></section></section></section></section></section></section><section powered-by="xiumi.us"><section>CellChat能画的图比较多，大家可以主要参考：CellChat：细胞间相互作用分析利器 - 简书https://www.jianshu.com/p/da145cff3d41 和单细胞分析之细胞交互-3：CellChat - 简书 http://events.jianshu.io/p/b3d26ac51c5a。主要代码如下：</section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><span>#3.CellChat(参考简书：CellChat：细胞间相互作用分析利器)-----------------------------------------------------------------------</span></span></code><code><span><span>#devtools::install_github("sqjin/CellChat")</span></span></code><code><span>rm(<span>list</span> = ls())</span></code><code><span>library(CellChat)</span></code><code><span>library(ggplot2)</span></code><code><span>library(ggalluvial)</span></code><code><span>library(svglite)</span></code><code><span>library(Seurat)</span></code><code><span>options(stringsAsFactors = <span>FALSE</span>)</span></code><code><span>library(SeuratData)</span></code><code><span><br></span></code><code><span>InstallData(<span>"pbmc3k"</span>)</span></code><code><span><span>##不稳定，解决办法就是下载rda文件load出来</span></span></code><code><span><span>#http://seurat.nygenome.org/src/contrib/pbmc3k.SeuratData_3.0.0.tar.gz</span></span></code><code><span>load(<span>'pbmc3k.final.rda'</span>)</span></code><code><span>data.input  &lt;- pbmc3k.<span>final</span>@assays$RNA@data</span></code><code><span>identity = data.frame(group =pbmc3k.<span>final</span>$seurat_annotations, row.names = names(pbmc3k.<span>final</span>$seurat_annotations)) <span># create a dataframe consisting of the cell labels</span></span></code><code><span>unique(identity$group) <span># check the cell labels</span></span></code><code><span><br></span></code><code><span>cellchat &lt;- createCellChat(object = data.input)<span>#data=data.input需要修改</span></span></code><code><span>cellchat &lt;- addMeta(cellchat, meta = identity, meta.name = <span>"labels"</span>)</span></code><code><span>cellchat &lt;- setIdent(cellchat, ident.<span>use</span> = <span>"labels"</span>) <span># set "labels" as default cell identity</span></span></code><code><span><br></span></code><code><span>groupSize &lt;- <span>as</span>.numeric(table(cellchat@idents)) <span># number of cells in each cell group</span></span></code><code><span>CellChatDB &lt;- CellChatDB.human <span>#打开看一看</span></span></code><code><span><br></span></code><code><span>CellChatDB.<span>use</span> &lt;- subsetDB(CellChatDB, search = <span>"Secreted Signaling"</span>) <span># use Secreted Signaling for cell-cell communication analysis</span></span></code><code><span>cellchat@DB &lt;- CellChatDB.<span>use</span> <span># set the used database in the object</span></span></code><code><span><br></span></code><code><span>unique(CellChatDB$interaction$annotation)</span></code><code><span><span>#"Secreted Signaling" "ECM-Receptor"       "Cell-Cell Contact" </span></span></code><code><span><br></span></code><code><span>cellchat &lt;- subsetData(cellchat) <span># subset the expression data of signaling genes for saving computation cost</span></span></code><code><span>future::plan(<span>"multiprocess"</span>, workers = <span>4</span>)</span></code><code><span>cellchat &lt;- identifyOverExpressedGenes(cellchat)</span></code><code><span>cellchat &lt;- identifyOverExpressedInteractions(cellchat)</span></code><code><span>cellchat &lt;- projectData(cellchat, PPI.human)  </span></code><code><span><br></span></code><code><span>cellchat &lt;- computeCommunProb(cellchat,raw.<span>use</span> = F,population.size = T)</span></code><code><span>cellchat &lt;- filterCommunication(cellchat,min.cells = <span>10</span>)</span></code><code><span><span>#过滤掉细胞数少于10个的通讯</span></span></code><code><span><br></span></code><code><span>df.net &lt;- subsetCommunication(cellchat)</span></code><code><span>cellchat &lt;- computeCommunProbPathway(cellchat)</span></code><code><span>df.netp &lt;- subsetCommunication(cellchat,slot.name = <span>"netP"</span>)</span></code><code><span><br></span></code><code><span><span>#统计细胞和细胞之间通讯的数量（有多少受体配体对）和强度（概率）</span></span></code><code><span>cellchat &lt;- aggregateNet(cellchat)</span></code><code><span>groupSize<span>#各种细胞有多少个</span></span></code><code><span>par(mfrow = c(<span>1</span>,<span>2</span>), xpd=T)</span></code><code><span>netVisual_circle(cellchat@net$count,vertex.weight = groupSize,weight.scale = T,</span></code><code><span>                 label.edge = F,title.name = <span>"Number of interactions"</span>)</span></code><code><span>netVisual_circle(cellchat@net$weight,vertex.weight = groupSize,weight.scale = T,</span></code><code><span>                 label.edge = F,title.name = <span>"Interaction weights/strength"</span>)</span></code><code><span><br></span></code><code><span><span>#单个信号通路</span></span></code><code><span>cellchat@netP$pathways</span></code><code><span>netVisual_aggregate(cellchat, signaling = c(<span>"BTLA"</span>), layout = <span>"circle"</span>, vertex.size = groupSize)</span></code><code><span><br></span></code><code><span><span>#全部受体配体相互作用的气泡图</span></span></code><code><span>levels(cellchat@idents)</span></code><code><span>netVisual_bubble(cellchat,sources.<span>use</span> = c(<span>3</span>,<span>5</span>,<span>7</span>,<span>8</span>,<span>9</span>),</span></code><code><span>                   targets.<span>use</span> = c(<span>1</span>,<span>2</span>,<span>4</span>,<span>6</span>),remove.isolate = F)</span></code><code><span><br></span></code><code><span><span>#特定信号通路的气泡图</span></span></code><code><span>netVisual_bubble(cellchat,sources.<span>use</span> = c(<span>3</span>,<span>5</span>,<span>7</span>,<span>8</span>,<span>9</span>),</span></code><code><span>                 targets.<span>use</span> = c(<span>1</span>,<span>2</span>,<span>4</span>,<span>6</span>),signaling = c(<span>"CCL"</span>,<span>"CXCL"</span>),remove.isolate = F)</span></code><code><span><span>#其他的，比如通讯网络中的角色识别（发送者、接收者、调节者、影响者）</span></span></code><code><span>library(patchwork)</span></code><code><span>cellchat &lt;- netAnalysis_computeCentrality(cellchat, slot.name = <span>"netP"</span>)</span></code><code><span><span>#计算网络中心性权重</span></span></code><code><span>netAnalysis_signalingRole_network(cellchat,signaling = c(<span>"BTLA"</span>),width = <span>12</span>,</span></code><code><span>                                  height = <span>5</span>,font.size = <span>10</span>)</span></code><code><span><br></span></code><code><span><span>#更多内容可以参考单细胞分析之细胞交互-3：CellChat - 简书http://events.jianshu.io/p/b3d26ac51c5a</span></span></code><code><span><span>#和CellChat：细胞间相互作用分析利器 - 简书 https://www.jianshu.com/p/da145cff3d41</span></span></code></pre></section><p>示例结果展示：</p></section><section powered-by="xiumi.us"><section><img data-backh="316" data-backw="578" data-ratio="0.5462963" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVxmpFVeJntoIQYLP21jKm7iblPKLthdGbop5Lz2Qp0uBcmdOsFORdBMIA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVxmpFVeJntoIQYLP21jKm7iblPKLthdGbop5Lz2Qp0uBcmdOsFORdBMIA/640?wx_fmt=png"></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section></section></section></section></section></section></section><section><section powered-by="xiumi.us"><section><p><strong>4.CellPhoneDB</strong></p></section></section></section></section></section></section><section powered-by="xiumi.us"><section>CellPhoneDB也是比较常见的细胞通讯工具，但其基于pathon，需要提前安装pathon包，由于篇幅限制这里不作为主要展示，感兴趣的同学可以参考以下帖子自学：单细胞分析之细胞交互-1：CellphoneDB - 简书 http://events.jianshu.io/p/38a9376f5286 或细胞间通讯教程|| cellphonedb 及其可视化 - 简书 https://www.jianshu.com/p/f196c98e0954。</section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section></section></section></section></section></section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section><section><section powered-by="xiumi.us"><section><p><strong>小结</strong></p></section></section></section></section><section>总的来说，单细胞转录组的细胞通讯作为下游分析的一部分并不是十分晦涩难懂，基于配体-受体的表达量很容易通过R实现，网上也有很多非常简单易行的经验分享贴，本文更多的是想让大家了解什么是单细胞转录组的细胞通讯，什么情况下可以用到细胞通讯，至于如何实现，由小王子指路，希望大家事半功倍，学有所得！</section><section><strong></strong></section><section><strong></strong></section><section><strong></strong></section><section><strong>本文主要参考：<br></strong></section><section><span>1.腾讯云-单细胞天地：细胞通讯-iTALK使用方法</span></section><section><span>2.简书-</span><span>CellChat：细胞间相互作用分析利器</span></section><section><span>3.简书-</span><span>单细胞分析之细胞交互-3：CellChat</span></section></section><section><section><strong><br></strong></section><section><strong>PS:我们在B站的同名账号“医学僧的科研日记”同步有公众号的讲解视频~目前已有6w余粉丝，感兴趣的小伙伴可以多多支持幺。</strong></section><p><img data-backh="578" data-backw="578" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVxIica6byjbhx3ISY71ME1VWzweAxm8yHfbcefS8zEE6KcEFQID89xIfg/640?wx_fmt=jpeg" data-type="jpeg" data-w="960" src="https://mmbiz.qpic.cn/mmbiz_jpg/eBfvI7Ryx8fZicgruYlDjDs3dfnWQJPVxIica6byjbhx3ISY71ME1VWzweAxm8yHfbcefS8zEE6KcEFQID89xIfg/640?wx_fmt=jpeg"></p><section><span>医学僧的心</span><span>愿是为医学僧的支持者和科研</span><span>爱好者营造一个勤学好问、互帮互助、共同进步的优良环境。</span><span>但是人多了难免鱼龙混杂，良莠不齐，群里不乏有真心实意、脚踏实地的科研人，我们很尊重并欢迎他们，因此不希望被少数来发广告的、划水的、看热闹的、占个坑的所打扰，最终我们的心意付之东流，大家的热情消磨殆尽。</span><span>为了解决这个问题，我们决定提高入群的门槛——</span><strong>收费进群，</strong><span>这样，愿意进群的同志相信也是个圈内活跃用户，圈内人相互交流，岂不快哉！</span></section><section powered-by="xiumi.us"><section>因此，为了提升大家的效率，调动大家的积极性，吸收真正的科研爱好者，形成一个良好的学习交流氛围，我们决定增加群的数量，并细化群的功能，暂时增加以下几个主题群：</section><ul><li><p>文献下载-医学僧</p></li><li><p>机器学习（分类）-医学僧</p></li><li><p>ggplot可视化-医学僧</p></li><li><p>热图可视化-医学僧</p></li><li><p>TCGA挖掘-医学僧</p></li><li><p>GEO挖掘-医学僧</p></li><li><p>肿瘤预后模型-医学僧</p></li><li><p>肿瘤分子亚型-医学僧</p></li></ul><p>欢迎小伙伴们进群👏👏👏，每个群收费<strong>15元</strong>。请联系小编微信yixuesengkyrj或扫描下面二维码：</p></section><section powered-by="xiumi.us"><section><img data-backh="486" data-backw="578" data-cropselx1="0" data-cropselx2="578" data-cropsely1="0" data-cropsely2="343" data-ratio="0.8407407407407408" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/eBfvI7Ryx8enibib3UJd6iaLibROb1ibWJtZn0fyA9Bu9szdIkibpzWVzjw0LIVrQKeHfPS7h1gI8bicaaYlcOnMIyQAQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/eBfvI7Ryx8enibib3UJd6iaLibROb1ibWJtZn0fyA9Bu9szdIkibpzWVzjw0LIVrQKeHfPS7h1gI8bicaaYlcOnMIyQAQ/640?wx_fmt=jpeg"></section></section></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/nMSVLDvqiLzDu4GH_-DjGw",target="_blank" rel="noopener noreferrer">原文链接</a>
