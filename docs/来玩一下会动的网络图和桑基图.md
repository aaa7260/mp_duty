---
title: "来玩一下会动的网络图和桑基图"
date: 2023-01-06T03:22:08Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
来玩一下会动的网络图和桑基图 by 生信星球
------
<div><p><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png"><span> 今天是生信星球陪你的<span><strong>第722天</strong></span></span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"></p><hr><p><span><span>   </span><span>大神一句话，菜鸟跑半年。我不是大神，但我可以缩短你走弯路的半年~</span></span></p><p><span>   就像歌儿唱的那样，如果你不知道该往哪儿走，就留在这学点生信好不好~</span></p><p><span>   这里有豆豆和花花的学习历程，从新手到进阶，生信路上有你有我!</span></p><section><blockquote><p>画图的内容，大家喜闻乐见，阅读量仅次于狗粮和故事。所以。。。我在没东西写的时候就写点画图的东西了，输出倒逼输入~</p><p>上次写的：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247489036&amp;idx=1&amp;sn=471ac7b1a139c521feeab038b9ecfc9c&amp;chksm=fdf85e4eca8fd758bed99c345b5fde870151c0576a8170adab8f5815e826312a3a92bdea4b46&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">弦图，气质出来点儿了没？</a>和这次的桑基图有点类似，都是在表达两边之间的对应关系，经常出现。</p></blockquote><h4><span>1.R包</span></h4><pre><code><span>1</span><span>library</span>(tidyverse)<br><span>2</span><span>library</span>(navdata)<br><span>3</span><span>library</span>(networkD3)<br></code></pre><h4><span>2.示例数据集</span></h4><pre><code><span>1</span>data(<span>"phone.call2"</span>)<br><span>2</span>nodes &lt;- phone.call2$nodes;head(nodes)<br></code></pre><pre><code><span>1</span><span>#</span><span><span># # A tibble: 6 x 2</span></span><br><span>2</span><span>#</span><span><span>#      id label   </span></span><br><span>3</span><span>#</span><span><span>#   &lt;int&gt; &lt;chr&gt;   </span></span><br><span>4</span><span>#</span><span><span># 1     1 France  </span></span><br><span>5</span><span>#</span><span><span># 2     2 Belgium </span></span><br><span>6</span><span>#</span><span><span># 3     3 Germany </span></span><br><span>7</span><span>#</span><span><span># 4     4 Danemark</span></span><br><span>8</span><span>#</span><span><span># 5     5 Croatia </span></span><br><span>9</span><span>#</span><span><span># 6     6 Slovenia</span></span><br></code></pre><pre><code><span>1</span>edges &lt;- phone.call2$edges;head(edges)<br></code></pre><pre><code><span>1</span><span>#</span><span><span># # A tibble: 6 x 3</span></span><br><span>2</span><span>#</span><span><span>#    from    to weight</span></span><br><span>3</span><span>#</span><span><span>#   &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;</span></span><br><span>4</span><span>#</span><span><span># 1     1     3      9</span></span><br><span>5</span><span>#</span><span><span># 2     2     1      4</span></span><br><span>6</span><span>#</span><span><span># 3     1     8      3</span></span><br><span>7</span><span>#</span><span><span># 4     1     9      4</span></span><br><span>8</span><span>#</span><span><span># 5     1    10      2</span></span><br><span>9</span><span>#</span><span><span># 6     1    11      3</span></span><br></code></pre><h4><span>3.交互式网络图</span></h4><p>使用networkD3 包里的forceNetwork函数。有一个比较严格的要求，就是节点必须要设置id，并且从0开始，不设置就报错，不堪吐槽哇。</p><pre><code><span>1</span>nodes_d3 &lt;- mutate(nodes, id = id - <span>1</span>);head(nodes_d3)<br></code></pre><pre><code><span>1</span><span>#</span><span><span># # A tibble: 6 x 2</span></span><br><span>2</span><span>#</span><span><span>#      id label   </span></span><br><span>3</span><span>#</span><span><span>#   &lt;dbl&gt; &lt;chr&gt;   </span></span><br><span>4</span><span>#</span><span><span># 1     0 France  </span></span><br><span>5</span><span>#</span><span><span># 2     1 Belgium </span></span><br><span>6</span><span>#</span><span><span># 3     2 Germany </span></span><br><span>7</span><span>#</span><span><span># 4     3 Danemark</span></span><br><span>8</span><span>#</span><span><span># 5     4 Croatia </span></span><br><span>9</span><span>#</span><span><span># 6     5 Slovenia</span></span><br></code></pre><pre><code><span>1</span>edges_d3 &lt;- mutate(edges, from = from - <span>1</span>, to = to - <span>1</span>);head(edges_d3)<br></code></pre><pre><code><span>1</span><span>#</span><span><span># # A tibble: 6 x 3</span></span><br><span>2</span><span>#</span><span><span>#    from    to weight</span></span><br><span>3</span><span>#</span><span><span>#   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span><br><span>4</span><span>#</span><span><span># 1     0     2      9</span></span><br><span>5</span><span>#</span><span><span># 2     1     0      4</span></span><br><span>6</span><span>#</span><span><span># 3     0     7      3</span></span><br><span>7</span><span>#</span><span><span># 4     0     8      4</span></span><br><span>8</span><span>#</span><span><span># 5     0     9      2</span></span><br><span>9</span><span>#</span><span><span># 6     0    10      3</span></span><br></code></pre><p>输入数据整対格式，出图就很简单，而且还是会动的~下面的桑基图也是可以交互的，我就直接截图不录屏了~</p><pre><code><span>1</span>forceNetwork(<br><span>2</span>  Links = edges_d3, Nodes = nodes_d3,  <br><span>3</span>  Source = <span>"from"</span>, Target = <span>"to"</span>,      <span># so the network is directed.</span><br><span>4</span>  NodeID = <span>"label"</span>, Group = <span>"id"</span>, Value = <span>"weight"</span>, <br><span>5</span>  opacity = <span>1</span>, fontSize = <span>16</span>, zoom = <span>TRUE</span><br><span>6</span>  )<br></code></pre><figure><img data-ratio="0.6561461794019934" data-src="https://mmbiz.qpic.cn/mmbiz_gif/8oKPbJgbBHpq2rXESr5I7AtcKibiaFzpKxgoErFnJ9iaCLLOtFn7kibx9gRxibwGKMv6KXstw7bDIIlRKeZfQ0suZQQ/640?wx_fmt=gif" data-type="gif" data-w="602" title="" src="https://mmbiz.qpic.cn/mmbiz_gif/8oKPbJgbBHpq2rXESr5I7AtcKibiaFzpKxgoErFnJ9iaCLLOtFn7kibx9gRxibwGKMv6KXstw7bDIIlRKeZfQ0suZQQ/640?wx_fmt=gif"></figure><h4><span>4.桑基图</span></h4><pre><code><span>1</span>sankeyNetwork(<br><span>2</span>  Links = edges_d3, Nodes = nodes_d3, <br><span>3</span>  Source = <span>"from"</span>, Target = <span>"to"</span>, <br><span>4</span>  NodeID = <span>"label"</span>, Value = <span>"weight"</span>,<br><span>5</span>  fontSize = <span>16</span>, unit = <span>"Letter(s)"</span>)<br></code></pre><figure><img data-ratio="0.7213930348258707" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpq2rXESr5I7AtcKibiaFzpKxWdzRcdLSxRfmdzGxLSiajvxEe9RLWjucrtpaKBzzw8QqgyZcyYK14qQ/640?wx_fmt=png" data-type="png" data-w="603" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpq2rXESr5I7AtcKibiaFzpKxWdzRcdLSxRfmdzGxLSiajvxEe9RLWjucrtpaKBzzw8QqgyZcyYK14qQ/640?wx_fmt=png"></figure><p>可以给连线加上颜色</p><pre><code><span>1</span>edges_d3$edgegroup = as.character(edges_d3$from)<br><span>2</span>sankeyNetwork(<br><span>3</span>  Links = edges_d3, Nodes = nodes_d3, <br><span>4</span>  Source = <span>"from"</span>, Target = <span>"to"</span>, <br><span>5</span>  NodeID = <span>"label"</span>, Value = <span>"weight"</span>,<br><span>6</span>  LinkGroup = <span>"edgegroup"</span>,<br><span>7</span>  fontSize = <span>16</span>, unit = <span>"Letter(s)"</span>)<br></code></pre><figure><img data-ratio="0.6702290076335878" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpq2rXESr5I7AtcKibiaFzpKxTtj7RicNNX7TSAHlnaNaQ5rsSK6gNfIc8TSWGs9L3ST6yDakkG5FOfQ/640?wx_fmt=png" data-type="png" data-w="655" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpq2rXESr5I7AtcKibiaFzpKxTtj7RicNNX7TSAHlnaNaQ5rsSK6gNfIc8TSWGs9L3ST6yDakkG5FOfQ/640?wx_fmt=png"></figure><h4><span>5.换个数据试试看</span></h4><pre><code><span>1</span>mat = sample(<span>0</span>:<span>5</span>,<span>27</span>,replace = <span>T</span>)<br><span>2</span>mat = matrix(mat,nrow = <span>3</span>)<br><span>3</span>rownames(mat) = paste0(<span>"S"</span>,<span>1</span>:nrow(mat))<br><span>4</span>colnames(mat) = paste0(<span>"T"</span>,<span>1</span>:ncol(mat))<br><span>5</span>mat<br></code></pre><pre><code><span>1</span><span>#</span><span><span>#    T1 T2 T3 T4 T5 T6 T7 T8 T9</span></span><br><span>2</span><span>#</span><span><span># S1  3  4  5  2  2  3  3  0  3</span></span><br><span>3</span><span>#</span><span><span># S2  3  2  4  3  1  0  0  0  5</span></span><br><span>4</span><span>#</span><span><span># S3  1  3  5  2  1  3  2  2  1</span></span><br></code></pre><pre><code><span>1</span>df &lt;- gather(rownames_to_column(as.data.frame(mat),var = <span>"from"</span>),<br><span>2</span>             key = <span>"to"</span>,<br><span>3</span>             value = <span>"value"</span>,<br><span>4</span>             - from);head(df)<br></code></pre><pre><code><span>1</span><span>#</span><span><span>#   from to value</span></span><br><span>2</span><span>#</span><span><span># 1   S1 T1     3</span></span><br><span>3</span><span>#</span><span><span># 2   S2 T1     3</span></span><br><span>4</span><span>#</span><span><span># 3   S3 T1     1</span></span><br><span>5</span><span>#</span><span><span># 4   S1 T2     4</span></span><br><span>6</span><span>#</span><span><span># 5   S2 T2     2</span></span><br><span>7</span><span>#</span><span><span># 6   S3 T2     3</span></span><br></code></pre><pre><code><span>1</span>edges &lt;- filter(df,value!=<span>0</span>)<br><span>2</span><br><span>3</span>x = unique(c(rownames(mat),colnames(mat)));length(x)<br></code></pre><pre><code><span>1</span><span>#</span><span><span># [1] 12</span></span><br></code></pre><pre><code><span>1</span>y = <span>0</span>:(sum(dim(mat))-<span>1</span>);length(y)<br></code></pre><pre><code><span>1</span><span>#</span><span><span># [1] 12</span></span><br></code></pre><pre><code><span>1</span><span>for</span>(i <span>in</span> <span>1</span>:length(y)){<br><span>2</span>  edges$from = str_replace(edges$from,<br><span>3</span>                           x[[i]],<br><span>4</span>                           as.character(y[[i]]))<br><span>5</span>  edges$to = str_replace(edges$to,<br><span>6</span>                           x[[i]],<br><span>7</span>                           as.character(y[[i]]))<br><span>8</span>}<br><span>9</span>str(edges)<br></code></pre><pre><code><span>1</span><span>## 'data.frame':    23 obs. of  3 variables:</span><br><span>2</span><span>##  $ from : chr  <span>"0"</span> <span>"1"</span> <span>"2"</span> <span>"0"</span> ...</span><br><span>3</span><span>##  $ to   : chr  <span>"3"</span> <span>"3"</span> <span>"3"</span> <span>"4"</span> ...</span><br><span>4</span><span>##  $ value: int  3 3 1 4 2 3 5 4 5 2 ...</span><br></code></pre><pre><code><span>1</span>edges &lt;- data.frame(apply(edges,<span>2</span>,as.numeric));head(edges)<br></code></pre><pre><code><span>1</span><span>#</span><span><span>#   from to value</span></span><br><span>2</span><span>#</span><span><span># 1    0  3     3</span></span><br><span>3</span><span>#</span><span><span># 2    1  3     3</span></span><br><span>4</span><span>#</span><span><span># 3    2  3     1</span></span><br><span>5</span><span>#</span><span><span># 4    0  4     4</span></span><br><span>6</span><span>#</span><span><span># 5    1  4     2</span></span><br><span>7</span><span>#</span><span><span># 6    2  4     3</span></span><br></code></pre><pre><code><span>1</span>nodes &lt;- data.frame(id = as.numeric(<span>0</span>:(sum(dim(mat))-<span>1</span>)),<br><span>2</span>                    label = c(rownames(mat),colnames(mat)));head(nodes)<br></code></pre><pre><code><span>1</span><span>#</span><span><span>#   id label</span></span><br><span>2</span><span>#</span><span><span># 1  0    S1</span></span><br><span>3</span><span>#</span><span><span># 2  1    S2</span></span><br><span>4</span><span>#</span><span><span># 3  2    S3</span></span><br><span>5</span><span>#</span><span><span># 4  3    T1</span></span><br><span>6</span><span>#</span><span><span># 5  4    T2</span></span><br><span>7</span><span>#</span><span><span># 6  5    T3</span></span><br></code></pre><p>照葫芦画瓢准备数据，对了就可以出图。</p><pre><code><span>1</span>forceNetwork(<br><span>2</span>  Links = edges, Nodes = nodes,  <br><span>3</span>  Source = <span>"from"</span>, Target = <span>"to"</span>,      <span># so the network is directed.</span><br><span>4</span>  NodeID = <span>"label"</span>, Group = <span>"id"</span>, Value = <span>"value"</span>,<br><span>5</span>  opacity = <span>1</span>, fontSize = <span>16</span>, zoom = <span>TRUE</span><br><span>6</span>)<br></code></pre><p><img data-ratio="0.6561461794019934" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_gif/8oKPbJgbBHpq2rXESr5I7AtcKibiaFzpKxAA4XDUnNibyZX6uIIibAOUPp73NMsrvibc7C1VIflsQxEibotXmqUianteg/640?wx_fmt=gif" data-type="gif" data-w="602" src="https://mmbiz.qpic.cn/mmbiz_gif/8oKPbJgbBHpq2rXESr5I7AtcKibiaFzpKxAA4XDUnNibyZX6uIIibAOUPp73NMsrvibc7C1VIflsQxEibotXmqUianteg/640?wx_fmt=gif"></p><pre><code><span>1</span>edges$edgegroup = as.character(edges$from)<br><span>2</span>sankeyNetwork(<br><span>3</span>  Links = edges, Nodes = nodes, <br><span>4</span>  Source = <span>"from"</span>, Target = <span>"to"</span>, <br><span>5</span>  NodeID = <span>"label"</span>, Value = <span>"value"</span>,<br><span>6</span>  LinkGroup = <span>"edgegroup"</span>,<br><span>7</span>  fontSize = <span>16</span>, unit = <span>"Letter(s)"</span>)<br></code></pre><figure><img data-ratio="0.6149341142020498" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpq2rXESr5I7AtcKibiaFzpKxMkbEricWkV5v5UxVIBZ3KFkfAzy9BTotibZwocBAeWMy5zJzLMwBy9icg/640?wx_fmt=png" data-type="png" data-w="683" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpq2rXESr5I7AtcKibiaFzpKxMkbEricWkV5v5UxVIBZ3KFkfAzy9BTotibZwocBAeWMy5zJzLMwBy9icg/640?wx_fmt=png"></figure></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><section><br></section></section><section><section><section><section><section><blockquote><p><strong>插个小广告！</strong></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247487729&amp;idx=2&amp;sn=c8075ff6c06998a939cc398b486e9ae1&amp;chksm=fdf858b3ca8fd1a5eaefc81fd5c0481b89b84cdc858e9c7e590dfd9301c00f03a2215068fdc0&amp;scene=21#wechat_redirect" textvalue="生信零基础入门学习小组" data-itemshowtype="0" tab="innerlink" data-linktype="2"><strong>生信零基础入门学习小组</strong></a></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247488557&amp;idx=2&amp;sn=6e539809690affbc29fefb8b739af0bc&amp;chksm=fdf85c6fca8fd57985d38ffb097d9852738fb2354b6ff643a6e655fb2034554f9ad80fe49de4&amp;scene=21#wechat_redirect" textvalue="全国巡讲全球听（生信线上直播课）" data-itemshowtype="11" tab="innerlink" data-linktype="2"><strong>全国巡讲全球听</strong><strong>（生信线上直播课，长期开班）</strong></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247488557&amp;idx=1&amp;sn=f9bf511110a3fe6acdb0e65938ef8a35&amp;chksm=fdf85c6fca8fd579ec6a34c99fbba561ba630bf4d84256d46787a8ec89960dc9eaf3c301fc00&amp;scene=21#wechat_redirect" textvalue="数据挖掘线上班第4期（两天变三周，实力加量，长期开班）" data-itemshowtype="11" tab="innerlink" data-linktype="2"><strong>数据挖掘线上班（两天变三周，实力加量，长期开班）</strong></a><br></p><p><strong><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247487032&amp;idx=2&amp;sn=fe2100fb70e84f7b4da00cb744c565a3&amp;chksm=fdf8467aca8fcf6ce40679d990a45c13c6c2b409a826e82be8a3c2db383845eca743553be9a9&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">一起来学单细胞吗？</a></strong></p><p><strong>答疑公告：</strong><strong><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247487050&amp;idx=2&amp;sn=aac649edf53957bb876d466af728311f&amp;chksm=fdf84608ca8fcf1e2571ad8aba6e0c721ef056f48693905b0575549d2228946fff4cb3deff19&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">生信星球答疑公告-2020年全年有效</a></strong></p></blockquote></section></section></section></section></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/r7535rbVT5zaoy9eUErs0Q",target="_blank" rel="noopener noreferrer">原文链接</a>
