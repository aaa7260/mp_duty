---
title: "cowplot优雅的拼接相关性网络热图"
date: 2022-10-24T15:55:59Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
cowplot优雅的拼接相关性网络热图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>最近有朋友问如何绘制组合相关性热图，本节来介绍如何使用<strong>「linkET」</strong>绘制此图；绘图过程倒也简单，但就是图形拼接调整比较麻烦；下面就来仔细写一下绘图过程，<strong>「数据及代码已经上传VIP群，加群的观众老爷请自行下载」</strong>，使用了AI软件进行后续拼图，结果仅供参考</p><span>❞</span></blockquote><blockquote data-tool="mdnice编辑器"><span>❝</span><p><code>有需要学习数据可视化的朋友欢迎加入小编2022年度VIP群</code>，目前群内已经上传公众号文档<strong>「数据+代码约200篇」</strong>，<code>VIP交流群(1)已经500人满员</code>,随着内容不断增多，为了更好的创做内容现在进群需<strong>「付费149元」</strong>,若转发此文档到朋友圈集赞20个可优惠20元，早进早享受；<strong>「一定让你感受到物超所值」</strong></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>个性化绘图服务</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>最近有部分观众老爷找小编做个性化绘图，为了给观众老爷提供更加优质的服务；开通了 <strong>「淘宝店铺(R语言数据分析指南)」</strong> ，有特殊绘图需求的欢迎咨询</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>library(tidyverse)<br>library(linkET)<br>library(RColorBrewer)<br>library(ggtext)<br>library(magrittr)<br>library(reshape)<br>library(psych)<br>library(vegan)<br>library(cowplot)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>data(varechem,package = <span>"vegan"</span>)<br>data(varespec,package = <span>"vegan"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>mantel分析</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>mantel &lt;- mantel_test(varespec, varechem,<br>                      spec_select = list(<span>" "</span>= 1:44)) %&gt;% <br>  mutate(rd = cut(r, breaks = c(-Inf, 0.2, 0.4, Inf),<br>                  labels = c(<span>"&lt; 0.2"</span>, <span>"0.2 - 0.4"</span>, <span>"&gt;= 0.4"</span>)),<br>         pd = cut(p, breaks = c(-Inf, 0.01, 0.05, Inf),<br>                  labels = c(<span>"&lt; 0.01"</span>, <span>"0.01 - 0.05"</span>, <span>"&gt;= 0.05"</span>)))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>p1 &lt;- qcorrplot(correlate(varechem,method = <span>"pearson"</span>),diag=F,<span>type</span>=<span>"lower"</span>)+<br>  geom_tile()+<br>  geom_mark(size=2.5,sig.thres=0.05,sep=<span>"\n"</span>)+<br>  geom_couple(aes(colour=pd,size=rd),data=mantel,label.colour = <span>"black"</span>,<br>              curvature=nice_curvature(0.15),<br>              nudge_x=0.2,<br>              label.fontface=2,<br>              label.size =4,<br>              drop = T)+<br>  scale_fill_gradientn(colours = RColorBrewer::brewer.pal(11,<span>"RdBu"</span>))+<br>  scale_size_manual(values = c(0.5, 1, 2)) +<br>  scale_colour_manual(values =c(<span>"#D95F02"</span>,<span>"#1B9E77"</span>,<span>"#A2A2A288"</span>)) +<br>  guides(size = guide_legend(title = <span>"Mantel's r"</span>,override.aes = list(colour = <span>"grey35"</span>), order = 2),<br>         colour = guide_legend(title = <span>"Mantel's p"</span>,override.aes = list(size = 3), order = 1),<br>         fill = guide_colorbar(title = <span>"pearson's r"</span>,order = 3))+<br>  theme(plot.margin = unit(c(0,0,0,-1),units=<span>"cm"</span>),<br>        legend.position = <span>"non"</span>,<br>        panel.background = element_blank(),<br>        axis.text=element_markdown(color=<span>"black"</span>,size=10)) <br></code></pre><p data-tool="mdnice编辑器">由于需要拼图，调整一下位置信息在绘制一幅图</p><pre data-tool="mdnice编辑器"><span></span><code>p2 &lt;- qcorrplot(correlate(varechem,method = <span>"pearson"</span>),diag=F,<span>type</span>=<span>"upper"</span>)+<br>  geom_tile()+<br>  geom_mark(size=2.5,sig.thres=0.05,sep=<span>"\n"</span>)+<br>  geom_couple(aes(colour=pd,size=rd),data=mantel,label.colour = <span>"black"</span>,<br>              curvature=nice_curvature(0.15),<br>              nudge_x=0.2,<br>              label.fontface=2,<br>              label.size =4,<br>              drop = T)+<br>  scale_fill_gradientn(colours = RColorBrewer::brewer.pal(11,<span>"RdBu"</span>))+<br>  scale_size_manual(values = c(0.5, 1, 2)) +<br>  scale_colour_manual(values =c(<span>"#D95F02"</span>,<span>"#1B9E77"</span>,<span>"#A2A2A288"</span>)) +<br>  guides(size = guide_legend(title = <span>"Mantel's r"</span>,override.aes = list(colour = <span>"grey35"</span>), order = 2),<br>         colour = guide_legend(title = <span>"Mantel's p"</span>,override.aes = list(size = 3), order = 1),<br>         fill = guide_colorbar(title = <span>"pearson's r"</span>,order = 3))+<br>  theme(plot.margin = unit(c(0,0.,0,0),units=<span>"cm"</span>),<br>        legend.background=element_blank(),<br>        panel.background = element_blank(),<br>        legend.key = element_blank(),<br>        axis.text=element_markdown(color=<span>"black"</span>,size=10))  <br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>拼图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>ggdraw()+<br>  draw_plot(p2,scale = 0.6,x=0.2,y=0.11)+<br>  draw_plot(p1,scale = 0.6,x=-0.21,y=-0.14)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7853610286844708" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAamhEmYEDL8LFlpdhMVKibrMFfhfBjsExd50SdHmk8zuDgIvY0LbHfRnuwx4uKqlHasjJWJALZ4ic7Q/640?wx_fmt=png" data-type="png" data-w="1011" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAamhEmYEDL8LFlpdhMVKibrMFfhfBjsExd50SdHmk8zuDgIvY0LbHfRnuwx4uKqlHasjJWJALZ4ic7Q/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节介绍到此结束，拼图代码后使用AI处理了部分细节，喜欢的观众老爷欢迎分享转发；<strong>「当然更推荐大家加入我的VIP交流群」</strong>扫描下方二维码加小编微信<strong>「付费149元」</strong>后邀请进群，<strong>「一定让你感受到物超所值」</strong>，<strong>「添加小编微信请备注来意，以便高效处理」</strong></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>小编微信</span><span></span></h3><p><img data-galleryid="" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg" data-type="jpeg" data-w="430" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/RqfTOodDkszsWF5KplIu_w",target="_blank" rel="noopener noreferrer">原文链接</a>
