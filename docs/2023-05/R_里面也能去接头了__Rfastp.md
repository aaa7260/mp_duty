---
title: "R 里面也能去接头了: Rfastp"
date: 2023-05-06T04:44:16Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
R 里面也能去接头了: Rfastp by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h4 data-tool="mdnice编辑器"><span></span></h4><section><mp-common-profile data-pluginname="mpprofile" data-weui-theme="light" data-id="MzkyMTI1MTYxNA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usey42oX5qyLTVibLRO9dz8ic5G4TpEHQc9rICYlpS4MHg6Et8cgXrQDqibvibXombicTro8t9cekJRlDBcw/0?wx_fmt=png" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-from="0" data-is_biz_ban="0"></mp-common-profile></section></section><section><qqmusic musicid="105917234" mid="000H3VYO0hU0ko" albumurl="https://y.gtimg.cn/music/photo_new/T002R68x68M000000aCAG748KoJQ.jpg" audiourl="http://isure6.stream.qqmusic.qq.com/C200001oaqRo0q7Csu.m4a?guid=2000000052&amp;vkey=014B1306E2B076CA64E6D79F0D98EE1B472605868003F99FE1BED3EE444B9DDA003FE2CD4F2F0DB47D846E5BA99C19C023C3EEB2532E8697&amp;uin=0&amp;fromtag=20052" music_name="借我" singer="谢春花 - 算云烟" play_length="257" src="/mp/readtemplate?t=app_editor/music&amp;singer=%E8%B0%A2%E6%98%A5%E8%8A%B1%20-%20%E7%AE%97%E4%BA%91%E7%83%9F&amp;music_name=%E5%80%9F%E6%88%91&amp;albumurl=https%3A%2F%2Fy.gtimg.cn%2Fmusic%2Fphoto_new%2FT002R68x68M000000aCAG748KoJQ.jpg&amp;musictype=1" musictype="1" otherid="000H3VYO0hU0ko" albumid="000aCAG748KoJQ" jumpurlkey="" data-pluginname="insertaudio"></qqmusic></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h4 data-tool="mdnice编辑器"><span></span></h4><h2 data-tool="mdnice编辑器"><span><span>1</span></span><span>引言</span><span></span></h2><blockquote data-tool="mdnice编辑器"><p>众所周知, <strong>很多二代测序的上游分析软件大部分使用都是 linux 里面运行的</strong>, 而下游统计分析和可视化又得切换到其它软件,这样确实有点不方便。比如上游的去接头软件: <strong>cutadpat,trim_galore,fastp</strong> 的等等。如果能在一个软件里能干绝大部分事情当然是极好的。<strong>fastp</strong> 是一款用 <strong>C++</strong> 语言编写的快速去接头的软件, <strong>Rfastp</strong> 使用 <strong>RCPP</strong> 接口进行了包装,让你在 R 里面也可以使用其进行接头序列去除过滤操作。</p></blockquote><figure data-tool="mdnice编辑器"><img data-ratio="0.6897880539499036" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4useyuCwXWeJ4EvVRysTd5ovDRBJPFTUPenMSzN2OmUrpoLzkazIus4kmUboUiand6EmibatS55TGTicf5Q/640?wx_fmt=png" data-type="png" data-w="1038" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4useyuCwXWeJ4EvVRysTd5ovDRBJPFTUPenMSzN2OmUrpoLzkazIus4kmUboUiand6EmibatS55TGTicf5Q/640?wx_fmt=png"></figure><h2 data-tool="mdnice编辑器"><span><span>2</span></span><span>安装</span><span></span></h2><pre data-tool="mdnice编辑器"><span></span><code><span>if</span> (!<span>require</span>(<span>"BiocManager"</span>, quietly = <span>TRUE</span>))<br>    install.packages(<span>"BiocManager"</span>)<br><br>BiocManager::install(<span>"Rfastp"</span>)<br><br><span># If required, the latest development version of</span><br><span># the package can also be installed from GitHub.</span><br><span>if</span> (!<span>require</span>(<span>"BiocManager"</span>, quietly = <span>TRUE</span>))<br>    install.packages(<span>"BiocManager"</span>)<br><br>BiocManager::install(<span>"Rfastp"</span>)<br></code></pre><h2 data-tool="mdnice编辑器"><span><span>3</span></span><span>使用介绍</span><span></span></h2><p data-tool="mdnice编辑器">加载测试 fastq 数据,单端和双端的:</p><pre data-tool="mdnice编辑器"><span></span><code>se_read1 &lt;- system.file(<span>"extdata"</span>,<span>"Fox3_Std_small.fq.gz"</span>,package=<span>"Rfastp"</span>)<br>pe_read1 &lt;- system.file(<span>"extdata"</span>,<span>"reads1.fastq.gz"</span>,package=<span>"Rfastp"</span>)<br>pe_read2 &lt;- system.file(<span>"extdata"</span>,<span>"reads2.fastq.gz"</span>,package=<span>"Rfastp"</span>)<br>outputPrefix &lt;- tempfile(tmpdir = tempdir())<br></code></pre><p data-tool="mdnice编辑器"><strong>thread</strong> 可以支持多线程运行:</p><pre data-tool="mdnice编辑器"><span></span><code>se_json_report &lt;- rfastp(read1 = se_read1,<br>    outputFastq = paste0(outputPrefix, <span>"_se"</span>), thread = <span>4</span>)<br></code></pre><p data-tool="mdnice编辑器">双端:</p><pre data-tool="mdnice编辑器"><span></span><code>pe_json_report &lt;- rfastp(read1 = pe_read1, read2 = pe_read2,<br>    outputFastq = paste0(outputPrefix, <span>"_pe"</span>))<br></code></pre><p data-tool="mdnice编辑器">合并双端数据:</p><pre data-tool="mdnice编辑器"><span></span><code>pe_merge_json_report &lt;- rfastp(read1 = pe_read1, read2 = pe_read2, merge = <span>TRUE</span>,<br>    outputFastq = paste0(outputPrefix, <span>'_unpaired'</span>),<br>    mergeOut = paste0(outputPrefix, <span>"_merged.fastq.gz"</span>))<br></code></pre><p data-tool="mdnice编辑器">10X 单细胞 UMI 处理:</p><pre data-tool="mdnice编辑器"><span></span><code>umi_json_report &lt;- rfastp(read1 = pe_read1, read2 = pe_read2,<br>    outputFastq = paste0(outputPrefix, <span>'_umi1'</span>), umi = <span>TRUE</span>, umiLoc = <span>"read1"</span>,<br>    umiLength = <span>16</span>)<br></code></pre><p data-tool="mdnice编辑器">更多的参数控制:</p><pre data-tool="mdnice编辑器"><span></span><code>clipr_json_report &lt;- rfastp(read1 = se_read1,<br>    outputFastq = paste0(outputPrefix, <span>'_clipr'</span>),<br>    disableTrimPolyG = <span>TRUE</span>,<br>    cutLowQualFront = <span>TRUE</span>,<br>    cutFrontWindowSize = <span>29</span>,<br>    cutFrontMeanQual = <span>20</span>,<br>    cutLowQualTail = <span>TRUE</span>,<br>    cutTailWindowSize = <span>1</span>,<br>    cutTailMeanQual = <span>5</span>,<br>    minReadLength = <span>29</span>,<br>    adapterSequenceRead1 = <span>'GTGTCAGTCACTTCCAGCGG'</span><br>)<br></code></pre><p data-tool="mdnice编辑器">多个文件处理:</p><pre data-tool="mdnice编辑器"><span></span><code>pe001_read1 &lt;- system.file(<span>"extdata"</span>,<span>"splited_001_R1.fastq.gz"</span>,<br>    package=<span>"Rfastp"</span>)<br>pe002_read1 &lt;- system.file(<span>"extdata"</span>,<span>"splited_002_R1.fastq.gz"</span>,<br>    package=<span>"Rfastp"</span>)<br>pe003_read1 &lt;- system.file(<span>"extdata"</span>,<span>"splited_003_R1.fastq.gz"</span>,<br>    package=<span>"Rfastp"</span>)<br>pe004_read1 &lt;- system.file(<span>"extdata"</span>,<span>"splited_004_R1.fastq.gz"</span>,<br>    package=<span>"Rfastp"</span>)<br>inputfiles &lt;- c(pe001_read1, pe002_read1, pe003_read1, pe004_read1)<br>cat_rjson_report &lt;- rfastp(read1 = inputfiles,<br>    outputFastq = paste0(outputPrefix, <span>"_merged1"</span>))<br></code></pre><p data-tool="mdnice编辑器"><strong>catfastq</strong> 函数合并多个 fastq 文件:</p><pre data-tool="mdnice编辑器"><span></span><code>pe001_read2 &lt;- system.file(<span>"extdata"</span>,<span>"splited_001_R2.fastq.gz"</span>,<br>    package=<span>"Rfastp"</span>)<br>pe002_read2 &lt;- system.file(<span>"extdata"</span>,<span>"splited_002_R2.fastq.gz"</span>,<br>    package=<span>"Rfastp"</span>)<br>pe003_read2 &lt;- system.file(<span>"extdata"</span>,<span>"splited_003_R2.fastq.gz"</span>,<br>    package=<span>"Rfastp"</span>)<br>pe004_read2 &lt;- system.file(<span>"extdata"</span>,<span>"splited_004_R2.fastq.gz"</span>,<br>    package=<span>"Rfastp"</span>)<br>inputR2files &lt;- c(pe001_read2, pe002_read2, pe003_read2, pe004_read2)<br>catfastq(output = paste0(outputPrefix,<span>"_merged2_R2.fastq.gz"</span>),<br>    inputFiles = inputR2files)<br></code></pre><p data-tool="mdnice编辑器">数据框格式的质控报告,这样你可以自己用 ggplot2 绘图:</p><pre data-tool="mdnice编辑器"><span></span><code>dfsummary &lt;- qcSummary(pe_json_report)<br></code></pre><p data-tool="mdnice编辑器">自带的函数绘图:</p><pre data-tool="mdnice编辑器"><span></span><code>p1 &lt;- curvePlot(se_json_report)<br>p1<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6230717639168344" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4useyuCwXWeJ4EvVRysTd5ovDRHlYEXJxibchpyw1E0hn6iasPh1F72NtTtkSK2wpyBxq7saGc7NwMT4aQ/640?wx_fmt=png" data-type="png" data-w="1491" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4useyuCwXWeJ4EvVRysTd5ovDRHlYEXJxibchpyw1E0hn6iasPh1F72NtTtkSK2wpyBxq7saGc7NwMT4aQ/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code>p2 &lt;- curvePlot(se_json_report, curve=<span>"content_curves"</span>)<br>p2<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6226541554959786" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4useyuCwXWeJ4EvVRysTd5ovDRYNAOB1iaZDlK4X8z7dzibWwkN9kLTsupjYwf0eIt1nmEPnYN4K1Y9ia8A/640?wx_fmt=png" data-type="png" data-w="1492" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4useyuCwXWeJ4EvVRysTd5ovDRYNAOB1iaZDlK4X8z7dzibWwkN9kLTsupjYwf0eIt1nmEPnYN4K1Y9ia8A/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">更多参数见函数文档:</p><figure data-tool="mdnice编辑器"><img data-ratio="0.6211562115621156" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4useyuCwXWeJ4EvVRysTd5ovDRXhzb0sySP9Vsdb9wlzmR4yH7puz9vonyia1QtkyYjAh8j4pDFsjmtUw/640?wx_fmt=png" data-type="png" data-w="813" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4useyuCwXWeJ4EvVRysTd5ovDRXhzb0sySP9Vsdb9wlzmR4yH7puz9vonyia1QtkyYjAh8j4pDFsjmtUw/640?wx_fmt=png"></figure><h2 data-tool="mdnice编辑器"><span><span>4</span></span><span>结尾</span><span></span></h2><blockquote data-tool="mdnice编辑器"><p>在 R 里多线程去接头还是很方便的。</p></blockquote><h2 data-tool="mdnice编辑器"><span><span>5</span></span><span>结尾</span><span></span></h2><blockquote data-tool="mdnice编辑器"><p><strong>路漫漫其修远兮,吾将上下而求索。</strong></p></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">欢迎加入生信交流群。加我微信我也拉你进 <strong>微信群聊</strong> <strong>老俊俊生信交流群</strong> <strong>(微信交流群需收取 20 元入群费用,一旦交费,拒不退还!(防止骗子和便于管理))</strong> 。QQ 群可免费加入, 记得进群按格式修改备注哦。</p><section data-tool="mdnice编辑器"><section><p><strong>老俊俊微信：</strong></p><figure><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4useyuCwXWeJ4EvVRysTd5ovDRKr8oogyuoUfQAvOiaX9IvDLiaSiaCt5tXicREia3rhSLzSyPZhbnDiakdfBQ/640?wx_fmt=png" data-type="png" data-w="430" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4useyuCwXWeJ4EvVRysTd5ovDRKr8oogyuoUfQAvOiaX9IvDLiaSiaCt5tXicREia3rhSLzSyPZhbnDiakdfBQ/640?wx_fmt=png"></figure><figure><img data-ratio="1.3668430335097002" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4useyuCwXWeJ4EvVRysTd5ovDRboJB4clFjpAlJEZmbjWrrJC9Mgb2OxibT4VWB3nauVgeic1J2uanVwvw/640?wx_fmt=png" data-type="png" data-w="567" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4useyuCwXWeJ4EvVRysTd5ovDRboJB4clFjpAlJEZmbjWrrJC9Mgb2OxibT4VWB3nauVgeic1J2uanVwvw/640?wx_fmt=png"></figure></section><section><p><strong>知识星球：</strong></p><figure><img data-ratio="1.5896226415094339" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/G5jjcE4useyuCwXWeJ4EvVRysTd5ovDRgt0oqfiaFxibf3Fhia2m32d0k4ulPcxQahSBiaJItiawDntCsMGZQnYGQ6A/640?wx_fmt=jpeg" data-type="jpeg" data-w="1060" src="https://mmbiz.qpic.cn/mmbiz_jpg/G5jjcE4useyuCwXWeJ4EvVRysTd5ovDRgt0oqfiaFxibf3Fhia2m32d0k4ulPcxQahSBiaJItiawDntCsMGZQnYGQ6A/640?wx_fmt=jpeg"></figure></section></section><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><br></p><center data-tool="mdnice编辑器"><strong> 往期回顾目录</strong></center><blockquote data-tool="mdnice编辑器"><p><br></p><center><strong><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247509140&amp;idx=1&amp;sn=3f46ed8760be054b173a60642d8fe608&amp;chksm=c1849ee5f6f317f36c7cb7e496181c1d9b431cb0c7a674f8cd31e7960b8f0830c4e8e0490b7d&amp;token=1839020225&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ClusterGVis 对接 monocle2 拟时序热图</a></strong></center><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247509098&amp;idx=1&amp;sn=51429bbb87f100744c50d4756375b089&amp;chksm=c1849e1bf6f3170d20d5aa284e7b28367d2ec4031644f01df96952de92f70e11e3a36c8d4d5e&amp;token=46732270&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">在 R 里面调用 julia</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247509081&amp;idx=1&amp;sn=300079e94a3b4da37e758d0eff5aac5b&amp;chksm=c1849e28f6f3173e786d633d10d3a7ecd4ea2b8833da59eff8cdff7458ffa66de329507d5d59&amp;token=1997382993&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">听说你想给聚类图旁边加个细胞数量条形图?</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247509065&amp;idx=1&amp;sn=74a7cb682d0895e75b27fff0621f1246&amp;chksm=c1849e38f6f3172ef335fb1d6a7f1a17f21969375f7003b6d9eb0b8153a3c54aaa2363eca253&amp;token=1997382993&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">如何给单细胞降维图例上添加亚群编号</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247508977&amp;idx=1&amp;sn=94817e9cb7bb07697a8592476f10875b&amp;chksm=c1849980f6f31096e2de956f9d82b8eee8fc85db486a289bf830af0357240631ef10a0f87a1f&amp;token=811397361&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">geom_arch2 绘制指定高度的弧线</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247508952&amp;idx=1&amp;sn=32b0f917e455a5d4b3f6d41043699bb8&amp;chksm=c18499a9f6f310bf7c6ed3099886e05bcae4de735eb016799a256e916bc4adaff2aaf08eeb06&amp;token=811397361&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">geom_cross_axis 绘制交叉坐标轴</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247508917&amp;idx=1&amp;sn=5d05856acbdd7ed8eec866615f339660&amp;chksm=c18499c4f6f310d29f9fd83915d881ad5734441aac4a71ce1dc1d695f5908b1aa3ff4ccc0039&amp;token=811397361&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">geom_markArrow 修饰你的单细胞图形</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247508861&amp;idx=1&amp;sn=10f6214664d87ac0af77fb57cfe35e49&amp;chksm=c184990cf6f3101ae36c0fb28c1009f5819e54576aa26247e8663d617d6c8003beee82a73f41&amp;token=1563877073&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">绘制渐变色三角形</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247508833&amp;idx=1&amp;sn=88c34c7d395daaf5f60203d9fc06df02&amp;chksm=c1849910f6f3100648723bd7256c5520f903a6effc6d9e08b31d2726a9a5091ea8c362dc5a2d&amp;token=1563877073&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">它...它来了: trackVisProMax</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247508806&amp;idx=1&amp;sn=93211aca628f0ae07f3acb0b411f0e49&amp;chksm=c1849937f6f310214fab2df33a686462cc774f0f9d95e0fdfd6bb14ebcfe91842f31e8262314&amp;token=536314270&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">矩形旋转问题之风波再起</a></center></strong><p><br></p></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/7xpKGeuFl7dR4U-yeWWAiw",target="_blank" rel="noopener noreferrer">原文链接</a>
