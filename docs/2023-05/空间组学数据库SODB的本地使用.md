---
title: "空间组学数据库SODB的本地使用"
date: 2023-05-14T14:11:26Z
draft: ["false"]
tags: [
  "fetched",
  "生信随笔"
]
categories: ["Acdemic"]
---
空间组学数据库SODB的本地使用 by 生信随笔
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">2023年2月，《Nature Methods》发表了<strong>一个综合性的空间组学数据库：SODB。</strong>文章题目为《SODB facilitates comprehensive exploration of spatial omics data》，SODB数据库涵盖了公开发表的空间转录组学、空间代谢组学、空间蛋白组学和空间基因组学的数据，提供了来自26种空间组学技术，数据量超过5000万细胞（spot），所有数据均由标准流程处理为Anndata形式，可兼容SCANPY、Squidpy等多种分析软件。</p><ul data-tool="mdnice编辑器"><li><section>详见推文<a href="https://mp.weixin.qq.com/s?__biz=MzA4MDkwODYyOQ==&amp;mid=2452659688&amp;idx=1&amp;sn=6d20974a404107dec682973a96de6519&amp;scene=21#wechat_redirect" data-linktype="2">Nature Methods | 空间组学数据库推荐：SODB</a></section></li><li><section>文章原文：https://www.nature.com/articles/s41592-023-01773-7</section></li><li><section>在线数据库链接在https://gene.ai.tencent.com/SpatialOmics/</section></li></ul><p data-tool="mdnice编辑器">除了使用在线数据库进行初步分析及可视化，SODB还支持本地使用命令行及python的方式进行数据下载。</p><ul data-tool="mdnice编辑器"><li><section>github：https://github.com/TencentAILabHealthcare/pysodb</section></li><li><section>说明文档：https://pysodb.readthedocs.io/en/latest/</section></li></ul><h3 data-tool="mdnice编辑器">Step1. 环境部署</h3><p data-tool="mdnice编辑器">Clone the source code.</p><pre data-tool="mdnice编辑器"><span></span><code>git <span>clone</span> https://github.com/TencentAILabHealthcare/pysodb.git<br><span>cd</span> pysodb<br></code></pre><p data-tool="mdnice编辑器">Create a conda environment and activate it.</p><pre data-tool="mdnice编辑器"><span></span><code><span>###### 有报错</span><br>conda env create -n pysodb --file pysodb.yml<br></code></pre><p data-tool="mdnice编辑器">但是上面的代码在我的服务器上有报错（大概率是因为pysodb.yml文件镜像设置的问题），所以我手动安装：</p><pre data-tool="mdnice编辑器"><span></span><code><span>###### 手动安装</span><br>mamba create -n pysodb python==3.8<br>conda activate pysodb<br>mamba install numpy==1.22.4 anndata==0.8.0  scanpy==1.9.1 pandas==1.5.0 requests==2.28.1 urllib3==1.26.12 tqdm==4.64.1 -y<br></code></pre><p data-tool="mdnice编辑器">Install pysodb as a dependency or third-party package with pip:</p><pre data-tool="mdnice编辑器"><span></span><code>pip install .<br></code></pre><p data-tool="mdnice编辑器">但是有一些包太旧了，实际运行过程中有报错，需要对部分包进行更新：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#有一些包太旧了，需要更新：</span><br>pip3 install numpy==1.20<br>pip3 install anndata<br>pip3 install leidenalg<br></code></pre><h3 data-tool="mdnice编辑器">Step2. 使用方法(python环境)</h3><pre data-tool="mdnice编辑器"><span></span><code><span>import</span> pysodb<br><br><span>### 1.Initialization</span><br>sodb = pysodb.SODB() <br><br><span>### 2.List datasets</span><br><span># Get the list of datasets</span><br>dataset_list = sodb.list_dataset() <br>dataset_list<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.22407407407407406" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqXxhicbnk0kVjicGSic75V2ASbbQUbVwNvarcOZ3PCQ7DGISLsrxGcBrzLwXXsTWaXfv4LiaJyBrfyfCw/640?wx_fmt=other" data-type="other" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqXxhicbnk0kVjicGSic75V2ASbbQUbVwNvarcOZ3PCQ7DGISLsrxGcBrzLwXXsTWaXfv4LiaJyBrfyfCw/640?wx_fmt=other"><figcaption>image-20230514164009413</figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code><span>### 3.List datasets by category</span><br><span># show the spatial proteomics datasets</span><br>sodb.list_dataset_by_category(<span>'Spatial Proteomics'</span>)<br><br><span># show the spatial transcriptomics datasets</span><br>sodb.list_dataset_by_category(<span>'Spatial Transcriptomics'</span>)<br><br><span># show the spatial metabolomics datasets</span><br>sodb.list_dataset_by_category(<span>'Spatial Metabolomics'</span>)<br><br><span># show the spatial MultiOmics datasets</span><br>sodb.list_dataset_by_category(<span>'Spatial MultiOmics'</span>)<br><br><span># show the spatial genomics datasets</span><br>sodb.list_dataset_by_category(<span>'Spatial Genomics'</span>)<br><br><span>#All</span><br>dataset_list = sodb.list_dataset_by_category() <span># Get the list of datasets with specific category. categories ["Spatial Transcriptomics", "Spatial Proteomics", "Spatial Metabolomics", "Spatial Genomics", "Spatial MultiOmics"]</span><br></code></pre><p data-tool="mdnice编辑器">下面是空转数据列表：</p><pre data-tool="mdnice编辑器"><span></span><code>$ sodb.list_dataset_by_category(<span>'Spatial Transcriptomics'</span>)<br>[<span>'stahl2016visualization'</span>,<br> <span>'wang2022high'</span>,<br> <span>'Juntaro2022MEK'</span>,<br> <span>'Konieczny2022Interleukin'</span>,<br> <span>'Vickovic2019high_update'</span>,<br> <span>'Ratz2022Clonal'</span>,<br> <span>'Barkley2022Cancer'</span>,<br> <span>'he2020integrating'</span>,<br> <span>'zhang2021spatially'</span>,<br> <span>'chen2020spatial'</span>,<br> <span>'Vickovic2019high'</span>,<br> <span>'Pascual2021Dietary'</span>,<br> <span>'Melo2021Integrating'</span>,<br> <span>'Misra2021Characterizing'</span>,<br> <span>'Sun2021Integrating'</span>,<br> <span>'moncada2020integrating'</span>,<br> <span>'xia2019spatial'</span>,<br> <span>'10x'</span>,<br> <span>'chen2021dissecting'</span>,<br> <span>'Allen2022Molecular_aging'</span>,<br> <span>'guilliams2022spatial'</span>,<br> <span>'maniatis2019spatiotemporal'</span>,<br> <span>'Allen2022Molecular_lps'</span>,<br> <span>'Lebrigand2022The'</span>,<br> <span>'asp2017spatial'</span>,<br> <span>'Alon2021Expansion'</span>,<br> <span>'DARTFISH'</span>,<br> <span>'Biermann2022Dissecting'</span>,<br> <span>'berglund2018spatial'</span>,<br> <span>'Joglekar2021A'</span>,<br> <span>'ortiz2020molecular'</span>,<br> <span>'seqFISH_VISp'</span>,<br> <span>'Wang2018three'</span>,<br> <span>'chen2021decoding'</span>,<br> <span>'hunter2021spatially'</span>,<br> <span>'Marshall2022High_mouse'</span>,<br> <span>'Tower2021Spatial'</span>,<br> <span>'Buzzi2022Spatial'</span>,<br> <span>'Garcia2021Mapping'</span>,<br> <span>'Wu2022spatial'</span>,<br> <span>'kvastad2021the'</span>,<br> <span>'codeluppi2018spatial'</span>,<br> <span>'fawkner2021spatiotemporal'</span>,<br> <span>'hildebrandt2021spatial'</span>,<br> <span>'chen2022spatiotemporal_compre_20'</span>,<br> <span>'thrane2018spatially'</span>,<br> <span>'Dixon2022Spatially'</span>,<br> <span>'Sanchez2021A'</span>,<br> <span>'wei2022single'</span>,<br> <span>'bergenstrahle2021super'</span>,<br> <span>'lohoff2021integration'</span>,<br> <span>'Zhang2023Amolecularly_rawcount'</span>,<br> <span>'parigi2022the'</span>,<br> <span>'Shah2016InSitu'</span>,<br> <span>'Gouin2021An'</span>,<br> <span>'scispace'</span>,<br> <span>'stickels2020highly'</span>,<br> <span>'moffitt2018molecular'</span>,<br> <span>'Fang2022Conservation'</span>,<br> <span>'mantri2021spatiotemporal'</span>,<br> <span>'Navarro2020Spatial'</span>,<br> <span>'gracia2021genome'</span>,<br> <span>'carlberg2019exploring'</span>,<br> <span>'Kleshchevnikov2022Cell2location'</span>,<br> <span>'ji2020multimodal'</span>,<br> <span>'maynard2021trans'</span>,<br> <span>'xia2022the'</span>,<br> <span>'Marshall2022High_human'</span>,<br> <span>'Merfish_Visp'</span>,<br> <span>'Shi2022Spatial'</span>,<br> <span>'asp2019a'</span>,<br> <span>'Sun2022Excitatory'</span>,<br> <span>'wang2021easi'</span>,<br> <span>'Kadur2022Human'</span>,<br> <span>'Booeshaghi2021Isoform'</span>,<br> <span>'Borm2022Scalable'</span>,<br> <span>'Zeng2023Integrative'</span>,<br> <span>'Wang2018Three_1k'</span>,<br> <span>'Dhainaut2022Spatial'</span>,<br> <span>'chen2022spatiotemporal'</span>,<br> <span>'rodriques2019slide'</span>,<br> <span>'liu2022spatiotemporal'</span>,<br> <span>'Fu2021Unsupervised'</span>,<br> <span>'Visium_Allen'</span>,<br> <span>'backdahl2021spatial'</span>,<br> <span>'eng2019transcriptome'</span>]<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code><span>### 4.List experiments by dataset</span><br><span># show the spatial genomics datasets</span><br>sodb.list_experiment_by_dataset(<span>'gut2018multiplexed'</span>)<br><br><span>### 5.load dataset</span><br><span># Load a specific dataset</span><br>adata = sodb.load_dataset(<span>"yuan2021seam"</span>) <span># Load a specific dataset</span><br><br><span>### 6.Load experiment</span><br>adata.experiment = sodb.load_experiment(<span>'hunter2021spatially'</span>,<span>'sample_B'</span>) <span># Load a specific experiment </span><br></code></pre><h3 data-tool="mdnice编辑器">Step3. 数据保存</h3><p data-tool="mdnice编辑器">使用<code>sodb.load_dataset</code>函数下载得到的adata是一个字典结构，对其保存的话，我写了一个循环：</p><pre data-tool="mdnice编辑器"><span></span><code>adata = sodb.load_dataset(<span>"yuan2021seam"</span>) <span># Load a specific dataset</span><br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.544564152791381" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqXxhicbnk0kVjicGSic75V2ASbbTwSXtqjImCg9Jyx2IX78H9bh8RmYEKKRPviancx1zwN4fjpdqW8elg/640?wx_fmt=other" data-type="other" data-w="1021" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqXxhicbnk0kVjicGSic75V2ASbbTwSXtqjImCg9Jyx2IX78H9bh8RmYEKKRPviancx1zwN4fjpdqW8elg/640?wx_fmt=other"><figcaption>image-20230514175237987</figcaption></figure><p data-tool="mdnice编辑器">这样下载得到的adata是一个字典结构：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.6203703703703703" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqXxhicbnk0kVjicGSic75V2ASbyLX2gTXibu4WRmV2wDJuHia2wSQGnwuicFfHjhRacPXJFaBjkVa4JxzibQ/640?wx_fmt=other" data-type="other" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqXxhicbnk0kVjicGSic75V2ASbyLX2gTXibu4WRmV2wDJuHia2wSQGnwuicFfHjhRacPXJFaBjkVa4JxzibQ/640?wx_fmt=other"><figcaption>image-20230514175252274</figcaption></figure><p data-tool="mdnice编辑器">所以保存的话可以用for循环批处理：</p><pre data-tool="mdnice编辑器"><span></span><code>out_dir=<span>"./"</span><br><span>for</span> key, value <span>in</span> adata.items():<br>    filename = out_dir+key + <span>".h5ad"</span><br>    <span># 使用AnnData对象的write()方法保存为h5ad文件</span><br>    value.write(filename)<br>    <span># 打印保存成功的提示信息</span><br>    print(<span>f"Saved <span>{key}</span> as <span>{filename}</span>"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.1879310344827586" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqXxhicbnk0kVjicGSic75V2ASbbau5kZgtmzsf0Cc3ATUnzDQDET75JprklUYZEShmWer3o92opckiaTA/640?wx_fmt=other" data-type="other" data-w="580" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqXxhicbnk0kVjicGSic75V2ASbbau5kZgtmzsf0Cc3ATUnzDQDET75JprklUYZEShmWer3o92opckiaTA/640?wx_fmt=other"><figcaption>image-20230514175419522</figcaption></figure><p data-tool="mdnice编辑器">其实还有另外一种方法。函数<code>sodb.load_dataset</code>一经运行，实际上就已经将目标数据下载下来了，只是我们不知道目标数据下载到了哪个路径下，我们只需要find一下即可：</p><pre data-tool="mdnice编辑器"><span></span><code>find ~/ -name yuan2021seam*<br><span>#~/miniconda3/envs/pysodb/lib/python3.8/site-packages/pysodb/cache/yuan2021seam</span><br></code></pre><p data-tool="mdnice编辑器">下载好的文件就在这个路径下：</p><pre data-tool="mdnice编辑器"><span></span><code>ls -lh ~/miniconda3/envs/pysodb/lib/python3.8/site-packages/pysodb/cache/yuan2021seam<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.1873015873015873" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqXxhicbnk0kVjicGSic75V2ASbBoeiaKhpK976ibKBLic5NINksJ3ibEpvAUiaXtMHAqcncAd8LbGmyic8iaH1A/640?wx_fmt=other" data-type="other" data-w="630" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqXxhicbnk0kVjicGSic75V2ASbBoeiaKhpK976ibKBLic5NINksJ3ibEpvAUiaXtMHAqcncAd8LbGmyic8iaH1A/640?wx_fmt=other"><figcaption>image-20230514175811692</figcaption></figure><span>- END -</span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/COc5xntbsy5eGFq0QZuirA",target="_blank" rel="noopener noreferrer">原文链接</a>
