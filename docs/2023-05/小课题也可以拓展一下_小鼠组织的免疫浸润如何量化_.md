---
title: "小课题也可以拓展一下，小鼠组织的免疫浸润如何量化？"
date: 2023-05-10T02:48:55Z
draft: ["false"]
tags: [
  "fetched",
  "果子学生信"
]
categories: ["Acdemic"]
---
小课题也可以拓展一下，小鼠组织的免疫浸润如何量化？ by 果子学生信
------
<div><section><p>这个免疫浸润系列越写越喜欢。<br>之前讲过CIBERSORT的使用极其注意事项，当分步拆解后，知道了很多细节。<br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650734689&amp;idx=1&amp;sn=d6727cd63a271aec269992d4d432f8e5&amp;scene=21#wechat_redirect" data-linktype="2">量化免疫浸润时CIBERSORT的注意事项</a><br>接着又讲了免疫浸润时另外一种重要的方法ssGSEA<br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650734731&amp;idx=1&amp;sn=56e33f855d848d7f24cb153dfa7109fb&amp;scene=21#wechat_redirect" data-linktype="2">ssgsea算法在量化免疫浸润时的运用以及原理</a><br>写到这里的时候，已经不适合大多数人看了。<br></p><figure><img data-ratio="0.45952677459526775" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicUAT0VAcm2DD8vbrJ9Y7M8ZmdL5bicNiaGl80WPhPrcb7ibliaQsgd1jkcg/640?wx_fmt=png" data-type="png" data-w="803" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicUAT0VAcm2DD8vbrJ9Y7M8ZmdL5bicNiaGl80WPhPrcb7ibliaQsgd1jkcg/640?wx_fmt=png"></figure><p>这很正常，写这篇的时候，我是凌晨四点睡的觉，是累，但是又理解了一个方法，心里很开心。<br>GSVA包中的四个方法，gsva，ssgsea，zscore，plage，全部都会以来输入的样本数目。<br>这是从代码里面看到的，虽然他们评测的是单个样本，但是他们纳入全部样本来标准化。<br>所以，后面来了个新的方法叫作，singscore，不依赖其他样本，这个以后会讲。<br></p><figure><img data-ratio="0.5332933413317337" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOictCWJibKqMphoxm9u5zJVJb8EzI9C6IL7lFN5k3c06icpv8P0Q5wIDAWw/640?wx_fmt=png" data-type="png" data-w="1667" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOictCWJibKqMphoxm9u5zJVJb8EzI9C6IL7lFN5k3c06icpv8P0Q5wIDAWw/640?wx_fmt=png"></figure><p>目前手上有一篇小鼠的测序组织，就想着能不能也量化一下他们的免疫浸润水平。<br>从CIBERSORT和ssGSEA的角度来说，做这个事情并不困难。<br>对于，CIBERSORT来说，只要有个免疫基因表达矩阵就行。<br>对于，ssGSEA来说，只要有小鼠的免疫类型对应的基因集就行。</p><p>这时我们会想，把人类的基因名称转换为小鼠的基因名称不就行了么？<br>可以，但是前提是，人类和小鼠的免疫类型以及功能相同。</p><p>这个事情是有解的，只要有人去总结小鼠的免疫芯片，测序的结果，并把他们变成免疫特征矩阵就可以了。<br>在这个基础上，这个免疫特征矩阵还要被验证。<br>比如，认为刺激T细胞，他能不能识别出单独的类型。<br>人为制造不同比例的已知的假的表达矩阵，看这个算法是否能算出跟我们预期一样的结果。</p><h3><span>ImmuCC量化芯片的小鼠免疫浸润</span></h3><p>j经过检索我发现，真的有人做了这个事情，他是国内苏州系统医学研究所苏吴爱平教授<br>文章发在这里<br></p><figure><img data-ratio="0.38379705400981995" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicHNhCwTvY9O2fdVlPekHiaay3bKgJYIDOlhgiaBUyJDlJdZP1icTIL1LWQ/640?wx_fmt=png" data-type="png" data-w="1222" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicHNhCwTvY9O2fdVlPekHiaay3bKgJYIDOlhgiaBUyJDlJdZP1icTIL1LWQ/640?wx_fmt=png"></figure><p>为了让别人可以更方便的用这个结果，他们也写了个R包，叫作immucc<br>地址在这里<br>https://github.com/wuaipinglab/ImmuCC</p><p>里面一个不错的工作就是得到了免疫特征矩阵<br>方法叫作immucc，但是实际上用的是CIBERSORT，这在作者的代码中可以看出来。<br></p><figure><img data-ratio="0.36982968369829683" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicfJibmSe7OictiaVHc4C0JC3Zeeo34k6P3skbaCh8Phm5Mj0SInaCR2pmw/640?wx_fmt=png" data-type="png" data-w="822" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicfJibmSe7OictiaVHc4C0JC3Zeeo34k6P3skbaCh8Phm5Mj0SInaCR2pmw/640?wx_fmt=png"></figure><p>好了，知道了原理，我们可以自己动手来操作<br><strong>从文章附件下载这个矩阵(补充表里面)</strong>，<br></p><figure><img data-ratio="0.44344344344344344" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicZjk77T7wcm6FoQ7Fk7XsefMhMCuicobdXTxu3TmZOOUTYusNSorZmDQ/640?wx_fmt=png" data-type="png" data-w="999" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicZjk77T7wcm6FoQ7Fk7XsefMhMCuicobdXTxu3TmZOOUTYusNSorZmDQ/640?wx_fmt=png"></figure><br>然后下载一个小鼠的表达矩阵(GSE41418)<br><figure><img data-ratio="0.5149833518312985" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicS2ibIibC1jqsyXPz8TicssD7mc0EcAg6Ab5VeibrZwbNsO4KhLqzDFS3uw/640?wx_fmt=png" data-type="png" data-w="901" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicS2ibIibC1jqsyXPz8TicssD7mc0EcAg6Ab5VeibrZwbNsO4KhLqzDFS3uw/640?wx_fmt=png"></figure><p>需要注意的，这里需要探针ID转换。要把探针变成小鼠的基因名称。<br>在这个帖子里，我们讲过几乎所有芯片的探针转换。<br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650734382&amp;idx=1&amp;sn=13406c56cbbbd993367ed9cf8112b3a8&amp;scene=21#wechat_redirect" data-linktype="2">视频课程:GEO芯片的探针ID转换(mRNA,lncRNA以及circRNA)</a></p><p>然后我们看他的表达量，基本上在10以内，说明是被log化之后的，通过之前的的分析我们知道<br>CIBERSORT中有一步会自动去log化。所以可以不用处理。</p><p>接下来的操作就简单了,下面就是固定操作。</p><pre><code><span>source</span>(<span>"CIBERSORT/CIBERSORT.R"</span>) <br>sig_matrix &lt;- <span>"sig_mouse.txt"</span><br>mixture_file = <span>'exprMatmouse.txt'</span><br>res_cibersort &lt;- CIBERSORT(sig_matrix, mixture_file, perm=<span>100</span>, QN=<span>TRUE</span>)<br></code></pre><p>跟之前的一样，把得到的结果变化一些形式，然后作图<br>这里，我增加了一个分组变量，这是GSE41418这个数据集中给出的。<br>增加了分组信息后，如果免疫浸润不一样，会看的很明显。</p><pre><code>library(dplyr)<br>library(tidyr)<br>library(tibble)<br>## 数据宽变长<br>dd1 &lt;- res_cibersort %&gt;% <br>  as.data.frame() %&gt;% <br>  rownames_to_column(<span>"sample"</span>) %&gt;% <br>  mutate(<span>type</span>=c(<span>rep</span>(<span>"Harlan_treat"</span>,<span>3</span>),<span>rep</span>(<span>"Jackson_treat"</span>,<span>3</span>),<span>rep</span>(<span>"Harlan_Ctrol"</span>,<span>3</span>),<span>rep</span>(<span>"Jackson_Ctrol"</span>,<span>3</span>))) %&gt;% <br>  pivot_longer(cols=<span>2</span>:<span>25</span>,<br>               names_to= <span>"celltype"</span>,<br>               values_to = <span>"Proportion"</span>)<br>### 绘图<br>library(ggplot2)<br>ggplot(dd1,aes(sample,Proportion,fill = celltype)) + <br>  geom_bar(position = <span>"fill"</span>,stat = <span>"identity"</span>)+<br>  theme_bw()+<br>  guides(fill=guide_legend(ncol=<span>1</span>))+<br>  facet_wrap(~<span>type</span>, scales = <span>"free_x"</span>, nrow = <span>1</span>)+<br>  theme(axis.text.x = element_text(angle = <span>45</span>, hjust = <span>1</span>,vjust = <span>1</span>, colour = <span>"black"</span>))<br></code></pre><p>但是，我没看出来差异。<br></p><figure><img data-ratio="0.625236593059937" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicN8zbe6W1JAl4uaMDuChl8iasj96e78YfwpL49KENkq0zsaUyC7Vn3mQ/640?wx_fmt=png" data-type="png" data-w="1585" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicN8zbe6W1JAl4uaMDuChl8iasj96e78YfwpL49KENkq0zsaUyC7Vn3mQ/640?wx_fmt=png"></figure><h3><span>seq-ImmuCC量化测序的小鼠免疫浸润</span></h3><p>以上的是处理芯片结果的方法，后面作者又开发了seq-ImmuCC，专门用来处理小鼠的测序数据。<br></p><figure><img data-ratio="0.3088363954505687" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicpDcEicBqoST5lRCg1XaXicbhAzIicWvdYQWVBX1177Viasluall6PQTwrA/640?wx_fmt=png" data-type="png" data-w="1143" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicpDcEicBqoST5lRCg1XaXicbhAzIicWvdYQWVBX1177Viasluall6PQTwrA/640?wx_fmt=png"></figure><p>作者人也比较好，开发了一个网页工具给大家免费使用。<br>网址在这里：</p><blockquote><p>http://218.4.234.74:3200/immune/</p></blockquote><p>打开后是这样的，我上传了一份他们的测试数据(在网页的教程里给了链接)。<br>有两个算法可以选择，我这里选的是我认识的SVR，CIBERSORT就是依赖的这个算法。<br></p><figure><img data-ratio="0.538135593220339" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOic6R3M4F2Aic8GfJgt60tjhmHD2pD4px2iaB51zFTvSib7mphTeAKYvxofw/640?wx_fmt=png" data-type="png" data-w="708" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOic6R3M4F2Aic8GfJgt60tjhmHD2pD4px2iaB51zFTvSib7mphTeAKYvxofw/640?wx_fmt=png"></figure><br>没用多久就返回了结果<br>这个工具比较谨慎，只能量化10种免疫细胞。<br>为什么？应该是测序的数据太少了，随着时间推移，随着单细胞的爆发，新的基因集，新的方法出现是迟早的事情。<br><figure><img data-ratio="0.7363515312916112" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicsa89ShcprA7MxJkMK6Kgzx4TWVqP5m8q1G7o6sHoeWT5PI90fFMGAQ/640?wx_fmt=png" data-type="png" data-w="1502" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicsa89ShcprA7MxJkMK6Kgzx4TWVqP5m8q1G7o6sHoeWT5PI90fFMGAQ/640?wx_fmt=png"></figure><p>算出来的是个比率，我下载了数据自己作图试了一下<br>画出来是一样的。<br></p><figure><img data-ratio="0.629582806573957" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicgDFZTr1lf1LqWb7mPzib9TokPshVZ8oibjyjObSzBZDXpRpV2YkxTFYA/640?wx_fmt=png" data-type="png" data-w="1582" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicgDFZTr1lf1LqWb7mPzib9TokPshVZ8oibjyjObSzBZDXpRpV2YkxTFYA/640?wx_fmt=png"></figure><p>用前面的方法来呈现，更加直观一点<br></p><figure><img data-ratio="0.6256599788806758" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicPEboDicKreCBAI8bibSVdsz01aW5vYLcu57VB5Ar6I1kbPZm6O6x45YQ/640?wx_fmt=png" data-type="png" data-w="1894" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicPEboDicKreCBAI8bibSVdsz01aW5vYLcu57VB5Ar6I1kbPZm6O6x45YQ/640?wx_fmt=png"></figure><h3><span>seq-ImmuCC的注意事项</span></h3><p>第一，这个是不是就是CIBERSORT方法呢？<br>因为我看到作者提供了一份不一样的免疫特征矩阵<br></p><figure><img data-ratio="0.40632054176072235" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicZjiciabrOzl5yk6BF4DFDmlZomicOUXYJ7iaicwO2GoUOCxF6FXiaUicHUlbw/640?wx_fmt=png" data-type="png" data-w="886" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicZjiciabrOzl5yk6BF4DFDmlZomicOUXYJ7iaicwO2GoUOCxF6FXiaUicHUlbw/640?wx_fmt=png"></figure><p>所以我用同样的数据测试了一下</p><pre><code><span>source</span>(<span>"CIBERSORT/CIBERSORT.R"</span>) <br>sig_matrix &lt;- <span>"sig_mouse_RNAseq.txt"</span><br>mixture_file = <span>'exprMat_RNAseq.txt'</span><br>res_cibersort &lt;- CIBERSORT(sig_matrix, mixture_file, perm=<span>100</span>, QN=<span>F</span>)<br></code></pre><p>总体差不多，些许不一样，所以，他没有用CIBERSORT函数<br></p><figure><img data-ratio="0.61875" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOiczttcJn8wAL7rJLUXy3YKKUQkeuWvJH7LaYia5mFric9LKhSFshYPB31A/640?wx_fmt=png" data-type="png" data-w="1280" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOiczttcJn8wAL7rJLUXy3YKKUQkeuWvJH7LaYia5mFric9LKhSFshYPB31A/640?wx_fmt=png"></figure><p>第二，自己如何准备测序数据？<br>作者写了很详细的文档，<br>从rawdata开始一直到得到counts数据，对的，输入的是counts数据<br>并且不支持其他数据。<br>这里给出了教程<br>http://218.4.234.74:3200/immune/manual<br>这里给出了从头到尾的脚本<br>https://github.com/wuaipinglab/ImmuCC/blob/master/webserver/RNASeq_pipeline.sh<br>跟着他可以学一波小鼠的RNAs-seq上游分析。</p><p>对于基因 ID的要求也是有的。<br>芯片是ensemble，因为这个也同时支持芯片，芯片要求的entriz ID<br></p><figure><img data-ratio="0.33698296836982966" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicUUHrBkZXDYJgI8QmznMEellJOnXYje4flGWKhCyHTiccWQBNYBuQ3FQ/640?wx_fmt=png" data-type="png" data-w="822" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicUUHrBkZXDYJgI8QmznMEellJOnXYje4flGWKhCyHTiccWQBNYBuQ3FQ/640?wx_fmt=png"></figure><p>第三，为什么他的免疫特征中有一些我完全看不懂的基因？<br></p><figure><img data-ratio="0.46362649294245384" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicKP3RFQ1dA1sFyXrKfMicEXjYScs6jZyPwCIyORzejW3g6FJI8FPQ31Q/640?wx_fmt=png" data-type="png" data-w="921" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicKP3RFQ1dA1sFyXrKfMicEXjYScs6jZyPwCIyORzejW3g6FJI8FPQ31Q/640?wx_fmt=png"></figure><p>这是因为他用这个表示不同的免疫受体。是不能删除的。<br>那么如何在自己准备的表达量矩阵中加上这个信息呢？<br>实际上只要按照之前的RNAseq流程做，他给了代码，自动完成的。</p><p>处理过程是这样的。<br>首先他准备了一些免疫受体和对应的基因信息<br></p><figure><img data-ratio="0.3727865796831314" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicOsyBH22joayQfd1oW23fhZdjYLHTHDw0sEZPv4ebXSFM5cJrZG6YjA/640?wx_fmt=png" data-type="png" data-w="1073" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicOsyBH22joayQfd1oW23fhZdjYLHTHDw0sEZPv4ebXSFM5cJrZG6YjA/640?wx_fmt=png"></figure><p>然后他先提取出除了这些基因的其他基因矩阵。<br>然后处理剩下的矩阵，一个个受体处理<br>如果这个受体只有一个基因，就直接提取表达量<br>如果有多个基因，就求和。<br>最好把这些结果叠加到第一个矩阵上面去。<br>测试数据的末尾就是这样的<br></p><figure><img data-ratio="0.5752608047690015" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicmWZuIGNk7ZFfWiaCoYgH1sufCkvPlcsITFgz6y6js54SQxjUNjCTuEg/640?wx_fmt=png" data-type="png" data-w="671" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOicmWZuIGNk7ZFfWiaCoYgH1sufCkvPlcsITFgz6y6js54SQxjUNjCTuEg/640?wx_fmt=png"></figure><p>好了，今天就到了这里了，本次的处理过程和讲解会录制成课程。和CIBERSORT，ssGSEA，还有最后一期Xcell，一起更新答疑群里。<br>并不是讲完xcell这个系列就不更新了，而是可以先告一段落。<br>免疫浸润的事情，根本不可能结束，会有新的数据，新的方法不断涌现。</p><h3><span>究竟选哪个？</span></h3><p>这个问题把我问到了，每个方法都有缺点，但是我们不能停下来<br>芯片数据选ImmuCC，因为细胞类型多<br>测序数据选seq-ImmuCC，结果更可靠。</p><p>但是，只要我们关注的不是那种若有若无的差异，那么选哪个其实不重要。<br>像这样的结果，我们已经比较过了，得到的结论是一样的。<br></p><figure><img data-ratio="0.61875" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOiczttcJn8wAL7rJLUXy3YKKUQkeuWvJH7LaYia5mFric9LKhSFshYPB31A/640?wx_fmt=png" data-type="png" data-w="1280" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX3KDpZfQicr2VOzHdARUdbOiczttcJn8wAL7rJLUXy3YKKUQkeuWvJH7LaYia5mFric9LKhSFshYPB31A/640?wx_fmt=png"></figure><p>这也是我一贯的理念：<br>真正的金子，在哪都发光，<br>真正的差异，肉眼就可见。<br>尤其是Western Blot，统计出来的差异，让之后的操作战战兢兢。</p><p>好了，如果要听课，那么就点击阅读原文吧。<br>有些人的学习，是不能有声音的，他们听到别人的声音就会瞌睡。<br>有些人的学习，更习惯有个人在旁边讲解，哪怕他就是在说白话，而我就属于后者。</p><p>这两种学习方法，没有好坏，只是不同。</p></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/DDZ9i9F7gWxbzcm1wVULJg",target="_blank" rel="noopener noreferrer">原文链接</a>
