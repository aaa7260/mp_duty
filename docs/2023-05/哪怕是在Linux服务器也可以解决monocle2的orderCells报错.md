---
title: "哪怕是在Linux服务器也可以解决monocle2的orderCells报错"
date: 2023-05-07T14:37:42Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
哪怕是在Linux服务器也可以解决monocle2的orderCells报错 by 单细胞天地
------
<div><section powered-by="xiumi.us"><section><section><section><img data-ratio="0.91875" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wztsZWIld4dbSAHficyAXWgkicrhjjacU8Ey0UKM56qbSnedHStMqWUfTPQxbqxNTVZy1g59nNW3BSg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="jpeg" data-w="640" src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wztsZWIld4dbSAHficyAXWgkicrhjjacU8Ey0UKM56qbSnedHStMqWUfTPQxbqxNTVZy1g59nNW3BSg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section><span title="" opera-tn-ra-cell="_$.pages:0.layers:0.comps:0.title1"><p><br></p></span></section><section><section powered-by="xiumi.us"><p>        这个monocle2的orderCells报错我们已经多次分享了，无非就是R包升级导致的问题，见：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247517444&amp;idx=1&amp;sn=d178aee4969fe48103d6929db5fd4b1d&amp;chksm=9b4bc5bfac3c4ca9670ed59cd3214e43d9298cf11b429d6bbf5f8b1b0c591fce2748690dcaed&amp;scene=21#wechat_redirect" textvalue="解决monocle中orderCells报错的一波三折" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">解决monocle中orderCells报错的一波三折</a>，如果是在个人电脑，无论是Mac还是Windows我们很容易跟着上面的教程解决这个monocle2的orderCells报错，但是很多小伙伴是在Linux环境的服务器使用monocle2，因为拟时序分析非常耗费计算机资源。<strong>但是好多人在Linux环境下面很难个性化自定义自己的数据分析环境，所以求助了我们“人美心善”的管理员</strong></p></section></section></section><section powered-by="xiumi.us"><section data-tools="新媒体排版" data-id="763890" data-style-type="undefined"><section placeholder="请输入标题"><span>下面是共享服务器的管理员的整理和分享</span><span></span></section></section></section><article tabindex="0"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">最近很多小伙伴在使用服务器的Rstudio运行 monocle的 orderCells报错，如下所示：</p></section><p><br></p><p><img data-ratio="0.1410488245931284" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7TcTRYMc3JDBIQ3DTMpKIrOaOaqlaicSVItacnFJe8sGRzKY1AwNWHUHCg/640?wx_fmt=png" data-type="png" data-w="553" width="553" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7TcTRYMc3JDBIQ3DTMpKIrOaOaqlaicSVItacnFJe8sGRzKY1AwNWHUHCg/640?wx_fmt=png"></p><span ne-filler="block"></span><ne-h3 data-lake-id="zPweo"><ne-heading-ext><ne-heading-anchor><span></span></ne-heading-anchor><ne-heading-fold><p><span></span></p></ne-heading-fold></ne-heading-ext><ne-heading-content><ne-text>方法：</ne-text><span> </span></ne-heading-content></ne-h3><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">这是 monocle 本身的版本或者 R语言版本更新导致函数不兼容，具体表现是 orderCells() 函数涉及一句判断语句：</p><pre data-tool="mdnice编辑器"><span></span><code>Error <span>in</span> <span>if</span> (class(projection) != <span>"matrix"</span>) projection &lt;- as.matrix(projection) : <br>  the condition has length &gt; 1<br></code></pre><p data-tool="mdnice编辑器">这是版本不兼容导致的：</p><pre data-tool="mdnice编辑器"><span></span><code> projection &lt;- rbind(projection, tmp)        -&gt; <span>"matrix"</span>, <span>"array"</span><br>  <span>if</span>(class(projection) != <span>'matrix'</span>)                 -&gt; error<br>    projection &lt;- as.matrix(projection)<br></code></pre><p data-tool="mdnice编辑器"><br></p><p data-tool="mdnice编辑器">简单的搜索一下，发现在 github 上面已经有人提过 issue了，并且也有人给出了解决方法：https://github.com/cole-trapnell-lab/monocle-release/issues/434</p><p data-tool="mdnice编辑器"><br></p></section><ne-p data-lake-id="u9c45f12e"><ne-card data-card-name="image" data-card-type="inline" data-event-boundary="card"><p><br></p><p><img data-ratio="0.8674351585014409" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7Tcef0Dnpk63PjJ4CkMcEa2df1AL0490L82WibnRtGlVbRBicrlx6iaXBpEw/640?wx_fmt=png" data-type="png" data-w="1041" width="1041" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7Tcef0Dnpk63PjJ4CkMcEa2df1AL0490L82WibnRtGlVbRBicrlx6iaXBpEw/640?wx_fmt=png"></p></ne-card><span ne-filler="block"></span></ne-p><ne-p data-lake-id="u88a59614"><span> </span></ne-p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">因此只需要在你的Linux服务器里面使用最简单的wget命令来下载这个安装包，然后安装一下即可：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 先在命令行 wget 安装包</span><br><span>cd</span> ~/<br>wget -c https://github.com/cole-trapnell-lab/monocle-release/files/10134172/monocle_2.26.0.tar.gz<br></code></pre><p data-tool="mdnice编辑器">然后再在 Rstudio 上安装，采用源码安装的方式：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 先检查自己的R包路径</span><br>.libPaths()<br><span># 设置R包路径，因为这个包还依赖其他包，添加上服务器的公共R包路径"/home/data/refdir/Rlib/"，就不用重复安装依赖包了。</span><br>.libPaths(c(<span>"~/R/x86_64-pc-linux-gnu-library/4.2"</span>, <span>"/usr/local/lib/R/library"</span>, <span>"/home/data/refdir/Rlib/"</span>))<br><span># 源码安装：</span><br>。<br><span># 安装成功后，在服务器 Rstudio 加载该包即可，先不加载原先的monocle，：</span><br>detach(<span>"package:monocle"</span>, unload = TRUE)<br><span># 重新加载即可</span><br>library(monocle)<br></code></pre><p data-tool="mdnice编辑器">（PS: 如果你的服务器没有存储的公共R包，需要自己先手动慢慢安装这个monocle_2.26.0.tar.gz 依赖的各种其它包）</p><p data-tool="mdnice编辑器">如果分不清重新加载是加载哪个版本，也可以在 Rstudio 右下角窗口找到自己安装的 monocle，打上勾即可：</p></section><p><ne-p data-lake-id="u88a59614"><span><img data-ratio="0.6907407407407408" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7Tck0iaibLf2QNicQKyzRV3heHpiaHnXu9g09e2WpwCmhtD34EicO3A4Oaic1zw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7Tck0iaibLf2QNicQKyzRV3heHpiaHnXu9g09e2WpwCmhtD34EicO3A4Oaic1zw/640?wx_fmt=png"></span></ne-p></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">安装好了打补丁的包之后，重新 run拟时序代码 就不报错了，可能有 warning，但影响不大：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; cds &lt;- orderCells(cds)<br>Warning messages:<br>1: In graph.dfs(dp_mst, root = root_cell, neimode = <span>"all"</span>, unreachable = FALSE,  :<br>  Argument `neimode<span>' is deprecated; use `mode'</span> instead<br>2: In graph.dfs(dp_mst, root = root_cell, neimode = <span>"all"</span>, unreachable = FALSE,  :<br>  Argument `neimode<span>' is deprecated; use `mode'</span> instead<br></code></pre></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">前面的教程：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247509858&amp;idx=2&amp;sn=476461cd7b7b77febf32b14884bb7b6d&amp;scene=21#wechat_redirect" data-linktype="2">拟时序分析就是差异分析的细节剖析</a>，我们展现了一个表达量矩阵如何去走<strong>Monocle2分析</strong>，通常我们的表达量矩阵在seurat对象里面， 首先导出，然后构建Monocle2对象，过滤细胞，选择基因，然后降维的时候选择默认DDRTree算法即可。 大家可以赶快试试看哈。</p><p data-tool="mdnice编辑器">比如可以参考https://bookdown.org/ytliu13207/SingleCellMultiOmicsDataAnalysis/monocle2.html 跑拟时序：</p><p><img data-galleryid="" data-ratio="0.825" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7TcrdRa5plQp1lYiaycJnl2qMgXZbnkJYncwO6Uxibq8ZRwkVKbicW4KIHfQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7TcrdRa5plQp1lYiaycJnl2qMgXZbnkJYncwO6Uxibq8ZRwkVKbicW4KIHfQ/640?wx_fmt=png"></p><p data-tool="mdnice编辑器">然后进行如下所示可视化：</p><ul><li><p>Visualize meta info</p></li></ul><p><span></span></p><pre><code><span>monocle<span>::</span><span>plot_cell_trajectory</span>(cds, <span>color_by =</span> <span>"cluster"</span>)</span></code></pre><p><img data-galleryid="" data-ratio="0.7648148148148148" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7Tcel8IhZzpPdzp1rAokO05xNzBOxkInib0WYlzL8dzfE7WESLUJCvhEFQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7Tcel8IhZzpPdzp1rAokO05xNzBOxkInib0WYlzL8dzfE7WESLUJCvhEFQ/640?wx_fmt=png"></p><p><span></span></p><pre><code><span>monocle<span>::</span><span>plot_cell_trajectory</span>(cds, <span>color_by =</span> <span>"cluster"</span>)  <span>+</span> <span>facet_wrap</span>(<span>~</span>cluster)</span></code></pre><p><img data-galleryid="" data-ratio="0.712037037037037" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7TcianrRLla5Igib9Cujhgw74ksQibvibOx4iczVfWib2TfyyZHkFlv3ibYuxGEA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7TcianrRLla5Igib9Cujhgw74ksQibvibOx4iczVfWib2TfyyZHkFlv3ibYuxGEA/640?wx_fmt=png"></p><p><span></span></p><pre><code><span>monocle<span>::</span><span>plot_cell_trajectory</span>(cds, <span>color_by =</span> <span>"State"</span>)</span></code></pre><p><img data-galleryid="" data-ratio="0.7703703703703704" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7TcAuABhLcAgdqeuyxWgu2ibADT2Xib5HnDcSicEyGALgCaJ1vwcDsDL7ehQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7TcAuABhLcAgdqeuyxWgu2ibADT2Xib5HnDcSicEyGALgCaJ1vwcDsDL7ehQ/640?wx_fmt=png"></p><p><span></span></p><pre><code><span>monocle<span>::</span><span>plot_cell_trajectory</span>(cds, <span>color_by =</span> <span>"State"</span>) <span>+</span> <span>facet_wrap</span>(<span>~</span>State)</span></code></pre><p><img data-galleryid="" data-ratio="0.7425925925925926" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7Tc1sIRd0P9mlor3BZvdJ3OMOnOQiakDXZQicbUQPfkazIqia6RBTyI9ibOvQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7Tc1sIRd0P9mlor3BZvdJ3OMOnOQiakDXZQicbUQPfkazIqia6RBTyI9ibOvQ/640?wx_fmt=png"></p><p><span></span></p><pre><code><span>monocle<span>::</span><span>plot_cell_trajectory</span>(cds, <span>color_by =</span> <span>"Pseudotime"</span>)</span></code></pre><p><br></p><ul><li><p>Visualize gene expression</p></li></ul><p><span></span></p><pre><code><span>my_genes <span>&lt;-</span> <span>c</span>(<span>"HOPX"</span>, <span>"MKI67"</span>, <span>"EOMES"</span>, <span>"NEUROD2"</span>, <span>"SATB2"</span>)</span><br><span>cds_subset <span>&lt;-</span> cds[my_genes,]</span><br><span><span>plot_genes_in_pseudotime</span>(cds_subset, <span>color_by =</span> <span>"cluster"</span>)</span></code></pre><p><br></p><p><img data-galleryid="" data-ratio="0.8481481481481481" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7TcibaCex84mNoa7vM7LPOdwrYr05ol10qtVpe2pK8hd9T8b391kGXDZEw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqKXR0xuqFlMm0K6YXv7TcibaCex84mNoa7vM7LPOdwrYr05ol10qtVpe2pK8hd9T8b391kGXDZEw/640?wx_fmt=png"></p><p data-tool="mdnice编辑器"><br></p></section></article><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/1IJflbVgRVIoJ238DcUsKA",target="_blank" rel="noopener noreferrer">原文链接</a>
