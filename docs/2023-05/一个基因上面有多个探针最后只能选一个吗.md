---
title: "一个基因上面有多个探针最后只能选一个吗"
date: 2023-05-03T00:59:36Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
一个基因上面有多个探针最后只能选一个吗 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>最近学员提出来了一个蛮古老的表达量芯片数据集的讨论，因为 它是做了这个PPARα的基因敲除，但是学员在分析表达量矩阵做差异的时候发现PPARα本身其实并没有统计学显著的差异表达。</p></blockquote><p data-tool="mdnice编辑器">数据集是：https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE8292</p><p data-tool="mdnice编辑器">学员选取的样品是control条件下，而不是 a single dose of WY14643 (400 μl of 10 mg/ml WY14643)  药物处理的 ：</p><pre data-tool="mdnice编辑器"><span></span><code>GSM205769 liver_wildtype_WY14643_6h_rep1<br>GSM205770 liver_wildtype_WY14643_6h_rep2<br>GSM205771 liver_wildtype_WY14643_6h_rep3<br>GSM205772 liver_wildtype_WY14643_6h_rep4 <br>GSM205778 liver_PPARa-knockout_WY14643_6h_rep1<br>GSM205779 liver_PPARa-knockout_WY14643_6h_rep2<br>GSM205780 liver_PPARa-knockout_WY14643_6h_rep3<br>GSM205781 liver_PPARa-knockout_WY14643_6h_rep4<br>GSM205782 liver_PPARa-knockout_WY14643_6h_rep5<br></code></pre><p data-tool="mdnice编辑器">同样的control条件下，我们比较 野生型和PPARα的基因敲除两个分组， 理论上肯定是表达量有统计学显著的差异。</p><h3 data-tool="mdnice编辑器"><span></span>首先整理基因芯片表达量矩阵和探针注释以及分组信息<span></span></h3><p data-tool="mdnice编辑器">如下所示的标准代码：</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())  <span>## 魔幻操作，一键清空~</span><br>options(stringsAsFactors = <span>F</span>)<br><br>getOption(<span>'timeout'</span>)<br>options(timeout=<span>10000</span>)<br><br><span>library</span>(AnnoProbe)<br><span>library</span>(GEOquery) <br>gset &lt;- geoChina(<span>"GSE8292"</span>)<br>gset<br>gset[[<span>1</span>]]<br>a=gset[[<span>1</span>]] <span>#</span><br>dat=exprs(a) <span>#a现在是一个对象，取a这个对象通过看说明书知道要用exprs这个函数</span><br>dim(dat)<span>#看一下dat这个矩阵的维度 </span><br>dat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>] <span>#查看dat这个矩阵的1至4行和1至4列，逗号前为行，逗号后为列</span><br>boxplot(dat[,<span>1</span>:<span>4</span>],las=<span>2</span>)  <br><br> <br>dat=log2(dat)<br>boxplot(dat[,<span>1</span>:<span>4</span>],las=<span>2</span>)  <br><span>library</span>(limma)<br>dat=normalizeBetweenArrays(dat)<br>boxplot(dat[,<span>1</span>:<span>4</span>],las=<span>2</span>)  <br>pd=pData(a) <br><br><span>#通过查看说明书知道取对象a里的临床信息用pData</span><br><span>## 挑选一些感兴趣的临床表型。</span><br><span>library</span>(stringr) <br><span># pd=pd[1:43,]</span><br><span># dat=dat[,1:43]</span><br>phe=pd <br><span># 这里一定要人工干预，每个数据集项目的分组不一样</span><br><span># 是主观判断，自己选择 </span><br><br><span># 比如这里我们仅仅是关心 没有药物处理的</span><br>kp=grepl(<span>'control'</span>,phe$title)<br>table(kp)<br>phe=phe[kp,]<br>dat=dat[,kp] <br>group_list=ifelse(grepl(<span>'wildtype'</span>,phe$title),<span>'WT'</span>,<span>'KO'</span>)<br>table(group_list)<br> <br>dat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]  <br>dim(dat)<br>a  <br>ids=idmap(<span>'GPL1261'</span>,<span>'soft'</span>)<br>head(ids)<br>ids=ids[ids$symbol != <span>''</span>,]<br>cg=dat[ids[ids$symbol==<span>'Ppara'</span>,<span>1</span>],]<br>boxplot(cg[<span>1</span>,] ~ group_list)<br>boxplot(cg[<span>2</span>,] ~ group_list)<br>boxplot(cg[<span>3</span>,] ~ group_list)<br>save(dat,group_list,ids,file = <span>'before_remove_dup_id.Rdata'</span>)<br></code></pre><p data-tool="mdnice编辑器">可以看到这个 PPARα 基因其实有3个对应的探针 ：</p><p><img data-galleryid="" data-ratio="1.237082066869301" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxseRRuGRtXbxMWE9jCHRUoswiaLgCXB8L28ic1exGiaYpNU18fLLulibPl6dznrZPM06gJ9tWEd5F1TQ/640?wx_fmt=png" data-type="png" data-w="658" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxseRRuGRtXbxMWE9jCHRUoswiaLgCXB8L28ic1exGiaYpNU18fLLulibPl6dznrZPM06gJ9tWEd5F1TQ/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>PPARα 基因其实有3个对应的探针</figcaption></figure><p data-tool="mdnice编辑器">我们授课提到的默认流程是，多个探针就选取表达量最大的探针作为这个基因的代表即可，所以如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><br>dat=dat[rownames(dat) %<span>in</span>% ids$ID,]<br>ids=ids[match(rownames(dat),ids$ID),]<br>head(ids) <br>colnames(ids)=c(<span>'probe_id'</span>,<span>'symbol'</span>)  <br>ids$probe_id=as.character(ids$probe_id)<br>rownames(dat)=ids$probe_id<br>dat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>] <br><br>ids=ids[ids$probe_id %<span>in</span>%  rownames(dat),]<br>dat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]   <br>dat=dat[ids$probe_id,] <br><br>ids$median=apply(dat,<span>1</span>,median) <span>#ids新建median这一列，列名为median，同时对dat这个矩阵按行操作，取每一行的中位数，将结果给到median这一列的每一行</span><br>ids=ids[order(ids$symbol,ids$median,decreasing = <span>T</span>),]<span>#对ids$symbol按照ids$median中位数从大到小排列的顺序排序，将对应的行赋值为一个新的ids</span><br>ids=ids[!duplicated(ids$symbol),]<span>#将symbol这一列取取出重复项，'!'为否，即取出不重复的项，去除重复的gene ，保留每个基因最大表达量结果s</span><br>dat=dat[ids$probe_id,] <span>#新的ids取出probe_id这一列，将dat按照取出的这一列中的每一行组成一个新的dat</span><br>rownames(dat)=ids$symbol<span>#把ids的symbol这一列中的每一行给dat作为dat的行名</span><br>dat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]  <span>#保留每个基因ID第一次出现的信息</span><br><br>dat[<span>'Actb'</span>,]<br>dat[<span>'Gapdh'</span>,]<br>save(dat,group_list,phe,file = <span>'step1-output.Rdata'</span>)<br></code></pre><p data-tool="mdnice编辑器">这个时候默认进行表达量矩阵质量控制，进行差异分析，代码很常规就不列出来了。主成分图，热图，火山图，都挺好的：</p><p><img data-galleryid="" data-ratio="0.9854910714285714" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxseRRuGRtXbxMWE9jCHRUoGSyANFVs3m3iabQs4QGYatOeKpFhG7ZTAFlodUzV3Vic70lfRvb6j4zg/640?wx_fmt=png" data-type="png" data-w="1792" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxseRRuGRtXbxMWE9jCHRUoGSyANFVs3m3iabQs4QGYatOeKpFhG7ZTAFlodUzV3Vic70lfRvb6j4zg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>火山图</figcaption></figure><p data-tool="mdnice编辑器">但是可以看到：</p><pre data-tool="mdnice编辑器"><span></span><code><span>source</span>(<span>'step2-check.R'</span>)<br><span>source</span>(<span>'step3-DEG.R'</span>) <br>load(<span>'deg.Rdata'</span>)<br>deg[<span>'Ppara'</span>,]<br></code></pre><p data-tool="mdnice编辑器">这个基因虽然在敲除的组里面确实是表达量下降了，但是居然统计学不显著，在边缘疯狂试探 ：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; deg[<span>'Ppara'</span>,]<br>          logFC  AveExpr        t    P.Value adj.P.Val<br>Ppara -0.4464635 10.28399 2.079013 0.06913026 0.3137238<br></code></pre><p data-tool="mdnice编辑器">但是，如果我们前面并不进行基因的探针过滤步骤，直接进行差异分析，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())  <span>## 魔幻操作，一键清空~</span><br>options(stringsAsFactors = <span>F</span>)<br>load(file = <span>'before_remove_dup_id.Rdata'</span>)<br><br><span>library</span>(limma)<br>design=model.matrix(~factor( group_list ,levels = c(<span>'WT'</span>,<span>'KO'</span>)))<br>fit=lmFit(dat,design)<br>fit=eBayes(fit)<br><span>## 上面是limma包用法的一种方式 </span><br>options(digits = <span>4</span>) <span>#设置全局的数字有效位数为4</span><br><span>#topTable(fit,coef=2,adjust='BH') </span><br>deg = topTable(fit,coef=<span>2</span>,adjust=<span>'BH'</span>, n=<span>Inf</span>) <br>deg[ids[ids$symbol==<span>'Ppara'</span>,<span>1</span>],]<br><br></code></pre><p data-tool="mdnice编辑器">可以看到，这个基因的3个探针，都显示出来了：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; deg[ids[ids<span>$symbol</span>==<span>'Ppara'</span>,1],]<br>             logFC AveExpr      t   P.Value adj.P.Val      B<br>1439675_at -0.4465  10.284 -2.068 7.030e-02  0.331133 -4.956<br>1449051_at -1.0463   9.057 -3.883 4.126e-03  0.086350 -2.107<br>1457721_at -1.7000   7.427 -8.500 1.918e-05  0.003281  3.427<br></code></pre><p data-tool="mdnice编辑器">如果多个探针就选取表达量最大的探针作为这个基因的代表即可，我们针对这个Ppara 就会挑选到1439675_at这个探针，以至于它虽然下调，但是并不达标。</p><p data-tool="mdnice编辑器">但是如果选择了 1457721_at这个探针，作为Ppara基因的代表，它就比较好的下调啦。</p><h3 data-tool="mdnice编辑器"><span></span>几个思考<span></span></h3><p data-tool="mdnice编辑器">选取表达量最大的探针作为这个基因的代表合理吗？</p><p data-tool="mdnice编辑器">PPARα的基因敲除意味着表达量芯片或者转录组测序里面，它表达量都会下降吗？</p><h3 data-tool="mdnice编辑器"><span></span>学徒作业<span></span></h3><p data-tool="mdnice编辑器">找到同一个基因敲除的表达量芯片和转录组测序数据，一般来说只能是从明显基因里面找啦，下载其对应的表达量芯片和转录组测序数据做差异分析，看看作者敲除的基因是否确实有表达量下降的情况发生！</p></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/qed6aOm1A1gKLeGaLEWqOg",target="_blank" rel="noopener noreferrer">原文链接</a>
