---
title: "浅谈R中相关性网络热图绘制小细节"
date: 2023-05-05T12:35:58Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
浅谈R中相关性网络热图绘制小细节 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>最近在绘制相关性网络热图的时候突然有一个小的发现，可以使用相关性热图的数据来结合<strong>「linkET」</strong>来绘图，以前一直认为为必须使用<strong>「mantel_test」</strong>才行；果然绘图还得多思考；本节就来通过一个案例将两份数据结合起来进行绘图；<strong>「数据+代码已经上传VIP群，加群的观众老爷请自行下载」</strong></p><span>❞</span></blockquote><blockquote data-tool="mdnice编辑器"><span>❝</span><p><code>有需要学习数据可视化的朋友欢迎加入小编2022年度VIP群</code>，目前群内已经上传公众号文档<strong>「数据+代码约260篇」</strong>，<code>VIP交流群(1)已经500人满员</code>,随着内容不断增多，为了更好的创做内容现在进群需<strong>「付费149元」</strong> 双十一临近小编也做一波优惠活动 <strong>「从即日起至11月底无需转发文档到朋友圈积赞，可直接已129元的价格入群」</strong></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺个性化绘图服务</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>最近有部分观众老爷找小编做个性化绘图，为了给观众老爷提供更加优质的服务；小编开通了 <strong>「淘宝店铺(R语言数据分析指南)」</strong> ，有特殊绘图需求的欢迎关注咨询(<strong>「由于小编时间精力有限有需求的请及时下单」</strong>)</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(linkET)<br><span>library</span>(RColorBrewer)<br><span>library</span>(ggtext)<br><span>library</span>(magrittr)<br><span>library</span>(psych)<br><span>library</span>(reshape)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>table1 &lt;- read.delim(<span>"env.xls"</span>,header =<span>T</span>,sep=<span>"\t"</span>,row.names = <span>1</span>,check.names = <span>F</span>)<br><br>table2 &lt;- read.delim(<span>"genus.xls"</span>,header =<span>T</span>,sep=<span>"\t"</span>,row.names = <span>1</span>,check.names = <span>F</span>) %&gt;% <br>  t() %&gt;% as.data.frame()<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>相关性分析</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>pp &lt;- corr.test(table1,table2,method=<span>"pearson"</span>,adjust = <span>"fdr"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>整合数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>cor &lt;- pp$r<br>pvalue &lt;- pp$p<br><br>df &lt;- melt(cor) %&gt;% mutate(pvalue=melt(pvalue)[,<span>3</span>],<br>                     p_signif=symnum(pvalue, corr = <span>FALSE</span>, na = <span>FALSE</span>,  <br>                                     cutpoints = c(<span>0</span>, <span>0.001</span>, <span>0.01</span>, <span>0.05</span>, <span>0.1</span>, <span>1</span>), <br>                                     symbols = c(<span>"***"</span>, <span>"**"</span>, <span>"*"</span>, <span>""</span>, <span>" "</span>))) %&gt;% <br>  set_colnames(c(<span>"env"</span>,<span>"genus"</span>,<span>"r"</span>,<span>"p"</span>,<span>"p_signif"</span>))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>转换数据格式</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>在此处以前一直以为必须使用<strong>「linkET::mantel_test」</strong>函数生成特定格式才能用于后面绘图，直到某次看了数据才明白导入外部的相关性分析数据也能用于后期绘图；此处的范围可根据需要自定义</p><span>❞</span></blockquote><pre data-tool="mdnice编辑器"><span></span><code>cordata &lt;- df %&gt;% left_join(.,read_tsv(<span>'annotation.xls'</span>),by=c(<span>"genus"</span>)) %&gt;% <br>  select(group,env:p,-genus) %&gt;% <br>  set_colnames(c(<span>"spc"</span>,<span>"env"</span>,<span>"r"</span>,<span>"p"</span>)) %&gt;% <br>  mutate(rd = cut(r, breaks = c(-<span>Inf</span>, <span>0</span>, <span>0.4</span>, <span>Inf</span>),<br>                  labels = c(<span>"&lt; 0"</span>, <span>"0 - 0.4"</span>, <span>"&gt;= 0.4"</span>)),<br>         pd = cut(p, breaks = c(-<span>Inf</span>, <span>0.01</span>, <span>0.05</span>, <span>Inf</span>),<br>                  labels = c(<span>"&lt; 0.01"</span>, <span>"0.01 - 0.05"</span>, <span>"&gt;= 0.05"</span>)))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>绘制相关性网络图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>qcorrplot(correlate(table1,method = <span>"spearman"</span>),diag=<span>F</span>,type=<span>"upper"</span>)+<br>  geom_tile()+<br>  geom_mark(size=<span>2.5</span>,sig.thres=<span>0.05</span>,sep=<span>"\n"</span>)+<br>  geom_couple(aes(colour=pd,size=rd),data=cordata,label.colour = <span>"black"</span>,<br>              curvature=nice_curvature(<span>0.15</span>),<br>              nudge_x=<span>0.2</span>,<br>              label.fontface=<span>2</span>,<br>              label.size =<span>4</span>,<br>              drop = <span>T</span>)+<br>  scale_fill_gradientn(colours = RColorBrewer::brewer.pal(<span>11</span>,<span>"RdBu"</span>))+<br>  scale_size_manual(values = c(<span>0.5</span>, <span>1</span>, <span>2</span>)) +<br>  scale_colour_manual(values =c(<span>"#D95F02"</span>,<span>"#1B9E77"</span>,<span>"#A2A2A288"</span>)) +<br>  guides(size = guide_legend(title = <span>"cor"</span>,override.aes = list(colour = <span>"grey35"</span>), order = <span>2</span>),<br>         colour = guide_legend(title = <span>"P_value"</span>,override.aes = list(size = <span>3</span>), order = <span>1</span>),<br>         fill = guide_colorbar(title = <span>"spearman's r"</span>,order = <span>3</span>))+<br>  theme(plot.margin = unit(c(<span>0</span>,<span>0</span>,<span>0</span>,-<span>1</span>),units=<span>"cm"</span>),<br>        panel.background = element_blank(),<br>        axis.text=element_markdown(color=<span>"black"</span>,size=<span>10</span>),<br>        legend.background = element_blank(),<br>        legend.key = element_blank())<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7090909090909091" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCjicedoVlJBKr6uc1HwkPeDJ8NVkXnKv5ibrtJEzf7ZQWRzuEZ1P8hCpXI44RNs2wwXRuYknxNG4w/640?wx_fmt=png" data-type="png" data-w="1045" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCjicedoVlJBKr6uc1HwkPeDJ8NVkXnKv5ibrtJEzf7ZQWRzuEZ1P8hCpXI44RNs2wwXRuYknxNG4w/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节介绍到此结束，喜欢的观众老爷欢迎分享转发；<strong>「当然更推荐大家加入我的VIP交流群」</strong>扫描下方二维码加小编微信<strong>「添加小编微信请备注来意，以便高效处理」</strong></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>小编微信</span><span></span></h3><p><img data-galleryid="" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg" data-type="jpeg" data-w="430" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile><p><br></p><section><section><section><section><p data-mid="">往期推荐</p></section></section><section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499659&amp;idx=1&amp;sn=e62ecf6601803b9b55feb5b4ee3bcc43&amp;chksm=cee2a715f9952e03e98e36df41f34d620bcff61470fe4d8d9dc0c3c085badae8032901d24963&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>ggplot2优雅的绘制组合版热图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499632&amp;idx=1&amp;sn=5c366cc5f193414e7baed41355aa51fb&amp;chksm=cee2a7eef9952ef8199b9c3680a35e39a1d3e5a463978d41e162d2c0277277cbb88d71ab7f68&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>ggraph快速绘制相关性网络图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499613&amp;idx=1&amp;sn=fef9aacaf90b8236b020df3340d0ae9a&amp;chksm=cee2a7c3f9952ed57af5882b474483b1a373994a9b311e10c037c663bce938c50c0e3b768f05&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>ggplot2分面图形自定义添加回归曲线R值</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499590&amp;idx=1&amp;sn=eff13988a69552451bdc3c91f8fe05f3&amp;chksm=cee2a7d8f9952ece3a8370c7d5f3f3eaf2b7dcc702ddfe0dc83f9a05abc14c89ddb46f5be1a4&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>[会员专享] ggraph绘制GO富集分析网络图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499488&amp;idx=1&amp;sn=4b64e4b183fd2d93ad55941adbb13da1&amp;chksm=cee2a67ef9952f68ff0e5394e272d0b9fcbd4ae1d3f6b87673f8e0651a58c4f876af17a92b29&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>通过ggplot2中stat_summary函数快速进行数据统计</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499544&amp;idx=1&amp;sn=a985f9cd1ae280b49de9ab381202b75d&amp;chksm=cee2a786f9952e9042d20a395c3d249c8d73d1809137f1ecf8b85ada0a9c736a6c91e991e5f7&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>揭秘ggh4x包的小妙用之绘制多重注释表</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499473&amp;idx=1&amp;sn=554ef292577419fef2da17f90436854b&amp;chksm=cee2a64ff9952f59a1b68e62877e5c00fbc93eb2449b4bc54f2fb0a1c86e239a3e845ed4ce05&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>[往期案例汇总] 9-10月公众号经典数据可视化案例汇总</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499355&amp;idx=1&amp;sn=8f8b82f3ffc12e728c844283d3887843&amp;chksm=cee2a6c5f9952fd329085597a6f74b05c09db2fd12359d7c99c06db67db27a088bf18b16b7f6&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>R中使用voronoiTreemap包轻松绘制圆形树状图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499327&amp;idx=1&amp;sn=a7fa052b36fdbe05f8b3d204a9805a36&amp;chksm=cee2a6a1f9952fb763ae177b8d7b2d8b21f702def211066996fffd6a83bb6e92c3b179d86a60&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>[GBD数据库挖掘] 10. ggplot2绘制组合版地图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499278&amp;idx=1&amp;sn=cccfaeb60c73055c737404f9f2a29a2b&amp;chksm=cee2a690f9952f86ec3c57cd2229ccba21f85c4d390b14badcee66b9e8c8cf2f6eb2a595f0df&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>[会员专享]ggplot2批量绘制蜂窝图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499160&amp;idx=1&amp;sn=39fd12e970aa73716e8169f5ee817450&amp;chksm=cee2a506f9952c100440c9dc451b815d89d9c425e3ab63b9705eec410b648155698952f26045&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>cowplot优雅的拼接相关性网络热图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499140&amp;idx=1&amp;sn=9b51a1e9c017b23530ccd1b022ece1ae&amp;chksm=cee2a51af9952c0ce879fddf86790b71ed16e6b0b0899e32cc151a48effa88300b5ab6fa0b2b&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>[会员专享] ggraph绘制层次结构网络图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499083&amp;idx=1&amp;sn=e79047969daffa6f203810c75b0aa8e7&amp;chksm=cee2a5d5f9952cc3ff6b4362de6d96d244f5288b6c6ea1f4dc867ebbe9e2a0d305e52e0f4693&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>ggplot2绘图添加显著性标记必知细节</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499061&amp;idx=1&amp;sn=19fe76fa4c488d9198de39049c3907a2&amp;chksm=cee2a5abf9952cbd9570a9402a106e1711f66dca88021d25849e920acd7c3ca7590c6a104454&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>浅谈ggplot2拼图必知的一些小细节</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247499020&amp;idx=1&amp;sn=e32f2318a98f1db01d5bce97292dd8b6&amp;chksm=cee2a592f9952c849d98defffcc4b8f75e1ec8b9775e80750f80945ceb4ebddf84ba8e96e22d&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>[会员专享] circlize自定义绘制多组和弦图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498971&amp;idx=1&amp;sn=ae2cd964f4e1c9af50648dc79ba3751e&amp;chksm=cee2a445f9952d53d05b8383617fddded8d50e396cab64d17e8f7abe31c4b609c9b120d0d979&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>ggplot2优雅的给环状条形图添加新元素</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498953&amp;idx=1&amp;sn=e9431f9a9915816a9d69e5b625401786&amp;chksm=cee2a457f9952d4171cf0f356ffd7efcaa6ac1044f005d516222a030affb2ea7c06d80c5749f&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>ggtree优雅的绘制环状堆砌条形图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498929&amp;idx=1&amp;sn=dee541efc09db2dc978e7f303bfd9bcf&amp;chksm=cee2a42ff9952d39ea985ab4914975085719163894a2069a9a08fb8c02a0c1031ef745be6c86&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>ggbreak优雅的截断坐标轴</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498910&amp;idx=1&amp;sn=5edde61114b0c3ed20fb76817d675047&amp;chksm=cee2a400f9952d16438690987ded4239fc7e07d49ae521eb22a9aefdd02932ab12c9e934979a&amp;scene=21#wechat_redirect" data-linktype="2"><section><p>[会员专享]ggplot2优雅绘制环状相关性热图</p></section></a></section><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498861&amp;idx=1&amp;sn=fac22cef830567ffa26fcda705fa306b&amp;chksm=cee2a4f3f9952de58fd93b82cc2418f42ae1f90cbbd9940c257573b36d7910445ef63bb99de9&amp;scene=21#wechat_redirect" data-linktype="2"></a><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498861&amp;idx=1&amp;sn=fac22cef830567ffa26fcda705fa306b&amp;chksm=cee2a4f3f9952de58fd93b82cc2418f42ae1f90cbbd9940c257573b36d7910445ef63bb99de9&amp;scene=21#wechat_redirect" data-linktype="2"></a><p><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247498861&amp;idx=1&amp;sn=fac22cef830567ffa26fcda705fa306b&amp;chksm=cee2a4f3f9952de58fd93b82cc2418f42ae1f90cbbd9940c257573b36d7910445ef63bb99de9&amp;scene=21#wechat_redirect" data-linktype="2">ggplot2优雅的绘制堆砌金字塔图</a></p></section></section></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/SWh5rSRPy-eANw69x9hAdg",target="_blank" rel="noopener noreferrer">原文链接</a>
