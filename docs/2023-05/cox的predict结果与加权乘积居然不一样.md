---
title: "cox的predict结果与加权乘积居然不一样"
date: 2023-05-12T08:03:57Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
cox的predict结果与加权乘积居然不一样 by 生信星球
------
<div><section data-mpa-powered-by="yiban.io"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png"><span> 今天是生信星球陪你的<span><strong>第827天</strong></span></span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"></section><hr><section><span><span>   </span><span>大神一句话，菜鸟跑半年。我不是大神，但我可以缩短你走弯路的半年~</span></span></section><section><span>   就像歌儿唱的那样，如果你不知道该往哪儿走，就留在这学点生信好不好~</span></section><section><span>   这里有豆豆和花花的学习历程，从新手到进阶，生信路上有你有我!</span></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span>1.问题起源</span><span></span></h3><p data-tool="mdnice编辑器">predict的参数type默认值就是“lp”，代表线性模型，理论上和大量文章里描述的公式应该是结果相同的。比如这个：<img data-ratio="0.6448390677025527" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHp9BBot4ibpuMNCic4M7mUbqK7JPNwbPIZjf81WHGlOYgWTHj3xWxldHylhbjJiawYhWX29u6ZSox9Qg/640?wx_fmt=png" data-type="png" data-w="901" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHp9BBot4ibpuMNCic4M7mUbqK7JPNwbPIZjf81WHGlOYgWTHj3xWxldHylhbjJiawYhWX29u6ZSox9Qg/640?wx_fmt=png"></p><blockquote data-tool="mdnice编辑器"><p>https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8051731/</p></blockquote><p data-tool="mdnice编辑器">但是我突然发现他俩对不上号(⊙﹏⊙)</p><figure data-tool="mdnice编辑器"><img data-ratio="0.43125" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHp9BBot4ibpuMNCic4M7mUbqKwhDLsPLNbOfBbLic2PPyk7Ibrv5wPS7ibDcwGXkdS7QG4C83PG0unMQQ/640?wx_fmt=png" data-type="png" data-w="800" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHp9BBot4ibpuMNCic4M7mUbqKwhDLsPLNbOfBbLic2PPyk7Ibrv5wPS7ibDcwGXkdS7QG4C83PG0unMQQ/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>2.探索原因</span><span></span></h3><p data-tool="mdnice编辑器">没去搜索，直接发了个朋友圈，五分钟后收到了这个链接：</p><p data-tool="mdnice编辑器"><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzI0NjUyMTE2MQ==&amp;mid=2247483688&amp;idx=1&amp;sn=fc7bb8b944d749bcc5a728c9aaff7217&amp;scene=21#wechat_redirect" tab="innerlink" data-linktype="2">为何predict()函数计算的Riskscore不等于基因的表达量与其系数的乘积的加权呢?</a><br></p><figure data-tool="mdnice编辑器"><img data-ratio="0.12320916905444126" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHp9BBot4ibpuMNCic4M7mUbqKG3VsIndgEicDIUm1akI8Y7wQXibkCbSRA4Zn1q8Gv6XFbmSJp0DQnLgg/640?wx_fmt=png" data-type="png" data-w="698" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHp9BBot4ibpuMNCic4M7mUbqKG3VsIndgEicDIUm1akI8Y7wQXibkCbSRA4Zn1q8Gv6XFbmSJp0DQnLgg/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">哈哈！我神奇的朋友圈，真的是藏龙卧虎，这也是我解决困惑的基本操作，近水楼台先得月。而且在这个链接里找到了我的名字~美滋滋。</p><p data-tool="mdnice编辑器">简单来说，就是<strong>加权乘积比predict的预测结果多加了一个常数</strong>。</p><h3 data-tool="mdnice编辑器"><span></span><span>3.比较二者的结果</span><span></span></h3><p data-tool="mdnice编辑器">上文种已经对公式做了很好的推导，我用R语言完成一下咯：</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br>library(survival)<br>load(<span>"surv_model.Rdata"</span>)<br>names(model<span>$coefficients</span>)<br><br><span>##  [1] "HFE"     "SHISA5"  "BRCA1"   "EPM2A"   "ERLIN1"  "GPX7"    "SLN"    </span><br><span>##  [8] "DNAJB11" "MMP2"    "NOL3"    "CP"      "ATP2A2"  "GLA"     "MAPK3"  </span><br><span>## [15] "SREBF2"  "CASP2"   "SNCA"    "DDIT3"   "BAG1"    "ANXA5"</span><br><br>model<span>$coefficients</span><br><br><span>##        HFE     SHISA5      BRCA1      EPM2A     ERLIN1       GPX7        SLN </span><br><span>##  0.3024894  0.6928951  0.7909278 -0.5709679 -0.7810678  0.4341572 -0.1456389 </span><br><span>##    DNAJB11       MMP2       NOL3         CP     ATP2A2        GLA      MAPK3 </span><br><span>## -0.8620475  0.1276739  0.3153988  0.1535990  0.6495272  0.3665937  0.8236297 </span><br><span>##     SREBF2      CASP2       SNCA      DDIT3       BAG1      ANXA5 </span><br><span>## -0.4178062  0.3980908  0.1977293  0.1403852 -0.2884173  0.1684487</span><br><br>a = predict(model,surv1)<br><br>b = apply(surv1[,names(model<span>$coefficients</span>)], 1,<span>function</span>(k){<br>  sum(model<span>$coefficients</span> * k)<br>})<br><br>dat = data.frame(a,b,k = a-b)<br>head(dat)<br><br><span>##                         a        b         k</span><br><span>## TCGA-06-0878-01A 2.232431 12.03249 -9.800062</span><br><span>## TCGA-26-5135-01A 2.736399 12.53646 -9.800062</span><br><span>## TCGA-06-5859-01A 1.992062 11.79212 -9.800062</span><br><span>## TCGA-06-2563-01A 1.153412 10.95347 -9.800062</span><br><span>## TCGA-41-2571-01A 2.982385 12.78245 -9.800062</span><br><span>## TCGA-28-5207-01A 1.966414 11.76648 -9.800062</span><br><br>plot(a,b)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.714516129032258" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHp9BBot4ibpuMNCic4M7mUbqKm89DDwewJ19jp5FMcOfLV2MjsM0Eqycc2kJ40o3KS7iaVtY72omKz1g/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHp9BBot4ibpuMNCic4M7mUbqKm89DDwewJ19jp5FMcOfLV2MjsM0Eqycc2kJ40o3KS7iaVtY72omKz1g/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">a是predict计算的结果，b是加权乘积计算的结果。如果是lasso模型，这两个数值是一致的。但cox模型，确实不一致。</p><h3 data-tool="mdnice编辑器"><span></span><span>4.不擅长公式推导，勉强试试</span><span></span></h3><p data-tool="mdnice编辑器">需要认识一下R语言里的函数exp和log</p><pre data-tool="mdnice编辑器"><span></span><code>exp(1)<br><br><span>## [1] 2.718282</span><br><br>exp(10)<br><br><span>## [1] 22026.47</span><br><br><span>log</span>(exp(1))<br><br><span>## [1] 1</span><br><br><span>log</span>(exp(10))<br><br><span>## [1] 10</span><br></code></pre><p data-tool="mdnice编辑器">exp是自然常数e的指数运算，exp(n)就是e的n次方，log则是数学公式里的ln，取自然对数的意思，二者刚好可逆</p><p data-tool="mdnice编辑器">所以公式可以写作</p><pre data-tool="mdnice编辑器"><span></span><code>h(t,x) = h0(t)*exp(b)<br><span>log</span>(h(t,x))-<span>log</span>(h0(t)) = b<br></code></pre><p data-tool="mdnice编辑器">所以predict计算出的预测值a就是公式里的log(h(t,x))，而上面的a-b的差-9.800062这个数字，就是公式里的常数log(h0(t))咯。</p></section><section><figure><span></span></figure></section><section><blockquote><section>代码看不懂？来找我，系统学习：</section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247490554&amp;idx=2&amp;sn=12c1ad970911a283f71f559268282ff1&amp;chksm=fdf853b8ca8fdaae8b5432c82655492c882267f9a9c2bab2022eb2ed1d3d976c8eaa9fa93110&amp;scene=21#wechat_redirect" textvalue="生信零基础入门学习小组" data-itemshowtype="0" tab="innerlink" data-linktype="2"><strong>生信零基础入门学习小组</strong></a></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247490920&amp;idx=2&amp;sn=9f8bad0a2c6c6b64beb993d06f1a9852&amp;chksm=fdf8552aca8fdc3c46dec7a470c36cc8f317d96040b91919a6f31a3d52e611e5f3e21bc9b88d&amp;scene=21#wechat_redirect" textvalue="生信入门班（四周线上直播课，长期开班）" data-itemshowtype="11" tab="innerlink" data-linktype="2"><strong>生信入门班（四周线上直播课，长期开班）</strong></a></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247490920&amp;idx=1&amp;sn=b008d2695c9344b04d25aa7499805282&amp;chksm=fdf8552aca8fdc3c289a4229b935890b45634d5a0cca1eab207670928c03a51273812bbb3464&amp;scene=21#wechat_redirect" textvalue="数据挖掘班（医生/医学生首选，三周线上直播课，长期开班）" data-itemshowtype="11" tab="innerlink" data-linktype="2"><strong>数据挖掘班（医生/医学生首选，三周线上直播课，长期开班）</strong></a></section></blockquote></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/8wqpSzx_IdY3MglN7byuLA",target="_blank" rel="noopener noreferrer">原文链接</a>
