---
title: "学做NAR图表：ggraph做网络图"
date: 2023-05-17T04:11:07Z
draft: ["false"]
tags: [
  "fetched",
  "KS科研分享与服务"
]
categories: ["Acdemic"]
---
学做NAR图表：ggraph做网络图 by KS科研分享与服务
------
<div><p><span>觉得小编内容有用的、有意思的，点赞、分享、关注一下呗！</span><br></p><blockquote data-tool="mdnice编辑器"><span>❝</span><p><span>1、《KS科研分享与服务》公众号有QQ交流群，但是进入门槛是20元，请考虑清楚。群里有推文的注释代码和示例数据，付费内容半价，还可以与大家交流。</span></p><p><br></p><p><span>2、单细胞转录组全流程代码需收费，收费代码包含公众号付费内容，也有很多新增加的内容。需进群或者需单细胞代码的小伙伴请添加作者微信了解，请备注目的，除此之外请勿添加，谢谢！</span></p><p><br></p><p><strong><span>3、<span>付费文章集合有打包价！付费作图+单细胞全套也有打包价哦！</span></span></strong></p><p><br></p><p><span>详情请联系作者：</span></p><p><span><strong><span data-raw-text="。" data-textnode-index-1652195285479="1" data-index-1652195285479="198"><strong><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/0nG6iazO80N1cL4xWNPsrucw2xh523TuRS5ICXsww3O5jSMYngxbIh9NlYqtemfgjjZjlDloIoqU8icJv6ckiaHpA/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="jpeg" data-w="430" src="https://mmbiz.qpic.cn/mmbiz_jpg/0nG6iazO80N1cL4xWNPsrucw2xh523TuRS5ICXsww3O5jSMYngxbIh9NlYqtemfgjjZjlDloIoqU8icJv6ckiaHpA/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></strong></span></strong></span></p><span>❞</span></blockquote><p>之前我们分享过网络图（<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg5OTYzMzY5Ng==&amp;mid=2247484655&amp;idx=1&amp;sn=6af179de5e9fbc56d39a90f1c3451c68&amp;chksm=c05103a0f7268ab66542d9bd7f8c621eaf20afedd1a47a9c398ba8af0baa16c98206f9c0a7e7&amp;scene=21#wechat_redirect" textvalue="graph包：圆状网络图的绘制|互作网络图|基因通路网络图" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">graph包：圆状网络图的绘制|互作网络图|基因通路网络图</a>，<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg5OTYzMzY5Ng==&amp;mid=2247484675&amp;idx=1&amp;sn=63e200925916395db4f1bdb63ed8be2c&amp;chksm=c051024cf7268b5a591314f109e37979fd6cd39d8233a561639ac2302c941bb036743c17d4ab&amp;scene=21#wechat_redirect" textvalue="新方法---大型网络图绘制---ggraph包" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">新方法---大型网络图绘制---ggraph包</a>），其实原理都是基于ggraph包的ggraph函数。最近在NAR上看到一篇文章：</p><section><img data-ratio="0.38549618320610685" data-src="https://mmbiz.qpic.cn/mmbiz_png/0nG6iazO80N00BzvPTubskJlNnV6P5Yics8Xib8wJfNiaQ1Ig6Sibykl2ibHR2MZWNtLV4Bp55bLhlfz2enCWbG63micA/640?wx_fmt=png" data-type="png" data-w="1310" src="https://mmbiz.qpic.cn/mmbiz_png/0nG6iazO80N00BzvPTubskJlNnV6P5Yics8Xib8wJfNiaQ1Ig6Sibykl2ibHR2MZWNtLV4Bp55bLhlfz2enCWbG63micA/640?wx_fmt=png"></section><section><br></section><section>原文网络图如下：<br></section><section><img data-ratio="0.9399249061326659" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/0nG6iazO80N00BzvPTubskJlNnV6P5YicseticNaQ1g6KibzWslLEAw0KricMYwhD4tprbPTFicCfLt5rAKfjBaKmhdg/640?wx_fmt=jpeg" data-type="jpeg" data-w="799" src="https://mmbiz.qpic.cn/mmbiz_jpg/0nG6iazO80N00BzvPTubskJlNnV6P5YicseticNaQ1g6KibzWslLEAw0KricMYwhD4tprbPTFicCfLt5rAKfjBaKmhdg/640?wx_fmt=jpeg"></section><section><br></section><section><strong>我们借此机会，通过ggraph作图解析相关参数。详细注释代码和参数已上传QQ群文件！</strong>我做的图如下，有一点问题，但不影响我们对这个函数的解析。</section><section><p><img data-galleryid="" data-ratio="0.9458823529411765" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/0nG6iazO80N00BzvPTubskJlNnV6P5Yics4tiapJBYbw1mLtT4pvfAIhQRxibPIzicrMb49jAkONeGQyCEmqFJORzWQ/640?wx_fmt=png" data-type="png" data-w="850" src="https://mmbiz.qpic.cn/mmbiz_png/0nG6iazO80N00BzvPTubskJlNnV6P5Yics4tiapJBYbw1mLtT4pvfAIhQRxibPIzicrMb49jAkONeGQyCEmqFJORzWQ/640?wx_fmt=png"></p>加载R包和节点数据，可以是STRING分析得到的网络文件，也可以是miRNA对应靶基因文件，再或者可以是转录因子对应的调控文件等！<br></section><section><ul><li><li><li><li><li></ul><pre data-lang="swift"><code><span>setwd(<span>"D:/KS项目/公众号文章/网络节点图"</span>)</span></code><code><span>df &lt;- read.csv(<span>"network.csv"</span>, header = <span>T</span>)</span></code><code><span>colnames(df) &lt;- <span>c</span>(<span>"ID"</span>, <span>"path"</span>, <span>"gene"</span>, <span>"Pval"</span>)</span></code><code><span>library(ggraph)</span></code><code><span>library(tidygraph)</span></code></pre></section><section>设置节点和边缘。<br></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="ruby"><code><span>paths &lt;- c(<span>"Node1"</span>, <span>"Node2"</span>, <span>"Node3"</span>)</span></code><code><span>nodelist &lt;- list()</span></code><code><span><span>for</span> (i <span>in</span> <span>1</span><span>:length</span>(paths)){</span></code><code><span>  node &lt;- subset(df, path == paths[i])</span></code><code><span>  </span></code><code><span>  nodes &lt;- data.frame(name = unique(union(node$path, node$gene)))</span></code><code><span>  nodes$values &lt;- c(sum(node$Pval), node$Pval)</span></code><code><span>  </span></code><code><span>  nodelist[[i]] &lt;- nodes</span></code><code><span>}</span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span>nodes &lt;- rbind(nodelist[[<span>1</span>]],nodelist[[<span>2</span>]],nodelist[[<span>3</span>]])</span></code><code><span>nodes$cluster &lt;- c(rep(<span>"Node1"</span>,<span>1</span>),rep(<span>"gene"</span>,<span>12</span>),</span></code><code><span>                   rep(<span>"Node2"</span>,<span>1</span>),rep(<span>"gene"</span>,<span>11</span>),</span></code><code><span>                   rep(<span>"Node3"</span>,<span>1</span>),rep(<span>"gene"</span>,<span>10</span>))</span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span>edges &lt;- df[c(<span>"path"</span>,<span>"gene"</span>,<span>"Pval"</span>)]</span></code><code><span>edges$class &lt;- edges$path</span></code></pre></section><section>构建作图文件。<br></section><section><ul><li></ul><pre data-lang="xml"><code><span>layout_cir <span>&lt;<span>-</span> <span>tbl_graph</span>(<span>nodes</span> = <span>nodes,</span> <span>edges</span> = <span>edges)</span></span></span></code></pre></section><section>出图：<br></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="sql"><code><span>ggraph(layout_cir,layout='linear',circular = TRUE) +</span></code><code><span>  geom_node_point(aes(size=<span>values</span>,colour = cluster))+</span></code><code><span>  geom_node_text(aes(x = <span>1.03</span> * x,</span></code><code><span>                     y = <span>1.03</span> * y,</span></code><code><span>                     label=<span>name</span>,</span></code><code><span>                     color=cluster,</span></code><code><span>                     angle = -((-node_angle(x, y) + <span>90</span>) %% <span>180</span>) + <span>90</span>),</span></code><code><span>                 hjust=<span>'outward'</span>) +</span></code><code><span>  geom_edge_arc(aes(colour=<span>class</span>))+</span></code><code><span>  theme_void()+</span></code><code><span>  theme(legend.position = <span>"none"</span>)+</span></code><code><span>  scale_colour_manual(<span>values</span> =c(<span>'#407972'</span>,</span></code><code><span>                                <span>'#961E28'</span>,</span></code><code><span>                                <span>'#D46724'</span>,</span></code><code><span>                                <span>'#0f8096'</span>))+</span></code><code><span>  scale_edge_colour_manual(<span>values</span> = c(<span>'#961E28'</span>,</span></code><code><span>                                      <span>'#D46724'</span>,</span></code><code><span>                                      <span>'#0f8096'</span>))+</span></code><code><span>  scale_size_continuous(<span>range</span> = c(<span>2</span>,<span>8</span>))+</span></code><code><span>  coord_cartesian(xlim=c(<span>-1.5</span>,<span>1.5</span>),ylim = c(<span>-1.5</span>,<span>1.5</span>))</span></code></pre></section><section><img data-galleryid="" data-ratio="0.9458823529411765" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/0nG6iazO80N00BzvPTubskJlNnV6P5Yics4tiapJBYbw1mLtT4pvfAIhQRxibPIzicrMb49jAkONeGQyCEmqFJORzWQ/640?wx_fmt=png" data-type="png" data-w="850" src="https://mmbiz.qpic.cn/mmbiz_png/0nG6iazO80N00BzvPTubskJlNnV6P5Yics4tiapJBYbw1mLtT4pvfAIhQRxibPIzicrMb49jAkONeGQyCEmqFJORzWQ/640?wx_fmt=png"></section><section>这样就完成了，也是美美的。如果觉得我的分享对你有用、有帮助的话，点个赞、分享一下再走呗！！！</section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/DGuoIkHgeVIFy5mVHh5-xA",target="_blank" rel="noopener noreferrer">原文链接</a>
