---
title: "nature medicine图表复现之热图叠加多种注释"
date: 2023-05-31T15:38:29Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
nature medicine图表复现之热图叠加多种注释 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来复现<strong>「nature medicine」</strong>上的一张图；其本质还是热图的绘制只不过在常规热图的基础上介绍如何添加方括号及文本注释，由于原数据过大绘图时仅采用了部分数据进行展示仅供参考。通过自定义构建数据集及个性化绘图两个案例来进行展示。<strong>「数据+代码已经上传2023VIP群，加群的观众老爷请自行下载」</strong></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>原文</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>An integrated tumor, immune and microbiome atlas of colon cancer</p><span>❞</span></blockquote><figure data-tool="mdnice编辑器"><img data-ratio="0.9930843706777317" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMatiatwqLGdMOwLITIKeF716fgicBPgFUKZ0dg6KF1WqOZQ3icjrQgoOhnzg/640?wx_fmt=png" data-type="png" data-w="723" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMatiatwqLGdMOwLITIKeF716fgicBPgFUKZ0dg6KF1WqOZQ3icjrQgoOhnzg/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-weui-theme="light" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(grid)<br><span>library</span>(pBrackets)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>testmap &lt;- tribble(<br>  ~Models, ~Group, ~Brands, ~Presence, ~Country,<br>  <span>"Xperia Z5"</span>, <span>"A"</span>, <span>"Sony"</span>, <span>1</span>, <span>"Japan"</span>,<br>  <span>"Galaxy S20"</span>, <span>"A"</span>, <span>"Samsung"</span>, <span>1</span>, <span>"Korea"</span>,<br>  <span>"Xperia XZ"</span>, <span>"B"</span>, <span>"Sony"</span>, <span>1</span>, <span>"Japan"</span>,<br>  <span>"Galaxy Note FE"</span>, <span>"B"</span>, <span>"Samsung"</span>, <span>0</span>, <span>"Korea"</span>,<br>  <span>"Nord"</span>,<span>"A"</span>, <span>"OnePlus"</span>,<span>1</span>,<span>"China"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>绘制图形</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>ggplot(testmap, aes(x=Country, y=Models, fill=Presence))+<br>  geom_tile() + xlab(label=<span>"Country"</span>)+ ylab(label=<span>"Models\n\n"</span>)+<br>  scale_fill_gradient(name=<span>"Presence of Models"</span>, low=<span>"white"</span>,high=<span>"black"</span>)+<br>  theme_bw() + theme(legend.position=<span>"none"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>添加括号</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>grid.locator(unit = <span>"native"</span>)<br><br>grid.brackets(<span>60</span>, <span>134</span>, <span>60</span>, <span>32</span>, type = <span>1</span>)<br>grid.brackets(<span>60</span>, <span>233</span>, <span>60</span>, <span>157</span>, type = <span>1</span>)<br>grid.brackets(<span>60</span>, <span>353</span>, <span>60</span>, <span>247</span>, type = <span>1</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>案例 2</span><span></span></h3><h4 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- read_tsv(<span>"F1.xls"</span>) %&gt;% pivot_longer(-Sample)<br><br>ddf &lt;- df %&gt;% filter(name %<span>in</span>% c(<span>"IFNG"</span>,<span>"TBX21"</span>,<span>"CD8A"</span>,<span>"CD8B"</span>,<span>"IL12B"</span>,<br>                          <span>"STAT1"</span>,<span>"IRF1"</span>,<span>"CXCL9"</span>,<span>"CXCL10"</span>,<span>"CCL5"</span>,<span>"GNLY"</span>,<span>"PRF1"</span>,<span>"GZMA"</span>,<br>                          <span>"GZMB"</span>,<span>"GZMH"</span>,<span>"CD274"</span>,<span>"CTLA4"</span>,<span>"FOXP3"</span>,<span>"IDO1"</span>,<span>"PDCD1"</span>))<br><br><span># 定义因子</span><br>ddf$name &lt;- factor(ddf$name,levels = rev(c(<span>"IFNG"</span>,<span>"TBX21"</span>,<span>"CD8A"</span>,<span>"CD8B"</span>,<span>"IL12B"</span>,<br>                                       <span>"STAT1"</span>,<span>"IRF1"</span>,<span>"CXCL9"</span>,<span>"CXCL10"</span>,<span>"CCL5"</span>,<span>"GNLY"</span>,<span>"PRF1"</span>,<span>"GZMA"</span>,<br>                                       <span>"GZMB"</span>,<span>"GZMH"</span>,<span>"CD274"</span>,<span>"CTLA4"</span>,<span>"FOXP3"</span>,<span>"IDO1"</span>,<span>"PDCD1"</span>)))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>绘制主图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>ddf %&gt;% ggplot(aes(Sample,name,fill=value))+ geom_tile()+<br>  scale_fill_gradientn(colours = (RColorBrewer::brewer.pal(<span>11</span>,<span>"RdBu"</span>)))+<br>  theme(axis.text.x=element_blank(),<br>        axis.ticks=element_blank(),<br>        axis.text.y=element_text(color=<span>"black"</span>,size=<span>8</span>),<br>        legend.background = element_blank(),<br>        legend.title = element_blank())+<br>  labs(x=<span>NULL</span>,y=<span>"\n\n\n\n\n"</span>)+<br>  guides(fill=guide_colorbar(direction=<span>"vertical"</span>,reverse=<span>F</span>,barwidth=unit(<span>.5</span>,<span>"cm"</span>),<br>                              barheight=unit(<span>9</span>,<span>"cm"</span>)))<br><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>添加方括号</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>案例图画布大小 4.7*3.75</p><span>❞</span></blockquote><pre data-tool="mdnice编辑器"><span></span><code>grid.locator(unit=<span>"native"</span>)<br><br>grid.brackets(<span>130</span>,<span>130</span>,<span>130</span>,<span>20</span>,lwd=<span>1</span>, ticks=<span>NA</span>, type = <span>4</span>)<br>grid.brackets(<span>130</span>,<span>200</span>,<span>130</span>,<span>140</span>,lwd=<span>1</span>, ticks=<span>NA</span>, type = <span>4</span>)<br>grid.brackets(<span>130</span>,<span>310</span>,<span>130</span>,<span>220</span>, lwd=<span>1</span>, ticks=<span>NA</span>, type = <span>4</span>)<br>grid.brackets(<span>130</span>,<span>420</span>,<span>130</span>,<span>320</span>, lwd=<span>1</span>, ticks=<span>NA</span>, type = <span>4</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>添加文本注释</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>grid.text(x=unit(<span>32</span>,<span>'native'</span>), y=unit(<span>90</span>,<span>'native'</span>),<br>          label=expression(paste(<span>'TH1 cell\nsignaling'</span>),<span>'type=4'</span>,size=<span>5</span>),<br>          gp=gpar(fontsize=<span>10</span>,col=<span>"black"</span>),hjust = <span>0</span>, vjust=<span>0</span>)<br><br>grid.text(x=unit(<span>30</span>,<span>'native'</span>), y=unit(<span>170</span>,<span>'native'</span>),<br>          label=expression(paste(<span>'CXCR3\nCCR5'</span>),<span>'type=4'</span>,size=<span>5</span>),<br>          gp=gpar(fontsize=<span>10</span>,col=<span>"black"</span>),hjust = <span>0</span>, vjust=<span>0</span>)<br><br>grid.text(x=unit(<span>30</span>,<span>'native'</span>), y=unit(<span>270</span>,<span>'native'</span>),<br>          label=expression(paste(<span>'Effector\nfunctions'</span>),<span>'type=4'</span>,size=<span>5</span>),<br>          gp=gpar(fontsize=<span>10</span>,col=<span>"black"</span>),hjust = <span>0</span>, vjust=<span>0</span>)<br><br>grid.text(x=unit(<span>22</span>,<span>'native'</span>), y=unit(<span>370</span>,<span>'native'</span>),<br>          label=expression(paste(<span>'Immune\nregulatory'</span>),<span>'type=4'</span>),<br>          gp=gpar(fontsize=<span>10</span>,col=<span>"red"</span>),hjust = <span>0</span>, vjust=<span>0</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7992895204262878" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMatJd9ibOmibQceNqiaiaqTrjlL4zEiclfQjFsIbgvhXibDqyuq9R9GK6VlZUgw/640?wx_fmt=png" data-type="png" data-w="563" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMatJd9ibOmibQceNqiaiaqTrjlL4zEiclfQjFsIbgvhXibDqyuq9R9GK6VlZUgw/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>有需要学习个性化数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>购买<strong>「2023年度会员」</strong> <code>初始价格99元</code>，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；按照往年数据小编年产出约在150+以上</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可下单购买，需要了解更多信息的朋友欢迎交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝扫一扫</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="1.6136783733826248" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMata4XOWyWNxicjtcbvibZ37Tm9eXSsGfLtnnp2PuicyIQoHYSnVzbU9LaAg/640?wx_fmt=png" data-type="png" data-w="541" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMata4XOWyWNxicjtcbvibZ37Tm9eXSsGfLtnnp2PuicyIQoHYSnVzbU9LaAg/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023会员群精彩内容</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMaticd0iavzcgpcQaBrxnYeoFQicNLWOzIKaeBDAhDLe1ialzaicfz96ibfyPQg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMaticd0iavzcgpcQaBrxnYeoFQicNLWOzIKaeBDAhDLe1ialzaicfz96ibfyPQg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMatRFfibnmcT804osMsIvysVNLT1p8QuTdYv6CJCy9kPcT5SgUInqoxmMw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMatRFfibnmcT804osMsIvysVNLT1p8QuTdYv6CJCy9kPcT5SgUInqoxmMw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMatiadOSq0vGAlG07L7qDZp5SKrNjUgwCgKsafn8IrSFFFvE41khibM8GjQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMatiadOSq0vGAlG07L7qDZp5SKrNjUgwCgKsafn8IrSFFFvE41khibM8GjQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMathE9gcdWk7MKv7ysEwg0NVBupXKvYiaiaFpVvAzKdRXE17mBIqiczkiaQdw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMathE9gcdWk7MKv7ysEwg0NVBupXKvYiaiaFpVvAzKdRXE17mBIqiczkiaQdw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMat6CO5a1zQLU0OvLknzVZLrbbvvCykCiahJz3esibglDfwso4iaLbPPcAZQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYPM31hS5oMVndLfngRAMat6CO5a1zQLU0OvLknzVZLrbbvvCykCiahJz3esibglDfwso4iaLbPPcAZQ/640?wx_fmt=png"><br></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/u11f7-IZyG_6Act4Gsf7UQ",target="_blank" rel="noopener noreferrer">原文链接</a>
