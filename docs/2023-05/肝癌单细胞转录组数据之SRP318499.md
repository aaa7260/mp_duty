---
title: "肝癌单细胞转录组数据之SRP318499"
date: 2023-05-22T10:21:55Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
肝癌单细胞转录组数据之SRP318499 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>这个肝癌单细胞转录组数据的SRA数据库链接是：</p></blockquote><ul data-tool="mdnice编辑器"><li><section>https://www.ncbi.nlm.nih.gov/sra/?term=SRP318499</section></li><li><section>https://trace.ncbi.nlm.nih.gov/Traces/?study=SRP318499</section></li></ul><p data-tool="mdnice编辑器">可以看到居然是bam文件格式：</p><pre data-tool="mdnice编辑器"><span></span><code>Organism Sample File Name Size Updated<br>Homo sapiens SAMN19017675 095_possorted_genome_bam.bam 55.2Gb 2021-05-05 10:26:32<br>Homo sapiens SAMN19017676 104_possorted_genome_bam.bam 22.8Gb 2021-05-05 05:41:14<br>Homo sapiens SAMN19017677 106_possorted_genome_bam.bam 21.1Gb 2021-05-05 05:51:20<br>Homo sapiens SAMN19017678 114_possorted_genome_bam.bam 50.1Gb 2021-05-05 08:36:12<br>Homo sapiens SAMN19017679 119_possorted_genome_bam.bam 44.7Gb 2021-05-05 09:00:40<br>Homo sapiens SAMN19017680 713_possorted_genome_bam.bam 21.4Gb 2021-05-05 06:10:24<br>Homo sapiens SAMN19017681 725_possorted_genome_bam.bam 26.2Gb 2021-05-05 05:42:48<br>Homo sapiens SAMN19017682 740_possorted_genome_bam.bam 52.5Gb 2021-05-05 09:12:26<br></code></pre><p data-tool="mdnice编辑器">其实也有对应的bioproject的ID ：https://www.ncbi.nlm.nih.gov/bioproject/PRJNA727404</p><p data-tool="mdnice编辑器"><br></p><h3 data-tool="mdnice编辑器"><span></span><span>安装conda</span><span></span></h3><p data-tool="mdnice编辑器">这里推荐每个人安装自己的conda，这样的话一个服务器里面的每个用户独立操作，安装方法代码如下：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 首先下载文件，20M/S的话需要几秒钟即可</span><br>wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh<br><span># 接下来使用bash命令来运行我们下载的文件，记得是一路yes下去</span><br>bash Miniconda3-latest-Linux-x86_64.sh <br><span>#  安装成功后需要更新系统环境变量文件</span><br><span>source</span> ~/.bashrc<br></code></pre><p data-tool="mdnice编辑器">安装好conda后需要设置镜像（取决于你服务器的情况，部分网络比较好的服务器可以不设置镜像）</p><pre data-tool="mdnice编辑器"><span></span><code>conda config --add channels https://mirrors.bfsu.edu.cn/anaconda/cloud/bioconda/<br>conda config --add channels https://mirrors.bfsu.edu.cn/anaconda/cloud/conda-forge/<br>conda config --add channels https://mirrors.bfsu.edu.cn/anaconda/pkgs/free/<br>conda config --add channels https://mirrors.bfsu.edu.cn/anaconda/pkgs/main/<br>conda config --<span>set</span> show_channel_urls yes <br></code></pre><p data-tool="mdnice编辑器">一个完整并且好用的conda真的是生产力工具。接下来就使用conda来配置mamba后设置kingfisher环境。</p><h3 data-tool="mdnice编辑器"><span></span><span>配置mamba后设置kingfisher环境</span><span></span></h3><p data-tool="mdnice编辑器">七八年前我写教程，尤其是多组学测序数据分析，都是从ncbi的sra数据库里面下载sra文件，然后一步步处理。很多教程还录制成为了视频上传到b站。但是读者多了之后我接受到的大家的反馈就是从ncbi的sra数据库里面下载sra文件实在是太慢了，因为我做演示的服务器在境外，所以自己压根就没有意识到这点。但是陆陆续续有小伙伴告诉我应该是使用aspera从ebi的ena数据库直接下载fastq文件即可，高速而且还少了一个sra文件转为fastq的步骤。所以后来我也开始在日常更新的公众号里面推荐这个方法，就是参考：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247492889&amp;idx=2&amp;sn=bc2ef17a3b96a257fb692f73338c6b0f&amp;scene=21#wechat_redirect" data-linktype="2">使用ebi数据库直接下载fastq测序数据</a>  , 需要自行配置好。但是风水轮流转，没想到，也没有过去多少年，就风水轮流转， aspera从ebi的ena数据库这个手段时灵时不灵的。现在只能是回归sra下载，见：<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247507081&amp;idx=1&amp;sn=16c5a07d2917f28b23d14a3e15ecb99b&amp;scene=21#wechat_redirect" data-linktype="2">转录组上游定量分析其实真不难，4步可定（一）</a>，从ncbi的sra数据库里面下载sra文件需要的是sra-tools这个工具套件， 如果你按照我的转录组流程配置：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247518195&amp;idx=1&amp;sn=d6d82ceda8531ebdc294dab0bf9d5519&amp;scene=21#wechat_redirect" data-linktype="2">在全新服务器配置转录组测序数据处理环境</a>，会发现安装的是sra-tools-2.8.0 ，后面仍然是报错，所以得指定版本，比如从github安装最新版。</p><p data-tool="mdnice编辑器">慢慢的，大家在交流群提到了无论是使用sra-tools从ncbi的sra数据库里面下载sra文件，还是使用aspera从ebi的ena数据库直接下载fastq文件，都是得费劲测试和验证， 还得自己准备每个项目的全部的样品的信息，工作繁琐。所以就有了kingfisher，仅仅是需要一个项目ID，就可以自动去检索ebi的ena数据库和ncbi的sra数据库，自动合适的方式下载，非常方便。</p><p data-tool="mdnice编辑器">代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>conda install mamba<br>mamba create -n kingfisher python=3.8<br>mamba init<br>mamba list<br>mamba activate kingfisher<br>mamba install -c bioconda kingfisher<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>一行代码下载数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>mamba activate kingfisher<br>kingfisher get -r SRP318499   -m ena-ascp ena-ftp prefetch aws-http<br></code></pre><p data-tool="mdnice编辑器">因为是根据sra数据库的id所以下载的是sra文件 , 需要把它们转为fq文件</p><pre data-tool="mdnice编辑器"><span></span><code>ls *sra|   xargs  -iF -P 4 sh -c <span>'   kingfisher extract --sra  F -t 2 -f fastq.gz'</span><br><br></code></pre><p data-tool="mdnice编辑器">我看了看，可能是因为作者提供的bam文件的，所以这个过程显得非常奇怪：</p><pre data-tool="mdnice编辑器"><span></span><code>ls -lh |cut -d<span>" "</span> -f 5-<br><br> 13G 1月  20 21:04 SRP318499.1.fastq.gz<br> 13G 1月  20 12:30 SRP318499.1.sra<br>9.9G 1月  20 21:01 SRP318499.2.fastq.gz<br>9.5G 1月  20 12:44 SRP318499.2.sra<br> 20G 1月  20 21:49 SRP318499.3.fastq.gz<br> 16G 1月  20 12:59 SRP318499.3.sra<br> 21G 1月  20 21:52 SRP318499.4.fastq.gz<br> 19G 1月  20 13:18 SRP318499.4.sra<br> 19G 1月  20 13:38 SRP318499.5.sra<br> 11G 1月  21 02:21 SRP318499.6.fastq.gz<br>9.7G 1月  20 13:47 SRP318499.6.sra<br> 12G 1月  21 02:33 SRP318499.7.fastq.gz<br>9.9G 1月  20 14:02 SRP318499.7.sra<br> 22G 1月  21 03:02 SRP318499.8.fastq.gz<br> 22G 1月  20 14:25 SRP318499.8.sra<br>289G 1月  20 14:56 SRP318499.fastq<br></code></pre><p data-tool="mdnice编辑器">另外，也有可能是因为这个sra数据库项目是10x技术单细胞，所以上面的参数可能是不准确，所以我们重新使用一行代码下载数据，这次根据对应的bioproject的ID ：https://www.ncbi.nlm.nih.gov/bioproject/PRJNA727404</p><pre data-tool="mdnice编辑器"><span></span><code>mamba activate kingfisher<br>kingfisher get -p PRJNA727404   -m ena-ascp ena-ftp prefetch aws-http<br></code></pre><p data-tool="mdnice编辑器">但是很不幸，仍然是下载的每个样品是单个fq文件，不符合10x这个单细胞转录组技术。</p><pre data-tool="mdnice编辑器"><span></span><code>ls -lh |cut -d<span>" "</span> -f 5-<br> <br> 26G 1月  21 09:54 SRR14424777.fastq.gz<br> 14G 1月  21 10:04 SRR14424778.fastq.gz<br> 11G 1月  21 10:10 SRR14424779.fastq.gz<br> 24G 1月  21 10:25 SRR14424780.fastq.gz<br> 25G 1月  21 10:41 SRR14424781.fastq.gz<br> 12G 1月  21 10:49 SRR14424782.fastq.gz<br> 13G 1月  21 10:57 SRR14424783.fastq.gz<br> 27G 1月  21 11:18 SRR14424784.fastq.gz<br></code></pre><p data-tool="mdnice编辑器">这个时候需要参考 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514146&amp;idx=1&amp;sn=b9721433d49a2d963eeaab1ad47fc91b&amp;scene=21#wechat_redirect" data-linktype="2">只能下载bam文件的10x单细胞转录组项目数据处理</a> ，如果你熟悉10x单细胞转录组数据，就知道：</p><ul data-tool="mdnice编辑器"><li><section><p>首先，1-26个cycle就是测序得到了26个碱基，先是16个Barcode碱基，然后是10个UMI碱基；通常是R1文件</p></section></li><li><section><p>然后，27-34这8个cycle得到了8个碱基，就是i7的sample index；通常是I1文件</p></section></li><li><section><p>最后35-132个cycle得到了98个碱基，就是转录本reads（目前很多测序仪都是150bp了），通常是R2文件</p></section></li></ul><p data-tool="mdnice编辑器">也就是说R2 文件是真正的测序reads，肯定是文件最大。因为这个项目对应的ebi数据库链接是：https://www.ebi.ac.uk/ena/browser/view/PRJNA727404，就是上面的 <code>kingfisher get -p PRJNA727404  </code> 命令获取到的8个fq.gz 文件。</p><p data-tool="mdnice编辑器">所以仍然是得回到 https://trace.ncbi.nlm.nih.gov/Traces/?view=study&amp;acc=SRP318499 页面，去下载那些bam文件，会复杂一点了。需要参考 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514146&amp;idx=1&amp;sn=b9721433d49a2d963eeaab1ad47fc91b&amp;scene=21#wechat_redirect" data-linktype="2">只能下载bam文件的10x单细胞转录组项目数据处理</a> 进行bam文件转为fq文件，然后再针对fq文件进行cellranger的定量流程。定量后的表达量矩阵很容易进行降维聚类分群，文章给出来的示范如下行：</p><p><img data-galleryid="" data-ratio="0.6174334140435835" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyK6FCuPzOss9SFbftfFCPcS1mFMrZ9uNFehlMEc4j16mfE4C24YqbL15gfn0JChY5LflvO7Iiaiarw/640?wx_fmt=png" data-type="png" data-w="1652" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyK6FCuPzOss9SFbftfFCPcS1mFMrZ9uNFehlMEc4j16mfE4C24YqbL15gfn0JChY5LflvO7Iiaiarw/640?wx_fmt=png"></p><p>可以看到，恶性肿瘤上皮细胞是每个病人都不一样，但是其它免疫细胞和间质细胞是可以比较好整合在一起的。感兴趣的可以去读一下文章：<br></p><p><img data-galleryid="" data-ratio="0.5318840579710145" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyK6FCuPzOss9SFbftfFCPcOPHqmVXXicdxVbyczkQH8ykLJPtlSfLVKdR2oI3329zzgFHTfaia1C7A/640?wx_fmt=png" data-type="png" data-w="1380" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyK6FCuPzOss9SFbftfFCPcOPHqmVXXicdxVbyczkQH8ykLJPtlSfLVKdR2oI3329zzgFHTfaia1C7A/640?wx_fmt=png"></p><h3 data-tool="mdnice编辑器"><span>cellranger的定量流程详解：</span><span></span></h3><blockquote data-tool="mdnice编辑器"><p>正常走cellranger的定量流程即可，代码我已经是多次分享了。参考：</p></blockquote><ul data-tool="mdnice编辑器"><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247512340&amp;idx=3&amp;sn=1b9609a8870a0209dd27ffdcbc3cac87&amp;chksm=9b4bf1afac3c78b90674678fcec66365b9faaa275ff4b0a2255e0a05fa8b905e15222a643bea&amp;scene=21#wechat_redirect" data-linktype="2">10X单细胞转录组原始测序数据的Cell Ranger流程（仅需800元）</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247496813&amp;idx=1&amp;sn=4151bf2265618eff4e0123722c50e569&amp;scene=21#wechat_redirect" data-linktype="2">10X的单细胞转录组原始数据也可以在EBI下载</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247510920&amp;idx=1&amp;sn=c4561d34e984406693c014cdfe236c0f&amp;chksm=9b4beb33ac3c622542d894344c323ff7cca52f69119d02fc7aa4636af0cbe7df4b6c63dd5ba9&amp;scene=21#wechat_redirect" data-linktype="2">一个10x单细胞转录组项目从fastq到细胞亚群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513565&amp;idx=1&amp;sn=092e637017d176c43f00a295d3210592&amp;scene=21#wechat_redirect" data-linktype="2">一文打通单细胞上游：从软件部署到上游分析</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513605&amp;idx=1&amp;sn=e86a329c887745c6d00d3ededa39dcda&amp;chksm=9b4bf6beac3c7fa8523cef4e7189fb20b914460ddb61e6cd1dd520b5928e1b59a8b7827ce783&amp;scene=21#wechat_redirect" data-linktype="2">PRJNA713302这个10x单细胞fastq实战</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513968&amp;idx=1&amp;sn=f5a44a7bea0bdacd8af1a20c177763e5&amp;scene=21#wechat_redirect" data-linktype="2">一次曲折且昂贵的单细胞公共数据获取与上游处理</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514146&amp;idx=1&amp;sn=b9721433d49a2d963eeaab1ad47fc91b&amp;scene=21#wechat_redirect" data-linktype="2">只能下载bam文件的10x单细胞转录组项目数据处理</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247511452&amp;idx=2&amp;sn=83ec97cbc3334a6095e6d63e05e9fd6e&amp;scene=21#wechat_redirect" data-linktype="2">不知道10x单细胞转录组样品和fastq文件的对应关系</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247508521&amp;idx=2&amp;sn=2cf3158e74d37b3a741908d8bfc8f02f&amp;scene=21#wechat_redirect" data-linktype="2">10X单细胞转录组测序数据的 SRA转fastq踩坑那些事</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514395&amp;idx=2&amp;sn=96c505b76ae87dd0efa737c4c44e2270&amp;scene=21#wechat_redirect" data-linktype="2">10x的单细胞转录组fastq文件的R1和R2不能弄混哦</a></section></li></ul><p data-tool="mdnice编辑器">差不多几个小时就可以完成全部的样品的cellranger的定量流程。基础知识非常重要，我们在单细胞天地多次分享过<strong>cellranger</strong>流程的笔记（2019年5月），大家可以自行前往学习，如下：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484146&amp;idx=1&amp;sn=16e09b82d048eed1ff6100b22970abd5&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(一)数据下载</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484179&amp;idx=1&amp;sn=fe84f5243a6021fe6afea128e3ac273a&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(二) cell ranger使用前注意事项</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484206&amp;idx=1&amp;sn=edeebbdd092f79361aee87e9ce086d80&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(三) Cell Ranger使用初探</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484355&amp;idx=1&amp;sn=7860fe0c46073a55d2d3700822c3103b&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(四) Cell Ranger流程概览</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484402&amp;idx=1&amp;sn=95c2be0dc6499e4b1eb9a91d79e584d1&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(五) 理解cellranger count的结果</a></section></li></ul></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器">单细胞春节福利继续</h3><p data-tool="mdnice编辑器">如果你有自己的单细胞转录组数据需要处理，可以直接参加我们的活动 ，详见：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519474&amp;idx=1&amp;sn=a07f2684e4bebfc5307add35cfbf82a2&amp;scene=21#wechat_redirect" data-linktype="2">春节期间单细胞转录组数据分析全免费</a>，如果你感兴趣我们处理过的数据集，可以直接填表留下联系方式即可，我们会在元宵节之前统一发放全部的代码和数据给大家的：</p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p><img data-galleryid="" data-ratio="1.1717171717171717" data-s="300,640" data-type="png" data-w="594" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyQr8BdGAhNyoC6JsX1Adz5cNOEMLwqyYLg2yEFoG9EhZbst22ordDweoSa1ErNa5vouvVDL0Ixbw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyQr8BdGAhNyoC6JsX1Adz5cNOEMLwqyYLg2yEFoG9EhZbst22ordDweoSa1ErNa5vouvVDL0Ixbw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><figure data-tool="mdnice编辑器"><figcaption>元宵节之前统一发放全部的代码和数据</figcaption></figure></section><h4 data-tool="mdnice编辑器"><span>文末友情宣传</span></h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519543&amp;idx=1&amp;sn=b9290a55d50c038bcc6e97d53a88b1c5&amp;chksm=9b4bcd8cac3c449aaa16dbf518578e9c7a4e67fe4122ae7c4fb115ddb2a843a976fa3462dcea&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授课（买‍一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课<span></span></section></li></ul><p><span></span></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/1WwI7kIRVqHZXpqYmfkTnQ",target="_blank" rel="noopener noreferrer">原文链接</a>
