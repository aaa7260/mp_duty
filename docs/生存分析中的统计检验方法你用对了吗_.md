---
title: "生存分析中的统计检验方法你用对了吗？"
date: 2022-12-06T00:26:10Z
draft: ["false"]
tags: [
  "fetched",
  "生物信息云"
]
categories: ["Acdemic"]
---
生存分析中的统计检验方法你用对了吗？ by 生物信息云
------
<div><p data-mpa-powered-by="yiban.io"><img data-ratio="0.11875" data-type="gif" data-w="640" data-src="https://mmbiz.qpic.cn/mmbiz_gif/dREape4YBzwlE827QdNGgPv5S50JOQrAK6QYEGudEI2gzsmgrp3SUKRWPKH7NPbnft9rfWUyQIsd2A3wmfp0cQ/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/mmbiz_gif/dREape4YBzwlE827QdNGgPv5S50JOQrAK6QYEGudEI2gzsmgrp3SUKRWPKH7NPbnft9rfWUyQIsd2A3wmfp0cQ/640?wx_fmt=gif"></p><hr><p><img data-ratio="0.25" data-s="300,640" data-type="jpeg" data-w="600" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/dREape4YBzyF5jVxNCORGgSJRgWqy8hD1vw3aTCTiauBVLErhPNxeAq1Z3p1iaawPViah3KsJ6q4ibys098ibmnjzcQ/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/mmbiz_jpg/dREape4YBzyF5jVxNCORGgSJRgWqy8hD1vw3aTCTiauBVLErhPNxeAq1Z3p1iaawPViah3KsJ6q4ibys098ibmnjzcQ/640?wx_fmt=jpeg"><br></p><hr><p><br>生存分析可能大家采用Kaplan-Meier法和log-rank检验生存率差异，很多TCGA在线工具也是用这2种方法，下面先对这2种方法简单介绍。<br></p><p><strong><span>1. Kaplan-Meier法</span></strong></p><p>Kaplan-Meier法简称K-M法，又称乘积极限法(Product-limit Estimate)是生存分析方法中最常用的一种，主要用于估计患者生存率和绘制生存曲线。Kaplan-Meier曲线（生存曲线），以生存时间为横轴,生存率S (tk)为纵轴，绘制而成的连续型的阶梯形曲线，用以说明生存时间与生存率之间的关系。生存曲线一般是平滑而水平延伸的，当某个时间点一旦有患者发生终点事件(如死亡)，曲线就会垂直下降,下降幅度是该时间点上患者发生终点事件例数和上一个时间节点后随访的患者样本量的比。</p><p><span><strong>一般情况下，不同组生存曲线不交叉，但如果有交叉，则提示可能存在混杂因素</strong></span>，可以用校正方法（如逆概率加权法），获得校正后的K-M曲线。</p><p><strong><span>2.Log-Rank test</span></strong></p><p>当两组或多组生存曲线（生存率）进行比较时，常用的假设检验方法是对数秩检验(log-rank test )，又称时序检验，属于非参数检验，用于比较两组或多组生存曲线或生存时间是否相同，检验统计量为卡方。<strong><span>需要注意的是，选用Log-Rank检验对样本生成存率进行比较时，要求各组生存曲线不能交叉</span></strong>，生存曲线交叉提示存在混杂因素，可以使用Two-stage方法。</p><hr><p>了解这2种检验方法后，都发现，这两种方法都不能有交叉。那么有交叉的生存曲线，该如何进行统计检验。其实前面已经提到可以用two-stage方法。</p><p><span><strong>3.Two Stage Hazard Rate Comparison</strong></span><br></p><p>在R中使用TSHRC包进行统计检验，该检验方法同时可以计算Kaplan-MeierLog-Rank test的p值。</p><p><strong><span>安装</span></strong><br></p><section><ul><li><li></ul><pre data-lang="sql"><code><span>install.packages(<span>"TSHRC"</span>)</span></code><code><span><span>library</span>(TSHRC)</span></code></pre></section><p><strong><span>生存分析</span></strong><br></p><p>我这里有一个生存数据：<br></p><p><img data-galleryid="" data-ratio="0.2918238993710692" data-s="300,640" data-type="png" data-w="795" data-src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxRcdYdYWPA3Eotzh6ITcuYrZ9l0ABP1ypycgvXAsO13zUfUZkdJn6N6fza513icibK0jbnzicQJX6tQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxRcdYdYWPA3Eotzh6ITcuYrZ9l0ABP1ypycgvXAsO13zUfUZkdJn6N6fza513icibK0jbnzicQJX6tQ/640?wx_fmt=png"></p><section><ul><li><li><li><li><li></ul><pre data-lang="powershell"><code><span>library(survival)</span></code><code><span>fit &lt;-  survdiff(Surv(OS.time,OS) ~ cluster,<span>data</span> = osdata)</span></code><code><span>summary(fit)</span></code><code><span>surv.obj &lt;- Surv(osdata<span>$OS</span>.time,osdata<span>$OS</span>)</span></code><code><span>surv.treat &lt;- survfit(surv.obj ~ cluster, <span>data</span> = osdata)</span></code></pre></section><p>默认的统计检验方法，p值是0.45，但我们看到生存曲线是有交叉的。<br></p><section><ul><li><li></ul><pre data-lang="properties"><code><span><span>ggsurvplot(surv.treat,</span> <span>data = osdata, pval = T,risk.table =T,</span></span></code><code><span><span>           ggtheme </span>=<span> theme_bw())</span></span></code></pre></section><p><img data-galleryid="" data-ratio="1.2043478260869565" data-s="300,640" data-type="png" data-w="460" data-src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxRcdYdYWPA3Eotzh6ITcuYRrxibbHJPCf5aXBRQuEZ03ydibEAwCaznYKXz6ufl3xX68HzrmgRczgA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxRcdYdYWPA3Eotzh6ITcuYRrxibbHJPCf5aXBRQuEZ03ydibEAwCaznYKXz6ufl3xX68HzrmgRczgA/640?wx_fmt=png"></p><p>接下来我们使用two-stage方法计算p值。</p><p>TSHRC包中的twostage函数是计算p值的方法。</p><section><ul><li></ul><pre data-lang="cs"><code><span>twostage(time, delta, <span>group</span>, nboot, alpha = <span>0.05</span>, eps = <span>0.1</span>)</span></code></pre></section><p>你可以查看函数帮助文档。<br></p><section><ul><li></ul><pre data-lang="nginx"><code><span><span>pv</span> &lt;- twostage(osdata<span>$OS</span>.time,osdata<span>$OS</span>, osdata<span>$group</span>, nboot = <span>100</span>)</span></code></pre></section><section><ul><li><li><li></ul><pre data-lang="css"><code><span>&gt; <span>pv</span></span></code><code><span>      <span>LRPV</span>       <span>MTPV</span>       <span>TSPV</span> </span></code><code><span>0<span>.44762934</span> 0<span>.06000000</span> 0<span>.08380133</span> </span></code></pre></section><p>得到的只是一个有名字的向量。</p><p>LRPV: p-value of the log-rank test, </p><p>MTPV: p-value of the suggested stage-II test, </p><p>TSPV: p-value of the two-stage test.</p><p><br></p><p>我们可以看到，默认情况下使用的是log-rank test，这里的0.44762934四舍五入收就是前面的0.45，但是生存曲线有交叉，这里我们需要使用TSPV。</p><section><ul><li><li></ul><pre data-lang="powershell"><code><span> ggsurvplot(surv.treat, <span>data</span> = osdata, pval = round(pv[<span>"TSPV"</span>],<span>3</span>),risk.table =T,</span></code><code><span>                ggtheme = theme_bw())</span></code></pre></section><p><img data-galleryid="" data-ratio="1.1931330472103003" data-s="300,640" data-type="png" data-w="466" data-src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxRcdYdYWPA3Eotzh6ITcuYgPq2XTf9bvWeibdRTcr1GxGriaSC0HGtEPCEc6q8JjjCjIYP6RlD5uZQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxRcdYdYWPA3Eotzh6ITcuYgPq2XTf9bvWeibdRTcr1GxGriaSC0HGtEPCEc6q8JjjCjIYP6RlD5uZQ/640?wx_fmt=png"></p><p>参考：<br></p><p><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzUyNDQ4OTkyNw==&amp;mid=2247488667&amp;idx=1&amp;sn=e490412ff506c4904efb2db9bc72b8a8&amp;scene=21#wechat_redirect" textvalue="生存分析统计方法选择，可以避免的一些坑" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2">生存分析统计方法选择，可以避免的一些坑</a><br></p><p><br></p><hr><p><br></p><section data-mpa-template="t" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><p data-mid=""><span>经    典    栏    目</span></p></section></section><section data-mid="" mpa-from-tpl="t"><br></section><section data-mid="" mpa-from-tpl="t"><br></section></section></section></section><p><br></p><section data-mpa-template="t" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><br></section><section data-mid="" mpa-from-tpl="t"><br></section><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><table align="center"><tbody><tr><td width="243" valign="bottom" align="center" height="45"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzA4NDAzODkzMA==&amp;action=getalbum&amp;album_id=1338047035672526848#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-ratio="0.2084639498432602" data-s="300,640" data-type="png" data-w="638" data-src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDhkvd0VYruWibnf6I99uicOsqFSIPicvmUP7w8m3ictoTgeAmsmF6v40nqw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDhkvd0VYruWibnf6I99uicOsqFSIPicvmUP7w8m3ictoTgeAmsmF6v40nqw/640?wx_fmt=png"></span></a></td><td width="243" valign="bottom" align="center" height="45"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzA4NDAzODkzMA==&amp;action=getalbum&amp;album_id=1385753371944239106#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-ratio="0.2084639498432602" data-s="300,640" data-type="png" data-w="638" data-src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RND8LOmqZpGNerHE2ib3hrYBm7czV8ibjkg6bgUynABicHtDblDwibcK0iafdg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RND8LOmqZpGNerHE2ib3hrYBm7czV8ibjkg6bgUynABicHtDblDwibcK0iafdg/640?wx_fmt=png"></span></a></td></tr><tr><td width="243" valign="bottom" align="center" height="45"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzA4NDAzODkzMA==&amp;action=getalbum&amp;album_id=1410264757734817793#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-ratio="0.2084639498432602" data-s="300,640" data-type="png" data-w="638" data-src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDnwmiaAUS36yqYw6aeJ9iaNkNUGmcU7ux65wvficPlQXDHQibW3JYrFJFvQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDnwmiaAUS36yqYw6aeJ9iaNkNUGmcU7ux65wvficPlQXDHQibW3JYrFJFvQ/640?wx_fmt=png"></span></a></td><td width="243" valign="bottom" align="center" height="45"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzA4NDAzODkzMA==&amp;action=getalbum&amp;album_id=1369789283514761218#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-ratio="0.20689655172413793" data-s="300,640" data-type="png" data-w="638" data-src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDANc1t4lIm5wTqesgaITcicUlfiaXHrSxrKVeWZYCzlH9MSy7IibTYQLNg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDANc1t4lIm5wTqesgaITcicUlfiaXHrSxrKVeWZYCzlH9MSy7IibTYQLNg/640?wx_fmt=png"></span></a></td></tr><tr><td width="243" valign="bottom" align="center" height="45"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzA4NDAzODkzMA==&amp;action=getalbum&amp;album_id=1519504738202025984#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-ratio="0.2084639498432602" data-s="300,640" data-type="png" data-w="638" data-src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDQmkz6ffBVfRj1Ab8ibMyygNmmvL7yia3eoZzJNoWjNW6vwjG4y3PWsNg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDQmkz6ffBVfRj1Ab8ibMyygNmmvL7yia3eoZzJNoWjNW6vwjG4y3PWsNg/640?wx_fmt=png"></span></a></td><td width="243" valign="bottom" align="center" height="45"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzA4NDAzODkzMA==&amp;action=getalbum&amp;album_id=1519504738034253825#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-ratio="0.20689655172413793" data-s="300,640" data-type="png" data-w="638" data-src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDCpphsguALa0tR6pfEy8yLBahRX9iaeYdKCwicKFbBd2X1yTSiaZyZwFqA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDCpphsguALa0tR6pfEy8yLBahRX9iaeYdKCwicKFbBd2X1yTSiaZyZwFqA/640?wx_fmt=png"></span></a></td></tr><tr><td width="243" valign="bottom" align="center" height="45"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzA4NDAzODkzMA==&amp;action=getalbum&amp;album_id=1687484069455986690#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-ratio="0.2084639498432602" data-s="300,640" data-type="png" data-w="638" data-src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RND73kOWY2pcLs5dmFMQWCG1Noz1oRR2oBCDHgNjiaAXqEZkLllKtoeO0g/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RND73kOWY2pcLs5dmFMQWCG1Noz1oRR2oBCDHgNjiaAXqEZkLllKtoeO0g/640?wx_fmt=png"></span></a></td><td width="243" valign="bottom" align="center" height="45"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzA4NDAzODkzMA==&amp;action=getalbum&amp;album_id=1521974159344533507#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-ratio="0.20689655172413793" data-s="300,640" data-type="png" data-w="638" data-src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RND6nm4ADziajqL0hpSudJTiacRyqVOg9NpnKoyfmVOgzwp97HicIFjb0gDw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RND6nm4ADziajqL0hpSudJTiacRyqVOg9NpnKoyfmVOgzwp97HicIFjb0gDw/640?wx_fmt=png"></span></a></td></tr><tr><td width="243" valign="bottom" align="center" height="45"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzA4NDAzODkzMA==&amp;action=getalbum&amp;album_id=1715194110111776770#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-ratio="0.2087912087912088" data-s="300,640" data-type="png" data-w="637" data-src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDRBOVZUPB816xXqA1SlbNzDRkmNRSjtCa3pqjuyAoQJxa1drcW0yeZQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDRBOVZUPB816xXqA1SlbNzDRkmNRSjtCa3pqjuyAoQJxa1drcW0yeZQ/640?wx_fmt=png"></span></a></td><td width="243" valign="bottom" align="center" height="45"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzA4NDAzODkzMA==&amp;action=getalbum&amp;album_id=1715194110212440067#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-ratio="0.20689655172413793" data-s="300,640" data-type="png" data-w="638" data-src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDxgtG3pdSyaKcfgvqjDrC2mpKa0MCu1rsbGkQLcOys8c9BVLs2VnjEg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDxgtG3pdSyaKcfgvqjDrC2mpKa0MCu1rsbGkQLcOys8c9BVLs2VnjEg/640?wx_fmt=png"></span></a></td></tr><tr><td width="243" valign="bottom" align="center" height="45"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzA4NDAzODkzMA==&amp;action=getalbum&amp;album_id=1712569781846933508#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-ratio="0.20722135007849293" data-s="300,640" data-type="png" data-w="637" data-src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDXqLDtKHqQMBReWKnTibVusnVlY43shlib0iaoluz4tmJPej8ej4vWiaehA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RNDXqLDtKHqQMBReWKnTibVusnVlY43shlib0iaoluz4tmJPej8ej4vWiaehA/640?wx_fmt=png"></span></a></td><td width="243" valign="bottom" align="center" height="45"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzA4NDAzODkzMA==&amp;action=getalbum&amp;album_id=1338481272770953216#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-ratio="0.2084639498432602" data-s="300,640" data-type="png" data-w="638" data-src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RND3CbMQTDNRO3A5SELiaQ3DDeqQkt5rfZqpwQRsQYyTicQUD9zQlfolIvQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/dREape4YBzxVERm1kp30MnGymicMs1RND3CbMQTDNRO3A5SELiaQ3DDeqQkt5rfZqpwQRsQYyTicQUD9zQlfolIvQ/640?wx_fmt=png"></span></a></td></tr></tbody></table><span></span><img data-ratio="0.44606650446066504" data-s="300,640" data-type="jpeg" data-w="1233" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/dREape4YBzyF5jVxNCORGgSJRgWqy8hD72dmSRN2iaqQ8CibvLricqsLfL7Mauoa1YLLVYDrhp0RNEGsvicky3kibeA/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/mmbiz_jpg/dREape4YBzyF5jVxNCORGgSJRgWqy8hD72dmSRN2iaqQ8CibvLricqsLfL7Mauoa1YLLVYDrhp0RNEGsvicky3kibeA/640?wx_fmt=jpeg"></section></section><section data-mid="" mpa-from-tpl="t"><br></section><section data-mid="" mpa-from-tpl="t"><span></span><br></section></section></section></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/O7lwi8NNjdNoYMJ2ERAJqw",target="_blank" rel="noopener noreferrer">原文链接</a>
