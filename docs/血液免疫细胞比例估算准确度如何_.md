---
title: "血液免疫细胞比例估算准确度如何？"
date: 2023-01-06T02:28:33Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
血液免疫细胞比例估算准确度如何？ by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>通常我们拿到了肿瘤相关的单细胞转录组的表达量矩阵后的第一层次降维聚类分群通常是：</p></blockquote><ul data-tool="mdnice编辑器"><li><section>immune (CD45+,PTPRC),</section></li><li><section>epithelial/cancer (EpCAM+,EPCAM),</section></li><li><section>stromal (CD10+,MME,fibo or CD31+,PECAM1,endo)</section></li></ul><p data-tool="mdnice编辑器">参考我前面介绍过 <a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247488940&amp;idx=1&amp;sn=1cc8a8a74715087939b9721c0881775d&amp;scene=21#wechat_redirect" data-linktype="2">CNS图表复现08—肿瘤单细胞数据第一次分群通用规则</a>，这3大单细胞亚群构成了肿瘤免疫微环境的复杂。绝大部分文章都是抓住免疫细胞亚群进行细分，包括淋巴系（T,B,NK细胞）和髓系（单核，树突，巨噬，粒细胞）的两大类作为第二次细分亚群。但是也有不少文章是抓住stromal 里面的fibo 和endo进行细分，并且编造生物学故事的。</p><p data-tool="mdnice编辑器">而且肿瘤微环境里面的免疫微环境越来越受大家关注，很自然的大家都喜欢拿肿瘤单细胞数据集的降维聚类分群结果去看常规的bulk肿瘤转录组测序矩阵里面的肿瘤微环境细胞亚群比例构成。前面我们虽然介绍了 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519296&amp;idx=1&amp;sn=46296748a3640a4d17c11bef64330910&amp;scene=21#wechat_redirect" data-linktype="2">使用MuSiC以及MuSiC2来根据单细胞转录组结果推断bulk转录组细胞比例</a>，但是仅仅是使用了其示范数据，而且是糖尿病领域，对绝大部分肿瘤研究小伙伴来说有点陌生，所以我们接下来以Seurat里面的单细胞降维聚类分群结果和bulk转录组，结合起来继续说明如何 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519296&amp;idx=1&amp;sn=46296748a3640a4d17c11bef64330910&amp;scene=21#wechat_redirect" data-linktype="2">使用MuSiC以及MuSiC2来根据单细胞转录组结果推断bulk转录组细胞比例</a>。</p><p data-tool="mdnice编辑器">因为是血液免疫，所以免疫细胞亚群进行细分就是，包括淋巴系（T,B,NK细胞）和髓系（单核，树突，巨噬，粒细胞）的两大类。</p><h3 data-tool="mdnice编辑器"><span></span><span>血液免疫细胞常规bulk转录组数据（GEO数据集）</span><span></span></h3><p data-tool="mdnice编辑器">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE74246</p><p data-tool="mdnice编辑器">样品队列是 13 normal hematopoietic cell types and 3 acute myeloid leukemia cell types ，每个病人都有很多细胞亚群的纯化后的常规bulk转录组数据：</p><pre data-tool="mdnice编辑器"><span></span><code>GSM1915582 2596-Bcell<br>GSM1915583 2596-CD4Tcell<br>GSM1915584 2596-CD8Tcell<br>GSM1915585 2596-CLP<br>GSM1915586 2596-Ery<br>GSM1915587 2596-NKcell<br></code></pre><p data-tool="mdnice编辑器">而且作者提供了 1.9M的 GSE74246_RNAseq_All_Counts.txt.gz 表达量矩阵文件下载，下载链接是：</p><ul data-tool="mdnice编辑器"><li><section>https://ftp.ncbi.nlm.nih.gov/geo/series/GSE74nnn/GSE74246/suppl/GSE74246_RNAseq_All_Counts.txt.gz</section></li></ul><h3 data-tool="mdnice编辑器"><span></span><span>血液免疫细胞的单细胞转录组（seurat-data和TENxPBMCData包）</span><span></span></h3><p data-tool="mdnice编辑器">们会推荐 satijalab/seurat-data ，它内置了很多数据集，如果你还没有下面的seurat-data包和pbmc3k对象 ，就自己去下载：</p><pre data-tool="mdnice编辑器"><span></span><code>install.packages(<span>'devtools'</span>)<br>devtools::install_github(<span>'satijalab/seurat-data'</span>)<br><span>library</span>(SeuratData) <span>#加载seurat数据集  </span><br>getOption(<span>'timeout'</span>)<br>options(timeout=<span>10000</span>)<br>InstallData(<span>"pbmc3k"</span>)  <br>data(<span>"pbmc3k"</span>)  <br>sce &lt;- pbmc3k.final  <br></code></pre><p data-tool="mdnice编辑器">但是因为它这个包仍然是在GitHub，所以很多人下载失败， 另外它数据也是在外网，很多人网络有问题无法下载。但是我随时搜索到了一个包，TENxPBMCData ，蛮有意思的，安装和加载：</p><pre data-tool="mdnice编辑器"><span></span><code><span># BiocManager::install('TENxPBMCData') # (286 KB)</span><br><span>library</span>(TENxPBMCData)<br>args(TENxPBMCData) <br></code></pre><p data-tool="mdnice编辑器">因为这个包，TENxPBMCData 并不大，所以它其实也是需要在线下载数据的。目前它有如下所示的10个数据：</p><ol data-tool="mdnice编辑器"><li><section>pbmc68k</section></li><li><section>frozen_pbmc_donor_a</section></li><li><section>frozen_pbmc_donor_b</section></li><li><section>frozen_pbmc_donor_c</section></li><li><section>pbmc33k</section></li><li><section>pbmc3k</section></li><li><section>pbmc6k</section></li><li><section>pbmc4k</section></li><li><section>pbmc8k</section></li><li><section>pbmc5k-CITEseq</section></li></ol><p data-tool="mdnice编辑器">每个数据集都有自己的代号：</p><pre data-tool="mdnice编辑器"><span></span><code><span>function</span> (dataset = c(<span>"pbmc4k"</span>, <span>"pbmc68k"</span>, <span>"frozen_pbmc_donor_a"</span>, <br>    <span>"frozen_pbmc_donor_b"</span>, <span>"frozen_pbmc_donor_c"</span>, <span>"pbmc33k"</span>, <br>    <span>"pbmc3k"</span>, <span>"pbmc6k"</span>, <span>"pbmc8k"</span>, <span>"pbmc5k-CITEseq"</span>), as.sparse = TRUE) <br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>运行MuSiC计算比例</span><span></span></h3><p data-tool="mdnice编辑器">首先读取前面的 1.9M的 GSE74246_RNAseq_All_Counts.txt.gz 表达量矩阵文件：</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br><span>library</span>(MuSiC)<br><span>library</span>(ggplot2)<br><span>library</span>(xbioc)<br><span>library</span>(dplyr)<br><span>library</span>(gridExtra)<br><span>library</span>(grid)<br><span>library</span>(MuSiC2)<br><br>a=data.table::fread(<span>'GSE74246_RNAseq_All_Counts.txt.gz'</span>,data.table = <span>F</span>)<br>length(unique(a[,<span>1</span>]))<br>rownames(a)=a[,<span>1</span>]<br>a=a[,-<span>1</span>]<br>phe = as.data.frame(stringr::str_split(colnames(a),<span>'[-_]'</span>,simplify = <span>T</span>))<br>head(phe)<br>table(phe$V2)<br><br><br>kp = phe$V2 %<span>in</span>% c(<span>'Bcell'</span>, <span>'CD4Tcell'</span>, <span>'CD8Tcell'</span> , <span>'Mono'</span>,<span>'NKcell'</span> )<br>a=a[,kp]<br>phe=phe[kp,]<br></code></pre><p data-tool="mdnice编辑器">这个时候因为数据集GSE74246涉及到的免疫细胞种类实在是有点多，我们仅仅是拿PBMC3K单细胞数据集里面的即可：</p><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages('devtools')</span><br><span># devtools::install_github('satijalab/seurat-data')</span><br><span>library</span>(SeuratData) <span>#加载seurat数据集  </span><br><span>library</span>(Seurat)<br>getOption(<span>'timeout'</span>)<br>options(timeout=<span>10000</span>)<br><span>#InstallData("pbmc3k")  </span><br>data(<span>"pbmc3k"</span>)  <br>sce &lt;- pbmc3k.final  <br>table(Idents(sce))<br><br></code></pre><p data-tool="mdnice编辑器">有了PBMC3K单细胞数据集，而且有了常规的bulk转录组测序矩阵，很容易 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519296&amp;idx=1&amp;sn=46296748a3640a4d17c11bef64330910&amp;scene=21#wechat_redirect" data-linktype="2">使用MuSiC以及MuSiC2来根据单细胞转录组结果推断bulk转录组细胞比例</a>。</p><pre data-tool="mdnice编辑器"><span></span><code><br><span>library</span>(scater)<br>pbmc3k.sce &lt;- SingleCellExperiment(<br>  assays = list(counts =  sce@assays$RNA@counts), <br>  colData = data.frame(cellType=Idents(sce),sampleID=colnames(sce))<br>)<br>pbmc3k.sce<br>colData(pbmc3k.sce)<br>unique(pbmc3k.sce$cellType) <br><br><br><span># music2 deconvolution</span><br>set.seed(<span>1234</span>)<br><span># MuSiC</span><br>bulk.mtx = as.matrix(a)<br>prop_music=music_prop(bulk.mtx = bulk.mtx, sc.sce = pbmc3k.sce, <br>                      clusters = <span>'cellType'</span>, samples = <span>'sampleID'</span>,<br>                      select.ct = unique(pbmc3k.sce$cellType) [<span>1</span>:<span>5</span>],<br>                      verbose = <span>F</span>)$Est.prop.weighted<br>pheatmap::pheatmap(prop_music)<br>pheatmap::pheatmap(prop_music,display_numbers = <span>T</span>)<br><br></code></pre><p data-tool="mdnice编辑器">可以很清楚的看到，这个细胞比例的推断还是蛮成功的 :</p><p><img data-galleryid="" data-ratio="1.036117381489842" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxbJBXafKbfg9NZkMPadL8YTl9GwPmPrricCdTn6rkNm3iaJIyw8TyYTmnhmOtmtB3vXUZPZFGLhzeA/640?wx_fmt=png" data-type="png" data-w="886" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxbJBXafKbfg9NZkMPadL8YTl9GwPmPrricCdTn6rkNm3iaJIyw8TyYTmnhmOtmtB3vXUZPZFGLhzeA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>细胞比例的推断还是蛮成功的</figcaption></figure><p data-tool="mdnice编辑器">因为这个常规的bulk转录组测序矩阵本来就是每个人的血液的各种免疫细胞亚群纯化后的，所以纯化后的样品去卷积推测其单细胞亚群比例就基本上也是比较纯的。</p></section><h4 data-tool="mdnice编辑器"><span>文末友情宣传</span></h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519083&amp;idx=1&amp;sn=61f07b390469617ca2e9924f5b3929ab&amp;scene=21#wechat_redirect" data-linktype="2">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li></ul><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/95TC6GdTCKAa22BJXEQjbA",target="_blank" rel="noopener noreferrer">原文链接</a>
