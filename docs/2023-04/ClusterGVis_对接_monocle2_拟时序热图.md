---
title: "ClusterGVis 对接 monocle2 拟时序热图"
date: 2023-04-29T13:10:05Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
ClusterGVis 对接 monocle2 拟时序热图 by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><h4 data-tool="mdnice编辑器"><span></span></h4><section><mp-common-profile data-pluginname="mpprofile" data-weui-theme="light" data-id="MzkyMTI1MTYxNA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usey42oX5qyLTVibLRO9dz8ic5G4TpEHQc9rICYlpS4MHg6Et8cgXrQDqibvibXombicTro8t9cekJRlDBcw/0?wx_fmt=png" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-from="0" data-is_biz_ban="0"></mp-common-profile></section></section><section><qqmusic musicid="106708125" mid="000Zbl1S04Xq3s" albumurl="https://y.gtimg.cn/music/photo_new/T002R68x68M000000ndvXv1aYZnt.jpg" audiourl="http://isure6.stream.qqmusic.qq.com/C200004PKwqT2u0rtC.m4a?guid=2000000052&amp;vkey=1CFF50F575F7FCE915A9834989F03E4CEABCC59C74229909B47742916EAE9360B8363AAD639B43E571A0BBC26835FD879B5C6533C98C3F16&amp;uin=0&amp;fromtag=20052" music_name="空白格" singer="杨宗纬 - 空白格" play_length="218" src="/mp/readtemplate?t=app_editor/music&amp;singer=%E6%9D%A8%E5%AE%97%E7%BA%AC%20-%20%E7%A9%BA%E7%99%BD%E6%A0%BC&amp;music_name=%E7%A9%BA%E7%99%BD%E6%A0%BC&amp;albumurl=https%3A%2F%2Fy.gtimg.cn%2Fmusic%2Fphoto_new%2FT002R68x68M000000ndvXv1aYZnt.jpg&amp;musictype=1" musictype="1" otherid="000Zbl1S04Xq3s" albumid="000ndvXv1aYZnt" jumpurlkey="" data-pluginname="insertaudio"></qqmusic></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h4 data-tool="mdnice编辑器"><span></span></h4><h2 data-tool="mdnice编辑器"><span><span>1</span></span><span>引言</span><span></span></h2><blockquote data-tool="mdnice编辑器"><p><strong>五一是个好日子, 有的人放下手头紧张的工作,带着家人孩子,好好休息放松一下,有的人来一场说走就走的蜜月之行,有的人则是大喜之日。明天是我堂弟和本科老铁的大喜之日,在这里,真心,诚挚的祝福你们跨入了人生的另一个阶段,祝福你们长长久久,幸福美满,甜甜蜜蜜至海枯石烂,好好努力,携手创造你们美好的未来!</strong></p></blockquote><blockquote data-tool="mdnice编辑器"><p>看了一下 monocle2 绘制拟时序热图的源码,主要有三个函数</p><ul><li><section><strong>plot_pseudotime_heatmap</strong></section></li><li><section><strong>plot_genes_branched_heatmap</strong></section></li><li><section><strong>plot_multiple_branches_heatmap</strong></section></li></ul><p>大致过程是取出矩阵然后使用 <strong>pheatmap</strong> 函数聚类,然后再拿聚类的结果再次用 <strong>pheatmap</strong> 重新绘图,我主要是在这三个函数后面做一个数据整理的工作,然后你就可以用 <strong>ClusterGVis</strong> 来画图了。新的函数名后面加个 2 就可以调用了:</p><ul><li><section><strong>plot_pseudotime_heatmap2</strong></section></li><li><section><strong>plot_genes_branched_heatmap2</strong></section></li><li><section><strong>plot_multiple_branches_heatmap2</strong></section></li></ul><p>意思就是你可以用这些函数画原来 <strong>monocle2</strong> 原生的图,也可以拿到整理的数据给 <strong>ClusterGVis</strong> 来画图。</p></blockquote><h2 data-tool="mdnice编辑器"><span><span>2</span></span><span>安装</span><span></span></h2><p data-tool="mdnice编辑器">重新安装获取新功能:</p><pre data-tool="mdnice编辑器"><span></span><code><span># Note: please update your ComplexHeatmap to the latest version!</span><br><span># install.packages("devtools")</span><br>devtools::install_github(<span>"junjunlab/ClusterGVis"</span>)<br></code></pre><h2 data-tool="mdnice编辑器"><span><span>3</span></span><span>使用介绍</span><span></span></h2><p data-tool="mdnice编辑器">加载一下需要用到的测试数据:</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ClusterGVis)<br><br>data(<span>"HSMM"</span>)<br>data(<span>"BEAM_res"</span>)<br>data(<span>"sig_gene_names"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>plot_pseudotime_heatmap2</span><span></span></h3><p data-tool="mdnice编辑器">用法和 <strong>monocle2</strong> 的没有区别:</p><pre data-tool="mdnice编辑器"><span></span><code><span># return plot</span><br>plot_pseudotime_heatmap2(HSMM[sig_gene_names[<span>1</span>:<span>100</span>],],<br>                         num_clusters = <span>4</span>,<br>                         cores = <span>1</span>,<br>                         show_rownames = <span>T</span>,<br>                         return_heatmap = <span>T</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.4485981308411215" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4vHdlNlVUzoiaITxEiaOiaicPVGPtQbOPZTRP45icWJRNQqrHrMGDs5nqrbg/640?wx_fmt=png" data-type="png" data-w="642" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4vHdlNlVUzoiaITxEiaOiaicPVGPtQbOPZTRP45icWJRNQqrHrMGDs5nqrbg/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><p><strong>return_heatmap</strong> 设置为 <strong>FALSE</strong> 则返回整理好的聚类信息数据,当然你可以拿这个自己去自由的绘图:</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code><span># test code</span><br>df &lt;- plot_pseudotime_heatmap2(HSMM[sig_gene_names[<span>1</span>:<span>100</span>],],<br>                               num_clusters = <span>4</span>,<br>                               cores = <span>1</span>)<br><br><span># check data</span><br>str(df)<br><span># List of 6</span><br><span># $ wide.res  :'data.frame': 100 obs. of  102 variables:</span><br><span>#   ..$ gene   : chr [1:100] "TSPAN6" "C1orf112" "CYP51A1" "AK2" ...</span><br><span># ..$ 1      : num [1:100] -1.573 2.783 -1.646 -0.566 2.264 ...</span><br><span># ..$ 2      : num [1:100] -1.55 2.65 -1.62 -0.57 2.19 ...</span><br><span># ..$ 3      : num [1:100] -1.524 2.517 -1.587 -0.575 2.118 ...</span><br><span># ...</span><br><span># $ long.res  :'data.frame': 10000 obs. of  5 variables:</span><br><span>#   ..$ cluster     : Factor w/ 4 levels "1","2","3","4": 1 1 1 1 1 1 1 1 1 1 ...</span><br><span># ..$ gene        : chr [1:10000] "TSPAN6" "CYP51A1" "AASS" "MGST1" ...</span><br><span># ..$ cell_type   : num [1:10000] 1 1 1 1 1 1 1 1 1 1 ...</span><br><span># ..$ norm_value  : num [1:10000] -1.573 -1.646 -1.86 -0.457 -2.024 ...</span><br><span># ..$ cluster_name: Factor w/ 4 levels "cluster 1 (14)",..: 1 1 1 1 1 1 1 1 1 1 ...</span><br><span># $ type      : chr "monocle"</span><br><span># $ geneMode  : chr "all"</span><br><span># $ geneType  : chr "non-branched"</span><br><span># $ pseudotime: num [1:100] 0 0.236 0.471 0.707 0.942 ...</span><br></code></pre><p data-tool="mdnice编辑器">折线图,横坐标是拟时序时间:</p><pre data-tool="mdnice编辑器"><span></span><code><span># plot</span><br>visCluster(object = df,plot.type = <span>"line"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.2967121090617482" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4MYuJfbLOqjCIUzp5N8VAg17uDQU8ibJnTHq9m1J5pACw2Mwibb2Fnt3g/640?wx_fmt=png" data-type="png" data-w="1247" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4MYuJfbLOqjCIUzp5N8VAg17uDQU8ibJnTHq9m1J5pACw2Mwibb2Fnt3g/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">热图:</p><pre data-tool="mdnice编辑器"><span></span><code>visCluster(object = df,plot.type = <span>"heatmap"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.196629213483146" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4TfahvS9KyPESp78dRqEdDDFiaGKwFn3fCicukjngT9lde3kEh5mbLMJQ/640?wx_fmt=png" data-type="png" data-w="712" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4TfahvS9KyPESp78dRqEdDDFiaGKwFn3fCicukjngT9lde3kEh5mbLMJQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">标注基因:</p><pre data-tool="mdnice编辑器"><span></span><code>pdf(file = <span>"gh.pdf"</span>,height = <span>8</span>,width = <span>6</span>,onefile = <span>F</span>)<br>gene = sample(df$wide.res$gene,<span>20</span>,replace = <span>F</span>)<br>visCluster(object = df,plot.type = <span>"heatmap"</span>,<br>           markGenes = gene)<br>dev.off()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.3283858998144713" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4E5zliaStJd0hU8EwmN1DpxgWQmLzEEmjMt4duSSvheTHOjVmn8G857g/640?wx_fmt=png" data-type="png" data-w="539" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4E5zliaStJd0hU8EwmN1DpxgWQmLzEEmjMt4duSSvheTHOjVmn8G857g/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器"><strong>pseudotime_col</strong> 参数修改拟时序注释颜色:</p><pre data-tool="mdnice编辑器"><span></span><code>visCluster(object = df,plot.type = <span>"heatmap"</span>,<br>           pseudotime_col = c(<span>"green"</span>,<span>"red"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.0838068181818181" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4HVUKKt6S67AhrklgMZzXpRf0b1ialv6xXt8feNY0yIFmwic1WooIfeLg/640?wx_fmt=png" data-type="png" data-w="704" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4HVUKKt6S67AhrklgMZzXpRf0b1ialv6xXt8feNY0yIFmwic1WooIfeLg/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">添加趋势线:</p><pre data-tool="mdnice编辑器"><span></span><code>pdf(file = <span>"one-branch.pdf"</span>,height = <span>6</span>,width = <span>5</span>)<br>visCluster(object = df,plot.type = <span>"both"</span>)<br>dev.off()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.1886477462437395" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4Crreyvl7MKw6LNT2u5TeRLbURAYPtOkXvFC5PmT8gyftxoc5WWJgow/640?wx_fmt=png" data-type="png" data-w="599" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4Crreyvl7MKw6LNT2u5TeRLbURAYPtOkXvFC5PmT8gyftxoc5WWJgow/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>plot_genes_branched_heatmap2</span><span></span></h3><blockquote data-tool="mdnice编辑器"><p><strong>plot_genes_branched_heatmap2</strong> 也是类似的。</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ClusterGVis)<br><br>data(<span>"HSMM"</span>)<br>data(<span>"BEAM_res"</span>)<br><br><span># return plot</span><br>plot_genes_branched_heatmap2(HSMM[row.names(subset(BEAM_res,qval &lt; <span>1e-4</span>)),],<br>                             branch_point = <span>1</span>,<br>                             num_clusters = <span>4</span>,<br>                             cores = <span>1</span>,<br>                             use_gene_short_name = <span>T</span>,<br>                             show_rownames = <span>T</span>,<br>                             return_heatmap = <span>T</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.0902578796561604" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4iceF85ERC7BHquhET41sbYheunOLJW9dlJA7nTyGiaX6YtptAo2glqwQ/640?wx_fmt=png" data-type="png" data-w="698" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4iceF85ERC7BHquhET41sbYheunOLJW9dlJA7nTyGiaX6YtptAo2glqwQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">返回数据:</p><pre data-tool="mdnice编辑器"><span></span><code><span># test code</span><br>df &lt;- plot_genes_branched_heatmap2(HSMM[row.names(subset(BEAM_res,qval &lt; <span>1e-4</span>)),],<br>                                   branch_point = <span>1</span>,<br>                                   num_clusters = <span>4</span>,<br>                                   cores = <span>1</span>,<br>                                   use_gene_short_name = <span>T</span>,<br>                                   show_rownames = <span>T</span>)<br><br><span># check data</span><br>str(df)<br><span># List of 6</span><br><span># $ wide.res  :'data.frame': 36 obs. of  202 variables:</span><br><span>#   ..$ gene   : chr [1:36] "BIRC5" "CDKN3" "ACTA2" "EFEMP1" ...</span><br><span># ..$ 1      : num [1:36] 1.544 2.571 1.329 -1.595 0.609 ...</span><br><span># ..$ 2      : num [1:36] 1.317 2.021 1.17 -1.45 0.498 ...</span><br><span># ..$ 3      : num [1:36] 1.101 1.505 1.015 -1.295 0.389 ...</span><br><span># .. [list output truncated]</span><br><span># $ long.res  :'data.frame': 7200 obs. of  5 variables:</span><br><span>#   ..$ cluster     : Factor w/ 4 levels "1","2","3","4": 1 1 1 1 1 1 1 1 1 1 ...</span><br><span># ..$ gene        : chr [1:7200] "BIRC5" "CDKN3" "STMN1" "CENPF" ...</span><br><span># ..$ cell_type   : num [1:7200] 1 1 1 1 1 1 1 1 1 1 ...</span><br><span># ..$ norm_value  : num [1:7200] 1.544 2.571 0.609 1.807 2.177 ...</span><br><span># ..$ cluster_name: Factor w/ 4 levels "cluster 1 (27)",..: 1 1 1 1 1 1 1 1 1 1 ...</span><br><span># $ type      : chr "monocle"</span><br><span># $ geneMode  : chr "all"</span><br><span># $ geneType  : chr "branched"</span><br><span># $ pseudotime: chr [1:200] "Cell fate 1" "Cell fate 1" "Cell fate 1" "Cell fate 1" ...</span><br></code></pre><p data-tool="mdnice编辑器">热图:</p><pre data-tool="mdnice编辑器"><span></span><code>visCluster(object = df,plot.type = <span>"heatmap"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.095100864553314" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4jYKkVHfroaZjaKRY1rPqzsqVtMBOG3KcXnbkbXMD0ZmmjxODmQGaUQ/640?wx_fmt=png" data-type="png" data-w="694" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4jYKkVHfroaZjaKRY1rPqzsqVtMBOG3KcXnbkbXMD0ZmmjxODmQGaUQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">修改注释颜色:</p><pre data-tool="mdnice编辑器"><span></span><code>visCluster(object = df,plot.type = <span>"heatmap"</span>,<br>           pseudotime_col = c(<span>"purple"</span>,<span>"yellow"</span>,<span>"green"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.0903873744619799" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN448Tb9ONibSicUFA5k5QbqQgAFUgZJApNfZr45ib2zJibL2AODZGb153Ecw/640?wx_fmt=png" data-type="png" data-w="697" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN448Tb9ONibSicUFA5k5QbqQgAFUgZJApNfZr45ib2zJibL2AODZGb153Ecw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">添加折线图:</p><pre data-tool="mdnice编辑器"><span></span><code>pdf(file = <span>"two-branch.pdf"</span>,height = <span>6</span>,width = <span>7</span>)<br>visCluster(object = df,plot.type = <span>"both"</span>)<br>dev.off()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.854066985645933" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4Zq7MEr9k3x6nx1tHwMcmEraoWiajR5FPrgRIAaH6b6YBAM8SydS44VA/640?wx_fmt=png" data-type="png" data-w="836" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4Zq7MEr9k3x6nx1tHwMcmEraoWiajR5FPrgRIAaH6b6YBAM8SydS44VA/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>plot_multiple_branches_heatmap2</span><span></span></h3><blockquote data-tool="mdnice编辑器"><p><strong>plot_multiple_branches_heatmap2</strong> 绘制多个分支的时序热图。</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code><span># return plot</span><br>plot_multiple_branches_heatmap2(HSMM[row.names(subset(BEAM_res,qval &lt; <span>1e-4</span>)),],<br>                                branches = c(<span>1</span>,<span>3</span>,<span>4</span>,<span>5</span>),<br>                                num_clusters = <span>4</span>,<br>                                cores = <span>1</span>,<br>                                use_gene_short_name = <span>T</span>,<br>                                show_rownames = <span>T</span>,<br>                                return_heatmap = <span>T</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7303370786516854" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4jKm7Ndkn3x9Qia7eOO42iadw93l2zUkmMRHabS6WvWemiakqWpoGg16Ig/640?wx_fmt=png" data-type="png" data-w="979" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4jKm7Ndkn3x9Qia7eOO42iadw93l2zUkmMRHabS6WvWemiakqWpoGg16Ig/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">返回数据:</p><pre data-tool="mdnice编辑器"><span></span><code><span># test code</span><br>df &lt;- plot_multiple_branches_heatmap2(HSMM[row.names(subset(BEAM_res,qval &lt; <span>1e-4</span>)),],<br>                                      branches = c(<span>1</span>,<span>3</span>,<span>4</span>,<span>5</span>),<br>                                      num_clusters = <span>4</span>,<br>                                      cores = <span>1</span>,<br>                                      use_gene_short_name = <span>T</span>,<br>                                      show_rownames = <span>T</span>)<br><br><span># check data</span><br>str(df)<br><span># List of 6</span><br><span># $ wide.res  :'data.frame': 36 obs. of  402 variables:</span><br><span>#   ..$ gene   : chr [1:36] "BIRC5" "CDKN3" "ACTA2" "EFEMP1" ...</span><br><span># ..$ 1      : num [1:36] 2.124 2.219 -0.908 -1.749 1.244 ...</span><br><span># ..$ 2      : num [1:36] 2.061 2.156 -0.937 -1.699 1.24 ...</span><br><span># ..$ 3      : num [1:36] 1.999 2.094 -0.965 -1.649 1.236 ...</span><br><span># $ long.res  :'data.frame': 14400 obs. of  5 variables:</span><br><span>#   ..$ cluster     : Factor w/ 4 levels "1","2","3","4": 1 1 1 1 1 1 1 1 1 1 ...</span><br><span># ..$ gene        : chr [1:14400] "BIRC5" "CDKN3" "STMN1" "CENPF" ...</span><br><span># ..$ cell_type   : num [1:14400] 1 1 1 1 1 1 1 1 1 1 ...</span><br><span># ..$ norm_value  : num [1:14400] 2.12 2.22 1.24 2.01 2.71 ...</span><br><span># ..$ cluster_name: Factor w/ 4 levels "cluster 1 (18)",..: 1 1 1 1 1 1 1 1 1 1 ...</span><br><span># $ type      : chr "monocle"</span><br><span># $ geneMode  : chr "all"</span><br><span># $ geneType  : chr "branched"</span><br><span># $ pseudotime: Factor w/ 4 levels "1","3","4","5": 1 1 1 1 1 1 1 1 1 1 ...</span><br></code></pre><p data-tool="mdnice编辑器">热图:</p><pre data-tool="mdnice编辑器"><span></span><code>visCluster(object = df,plot.type = <span>"heatmap"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7291242362525459" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4K1sNq3V10pYhHGcUbDbettM8nynzKAoMuy6BrBebb99Qzt80qr0Ltw/640?wx_fmt=png" data-type="png" data-w="982" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4K1sNq3V10pYhHGcUbDbettM8nynzKAoMuy6BrBebb99Qzt80qr0Ltw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">修改注释颜色和热图颜色:</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(RColorBrewer)<br>visCluster(object = df,<br>           plot.type = <span>"heatmap"</span>,<br>           ht.col.list = list(col_range = seq(-<span>2</span>,<span>2</span>,length.out = <span>100</span>),<br>                              col_color = colorRampPalette(brewer.pal(<span>9</span>,<span>"PRGn"</span>))(<span>100</span>)),<br>           pseudotime_col = ggsci::pal_d3()(<span>4</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7316326530612245" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4Ye3eZqZTssUjl4GGvUMXGwazyiaS9QlVzLy9iaNUXL2icUOiaVYdRqIS4Q/640?wx_fmt=png" data-type="png" data-w="980" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4Ye3eZqZTssUjl4GGvUMXGwazyiaS9QlVzLy9iaNUXL2icUOiaVYdRqIS4Q/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">添加趋势线:</p><pre data-tool="mdnice编辑器"><span></span><code>pdf(file = <span>"multiple-branch.pdf"</span>,height = <span>6</span>,width = <span>8</span>)<br>visCluster(object = df,plot.type = <span>"both"</span>)<br>dev.off()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7427083333333333" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN40icMn82ICDE3cLo5rLAd9Vvo46TgwEhd07FCPW0yzXjw2cic1OUKK1Yw/640?wx_fmt=png" data-type="png" data-w="960" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN40icMn82ICDE3cLo5rLAd9Vvo46TgwEhd07FCPW0yzXjw2cic1OUKK1Yw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">添加富集注释信息:</p><pre data-tool="mdnice编辑器"><span></span><code><span># enrich</span><br>df &lt;- plot_multiple_branches_heatmap2(HSMM[row.names(subset(BEAM_res,qval &lt; <span>0.1</span>)),],<br>                                      branches = c(<span>1</span>,<span>3</span>,<span>4</span>,<span>5</span>),<br>                                      num_clusters = <span>4</span>,<br>                                      cores = <span>1</span>,<br>                                      use_gene_short_name = <span>T</span>,<br>                                      show_rownames = <span>T</span>)<br><br><span># enrich for clusters</span><br><span>library</span>(org.Hs.eg.db)<br>enrich &lt;- enrichCluster(object = df,<br>                        OrgDb = org.Hs.eg.db,<br>                        type = <span>"BP"</span>,<br>                        organism = <span>"hsa"</span>,<br>                        pvalueCutoff = <span>0.5</span>,<br>                        topn = <span>5</span>,<br>                        seed = <span>5201314</span>)<br><br><span># check</span><br>head(enrich[<span>1</span>:<span>3</span>,])<br><br><span>#            group                      Description      pvalue ratio</span><br><span># GO:1904238    C1    pericyte cell differentiation 0.002325826    25</span><br><span># GO:0034982    C1 mitochondrial protein processing 0.002748268    25</span><br><span># GO:0072537    C1            fibroblast activation 0.002748268    25</span><br><br>markGenes = sample(unique(df$wide.res$gene),<span>25</span>,replace = <span>F</span>)<br><br><span># PLOT</span><br>pdf(<span>'branch-enrich.pdf'</span>,height = <span>9</span>,width = <span>16</span>,onefile = <span>F</span>)<br>visCluster(object = df,<br>           plot.type = <span>"both"</span>,<br>           column_names_rot = <span>45</span>,<br>           show_row_dend = <span>F</span>,<br>           markGenes = markGenes,<br>           markGenes.side = <span>"left"</span>,<br>           annoTerm.data = enrich,<br>           go.col = rep(jjAnno::useMyCol(<span>"calm"</span>,n = <span>4</span>),each = <span>5</span>),<br>           add.bar = <span>T</span>,<br>           line.side = <span>"left"</span>)<br>dev.off()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5613760750586395" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4L6nP7VMnLBCrP7O09WNs6Ga0xniaibxT1AVVNcwpxueyMmF8CngXp8ibg/640?wx_fmt=png" data-type="png" data-w="1279" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4L6nP7VMnLBCrP7O09WNs6Ga0xniaibxT1AVVNcwpxueyMmF8CngXp8ibg/640?wx_fmt=png"></figure><h2 data-tool="mdnice编辑器"><span><span>4</span></span><span>结尾</span><span></span></h2><blockquote data-tool="mdnice编辑器"><p><strong>路漫漫其修远兮,吾将上下而求索。</strong></p></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">欢迎加入生信交流群。加我微信我也拉你进 <strong>微信群聊</strong> <strong>老俊俊生信交流群</strong> <strong>(微信交流群需收取 20 元入群费用,一旦交费,拒不退还!(防止骗子和便于管理))</strong> 。QQ 群可免费加入, 记得进群按格式修改备注哦。</p><section data-tool="mdnice编辑器"><section><p><strong>老俊俊微信：</strong></p><figure><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4wurxsbyt4AYYPpWLVx0RFiaC0DfINiaAhUlEj2dcerzicuxbzhkSoWj7A/640?wx_fmt=png" data-type="png" data-w="430" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4wurxsbyt4AYYPpWLVx0RFiaC0DfINiaAhUlEj2dcerzicuxbzhkSoWj7A/640?wx_fmt=png"></figure><figure><img data-ratio="1.3668430335097002" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4fKSnD9ACFDuprRkIE7TO2oVQ2WXBkO6kSdw1y2rm3ZFwTEPZ5HAolw/640?wx_fmt=png" data-type="png" data-w="567" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4fKSnD9ACFDuprRkIE7TO2oVQ2WXBkO6kSdw1y2rm3ZFwTEPZ5HAolw/640?wx_fmt=png"></figure></section><section><p><strong>知识星球：</strong></p><figure><img data-ratio="1.5896226415094339" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4FuX3ZBdUcFqE86nMO5hKc3hRXiaibKGhtJcC5arhyt523o2H77QJ6VHg/640?wx_fmt=jpeg" data-type="jpeg" data-w="1060" src="https://mmbiz.qpic.cn/mmbiz_jpg/G5jjcE4usexGiaTibOyqeaqpO7yf6vOKN4FuX3ZBdUcFqE86nMO5hKc3hRXiaibKGhtJcC5arhyt523o2H77QJ6VHg/640?wx_fmt=jpeg"></figure></section></section><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><br></p><center data-tool="mdnice编辑器"><strong> 往期回顾目录</strong></center><blockquote data-tool="mdnice编辑器"><p><br></p><center><strong><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247509098&amp;idx=1&amp;sn=51429bbb87f100744c50d4756375b089&amp;chksm=c1849e1bf6f3170d20d5aa284e7b28367d2ec4031644f01df96952de92f70e11e3a36c8d4d5e&amp;token=46732270&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">在 R 里面调用 julia</a></strong></center><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247509081&amp;idx=1&amp;sn=300079e94a3b4da37e758d0eff5aac5b&amp;chksm=c1849e28f6f3173e786d633d10d3a7ecd4ea2b8833da59eff8cdff7458ffa66de329507d5d59&amp;token=1997382993&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">听说你想给聚类图旁边加个细胞数量条形图?</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247509065&amp;idx=1&amp;sn=74a7cb682d0895e75b27fff0621f1246&amp;chksm=c1849e38f6f3172ef335fb1d6a7f1a17f21969375f7003b6d9eb0b8153a3c54aaa2363eca253&amp;token=1997382993&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">如何给单细胞降维图例上添加亚群编号</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247508977&amp;idx=1&amp;sn=94817e9cb7bb07697a8592476f10875b&amp;chksm=c1849980f6f31096e2de956f9d82b8eee8fc85db486a289bf830af0357240631ef10a0f87a1f&amp;token=811397361&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">geom_arch2 绘制指定高度的弧线</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247508952&amp;idx=1&amp;sn=32b0f917e455a5d4b3f6d41043699bb8&amp;chksm=c18499a9f6f310bf7c6ed3099886e05bcae4de735eb016799a256e916bc4adaff2aaf08eeb06&amp;token=811397361&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">geom_cross_axis 绘制交叉坐标轴</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247508917&amp;idx=1&amp;sn=5d05856acbdd7ed8eec866615f339660&amp;chksm=c18499c4f6f310d29f9fd83915d881ad5734441aac4a71ce1dc1d695f5908b1aa3ff4ccc0039&amp;token=811397361&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">geom_markArrow 修饰你的单细胞图形</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247508861&amp;idx=1&amp;sn=10f6214664d87ac0af77fb57cfe35e49&amp;chksm=c184990cf6f3101ae36c0fb28c1009f5819e54576aa26247e8663d617d6c8003beee82a73f41&amp;token=1563877073&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">绘制渐变色三角形</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247508833&amp;idx=1&amp;sn=88c34c7d395daaf5f60203d9fc06df02&amp;chksm=c1849910f6f3100648723bd7256c5520f903a6effc6d9e08b31d2726a9a5091ea8c362dc5a2d&amp;token=1563877073&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">它...它来了: trackVisProMax</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247508806&amp;idx=1&amp;sn=93211aca628f0ae07f3acb0b411f0e49&amp;chksm=c1849937f6f310214fab2df33a686462cc774f0f9d95e0fdfd6bb14ebcfe91842f31e8262314&amp;token=536314270&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">矩形旋转问题之风波再起</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247508772&amp;idx=1&amp;sn=5efd2503f980803259c209d59d0f4abc&amp;chksm=c1849955f6f310438c821c416fef48260e1660c7a732158f73d9c8236b1e856ea5acf2691ef7&amp;token=1671488784&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">染色体绘制之温故而知新</a></center></strong><p><br></p></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Etb5XwijFC7P7zX8nhnoLg",target="_blank" rel="noopener noreferrer">原文链接</a>
