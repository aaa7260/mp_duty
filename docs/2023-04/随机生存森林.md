---
title: "随机生存森林"
date: 2023-04-18T10:22:11Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
随机生存森林 by 生信星球
------
<div><section data-mpa-powered-by="yiban.io"><span>‍</span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png"><span> 今天是生信星球陪你的<span><strong>第903天</strong></span></span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"></section><hr><p><span><span>   </span><span>大神一句话，菜鸟跑半年。我不是大神，但我可以缩短你走弯路的半年~</span></span></p><p><span>   就像歌儿唱的那样，如果你不知道该往哪儿走，就留在这学点生信好不好~</span></p><p><span>   这里有豆豆和花花的学习历程，从新手到进阶，生信路上有你有我!</span></p><section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">层出不穷的机器学习算法。数据挖掘文章里的新花样。。。</p><h3 data-tool="mdnice编辑器"><span></span><span>1.示例数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br>library(randomForestSRC)<br>library(survival)<br>data(vdv, package = <span>"randomForestSRC"</span>)<br>dim(vdv)<br><span>## [1]   78 4707</span><br>vdv[1:5,1:5]<br><span>##    Time Censoring AA555029_RC AA598803_RC     AB002301</span><br><span>## 1 12.53         0  -0.5049331  -0.2425008 -0.199315682</span><br><span>## 2  6.44         0  -0.5879813   0.4384945 -0.621200562</span><br><span>## 3 10.66         0  -0.3521244  -0.2258911  0.006643856</span><br><span>## 4 13.00         0  -0.4750357   0.5016111 -0.671029449</span><br><span>## 5 11.98         0  -0.1660964   0.1361991  0.989934564</span><br>boxplot(vdv[,3:10])<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7148148148148148" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrAoHfG5ylBPK2cgmsw7zYSHzTgV9CT4rQGsQkP8BmFmkuQwBS4JZAFf8nicjQWooqRBRcNpAfJNXg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrAoHfG5ylBPK2cgmsw7zYSHzTgV9CT4rQGsQkP8BmFmkuQwBS4JZAFf8nicjQWooqRBRcNpAfJNXg/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>2.代码</span><span></span></h3><p data-tool="mdnice编辑器">这里使用的是官方文档里的例子 https://cran.r-project.org/web/packages/randomForestSRC/randomForestSRC.pdf</p><p data-tool="mdnice编辑器">var.select的示例。</p><p data-tool="mdnice编辑器">和cox结合，按照单因素cox的p值设置了权重。</p><pre data-tool="mdnice编辑器"><span></span><code>cox.weights &lt;- <span>function</span>(rfsrc.f, rfsrc.data) {<br>  event.names &lt;- all.vars(rfsrc.f)[1:2]<br>  p &lt;- ncol(rfsrc.data) - 2<br>  event.pt &lt;- match(event.names, names(rfsrc.data))<br>  xvar.pt &lt;- setdiff(1:ncol(rfsrc.data), event.pt)<br>  sapply(1:p, <span>function</span>(j) {<br>    cox.out &lt;- coxph(rfsrc.f, rfsrc.data[, c(event.pt, xvar.pt[j])])<br>    pvalue &lt;- summary(cox.out)<span>$coef</span>[5]<br>    <span>if</span> (is.na(pvalue)) 1.0 <span>else</span> 1/(pvalue + 1e-100)<br>  })<br>}       <br>rfsrc.f &lt;- as.formula(Surv(Time, Censoring) ~ .)<br>rfsrc.f<br><span>## Surv(Time, Censoring) ~ .</span><br></code></pre><p data-tool="mdnice编辑器">cox.weights函数就是根据单因素coxp值计算权重用的。rfsrc.f是生存模型公式</p><pre data-tool="mdnice编辑器"><span></span><code>cox.wts &lt;- cox.weights(rfsrc.f, vdv)<br><span>#vh.model &lt;- rfsrc(rfsrc.f, vdv , nsplit = 10, </span><br><span>#                  xvar.wt = cox.wts,importance = "random",</span><br><span>#                  na.action ="na.impute",ntree = 1000)</span><br></code></pre><p data-tool="mdnice编辑器">变量选择</p><pre data-tool="mdnice编辑器"><span></span><code>vh.breast.cox &lt;- var.select(rfsrc.f, vdv, method = <span>"vh"</span>, nstep = 5,<br>                            nrep = 10, xvar.wt = cox.wts)<br><br><span>## ---------------------  Iteration: 1   ---------------------</span><br><span>##   selecting variables using Variable Hunting ...</span><br><span>##   iteration:  1   # vars: 7   joint-vimp: 0.093 </span><br>     iteration:  2   <span># vars: 12   joint-vimp: 0.152 </span><br>     iteration:  3   <span># vars: 17   joint-vimp: 0.176 </span><br>     iteration:  4   <span># vars: 22   joint-vimp: 0.193 </span><br>     iteration:  5   <span># vars: 27   joint-vimp: 0.192 </span><br><br>     PE: 23.1884      dim: 22 <br><span>## ---------------------  Iteration: 2   ---------------------</span><br><span>##   selecting variables using Variable Hunting ...</span><br><span>##   iteration:  1   # vars: 41   joint-vimp: 0.263 </span><br>     iteration:  2   <span># vars: 44   joint-vimp: 0.264 </span><br>     iteration:  3   <span># vars: 48   joint-vimp: 0.257 </span><br><br>     PE: 27.381      dim: 44 <br><span>## ---------------------  Iteration: 3   ---------------------</span><br><span>##   selecting variables using Variable Hunting ...</span><br><span>##   iteration:  1   # vars: 36   joint-vimp: 0.255 </span><br>     iteration:  2   <span># vars: 39   joint-vimp: 0.251 </span><br><br>     PE: 29.7619      dim: 36 <br><span>## ---------------------  Iteration: 4   ---------------------</span><br><span>##   selecting variables using Variable Hunting ...</span><br><span>##   iteration:  1   # vars: 11   joint-vimp: 0.256 </span><br>     iteration:  2   <span># vars: 16   joint-vimp: 0.286 </span><br>     iteration:  3   <span># vars: 20   joint-vimp: 0.291 </span><br>     iteration:  4   <span># vars: 25   joint-vimp: 0.294 </span><br>     iteration:  5   <span># vars: 30   joint-vimp: 0.302 </span><br>     iteration:  6   <span># vars: 35   joint-vimp: 0.3 </span><br><br>     PE: 38.6905      dim: 30 <br><span>## ---------------------  Iteration: 5   ---------------------</span><br><span>##   selecting variables using Variable Hunting ...</span><br><span>##   iteration:  1   # vars: 39   joint-vimp: 0.186 </span><br>     iteration:  2   <span># vars: 42   joint-vimp: 0.186 </span><br>     iteration:  3   <span># vars: 46   joint-vimp: 0.19 </span><br>     iteration:  4   <span># vars: 49   joint-vimp: 0.196 </span><br>     iteration:  5   <span># vars: 52   joint-vimp: 0.196 </span><br>     iteration:  6   <span># vars: 56   joint-vimp: 0.192 </span><br><br>     PE: 14.4928      dim: 52 <br><span>## ---------------------  Iteration: 6   ---------------------</span><br><span>##   selecting variables using Variable Hunting ...</span><br><span>##   iteration:  1   # vars: 38   joint-vimp: 0.27 </span><br>     iteration:  2   <span># vars: 41   joint-vimp: 0.277 </span><br>     iteration:  3   <span># vars: 45   joint-vimp: 0.301 </span><br>     iteration:  4   <span># vars: 48   joint-vimp: 0.302 </span><br>     iteration:  5   <span># vars: 52   joint-vimp: 0.302 </span><br>     iteration:  6   <span># vars: 55   joint-vimp: 0.3 </span><br><br>     PE: 46.4286      dim: 52 <br><span>## ---------------------  Iteration: 7   ---------------------</span><br><span>##   selecting variables using Variable Hunting ...</span><br><span>##   iteration:  1   # vars: 10   joint-vimp: 0.139 </span><br>     iteration:  2   <span># vars: 15   joint-vimp: 0.166 </span><br>     iteration:  3   <span># vars: 20   joint-vimp: 0.178 </span><br>     iteration:  4   <span># vars: 24   joint-vimp: 0.178 </span><br>     iteration:  5   <span># vars: 29   joint-vimp: 0.191 </span><br>     iteration:  6   <span># vars: 34   joint-vimp: 0.199 </span><br>     iteration:  7   <span># vars: 38   joint-vimp: 0.192 </span><br><br>     PE: 25      dim: 34 <br><span>## ---------------------  Iteration: 8   ---------------------</span><br><span>##   selecting variables using Variable Hunting ...</span><br><span>##   iteration:  1   # vars: 47   joint-vimp: 0.233 </span><br>     iteration:  2   <span># vars: 50   joint-vimp: 0.236 </span><br>     iteration:  3   <span># vars: 53   joint-vimp: 0.235 </span><br><br>     PE: 15.873      dim: 50 <br><span>## ---------------------  Iteration: 9   ---------------------</span><br><span>##   selecting variables using Variable Hunting ...</span><br><span>##   iteration:  1   # vars: 9   joint-vimp: 0.193 </span><br>     iteration:  2   <span># vars: 14   joint-vimp: 0.219 </span><br>     iteration:  3   <span># vars: 19   joint-vimp: 0.233 </span><br>     iteration:  4   <span># vars: 24   joint-vimp: 0.231 </span><br><br>     PE: 22.619      dim: 19 <br><span>## ---------------------  Iteration: 10   ---------------------</span><br><span>##   selecting variables using Variable Hunting ...</span><br><span>##   iteration:  1   # vars: 8   joint-vimp: 0.177 </span><br>     iteration:  2   <span># vars: 13   joint-vimp: 0.219 </span><br>     iteration:  3   <span># vars: 18   joint-vimp: 0.225 </span><br>     iteration:  4   <span># vars: 23   joint-vimp: 0.238 </span><br>     iteration:  5   <span># vars: 28   joint-vimp: 0.241 </span><br>     iteration:  6   <span># vars: 33   joint-vimp: 0.25 </span><br>     iteration:  7   <span># vars: 37   joint-vimp: 0.249 </span><br><br>     PE: 34.5238      dim: 33 <br><span>## fitting forests to final selected variables ...</span><br><span>## </span><br><span>## </span><br><span>## -----------------------------------------------------------</span><br><span>## family             : surv </span><br><span>## var. selection     : Variable Hunting </span><br><span>## conservativeness   : medium </span><br><span>## dimension          : 4705 </span><br><span>## sample size        : 78 </span><br><span>## K-fold             : 5 </span><br><span>## no. reps           : 10 </span><br><span>## nstep              : 5 </span><br><span>## ntree              : 500 </span><br><span>## nsplit             : 10 </span><br><span>## mvars              : 942 </span><br><span>## nodesize           : 2 </span><br><span>## refitted forest    : TRUE </span><br><span>## depth ratio        : 3.1277 </span><br><span>## model size         : 37.2 +/- 11.9796 </span><br><span>## PE (K-fold)        : 27.7959 +/- 9.9451 </span><br><span>## </span><br><span>## </span><br><span>## Top variables:</span><br><span>##                depth rel.freq</span><br><span>## AL080059       7.653      100</span><br><span>## NM_005915      7.548      100</span><br><span>## NM_016448      7.668      100</span><br><span>## AA555029_RC    7.827       90</span><br><span>## Contig35251_RC 7.712       90</span><br><span>## NM_006201      7.786       90</span><br><span>## NM_006681      7.890       90</span><br><span>## NM_015239      7.983       90</span><br><span>## Contig43983_RC 7.667       70</span><br><span>## Contig46223_RC 7.916       70</span><br><span>## Contig51464_RC 7.670       70</span><br><span>## NM_001216      8.008       70</span><br><span>## NM_006931      8.091       70</span><br><span>## NM_016577      8.087       70</span><br><span>## Contig44409    7.872       60</span><br><span>## Contig47405_RC 8.154       60</span><br><span>## NM_000436      8.181       60</span><br><span>## NM_020974      8.209       60</span><br><span>## Contig20217_RC 8.109       50</span><br><span>## Contig32185_RC 8.169       50</span><br><span>## Contig48328_RC 8.258       50</span><br><span>## Contig54742_RC 8.208       50</span><br><span>## NM_014246      7.750       50</span><br><span>## NM_018265      8.225       50</span><br><span>## AB020689       8.251       40</span><br><span>## AF052162       8.246       40</span><br><span>## Contig55377_RC 7.957       40</span><br><span>## NM_000507      8.274       40</span><br><span>## NM_004504      8.219       40</span><br><span>## NM_018354      8.284       40</span><br><span>## NM_020142      7.918       40</span><br><span>## AL137718       8.330       30</span><br><span>## Contig25343_RC 8.429       30</span><br><span>## Contig38726_RC 8.354       30</span><br><span>## Contig53268_RC 8.047       30</span><br><span>## Contig63102_RC 7.432       30</span><br><span>## NM_001673      8.368       30</span><br><span>## NM_014968      8.421       30</span><br><span>## -----------------------------------------------------------</span><br><span>#nrep指定变量选择过程的重复次数,实际使用可以写1000，但会增加计算时间</span><br>vh.breast.cox<span>$topvars</span><br><span>##  [1] "AL080059"       "NM_005915"      "NM_016448"      "AA555029_RC"   </span><br><span>##  [5] "Contig35251_RC" "NM_006201"      "NM_006681"      "NM_015239"     </span><br><span>##  [9] "Contig43983_RC" "Contig46223_RC" "Contig51464_RC" "NM_001216"     </span><br><span>## [13] "NM_006931"      "NM_016577"      "Contig44409"    "Contig47405_RC"</span><br><span>## [17] "NM_000436"      "NM_020974"      "Contig20217_RC" "Contig32185_RC"</span><br><span>## [21] "Contig48328_RC" "Contig54742_RC" "NM_014246"      "NM_018265"     </span><br><span>## [25] "AB020689"       "AF052162"       "Contig55377_RC" "NM_000507"     </span><br><span>## [29] "NM_004504"      "NM_018354"      "NM_020142"      "AL137718"      </span><br><span>## [33] "Contig25343_RC" "Contig38726_RC" "Contig53268_RC" "Contig63102_RC"</span><br><span>## [37] "NM_001673"      "NM_014968"</span><br></code></pre><p data-tool="mdnice编辑器">没有常规意义上的系数和cox模型那样的公式，可以用作和lasso回归一样的变量筛选，缩小一下范围，但不用作最后一步。</p></section></section><section><blockquote><section><span>如果因为代码看不懂，而跟不上正文的节奏，可以来找我，系统学习。我的</span><span>课程都是循环开课。</span><span>下一期的时间，点进去咨询微信咯</span><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247492986&amp;idx=1&amp;sn=c5db0884e283fcc50fe2c91f59167ba2&amp;chksm=fdfbad38ca8c242ecab3fad572975ce70ed9f2fb3ac8512eaa5393b54d210ecec4aad8a2c3fd&amp;scene=21#wechat_redirect" textvalue="新的一年，你要不要来‍找我们学习生信" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">新的一年，你要不要来找我们学习生信</a><br></section></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/SIawF_hxvWqxX0dubL9bwg",target="_blank" rel="noopener noreferrer">原文链接</a>
