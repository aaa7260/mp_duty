---
title: "ICGC数据下载和整理"
date: 2023-04-06T04:03:22Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
ICGC数据下载和整理 by 生信星球
------
<div><section data-mpa-powered-by="yiban.io"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png"><span> 今天是生信星球陪你的<span><strong>第902天</strong></span></span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"></section><hr><p><span><span>   </span><span>大神一句话，菜鸟跑半年。我不是大神，但我可以缩短你走弯路的半年~</span></span></p><p><span>   就像歌儿唱的那样，如果你不知道该往哪儿走，就留在这学点生信好不好~</span></p><p><span>   这里有豆豆和花花的学习历程，从新手到进阶，生信路上有你有我!</span></p><section><p>收到一个<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247492986&amp;idx=1&amp;sn=c5db0884e283fcc50fe2c91f59167ba2&amp;chksm=fdfbad38ca8c242ecab3fad572975ce70ed9f2fb3ac8512eaa5393b54d210ecec4aad8a2c3fd&amp;scene=21#wechat_redirect" textvalue="直播课" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">直播课</a>学生求助，整理ICGC数据，遇到一个内存不足的报错。之前还能设置一下memory.limit()，现在已经不能用了。</p><p>所以解决办法是用服务器来搞定哦。又是我来代劳的。<span></span></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span>1.数据下载</span><span></span></h3><p data-tool="mdnice编辑器">https://dcc.icgc.org/</p><figure data-tool="mdnice编辑器"><img data-ratio="0.49907407407407406" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHoYwHYIuCbib2MUFgpvaKFmOCJN65t0L6Y0tdqTwD0jGOrEIhpkq07eUlv754yYRmBS1ibyrM7qPYFg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHoYwHYIuCbib2MUFgpvaKFmOCJN65t0L6Y0tdqTwD0jGOrEIhpkq07eUlv754yYRmBS1ibyrM7qPYFg/640?wx_fmt=png"></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.4935185185185185" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHoYwHYIuCbib2MUFgpvaKFmOGodeuwDkzT01AicJ1cdb2WZYjMTaKwRCIkWxlpTcsyorUFGEu2QTmVA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHoYwHYIuCbib2MUFgpvaKFmOGodeuwDkzT01AicJ1cdb2WZYjMTaKwRCIkWxlpTcsyorUFGEu2QTmVA/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">&gt; https://dcc.icgc.org/releases/current/Projects</p><p data-tool="mdnice编辑器">找到自己要的项目下载即可。以RECA-EU为例。</p><blockquote data-tool="mdnice编辑器"><p>exp_seq.RECA-EU.tsv.gz</p><p>specimen.RECA-EU.tsv.gz</p></blockquote><h3 data-tool="mdnice编辑器"><span></span><span>2. 整理表达矩阵</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br>library(tidyverse)<br>dat = data.table::fread(<span>"exp_seq.RECA-EU.tsv.gz"</span>,data.table = F)<br>dat[1:4,1:4]<br><br><span>##   icgc_donor_id project_code icgc_specimen_id icgc_sample_id</span><br><span>## 1       DO47068      RECA-EU         SP103448       SA507253</span><br><span>## 2       DO47068      RECA-EU         SP103448       SA507253</span><br><span>## 3       DO47068      RECA-EU         SP103448       SA507253</span><br><span>## 4       DO47068      RECA-EU         SP103448       SA507253</span><br><br>colnames(dat) <br><br><span>##  [1] "icgc_donor_id"            "project_code"            </span><br><span>##  [3] "icgc_specimen_id"         "icgc_sample_id"          </span><br><span>##  [5] "submitted_sample_id"      "analysis_id"             </span><br><span>##  [7] "gene_model"               "gene_id"                 </span><br><span>##  [9] "normalized_read_count"    "raw_read_count"          </span><br><span>## [11] "fold_change"              "assembly_version"        </span><br><span>## [13] "platform"                 "total_read_count"        </span><br><span>## [15] "experimental_protocol"    "alignment_algorithm"     </span><br><span>## [17] "normalization_algorithm"  "other_analysis_algorithm"</span><br><span>## [19] "sequencing_strategy"      "raw_data_repository"     </span><br><span>## [21] "raw_data_accession"       "reference_sample_type"</span><br></code></pre><p data-tool="mdnice编辑器">我们需要count，基因id，还有样本ID和病人ID列。病人和样本ID合并为一列</p><pre data-tool="mdnice编辑器"><span></span><code>dat = dat[,c(<br>  <span>'icgc_specimen_id'</span>, <br>  <span>'icgc_donor_id'</span>,<br>  <span>'gene_id'</span>, <br>  <span>'raw_read_count'</span> <br>)]<br>dat = unite(dat, <span>"sample_id"</span>, icgc_specimen_id, icgc_donor_id)<br>head(dat)<br><br><span>##          sample_id         gene_id raw_read_count</span><br><span>## 1 SP103448_DO47068 ENSG00000000003           1986</span><br><span>## 2 SP103448_DO47068 ENSG00000000005              1</span><br><span>## 3 SP103448_DO47068 ENSG00000000419           1418</span><br><span>## 4 SP103448_DO47068 ENSG00000000457            252</span><br><span>## 5 SP103448_DO47068 ENSG00000000460            225</span><br><span>## 6 SP103448_DO47068 ENSG00000000938            382</span><br></code></pre><p data-tool="mdnice编辑器">长变宽，变成常见的表达矩阵的样子</p><pre data-tool="mdnice编辑器"><span></span><code>exp = dat%&gt;% pivot_wider(names_from = sample_id, values_from = raw_read_count) %&gt;%<br>  column_to_rownames(<span>"gene_id"</span>) %&gt;%<br>  as.matrix()<br>exp[1:3,1:3]<br><br><span>##                 SP103448_DO47068 SP103459_DO47072 SP103420_DO47056</span><br><span>## ENSG00000000003             1986              732              423</span><br><span>## ENSG00000000005                1                1               19</span><br><span>## ENSG00000000419             1418              295              216</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>3.分组信息</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>pd = data.table::fread(<span>'specimen.RECA-EU.tsv.gz'</span>,data.table = F)<br>colnames(pd)<br><br><span>##  [1] "icgc_specimen_id"                    "project_code"                       </span><br><span>##  [3] "study_specimen_involved_in"          "submitted_specimen_id"              </span><br><span>##  [5] "icgc_donor_id"                       "submitted_donor_id"                 </span><br><span>##  [7] "specimen_type"                       "specimen_type_other"                </span><br><span>##  [9] "specimen_interval"                   "specimen_donor_treatment_type"      </span><br><span>## [11] "specimen_donor_treatment_type_other" "specimen_processing"                </span><br><span>## [13] "specimen_processing_other"           "specimen_storage"                   </span><br><span>## [15] "specimen_storage_other"              "tumour_confirmed"                   </span><br><span>## [17] "specimen_biobank"                    "specimen_biobank_id"                </span><br><span>## [19] "specimen_available"                  "tumour_histological_type"           </span><br><span>## [21] "tumour_grading_system"               "tumour_grade"                       </span><br><span>## [23] "tumour_grade_supplemental"           "tumour_stage_system"                </span><br><span>## [25] "tumour_stage"                        "tumour_stage_supplemental"          </span><br><span>## [27] "digital_image_of_stained_section"    "percentage_cellularity"             </span><br><span>## [29] "level_of_cellularity"</span><br><br>pd = pd[,c(<br>  <span>'icgc_specimen_id'</span>, <br>  <span>'icgc_donor_id'</span>, <br>  <span>'specimen_type'</span> <br>)]<br>pd = unite(pd, <span>"sample_id"</span>, icgc_specimen_id, icgc_donor_id)<br>head(pd)<br><br><span>##          sample_id                 specimen_type</span><br><span>## 1 SP103444_DO47068 Primary tumour - solid tissue</span><br><span>## 2 SP103452_DO47068        Normal - blood derived</span><br><span>## 3 SP103448_DO47068 Primary tumour - solid tissue</span><br><span>## 4 SP103436_DO47064 Primary tumour - solid tissue</span><br><span>## 5 SP103440_DO47064        Normal - blood derived</span><br><span>## 6 SP103463_DO47072        Normal - blood derived</span><br><br>pd = pd[match(colnames(exp),pd<span>$sample_id</span>),]<br>identical(colnames(exp),pd<span>$sample_id</span>)<br><br><span>## [1] TRUE</span><br><br>table(pd<span>$specimen_type</span>) <br><br><span>## </span><br><span>## Normal - tissue adjacent to primary       Primary tumour - solid tissue </span><br><span>##                                  45                                  91</span><br><br>Group = ifelse(str_detect(pd<span>$specimen_type</span>,<span>"tumour"</span>),<br>                       <span>'tumor'</span>,<span>'normal'</span>)<br>table(Group)<br><br><span>## Group</span><br><span>## normal  tumor </span><br><span>##     45     91</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>4.行名转换</span><span></span></h3><p data-tool="mdnice编辑器">有的数据下载下来就已经是symbol，不需要转换，也有的像这个一样是ENSEMBLID，简单转换一下。</p><pre data-tool="mdnice编辑器"><span></span><code>library(tinyarray)<br>exp = trans_exp_new(exp)<br>save(exp,pd,Group,file = <span>"RECA_exp_pd_Group.Rdata"</span>)<br></code></pre></section><p>刚好需要这个数据的话，后台回复icgc902获取吧。<br></p></section><section><blockquote><section><span>如果因为代码看不懂，而跟不上正文的节奏，可以来找我，系统学习。我的</span><span>课程都是循环开课。</span><span>下一期的时间，点进去咨询微信咯</span><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247492986&amp;idx=1&amp;sn=c5db0884e283fcc50fe2c91f59167ba2&amp;chksm=fdfbad38ca8c242ecab3fad572975ce70ed9f2fb3ac8512eaa5393b54d210ecec4aad8a2c3fd&amp;scene=21#wechat_redirect" textvalue="新的一年，你要不要来‍找我们学习生信" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">新的一年，你要不要来找我们学习生信</a><br></section></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/F-d9PyEgHNpJn432cszcVA",target="_blank" rel="noopener noreferrer">原文链接</a>
