---
title: "R问题｜代码报错如何解决？"
date: 2023-04-19T12:23:30Z
draft: ["false"]
tags: [
  "fetched",
  "庄闪闪的R语言手册"
]
categories: ["Acdemic"]
---
R问题｜代码报错如何解决？ by 庄闪闪的R语言手册
------
<div><p data-mpa-powered-by="yiban.io"><span>点击下方</span><span>公众号</span><span>，回复</span><span>资料分享</span><span>，收获惊喜</span></p><section><mp-common-profile data-pluginname="mpprofile" data-weui-theme="light" data-id="MzI1NjUwMjQxMQ==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHiaOjUwXredJLzMleuKP97WYf7W4ylibNiaRJlP7icneHRGekYcQEPgTLpIDbibTuuEADhn0Sv4Xqhhf4A/0?wx_fmt=png" data-nickname="庄闪闪的R语言手册" data-alias="Zss_R4ds" data-signature="在读统计博士生，R语言爱好者。来跟着我一起学 R 数据科学，可视化。" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>简介</span></h2><p data-tool="mdnice编辑器">最近写论文所需要的代码时，由于数据模拟时，数据变化导致求单位根或者参数估计时出现异常情况。</p><p data-tool="mdnice编辑器">如果你需要将这些错误隐藏或者将其赋值为 NA，需要如何处理呢？本文是小编出现该问题时，所整理记录的笔记。主要参考：<span>1</span><sup>[1]</sup>，<span>2</span><sup>[2]</sup>，<span>3</span><sup>[3]</sup>。</p><h3 data-tool="mdnice编辑器"><span></span><span>本文框架</span></h3><ul><li><p>简介</p></li><ul><li><p>本文框架</p></li></ul><li><p>tryCatch() 及其拓展</p></li><li><p>其他 R 包中类似功能函数</p></li><ul><li><p> purrr::possibly()</p></li></ul><li><p>小编有话说</p></li></ul><h2 data-tool="mdnice编辑器"><span></span><span><code>tryCatch()</code>及其拓展</span></h2><p data-tool="mdnice编辑器"><code>tryCatch()</code>函数可以用于捕捉代码执行时可能发生的错误或异常，并提供对错误/异常的处理。的基本语法如下：</p><pre data-tool="mdnice编辑器"><span></span><code><span>tryCatch</span>({<br>  <span># 执行可能会出错的代码块</span><br>}, error = <span>function</span>(e) {<br>  <span># 处理错误的代码块</span><br>}, <span>warning</span> = <span>function</span>(w) {<br>  <span># 处理警告的代码块</span><br>}, finally = {<br>  <span># 执行无论是否有错误都会执行的代码块</span><br>})<br></code></pre><p data-tool="mdnice编辑器">其中，<code>tryCatch()</code>函数的第一个参数是要执行的代码块。如果在执行过程中出现错误或警告，<code>tryCatch()</code>函数会调用相应的处理函数（error 和 warning）。在处理函数中，可以编写自定义的代码来处理错误或警告。此外，还可以使用 <code>finally</code> 参数指定无论是否发生错误或警告，都会执行的代码块。</p><p data-tool="mdnice编辑器"><strong>简单例子</strong>：演示了如何使用 <code>tryCatch()</code>函数来处理错误：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 定义一个除法函数</span><br>my_divide &lt;- <span>function</span>(x, y) {<br>  x/y<br>}<br><br><span># 尝试对函数进行除以0的操作</span><br>result &lt;- <span>tryCatch</span>({<br>  my_divide(<span>1</span>, <span>0</span>)<br>}, error = <span>function</span>(e) {<br>  <span># 处理除以0错误的代码块</span><br>  cat(<span>"Error:"</span>, e$message, <span>"\n"</span>)<br>}, <span>warning</span> = <span>function</span>(w) {<br>  <span># 处理警告的代码块</span><br>  cat(<span>"Warning:"</span>, w$message, <span>"\n"</span>)<br>}, finally = {<br>  <span># 执行无论是否有错误都会执行的代码块</span><br>  cat(<span>"Finally block executed\n"</span>)<br>})<br><br>print(result)<br><br></code></pre><p data-tool="mdnice编辑器">在这个例子中，<code>my_divide()</code>函数会尝试将两个参数相除。由于第二个参数为 0，因此会出现除以0的错误。<code>tryCatch()</code>函数会捕捉到这个错误，并调用 error 参数中定义的处理函数来处理该错误。在处理函数中，我们使用 <code>cat()</code> 函数输出错误消息。最后，<code>finally</code> 参数中的代码块也会被执行。</p><p data-tool="mdnice编辑器">在R语言中，除了<code>tryCatch()</code>函数之外，还有几个类似的函数可用于处理错误或异常：</p><ol data-tool="mdnice编辑器"><li><section><code>try()</code>函数：与<code>tryCatch()</code>函数类似，都可以用于捕捉代码执行时可能发生的错误或异常。但是，与<code>tryCatch()</code>不同的是，<code>try()</code>函数只能处理错误，无法处理警告。另外，<code>try()</code>函数会返回一个特殊的对象，而不是像<code>tryCatch()</code>函数那样在处理函数中提供更多的灵活性。</section></li><li><section><code>withCallingHandlers()</code>函数：可以用于在执行代码时拦截和处理警告和错误信息。与<code>tryCatch()</code>和<code>try()</code>函数不同的是，<code>withCallingHandlers()</code>函数可以指定不同类型的处理程序来处理警告和错误信息。</section></li><li><section><code>tryCatchLog()</code>函数：一个扩展的<code>tryCatch()</code>函数，可以将错误或警告信息写入日志文件中，以便后续分析。</section></li><li><section><code>tryCatchList()</code>函数：可以用于将多个<code>tryCatch()</code>语句组合成一个列表，以方便同时处理多个错误或异常情况。</section><section><br></section></li></ol><p data-tool="mdnice编辑器">总的来说，<code>tryCatch()</code>函数是处理错误或异常情况的主要函数，但如果需要处理警告或将错误信息记录在日志中，则可以使用其他类似的函数来扩展其功能。</p><h2 data-tool="mdnice编辑器"><span></span><span>其他 R 包中类似功能函数</span></h2><p data-tool="mdnice编辑器">R语言社区中还有很多其他的包提供了类似的函数，扩展了 R 的错误和异常处理功能。以下是一些常用的包及其提供的函数：</p><ol data-tool="mdnice编辑器"><li><section><code>purrr</code> 包中的 <code>possibly()</code> 函数：可以将一个可能会出错的函数转换为一个默认返回 NA 值的函数，从而避免函数执行过程中的错误导致整个代码块中断。该函数也提供了一些控制错误处理的选项，例如可以指定默认返回值或自定义错误消息等。</section></li><li><section><code>assertthat</code> 包中的断言函数：<code>assertthat</code> 包提供了一系列断言函数，可以在代码中插入检查点来确保变量或条件符合特定的规范或预期。这些函数会在变量或条件不符合规范时抛出错误或异常，从而帮助开发人员及早发现问题。</section></li><li><section><code>testthat</code> 包中的测试框架：该包是一个基于单元测试的框架，可以帮助开发人员编写测试用例来测试函数的输出是否符合预期，以及是否存在潜在的错误或异常情况。该框架还提供了一些辅助函数，例如 <code>expect_warning()</code> 和 <code>expect_error()</code> 等，可以测试代码中是否会产生警告或错误信息。</section></li><li><section><code>plyr</code> 包：提供了一些用于数据分组处理的函数，如 <code>ddply()</code>、<code>adply()</code>等，在执行过程中遇到错误时，会自动将出错的子集剔除，然后继续执行。</section></li></ol><h3 data-tool="mdnice编辑器"><span></span><span><code>purrr::possibly()</code></span><span></span></h3><p data-tool="mdnice编辑器">可以使用<code>purrr</code>包中的<code>possibly()</code>函数来处理这些错误，例如将错误值替换为默认值。</p><p data-tool="mdnice编辑器"><strong>简单例子</strong>，演示如何使用 <code>possibly()</code> 函数来处理除以 0 的错误：</p><pre data-tool="mdnice编辑器"><span></span><code>library(purrr)<br><br><span># 定义一个可能会出错的函数</span><br>divide_by &lt;- <span>function</span>(x, y) {<br>  x / y<br>}<br><br><span># 使用 possibly() 函数将函数转换为默认返回值为 NA 的函数</span><br>safe_divide_by &lt;- possibly(divide_by, otherwise = NA)<br><br><span># 对于除以0的情况，函数会返回默认值 NA，而不会报错</span><br>safe_divide_by(10, 0)<br><span>#&gt; [1] NA</span><br><br><span># 对于非除以0的情况，函数会返回正确的值</span><br>safe_divide_by(10, 5)<br><span>#&gt; [1] 2</span><br></code></pre><p data-tool="mdnice编辑器">在上面的例子中，我们定义了一个 <code>divide_by()</code> 函数，用于计算两个数的商。但是，如果第二个参数为0，则会出现错误，从而导致整个代码块中断。</p><p data-tool="mdnice编辑器">为了避免这种情况，我们使用 <code>possibly()</code> 函数将 <code>divide_by()</code> 函数转换为默认返回 NA 值的函数 <code>safe_divide_by()</code>。这样，在除以0的情况下，<code>safe_divide_by()</code> 函数会返回 NA 值，而不会中断代码块的执行。同时，在其他情况下， <code>safe_divide_by()</code> 函数会返回正确的计算结果。</p><h2 data-tool="mdnice编辑器"><span></span><span>小编有话说</span></h2><ul data-tool="mdnice编辑器"><li><section>本文属于小编科研时整理的笔记，仅供参考。</section></li></ul><h3 data-tool="mdnice编辑器"><span>参考资料</span></h3><section data-tool="mdnice编辑器"><span><span>[1]</span><p>1: <em>https://www.r-bloggers.com/2020/10/basic-error-handing-in-r-with-trycatch/</em></p></span><span><span>[2]</span><p>2: <em>https://purrr.tidyverse.org/</em></p></span><span><span>[3]</span><p>3: <em>https://chat.openai.com/chat</em></p></span></section></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">推荐： 可以保存以下照片，在b站扫该二维码，或者b站搜索【庄闪闪】观看Rmarkdown系列的视频教程。Rmarkdown视频新增两节视频（写轮眼幻灯片制作）需要视频内的文档，可在公众号回复【rmarkdown】<br></p></section><p><img data-cropselx1="0" data-cropselx2="558" data-cropsely1="0" data-cropsely2="709" data-ratio="1.2697916666666667" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHgqHNBecRAPwEt9BwiazJN4FgL5hGictfWBVK6f5pS7a3CQBiaE7L8IgJwIcJCQXVdMEsQibnNkiajfoZw/640?wx_fmt=jpeg" data-type="jpeg" data-w="960" src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHgqHNBecRAPwEt9BwiazJN4FgL5hGictfWBVK6f5pS7a3CQBiaE7L8IgJwIcJCQXVdMEsQibnNkiajfoZw/640?wx_fmt=jpeg"></p><section data-mpa-template="t" data-from="yb-recommend-list"><br><section data-mpa-template="t" data-from="yb-recommend" data-recommend-article-type="normal" data-recomment-template-id="1" data-recommend-article-id="2247492028_1" data-recommend-article-time="1615811746" data-recommend-article-cover="http://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHjqYtTRnKYwYP4k7iaZoMibUQYZg8ziaLUAFiaIK4cNS6u5iazLD9ffuN9C8M9pk0Nq5y7GhM5npfTibnRw/0?wx_fmt=jpeg" data-recommend-article-title="R沟通｜Rmarkdown教程（4）" data-recommend-article-content-url="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247492028&amp;idx=1&amp;sn=9964f55b6cdc984f22620330e752226e&amp;chksm=ea271e58dd50974e35b274816cd9dde9cda3c0864487b187b4f2ac87c9773d782b02e5b28816#rd"><a href="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247492028&amp;idx=1&amp;sn=9964f55b6cdc984f22620330e752226e&amp;chksm=ea271e58dd50974e35b274816cd9dde9cda3c0864487b187b4f2ac87c9773d782b02e5b28816&amp;scene=21#wechat_redirect" data-linktype="1"><section data-recommend-type="normal" data-recommend-tid="1" data-mid=""><section data-mid=""><section data-mid=""><span data-positionback="static"><img data-ratio="0.42592592592592593" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHjqYtTRnKYwYP4k7iaZoMibUQYZg8ziaLUAFiaIK4cNS6u5iazLD9ffuN9C8M9pk0Nq5y7GhM5npfTibnRw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHjqYtTRnKYwYP4k7iaZoMibUQYZg8ziaLUAFiaIK4cNS6u5iazLD9ffuN9C8M9pk0Nq5y7GhM5npfTibnRw/640?wx_fmt=jpeg"></span></section><section data-mid=""><p data-recommend-title="t" data-mid="">R沟通｜Rmarkdown教程（4）</p></section></section></section></a></section><br><section data-mpa-template="t" data-from="yb-recommend" data-recommend-article-type="normal" data-recomment-template-id="1" data-recommend-article-id="2247491844_1" data-recommend-article-time="1615203000" data-recommend-article-cover="http://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHjQaBFpiaqVdicmbG9Qc6jzc6libMFWfa3BibLBAuEvheHibyV9XmEElb1t3DbCLQksuL8TK9PWYaZsmrw/0?wx_fmt=jpeg" data-recommend-article-title="R沟通｜Rmarkdown教程（3）" data-recommend-article-content-url="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247491844&amp;idx=1&amp;sn=36decacb06ca6ce1fc689141174bb98f&amp;chksm=ea271ee0dd5097f615b87c27151200635a9e5ff3c3072864bcf8fe6e8fbc41c0cffc6c95148f#rd"><a href="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247491844&amp;idx=1&amp;sn=36decacb06ca6ce1fc689141174bb98f&amp;chksm=ea271ee0dd5097f615b87c27151200635a9e5ff3c3072864bcf8fe6e8fbc41c0cffc6c95148f&amp;scene=21#wechat_redirect" data-linktype="1"><section data-recommend-type="normal" data-recommend-tid="1" data-mid=""><section data-mid=""><section data-mid=""><span data-positionback="static"><img data-ratio="0.42592592592592593" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHjQaBFpiaqVdicmbG9Qc6jzc6libMFWfa3BibLBAuEvheHibyV9XmEElb1t3DbCLQksuL8TK9PWYaZsmrw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHjQaBFpiaqVdicmbG9Qc6jzc6libMFWfa3BibLBAuEvheHibyV9XmEElb1t3DbCLQksuL8TK9PWYaZsmrw/640?wx_fmt=jpeg"></span></section><section data-mid=""><p data-recommend-title="t" data-mid="">R沟通｜Rmarkdown教程（3）</p></section></section></section></a></section><br><section data-mpa-template="t" data-from="yb-recommend" data-recommend-article-type="normal" data-recomment-template-id="1" data-recommend-article-id="2247491546_1" data-recommend-article-time="1614601800" data-recommend-article-cover="http://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHiayicgGYwRzibR9sxwM8TDrHOXun1v2WF5SpvjOYrTvQh1A9pmu8NLzId0pcZ3j1MYmib5ibeqk6icUeAA/0?wx_fmt=jpeg" data-recommend-article-title="R沟通｜Rmarkdown教程（2）" data-recommend-article-content-url="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247491546&amp;idx=1&amp;sn=00f8dea8903dbf4ec6e683ab5061a7a5&amp;chksm=ea24e03edd536928ff6c5a3600c8fbbd87cafbf9286ad47bfe4c084032cada9bf6ee7dfddcd9#rd"><a href="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247491546&amp;idx=1&amp;sn=00f8dea8903dbf4ec6e683ab5061a7a5&amp;chksm=ea24e03edd536928ff6c5a3600c8fbbd87cafbf9286ad47bfe4c084032cada9bf6ee7dfddcd9&amp;scene=21#wechat_redirect" data-linktype="1"><section data-recommend-type="normal" data-recommend-tid="1" data-mid=""><section data-mid=""><section data-mid=""><span data-positionback="static"><img data-ratio="0.42314814814814816" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHiayicgGYwRzibR9sxwM8TDrHOXun1v2WF5SpvjOYrTvQh1A9pmu8NLzId0pcZ3j1MYmib5ibeqk6icUeAA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHiayicgGYwRzibR9sxwM8TDrHOXun1v2WF5SpvjOYrTvQh1A9pmu8NLzId0pcZ3j1MYmib5ibeqk6icUeAA/640?wx_fmt=jpeg"></span></section><section data-mid=""><p data-recommend-title="t" data-mid="">R沟通｜Rmarkdown教程（2）</p></section></section></section></a></section><br><section data-mpa-template="t" data-from="yb-recommend" data-recommend-article-type="normal" data-recomment-template-id="1" data-recommend-article-id="2247491355_1" data-recommend-article-time="1614342600" data-recommend-article-cover="http://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHgQIt6ob17tBZRRISiczGtKzRNPmiceYZib7KnNOWw2gM971ugt1KuY99tTwNicIxBB6If2AjCIicxR9TQ/0?wx_fmt=jpeg" data-recommend-article-title="R沟通｜Rmarkdown教程（1）" data-recommend-article-content-url="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247491355&amp;idx=1&amp;sn=79739adfde0822e2eedc60e7c6761820&amp;chksm=ea24e0ffdd5369e9806d20c84c669febced9c36595f15357b3ff108f82e62cc105f0a0c456fe#rd"><section data-recommend-type="normal" data-recommend-tid="1" data-mid=""><section data-mid=""><section data-mid=""><a href="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247491355&amp;idx=1&amp;sn=79739adfde0822e2eedc60e7c6761820&amp;chksm=ea24e0ffdd5369e9806d20c84c669febced9c36595f15357b3ff108f82e62cc105f0a0c456fe&amp;scene=21#wechat_redirect" data-linktype="1"><span><img data-ratio="0.42685185185185187" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHgQIt6ob17tBZRRISiczGtKzRNPmiceYZib7KnNOWw2gM971ugt1KuY99tTwNicIxBB6If2AjCIicxR9TQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHgQIt6ob17tBZRRISiczGtKzRNPmiceYZib7KnNOWw2gM971ugt1KuY99tTwNicIxBB6If2AjCIicxR9TQ/640?wx_fmt=jpeg"></span></a></section></section></section></section></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Pu_IEfKhAEafC2ULTwjDig",target="_blank" rel="noopener noreferrer">原文链接</a>
