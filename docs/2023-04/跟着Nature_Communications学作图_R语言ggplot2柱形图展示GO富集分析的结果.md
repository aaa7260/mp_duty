---
title: "跟着Nature Communications学作图：R语言ggplot2柱形图展示GO富集分析的结果"
date: 2023-04-04T14:16:36Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Acdemic"]
---
跟着Nature Communications学作图：R语言ggplot2柱形图展示GO富集分析的结果 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><h2 data-tool="mdnice编辑器"><span></span><span>论文</span><span></span><span> </span></h2><blockquote data-tool="mdnice编辑器"><p>Chromosome-level assemblies of multiple Arabidopsis genomes reveal hotspots of rearrangements with altered evolutionary dynamics</p></blockquote><p data-tool="mdnice编辑器">https://www.nature.com/articles/s41467-020-14779-y</p><p data-tool="mdnice编辑器"><code>拟南芥NC_panGenome.pdf</code></p><p data-tool="mdnice编辑器">分析代码的github主页</p><p data-tool="mdnice编辑器">https://github.com/schneebergerlab/AMPRIL-genomes</p><p data-tool="mdnice编辑器">论文中组装了7个拟南芥的基因组，做了一些泛基因组相关的分析，数据和大部分代码都公开了，我们试着复现一下其中的图和一些分析过程，今天的推文复现一下论文中的figure5e 柱形图展示富集分析的结果</p><p data-tool="mdnice编辑器">做完GO富集分析，数据格式如下</p><figure data-tool="mdnice编辑器"><img data-ratio="0.2814516129032258" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5ic5WicptR3jGgatcxfmJ52YibC7Zia0bXxcRYtkpQUtZyGkPoPxPU9F6Y0ZGDBhaq8WrfYXmztpXQzQ/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5ic5WicptR3jGgatcxfmJ52YibC7Zia0bXxcRYtkpQUtZyGkPoPxPU9F6Y0ZGDBhaq8WrfYXmztpXQzQ/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">数据是excel存储</p><h2 data-tool="mdnice编辑器"><span></span><span>首先是读取数据</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(readxl)<br>dat&lt;-read_excel(<span>"data/20230318/Source_Data.Figure5/5e/Fig5e.HOT.genes.GO.xlsx"</span>)<br>dat<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>最基本的柱形图</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(ggplot2)<br>ggplot(dat,aes(x=Term,y=Count))+<br>  geom_col()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.0833333333333333" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5ic5WicptR3jGgatcxfmJ52YPuQQZvB1j7APfZibJZM0O7X8byNN1X5rCVWQSEMhwUs4iaxbvxQvuQ6g/640?wx_fmt=png" data-type="png" data-w="840" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5ic5WicptR3jGgatcxfmJ52YPuQQZvB1j7APfZibJZM0O7X8byNN1X5rCVWQSEMhwUs4iaxbvxQvuQ6g/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>进行一些美化</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(tidyverse)<br><br>dat %&gt;% <br>  mutate(Term=str_replace(Term,<span>"GO:[0-9]+~"</span>,<span>""</span>)) %&gt;% <br>  arrange(desc(Count)) %&gt;% <br>  mutate(Term=factor(Term,levels = Term)) %&gt;% <br>  ggplot(aes(x=Term,y=Count))+<br>  geom_col(aes(fill=PValue))+<br>  theme_bw()+<br>  theme(axis.text.x = element_text(angle = 60,hjust=1),<br>        legend.position = c(0.9,0.4))+<br>  scale_y_continuous(expand = expansion(mult = c(0,0)),<br>                     limits = c(0,65))+<br>  scale_fill_gradient(low=<span>"blue"</span>,high = <span>"red"</span>,<br>                      name=expression(italic(<span>"P-value"</span>)))+<br>  labs(x=NULL)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.4274193548387097" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5ic5WicptR3jGgatcxfmJ52Y6Kh8j5UU8PNicV65ZERgCAgYDPXzNiaaWueqbGVanSxibCcV3mfiaS7S4Q/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5ic5WicptR3jGgatcxfmJ52Y6Kh8j5UU8PNicV65ZERgCAgYDPXzNiaaWueqbGVanSxibCcV3mfiaS7S4Q/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">买一送一，再复现一下论文中的Figure5d</p><pre data-tool="mdnice编辑器"><span></span><code>fig5d&lt;-read_delim(<span>"data/20230318/Source_Data.Figure5/5d/Fig5d.txt"</span>,<br>                  delim = <span>"\t"</span>)<br>library(ggh4x)<br><br>fig5d %&gt;% <br>  mutate(region=factor(region,levels = c(<span>"SYN"</span>,<span>"HOR"</span>))) -&gt; fig5d<br>ggplot(data=fig5d,aes(x=`high-effect-variant-percent`,y=region))+<br>  geom_boxplot(outlier.alpha = 0,<br>               aes(fill=region),<br>               width=0.4)+<br>  theme_bw()+<br>  theme(legend.position = <span>"none"</span>,<br>        panel.border = element_blank(),<br>        axis.line = element_line(),<br>        panel.grid = element_blank())+<br>  scale_x_continuous(limits = c(0,15))+<br>  guides(x=guide_axis_truncated(trunc_lower = 0,<br>                                trunc_upper = 15),<br>         y=guide_axis_truncated(trunc_lower = 1,<br>                                trunc_upper = 2))+<br>  scale_fill_manual(values = c(<span>"#2b6aa8"</span>,<span>"#f39200"</span>))+<br>  labs(x=<span>"Deleterious variants (%)"</span>,y=NULL)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.736144578313253" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5ic5WicptR3jGgatcxfmJ52YAHiaRZicEicsVFFhOUeh3sXUOs8AU7wvuf5htOPVqYDukop0Lciayc5Mibw/640?wx_fmt=png" data-type="png" data-w="830" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5ic5WicptR3jGgatcxfmJ52YAHiaRZicEicsVFFhOUeh3sXUOs8AU7wvuf5htOPVqYDukop0Lciayc5Mibw/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>最后是拼图</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(patchwork)<br>p2+p1+<br>  plot_layout(widths = c(1,3))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.4258064516129032" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5ic5WicptR3jGgatcxfmJ52YZuOXoNlsYUERdC8JmDnrbriaAqIvtc2z2YT0KHXIcfwDM6FdFLMZ9vg/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5ic5WicptR3jGgatcxfmJ52YZuOXoNlsYUERdC8JmDnrbriaAqIvtc2z2YT0KHXIcfwDM6FdFLMZ9vg/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><blockquote data-tool="mdnice编辑器"><p>示例数据和代码可以给推文点赞，然后点击在看，最后留言获取</p></blockquote><p data-tool="mdnice编辑器">欢迎大家关注我的公众号</p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-weui-theme="light" data-id="MzI3NzQ3MTcxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5t1sOnM0iabvBhnfIj5YpyqrMib0E1MGCd9ibcYxaOPZd0GWhQBDvK2BPEwsicQxd6y5MHLfphnwHnow/0?wx_fmt=png" data-nickname="小明的数据分析笔记本" data-alias="" data-signature="数据分析和数据可视化有意思的简单小例子~石榴研究生的笔记本" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"></p><blockquote data-tool="mdnice编辑器"><p>小明的数据分析笔记本 公众号 主要分享：1、R语言和python做数据分析和数据可视化的简单小例子；2、园艺植物相关转录组学、基因组学、群体遗传学文献阅读笔记；3、生物信息学入门学习资料及自己的学习笔记！</p></blockquote><p data-tool="mdnice编辑器"><strong>微信公众号好像又有改动，如果没有将这个公众号设为星标的话，会经常错过公众号的推文，个人建议将 小明的数据分析笔记本 公众号添加星标，添加方法是</strong></p><h2 data-tool="mdnice编辑器"><span></span><span>点开公众号的页面，右上角有三个点</span><span></span><span> </span></h2><figure data-tool="mdnice编辑器"><img data-ratio="0.996694214876033" data-src="https://mmbiz.qpic.cn/mmbiz/t1wZDoUyFk5ic5WicptR3jGgatcxfmJ52YheEYzbMwmwaiaGM2jtd0dcXUbf0BdC0MeRFLvicL8HPkXxAa2Uenpqew/640?wx_fmt=other" data-type="other" data-w="605" src="https://mmbiz.qpic.cn/mmbiz/t1wZDoUyFk5ic5WicptR3jGgatcxfmJ52YheEYzbMwmwaiaGM2jtd0dcXUbf0BdC0MeRFLvicL8HPkXxAa2Uenpqew/640?wx_fmt=other"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>点击三个点，会跳出界面</span><span></span><span> </span></h2><figure data-tool="mdnice编辑器"><img data-ratio="2.137987012987013" data-src="https://mmbiz.qpic.cn/mmbiz/t1wZDoUyFk5ic5WicptR3jGgatcxfmJ52YThjq7FkpwqJlG0EJAmL6CzVdEWlwRAF6tDwbhDB3ibbsgcrSDAhfyicg/640?wx_fmt=other" data-type="other" data-w="616" src="https://mmbiz.qpic.cn/mmbiz/t1wZDoUyFk5ic5WicptR3jGgatcxfmJ52YThjq7FkpwqJlG0EJAmL6CzVdEWlwRAF6tDwbhDB3ibbsgcrSDAhfyicg/640?wx_fmt=other"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>直接点击 设为星标 就可以了</span><span></span><span> </span></h2></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/uXDHSt97mrhcQy-wM-SJ3g",target="_blank" rel="noopener noreferrer">原文链接</a>
