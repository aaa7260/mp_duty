---
title: "癌症亚型分析的多组学整合和可视化第二弹：MOVICS"
date: 2023-02-07T23:27:43Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
癌症亚型分析的多组学整合和可视化第二弹：MOVICS by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>多组学分析的黄金时代是否已经过去？抑或是方兴未艾，仍值得一探究竟？</p><p>哪些组学数据可以被用来整合分析？</p><p>有没有成套的多组学分析思路可以借鉴？</p></blockquote><p data-tool="mdnice编辑器">这一期我们将延续昨天的思路，为大家带来另一款多组学R包——</p><blockquote data-tool="mdnice编辑器"><ul><li><section>PMID: 33315104</section></li><li><section>DOI: 10.1093/bioinformatics/btaa1018</section></li><li><section><strong>Availability and implementation:</strong> MOVICS package and online tutorial are freely available at https://github.com/xlucpu/MOVICS.</section></li></ul></blockquote><p data-tool="mdnice编辑器">先来看看它的数据处理及分析流程⬇<img data-ratio="0.9948571428571429" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los9KXWH9N0icrSyoVMjQst0XgXjok9dmvwURr62uqcDXOvQId1ToGPKB13OJr24KgTMj1x57ILXBpibQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1750" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los9KXWH9N0icrSyoVMjQst0XgXjok9dmvwURr62uqcDXOvQId1ToGPKB13OJr24KgTMj1x57ILXBpibQ/640?wx_fmt=jpeg"></p><p data-tool="mdnice编辑器">一共分为3个模块，几乎可以完全服务于你的文章，也就是说，学会这个包，就可以包圆你的多组学分析文章的figures，蛮酷吧？</p><blockquote data-tool="mdnice编辑器"><p>GET Module: 通过多组学综合聚类获得亚型</p><p>COMP Module: 从多角度比较亚型的情况</p><p>RUN Module: 运行标志物识别和验证亚型</p></blockquote><p data-tool="mdnice编辑器">同时，在这篇文章下面的相似文献中，就涌现了好几款工具，孰优孰劣暂且不做评价。一般来说，有需求才会有市场，既然还有团队在做组学联合分析的工具，就说明这方面的研究浪潮还未退去。选好方向，仍有上岸的希望！</p><figure data-tool="mdnice编辑器"><img data-ratio="0.9578713968957872" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KXWH9N0icrSyoVMjQst0XgDf9Bsa3TYqIaAlhiaXGaCUiaAibn3YyWmR1voB6jNKBcfQalebXAbK9CA/640?wx_fmt=png" data-type="png" data-w="902" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KXWH9N0icrSyoVMjQst0XgDf9Bsa3TYqIaAlhiaXGaCUiaAibn3YyWmR1voB6jNKBcfQalebXAbK9CA/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">由于运行耗费太多时间，这里我以第一个模块为例，用自己的数据跑一次，看看能不能跑得通</p><h2 data-tool="mdnice编辑器"><span></span><span>step1 摸查数据</span><span></span></h2><pre data-tool="mdnice编辑器"><code><span>library</span>(MOVICS)<br><span># load example data of breast cancer</span><br>load(system.file(<span>"extdata"</span>, <span>"brca.tcga.RData"</span>, package = <span>"MOVICS"</span>, mustWork = <span>TRUE</span>))<br><span># load(system.file("extdata", "brca.yau.RData",  package = "MOVICS", mustWork = TRUE))</span><br><span>##摸清不同包的格式要求</span><br></code></pre><blockquote data-tool="mdnice编辑器"><h2><span></span><span>注意突变数据，如果在所有样本中都无突变的话，可直接删除这个基因</span><span></span></h2><pre><code>snp &lt;- snp[which(rowSums(snp) &gt; <span>0</span>),] <span>##过滤掉无突变的基因</span><br></code></pre></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>step2 加载自己的数据</span><span></span></h2><pre data-tool="mdnice编辑器"><code>load(file = <span>"multidat.rda"</span>)<br>multidat$cnv &lt;- <span>NULL</span>  <span>##cnv数据中包含负值,丢掉这个数据再试试看</span><br></code></pre><p data-tool="mdnice编辑器">然后我的数据长这样</p><h2 data-tool="mdnice编辑器"><span></span><span>step3 获得最佳聚类数</span><span></span></h2><pre data-tool="mdnice编辑器"><code><span># identify optimal clustering number (may take a while)</span><br>optk.ova &lt;- getClustNum(data        = multidat[<span>1</span>:<span>5</span>], <span>##List of matrices</span><br>                         is.binary   = c(<span>F</span>,<span>F</span>,<span>F</span>,<span>T</span>,<span>F</span>), <br>                         try.N.clust = <span>2</span>:<span>8</span>, <span># try cluster number from 2 to 8</span><br>                         fig.name    = <span>"optimal_number_cluster OF TCGA-OVA"</span>)<br><br><span>###整个下午都在报错报错</span><br></code></pre><pre data-tool="mdnice编辑器"><code>[Error <span>in</span> svd(B, nv = <span>0</span>) : <span>'x'</span>里有无穷值或遗漏值] <br></code></pre><p data-tool="mdnice编辑器">那就按报错信息检查缺失值和无穷数，也没发现问题啊！！！</p><p data-tool="mdnice编辑器">这里不得不说，这个包实在是太耗时了，每次检查数据后都要重新运行这个函数，至少30分钟，绝了~</p><pre data-tool="mdnice编辑器"><code><span>#&gt; calculating Cluster Prediction Index...</span><br><span>#&gt; 5% complete</span><br><span>#&gt; 5% complete</span><br><span>#&gt; 10% complete</span><br><span>#&gt; 10% complete</span><br><span>#&gt; 15% complete</span><br><span>#&gt; 15% complete</span><br><span>#&gt; 20% complete</span><br><span>#&gt; 25% complete</span><br><span>#&gt; 25% complete</span><br><span>#&gt; 30% complete</span><br><span>#&gt; 30% complete</span><br><span>#&gt; 35% complete</span><br><span>#&gt; 35% complete</span><br><span>#&gt; 40% complete</span><br><span>#&gt; 45% complete</span><br><span>#&gt; 45% complete</span><br><span>#&gt; 50% complete</span><br><span>#&gt; 50% complete</span><br><span>#&gt; 55% complete</span><br><span>#&gt; 55% complete</span><br><span>#&gt; 60% complete</span><br><span>#&gt; 65% complete</span><br><span>#&gt; 65% complete</span><br><span>#&gt; 70% complete</span><br><span>#&gt; 70% complete</span><br><span>#&gt; 75% complete</span><br><span>#&gt; 75% complete</span><br><span>#&gt; 80% complete</span><br><span>#&gt; 85% complete</span><br><span>#&gt; 85% complete</span><br><span>#&gt; 90% complete</span><br><span>#&gt; 90% complete</span><br><span>#&gt; 95% complete</span><br><span>#&gt; 95% complete</span><br></code></pre><p data-tool="mdnice编辑器">看到这里，就看到了希望的曙光——然而报错总是猝不及防，当然如果这里你的数据没问题的话，直接往下走即可</p><h2 data-tool="mdnice编辑器"><span></span><span>step4 顺藤摸瓜</span><span></span></h2><p data-tool="mdnice编辑器">用其中一种方法获得聚类信息</p><pre data-tool="mdnice编辑器"><code><span># perform iClusterBayes (may take a while)</span><br>iClusterBayes.res &lt;- getiClusterBayes(data        = multidat,<br>                                      N.clust     = <span>5</span>, <span>##根据上一步的结果来定</span><br>                                      type        = c(<span>"gaussian"</span>,<span>"gaussian"</span>,<span>"gaussian"</span>,<span>"binomial"</span>,<span>"gaussian"</span>),<br>                                      n.burnin    = <span>1800</span>,<br>                                      n.draw      = <span>1200</span>,<br>                                      prior.gamma = c(<span>0.5</span>, <span>0.5</span>, <span>0.5</span>, <span>0.5</span>, <span>0.5</span>, <span>0.5</span>),<br>                                      sdev        = <span>0.05</span>,<br>                                      thin        = <span>3</span>)<br></code></pre><p data-tool="mdnice编辑器">一次性获得其他九种方法的聚类信息</p><pre data-tool="mdnice编辑器"><code><span># perform multi-omics integrative clustering with the rest of 9 algorithms</span><br>moic.res.list &lt;- getMOIC(data        = mo.data,<br>                         methodslist = list(<span>"SNF"</span>, <span>"PINSPlus"</span>, <span>"NEMO"</span>, <span>"COCA"</span>, <span>"LRAcluster"</span>, <span>"ConsensusClustering"</span>, <span>"IntNMF"</span>, <span>"CIMLR"</span>, <span>"MoCluster"</span>),<br>                         N.clust     = <span>5</span>,<br>                         type        = c(<span>"gaussian"</span>, <span>"gaussian"</span>, <span>"gaussian"</span>, <span>"binomial"</span>, <span>"gaussian"</span>))<br></code></pre><p data-tool="mdnice编辑器">把以上十种方法得到的结果放在一起</p><pre data-tool="mdnice编辑器"><code><span># attach iClusterBayes.res as a list using append() to moic.res.list with 9 results already</span><br>moic.res.list &lt;- append(moic.res.list, <br>                        list(<span>"iClusterBayes"</span> = iClusterBayes.res))<br><br><span># save moic.res.list to local path</span><br>save(moic.res.list, file = <span>"moic.res.list.rda"</span>)<br></code></pre><p data-tool="mdnice编辑器">现在，所有来自10种算法的聚类结果都拿到了，MOVICS借用了<span>consensus ensembles</span>的想法，以便整合来自不同算法的聚类结果，从而提高聚类结果的稳健性。</p><pre data-tool="mdnice编辑器"><code>cmoic.brca &lt;- getConsensusMOIC(moic.res.list = moic.res.list,<br>                               fig.name      = <span>"CONSENSUS HEATMAP"</span>,<br>                               distance      = <span>"euclidean"</span>,<br>                               linkage       = <span>"average"</span>)<br></code></pre><p data-tool="mdnice编辑器">这个热图还挺好看的~ 理想情况下，这个热图将显示一个完美的对角线矩形，输入值为0和1是因为所有算法得出的聚类结果相同。</p><p data-tool="mdnice编辑器">运行到这里，后续第一模块的函数基本上没问题了，千里之行始于足下，重要的是把数据调整好，后面见招拆招即可。</p><h2 data-tool="mdnice编辑器"><span></span><span>求助小结</span><span></span></h2><p data-tool="mdnice编辑器">吐血(⊙﹏⊙)关于这个包，在用自己的数据试运行的过程中，发现几点问题，提醒大家【经验之谈，不一定对，仅供参考】</p><blockquote data-tool="mdnice编辑器"><ol><li><section><p>运行超慢，甚至比我跑过的单细胞数据还要慢，一个函数一下午。。。不知道有没有加速的办法</p></section></li><li><section><p>getClustNum函数我试了好几次都报错【Error in svd(B, nv = 0) : 'x'里有无穷值或遗漏值】，检查了缺失值(is.na)和无穷值(is.infinite)，并未发现问题。。。</p></section></li><li><section><p>排查发现，可能因为copy number含负值，这个包并不支持cnv数据的分析？去掉这个数据也报了同样的错</p></section></li><li><section><p>取子集再分析，也还是一样的报错</p></section></li><li><section><p>R- prcomp()的'x‘中无限值或缺少值 - 问答 - 腾讯云开发者社区-腾讯云 (tencent.com)</p><pre><code>d &lt;- multidat$snp[<span>1</span>:<span>100</span>,<span>1</span>:<span>20</span>]<br>table(is.na(d))<br>d[is.na(d)] &lt;- <span>0</span><br>infs &lt;- apply(d,<span>2</span>, is.infinite)<br>rowswithinf &lt;- rowSums(infs) &gt; <span>0</span><br><span>#df[infs]  #handle infinite rows</span><br><span>#df[rowswithinf, ]  #Handle infinite rows</span><br>d &lt;- d[!rowswithinf, ] <br></code></pre></section></li><li><section><p>难道是SNP数据有问题？删掉这个数据试试看</p><pre><code>multidat$snp &lt;- <span>NULL</span> <br>optk.ova &lt;- getClustNum(data        = multidat[<span>1</span>:<span>5</span>], <span>##List of matrices</span><br>                         is.binary   = c(<span>F</span>,<span>F</span>,<span>F</span>,<span>F</span>,<span>F</span>), <br>                         try.N.clust = <span>2</span>:<span>8</span>, <span># try cluster number from 2 to 8</span><br>                         fig.name    = <span>"optimal_number_cluster OF TCGA-OVA"</span>)<br></code></pre></section></li></ol><p>7.再次调出示例数据作为参照，发现甲基化数据保留了3位小数，而我的甲基化给蛋白组学数据的小数位数均超过3处理一下：</p><pre><code>myfun &lt;- <span>function</span>(x){<br>round(x,<span>3</span>)<br>}<br>Methy &lt;- apply(Methy, <span>2</span>, myfun)<br>Methy &lt;- as.data.frame(Methy)<br>rppa &lt;- apply(rppa, <span>2</span>, myfun)<br>rppa &lt;- as.data.frame(rppa)<br></code></pre></blockquote><p data-tool="mdnice编辑器">终于出图了，大家可以用自己的数据试试</p><p data-tool="mdnice编辑器">……<strong>解决问题就是抽丝剥茧找到线头的过程，细节真的很重要，希望大家一天比一天更有进步</strong></p></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/KrIETtIrpR0ILGnqhmku8g",target="_blank" rel="noopener noreferrer">原文链接</a>
