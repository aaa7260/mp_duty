---
title: "你永远不知道公共数据集给你埋什么坑"
date: 2024-08-06T05:10:47Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
你永远不知道公共数据集给你埋什么坑 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>不同格式的单细胞表达量矩阵文件读取的分门别类的代码我们都分享了好多次，最后都是要成为 <code>Seurat</code>对象。详见：<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247511915&amp;idx=1&amp;sn=6c63ddde0d992068b799dec51e302038&amp;scene=21#wechat_redirect" data-linktype="2">读取不同格式的单细胞转录组数据及遇到问题的解决办法</a>，简单的汇总一下就是：</p></blockquote><ol data-tool="mdnice编辑器"><li><section><strong>h5格式的单细胞文件读取</strong>：</section></li></ol><ul><li><section>使用<code>Seurat</code>包中的<code>Read10X_h5</code>函数。</section></li></ul><li><section><strong>10X格式的单细胞文件读取</strong>：</section></li><ul><li><section>10X格式通常包含<code>matrix.mtx.gz</code>、<code>genes.tsv.gz</code>（或<code>features.tsv.gz</code>）和<code>barcodes.tsv.gz</code>三个文件。</section></li><li><section>使用<code>Seurat</code>包中的<code>Read10X</code>函数。</section></li></ul><li><section><strong>txt.gz格式文件读取</strong>：</section></li><ul><li><section>使用<code>data.table</code>包中的<code>fread</code>函数。</section></li></ul><li><section><strong>csv格式文件读取</strong>：</section></li><ul><li><section>同样使用<code>data.table</code>包中的<code>fread</code>函数。</section></li></ul><p data-tool="mdnice编辑器">遇到的问题及解决办法：</p><ul data-tool="mdnice编辑器"><li><section><p><strong>非标准10X数据集</strong>：有时GEO数据库上传的数据可能不符合标准格式，需要进行预处理。</p></section></li><li><section><p><strong>去除第一行和第一列</strong>：如果第一行或第一列包含非数据内容，需要去除以避免读取错误。</p></section></li><ul><li><section>解决办法：使用R的数据处理函数，如<code>read.table</code>时指定<code>quote = ""</code>和<code>row.names = 1</code>，或者手动去除不需要的行列。</section></li></ul><li><section><p><strong>特征（feature）列问题</strong>：如果特征列不符合预期，可能需要指定<code>gene.column</code>参数。</p></section></li><li><section><p>**使用<code>read.table</code>**：有评论建议使用<code>read.table</code>函数，并通过设置参数<code>quote = ""</code>和<code>row.names = 1</code>来避免切割文件。</p></section></li></ul><p data-tool="mdnice编辑器">其它：比如<code>.loom</code>文件可以使用<code>Seurat</code>包中的<code>Read10X_loom</code>函数或者<code>loomR</code>包来读取。</p><h3 data-tool="mdnice编辑器"><span></span><span>一个让人脑子有坑的公共数据集</span><span></span></h3><p data-tool="mdnice编辑器">正常情况下，任意公共数据集，都是只需要把表达量矩阵文件读入到r编程语言里面的成为了一个合格的Seurat对象，后续的降维聚类分群等常规单细胞转录组数据分析基本上可以套用我们的标准代码即可，</p><p data-tool="mdnice编辑器">但是最近交流群有小伙伴反馈了一个新鲜出炉的文章：《Single-cell profiling reveals altered immune landscape and impaired NK cell function in gastric cancer liver metastasis》它的数据集是GSE246662，在GEO界面可以看到作者给出来的是如下所示的文件 ：</p><pre data-tool="mdnice编辑器"><span></span><code>   21M 11  1  2023 GSM7874169_HL1.csv.gz<br>   22M 11  1  2023 GSM7874170_HL2.csv.gz<br>   16M 11  1  2023 GSM7874171_HL3.csv.gz<br>   13M 11  1  2023 GSM7874172_GC1.csv.gz<br>   22M 11  1  2023 GSM7874173_GC2.csv.gz<br>   33M 11  1  2023 GSM7874174_GC3.csv.gz<br>   17M 11  1  2023 GSM7874175_LM1.csv.gz<br>   27M 11  1  2023 GSM7874176_LM2.csv.gz<br>   25M 11  1  2023 GSM7874177_LM3.csv.gz<br></code></pre><p data-tool="mdnice编辑器">如果是每个文件当做是同样的格式批量读取，就会出现如下所示的奇怪的降维聚类分群图：</p><p><img data-galleryid="" data-imgfileid="100048720" data-ratio="1.0888888888888888" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwgGb6L7DOKEHibbcBByS2lD3xMnv3ZicOZOflYH5XITSib51RiaR58asNiao7L5ejSgAewXsX0eTo61Vg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwgGb6L7DOKEHibbcBByS2lD3xMnv3ZicOZOflYH5XITSib51RiaR58asNiao7L5ejSgAewXsX0eTo61Vg/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>奇怪的降维聚类分群图</figcaption></figure><p data-tool="mdnice编辑器">也就是说，0,1,3,4这4个亚群，它们没有任意的标记基因，但是确实是在UMAP的二维图上面很清晰的聚成为了一个独立的很清晰的cluster，我打打开了这些亚群的top3基因才发现问题所在：</p><p><img data-galleryid="" data-imgfileid="100048721" data-ratio="1.1527777777777777" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwgGb6L7DOKEHibbcBByS2lD2y59iaGZFZpUxibicp3GLdFt5JniabuVibWfibmMciaP3p3bMOthDicG0wCGRQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwgGb6L7DOKEHibbcBByS2lD2y59iaGZFZpUxibicp3GLdFt5JniabuVibWfibmMciaP3p3bMOthDicG0wCGRQ/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">有一些样品居然是被转置的，正常的表达量矩阵应该是列是细胞，然后行是基因。</p><p data-tool="mdnice编辑器">所以需要修改我们的默认读取表达量矩阵的代码，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>dir=<span>'GSE246662_RAW'</span><br>samples=list.files( dir  )<br>samples<br><br>sceList = lapply(samples,<span>function</span>(pro){ <br>  <span># pro=samples[1] </span><br>  print(pro)   <br>  ct=data.table::fread( file.path(dir,pro ) ,data.table = <span>F</span>) <br>  ct[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>  rownames(ct)=ct$V1<br>  ct=ct[,-<span>1</span>]  <br>  <span>if</span>( ! sum(nchar(colnames(ct)) &gt; <span>12</span>) &gt; <span>1000</span> ){ ct= t(ct)}<br>  sce =CreateSeuratObject(counts =  ct ,<br>                          project =  gsub(<span>'.csv.gz'</span>,<span>''</span>,pro)  ,<br>                          min.cells = <span>5</span>,<br>                          min.features = <span>300</span> )<br> <br>  <span>return</span>(sce)<br>}) <br>do.call(rbind,lapply(sceList, dim)) <br></code></pre><p data-tool="mdnice编辑器">因为基因名字大多数长度小于10的，但是细胞的名字都是大于10的，所以我加上了一个很简单的判断。就可以得到一个正常的Seurat对象然后降维聚类分群啦， 如下所示的结果，其中那个merge亚群其实是可以细分，本来就是肝细胞为主但是里面不知道为什么混入了t细胞的基因，所以我没有给文章那这样的肝细胞这样的名字。</p><p><img data-galleryid="" data-imgfileid="100048722" data-ratio="1.1777777777777778" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwgGb6L7DOKEHibbcBByS2lDgMJJJ1QnXjLFE6lTL9wRSAJLvjosdrsn63463XIdZdjI3XquRibRdLQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwgGb6L7DOKEHibbcBByS2lDgMJJJ1QnXjLFE6lTL9wRSAJLvjosdrsn63463XIdZdjI3XquRibRdLQ/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>我的降维聚类分群</figcaption></figure><p data-tool="mdnice编辑器">虽然说是跟文章有点差异，但是这个出入是可以接受的：</p><p><img data-galleryid="" data-imgfileid="100048719" data-ratio="0.5370370370370371" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwgGb6L7DOKEHibbcBByS2lDA8aRcLTK5qcxByLzKWaR3jib5omzCmmy4pKE3YibuVlK6ENaCiaWFpib3A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwgGb6L7DOKEHibbcBByS2lDA8aRcLTK5qcxByLzKWaR3jib5omzCmmy4pKE3YibuVlK6ENaCiaWFpib3A/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>文章的降维聚类分群</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span><span>学徒作业</span><span></span></h3><p data-tool="mdnice编辑器">完成这个数据集，GSE246662，的降维聚类分群后，<span><strong>看看里面的肝细胞是不是真的有t淋巴细胞的特性。</strong></span>毕竟新鲜出炉的2024的单细胞转录组配合空间单细胞的文献：《Single-cell and spatial transcriptomics analysis of non-small cell lung cancer》，就是提出来了<strong> cancer-associated macrophage-like cells (CAMLs)，它的特殊性在于 co-expression of myeloid (LYZ, CD68, CD14, MRC1) and epithelial genes (KRT19, EPCAM) ，也算是另辟蹊径？</strong></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/i4QwC436WpR7oOoqx0lkjg",target="_blank" rel="noopener noreferrer">原文链接</a>
