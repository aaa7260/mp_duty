---
title: "非模式生物构建10x单细胞转录组CellRanger参考文件"
date: 2024-08-16T08:58:11Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
非模式生物构建10x单细胞转录组CellRanger参考文件 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><strong>10X单细胞上游定量标准流程运行Cellranger定量需要对应的参考基因组文件以及其配套的基因组注释信息文件</strong>，如果是人类和小鼠，官网即可下载构建好的文件压缩包，详见：https://www.10xgenomics.com/support/software/cell-ranger/downloads#reference-downloads</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100046130" data-ratio="1.1027777777777779" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxzcLpUyCp5l7srJjeItH6NNaficJiaz7Z1FC6TABHsjicTVpxwXP9roI0moQa1pVKPZu6DWyRKF8dbg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxzcLpUyCp5l7srJjeItH6NNaficJiaz7Z1FC6TABHsjicTVpxwXP9roI0moQa1pVKPZu6DWyRKF8dbg/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><blockquote data-tool="mdnice编辑器"><span></span><p>正常走cellranger的定量流程即可，代码我已经是多次分享了。参考：</p></blockquote><ul data-tool="mdnice编辑器"><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247512340&amp;idx=3&amp;sn=1b9609a8870a0209dd27ffdcbc3cac87&amp;chksm=9b4bf1afac3c78b90674678fcec66365b9faaa275ff4b0a2255e0a05fa8b905e15222a643bea&amp;scene=21#wechat_redirect" data-linktype="2">10X单细胞转录组原始测序数据的Cell Ranger流程（仅需800元）</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247496813&amp;idx=1&amp;sn=4151bf2265618eff4e0123722c50e569&amp;scene=21#wechat_redirect" data-linktype="2">10X的单细胞转录组原始数据也可以在EBI下载</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247510920&amp;idx=1&amp;sn=c4561d34e984406693c014cdfe236c0f&amp;chksm=9b4beb33ac3c622542d894344c323ff7cca52f69119d02fc7aa4636af0cbe7df4b6c63dd5ba9&amp;scene=21#wechat_redirect" data-linktype="2">一个10x单细胞转录组项目从fastq到细胞亚群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513565&amp;idx=1&amp;sn=092e637017d176c43f00a295d3210592&amp;scene=21#wechat_redirect" data-linktype="2">一文打通单细胞上游：从软件部署到上游分析</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513605&amp;idx=1&amp;sn=e86a329c887745c6d00d3ededa39dcda&amp;chksm=9b4bf6beac3c7fa8523cef4e7189fb20b914460ddb61e6cd1dd520b5928e1b59a8b7827ce783&amp;scene=21#wechat_redirect" data-linktype="2">PRJNA713302这个10x单细胞fastq实战</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513968&amp;idx=1&amp;sn=f5a44a7bea0bdacd8af1a20c177763e5&amp;scene=21#wechat_redirect" data-linktype="2">一次曲折且昂贵的单细胞公共数据获取与上游处理</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514146&amp;idx=1&amp;sn=b9721433d49a2d963eeaab1ad47fc91b&amp;scene=21#wechat_redirect" data-linktype="2">只能下载bam文件的10x单细胞转录组项目数据处理</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247511452&amp;idx=2&amp;sn=83ec97cbc3334a6095e6d63e05e9fd6e&amp;scene=21#wechat_redirect" data-linktype="2">不知道10x单细胞转录组样品和fastq文件的对应关系</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247508521&amp;idx=2&amp;sn=2cf3158e74d37b3a741908d8bfc8f02f&amp;scene=21#wechat_redirect" data-linktype="2">10X单细胞转录组测序数据的 SRA转fastq踩坑那些事</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514395&amp;idx=2&amp;sn=96c505b76ae87dd0efa737c4c44e2270&amp;scene=21#wechat_redirect" data-linktype="2">10x的单细胞转录组fastq文件的R1和R2不能弄混哦</a></section></li></ul><p data-tool="mdnice编辑器">差不多几个小时就可以完成全部的样品的cellranger的定量流程。</p><p data-tool="mdnice编辑器">但是对于其它物种，就需要我们自己单独去构建cellranger 所需的参考基因组及注释文件（详见：https://www.10xgenomics.com/support/software/cell-ranger/latest/tutorials/cr-tutorial-mr）。</p><p data-tool="mdnice编辑器"><strong>通常我们会去Ensembl网站独立下载，然后构建，Ensembl 的 GTF 文件包含可选标签，这使过滤变得容易。如果 Ensembl 无法提供您感兴趣的物种，则其他来源的 GTF 和 FASTA 文件也可以使用。</strong>但请注意，注释文件需要时GTF 格式，而 GFF 格式不受支持。</p><h2 data-tool="mdnice编辑器"><span></span><span>首先下载基因组注释信息</span><span></span></h2><p data-tool="mdnice编辑器">基因组注释是对参考基因组序列上的功能区域进行标识和描述的过程，它包括基因的位置、结构、功能和其他生物学特征。</p><p data-tool="mdnice编辑器"><strong>GTF文件</strong>：</p><ul data-tool="mdnice编辑器"><li><section>GTF（General Transfer Format）文件是一种基于纯文本的基因组注释文件格式，广泛用于存储基因、转录本、外显子等的注释信息。</section></li><li><section>GTF文件中的每一行代表一个基因组上的注释特征，通常包括以下字段：</section></li><ul><li><section><strong>seqname</strong>：染色体或扫描序列的名称。</section></li><li><section><strong>source</strong>：注释信息的来源，例如基因预测软件或数据库。</section></li><li><section><strong>feature</strong>：特征类型，如基因（gene）、转录本（transcript）、外显子（exon）等。</section></li><li><section><strong>start</strong>：特征在序列上的起始位置（1-based）。</section></li><li><section><strong>end</strong>：特征在序列上的结束位置。</section></li><li><section><strong>score</strong>：一个可选的分数，通常用于表示序列比对的匹配程度。</section></li><li><section><strong>strand</strong>：特征在序列上的链，通常是<code>+</code>（正链）或<code>-</code>（负链）。</section></li><li><section><strong>frame</strong>：在某些情况下，指定编码区的阅读框架（0、1或2）。</section></li><li><section><strong>attribute</strong>：一系列键值对，提供额外的信息，如基因ID、外显子编号、注释来源等。</section></li></ul></ul><p data-tool="mdnice编辑器">GTF文件为研究人员提供了一种标准化的方式来描述和共享基因组注释数据，它支持基因表达分析、变异分析和调控元件的识别等多种应用。</p><p data-tool="mdnice编辑器">我们首先去Ensembl （ https://www.ensembl.org/index.html ）官网找到<strong>待处理物种</strong>的基因组注释信息（gtf文件），然后下载</p><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span><span>#下载注释文件</span></span><br>wget -c https://ftp.ensembl.org/pub/release-111/gtf/gallus_gallus_gca000002315v5/Gallus_gallus_gca000002315v5.GRCg6a.111.gtf.gz<br><span>#</span><span><span>#文件大小</span></span><br>18M 10月  9 16:44 Gallus_gallus_gca000002315v5.GRCg6a.111.gtf.gz <br><span>#</span><span><span>#解压后大小</span></span><br>488M 10月  9 16:44 Gallus_gallus_gca000002315v5.GRCg6a.111.gtf<br></code></pre><p data-tool="mdnice编辑器">为了避免在进行单细胞RNA测序数据分析时出现的多重映射（multi-mapped）问题，需要过滤一下GTF文件</p><p data-tool="mdnice编辑器">详细信息可参考</p><ul data-tool="mdnice编辑器"><li><section>Check for multi-mapped reads</section></li><li><section>Which reads are considered for UMI counting by Cell Ranger?</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span><span>#过滤GTF</span></span><br>./cellranger-7.1.0/bin/cellranger mkgtf \<br>  Gallus_gallus_gca000002315v5.GRCg6a.111.gtf \<br>  Gallus_gallus_gca000002315v5.GRCg6a.111.filtered.gtf \<br>  --attribute=gene_biotype:protein_coding \<br>  --attribute=gene_biotype:lncRNA \<br>  --attribute=gene_biotype:antisense \<br>  --attribute=gene_biotype:IG_LV_gene \<br>  --attribute=gene_biotype:IG_V_gene \<br>  --attribute=gene_biotype:IG_V_pseudogene \<br>  --attribute=gene_biotype:IG_D_gene \<br>  --attribute=gene_biotype:IG_J_gene \<br>  --attribute=gene_biotype:IG_J_pseudogene \<br>  --attribute=gene_biotype:IG_C_gene \<br>  --attribute=gene_biotype:IG_C_pseudogene \<br>  --attribute=gene_biotype:TR_V_gene \<br>  --attribute=gene_biotype:TR_V_pseudogene \<br>  --attribute=gene_biotype:TR_D_gene \<br>  --attribute=gene_biotype:TR_J_gene \<br>  --attribute=gene_biotype:TR_J_pseudogene \<br>  --attribute=gene_biotype:TR_C_gene<br><span><br><br>#</span><span><span># 按最新的教程其实也可以只保留编码蛋白质的基因的信息</span></span><br>cellranger mkgtf \<br>    Danio_rerio.GRCz11.105.gtf \<br>    Danio_rerio.GRCz11.105.filtered.gtf \<br>    --attribute=gene_biotype:protein_coding<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>上面的mkgtf操作到底是过滤掉了什么？</span><span></span></h3><p data-tool="mdnice编辑器">那么这一步做了什么，参考基因组注释文件有哪些变化，我们可以来详细看一下，首先对它参考基因组注释下载的原始文件进行基础的统计</p><pre data-tool="mdnice编辑器"><span></span><code> cat  Gallus_gallus_gca000002315v5.GRCg6a.111.gtf| awk '$3 == "gene" {print}'|cut -f 9 |perl -alne '{/gene_biotype "([^"]+)";/;print $1}' |sort |uniq  -c |sort -k1n<br></code></pre><p data-tool="mdnice编辑器">结果如下</p><pre data-tool="mdnice编辑器"><span></span><code>     2 Mt_rRNA<br>      2 ribozyme<br>      2 vault_RNA<br>      2 Y_RNA<br>      5 misc_RNA<br>     13 processed_pseudogene<br>     15 scaRNA<br>     22 Mt_tRNA<br>     43 pseudogene<br>     74 snRNA<br>    108 rRNA<br>    200 snoRNA<br>    850 miRNA<br>  12447 lncRNA<br>  17077 protein_coding<br><br></code></pre><p data-tool="mdnice编辑器">然后统计一下过滤后的文件：</p><pre data-tool="mdnice编辑器"><span></span><code>cat  Gallus_gallus_gca000002315v5.GRCg6a.111.filtered.gtf| awk '$3 == "gene" {print}'| cut -f 9 |perl -alne '{/gene_biotype "([^"]+)";/;print $1}' |sort |uniq  -c |sort -k1n<br></code></pre><p data-tool="mdnice编辑器">过滤后的结果统计：</p><pre data-tool="mdnice编辑器"><span></span><code>  12447 lncRNA<br>  17077 protein_coding<br><br></code></pre><p data-tool="mdnice编辑器">可以看到，只剩下lncRNA和protein_coding。而参数中的<code>antisense</code> 、 <code>IG_LV_gene</code> 等，是参考基因组注释文件中本身就没有的。</p><h2 data-tool="mdnice编辑器"><span></span><span>其次是下载参考基因组FA文件</span><span></span></h2><p data-tool="mdnice编辑器">参考基因组是一个物种的代表性DNA序列，它通常是通过整合来自多个个体的遗传信息而构建的，旨在反映该物种的遗传多样性。参考基因组被用作比较基因组分析、基因发现、变异检测和基因功能研究的基础。</p><p data-tool="mdnice编辑器"><strong>FA文件</strong>：</p><ul data-tool="mdnice编辑器"><li><section>FA文件是FASTA格式的一种变体，通常用于存储参考基因组序列。</section></li><li><section>FASTA格式是一种生物序列文件格式，其中每个序列以一个以大于号（<code>&gt;</code>）开头的标题行开始，后面跟着序列本身的一行或多行。</section></li><li><section>标题行通常包含序列的名称、来源和其他相关信息。</section></li><li><section>FA文件中的每个序列代表基因组中的一个染色体或片段，文件中可能包含整个基因组的所有染色体。</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span><span># 参考基因组下载</span></span><br>wget -c https://ftp.ensembl.org/pub/release-111/fasta/gallus_gallus_gca000002315v5/dna/Gallus_gallus_gca000002315v5.GRCg6a.dna.toplevel.fa.gz<br><span><br>#</span><span><span>#文件大小</span></span><br>306M 10月  4 19:46 Gallus_gallus_gca000002315v5.GRCg6a.dna.toplevel.fa.gz<br><span><br>#</span><span><span>#解压后大小</span></span><br>1.1G 10月  4 19:46 Gallus_gallus_gca000002315v5.GRCg6a.dna.toplevel.fa<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>构建CellRanger自定义参考</span><span></span></h2><p data-tool="mdnice编辑器">有了上面的两个文件，剩下的就很简单，执行<code>cellranger mkref </code> 即可</p><pre data-tool="mdnice编辑器"><span></span><code>cellranger-7.1.0/bin/cellranger mkref \<br>  --genome=Gallus \<br>  --fasta=Gallus_gallus_gca000002315v5.GRCg6a.dna.toplevel.fa \<br>  --genes=Gallus_gallus_gca000002315v5.GRCg6a.111.filtered.gtf \<br>  --ref-version=1.0.0<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>学徒作业</span><span></span></h3><p data-tool="mdnice编辑器">依据上面的的流程，自行下载猪马牛羊狗的参考基因组fa文件以及基因组注释信息gtf文件，构建好10x单细胞转录组CellRanger参考文件。然后完成一个(Sus scrofa domesticus)的10x项目的定量：</p><ul data-tool="mdnice编辑器"><li><section>https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE193975</section></li><li><section>https://www.ncbi.nlm.nih.gov/bioproject/PRJNA798674</section></li></ul><h3 data-tool="mdnice编辑器"><span></span><span>进阶作业</span><span></span></h3><p data-tool="mdnice编辑器">仍然是一个(Sus scrofa domesticus)的10x项目的定量，但是需要下载两个物种的fq和gtf文件，然后合并后构建好10x单细胞转录组CellRanger参考文件。如下所示：</p><p><img data-imgfileid="100046136" data-ratio="0.6046296296296296" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxzcLpUyCp5l7srJjeItH6NzwbDiaHVsW358XcwYeLJTK41uQibnmmmR3yEW5teoLviaflMMbxXgxxug/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxzcLpUyCp5l7srJjeItH6NzwbDiaHVsW358XcwYeLJTK41uQibnmmmR3yEW5teoLviaflMMbxXgxxug/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>两个物种</figcaption></figure><p data-tool="mdnice编辑器">数据集是：</p><ul data-tool="mdnice编辑器"><li><section>https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE168113</section></li><li><section>https://www.ncbi.nlm.nih.gov/bioproject/PRJNA706032</section></li></ul><h3 data-tool="mdnice编辑器"><span></span><span>视频号直播互动演练</span><span></span></h3><p data-tool="mdnice编辑器">考虑到很多小伙伴看完了我们的文字版推文后仍然是很难直接上手实操，<span><strong>所以今天下午五点我们会在《生信技能树》视频号进行直播互动讲解这个猪马牛羊狗的10x单细胞转录组CellRanger参考文件构建过程</strong></span>，欢迎互动交流哈！</p><section><mp-common-videosnap data-pluginname="mpvideosnap" data-headimgurl="https://wx.qlogo.cn/finderhead/PiajxSqBRaEI7scvWIPdECSfnUpSjTib9Y7RI14r1VVzxaA57PjcCERw/0" data-username="v2_060000231003b20faec8c7e1881bcad2ca06ec35b07788412aec898c89eb1e34f9a354475e8c@finder" data-nickname="生信技能树" data-desc="将在04月18日 17:00 直播" data-livewording="预约" data-intro="转录组和单细胞上游基于Linux的数据分析" data-type="live" data-status="0" data-noticeid="finderlivenotice-v2_060000231003b20faec8c7e1881bcad2ca06ec35b07788412aec898c89eb1e34f9a354475e8c@finder-1710295572697708-663355731" data-isdisabled="0" data-errortips=""></mp-common-videosnap></section></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span>文末友情宣传</span></h3><p data-tool="mdnice编辑器"><strong>强烈建议你推荐给身边的博士后以及年轻生物学PI，多一点数据认知，让他们的科研上一个台阶：</strong></p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247529099&amp;idx=1&amp;sn=fe3be2d43a6284a36c15625c23dc9a3e&amp;scene=21#wechat_redirect" data-linktype="2">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;scene=21#wechat_redirect" data-linktype="2">时隔5年，我们的生信技能树VIP学徒继续招生啦</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;scene=21#wechat_redirect" data-linktype="2">2024的共享服务器交个朋友福利价仍然是800</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;scene=21#wechat_redirect" data-linktype="2">千呼万唤始出来的独享生物信息学云服务器</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528144&amp;idx=1&amp;sn=be4d7e542d1077921024c86a4c130f16&amp;scene=21#wechat_redirect" data-linktype="2">永久免费的生信进阶培训（线下）</a></section></li></ul></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/5cyuJIw269rIqqd8JtEIdg",target="_blank" rel="noopener noreferrer">原文链接</a>
