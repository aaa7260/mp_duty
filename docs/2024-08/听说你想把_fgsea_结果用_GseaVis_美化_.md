---
title: "听说你想把 fgsea 结果用 GseaVis 美化？"
date: 2024-08-06T01:38:09Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
听说你想把 fgsea 结果用 GseaVis 美化？ by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><section><mp-common-profile data-pluginname="mpprofile" data-id="MzkyMTI1MTYxNA==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezgsqIGqjITSMggCTSoViaYeoKe2xoZr1IIvNJoztibQxibYHLDDoiabwAc6Ggws3Tvdo8EPss2nLgaVQ/0?wx_fmt=png" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-from="0" data-is_biz_ban="0"></mp-common-profile></section></section><section><mp-common-clmusic data-pluginname="insertaudio" type="1" music_name="%E6%A1%A5%E8%B1%86%E9%BA%BB%E8%A2%8B" albumurl="http://wx.y.gtimg.cn/music/photo_new/T002R500x500M000004fAhFe0fdHYF_1.jpg" singer="陈粒" duration="179000" username="" music_source="1" is_vip="0" listenid="78221544915037504"></mp-common-clmusic></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>引言</span><span></span></h2><figure data-tool="mdnice编辑器"><img data-imgfileid="100030493" data-ratio="0.3114754098360656" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DE9RiciaPN9R4y6p1MTBgxMvbmt2EsqkJOuCQPxmvbPyY0LJFm2RicjKBQw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="671" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DE9RiciaPN9R4y6p1MTBgxMvbmt2EsqkJOuCQPxmvbPyY0LJFm2RicjKBQw/640?wx_fmt=png&amp;from=appmsg"></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100030492" data-ratio="0.29850746268656714" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DE4JvGxSSUCUPR7GDyy0Raz9PPLa9qXhUnwcogQDWOBcu8ycibZpJeZKQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="670" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DE4JvGxSSUCUPR7GDyy0Raz9PPLa9qXhUnwcogQDWOBcu8ycibZpJeZKQ/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>粉丝觉得 <strong>fgsea</strong> 画的图不好看，于是自己构建了 <strong>gsearesult</strong> 格式的对象，但是传入 <strong>gseaNb</strong> 画图报错。不排除他构建的对象是存在问题的，这里我给个解决方案。之前写过 <a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247512646&amp;idx=1&amp;sn=d9241b243771dcb355c74fd1a7f9431c&amp;chksm=c1848837f6f301216f9d4c06659f01814b54994b552b5f15d9df9c5b227f417288a7cd4061e6&amp;token=1853819831&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">听说你只有富集表格还想画 GSEA 图?</a> ，介绍如何把富集表格转为 <strong>gseaResult</strong> 对象，<strong>fgsea</strong> 输出结果也是一个表格，那么就可以使用这个方法。</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>尝试</span><span></span></h2><p data-tool="mdnice编辑器">首先自己下载基因集合，这我们新加了一个 <strong>GO ID</strong> 到通路名称前面，后面需要用到：</p><pre data-tool="mdnice编辑器"><span></span><code>library(fgsea)<br>library(msigdbr)<br><br><span># load test data</span><br>data(geneList, package=<span>"DOSE"</span>)<br><br>msigdb.hs &lt;- msigdbr(species = <span>"Homo sapiens"</span>,<br>                     category = <span>"C5"</span>,<br>                     subcategory = <span>"BP"</span>) %&gt;%<br>  mutate(id = paste(gs_exact_source,gs_name,sep = <span>"|"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030494" data-ratio="0.3301549463647199" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DEia2tg03F0hm0sthuH45aiczYwOj8vxXPsle1psBrM09dmLxibQmicHInlw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="839" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DEia2tg03F0hm0sthuH45aiczYwOj8vxXPsle1psBrM09dmLxibQmicHInlw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">然后构建通路列表：</p><pre data-tool="mdnice编辑器"><span></span><code>pathway_list &lt;- msigdb.hs %&gt;%<br>  select(id, entrez_gene) %&gt;%<br>  as.data.frame() %&gt;%<br>  split(., .$id) %&gt;%<br>  lapply(., <span>function</span>(x)(x$entrez_gene))<br><br><span># check</span><br>head(pathway_list,<span>1</span>)<br><span># $`GO:0000002|GOBP_MITOCHONDRIAL_GENOME_MAINTENANCE`</span><br><span># [1]  10000  10000   1763   2021 201163   3980   9361   4205  92667   4358   4976    142  80119  11232</span><br><span># [15]  11232  10891 201973  83667  83667  84275  55186    291 219736   7156   7156   7157   1890</span><br></code></pre><p data-tool="mdnice编辑器">跑 <strong>fgsea</strong> 分析，得到富集表格：</p><pre data-tool="mdnice编辑器"><span></span><code>fgseaRes0 &lt;- fgsea(pathways = pathway_list,<br>                   stats    = geneList,<br>                   minSize  = <span>15</span>,<br>                   maxSize  = <span>500</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030495" data-ratio="0.353874883286648" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DEic71kwTa8M00ML76AxKsoicpO9Gglk7AOZdt6nz91eD0UGQQd6uSGQ8A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1071" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DEic71kwTa8M00ML76AxKsoicpO9Gglk7AOZdt6nz91eD0UGQQd6uSGQ8A/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">处理一下表格，使其类似于 <strong>gseGO/gseKEGG</strong> 输出类似的东西：</p><pre data-tool="mdnice编辑器"><span></span><code>fgseaRes &lt;- fgseaRes0 %&gt;%<br>  tidyr::separate_wider_delim(pathway,delim = <span>"|"</span>,names = c(<span>"ID"</span>,<span>"Description"</span>)) %&gt;%<br>  rowwise() %&gt;%<br>  mutate(leadingEdge =paste0(unlist(leadingEdge),collapse = <span>"/"</span>))<br><br>enrich_df &lt;- data.frame(ID = fgseaRes$ID,<br>                        Description = fgseaRes$Description,<br>                        setSize = fgseaRes$size,<br>                        enrichmentScore = fgseaRes$ES,<br>                        NES = fgseaRes$NES,<br>                        pvalue = fgseaRes$pval,<br>                        p.adjust = fgseaRes$padj,<br>                        core_enrichment = fgseaRes$leadingEdge)<br><br>rownames(enrich_df) &lt;- enrich_df$ID<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030496" data-ratio="0.3120376597175521" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DE1WkQJvWDvxHvWIlp80hJXBarA9AAtZvtNkFoNRwI3VzLv1POuO9syA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1487" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DE1WkQJvWDvxHvWIlp80hJXBarA9AAtZvtNkFoNRwI3VzLv1POuO9syA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">然后就可以转换了，顺便把 <strong>ID</strong> 转换一下：</p><pre data-tool="mdnice编辑器"><span></span><code>en &lt;- GseaVis::dfGO2gseaResult(enrich.df = enrich_df,<br>                               geneList = geneList,<br>                               OrgDb = org.Hs.eg.db)<br><br>class(en)<br><span># [1] "gseaResult"</span><br><span># attr(,"package")</span><br><span># [1] "DOSE"</span><br><br>en &lt;- setReadable(x = en,OrgDb = org.Hs.eg.db,keyType = <span>"ENTREZID"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030498" data-ratio="0.5926365795724465" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DEWLpa1q7qbbX1eN3VP2NibiaEypfWXiaY6AYBxdKtpw6JElNn19iaBGlnVw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="842" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DEWLpa1q7qbbX1eN3VP2NibiaEypfWXiaY6AYBxdKtpw6JElNn19iaBGlnVw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">画图看看：</p><pre data-tool="mdnice编辑器"><span></span><code>enrichplot::gseaplot2(x = en,geneSetID = enrich_df$ID[<span>1</span>])<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030497" data-ratio="0.7245949926362297" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DE1u9UJRM4MkteicgJOFWSub6ANaNQZIiaYIDLchzE3cJfnXStVSmGTyUw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="679" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DE1u9UJRM4MkteicgJOFWSub6ANaNQZIiaYIDLchzE3cJfnXStVSmGTyUw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>gseaNb</strong> 画个看看：</p><pre data-tool="mdnice编辑器"><span></span><code>gseaNb(object = en,geneSetID = enrich_df$ID[<span>1</span>])<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030500" data-ratio="0.7245949926362297" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DEc5Dyf5CNicU8bCZ1bpcruxGVpXGMR4H5qfVvaylAPupichesfSyNkyJA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="679" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DEc5Dyf5CNicU8bCZ1bpcruxGVpXGMR4H5qfVvaylAPupichesfSyNkyJA/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>OK，问题不大。</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>结尾</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong>路漫漫其修远兮,吾将上下而求索。</strong></p></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">欢迎加入生信交流群。加我微信我也拉你进 <strong>微信群聊</strong> <strong>老俊俊生信交流群</strong> <strong>(微信交流群需收取 20 元入群费用,一旦交费,拒不退还!(防止骗子和便于管理))</strong> 。QQ 群可免费加入, 记得进群按格式修改备注哦。</p><section data-tool="mdnice编辑器"><section><p><strong>老俊俊微信：</strong></p><figure><img data-imgfileid="100030499" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DEphdynarLPCnQ1OXIGt585s4KozueQJ6GChRjWfB2SWbiaHMwluxia2ww/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="430" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DEphdynarLPCnQ1OXIGt585s4KozueQJ6GChRjWfB2SWbiaHMwluxia2ww/640?wx_fmt=png&amp;from=appmsg"></figure><figure><img data-imgfileid="100030501" data-ratio="1.3668430335097002" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DETKa3waVibrwt4E9cekBYIF6jbrL2Wu0P3avkF87SW5tT8k5mIIYk6uA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="567" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewPM4CKWzxpXBI67O46v5DETKa3waVibrwt4E9cekBYIF6jbrL2Wu0P3avkF87SW5tT8k5mIIYk6uA/640?wx_fmt=png&amp;from=appmsg"></figure></section><section><p><strong>知识星球：</strong></p><figure><img data-imgfileid="100030507" data-ratio="1.5896226415094339" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4usewPM4CKWzxpXBI67O46v5DEaNADBATe39z4cY884RZlKmv3GepG0fLiaibjShBbGPPppsmcJYerrPXw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1060" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4usewPM4CKWzxpXBI67O46v5DEaNADBATe39z4cY884RZlKmv3GepG0fLiaibjShBbGPPppsmcJYerrPXw/640?wx_fmt=jpeg&amp;from=appmsg"></figure></section></section><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><strong></strong></p><center data-tool="mdnice编辑器"><strong> 往期回顾目录</strong></center><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong></strong></p><center><strong><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247514139&amp;idx=1&amp;sn=eae730e19b0ba2fa1f90dfb3ac10c582&amp;chksm=c184826af6f30b7caa9d07c496d8237d44e01c9440bea1d0ac8b73846871a05e178392d0c2dc&amp;token=1396583615&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">GSEA 还可以环形可视化？</a></strong></center><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247514098&amp;idx=1&amp;sn=5af39ec7c19f4240319a6efe519d781f&amp;chksm=c1848d83f6f304959a9d9e6a47225fcb1f51ddaededfe717f0b60b77cab9021928047f41c87c&amp;token=1396583615&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">送你一个环形富集分析图</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247514040&amp;idx=1&amp;sn=3d7005394edf920db316a4afceda3d01&amp;chksm=c1848dc9f6f304df5624b8e0177c543fb210a07a0daa47efcb9b1520fba166c6c070860480a3&amp;token=736408649&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">enrichCluster 关于非模式物种富集分析的使用</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513973&amp;idx=1&amp;sn=00ce573d81657bf2c985abc8bb6c8422&amp;chksm=c1848d04f6f3041222971f1933b4de0a7f99766ef99982c2560d5d4ff7ad0d0006a29fb7f56e&amp;token=1438488422&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">tidyCoverage 计算 bigwig 文件在目标区域的信号</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513953&amp;idx=1&amp;sn=7c9eb4545986fa9187cdd66cae8b1456&amp;chksm=c1848d10f6f30406d0bc3a86b3aa0150eb7191aea24bc4b9e366e0c04bc0be13a0a382253dfa&amp;token=1202987559&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">桑基图加富集图一行代码出图?</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513935&amp;idx=1&amp;sn=7149af238f8ae9ef1750349fef7e79e9&amp;chksm=c1848d3ef6f3042892939e2ddee645b405c6a007fc290ff8e67f5cceeb7af37ff2cb11f1df93&amp;token=1267815615&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">GEO 上传数据最新教程</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513903&amp;idx=1&amp;sn=7406e159002c4f5a11dffb74cd8bc16c&amp;chksm=c1848d5ef6f304485adeb4927b95318412d1f2d3aaddc21a6a60d58c4f4cac9d2c02340421e3&amp;token=350392803&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">试试 bulkRNA 做拟时序分析？</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513809&amp;idx=1&amp;sn=05eb04b579b04ff5b20f3cab2f52406a&amp;chksm=c1848ca0f6f305b6005b1f9853a79843be0e582f7519c234350a6b22b81f7d07f5d749dbe87b&amp;token=350392803&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ClusterGVis 绘制 lineplot 的优化</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513792&amp;idx=1&amp;sn=b71dffea7f6dd9ad8acaec98ee99678c&amp;chksm=c1848cb1f6f305a7c85b54cbc9f40e2aaffefbc119654d533cd0aef2480eda6e7946295d5008&amp;token=1799964631&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">RNAseqQC 给你的数据来个全面的 QC 检查</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513652&amp;idx=1&amp;sn=4750e40c39e055b0b8b6dae51d70c620&amp;chksm=c1848c45f6f30553044afacb5ea3544afd63287fd90f60858859b873db060019a569208590e9&amp;token=1799964631&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">如何 Pull Request 到 github 贡献你的代码</a></center></strong><p><br></p></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/BR3rxrnB8PpZBnF2DMQ5tw",target="_blank" rel="noopener noreferrer">原文链接</a>
