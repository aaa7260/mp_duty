---
title: "CODEX空间蛋白生信分析|| 使用Giotto分析CODEX (Akoya) Mouse Spleen Dataset"
date: 2024-08-01T21:17:08Z
draft: ["false"]
tags: [
  "fetched",
  "新叶生物"
]
categories: ["Acdemic"]
---
CODEX空间蛋白生信分析|| 使用Giotto分析CODEX (Akoya) Mouse Spleen Dataset by 新叶生物
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h1 data-tool="mdnice编辑器"><span></span><span><span>本次学习使用Gitto包来对 CODEX 的空间蛋白数据 Mouse Spleen Dataset 进行探索。</span><br></span><span><br></span><span>如果你也对CODEX空间单细胞蛋白数据分析感兴趣，欢迎交流：13343400813（wx）<br></span></h1><p data-tool="mdnice编辑器"><span>Gitto包的分析流程如下</span>：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100000734" data-ratio="0.5978112175102599" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LJGgNnqBuiaUlLOlPcH9g0FlKqPhOD4US0Srk542JmXZ6MKWmic1Lk447b68icEDVqGSNicbcAOcjYRHg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="731" src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LJGgNnqBuiaUlLOlPcH9g0FlKqPhOD4US0Srk542JmXZ6MKWmic1Lk447b68icEDVqGSNicbcAOcjYRHg/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240801215309858</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span><span>数据介绍</span><span></span></h3><p data-tool="mdnice编辑器">本次分析的数据为<span>小鼠脾脏组织</span>，下载链接：</p><p data-tool="mdnice编辑器"><span>https://github.com/drieslab/spatial-datasets</span></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100000732" data-ratio="0.3492063492063492" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LJGgNnqBuiaUlLOlPcH9g0Fltayh7e0s5x5ucf8fl8JxqQP3323PaGp9zKaTVDWKWn91hRhRoticIjg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="630" src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LJGgNnqBuiaUlLOlPcH9g0Fltayh7e0s5x5ucf8fl8JxqQP3323PaGp9zKaTVDWKWn91hRhRoticIjg/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240720183410122</figcaption></figure><p data-tool="mdnice编辑器">上面的地址给出了来源文献：<span>https://www.sciencedirect.com/science/article/pii/S0092867418309048</span>，于<span>2018年8月2号发表在Cell</span>上（这个时间真早啊！）</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100000736" data-ratio="0.7810150375939849" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LJGgNnqBuiaUlLOlPcH9g0FlqHaddQwWyowaSy2YEOezvJLGYNIwnROlyNmuJ1Mw76BGdSSy4PiauoQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1064" src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LJGgNnqBuiaUlLOlPcH9g0FlqHaddQwWyowaSy2YEOezvJLGYNIwnROlyNmuJ1Mw76BGdSSy4PiauoQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240801144714145</figcaption></figure><p data-tool="mdnice编辑器">简单看一眼文献中对数据的描述：</p><p data-tool="mdnice编辑器">MRL/lpr dataset has 9 samples: 3 control wild-type BALBc spleens (BALBc  1,-2,-3 and 6 MRL spleens MRL  4,-5,-6,-7,-8,-9)</p><p data-tool="mdnice编辑器">主要为 <span>3 个 normal BALBc spleens</span>, 以及<span>6 个spleens from MRL/lpr mice</span></p><p data-tool="mdnice编辑器"><span>BALB/c小鼠</span>的了解：https://www.shsmu.edu.cn/cbms-dlas/info/1021/1155.htm</p><p data-tool="mdnice编辑器"><span>MRL/Lpr小鼠</span>：https://jax.biomart.cn/news/3156331.htm</p><h3 data-tool="mdnice编辑器"><span></span><span><span>30个蛋白panel<span>如下：</span></span></span><span></span></h3><figure data-tool="mdnice编辑器"><img data-imgfileid="100000735" data-ratio="0.64030131826742" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LJGgNnqBuiaUlLOlPcH9g0FlmNkePaBOqAN0xMRMBTPCDw8hz38mCze6qDzjHg62cHLbXPGCT1n8lQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1062" src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LJGgNnqBuiaUlLOlPcH9g0FlmNkePaBOqAN0xMRMBTPCDw8hz38mCze6qDzjHg62cHLbXPGCT1n8lQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240801193811879</figcaption></figure><p data-tool="mdnice编辑器"><span>本教程选用 BALBc-3 样本，共83,787 cells进行数据分析。</span></p><h3 data-tool="mdnice编辑器"><span></span><span>首先，安装一下包：</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>### Spatial Data Analysis using Giotto: CODEX mouse spleen dataset</span><br><span># https://github.com/drieslab/spatial-datasets/tree/master/data</span><br><br><span>## 安装包，已安装可以跳过</span><br>remotes::install_github(<span>"RubD/Giotto"</span>) <br><br><span>## 加载包</span><br>library(Giotto)<br><br><span># set python path to NULL and use the giotto miniconda environment</span><br><span># 这里可以设置一下你的 python 环境</span><br>python_path = NULL <span># (only the first time on your setup)</span><br><span>if</span>(is.null(python_path)) {installGiottoEnvironment()}<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>创建Giotto对象和预处理数据：</span><span></span></h3><p data-tool="mdnice编辑器">先读取表达矩阵，对数据做一下简单探索：</p><pre data-tool="mdnice编辑器"><span></span><code><br><span>### Part 1. Create Giotto object and process data</span><br><span>## prepare the data for creating a Giotto object</span><br><span># 读取表达矩阵</span><br>codex_expression &lt;- readExprMatrix( <span>"./2018_codex_spleen/count_matrix/codex_BALBc_3_expression.txt.gz"</span>, transpose = F)<br>class(codex_expression)<br><br><span># 读取进来之后是一个dgCMatrix，大家对这个对象应该很熟悉了</span><br><span># [1] "dgCMatrix"</span><br><span># attr(,"package")</span><br><span># [1] "Matrix"</span><br><br><span># 转成matrix，看一下表达</span><br>codex_expression1 &lt;- as.matrix(codex_expression)<br>dim(codex_expression1)<br><span># 总共包含30个marker，83786个细胞</span><br><span># [1]    30 83786</span><br><br><span># 30个蛋白marker</span><br>rownames(codex_expression1)<br><span># [1] "CD45"   "Ly6C"   "TCR"    "Ly6G"   "CD19"   "CD169"  "CD106"  "CD3"    "CD1632" "CD8a"   "CD90"   "F480"   "CD11c"  "Ter119" "CD11b"  "IgD"    "CD27"   "CD5"   </span><br><span># [19] "CD79b"  "CD71"   "CD31"   "CD4"    "IgM"    "B220"   "ERTR7"  "CD35"   "CD2135" "CD44"   "NKp46"  "MHCII" </span><br><br><span># 细胞名字是数字编号</span><br>colnames(codex_expression1)[1:100]<br><br><span># 表达值</span><br>codex_expression1[1:10, 1:20]<br></code></pre><p data-tool="mdnice编辑器">表达值应该做了什么处理，里面有负值：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100000733" data-ratio="0.27037037037037037" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LJGgNnqBuiaUlLOlPcH9g0FlUGo4SeHZFWBkibpV1GZY6icj3NrghD0SicY7HoiaR31z79GKkhPFmsCIicA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LJGgNnqBuiaUlLOlPcH9g0FlUGo4SeHZFWBkibpV1GZY6icj3NrghD0SicY7HoiaR31z79GKkhPFmsCIicA/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240801173325058</figcaption></figure><p data-tool="mdnice编辑器">接着，读取细胞的空间坐标信息</p><pre data-tool="mdnice编辑器"><span></span><code><span># 读取细胞坐标信息</span><br>codex_locations &lt;- data.table::fread(<span>"./2018_codex_spleen/cell_locations/codex_BALBc_3_coord.txt"</span>)<br>head(codex_locations)<br><br><span># cellID   X.X   Y.Y</span><br><span># &lt;int&gt; &lt;int&gt; &lt;int&gt;</span><br><span>#   1:      1    10    70</span><br><span># 2:      2  1000   294</span><br><span># 3:      3  1003   605</span><br><span># 4:      4  1015   873</span><br><span># 5:      5  1021   953</span><br><span># 6:      6  1046   642</span><br></code></pre><p data-tool="mdnice编辑器">读取细胞meta信息</p><pre data-tool="mdnice编辑器"><span></span><code><span># read in metadata</span><br>codex_metadata &lt;- data.table::fread(<span>"./2018_codex_spleen/cell_locations/codex_BALBc_3_annotation.txt"</span>)<br>head(codex_metadata)<br></code></pre><p data-tool="mdnice编辑器">这个metadata数据是带有细胞类型注释信息的：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100000738" data-ratio="0.13425925925925927" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LJGgNnqBuiaUlLOlPcH9g0FlgrVYVfqW9bThMicoVv36PlBXiahOTpQL9OMRiahsbn4GcHDo2WROOO03A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LJGgNnqBuiaUlLOlPcH9g0FlgrVYVfqW9bThMicoVv36PlBXiahOTpQL9OMRiahsbn4GcHDo2WROOO03A/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240801193435055</figcaption></figure><p data-tool="mdnice编辑器"><span><strong>Spatial tile</strong>：</span></p><p data-tool="mdnice编辑器">对大型生物标本进行高分辨率成像的需求日益增加，通常这些标本并不适合显微镜的视野。为了克服这个缺点，<span>可以机动地阶段移动样品来创建整个样品的单个 tile 扫描</span>。显微镜阶段移动提供的物理坐标不够精确，无法从单个tiled扫描图像堆栈中重建(“拼接【”<span>Stitching</span>”】”)整个图像。</p><p><mp-pay-preview-filter data-offset="32"></mp-pay-preview-filter></p></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/VnoJLuPzbOxvBJn-uQ2cbw",target="_blank" rel="noopener noreferrer">原文链接</a>
