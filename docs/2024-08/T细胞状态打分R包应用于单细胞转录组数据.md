---
title: "T细胞状态打分R包应用于单细胞转录组数据"
date: 2024-08-20T08:35:49Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
T细胞状态打分R包应用于单细胞转录组数据 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>之前我们介绍过<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526904&amp;idx=1&amp;sn=4ea4c4289217c8ba815354370813540a&amp;scene=21#wechat_redirect" data-linktype="2">irGSEA：基于秩次的单细胞基因集富集分析整合框架</a>，针对<strong>17种常见的Functional Class Scoring (FCS)方法</strong>在单细胞转录组里面进行了benchmark，感兴趣的可以仔细读一下。</p></blockquote><p data-tool="mdnice编辑器">我们首先了解一下打分工具的本质，首先是带有生物学功能意义的基因集合的数据库资源，其次是统计学公式。前者可以是免疫或者代谢等基因集，主要是来源于msigdb等数据库。后者统计学公式对大家来说最容易理解的就是gsea或者gsva啦。比如我前两天介绍的：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247531885&amp;idx=1&amp;sn=bbccefc7d8f87f459fe62f26e31776cf&amp;scene=21#wechat_redirect" data-linktype="2">单细胞GSVA分析专用R包</a></p><p data-tool="mdnice编辑器">今天我们分享一个工具 | TCellSI：首个全面评估T细胞状态的创新工具，是2024年6月21日，四川大学华西医院郭安源教授团队首次开发了一种能够系统地评估T细胞状态的新工具，TCellSI (T Cell State Identifier)。</p><p><img data-galleryid="" data-imgfileid="100048302" data-ratio="0.8435185185185186" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqSjKia6x76edxZycAfhfbaicKukAQKsmj3jWCbemQqBxbicic8caoMW8AUVPy1iajvRQNj1JBtiaCGKYw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwqSjKia6x76edxZycAfhfbaicKukAQKsmj3jWCbemQqBxbicic8caoMW8AUVPy1iajvRQNj1JBtiaCGKYw/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>系统地评估T细胞状态的新工具</figcaption></figure><p data-tool="mdnice编辑器">目前准确评估T细胞的八种不同状态，这些状态包括：</p><p data-tool="mdnice编辑器"><strong>● 静止（Quiescence）</strong></p><p data-tool="mdnice编辑器"><strong>● 调节（Regulating）</strong></p><p data-tool="mdnice编辑器"><strong>● 增殖（Proliferation）</strong></p><p data-tool="mdnice编辑器"><strong>● 辅助（Helper）</strong></p><p data-tool="mdnice编辑器"><strong>● 细胞毒性（Cytotoxicity）</strong></p><p data-tool="mdnice编辑器"><strong>● 初始耗竭（Progenitor exhaustion）</strong></p><p data-tool="mdnice编辑器"><strong>● 终末耗竭（Terminal exhaustion）</strong></p><p data-tool="mdnice编辑器"><strong>● 衰老（Senescence）</strong></p><p data-tool="mdnice编辑器">这些状态的评估结果被称为T细胞状态评分（TCSS, T Cell State Score）。通过这些评分，研究人员可以深入了解T细胞在免疫反应中的具体功能和角色。</p><p data-tool="mdnice编辑器">TCellSI借助Mann-Whitney U统计量，通过特定的标记基因集和参考谱为样本进行T细胞状态的评估。TCellSI在开发和验证过程中，涵盖了大规模数据，包括来自20个数据集的 379个 T 细胞系、34,730个单细胞、4,477个pseudo-bulk样本、33 种癌症类型的 10,535 名癌症患者、20种组织类型的 7,862个正常样本、免疫治疗队列中的 674个样本，以及 884个病毒感染的非癌症外周血样本。TCellSI不仅能准确描述T细胞状态，而且在免疫环境中显现出高度的预测价值。</p><h3 data-tool="mdnice编辑器"><span></span><span>先看看包的帮助文档</span><span></span></h3><p data-tool="mdnice编辑器">安装和加载：</p><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("devtools")</span><br>devtools::install_github(<span>"GuoBioinfoLab/TCellSI"</span>)<br><span>library</span>(TCellSI)<br></code></pre><p data-tool="mdnice编辑器">然后一步到位就可以评估T细胞的八种状态：</p><pre data-tool="mdnice编辑器"><span></span><code><span>## 示例表达数据</span><br><span>## 要求是完整的基因表达矩阵（log2转换后的RNA-seq TPM标准化基因表达矩阵）</span><br>sample_expression &lt;- TCellSI::exampleSample<br>sample_expression[1:10, ]<br><span># 如下所示的示例数据表达量矩阵格式：</span><br><span>##           SRR5088825 SRR5088828 SRR5088830 SRR5088833 SRR5088835</span><br><span>## 5_8S_rRNA   0.000000   0.000000  0.0000000  0.0000000   0.000000</span><br><span>## 5S_rRNA     0.000000   0.000000  0.4346853  0.0000000   0.000000</span><br><span>## 7SK         0.000000   0.000000  0.0000000  0.0000000   0.000000</span><br><span>## A1BG        1.907599   3.284418  4.0821248  3.2864715   2.863233</span><br><span>## A1BG-AS1    3.083914   2.021561  4.5169002  2.9347126   2.918992</span><br><span>## A1CF        0.000000   0.000000  0.0000000  0.0000000   0.000000</span><br><span>## A2M         9.812037   9.516751  5.7541683  6.9308912   7.394556</span><br><span>## A2M-AS1     2.107557   1.889085  0.1596072  0.8729146   1.206896</span><br><span>## A2ML1       0.000000   0.000000  0.0000000  0.0000000   0.000000</span><br><span>## A2ML1-AS1   0.000000   0.000000  0.0000000  0.0000000   0.000000</span><br><span>## 进行TCSS的计算，TCSS是0-1之间的数值</span><br>ResultScores_TCSS &lt;- TCSS_Calculate(sample_expression)<br></code></pre><p data-tool="mdnice编辑器">返回的就是每个样品的8种打分值：</p><pre data-tool="mdnice编辑器"><span></span><code>ResultScores_TCSS<br><span>##                       SRR5088825 SRR5088828 SRR5088830 SRR5088833 SRR5088835</span><br><span>## Quiescence             0.6422158  0.6153140  0.5105856  0.4520591  0.6951249</span><br><span>## Regulating             0.4404173  0.3974391  0.1670356  0.2615326  0.5454356</span><br><span>## Proliferation          0.5780474  0.5761891  0.3994404  0.4282601  0.6184267</span><br><span>## Helper                 0.5647604  0.4063729  0.2121070  0.1735861  0.6547372</span><br><span>## Cytotoxicity           0.6482720  0.5826073  0.1829111  0.2358969  0.5888452</span><br><span>## Progenitor_exhaustion  0.5905679  0.5308304  0.2482848  0.2461412  0.6199635</span><br><span>## Terminal_exhaustion    0.6624943  0.6222188  0.3311532  0.3387099  0.6042142</span><br><span>## Senescence             0.5921543  0.5725185  0.2896508  0.3206251  0.6043355</span><br></code></pre><p data-tool="mdnice编辑器">对于这个打分结果矩阵，可以有很多可视化方法啦， 具体可以看 R包 的官方文档 （https://github.com/GuoBioinfoLab/TCellSI/）</p><h4 data-tool="mdnice编辑器"><span></span><span>核心之一：人工整理的基因列表：</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>&gt; markers<br><span>$Quiescence</span><br>[1] <span>"BTG2"</span>  <span>"KLF2"</span>  <span>"FOXP1"</span> <span>"RUNX1"</span> <span>"MYC"</span>  <br><br><span>$Regulating</span><br>[1] <span>"TNFRSF9"</span>  <span>"TNFRSF18"</span> <span>"ENTPD1"</span>   <span>"IKZF4"</span>    <span>"LRRC32"</span>   <span>"IKZF2"</span>   <br>[7] <span>"STAT5A"</span>   <span>"FOXP3"</span>    <span>"CD4"</span>     <br><br><span>$Proliferation</span><br> [1] <span>"MKI67"</span> <span>"TYMS"</span>  <span>"TTK"</span>   <span>"CKS1B"</span> <span>"BRIP1"</span> <span>"GINS2"</span> <span>"CKS2"</span>  <span>"ANLN"</span> <br> [9] <span>"CD4"</span>   <span>"CD8A"</span>  <span>"CD8B"</span>  <span>"CD3G"</span>  <span>"CD3D"</span>  <span>"CD3E"</span>  <span>"CD247"</span><br><br><span>$Helper1_2</span><br> [1] <span>"LTA"</span>     <span>"TNF"</span>     <span>"IL2"</span>     <span>"IL18"</span>    <span>"TBX21"</span>   <span>"LTBR"</span>   <br> [7] <span>"CXCR3"</span>   <span>"IFNG"</span>    <span>"KLRD1"</span>   <span>"HAVCR2"</span>  <span>"DPP4"</span>    <span>"TNFSF11"</span><br>[13] <span>"CCR5"</span>    <span>"IFNGR1"</span>  <span>"STAT1"</span>   <span>"STAT4"</span>   <span>"CCR4"</span>    <span>"CCR6"</span>   <br>[19] <span>"GZMK"</span>    <span>"IFNGR1"</span>  <span>"PARP8"</span>   <span>"PVRIG"</span>   <span>"SLC4A10"</span><br><br><span>$Helper17</span><br> [1] <span>"TGFB1"</span>   <span>"STAT3"</span>   <span>"RORA"</span>    <span>"RORC"</span>    <span>"IL22"</span>    <span>"IL21"</span>   <br> [7] <span>"IL17F"</span>   <span>"IL17A"</span>   <span>"CCR6"</span>    <span>"GZMK"</span>    <span>"IFNGR1"</span>  <span>"PARP8"</span>  <br>[13] <span>"PVRIG"</span>   <span>"SLC4A10"</span><br><br><span>$Fhelper</span><br> [1] <span>"STAT3"</span>   <span>"ICOS"</span>    <span>"CXCR5"</span>   <span>"BCL6"</span>    <span>"CXCL13"</span>  <span>"PDCD1"</span>  <br> [7] <span>"BATF"</span>    <span>"CXCR3"</span>   <span>"KLRB1"</span>   <span>"LTA"</span>     <span>"MAP4K1"</span>  <span>"CCR4"</span>   <br>[13] <span>"CCR6"</span>    <span>"GZMK"</span>    <span>"IFNGR1"</span>  <span>"PARP8"</span>   <span>"PVRIG"</span>   <span>"SLC4A10"</span><br><br><span>$Cytotoxicity</span><br> [1] <span>"GZMB"</span>   <span>"GZMH"</span>   <span>"GZMK"</span>   <span>"GZMA"</span>   <span>"TIA1"</span>   <span>"PRF1"</span>   <span>"LAMP1"</span> <br> [8] <span>"GNLY"</span>   <span>"FASLG"</span>  <span>"SLAMF7"</span> <span>"ZAP70"</span>  <span>"CD69"</span>   <span>"TNF"</span>   <br><br><span>$Progenitor_exhaustion</span><br> [1] <span>"CTLA4"</span>   <span>"PDCD1"</span>   <span>"HNF1A"</span>   <span>"SLAMF6"</span>  <span>"CD8A"</span>    <span>"CD8B"</span>   <br> [7] <span>"TNF"</span>     <span>"ICOS"</span>    <span>"TNFSF14"</span> <span>"SATB1"</span>   <span>"EOMES"</span>   <span>"ID3"</span>    <br>[13] <span>"TCF7"</span>    <span>"CXCR3"</span>   <span>"GZMK"</span>    <span>"SELL"</span>    <span>"IL7R"</span>    <span>"CCR7"</span>   <br>[19] <span>"CXCL10"</span>  <span>"CD44"</span>    <span>"BCL6"</span>    <span>"CD27"</span>    <span>"CD28"</span>    <span>"CD38"</span>   <br><br><span>$Terminal_exhaustion</span><br> [1] <span>"CXCL13"</span>   <span>"ENTPD1"</span>   <span>"PRF1"</span>     <span>"GZMH"</span>     <span>"GZMB"</span>     <span>"GZMA"</span>    <br> [7] <span>"BATF"</span>     <span>"LYST"</span>     <span>"BATF"</span>     <span>"TIGIT"</span>    <span>"LAG3"</span>     <span>"HAVCR2"</span>  <br>[13] <span>"PDCD1"</span>    <span>"PRDM1"</span>    <span>"RBPJ"</span>     <span>"SLAMF7"</span>   <span>"CCL4"</span>     <span>"TNFSF10"</span> <br>[19] <span>"TBX21"</span>    <span>"NFATC1"</span>   <span>"HIF1A"</span>    <span>"TNFRSF4"</span>  <span>"CXCR6"</span>    <span>"PTPN7"</span>   <br>[25] <span>"EWSR1"</span>    <span>"HLA-DPB1"</span> <span>"HLA-DPA1"</span> <span>"UBXN1"</span>    <span>"PSMB9"</span>    <span>"LY6E"</span>    <br>[31] <span>"CCNDBP1"</span>  <span>"IRF9"</span>     <span>"LCP2"</span>    <br><br><span>$Senescence</span><br> [1] <span>"CD3G"</span>   <span>"CD3D"</span>   <span>"CD3E"</span>   <span>"CD247"</span>  <span>"KLRG1"</span>  <span>"B3GAT1"</span> <span>"TP53"</span>  <br> [8] <span>"MAPK14"</span> <span>"MAPK8"</span>  <span>"MAPK1"</span>  <span>"CDKN2A"</span><br></code></pre><h4 data-tool="mdnice编辑器"><span></span><span>核心之二：</span><span></span></h4><p data-tool="mdnice编辑器">打分算法：</p><p data-tool="mdnice编辑器">感兴趣可以让人工智能大模型帮你解读一下这两个代码文件：</p><pre data-tool="mdnice编辑器"><span></span><code>   81 R/CSS_Calculate.R<br> 112 R/TCSS_Calculate.R<br></code></pre><p data-tool="mdnice编辑器">每个代码里面的内容并不多哈，相信大家可以啃下去的！</p><h3 data-tool="mdnice编辑器"><span></span><span>应用于小规模单细胞表达量矩阵</span><span></span></h3><p data-tool="mdnice编辑器">很容易从Seurat对象里面的拿到了单细胞表达量矩阵，一般来说都是两三万个基因然后几万个甚至几十万细胞数量。所以这个时候计算资源消耗比较大而且很慢，而且单细胞表达量矩阵里面的drop-out非常严重，计算会不准确，下面的两个方法都可以获取具体的表达量矩阵哈：</p><pre data-tool="mdnice编辑器"><span></span><code>GetAssayData(sce ,  slot=<span>'counts'</span>,assay=<span>'RNA'</span>)<br>sce@assays<span>$RNA</span><span>$counts</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>推荐使用伪bulk表达量矩阵方法</span><span></span></h3><p data-tool="mdnice编辑器">比如下面的案例是首先对自己的单细胞表达量矩阵进行降维聚类分群后并且生物学注释，这样的话每个细胞就有了celltype属性，然后多个样品可以分开，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><span># v4 是 AverageExpression</span><br>av &lt;-AggregateExpression(sce.all ,<br>                         group.by = c(<span>"orig.ident"</span>,<span>"celltype"</span>),<br>                         assays = <span>"RNA"</span>) <br>av=as.data.frame(av[[<span>1</span>]])<br>head(av) <span># 可以看到是整数矩阵</span><br><span>#write.csv(av,file = 'AverageExpression-0.8.csv')</span><br>cg=names(tail(sort(apply(log(av+<span>1</span>), <span>1</span>, sd)),<span>1000</span>)) <br>pheatmap::pheatmap(cor(as.matrix(log(av[cg,]+<span>1</span>)))) <br>save(av,file = <span>'av_for_pseudobulks.Rdata'</span>)<br></code></pre><p data-tool="mdnice编辑器">上面的 log(av+1) 矩阵，就可以直接使用TCSS_Calculate去计算啦。</p><h3 data-tool="mdnice编辑器"><span></span><span>其它打分推荐</span><span></span></h3><p data-tool="mdnice编辑器">之前我们介绍过<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526904&amp;idx=1&amp;sn=4ea4c4289217c8ba815354370813540a&amp;scene=21#wechat_redirect" data-linktype="2">irGSEA：基于秩次的单细胞基因集富集分析整合框架</a>，针对<strong>17种常见的Functional Class Scoring (FCS)方法</strong>在单细胞转录组里面进行了benchmark，感兴趣的可以仔细读一下。使用方法也很简单，如果是真的全部的单细胞表达量矩阵就会很慢很慢哦，如下所示代码：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 包括GSEA, GSVA,PLAGE, addModuleScore, SCSE, Vision, VAM, gficf, pagoda2, Sargent, AUCell、UCell、singscore、ssGSEA、JASMINE, Viper等等</span><br><span># https://mp.weixin.qq.com/s/VI4ISO6y5_rt8Yy_VnIR-w</span><br><span>library</span>(irGSEA)<br><span># irGSEA通过内置的msigdbr包的基因列表进行打分</span><br><span># #### Hallmark基因集打分 ####</span><br>sce.all &lt;- irGSEA.score(object = sce.all, assay = <span>"RNA"</span>, <br>                    slot = <span>"data"</span>, seeds = <span>123</span>, ncores = <span>1</span>,<br>                    min.cells = <span>3</span>, min.feature = <span>0</span>,<br>                    custom = <span>F</span>, geneset = <span>NULL</span>, msigdb = <span>T</span>, <br>                    species = <span>"Homo sapiens"</span>, category = <span>"H"</span>,  <br>                    subcategory = <span>NULL</span>, geneid = <span>"symbol"</span>,<br>                    method = c(<span>"AUCell"</span>,<span>"UCell"</span>,<span>"singscore"</span>,<span>"ssgsea"</span> ),<br>                    aucell.MaxRank = <span>NULL</span>, ucell.MaxRank = <span>NULL</span>, <br>                    kcdf = <span>'Gaussian'</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>可视化；</span><span></span></h3><p data-tool="mdnice编辑器">基本上就是Seurat包的5种可视化，单细胞数据分析里面最基础的就是降维聚类分群，参考前面的例子：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247497956&amp;idx=1&amp;sn=5d4deb7cf7b7848b3e2273cbd663bb6a&amp;scene=21#wechat_redirect" data-linktype="2">人人都能学会的单细胞聚类分群注释</a>  ，这个大家基本上问题不大了，使用seurat标准流程即可，不过它默认出图并不好看，详见以前我们做的投票：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247500816&amp;idx=1&amp;sn=25568540a54d63225def0804c05025f8&amp;scene=21#wechat_redirect" data-linktype="2">可视化单细胞亚群的标记基因的5个方法</a>，下面的5个基础函数相信大家都是已经烂熟于心了：</p><ul data-tool="mdnice编辑器"><li><section>VlnPlot(pbmc, features = c("MS4A1", "CD79A"))</section></li><li><section>FeaturePlot(pbmc, features = c("MS4A1", "CD79A"))</section></li><li><section>RidgePlot(pbmc, features = c("MS4A1", "CD79A"), ncol = 1)</section></li><li><section>DotPlot(pbmc, features = unique(features)) + RotatedAxis()</section></li><li><section>DoHeatmap(subset(pbmc, downsample = 100), features = features, size = 3)</section></li></ul><p data-tool="mdnice编辑器">这个T细胞状态打分R包，就可以去跟我们的降维聚类分群结合起来进行5种可视化展示。</p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span>写在文末</span><span></span></h3></section><p>如果你也想做单细胞转录组数据分析，<span>最好是有自己的计算机资源哦，比如我们的</span><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;scene=21#wechat_redirect" data-linktype="2">2024的共享服务器交个朋友福利价仍然是800</a><span>，而且还需要有基本的生物信息学基础，也可以看看我们的</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247531929&amp;idx=1&amp;sn=f6f16b7bf6b907360d6d0052e3d10cf6&amp;chksm=9b4b3d22ac3cb434b6aa7753a4cf0f266578147ccf10b49cc834e46af578ee6de99be0accb30&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉‍松授课（买一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">生物信息学马拉松授课（买一得五）</a><span> ，你的生物信息学入门课。</span></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/sECAwVgonu6Aocm-Uzf8Bw",target="_blank" rel="noopener noreferrer">原文链接</a>
