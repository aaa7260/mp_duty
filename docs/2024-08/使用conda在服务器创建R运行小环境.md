---
title: "使用conda在服务器创建R运行小环境"
date: 2024-08-25T15:14:43Z
draft: ["false"]
tags: [
  "fetched",
  "新叶生物"
]
categories: ["Acdemic"]
---
使用conda在服务器创建R运行小环境 by 新叶生物
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span>在服务器上运行R会比本地方便许多，下面介绍如何在服务器上安装一个R运行的小环境</span><br><span></span></h2><h3 data-tool="mdnice编辑器"><span></span><span>首先是conda的安装</span><span></span></h3><p data-tool="mdnice编辑器">下载安装包 -- bash 安装 -- 接受协议 -- 选择默认安装路径（回车） -- 重新激活环境 -- 调用帮助文档</p><pre data-tool="mdnice编辑器"><code><span>## 下载，其实不需要，只是为了让大家了解一下，服务器已经下载好了，直接cp或者软链接即可</span><br><span># wget -c https://mirrors.bfsu.edu.cn/anaconda/miniconda/Miniconda3-latest-Linux-x86_64.sh</span><br><br><span>## 软链接即可</span><br><span>cd</span>  ~<br>ln  -s  /home/t_linux/Miniconda3-latest-Linux-x86_64.sh  ./<br><span>## 安装，安装过程只需要输入 yes 或者按 Enter</span><br>bash  Miniconda3-latest-Linux-x86_64.sh <br><br><span>## 重新激活环境</span><br><span>source</span>  ~/.bashrc <br><br><span>## 查看 conda 的帮助文档</span><br>conda --<span>help</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>接着配置镜像</span><span></span></h3><p data-tool="mdnice编辑器">我们使用 conda 安装软件时，conda 会去 channel 中搜索软件，如果使用的服务器是在国内，channel 就选择国内的，推荐清华，如果清华镜像出问题，再选择其他。</p><pre data-tool="mdnice编辑器"><code><span>#</span><span><span> 配置镜像</span></span><span><br>#</span><span> 下面四行配置清华大学的conda的channel地址（首选）</span><br>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/<br>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/<br>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda/<br>conda config --set show_channel_urls yes<br><span><br>#</span><span> 如果需要官方频道，可以添加下面这两行配置官网的channel地址（不推荐）</span><br>conda config --add channels conda-forge <br>conda config --add channels bioconda<br><span><br>#</span><span> 删除defaults频道</span><br>sed -i '/defaults/d' ~/.condarc<br><span><br>#</span><span><span># 配置镜像成功</span></span><br><span>#</span><span> 查看配置结果</span><br>cat ~/.condarc<br><span><br>#</span><span><span># 每次更换完频道之后记得要清除一下index。</span></span><br><span>#</span><span> -i 是指清除掉构建好的index，清除掉之后才会从新的频道下载软件包</span><br>conda clean -i <br><span>#</span><span> 也可以把所有的缓存都清除掉</span><br>conda clean -a  <br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>创建R4小环境</span><span></span></h3><pre data-tool="mdnice编辑器"><code><span># 创建名为R4的软件环境来安装转录组学分析的各种R包</span><br><span># 安装一个python=3的软件作为依赖</span><br>conda create -y -n  R4  python=3.8<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>在小环境中安装R以及R包</span><span></span></h3><p data-tool="mdnice编辑器">注：软件都要安装在小环境中，不要安装在 base</p><pre data-tool="mdnice编辑器"><code><span># 激活环境</span><br>conda activate R4<br><br><span># 安装 R 软件</span><br>conda install r-base=4.3.0 -y<br><br><span># 查看版本</span><br>R --version<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>有了R后，接着安装需要的额R包</span><span></span></h3><p data-tool="mdnice编辑器"><span>安装R包的命令可以直接网页搜索：conda + R包的名字</span>，如：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100000777" data-ratio="0.4305555555555556" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LLIBIFic6b1ibLaXbQPiaibdVjjVluiar5T84ia8TQjAkN6WibXXBqyic5e9GpNTMTQ0RgQwEftmkzkW4trAg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LLIBIFic6b1ibLaXbQPiaibdVjjVluiar5T84ia8TQjAkN6WibXXBqyic5e9GpNTMTQ0RgQwEftmkzkW4trAg/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240825212200453</figcaption></figure><p data-tool="mdnice编辑器">第一个词条点击进去，得到命令如下：但是我们自己安装的时候去掉冒号前的codna-forge：<span>conda install -y r-getopt</span></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100000773" data-ratio="0.2730093071354705" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LLIBIFic6b1ibLaXbQPiaibdVjjeEmYOer0HOSPPgQWJJE2MfPMbR1ibmafNH6FFVFaBDovRIDTbKXvQVw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="967" src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LLIBIFic6b1ibLaXbQPiaibdVjjeEmYOer0HOSPPgQWJJE2MfPMbR1ibmafNH6FFVFaBDovRIDTbKXvQVw/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240825212235846</figcaption></figure><p data-tool="mdnice编辑器">下面来安装一些课上用于差异分析的R包，命令如下：</p><p data-tool="mdnice编辑器"><span>一定需要有耐心</span>，集群上安装软件大多时候比较顺畅，但也有会由于网速等各种原因安装起来比较闹心，但是一旦安装好了，用起来的时候会很爽。</p><pre data-tool="mdnice编辑器"><code>conda install -y r-getopt <span># 参数传递包</span><br>conda install -y bioconductor-edger <span># 差异分析包edger</span><br>conda install -y r-ggplot2 <span># 绘图包</span><br>conda install -y r-gtidyverse <span># 数据处理包</span><br>conda install -y bioconductor-org.hs.eg.db <span># id转换包，这个包相对比较难以安装</span><br></code></pre><p data-tool="mdnice编辑器">还可以选择本地安装，不需要联网安装非常丝滑，但是需要手动安装依赖包，不是很建议（只有在特别难安装的时候考虑使用）</p><p data-tool="mdnice编辑器">如上面的org.hs.eg.db包本地安装，</p><p data-tool="mdnice编辑器">下载包：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100000774" data-ratio="0.47086247086247085" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LLIBIFic6b1ibLaXbQPiaibdVjjRYKG5FPGiaJKbWHo0yu6WG9jNp5eNo2eMhbsAicDY1FnCGKNAa5D7Kxw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="858" src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LLIBIFic6b1ibLaXbQPiaibdVjjRYKG5FPGiaJKbWHo0yu6WG9jNp5eNo2eMhbsAicDY1FnCGKNAa5D7Kxw/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240825223347205</figcaption></figure><p data-tool="mdnice编辑器">点击进去：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100000775" data-ratio="0.30185185185185187" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LLIBIFic6b1ibLaXbQPiaibdVjjiaZ5Ipm3EKcoLmltNKlmNRjDLSmGIYntz8lq1xEOrRaaosY9l4xX84Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LLIBIFic6b1ibLaXbQPiaibdVjjiaZ5Ipm3EKcoLmltNKlmNRjDLSmGIYntz8lq1xEOrRaaosY9l4xX84Q/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240825223457006</figcaption></figure><p data-tool="mdnice编辑器">下载到服务器：</p><pre data-tool="mdnice编辑器"><code>wget https://bioconductor.org/packages/release/data/annotation/src/contrib/org.Hs.eg.db_3.19.1.tar.gz<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100000776" data-ratio="0.14722222222222223" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LLIBIFic6b1ibLaXbQPiaibdVjjsMMHkgW3QyCQ9k5lCXgeRtjBOMphP8bu8js99NJbUnLsdGxpxepT7A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LLIBIFic6b1ibLaXbQPiaibdVjjsMMHkgW3QyCQ9k5lCXgeRtjBOMphP8bu8js99NJbUnLsdGxpxepT7A/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240825223529552</figcaption></figure><p data-tool="mdnice编辑器">安装：</p><pre data-tool="mdnice编辑器"><code>/home/data/t020448/miniconda3/envs/R4/bin/R  CMD INSTALL -l /home/data/t020448/miniconda3/envs/R4/lib/R/library  org.Hs.eg.db_3.19.1.tar.gz<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>或者直接导入配置文件以安装软件</span><span></span></h3><p data-tool="mdnice编辑器">下载钉钉群里的yaml文件</p><pre data-tool="mdnice编辑器"><code>conda env create -n R4 -f R4.yaml<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>测试上课的差异分析脚本：</span><span></span></h3><p data-tool="mdnice编辑器">测试帮助文档：</p><pre data-tool="mdnice编辑器"><code>/home/data/t020448/miniconda3/envs/R4/bin/Rscript edgeR.R<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100000778" data-ratio="0.2361111111111111" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LLIBIFic6b1ibLaXbQPiaibdVjj7v73HCr858iaKLziaWMzzkBibiasqyKibgPWcPNicYtJTL6MKkeYItKJVM3g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/by7zpDFL3LLIBIFic6b1ibLaXbQPiaibdVjj7v73HCr858iaKLziaWMzzkBibiasqyKibgPWcPNicYtJTL6MKkeYItKJVM3g/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240825224014149</figcaption></figure><p data-tool="mdnice编辑器">出现上面的帮助文档就是调用成功。</p><p data-tool="mdnice编辑器">现在试试运行差异分析：</p><pre data-tool="mdnice编辑器"><code>/home/data/t020448/miniconda3/envs/R4/bin/Rscript edgeR.R --count filter_count.txt --group group.txt --comp Dex_vs_untreated --<span>fc</span> 1.5 --pvalue 0.05 --od ./Test1<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>最后</span><span></span></h3><p data-tool="mdnice编辑器">R包有时候比较难安装，多尝试几次就好了，如果最后你还是解决不了，联系我给你看看：微信群里添加新叶老师</p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/cWXXgfclhGBsknbUsxak-A",target="_blank" rel="noopener noreferrer">原文链接</a>
