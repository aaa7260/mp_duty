---
title: "Alevin — 更快的单细胞定量"
date: 2024-08-15T09:59:54Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
Alevin — 更快的单细胞定量 by 生信菜鸟团
------
<div><section data-md5="d93a6" act="xmy"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><p data-md5="d93a6"><strong data-md5="d93a6">工欲善其事必先利其器</strong></p></section></section></section></section></section></section></section><p><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span><span>1</span></span><span>Alevin</span></h2><p data-tool="mdnice编辑器">Alevin 是一个专为单细胞RNA测序（scRNA-seq）数据设计的软件工具，它是Salmon软件的一个组成部分，由Rob Patro及其研究团队开发。其具有以下特性</p><ol data-tool="mdnice编辑器"><li><section><strong>快速准确的细胞分配和表达量估计：</strong> Alevin使用了先进的算法来对单细胞测序数据进行预处理、错误校正和表达量估计。这包括从原始的读取数据中准确识别和量化细胞特异性表达模式。</section></li><li><section><strong>端到端处理流程：</strong> Alevin提供了一个从读取数据到细胞-基因表达矩阵的一体化解决方案，极大简化了单细胞数据的预处理步骤。</section></li><li><section><strong>高效的内存和时间性能：</strong> 通过优化数据结构和算法，Alevin能够在保持高准确度的同时，显著降低内存使用和加快数据处理速度。</section></li><li><section><strong>兼容性和可扩展性：</strong> Alevin能够处理多种单细胞测序技术产生的数据，目前支持 10x Genomics、Drop-seq、inDrop V2、CELSeq 1/2、Quartz-Seq2、 sci-RNA-seq3 测序数据。此外，它可以输出多种格式的结果，方便与后续分析工具如Seurat或Scanpy进行集成。</section></li><li><section><strong>开源和社区支持：</strong> Alevin是开源软件，可供广大研究者和开发者使用和修改。</section></li></ol><p data-tool="mdnice编辑器">官方文档：</p><ul data-tool="mdnice编辑器"><li><section>https://salmon.readthedocs.io/en/latest/alevin.html</section></li></ul><p data-tool="mdnice编辑器">github：</p><ul data-tool="mdnice编辑器"><li><section>https://github.com/COMBINE-lab/salmon?tab=readme-ov-file</section></li></ul><h2 data-tool="mdnice编辑器"><span><span>2</span></span><span>发表文章</span></h2><blockquote data-tool="mdnice编辑器"><p><strong>题目</strong>: Alevin efficiently estimates accurate gene abundances from dscRNA-seq data<br><strong>期刊</strong>：Genome Biology<br><strong>日期</strong>：2019年3月<br><strong>作者及单位</strong>：Avi Srivastava &amp; Stony Brook University<br><strong>DOI</strong>：https://doi.org/10.1186/s13059-019-1670-y</p></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100037616" data-ratio="0.5555555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic6jB05Oxibx8IUU8cfS7bkzpDKhEC3oWpshQgubiak4Bd8x4nt9J82W3xO9Tag0RpEM4t4PybejprA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic6jB05Oxibx8IUU8cfS7bkzpDKhEC3oWpshQgubiak4Bd8x4nt9J82W3xO9Tag0RpEM4t4PybejprA/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span><span>3</span></span><span>如何安装</span></h2><h3 data-tool="mdnice编辑器"><span></span><span>二进制版本</span><span></span></h3><p data-tool="mdnice编辑器">github上最新版v1.10.1未提供二进制版本，源码编译非常复杂，通常会报错，所以不建议直接源码编译。可以选择 Salmon v1.10.0 版本，其提供的有二进制版本，安装起来非常方便</p><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span><span># 解压即可使用</span></span><br>wget -c https://github.com/COMBINE-lab/salmon/releases/download/v1.10.0/salmon-1.10.0_linux_x86_64.tar.gz<br>tar -xf salmon-1.10.0_linux_x86_64.tar.gz <br><span><br>#</span><span><span>#创建软链接（可选）</span></span><br>ln -s ~/software/salmon-latest_linux_x86_64/bin/salmon ~/software/bin/salmon<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>conda 安装</span><span></span></h3><p data-tool="mdnice编辑器">如果你想使用最新版，可以使用codna安装。这也是比较推荐的方法。</p><pre data-tool="mdnice编辑器"><span></span><code>mamba create -n alevin<br>mamba activate alevin<br>mamba install salmon<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100037613" data-ratio="0.2972222222222222" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic6jB05Oxibx8IUU8cfS7bkzDHAzUuNwaSe9meM9UktLicZOhbib5EdTTfUibXtbaBgbhsPPHaLHe263g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic6jB05Oxibx8IUU8cfS7bkzDHAzUuNwaSe9meM9UktLicZOhbib5EdTTfUibXtbaBgbhsPPHaLHe263g/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>singularity 容器调用</span><span></span></h3><p data-tool="mdnice编辑器">当然，官方指导还提供了Docker安装，如果我们没有Docker权限，可以使用singularity替代</p><pre data-tool="mdnice编辑器"><span></span><code>singularity pull docker://combinelab/salmon<br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100037617" data-ratio="0.8240740740740741" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic6jB05Oxibx8IUU8cfS7bkzYnAdAfSPQkn0vc6gsy647epaSicveQEVH80UjnJAd5HCWoMKFE3rU0Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic6jB05Oxibx8IUU8cfS7bkzYnAdAfSPQkn0vc6gsy647epaSicveQEVH80UjnJAd5HCWoMKFE3rU0Q/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span><span>4</span></span><span>功能简述</span></h2><p data-tool="mdnice编辑器">Alevin是Salmon软件工具的一个组件，专门设计用于处理单细胞RNA测序数据。Alevin旨在为单细胞实验提供快速、准确的基因表达量估计。</p><h2 data-tool="mdnice编辑器"><span><span>5</span></span><span>最小化使用</span></h2><pre data-tool="mdnice编辑器"><span></span><code>salmon alevin -l ISR -1 cb.fastq.gz -2 reads.fastq.gz --chromium  -i salmon_index_directory -p 10 -o alevin_output --tgMap txp2gene.tsv<br><span><br>#</span><span> -l 建库类型，建议对Drop-seq 和 10X-V2都使用 <span>"ISR"</span></span><br><span>#</span><span> -1 CB+UMI 文件，可同时指定多个文件</span><br><span>#</span><span> -2 Read序列文件</span><br><span>#</span><span> --dropseq / --chromium / --chromiumV3  建库protocol</span><br><span>#</span><span> -i 索引文件，由 salmon index 命令生成的参考基因组索引文件</span><br><span>#</span><span> -p 指定线程。默认调用系统中所有可用的线程。但是建议使用10个线程，因为这在时间-内存测试可以在达到最佳均衡。</span><br><span>#</span><span> -o 输出文件路径</span><br><span>#</span><span> --tgMap 转录本到基因的注释文件，tsv文件（以制表符分割，没有标题，包含两列，第一列是转录本，第二列是相应的基因）</span><br></code></pre><h2 data-tool="mdnice编辑器"><span><span>6</span></span><span>实例演示</span></h2><p data-tool="mdnice编辑器">数据集来自<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247522953&amp;idx=1&amp;sn=9e86346a6de21d02bc0c770f3d2734a6&amp;chksm=9b4bda32ac3c5324d83bfc9f1601648626ad90c84eba1df8c782735c7a648351b03fddb69845&amp;scene=21#wechat_redirect" textvalue="小鼠的5个样品的10x技术单细胞转录组上游定量（文末赠送全套代码）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">小鼠的5个样品的10x技术单细胞转录组上游定量（文末赠送全套代码）</a></p><h3 data-tool="mdnice编辑器"><span></span><span>下载对应的转录本序列及注释文件</span><span></span></h3><p data-tool="mdnice编辑器">从GENCODE下载对应的参考基因组及注释文件：https://www.gencodegenes.org/mouse/</p><pre data-tool="mdnice编辑器"><span></span><code>nohup wget -c https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_mouse/release_M34/gencode.vM34.transcripts.fa.gz 1&gt;fa.log 2&gt;&amp;1 &amp;<br>wget -c https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_mouse/release_M34/gencode.vM34.annotation.gtf.gz<br><br>28M 1月  11 21:33 gencode.vM34.annotation.gtf.gz<br>54M 1月  11 21:31 gencode.vM34.transcripts.fa.gz<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>构建索引</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>nohup salmon index -i transcript_index -k 31 --gencode -p 10  -t gencode.vM34.transcripts.fa.gz 1&gt;salmon.log 2&gt;&amp;1 &amp;<br><br>-i #指定索引生成目录<br>-k #设置用于构建准索引的k-mer的长度，默认为31<br>-p #设置调用线程<br>-t #转录本的fasta格式文件<br>--gencode #此选项表明输入的fasta文件是GENCODE格式的，会在第一个`|`字符处切分转录本名称<br><span><br>#</span><span><span>#构建索引速度还是很快的</span></span><br>real    1m47.533s<br>user    6m28.436s<br>sys     0m5.453s<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>生成ENST与Gene Symbol对应的tsv文件</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>bioawk -c gff '$feature=="transcript" {print $group}' &lt;(gunzip -c gencode.vM34.annotation.gtf.gz) | awk -F ' ' '{print substr($4,2,length($4)-3) "\t" substr($8,2,length($8)-3)}' &gt; txp2gene_symbol.tsv<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>定量脚本</span><span></span></h3><p data-tool="mdnice编辑器">新建脚本文件 <code>vim salmon_alvein.sh</code></p><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span>! /bin/bash -xe</span><br><span>#</span><br>index=~/test_data/test_alevin/transcript_index<br>tsv=~/test_data/test_alevin/txp2gene_symbol.tsv<br><br>salmon alevin -l ISR \<br>        -1 ${1} \<br>        -2 ${2} \<br>        --chromium  \<br>        -i ${index} \<br>        -p 4 \<br>        -o ${3} \<br>        --dumpMtx \<br>        --dumpFeatures \<br>        --tgMap ${tsv}<br><br>echo "salmon alevin run finised!"<br><br>--dumpMtx #将 基因-计数 矩阵从默认的二进制格式转换为更易于阅读和分析的mtx稀疏格式<br>--dumpFeatures #允许导出细胞条形码分类过程中使用的所有特征及其在每个细胞级别上的计数<br></code></pre><blockquote data-tool="mdnice编辑器"><p>更多参数详见：https://salmon.readthedocs.io/en/latest/alevin.html#single-cell-protocol-specific-notes</p></blockquote><h3 data-tool="mdnice编辑器"><span></span><span>批量提交运行</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>ls ~/test_data/raw/SRR*R1* |paste - &lt;(ls /home/test_data/raw/SRR*R2*)|paste - &lt;(ls ../raw/*gz|cut -d"_" -f 1 |sort -u|cut -d"/" -f 3 | cut -d "_" -f 1 ) &gt; ../alevin_out/samplelist.txt<br><br>cat samplelist.txt |awk '{print "nohup bash salmon_alvein.sh " $0 "  1&gt;"$3".log 2&gt;&amp;1 &amp;"}' &gt; alevin_run.sh<br><br>bash alevin_run.sh<br></code></pre><p data-tool="mdnice编辑器"><img data-imgfileid="100037615" data-ratio="0.09351851851851851" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic6jB05Oxibx8IUU8cfS7bkz4LRT72E5P4dKgATWicZDSx7Ym4eGLcmcZ63EoamUP4ib1wfRib0Oe2xdA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic6jB05Oxibx8IUU8cfS7bkz4LRT72E5P4dKgATWicZDSx7Ym4eGLcmcZ63EoamUP4ib1wfRib0Oe2xdA/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100037614" data-ratio="0.12777777777777777" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic6jB05Oxibx8IUU8cfS7bkzwKUN8Zw4E7vGyGQxm8o5q5VUyEpDHcRHX9z6h0ofXZvmWHzhQ5USnQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic6jB05Oxibx8IUU8cfS7bkzwKUN8Zw4E7vGyGQxm8o5q5VUyEpDHcRHX9z6h0ofXZvmWHzhQ5USnQ/640?wx_fmt=png&amp;from=appmsg"></p><h3 data-tool="mdnice编辑器"><span></span><span>输出结果</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-imgfileid="100037622" data-ratio="0.856" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic6jB05Oxibx8IUU8cfS7bkzlLr2Aw1jIBNDRrTuTIKnQLP5WicK8P9MeTtCct1t64ujEEPrUv6icawg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="750" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic6jB05Oxibx8IUU8cfS7bkzlLr2Aw1jIBNDRrTuTIKnQLP5WicK8P9MeTtCct1t64ujEEPrUv6icawg/640?wx_fmt=png&amp;from=appmsg"></figure><ul data-tool="mdnice编辑器"><li><section><code>quants_mat.gz</code>：压缩的计数矩阵，其中包含每个细胞中每个基因的计数。二进制格式，<code>--dumpMtx</code> 参数可使矩阵从默认的二进制格式转换为更易于阅读和分析的mtx稀疏格式。</section></li><li><section><code>quants_mat_cols.txt</code>：矩阵的列标题，表示基因的ID。</section></li><li><section><code>quants_mat_rows.txt</code>：矩阵的行索引，表示细胞条形码的ID。</section></li><li><section><code>quants_tier_mat.gz</code>：矩阵的分层分类。</section></li></ul><p data-tool="mdnice编辑器">分层分类（Tier categorization）: Alevin将每个细胞中每个基因的估计计数值分类为三个层级。层级1包含所有reads都是唯一映射(mapping)的基因。层级2包含有模糊映射reads但也连接到唯一read证据的基因，这些证据可以由 EM 算法用来解析多映射读取。层级3包含没有唯一证据的基因，read计数是根据先验概率在这些基因之间的分布来计算的。</p><p data-tool="mdnice编辑器">后续分析走Seurat流程，读取 <code>quants_mat.mtx.gz</code> ，<code>quants_mat_rows.txt</code>， <code>quants_mat_cols.txt</code> 这三个文件即可</p><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">参考：</p><ul data-tool="mdnice编辑器"><li><section>https://salmon.readthedocs.io/en/latest/alevin.html#single-cell-protocol-specific-notes</section></li><li><section>https://www.jianshu.com/p/8de246673c85</section></li></ul></section><section><section act="xmy"><section data-id="123409" data-type="lspecial02,lspecial04" powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><br></section><section powered-by="xmyeditor.com" data-md5="8b46d"><img data-imgfileid="100037628" data-ratio="0.6940298507462687" data-type="gif" data-w="134" data-src="https://mmbiz.qpic.cn/mmbiz_gif/iaRJcrq2LosibrvQnXTV3PMktpwwmDsjia2JG4e3ibpLQ1G6M4nktW4PiaiaKfnpiaRmNbTT6St7QLfzAMAomKgWxQ4kA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp" src="https://mmbiz.qpic.cn/mmbiz_gif/iaRJcrq2LosibrvQnXTV3PMktpwwmDsjia2JG4e3ibpLQ1G6M4nktW4PiaiaKfnpiaRmNbTT6St7QLfzAMAomKgWxQ4kA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp"></section><section powered-by="xmyeditor.com" data-md5="8b46d"><br></section></section></section></section></section></section><p><span></span><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section> <a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247529099&amp;idx=1&amp;sn=fe3be2d43a6284a36c15625c23dc9a3e&amp;chksm=9b4b3230ac3cbb26b875bd0a294f24dfbd41a2b59996fbfe79087330d267c4ec70882683c3bd&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课4月班" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信入门&amp;数据挖掘线上直播课4月班</a>，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;chksm=9b4b2f10ac3ca606c1c4bac8cf112bb9b0f18e3c4262f5f2b8c0dba3bfedf2ba201507247005&amp;scene=21#wechat_redirect" textvalue="2024的共享服务器交个朋友福利价仍然是800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">2024的共享服务器交个朋友福利价仍然是800</a></section></li></ul></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/E1LKT0LYd2K_6vfOhFAnQA",target="_blank" rel="noopener noreferrer">原文链接</a>
