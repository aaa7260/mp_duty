---
title: "预测癌症免疫治疗反应-EaSleR学习和知识整理"
date: 2024-08-26T23:00:27Z
draft: ["false"]
tags: [
  "fetched",
  "生信方舟"
]
categories: ["Acdemic"]
---
预测癌症免疫治疗反应-EaSleR学习和知识整理 by 生信方舟
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">EaSIeR通过RNA-seq数据与其他不同来源的先验知识/数据相结合，得出系统性的肿瘤微环境特征以及量化了免疫细胞组成和细胞内和细胞间的通讯。开发团队对这种特征应用了多任务的学习方式赖预测免疫反应的不同标志物，并根据可解释的生物标志物得出特异性的癌症模型。</p><p data-tool="mdnice编辑器">这种模型可以应用于接受 PD-1/PD-L1 抑制剂治疗的患者的RNA-seq数据。<img data-imgfileid="100001342" data-ratio="0.9411764705882353" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFmZTcVib2JrxH0UHxics8PkO4ia94YRIkXgFQibZCKfBd9M3THuAK3FZ91EusrtCGtevDicLl82WtbfTg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="425" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFmZTcVib2JrxH0UHxics8PkO4ia94YRIkXgFQibZCKfBd9M3THuAK3FZ91EusrtCGtevDicLl82WtbfTg/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器"><strong>输入数据：</strong></p><p data-tool="mdnice编辑器">1、Count数据；2、TPM数据；3、TMB数据；4、既往免疫治疗反应的数据(若存在的话, 本文采用TIDE数据库预测得到结果))</p><h4 data-tool="mdnice编辑器"><span></span><span>分析步骤</span><span></span></h4><h5 data-tool="mdnice编辑器"><span></span><span>1、导入数据和加载R包</span><span></span></h5><p data-tool="mdnice编辑器">注：示例数据不是RNA-seq数据， 仅用于实操练习！</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br>proj = <span>"combat"</span><br><span>library</span>(<span>"easier"</span>)<br>load(<span>"~/Desktop/data.Rdata"</span>)<br>head(exp)[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br><span># GSM1020099 GSM1020100 GSM1020101 GSM1020102</span><br><span># RFC2     7.727199   5.109329   8.021387   7.880099</span><br><span># HSPA6    7.601476   6.538490   6.340193   6.016021</span><br><span># PAX8     5.910106   5.848390   6.124806   5.894079</span><br><span># GUCA1A   3.577948   3.591067   3.566542   3.553448</span><br><br><span># TIDE预测得到了免疫治疗反应情况</span><br>meta_TIDE &lt;- read.csv(<span>"~/Desktop/meta_TIDE.csv"</span>,<br>                      row.names = <span>1</span>)<br>identical(colnames(exp),rownames(meta_TIDE))<br><span># TRUE</span><br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>2、获取免疫特征评分</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>Hallmarks &lt;- c(<span>"CYT"</span>, <span>"Roh_IS"</span>, <span>"chemokines"</span>, <span>"Davoli_IS"</span>, <br>               <span>"IFNy"</span>, <span>"Ayers_expIS"</span>, <span>"Tcell_inflamed"</span>, <span>"RIR"</span>, <span>"TLS"</span>)<br>scores &lt;- compute_scores_immune_response(RNA_tpm = exp, <br>                                         selected_scores = Hallmarks)<br>colnames(scores)<br>scores &lt;- scores[,-c(<span>5</span>)]<br><br><span># 对数据进行标准化</span><br>data_scaled &lt;- t(scale(t(scores)))<br>pheatmap::pheatmap(data_scaled, <br>                   cluster_rows = <span>TRUE</span>, <br>                   cluster_cols = <span>TRUE</span>, <br>                   show_rownames = <span>TRUE</span>, <br>                   show_colnames = <span>TRUE</span>,<br>                   fontsize_row = <span>8</span>, <br>                   fontsize_col = <span>8</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100001343" data-ratio="0.748" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFmZTcVib2JrxH0UHxics8PkOFsqaIs3PJibkQ3iaIOSBLOoN0jhX4ymdlB4ghASw3CuNsFibZd6ExGDwQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="750" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFmZTcVib2JrxH0UHxics8PkOFsqaIs3PJibkQ3iaIOSBLOoN0jhX4ymdlB4ghASw3CuNsFibZd6ExGDwQ/640?wx_fmt=png&amp;from=appmsg"></figure><h5 data-tool="mdnice编辑器"><span></span><span>3、对TME特征进行定量为后续分析做准备</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code><span># quanTIseq法对免疫细胞比例进行定量</span><br>cell_res &lt;- compute_cell_fractions(RNA_tpm = exp)<br><br><span># PROGENy法推断14条通路活性</span><br><span># 部分通路相关基因可能被纳入计算免疫反应评分</span><br><span># remove_sig_genes_immune_response设置为True，去除这部分重复基因进行计算，</span><br><span># 这里是应该使用count数据</span><br>pathway_res &lt;- compute_pathway_activity(RNA_counts = exp,<br>                                        remove_sig_genes_immune_response = <span>TRUE</span>)<br><br><span># DoRothEA法进行转录因子分析</span><br>tf_res &lt;- compute_TF_activity(RNA_tpm = exp)<br><br><span># 肿瘤特异性细胞间通讯网络分析</span><br><span># "BLCA"   "BRCA"   "CESC"   "CRC"    "GBM"    "HNSC"   "KIRC"   "LIHC"   </span><br><span># "LUAD" # "LUSC"   "OV"     "PAAD"   "pancan" "PRAD"   "SKCM"  </span><br><span># "STAD"   "THCA"   "UCEC"</span><br><span># 其中pancan是指泛癌</span><br><br>lrpair_weights &lt;- compute_LR_pairs(RNA_tpm = exp,<br>                                  cancer_type = <span>"HNSC"</span>)<br>ccpair_scores &lt;- compute_CC_pairs(lrpairs = lrpair_weights, <br>                                   cancer_type = <span>"HNSC"</span>)                                 <br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>4、预测患者的免疫反应</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code><span># cancer_type需要特别指定</span><br>predictions &lt;- predict_immune_response(pathways = pathway_activities,<br>                                       immunecells = cell_fractions,<br>                                       tfs = tf_activities,<br>                                       lrpairs = lrpair_weights,<br>                                       ccpairs = ccpair_scores,<br>                                       cancer_type = <span>"HNSC"</span>, <br>                                       verbose = <span>TRUE</span>)<br><span># 若已知病人的免疫治疗结果，那么可以判断predictions的准确性，若未知免疫治疗效果，则预测的结果无从判断。</span><br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>5、根据免疫治疗反应数据评估EaSIeR的预测</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code><span># 准备肿瘤突变负荷数据</span><br><span># 由于这个数据集中是没有TMB数据的</span><br><span># 自己分析的时候需要把TMB数据转化成一行，内容是TMB的值，列名是样本名</span><br><span># TMB &lt;- colData(dataset_mariathasan)[["TMB"]]</span><br><span># names(TMB) &lt;- colData(dataset_mariathasan)[["pat_id"]]</span><br><br><span>############</span><br><span># 有免疫治疗数据评估免疫反应</span><br>output_have &lt;- assess_immune_response(predictions_immune_response = predictions,<br>                                      patient_response = meta_TIDE$Responder,<br>                                      RNA_tpm = exp,<br>                                      TMB_values = TMB,<br>                                      easier_with_TMB = <span>"weighted_average"</span>,<br>                                      weight_penalty = <span>0.5</span>)<br><span># Error: object 'TMB' not found</span><br><span># In addition: Warning message:</span><br><span># In assess_immune_response(predictions_immune_response = predictions,  :</span><br><span>#   Gene expression (TPM) data is missing, skipping computation of scores of immune response..</span><br><br><span>###################</span><br><span># 无免疫治疗数据评估免疫反应</span><br>output_none &lt;- assess_immune_response(predictions_immune_response = predictions,<br>                                      TMB_values = TMB,<br>                                      easier_with_TMB = <span>"weighted_average"</span>,<br>                                      weight_penalty = <span>0.5</span>)<br><span># Error: object 'TMB' not found</span><br><span># In addition: Warning message:</span><br><span># In assess_immune_response(predictions_immune_response = predictions,  :</span><br><span>#   Gene expression (TPM) data is missing, skipping computation of scores of immune response..</span><br><br><span>################</span><br><span># 获得免疫反应评分</span><br>derived_scores &lt;- retrieve_easier_score(predictions_immune_response = predictions,<br>                                        TMB_values = TMB,<br>                                        easier_with_TMB = c(<span>"weighted_average"</span>, <br>                                                             <span>"penalized_score"</span>),<br>                                        weight_penalty = <span>0.5</span>)<br></code></pre><p data-tool="mdnice编辑器"><strong>该数据集中没有TMB数据，所以这里的很多步没法执行</strong></p><h5 data-tool="mdnice编辑器"><span></span><span>6、可解释的Biomarker预测/展示免疫疗法的反应</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>identical(colnames(exp),rownames(meta_TIDE))<br><span>#meta_TIDE$threshold = factor(ifelse(meta_TIDE$TIDE &gt; 0,'NR','R'),levels=c('R','NR'))</span><br>ICB_response = ifelse(meta_TIDE$TIDE &gt; <span>0</span>,<span>'NR'</span>,<span>'R'</span>)<br>ICB_response &lt;- t(ICB_response)<br>names(ICB_response) &lt;- colnames(exp)<br>output_biomarkers &lt;- explore_biomarkers(pathways = pathway_res,<br>                                        immunecells = cell_res,<br>                                        tfs = tf_res,<br>                                        lrpairs = lrpair_weights,<br>                                        ccpairs = ccpair_scores,<br>                                        cancer_type = <span>'HNSC'</span>,<br>                                        patient_label = ICB_response)<br><span># 输出图片</span><br>output_biomarkers[[<span>1</span>]]<br>output_biomarkers[[<span>2</span>]]<br>output_biomarkers[[<span>3</span>]]<br>output_biomarkers[[<span>4</span>]]<br>output_biomarkers[[<span>5</span>]]<br>output_biomarkers[[<span>6</span>]]<br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>重要结果解读</span><span></span></h5><p data-tool="mdnice编辑器"><strong>第一张图</strong><img data-imgfileid="100001344" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFmZTcVib2JrxH0UHxics8PkOzjtdgFgkElrtlSjVzzT9T8IrQxD99SL2fiacD8eXMAapv2JYODHTk3g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="800" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFmZTcVib2JrxH0UHxics8PkOzjtdgFgkElrtlSjVzzT9T8IrQxD99SL2fiacD8eXMAapv2JYODHTk3g/640?wx_fmt=png&amp;from=appmsg">个人理解：蓝色代表正相关，红色代表负相关，数值代表不同类型细胞在肿瘤中浸润的程度。Z-score就是展示同一种细胞亚型对不同分组的患者的影响分数。</p><p data-tool="mdnice编辑器"><strong>第二张图</strong><img data-imgfileid="100001345" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFmZTcVib2JrxH0UHxics8PkOo25QtibXgUgB9ecJibDVfVE0T7LyxcQ9rKLjTeTODGIW675slhqnb2Gw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="800" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFmZTcVib2JrxH0UHxics8PkOo25QtibXgUgB9ecJibDVfVE0T7LyxcQ9rKLjTeTODGIW675slhqnb2Gw/640?wx_fmt=png&amp;from=appmsg">个人理解：左边是没有反应患者，右边是有反应患者情况。中间的灰色或者蓝色点的大小代表权重。形状代表正负相关性。里面的文字标识代表了不同的细胞-细胞，细胞-分子，分子-分子之间的作用情况/方向。整体从左往右看的话可以观察患者无反应到有反应过程中的分子调控的变化。</p><p data-tool="mdnice编辑器">更详细的结果解释可读一下原文~</p><h4 data-tool="mdnice编辑器"><span></span><span>参考资料：</span><span></span></h4><p data-tool="mdnice编辑器">1、EaSleR: https://bioconductor.org/packages/release/bioc/vignettes/easier/inst/doc/easier_user_manual.html</p><p data-tool="mdnice编辑器">2、Interpretable systems biomarkers predict response to immune-checkpoint inhibitors. Patterns (N Y). 2021 Jun 30;2(8):100293</p><p data-tool="mdnice编辑器">2、生信菜鸟团：https://mp.weixin.qq.com/s/_Z5mWDNi8hzAc_mLivcjsQhttps://mp.weixin.qq.com/s/AHJCgY_341ZY5pmq6vSQCw</p><p data-tool="mdnice编辑器"><strong>致谢</strong>：感谢曾老师、小洁老师以及生信技能树团队全体成员。</p><p data-tool="mdnice编辑器"><strong>注</strong>：若对内容有疑惑或者有发现明确错误的朋友，请联系后台(欢迎交流)。更多内容可关注公众号：<strong>生信方舟</strong></p><span>- END -</span></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/0FcSHn8g9C4eU3XDxNEWxw",target="_blank" rel="noopener noreferrer">原文链接</a>
