---
title: "单细胞全流程之SCP"
date: 2024-08-01T12:42:02Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
单细胞全流程之SCP by 生信菜鸟团
------
<div><blockquote data-tool="mdnice编辑器"><p><span>从我们</span><span>生信技能树</span><span>历年的几千个马拉松授课学员里面募集了一些优秀的创作者，某种意义来说是传承了我们生信技能树的知识整理和分享的思想！</span></p></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">今天的是学员一点一滴整理的授课知识点笔记哦，还有互动练习题哈，欢迎大家点击文末的阅读原文去关注我们学员的公众号哦！</p><p><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">曾经把我一个盘的东西都整没的包，今天终于在张浩老师本人解答下基本能够运行了~</p><p data-tool="mdnice编辑器">其实之前曾老师已经写过如何安装SCP及分析的教程，但我在安装的过程中还是遇到了很多奇奇怪怪的问题，所以记录一下我的学习过程，如果有什么不对或者能够改进的地方，希望各位大佬能够指点~</p><p data-tool="mdnice编辑器">在这里就不过多介绍这个包，因为功能强大，从数据预处理到发表级图片输出一应俱全。</p><p><img data-galleryid="" data-imgfileid="100042230" data-ratio="0.6759259259259259" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GWAl5obPcIjzyE1RueUGvCiaZ5WBhjl5gzps2nQGb0nmJGbSX6ps9uibbWftxmPvSYwVibWVp6aaaicgw/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=13&amp;tp=wxpic" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GWAl5obPcIjzyE1RueUGvCiaZ5WBhjl5gzps2nQGb0nmJGbSX6ps9uibbWftxmPvSYwVibWVp6aaaicgw/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=13&amp;tp=wxpic"></p><p data-tool="mdnice编辑器">今天主要完成的是在公共服务器上安装SCP</p><p data-tool="mdnice编辑器">由于是公共服务器那么我们需要在一个独立的R环境中</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/XCopLcwfzeeteOqHsPkjOSia87GmAVoOwXFsxPO9IA9icam65Q9Bx7uHRL8Iw2ibhPDAps1NeY9cSlXoCarIUzwAtWL2nnPEDIm/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code><span>if</span> (!<span>require</span>(<span>"renv"</span>, quietly = <span>TRUE</span>)) {<br>  install.packages(<span>"renv"</span>)<br>}<br>dir.create(<span>"~/SCP_env"</span>, recursive = <span>TRUE</span>) <span>## It cannot be the home directory "~" !</span><br>renv::init(project = <span>"~/SCP_env"</span>, bare = <span>TRUE</span>, restart = <span>TRUE</span>)<br><span>#这时候在当前路径下会出现一个名为SCP_env的文件夹，成功创建环境后在console中会看到下图内容</span><br></code></pre><p><img data-galleryid="" data-imgfileid="100042226" data-ratio="0.4116766467065868" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GWAl5obPcIjzyE1RueUGvCia9Zgu2OB19LxgB8S1wkG1ne8D0hNPNEo1Uk99g2lbjCZcfG3fM0bDaw/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="668" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GWAl5obPcIjzyE1RueUGvCia9Zgu2OB19LxgB8S1wkG1ne8D0hNPNEo1Uk99g2lbjCZcfG3fM0bDaw/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/XCopLcwfzeeteOqHsPkjOSia87GmAVoOwXFsxPO9IA9icam65Q9Bx7uHRL8Iw2ibhPDAps1NeY9cSlXoCarIUzwAtWL2nnPEDIm/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>renv::activate(project = <span>"~/SCP_env"</span>)<span>#激活环境</span><br>renv::install(<span>"BiocManager"</span>)<br>renv::install(<span>"zhanghao-njmu/SCP"</span>, repos = BiocManager::repositories())<br>SCP::PrepareEnv(<br>  miniconda_repo = <span>"https://mirrors.bfsu.edu.cn/anaconda/miniconda"</span>,<br>  pip_options = <span>"-i https://pypi.tuna.tsinghua.edu.cn/simple"</span><br>)<br><span>#自动配置python环境，但我失败了，提示我需要手动安装一系列python包</span><br><span>#这里如果将SCP包加载进来我们会发现依旧可以运行一些内容，但是基于python的算法则无法运行</span><br></code></pre><p data-tool="mdnice编辑器">这时候我想到了手动配置一个conda环境去安装这些包，打开shell</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/XCopLcwfzeeteOqHsPkjOSia87GmAVoOwXFsxPO9IA9icam65Q9Bx7uHRL8Iw2ibhPDAps1NeY9cSlXoCarIUzwAtWL2nnPEDIm/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code><span>#</span><span>首先创建一个miniconda的文件夹并安装</span><br>mkdir miniconda<br>cd miniconda<br>wget https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-latest-Linux-x86_64.sh<br>bash Miniconda3-latest-Linux-x86_64.sh<br><span>#</span><span>根据提示，都选yes即可</span><br></code></pre><p data-tool="mdnice编辑器">重启终端，跟R一样需要配置镜像，方便下载</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/XCopLcwfzeeteOqHsPkjOSia87GmAVoOwXFsxPO9IA9icam65Q9Bx7uHRL8Iw2ibhPDAps1NeY9cSlXoCarIUzwAtWL2nnPEDIm/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/<br>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/<br>conda config --set show_channel_urls yes <br>pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple<br></code></pre><p data-tool="mdnice编辑器">再次重启后，名字前会出现base字样，说明miniconda配置完成，之后每次打开终端都会出现base</p><p><img data-galleryid="" data-imgfileid="100042227" data-ratio="0.06927710843373494" data-s="300,640" data-type="png" data-w="332" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GWAl5obPcIjzyE1RueUGvCia8CLD6bpE6hR8AM92Lun5MYaCxrKaK1ChqpllicRicrQ6Hn7XjSRdsYicQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GWAl5obPcIjzyE1RueUGvCia8CLD6bpE6hR8AM92Lun5MYaCxrKaK1ChqpllicRicrQ6Hn7XjSRdsYicQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><p data-tool="mdnice编辑器">可以通过conda deactivate退出base环境。</p><p data-tool="mdnice编辑器">接着，我们需要创建一个新的环境去安装SCP需要的python包</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/XCopLcwfzeeteOqHsPkjOSia87GmAVoOwXFsxPO9IA9icam65Q9Bx7uHRL8Iw2ibhPDAps1NeY9cSlXoCarIUzwAtWL2nnPEDIm/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>conda create --n SCP_env python==版本号  <span>#n 代表name SCP_env是环境名称，可以自由设置，python版本需要注意，这里有一个名为numba==0.5.5的依赖包需要的python版本要&gt;3.7&amp;&lt;3.11,所以不能安装最新的3.12，我这里指定的是3.10，因为这个问题卡了好久，大家一定要主要查看依赖包的版本以及对应需要的python版本。</span></code></pre><p data-tool="mdnice编辑器">根据提示我们将依赖包及其对应版本写到文本中，方便批量安装</p><p><img data-galleryid="" data-imgfileid="100042228" data-ratio="1.1228070175438596" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GWAl5obPcIjzyE1RueUGvCiau04kCDCzTSaUgwVgmEezo2AC6uicLc7iaVnoa3AfXo73Libm5f6SpHKAw/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="456" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GWAl5obPcIjzyE1RueUGvCiau04kCDCzTSaUgwVgmEezo2AC6uicLc7iaVnoa3AfXo73Libm5f6SpHKAw/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/XCopLcwfzeeteOqHsPkjOSia87GmAVoOwXFsxPO9IA9icam65Q9Bx7uHRL8Iw2ibhPDAps1NeY9cSlXoCarIUzwAtWL2nnPEDIm/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>pip install -r requirements.txt<br></code></pre><p data-tool="mdnice编辑器">再次切换到R server</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/XCopLcwfzeeteOqHsPkjOSia87GmAVoOwXFsxPO9IA9icam65Q9Bx7uHRL8Iw2ibhPDAps1NeY9cSlXoCarIUzwAtWL2nnPEDIm/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code>renv::activate(project = <span>"~/SCP_env"</span>)<span>#启动环境</span><br></code></pre><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/XCopLcwfzeeteOqHsPkjOSia87GmAVoOwXFsxPO9IA9icam65Q9Bx7uHRL8Iw2ibhPDAps1NeY9cSlXoCarIUzwAtWL2nnPEDIm/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"></span><code><span>#这里首先要设置好之前配置好的conda环境</span><br><span>#如果不设置在运行PAGA等python算法时会提示缺失scanpy等包</span><br>options(reticulate.conda_binary = <span>"/path/miniconda3/envs/SCP_env"</span>)<br><span>library</span>(SCP)<br>data(<span>"pancreas_sub"</span>)<br>pancreas_sub &lt;- RunPAGA(srt = pancreas_sub, group_by = <span>"SubCellType"</span>, linear_reduction = <span>"PCA"</span>, nonlinear_reduction = <span>"UMAP"</span>)<br>CellDimPlot(pancreas_sub, group.by = <span>"SubCellType"</span>, reduction = <span>"draw_graph_fr"</span>)<br></code></pre><p><img data-croporisrc="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GWAl5obPcIjzyE1RueUGvCiaSicB3QPr8ejtYrQ1ic68jJ37jgRItDuztdCuAohHA7lTiahyeUGpGT2MQ/0?wx_fmt=png&amp;from=appmsg" data-cropx1="0" data-cropx2="815.6290322580645" data-cropy1="0" data-cropy2="442.72759856630825" data-galleryid="" data-imgfileid="100042229" data-ratio="0.5423312883435583" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/PibBGN3Gt5GWAl5obPcIjzyE1RueUGvCiaB0M1Dk7TFf6ibCGfuMaicSbWtNREvD1VT63zUQz0lCuchZoNKusoWDVg/640?wx_fmt=jpeg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="jpeg" data-w="815" src="https://mmbiz.qpic.cn/mmbiz_jpg/PibBGN3Gt5GWAl5obPcIjzyE1RueUGvCiaB0M1Dk7TFf6ibCGfuMaicSbWtNREvD1VT63zUQz0lCuchZoNKusoWDVg/640?wx_fmt=jpeg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><p data-tool="mdnice编辑器">PAGA运行成功，证明整体安装成功。</p><p data-tool="mdnice编辑器">其他分析后续探索，欢迎关注~</p><p data-tool="mdnice编辑器">参考文章：</p><p data-tool="mdnice编辑器"><span>https://github.com/zhanghao-njmu/SCP</span></p><p data-tool="mdnice编辑器"><span>https://cloud.tencent.com/developer/article/2331034</span></p></section><p><br></p><p><br></p><h3 data-tool="mdnice编辑器"><span>文末友情宣传</span></h3><p data-tool="mdnice编辑器"><strong>强烈建议你推荐给身边的博士后以及年轻生物学PI，多一点数据认知，让他们的科研上一个台阶：</strong></p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247530001&amp;idx=1&amp;sn=676dcf224f9be23b288189775292aeeb&amp;chksm=9b4b36aaac3cbfbc3e3bb0865bd789d5093e3a643f3f345332995f707b7f209ae924e9e9529e&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授课（买‍一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;scene=21#wechat_redirect" data-linktype="2">时隔5年，我们的生信技能树VIP学徒继续招生啦</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;scene=21#wechat_redirect" data-linktype="2">2024的共享服务器交个朋友福利价仍然是800</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;scene=21#wechat_redirect" data-linktype="2">千呼万唤始出来的独享生物信息学云服务器</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528144&amp;idx=1&amp;sn=be4d7e542d1077921024c86a4c130f16&amp;scene=21#wechat_redirect" data-linktype="2">永久免费的生信进阶培训（线下）</a></section></li></ul><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/0P62IGx2bY0Y1jk5N_cHZQ",target="_blank" rel="noopener noreferrer">原文链接</a>
