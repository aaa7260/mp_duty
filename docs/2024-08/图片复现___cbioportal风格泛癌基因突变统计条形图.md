---
title: "图片复现 | cbioportal风格泛癌基因突变统计条形图"
date: 2024-08-22T09:44:54Z
draft: ["false"]
tags: [
  "fetched",
  "被炸熟的虾"
]
categories: ["Acdemic"]
---
图片复现 | cbioportal风格泛癌基因突变统计条形图 by 被炸熟的虾
------
<div><section><span>做泛癌分析时的很多结果大家可以通过在线工具很方便的获取，比如<strong>基因突变类型与突变频率</strong>就可以直接从</span><strong><span>cbioportal</span></strong><span>网站查询到：</span><br></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p><span>https://www.cbioportal.org/</span></p><p><img data-galleryid="" data-imgfileid="100004346" data-ratio="0.5814814814814815" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JxiaZLib73WtpDmfSdUEiaWgBYcJpWlkQL67hCQmPXttv4ENibQf9iag7dfKzlc5QribGnhVvGwiaYNR4iaw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JxiaZLib73WtpDmfSdUEiaWgBYcJpWlkQL67hCQmPXttv4ENibQf9iag7dfKzlc5QribGnhVvGwiaYNR4iaw/640?wx_fmt=png&amp;from=appmsg"></p><p><span>唯一的纠结可能就是在线绘图不是很美观，不方便后期排版。我们以</span><span>SNAI2</span><span>为例，横坐标使用癌症全称过长，图例偏小。</span></p><p><img data-galleryid="" data-imgfileid="100004347" data-ratio="0.7212962962962963" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JxiaZLib73WtpDmfSdUEiaWgBcL5M9CSMhMQmAATIFheZJNRhZ4pI6umadj1ay70ps4TqUgE1z0P0EA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JxiaZLib73WtpDmfSdUEiaWgBcL5M9CSMhMQmAATIFheZJNRhZ4pI6umadj1ay70ps4TqUgE1z0P0EA/640?wx_fmt=png&amp;from=appmsg"></p><p>Comprehensively prognostic and immunological analysis of snail family transcriptional repressor 2 in pan-cancer and identification in pancreatic carcinoma. Front Immunol. 2023 May 11; PMID: 37251370.</p><p><span>这时候我们就可以下载数据手工重绘：</span></p><p><img data-galleryid="" data-imgfileid="100004348" data-ratio="0.5592592592592592" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JxiaZLib73WtpDmfSdUEiaWgB3AIEJp96VQARIAvvmbQYJrfYw1ZOibibYrEpxJib9DmjG5gAO93aBPW7w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JxiaZLib73WtpDmfSdUEiaWgB3AIEJp96VQARIAvvmbQYJrfYw1ZOibibYrEpxJib9DmjG5gAO93aBPW7w/640?wx_fmt=png&amp;from=appmsg"></p><h2><span>Step1：数据整理</span></h2><pre><code>df1 &lt;- read.table(<span>"cancer_types_summary.txt"</span>,header = <span>T</span>,sep = <span>"\t"</span>)<br>head(df1)<br>                                                   <span># Cancer.Study</span><br><span># 1                Uterine Carcinosarcoma (TCGA, PanCancer Atlas)</span><br><span># 2                Uterine Carcinosarcoma (TCGA, PanCancer Atlas)</span><br><span># 3 Head and Neck Squamous Cell Carcinoma (TCGA, PanCancer Atlas)</span><br><span># 4 Head and Neck Squamous Cell Carcinoma (TCGA, PanCancer Atlas)</span><br><span># 5        Liver Hepatocellular Carcinoma (TCGA, PanCancer Atlas)</span><br><span># 6                   Lung Adenocarcinoma (TCGA, PanCancer Atlas)</span><br>  <span># Alteration.Frequency Alteration.Type Alteration.Count</span><br><span># 1            1.7543860          homdel                1</span><br><span># 2           14.0350877             amp                8</span><br><span># 3            5.3537285             amp               28</span><br><span># 4            0.1912046         mutated                1</span><br><span># 5            5.3763441             amp               20</span><br><span># 6            0.1766784          homdel                1</span><br></code></pre><p><span>Cancer.Study</span><span>替换为</span><span>TCGA</span><span>惯用缩写（非常繁琐<img data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Broken.png" data-ratio="1" data-w="128" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Broken.png">）：</span></p><pre><code>df1$Cancer.Study &lt;- factor(df1$Cancer.Study,<br>                           levels = c(<span>"Adrenocortical Carcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Bladder Urothelial Carcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Breast Invasive Carcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Cervical Squamous Cell Carcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Cholangiocarcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Colorectal Adenocarcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Diffuse Large B-Cell Lymphoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Esophageal Adenocarcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Glioblastoma Multiforme (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Head and Neck Squamous Cell Carcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Kidney Chromophobe (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Kidney Renal Clear Cell Carcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Kidney Renal Papillary Cell Carcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Acute Myeloid Leukemia (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Brain Lower Grade Glioma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Liver Hepatocellular Carcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Lung Adenocarcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Lung Squamous Cell Carcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Mesothelioma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Ovarian Serous Cystadenocarcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Pancreatic Adenocarcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Pheochromocytoma and Paraganglioma (TCGA, PanCancer Atlas)"</span>,<br>                                       <span>"Prostate Adenocarcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Sarcoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Skin Cutaneous Melanoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Stomach Adenocarcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Testicular Germ Cell Tumors (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Thyroid Carcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Thymoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Uterine Corpus Endometrial Carcinoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Uterine Carcinosarcoma (TCGA, PanCancer Atlas)"</span>,<br>                                      <span>"Uveal Melanoma (TCGA, PanCancer Atlas)"</span>),<br>                           labels = c(<span>"ACC"</span>,<span>"BLCA"</span>,<span>"BRCA"</span>,<span>"CESC"</span>,<span>"CHOL"</span>,<span>"CRC"</span>,<span>"DLBC"</span>,<span>"ESCA"</span>,<span>"GBM"</span>,<span>"HNSC"</span>,<br>                                      <span>"KICH"</span>,<span>"KIRC"</span>,<span>"KIRP"</span>,<span>"LAML"</span>,<span>"LGG"</span>,<span>"LIHC"</span>,<span>"LUAD"</span>,<span>"LUSC"</span>,<span>"MESO"</span>,<br>                                      <span>"OV"</span>,<span>"PAAD"</span>,<span>"PCPG"</span>,<span>"PRAD"</span>,<span>"SARC"</span>,<span>"SKCM"</span>,<span>"STAD"</span>,<br>                                      <span>"TGCT"</span>,<span>"THCA"</span>,<span>"THYM"</span>,<span>"UCEC"</span>,<span>"UCS"</span>,<span>"UVM"</span>))    <br></code></pre><p><span>检查数据发现没有突变的癌症类型也就没有提供数据，补上（为了通用性全部补一遍</span><span>0</span><span>）：</span></p><pre><code>tmp &lt;- data.frame(Cancer.Study = levels(df1$Cancer.Study),<br>                  Alteration.Frequency = <span>0</span>,<br>                  Alteration.Type = <span>"amp"</span>,<br>                  Alteration.Count = <span>0</span>)<br>df2 &lt;- rbind(df1,tmp)<br>df2$Cancer.Type &lt;- factor(df2$Cancer.Study,levels = levels(df1$Cancer.Study))<br>df2$Alteration.Type &lt;- factor(df2$Alteration.Type,<br>                              levels = c(<span>"mutated"</span>,<span>"amp"</span>,<span>"homdel"</span>,<span>"multiple"</span>),<br>                              labels = c(<span>"Mutation"</span>,<span>"Amplification"</span>,<br>                                         <span>"Deep Deletion"</span>,<span>"Multiple Alteration"</span>))<br></code></pre><h2><span>Step2：堆砌条形图</span></h2><p><span>很久前写的 </span><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247484321&amp;idx=2&amp;sn=20879db019bd2ade432ff1600bb0a6e6&amp;scene=21#wechat_redirect" data-linktype="2"><span>R语言画图 | 堆砌条形图</span></a><span>，过于粗糙，简单来说就是修改</span><span><code><span>position</span></code></span><span>参数：</span></p><p><span>•</span><span><code><span>position = 'stack'</span></code></span><span>：y轴展示原始计数，即作图数据中给定值为多少即展示多少，柱子高度为各样本丰度总和；</span></p><p><span>•</span><span><code><span>position = 'fill'</span></code></span><span>：将作图数据中每个类群的丰度除以其在各样本中的总丰度，展示重新计算的比例，</span><span>y</span><span>轴最大值默认为</span><span>1</span><span>。</span></p><pre><code><span>library</span>(ggplot2)<br>mytheme &lt;- theme_bw() +<br>           theme(axis.text.x = element_text(angle = -<span>40</span>,hjust = <span>0</span>,vjust = <span>1</span>,size = <span>20</span>),<br>                 axis.text.y = element_text(size = <span>20</span>), <br>                 axis.title.x = element_text(size = <span>20</span>), <br>                 axis.title.y = element_text(size = <span>20</span>), <br>                 plot.title = element_text(hjust = <span>0.5</span>,size =  <span>20</span>),<br>                 plot.margin = margin(t = <span>10</span>,  <span># 顶部边缘距离</span><br>                                      r = <span>40</span>,  <span># 右边边缘距离</span><br>                                      b = <span>10</span>,  <span># 底部边缘距离</span><br>                                      l = <span>10</span>), <span># 左边边缘距离</span><br>                 legend.key = element_rect(fill = <span>'transparent'</span>), <br>                 legend.background = element_rect(fill = <span>'transparent'</span>), <br>                 legend.position = c(<span>0.6</span>,<span>0.9</span>),<br>                 legend.title = element_blank(),<br>                 legend.text = element_text(size = <span>20</span>))<br>range(df2$Alteration.Frequency)<br>p &lt;- ggplot(df2, aes(x = Cancer.Type,y = Alteration.Frequency, fill = Alteration.Type)) +<br>     geom_col(position = <span>'stack'</span>, width = <span>0.6</span>) +<br>     scale_y_continuous(expand = c(<span>0</span>,<span>0</span>),limits = c(<span>0</span>,<span>18</span>), <br>                     breaks = seq(<span>0</span>,<span>18</span>,<span>3</span>),labels = seq(<span>0</span>,<span>18</span>,<span>3</span>)) +<br>     scale_fill_manual(values = c(<span>"#459943"</span>,<span>"#db6968"</span>,<span>"#4d97cd"</span>,<span>"#606f8a"</span>))+<br>     labs(title = <span>NULL</span>, x = <span>NULL</span>, y = <span>"Alteration Frequency"</span>) +<br>     mytheme + guides(fill = guide_legend(nrow = <span>1</span>, byrow = <span>TRUE</span>)) <span>#调整图例为1行</span><br></code></pre><p><img data-galleryid="" data-imgfileid="100004350" data-ratio="0.32037037037037036" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JxiaZLib73WtpDmfSdUEiaWgBnEib5vkFic0tbb5VoBvybUe42ZZ6P3zePpHmYFId9DWBpu14DdhkoLiaA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JxiaZLib73WtpDmfSdUEiaWgBnEib5vkFic0tbb5VoBvybUe42ZZ6P3zePpHmYFId9DWBpu14DdhkoLiaA/640?wx_fmt=png&amp;from=appmsg"></p><p><span>如</span><span>cbioportal</span><span>数据库中所示，更多的时候大家还是习惯于按照突变频率降序排列。很方便的是下载的统计数据已经按照频率完成了排序，我们只需要添上几个零突变癌症就可以了</span></p><pre><code>df3 &lt;- df2<br>df3$Cancer.Type &lt;- factor(df3$Cancer.Type,<br>                          levels = c(as.character(unique(df1$Cancer.Study)),<br>                   c(<span>"ACC"</span>,<span>"CHOL"</span>,<span>"KICH"</span>,<span>"THYM"</span>,<span>"UVM"</span>)))<br></code></pre><p><span>画图的代码还是一模一样的</span></p><p><img data-galleryid="" data-imgfileid="100004349" data-ratio="0.32037037037037036" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JxiaZLib73WtpDmfSdUEiaWgB6XNfNTyB7BUmqXgIkCd7J2JtIULpRzkDibPpGZBEnqyxIuSzcOdBwMg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JxiaZLib73WtpDmfSdUEiaWgB6XNfNTyB7BUmqXgIkCd7J2JtIULpRzkDibPpGZBEnqyxIuSzcOdBwMg/640?wx_fmt=png&amp;from=appmsg"></p><p><span>至于下面的加号行拼图添加也很快捷，就像之前用ggplot2拼图绘制森林图一样：</span><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247485128&amp;idx=1&amp;sn=47fa55bb56f418b230c1c86381b7aa73&amp;scene=21#wechat_redirect" data-linktype="2"><span>R语言画图 | 森林图 单基因泛癌Cox回归分析</span></a></p></section><section><img data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="341" src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section data-tools="135编辑器" data-id="116886" draggable="true"><section><section><section><section><strong data-brushtype="text">被炸熟的虾</strong></section></section></section><section><section><section data-width="35%"><section><img data-cropselx1="0" data-cropselx2="115" data-cropsely1="0" data-cropsely2="115" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="jpeg" data-w="258" data-width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section><section data-width="63%"><section><section><strong>自己的摸索，发现问题麻烦告诉作者，光速回来改正</strong><strong><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="64" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></strong></section></section></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/LWUM-4AsfM_wnHujWAt6EQ",target="_blank" rel="noopener noreferrer">原文链接</a>
