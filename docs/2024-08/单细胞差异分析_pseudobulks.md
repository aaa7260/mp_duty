---
title: "单细胞差异分析：pseudobulks"
date: 2024-08-01T12:41:21Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
单细胞差异分析：pseudobulks by 生信菜鸟团
------
<div><blockquote data-tool="mdnice编辑器"><p><span>从我们</span><span>生信技能树</span><span>历年的几千个马拉松授课学员里面募集了一些优秀的创作者，某种意义来说是传承了我们生信技能树的知识整理和分享的思想！</span></p></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">今天的是学员一点一滴整理的授课知识点笔记哦，还有互动练习题哈，欢迎大家点击文末的阅读原文去关注我们学员的公众号哦！</p><p><br></p><p><span></span><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><img data-croporisrc="https://mmbiz.qlogo.cn/mmbiz_png/PibBGN3Gt5GXoDFFpXWPudEIfEU8ZQ56uZUXOtKogWibGPn5ExbrTy0FDm4Thezk7w0JXgEN71QTdNL93EjCP90w/0?wx_fmt=png" data-cropx1="0" data-cropx2="1080" data-cropy1="29.032258064516128" data-cropy2="540" data-imgfileid="100042183" data-ratio="0.47314814814814815" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/PibBGN3Gt5GXoDFFpXWPudEIfEU8ZQ56uhIE8wwic6En6icjdVrrbkoEwRZDRJp6Fb6l8IuRLHeHmlG3gaMRxNicbw/640?wx_fmt=jpeg&amp;wxfrom=13&amp;tp=wxpic" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/PibBGN3Gt5GXoDFFpXWPudEIfEU8ZQ56uhIE8wwic6En6icjdVrrbkoEwRZDRJp6Fb6l8IuRLHeHmlG3gaMRxNicbw/640?wx_fmt=jpeg&amp;wxfrom=13&amp;tp=wxpic"></p><p data-tool="mdnice编辑器">差异分析是高通量数据必不可少的分析步骤，<span><strong>在单细胞数据中大家常用的往往是FindAllmarkers()和FindMarkers()两个函数，这两个函数都是单个细胞间进行比较，pseudobulks则是将细胞进行整合后进行样本间或分组间比较，可以减少假阳性且更有生物学意义。</strong></span>下面我们来看一下如何实现该分析。</p><p data-tool="mdnice编辑器"><span>加载及</span><span>整合数据，下面是不同单细胞亚群内部的全部的细胞直接表达量加和，自己写了一个函数：</span><br></p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/XCopLcwfzefB8gj7MQANDvZDMapfAwW8JT2odenLXAhsVs2ic8hPRLRaOOibVlVnibEeuHTBicJg4kptTePKpxMXRPicjicSk2V8mx/640?wx_fmt=svg" data-fail="0"></span><code>rm(list = ls())<br>library(Seurat)<br>library(tidyverse)<br>library(dplyr)<br>library(reshape2)<br>library(S4Vectors)<br>library(tibble)<br>library(SingleCellExperiment)<br>library(DESeq2)<br>library(ggplot2)<br>library(cowplot)<br>library(ggrepel)<br>#数据整合<br>sce &lt;- readRDS("sce_anno.RDS")<br>table(sce$Group)<br>bs = split(colnames(sce),sce$sample)<br>ct = do.call(<br>  cbind,lapply(names(bs), function(x){ <br>    # x=names(bs)[[1]]<br>    kp =colnames(sce) %in% bs[[x]]<br>    rowSums( as.matrix(sce@assays$RNA@counts[, kp]  ))<br>  })<br>)<br>colnames(ct) &lt;- names(bs)<br>head(ct)<br>phe = unique(sce@meta.data[,c('sample','Group')]#样本信息，分组信息，根据自己的metadata进行修改<br>phe<br>group_list = phe[match(names(bs),phe$sample),'Group']<br>table(group_list)   <br>exprSet = ct<br>dim(exprSet)<br>exprSet=exprSet[apply(exprSet,1, function(x) sum(x&gt;1) &gt; 1),]<br>dim(exprSet)  <br>table(group_list)<br><br><br></code></pre><p data-tool="mdnice编辑器">开始进行差异分析</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/XCopLcwfzefB8gj7MQANDvZDMapfAwW8JT2odenLXAhsVs2ic8hPRLRaOOibVlVnibEeuHTBicJg4kptTePKpxMXRPicjicSk2V8mx/640?wx_fmt=svg" data-fail="0"></span><code>#第一步构建DEseq对象<br>colData &lt;- data.frame(row.names=colnames(exprSet),group_list=group_list)<br>dds &lt;- DESeqDataSetFromMatrix(countData = exprSet,<br>                              colData = colData,<br>                              design = ~ group_list)<br># 第二步，进行差异表达分析<br>dds2 &lt;- DESeq(dds)<br>table(group_list)<br>tmp &lt;- results(dds2,contrast=c("group_list","AC","PA"))<br>DEG_DESeq2 &lt;- as.data.frame(tmp[order(tmp$padj),])<br>head(DEG_DESeq2)<br>DEG_DESeq2 = na.omit(DEG_DESeq2)<br>head(DEG_DESeq2)<br>#添加上下调信息<br>DEG_DESeq2 &lt;- DEG_DESeq2 %&gt;%<br>  mutate(Type = if_else(padj &gt; 0.05, <br>                        "ns",<br>                        if_else(abs(log2FoldChange) &lt; 1, "ns",<br>                                if_else(log2FoldChange &gt;= 1, "up", "down")))) %&gt;%<br>  arrange(desc(abs(log2FoldChange))) %&gt;% rownames_to_column("Gene_Symbol")<br></code></pre><p data-tool="mdnice编辑器">画个火山图结束</p><pre data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/XCopLcwfzefB8gj7MQANDvZDMapfAwW8JT2odenLXAhsVs2ic8hPRLRaOOibVlVnibEeuHTBicJg4kptTePKpxMXRPicjicSk2V8mx/640?wx_fmt=svg" data-fail="0"></span><code>ggplot(DEG_DESeq2, aes(log2FoldChange,<br>                       -log10(padj))) +<br>  geom_point(size = 3.5, <br>             alpha = 0.8,<br>             aes(color = Type),<br>             show.legend = T)  +<br>  scale_color_manual(values = c("#00468B", "gray", "#E64B35")) +<br>  ylim(0, 15) +<br>  xlim(-10, 10) +<br>  labs(x = "Log2(fold change)", y = "-log10(padj)") +<br>  geom_hline(yintercept = -log10(0.05),  <br>             linetype = 2,<br>             color = 'black',lwd=0.8) + <br>  geom_vline(xintercept = c(-1, 1), <br>             linetype = 2, <br>             color = 'black',lwd=0.8)+theme_bw()+<br>  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())<br>ggsave("volcano.pdf")<br><br></code></pre></section><p><img data-galleryid="" data-imgfileid="100042184" data-ratio="0.7523939808481532" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GXoDFFpXWPudEIfEU8ZQ56uGibdicicETQfeRXhGTlF6rVx5qc4yg4j9GVA3XENgqgboHibdjAKYUiamag/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="731" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GXoDFFpXWPudEIfEU8ZQ56uGibdicicETQfeRXhGTlF6rVx5qc4yg4j9GVA3XENgqgboHibdjAKYUiamag/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><p>参考文章：单细胞层面的表达量差异分析到底如何做 - 知乎 (zhihu.com)</p><p><br></p><p><br></p><h3 data-tool="mdnice编辑器"><span>文末友情宣传</span></h3><p data-tool="mdnice编辑器"><strong>强烈建议你推荐给身边的博士后以及年轻生物学PI，多一点数据认知，让他们的科研上一个台阶：</strong></p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247530001&amp;idx=1&amp;sn=676dcf224f9be23b288189775292aeeb&amp;chksm=9b4b36aaac3cbfbc3e3bb0865bd789d5093e3a643f3f345332995f707b7f209ae924e9e9529e&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授课（买‍一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;scene=21#wechat_redirect" data-linktype="2">时隔5年，我们的生信技能树VIP学徒继续招生啦</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;scene=21#wechat_redirect" data-linktype="2">2024的共享服务器交个朋友福利价仍然是800</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;scene=21#wechat_redirect" data-linktype="2">千呼万唤始出来的独享生物信息学云服务器</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528144&amp;idx=1&amp;sn=be4d7e542d1077921024c86a4c130f16&amp;scene=21#wechat_redirect" data-linktype="2">永久免费的生信进阶培训（线下）</a></section></li></ul><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/H--2mmyf5UZ_bxw88A2VPA",target="_blank" rel="noopener noreferrer">原文链接</a>
