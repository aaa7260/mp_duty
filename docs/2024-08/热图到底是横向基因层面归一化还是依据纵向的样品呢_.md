---
title: "热图到底是横向基因层面归一化还是依据纵向的样品呢？"
date: 2024-08-06T05:29:36Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
热图到底是横向基因层面归一化还是依据纵向的样品呢？ by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>看到了一个2022的文章，标题是：《Bromodomain Inhibitors Modulate FcgR-Mediated Mononuclear Phagocyte Activation and Chemotaxis》。这个研究里面的转录组数据是通过RNA测序（RNA-seq）技术获得的，这些数据来自两个不同的细胞类型：树突细胞（Dendritic Cells, DCs）和巨噬细胞（Macrophages），以及它们在不同实验条件下的反应。</p></blockquote><p data-tool="mdnice编辑器">不同的细胞类型就是不同的数据集，每个数据集内部都是4个分组：</p><ul data-tool="mdnice编辑器"><li><section><strong>IC（Immune Complexes）刺激</strong>：树突细胞被免疫复合物刺激，这是模拟体内免疫反应的一种实验条件。</section></li><li><section><strong>Ova（Ovalbumin）刺激</strong>：树突细胞被卵清蛋白刺激，这是一种常用的模型抗原，用于研究免疫细胞的激活。</section></li><li><section><strong>DMSO对照组</strong>：细胞未接受任何处理，DMSO是iBET药物的溶剂，这里作为阴性对照。</section></li><li><section><strong>iBET处理组</strong>：细胞被BET蛋白抑制剂iBET处理，用于研究iBET对树突细胞转录组的影响。</section></li></ul><p data-tool="mdnice编辑器">在（Gene Expression Omnibus, GEO）中，可以通过提供的访问号码GSE200033和GSE200226获取这两个数据集的表达量矩阵。</p><p data-tool="mdnice编辑器">我们很容易读取<strong>树突细胞（BMDCs）</strong>的表达量矩阵，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<span>#清空当前的工作环境</span><br>options(stringsAsFactors = <span>F</span>)<span>#不以因子变量读取</span><br>options(scipen = <span>20</span>)<span>#不以科学计数法显示</span><br><span>library</span>(data.table) <br>data&lt;-data.table::fread(<span>"GSE200226_CountTable_BMDC.csv.gz"</span>,<br>                        header = <span>T</span>,<br>                        data.table = <span>F</span>) <br>data=data[!duplicated(data$V1),]<br>mat&lt;-floor(data[,c( <span>2</span>:ncol(data))])<br>rownames(mat)= data[,<span>1</span>] <br>keep_feature &lt;- rowSums (mat &gt; <span>1</span>) &gt; <span>1</span> <br>symbol_matrix &lt;- mat[keep_feature, ]  <br>rownames(symbol_matrix)=rownames(mat)[keep_feature] <br>dat=log(edgeR::cpm(symbol_matrix)+<span>1</span>)<br></code></pre><p data-tool="mdnice编辑器">然后简单的根据这个表达量矩阵的基因的SD值排序后挑选里面的排名靠前的1000个基因后绘制如下所示的热图：</p><p><img data-galleryid="" data-imgfileid="100048586" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxVvPzArpggic3VKuAtOmY1KmZUicsQ28rOMByeHFGImn72icODicibDvjtAZttickMIhXKXosjPmJKW44w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxVvPzArpggic3VKuAtOmY1KmZUicsQ28rOMByeHFGImn72icODicibDvjtAZttickMIhXKXosjPmJKW44w/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>SD值排序后挑选里面的排名靠前的1000个基因</figcaption></figure><p data-tool="mdnice编辑器">很明显的可以看到这个表达量矩阵里面BET蛋白抑制剂iBET处理造成的表达量变化是最大的，然后是卵清蛋白刺激和IC的稍微小一点的差异，然后每个组里面的5个重复其实也略微有一点点分组，可能是先做了3个重复然后补了2个样品。</p><p data-tool="mdnice编辑器">上面的热图代码是：</p><pre data-tool="mdnice编辑器"><span></span><code>dat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>] <br>cg=names(tail(sort(apply(dat,<span>1</span>,sd)),<span>1000</span>))<span>#apply按行（'1'是按行取，'2'是按列取）取每一行的方差，从小到大排序，取最大的1000个</span><br><span>library</span>(pheatmap)<br>pheatmap(dat[cg,],show_colnames =<span>F</span>,show_rownames = <span>F</span>) <span>#对那些提取出来的1000个基因所在的每一行取出，组合起来为一个新的表达矩阵</span><br>n=t(scale(t(dat[cg,]))) <span># 'scale'可以对log-ratio数值进行归一化</span><br>n[n&gt;<span>2</span>]=<span>2</span> <br>n[n&lt; -<span>2</span>]= -<span>2</span><br>n[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>pheatmap(n,show_colnames =<span>F</span>,show_rownames = <span>F</span>)<br>ac=data.frame(group=group_list)<br>rownames(ac)=colnames(n)<br>pheatmap(n,show_colnames =<span>F</span>,show_rownames = <span>F</span>,<br>         annotation_col=ac)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>我们该如何判断这个矩阵确实是来自于树突细胞呢</span><span></span></h3><p data-tool="mdnice编辑器">前面我们提到了不同的细胞类型：树突细胞（Dendritic Cells, DCs）和巨噬细胞（Macrophages），是不同的数据集，有不同的表达量矩阵文件。但是我们如何相信作者给出来的文件是否准确无误呢？</p><p data-tool="mdnice编辑器">其实很简单，需要靠生物学背景，比如任意单细胞转录组数据集里面都可以看到不同细胞亚群的特异性基因，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>SCP1661_meyloids_markers_list =list(<br>  macrophages=c(<span>'Adgre1'</span>, <span>'Cd14'</span>,  <span>'Fcgr3'</span>),<br>  cDCs=c(<span>'Xcr1'</span>, <span>'Flt3'</span>,  <span>'Ccr7'</span>),<br>  pDCs=c(<span>'Siglech'</span>, <span>'Clec10a'</span>,  <span>'Clec12a'</span>)  ,<br>  monocytes=c(<span>'Ly6c2'</span> , <span>'Spn'</span>),<br>  neutrophils=c(<span>'Csf3r'</span>, <span>'S100a8'</span>,  <span>'Cxcl3'</span>) <br>) <br>df = data.frame(<br>  celltype=rep(names(SCP1661_meyloids_markers_list),<br>               times=unlist(lapply(SCP1661_meyloids_markers_list, length))),<br>  gene=unlist(SCP1661_meyloids_markers_list)<br>) <br><span>library</span>(stringr) <br>df=df[df$gene %<span>in</span>% rownames(dat),]<br>cg=df$gene<br></code></pre><p data-tool="mdnice编辑器">这个时候，首先查看树突细胞数据集里面的各个髓系免疫细胞单细胞亚群的特异性基因的热图，这个时候我们不会选择横向基因层面归一化，而是直接可视化log的CPM值，如下所示 ：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(pheatmap)<br><span>#tmp=dat[cg,]</span><br>n=t(scale(t(dat[cg,]))) <span># 'scale'可以对log-ratio数值进行归一化</span><br>n[n&gt;<span>2</span>]=<span>2</span> <br>n[n&lt; -<span>2</span>]= -<span>2</span><br>n[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>pheatmap(n,show_colnames =<span>F</span>,show_rownames = <span>F</span>)<br>ac=data.frame(group=group_list)<br>ar=data.frame(gene=df$celltype)<br>rownames(ac)=colnames(n)<br>rownames(ar)=rownames(n) <br>pheatmap(tmp,show_colnames =<span>F</span>,show_rownames = <span>T</span>, <br>         display_numbers = <span>T</span>,<br>         annotation_row =ar,<br>         annotation_col=ac)  <br></code></pre><p data-tool="mdnice编辑器">如下所示的效果：</p><p><img data-galleryid="" data-imgfileid="100048585" data-ratio="0.8953703703703704" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxVvPzArpggic3VKuAtOmY1KNg0rJBNg5b4hQ5O9tOgtLAGptpxgaib0hXEPy7hmiae95AMJqUHorjGQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxVvPzArpggic3VKuAtOmY1KNg0rJBNg5b4hQ5O9tOgtLAGptpxgaib0hXEPy7hmiae95AMJqUHorjGQ/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">那么，为什么这个时候我们不会选择横向基因层面归一化呢，<strong>因为我想看的巨噬细胞和树突细胞特异性基因是否在每个数据集内部高表达，而不是在数据集内部对比那4个分组的表达量差异。</strong></p><p data-tool="mdnice编辑器">可以看到，<span><strong>在树突细胞数据集里面的Clec10a基因确实是表达量很高，这个基因在巨噬细胞数据集里面是表达量略低的。</strong></span></p><h3 data-tool="mdnice编辑器"><span></span><span>学徒作业</span><span></span></h3><p data-tool="mdnice编辑器">正常情况下，<strong>应该是把上面的这两个矩阵合并后可视化，这个时候就可以继续横向基因层面归一化，可以看到具体的每个基因在两个数据集的差异来区分巨噬细胞和树突细胞数据集。</strong></p><p data-tool="mdnice编辑器">那，<span><strong>什么时候需要依据纵向的样品进行归一化呢？</strong></span>反正我基本上没有遇到过这样的需求，上面的热图就是没有选择横向基因层面归一化，而是直接可视化log的CPM值，其实也可以做依据纵向的样品的归一化，<strong>但是因为巨噬细胞和树突细胞特异性基因并不多，而且表达量差异悬殊，是<span>依据纵向的样品的</span>否归一化就不那么重要了。</strong></p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span>写在文末</span></h3></section><p>如果你也想做单细胞转录组数据分析，<span>最好是有自己的计算机资源哦，比如我们的</span><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;scene=21#wechat_redirect" data-linktype="2">2024的共享服务器交个朋友福利价仍然是800</a><span>，而且还需要有基本的生物信息学基础，也可以看看我们的</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247531929&amp;idx=1&amp;sn=f6f16b7bf6b907360d6d0052e3d10cf6&amp;chksm=9b4b3d22ac3cb434b6aa7753a4cf0f266578147ccf10b49cc834e46af578ee6de99be0accb30&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉‍松授课（买一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a><span> ，你的生物信息学入门课。</span></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/-tjgygmjImddPbRYr1q4Qw",target="_blank" rel="noopener noreferrer">原文链接</a>
