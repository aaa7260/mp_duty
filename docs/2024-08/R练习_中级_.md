---
title: "R练习：中级②"
date: 2024-08-22T10:42:19Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
R练习：中级② by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h1 data-tool="mdnice编辑器"><span></span></h1><blockquote data-type="2" data-url="" data-author-name="" data-content-utf8-length="56" data-source-title=""><section><p>学习笔记引用自生信菜鸟团练习题</p><p>http://www.bio-info-trainee.com/3750.html</p></section></blockquote><h1 data-tool="mdnice编辑器">作业六</h1><h3 data-tool="mdnice编辑器"><span></span>1.题目<span></span></h3><p data-tool="mdnice编辑器">下载数据集GSE17215的表达矩阵并且提取下面的基因画热图</p><pre data-tool="mdnice编辑器"><span></span><code>ACTR3B ANLN BAG1 BCL2 BIRC5 BLVRA CCNB1 CCNE1 CDC20 CDC6 CDCA1 CDH3 CENPF CEP55 CXXC5 EGFR ERBB2 ESR1 EXO1 FGFR4 FOXA1 FOXC1 GPR160 GRB7 KIF2C KNTC2 KRT14 KRT17 KRT5 MAPT MDM2 MELK MIA MKI67 MLPH MMP11 MYBL2 MYC NAT1 ORC6L PGR PHGDH PTTG1 RRM2 SFRP1 SLC39A6 TMEM45B TYMS UBE2C UBE2T<br></code></pre><h3 data-tool="mdnice编辑器"><span></span>2.思路<span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<span>#打破下载时间的限制,改前60秒，改后10w秒</span><br>options(timeout = 100000) <br>options(scipen = 20)<span>#不要以科学计数法表示</span><br><br>library(GEOquery)<br>eSet = getGEO(<span>"GSE17215"</span>, destdir = <span>'.'</span>, getGPL = F)<br><br>class(eSet)<br>length(eSet)<br>eSet = eSet[[1]] <br>class(eSet)<br><br>exp &lt;- exprs(eSet)<br>dim(exp)<br>range(exp)<br>exp = log2(exp+1)<br>range(exp)<br><br>gpl_number &lt;- eSet@annotation;gpl_number<br>library(tinyarray)<br>find_anno(gpl_number) <span>#打出找注释的代码</span><br>library(hthgu133a.db)<br>ids &lt;- toTable(hthgu133aSYMBOL)<br><br><span>#获取目标基因及对应的表达矩阵</span><br>dfexp &lt;- data.frame(exp)<br>dfexp<span>$probe_id</span> &lt;- rownames(dfexp)<br>head(dfexp)<br>total &lt;- merge(dfexp,ids,by=<span>"probe_id"</span>)<br>target_gene &lt;- (<span>"ACTR3B ANLN BAG1 BCL2 BIRC5 BLVRA CCNB1 CCNE1 CDC20 CDC6 CDCA1 CDH3 CENPF CEP55 CXXC5 EGFR ERBB2 ESR1 EXO1 FGFR4 FOXA1 FOXC1 GPR160 GRB7 KIF2C KNTC2 KRT14 KRT17 KRT5 MAPT MDM2 MELK MIA MKI67 MLPH MMP11 MYBL2 MYC NAT1 ORC6L PGR PHGDH PTTG1 RRM2 SFRP1 SLC39A6 TMEM45B TYMS UBE2C UBE2T"</span>)<br>tg &lt;- strsplit(target_gene, split = <span>" "</span>) ;<br>tg &lt;- tg[[1]]<br>choice_rows &lt;- total[total<span>$symbol</span> %<span>in</span>% tg,];choice_rows<br><br>exp1 &lt;- as.matrix(choice_rows[,- c(1,8)])<br>library(pheatmap)<br>pheatmap::pheatmap(exp1,scale = <span>'row'</span>)<br></code></pre><h1 data-tool="mdnice编辑器"><span></span>作业七</h1><h3 data-tool="mdnice编辑器"><span></span>1.题目<span></span></h3><p data-tool="mdnice编辑器">下载数据集GSE24673的表达矩阵计算样本的相关性并且绘制热图，需要标记上样本分组信息</p><h3 data-tool="mdnice编辑器"><span></span>2.思路<span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<span>#打破下载时间的限制,改前60秒，改后10w秒</span><br>options(timeout = 100000) <br>options(scipen = 20)<span>#不要以科学计数法表示</span><br><br>library(GEOquery)<br>eSet = getGEO(<span>"GSE24673"</span>, destdir = <span>'.'</span>, getGPL = F)<br><br>class(eSet)<br>length(eSet)<br>eSet = eSet[[1]] <br>class(eSet)<br><br>exp &lt;- exprs(eSet)<br>dim(exp)<br>range(exp)<br><br><span>#提取临床信息</span><br>pd &lt;- pData(eSet)<br><br><span>#让exp列名与pd的行名顺序完全一致</span><br>p = identical(rownames(pd),colnames(exp));p<br><span>if</span>(!p) {<br>  s = intersect(rownames(pd),colnames(exp))<br>  exp = exp[,s]<br>  pd = pd[s,]<br>}<br><br><span>#分组</span><br>library(stringr)<br><span>#k = str_detect(pd$title,"Healthy");table(k)</span><br><span>#Group = ifelse(k,"Healthy","RB")</span><br>Group=c(<span>'rbc'</span>,<span>'rbc'</span>,<span>'rbc'</span>,<br>        <span>'rbn'</span>,<span>'rbn'</span>,<span>'rbn'</span>,<br>        <span>'rbc'</span>,<span>'rbc'</span>,<span>'rbc'</span>,<br>        <span>'normal'</span>,<span>'normal'</span>)<br><br>M=cor(exp)<br>tmp=data.frame(G=Group)<br>rownames(tmp)=colnames(M)<br>pheatmap::pheatmap(M,annotation_col = tmp)<br></code></pre><h1 data-tool="mdnice编辑器"><span></span>作业八</h1><h3 data-tool="mdnice编辑器"><span></span>1.题目<span></span></h3><p data-tool="mdnice编辑器">找到 GPL6244 platform of Affymetrix Human Gene 1.0 ST Array 对应的R的bioconductor注释包，并且安装它</p><h3 data-tool="mdnice编辑器"><span></span>2.思路<span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>options()<span>$repos</span><span>#显示当前R会话中的软件包下载镜像（repositories）设置</span><br>options()<span>$BioC_mirror</span> <span>#显示当前Bioconductor镜像设置</span><br><br>options(<span>"repos"</span> = c(CRAN=<span>"https://mirrors.tuna.tsinghua.edu.cn/CRAN/"</span>))<span>#设置CRAN的镜像源</span><br>options(BioC_mirror=<span>"https://mirrors.ustc.edu.cn/bioc/"</span>)<span>#设置Bioconductor的镜像源</span><br><br>library(tinyarray)<br>find_anno(<span>"GPL6244"</span>)<br></code></pre><p data-tool="mdnice编辑器">另辟蹊径，找到要下载的R包<img data-ratio="0.06255835667600373" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/A8HZFc8vBSXjDRQIELGqf1QmIuUFnTicmUVCiaFIaWu9OlYjafa3o9LbqSEA6mGMGIZ9A1LicIfic3Wnot9BBL0hog/640?wx_fmt=png" data-type="png" data-w="1071" src="https://mmbiz.qpic.cn/sz_mmbiz_png/A8HZFc8vBSXjDRQIELGqf1QmIuUFnTicmUVCiaFIaWu9OlYjafa3o9LbqSEA6mGMGIZ9A1LicIfic3Wnot9BBL0hog/640?wx_fmt=png"></p><pre data-tool="mdnice编辑器"><span></span><code>BiocManager::install(<span>"hugene10sttranscriptcluster.db"</span>,<span>#使用 BiocManager 包来安装指定的R包</span><br>                     ask = F,<span>#不要求用户确认安装</span><br>                     update = F<span>#不要更新已安装的包</span><br>                     )<br>library(hugene10sttranscriptcluster.db)<br>options()<span>$repos</span><br>options()<span>$BioC_mirror</span><br></code></pre><h1 data-tool="mdnice编辑器"><span></span>作业九</h1><h3 data-tool="mdnice编辑器"><span></span>1.题目<span></span></h3><p data-tool="mdnice编辑器">下载数据集GSE42872的表达矩阵，并且分别挑选出所有样本的(平均表达量/sd/mad/)最大的探针，并且找到它们对应的基因</p><h3 data-tool="mdnice编辑器"><span></span>2.思路<span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<span>#打破下载时间的限制,改前60秒，改后10w秒</span><br>options(timeout = 100000) <br>options(scipen = 20)<span>#不要以科学计数法表示</span><br><br>library(GEOquery)<br>eSet = getGEO(<span>"GSE42872"</span>, destdir = <span>'.'</span>, getGPL = F)<br><br>class(eSet)<br>length(eSet)<br>eSet = eSet[[1]] <br>class(eSet)<br><br>exp &lt;- exprs(eSet)<br>dim(exp)<br>range(exp)<br><span>#exp = log2(exp+1)</span><br><span>#range(exp)</span><br><br>gpl_number &lt;- eSet@annotation;gpl_number<br>library(tinyarray)<br>find_anno(gpl_number) <span>#打出找注释的代码</span><br>library(hugene10sttranscriptcluster.db)<br>ids &lt;- toTable(hugene10sttranscriptclusterSYMBOL)<br><br><span>#获取目标基因及对应的表达矩阵</span><br>dfexp &lt;- data.frame(exp)<br>dfexp<span>$probe_id</span> &lt;- rownames(dfexp)<br>head(dfexp)<br>total &lt;- merge(dfexp,ids,by=<span>"probe_id"</span>)<br>head(total)<br><br><span># (平均表达量/sd/mad/)最大的探针</span><br>mean &lt;- sort(apply(exp,1,mean),decreasing = T)[1]<br>sd &lt;- sort(apply(exp,1,sd),decreasing = T)[1]<br>mad &lt;- sort(apply(exp,1,mad),decreasing = T)[1]<br><span># apply(dat,1,mean)的1表示按行应用，即计算每一行的平均值。如果是2，则表示按列应</span><br><br>cat(total<span>$symbol</span>[mean])<br>cat(total<span>$symbol</span>[sd])<br>cat(total<span>$symbol</span>[mad])<br></code></pre><h1 data-tool="mdnice编辑器"><span></span>作业十</h1><h3 data-tool="mdnice编辑器"><span></span>1.题目<span></span></h3><p data-tool="mdnice编辑器">下载数据集GSE42872的表达矩阵，并且根据分组使用limma做差异分析，得到差异结果矩阵</p><h3 data-tool="mdnice编辑器"><span></span>2.思路<span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<span>#打破下载时间的限制,改前60秒，改后10w秒</span><br>options(timeout = 100000) <br>options(scipen = 20)<span>#不要以科学计数法表示</span><br><br><span>#(1)下载文件</span><br>library(GEOquery)<br>eSet = getGEO(<span>"GSE42872"</span>, destdir = <span>'.'</span>, getGPL = F)<br><br><span>#(2)观察数据</span><br>class(eSet)<br>length(eSet)<br>eSet = eSet[[1]] <br>class(eSet)<br><br><span>#(3)提取表达矩阵</span><br>exp &lt;- exprs(eSet)<br>dim(exp)<br>range(exp)<br><br><span>#(4)获取探针注释</span><br>gpl_number &lt;- eSet@annotation;gpl_number<br>library(tinyarray)<br>find_anno(gpl_number) <span>#打出找注释的代码</span><br>library(hugene10sttranscriptcluster.db)<br>ids &lt;- toTable(hugene10sttranscriptclusterSYMBOL)<br><br><span>#(5)提取临床信息</span><br>pd=pData(eSet)<br><br><span>#(6)分组</span><br>library(stringr)<br>k = str_detect(pd<span>$title</span>,<span>"Control"</span>);table(k)<br>Group = ifelse(k,<span>"Control"</span>,<span>"Vemurafenib"</span>)<br><br><span>#(7)差异分析</span><br>library(limma)<br>design = model.matrix(~Group)<br>fit = lmFit(exp,design)<br>fit = eBayes(fit)<br>deg = topTable(fit,coef = 2,number = Inf)<br><br><span>#为deg数据框添加几列</span><br><span>#1.加probe_id列，把行名变成一列</span><br>library(dplyr)<br>deg = mutate(deg,probe_id = rownames(deg))<br><span>#2.加上探针注释</span><br>ids = distinct(ids,symbol,.keep_all = T)<br><span>#其他去重方式在zz.去重方式.R</span><br>deg = inner_join(deg,ids,by=<span>"probe_id"</span>)<br>nrow(deg)<br><span>#3.加change列,标记上下调基因</span><br>logFC_t = 1<br>p_t = 0.05<br>k1 = (deg<span>$P</span>.Value &lt; p_t)&amp;(deg<span>$logFC</span> &lt; -logFC_t)<br>k2 = (deg<span>$P</span>.Value &lt; p_t)&amp;(deg<span>$logFC</span> &gt; logFC_t)<br>deg = mutate(deg,change = ifelse(k1,<span>"down"</span>,ifelse(k2,<span>"up"</span>,<span>"stable"</span>)))<br>table(deg<span>$change</span>)<br></code></pre></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/qu-7bssDqAe9z--fpl6ZaQ",target="_blank" rel="noopener noreferrer">原文链接</a>
