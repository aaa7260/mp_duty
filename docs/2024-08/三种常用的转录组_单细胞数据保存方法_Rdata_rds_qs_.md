---
title: "三种常用的转录组/单细胞数据保存方法(Rdata,rds,qs)"
date: 2024-08-05T02:48:43Z
draft: ["false"]
tags: [
  "fetched",
  "生信方舟"
]
categories: ["Acdemic"]
---
三种常用的转录组/单细胞数据保存方法(Rdata,rds,qs) by 生信方舟
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">目前有三种常用的转录组/单细胞数据保存方法，分别为Rdata，rds和qs。</p><p data-tool="mdnice编辑器">在分析数据的时候最常规的保存方法是Rdata，这种方法可以把我们想保存的信息全部糅杂在一起变成同一个文件，在下次加载的时候一并加载出来就可以了，是初学者必学的保存数据类型。</p><p data-tool="mdnice编辑器">但Rdata文件不能很个性化的修改名称，这时候如果不小心出现重名文件就会把上一次的文件给覆盖掉。因此选择rds格式的保存方式可以个性化的进行保存和读取文件，不用担心覆盖的情况，并且保存和读取速度也可能会(<strong>实际不一定!</strong>)比Rdata会快一些。</p><p data-tool="mdnice编辑器">但进入单细胞分析时代之后，数据大小动不动就超过了20GB，上述两种方式读取和保存文件的时间变得非常的长，而且一套分析下来有可能占用存储空间会超过200GB。此时使用rdata或者rds格式的保存方式就会出现十分“心累”的情况。</p><p data-tool="mdnice编辑器">那么在这个大数据分析的时代下，有没有更加适合的数据保存方式呢？曾老师告诉我可以尝试使用qs的保存方式，这种方式可以在不损坏数据的前提下尽可能的压缩文件，并且同样的文件在保存和读取速度都比上述两种方式更快。</p><h4 data-tool="mdnice编辑器"><span></span>简单总结这三种方式的优缺点。<span></span></h4><h5 data-tool="mdnice编辑器"><span></span>1. .Rdata<span></span></h5><p data-tool="mdnice编辑器"><strong>优点：</strong></p><p data-tool="mdnice编辑器">● 多对象保存：可以在一个 .Rdata 文件中保存多个 R 对象（如数据框、列表、模型等）。</p><p data-tool="mdnice编辑器">● 兼容性好：这是 R 中最常用的文件格式之一，兼容性高，易于在不同 R 环境中使用。</p><p data-tool="mdnice编辑器">● 加载灵活：加载 .Rdata 文件时，可以选择性地加载其中的某些对象，而不必加载所有对象。</p><p data-tool="mdnice编辑器"><strong>缺点：</strong></p><p data-tool="mdnice编辑器">● 文件体积较大：相比其他格式，.Rdata 文件的体积可能较大，特别是当包含多个大型对象时。</p><p data-tool="mdnice编辑器">● 加载速度慢：加载速度相对较慢，尤其是在保存了大量数据时。</p><h5 data-tool="mdnice编辑器"><span></span>2. .rds<span></span></h5><p data-tool="mdnice编辑器"><strong>优点：</strong></p><p data-tool="mdnice编辑器">● 单对象保存：专门用于保存单个 R 对象，更适合需要保存单一数据框或模型的场景。</p><p data-tool="mdnice编辑器">● 文件体积较小：通常比 .Rdata 文件更小，因为 .rds 文件只保存一个对象，并且通过压缩减少文件大小。</p><p data-tool="mdnice编辑器">● 加载速度较快：由于文件体积小，加载速度通常比 .Rdata快。</p><p data-tool="mdnice编辑器">● 灵活性：可以用 readRDS() 加载对象，并赋值给任何变量名称，而不受保存时的对象名称限制。</p><p data-tool="mdnice编辑器"><strong>缺点：</strong></p><p data-tool="mdnice编辑器">● 仅保存单个对象：只能保存单个对象，不适合需要同时保存多个对象的场景。</p><p data-tool="mdnice编辑器">● 不包含变量名称：加载 .rds 文件时，必须显式地指定变量名，否则无法直接使用。</p><h5 data-tool="mdnice编辑器"><span></span>3. .qs<span></span></h5><p data-tool="mdnice编辑器"><strong>优点：</strong></p><p data-tool="mdnice编辑器">● 超高压缩率：qs 格式使用高效的压缩算法，生成的文件体积非常小，非常适合保存大数据集。</p><p data-tool="mdnice编辑器">● 读写速度极快：相比于 .Rdata 和 .rds，qs 格式的读写速度显著更快，特别是在处理大数据时表现尤为出色。</p><p data-tool="mdnice编辑器">● 支持多种压缩等级：可以根据需要调整压缩等级，以平衡文件大小和读写速度。</p><p data-tool="mdnice编辑器"><strong>缺点：</strong></p><p data-tool="mdnice编辑器">● 兼容性问题：qs 格式相对较新，在一些环境中可能需要额外安装 qs 包，兼容性不如 .Rdata 和 .rds 普遍。</p><p data-tool="mdnice编辑器">● 社区支持较少：由于qs格式较新，相关的资源和支持可能不如其他格式丰富。</p><p data-tool="mdnice编辑器">接下来进行代码运行时长和存储文件大小比较，系统中存在这三个文件。</p><p data-tool="mdnice编辑器"><img data-imgfileid="100000960" data-ratio="0.16634799235181644" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGm4ibdTYxNSydYgWYWMM9gNz56fFBFxrKVmfiauUiayZtlicILo7OtL1kILVShiazA8aw25zvDNIVQBvQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="523" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGm4ibdTYxNSydYgWYWMM9gNz56fFBFxrKVmfiauUiayZtlicILo7OtL1kILVShiazA8aw25zvDNIVQBvQ/640?wx_fmt=png&amp;from=appmsg">使用system.time()函数去计算代码运行时间，最后会返回三个数值，分别是user，system和elapsed。</p><p data-tool="mdnice编辑器">● user：用户CPU时间，即R代码本身在用户模式下执行的时间。也就是R解释并运行R代码所花费的时间。</p><p data-tool="mdnice编辑器">● system：系统CPU时间，即操作系统为代码执行分配的时间。通常是R在操作系统级别处理文件读写或其他系统调用所消耗的时间。</p><p data-tool="mdnice编辑器">● elspsed：这是墙钟时间（wall clock time），也就是从开始到结束的实际时间，包括了user时间、system时间以及R进程在等待其他资源（如I/O操作）时所花费的时间。换句话说，elspsed时间是在运行代码时实际等待的时间。</p><h4 data-tool="mdnice编辑器"><span></span>1、Rdata格式：<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>system.time({<br>save(sce.all,sce,sceList,file = <span>"sce_RAW.Rdata"</span>)<br>})<br><br><span>#   user  system elapsed </span><br><span># 22.915  38.786  67.229 </span><br><br>system.time({<br>load(<span>"sce_RAW.Rdata"</span>)<br>})<br><span>#   user  system elapsed </span><br><span># 21.609  12.622  34.228 </span><br><br>file_info &lt;- file.info(<span>"sce_RAW.Rdata"</span>)<br>file_size &lt;- file_info$size<br>format_file_size &lt;- <span>function</span>(size) {<br>  <span>if</span> (size &lt; <span>1024</span>) {<br>    <span>return</span>(paste(size, <span>"Bytes"</span>))<br>  } <span>else</span> <span>if</span> (size &lt; <span>1024</span>^<span>2</span>) {<br>    <span>return</span>(paste(round(size / <span>1024</span>, <span>2</span>), <span>"KB"</span>))<br>  } <span>else</span> <span>if</span> (size &lt; <span>1024</span>^<span>3</span>) {<br>    <span>return</span>(paste(round(size / <span>1024</span>^<span>2</span>, <span>2</span>), <span>"MB"</span>))<br>  } <span>else</span> {<br>    <span>return</span>(paste(round(size / <span>1024</span>^<span>3</span>, <span>2</span>), <span>"GB"</span>))<br>  }<br>}<br><br><span># 使用该函数格式化文件大小</span><br>readable_size &lt;- format_file_size(file_size)<br>print(readable_size)<br><span>#[1] "18.86 GB"</span><br></code></pre><p data-tool="mdnice编辑器">保存需要花费1分多钟时间，加载需要花费半分钟左右，最后生成的文件大小为18.86GB。</p><h4 data-tool="mdnice编辑器"><span></span>2、rds格式：<span></span></h4><p data-tool="mdnice编辑器">由于只能对单对象保存，这里仅保存最大的文件(sce)</p><pre data-tool="mdnice编辑器"><span></span><code>system.time({<br>saveRDS(sce,file = <span>"sce_RDS.rds"</span>)<br>})<br><span>#   user  system elapsed </span><br><span>#740.750  27.599 770.705 </span><br><br>system.time({<br>sce &lt;- readRDS(<span>"sce_RDS.rds"</span>)<br>})<br><span>#   user  system elapsed </span><br><span># 92.853  10.411 103.214 </span><br><br>file_info &lt;- file.info(<span>"sce_RDS.rds"</span>)<br>file_size &lt;- file_info$size<br>format_file_size &lt;- <span>function</span>(size) {<br>  <span>if</span> (size &lt; <span>1024</span>) {<br>    <span>return</span>(paste(size, <span>"Bytes"</span>))<br>  } <span>else</span> <span>if</span> (size &lt; <span>1024</span>^<span>2</span>) {<br>    <span>return</span>(paste(round(size / <span>1024</span>, <span>2</span>), <span>"KB"</span>))<br>  } <span>else</span> <span>if</span> (size &lt; <span>1024</span>^<span>3</span>) {<br>    <span>return</span>(paste(round(size / <span>1024</span>^<span>2</span>, <span>2</span>), <span>"MB"</span>))<br>  } <span>else</span> {<br>    <span>return</span>(paste(round(size / <span>1024</span>^<span>3</span>, <span>2</span>), <span>"GB"</span>))<br>  }<br>}<br><br><span># 使用该函数格式化文件大小</span><br>readable_size &lt;- format_file_size(file_size)<br>print(readable_size)<br><span># [1] "12.71 GB"</span><br></code></pre><p data-tool="mdnice编辑器">实际情况还是挺慢的，保存时间竟然超过了10分钟..，存储大小变小了一些只有12.71GB(不过只保存了最大的sce)。</p><h4 data-tool="mdnice编辑器"><span></span>3、qs格式：<span></span></h4><p data-tool="mdnice编辑器">同样只能对单对象保存，这里仅保存最大的文件(sce)</p><pre data-tool="mdnice编辑器"><span></span><code><span># 需要先加载一下qs包</span><br><span>library</span>(qs)<br>system.time({<br>qsave(sce,file = <span>"sce_qs.qs"</span>)<br>})<br><span>#   user  system elapsed </span><br><span># 67.516  20.576  88.543  </span><br><br>system.time({<br>sce &lt;- qread(<span>"sce_qs.qs"</span>)<br>})<br><span>#   user  system elapsed </span><br><span># 20.622  16.275  36.943 </span><br><br>file_info &lt;- file.info(<span>"sce_qs.qs"</span>)<br>file_size &lt;- file_info$size<br>format_file_size &lt;- <span>function</span>(size) {<br>  <span>if</span> (size &lt; <span>1024</span>) {<br>    <span>return</span>(paste(size, <span>"Bytes"</span>))<br>  } <span>else</span> <span>if</span> (size &lt; <span>1024</span>^<span>2</span>) {<br>    <span>return</span>(paste(round(size / <span>1024</span>, <span>2</span>), <span>"KB"</span>))<br>  } <span>else</span> <span>if</span> (size &lt; <span>1024</span>^<span>3</span>) {<br>    <span>return</span>(paste(round(size / <span>1024</span>^<span>2</span>, <span>2</span>), <span>"MB"</span>))<br>  } <span>else</span> {<br>    <span>return</span>(paste(round(size / <span>1024</span>^<span>3</span>, <span>2</span>), <span>"GB"</span>))<br>  }<br>}<br><br><span># 使用该函数格式化文件大小</span><br>readable_size &lt;- format_file_size(file_size)<br>print(readable_size)<br><span># [1] "3.58 GB"</span><br></code></pre><p data-tool="mdnice编辑器">保存和加载的时间跟Rdata差不多，存储大小只需要3.58GB，缩小了4.8倍，简直太棒了！</p><h4 data-tool="mdnice编辑器"><span></span>总结:<span></span></h4><p data-tool="mdnice编辑器">如果需要<strong>保存多个 R 对象</strong>，并且<strong>不在意文件大小和加载速度</strong>，.<strong>Rdata</strong> 是一种<strong>方便的选择</strong>。</p><p data-tool="mdnice编辑器">如果只需要保存一个对象，并且希望文件较小，.rds <strong>可能是</strong>一个不错的选择。</p><p data-tool="mdnice编辑器">如果处理的是大数据集，并且对文件体积和加载速度有较高要求，.<strong>qs 格式是一个极佳的选择</strong>。</p><p data-tool="mdnice编辑器"><strong>致谢</strong>：感谢曾老师以及生信技能树团队全体成员。</p><p data-tool="mdnice编辑器"><strong>注</strong>：若对内容有疑惑或者有发现明确错误的朋友，请联系后台(欢迎交流)。</p><span>- END -</span></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/vk8GK5wKixjMHok-n0rJMw",target="_blank" rel="noopener noreferrer">原文链接</a>
