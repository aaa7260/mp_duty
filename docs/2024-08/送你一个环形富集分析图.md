---
title: "送你一个环形富集分析图"
date: 2024-08-03T09:57:49Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
送你一个环形富集分析图 by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><section><mp-common-profile data-pluginname="mpprofile" data-id="MzkyMTI1MTYxNA==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezgsqIGqjITSMggCTSoViaYeoKe2xoZr1IIvNJoztibQxibYHLDDoiabwAc6Ggws3Tvdo8EPss2nLgaVQ/0?wx_fmt=png" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-from="0" data-is_biz_ban="0"></mp-common-profile></section></section><section><mp-common-clmusic data-pluginname="insertaudio" type="1" music_name="%E5%A6%82%E6%9E%9C%E5%BD%93%E6%97%B6" albumurl="http://wx.y.gtimg.cn/music/photo_new/T002R500x500M000002KSDg90IaScI_2.jpg" singer="许嵩" duration="316000" username="" music_source="1" is_vip="1" listenid="78221633839759872"></mp-common-clmusic></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>引言</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p>好久没用 <strong>circlize</strong> 了，都忘记怎么用了。今天画个环形富集分析图。网上教程也多，开动自己的脑筋和创意画一个。</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>富集分析</span><span></span></h2><p data-tool="mdnice编辑器">首先获得富集结果：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggplot2)<br><span>library</span>(org.Hs.eg.db)<br><span>library</span>(clusterProfiler)<br><span>library</span>(dplyr)<br><br><span># load test data</span><br>data(geneList, package=<span>"DOSE"</span>)<br><br><span># check</span><br>head(geneList)<br><span># 4312     8318    10874    55143    55388      991</span><br><span># 4.572613 4.514594 4.418218 4.144075 3.876258 3.677857</span><br><br><span># enrichment for control</span><br>ego1 &lt;- enrichGO(gene = names(geneList)[<span>1</span>:<span>500</span>],<br>                 OrgDb = org.Hs.eg.db,<br>                 keyType = <span>"ENTREZID"</span>,<br>                 ont = <span>"ALL"</span>,<br>                 qvalueCutoff = <span>1</span>,<br>                 pvalueCutoff = <span>1</span>,<br>                 readable = <span>T</span>)<br><br><span># get top 6 terms for visualization</span><br>ego1_df &lt;- data.frame(ego1) %&gt;%<br>  group_by(ONTOLOGY) %&gt;%<br>  arrange(pvalue) %&gt;%<br>  slice_head(n = <span>6</span>) %&gt;%<br>  rowwise() %&gt;%<br>  mutate(fc = eval(parse(text = GeneRatio))/eval(parse(text = BgRatio)))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030437" data-ratio="0.33503509891512445" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezG250YeetBDAxibYOTcmoXsef8nWyYYxBjMx6UBDszKOMQR9b9INzO18sDmztIus52jLVwqlbW3ZQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1567" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezG250YeetBDAxibYOTcmoXsef8nWyYYxBjMx6UBDszKOMQR9b9INzO18sDmztIus52jLVwqlbW3ZQ/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>画图</span><span></span></h2><p data-tool="mdnice编辑器">就拿上面的结果来绘图：</p><pre data-tool="mdnice编辑器"><span></span><code><span># plot</span><br><span>library</span>(circlize)<br><br><span># colors for ONTOLOGY group</span><br>col &lt;- rep(rand_color(n = length(unique(ego1_df$ONTOLOGY))),<br>           table(ego1_df$ONTOLOGY))<br><br>circos.clear()<br>circos.initialize(sectors = ego1_df$ID,xlim = c(<span>0</span>,<span>1</span>))<br><br><span># first GO id</span><br>circos.track(sectors = ego1_df$ID,ylim = c(<span>0</span>,<span>1</span>),<br>             bg.col = col,<br>             panel.fun = <span>function</span>(x, y){<br>               circos.text(x = CELL_META$xcenter,y = CELL_META$ycenter,<br>                           labels = CELL_META$sector.index,<br>                           cex = <span>0.75</span>)<br>             })<br><br><span># add count track</span><br>circos.track(sectors = ego1_df$ID,ylim = c(<span>0</span>,<span>1</span>),track.height = <span>0.1</span>,<br>             panel.fun = <span>function</span>(x, y){<br>               <span># circos.axis(h = "bottom")</span><br>             })<br><span>for</span> (i <span>in</span> <span>1</span>:nrow(ego1_df)){<br>  circos.rect(xleft = <span>0</span>,xright = ego1_df$Count[i]/max(ego1_df$Count),<br>              ybottom = <span>0.25</span>,ytop = <span>0.75</span>,<br>              sector.index = ego1_df$ID[i],<br>              <span># track.index = 1,</span><br>              col = <span>"#9933CC"</span>)<br><br>  <span># add xaxis</span><br>  circos.axis(h = <span>"bottom"</span>,major.at = c(<span>0</span>,<span>1</span>),labels = c(<span>0</span>,max(ego1_df$Count)),<br>              sector.index = ego1_df$ID[i])<br>}<br><br><span># foldchange enriment</span><br>circos.track(sectors = ego1_df$ID,ylim = c(<span>0</span>,<span>1</span>),track.height = <span>0.05</span>)<br><span>for</span> (i <span>in</span> <span>1</span>:nrow(ego1_df)){<br>  circos.text(x = <span>0.5</span>,y = <span>0.5</span>,<br>              labels = paste(<span>"FC:"</span>,round(ego1_df$fc[i],digits = <span>1</span>),sep = <span>" "</span>),<br>              sector.index = ego1_df$ID[i])<br>}<br><br>circos.track(sectors = ego1_df$ID,ylim = c(<span>0</span>,ceiling(max(ego1_df$fc))))<br><span>for</span> (i <span>in</span> <span>1</span>:nrow(ego1_df)){<br>  circos.barplot(value = ego1_df$fc[i],pos = <span>0.5</span>,<br>                 sector.index = ego1_df$ID[i],<br>                 <span># track.index = 4,</span><br>                 col = <span>"#FF6666"</span>)<br>}<br><br><span># -log10 pvalue</span><br>circos.track(sectors = ego1_df$ID,ylim = c(<span>0</span>,ceiling(max(-log10(ego1_df$pvalue)))))<br><span>for</span> (i <span>in</span> <span>1</span>:nrow(ego1_df)){<br>  circos.barplot(value = -log10(ego1_df$pvalue)[i],pos = <span>0.5</span>,<br>                 sector.index = ego1_df$ID[i],<br>                 <span># track.index = 2,</span><br>                 col = col[i])<br>}<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100030439" data-ratio="0.7442748091603053" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezG250YeetBDAxibYOTcmoXslfE68ub63iaEpNiaBmicsQQjBxIbs0KgloGHPNHMykwQCEN2zmozO3MLQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1310" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezG250YeetBDAxibYOTcmoXslfE68ub63iaEpNiaBmicsQQjBxIbs0KgloGHPNHMykwQCEN2zmozO3MLQ/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>包括了 count，富集倍数，p 值信息。当然你也可以继续添加其它信息上去。</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>结尾</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong>路漫漫其修远兮,吾将上下而求索。</strong></p></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">欢迎加入生信交流群。加我微信我也拉你进 <strong>微信群聊</strong> <strong>老俊俊生信交流群</strong> <strong>(微信交流群需收取 20 元入群费用,一旦交费,拒不退还!(防止骗子和便于管理))</strong> 。QQ 群可免费加入, 记得进群按格式修改备注哦。</p><section data-tool="mdnice编辑器"><section><p><strong>老俊俊微信：</strong></p><figure><img data-imgfileid="100030435" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezG250YeetBDAxibYOTcmoXsRUuiba273J04HnmWQEeEhfZ6v1V24pHEl2V7wGImoRU8acfqPMY5mlg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="430" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezG250YeetBDAxibYOTcmoXsRUuiba273J04HnmWQEeEhfZ6v1V24pHEl2V7wGImoRU8acfqPMY5mlg/640?wx_fmt=png&amp;from=appmsg"></figure><figure><img data-imgfileid="100030436" data-ratio="1.3668430335097002" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezG250YeetBDAxibYOTcmoXsQ7cZ6rSmZGCZFSwicBTicfSYh6CJepia9T9AD1b4qQvt9UoHmE4hEPkvg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="567" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezG250YeetBDAxibYOTcmoXsQ7cZ6rSmZGCZFSwicBTicfSYh6CJepia9T9AD1b4qQvt9UoHmE4hEPkvg/640?wx_fmt=png&amp;from=appmsg"></figure></section><section><p><strong>知识星球：</strong></p><figure><img data-imgfileid="100030438" data-ratio="1.5896226415094339" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4usezG250YeetBDAxibYOTcmoXs7sqBZU8SdsSHcDYbmw0AxrQmYOuYxKCibGpco76YGggJyI0MyNYmibvA/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1060" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4usezG250YeetBDAxibYOTcmoXs7sqBZU8SdsSHcDYbmw0AxrQmYOuYxKCibGpco76YGggJyI0MyNYmibvA/640?wx_fmt=jpeg&amp;from=appmsg"></figure></section></section><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><strong></strong></p><center data-tool="mdnice编辑器"><strong> 往期回顾目录</strong></center><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong></strong></p><center><strong><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247514040&amp;idx=1&amp;sn=3d7005394edf920db316a4afceda3d01&amp;chksm=c1848dc9f6f304df5624b8e0177c543fb210a07a0daa47efcb9b1520fba166c6c070860480a3&amp;token=736408649&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">enrichCluster 关于非模式物种富集分析的使用</a></strong></center><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513973&amp;idx=1&amp;sn=00ce573d81657bf2c985abc8bb6c8422&amp;chksm=c1848d04f6f3041222971f1933b4de0a7f99766ef99982c2560d5d4ff7ad0d0006a29fb7f56e&amp;token=1438488422&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">tidyCoverage 计算 bigwig 文件在目标区域的信号</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513953&amp;idx=1&amp;sn=7c9eb4545986fa9187cdd66cae8b1456&amp;chksm=c1848d10f6f30406d0bc3a86b3aa0150eb7191aea24bc4b9e366e0c04bc0be13a0a382253dfa&amp;token=1202987559&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">桑基图加富集图一行代码出图?</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513935&amp;idx=1&amp;sn=7149af238f8ae9ef1750349fef7e79e9&amp;chksm=c1848d3ef6f3042892939e2ddee645b405c6a007fc290ff8e67f5cceeb7af37ff2cb11f1df93&amp;token=1267815615&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">GEO 上传数据最新教程</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513903&amp;idx=1&amp;sn=7406e159002c4f5a11dffb74cd8bc16c&amp;chksm=c1848d5ef6f304485adeb4927b95318412d1f2d3aaddc21a6a60d58c4f4cac9d2c02340421e3&amp;token=350392803&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">试试 bulkRNA 做拟时序分析？</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513809&amp;idx=1&amp;sn=05eb04b579b04ff5b20f3cab2f52406a&amp;chksm=c1848ca0f6f305b6005b1f9853a79843be0e582f7519c234350a6b22b81f7d07f5d749dbe87b&amp;token=350392803&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ClusterGVis 绘制 lineplot 的优化</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513792&amp;idx=1&amp;sn=b71dffea7f6dd9ad8acaec98ee99678c&amp;chksm=c1848cb1f6f305a7c85b54cbc9f40e2aaffefbc119654d533cd0aef2480eda6e7946295d5008&amp;token=1799964631&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">RNAseqQC 给你的数据来个全面的 QC 检查</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513652&amp;idx=1&amp;sn=4750e40c39e055b0b8b6dae51d70c620&amp;chksm=c1848c45f6f30553044afacb5ea3544afd63287fd90f60858859b873db060019a569208590e9&amp;token=1799964631&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">如何 Pull Request 到 github 贡献你的代码</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513591&amp;idx=2&amp;sn=24c65a23ae46dfd31757b8e5a4c5908d&amp;chksm=c1848f86f6f30690024b4d74a8a4beadd5a4691ee30df9287ed42b24a9e1fd42f531adecde9e&amp;token=1130224323&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ggplot 添加分类型数据双坐标轴</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247513571&amp;idx=1&amp;sn=65c28c7798caee6a68208c7f8c50cc2b&amp;chksm=c1848f92f6f3068409d1036f0b038d7d127cee7c897138b12ddc34dc13f7b019136342582d86&amp;token=1130224323&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">富集分析流星图?</a></center></strong></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/sC-srCJhvjbdMFIXk6knJQ",target="_blank" rel="noopener noreferrer">原文链接</a>
