---
title: "scGSVA——让GSVA不再是bulk RNA-seq的特权"
date: 2024-08-09T02:19:50Z
draft: ["false"]
tags: [
  "fetched",
  "R语言学徒"
]
categories: ["Acdemic"]
---
scGSVA——让GSVA不再是bulk RNA-seq的特权 by R语言学徒
------
<div><p data-mpa-powered-by="yiban.io"><img data-cropselx1="0" data-cropselx2="578" data-cropsely1="0" data-cropsely2="135" data-galleryid="" data-imgfileid="100005020" data-ratio="0.2222222222222222" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEUckerRictfTicSHoNskkHZjoa7nSeGI9ticg8pf3FOEkewHQTNLbNhdKK36fxBPpNLzVm0W8LjZYKEg/640?wx_fmt=png&amp;from=appmsg" data-type="jpeg" data-w="900" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEUckerRictfTicSHoNskkHZjoa7nSeGI9ticg8pf3FOEkewHQTNLbNhdKK36fxBPpNLzVm0W8LjZYKEg/640?wx_fmt=png&amp;from=appmsg"></p><p><span>各位小伙伴们，大家在进行文献的阅读时有没有见GSVA分析呀？GSVA（ Gene Set Variation Analysis），中文我们称为基因集变异分析，可以说是在SCI文章中十分常见的一个生信分析的方法，在各位小伙伴获得多个pathway通路时，可以通过这个分析方法，比较通路在不同样本之间的异质性哦！还没有接触过的小伙伴也别担心啦，师妹给大家简单的介绍一下，已经了解过的看看师妹说的对不对，如果有问题可以在评论区帮师妹纠纠错呀 各位小伙伴可以把GSVA想象成是一个魔镜，它可以帮助我们理解基因在不同个体或条件下的活动。整个分析流程呢，大概是长这样的：首先，我们有一堆基因，就像一群小精灵，它们有的勤奋，有的懒惰。GSVA的任务就是告诉我们哪些小精灵在哪些情况下（样本的差异）可以激励他们劳作，变得勤奋（基因表达量高）。GSVA会拿着一个名单，上面写着不同的情况，比如不同的细胞类型或疾病状态。然后，它会检查每个基因是否在这些情况下表现得更好或更差。最后，GSVA会把结果告诉我们，告诉我们哪些情况下哪些基因变得更活跃。这对于研究基因与疾病之间的关系或了解不同细胞类型的功能非常有帮助的哦。但是咧，目前的研究很少针对于单细胞转录组的GSVA分析的软件包，可能各位研究单细胞的小伙伴都是在使用对bulk RNA-seq开发的原始的版本吧，今天师妹想为大家介绍的就是一个针对SCRNA-seq开发的GSVA工具R包哦，他就是scGSVA！！他让我们可以在单细胞数据中进行GSVA分析，几乎支持所有物种的注释数据，还可以针对GSVA的结果生成对应的数据哦~ 接下来就请各位小伙伴跟着师妹一起学习这个scGSVA R包吧！</span></p><h1><strong><span>step 1</span></strong><span></span></h1><p><span>安装R包，这里我们和之前一样，因为是从github上进行下载，所以师妹在这设置了timeout参数哦    </span><page></page></p><section><ul><li><li><li></ul><pre data-lang="apache"><code><span><span>library</span>(devtools)            </span></code><code><span><span><span>options</span></span>(timeout = 999999)            </span></code><code><span><span>install_github</span>(<span>"guokai8/scGSVA"</span>)</span></code></pre></section><h1><strong><span><br></span></strong></h1><h1><strong><span>step 2</span></strong><span></span></h1><p><span>接下来，我们就要开始正式的分析啦，师妹会为每行代码都添加注释哦，各位小伙伴可以放心食用呀~</span></p><section><ul><li><li><li><li><li></ul><pre data-lang="sql"><code><span>set.seed(<span>123</span>) <span># 这里设置了随机数种子，这样各位小伙伴就可以保证实验结果的可重复性啦             </span></span></code><code><span><span>library</span>(scGSVA) <span># 加载我们今天的主角R包            </span></span></code><code><span><span>data</span>(pbmcs) <span># 这里咧，是我们今天使用的示例数据集呀            </span></span></code><code><span>anno &lt;- buildAnnot(species=<span>"human"</span>, keytype=<span>"SYMBOL"</span>, anntype=<span>"KEGG"</span>) <span># 这里scGSVA为各位小伙伴们提供了用于一键注释的函数            </span></span></code><code><span>res &lt;- scgsva(pbmcs, anno) <span># 我们在这里给了数据集（一个Seurat对象）和注释文件到scgsva()函数中</span></span></code></pre></section><p><span>没有服务器的小伙伴欢迎联系师妹租赁服务器，价格便宜到超乎想象，花小价钱办大事，性价比超级高~~</span></p><p><img data-cropselx1="0" data-cropselx2="578" data-cropsely1="0" data-cropsely2="128" data-imgfileid="100007342" data-ratio="0.24" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/oCSOtP61aEWyGdujg4gzuI4ToSBwBOXBuv2azH59NIH0wsahlF2kN8h81HOHeNTtOAGkb1dBWH20iaqPtwIcUoQ/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="900" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/oCSOtP61aEWyGdujg4gzuI4ToSBwBOXBuv2azH59NIH0wsahlF2kN8h81HOHeNTtOAGkb1dBWH20iaqPtwIcUoQ/640?wx_fmt=jpeg&amp;from=appmsg"></p><p><strong><span>step 3 </span></strong><span>  </span></p><p><span>step 2运行结束后就意味着各位小伙伴已经把GSVA分析完成啦，我们接下来要做的就是对结果进行可视化啦！</span></p><p><span>这里出现了一个小小的bug哦，不过解决的办法也很简单，这里我们跑出来的gsva对象其中的列名中含有空格，这使得在进行可视化时并不能成功的识别出啦。大家可以针对自己想要研究的通路，针对性的进行修改，就像这里哦，师妹想要观察Wnt信号通路的变化，就可以只对这个通路的列名进行修改就好啦，师妹也试过直接用空格，结果也是报错的咧..</span></p><section><ul><li><li></ul><pre data-lang="css"><code><span><span>colnames</span>(<span>res</span>@<span>gsva</span>)[<span>117</span>] &lt;- <span>"Wnt.signaling.pathway"</span>            </span></code><code><span>vlnPlot(res, features = <span>"Wnt.signaling.pathway"</span>, group_by = <span>"groups"</span>) # 这里师妹使用的是groups进行分组，g1和g2代表了两个样本</span></code></pre></section><p><span></span><page></page></p><p><img data-imgfileid="100007340" data-ratio="0.8" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEUJjUD7gRr1e0oVvl7hl42Pf4DzLnRYUAt6PCN8r25loH7dxyvoRLicICA9LiarBgWicpFQwTvdvpkicQ/640?wx_fmt=png" data-type="png" data-w="1080" height="385.2900085449219" width="481.6099853515625" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEUJjUD7gRr1e0oVvl7hl42Pf4DzLnRYUAt6PCN8r25loH7dxyvoRLicICA9LiarBgWicpFQwTvdvpkicQ/640?wx_fmt=png"></p><p><span>从这个小提琴图中，我们可以发现这两个“情况”对于Wnt信号通路而言区别是不大的哦</span></p><section><ul><li></ul><pre data-lang="javascript"><code><span>dotPlot(res, features=<span>"Wnt.signaling.pathway"</span>, group_by=<span>"groups"</span>, pt.size = <span>5</span>)</span></code></pre></section><p><span> </span><page></page></p><p><img data-imgfileid="100007339" data-ratio="0.8" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEUJjUD7gRr1e0oVvl7hl42PTzUpiadjgJJiaVbVNRSAPzYAAn2GibKAvIeQTPmQBA8kLrCGmG5AYNcZA/640?wx_fmt=png" data-type="png" data-w="1080" height="385.2900085449219" width="481.6099853515625" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEUJjUD7gRr1e0oVvl7hl42PTzUpiadjgJJiaVbVNRSAPzYAAn2GibKAvIeQTPmQBA8kLrCGmG5AYNcZA/640?wx_fmt=png"></p><p><span>点图中的NES（Normalized Enrichment Score）坐标咧，是基因集富集分析中常用的指标之一，它可以用于帮助理解基因集在不同生物学条件下的活性。NES越高（1）表示该基因集在样本中的富集更为显著 （2）表明与该基因集相关的生物学通路或功能在您的样本中具有更高的活性 （3）表示该通路在您研究的条件下具有更大的生物学影响。</span></p><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="shell"><code><span>ridgePlot(res,features="Wnt.signaling.pathway", group_by="groups")</span></code><code><span><span>#</span><span># Warning: The `` argument of `guides()` cannot be `FALSE`. Use "none" instead as            </span></span></code><code><span><span>#</span><span># of ggplot2 3.3.4.            </span></span></code><code><span><span>#</span><span># ℹ The deprecated feature was likely used in the scGSVA package.            </span></span></code><code><span><span>#</span><span>#   Please report the issue to the authors.            </span></span></code><code><span><span>#</span><span># This warning is displayed once every 8 hours.            </span></span></code><code><span><span>#</span><span># Call `lifecycle::last_lifecycle_warnings()` to see where this warning was            </span></span></code><code><span><span>#</span><span># generated.</span></span></code><code><span><span>#</span><span># Picking joint bandwidth of 0.0451</span></span></code></pre></section><p><span>    </span><page></page></p><p><img data-imgfileid="100007338" data-ratio="0.8" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEUJjUD7gRr1e0oVvl7hl42PzgSvBNv67ecick0y9NdZE4QzqZR8rH1PbteAbhs3Qx6z6GrId66eQTw/640?wx_fmt=png" data-type="png" data-w="480" height="388.04998779296875" width="485.05999755859375" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEUJjUD7gRr1e0oVvl7hl42PzgSvBNv67ecick0y9NdZE4QzqZR8rH1PbteAbhs3Qx6z6GrId66eQTw/640?wx_fmt=png"></p><p><span>这里师妹画了一张山脊图哦，山脊图可以说是比较特殊的一个图，在常规的分析中，我们只会在GSVA中看到，可能有小伙伴不太了解怎么进行解读，所以就让师妹简单的解读一下吧！</span></p><p><span>每个山峰：每个山峰代表一个不同的分组。每个山峰的高度表示在该分组中信号通路的富集程度。</span></p><p><span>山峰的位置：山峰的位置表示在哪个分组中富集程度最高。可以看出哪些分组中某个信号通路最显著。</span></p><p><span>山峰的形状和宽度：山峰的形状和宽度可以反映分组内通路富集的变化程度。较宽或较平坦的山峰表示在多个分组中通路富集程度相对一致，而尖锐的山峰可能表示在特定分组中通路富集非常显著。</span></p><section><ul><li></ul><pre data-lang="javascript"><code><span>featurePlot(res, features=<span>"Wnt.signaling.pathway"</span>, reduction=<span>"tsne"</span>, pt.size = <span>4</span>)</span></code></pre></section><p><span></span><page></page></p><p><img data-imgfileid="100007337" data-ratio="0.8" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEUJjUD7gRr1e0oVvl7hl42PpIRSoW9uuW1Boyzvxt6icbzloibibC5QSxsFFO6aJX6SG47GyYAlDXQ8A/640?wx_fmt=png" data-type="png" data-w="480" height="388.04998779296875" width="485.05999755859375" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEUJjUD7gRr1e0oVvl7hl42PpIRSoW9uuW1Boyzvxt6icbzloibibC5QSxsFFO6aJX6SG47GyYAlDXQ8A/640?wx_fmt=png"></p><p><span>这张图就是很简单的将gsva的结果在tsne的图上进行可视化啦，师妹这里就不做过多的解释咯。</span></p><p><strong><span>step 4</span></strong></p><p><span>这里scGSVA为各位小伙伴准备了一两个寻找通路的函数：findPathway是为每个通路拟合线性模型，可以评估通路中的基因表达是否与分组变量相关；sigPathway是进行组建显著性分析，它关注的稍有不同，是研究在不同分组之间具有显著差异的通路哦。</span><span></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="shell"><code><span>result1 &lt;- findPathway(res,group = "groups")            </span></code><code><span>head(result1)</span></code><code><span><span>#</span><span>#                                                 logFC      AveExpr         t            </span></span></code><code><span><span>#</span><span># Endocytosis                               -0.05092853 -0.026558556 -2.131606            </span></span></code><code><span><span>#</span><span># Natural killer cell mediated cytotoxicity  0.07192093 -0.013542222  2.018542            </span></span></code><code><span><span>#</span><span># Butanoate metabolism                      -0.04436583  0.092388778 -1.876971            </span></span></code><code><span><span>#</span><span># SNARE interactions in vesicular transport -0.04760937  0.212333077 -1.819595            </span></span></code><code><span><span>#</span><span># Acute myeloid leukemia                    -0.06306390  0.009388878 -1.799302            </span></span></code><code><span><span>#</span><span># Adherens junction                         -0.06306390  0.009388878 -1.799302            </span></span></code><code><span><span>#</span><span>#                                              P.Value adj.P.Val         B            </span></span></code><code><span><span>#</span><span># Endocytosis                               0.03599950 0.6580067 -3.757155            </span></span></code><code><span><span>#</span><span># Natural killer cell mediated cytotoxicity 0.04676743 0.6580067 -3.960868            </span></span></code><code><span><span>#</span><span># Butanoate metabolism                      0.06403943 0.6580067 -4.201838            </span></span></code><code><span><span>#</span><span># SNARE interactions in vesicular transport 0.07243017 0.6580067 -4.294961            </span></span></code><code><span><span>#</span><span># Acute myeloid leukemia                    0.07560918 0.6580067 -4.327263            </span></span></code><code><span><span>#</span><span># Adherens junction                         0.07560918 0.6580067 -4.327263            </span></span></code><code><span><span>#</span><span>#                                           comparision            </span></span></code><code><span><span>#</span><span># Endocytosis                                  g1_vs_g2            </span></span></code><code><span><span>#</span><span># Natural killer cell mediated cytotoxicity    g1_vs_g2            </span></span></code><code><span><span>#</span><span># Butanoate metabolism                         g1_vs_g2            </span></span></code><code><span><span>#</span><span># SNARE interactions in vesicular transport    g1_vs_g2            </span></span></code><code><span><span>#</span><span># Acute myeloid leukemia                       g1_vs_g2            </span></span></code><code><span><span>#</span><span># Adherens junction                            g1_vs_g2    </span></span></code><code><span>result2 &lt;- sigPathway(res, group = "groups")            </span></code><code><span>head(result2)</span></code><code><span><span>#</span><span># # A tibble: 6 × 6            </span></span></code><code><span><span>#</span><span>#   Path                            group1 group2 statistic      p p.adj            </span></span></code><code><span><span>#</span><span>#                                                                                                  </span></span></code><code><span><span>#</span><span># 1 Acute myeloid leukemia          g1     g2          596  0.0586 0.545            </span></span></code><code><span><span>#</span><span># 2 Adherens junction               g1     g2          596  0.0586 0.545            </span></span></code><code><span><span>#</span><span># 3 Adipocytokine signaling pathway g1     g2          882. 0.384  0.712            </span></span></code><code><span><span>#</span><span># 4 African trypanosomiasis         g1     g2          678. 0.274  0.712            </span></span></code><code><span><span>#</span><span># 5 Allograft rejection             g1     g2          958  0.11   0.585            </span></span></code><code><span><span>#</span><span># 6 Alzheimer disease               g1     g2          909  0.261  0.712</span></span></code></pre></section><p><span>这里师妹使用了genes函数，可以提取自己想要的通路的信息哦！</span><span></span><span></span></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="shell"><code><span><span>#</span> 提取具有表达值的特定通路            </span></code><code><span>result3 &lt;- genes(res, features = "Wnt.signaling.pathway")            </span></code><code><span>result3[1:2,1:5]</span></code><code><span><span>#</span><span>#       GeneID  PATH                 Annot ATGCCAGAACGACT CATGGCCTGTGCAT            </span></span></code><code><span><span>#</span><span># 10253 PPP3CC 04310 Wnt signaling pathway              0              0            </span></span></code><code><span><span>#</span><span># 12724   TCF7 04310 Wnt signaling pathway              0              0</span></span></code></pre></section><p><span></span></p><p><span>这里就是今天师妹为大家准备的学习内容啦！希望今天的分享可以帮助到各位最近想做单细胞GSVA分析的小伙伴们哦~如果小伙伴有其他数据分析需求，可以尝试使用本公司新开发的生信分析小工具云平台，零代码完成分析，非常方便奥，云平台网址为：</span><span>http://www.biocloudservice.com/home.html</span><span>    </span></p><p><img data-cropselx1="0" data-cropselx2="578" data-cropsely1="0" data-cropsely2="225" data-imgfileid="100007343" data-ratio="0.5" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/oCSOtP61aEX11kCNUeuknTBMibgv0x3xsR4JL8M2FN9ZCDnkUxEKHmxwOtZEZSQic4u7gjX7AZwibQE1Nmtq3j1Yw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="800" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/oCSOtP61aEX11kCNUeuknTBMibgv0x3xsR4JL8M2FN9ZCDnkUxEKHmxwOtZEZSQic4u7gjX7AZwibQE1Nmtq3j1Yw/640?wx_fmt=jpeg&amp;from=appmsg"></p><p><img data-imgfileid="100007344" data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEXIKicwUpMyKu4leia6g9hicEcR0pHEtianl9Z041w5j3xsEzQqBBlpWP4MdibsBbbdSYpOfP2zNEwo0eg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-w="900" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEXIKicwUpMyKu4leia6g9hicEcR0pHEtianl9Z041w5j3xsEzQqBBlpWP4MdibsBbbdSYpOfP2zNEwo0eg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><p>往</p></section></section></section><section><section powered-by="xiumi.us"><section><p>期</p></section></section></section><section><section powered-by="xiumi.us"><section><p>推</p></section></section></section><section><section powered-by="xiumi.us"><section><p>荐</p></section></section></section><section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg5MDk3Mzg4OA==&amp;mid=2247489834&amp;idx=1&amp;sn=55f72eef444a1c0682051cff269113f6&amp;chksm=cfd52285f8a2ab9391cf3d1525eb05f346bd75b5cb008e59daebc6172405d78065273c59f86d&amp;scene=21#wechat_redirect" textvalue="ggkegg包：让你的KEGG分析和可视化遥遥领先" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">ggkegg包：让你的KEGG分析和可视化遥遥领先</a><span>  </span></p></section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section><section powered-by="xiumi.us"><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg5MDk3Mzg4OA==&amp;mid=2247488767&amp;idx=1&amp;sn=33f8fb31948a095f131fad5c58873b75&amp;chksm=cfd52f50f8a2a6465835346702e840cf6693cb93b665df9c7b7a28451ab79cd2e1f453642379&amp;scene=21#wechat_redirect" textvalue="用R进行GWAS分析，原来如此简单" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">用R进行GWAS分析，原来如此简单</a></p></section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section><section powered-by="xiumi.us"><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg5MDk3Mzg4OA==&amp;mid=2247488665&amp;idx=1&amp;sn=6d7b7b1e8b36a92df691b0ab014e7663&amp;chksm=cfd52f36f8a2a620a790e74d99e3d8af879904a131c4e1f653448590453941b7ff356d486531&amp;scene=21#wechat_redirect" textvalue="师妹教你R包EnhancedVolcano超详尽，让你的火山图喷发姿势更帅" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">师妹教你R包EnhancedVolcano超详尽，让你的火山图喷发姿势更帅</a></p></section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section><section powered-by="xiumi.us"><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg5MDk3Mzg4OA==&amp;mid=2247488767&amp;idx=2&amp;sn=f4de9eddb643d07901e8026f6a809030&amp;chksm=cfd52f50f8a2a6464ed97abaae48727355571d8c1b14ba989f58d9e8125b937e7c2f1310aa2d&amp;scene=21#wechat_redirect" textvalue="软件包安装、打怪快又好，1024G存储的生信服务器；还有比这更省钱的嘛！！！" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>软件包安装、打怪快又好，1024G存储的生信服务器；还有比这更省钱的嘛！！！</span></a><span>       </span><p><span> </span></p><span>    </span></p></section></section></section></section><p><page><br></page></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/LSFD6mJv4FjuJYYwg7xuww",target="_blank" rel="noopener noreferrer">原文链接</a>
