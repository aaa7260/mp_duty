---
title: "TCGA与GEO数据合并--怎么矫正批次效应？"
date: 2024-08-12T01:39:31Z
draft: ["false"]
tags: [
  "fetched",
  "作图丫"
]
categories: ["Acdemic"]
---
TCGA与GEO数据合并--怎么矫正批次效应？ by 作图丫
------
<div><p><span><strong><strong>最近有小伙伴反映收不到推送，因为公众号改了推送算法，现在需要加星标，多点赞、点在看，才能准时收到推送哦。</strong></strong></span></p><section label="Powered by 135editor.com" data-role="outer"><section data-id="undefined"><section><section data-style="background-color:rgb(248, 248, 248); color:rgb(115, 115, 115); font-size:14px; line-height:21px"><p>导语：在高通量实验中，异质性和潜在变量通常被视为主要的偏差和变异源。而在基因组实验中，批次效应是最常见的变异因素。批次效应通常由实验方法、实验时间、实验组别或操作人员的差异引起，可能对数据分析过程及其结果产生显著影响。</p></section></section></section></section><section data-id="96283" data-tools="135编辑器"><section><section><section><br></section><p><span>作图丫不仅文章解读的好，</span><span>课题做得也出色，</span><span><span>已与</span><span>国内多家知名医院的老师</span><span>和名牌大学实验室达成合作。<span>欢迎有生信分析需求的老师垂询，</span><span>公共</span><span>数据库数据挖掘或</span><span>自测数据分析均可。</span></span></span></p><section><span>欢迎长期合作</span></section><section><span>联系请扫描下方二维码</span></section><p><img data-galleryid="" data-imgfileid="100034508" data-ratio="1.0092592592592593" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/DgSHw3V1iaJxs4NpB9icYspMJLdfLBIms8zdiaeytYtbZyjlMERIm7B8mLBVnQwqc9QBXUbyUmRUIicrVrpscf9Z8g/640?wx_fmt=jpeg&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/DgSHw3V1iaJxs4NpB9icYspMJLdfLBIms8zdiaeytYtbZyjlMERIm7B8mLBVnQwqc9QBXUbyUmRUIicrVrpscf9Z8g/640?wx_fmt=jpeg&amp;from=appmsg"></p><section><span></span></section><section><br></section></section></section></section><section data-id="96283" data-tools="135编辑器"><section><section><section data-id="94674" data-tools="135编辑器"><section><img data-imgfileid="100034509" data-ratio="0.22169811320754718" data-type="gif" data-w="636" data-width="100%" data-src="https://mmbiz.qpic.cn/mmbiz_gif/DgSHw3V1iaJwuSD9luOs4P16C9qmHN4uh4MxTNkkIibVkTeRzeGt4miaDE7kbeHmoNj8IicOJglMY6FTfiaujH46uQA/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/mmbiz_gif/DgSHw3V1iaJwuSD9luOs4P16C9qmHN4uh4MxTNkkIibVkTeRzeGt4miaDE7kbeHmoNj8IicOJglMY6FTfiaujH46uQA/640?wx_fmt=gif"></section></section><section><img data-ratio="1.0625" data-type="png" data-w="32" data-width="100%" data-imgfileid="100034507" data-src="https://mmbiz.qpic.cn/mmbiz_png/DgSHw3V1iaJxXClpLyMwEZQh6Z6ibDyjmaPv8j3WcGIuVdJkyW4cmiaf38RaNBeXHFBn3IibZXgFER38e5efRzkFdQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/DgSHw3V1iaJxXClpLyMwEZQh6Z6ibDyjmaPv8j3WcGIuVdJkyW4cmiaf38RaNBeXHFBn3IibZXgFER38e5efRzkFdQ/640?wx_fmt=png"></section><section><section data-brushtype="text"><strong>背景介绍</strong></section><section data-width="80%"><br></section><section><br></section></section><section><section><br></section></section><section><section><br></section></section></section></section></section><section><span></span></section><section><span>在我们做生信分析时，经常需要整合TCGA和GEO的数据共同分析和相互验证，因此，去除批次效应显得尤为重要。本文将介绍一种常用的批次校正方法，即基于经验贝叶斯理论的R包sva。</span></section><section><br></section><section data-id="96283" data-tools="135编辑器"><section><section><section data-id="94674" data-tools="135编辑器"><section><img data-imgfileid="100034513" data-ratio="0.22169811320754718" data-type="gif" data-w="636" data-width="100%" data-src="https://mmbiz.qpic.cn/mmbiz_gif/DgSHw3V1iaJwuSD9luOs4P16C9qmHN4uh4MxTNkkIibVkTeRzeGt4miaDE7kbeHmoNj8IicOJglMY6FTfiaujH46uQA/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/mmbiz_gif/DgSHw3V1iaJwuSD9luOs4P16C9qmHN4uh4MxTNkkIibVkTeRzeGt4miaDE7kbeHmoNj8IicOJglMY6FTfiaujH46uQA/640?wx_fmt=gif"></section></section><section><img data-imgfileid="100034516" data-ratio="1.0625" data-type="png" data-w="32" data-width="100%" data-src="https://mmbiz.qpic.cn/mmbiz_png/DgSHw3V1iaJxXClpLyMwEZQh6Z6ibDyjmaPv8j3WcGIuVdJkyW4cmiaf38RaNBeXHFBn3IibZXgFER38e5efRzkFdQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/DgSHw3V1iaJxXClpLyMwEZQh6Z6ibDyjmaPv8j3WcGIuVdJkyW4cmiaf38RaNBeXHFBn3IibZXgFER38e5efRzkFdQ/640?wx_fmt=png"></section><section><section data-brushtype="text"><strong>结果解析</strong></section><section data-width="80%"><br></section><section><br></section></section><section><section><br></section></section><section><section><br></section></section></section></section></section><section><section><section><span><strong>01</strong></span></section><section data-brushtype="text"><span>加载R包</span></section></section></section><section><br></section><section><span></span></section><section><section><ul><li><li><li><li><li><li></ul><pre data-lang="javascript"><code><span>##首先安装BiocManager（如果尚未安装）：</span></code><code><span>install.packages(<span>"BiocManager"</span>)</span></code><code><span>##然后使用BiocManager来安装sva包：</span></code><code><span>BiocManager::install(<span>"sva"</span>)</span></code><code><span>##安装完成后，通过以下命令加载包：</span></code><code><span>library(sva)</span></code></pre></section></section><section><span></span></section><section><span>所使用的主要函数：<span>model.matrix和ComBat。</span></span></section><section><section><section><span><strong>02</strong></span></section><section data-brushtype="text"><span>所需数据<br></span></section></section></section><section><br></section><section><ul><li><li></ul><pre data-lang="css"><code><span>##1.需要矫正的数据：<span>geo_tcga</span></span></code><code><span><span>geo_tcga</span>&lt;<span>-cbind</span>(<span>tcga_exp</span><span>[,-1]</span>,<span>geo</span><span>[,-1]</span>)</span></code></pre></section><section><span></span></section><section><span>geo_tcga如下所示：</span></section><p><img data-galleryid="" data-imgfileid="100034531" data-ratio="0.5462962962962963" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/DgSHw3V1iaJw6cDTbFgDK5ibup1qH0hvYMAlZHhxccjQ3Gz3BZ2qy34fcwZibnmk0xGcYHRBAObUuZ6tHibQfq41sg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/DgSHw3V1iaJw6cDTbFgDK5ibup1qH0hvYMAlZHhxccjQ3Gz3BZ2qy34fcwZibnmk0xGcYHRBAObUuZ6tHibQfq41sg/640?wx_fmt=png&amp;from=appmsg"></p><section><span></span></section><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="javascript"><code><span>##<span>2.</span>指定样本批次和组（<span>case</span><span>/control）的文件：共三列，第一列是样本ID（GSM），</span></span></code><code><span>##第二列是批次，第三列是疾病状态（健康或疾病）</span></code><code><span>sample&lt;-colnames(geo_tcga)</span></code><code><span>gse&lt;-c(rep("tcga",ncol(tcga_exp[,-1])),rep("gse",ncol(geo[,-1])))</span></code><code><span>class&lt;-c(rep("case",ncol(tcga_exp[,-1])),rep("case",ncol(geo_can[,-1])))</span></code><code><span>bdata&lt;-cbind(sample,gse,class)</span></code><code><span>bdata&lt;-as.data.frame(bdata)</span></code></pre></section><section><span>或者如果大家有准备好的数据如下所示：<br></span></section><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>library(sva)<span>#导入sva包</span></span></code><code><span><br></span></code><code><span>bdata&lt;-read.table(<span>"bdata.txt"</span>,row.names=1)<span>#导入指定样本批次和组别的文件</span></span></code><code><span><br></span></code><code><span>colnames(bdata)=c(<span>"sample"</span>,<span>"gse"</span>,<span>"class"</span>)</span></code><code><span><br></span></code><code><span>mdata=read.table(<span>"final.txt"</span>,header=T,row.names=1)<span>#导入待校正的数据文件</span></span></code></pre></section><section><span></span></section><section><br></section><section><section><section><span><strong>03</strong></span></section><section data-brushtype="text"><span>开始矫正</span></section></section></section><section><br></section><section><ul><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>mod = model.matrix(~as.factor(class), data=bdata)<span>#根据表型文件建立模型</span></span></code><code><span>geo_tcga&lt;-apply(geo_tcga, 2, as.numeric)</span></code><code><span>mdata&lt;-geo_tcga</span></code><code><span>combat_mdata =ComBat(dat=mdata, batch=bdata$gse, mod=mod,par.prior=TRUE,prior.plots=FALSE)<span>#校正批次效应</span></span></code><code><span>write.table(combat_mdata,<span>"combat_mdata.txt"</span>,quote=F,sep=<span>"\t"</span>,row.names= T,col.names = T,append=T)<span>#导出校正后的数据</span></span></code></pre></section><section><span></span></section><p><span>输出数据：输出的数据格式将与输入数据格式保持一致，只不过这些数据是经过批次效应校正后的结果。</span></p><p><br></p><section data-id="96283" data-tools="135编辑器"><section><section><section data-id="94674" data-tools="135编辑器"><section><img data-imgfileid="100034520" data-ratio="0.22169811320754718" data-type="gif" data-w="636" data-width="100%" data-src="https://mmbiz.qpic.cn/mmbiz_gif/DgSHw3V1iaJwuSD9luOs4P16C9qmHN4uh4MxTNkkIibVkTeRzeGt4miaDE7kbeHmoNj8IicOJglMY6FTfiaujH46uQA/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/mmbiz_gif/DgSHw3V1iaJwuSD9luOs4P16C9qmHN4uh4MxTNkkIibVkTeRzeGt4miaDE7kbeHmoNj8IicOJglMY6FTfiaujH46uQA/640?wx_fmt=gif"></section></section><section><img data-imgfileid="100034518" data-ratio="1.0625" data-type="png" data-w="32" data-width="100%" data-src="https://mmbiz.qpic.cn/mmbiz_png/DgSHw3V1iaJxXClpLyMwEZQh6Z6ibDyjmaPv8j3WcGIuVdJkyW4cmiaf38RaNBeXHFBn3IibZXgFER38e5efRzkFdQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/DgSHw3V1iaJxXClpLyMwEZQh6Z6ibDyjmaPv8j3WcGIuVdJkyW4cmiaf38RaNBeXHFBn3IibZXgFER38e5efRzkFdQ/640?wx_fmt=png"></section><section><section data-brushtype="text"><strong>小编总结</strong></section><section data-width="80%"><br></section><section><br></section></section><section><section><br></section></section><section><section><br></section></section></section></section></section><section><span></span></section><p><span><span>经过校正的数据将呈现出更为一致和可靠的特征，减少了实验条件或其他外部因素对数据的</span><span>影响，从而提高了分析的准确性和数据的可重复性。</span></span></p><p><span>在处理数据时，尤其是当数据行列（即基因和样本）非常庞大时，可能会因为计算机配置的限制而导致校正过程的时间显著延长，或者出现内存不足的情况。这种问题通常是由于计算资源不足以处理大规模数据集所致。</span><span>为了应</span><span>对这些计算挑战，可以将数据文件根据计算机的内存容量进行合理分割。</span><span>例如，可以将数据按每500行分成若干份，并分别进行批次效应校正。</span><span>这样做可以有效地减少单次处理的数据量，降低对计算资源的要求，从而避免长时间的计算和内存不足的问题。</span><span>同时，校正后的结果可以在后续步骤中合并，以获得最终的校正数据集。</span></p><section><span></span></section><section><br></section><section><span><br></span></section><section><br></section><section data-mpa-template="t" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><img data-fileid="100016082" data-ratio="0.9166666666666666" data-type="png" data-w="24" data-imgfileid="100034519" data-src="https://mmbiz.qpic.cn/mmbiz_png/HaaibyndPicBichBbjTmfn3t5GIesdrp5soTxpZIFsf18w8N7HAFF7XVt9l51HXaMeJqOwzE06GS9AQ4smDf8SicFA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/HaaibyndPicBichBbjTmfn3t5GIesdrp5soTxpZIFsf18w8N7HAFF7XVt9l51HXaMeJqOwzE06GS9AQ4smDf8SicFA/640?wx_fmt=png"></section><section data-mid="" mpa-from-tpl="t"><img data-fileid="100016080" data-ratio="0.9166666666666666" data-type="png" data-w="24" data-imgfileid="100034517" data-src="https://mmbiz.qpic.cn/mmbiz_png/H1YldzEORib75cEkpXjN27FU2UH8V4qgKqjgPUePJ0IT5S4xn1UQMlf5ocHtRr0vcLHOV040fpQWPbuLicViawJCA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/H1YldzEORib75cEkpXjN27FU2UH8V4qgKqjgPUePJ0IT5S4xn1UQMlf5ocHtRr0vcLHOV040fpQWPbuLicViawJCA/640?wx_fmt=png"></section></section><section data-mid="" mpa-from-tpl="t"><section><span><p><br></p><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><img data-fileid="100016076" data-ratio="0.18518518518518517" data-type="png" data-w="108" data-imgfileid="100034525" data-src="https://mmbiz.qpic.cn/mmbiz_png/jvibaTuwDCBHkp4Ocd4ibfkBJqRgkiaxZ8bWqDzrhReRrRcczPEsAV9qwuhESMWxNrGaxvGiax4Jky0thTibbQNOF2A/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/jvibaTuwDCBHkp4Ocd4ibfkBJqRgkiaxZ8bWqDzrhReRrRcczPEsAV9qwuhESMWxNrGaxvGiax4Jky0thTibbQNOF2A/640?wx_fmt=png"></section><section data-mid="" mpa-from-tpl="t"><p data-mid="">往期推荐</p></section><section data-mid="" mpa-from-tpl="t"><img data-fileid="100016083" data-imgfileid="100034524" data-ratio="0.18518518518518517" data-type="png" data-w="108" data-src="https://mmbiz.qpic.cn/mmbiz_png/kjOBCbXenyDJl0zqzjZSohdOpooZGtE9t5kznNnwDxY8GftM54027Qm9wgg7V1xCAhlon8RSlxUpDZb4OTVTSQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kjOBCbXenyDJl0zqzjZSohdOpooZGtE9t5kznNnwDxY8GftM54027Qm9wgg7V1xCAhlon8RSlxUpDZb4OTVTSQ/640?wx_fmt=png"></section></section></section></section><p><br></p><p><span>分析专辑</span></p><p><br></p><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1439296529227169792&amp;__biz=Mzg2NTE1MzU4NQ==#wechat_redirect" data-linktype="2" wah-hotarea="click"><span>单细胞scRNA</span></a><span> | </span><a href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1411481499404451840&amp;__biz=Mzg2NTE1MzU4NQ==#wechat_redirect" data-linktype="2" wah-hotarea="click"><span>R包绘图</span></a><span> | </span><a href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1439276066627239937&amp;__biz=Mzg2NTE1MzU4NQ==#wechat_redirect" data-linktype="2" wah-hotarea="click"><span>免疫浸润分析</span></a><span> | </span><a href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1439317668720656387&amp;__biz=Mzg2NTE1MzU4NQ==#wechat_redirect" data-linktype="2" wah-hotarea="click"><span>肿瘤纯度评估工具</span></a><span> | </span><a href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1439303845016092674&amp;__biz=Mzg2NTE1MzU4NQ==#wechat_redirect" data-linktype="2" wah-hotarea="click"><span>数据库</span></a></p><p><br></p><p><span>文章解读专辑</span></p><p><br></p><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1320422885441306624&amp;__biz=Mzg2NTE1MzU4NQ==#wechat_redirect" data-linktype="2" wah-hotarea="click"><span>多区域进化文章精读</span></a><span> | </span><a href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1439310805396471811&amp;__biz=Mzg2NTE1MzU4NQ==#wechat_redirect" data-linktype="2" wah-hotarea="click"><span>高分文章精读</span></a><span> | </span><a href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1439284039948812289&amp;__biz=Mzg2NTE1MzU4NQ==#wechat_redirect" data-linktype="2" wah-hotarea="click"><span>免疫微环境文献解读</span></a></p><p><br></p><p><span>招聘信息</span></p><p><br></p><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2NTE1MzU4NQ==&amp;action=getalbum&amp;album_id=1905608451808903168#wechat_redirect" data-linktype="2" wah-hotarea="click"><span>招聘</span></a></p><p><br></p><p><span>点击</span><span><strong>红字</strong></span><span>即可进入专栏！</span></p></span></section><section><br></section><section><span>码字不易，欢迎读者分享或转发到朋友圈，任何公众号或其他媒体未经许可不得私自转载或抄袭。</span></section><section><span>由于微信平台算法改版，公众号内容将不再以时间排序展示，建议设置“作图丫”公众号为星标，防止丢失。星标具体步骤为：</span></section><section><span>（1）点击页面最上方“作图丫”，进入公众号主页；</span></section><section><span>（2）点击右上角的小点点，在弹出界面选择“设为星标”即可。</span></section><section><br></section></section><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><img data-fileid="100016081" data-ratio="0.9166666666666666" data-type="png" data-w="24" data-imgfileid="100034521" data-src="https://mmbiz.qpic.cn/mmbiz_png/QAeGPMg6mLHanHicMnib0MXvXH7qgdniaicCTPJANlHzicibE3sYqn1cQvV44wNW8gUstPlDakqyhPYQrABpjqPgia8cA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/QAeGPMg6mLHanHicMnib0MXvXH7qgdniaicCTPJANlHzicibE3sYqn1cQvV44wNW8gUstPlDakqyhPYQrABpjqPgia8cA/640?wx_fmt=png"></section><section data-mid="" mpa-from-tpl="t"><img data-fileid="100016084" data-ratio="0.9166666666666666" data-type="png" data-w="24" data-imgfileid="100034523" data-src="https://mmbiz.qpic.cn/mmbiz_png/gVbW22e6tKxOQhGYgU8ARXmEW82kBj8BREKtIdPibNkGZz6w3JqJCiaR8ytTQBdVOu4wlHNEVkHUShWAmoG2tr5A/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/gVbW22e6tKxOQhGYgU8ARXmEW82kBj8BREKtIdPibNkGZz6w3JqJCiaR8ytTQBdVOu4wlHNEVkHUShWAmoG2tr5A/640?wx_fmt=png"></section></section></section></section></section><p><br mpa-from-tpl="t"></p><section data-mpa-template="t" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><img data-fileid="100016085" data-ratio="1.105263157894737" data-type="png" data-w="38" data-imgfileid="100034522" data-src="https://mmbiz.qpic.cn/mmbiz_png/szwC3dO9ULQsNyxYzGuJKRIlyjU2rKCnBHc4dUKxNaE991olhpeMVR3CzWGhQtSwMl1CeMuqniclZqWMz23qFicg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/szwC3dO9ULQsNyxYzGuJKRIlyjU2rKCnBHc4dUKxNaE991olhpeMVR3CzWGhQtSwMl1CeMuqniclZqWMz23qFicg/640?wx_fmt=png"></section></section><section data-mid="" mpa-from-tpl="t"><p data-mid=""><span>点个<span data-mid="">在看</span>你最好看</span></p></section><section data-mid="" mpa-from-tpl="t"><img data-fileid="100016086" data-imgfileid="100034528" data-ratio="0.9473684210526315" data-type="gif" data-w="114" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/e04oVjfBibI5Sh4ibn3ZUnjKq2p5KiaSfeXpVxGF1lqQVM3hRA2dw87CIIjnccRRZd18xjXKTJy0MuiafNt5jU9v3g/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/e04oVjfBibI5Sh4ibn3ZUnjKq2p5KiaSfeXpVxGF1lqQVM3hRA2dw87CIIjnccRRZd18xjXKTJy0MuiafNt5jU9v3g/640?wx_fmt=gif"></section></section></section></section><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/0cWUgy0XT7Sm_NlfO1vPhQ",target="_blank" rel="noopener noreferrer">原文链接</a>
