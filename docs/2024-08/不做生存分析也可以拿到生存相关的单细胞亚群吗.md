---
title: "不做生存分析也可以拿到生存相关的单细胞亚群吗"
date: 2024-08-09T13:12:21Z
draft: ["false"]
tags: [
  "fetched",
  "珠海健明生物医药科技"
]
categories: ["Acdemic"]
---
不做生存分析也可以拿到生存相关的单细胞亚群吗 by 珠海健明生物医药科技
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>前面我们通过生存分析聚焦到了恶性增殖的亚群，详见：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526007&amp;idx=1&amp;sn=cf7e7a308ea1b968a36f7921d8aa6462&amp;scene=21#wechat_redirect" data-linktype="2">关键单细胞亚群辅助判定之生存分析</a>，而且也介绍了其实生存分析后可以做一个 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526014&amp;idx=2&amp;sn=56f7e054b33d14e344454fd991459270&amp;scene=21#wechat_redirect" data-linktype="2">最简单的统计学之取交集</a>。</p></blockquote><p data-tool="mdnice编辑器">但是这两个方法的步骤以及代码量都很多，而且都是首先需要降维聚类分群后才能去确定具体的有意义的亚群。如果我们的降维聚类分群步骤里面的亚群并不纯粹或者分群时候的分辨率选择不够好，就会面临一个问题是得到的亚群就是混杂的，因为亚群是我们的最小分析单位。我们是依据每个单细胞亚群的特异性高表达量基因去给病人样品分组后生存分析，或者跟生存分析的基因取交集。</p><p data-tool="mdnice编辑器">实际上，也是可以无需降维聚类分群，直接找生存相关的单细胞，就具体到每个细胞层面了，脱离了亚群的范畴。这里我们首先推荐Scissor，它发表在2021年Nature Biotechnology上，题为《Identifying phenotype-associated subpopulations by integrating bulk and single-cell sequencing data》 ，Scissor算法可利用单细胞数据和bulk RNA-seq数据及表型信息识别与疾病高度相关的细胞亚群。让我们来一起看看代码吧:</p><p data-tool="mdnice编辑器">首先需要安装和加载它：</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br><br><span>library</span>(Seurat)<br><span>library</span>(preprocessCore)<br><span># devtools::install_github('sunduanchen/Scissor')</span><br><span># https://api.github.com/repos/sunduanchen/Scissor/tarball/HEAD</span><br><span># devtools::install_local('~/Downloads/sunduanchen-Scissor-311560a.tar.gz')</span><br><span>library</span>(Scissor)<br><br></code></pre><h3 data-tool="mdnice编辑器"><span></span>第一步：拿到单细胞表达量矩阵对象<span></span></h3><p data-tool="mdnice编辑器">在：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247525924&amp;idx=1&amp;sn=aaa305d856a835adda2f842840b96ec2&amp;scene=21#wechat_redirect" data-linktype="2">换一个分析策略会导致文章的全部论点都得推倒重来吗</a>，我们把一个单细胞转录组数据集进行基础的降维聚类分群，并且针对里面的上皮细胞亚群进行细分亚群，而且在 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247525967&amp;idx=1&amp;sn=c0b059b4aec399bf76380b9ae9b1d4ac&amp;scene=21#wechat_redirect" data-linktype="2">肿瘤单细胞转录组拷贝数分析结果解读和应用</a>我们根据拷贝数情况判断了其中0,1,6还有cycle是恶性细胞亚群。我们就是从这个上皮细胞细分亚群里面拿到的单细胞表达量矩阵对象哈，具体的代码和文件在：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526007&amp;idx=1&amp;sn=cf7e7a308ea1b968a36f7921d8aa6462&amp;scene=21#wechat_redirect" data-linktype="2">关键单细胞亚群辅助判定之生存分析</a>可以拿到！！！</p><p data-tool="mdnice编辑器">这里我们是基于R语言的Scissor算法实现，所以拿到的单细胞表达量矩阵对象是Seurat格式的：</p><pre data-tool="mdnice编辑器"><span></span><code>load(<span>'scRNA_for_scAB_Scissor.Rdata'</span>)<br>scRNA<br>table(scRNA$celltype)<br>sce=CreateSeuratObject(<br>  counts = scRNA@assays$RNA@counts,<br>  meta.data = scRNA@meta.data<br>)<br><span># 下面的  Scissor::Seurat_preprocessing 函数需要的仅仅是表达量矩阵</span><br>sc_dataset &lt;- Scissor::Seurat_preprocessing(<br>  scRNA@assays$RNA@counts , verbose = <span>T</span>)<br>sc_dataset$celltype =  scRNA$celltype<br>DimPlot(sc_dataset, reduction = <span>'umap'</span>, <br>        label = <span>T</span>, label.size = <span>3</span>) +<br>DimPlot(sc_dataset, reduction = <span>'umap'</span>,<br>        group.by = <span>'celltype'</span>, label = <span>T</span>, label.size = <span>3</span>)<br>ggplot2::ggsave(<span>'umap_by_celltype_and_Scissor.pdf'</span>,width =<span>8</span>)<br></code></pre><p data-tool="mdnice编辑器">可以看到9个肺腺癌病人的上皮细胞被harmony整合后上皮细胞可以区分出来正常上皮细胞亚群以及一些未知的恶性肿瘤细胞亚群。</p><p data-tool="mdnice编辑器">而且可以看到不同肿瘤病人上皮细胞harmony处理与否会导致病人个体差异被抹平如果不走harmony整合，我们就需要针对每个病人研究肿瘤内部异质性如果走harmony流程，就可以研究整体异质性。。。</p><p data-tool="mdnice编辑器">下面是 harmony整合后上皮细胞 细分亚群情况：</p><p><img data-galleryid="" data-ratio="0.49537037037037035" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJRxIjAY1DCGIvyugNPoGvCVjY4WDiaDKlHwL1hYjnu1LqLTUDziaID9hH6x4PExdldezPL05EibDfQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJRxIjAY1DCGIvyugNPoGvCVjY4WDiaDKlHwL1hYjnu1LqLTUDziaID9hH6x4PExdldezPL05EibDfQ/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>harmony整合后上皮细胞</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span>然后查看bulk转录组和病人临床信息：<span></span></h3><p data-tool="mdnice编辑器">这里就是前面的代码，具体的代码和文件在：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526007&amp;idx=1&amp;sn=cf7e7a308ea1b968a36f7921d8aa6462&amp;scene=21#wechat_redirect" data-linktype="2">关键单细胞亚群辅助判定之生存分析</a>可以拿到！！！</p><pre data-tool="mdnice编辑器"><span></span><code>load(<span>"../01-tcga_luad_from_xena/tcga-luad.for_survival.rdata"</span>)<br>head(meta)<br>exprSet[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>bulk_dataset = exprSet<br>head(bulk_dataset[,<span>1</span>:<span>10</span>])<br>dim(bulk_dataset)<br>phenotype = meta[,c(<span>3</span>,<span>2</span>)]<br>colnames(phenotype)=c(<span>"time"</span>,<span>"status"</span>)<br>head(phenotype)<br>table(phenotype$status)<br>identical(colnames(bulk_dataset) ,row.names(phenotype))<br><br></code></pre><h3 data-tool="mdnice编辑器"><span></span>一句话代码运行Scissor算法<span></span></h3><p data-tool="mdnice编辑器">非常奇怪的是我自己的Mac电脑居然运行半个小时以上，但是学徒的普通电脑就一两分钟。。。。</p><p data-tool="mdnice编辑器">主要就是Scissor包Scissor函数而已，准备好单细胞对象，bulk表达量矩阵及其配对临床信息即可：</p><pre data-tool="mdnice编辑器"><span></span><code><span>## 下面是主体代码，会很耗费时间和计算机资源</span><br><span># 我的电脑超过了半个小时</span><br><span>if</span>(<span>T</span>){<br>  start_time1 &lt;- Sys.time()<br> <br>  <span># devtools::install_github('sunduanchen/Scissor')</span><br>  <span>library</span>(Seurat)<br>  <span>library</span>(Scissor)<br>  infos1 &lt;- Scissor(as.matrix(bulk_dataset), <br>                    sc_dataset, phenotype, alpha = <span>0.05</span>, <br>                    family = <span>"cox"</span>, <br>                    Save_file = <span>'./Scissor_survival.RData'</span>)<br>  <br>  end_time1 &lt;- Sys.time()<br>  execution_time1 &lt;- end_time1 - start_time1<br>  print(execution_time1)<br>}<br><br>names(infos1) <br>length(infos1$Scissor_pos) <br>infos1$Scissor_pos[<span>1</span>:<span>4</span>]<br>length(infos1$Scissor_neg) <br>infos1$Scissor_neg<br><br></code></pre><h3 data-tool="mdnice编辑器"><span></span>可视化Scissor算法结果<span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>Scissor_select &lt;- rep(<span>"Background"</span>, ncol(sc_dataset))<br>names(Scissor_select) &lt;- colnames(sc_dataset)<br>Scissor_select[infos1<span>$Scissor_pos</span>] &lt;- <span>"Scissor+"</span><br>Scissor_select[infos1<span>$Scissor_neg</span>] &lt;- <span>"Scissor-"</span><br>sc_dataset &lt;- AddMetaData(sc_dataset,<br>                          metadata = Scissor_select, <br>                          col.name = <span>"scissor"</span>)<br>table(sc_dataset<span>$scissor</span>)<br><br>p1 = DimPlot(sc_dataset, reduction = <span>'umap'</span>, group.by = <span>'scissor'</span>, <br>        cols = c(<span>'grey'</span>,<span>'royalblue'</span>,<span>'indianred1'</span>), pt.size = 1.2, order = T)<br>p1<br>p2 = DimPlot(sc_dataset, reduction = <span>'umap'</span>, group=<span>'celltype'</span>,<br>            label = T, label.size = 3)<br>p2<br>p1+p2<br><br>gplots::balloonplot(<br>  table(sc_dataset<span>$celltype</span>,sc_dataset<span>$scissor</span>)<br>)<br>save(infos1,sc_dataset,file = <span>'output_of_Scissor.Rdata'</span>)<br><br></code></pre><p data-tool="mdnice编辑器">很明显的可以看到这个Scissor算法判断的生存分析相关细胞主要是在恶性的增值细胞亚群：</p><p><img data-galleryid="" data-ratio="0.4324074074074074" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJRxIjAY1DCGIvyugNPoGv6DmIz8CpLRERZbV1CqF2agiaZWcynPLgJWJbXwrqUHh6qpiaEFbgb8KQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJRxIjAY1DCGIvyugNPoGv6DmIz8CpLRERZbV1CqF2agiaZWcynPLgJWJbXwrqUHh6qpiaEFbgb8KQ/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>在恶性的增值细胞亚群</figcaption></figure><p data-tool="mdnice编辑器">其中跟前面的：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526007&amp;idx=1&amp;sn=cf7e7a308ea1b968a36f7921d8aa6462&amp;scene=21#wechat_redirect" data-linktype="2">关键单细胞亚群辅助判定之生存分析</a>，结论是一致的，但是前面是先降维聚类分群拿到了恶性的增值细胞亚群后根据生存分析结果判断恶性的增值细胞亚群的全部细胞都是有意义，但是Scissor算法判断的是恶性的增值细胞亚群绝大部分细胞是有意义的。</p><p data-tool="mdnice编辑器">殊路同归，又有所不同！</p><h2 data-tool="mdnice编辑器">后记</h2><p data-tool="mdnice编辑器">我们按照文章的思路， 定位到了特殊的也就是具有统计学生存分析意义的亚群，详见：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247525924&amp;idx=1&amp;sn=aaa305d856a835adda2f842840b96ec2&amp;scene=21#wechat_redirect" data-linktype="2">换一个分析策略会导致文章的全部论点都得推倒重来吗</a>，但是也有其它思路可以拿到同样的结果。但是上面的代码已经是足够复杂啦，<strong>我们还是等待大家运行后我们先视频号答疑后，再分享后面的思路哈！代码会持续更新在这个链接哈，大家一定要抽空测试：</strong></p><pre data-tool="mdnice编辑器"><span></span><code>链接: https://pan.baidu.com/s/1geW1MTLRizcJWEESdjMN7g?<span>pwd</span>=96t6 提取码: 96t6<br></code></pre><p data-tool="mdnice编辑器"><strong>我们会在视频号直播互动答疑</strong></p><section><br></section><p data-tool="mdnice编辑器"><br></p></section><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526014&amp;idx=1&amp;sn=44afb387fc49b89276386e5182db7bc9&amp;chksm=9b4b26c5ac3cafd35616b2fe9df7fea664e59d75e9970feb322a477beb222ac023f7daebb3dc&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授课（买一得‍五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247522831&amp;idx=2&amp;sn=1744efdf428465425a145ff3a982198b&amp;chksm=9b4bdab4ac3c53a28fbecbbff4f254f470b54a7a20468bb753b295b930315e1ec45bcbabc10b&amp;scene=21#wechat_redirect" textvalue="144线程640Gb内存服务器共享一年‍仍然是仅需800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">144线程640Gb内存服务器共享一年仍然是仅需800</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">千呼万唤始出来的独享生物信息学云服务器</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"></a><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524275&amp;idx=1&amp;sn=fa592ee29f636f34387491d0fceadd8e&amp;chksm=9b4bdf08ac3c561e0881974b3817beb0a0e514dc1a8df4c34c2b6653da6fa78e09acb03c70c2&amp;scene=21#wechat_redirect" textvalue="生信技能树知识整理实习生又又又开放申请啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信技能树知识整理实习生又又又开放申请啦</a><span><strong>（不招了，谢谢）</strong></span></section></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524432&amp;idx=1&amp;sn=5b33b0c6807a9e6939c332c58fabff89&amp;chksm=9b4b20ebac3ca9fdb3d8bfaf2bef5552f64eb70e7fae557cc7197fb1a23b3e8bc31b585bf829&amp;scene=21#wechat_redirect" textvalue="生信共享办公室出租" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信共享办公室出租</a></p></li></ul><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/C5Hq4Xzx_MeIX5VUXMBr8g",target="_blank" rel="noopener noreferrer">原文链接</a>
