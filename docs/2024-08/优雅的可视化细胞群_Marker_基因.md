---
title: "优雅的可视化细胞群 Marker 基因"
date: 2024-08-20T02:09:35Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
优雅的可视化细胞群 Marker 基因 by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><section><br></section><p><span><span>1</span></span><span>引言</span></p><h2 data-tool="mdnice编辑器"></h2><p data-tool="mdnice编辑器"><strong>FindAllMarkers</strong> 函数来寻找每个细胞 <strong>cluster</strong> 的特异性基因,我们可以对每个 cluster 的基因绘制类似于 <strong>volcalno</strong> 的图。类似于下面这篇 <strong>NC</strong> 里的展现方式:</p><figure data-tool="mdnice编辑器"><img data-ratio="0.7467760844079718" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usewAx4TbKbPN78f5SWDmftpUAhDCT2IIcsR2HJFib7jygSucSKSn36g3KibR0quyISHyb8nLUTtauAicg/640?wx_fmt=png" data-type="png" data-w="853" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usewAx4TbKbPN78f5SWDmftpUAhDCT2IIcsR2HJFib7jygSucSKSn36g3KibR0quyISHyb8nLUTtauAicg/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">参考 <strong>生信技能树</strong> 的推文 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247509858&amp;idx=1&amp;sn=f2642039b7e4bc3f84a333ecc877da35&amp;scene=21#wechat_redirect" data-linktype="2">两个不同单细胞亚群差异分析，合并一定要做火山图</a> 。我们可以拓展一下,用这样的图来展示每个细胞类群的 <strong>Marker</strong> 基因。</p><h2 data-tool="mdnice编辑器"><span><span>2</span></span><span>加载所需 R 包</span></h2><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(ggsci)<br><span>library</span>(ggrepel)<br><span>library</span>(tidyverse)<br><span>library</span>(SeuratData)<br><span>library</span>(pbmc3k.SeuratData)<br></code></pre><h2 data-tool="mdnice编辑器"><span><span>3</span></span><span>加载内置单细胞测试数据</span></h2><p data-tool="mdnice编辑器">这是已经处理好的单细胞数据:</p><pre data-tool="mdnice编辑器"><span></span><code><span># load data</span><br>pbmc3k &lt;- LoadData(<span>"pbmc3k"</span>, type = <span>"pbmc3k.final"</span>)<br>pbmc3k &lt;- UpdateSeuratObject(object = pbmc3k)<br>pbmc3k<br><br><span># An object of class Seurat</span><br><span># 13714 features across 2638 samples within 1 assay</span><br><span># Active assay: RNA (13714 features, 2000 variable features)</span><br><span># 2 dimensional reductions calculated: pca, umap</span><br></code></pre><p data-tool="mdnice编辑器"><strong>差异分析:</strong></p><p data-tool="mdnice编辑器">这里 <strong>logfc.threshold</strong> 设置为 <strong>0</strong> :</p><pre data-tool="mdnice编辑器"><span></span><code><span># find markers</span><br>pbmc.markers &lt;- FindAllMarkers(pbmc3k, only.pos = <span>FALSE</span>,<br>                               min.pct = <span>0.25</span>,<br>                               logfc.threshold = <span>0</span>)<br><span># Calculating cluster Naive CD4 T</span><br><span>#   |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=04s</span><br><br><span># cluster markers numbers</span><br>table(pbmc.markers$cluster)<br><span># Naive CD4 T Memory CD4 T   CD14+ Mono            B        CD8 T FCGR3A+ Mono</span><br><span># 617          533          764          540          367         1035</span><br><span># NK           DC     Platelet</span><br><span># 579         1060          426</span><br><br><span># check</span><br>head(pbmc.markers,<span>3</span>)<br><span># p_val avg_log2FC pct.1 pct.2     p_val_adj     cluster  gene</span><br><span># RPS12 2.008629e-140  0.7256738 1.000 0.991 2.754633e-136 Naive CD4 T RPS12</span><br><span># RPS27 2.624075e-140  0.7242847 0.999 0.992 3.598656e-136 Naive CD4 T RPS27</span><br><span># RPS6  1.280169e-138  0.6742630 1.000 0.995 1.755623e-134 Naive CD4 T  RPS6</span><br></code></pre><h2 data-tool="mdnice编辑器"><span><span>4</span></span><span>绘图</span></h2><p data-tool="mdnice编辑器"><strong>筛选前五和后 5 的基因作为展示:</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span># top 5 genes</span><br>top5pos &lt;- pbmc.markers %&gt;% group_by(cluster) %&gt;% top_n(n = <span>5</span>, wt = avg_log2FC)<br>top5negtive &lt;- pbmc.markers %&gt;% group_by(cluster) %&gt;% top_n(n = -<span>5</span>, wt = avg_log2FC)<br><br><span># merge</span><br>top10 &lt;- rbind(top5pos,top5negtive)<br></code></pre><p data-tool="mdnice编辑器"><strong>绘图:</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span># plot</span><br>ggplot(pbmc.markers,<br>       aes(x = pct.2 - pct.1,y = avg_log2FC)) +<br>  geom_point(color = <span>'grey80'</span>) +<br>  <span># 添加水平线</span><br>  geom_hline(yintercept = c(-<span>0.25</span>,<span>0.25</span>),lty = <span>'dashed'</span>,size = <span>1</span>,color = <span>'grey50'</span>) +<br>  <span># 添加 top5pos 基因标签</span><br>  geom_text_repel(data = top5pos,<br>                   aes(x = pct.2 - pct.1,y = avg_log2FC,<br>                       label = gene,color = cluster),<br>                   show.legend = <span>F</span>,direction = <span>'y'</span>,<br>                  hjust = <span>1</span>, <span># 右对齐</span><br>                  nudge_y = <span>0.25</span>, <span># 文字竖直方向调整</span><br>                  force = <span>5</span>, <span># 文字重叠调整</span><br>                  <span># 文字靠右竖直对齐</span><br>                  nudge_x = <span>0.8</span> - (top5pos$pct.2 - top5pos$pct.1)) +<br>  <span># 添加 top5negtive 基因标签</span><br>  geom_text_repel(data = top5negtive,<br>                  aes(x = pct.2 - pct.1,y = avg_log2FC,<br>                      label = gene,color = cluster),<br>                  show.legend = <span>F</span>,direction = <span>'y'</span>,<br>                  hjust = <span>0</span>, <span># 左对齐</span><br>                  force = <span>2.5</span>, <span># 文字重叠调整</span><br>                  <span># 文字靠左竖直对齐</span><br>                  nudge_x = -<span>0.8</span> - (top5negtive$pct.2 - top5negtive$pct.1)) +<br>  <span># top10 点颜色</span><br>  geom_point(data = top10,show.legend = <span>F</span>,<br>             aes(x = pct.2 - pct.1,y = avg_log2FC,color = cluster)) +<br>  scale_color_npg(name = <span>''</span>) +<br>  <span># x y breaks label</span><br>  scale_y_continuous(limits = c(-<span>6</span>,<span>10</span>),breaks = seq(-<span>6</span>,<span>10</span>,<span>2</span>)) +<br>  scale_x_continuous(limits = c(-<span>1</span>,<span>1</span>),breaks = seq(-<span>1</span>,<span>1</span>,<span>0.5</span>)) +<br>  theme_bw(base_size = <span>14</span>) +<br>  <span># 主题调整</span><br>  theme(panel.grid = element_blank(),<br>        axis.text.x = element_text(angle = <span>45</span>,hjust = <span>1</span>),<br>        strip.background = element_rect(color = <span>NA</span>,fill = <span>'grey90'</span>)) +<br>  <span># 轴标签</span><br>  xlab(expression(Delta~<span>'Percentage Diffrence'</span>)) +<br>  ylab(<span>'Log2-Fold Change'</span>) +<br>  <span># 分面</span><br>  facet_wrap(~cluster,nrow = <span>1</span>,scales = <span>'fixed'</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.4353518821603928" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usewAx4TbKbPN78f5SWDmftpUf7LJSAf6h0PRSqGgicZ4CJl9FQU3UT4Gveo0uWlCogTSbRrW49h95zg/640?wx_fmt=png" data-type="png" data-w="1222" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usewAx4TbKbPN78f5SWDmftpUf7LJSAf6h0PRSqGgicZ4CJl9FQU3UT4Gveo0uWlCogTSbRrW49h95zg/640?wx_fmt=png"></figure><h2 data-tool="mdnice编辑器"><span><span>5</span></span><span>结尾</span></h2><blockquote data-tool="mdnice编辑器"><p>上图的横坐标是两个组基因占细胞百分比的差值。下面是文章的图例:</p></blockquote><figure data-tool="mdnice编辑器"><img data-ratio="0.1658653846153846" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usewAx4TbKbPN78f5SWDmftpUs6PGyN7veLHC0M37xuaqHfMtM8wBczuJTojHPFW4Vc6Tpk9icLCu9RA/640?wx_fmt=png" data-type="png" data-w="832" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usewAx4TbKbPN78f5SWDmftpUs6PGyN7veLHC0M37xuaqHfMtM8wBczuJTojHPFW4Vc6Tpk9icLCu9RA/640?wx_fmt=png"></figure></section><section><p><br></p><p><br></p><section data-style-type="5" data-tools="新媒体排版" data-id="2440476"><section><section><section><section><img data-ratio="0.9495798319327731" data-src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif" data-type="gif" data-w="119" data-width="100%" src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif"></section><section data-brushtype="text">往期回顾</section><section><br></section></section></section></section><section><section data-autoskip="1"><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247504160&amp;idx=1&amp;sn=298cdbc28bbf2c07c644eb568bbbbc50&amp;chksm=ea1cd7a2dd6b5eb4bb5bb69d143c7415f0dbf1a6abfc4b07fe2e750a22894dc9dceff2d43c02&amp;scene=21#wechat_redirect" textvalue="单细胞集大成者的seurat包的可视化本质上是ggplot2语法" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>单细胞集大成者的seurat包的可视化本质上是ggplot2语法</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247504075&amp;idx=1&amp;sn=385fa141bdbfc2c26d64b0e4aa485b9a&amp;chksm=ea1cd649dd6b5f5f98ba8b1ddb3084517b6c8015518354a5996791b276c1c7905d25e6a52c44&amp;scene=21#wechat_redirect" textvalue="各个单细胞亚群的差异基因数量投射到umap图" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>各个单细胞亚群的差异基因数量投射到umap图</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247504046&amp;idx=1&amp;sn=ceb6bb171d35e7522e55a3e6d38b0f22&amp;chksm=ea1cd62cdd6b5f3a98ecb931b4620fccf20d7ab213d477f9e402ea3c6b8ac414a9f8f8eddaff&amp;scene=21#wechat_redirect" textvalue="各个单细胞亚群独立在两个分组做差异分析" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>各个单细胞亚群独立在两个分组做差异分析</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247504004&amp;idx=1&amp;sn=708c6b33bdddd93a7120af8d987daeae&amp;chksm=ea1cd606dd6b5f10932791383a502bd4c53649053a0d53b9f1d2a419e470c11039b012d6ac5d&amp;scene=21#wechat_redirect" textvalue="Science: 微生物单细胞、高通量、菌株分辨率，我全都要！| 深度长文" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>Science: 微生物单细胞、高通量、菌株分辨率，我全都要！| 深度长文</span></a><br></p></section></section><hr><p><br></p></section><section data-style-type="5" data-tools="新媒体排版" data-id="2440475"><hr><p><br></p><hr><section><p>如果你对单细胞转录组研究感兴趣，但又不知道如何入门，也许你可以关注一下下面的课程<span></span></p><p><br></p><ul><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514803&amp;idx=2&amp;sn=7a1a036ce16df59d4b426ceefd8aad4d&amp;chksm=9b4bfa08ac3c731e0be86ee90638f20cd5db8589da526bc7c1ce95c09920e82760e02309afff&amp;scene=21#wechat_redirect" textvalue="生信入门课-2022年6~7月场" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">生信入门课-2022年6~7月场</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514803&amp;idx=1&amp;sn=b56f3a624a295c05ad54b47e934591bd&amp;chksm=9b4bfa08ac3c731e20598c89dfb8ffb667e49931e94ddaf0901bf4409d11d8e67cd8051c4d87&amp;scene=21#wechat_redirect" textvalue="数据挖掘（GEO,TCGA,单细胞）2022年6~7月场" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">数据挖掘（GEO,TCGA,单细胞）2022年6~7月场</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247501306&amp;idx=1&amp;sn=a38c5d2c3665ec0949649f22a8c7cd72&amp;chksm=ea1cc378dd6b4a6e1cdb72babea1fb4b232810c7656ac81963175e735a8d10a7cfae73921a16&amp;scene=21#wechat_redirect" textvalue="一个10x单细胞样品费用拿下你的专属64线程200G内存服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">一个10x单细胞样品费用拿下你的专属64线程200G内存服务器</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247501306&amp;idx=3&amp;sn=64ad5b7771462b946c74733d6e184f5e&amp;chksm=ea1cc378dd6b4a6ef6af8f0751e29c7180a7c69a96c54a94cb6163bc1d4b11daee2893102d53&amp;scene=21#wechat_redirect" textvalue="96线程384G内存服务器共享一年仅700（每月一批，循环开通账号）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">96线程384G内存服务器共享一年仅700（每月一批，循环开通账号）</a></p></li></ul><p><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif" data-type="gif" data-w="240" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif"><br></p><p><img data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg" data-type="jpeg" data-w="341" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p></section><section><section data-id="93668"><section><section data-width="95%"><section><section><section data-width="38%"><section><section data-tools="135编辑器" data-id="93668"><section><section data-width="95%"><section><section><section data-width="61.8%"><section><section><section><p><br></p><span><strong data-burshtype="text"><img data-copyright="0" data-cropselx1="0" data-cropselx2="109" data-cropsely1="0" data-cropsely2="109" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg" data-type="jpeg" data-w="430" title="qrcode_for_gh_5a3c482ed99f_1280.jpg" src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg"><strong data-burshtype="text">生物</strong><strong data-burshtype="text"> | 单细胞 | 转录组丨资料</strong></strong></span></section><section><span><strong data-burshtype="text">每天都精彩</strong></span></section></section></section><section><section><section><section><section><section><p><span>长按扫码可关注</span></p></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section><section data-support="96编辑器" data-style-id="22949"><section><section><section><br></section></section></section></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/8GVl-JFGO6Q92-jh3glK_g",target="_blank" rel="noopener noreferrer">原文链接</a>
