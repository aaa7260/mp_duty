---
title: "GSE242889-肝细胞癌微血管侵袭"
date: 2024-08-09T10:02:11Z
draft: ["false"]
tags: [
  "fetched",
  "生信漫漫学"
]
categories: ["Acdemic"]
---
GSE242889-肝细胞癌微血管侵袭 by 生信漫漫学
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span></span><span>写在开头</span><span></span></h3><p data-tool="mdnice编辑器">很久没整理直播预告了，<strong>好像最近一段时间直播分享都是直接感觉文献阅读笔记来分享的</strong>。今天正好还有点时间，对于这个数据集也存有一些疑惑，那就在直播分享之前整理一下分析的推文吧！</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100005223" data-ratio="1.3375" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobI1txEd9zzCicQPXALxt0VJH7TDPhvDhdLGfVLenT6yuWElmFyygMUWQQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="400" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobI1txEd9zzCicQPXALxt0VJH7TDPhvDhdLGfVLenT6yuWElmFyygMUWQQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">对了对了，<strong>这个月底生信技能树在南京有线下课哦，主要也是单细胞数据挖掘内容，南京的朋友可以约着见一见啦！</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100005226" data-ratio="0.4444444444444444" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobID9lGbMqFSAXFJOibIugVAwtGrulfrS52Zcia61h3nfRM2H5T9eUlYvCA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobID9lGbMqFSAXFJOibIugVAwtGrulfrS52Zcia61h3nfRM2H5T9eUlYvCA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247532373&amp;idx=1&amp;sn=047aab29412ad8257eab4ca98d7443fb&amp;scene=21#wechat_redirect" data-linktype="2">千呼万唤，让我们南京线下约起</a></p><h3 data-tool="mdnice编辑器"><span></span><span></span><span>文章概述</span><span></span></h3><p data-tool="mdnice编辑器"><strong>文章标题：</strong>《Single-cell dissection of the multicellular ecosystem and molecular features underlying microvascular invasion in HCC》</p><p data-tool="mdnice编辑器"><strong>发表日期和杂志：</strong>2023年发表在Hepatology上</p><p data-tool="mdnice编辑器"><strong>在线阅读链接：</strong>https://doi.org/10.1097%2FHEP.0000000000000673</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100005224" data-ratio="0.9210526315789473" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIY1haOiadlF7rUib8gMc8H0bH77FucziaYuia1q1aIjBzwIoD77ZjCXMxOg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="760" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIY1haOiadlF7rUib8gMc8H0bH77FucziaYuia1q1aIjBzwIoD77ZjCXMxOg/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>单细胞数据详情</span><span></span></h3><p data-tool="mdnice编辑器"><strong>数据链接是</strong>：https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE242889</p><p data-tool="mdnice编辑器"><strong>研究共收集了来自5位肝细胞癌（HCC）患者的10个独立的手术切除标本，每位患者提供了两种组织样本：一种是HCC组织，另一种是相邻的非肿瘤组织。其中3位患者存在微血管侵犯（MVI+），2位患者不存在微血管侵犯（MVI-）</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100005225" data-ratio="0.5435992578849722" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIPxc78iasBpZUAGGfXqH49QnibPZWiczzdNhYiciaO9Uh5QCC4omLHB3s1iag/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1078" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIPxc78iasBpZUAGGfXqH49QnibPZWiczzdNhYiciaO9Uh5QCC4omLHB3s1iag/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>样品详情：</strong></p><pre data-tool="mdnice编辑器"><span></span><code>GSM7774394 1NT<br>GSM7774395 2NT<br>GSM7774396 3NT<br>GSM7774397 4NT<br>GSM7774398 5NT<br>GSM7774399 1T<br>GSM7774400 2T<br>GSM7774401 3T<br>GSM7774402 4T<br>GSM7774403 5T<br><br></code></pre><p data-tool="mdnice编辑器"><strong>数据详情：</strong>提供的是tar.gz的压缩文件，下载之后解压开来里面是10X的标准三文件格式，然后使用Read10X()函数循环读取即可。</p><pre data-tool="mdnice编辑器"><span></span><code>GSM7774394_1NT_P21.tar.gz 83.3 Mb<br>GSM7774395_2NT_P24.tar.gz 102.8 Mb<br>GSM7774396_3NT_P25.tar.gz 34.4 Mb<br>GSM7774397_4NT_P29.tar.gz 173.6 Mb<br>GSM7774398_5NT_P36.tar.gz 76.3 Mb<br>GSM7774399_1T_C21.tar.gz 122.1 Mb<br>GSM7774400_2T_C24.tar.gz 208.8 Mb<br>GSM7774401_3T_C25.tar.gz 161.8 Mb<br>GSM7774402_4T_C29.tar.gz 203.0 Mb<br>GSM7774403_5T_C36.tar.gz 146.4 Mb<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100005222" data-ratio="0.3748558246828143" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIp6icHHGeqX2QSFh78A0miaxe18yicEhDDcTOfhRDCv0FCPNVmbYlAGkJA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="867" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIp6icHHGeqX2QSFh78A0miaxe18yicEhDDcTOfhRDCv0FCPNVmbYlAGkJA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>文章中分析代码：</strong>https://github.com/ZhoulabCPH/MVI_HCC</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100005229" data-ratio="0.6540930979133226" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobI2rrOuxINU867eLATDZzVJ1muEhMFkia4ewQ3icibAa8bIcqPZ9ng2PvMg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1246" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobI2rrOuxINU867eLATDZzVJ1muEhMFkia4ewQ3icibAa8bIcqPZ9ng2PvMg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">文章是提供了分析的代码，但是捏貌似是没有提供分析过程的数据文件的，所以<strong>可以参考代码进行分析，但是不能直接套用代码跑通整个流程。</strong></p><h3 data-tool="mdnice编辑器"><span></span><span></span><span>第一层次降维聚类分群</span><span></span></h3><p data-tool="mdnice编辑器"><strong>文章质控标准判断：</strong></p><p data-tool="mdnice编辑器">小提琴图显示了每个样本检测到的基因(nFeature RNA)，计数的UMIs (nCount RNA)，线粒体基因表达的检出率(百分比mt)和核糖体基因表达的检出率(百分比rb)。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100005231" data-ratio="0.627906976744186" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIP332n4DUj1IibntEQUbLrqAJPP8ndjoURI82J8KsPHLO8XLnn3TVNyw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1161" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIP332n4DUj1IibntEQUbLrqAJPP8ndjoURI82J8KsPHLO8XLnn3TVNyw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">密度图显示每个样本mt和nFeature RNA的百分比分布，红线表示质量控制阈值。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100005230" data-ratio="0.7017017017017017" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIyicE37TUOkdzP3auvRGzbITjMuzzKTHtSTP18Yv9Gfjl7DV18DiaCeyA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="999" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIyicE37TUOkdzP3auvRGzbITjMuzzKTHtSTP18Yv9Gfjl7DV18DiaCeyA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>读取数据走降维聚类分群流程，然后根据文章的阈值设置过滤标准</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>###### step1:导入数据 ######   </span><br><br><br>dir=<span>'GSE242889/'</span><br>samples=list.files( dir )<br>samples <br>sceList = lapply(samples,<span>function</span>(pro){ <br>  <span># pro=samples[1] </span><br>  <span>print</span>(pro)  <br>  tmp = Read10X(file.path(dir,pro )) <br>  <span>if</span>(length(tmp)==2){<br>    ct = tmp[[1]] <br>  }<span>else</span>{ct = tmp}<br>  sce =CreateSeuratObject(counts =  ct ,<br>                          project =  pro  ,<br>                          min.cells = 5,<br>                          min.features = 500 )<br>  <span>return</span>(sce)<br>}) <br><br>do.call(rbind,lapply(sceList, dim))<br><br>sce.all=merge(x=sceList[[1]],<br>              y=sceList[ -1 ],<br>              add.cell.ids = samples  ) <br><br>names(sce.all@assays<span>$RNA</span>@layers)<br>sce.all[[<span>"RNA"</span>]]<span>$counts</span> <br><br><span># Alternate accessor function with the same result</span><br>LayerData(sce.all, assay = <span>"RNA"</span>, layer = <span>"counts"</span>)<br>sce.all &lt;- JoinLayers(sce.all)<br><br>dim(sce.all[[<span>"RNA"</span>]]<span>$counts</span> )<br><br>as.data.frame(sce.all@assays<span>$RNA</span><span>$counts</span>[1:10, 1:2])<br>head(sce.all@meta.data, 10)<br>table(sce.all<span>$orig</span>.ident) <br><br><span># 分组信息，通常是隐含在文件名，样品名字里面</span><br>sce.all<span>$group</span>=toupper(gsub(<span>"_"</span>, <span>""</span>, substring(colnames(sce.all), 1, 3)))<br>table(sce.all@meta.data<span>$group</span>)<br><br><span>###按照患者来源</span><br>sce.all<span>$patient</span> = sce.all<span>$group</span><br>table(sce.all<span>$patient</span>)<br><span># 定义一个模式到替换值的映射</span><br>replacements &lt;- c(<span>"1NT|1T"</span> = <span>"Patient1"</span>, <span>"2NT|2T"</span> = <span>"Patient2"</span>, <span>"3NT|3T"</span> = <span>"Patient3"</span>, <span>"4NT|4T"</span> = <span>"Patient4"</span>, <span>"5NT|5T"</span> = <span>"Patient5"</span>)<br><span># 应用替换</span><br><span>for</span> (pattern <span>in</span> names(replacements)) {<br>  sce.all<span>$patient</span> = gsub(pattern, replacements[pattern], sce.all<span>$patient</span>)<br>}<br><span># 再次查看patient列</span><br>table(sce.all<span>$patient</span>)<br>table(sce.all@meta.data<span>$orig</span>.ident)<br><br><span>###### step2:QC质控 ######</span><br>dir.create(<span>"./1-QC"</span>)<br>setwd(<span>"./1-QC"</span>)<br><span># 如果过滤的太狠，就需要去修改这个过滤代码</span><br><span>source</span>(<span>'../scRNA_scripts/qc.R'</span>)<br>sce.all.filt = basic_qc(sce.all)<br><span>print</span>(dim(sce.all))<br><span>print</span>(dim(sce.all.filt))<br>setwd(<span>'../'</span>)<br><br>sp=<span>'human'</span><br><br><span>###### step3: harmony整合多个单细胞样品 ######</span><br>dir.create(<span>"2-harmony"</span>)<br>getwd()<br>setwd(<span>"2-harmony"</span>)<br><span>source</span>(<span>'../scRNA_scripts/harmony.R'</span>)<br><span># 默认 ScaleData 没有添加"nCount_RNA", "nFeature_RNA"</span><br><span># 默认的</span><br>sce.all.int = run_harmony(sce.all.filt)<br>setwd(<span>'../'</span>)<br></code></pre><p data-tool="mdnice编辑器"><strong>选择0.1的分辨率进行分群</strong></p><pre data-tool="mdnice编辑器"><span></span><code>table(Idents(sce.all.int))<br>table(sce.all.int<span>$seurat_clusters</span>)<br>table(sce.all.int<span>$RNA_snn_res</span>.0.1) <br>table(sce.all.int<span>$RNA_snn_res</span>.0.8) <br><br>getwd()<br>dir.create(<span>'check-by-0.1'</span>)<br>setwd(<span>'check-by-0.1'</span>)<br>sel.clust = <span>"RNA_snn_res.0.1"</span><br>sce.all.int &lt;- SetIdent(sce.all.int, value = sel.clust)<br>table(sce.all.int@active.ident) <br><span>source</span>(<span>'../scRNA_scripts/check-all-markers.R'</span>)<br>setwd(<span>'../'</span>) <br>getwd()<br></code></pre><p data-tool="mdnice编辑器"><strong>在整理的check-all-makers脚本里面有整理HCC相关的marker基因，所以直接基于last_markers基因集进行命名即可</strong></p><pre data-tool="mdnice编辑器"><span></span><code>last_markers = c(<span>'PTPRC'</span>, <span>'CD3D'</span>, <span>'CD3E'</span>, <span>'CD4'</span>,<span>'CD8A'</span>,<br>                   <span>'CD19'</span>, <span>'CD79A'</span>, <span>'MS4A1'</span> ,<br>                   <span>'IGHG1'</span>, <span>'MZB1'</span>, <span>'SDC1'</span>,<br>                   <span>'CD68'</span>, <span>'CD163'</span>, <span>'CD14'</span>, <br>                   <span>'TPSAB1'</span> , <span>'TPSB2'</span>,  <span># mast cells,</span><br>                   <span>'RCVRN'</span>,<span>'FPR1'</span> , <span>'ITGAM'</span> ,<br>                   <span>'C1QA'</span>,  <span>'C1QB'</span>,  <span># mac</span><br>                   <span>'S100A9'</span>, <span>'S100A8'</span>, <span>'MMP19'</span>,<span># monocyte</span><br>                   <span>'FCGR3A'</span>,<br>                   <span>'LAMP3'</span>, <span>'IDO1'</span>,<span>'IDO2'</span>,<span>## DC3 </span><br>                   <span>'CD1E'</span>,<span>'CD1C'</span>, <span># DC2</span><br>                   <span>'KLRB1'</span>,<span>'NCR1'</span>, <span># NK </span><br>                   <span>'FGF7'</span>,<span>'MME'</span>, <span>'ACTA2'</span>, <span>## human  fibo </span><br>                 <span>'GJB2'</span>, <span>'RGS5'</span>,<br>                   <span>'DCN'</span>, <span>'LUM'</span>,  <span>'GSN'</span> , <span>## mouse PDAC fibo </span><br>                   <span>'MKI67'</span> , <span>'TOP2A'</span>, <br>                   <span>'PECAM1'</span>, <span>'VWF'</span>,  <span>## endo </span><br>                 <span>"PLVAP"</span>,<span>'PROX1'</span>,<span>'ACKR1'</span>,<span>'CA4'</span>,<span>'HEY1'</span>,<br>                   <span>'EPCAM'</span> , <span>'KRT19'</span>,<span>'KRT7'</span>, <span># epi </span><br>                   <span>'FYXD2'</span>, <span>'TM4SF4'</span>, <span>'ANXA4'</span>,<span># cholangiocytes</span><br>                   <span>'APOC3'</span>, <span>'FABP1'</span>,  <span>'APOA1'</span>,  <span># hepatocytes</span><br>                   <span>'Serpina1c'</span>,<br>                   <span>'PROM1'</span>, <span>'ALDH1A1'</span> )<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100005228" data-ratio="1.0872675250357653" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIMeGLZKQRJhvnb7e3m3ELU1MjdK0v9kzWiaRsaPDHHvZhcibt6pMyJA6g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="699" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIMeGLZKQRJhvnb7e3m3ELU1MjdK0v9kzWiaRsaPDHHvZhcibt6pMyJA6g/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>基于last_marker基因集手动命名结果</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>if</span>(T){<br>  sce.all.int<br>  celltype=data.frame(ClusterID=0:9 ,<br>                      celltype= 0:9) <br>  <span>#定义细胞亚群        </span><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 0 ),2]=<span>'myeloids'</span><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c(2),2]=<span>'Tcell'</span> <br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 3),2]=<span>'macrophages'</span>  <br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 1 ),2]=<span>'hepatocytes'</span><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 4 ),2]=<span>'endothelial'</span><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 5 ),2]=<span>'Bcell'</span> <br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 6 ),2]=<span>'epithelial'</span><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 7 ),2]=<span>'cycle'</span><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 8 ),2]=<span>'myofibroblasts'</span> <br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 9 ),2]=<span>'mast'</span> <br>  <br>  head(celltype)<br>  celltype<br>  table(celltype<span>$celltype</span>)<br>  sce.all.int@meta.data<span>$celltype</span> = <span>"NA"</span><br>  <br>  <span>for</span>(i <span>in</span> 1:nrow(celltype)){<br>    sce.all.int@meta.data[<span>which</span>(sce.all.int@meta.data<span>$RNA_snn_res</span>.0.1 == celltype<span>$ClusterID</span>[i]),<span>'celltype'</span>] &lt;- celltype<span>$celltype</span>[i]}<br>  Idents(sce.all.int)=sce.all.int<span>$celltype</span><br>  <br>  sel.clust = <span>"celltype"</span><br>  sce.all.int &lt;- SetIdent(sce.all.int, value = sel.clust)<br>  table(sce.all.int@active.ident) <br>  <br>  dir.create(<span>'check-by-celltype'</span>)<br>  setwd(<span>'check-by-celltype'</span>)<br>  <span>source</span>(<span>'../scRNA_scripts/check-all-markers.R'</span>)<br>  setwd(<span>'../'</span>) <br>  getwd()<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100005227" data-ratio="0.2617801047120419" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobI6BjLRnub0wBiaNSsLIcfHFp3fUuA7ibY01Fiah6LP3LQjE7iczQcFIfnYQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1337" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobI6BjLRnub0wBiaNSsLIcfHFp3fUuA7ibY01Fiah6LP3LQjE7iczQcFIfnYQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>可视化umap结果</strong></p><pre data-tool="mdnice编辑器"><span></span><code>library(tidydr)<br><br>DimPlot(sce.all.int, reduction = <span>"umap"</span>,cols = mycolors,raster = F,<br>        label = T,repel = T)  +<br>  theme_dr(xlength = 0.22, ylength = 0.22, arrow = grid::arrow(length = unit(0.15, <span>"inches"</span>), <span>type</span> = <span>"closed"</span>))+<br>  theme(panel.grid = element_blank())<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100005233" data-ratio="0.9652631578947368" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIicQRBF5YMqnw4Gwu7YibjiaBYEwP3CbPer1zgEAlKWibpjTNATI3Hg3JbA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="950" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIicQRBF5YMqnw4Gwu7YibjiaBYEwP3CbPer1zgEAlKWibpjTNATI3Hg3JbA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>文章结果</span><span></span></h3><p data-tool="mdnice编辑器">文章中根据已知的典型标记基因鉴定出<strong>7种主要细胞类型</strong>：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100005235" data-ratio="0.8653061224489796" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIs1AMzq03P0pbiataBGPzpE6iaQt3QKu6gOe5kgumGwFgwAibAVvWia5qCA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="735" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobIs1AMzq03P0pbiataBGPzpE6iaQt3QKu6gOe5kgumGwFgwAibAVvWia5qCA/640?wx_fmt=png&amp;from=appmsg"></figure><ul data-tool="mdnice编辑器"><li><section>7,419个<strong>T/NK细胞</strong>（包括T细胞和自然杀伤细胞，以CD3E和杀伤细胞凝集素样受体D1作为标记基因）。</section></li><li><section>3,982个<strong>B细胞</strong>（以CD79A作为标记基因）</section></li><li><section>18,164个<strong>髓系细胞</strong></section></li><li><section>3,258个<strong>内皮细胞</strong></section></li><li><section>1,008个<strong>间充质细胞</strong></section></li><li><section>1,506个<strong>肝前体细胞</strong>（HPCs）</section></li><li><section>11,452个<strong>恶性细胞</strong></section></li></ul><figure data-tool="mdnice编辑器"><img data-imgfileid="100005236" data-ratio="0.5088940448569219" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobImichWriar75U7Aicx1mwkCFUt8Hvyic7R0J7G2sQia5EkQSic4M2v8yq2icaQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1293" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobImichWriar75U7Aicx1mwkCFUt8Hvyic7R0J7G2sQia5EkQSic4M2v8yq2icaQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>看起来文章命名11,452个malignant cells，emmm有点多，相反它的HPcs细胞命名的较少。感觉是将上皮细胞以及部分肝细胞命名为为恶性细胞？</strong></p><p data-tool="mdnice编辑器">文章通过分析<strong>每种细胞类型的上调基因和独特的生物学特征</strong>，进一步确认了细胞类型注释的准确性。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100005234" data-ratio="0.6620689655172414" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobI44PhbYzcw0Zua8RE2uhJ0aVUJRZT9fm2b4ick8FgXrIWBHFAdpANeyQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1595" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YmcIN5YxJnS8PakZFeoobI44PhbYzcw0Zua8RE2uhJ0aVUJRZT9fm2b4ick8FgXrIWBHFAdpANeyQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">将找到的<strong>marker基因和功能富集的结果整合到一起进行展示，还挺有意思的，文章提供了代码，我还没测试，大家感兴趣的可以试试看。</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>######## Figure 1D</span><br>top = cell_marker %&gt;% group_by(cluster) %&gt;% top_n(n = 20, wt = avg_log2FC ) <br>top = rbind(filter(top,cluster == <span>'T cell'</span>),filter(top,cluster == <span>'Myeloid'</span>),filter(top,cluster == <span>'B cell'</span>),filter(top,cluster == <span>'Endo'</span>),<br>            filter(top,cluster == <span>'Mesenchyme'</span>),filter(top,cluster == <span>'Epi'</span>),filter(top,cluster == <span>'Malignant'</span>))<br><br>exp = AverageExpression(scdata4,group.by = <span>'celltype2'</span>,features = top<span>$gene</span>)<br><br>scdata4<span>$celltype2</span> = factor(scdata4<span>$celltype2</span>,levels = c(<span>'T cell'</span>,<span>'Myeloid'</span>,<span>'B cell'</span>,<span>'Endo'</span>,<span>'Mesenchyme'</span>,<span>'Epi'</span>,<span>'Malignant'</span>))<br>exp = exp<span>$SCT</span><br>exp = exp[,c(<span>'T cell'</span>,<span>'Myeloid'</span>,<span>'B cell'</span>,<span>'Endo'</span>,<span>'Mesenchyme'</span>,<span>'Epi'</span>,<span>'Malignant'</span>)]<br>bk &lt;- c(seq(-2,2,by=0.01))<br>color = c(colorRampPalette(colors = c(<span>"white"</span>,<span>"#FEF9F7"</span>))(length(bk)/2),colorRampPalette(colors = c(<span>"#FEF9F7"</span>,<span>"#FB6848"</span>))(length(bk)/2))<br>pheatmap(exp, fontsize=6,<br>         color  = color,scale = <span>'row'</span>,<br>         border_color = <span>"grey60"</span>,border=T,<br>         cluster_cols = F, cluster_rows = F,<br>         show_rownames = F, show_colnames = T)<br><br><br>library(clusterProfiler)<br>res1 = bitr(top<span>$gene</span>,fromType=  <span>"SYMBOL"</span> ,toType=<span>"ENTREZID"</span>,OrgDb=<span>"org.Hs.eg.db"</span>)<br>rownames(res1) = res1<span>$SYMBOL</span><br>kk &lt;- enrichKEGG(res1[filter(top,cluster == <span>'T cell'</span>)<span>$gene</span> ,2], pvalueCutoff = 0.05,qvalueCutoff = 0.1)<br><br>ego_BP = data.frame()<br><span>for</span> (i <span>in</span> as.character(unique(top<span>$cluster</span>))) {<br>  ego_BP2 &lt;- enrichGO(filter(top,cluster == i)<span>$gene</span>, <br>                      OrgDb = org.Hs.eg.db,ont = <span>"BP"</span>, keyType = <span>'SYMBOL'</span>,<br>                      pAdjustMethod = <span>"BH"</span>,pvalueCutoff = 0.05,qvalueCutoff = 0.1,readable = FALSE)<br>  ego_BP2@result<span>$celltype</span> = i<br>  ego_BP = rbind(ego_BP,ego_BP2@result[1:10,])<br>}<br>ego_subset = ego_BP[c(<span>'GO:0140131'</span>,<span>'GO:0035747'</span>,<span>'GO:0010820'</span>,<span>'GO:0019886'</span>,<span>'GO:0060333'</span>,<span>'GO:0043312'</span>,<span>'GO:0050864'</span>,<span>'GO:0050853'</span>,<br>                      <span>'GO:0042113'</span>,<span>'GO:0010739'</span>,<span>'GO:0042118'</span>,<span>'GO:004544'</span>,<span>'GO:0006936'</span>,<span>'GO:0033275'</span>,<span>'GO:0030239'</span>,<span>'GO:0070268'</span>,<br>                      <span>'GO:0097284'</span>,<span>'GO:0043588'</span>,   <span>'GO:0002576'</span>,<span>'GO:0034375'</span>,<span>'GO:0072376'</span>),c(2,5,6,7,8,9,10)]<br>ego_subset<span>$log10</span> = -log10(ego_subset<span>$p</span>.adjust)<br>ego_subset<span>$Description</span> = factor(ego_subset<span>$Description</span>,levels = rev(ego_subset<span>$Description</span>))<br><br>ggplot(ego_subset, aes(x=Description, y=log10,fill = Count)) +<br>  geom_bar(position = <span>"dodge"</span>,<span>stat</span> = <span>"identity"</span>,colour=<span>"black"</span>,width= 0.6)+coord_flip()+<br>  scale_fill_gradient2(low = <span>"#EFAE95"</span>, high = <span>"#F37132"</span>)<br></code></pre></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/ZbQzfxGvUOIQ1Cj2QDlymw",target="_blank" rel="noopener noreferrer">原文链接</a>
