---
title: "R优雅绘制小样本间相关性网络图"
date: 2024-01-22T23:37:27Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
R优雅绘制小样本间相关性网络图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>最近有观众老爷询问绘制相关性分析网络图中的报错，本节就来解答如何处理这个问题，整个过程仅参考。希望对各位观众老爷能有所帮助。<strong>「数据代码已经整合上传到会员交流群」</strong>，购买过小编VIP的朋友可在所加的会员群内获取下载，有需要的朋友可关注文末介绍加入VIP交流群。</p><span>❞</span></blockquote><blockquote data-tool="mdnice编辑器"><span>❝</span><p>给予长期支持我们的忠实读者们一个特别待遇，我们提供了一个持续更新的数据可视化会员文档库。<strong>「这份文档包含数百个数据可视化文档，是学习和提升技能的理想选择」</strong>。一次性付费，您就可以长期享受到持续更新的资源，有效地提升您的R语言应用能力。</p><span>❞</span></blockquote><p data-tool="mdnice编辑器"><strong>「2024更新的绘图内容同时包含数据+代码+markdown注释文档+文档清单」</strong></p><h4 data-tool="mdnice编辑器"><span></span><span><span></span>具体问题如下</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>Error <span>in</span> rcorr(t(df), type = <span>"spearman"</span>) : must have &gt;<span>4</span> observations<br></code></pre><p data-tool="mdnice编辑器">报错信息表明rcorr函数在尝试计算Spearman相关性时遇到了问题，原因是数据中的某些变量（列）的观测值数量不足以进行相关性分析。具体来说rcorr 函数要求每个变量至少有5个观测值来计算相关性。</p><h4 data-tool="mdnice编辑器"><span></span><span><span></span>解决方案</span><span></span></h4><blockquote data-tool="mdnice编辑器"><span>❝</span><p>由于在进行实验设计时，通常多为设置3重复，若我们想分析每一组内不同样本之间的相关性就会频繁遇到这种问题，使用内置的R包则无法解决问题，因为需要我们进行自定义分析函数来进行相关性分析.</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(ggraph)<br><span>library</span>(Hmisc)<br><span>library</span>(igraph)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R函数</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>source</span>(<span>"corrr.R"</span>)<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- read_tsv(<span>"gene.xls"</span>) %&gt;% column_to_rownames(var=<span>"id"</span>) %&gt;% <br>  filter(rowSums(.) &gt;= 2)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>计算相关性</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df_cor &lt;- corrr(t(df))<br>df_cor_r &lt;- df_cor$r<br>df_cor_p &lt;- df_cor$P<br>df_cor_r[df_cor_p&gt;<span>0.05</span>|abs(df_cor_r)&lt;<span>0.7</span>] = <span>0</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>将邻接矩阵转换为边列表</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>edge_list &lt;- df_cor_r %&gt;%<br>  as_tibble(rownames = <span>"from"</span>) %&gt;%<br>  pivot_longer(cols = -from, names_to = <span>"to"</span>, values_to = <span>"weight"</span>) %&gt;%<br>  filter(weight != <span>0</span>, from != to) <span># 过滤掉权重为0的边和自环</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>创建图形</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df_igraph &lt;- graph_from_data_frame(edge_list, directed = <span>FALSE</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>提取边的权重</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df.weight &lt;- E(df_igraph)$weight<br><br>edge_attributes &lt;- tibble(weight = df.weight) %&gt;%<br>  mutate(<br>    color = case_when(<br>      weight &gt; <span>0</span> ~ <span>"#E6956F"</span>,<br>      weight &lt; <span>0</span> ~ <span>"#788FCE"</span>,<br>      <span>TRUE</span> ~ <span>"gray"</span><br>    ),<br>    width = abs(weight) * <span>2.5</span><br>  )<br><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建点数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>node_sizes &lt;- df %&gt;%<br>  rowSums() %&gt;%<br>  enframe(name = <span>"name"</span>, value = <span>"size"</span>) %&gt;%<br>  mutate(size = log10(size) * <span>2.5</span>) %&gt;%<br>  filter(name %<span>in</span>% V(df_igraph)$name)<br><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>portraits &lt;- create_layout(df_igraph, layout = <span>'circle'</span>) <br><br>ggraph(df_igraph, layout = <span>"circle"</span>)+<br>  geom_edge_arc(aes(color=color),edge_width = <span>0.4</span>,show.legend = <span>F</span>,<br>                curvature=<span>0.2</span>)+<br>  geom_node_point(aes(size=size),shape = <span>21</span>,show.legend =<span>F</span>,fill=<span>"#788FCE"</span>)+<br>  scale_edge_colour_manual(values=c(<span>"#788FCE"</span>,<span>"red"</span>))+<br><br>  theme_graph()+<br>  expand_limits(x = c(-<span>1.2</span>, <span>1.2</span>), y = c(-<span>1.2</span>, <span>1.2</span>))<br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100025528" data-ratio="1.0527777777777778" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbm6eqiaicvxuibtZuibLntl215lQFk7OiaZmkg4bvgmf0reqyLUPRMw7fpJHxhvibS0mM2ib8SOCic8BXrJA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbm6eqiaicvxuibtZuibLntl215lQFk7OiaZmkg4bvgmf0reqyLUPRMw7fpJHxhvibS0mM2ib8SOCic8BXrJA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关于永久群内容的说明</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>给予长期支持我们的忠实读者们一个特别待遇：凡是购买过小编2022年或2023年任意一年会员文档的朋友，<strong>「将自动获得2024年及以后更新的绘图文档代码，无需额外付费」</strong>。简要概括就是只要购买任意1年的会员内容，2024及后期公众号所更新的绘图文档均会在已经加入的会员群内分享。</p><span>❞</span></blockquote><p data-tool="mdnice编辑器"><strong>「购买后微信发小编订单号进行验证，即邀请进新的会员交流群」</strong>，早买早享受，需要了解更多信息的朋友欢迎淘宝店铺交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺(淘宝扫一扫)</span><span></span></h3><p><img data-galleryid="" data-imgfileid="100019415" data-ratio="1.0210420841683367" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg" data-type="jpeg" data-w="998" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"><img data-imgfileid="100025550" data-ratio="0.6175925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbm6eqiaicvxuibtZuibLntl215QVUfibB7xYOcknZEdJTO6esQYMicibgswUtYI8mT57TsqNZWRmD76qYew/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbm6eqiaicvxuibtZuibLntl215QVUfibB7xYOcknZEdJTO6esQYMicibgswUtYI8mT57TsqNZWRmD76qYew/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器"><img data-imgfileid="100025551" data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbm6eqiaicvxuibtZuibLntl215380Rc9T1MyibqGPztWVxJxuU1nJFlAqUAwicBl5XjD42wNa8icj24tblw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbm6eqiaicvxuibtZuibLntl215380Rc9T1MyibqGPztWVxJxuU1nJFlAqUAwicBl5XjD42wNa8icj24tblw/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100025554" data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbm6eqiaicvxuibtZuibLntl215jfAfdWa2ZFg39Rg4OSTAb0icfpFiapCDZ5iaXAJ5RiauBRB7qxvtsgztCA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbm6eqiaicvxuibtZuibLntl215jfAfdWa2ZFg39Rg4OSTAb0icfpFiapCDZ5iaXAJ5RiauBRB7qxvtsgztCA/640?wx_fmt=png&amp;from=appmsg"></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/xrFWUXTee5RbQGHyWL9STw",target="_blank" rel="noopener noreferrer">原文链接</a>
