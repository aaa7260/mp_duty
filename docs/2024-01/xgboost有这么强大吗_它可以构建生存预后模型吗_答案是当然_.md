---
title: "xgboost有这么强大吗？它可以构建生存预后模型吗？答案是当然！"
date: 2024-01-04T08:25:20Z
draft: ["false"]
tags: [
  "fetched",
  "生信滩"
]
categories: ["Acdemic"]
---
xgboost有这么强大吗？它可以构建生存预后模型吗？答案是当然！ by 生信滩
------
<div><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-ratio="0.4255555555555556" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSSvIICSdpb44icZIiaGqKVgS2DpQakXNlrd0TUc5e0NKChUENLl4MZ0u4n9SicwmpwGrdXBwokib1V4kQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSSvIICSdpb44icZIiaGqKVgS2DpQakXNlrd0TUc5e0NKChUENLl4MZ0u4n9SicwmpwGrdXBwokib1V4kQ/640?wx_fmt=png"></section></section></section><p>Hello! 小伙伴们大家好！我是大海哥，今天大海哥要给大家带来一个厉害的技术分享，没错！就是XGBoost！很多小伙伴一定都听说过它的名字，那这些朋友肯定要问了，XGBoost真的这么强大吗？它能构建生存预后模型吗？大海哥很明确的告诉你！可以！非常可以！</p><p><br></p><p>那么今天，我们将探讨如何使用强大的机器学习算法XGBoost构建生存预后模型，将机器学习的力量引入生物信息学领域。</p><p><br></p><p>我们都知道生物信息学是一个充满挑战的领域，涉及大量的生物学数据和复杂的数据分析。近年来，机器学习技术的飞速发展为生物信息学研究带来了新的可能性。XGBoost正是这一背景下的产物。而什么是生存预后模型呢？生存预后模型是一种用于分析患者生存时间和生存事件（如死亡或疾病复发）的统计模型。它们在医学研究和临床实践中具有重要作用，帮助医生和研究人员预测患者的生存概率，识别风险因素，并制定更有效的治疗方案。</p><p><br></p><p>分析之前呢再让我们了解一下XGBoost的原理，XGBoost是一种梯度提升算法，经常用于分类和回归任务。它的出色性能和可扩展性使其成为生存预后分析的强大工具。XGBoost通过逐步构建多个决策树来建立模型，然后将它们组合起来以获得更准确的预测。</p><p><br></p><p>先大概预览一下接下来的分析，一共五步，</p></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p>1. 数据准备</p></section></section></section><p powered-by="xiumi.us">收集和清理生物学数据，包括患者信息、基因表达数据等。</p><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p>2. 划分数据集</p></section></section></section><p powered-by="xiumi.us">将数据集分为训练集和测试集，以便评估模型性能。</p><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p>3. 特征工程</p></section></section></section><p powered-by="xiumi.us">选择和提取与预测生存相关的特征，进行数据预处理。</p><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p>4. 训练XGBoost模型</p></section></section></section><p powered-by="xiumi.us">使用XGBoost训练生存预后模型，将生存时间和生存事件作为目标变量。</p><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p>5. 模型评估</p></section></section></section><p powered-by="xiumi.us">使用不同的评估指标（如C-指数、Kaplan-Meier曲线、对数似然比检验等）来评估模型性能。</p><section><ul><li><li><li><li><li><li></ul><pre data-lang="r"><code><span><span>#正式开始！</span></span></code><code><span><span>#本次我们将使用R包中提供的survival包中的实际数据集来进行示例。一个常用的预后数据集是lung数据集，其中包含了肺癌患者的生存信息。</span></span></code><code><span><span># 加载survival包</span></span></code><code><span>library(survival)</span></code><code><span><span># 加载lung数据集</span></span></code><code><span>data(<span>"lung"</span>)</span></code></pre></section><section powered-by="xiumi.us"><section><img data-ratio="0.22127139364303178" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjST7OJ4oicQJNxwca3ISQxPCRffFia2pm9ULZmWhz3LSphx2JhxKv5IjJkrsfeStA6YCyq9IGXpqcEiaQ/640?wx_fmt=png" data-type="png" data-w="818" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjST7OJ4oicQJNxwca3ISQxPCRffFia2pm9ULZmWhz3LSphx2JhxKv5IjJkrsfeStA6YCyq9IGXpqcEiaQ/640?wx_fmt=png"></section></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="r"><code><span><span># 划分数据集为训练集和测试集</span></span></code><code><span>set.seed(<span>123</span>)</span></code><code><span>n &lt;- nrow(lung)</span></code><code><span>train_index &lt;- sample(<span>1</span>:n, <span>0.7</span> * n)</span></code><code><span>train_data &lt;- lung[train_index, ]</span></code><code><span>test_data &lt;- lung[-train_index, ]</span></code><code><span><span># 训练XGBoost模型</span></span></code><code><span>library(xgboost)</span></code><code><span>xgb_model &lt;- xgboost(data = </span></code><code><span>as.matrix(train_data[, <span>c</span>(<span>"age"</span>, <span>"sex"</span>, <span>"ph.ecog"</span>,<span>"ph.karno"</span>,<span>"pat.karno"</span>)]),</span></code><code><span>                      label = train_data$time,</span></code><code><span>                      objective = <span>"survival:cox"</span>,</span></code><code><span>                      nrounds = <span>500</span>,</span></code><code><span>                      params = <span>list</span>(</span></code><code><span>                        eta = <span>0.1</span>,</span></code><code><span>                        max_depth = <span>3</span>,</span></code><code><span>                        min_child_weight = <span>1</span>,</span></code><code><span>                        subsample = <span>0.8</span>,</span></code><code><span>                        <span>gamma</span> = <span>0.2</span></span></code><code><span>                      ))</span></code></pre></section><p powered-by="xiumi.us"><br></p><section powered-by="xiumi.us"><section><img data-ratio="0.5723270440251572" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjST7OJ4oicQJNxwca3ISQxPCRg9DZNU8siav0YUUcKZNUzG1vSz6Oqag4KvsyyLicLSiaYYiafiboWx9UG4A/640?wx_fmt=png" data-type="png" data-w="477" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjST7OJ4oicQJNxwca3ISQxPCRg9DZNU8siav0YUUcKZNUzG1vSz6Oqag4KvsyyLicLSiaYYiafiboWx9UG4A/640?wx_fmt=png"></section></section><p powered-by="xiumi.us"><br></p><section><ul><li><li></ul><pre data-lang="r"><code><span><span># 预测生存概率</span></span></code><code><span>predicted_survival &lt;- predict(xgb_model, newdata = as.matrix(test_data[, <span>c</span>(<span>"age"</span>, <span>"sex"</span>, <span>"ph.ecog"</span>,<span>"ph.karno"</span>,<span>"pat.karno"</span>)]), type = <span>"response"</span>)</span></code></pre></section><section powered-by="xiumi.us"><section><img data-ratio="0.3263598326359833" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjST7OJ4oicQJNxwca3ISQxPCRkPq8MRicnH6VyLHtU7kqLtFOG32xtriaHrEJHTfOjbaRvYl29RhIhQDg/640?wx_fmt=png" data-type="png" data-w="717" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjST7OJ4oicQJNxwca3ISQxPCRkPq8MRicnH6VyLHtU7kqLtFOG32xtriaHrEJHTfOjbaRvYl29RhIhQDg/640?wx_fmt=png"></section></section><p powered-by="xiumi.us"><br></p><section><ul><li><li><li></ul><pre data-lang="r"><code><span><span>#这个结果就是风险系数！有了这个一切都好说了</span></span></code><code><span><span># 计算C-指数</span></span></code><code><span>c_index &lt;- survConcordance(Surv(time, status) ~ predicted_survival, data = test_data)</span></code></pre></section><section powered-by="xiumi.us"><section><img data-ratio="0.630057803468208" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjST7OJ4oicQJNxwca3ISQxPCRSbHN6eYv2FhzrfJPmf8X23Pia7PTnQRH5h3onKWXENvibG3rNzfd90fg/640?wx_fmt=png" data-type="png" data-w="865" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjST7OJ4oicQJNxwca3ISQxPCRSbHN6eYv2FhzrfJPmf8X23Pia7PTnQRH5h3onKWXENvibG3rNzfd90fg/640?wx_fmt=png"></section></section><section><ul><li><li></ul><pre data-lang="r"><code><span><span>#结果不是很好，毕竟大海哥是随便选了几个指标来预测的</span></span></code><code><span><span>#看一下Integrated Brier Score (IBS)指标</span></span></code></pre></section><section powered-by="xiumi.us"><section><img data-ratio="0.5930635838150289" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjST7OJ4oicQJNxwca3ISQxPCRibrS7OxicRgQ11DLUribsFZu8nibBPNuomAkYBtjibicibJO8zButK0kMjfzQ/640?wx_fmt=png" data-type="png" data-w="865" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjST7OJ4oicQJNxwca3ISQxPCRibrS7OxicRgQ11DLUribsFZu8nibBPNuomAkYBtjibicibJO8zButK0kMjfzQ/640?wx_fmt=png"></section></section><section><ul><li><li><li></ul><pre data-lang="r"><code><span><span>#同时还可以画时间roc曲线哦！</span></span></code><code><span>y &lt;- survivalROC(Stime = test_data$time, status = test_data$status, marker = predicted_survival,</span></code><code><span>predict.time = cutoff, method = <span>"KM"</span>)</span></code></pre></section><section powered-by="xiumi.us"><section><img data-ratio="0.29596412556053814" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjST7OJ4oicQJNxwca3ISQxPCRyywm1vA8mib2jeMo0Jg5Dq6GX1ia0g3PUPhCIRU9Y0SpvfeGlgHdK9og/640?wx_fmt=png" data-type="png" data-w="223" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjST7OJ4oicQJNxwca3ISQxPCRyywm1vA8mib2jeMo0Jg5Dq6GX1ia0g3PUPhCIRU9Y0SpvfeGlgHdK9og/640?wx_fmt=png"><span></span></section></section><section><ul><li><li><li><li><li></ul><pre data-lang="r"><code><span><span><span>‍</span></span>可视化一下</span></code><code><span>plot(y$FP,y$TP,type=<span>"l"</span>,</span></code><code><span>xlim=<span>c</span>(<span>0</span>,<span>1</span>), ylim=<span>c</span>(<span>0</span>,<span>1</span>), col=<span>"red"</span>,  </span></code><code><span> xlab=paste( <span>"FP"</span>, <span>"\n"</span>, <span>"AUC = "</span>,<span>round</span>(y$AUC,<span>3</span>)),</span></code><code><span> ylab=<span>"TP"</span>,main=<span>"ROC Curve of Year=1"</span>)</span></code></pre></section><section powered-by="xiumi.us"><section><img data-ratio="0.9708222811671088" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjST7OJ4oicQJNxwca3ISQxPCRd7FK0EibU6Z7bMMKJuDTERHlrk0bUMaapbNaLmv2vN3q2SyMXGP7ibjg/640?wx_fmt=png" data-type="png" data-w="377" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjST7OJ4oicQJNxwca3ISQxPCRd7FK0EibU6Z7bMMKJuDTERHlrk0bUMaapbNaLmv2vN3q2SyMXGP7ibjg/640?wx_fmt=png"></section></section><p powered-by="xiumi.us"><br></p><section><ul><li></ul><pre data-lang="r"><code><span><span>#毕竟是随机选的特征，差点很正常，但是大海哥的目的是为了让大家学会如何使用XGBoost来构建生存预后模型，相信今天这个如此详细的分析教学，你一定可以独立完成的，快去试试！</span></span></code></pre></section><section powered-by="xiumi.us"><p>最后总结一下！XGBoost是生物信息学领域中强大的工具，可以用于构建生存预后模型以改善疾病预测和治疗。借助机器学习的力量，我们可以更深入地理解生物学数据，并为医学研究提供有力的支持。同时生存分析和XGBoost模型的结合需要深入的统计和机器学习知识，同时也需要医学领域的专业知识，以确保模型的准确性和可解释性。大家可不能像大海哥一样随便选取特征来构建模型哦！一定要有一定的理论依据，那样你的结果才可以好！自己动手试试吧！</p><p><br></p><section><section powered-by="xiumi.us"><section><img data-ratio="0.4255555555555556" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSSvIICSdpb44icZIiaGqKVgS2eqRibj7WlwYWwia4kVTGtMqCQuk2ehpjaLKTYO4GN6CE4ve6YnJFlKIw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSSvIICSdpb44icZIiaGqKVgS2eqRibj7WlwYWwia4kVTGtMqCQuk2ehpjaLKTYO4GN6CE4ve6YnJFlKIw/640?wx_fmt=png"></section></section><a title="https://mp.weixin.qq.com/s?__biz=MzAwNjE0MDY3MQ==&amp;mid=2650761303&amp;idx=2&amp;sn=6f73471d1e82c56c0b2160d0fcd32d53&amp;token=885195036&amp;lang=zh_CN&amp;scene=21#wechat_redirect" formlinkparm='"https://mp.weixin.qq.com/s?__biz=MzAwNjE0MDY3MQ==&amp;mid=2650761303&amp;idx=2&amp;sn=6f73471d1e82c56c0b2160d0fcd32d53&amp;token=885195036&amp;lang=zh_CN&amp;scene=21#wechat_redirect"' href="https://mp.weixin.qq.com/s?__biz=MzAwNjE0MDY3MQ==&amp;mid=2650761303&amp;idx=2&amp;sn=6f73471d1e82c56c0b2160d0fcd32d53&amp;token=885195036&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer" powered-by="xiumi.us" data-linktype="1"><section><section><span><img data-ratio="0.35083798882681566" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/YHGRXkSxjSSvIICSdpb44icZIiaGqKVgS2szMtDuMIXFibWW3bZNyDgar4G0dPiaMH4UvynOvicrARy7Swia4NOkxCpQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="895" src="https://mmbiz.qpic.cn/mmbiz_jpg/YHGRXkSxjSSvIICSdpb44icZIiaGqKVgS2szMtDuMIXFibWW3bZNyDgar4G0dPiaMH4UvynOvicrARy7Swia4NOkxCpQ/640?wx_fmt=jpeg"></span></section></section></a><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p>往期推荐</p></section></section><section><section powered-by="xiumi.us"><section><a title="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247485349&amp;idx=1&amp;sn=b0c7ae1a0cd12bd5e2f2b458ab166f80&amp;chksm=c24a2494f53dad82cc89979727ed426be22c8a01af31994b487bacc47dcba5d0e2ec9990b461&amp;token=437144826&amp;lang=zh_CN&amp;scene=21#wechat_redirect" formlinkparm='"https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247485349&amp;idx=1&amp;sn=b0c7ae1a0cd12bd5e2f2b458ab166f80&amp;chksm=c24a2494f53dad82cc89979727ed426be22c8a01af31994b487bacc47dcba5d0e2ec9990b461&amp;token=437144826&amp;lang=zh_CN&amp;scene=21#wechat_redirect"' href="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247485349&amp;idx=1&amp;sn=b0c7ae1a0cd12bd5e2f2b458ab166f80&amp;chksm=c24a2494f53dad82cc89979727ed426be22c8a01af31994b487bacc47dcba5d0e2ec9990b461&amp;token=437144826&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer" powered-by="xiumi.us" data-linktype="2"><section><p><br></p></section></a><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487071&amp;idx=1&amp;sn=00ff2c7c466c2612149af63fb9ef856a&amp;chksm=c24a2d6ef53da478443f1a1a5ad94e38a0dc7831ac3660bd5f883f0bf6095d3ed14ffe2564c3&amp;scene=21#wechat_redirect" textvalue="1. ‍大海哥带你一起探索什么是专为基因空间转录组数据开发的R语言包‍‍" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>1. <span>大海哥带你一起探索什么是专为基因空间转录组数据开发的R语言包</span></span></a></p></section><span>‍</span><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section><a title="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247486642&amp;idx=1&amp;sn=590952da49435d522242e016ca6327f8&amp;chksm=c24a2f83f53da6950cd2ed21ad8f3b5c5de2c416ccf803dd81b50228d5a2214d4e2f3dfc5210&amp;token=437144826&amp;lang=zh_CN&amp;scene=21#wechat_redirect" formlinkparm='"https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247486642&amp;idx=1&amp;sn=590952da49435d522242e016ca6327f8&amp;chksm=c24a2f83f53da6950cd2ed21ad8f3b5c5de2c416ccf803dd81b50228d5a2214d4e2f3dfc5210&amp;token=437144826&amp;lang=zh_CN&amp;scene=21#wechat_redirect"' href="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247486642&amp;idx=1&amp;sn=590952da49435d522242e016ca6327f8&amp;chksm=c24a2f83f53da6950cd2ed21ad8f3b5c5de2c416ccf803dd81b50228d5a2214d4e2f3dfc5210&amp;token=437144826&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer" powered-by="xiumi.us" data-linktype="2"><section><p>2.SnpEff：一个神奇的基因组变异注释工具</p></section></a><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section><a title="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247485133&amp;idx=1&amp;sn=0d88e834e7266f2cdb58b5fd0d47174b&amp;chksm=c24a25fcf53dacea63f3b2e2dfb9e834160235c5a918bc38b4ab05ab911d552788b337f825b7&amp;token=437144826&amp;lang=zh_CN&amp;scene=21#wechat_redirect" formlinkparm='"https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247485133&amp;idx=1&amp;sn=0d88e834e7266f2cdb58b5fd0d47174b&amp;chksm=c24a25fcf53dacea63f3b2e2dfb9e834160235c5a918bc38b4ab05ab911d552788b337f825b7&amp;token=437144826&amp;lang=zh_CN&amp;scene=21#wechat_redirect"' href="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247485133&amp;idx=1&amp;sn=0d88e834e7266f2cdb58b5fd0d47174b&amp;chksm=c24a25fcf53dacea63f3b2e2dfb9e834160235c5a918bc38b4ab05ab911d552788b337f825b7&amp;token=437144826&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer" powered-by="xiumi.us" data-linktype="2"><section><p><span>3. 10行代码搞定随机森林算法筛选重要基因特征</span></p></section></a><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section><a title="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247485085&amp;idx=1&amp;sn=d80ee98fd8165a8d05012a6791d05b19&amp;chksm=c24a25acf53dacba2404f1bbdd6faf528602acd925708a87d9d81ba8b00ba2d614d2006f2c46&amp;token=437144826&amp;lang=zh_CN&amp;scene=21#wechat_redirect" formlinkparm='"https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247485085&amp;idx=1&amp;sn=d80ee98fd8165a8d05012a6791d05b19&amp;chksm=c24a25acf53dacba2404f1bbdd6faf528602acd925708a87d9d81ba8b00ba2d614d2006f2c46&amp;token=437144826&amp;lang=zh_CN&amp;scene=21#wechat_redirect"' href="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247485085&amp;idx=1&amp;sn=d80ee98fd8165a8d05012a6791d05b19&amp;chksm=c24a25acf53dacba2404f1bbdd6faf528602acd925708a87d9d81ba8b00ba2d614d2006f2c46&amp;token=437144826&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer" powered-by="xiumi.us" data-linktype="2"><section><p><span>4. 想挑选最优机器学习方法？你一定不可以错过自动机器学习（AutoML）</span></p></section></a><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/t21rrsSYqXk485NGebBQcw",target="_blank" rel="noopener noreferrer">原文链接</a>
