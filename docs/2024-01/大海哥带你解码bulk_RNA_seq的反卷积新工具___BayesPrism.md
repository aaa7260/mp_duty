---
title: "大海哥带你解码bulk RNA-seq的反卷积新工具—— BayesPrism"
date: 2024-01-04T08:24:37Z
draft: ["false"]
tags: [
  "fetched",
  "生信滩"
]
categories: ["Acdemic"]
---
大海哥带你解码bulk RNA-seq的反卷积新工具—— BayesPrism by 生信滩
------
<div><p data-mpa-powered-by="yiban.io"><img data-galleryid="" data-imgfileid="100006960" data-ratio="0.2222222222222222" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/YHGRXkSxjSSTLBeSPhCR04KZicW7PMfHhBH3mG25oQUuFZhqUXXAu6zFgXCwRiaIRmu5h0YA8H6T9nxqk8J9cibFA/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_jpg/YHGRXkSxjSSTLBeSPhCR04KZicW7PMfHhBH3mG25oQUuFZhqUXXAu6zFgXCwRiaIRmu5h0YA8H6T9nxqk8J9cibFA/640?wx_fmt=jpeg&amp;from=appmsg"></p><p><span><strong><span>引言</span></strong></span></p><p><span><span>小伙伴们对CIBERSORTx去卷积的算法应该耳熟能详了吧！下面大海哥给大家介绍一下BayesPrism，一种基于贝叶斯模型的前沿技术，它巧妙地将单细胞RNA测序（scRNA-seq）作为参考谱融入Bulk RNA测序（RNA-seq）数据中，从而实现细胞类型评分和基因表达的后验分布推断。</span><span>  </span></span></p><p><span>    </span><p><span> </span></p></p><p><span><strong>介绍</strong></span></p><p><span><br></span></p><p><span>BayesPrism 利用从匹配或相似组织类型采集的样本scRNA-seq，对Bulk RNA-seq和空间转录组学进行细胞类型和基因表达去卷积。它将 scRNA-seq 作为先验信息处理，并估计细胞类型分数和细胞类型特异性基因表达在每个批次中的联合后验分布。</span></p><p><span><img data-imgfileid="100006962" data-ratio="0.4255555555555556" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4fa50pNfmlw19bmbzVsorNicVaV9W85ofNe5NeBribGMJLeMFlsicY0StoQQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4fa50pNfmlw19bmbzVsorNicVaV9W85ofNe5NeBribGMJLeMFlsicY0StoQQ/640?wx_fmt=png"></span></p><p><span><br></span></p><p><span><span>BayesPrism 由去卷积模块和嵌入学习模块组成。解卷积模块根据scRNA-seq的细胞类型特异性表达谱建立先验模型，以联合估计肿瘤（或非肿瘤）样本的大量RNA-seq表达的细胞类型组成和细胞类型特异性基因表达的后验分布。嵌入学习模块使用期望最大化（EM）技术，利用恶性基因程序的线性组合近似计算肿瘤表达量，同时以推断表达量和解卷积模块估计的非恶性细胞比例为条件。</span>    </span><page></page></p><p><span><img data-imgfileid="100006963" data-ratio="0.42962962962962964" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4faMGicx0JicHa8OaLqhxMXDR9dqrwEWXdmcpaQPpYAd4NMv8b43DSzPuPA/640?wx_fmt=png" data-type="png" data-w="1080" height="237.60000610351562" width="552.8099975585938" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4faMGicx0JicHa8OaLqhxMXDR9dqrwEWXdmcpaQPpYAd4NMv8b43DSzPuPA/640?wx_fmt=png"></span></p><p><span>          <p> </p></span></p><p><span><strong>示例</strong></span></p><p><span><br></span></p><p><span><strong><span>R包安装</span></strong></span></p><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><span>#方法一</span></span></code><code><span><br></span></code><code><span><span>library("devtools");</span></span></code><code><span><br></span></code><code><span><span>install_github("Danko-Lab/BayesPrism/BayesPrism")</span></span></code><code><span><br></span></code><code><span><span>#如果方法一报错可以下载R包到本地自行安装（https://github.com/Danko-Lab/BayesPrism）</span></span></code><code><span><span>devtools::install_local('E:/BayesPrism/BayesPrism.zip')##选择自己的路径哦！！</span></span></code></pre></section><p><br></p><p><span><strong>加载BayesPrism包</strong></span></p><section><ul><li></ul><pre><code><span><span>suppressWarnings(library(BayesPrism))</span></span></code></pre></section><p><br></p><p><span><strong>加载数据集</strong></span></p><p><span>rdata 文件存储在 "your_git_repository/tutorial.dat/tutorial.gbm.rdata"</span></p><p><span><span>地址：</span><span><span>https://github.com/Danko-Lab/BayesPrism</span><span> </span></span><span>  </span><span> </span></span></p><p><span>        </span><p><span> </span></p></p><p><span>rdata 文件包含运行 BayesPrism 所需的对象。</span></p><p><page><br></page></p><p><span>1.bk.dat：批量 RNA-seq 表达的按基因样本的原始计数矩阵。rownames是样本 ID，而 colnames是基因名称ID。</span></p><p><span><br></span></p><p><span>2.sc.dat：批量 RNA-seq 表达的逐个基因的原始计数矩阵。rownames是细胞ID，而 colnames是基因名称ID。这里大海提醒大家，如果你的sc.dat矩阵是稀疏矩阵，你应该将其转换为密集矩阵，即sc.dat &lt;- as.matrix(sc.dat)</span></p><p><span><br></span></p><p><span>3.cell.type.labels：是一个字符向量，长度与nrow(sc.dat)相同，表示sc.dat中每个细胞的类型。</span></p><p><span><br></span></p><p><span><span>4.cell.state.labels：表示sc.dat中每个细胞的亚类型。</span></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="sql"><code><span><span>#加载数据</span></span></code><code><span><span>load("../tutorial.dat/tutorial.gbm.rdata")</span></span></code><code><span><span>ls()</span></span></code><code><span><span>#查看数据1.   bk.dat</span></span></code><code><span><span>dim(bk.dat)</span></span></code><code><span><span>head(rownames(bk.dat))</span></span></code><code><span><span>head(colnames(bk.dat))</span></span></code><code><span><span>#查看数据sc.dat</span></span></code><code><span><span>dim(sc.dat)</span></span></code><code><span><span>head(rownames(sc.dat))</span></span></code><code><span><span>head(colnames(sc.dat))    </span></span></code><code><span><span>sort(table(cell.state.labels))</span></span></code><code><span><span>table(cbind.data.frame(cell.state.labels, cell.type.labels))</span></span></code></pre></section><p><br></p><p><span>• 请注意，BayesPrism 将对mixture和 scRNA-seq 参考之间共享的基因执行反卷积，即通过交叉 colnames(mixture) 和 colnames(reference)。因此，请确保使用一致的基因注释。</span></p><p><span><br></span></p><p><span>•建议使用未标准化和未转换的计数数据。当原始计数不可用时，线性归一化（例如 TPM、RPM、RPKM、FPKM）也是可以接受的，因为 BayesPrism 对于参考和mixture之间的线性乘法差异具有鲁棒性。理想情况下，如果使用标准化数据，最好提供参考并通过相同方法进行批量转换。应避免对数转换。</span></p><p><span><br></span></p><p><span>•请确保所有细胞状态包含合理数量的细胞，例如&gt;20或&gt;50。</span></p><p><span>          <p> </p></span></p><p><span><strong>细胞状态之间和细胞类型之间的相关性分析</strong></span></p><p><span><br></span></p><p><span>我们建议首先绘制细胞状态之间和细胞类型之间的成对相关矩阵。这将使我们对数据质量有所了解。在细胞类型/状态没有用足够的信息量表示的情况下（细胞计数低和/或库大小低），低质量的细胞类型/状态往往聚集在一起。用户可以以更高的置信度重新聚类数据，或者将这些单元类型/状态与最相似的单元类型/状态合并，或者删除它们（如果重新聚类和合并不合适）。</span></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="swift"><code><span><span>plot.cor.phi (input=sc.dat,</span></span></code><code><span><span>                         input.labels=cell.state.labels,</span></span></code><code><span><span>                         title="cell state correlation",</span></span></code><code><span><span>                           pdf.prefix="gbm.cor.cs", </span></span></code><code><span><span>                         cexRow=0.2, cexCol=0.2,    </span></span></code><code><span><span>                         margins=c(2,2))</span></span></code></pre></section><p><span> </span><p><span> </span></p></p><p><span><p></p></span></p><p><span>          <p> </p></span></p><p><span><img data-imgfileid="100006964" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4fa8cCVA83hPn6ZWZaMekIs1fMKwszFUmbJTToOSSSzGEquu7JCd6dpOg/640?wx_fmt=png" data-type="png" data-w="1080" height="546.4099731445312" width="546.4099731445312" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4fa8cCVA83hPn6ZWZaMekIs1fMKwszFUmbJTToOSSSzGEquu7JCd6dpOg/640?wx_fmt=png"><span>      </span><p> </p></span></p><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="swift"><code><span><span>plot.cor.phi (input=sc.dat, </span></span></code><code><span><span>                         input.labels=cell.type.labels, </span></span></code><code><span><span>                         title="cell type correlation",</span></span></code><code><span><span>                         #specify pdf.prefix if need to output to pdf</span></span></code><code><span><span>                         #pdf.prefix="gbm.cor.ct",</span></span></code><code><span><span>                         cexRow=0.5, cexCol=0.5,</span></span></code><code><span><span>                         )</span></span></code></pre></section><p><br></p><p><span><p></p></span></p><p><span>          <p> </p></span></p><p><span><img data-imgfileid="100006961" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4far4IRyTdIMVDR09m198HfmVgt0DRxm9jfGGaIQ8fkmzcOQmYWvLgIeQ/640?wx_fmt=png" data-type="png" data-w="1080" height="548.010009765625" width="548.010009765625" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4far4IRyTdIMVDR09m198HfmVgt0DRxm9jfGGaIQ8fkmzcOQmYWvLgIeQ/640?wx_fmt=png"></span></p><p><span><strong>过滤异常基因</strong></span></p><p><span><br></span></p><p><span><span>高强度表达的基因，例如核糖体蛋白基因和线粒体基因，可能主导分布并使推论产生偏差。这些基因通常无法提供区分细胞类型的信息，并且可能是大量虚假方差的来源。因此，它们可能不利于反卷积。我们建议去除这些基因。</span> </span></p><p><span>   </span><page></page></p><p><span>用户可以从 scRNA-seq 参考中可视化异常基因的分布。我们计算所有细胞类型中每个基因的平均表达和它们的细胞类型特异性得分,可视化并确定 scRNA-seq 数据中的异常基因</span></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><span>sc.stat &lt;- plot.scRNA.outlier(</span></span></code><code><span><span>  input=sc.dat, #make sure the colnames are gene symbol or ENSMEBL ID</span></span></code><code><span><span>  cell.type.labels=cell.type.labels,</span></span></code><code><span><span>  species="hs", </span></span></code><code><span><span>return.raw=TRUE #return the data used for plotting.</span></span></code><code><span><span>)</span></span></code></pre></section><p><span><br></span></p><p><span><img data-backh="346" data-backw="554" data-imgfileid="100006968" data-ratio="0.625" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4faPTAw4UxTibicWgoX7PY5f9YNJLt8RTdwCu7Davh4uhEQicyUcbaibWoGBQ/640?wx_fmt=png" data-type="png" data-w="1080" height="346.4100036621094" width="553.6099853515625" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4faPTAw4UxTibicWgoX7PY5f9YNJLt8RTdwCu7Davh4uhEQicyUcbaibWoGBQ/640?wx_fmt=png"></span></p><p><span>          <p> </p></span></p><p><span>如图所示，核糖体蛋白基因通常表现出高平均表达和低细胞类型特异性得分。</span></p><p><span><br></span></p><p><span>如果需要，用户还可以根据函数输出的统计数据对 sc.dat 中的基因进行子集化。</span></p><p><span>          <p> </p></span></p><section><ul><li></ul><pre data-lang="css"><code><span><span>head(sc.stat)</span></span></code></pre></section><p><span>sc.stat显示每个基因的归一化平均表达（x 轴）和最大特异性（y 轴）的对数，以及每个基因是否属于潜在的异常值类别。other_Rb是一组主要由核糖体假基因组成的基因。</span></p><p><span>          <p> </p></span></p><p><span>同样，我们也可以可视化来自Bulk RNA 测序的异常基因。我们计算所有细胞类型中每个基因的平均表达值的和。由于我们没有来自Bulk RNA 测序数据的细胞类型水平信息，因此我们根据 scRNA-seq 计算细胞类型特异性得分，与上述相同。</span></p><p><br></p><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><span>bk.stat &lt;- plot.bulk.outlier(</span></span></code><code><span><span>  bulk.input=bk.dat, #确保列名为基因符号或 ENSMEBL ID    </span></span></code><code><span><span>    sc.input=sc.dat, #确保列名为基因符号或 ENSMEBL ID</span></span></code><code><span><span>  cell.type.labels=cell.type.labels,</span></span></code><code><span><span>  species="hs", #currently only human(hs) and mouse(mm) annotations are supported</span></span></code><code><span><span>return.raw=TRUE</span></span></code><code><span><span>)</span></span></code></pre></section><p><br></p><section><ul><li></ul><pre data-lang="css"><code><span><span>head(bk.stat)</span></span></code></pre></section><p><br></p><p><span><img data-imgfileid="100006969" data-ratio="0.625" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4faERqjmq4icI9IPicXVAhEHv7OIx4ic0MA5VO468CDY0MJ2jQc6sFY0ias1g/640?wx_fmt=png" data-type="png" data-w="1080" height="346.4100341796875" width="553.6099853515625" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4faERqjmq4icI9IPicXVAhEHv7OIx4ic0MA5VO468CDY0MJ2jQc6sFY0ias1g/640?wx_fmt=png"></span></p><p><span><strong>从 scRNA-seq 数据中过滤异常基因</strong></span></p><p><span><br></span></p><p><span><span>接下来，我们从选定的组中删除基因。请注意，当mixture和混合物之间的性别不相同时，我们建议排除 chrX 和 chrY 中的基因。我们还删除了低转录基因，因为这些基因的转录测量往往容易受到噪音影响。去除这些基因也可以加快计算速度。</span><span>      </span></span><p><span> </span></p></p><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="cs"><code><span><span>sc.dat.filtered &lt;- cleanup.genes (input=sc.dat,</span></span></code><code><span><span>                                  input.type="count.matrix",    </span></span></code><code><span><span>                                    species="hs", </span></span></code><code><span><span>                                    gene.group=c( "Rb","Mrp","other_Rb","chrM","MALAT1","chrX","chrY") ,</span></span></code><code><span><span>                                    exp.cells=5)</span></span></code><code><span><br></span></code><code><span><span>dim(sc.dat.filtered)</span></span></code></pre></section><p><br></p><p><span>接下来，我们检查不同类型基因的基因表达的一致性。由于批量和单细胞数据通常是通过不同的实验方案收集的，因此它们对不同类型的基因可能具有不同的敏感性。</span></p><p><br></p><section><ul><li><li><li></ul><pre><code><span><span>plot.bulk.vs.sc (sc.input = sc.dat.filtered,</span></span></code><code><span><span>                            bulk.input = bk.dat</span></span></code><code><span><span>)</span></span></code></pre></section><p><br></p><p><span><img data-imgfileid="100006965" data-ratio="0.625" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4faPPegdyp6UibCxGGricoJDVXDWyo27ffFVNeYv4IgTkGCFqfOkHrZ0iaqg/640?wx_fmt=png" data-type="png" data-w="1080" height="346.4100341796875" width="553.6099853515625" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4faPPegdyp6UibCxGGricoJDVXDWyo27ffFVNeYv4IgTkGCFqfOkHrZ0iaqg/640?wx_fmt=png"></span></p><p><span><span>我们观察到蛋白质编码基因是两个测定之间最一致的组。为了减少批次效应并加快计算速度，我们对蛋白质编码基因进行反卷积。</span>    <span><p></p></span></span></p><section><ul><li><li><li></ul><pre data-lang="go"><code><span><span>##蛋白质编码基因的子集</span></span></code><code><span><span>sc.dat.filtered.pc &lt;-  select.gene.type (sc.dat.filtered,</span></span></code><code><span><span>                                        gene.type = "protein_coding")     </span></span></code></pre></section><p><br></p><p><span><p></p></span></p><p><span>我们提供了一种通过使用来自不同细胞类型的细胞状态之间的成对 t 检验执行差异表达来选择基因的函数。也可以使用其他差异表达分析。</span></p><p><br></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="cpp"><code><span><span>diff.exp.stat &lt;- get.exp.stat(sc.dat=sc.dat[,colSums(sc.dat&gt;0)&gt;3],</span></span></code><code><span><span>                              cell.type.labels=cell.type.labels,</span></span></code><code><span><span>                              cell.state.labels=cell.state.labels,</span></span></code><code><span><span>                              pseudo.count=0.1, </span></span></code><code><span><span>                              n.cores=1</span></span></code><code><span><span>)</span></span></code></pre></section><p><span>          <p> </p></span></p><p><span><span>理想情况下，我们希望为每种细胞类型选择足够数量的基因（&gt; 50）。如果没有，用户可以降低截止值。</span><span><p></p></span></span></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="xml"><code><span><span>##要根据特征基因对计数矩阵进行子集化，请执行以下操作</span></span></code><code><span><span>sc.dat.filtered.pc.sig &lt;- select.marker (sc.dat=sc.dat.filtered.pc,</span></span></code><code><span><span>stat=diff.exp.stat,</span></span></code><code><span><span>pval.max=0.01,</span></span></code><code><span><span>lfc.min=0.1)</span></span></code><code><span><span>dim(sc.dat.filtered.pc.sig)</span></span></code></pre></section><p><span>          <p> </p></span></p><p><span><strong>构造Prism对象</strong></span></p><p><span><br></span></p><p><span>Prism 对象包含运行 BayesPrism 所需的所有数据，即 scRNA-seq 参考矩阵、每行参考的细胞类型和细胞状态标签以及批量 RNA-seq 的混合矩阵。</span></p><p><span><br></span></p><p><span>当使用 scRNA-seq 计数矩阵作为输入（推荐）时，用户需要指定input.type = "count.matrix"。另一个选项input.type是"GEP"（基因表达谱），它是基因矩阵的细胞状态。当使用从其他测定得出的参考（例如排序的批量数据）时，使用此选项。</span></p><p><span><br></span></p><p><span>cell.type.labels 参数键是与恶性细胞类型相对应的字符。NULL如果没有恶性细胞或参考和混合物之间的恶性细胞来自匹配样本，则设置为，在这种情况下，所有细胞类型将被同等对待。</span></p><p><br></p><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="xml"><code><span><span>myPrism &lt;- new.prism(</span></span></code><code><span><span>reference=sc.dat.filtered.pc,</span></span></code><code><span><span>mixture=bk.dat,</span></span></code><code><span><span>input.type="count.matrix", </span></span></code><code><span><span>cell.type.labels = cell.type.labels,</span></span></code><code><span><span>cell.state.labels = cell.state.labels,</span></span></code><code><span><span>key="tumor",</span></span></code><code><span><span>outlier.cut=0.01,</span></span></code><code><span><span>outlier.fraction=0.1,</span></span></code><code><span><span>)</span></span></code></pre></section><p><span>          <p> </p></span></p><p><span><strong>运行BayesPrism</strong></span></p><p><span><br></span></p><p><span>gibbs.control可以使用和指定控制吉布斯采样和优化的参数opt.control。我们建议使用默认参数。</span></p><p><br></p><section><ul><li></ul><pre data-lang="xml"><code><span><span>bp.res &lt;- run.prism(prism = myPrism, n.cores=50)</span></span></code></pre></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="shell"><code><span><span>#&gt; Run Gibbs sampling...</span></span></code><code><span><span>#&gt; Current time:  2022-06-21 17:18:56</span></span></code><code><span><span>#&gt; Estimated time to complete:  46mins</span></span></code><code><span><span>#&gt; Estimated finishing time:  2022-06-21 18:04:15</span></span></code><code><span><span>#&gt; Start run...</span></span></code><code><span><span>#&gt; Warning in searchCommandline(parallel, cpus = cpus, type = type, socketHosts = socketHosts, : Unknown option on commandline: rmarkdown::render('/home/chut/tmp/vignette/vignettes/tutorial_deconvolution.Rmd',~+~~+~encoding~+~</span></span></code><code><span><span>#&gt; R Version:  R version 4.1.2 (2021-11-01)</span></span></code><code><span><span>#&gt; snowfall 1.84-6.1 initialized (using snow 0.4-4): parallel execution on 50 CPUs.</span></span></code><code><span><span>#&gt;</span></span></code><code><span><span>#&gt; Stopping cluster</span></span></code><code><span><span>#&gt; Update the reference matrix ...    </span></span></code><code><span><span>#&gt; Warning in searchCommandline(parallel, cpus = cpus, type = type, socketHosts = socketHosts, : Unknown option on commandline: rmarkdown::render('/home/chut/tmp/vignette/vignettes/tutorial_deconvolution.Rmd',~+~~+~encoding~+~</span></span></code><code><span><span>#&gt; snowfall 1.84-6.1 initialized (using snow 0.4-4): parallel execution on 50 CPUs.</span></span></code><code><span><span>#&gt;</span></span></code><code><span><span>#&gt;</span></span></code><code><span><span>#&gt; Stopping cluster</span></span></code><code><span><span>#&gt; Run Gibbs sampling using updated reference ...</span></span></code><code><span><span>#&gt; Current time:  2022-06-21 17:53:16</span></span></code><code><span><span>#&gt; Estimated time to complete:  17mins</span></span></code><code><span><span>#&gt; Estimated finishing time:  2022-06-21 18:10:09</span></span></code><code><span><span>#&gt; Start run...</span></span></code><code><span><span>#&gt; Warning in searchCommandline(parallel, cpus = cpus, type = type, socketHosts = socketHosts, : Unknown option on commandline: rmarkdown::render('/home/chut/tmp/vignette/vignettes/tutorial_deconvolution.Rmd',~+~~+~encoding~+~</span></span></code><code><span><span>#&gt; snowfall 1.84-6.1 initialized (using snow 0.4-4): parallel execution on 50 CPUs.</span></span></code><code><span><span>#&gt;</span></span></code><code><span><span>#&gt;     </span></span></code><code><span><span>#&gt; Stopping cluster</span></span></code></pre></section><p><span><span>        </span><span><strong>  </strong></span></span><p><span><strong> </strong></span></p></p><p><span><strong>提取结果</strong></span></p><p><span><br></span></p><p><span>BayesPrism 预计会生成以下结果</span></p><p><span><img data-imgfileid="100006966" data-ratio="0.8961038961038961" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4fahC6GmM6Tz9vB0wicU6PW3jQbJkLSd5EDAS3mbVDMQ30iaQk6wM6NMbWA/640?wx_fmt=png" data-type="png" data-w="770" height="465.0199890136719" width="519.2100219726562" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4fahC6GmM6Tz9vB0wicU6PW3jQbJkLSd5EDAS3mbVDMQ30iaQk6wM6NMbWA/640?wx_fmt=png"></span></p><p><span>          <p> </p></span></p><section><ul><li></ul><pre data-lang="css"><code><span><span>slotNames(bp.res)          </span></span></code></pre></section><p><span><p></p></span></p><p><span>我们提供了从 run.prism 输出中提取解卷积细胞类型分数和表达的实用功能。</span></p><p><br></p><section><ul><li><li><li><li><li></ul><pre data-lang="cs"><code><span><span>theta &lt;- get.fraction (bp=bp.res,</span></span></code><code><span><span>            which.theta="final",</span></span></code><code><span><span>            state.or.type="type")    </span></span></code><code><span><br></span></code><code><span><span>head(theta)</span></span></code></pre></section><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="css"><code><span><span>#&gt;                                  tumor    myeloid     pericyte endothelial        tcell        oligo</span></span></code><code><span><span>#&gt; TCGA-06-2563-01A-01R-1849-01 0.8392297 0.04329259 2.999022e-02  0.07528272 6.474488e-04 0.0115573149</span></span></code><code><span><span>#&gt; TCGA-06-0749-01A-01R-1849-01 0.7090654 0.17001073 8.995526e-07  0.01275526 1.179331e-06 0.1081665709</span></span></code><code><span><span>#&gt; TCGA-06-5418-01A-01R-1849-01 0.8625322 0.09839143 9.729268e-03  0.02416954 7.039913e-07 0.0051768589</span></span></code><code><span><span>#&gt; TCGA-06-0211-01B-01R-1849-01 0.8893449 0.04482991 1.131622e-02  0.05435490 2.508238e-06 0.0001515524</span></span></code><code><span><span>#&gt; TCGA-19-2625-01A-01R-1850-01 0.9406438 0.03546026 1.932740e-03  0.01309753 4.535897e-06 0.0088610997</span></span></code><code><span><span>#&gt; TCGA-19-4065-02A-11R-2005-01 0.6763166 0.08374439 1.849921e-01  0.01918132 3.541126e-04 0.0354114398</span></span></code></pre></section><section><ul><li><li><li></ul><pre data-lang="css"><code><span><span>theta.cv &lt;- bp.res@posterior.theta_f@theta.cv</span></span></code><code><span><br></span></code><code><span><span>head(theta.cv)</span></span></code></pre></section><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="css"><code><span><span>#&gt;                                     tumor      myeloid     pericyte endothelial      tcell       oligo</span></span></code><code><span><span>#&gt; TCGA-06-2563-01A-01R-1849-01 0.0001722829 0.0016025331 0.0026568433 0.001853843 0.05452368 0.005606057</span></span></code><code><span><span>#&gt; TCGA-06-0749-01A-01R-1849-01 0.0002333853 0.0006859332 0.8109050326 0.005683516 0.74729658 0.001276784</span></span></code><code><span><span>#&gt; TCGA-06-5418-01A-01R-1849-01 0.0001601128 0.0009389782 0.0070872942 0.004131925 0.83670176 0.011362855</span></span></code><code><span><span>#&gt; TCGA-06-0211-01B-01R-1849-01 0.0001175529 0.0014412303 0.0055064706 0.001673105 0.60905434 0.280609474</span></span></code><code><span><span>#&gt; TCGA-19-2625-01A-01R-1850-01 0.0001327408 0.0023661566 0.0335184780 0.006286823 0.73453327 0.006138184</span></span></code><code><span><span>#&gt; TCGA-19-4065-02A-11R-2005-01 0.0002862600 0.0012227981 0.0009100677 0.005660069 0.06371147 0.002243368     </span></span></code></pre></section><section><ul><li><li><li><li><li></ul><pre data-lang="cpp"><code><span><span>Z.tumor &lt;- get.exp (bp=bp.res,</span></span></code><code><span><span>                          state.or.type="type",</span></span></code><code><span><span>                          cell.name="tumor")</span></span></code><code><span><br></span></code><code><span><span>head(t(Z.tumor[1:5,]))</span></span></code></pre></section><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="css"><code><span><span>#&gt;                    TCGA-06-2563-01A-01R-1849-01 TCGA-06-0749-01A-01R-1849-01 TCGA-06-5418-01A-01R-1849-01 TCGA-06-0211-01B-01R-1849-01 TCGA-19-2625-01A-01R-1850-01</span></span></code><code><span><span>#&gt; ENSG00000130876.10                       55.980                      444.980                        9.000                       56.996                       15.996</span></span></code><code><span><span>#&gt; ENSG00000165244.6                       206.344                       38.096                      291.872                      530.732                      507.788</span></span></code><code><span><span>#&gt; ENSG00000173597.7                        17.100                        6.588                       21.804                       28.744                       10.800</span></span></code><code><span><span>#&gt; ENSG00000158022.6                         0.000                        0.476                        2.616                        0.960                        7.824</span></span></code><code><span><span>#&gt; ENSG00000167220.10                     2273.824                     1060.976                     2775.180                     2368.016                     2084.620</span></span></code><code><span><span>#&gt; ENSG00000126106.12                      678.468                      685.948                      481.000                      698.888                     1296.080</span></span></code></pre></section><p><span>          <p> </p></span></p><p><span><strong>保存结果</strong></span></p><section><ul><li></ul><pre data-lang="javascript"><code><span><span>save(bp.res, file="bp.res.rdata")              </span></span></code></pre></section><p><span><span>紧接着可以使用上述结果进行潜在的下游分析，例如：</span></span></p><p><page></page></p><section><span>•使用 DESeq2 软件包中的 vst 函数，通过 theta 或 Z 对批量样本进行聚类（Z 可通过 vst(round(t(Z.tumor))) 进行归一化）。</span></section><section><span><br></span></section><section><span>•计算相关细胞类型 Z 的特征基因 z 值。</span></section><section><span><br></span></section><section><span>•使用 theta 和 Z 进行生存分析以及与其他临床协变量的相关性分析。</span></section><section><span><br></span></section><section><span>•将 Z（使用 vst 或 bp.res@reference.update@psi_mal 进行归一化后）与 theta 相关联，以了解（恶性细胞中）每个基因的表达与肿瘤微环境中非恶性细胞的细胞类型部分的相关性，然后进行基因组富集分析</span></section><p><span>          <p> </p></span></p><p><span><strong><span>结语</span></strong></span></p><p><span><br></span></p><p><span>在这里，大海哥给大家介绍了BayesPrism。基于贝叶斯模型，对单细胞参考数据和批量数据之间的基因表达差异进行明确建模和边际化。BayesPrism 在肿瘤和非肿瘤环境下的细胞类型分数推断方面都大大优于目前的其它的方法。BayesPrism的出现为整合分析Bulk和 scRNA-seq 数据引入了一个强大的新工具。</span></p><section><p><img data-galleryid="" data-imgfileid="100006967" data-ratio="0.5555555555555556" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/YHGRXkSxjSRNic7vDHtG0kKfMdZ64pMkib09tXDhQpZf8ywJibfM2epnPxuQ10HXpuNGd2zjwYgIWbvUzvv8gP8rQ/640?wx_fmt=jpeg&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="jpeg" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_jpg/YHGRXkSxjSRNic7vDHtG0kKfMdZ64pMkib09tXDhQpZf8ywJibfM2epnPxuQ10HXpuNGd2zjwYgIWbvUzvv8gP8rQ/640?wx_fmt=jpeg&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><section powered-by="xiumi.us"><section><img data-imgfileid="100006970" data-ratio="0.4255555555555556" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4faP0RgpZvG2J0l2rdvribkN4kJibXUgib3pZYTapVibqCvGicGuUJIQmQlJEA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/YHGRXkSxjSQcBw5tfIuO4B0yEqdct4faP0RgpZvG2J0l2rdvribkN4kJibXUgib3pZYTapVibqCvGicGuUJIQmQlJEA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section><section powered-by="xiumi.us"><section><section><section><a title="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487086&amp;idx=2&amp;sn=d8271334e53ccb9b608812ca26121ae0&amp;chksm=c24a2d5ff53da4491537d6f3447c89fd38ba34a48507eda644ef1f1e606990cec13b5a38d3b1&amp;token=1072674750&amp;lang=zh_CN&amp;scene=21#wechat_redirect" formlinkparm='[{"href":"https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487086&amp;idx=2&amp;sn=d8271334e53ccb9b608812ca26121ae0&amp;chksm=c24a2d5ff53da4491537d6f3447c89fd38ba34a48507eda644ef1f1e606990cec13b5a38d3b1&amp;token=1072674750&amp;lang=zh_CN&amp;scene=21#wechat_redirect"}]' href="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487086&amp;idx=2&amp;sn=d8271334e53ccb9b608812ca26121ae0&amp;chksm=c24a2d5ff53da4491537d6f3447c89fd38ba34a48507eda644ef1f1e606990cec13b5a38d3b1&amp;token=1072674750&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer" powered-by="xiumi.us" data-linktype="2"></a></section></section></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p><br></p></section></section></section></section></section><section powered-by="xiumi.us"><section><section><section><br></section></section></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p><span>往期推荐</span></p></section></section><section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><a title="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487475&amp;idx=1&amp;sn=5cbc93791181780816095d955b9691e9&amp;chksm=c24a2cc2f53da5d453b1f16d6fd5ffe7c50a50837c4fe84fe3cd12ce0f883c981353acb29bc9&amp;token=392442812&amp;lang=zh_CN&amp;scene=21#wechat_redirect" formlinkparm='[{"href":"https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487475&amp;idx=1&amp;sn=5cbc93791181780816095d955b9691e9&amp;chksm=c24a2cc2f53da5d453b1f16d6fd5ffe7c50a50837c4fe84fe3cd12ce0f883c981353acb29bc9&amp;token=392442812&amp;lang=zh_CN&amp;scene=21#wechat_redirect"}]' href="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487475&amp;idx=1&amp;sn=5cbc93791181780816095d955b9691e9&amp;chksm=c24a2cc2f53da5d453b1f16d6fd5ffe7c50a50837c4fe84fe3cd12ce0f883c981353acb29bc9&amp;token=392442812&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer" powered-by="xiumi.us" data-linktype="2"><section><p><span>1.数据降维只会一个PCA？t-SNE和UMAP打开你的知识盲区！</span></p></section></a><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section><a title="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487448&amp;idx=1&amp;sn=ff5c0db5c808dadeb130e1fdfaf41d1f&amp;chksm=c24a2ce9f53da5ff565e5be95c2b054bc0000ed2b6ba7ae9d0374f90b01eff30f26bf4b699a9&amp;token=392442812&amp;lang=zh_CN&amp;scene=21#wechat_redirect" formlinkparm='[{"href":"https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487448&amp;idx=1&amp;sn=ff5c0db5c808dadeb130e1fdfaf41d1f&amp;chksm=c24a2ce9f53da5ff565e5be95c2b054bc0000ed2b6ba7ae9d0374f90b01eff30f26bf4b699a9&amp;token=392442812&amp;lang=zh_CN&amp;scene=21#wechat_redirect"}]' href="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487448&amp;idx=1&amp;sn=ff5c0db5c808dadeb130e1fdfaf41d1f&amp;chksm=c24a2ce9f53da5ff565e5be95c2b054bc0000ed2b6ba7ae9d0374f90b01eff30f26bf4b699a9&amp;token=392442812&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer" powered-by="xiumi.us" data-linktype="2"><section><p><span>2. 生物信息的根与枝：树状图的视觉探索</span></p></section></a><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section><a title="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487472&amp;idx=1&amp;sn=059f653c96ac5ee678be631a7d7cae28&amp;chksm=c24a2cc1f53da5d7db20cc0eb9abe5dacd7a5c343dd7bd925789d334d5128ece2455d97eb387&amp;token=392442812&amp;lang=zh_CN&amp;scene=21#wechat_redirect" formlinkparm='[{"href":"https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487472&amp;idx=1&amp;sn=059f653c96ac5ee678be631a7d7cae28&amp;chksm=c24a2cc1f53da5d7db20cc0eb9abe5dacd7a5c343dd7bd925789d334d5128ece2455d97eb387&amp;token=392442812&amp;lang=zh_CN&amp;scene=21#wechat_redirect"}]' href="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487472&amp;idx=1&amp;sn=059f653c96ac5ee678be631a7d7cae28&amp;chksm=c24a2cc1f53da5d7db20cc0eb9abe5dacd7a5c343dd7bd925789d334d5128ece2455d97eb387&amp;token=392442812&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer" powered-by="xiumi.us" data-linktype="2"><section><p><span>3. 全程一键化！基于h2o的自动机器学习过程搭建</span></p></section></a><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section><a title="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487339&amp;idx=1&amp;sn=e0a5fc14c80ea35268667ad3e6a022f8&amp;chksm=c24a2c5af53da54cf1dba9550124dbfb0deda5650c8a5ce690c481fde52aadaa6fd1a3a4693c&amp;token=1731422986&amp;lang=zh_CN&amp;scene=21#wechat_redirect" formlinkparm='[{"href":"https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487339&amp;idx=1&amp;sn=e0a5fc14c80ea35268667ad3e6a022f8&amp;chksm=c24a2c5af53da54cf1dba9550124dbfb0deda5650c8a5ce690c481fde52aadaa6fd1a3a4693c&amp;token=1731422986&amp;lang=zh_CN&amp;scene=21#wechat_redirect"}]' href="https://mp.weixin.qq.com/s?__biz=MzkzMzUwODcwMg==&amp;mid=2247487339&amp;idx=1&amp;sn=e0a5fc14c80ea35268667ad3e6a022f8&amp;chksm=c24a2c5af53da54cf1dba9550124dbfb0deda5650c8a5ce690c481fde52aadaa6fd1a3a4693c&amp;token=1731422986&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer" powered-by="xiumi.us" data-linktype="2"><section><p><span>4.单个模型ROC好画，多个机器学习模型ROC你会画吗？</span></p></section></a><section powered-by="xiumi.us"><section><span> <p> </p></span><span>    </span></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/fRbq1s2KjE4XqGm_rGnslg",target="_blank" rel="noopener noreferrer">原文链接</a>
