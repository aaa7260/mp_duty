---
title: "假如你的两个分组真的就是都有且仅有一个样品该如何做差异分析呢"
date: 2024-01-25T10:30:47Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
假如你的两个分组真的就是都有且仅有一个样品该如何做差异分析呢 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>前面的教程：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247508820&amp;idx=1&amp;sn=1aec4f8dcbc6c105a114496054369008&amp;scene=21#wechat_redirect" data-linktype="2">把火山图做成烟花图</a> ，我们批评了一个学员做差异分析时候的错误的思路，就是把每个分组里面的单个样品简单粗暴的复制粘贴3次充当生物学重复，会导致计算得到的p值如此的诡异。</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code>exprSet=cbind(<br>  exprSet[,<span>1</span>:<span>2</span>],<br>  exprSet[,<span>1</span>:<span>2</span>],<br>  exprSet[,<span>1</span>:<span>2</span>],<br>  exprSet[,<span>1</span>:<span>2</span>]<br>) <br>colnames(exprSet)=<span>1</span>:<span>8</span> <br></code></pre><p data-tool="mdnice编辑器">那么， 假如你的两个分组真的就是都有且仅有一个样品，你该如何进行差异分析呢？</p><p data-tool="mdnice编辑器">当然也是有办法的，大家在前面的教程：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247508820&amp;idx=1&amp;sn=1aec4f8dcbc6c105a114496054369008&amp;scene=21#wechat_redirect" data-linktype="2">把火山图做成烟花图</a> 也看到了大量的留言给出了解决方案！我们就摘选其中最简单的edgeR包来分享一下。</p><h3 data-tool="mdnice编辑器"><span></span>首先仍然是从查看表达量矩阵和分组信息<span></span></h3><p data-tool="mdnice编辑器">这个时候需要参考前面的教程：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247508820&amp;idx=1&amp;sn=1aec4f8dcbc6c105a114496054369008&amp;scene=21#wechat_redirect" data-linktype="2">把火山图做成烟花图</a> ，自己制作  Step01-airwayData.Rdata 这个文件，它里面存储了表达量矩阵和分组信息：</p><pre data-tool="mdnice编辑器"><span></span><code><br>rm(list = ls())<br>options(stringsAsFactors = <span>F</span>) <br><span># 读取基因表达矩阵信息</span><br>lname &lt;- load(file = <span>"./data/Step01-airwayData.Rdata"</span>)<br>lname  <br><span># 查看分组信息和表达矩阵数据</span><br>exprSet &lt;- filter_count<br>dim(exprSet)<br>exprSet[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>group_list<br>table(group_list)<br><span># 加载包</span><br><span>library</span>(DESeq2)<br>exprSet = exprSet[,<span>1</span>:<span>2</span>]<br>group_list=group_list[<span>1</span>:<span>2</span>]<br></code></pre><p data-tool="mdnice编辑器">可以看到的是，我们简单粗暴的选取了这个表达量矩阵的前两个样品而已。这样的话，我们的两个分组就各自都有且仅有一个样品啦，这样的无生物学重复的实验设计其实也可以勉强做差异分析。</p><h3 data-tool="mdnice编辑器"><span></span>使用 edgeR包 设置 bcv参数来做无重复的差异分析<span></span></h3><p data-tool="mdnice编辑器">代码很简单， 如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#加载包</span><br><span>library</span>(edgeR) <br><span>#设置分组信息</span><br>exprSet &lt;- DGEList(counts = exprSet, group = group_list)<br>bcv = <span>0.1</span><span>#设置bcv为0.1</span><br>et &lt;- exactTest(exprSet, dispersion=bcv^<span>2</span>)<br>DEG_edgeR=as.data.frame(topTags(et, n = nrow(exprSet$counts)))<br>head(DEG_edgeR)<br>write.csv(DEG_edgeR, <span>'single-sample-deg-result.csv'</span>, quote = <span>FALSE</span>)<br></code></pre><p data-tool="mdnice编辑器">前面的教程：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247508820&amp;idx=1&amp;sn=1aec4f8dcbc6c105a114496054369008&amp;scene=21#wechat_redirect" data-linktype="2">把火山图做成烟花图</a> 里面我们展示了 DEseq2和limma两个包，这个时候又出来了  edgeR包 ，其实就大满贯啦。转录组差异分析最常用的3个包，就是它们了。</p><h3 data-tool="mdnice编辑器"><span></span>仍然是绘制火山图<span></span></h3><p data-tool="mdnice编辑器">代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#筛选上下调，设定阈值</span><br>fc_cutoff &lt;- <span>1.5</span><br>pvalue &lt;- <span>0.05</span><br>DEG_edgeR$regulated &lt;- <span>"normal"</span><br>loc_up &lt;- intersect(which(DEG_edgeR$logFC&gt;log2(fc_cutoff)),<br>                    which(DEG_edgeR$PValue&lt;pvalue))<br>loc_down &lt;- intersect(which(DEG_edgeR$logFC &lt; (-log2(fc_cutoff))),<br>                      which(DEG_edgeR$PValue&lt;pvalue))<br>DEG_edgeR$regulated[loc_up] &lt;- <span>"up"</span><br>DEG_edgeR$regulated[loc_down] &lt;- <span>"down"</span> <br>head(DEG_edgeR)<br><span>library</span>(AnnoProbe)<br>ag=annoGene(rownames(DEG_edgeR),<br>            ID_type = <span>'ENSEMBL'</span>,species = <span>'human'</span><br>)<br>head(ag)<br>DEG_edgeR$ENSEMBL=rownames(DEG_edgeR)<br><br>deg_anno=merge(ag,DEG_edgeR,by=<span>'ENSEMBL'</span>)<br>head(deg_anno)<br><span>library</span>(EnhancedVolcano)<br>colnames(deg_anno)<br>EnhancedVolcano(deg_anno,<br>                lab =deg_anno$SYMBOL,<br>                x = <span>'logFC'</span>,<br>                y = <span>'FDR'</span>)<br></code></pre><p data-tool="mdnice编辑器">出图如下所示：</p><p><img data-galleryid="" data-ratio="0.5489773950484392" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwICW1xhRb6T85ngZFibsAVzFLLtUZzicdwEMPRsxGufcicmaBuIOLJS9QqwoFAIYDPRqFDUsLVuJvOA/640?wx_fmt=png" data-type="png" data-w="1858" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwICW1xhRb6T85ngZFibsAVzFLLtUZzicdwEMPRsxGufcicmaBuIOLJS9QqwoFAIYDPRqFDUsLVuJvOA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>正常火山图</figcaption></figure><p data-tool="mdnice编辑器">可以看到这个时候的火山图其实是非常正常的！</p><h3 data-tool="mdnice编辑器"><span></span>可以跟原始的差异分析做对比<span></span></h3><p data-tool="mdnice编辑器">首先查看两次差异分析：</p><pre data-tool="mdnice编辑器"><span></span><code>reulsts_edgeR = deg_anno<br>colnames(reulsts_edgeR)<br>load( file = <span>"./data/Step03-DESeq2_nrDEG.Rdata"</span>)<br>reulsts_DEseq2 = deg_anno<br>colnames(reulsts_DEseq2)<br><br>df=merge(reulsts_edgeR[,c(<span>1</span>,<span>2</span>,<span>7</span>,<span>10</span>,<span>11</span>)],<br>      reulsts_DEseq2[,c(<span>1</span>,<span>8</span>,<span>12</span>,<span>13</span>)],<br>      by=<span>'ENSEMBL'</span>)<br>table(df$regulated.x,df$regulated.y)<br></code></pre><p data-tool="mdnice编辑器">如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; colnames(reulsts_edgeR)<br> [1] <span>"ENSEMBL"</span>   <span>"SYMBOL"</span>    <span>"biotypes"</span>  <span>"chr"</span>       <span>"start"</span>     <span>"end"</span>      <br> [7] <span>"logFC"</span>     <span>"logCPM"</span>    <span>"PValue"</span>    <span>"FDR"</span>       <span>"regulated"</span> <br>&gt; colnames(reulsts_DEseq2)<br> [1] <span>"ENSEMBL"</span>        <span>"SYMBOL"</span>         <span>"biotypes"</span>       <span>"chr"</span>           <br> [5] <span>"start"</span>          <span>"end"</span>            <span>"baseMean"</span>       <span>"log2FoldChange"</span><br> [9] <span>"lfcSE"</span>          <span>"stat"</span>           <span>"pvalue"</span>         <span>"padj"</span>          <br>[13] <span>"regulated"</span>   <br></code></pre><p data-tool="mdnice编辑器">需要把两个差异分析结果矩阵合并，然后对比！</p><pre data-tool="mdnice编辑器"><span></span><code>       down normal    up<br>  down       0    355   670<br>  normal   424  13643   860<br>  up       719    789     0<br></code></pre><p data-tool="mdnice编辑器">可以看到， 上下调居然是反过来了，哈哈哈，可能是前面的代码没有设置因子。</p><p data-tool="mdnice编辑器">我们可以散点图更加直观查看，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggplot2)<br><span>library</span>(ggpubr)<br><span>library</span>(ggstatsplot)<br>p &lt;- ggplot(df, aes(x=df$logFC,<br>                    df$log2FoldChange))+    <br>  geom_point()+<br>  labs(x = <span>"logFC"</span>,<br>       y = <span>"log2FoldChange"</span>)+<br>  scale_color_manual(values=c(<span>"blue"</span>, <span>"grey"</span>,<span>"red"</span>))+<br>  geom_vline(xintercept = c( -<span>1.5</span>,<span>0</span>,<span>1.5</span>),lty=<span>4</span>,col=<span>"#ec183b"</span>,lwd=<span>0.8</span>) +<br>  geom_hline(yintercept = c(-<span>1.5</span>,<span>0</span>,<span>1.5</span> ),lty=<span>4</span>,col=<span>"#18a5ec"</span>,lwd=<span>0.8</span>) +<br>  <span>#xlim(-5,5)+</span><br>  <span>#ylim(-3,3)+</span><br>  theme_ggstatsplot()+<br>  theme(panel.grid.minor = element_blank(),<br>        panel.grid.major = element_blank())<br>p <br><br></code></pre><p data-tool="mdnice编辑器">效果如下：</p><p><img data-galleryid="" data-ratio="0.5678879310344828" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwICW1xhRb6T85ngZFibsAVz73M0ZMqyCbVNVxJe4LF7csG0gHPDIAYLmShugaWMau9wiaDEn7TEctQ/640?wx_fmt=png" data-type="png" data-w="1856" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwICW1xhRb6T85ngZFibsAVz73M0ZMqyCbVNVxJe4LF7csG0gHPDIAYLmShugaWMau9wiaDEn7TEctQ/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>散点图更加直观查看两个差异分析结果的对比</figcaption></figure><p data-tool="mdnice编辑器">还有个韦恩图，也可以查看两次差异分析结果的区别：</p><p data-tool="mdnice编辑器">代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><br><span>library</span>(data.table)<br><span>library</span>(ggplot2)<br><span>library</span>(ggstatsplot)<br><span>library</span>(ggvenn)<br><br>a &lt;- list( <span>'edgeR_up'</span>=split(df$ENSEMBL,df$regulated.x)$up,<br>           <span>'edgeR_down'</span>=split(df$ENSEMBL,df$regulated.x)$down,<br>           <span>'DEseq2_up'</span>=split(df$ENSEMBL,df$regulated.y)$up,<br>           <span>'DEseq2_down'</span>=split(df$ENSEMBL,df$regulated.y)$down<br>          )<br>p1 &lt;- ggvenn(a, <br>             fill_alpha = <span>0.9</span>,<br>             fill_color = c(<span>'#7fc97f'</span>,<span>'#beaed4'</span>,<span>'#fdc086'</span>,<span>'#ffff99'</span>),<br>             set_name_size = <span>5</span>,<br>             stroke_size = <span>0.5</span>) <br>p1<br><br><br><br></code></pre><p data-tool="mdnice编辑器">出图如下：</p><p><img data-galleryid="" data-ratio="0.6952054794520548" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwICW1xhRb6T85ngZFibsAVzTUBsHoMs24ruicfqKXFjib3rT8bxQgxP89bNpS655Zq3JhRZCQLxQyFg/640?wx_fmt=png" data-type="png" data-w="1168" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwICW1xhRb6T85ngZFibsAVzTUBsHoMs24ruicfqKXFjib3rT8bxQgxP89bNpS655Zq3JhRZCQLxQyFg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>韦恩图查看两次 差异分析的结果的区别</figcaption></figure><p data-tool="mdnice编辑器">因为我们前面两次 差异分析的因子没有设置，所以这个上下调是反过来的，但是仍然是可以看到，两次差异分析的结果的一致性比较好！</p><h4 data-tool="mdnice编辑器"><span></span>学徒作业<span></span></h4><p data-tool="mdnice编辑器">运行我的代码，把因子设置好，重新进行散点图，韦恩图的绘制！</p></section><h3 data-tool="mdnice编辑器">文末友情推荐</h3><p data-tool="mdnice编辑器">与十万人一起学生信，你值得拥有下面的学习班：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247508762&amp;idx=1&amp;sn=c411bc6007b02e1828235317465fa458&amp;chksm=9b4be3a1ac3c6ab7e649381f828aace86ac811e3edcd152a0a981118d39af4cd87260933b2dc&amp;scene=21#wechat_redirect" textvalue="数据挖掘（GEO,TCGA,单细‍胞）2021第9期" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">数据挖掘（GEO,TCGA,单细胞）2021第10期</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247508762&amp;idx=2&amp;sn=d1eb0963f32da5ca35a6d873658d0179&amp;chksm=9b4be3a1ac3c6ab78521bec4b27b380f6f560cf8feaabdb744e545e8c7aa2bcfa007fc27dd0d&amp;scene=21#wechat_redirect" textvalue="生信爆款入门-2021第‍9期" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">生信爆款入门-2021第9期</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247508448&amp;idx=1&amp;sn=3283fafda88479411c6fab4e54166fa0&amp;chksm=9b4be15bac3c684d6e9b5c245ce759491c54ab97f39517b266f4d9e9a68f65f2dba56b910a5b&amp;scene=21#wechat_redirect" textvalue="（千呼万唤始出来）生信技能树知识整理实习生在哪里" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">（千呼万唤始出来）生信技能树知识整理实习生在哪里</a></section></li></ul><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/A0H_i1SIoPiqT4aOv9IkOw",target="_blank" rel="noopener noreferrer">原文链接</a>
