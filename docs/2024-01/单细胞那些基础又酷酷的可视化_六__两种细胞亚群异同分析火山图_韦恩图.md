---
title: "单细胞那些基础又酷酷的可视化（六）：两种细胞亚群异同分析火山图+韦恩图"
date: 2024-01-31T09:52:11Z
draft: ["false"]
tags: [
  "fetched",
  "生信作曲家"
]
categories: ["Acdemic"]
---
单细胞那些基础又酷酷的可视化（六）：两种细胞亚群异同分析火山图+韦恩图 by 生信作曲家
------
<div><section><h3><span>前言</span></h3><blockquote><p><span><span>生信作曲家一直致力于构建国内</span><span><strong>和谐、开放、可持续</strong></span><span><strong>的生物信息交流平台</strong>。生信作曲家的目标是<strong>为每个科研人扫清科研路上的一切障碍，让生物信息学人人可做</strong>。目前，生信作曲家已推出</span><span><strong>"</strong><strong>跟着一区文章学通机器学习”、</strong></span><span><strong>"</strong><strong>跟着一区文章学通单细胞</strong><strong>"、"空间转录组从入门到精通”、孟德尔随机化实战”</strong><span><strong>、</strong></span><strong>Bootstrap<span><strong>、</strong></span>NATMI、CIBERSORTx、hdWGCNA、NTP、metaVIPER算法</strong></span><span>等多种强力教程，同时也兼具数据整理、可视化等核心入门技术教学，开办</span></span><strong><span>单细胞孟德尔发文计划MR、</span></strong><span><span><strong>肿瘤发文计划RS、max，非肿瘤发文计划note、ultra、pro、时空百宝箱计划sp</strong><strong>和五一创新发文计划pro</strong></span><span><strong>等、生信中秋分享会、小年夜分享会、暑期集训营和冬季集训营</strong>等多次。辅导同学实现纯生信SCI发表硕果累累，帮助同学实现医学事业路上的理想与追求。</span></span></p></blockquote><p>尝试复现一张火山图+韦恩图，本图指的是单细胞两种细胞亚群的<strong>分别各自对比对照组上调基因</strong>和<strong>共同相比某组上调的基因</strong>！</p><p>例如，我们将肿瘤相关巨噬细胞分成了geneA+巨噬，geneB+巨噬，我们可以考虑这两群巨噬相比于normal样本的巨噬有什么异同</p><figure><p><br></p></figure><p><img data-galleryid="" data-imgfileid="100004875" data-ratio="0.5685185185185185" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaAfKXmKx035ITFiapV2yQO6PYmR9jswwialPdrPCY3LibP882ibryCsbIb9ntxWO5CcWxj8YRlqzYGBMg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaAfKXmKx035ITFiapV2yQO6PYmR9jswwialPdrPCY3LibP882ibryCsbIb9ntxWO5CcWxj8YRlqzYGBMg/640?wx_fmt=png&amp;from=appmsg"></p><h3><span>代码实操</span></h3><pre><code>scRNA=readRDS(<span>'F:/double_eqtl/scRNA_T.RDS'</span>)<br><br>Idents(scRNA) &lt;- scRNA$T_celltype<br><br><span>## 此处单核细胞已经分好了亚群！</span><br><br><span>#    Classical monocytes  Intermediate monocytes Myeloid dendritic cells        Progenitor cells </span><br> <span>#                  2259                    1478                     105                      17 </span><br><span># table(scRNA$T_celltype)</span><br><br><span># Intermediate_monocytes比经典型</span><br>markers_im_vs_cm&lt;- FindMarkers(object = scRNA, ident.1 =<br>                                        <span>"Intermediate monocytes"</span>,<br>                                      ident.2 = <span>"Classical monocytes"</span>, only.pos = <span>TRUE</span>,<br>                                      min.pct = <span>0.25</span>,<br>                                      logfc.threshold = <span>0.25</span>)<br>markers_im_vs_cm$gene &lt;- rownames(markers_im_vs_cm)<br><br><br><br><span># Myeloid_dendritic_cells比 经典型</span><br>markers_dc_vs_cM &lt;- FindMarkers(object = scRNA, ident.1 = <span>"Myeloid dendritic cells"</span>,<br>                                    ident.2 = <span>"Classical monocytes"</span>, only.pos = <span>TRUE</span>,<br>                                    min.pct = <span>0.25</span>,<br>                                    logfc.threshold = <span>0.25</span>)<br>markers_dc_vs_cM $gene &lt;- rownames(markers_dc_vs_cM )<br><br><br>common_genes &lt;- intersect(markers_im_vs_cm$gene,<br>                          markers_dc_vs_cM$gene)<br><br><span>## 提取出非共同上调的基因</span><br>markers_im_only &lt;- markers_im_vs_cm$gene[!(markers_im_vs_cm$gene %<span>in</span>%<br>                                                  common_genes)]<br><br>markers_dc_only &lt;- markers_dc_vs_cM$gene[!(markers_dc_vs_cM$gene %<span>in</span>%<br>                                                      common_genes)]<br><br><span>###提取所有感兴趣的基因（包括单独和共同上调的）</span><br>genes &lt;- unique(c( markers_im_vs_cm$gene, markers_dc_vs_cM$gene))<br><br><span>## 挑选细胞</span><br>cell_types_selected &lt;- c(<span>"Intermediate monocytes"</span>, <span>"Myeloid dendritic cells"</span>, <span>"Classical monocytes"</span>)<br>names(cell_types_selected) &lt;- c(<span>"Intermediate monocytes"</span>, <span>"Myeloid dendritic cells"</span>, <span>"Classical monocytes"</span>)<br><br><span>## 计算每种细胞的平均值</span><br>genes_mean_expr &lt;- sapply(cell_types_selected, <span>function</span>(cell_type) {<br>  Matrix::rowMeans(scRNA@assays$RNA@data[genes, colnames(scRNA)<br>                                              [scRNA$T_celltype == cell_type]],na.rm = <span>T</span>)<br>})<br><span>###得到三种细胞对于基因的平均表达数据</span><br>colnames(genes_mean_expr)[<span>1</span>:<span>3</span>]&lt;-cell_types_selected &lt;- c(<span>"Intermediate_monocytes"</span>, <span>"Myeloid_dendritic_cells"</span>, <span>"Classical_monocytes"</span>)<br><br>genes_mean_expr &lt;- as.data.frame(genes_mean_expr)<br>genes_mean_expr$gene &lt;- rownames(genes_mean_expr)<br><br><span>###得到基因名对应表达量的表格</span><br>genes_mean_expr$color &lt;- <span>0</span><br>genes_mean_expr[genes_mean_expr$gene %<span>in</span>% markers_im_only , <span>"color"</span>]&lt;-<span>"Intermediate_monocytes"</span><br>genes_mean_expr[genes_mean_expr$gene %<span>in</span>% markers_dc_only , <span>"color"</span>]&lt;-<span>"Myeloid_dendritic_cells"</span><br>genes_mean_expr[genes_mean_expr$gene %<span>in</span>% common_genes, <span>"color"</span>]&lt;-<span>"common"</span><br>genes_mean_expr$color&lt;-factor(genes_mean_expr$color, levels=c(<span>"Intermediate_monocytes"</span>, <span>"Myeloid_dendritic_cells"</span>, <span>"common"</span>))<br><br><br><span>###设置颜色名</span><br><span># 选基因展示，此处我挑一些共同上调的基因</span><br>labels&lt;-common_genes[sample(<span>1</span>:length(common_genes),<span>20</span>)]<br><br>genes_mean_expr_labeled &lt;- genes_mean_expr[labels, ]<br>col_dc&lt;-<span>"#FABF00"</span><br>col_im&lt;-<span>"#2F8EA1"</span><br><span>library</span>(ggrepel)<br><span>library</span>(ggplot2)<br>p1=ggplot(genes_mean_expr, aes(x=Intermediate_monocytes, y=Myeloid_dendritic_cells))+<br>  geom_jitter(aes(fill=color),shape=<span>21</span>, color=<span>"white"</span>, alpha=<span>0.7</span>, size=<span>4</span>)+<br>  geom_text_repel(data=genes_mean_expr_labeled, aes(label=gene), nudge_y=<span>0.2</span>,<br>                  size=<span>3</span>,<br>                  direction=<span>"both"</span>)+<br>  geom_abline(intercept=<span>0</span>, slope=<span>1</span>)+<br>  scale_fill_manual(values=c(col_im, col_dc, <span>"black"</span>))+<br>  xlim(<span>0</span>,<span>5</span>)+<br>  ylim(<span>0</span>,<span>5</span>)+<br>  xlab(<span>"Intermediate_monocytes"</span>)+<br>  ylab(<span>"Myeloid_dendritic_cells"</span>)+<br>  coord_fixed()+<br>  theme_bw()+<br>  theme(panel.grid = element_blank())<br><br>p1<br><br></code></pre><figure><figcaption><img data-imgfileid="100004872" data-ratio="0.6300102774922919" data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaAfKXmKx035ITFiapV2yQO6PykRKRKicicTJTqL2GtkES0SClx4pkpvofvibC8m1bW6bR5VTwpibKb9Jqg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="973" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaAfKXmKx035ITFiapV2yQO6PykRKRKicicTJTqL2GtkES0SClx4pkpvofvibC8m1bW6bR5VTwpibKb9Jqg/640?wx_fmt=png&amp;from=appmsg"><br></figcaption></figure><pre><code><span>## 韦恩图</span><br>dat&lt;-c(<span>"Intermediate_monocytes"</span> = <span>417</span>, <br>       <span>"Myeloid_dendritic_cells"</span> = <span>498</span>, <br>       <span>'Intermediate_monocytes&amp;Myeloid_dendritic_cells'</span>=<span>127</span>)<br><span>#install.packages("eulerr")</span><br><br><span>library</span>(eulerr)<br>p2=plot(euler(dat),<br>     fills = list(fill=c(<span>"#2F8EA1"</span>,<span>"#FABF00"</span>,<br>                         <span>"black"</span>),<br>                  alpha=<span>0.8</span>),<br>     quantities = list(c(<span>417</span>,<span>498</span>,<span>127</span>), col=<span>"white"</span>,<br>                       cex=<span>2</span>),<br>     edges = list(col=<span>"white"</span>,alpha=<span>1</span>,lwd=<span>2</span>))<br><br>p2<br>gridExtra::grid.arrange(p1,p2)<br></code></pre><figure><figcaption><img data-imgfileid="100004873" data-ratio="1.1037037037037036" data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaAfKXmKx035ITFiapV2yQO6PyA7yCrd2PmtmriarMfcCBKAO6UyEAbic8b9jVC2pVdnZCkvJvP1bmU7Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaAfKXmKx035ITFiapV2yQO6PyA7yCrd2PmtmriarMfcCBKAO6UyEAbic8b9jVC2pVdnZCkvJvP1bmU7Q/640?wx_fmt=png&amp;from=appmsg"></figcaption></figure></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/turLIWwGZnpzZcY3Yj5jmQ",target="_blank" rel="noopener noreferrer">原文链接</a>
