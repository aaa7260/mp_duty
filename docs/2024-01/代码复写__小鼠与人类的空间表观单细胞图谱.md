---
title: "代码复写| 小鼠与人类的空间表观单细胞图谱"
date: 2024-01-16T02:47:34Z
draft: ["false"]
tags: [
  "fetched",
  "Biomamba 生信基地"
]
categories: ["Acdemic"]
---
代码复写| 小鼠与人类的空间表观单细胞图谱 by Biomamba 生信基地
------
<div><section data-support="96编辑器" data-style-id="39820"><section data-align="title"><section><section><section><p><span>评审环节开始！</span></p></section></section></section></section></section><section data-support="96编辑器" data-style-id="39183"><section><section><section><section><p><span><strong><em>写在前面</em></strong></span></p></section><section data-width="72%"><br></section></section><section><section><section><br></section><section>首届“<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247506477&amp;idx=2&amp;sn=155b83716930e4ae956604f7745a6fe4&amp;chksm=9b3ca37dac4b2a6b57d1467eb4dff2c1d425b5150e6eaf384fd2232e105a597f3c3887bc9807&amp;scene=21#wechat_redirect" textvalue="寻因杯" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">寻因杯</a>”单细胞代码复写大赛正在展开评审环节，这次带来的是15号作品(由sgs小队提交)。本作品复写了题为"<span>Spatial profiling of chromatin accessibility in mouse and human tissues</span><span>"的论文.</span></section><section><strong><span>文章链接</span></strong><span>：</span></section><section><span>https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9452302/</span></section><section><strong><span>数据原始链接：</span></strong></section><section><span>作者未提供</span><br></section><section><span></span></section><section><strong>复现图片集锦</strong>：<br></section><p><img data-galleryid="" data-imgfileid="100023848" data-ratio="0.9574074074074074" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5dY58Z9sAFeIQnEN8ia5KvQXoqW5p5YFfp9P2FVeykicOe1jiccaGIwtRw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5dY58Z9sAFeIQnEN8ia5KvQXoqW5p5YFfp9P2FVeykicOe1jiccaGIwtRw/640?wx_fmt=jpeg&amp;from=appmsg"></p><section><br></section><section><strong>文献简介</strong><span>：</span></section><h5 cid="n2" mdtype="heading"><span md-inline="plain">选择复现的文章图表于2022年发表于 Nature 杂志, 文章题目为《Spatial profiling of chromatin accessibility in mouse and human tissues》。在该文章中作者通过空间表观组学数据研究了小鼠和人类在不同发育时期（如E10、E11、E13、P21）的空间表观单细胞图谱, 我们挑选了感兴趣的E11时期(小鼠胚胎11天)进行图表复现。</span></h5><section><br></section></section></section></section></section></section><section><br></section><section data-support="96编辑器" data-style-id="39820"><section data-align="title"><section><section><section data-support="96编辑器" data-style-id="35217"><section><section><section data-support="96编辑器" data-style-id="35217"><section><section><p>一、复写内容</p></section><section><section><section><section><section><br></section><h2 cid="n13" mdtype="heading"><span md-inline="plain">空间ATAC分析</span></h2><h3 cid="n14" mdtype="heading"><span md-inline="plain">导入依赖包</span></h3><pre spellcheck="false" lang="R" cid="n15" mdtype="fences"><span role="presentation"><span>rm</span>(<span>list</span> <span>=</span> <span>ls</span>())</span><br><span role="presentation"><span>library</span>(<span>ArchR</span>)</span><br><span role="presentation"><span>library</span>(<span>Seurat</span>)</span><br><span role="presentation"><span>library</span>(<span>grid</span>)</span><br><span role="presentation"><span>set.seed</span>(<span>1234</span>)</span><br><span role="presentation"><span>rm</span>(<span>list</span> <span>=</span> <span>ls</span>())</span><br><span role="presentation"><span>threads</span> <span>=</span> <span>8</span></span><br><span role="presentation"><span>addArchRThreads</span>(<span>threads</span> <span>=</span> <span>threads</span>)</span><br><span role="presentation"><span>addArchRGenome</span>(<span>"mm10"</span>)</span><br><span role="presentation"><span>## 定义相关全局变量</span></span><br><span role="presentation"><span>inputFiles</span> <span>&lt;-</span> <span>"./GSM5238385_ME11_50um.fragments.tsv.gz"</span></span><br><span role="presentation"><span>sampleNames</span> <span>&lt;-</span> <span>'ME11_50um'</span></span><br><span role="presentation"><span>output_dir</span> <span>&lt;-</span> <span>"E11_proj_in_tissue"</span></span><br><span role="presentation"><span>cellidents</span> <span>&lt;-</span> <span>"ME11_50um#"</span></span><br><span role="presentation"><span>lsi_res</span> <span>&lt;-</span> <span>c</span>(<span>0.2</span>,<span>0.3</span>,<span>0.4</span>,<span>0.5</span>)</span><br><span role="presentation"><span>cluster_res</span> <span>&lt;-</span> <span>0.8</span></span><br><span role="presentation"><span>umpa_res</span> <span>&lt;-</span> <span>0.5</span></span><br><span role="presentation"><span>setwd</span>(<span>"/your_path/data/ME11"</span>)</span></pre><h3 cid="n16" mdtype="heading"><span md-inline="plain">降维聚类分析</span></h3><pre spellcheck="false" lang="R" cid="n17" mdtype="fences"><span role="presentation"><span>## Create ArchRProject</span></span><br><span role="presentation"><span>ArrowFiles</span> <span>&lt;-</span> <span>createArrowFiles</span>(</span><br><span role="presentation">  <span>inputFiles</span> = <span>inputFiles</span>,</span><br><span role="presentation">  <span>sampleNames</span> = <span>sampleNames</span>,</span><br><span role="presentation">  <span>filterTSS</span> = <span>0</span>,</span><br><span role="presentation">  <span>filterFrags</span> = <span>0</span>,</span><br><span role="presentation">  <span>minFrags</span> = <span>0</span>,</span><br><span role="presentation">  <span>maxFrags</span> = <span>1e+07</span>,</span><br><span role="presentation">  <span>addTileMat</span> = <span>TRUE</span>,</span><br><span role="presentation">  <span>addGeneScoreMat</span> = <span>TRUE</span>,</span><br><span role="presentation">  <span>offsetPlus</span> = <span>0</span>,</span><br><span role="presentation">  <span>offsetMinus</span> = <span>0</span>,</span><br><span role="presentation">  <span>TileMatParams</span> = <span>list</span>(<span>tileSize</span> <span>=</span> <span>5000</span>)</span><br><span role="presentation">)</span><br><span role="presentation"><span>ArrowFiles</span></span><br><span role="presentation"><span>proj</span> <span>&lt;-</span> <span>ArchRProject</span>(</span><br><span role="presentation">  <span>ArrowFiles</span> = <span>ArrowFiles</span>,</span><br><span role="presentation">  <span>outputDirectory</span> = <span>sampleNames</span>,</span><br><span role="presentation">  <span>copyArrows</span> = <span>TRUE</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>proj</span></span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>## Select pixels in tissue</span></span><br><span role="presentation"><span>meta.data</span> <span>&lt;-</span> <span>as.data.frame</span>(<span>getCellColData</span>(<span>ArchRProj</span> <span>=</span> <span>proj</span>))</span><br><span role="presentation"><span>meta.data</span>[<span>'cellID_archr'</span>] <span>&lt;-</span> <span>row.names</span>(<span>meta.data</span>)</span><br><span role="presentation"><span>data.dir</span> <span>&lt;-</span> <span>getwd</span>()</span><br><span role="presentation"><span>assay</span> <span>=</span> <span>"Spatial"</span></span><br><span role="presentation"><span>filter.matrix</span> <span>=</span> <span>TRUE</span></span><br><span role="presentation"><span>slice</span> <span>=</span> <span>"slice1"</span></span><br><span role="presentation"><span>image</span> <span>&lt;-</span> <span>Read10X_Image</span>(<span>image.dir</span> <span>=</span> <span>file.path</span>(<span>data.dir</span>, <span>"spatial"</span>), </span><br><span role="presentation">                       <span>filter.matrix</span> <span>=</span> <span>filter.matrix</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>#meta.data.spatial &lt;- meta.data[paste0("ME11_50um#",row.names(image@coordinates)), ]</span></span><br><span role="presentation"><span>meta.data.spatial</span> <span>&lt;-</span> <span>meta.data</span>[<span>paste0</span>(<span>cellidents</span>,<span>row.names</span>(<span>image</span>@<span>coordinates</span>)), ]</span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>proj</span>[<span>meta.data.spatial</span><span>$</span><span>cellID_archr</span>, ]</span><br><span role="presentation"><span>proj_in_tissue</span></span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>## Data normalization and dimensionality reduction </span></span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>addIterativeLSI</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>,</span><br><span role="presentation">  <span>useMatrix</span> = <span>"TileMatrix"</span>, </span><br><span role="presentation">  <span>name</span> = <span>"IterativeLSI"</span>, </span><br><span role="presentation">  <span>iterations</span> = <span>2</span>, </span><br><span role="presentation">  <span>clusterParams</span> = <span>list</span>(</span><br><span role="presentation">    <span>resolution</span> <span>=</span> <span>lsi_res</span>,  </span><br><span role="presentation">    <span>sampleCells</span> <span>=</span> <span>10000</span>, </span><br><span role="presentation">    <span>n.start</span> <span>=</span> <span>10</span>), </span><br><span role="presentation">  <span>varFeatures</span> = <span>25000</span>, </span><br><span role="presentation">  <span>dimsToUse</span> = <span>1</span><span>:</span><span>30</span>,</span><br><span role="presentation">  <span>force</span> = <span>TRUE</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>addClusters</span>(</span><br><span role="presentation">  <span>input</span> = <span>proj_in_tissue</span>,</span><br><span role="presentation">  <span>reducedDims</span> = <span>"IterativeLSI"</span>,</span><br><span role="presentation">  <span>method</span> = <span>"Seurat"</span>,</span><br><span role="presentation">  <span>name</span> = <span>"Clusters"</span>,</span><br><span role="presentation">  <span>resolution</span> = <span>cluster_res</span>,</span><br><span role="presentation">  <span>force</span> = <span>TRUE</span></span><br><span role="presentation">)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>addUMAP</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>, </span><br><span role="presentation">  <span>reducedDims</span> = <span>"IterativeLSI"</span>, </span><br><span role="presentation">  <span>name</span> = <span>"UMAP"</span>, </span><br><span role="presentation">  <span>nNeighbors</span> = <span>30</span>, </span><br><span role="presentation">  <span>minDist</span> = <span>umpa_res</span>,  <span># raw:0.5</span></span><br><span role="presentation">  <span>metric</span> = <span>"cosine"</span>,</span><br><span role="presentation">  <span>force</span> = <span>TRUE</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>plotEmbedding</span>(<span>ArchRProj</span> <span>=</span> <span>proj_in_tissue</span>, <span>colorBy</span> <span>=</span> <span>"cellColData"</span>, <span>name</span> <span>=</span> <span>"Clusters"</span>, <span>embedding</span> <span>=</span> <span>"UMAP"</span>, <span>size</span> <span>=</span> <span>1.5</span>)</span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>addImputeWeights</span>(<span>proj_in_tissue</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>## Identify the marker genes for each cluster </span></span><br><span role="presentation"><span>markersGS</span> <span>&lt;-</span> <span>getMarkerFeatures</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>, </span><br><span role="presentation">  <span>useMatrix</span> = <span>"GeneScoreMatrix"</span>, </span><br><span role="presentation">  <span>groupBy</span> = <span>"Clusters"</span>,</span><br><span role="presentation">  <span>testMethod</span> = <span>"wilcoxon"</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>markerList_pos</span> <span>&lt;-</span> <span>getMarkers</span>(<span>markersGS</span>, <span>cutOff</span> <span>=</span> <span>"FDR &lt;= 0.05 &amp; Log2FC &gt;= 0.25"</span>)</span><br><span role="presentation"><span>markerGenes</span> <span>&lt;-</span> <span>list</span>()</span><br><span role="presentation"><span>for</span> (<span>i</span> <span>in</span> <span>seq_len</span>(<span>length</span>(<span>markerList_pos</span>))) {</span><br><span role="presentation">  <span>markerGenes</span> <span>&lt;-</span> <span>c</span>(<span>markerGenes</span>, <span>markerList_pos</span>[[<span>i</span>]]<span>$</span><span>name</span>)</span><br><span role="presentation">}</span><br><span role="presentation"><span>markerGenes</span> <span>&lt;-</span> <span>unlist</span>(<span>markerGenes</span>)</span><br><span role="presentation"><span>saveArchRProject</span>(<span>ArchRProj</span> <span>=</span> <span>proj_in_tissue</span>, <span>outputDirectory</span> <span>=</span> <span>output_dir</span>)</span></pre><h3 cid="n18" mdtype="heading"><span md-inline="plain">Peaks Calling</span></h3><pre spellcheck="false" lang="R" cid="n19" mdtype="fences"><span role="presentation"><span>## Call peaks</span></span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>addGroupCoverages</span>(<span>ArchRProj</span> <span>=</span> <span>proj_in_tissue</span>, </span><br><span role="presentation">                                    <span>groupBy</span> <span>=</span> <span>"Clusters"</span>)</span><br><span role="presentation"><span>pathToMacs2</span> <span>&lt;-</span> <span>"/usr/local/bin/macs2"</span></span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>addReproduciblePeakSet</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>,</span><br><span role="presentation">  <span>groupBy</span> = <span>"Clusters"</span>,</span><br><span role="presentation">  <span>pathToMacs2</span> = <span>pathToMacs2</span>,</span><br><span role="presentation">  <span>force</span> = <span>TRUE</span></span><br><span role="presentation">)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>library</span>(<span>"chromVARmotifs"</span>)</span><br><span role="presentation"><span>#devtools::install_github("GreenleafLab/chromVARmotifs")</span></span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>addPeakMatrix</span>(<span>proj_in_tissue</span>)</span><br><span role="presentation"><span>getAvailableMatrices</span>(<span>proj_in_tissue</span>)</span><br><span role="presentation"><span>getPeakSet</span>(<span>proj_in_tissue</span>)</span><br><span role="presentation"><span>getPeakSet</span>(<span>proj_in_tissue</span>)</span><br><span role="presentation"><span>if</span> (<span>"Motif"</span> <span>%in%</span> <span>names</span>(<span>proj_in_tissue</span>@<span>peakAnnotation</span>)) {</span><br><span role="presentation">  <span>proj_in_tissue</span> <span>&lt;-</span> <span>addMotifAnnotations</span>(<span>ArchRProj</span> <span>=</span> <span>proj_in_tissue</span>,</span><br><span role="presentation">                                        <span>motifSet</span> <span>=</span> <span>"cisbp"</span>,</span><br><span role="presentation">                                        <span>name</span> <span>=</span> <span>"Motif"</span>,</span><br><span role="presentation">                                        <span>force</span> <span>=</span> <span>TRUE</span>)</span><br><span role="presentation">}</span><br><span role="presentation"><span>saveArchRProject</span>(<span>ArchRProj</span> <span>=</span> <span>proj_in_tissue</span>, <span>outputDirectory</span> <span>=</span> <span>output_dir</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>### ident markerpeaks</span></span><br><span role="presentation"><span>markersPeaks</span> <span>&lt;-</span> <span>getMarkerFeatures</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>,</span><br><span role="presentation">  <span>useMatrix</span> = <span>"PeakMatrix"</span>,</span><br><span role="presentation">  <span>groupBy</span> = <span>"Clusters"</span>,</span><br><span role="presentation">  <span>bias</span> = <span>c</span>(<span>"TSSEnrichment"</span>, <span>"log10(nFrags)"</span>),</span><br><span role="presentation">  <span>testMethod</span> = <span>"wilcoxon"</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>markerList</span> <span>&lt;-</span> <span>getMarkers</span>(<span>markersPeaks</span>, <span>cutOff</span> <span>=</span> <span>"FDR &lt;= 0.05 &amp; Log2FC &gt;= 0.1"</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span></pre><h3 cid="n20" mdtype="heading"><span md-inline="plain">ChromVAR Deviatons Enrichment</span></h3><pre spellcheck="false" lang="R" cid="n21" mdtype="fences"><span role="presentation"><span>## ChromVAR Deviatons Enrichment</span></span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>addBgdPeaks</span>(<span>proj_in_tissue</span>, <span>force</span> <span>=</span> <span>TRUE</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>addDeviationsMatrix</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>, </span><br><span role="presentation">  <span>peakAnnotation</span> = <span>"Motif"</span>,</span><br><span role="presentation">  <span>force</span> = <span>TRUE</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>markersMotifs</span> <span>&lt;-</span> <span>getMarkerFeatures</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>,</span><br><span role="presentation">  <span>useMatrix</span> = <span>"MotifMatrix"</span>,</span><br><span role="presentation">  <span>groupBy</span> = <span>"Clusters"</span>,</span><br><span role="presentation">  <span>bias</span> = <span>c</span>(<span>"TSSEnrichment"</span>, <span>"log10(nFrags)"</span>),</span><br><span role="presentation">  <span>testMethod</span> = <span>"wilcoxon"</span>,</span><br><span role="presentation">  <span>useSeqnames</span> = <span>'z'</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>motifsUp</span> <span>&lt;-</span> <span>peakAnnoEnrichment</span>(</span><br><span role="presentation">  <span>seMarker</span> = <span>markersPeaks</span>,</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>,</span><br><span role="presentation">  <span>peakAnnotation</span> = <span>"Motif"</span>,</span><br><span role="presentation">  <span>cutOff</span> = <span>"FDR &lt;= 0.1 &amp; Log2FC &gt;= 0.5"</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>saveArchRProject</span>(<span>ArchRProj</span> <span>=</span> <span>proj_in_tissue</span>, <span>outputDirectory</span> <span>=</span> <span>output_dir</span>)</span><br><span role="presentation"><span>save</span>(<span>markersGS</span>,<span>markersPeaks</span>, <span>markersMotifs</span>, <span>file</span> <span>=</span> <span>"./markers_obj.RData"</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>#### 进行motif富集分析</span></span><br><span role="presentation"><span>library</span>(<span>"BSgenome.Mmusculus.UCSC.mm10"</span>)</span><br><span role="presentation"><span>## ChromVAR Deviatons Enrichment</span></span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>addBgdPeaks</span>(<span>proj_in_tissue</span>, <span>force</span> <span>=</span> <span>TRUE</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>if</span> (<span>"Motif"</span> <span>%in%</span> <span>names</span>(<span>proj_in_tissue</span>@<span>peakAnnotation</span>)) {</span><br><span role="presentation">  <span>proj_in_tissue</span> <span>&lt;-</span> <span>addMotifAnnotations</span>(<span>ArchRProj</span> <span>=</span> <span>proj_in_tissue</span>,</span><br><span role="presentation">                                        <span>motifSet</span> <span>=</span> <span>"cisbp"</span>,</span><br><span role="presentation">                                        <span>name</span> <span>=</span> <span>"Motif"</span>,</span><br><span role="presentation">                                        <span>force</span> <span>=</span> <span>TRUE</span>)</span><br><span role="presentation">}</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>addDeviationsMatrix</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>, </span><br><span role="presentation">  <span>peakAnnotation</span> = <span>"Motif"</span>,</span><br><span role="presentation">  <span>force</span> = <span>TRUE</span></span><br><span role="presentation">)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>markersMotifs</span> <span>&lt;-</span> <span>getMarkerFeatures</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>,</span><br><span role="presentation">  <span>useMatrix</span> = <span>"MotifMatrix"</span>,</span><br><span role="presentation">  <span>groupBy</span> = <span>"Clusters"</span>,</span><br><span role="presentation">  <span>bias</span> = <span>c</span>(<span>"TSSEnrichment"</span>, <span>"log10(nFrags)"</span>),</span><br><span role="presentation">  <span>testMethod</span> = <span>"wilcoxon"</span>,</span><br><span role="presentation">  <span>useSeqnames</span> = <span>'z'</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>saveArchRProject</span>(<span>proj_in_tissue</span>, <span>outputDirectory</span> <span>=</span> <span>output_dir</span>)</span></pre><h3 cid="n22" mdtype="heading"><span md-inline="plain">scRNA参考数据集整合分析</span></h3><h4 cid="n23" mdtype="heading"><span md-inline="plain">Prepare MOCA data</span></h4><pre spellcheck="false" lang="R" cid="n24" mdtype="fences"><span role="presentation"><span>library</span>(<span>ArchR</span>)</span><br><span role="presentation"><span>library</span>(<span>Seurat</span>)</span><br><span role="presentation"><span>library</span>(<span>grid</span>)</span><br><span role="presentation"><span>library</span>(<span>tidyverse</span>)</span><br><span role="presentation"><span>source</span>(<span>"../data_visualization/SpatialDimPlot_new.R"</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>#### Prepare MOCA data</span></span><br><span role="presentation"><span>MOCA_dir</span> <span>&lt;-</span> <span>"../MOCA_data/"</span></span><br><span role="presentation"><span>meta.data.RNA</span> <span>&lt;-</span> <span>read_csv</span>(<span>file</span> <span>=</span> <span>paste0</span>(<span>MOCA_dir</span>, <span>'cell_annotate.csv'</span>))</span><br><span role="presentation"><span>gene.ANN.RNA</span> <span>&lt;-</span> <span>read_csv</span>(<span>file</span> <span>=</span> <span>paste0</span>(<span>MOCA_dir</span>, <span>'gene_annotate.csv'</span>))</span><br><span role="presentation"><span>cds</span> <span>&lt;-</span> <span>readRDS</span>(<span>paste0</span>(<span>MOCA_dir</span>, <span>'gene_count_cleaned_sampled_100k.RDS'</span>))</span><br><span role="presentation"><span>rownames</span>(<span>meta.data.RNA</span>) <span>&lt;-</span> <span>meta.data.RNA</span><span>$</span><span>sample</span></span><br><span role="presentation"><span>MOCA</span> <span>&lt;-</span> <span>CreateSeuratObject</span>(<span>counts</span> <span>=</span> <span>cds</span>, <span>project</span> <span>=</span> <span>'MOCA'</span>)</span><br><span role="presentation"><span>meta.data.RNA1</span> <span>&lt;-</span> <span>meta.data.RNA</span>[<span>colnames</span>(<span>MOCA</span>), ]</span><br><span role="presentation"><span>meta.data.RNA1</span> <span>&lt;-</span> <span>meta.data.RNA1</span>[, <span>c</span>(<span>'Main_cell_type'</span>, <span>'development_stage'</span>)]</span><br><span role="presentation"><span>MOCA</span>[[<span>"Main_cell_type"</span>]] <span>&lt;-</span> <span>meta.data.RNA1</span><span>$</span><span>Main_cell_type</span></span><br><span role="presentation"><span>MOCA</span>[[<span>"development_stage"</span>]] <span>&lt;-</span> <span>meta.data.RNA1</span><span>$</span><span>development_stage</span></span><br><span role="presentation"><span>save</span>(<span>MOCA</span>, <span>file</span> <span>=</span> <span>"./MOCA.RData"</span>)</span><br><span role="presentation"><span>MOCA_E11</span> <span>&lt;-</span>  <span>subset</span>(<span>MOCA</span>, <span>development_stage</span> <span>==</span> <span>11.5</span>)</span><br><span role="presentation"><span>MOCA_E11.raw.data</span> <span>&lt;-</span> <span>as.matrix</span>(<span>GetAssayData</span>(<span>MOCA_E11</span>, <span>slot</span> <span>=</span> <span>'counts'</span>))</span><br><span role="presentation"><span>MOCA_E11.raw.data</span> <span>&lt;-</span> <span>as.data.frame</span>(<span>MOCA_E11.raw.data</span>)</span><br><span role="presentation"><span>save</span>(<span>MOCA_E11.raw.data</span>, <span>file</span> <span>=</span> <span>"./MOCA_E11_raw_data.RData"</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>## fetch ME11 cells</span></span><br><span role="presentation"><span>rownames</span>(<span>gene.ANN.RNA</span>) <span>&lt;-</span> <span>gene.ANN.RNA</span><span>$</span><span>gene_id</span></span><br><span role="presentation"><span>gene.ANN.RNA</span> <span>&lt;-</span> <span>gene.ANN.RNA</span>[<span>rownames</span>(<span>MOCA_E11.raw.data</span>) , ]</span><br><span role="presentation"><span>MOCA_E11.raw.data</span> <span>&lt;-</span> <span>cbind</span>(<span>gene_id</span><span>=</span><span>rownames</span>(<span>MOCA_E11.raw.data</span>),<span>MOCA_E11.raw.data</span>)</span><br><span role="presentation"><span>MOCA_E11.raw.data</span> <span>&lt;-</span> <span>merge</span>(<span>gene.ANN.RNA</span>, <span>MOCA_E11.raw.data</span>, <span>by</span><span>=</span><span>"gene_id"</span>, <span>all</span><span>=</span><span>TRUE</span>)</span><br><span role="presentation"><span>which</span>(<span>is.na</span>(<span>MOCA_E11.raw.data</span><span>$</span><span>gene_short_name</span>))</span><br><span role="presentation"><span>tt</span> <span>&lt;-</span> <span>table</span>(<span>MOCA_E11.raw.data</span><span>$</span><span>gene_short_name</span>)</span><br><span role="presentation"><span>name_rep</span> <span>&lt;-</span> <span>names</span>(<span>which</span>(<span>tt</span> <span>&gt;</span> <span>1</span>))</span><br><span role="presentation"><span>row_del_fun</span> <span>&lt;-</span> <span>function</span>(<span>x</span>){</span><br><span role="presentation">  <span>rows</span> <span>&lt;-</span> <span>which</span>(<span>MOCA_E11.raw.data</span><span>$</span><span>gene_short_name</span> <span>==</span> <span>x</span>)</span><br><span role="presentation">  <span>return</span>(<span>rows</span>[<span>2</span><span>:</span><span>length</span>(<span>rows</span>)] )</span><br><span role="presentation">}</span><br><span role="presentation"><span>row_del</span> <span>&lt;-</span> <span>unlist</span>(<span>lapply</span>(<span>name_rep</span>, <span>row_del_fun</span>))</span><br><span role="presentation"><span>MOCA_E11.raw.data</span> <span>&lt;-</span> <span>MOCA_E11.raw.data</span>[<span>-</span><span>row_del</span>, ]</span><br><span role="presentation"><span>row.names</span>(<span>MOCA_E11.raw.data</span>) <span>&lt;-</span> <span>MOCA_E11.raw.data</span><span>$</span><span>gene_short_name</span></span><br><span role="presentation"><span>MOCA_E11.raw.data</span> <span>&lt;-</span> <span>MOCA_E11.raw.data</span>[ , <span>-</span><span>c</span>(<span>1</span><span>:</span><span>2</span>), <span>drop</span><span>=</span><span>FALSE</span>]</span><br><span role="presentation"><span>MOCA_E11.raw.data</span> <span>&lt;-</span> <span>MOCA_E11.raw.data</span>[ , <span>-</span><span>1</span>, <span>drop</span><span>=</span><span>FALSE</span>]</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>MOCA_E11</span> <span>&lt;-</span> <span>CreateSeuratObject</span>(<span>counts</span> <span>=</span> <span>MOCA_E11.raw.data</span>,</span><br><span role="presentation">                               <span>project</span> <span>=</span> <span>"MOCA_E11"</span>,</span><br><span role="presentation">                               <span>meta.data</span> <span>=</span> <span>MOCA_E11</span>@<span>meta.data</span>)</span><br><span role="presentation"><span>save</span>(<span>MOCA_E11</span>, <span>file</span> <span>=</span> <span>"./MOCA_E11.RData"</span>)</span><br><span role="presentation"><span>load</span>(<span>"./MOCA_E11.RData"</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span></pre><h4 cid="n25" mdtype="heading"><span md-inline="plain">Integration with ArchR oject</span></h4><pre spellcheck="false" lang="R" cid="n26" mdtype="fences"><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>loadArchRProject</span>(<span>path</span> <span>=</span> <span>output_dir</span>)</span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>addGeneIntegrationMatrix</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>, </span><br><span role="presentation">  <span>useMatrix</span> = <span>"GeneScoreMatrix"</span>,</span><br><span role="presentation">  <span>matrixName</span> = <span>"GeneIntegrationMatrix"</span>,</span><br><span role="presentation">  <span>reducedDims</span> = <span>"IterativeLSI"</span>,</span><br><span role="presentation">  <span>seRNA</span> = <span>MOCA_E11</span>,</span><br><span role="presentation">  <span>addToArrow</span> = <span>TRUE</span>,</span><br><span role="presentation">  <span>groupRNA</span> = <span>"Main_cell_type"</span>,</span><br><span role="presentation">  <span>nameCell</span> = <span>"predictedCell"</span>,</span><br><span role="presentation">  <span>nameGroup</span> = <span>"predictedGroup"</span>,</span><br><span role="presentation">  <span>nameScore</span> = <span>"predictedScore"</span>,</span><br><span role="presentation">  <span>force</span> = <span>TRUE</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>saveArchRProject</span>(<span>proj_in_tissue</span>, <span>outputDirectory</span> <span>=</span> <span>output_dir</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>### Integration with ArchR oject</span></span><br><span role="presentation"><span>library</span>(<span>"glmGamPoi"</span>)</span><br><span role="presentation"><span>proj_in_tissue</span> </span><br><span role="presentation"><span>genescore</span> <span>&lt;-</span> <span>getMatrixFromProject</span>(<span>ArchRProj</span> <span>=</span> <span>proj_in_tissue</span>, <span>useMatrix</span> <span>=</span> <span>"GeneScoreMatrix"</span>)</span><br><span role="presentation"><span>genescore_mat</span> <span>&lt;-</span> <span>assay</span>(<span>genescore</span>,<span>"GeneScoreMatrix"</span>)</span><br><span role="presentation"><span>rownames</span>(<span>genescore_mat</span>) <span>&lt;-</span> <span>rowData</span>(<span>genescore</span>)<span>$</span><span>name</span></span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>proj_RNA</span> <span>&lt;-</span> <span>CreateSeuratObject</span>(<span>project</span> <span>=</span> <span>"E11"</span>, <span>counts</span> <span>=</span> <span>genescore_mat</span>, <span>assay</span> <span>=</span> <span>"RNA"</span>) <span>%&gt;%</span></span><br><span role="presentation">  <span>PercentageFeatureSet</span>(<span>pattern</span> <span>=</span> <span>"^MT-"</span>, <span>col.name</span> <span>=</span> <span>"percent.mt"</span>) <span>%&gt;%</span> </span><br><span role="presentation">  <span>SCTransform</span>(<span>vars.to.regress</span> <span>=</span> <span>"percent.mt"</span>, <span>do.scale</span><span>=</span><span>TRUE</span>, <span>method</span> <span>=</span> <span>"glmGamPoi"</span>) <span>%&gt;%</span> </span><br><span role="presentation">  <span>RunPCA</span>() <span>%&gt;%</span></span><br><span role="presentation">  <span>FindNeighbors</span>(<span>dims</span> <span>=</span> <span>1</span><span>:</span><span>30</span>) <span>%&gt;%</span></span><br><span role="presentation">  <span>RunUMAP</span>(<span>dims</span> <span>=</span> <span>1</span><span>:</span><span>30</span>) <span>%&gt;%</span></span><br><span role="presentation">  <span>FindClusters</span>()</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>## 注意：当线粒体得分全部为0时，可能是设置的大小写基因名称的问题，尝试换为 ^mt- 或 ^MT- 试试；</span></span><br><span role="presentation"><span>MOCA_E11</span>[[<span>"percent.mt"</span>]] <span>&lt;-</span> <span>PercentageFeatureSet</span>(<span>MOCA_E11</span>, <span>pattern</span> <span>=</span> <span>"^MT-"</span>)</span><br><span role="presentation"><span>MOCA_E11</span>[[<span>"percent.ribo"</span>]] <span>&lt;-</span> <span>PercentageFeatureSet</span>(<span>MOCA_E11</span>, <span>pattern</span> <span>=</span> <span>"^RP[L|S]"</span>)</span><br><span role="presentation"><span>red.genes</span> <span>&lt;-</span> <span>c</span>(<span>"HBA1"</span>,<span>"HBA2"</span>,<span>"HBB"</span>)  </span><br><span role="presentation"><span>MOCA_E11</span>[[<span>"percent.redcell"</span>]] <span>&lt;-</span> <span>PercentageFeatureSet</span>(<span>MOCA_E11</span>, <span>features</span><span>=</span><span>red.genes</span>[<span>!</span><span>is.na</span>(<span>match</span>(<span>red.genes</span>,<span>rownames</span>(<span>MOCA_E11</span>)))])</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span># 使用violin plot可视化  QC指标，并使用这些指标过滤单元格</span></span><br><span role="presentation"><span>qc</span> <span>&lt;-</span> <span>VlnPlot</span>(<span>MOCA_E11</span>,<span>features</span> <span>=</span> <span>c</span>(<span>"nFeature_RNA"</span>,<span>"nCount_RNA"</span>,<span>"percent.mt"</span>,<span>"percent.redcell"</span>),<span>ncol</span> <span>=</span> <span>4</span>)</span><br><span role="presentation"><span>ggsave</span>(<span>file</span> <span>=</span> <span>"./seurat_int/QC_reference.pdf"</span>, <span>plot</span><span>=</span><span>qc</span>, <span>width</span><span>=</span><span>8</span>, <span>height</span><span>=</span><span>7</span>)</span><br><span role="presentation"><span>MOCA_E11</span> <span>&lt;-</span> <span>subset</span>(<span>MOCA_E11</span>, <span>subset</span><span>=</span><span>nFeature_RNA</span> <span>&gt;</span> <span>200</span> <span>&amp;</span> <span>nFeature_RNA</span> <span>&lt;</span> <span>2500</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span># 标准化+找高变基因</span></span><br><span role="presentation"><span>MOCA_E11</span> <span>&lt;-</span> <span>SCTransform</span>(<span>MOCA_E11</span>, <span>vars.to.regress</span> <span>=</span> <span>"percent.mt"</span>, <span>do.scale</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span>table</span>(<span>MOCA_E11</span>@<span>meta.data</span><span>$</span><span>Main_cell_type</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>combined.anchors</span> <span>&lt;-</span> <span>FindIntegrationAnchors</span>(<span>object.list</span> <span>=</span> <span>c</span>(<span>MOCA_E11</span>, <span>proj_RNA</span>), <span>anchor.features</span> <span>=</span> <span>2000</span>, <span>dims</span> <span>=</span> <span>1</span><span>:</span><span>30</span>)</span><br><span role="presentation"><span>combined_obj</span> <span>&lt;-</span> <span>IntegrateData</span>(<span>anchorset</span> <span>=</span> <span>combined.anchors</span>, <span>dims</span> <span>=</span> <span>1</span><span>:</span><span>30</span>)</span><br><span role="presentation"><span>DefaultAssay</span>(<span>combined_obj</span>) <span>&lt;-</span> <span>"integrated"</span></span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>combined_obj</span> <span>&lt;-</span> <span>ScaleData</span>(<span>combined_obj</span>, <span>features</span> <span>=</span> <span>rownames</span>(<span>combined_obj</span>))</span><br><span role="presentation"><span>combined_obj</span> <span>&lt;-</span> <span>NormalizeData</span>(<span>combined_obj</span>)</span><br><span role="presentation"><span>combined_obj</span> <span>&lt;-</span> <span>RunPCA</span>(<span>combined_obj</span>, <span>verbose</span> <span>=</span> <span>F</span>)</span><br><span role="presentation"><span>combined_obj</span> <span>&lt;-</span> <span>RunUMAP</span>(<span>combined_obj</span>, <span>dims</span> <span>=</span> <span>1</span><span>:</span><span>30</span>, <span>verbose</span> <span>=</span> <span>F</span>)</span><br><span role="presentation"><span>combined_obj</span> <span>&lt;-</span> <span>FindNeighbors</span>(<span>combined_obj</span>, <span>dims</span> <span>=</span> <span>1</span><span>:</span><span>30</span>, <span>verbose</span> <span>=</span> <span>F</span>)</span><br><span role="presentation"><span>combined_obj</span> <span>&lt;-</span> <span>FindClusters</span>(<span>combined_obj</span>, <span>verbose</span> <span>=</span> <span>F</span>)</span><br><span role="presentation"><span>table</span>(<span>combined_obj</span>[[]]<span>$</span><span>seurat_clusters</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>library</span>(<span>RColorBrewer</span>)</span><br><span role="presentation"><span>ncluster</span> <span>&lt;-</span> <span>length</span>(<span>unique</span>(<span>combined_obj</span>[[]]<span>$</span><span>Main_cell_type</span>))</span><br><span role="presentation"><span>mycol</span> <span>&lt;-</span> <span>colorRampPalette</span>(<span>brewer.pal</span>(<span>8</span>, <span>"Set3"</span>))(<span>ncluster</span>)</span><br><span role="presentation"><span>p1</span> <span>&lt;-</span> <span>DimPlot</span>(<span>combined_obj</span>, <span>label</span> <span>=</span> <span>T</span>, <span>cols</span> <span>=</span> <span>mycol</span>, <span>group.by</span> <span>=</span> <span>'Main_cell_type'</span>, <span>label.size</span> <span>=</span> <span>0</span>)</span><br><span role="presentation"><span>p1</span></span><br><span role="presentation"><span>ggsave</span>(<span>file</span> <span>=</span> <span>"./seurat_int/MISARrna_RNA_combined_sample.pdf"</span>, <span>plot</span><span>=</span><span>p1</span>, <span>width</span><span>=</span><span>8</span>, <span>height</span><span>=</span><span>7</span>)</span><br><span role="presentation"><span>saveRDS</span>(<span>combined_obj</span>, <span>file</span> <span>=</span> <span>"./seurat_int/combined_obj.rds"</span>)</span></pre><h3 cid="n27" mdtype="heading"><span md-inline="plain">拟时序与共可及性分析</span></h3><pre spellcheck="false" lang="R" cid="n28" mdtype="fences"><span role="presentation"><span>source</span>(<span>'../data_visualization/SpatialPlot_traj.R'</span>)</span><br><span role="presentation"><span>### 拟时序分析</span></span><br><span role="presentation"><span>trajectory</span> <span>&lt;-</span> <span>c</span>(<span>"Radial glia"</span>, <span>"Postmitotic premature neurons"</span>, <span>"Excitatory neurons"</span>)</span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>addTrajectory</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>, </span><br><span role="presentation">  <span>name</span> = <span>"Neuron_U"</span>, </span><br><span role="presentation">  <span>groupBy</span> = <span>"predictedGroup"</span>,</span><br><span role="presentation">  <span>trajectory</span> = <span>trajectory</span>, </span><br><span role="presentation">  <span>embedding</span> = <span>"UMAP"</span>, </span><br><span role="presentation">  <span>force</span> = <span>TRUE</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>saveArchRProject</span>(<span>proj_in_tissue</span>, <span>outputDirectory</span> <span>=</span> <span>output_dir</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>##### 进行共可及性分析</span></span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>addCoAccessibility</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>,</span><br><span role="presentation">  <span>reducedDims</span> = <span>"IterativeLSI"</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>cA</span> <span>&lt;-</span> <span>getCoAccessibility</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>,</span><br><span role="presentation">  <span>corCutOff</span> = <span>0.5</span>,</span><br><span role="presentation">  <span>resolution</span> = <span>10000</span>,</span><br><span role="presentation">  <span>returnLoops</span> = <span>TRUE</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>cA</span>[[<span>1</span>]]</span><br><span role="presentation"><span>markerGenes1</span> <span>&lt;-</span> <span>c</span>(<span>"Slc4a1"</span>, <span>"Nova2"</span>, <span>"Rarg"</span>)</span><br><span role="presentation"><span>p</span> <span>&lt;-</span> <span>plotBrowserTrack</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>,</span><br><span role="presentation">  <span>groupBy</span> = <span>"Clusters"</span>,</span><br><span role="presentation">  <span>geneSymbol</span> = <span>markerGenes1</span>,</span><br><span role="presentation">  <span>upstream</span> = <span>50000</span>,</span><br><span role="presentation">  <span>downstream</span> = <span>50000</span>,</span><br><span role="presentation">  <span>loops</span> = <span>getCoAccessibility</span>(<span>proj_in_tissue</span>)</span><br><span role="presentation">)</span><br><span role="presentation"><span>saveArchRProject</span>(<span>proj_in_tissue</span>, <span>outputDirectory</span> <span>=</span> <span>output_dir</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span></pre><h3 cid="n29" mdtype="heading"><span md-inline="plain">整合空间ATAC矩阵与组织背景切片</span></h3><pre spellcheck="false" lang="R" cid="n30" mdtype="fences"><span role="presentation"><span>## 导入相关依赖包</span></span><br><span role="presentation"><span>library</span>(<span>ArchR</span>)</span><br><span role="presentation"><span>library</span>(<span>Seurat</span>)</span><br><span role="presentation"><span>library</span>(<span>grid</span>)</span><br><span role="presentation"><span>library</span>(<span>ggplot2</span>)</span><br><span role="presentation"><span>library</span>(<span>patchwork</span>)</span><br><span role="presentation"><span>library</span>(<span>dplyr</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>## Prepare meta data</span></span><br><span role="presentation"><span>meta.data</span> <span>&lt;-</span> <span>as.data.frame</span>(<span>getCellColData</span>(<span>ArchRProj</span> <span>=</span> <span>proj_in_tissue</span>))</span><br><span role="presentation"><span>meta.data</span>[<span>'cellID_archr'</span>] <span>&lt;-</span> <span>row.names</span>(<span>meta.data</span>)</span><br><span role="presentation"><span>new_row_names</span> <span>&lt;-</span> <span>row.names</span>(<span>meta.data</span>)</span><br><span role="presentation"><span>new_row_names</span> <span>&lt;-</span> <span>unlist</span>(<span>lapply</span>(<span>new_row_names</span>, <span>function</span>(<span>x</span>) <span>gsub</span>(<span>".*#"</span>,<span>""</span>, <span>x</span>)))</span><br><span role="presentation"><span>new_row_names</span> <span>&lt;-</span> <span>unlist</span>(<span>lapply</span>(<span>new_row_names</span>, <span>function</span>(<span>x</span>) <span>gsub</span>(<span>"-.*"</span>,<span>""</span>, <span>x</span>)))</span><br><span role="presentation"><span>row.names</span>(<span>meta.data</span>) <span>&lt;-</span> <span>new_row_names</span></span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>## Create Seurat Object</span></span><br><span role="presentation"><span>proj_in_tissue</span> <span>&lt;-</span> <span>addImputeWeights</span>(<span>proj_in_tissue</span>)</span><br><span role="presentation"><span>gene_score</span> <span>&lt;-</span> <span>getGeneScore_ArchR</span>(<span>ArchRProj</span> <span>=</span> <span>proj_in_tissue</span>, <span>name</span> <span>=</span> <span>markerGenes</span>, <span>imputeWeights</span> <span>=</span> <span>getImputeWeights</span>(<span>proj_in_tissue</span>))</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>data.dir</span> <span>&lt;-</span> <span>getwd</span>()</span><br><span role="presentation"><span>assay</span> <span>=</span> <span>"Spatial"</span></span><br><span role="presentation"><span>filter.matrix</span> <span>=</span> <span>TRUE</span></span><br><span role="presentation"><span>slice</span> <span>=</span> <span>"slice1"</span></span><br><span role="presentation"><span>object</span> <span>&lt;-</span> <span>CreateSeuratObject</span>(<span>counts</span> <span>=</span> <span>gene_score</span>, <span>assay</span> <span>=</span> <span>assay</span>, <span>meta.data</span> <span>=</span> <span>meta.data</span>)</span><br><span role="presentation"><span>image</span> <span>&lt;-</span> <span>Read10X_Image</span>(<span>image.dir</span> <span>=</span> <span>file.path</span>(<span>data.dir</span>, <span>"spatial"</span>))</span><br><span role="presentation"><span>image</span> <span>&lt;-</span> <span>image</span>[<span>Cells</span>(<span>x</span><span>=</span><span>object</span>)]</span><br><span role="presentation"><span>DefaultAssay</span>(<span>object</span> <span>=</span> <span>image</span>) <span>&lt;-</span> <span>assay</span></span><br><span role="presentation"><span>object</span>[[<span>slice</span>]] <span>&lt;-</span> <span>image</span></span><br><span role="presentation"><span>spatial.obj</span> <span>&lt;-</span> <span>object</span></span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>####add umap coords</span></span><br><span role="presentation"><span>umap_coords</span> <span>&lt;-</span> <span>getEmbedding</span>(<span>proj_in_tissue</span>, <span>embedding</span> <span>=</span> <span>"UMAP"</span>)</span><br><span role="presentation"><span>colnames</span>(<span>umap_coords</span>) <span>&lt;-</span> <span>c</span>(<span>"UMAP_1"</span>, <span>"UMAP_2"</span>)</span><br><span role="presentation"><span>new_row_names</span> <span>&lt;-</span> <span>row.names</span>(<span>umap_coords</span>)</span><br><span role="presentation"><span>new_row_names</span> <span>&lt;-</span> <span>unlist</span>(<span>lapply</span>(<span>new_row_names</span>, <span>function</span>(<span>x</span>) <span>gsub</span>(<span>".*#"</span>,<span>""</span>, <span>x</span>)))</span><br><span role="presentation"><span>new_row_names</span> <span>&lt;-</span> <span>unlist</span>(<span>lapply</span>(<span>new_row_names</span>, <span>function</span>(<span>x</span>) <span>gsub</span>(<span>"-.*"</span>,<span>""</span>, <span>x</span>)))</span><br><span role="presentation"><span>row.names</span>(<span>umap_coords</span>) <span>&lt;-</span> <span>new_row_names</span></span><br><span role="presentation"><span>spatial.obj</span>[[<span>"UMAP"</span>]] <span>&lt;-</span> <span>CreateDimReducObject</span>(<span>embeddings</span> <span>=</span> <span>as.matrix</span>(<span>umap_coords</span>), <span>assay</span> <span>=</span> <span>"Spatial"</span>)</span><br><span role="presentation"><span>save</span>(<span>spatial.obj</span>, <span>file</span> <span>=</span> <span>"./spatial_obj.RData"</span>)</span></pre><h2 cid="n31" mdtype="heading"><span md-inline="plain">结果可视化</span></h2><h3 cid="n32" mdtype="heading"><span md-inline="plain">Extend Fig.4 结果可视化</span></h3><h4 cid="n33" mdtype="heading"><span md-inline="plain">空间聚类结果图 (Extend Fig.4.a)</span></h4><pre spellcheck="false" lang="" cid="n34" mdtype="fences"><span role="presentation">### 空间cluster spatial (图4a) </span><br><span role="presentation">p4 &lt;- SpatialPlot(spatial.obj, label = FALSE, label.size = 3, group.by = 'Clusters', pt.size.factor = 2, </span><br><span role="presentation">                  cols = cols4, image.alpha = 1, stroke = 0,</span><br><span role="presentation">                  alpha = c(1,1))</span><br><span role="presentation">p4$layers[[1]]$aes_params &lt;- c(p4$layers[[1]]$aes_params, shape=22)</span><br><span role="presentation">p4</span><br><span role="presentation">ggsave(file = "./2023_xunyin_fig/4_clusters_spatial.png", plot=p4, width=10, height=8)</span></pre><p><img data-galleryid="" data-imgfileid="100023833" data-ratio="0.9228486646884273" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5mwRaKkDUqWWiaiarI5QJncghSQcCqgO5jhbuicwfkkQpAAwyDI7xHiaStQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="337" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5mwRaKkDUqWWiaiarI5QJncghSQcCqgO5jhbuicwfkkQpAAwyDI7xHiaStQ/640?wx_fmt=png&amp;from=appmsg"></p><h4 cid="n36" mdtype="heading"><span md-inline="plain">空间 ATAC-seq UMAP 降维聚类图 (Extend Fig.4.b)</span></h4><pre spellcheck="false" lang="R" cid="n37" mdtype="fences"><span role="presentation"><span>cols4</span> <span>&lt;-</span> <span>c</span>(<span>"#6ADCD6"</span>, <span>"#93D481"</span>, <span>"#D683B7"</span>, <span>"#DCD5AF"</span> )</span><br><span role="presentation"><span>names</span>(<span>cols4</span>) <span>&lt;-</span> <span>c</span>(<span>"C1"</span>,<span>"C2"</span>,<span>"C3"</span>,<span>"C4"</span>)</span><br><span role="presentation"><span>p4</span> <span>&lt;-</span> <span>plotEmbedding</span>(</span><br><span role="presentation">  <span>proj_in_tissue</span>,</span><br><span role="presentation">  <span>colorBy</span> = <span>"cellColData"</span>,</span><br><span role="presentation">  <span>embedding</span> = <span>"UMAP"</span>,</span><br><span role="presentation">  <span>name</span> = <span>"Clusters"</span>,<span>pal</span> = <span>cols4</span>, <span>size</span> = <span>0.3</span>)</span><br><span role="presentation"><span>ggsave</span>(<span>file</span> <span>=</span> <span>"./2023_xunyin_fig/4_clusters_UMAP.png"</span>, <span>plot</span><span>=</span><span>p4</span>, <span>width</span><span>=</span><span>10</span>, <span>height</span><span>=</span><span>8</span>)</span></pre><p><img data-galleryid="" data-imgfileid="100023834" data-ratio="1.1566666666666667" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5T3ic82gESTe7vVgLCBwPBRmFV36bkyU8VV6zVpCCmXctoN9L3hfUKYA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="300" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5T3ic82gESTe7vVgLCBwPBRmFV36bkyU8VV6zVpCCmXctoN9L3hfUKYA/640?wx_fmt=png&amp;from=appmsg"></p><h4 cid="n39" mdtype="heading"><span md-inline="plain">Marker Feature 空间表达可视化 (Extend Fig.4.c)</span></h4><pre spellcheck="false" lang="R" cid="n40" mdtype="fences"><span role="presentation"><span>## marker feature可视化(图4c)</span></span><br><span role="presentation"><span>features</span> <span>&lt;-</span> <span>c</span>(<span>"Slc4a1"</span>, <span>"Nova2"</span>, <span>"Il1rapl1"</span>, <span>"Rarg"</span>)</span><br><span role="presentation"><span>feature</span> <span>&lt;-</span> <span>"Il1rapl1"</span></span><br><span role="presentation"><span>DefaultAssay</span>(<span>spatial.obj</span>) <span>&lt;-</span> <span>"Spatial"</span></span><br><span role="presentation"><span>p2_1</span> <span>&lt;-</span> <span>SpatialDimPlot_new</span>(<span>spatial.obj</span>, <span>features</span> <span>=</span><span>feature</span>, <span>image.alpha</span> <span>=</span> <span>1</span>,</span><br><span role="presentation">                           <span>facet.highlight</span> <span>=</span> <span>TRUE</span>, <span>pt.size.factor</span> <span>=</span> <span>2</span>, <span>alpha</span> <span>=</span> <span>c</span>(<span>0.8</span>,<span>0.7</span>), <span>stroke</span> <span>=</span> <span>0</span>)</span><br><span role="presentation"><span>p2_1</span><span>$</span><span>layers</span>[[<span>1</span>]]<span>$</span><span>aes_params</span> <span>&lt;-</span> <span>c</span>(<span>p2_1</span><span>$</span><span>layers</span>[[<span>1</span>]]<span>$</span><span>aes_params</span>, <span>shape</span><span>=</span><span>22</span>)</span><br><span role="presentation"><span>p2_1</span></span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>ggsave</span>(<span>file</span> <span>=</span> <span>"./2023_xunyin_fig/4-Il1rapl1.png"</span>, <span>plot</span><span>=</span><span>p2_1</span>, <span>width</span><span>=</span><span>10</span>, <span>height</span><span>=</span><span>8</span>)</span></pre><p><img data-galleryid="" data-imgfileid="100023835" data-ratio="1.065217391304348" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5TbF9KUrz7QoTCGyHqBkGW6zgz6JLomywWK09oic9hKUPwWExpkfPksw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="690" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5TbF9KUrz7QoTCGyHqBkGW6zgz6JLomywWK09oic9hKUPwWExpkfPksw/640?wx_fmt=png&amp;from=appmsg"></p><h4 cid="n43" mdtype="heading"><span md-inline="plain">整合 E11.5 时期的 scRNA-seq和空间 ATAC-seq 数据. (Extend Fig.4.d)</span></h4><pre spellcheck="false" lang="R" cid="n44" mdtype="fences"><span role="presentation"><span>## RNA 整合可可视化(Extend Fig.4d)</span></span><br><span role="presentation"><span>### RNA combine对象</span></span><br><span role="presentation"><span>combined_obj</span> <span>&lt;-</span> <span>readRDS</span>(<span>"./seurat_int/combined_obj.rds"</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>Idents</span>(<span>combined_obj</span>) <span>&lt;-</span> <span>"Main_cell_type"</span></span><br><span role="presentation"><span>celltype</span> <span>&lt;-</span> <span>c</span>(<span>"Excitatory neurons"</span>, <span>"Primitive erythroid lineage"</span>, <span>"Radial glia"</span>,</span><br><span role="presentation">              <span>"Postmitotic premature neurons"</span>,<span>"Inhibitory neuron progenitors"</span>,</span><br><span role="presentation">              <span>"Connective tissue progenitors"</span>,<span>"Early mesenchyme"</span>,</span><br><span role="presentation">              <span>"Osteoblasts"</span>,<span>"Jaw and tooth progenitors"</span>)</span><br><span role="presentation"><span>celltype_hig_cols</span> <span>&lt;-</span> <span>c</span>(<span>"#A99B3A"</span>,<span>"#69AB36"</span>, <span>"#4DAAE9"</span>,<span>"#55BA7F"</span>,<span>"#54B5BF"</span>,<span>"#CF9533"</span>,<span>"#B0A133"</span>,<span>"#BC82F7"</span>,<span>"#22c9c5"</span>)</span><br><span role="presentation"><span>celltype_cols</span> <span>&lt;-</span> <span>rep</span>(<span>"grey"</span>,<span>37</span>)</span><br><span role="presentation"><span>names</span>(<span>celltype_cols</span>) <span>&lt;-</span> <span>names</span>(<span>table</span>(<span>combined_obj</span>@<span>meta.data</span><span>$</span><span>Main_cell_type</span>))</span><br><span role="presentation"><span>celltype_cols</span>[<span>celltype</span>] <span>&lt;-</span> <span>celltype_hig_cols</span></span><br><span role="presentation"><span>p</span> <span>&lt;-</span> <span>DimPlot</span>(</span><br><span role="presentation">  <span>object</span> = <span>combined_obj</span>,</span><br><span role="presentation">  <span>reduction</span> = <span>"umap"</span>,</span><br><span role="presentation">  <span>group.by</span> = <span>"Main_cell_type"</span>,</span><br><span role="presentation">  <span># label = T</span></span><br><span role="presentation">  <span>cols</span> = <span>celltype_cols</span></span><br><span role="presentation">  <span># cells.highlight=colnames(spatial.obj)</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>ggsave</span>(<span>file</span> <span>=</span> <span>"./2023_xunyin_fig/4-MOCA_RNA_umap.png"</span>, <span>plot</span><span>=</span><span>p</span>, <span>width</span><span>=</span><span>12</span>, <span>height</span><span>=</span><span>8</span>)</span></pre><p><img data-galleryid="" data-imgfileid="100023836" data-ratio="0.6737357259380098" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5lEeBOLoygaOzD6n8PZTbicl9VTNtN6hiantfs5skC4icYBGUwcqZz4g4A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="613" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5lEeBOLoygaOzD6n8PZTbicl9VTNtN6hiantfs5skC4icYBGUwcqZz4g4A/640?wx_fmt=png&amp;from=appmsg"></p><pre spellcheck="false" lang="R" cid="n46" mdtype="fences"><span role="presentation"><span>### ATAC this work</span></span><br><span role="presentation"><span>combined_obj</span> <span>&lt;-</span> <span>readRDS</span>(<span>'./seurat_int/combined_obj.rds'</span>)</span><br><span role="presentation"><span>color_all_celltype</span> <span>&lt;-</span> <span>c</span>(<span>"#e87d72"</span>, <span>"#e3835b"</span>, <span>"#dc8940"</span>, <span>"#d48132"</span>,<span>"#010101"</span>, <span>"#c19933"</span>, <span>"#010101"</span>, <span>"#a9a333"</span>, <span>"#9ba734"</span> , <span>"#8bab34"</span>, <span>"#010101"</span>, <span>"#63b234"</span>, <span>"#53b643"</span>, <span>"#55b95d"</span>, <span>"#010101"</span>, <span>"#56bc87"</span>, <span>"#56bd9a"</span>, <span>"#56beab"</span>, <span>"#010101"</span>, <span>"#54bcca"</span>, <span>"#53b9d8"</span>, <span>"#51b5e4"</span>, <span>"#4dafee"</span>,<span>"#4aa9f7"</span>, <span>"#52a1f8"</span>, <span>"799af8"</span>, <span>"#9691f8"</span>, <span>"#ad88f8"</span>, <span>"#010101"</span>, <span>"#010101"</span>, <span>"#dc72e8"</span>, <span>"#010101"</span>, <span>"#010101"</span>, <span>"#ed6dbe"</span>, <span>"#ed6fad"</span>, <span>"#ee739b"</span>, <span>"#ec7887"</span>)</span><br><span role="presentation"><span>p</span> <span>&lt;-</span> <span>DimPlot</span>(</span><br><span role="presentation">  <span>object</span> = <span>combined_obj</span>,</span><br><span role="presentation">  <span>reduction</span> = <span>"umap"</span>,</span><br><span role="presentation">  <span>group.by</span> = <span>"Main_cell_type"</span>,</span><br><span role="presentation">  <span># label = T</span></span><br><span role="presentation">  <span>cols</span> = <span>color_all_celltype</span></span><br><span role="presentation">  <span># cells.highlight=colnames(spatial.obj)</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>p</span></span><br><span role="presentation"><span>ggsave</span>(<span>file</span> <span>=</span> <span>"./2023_xunyin_fig/4-ATAC_this_work_umap.png"</span>, <span>plot</span><span>=</span><span>p</span>, <span>width</span><span>=</span><span>12</span>, <span>height</span><span>=</span><span>8</span>)</span></pre><p><img data-galleryid="" data-imgfileid="100023837" data-ratio="0.6721044045676998" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5aMXcyJKtShCPtcs3E8hnJvXKEZT1DCFZrORvqepHNT5VFuHdJsWMfw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="613" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5aMXcyJKtShCPtcs3E8hnJvXKEZT1DCFZrORvqepHNT5VFuHdJsWMfw/640?wx_fmt=png&amp;from=appmsg"></p><h4 cid="n48" mdtype="heading"><span md-inline="plain">特定细胞类型空间分布 (Extend Fig.4.f)</span></h4><pre spellcheck="false" lang="R" cid="n49" mdtype="fences"><span role="presentation"><span>#### 可视化特定细胞类型空间分布 (图4f)</span></span><br><span role="presentation"><span>meta.data.integration</span> <span>&lt;-</span> <span>as.data.frame</span>(<span>getCellColData</span>(<span>ArchRProj</span> <span>=</span> <span>proj_in_tissue</span>))[, <span>c</span>(<span>'predictedCell'</span>, <span>'predictedGroup'</span>, <span>'predictedScore'</span>)]</span><br><span role="presentation"><span>new_row_names</span> <span>&lt;-</span> <span>row.names</span>(<span>meta.data.integration</span>)</span><br><span role="presentation"><span>new_row_names</span> <span>&lt;-</span> <span>unlist</span>(<span>lapply</span>(<span>new_row_names</span>, <span>function</span>(<span>x</span>) <span>gsub</span>(<span>".*#"</span>,<span>""</span>, <span>x</span>)))</span><br><span role="presentation"><span>new_row_names</span> <span>&lt;-</span> <span>unlist</span>(<span>lapply</span>(<span>new_row_names</span>, <span>function</span>(<span>x</span>) <span>gsub</span>(<span>"-.*"</span>,<span>""</span>, <span>x</span>)))</span><br><span role="presentation"><span>row.names</span>(<span>meta.data.integration</span>) <span>&lt;-</span> <span>new_row_names</span></span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>spatial.obj2</span> <span>&lt;-</span> <span>AddMetaData</span>(<span>object</span> <span>=</span> <span>spatial.obj</span>, <span>metadata</span> <span>=</span> <span>meta.data.integration</span>)</span><br><span role="presentation"><span>Idents</span>(<span>spatial.obj2</span>) <span>&lt;-</span> <span>'predictedGroup'</span></span><br><span role="presentation"><span>ids.highlight</span> <span>&lt;-</span> <span>names</span>(<span>table</span>(<span>spatial.obj2</span><span>$</span><span>predictedGroup</span>))[<span>1</span>]</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span># ids.highlight &lt;- "Limb mesenchyme"</span></span><br><span role="presentation"><span>ids.highlight</span> <span>&lt;-</span> <span>"Radial glia"</span></span><br><span role="presentation"><span>ids.highlight</span> <span>&lt;-</span> <span>"Primitive erythroid lineage"</span></span><br><span role="presentation"><span>ids.highlight</span> <span>&lt;-</span> <span>"Postmitotic premature neurons"</span></span><br><span role="presentation"><span>ids.highlight</span> <span>&lt;-</span> <span>"Inhibitory neuron progenitors"</span></span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>p2</span> <span>&lt;-</span> <span>SpatialDimPlot_new</span>(<span>spatial.obj2</span>, <span>cells.highlight</span> <span>=</span> <span>CellsByIdentities</span>(<span>object</span> <span>=</span> <span>spatial.obj2</span>, <span>idents</span> <span>=</span> <span>ids.highlight</span>), </span><br><span role="presentation">                         <span>facet.highlight</span> <span>=</span> <span>TRUE</span>, <span>pt.size.factor</span> <span>=</span> <span>2.5</span>, <span>alpha</span> <span>=</span> <span>c</span>(<span>1</span>,<span>0</span>), <span>stroke</span> <span>=</span> <span>0</span>)</span><br><span role="presentation"><span>p2</span><span>$</span><span>layers</span>[[<span>1</span>]]<span>$</span><span>aes_params</span> <span>&lt;-</span> <span>c</span>(<span>p2</span><span>$</span><span>layers</span>[[<span>1</span>]]<span>$</span><span>aes_params</span>, <span>shape</span><span>=</span><span>22</span>)</span><br><span role="presentation"><span>p2</span></span><br><span role="presentation"><span>ggsave</span>(<span>file</span> <span>=</span> <span>"./2023_xunyin_fig/Inhibitory neuron progenitors.png"</span>, <span>plot</span><span>=</span><span>p2</span>, <span>width</span><span>=</span><span>10</span>, <span>height</span><span>=</span><span>8</span>)</span></pre><p><img data-galleryid="" data-imgfileid="100023838" data-ratio="0.8872727272727273" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5x2zbdic6oqEskDNF7PSbcqwAG3a7hMRAX8Chyv5FK45PDLHVGcMnhRQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="550" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5x2zbdic6oqEskDNF7PSbcqwAG3a7hMRAX8Chyv5FK45PDLHVGcMnhRQ/640?wx_fmt=png&amp;from=appmsg"><span></span></p><center>   </center><p><span></span></p><p cid="n51" mdtype="paragraph"><br></p><h4 cid="n53" mdtype="heading"><span md-inline="plain">空间拟时序推断-放射状胶质细胞到兴奋性神经元的发育过程. (Extend Fig.4.g)</span></h4><pre spellcheck="false" lang="R" cid="n54" mdtype="fences"><span role="presentation"><span>#### 拟时序分析结果展示 (图4g)       </span></span><br><span role="presentation"><span>meta.data.integration</span> <span>&lt;-</span> <span>as.data.frame</span>(<span>getCellColData</span>(<span>ArchRProj</span> <span>=</span> <span>projCUTA</span>))[, <span>c</span>(<span>'Neuron_U'</span>), <span>drop</span><span>=</span><span>FALSE</span>]</span><br><span role="presentation"><span>new_row_names</span> <span>&lt;-</span> <span>row.names</span>(<span>meta.data.integration</span>)</span><br><span role="presentation"><span>new_row_names</span> <span>&lt;-</span> <span>unlist</span>(<span>lapply</span>(<span>new_row_names</span>, <span>function</span>(<span>x</span>) <span>gsub</span>(<span>".*#"</span>,<span>""</span>, <span>x</span>)))</span><br><span role="presentation"><span>new_row_names</span> <span>&lt;-</span> <span>unlist</span>(<span>lapply</span>(<span>new_row_names</span>, <span>function</span>(<span>x</span>) <span>gsub</span>(<span>"-.*"</span>,<span>""</span>, <span>x</span>)))</span><br><span role="presentation"><span>row.names</span>(<span>meta.data.integration</span>) <span>&lt;-</span> <span>new_row_names</span></span><br><span role="presentation"><span>all</span>(<span>row.names</span>(<span>meta.data.integration</span>) <span>==</span> <span>colnames</span>(<span>spatial.obj</span>))</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>spatial.obj1</span> <span>&lt;-</span> <span>AddMetaData</span>(<span>object</span> <span>=</span> <span>spatial.obj</span>, <span>metadata</span> <span>=</span> <span>meta.data.integration</span>)</span><br><span role="presentation"><span>spatial.obj1</span><span>$</span><span>PseudoTime</span> <span>&lt;-</span> <span>spatial.obj1</span><span>$</span><span>Neuron_U</span></span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>p1</span> <span>&lt;-</span> <span>SpatialPlot_traj</span>(<span>spatial.obj1</span>, <span>features</span> <span>=</span> <span>"PseudoTime"</span>,  <span>pt.size.factor</span> <span>=</span> <span>3</span>, <span>image.alpha</span> <span>=</span> <span>0</span>, <span>stroke</span> <span>=</span> <span>0</span>) <span>+</span></span><br><span role="presentation">  <span>theme</span>(<span>legend.position</span> <span>=</span> <span>"right"</span>, <span>legend.text</span><span>=</span><span>element_text</span>(<span>size</span><span>=</span><span>15</span>), <span>legend.title</span><span>=</span><span>element_text</span>(<span>size</span><span>=</span><span>15</span>))</span><br><span role="presentation"><span>p1</span><span>$</span><span>layers</span>[[<span>1</span>]]<span>$</span><span>aes_params</span> <span>&lt;-</span> <span>c</span>(<span>p1</span><span>$</span><span>layers</span>[[<span>1</span>]]<span>$</span><span>aes_params</span>, <span>shape</span><span>=</span><span>22</span>)</span><br><span role="presentation"><span>p1</span></span><br><span role="presentation"><span>ggsave</span>(<span>file</span> <span>=</span> <span>"./2023_xunyin_fig/4-PseudoTime_traj_splot.png"</span>, <span>plot</span><span>=</span><span>p1</span>, <span>width</span><span>=</span><span>10</span>, <span>height</span><span>=</span><span>8</span>)</span></pre><p><img data-galleryid="" data-imgfileid="100023839" data-ratio="0.8620689655172413" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5fbtz3OyeKWoZ9VWb5NJKbPYjZiasiclzY8CrxBkezdZ3nsoIicmQXyJng/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="348" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5fbtz3OyeKWoZ9VWb5NJKbPYjZiasiclzY8CrxBkezdZ3nsoIicmQXyJng/640?wx_fmt=png&amp;from=appmsg"></p><h4 cid="n56" mdtype="heading"><span md-inline="plain">Notch1基因得分的空间表达可视化 (Extend Fig.4.h)</span></h4><pre spellcheck="false" lang="R" cid="n57" mdtype="fences"><span role="presentation"><span>#### Notch1 可视化 (图4h)</span></span><br><span role="presentation"><span>p3</span> <span>&lt;-</span> <span>SpatialPlot_new</span>(<span>spatial.obj1</span>, <span>features</span> <span>=</span> <span>"Notch1"</span>,  <span>pt.size.factor</span> <span>=</span> <span>3</span>, <span>min.cutoff</span> <span>=</span> <span>"q10"</span>, <span>max.cutoff</span> <span>=</span> <span>"q90"</span>, <span>image.alpha</span> <span>=</span> <span>0</span>, <span>stroke</span> <span>=</span> <span>0</span>) <span>+</span> </span><br><span role="presentation">  <span>theme</span>(<span>legend.position</span> <span>=</span> <span>"right"</span>, <span>legend.text</span><span>=</span><span>element_text</span>(<span>size</span><span>=</span><span>15</span>), <span>legend.title</span><span>=</span><span>element_text</span>(<span>size</span><span>=</span><span>15</span>))</span><br><span role="presentation"><span>p3</span><span>$</span><span>layers</span>[[<span>1</span>]]<span>$</span><span>aes_params</span> <span>&lt;-</span> <span>c</span>(<span>p3</span><span>$</span><span>layers</span>[[<span>1</span>]]<span>$</span><span>aes_params</span>, <span>shape</span><span>=</span><span>22</span>)</span><br><span role="presentation"><span>p3</span></span><br><span role="presentation"><span>ggsave</span>(<span>file</span> <span>=</span> <span>"./2023_xunyin_fig/4-Notch1_traj.jpg"</span>, <span>plot</span><span>=</span><span>p3</span>, <span>width</span><span>=</span><span>10</span>, <span>height</span><span>=</span><span>8</span>)</span></pre><p><img data-galleryid="" data-imgfileid="100023840" data-ratio="0.884272997032641" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha506TiaiaRzLriaaxEfOtVpuWDH0Ua55bJ0nOIibKPtk73rD8RDLIXKrry6w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="337" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha506TiaiaRzLriaaxEfOtVpuWDH0Ua55bJ0nOIibKPtk73rD8RDLIXKrry6w/640?wx_fmt=png&amp;from=appmsg"></p><h4 cid="n60" mdtype="heading"><span md-inline="plain">动态基因的拟时序表达轨迹图谱 (Extend Fig.4.i)</span></h4><pre spellcheck="false" lang="R" cid="n61" mdtype="fences"><span role="presentation"><span>trajectory</span> <span>&lt;-</span> <span>c</span>(<span>"Radial glia"</span>, <span>"Postmitotic premature neurons"</span>, <span>"Excitatory neurons"</span>)</span><br><span role="presentation"><span>projCUTA</span> <span>&lt;-</span> <span>addTrajectory</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>, </span><br><span role="presentation">  <span>name</span> = <span>"Neuron_U"</span>, </span><br><span role="presentation">  <span>groupBy</span> = <span>"predictedGroup"</span>,</span><br><span role="presentation">  <span>trajectory</span> = <span>trajectory</span>, </span><br><span role="presentation">  <span>embedding</span> = <span>"UMAP"</span>, </span><br><span role="presentation">  <span>force</span> = <span>TRUE</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>projCUTA</span> <span>&lt;-</span> <span>addImputeWeights</span>(<span>projCUTA</span>)</span><br><span role="presentation"><span># gene &lt;- c("Sox2", "Pax6", "Ntng1", "Car10")</span></span><br><span role="presentation"><span>p1_1</span> <span>&lt;-</span> <span>plotTrajectory</span>(</span><br><span role="presentation">  <span>projCUTA</span>,</span><br><span role="presentation">  <span>trajectory</span> = <span>"Neuron_U"</span>,</span><br><span role="presentation">  <span>colorBy</span> = <span>"GeneIntegrationMatrix"</span>,</span><br><span role="presentation">  <span>name</span> = <span>"Sox2"</span>,</span><br><span role="presentation">  <span>continuousSet</span> = <span>"horizonExtra"</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>p1_1</span>[[<span>2</span>]]</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>ggsave</span>(<span>file</span> <span>=</span> <span>"./2023_xunyin_fig/4-Sox2_PseudoTime_traj.png"</span>, <span>plot</span><span>=</span><span>p1_1</span>[[<span>2</span>]], <span>width</span><span>=</span><span>10</span>, <span>height</span><span>=</span><span>8</span>)</span></pre><p><img data-galleryid="" data-imgfileid="100023841" data-ratio="0.7171314741035857" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha53VlXwSv9Jo4P94vdzFuCf7Fd6UtjC48tYibUNb2xiaYZ63DLnDsVIpEQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="753" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha53VlXwSv9Jo4P94vdzFuCf7Fd6UtjC48tYibUNb2xiaYZ63DLnDsVIpEQ/640?wx_fmt=png&amp;from=appmsg"></p><p><span></span></p><center>   </center><p><span></span></p><p cid="n64" mdtype="paragraph"><br></p><h4 cid="n65" mdtype="heading"><span md-inline="plain">TF基序的拟时序表达动态热图 (径向胶质细胞到兴奋性神经元的变化) (Extend Fig.4.j)</span></h4><pre spellcheck="false" lang="R" cid="n66" mdtype="fences"><span role="presentation"><span>#### 基因相关拟时序表达热图 (图4j)</span></span><br><span role="presentation"><span>trajGSM</span> <span>&lt;-</span> <span>getTrajectory</span>(<span>ArchRProj</span> <span>=</span> <span>projCUTA</span>,<span>name</span> <span>=</span> <span>"Neuron_U"</span>,</span><br><span role="presentation">                         <span>useMatrix</span> <span>=</span> <span>"GeneScoreMatrix"</span>,</span><br><span role="presentation">                         <span>log2Norm</span> <span>=</span> <span>TRUE</span>)</span><br><span role="presentation"><span>p2</span> <span>&lt;-</span> <span>trajectoryHeatmap</span>(<span>trajGSM</span>, <span>pal</span> <span>=</span> <span>paletteContinuous</span>(<span>set</span><span>=</span> <span>"horizonExtra"</span>))</span><br><span role="presentation"><span># ggsave(file = "./2023_xunyin_fig/PseudoTime_traj_heatmap.png", plot=p1, width=10, height=8)</span></span><br><span role="presentation"><span>ggsave</span>(<span>file</span> <span>=</span> <span>"./2023_xunyin_fig/4-motif-heatmap_pseudoTime_traj.png"</span>, <span>plot</span><span>=</span><span>p1</span>, <span>width</span><span>=</span><span>10</span>, <span>height</span><span>=</span><span>8</span>)</span></pre><p><img data-galleryid="" data-imgfileid="100023842" data-ratio="0.9170212765957447" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5bJbWh8pFUibQsc9Kib3YxneDmXYARHCGCWCUTlPC3f88IicFt2HEZvSEA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="470" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5bJbWh8pFUibQsc9Kib3YxneDmXYARHCGCWCUTlPC3f88IicFt2HEZvSEA/640?wx_fmt=png&amp;from=appmsg"></p><h3 cid="n68" mdtype="heading"><span md-inline="plain">Extend Fig.6 绘图代码</span></h3><h4 cid="n69" mdtype="heading"><span md-inline="plain">空间降维聚类图谱(Extend Fig.5.b)</span></h4><pre spellcheck="false" lang="R" cid="n70" mdtype="fences"><span role="presentation"><span>#### 可视化cluster注释结果空间分布(图5b)</span></span><br><span role="presentation"><span>projCUTA</span> <span>&lt;-</span> <span>loadArchRProject</span>(<span>"./projCUTA/"</span>)</span><br><span role="presentation"><span>n_clusters</span> <span>&lt;-</span> <span>length</span>(<span>unique</span>(<span>projCUTA</span><span>$</span><span>Clusters</span>))</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>n_clusters</span> <span>&lt;-</span> <span>length</span>(<span>unique</span>(<span>proj_in_tissue</span><span>$</span><span>Clusters</span>))</span><br><span role="presentation"><span>cols</span> <span>&lt;-</span> <span>ArchRPalettes</span><span>$</span><span>stallion</span>[<span>as.character</span>(<span>seq_len</span>(<span>n_clusters</span>))]</span><br><span role="presentation"><span>names</span>(<span>cols</span>) <span>&lt;-</span> <span>paste0</span>(<span>'C'</span>, <span>seq_len</span>(<span>n_clusters</span>))</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>names</span>(<span>cols</span>) <span>&lt;-</span> <span>c</span>(<span>"C1"</span>,<span>"C4"</span>,<span>"C3"</span>,<span>"C2"</span>)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>p4</span> <span>&lt;-</span> <span>SpatialPlot</span>(<span>spatial.obj</span>, <span>label</span> <span>=</span> <span>FALSE</span>, <span>label.size</span> <span>=</span> <span>3</span>, <span>group.by</span> <span>=</span> <span>'Clusters'</span>, <span>pt.size.factor</span> <span>=</span> <span>3</span>, <span>cols</span> <span>=</span> <span>cols</span>, <span>image.alpha</span> <span>=</span> <span>0</span>, <span>stroke</span> <span>=</span> <span>0</span>)</span><br><span role="presentation"><span>p4</span><span>$</span><span>layers</span>[[<span>1</span>]]<span>$</span><span>aes_params</span> <span>&lt;-</span> <span>c</span>(<span>p4</span><span>$</span><span>layers</span>[[<span>1</span>]]<span>$</span><span>aes_params</span>, <span>shape</span><span>=</span><span>22</span>)</span><br><span role="presentation"><span>p4</span></span><br><span role="presentation"><span>ggsave</span>(<span>file</span> <span>=</span> <span>"./2023_xunyin_fig/5_cluster_splot.png"</span>, <span>plot</span><span>=</span><span>p4</span>, <span>width</span><span>=</span><span>10</span>, <span>height</span><span>=</span><span>8</span>)</span></pre><p><img data-galleryid="" data-imgfileid="100023843" data-ratio="0.8810975609756098" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5o3Vm9M6fgNGlWXfvURjxb3tQF4wctsCNYYIu1wNrPCIqwXBwmrQtBg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="328" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5o3Vm9M6fgNGlWXfvURjxb3tQF4wctsCNYYIu1wNrPCIqwXBwmrQtBg/640?wx_fmt=png&amp;from=appmsg"></p><h4 cid="n72" mdtype="heading"><span md-inline="plain">特定features的可及性图谱(Extend Fig.5.c)</span></h4><pre spellcheck="false" lang="R" cid="n73" mdtype="fences"><span role="presentation"><span>###### 可视化trackplot(图5c)</span></span><br><span role="presentation"><span>markers</span> <span>&lt;-</span> <span>c</span>(<span>"Slc4a1"</span>, <span>"Nova2"</span>, <span>"Rarg"</span>)</span><br><span role="presentation"><span>p7</span> <span>&lt;-</span> <span>plotBrowserTrack</span>(</span><br><span role="presentation">  <span>ArchRProj</span> = <span>proj_in_tissue</span>, </span><br><span role="presentation">  <span>groupBy</span> = <span>"Clusters"</span>, </span><br><span role="presentation">  <span>geneSymbol</span> = <span>markers</span>,</span><br><span role="presentation">  <span>upstream</span> = <span>50000</span>,</span><br><span role="presentation">  <span>downstream</span> = <span>50000</span></span><br><span role="presentation">)</span><br><span role="presentation"><span>grid</span><span>::</span><span>grid.newpage</span>()</span><br><span role="presentation"><span>grid</span><span>::</span><span>grid.draw</span>(<span>p7</span><span>$</span><span>Nova2</span>)</span><br><span role="presentation"><span>plotPDF</span>(<span>plotList</span> <span>=</span> <span>p7</span>, </span><br><span role="presentation">        <span>name</span> <span>=</span> <span>"Plot-Tracks-Marker-Genes.pdf"</span>, </span><br><span role="presentation">        <span>ArchRProj</span> <span>=</span> <span>proj_in_tissue</span>, </span><br><span role="presentation">        <span>addDOC</span> <span>=</span> <span>FALSE</span>, <span>width</span> <span>=</span> <span>5</span>, <span>height</span> <span>=</span> <span>5</span>)</span></pre><p><img data-galleryid="" data-imgfileid="100023844" data-ratio="0.37922403003754696" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5UebTvLicZok3BRiazSpm05ia6W2RiaqsibibVrGcuYDvpL6pu2MScvHMo5CQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="799" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5UebTvLicZok3BRiazSpm05ia6W2RiaqsibibVrGcuYDvpL6pu2MScvHMo5CQ/640?wx_fmt=png&amp;from=appmsg"></p><h4 cid="n75" mdtype="heading"><span md-inline="plain">染色质可及性umap降维聚类图谱 (Extend Fig.5.d)</span></h4><pre spellcheck="false" lang="R" cid="n76" mdtype="fences"><span role="presentation"><span>#### clusters UMAP (图5d)   </span></span><br><span role="presentation"><span>cols5</span> <span>&lt;-</span> <span>c</span>(<span>"#D51F26"</span>, <span>"#272E6A"</span>, <span>"#208A42"</span>, <span>"#89288F"</span> )</span><br><span role="presentation"><span>names</span>(<span>cols5</span>) <span>&lt;-</span> <span>c</span>(<span>"C1"</span>,<span>"C4"</span>,<span>"C3"</span>,<span>"C2"</span>)</span><br><span role="presentation"><span>p5</span> <span>&lt;-</span> <span>plotEmbedding</span>(</span><br><span role="presentation">  <span>proj_in_tissue</span>,</span><br><span role="presentation">  <span>colorBy</span> = <span>"cellColData"</span>,</span><br><span role="presentation">  <span>embedding</span> = <span>"UMAP"</span>,</span><br><span role="presentation">  <span>name</span> = <span>"Clusters"</span>,<span>pal</span> = <span>cols5</span>, <span>size</span> = <span>0.3</span>)</span><br><span role="presentation"><span>ggsave</span>(<span>file</span> <span>=</span> <span>"./2023_xunyin_fig/5_clusters_UMAP.png"</span>, <span>plot</span><span>=</span><span>p5</span>, <span>width</span><span>=</span><span>10</span>, <span>height</span><span>=</span><span>8</span>)</span></pre><p><img data-galleryid="" data-imgfileid="100023845" data-ratio="1.1433224755700326" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5RicHWYW6l6Lg0RpfxHTWW37FibuCNCT34EavXYcVMGjicvV1nEpibIKxkA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="307" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5RicHWYW6l6Lg0RpfxHTWW37FibuCNCT34EavXYcVMGjicvV1nEpibIKxkA/640?wx_fmt=png&amp;from=appmsg"></p><h4 cid="n78" mdtype="heading"><span md-inline="plain">标记基因得分的空间表达图谱 (Extend Fig.5.h)</span></h4><pre spellcheck="false" lang="R" cid="n79" mdtype="fences"><span role="presentation"><span>features</span> <span>&lt;-</span> <span>c</span>(<span>"Slc4a1"</span>, <span>"Nova2"</span>, <span>"Rarg"</span>)</span><br><span role="presentation"><span>feature</span> <span>&lt;-</span> <span>"Rarg"</span></span><br><span role="presentation"><span>DefaultAssay</span>(<span>spatial.obj</span>) <span>&lt;-</span> <span>"Spatial"</span></span><br><span role="presentation"><span>p3</span> <span>&lt;-</span> <span>SpatialPlot_new</span>(<span>spatial.obj</span>, <span>features</span> <span>=</span> <span>"Rarg"</span>,  <span>pt.size.factor</span> <span>=</span> <span>3</span>, <span>min.cutoff</span> <span>=</span> <span>"q10"</span>, <span>max.cutoff</span> <span>=</span> <span>"q90"</span>, <span>image.alpha</span> <span>=</span> <span>0</span>, <span>stroke</span> <span>=</span> <span>0</span>) <span>+</span> </span><br><span role="presentation">  <span>theme</span>(<span>legend.position</span> <span>=</span> <span>"right"</span>, <span>legend.text</span><span>=</span><span>element_text</span>(<span>size</span><span>=</span><span>15</span>), <span>legend.title</span><span>=</span><span>element_text</span>(<span>size</span><span>=</span><span>15</span>))</span><br><span role="presentation"><span>p3</span><span>$</span><span>layers</span>[[<span>1</span>]]<span>$</span><span>aes_params</span> <span>&lt;-</span> <span>c</span>(<span>p3</span><span>$</span><span>layers</span>[[<span>1</span>]]<span>$</span><span>aes_params</span>, <span>shape</span><span>=</span><span>22</span>)</span><br><span role="presentation"><span>p3</span></span><br><span role="presentation"><span>ggsave</span>(<span>file</span> <span>=</span> <span>"./2023_xunyin_fig/5_Rarg.png"</span>, <span>plot</span><span>=</span><span>p3</span>, <span>width</span><span>=</span><span>10</span>, <span>height</span><span>=</span><span>8</span>)</span></pre><p><img data-galleryid="" data-imgfileid="100023846" data-ratio="0.8835820895522388" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha52PMzZAlj9vVEQCBibBc47VUfPJnh9WPVxU1oSPjw7BWYBZasSkFuJuA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="335" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha52PMzZAlj9vVEQCBibBc47VUfPJnh9WPVxU1oSPjw7BWYBZasSkFuJuA/640?wx_fmt=png&amp;from=appmsg"></p><h3 cid="n81" mdtype="heading"><span md-inline="plain">Extend Fig.6 绘图代码</span></h3><h4 cid="n82" mdtype="heading"><span md-inline="plain">marker peaks 的可视化(Extend Fig.6.a)</span></h4><pre spellcheck="false" lang="R" cid="n83" mdtype="fences"><span role="presentation"><span>heatmapPeaks</span> <span>&lt;-</span> <span>markerHeatmap</span>(</span><br><span role="presentation">  <span>seMarker</span> = <span>markersPeaks</span>,</span><br><span role="presentation">  <span>cutOff</span> = <span>"FDR &lt;= 0.1 &amp; Log2FC &gt;= 0.5"</span>,</span><br><span role="presentation">  <span>transpose</span> = <span>TRUE</span></span><br><span role="presentation">)</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span><br><span role="presentation"><span>heat_p</span> <span>&lt;-</span> <span>draw</span>(<span>heatmapPeaks</span>,<span>heatmap_legend_side</span> <span>=</span> <span>"bot"</span>,<span>annotation_legend_side</span> <span>=</span><span>"bot"</span>)</span><br><span role="presentation"><span>ggsave</span>(<span>file</span> <span>=</span> <span>"./2023_xunyin_fig/6_heatmapPeaks.png"</span>, <span>plot</span><span>=</span><span>heat_p</span>, <span>width</span><span>=</span><span>10</span>, <span>height</span><span>=</span><span>8</span>)</span></pre><p><img data-galleryid="" data-imgfileid="100023847" data-ratio="0.6666666666666666" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5rB0ZlwJV3goZF0Ek622h1cOjXwJ3fx0kAAjsb9NMibMtmTyljAZKS3g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="714" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5rB0ZlwJV3goZF0Ek622h1cOjXwJ3fx0kAAjsb9NMibMtmTyljAZKS3g/640?wx_fmt=png&amp;from=appmsg"><span></span></p><section><br></section><section><br></section></section><section><p data-form="0" data-num="1">01</p></section></section></section><section><br></section></section></section></section><section><br></section><p><br></p></section></section></section><section><br></section><section data-support="96编辑器" data-style-id="35217"><section><section><p>二、测试文件及代码</p></section><section><section><section><section><p>如果你也想学习本文的代码和思路，我们给大家准备好了测试文件和代码。</p><p>链接：<span>https://pan.baidu.com/s/1qzbE7swL-pKMBIzRy8ey6Q?pwd=oqi9 </span></p><p>提取码：<span>oqi9 </span></p><p><img data-galleryid="" data-imgfileid="100023851" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5JDibEbC6MspLaG7oQz5Mib87ofl0SiaZ8GIDR261BJcY70ML7E2l9cQ4g/640?wx_fmt=jpeg&amp;from=appmsg" data-type="png" data-w="280" src="https://mmbiz.qpic.cn/mmbiz_jpg/ImlBFVOwwpwUIPT9T6ngC7JGmhcCcha5JDibEbC6MspLaG7oQz5Mib87ofl0SiaZ8GIDR261BJcY70ML7E2l9cQ4g/640?wx_fmt=jpeg&amp;from=appmsg"></p><h3 cid="n85" mdtype="heading"><span md-inline="plain">附件:</span></h3><p cid="n86" mdtype="paragraph"><span md-inline="plain">相关绘图函数请预先 source 加载下面的相关函数:  </span></p><p cid="n87" mdtype="paragraph"><span md-inline="link"><span md-inline="plain">getGeneScore_ArchR.R</span></span></p><p cid="n88" mdtype="paragraph"><span md-inline="link"><span md-inline="plain">SpatialPlot_new.R</span></span></p><p cid="n89" mdtype="paragraph"><span md-inline="link"><span md-inline="plain">SpatialDimPlot_new.R</span></span></p><p cid="n90" mdtype="paragraph"><span md-inline="link"><span md-inline="plain">SpatialPlot_traj.R</span></span></p><p><br></p></section><section><p data-form="0" data-num="1">02</p></section></section></section><section><br></section></section></section></section><section><br></section></section></section></section></section><p><br></p><section data-support="96编辑器" data-style-id="35217"><section><section><p>三、合作方介绍</p></section><section><section><section><section><section><span></span></section><section><span><br></span></section><section><strong><span></span></strong><span>本次活动由</span><span><strong>Biomamba生信基地</strong></span><span>组织主办、</span><span><strong>北京寻因生物科技</strong></span><span>有限公司</span><span>独家冠名、科研者之家、西柚云超算联合赞助，设立总价值约<strong><span>50W</span></strong>的科研助力基金。</span><span><span></span></span></section><section><span><br></span></section><section><span>北京寻因生物科技有限公司：</span></section><p><span>北京寻因生物科技有限公司（简称寻因生物）成立于2018年，秉承“用技术温暖生命，预见未来”的企业愿景，致力于全球单细胞市场标准普世化发展，推动单细胞技术在早筛、临床、药研等应用方向的深耕落地，为全球科学家、技术公司及药企工业等客户提供可信赖的高品质单细胞技术服务及实验室建设解决方案。</span></p><section><span><br></span></section><section><span>科研者之家：</span></section><p><span>科研者之家（www.home-for-researchers）是目前国内最知名的科研工具箱平台，以“科研不停，神器不止”为理念，自2019年上线以来，多款工具火爆科研界，如AI写作助手、Figdraw在线绘图平台、生信零代码平台、AI润色、DLP一键改写降重、中文版Pubmed、课题思路助手等。截止目前，包括Nature，Advanced Materials等顶级期刊在内，科研者之家相关科研工具被论文引用已超2300次之多。</span></p><section><br></section><p>西柚云超算：</p><section><span>西柚云是一家专注于科研共享计算的云服务基建型公司。于2022年推出独立研发的大禹共享型计算系统，具有实例动态迁移（拒绝传统型共享服务器单节点卡顿）、开箱即用的生信环境、每个用户拥有<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247503869&amp;idx=1&amp;sn=142f8c7ba8620815a8770773df077f12&amp;chksm=9b3cb6adac4b3fbb1acdf7593df06af5ac77d1fe9c0144c999de7109bd063b76080a33c50e0d&amp;scene=21#wechat_redirect" textvalue="独立的实例和root权限" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">独立的实例和root权限</a>等特性。</span></section><section><span><br></span></section></section><section><p data-form="0" data-num="1">03</p></section></section></section><section><br></section></section></section></section><section><br></section><section><section><section data-support="96编辑器" data-style-id="27326"><section><section><section><section><section><section><section data-support="96编辑器" data-style-id="34887"><section><section><section data-support="96编辑器" data-style-id="36531"><section data-align="title"><section><section><br></section></section><section><section data-support="96编辑器" data-style-id="35217"><section><section><p>四、往期作品回顾</p></section><section><section><section><section><section><span></span></section><section><span><br></span></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247506684&amp;idx=1&amp;sn=c27703a05d4fffae6a5e9e54b4fa7dfe&amp;chksm=9b3ca3acac4b2abaa1e5d4f4a7e4d0730f2e5c4d72c7b3d3d29a653c3bae6590d90e31908dde&amp;scene=21#wechat_redirect" textvalue="单细胞代码复写| 干细胞样CD4+ T细胞与自身免疫性血管炎" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">干细胞样CD4+ T细胞与自身免疫性血管炎</a><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247506720&amp;idx=2&amp;sn=4760277df5a7b6f0d6d1698ac734aa3b&amp;chksm=9b3ca270ac4b2b66b0330e822893fa233ba3bdfd45d857097fba6e86561196c1497c20db25b8&amp;scene=21#wechat_redirect" textvalue="代码复写| 结直肠癌免疫图谱中的基因表达程序" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">结直肠癌免疫图谱中的基因表达程序</a><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247506754&amp;idx=1&amp;sn=3e3e9b4857bb0371b7c1113df792df2e&amp;chksm=9b3ca212ac4b2b043baf0c72684d186a1c065ff7b3d865c308aff4f3483ab5923638fda8d1ff&amp;scene=21#wechat_redirect" textvalue="代码复写| MLP模型鉴定免疫细胞发育和瘤内T细胞耗竭的单细胞染色质图谱" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">MLP模型鉴定免疫细胞发育和瘤内T细胞耗竭的单细胞染色质图谱</a><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247506779&amp;idx=1&amp;sn=dc97a74cfac6caeabaa838160385c3b2&amp;chksm=9b3ca20bac4b2b1da51998764b22ac3c08415298a47ded14283337386f18f9548749de70725e&amp;scene=21#wechat_redirect" textvalue="代码复写| T Cell单细胞参考图谱" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">T Cell单细胞参考图谱</a><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247506900&amp;idx=1&amp;sn=83774f3062e42ca0eee1df2cf19144f0&amp;chksm=9b3ca284ac4b2b9221736162ac44280d6184c9f8b0cc13bbcc4c914c14b707fe13a850c6418e&amp;scene=21#wechat_redirect" textvalue="代码复写| 小鼠纹状体单细胞基因变化图谱" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">小鼠纹状体单细胞基因变化图谱</a><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247506960&amp;idx=1&amp;sn=9f5913231f9583411e47ccf0dcadedf6&amp;chksm=9b3ca540ac4b2c56a60b5f71ab32e1eacd3194af4bfef819b2de60fc50781360876b45837bf7&amp;scene=21#wechat_redirect" textvalue="代码复写| 人类肾脏snRNA-seq图谱拟时序分析" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"></a></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247506960&amp;idx=1&amp;sn=9f5913231f9583411e47ccf0dcadedf6&amp;chksm=9b3ca540ac4b2c56a60b5f71ab32e1eacd3194af4bfef819b2de60fc50781360876b45837bf7&amp;scene=21#wechat_redirect" textvalue="代码复写| 人类肾脏snRNA-seq图谱拟时序分析" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">人类肾脏snRNA-seq图谱拟时序分析</a><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247507012&amp;idx=1&amp;sn=fb01cca63326fd6e8c682434a53fc2ea&amp;chksm=9b3ca514ac4b2c02115ae5dea368190ce74997ac16a07fdc29f76cef815600b1e5b813c71163&amp;scene=21#wechat_redirect" textvalue="代码复写| CellRank的教程重现" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">CellRank的教程重现</a><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247507096&amp;idx=1&amp;sn=98e42a5768074d2766f2ce64214ac391&amp;chksm=9b3ca5c8ac4b2cdebe68a8519a087e41a4c88a7e465c5ddc107f633a5fbf3fcc8bbff6aa8821&amp;scene=21#wechat_redirect" textvalue="代码复写| 胶质瘤相关巨噬细胞scRNA图谱" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">胶质瘤相关巨噬细胞scRNA图谱</a><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247507136&amp;idx=2&amp;sn=16f8afe29fb59b9a8e9cac265098709c&amp;chksm=9b3ca590ac4b2c86c9554bf20edd587f5d758636f55cf9e390220249d3338b1fde7717fb3c6e&amp;scene=21#wechat_redirect" textvalue="代码复写| 肝癌单细胞分群marker" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">肝癌单细胞分群marker</a><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247507144&amp;idx=1&amp;sn=ed6e95f16601e6196cea7179b88db250&amp;chksm=9b3ca598ac4b2c8ecfd1025246eb79c6aa8bf5703f8698d23f1d1f673121e3bf8168a32dba07&amp;scene=21#wechat_redirect" textvalue="代码复写| scRNA揭示T1D骨髓与骨质减少的关系" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">scRNA揭示T1D骨髓与骨质减少的关系</a><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247507337&amp;idx=1&amp;sn=e23d849663a6cfcad19bacdaeeb85b5f&amp;chksm=9b3ca4d9ac4b2dcf8ce4d9720bf7588a30e932adea4297862927ebfe20c29f8961436f761b8c&amp;scene=21#wechat_redirect" textvalue="代码复写| 微环境中肿瘤免疫屏障决定了免疫治疗的效果" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">微环境中肿瘤免疫屏障决定了免疫治疗的效果</a></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247507353&amp;idx=1&amp;sn=f2922ce2337c31a781a690ea59c5abde&amp;chksm=9b3ca4c9ac4b2ddfc267838fe6d794027643e89fe054a5ca4d48e51976ea825af7fed285e26b&amp;scene=21#wechat_redirect" textvalue="代码复写| 肝脏发育、成熟的单细胞图谱" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">肝脏发育、成熟的单细胞图谱</a><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247507450&amp;idx=1&amp;sn=ee9b7d482ad9a88c6da18341c7ec5254&amp;chksm=9b3ca4aaac4b2dbc83fc6cc4c084636fb397e56d0057dfb5b546acf402661ab64d241f985073&amp;scene=21#wechat_redirect" textvalue="代码复写| 胰腺导管腺癌的内异质性和恶性进展scRNA-seq图谱" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">胰腺导管腺癌的内异质性和恶性进展scRNA-seq图谱</a><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247507096&amp;idx=1&amp;sn=98e42a5768074d2766f2ce64214ac391&amp;chksm=9b3ca5c8ac4b2cdebe68a8519a087e41a4c88a7e465c5ddc107f633a5fbf3fcc8bbff6aa8821&amp;scene=21#wechat_redirect" textvalue="代码复写| 胶质瘤相关巨噬细胞scRNA图谱" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"></a><br></section><section><span><br></span></section></section><section><p data-form="0" data-num="1">04</p></section></section></section><section><br></section></section></section></section><section><span><strong><span>本次活动最终解释权归主办方所有!</span></strong></span><strong><span></span></strong></section><section><span><strong><span>主办方拥有对作品的编辑、宣发权利!</span></strong></span></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section><p><br></p><section><section><section data-support="96编辑器" data-style-id="27326"><section><section><section><section><section><section><section data-support="96编辑器" data-style-id="34887"><section><section><section data-support="96编辑器" data-style-id="36531"><section data-align="title"><section><section><img data-imgfileid="100023064" data-ratio="0.5106382978723404" data-w="47" data-width="100%" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWiaFyWDMZJ2713X3DwiaQicG5O8mjlC4kPOluxibs4oDot7AXe0RgoXgMeiaB3KYViadIQqXRoRicyian7KUg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWiaFyWDMZJ2713X3DwiaQicG5O8mjlC4kPOluxibs4oDot7AXe0RgoXgMeiaB3KYViadIQqXRoRicyian7KUg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section><section><section><p><strong>如何联系我们</strong><br></p></section></section><section><img data-imgfileid="100023066" data-ratio="1.163265306122449" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWiaFyWDMZJ2713X3DwiaQicG5OSxqKNRib39TuLic5NT2iaJaI0mIicuvjMZlRPvlqPfgjzg001qlRJTBDRA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-w="49" data-width="100%" src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWiaFyWDMZJ2713X3DwiaQicG5OSxqKNRib39TuLic5NT2iaJaI0mIicuvjMZlRPvlqPfgjzg001qlRJTBDRA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section></section><section data-support="96编辑器" data-style-id="34624"><section><section><section><img data-imgfileid="100023062" data-ratio="0.2463768115942029" data-w="138" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWiaC0oer2QpXIolHVU3Xibtm9BNWiav660mHaB5qEd1dibMibUicNYmAzBBiadQP2s7HArdUxoWL5cDkTEbQ/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWiaC0oer2QpXIolHVU3Xibtm9BNWiav660mHaB5qEd1dibMibUicNYmAzBBiadQP2s7HArdUxoWL5cDkTEbQ/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section><section><section>公众号后台消息回复不便，这里给大家留一下领取资料及免费服务器(<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247506420&amp;idx=1&amp;sn=6867471200293a24ff3122583585da33&amp;chksm=9b3ca0a4ac4b29b2ea3a3873acbccd80ff7c9ef487baf2865cd3fc5f744beb6881230ec3c1c4&amp;scene=21#wechat_redirect" textvalue="足够支持你完成硕博生涯的生信环境" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>足够支持你完成硕博生涯的生信环境</span></a>)的<span><strong>微信号</strong></span>，方便各位随时交流、提建议（科研任务繁重，回复不及时请见谅）。此外呼声一直很高的<strong><span>交流群</span></strong>也建好了，欢迎大家入群讨论：</section><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247505868&amp;idx=2&amp;sn=20c81313eaef9a7031a84ef3a691d1b5&amp;chksm=9b3cae9cac4b278a42c8de97e864c7664a37e9a4adb5973625fe3f8dd1093e55aeda88d443aa&amp;scene=21#wechat_redirect" textvalue="永久免费的生信、科研交流群" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">永久免费的生信、科研交流群</a><br></p><section><span>大家可以阅读完这几篇之后添加</span></section><section><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247493329&amp;idx=1&amp;sn=597870b7f7ce10346da3561e7c281627&amp;chksm=9b3c9f81ac4b169794088ce9abbcacb5f18e9fd174fc0d7e28da62d78facadf3100ef38aaf22&amp;scene=21#wechat_redirect" textvalue="给生信入门初学者的小贴士" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">给生信入门初学者的小贴士</a><br></span></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247506266&amp;idx=2&amp;sn=22b1164bc9602c25620d058847785422&amp;chksm=9b3ca00aac4b291c16d738271746ffb90149282a728f484e8a1952463c46a8e7dc4f883ab928&amp;scene=21#wechat_redirect" textvalue="如何搜索公众号过往发布内容(内含集锦)" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">如何搜索公众号过往发布内容</a><br></section><p><img data-galleryid="" data-imgfileid="100023065" data-ratio="0.4357976653696498" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpx6Htt0YEibg4Pn7N7fFUdclZQH9RX6YAUqQG98l3jcz9XjCiatucDpyE0o10sotnD7jiaEIFDOmv8Yw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="1028" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpx6Htt0YEibg4Pn7N7fFUdclZQH9RX6YAUqQG98l3jcz9XjCiatucDpyE0o10sotnD7jiaEIFDOmv8Yw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section><section><section><section><img data-imgfileid="100023067" data-ratio="0.7619047619047619" data-w="84" data-width="80%" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWhFTIP7DCMLPwWh8Yhjs079f1vMqlYdExqbWaZVJyiawKkr21EDSNW740b4yMzkeHxFJULTpZGzYwQ/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWhFTIP7DCMLPwWh8Yhjs079f1vMqlYdExqbWaZVJyiawKkr21EDSNW740b4yMzkeHxFJULTpZGzYwQ/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section><section><span>您点的每个赞和在看，我都认真当成了喜欢</span></section></section></section><section><br></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/zUFbYe-QIjsg_n-JII2YkQ",target="_blank" rel="noopener noreferrer">原文链接</a>
