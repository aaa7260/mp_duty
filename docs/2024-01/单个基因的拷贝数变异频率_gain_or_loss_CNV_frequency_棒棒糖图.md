---
title: "单个基因的拷贝数变异频率（gain or loss CNV frequency）棒棒糖图"
date: 2024-01-24T01:50:04Z
draft: ["false"]
tags: [
  "fetched",
  "医学和生信笔记"
]
categories: ["Acdemic"]
---
单个基因的拷贝数变异频率（gain or loss CNV frequency）棒棒糖图 by 医学和生信笔记
------
<div><p><br></p><section><span>关注公众号，发送</span><strong>R语言</strong><span>或</span><strong>python</strong><span>，可获取资料</span><span></span></section><section><mp-common-profile data-pluginname="mpprofile" data-id="MzUzOTQzNzU0NA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R9YDc8IDhqWAHTrZsMuhDpFlw4scqOl1ZVWpeY77cdibaSzPeGALfkEhdVpwHzVibHCRSYZg4csB43g/0?wx_fmt=png" data-nickname="医学和生信笔记" data-alias="yxhsxbj" data-signature="外科医生👨‍⚕️的R语言和生信学习🔖" data-from="2" data-is_biz_ban="0" data-weui-theme="light"></mp-common-profile></section><section data-role="outer" label="edit by 135editor"><section data-role="paragraph"><section data-role="outer" label="edit by 135editor"><section data-role="paragraph"><section data-role="outer" label="edit by 135editor"><section data-role="paragraph"><section data-role="outer"><section data-role="outer" label="edit by 135editor"><section data-tools="135编辑器" data-id="28"><p data-brushtype="text" hm_fix="440:185"><span>💡专注R语言在🩺生物医学中的使用</span></p></section></section></section></section></section><hr><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><span><span>设为“</span><strong><span>星标</span></strong><span>”，精彩不错过</span></span><br></p><hr><p data-tool="mdnice编辑器"><span><strong></strong></span></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">大家在一些涉及拷贝数变异（copy number variation，cnv）的SCI文章中可能会遇到以下图片：</p><p data-tool="mdnice编辑器">DOI:10.1007/s00011-023-01772-6<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="22px" height="22px" viewbox="0 0 32 32" enable-background="new 0 0 32 32"><image width="32" height="32" x="0" y="0"></image></svg></p><p data-tool="mdnice编辑器"><img data-imgfileid="100017197" data-ratio="0.38616352201257864" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R96YTrYZicbOtjvGNjhSHFaHP1IiaqTzdMMXib0E2gSUC0Jco1HtOcd0wSGqgTMa2MALOkkA6VNXjugA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="795" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R96YTrYZicbOtjvGNjhSHFaHP1IiaqTzdMMXib0E2gSUC0Jco1HtOcd0wSGqgTMa2MALOkkA6VNXjugA/640?wx_fmt=png&amp;from=appmsg">https://doi.org/10.1186/s12943-020-01170-0</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100017195" data-ratio="0.5738963531669866" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R96YTrYZicbOtjvGNjhSHFaHokU9SkZ1mymAibLjXgOf7jcpmXcOLz4YOictIMIRicyBRiagWyYmQbNBcg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="521" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R96YTrYZicbOtjvGNjhSHFaHokU9SkZ1mymAibLjXgOf7jcpmXcOLz4YOictIMIRicyBRiagWyYmQbNBcg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">这个图形展示了单个基因的拷贝数变化。如果你已经有了数据，画图还是很简单的，就是一个简单的点和线的组合而已，有多种方式可以实现，比如我之前就专门介绍过：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzUzOTQzNzU0NA==&amp;mid=2247489587&amp;idx=1&amp;sn=c9aecbca2ff424a2b737ebbc46fafdfb&amp;scene=21#wechat_redirect" data-linktype="2">R语言棒棒糖图</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzUzOTQzNzU0NA==&amp;mid=2247488567&amp;idx=1&amp;sn=ab4025f014f8c75f6654d61933a06dce&amp;scene=21#wechat_redirect" data-linktype="2">R语言画误差线的5种方法</a></section></li></ul><p data-tool="mdnice编辑器">今天主要记录下如何通过拷贝数变异数据，得到画图的数据。我们就以从TCGA下载的TCGA-COAD的拷贝数变异数据为例。</p><h2 data-tool="mdnice编辑器"><span></span><span>加载数据</span><span></span></h2><p data-tool="mdnice编辑器">直接从TCGA下载的拷贝数变异数据是不行的，需要使用GISTIC2.0这个软件对CNV数据进行分析，得到以下结果才行：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100017199" data-ratio="2.4031620553359683" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R96YTrYZicbOtjvGNjhSHFaHM33XIW1z988ObticNIDmKFMF153IiaWhYibnibkDNqBuTzc8BkEIJz1l3g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="253" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R96YTrYZicbOtjvGNjhSHFaHM33XIW1z988ObticNIDmKFMF153IiaWhYibnibkDNqBuTzc8BkEIJz1l3g/640?wx_fmt=png&amp;from=appmsg"><figcaption>GISTIC2.0的输出</figcaption></figure><p data-tool="mdnice编辑器">这个过程对于初学者还是很复杂的，光是安装gistic这个软件估计就会卡住很多人。但是这个过程网上有非常多的教程，我们就不多做介绍了。这里给大家提供一个安装GISTIC软件的快速方法，可以1行代码安装，详见：王诗翔大佬的github：Install GISTIC2 by one line code</p><p data-tool="mdnice编辑器">除此之外，这个分析还可以通过网页工具完成，一个是gene pattern，另一个是hiplot（不知道现在还能不能用这个功能）。</p><p data-tool="mdnice编辑器">GISTIC2.0的输出结果中有多个文件都可以用来绘制上面的图，但是它们是有区别的，其中部分结果的解释参考简书（网址：https://www.jianshu.com/p/5de9922e6b8b）：</p><ul data-tool="mdnice编辑器"><li><section>all_data_by_genes.txt：基因在不同样本中具体的拷贝数数值</section></li><li><section>all_thresholded.by_genes.txt：基因在不同样本中拷贝数数值离散化后的结果，-2代表缺失两个拷贝，-1代表缺失一个拷贝，0代表拷贝数正常，1代表增加一个拷贝，2代表扩增两个拷贝</section></li><li><section>focal_data_by_genes.txt：基因在不同样本中具体的拷贝数数值（只考虑 focal events）</section></li><li><section>broad_data_by_genes.txt：基因在不同样本中具体的拷贝数数值（只考虑 arm events）</section></li><li><section>all_lesions.conf_90.txt：识别到的拷贝数扩增和缺失的Peak区域</section></li><li><section>amp_genes.conf_90.txt：识别到的拷贝数扩增的Peak区域及区域内涉及到的基因</section></li><li><section>del_genes.conf_90.txt：识别到的拷贝数缺失的Peak区域及区域内涉及到的基因</section></li><li><section>broad_significance_results.txt：显著发生拷贝数变异的broad区域</section></li><li><section>broad_values_by_arm.txt：染色体臂在样本中的拷贝数数值</section></li><li><section>scores.gistic：该算法的打分结果，可导入IGV进行可视化</section></li></ul><p data-tool="mdnice编辑器">其中前4个文件都可以用来画图，但是根据它们的具体含义我最终选择了<code>all_thresholded.by_genes.txt</code>这个文件。</p><p data-tool="mdnice编辑器">首先我们肯定是选择所有的样本，不能只考虑focal或者arm，关于这两种东西的解释，参考一个博客的解释：</p><p data-tool="mdnice编辑器">在整个基因组上，最常见的体细胞拷贝数变异（SCNA）是短的染色体变异（focal），和几乎和染色体臂或整条染色体等长的染色体变异（arm-level）。arm-level的染色体变异发生的占比大约是focal的30倍，且几乎所有的癌症类型中都是这样。认为这两者发生概率不同，意味着是分别发生的。https://taozyblog.com.cn/post/2022-3-16_mechanism_of_cnv/</p><p data-tool="mdnice编辑器">其次是使用具体的拷贝数数值还是离散化之后的数据，我都读取进来对比了一下：</p><pre data-tool="mdnice编辑器"><code><span># 具体的拷贝数数值</span><br>df1 &lt;- data.table::fread(<span>"G:/tcga/TCGA_COAD_results/all_data_by_genes.txt"</span>,<br>                        data.table = <span>F</span>)<br>dim(df1)<br></code></pre><pre data-tool="mdnice编辑器"><code><span>## [1] 25988   492</span><br></code></pre><pre data-tool="mdnice编辑器"><code>df1[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br></code></pre><pre data-tool="mdnice编辑器"><code><span>##   Gene Symbol Gene ID Cytoband TCGA-DM-A285-01A-11D-A16U-01</span><br><span>## 1       ACAP3  116983  1p36.33                       -0.263</span><br><span>## 2      ACTRT2  140625  1p36.32                       -0.263</span><br><span>## 3        AGRN  375790  1p36.33                       -0.263</span><br><span>## 4     ANKRD65  441869  1p36.33                       -0.263</span><br></code></pre><pre data-tool="mdnice编辑器"><code><span># 离散化后的数据</span><br>df2 &lt;- data.table::fread(<span>"G:/tcga/TCGA_COAD_results/all_thresholded.by_genes.txt"</span>,<br>                        data.table = <span>F</span>)<br>dim(df2)<br></code></pre><pre data-tool="mdnice编辑器"><code><span>## [1] 25988   492</span><br></code></pre><pre data-tool="mdnice编辑器"><code>df2[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br></code></pre><pre data-tool="mdnice编辑器"><code><span>##   Gene Symbol Locus ID Cytoband TCGA-DM-A285-01A-11D-A16U-01</span><br><span>## 1       ACAP3   116983  1p36.33                           -1</span><br><span>## 2      ACTRT2   140625  1p36.32                           -1</span><br><span>## 3        AGRN   375790  1p36.33                           -1</span><br><span>## 4     ANKRD65   441869  1p36.33                           -1</span><br></code></pre><p data-tool="mdnice编辑器">可以看到它们的数据结构是完全一样的，只是表示方法不一样。如果你选择具体的拷贝数数值，那么你需要自己设定一个阈值（0.3，0.4，0.5等），到底这个数值大于多少是gain（也就是duplication），小于多少是loss（也就是deletion），但是如果使用离散化之后的数据，那么根据它的意思，大于0的就是gain，小于0的就是loss，不需要自己设定阈值了，为了方便，我选择这个离散化之后的数据。</p><h2 data-tool="mdnice编辑器"><span></span><span>数据整理</span><span></span></h2><p data-tool="mdnice编辑器">这个<code>df2</code>是长这样的：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100017196" data-ratio="0.44351851851851853" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R96YTrYZicbOtjvGNjhSHFaH9iaXwWWIibxXY02oeVzCJTH7OHztC7lsmydUICb25FeScwP2vXmOP6Yg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R96YTrYZicbOtjvGNjhSHFaH9iaXwWWIibxXY02oeVzCJTH7OHztC7lsmydUICb25FeScwP2vXmOP6Yg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">第一列是基因名字，第2和第3列我们画图用不到，可以直接删掉，后面的列都是样本名，其中是用数字表示拷贝数变异，所以我们对它进行一点小小的整理：</p><ul data-tool="mdnice编辑器"><li><section>去掉第2和第3列</section></li><li><section>把-1和-2变成loss，把1和2变成gain，0变成neutral</section></li></ul><pre data-tool="mdnice编辑器"><code>df2 &lt;- df2[,-c(<span>2</span>,<span>3</span>)]<br>rownames(df2) &lt;- df2[,<span>1</span>]<br>df2 &lt;- df2[,-<span>1</span>]<br><br>df2[df2&gt;<span>0</span>] &lt;- <span>"gain"</span><br>df2[df2&lt;<span>0</span>] &lt;- <span>"loss"</span><br>df2[df2 == <span>0</span>] &lt;- <span>"neutral"</span><br></code></pre><p data-tool="mdnice编辑器">然后某个基因的<code>CNV frequency</code>就很好计算了，比如第一个基因它的gain的频率，就是<code>出现gain的样本数 / 样本总数</code>，它的loss的频率就是<code>出现loss的样本数 / 样本总数</code>，先简单看下出现gain/loss/neutral的样本数量，以第一个基因为例：</p><pre data-tool="mdnice编辑器"><code>table(t(df2)[,<span>1</span>])<br></code></pre><pre data-tool="mdnice编辑器"><code><span>## </span><br><span>##    gain    loss neutral </span><br><span>##      18     162     309</span><br></code></pre><p data-tool="mdnice编辑器">根据这个思路我们就可以很轻松的计算出所有基因的gain/loss/neutral的样本数：</p><pre data-tool="mdnice编辑器"><code>df3 &lt;- as.data.frame(t(df2))<br>df3 &lt;- apply(df3, <span>2</span>, table)<br>df3 &lt;- as.data.frame(do.call(rbind,df3))<br></code></pre><pre data-tool="mdnice编辑器"><code><span>## Warning in (function (..., deparse.level = 1) : number of columns of result is</span><br><span>## not a multiple of vector length (arg 24509)</span><br></code></pre><pre data-tool="mdnice编辑器"><code>df3$gene &lt;- rownames(df3)<br>head(df3)<br></code></pre><pre data-tool="mdnice编辑器"><code><span>##         gain loss neutral    gene</span><br><span>## ACAP3     18  162     309   ACAP3</span><br><span>## ACTRT2    18  162     309  ACTRT2</span><br><span>## AGRN      18  162     309    AGRN</span><br><span>## ANKRD65   18  162     309 ANKRD65</span><br><span>## ATAD3A    18  162     309  ATAD3A</span><br><span>## ATAD3B    18  162     309  ATAD3B</span><br></code></pre><p data-tool="mdnice编辑器">这个就是我们的画图数据了（我这里并没有除以样本总数，大家有需要的可以自己计算），有了这个数据画图就是直接<code>ggplot2</code>就好了。</p><h2 data-tool="mdnice编辑器"><span></span><span>画图</span><span></span></h2><p data-tool="mdnice编辑器">我们随便取30个基因，你可以根据自己的情况选择自己感兴趣的基因，比如免疫相关的基因、铜死亡相关的基因等。</p><pre data-tool="mdnice编辑器"><code>set.seed(<span>1567</span>)<br>markers &lt;- sample(df3$gene, <span>30</span>)<br>markers<br></code></pre><pre data-tool="mdnice编辑器"><code><span>##  [1] "KRT10"         "LAMA1"         "TADA3"         "MIR663A|chr20"</span><br><span>##  [5] "LOC100129138"  "hsa-mir-886"   "DSC2"          "KRTAP22-2"    </span><br><span>##  [9] "MICU3"         "LOC390705"     "ZYG11B"        "LRRC75A"      </span><br><span>## [13] "FAM86B1"       "TRIM52-AS1"    "LOC102723604"  "MIR4304"      </span><br><span>## [17] "RNF139-AS1"    "LINC00620"     "ISCA1"         "FBP1"         </span><br><span>## [21] "TRIAP1"        "APOA1-AS"      "MLN"           "ST6GALNAC2"   </span><br><span>## [25] "OR4K17"        "MIR518C"       "GABPB2"        "ZFP28"        </span><br><span>## [29] "MEIOC"         "CSRP1"</span><br></code></pre><pre data-tool="mdnice编辑器"><code>df4 &lt;- df3[df3$gene %<span>in</span>% markers,]<br>df4<br></code></pre><pre data-tool="mdnice编辑器"><code><span>##               gain loss neutral          gene</span><br><span>## ZYG11B          12  130     347        ZYG11B</span><br><span>## LOC100129138    12  151     326  LOC100129138</span><br><span>## GABPB2         113   37     339        GABPB2</span><br><span>## CSRP1          115   42     332         CSRP1</span><br><span>## TADA3           39   75     375         TADA3</span><br><span>## LINC00620       39   76     374     LINC00620</span><br><span>## hsa-mir-886     49   99     341   hsa-mir-886</span><br><span>## TRIM52-AS1      57   94     338    TRIM52-AS1</span><br><span>## MLN            104   42     343           MLN</span><br><span>## FAM86B1         92  217     180       FAM86B1</span><br><span>## MICU3           96  216     177         MICU3</span><br><span>## RNF139-AS1     283   12     194    RNF139-AS1</span><br><span>## ISCA1           73   62     354         ISCA1</span><br><span>## FBP1            76   64     349          FBP1</span><br><span>## APOA1-AS        61   73     355      APOA1-AS</span><br><span>## TRIAP1         101   55     333        TRIAP1</span><br><span>## MIR4304        102   55     332       MIR4304</span><br><span>## OR4K17          42  149     298        OR4K17</span><br><span>## LOC102723604    41  149     299  LOC102723604</span><br><span>## LOC390705      131   16     342     LOC390705</span><br><span>## LRRC75A         13  276     200       LRRC75A</span><br><span>## KRT10          120   52     317         KRT10</span><br><span>## MEIOC          108   59     322         MEIOC</span><br><span>## ST6GALNAC2     112   62     315    ST6GALNAC2</span><br><span>## LAMA1           25  279     185         LAMA1</span><br><span>## DSC2            28  288     173          DSC2</span><br><span>## MIR518C         97   56     336       MIR518C</span><br><span>## ZFP28          102   53     334         ZFP28</span><br><span>## MIR663A|chr20  290   29     170 MIR663A|chr20</span><br><span>## KRTAP22-2       30  141     318     KRTAP22-2</span><br></code></pre><p data-tool="mdnice编辑器">画图是最简单的一步：</p><pre data-tool="mdnice编辑器"><code><span>library</span>(ggplot2)<br><br>ggplot(df4)+<br>  geom_linerange(aes(x=gene,ymin=<span>0</span>,ymax=ifelse(gain&gt;loss,gain,loss)),<br>                 linewidth=<span>2</span>,color=<span>"grey"</span>)+<br>  geom_point(aes(x=gene, y=gain), color=<span>"red"</span>,size=<span>4</span>)+<br>  geom_point(aes(x=gene, y=loss), color=<span>"blue"</span>,size=<span>4</span>)+<br>  labs(x=<span>NULL</span>,y=<span>"CNV frequency"</span>)+<br>  theme_bw()+<br>  theme(axis.text.x = element_text(angle = <span>45</span>,hjust = <span>1</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100017198" data-ratio="0.6044776119402985" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R96YTrYZicbOtjvGNjhSHFaH7Hsn8TzWsUeLeNjLmNjicEyicDzHO7t78AXInkXvCtBUibdlp7rLcFHKg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="804" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R96YTrYZicbOtjvGNjhSHFaH7Hsn8TzWsUeLeNjLmNjicEyicDzHO7t78AXInkXvCtBUibdlp7rLcFHKg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">你还可以先排个序再画，这样看起来更整齐一点，我这里就不演示了。</p><p data-tool="mdnice编辑器">公众号后台回复<strong>突变</strong>即可获取突变相关推文合集，后台回复<strong>20240120</strong>即可获取今天画图用的数据。</p></section><p><span><br></span></p><hr><blockquote><p><span><strong>联系我们，关注我们</strong></span></p><ol><li><section>免费QQ交流群1：613637742</section></li><li><section>免费QQ交流群2：608720452</section></li><li><section>公众号消息界面关于作者获取联系方式</section></li><li><section>知乎、CSDN、简书同名账号</section></li><li><section>哔哩哔哩：阿越就是我</section></li></ol></blockquote></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/m37OQ98LHOy9bSQaNTizHg",target="_blank" rel="noopener noreferrer">原文链接</a>
