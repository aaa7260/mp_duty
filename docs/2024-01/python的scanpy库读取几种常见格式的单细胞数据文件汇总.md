---
title: "python的scanpy库读取几种常见格式的单细胞数据文件汇总"
date: 2024-01-25T00:14:00Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
python的scanpy库读取几种常见格式的单细胞数据文件汇总 by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>首先你需要有Python，以及它配套的代码编辑器哈。从零开始开始学习一个编程语言，我们肯定是首先得安装好它，比如前面我们讲解了Python的安装，它多个版本的差异以及管理，详见：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247527250&amp;idx=2&amp;sn=e6a0c3cf1e07786eaff7069ec21bf573&amp;scene=21#wechat_redirect" data-linktype="2">Python初体验之弄清楚版本差异和如何安装管理</a>，然后给出来了两个Python编辑器，就是PyCharm或者JupyterLab，任选其一都可以打开你的Python从零开始之旅。如果你确实是从零开始，建议参考我们的推荐的学习资料哈：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247527938&amp;idx=1&amp;sn=578544984a94d993ae1800b341b15388&amp;scene=21#wechat_redirect" data-linktype="2">Python从零开始的配套b站视频和书籍</a> 。</p></blockquote><p data-tool="mdnice编辑器"><code>scanpy</code> 是用于单细胞数据分析的 Python 库，需要有Python基础，才有可能跟下面的教程进行scanpy的单细胞数据分析流程哦！</p><p data-tool="mdnice编辑器"><strong>读前热身准备：</strong></p><p data-tool="mdnice编辑器">在Python编程体系读取单细胞文件数据会用到<strong>scanpy</strong>这个库，所以需要安装<strong>scanpy</strong>这个库：</p><pre data-tool="mdnice编辑器"><span></span><code>pip install scanpy -i https://pypi.tuna.tsinghua.edu.cn/simple<br></code></pre><p data-tool="mdnice编辑器">安装好之后，就可以使用了。首先理解一下单细胞表达量矩阵的多种文件格式，主要包括以下几种：</p><ol data-tool="mdnice编辑器"><li><section><strong>Matrix Market Exchange Format (MEX):</strong></section></li></ol><ul><li><section><code>.mtx</code> 文件，该文件包含了一个稀疏矩阵，其中每一行代表一个基因，每一列代表一个细胞，而每个元素则表示基因在相应细胞中的表达量。通常会有三个文件组成：<code>barcodes.tsv</code>（细胞标识）、<code>features.tsv</code>（基因标识）和 <code>matrix.mtx</code>（表达矩阵）。</section></li></ul><li><section><strong>Hierarchical Data Format (HDF5):</strong></section></li><ul><li><section><code>.h5</code> 文件，HDF5 是一种用于存储和组织大规模科学数据的文件格式。在单细胞数据中，可以使用 HDF5 存储表达矩阵、基因和细胞的元数据等信息。</section></li></ul><li><section><strong>AnnData:</strong></section></li><ul><li><section><code>.h5ad</code> 文件，是基于 HDF5 的文件格式，由 <code>anndata</code> 库定义。它可以包含单细胞数据的表达矩阵、基因和细胞的元数据、样品信息等。</section></li></ul><li><section><strong>Comma-Separated Values (CSV) 或文本文件:</strong></section></li><ul><li><section><code>.csv</code> 或 <code>.txt</code> 文件，包含表达矩阵的文本文件。每一行代表一个基因，每一列代表一个细胞，元素是表达量。</section></li></ul><h3 data-tool="mdnice编辑器"><span></span>1.读取h5文件<span></span></h3><p><img data-cropselx1="0" data-cropselx2="558" data-cropsely1="2" data-cropsely2="26" data-galleryid="" data-imgfileid="100044319" data-ratio="0.11683168316831684" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCBZyZN4cV25Jh5CuDafCL0G7jkxyhy5zbAAxxibsMyEzJxiaerdGJLGUxXXsZHBsP18icicIicBtmwIA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1010" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCBZyZN4cV25Jh5CuDafCL0G7jkxyhy5zbAAxxibsMyEzJxiaerdGJLGUxXXsZHBsP18icicIicBtmwIA/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">使用<strong>scanpy</strong>读取如上图所示的<strong>h5</strong>文件，我们可以用<strong>read_10x_h5()<strong>这个函数进行</strong>h5</strong>文件读取，下面是简单的示范；</p><pre data-tool="mdnice编辑器"><span></span><code>read_10x_h5(filename）<br></code></pre><p data-tool="mdnice编辑器"><strong>参数：</strong></p><p data-tool="mdnice编辑器"><strong>filename</strong>：文件名，填写你要读取的h5文件，比如:"/home/my/data/GSE10086_filtered_bc.h5"这样的文件路径。</p><p data-tool="mdnice编辑器">更多详情见：https://scanpy.readthedocs.io/en/latest/generated/scanpy.read_10x_h5.html</p><p data-tool="mdnice编辑器"><strong>实战：</strong></p><p data-tool="mdnice编辑器">上图中这个文件的下载地址：https://ftp.ncbi.nlm.nih.gov/geo/samples/GSM5344nnn/GSM5344024/suppl/GSM5344024%5FB1.KO%5Fnormal.adjacent.lung%5Ffiltered%5Ffeature%5Fbc%5Fmatrix.h5</p><p data-tool="mdnice编辑器">我已经把这个文件下载好了并放在<strong>C:/Users/my/Desktop/data</strong>目录下，现在开始读取h5文件吧！</p><p data-tool="mdnice编辑器"><strong>代码如下：</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>#导入scanpy库</span><br><span>import</span> scanpy <span>as</span> sc<br><span>#读取h5文件</span><br>data=sc.read_10x_h5(<span>'C:/Users/my/Desktop/data/GSM5344024_B1.KO_normal.adjacent.lung_filtered_feature_bc_matrix.h5'</span>)<br><span>#查看数据</span><br>print(data)<br></code></pre><p data-tool="mdnice编辑器"><strong>结果如下：</strong></p><pre data-tool="mdnice编辑器"><span></span><code>AnnData object with n_obs × n_vars = 13113 × 31053<br>    var: <span>'gene_ids'</span>, <span>'feature_types'</span>, <span>'genome'</span><br></code></pre><p data-tool="mdnice编辑器">可以看出读取文件之后的data变量是一个AnnData数据对象，包含13113个细胞和31053个基因。</p><h3 data-tool="mdnice编辑器"><span></span>2.读取txt文件<span></span></h3><p data-tool="mdnice编辑器">txt就是普普通通的文本文件而已，所以很容易读取：</p><p><img data-galleryid="" data-imgfileid="100044319" data-ratio="0.07883369330453564" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCBZyZN4cV25Jh5CuDafCLuI995RLQCCaJrhJrg7jtic8FqDw8fCSLBoYicfLXAUcXibtR4PejGHQ6w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="926" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCBZyZN4cV25Jh5CuDafCLuI995RLQCCaJrhJrg7jtic8FqDw8fCSLBoYicfLXAUcXibtR4PejGHQ6w/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">使用scanpy读取如上图所示的<strong>txt</strong>文件，我们可以用**read_text()**这个函数进行txt文件读取，下面是简单的示范；</p><pre data-tool="mdnice编辑器"><span></span><code>read_text(filename)<br></code></pre><p data-tool="mdnice编辑器"><strong>参数</strong>：</p><p data-tool="mdnice编辑器"><strong>filename</strong>：文件名，填写你要读取的txt文件，比如:"/home/my/data/GSE10086_filtered_bc.txt.gz"这样的文件路径。</p><p data-tool="mdnice编辑器">更多详情见:https://scanpy.readthedocs.io/en/latest/generated/scanpy.read_text.html#scanpy.read_text</p><p data-tool="mdnice编辑器"><strong>实战：</strong></p><p data-tool="mdnice编辑器">上图中这个文件的下载地址：https://ftp.ncbi.nlm.nih.gov/geo/samples/GSM5101nnn/GSM5101014/suppl/GSM5101014%5FPt1%5FSuperficial%5FCountMatrix.txt.gz</p><p data-tool="mdnice编辑器">我已经把这个文件下载好了并放在<strong>C:/Users/my/Desktop/data</strong>目录下，现在开始读取txt文件吧！</p><p data-tool="mdnice编辑器"><strong>代码如下：</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>#导入scanpy库</span><br><span>import</span> scanpy <span>as</span> sc<br><span>#读取txt文件</span><br>data=sc.read_text(<span>'C:/Users/my/Desktop/data/GSM5101014_Pt1_Superficial_CountMatrix.txt.gz'</span>)<br><span>#查看数据</span><br>print(data)<br></code></pre><p data-tool="mdnice编辑器"><strong>结果如下：</strong></p><pre data-tool="mdnice编辑器"><span></span><code>AnnData object with n_obs × n_vars = 32738 × 2315<br></code></pre><p data-tool="mdnice编辑器">可以看出读取文件之后的data变量是一个AnnData数据对象，包含32738个细胞和2315个基因。</p><h3 data-tool="mdnice编辑器"><span></span>3.读取tab文件<span></span></h3><p data-tool="mdnice编辑器">它本质上也是txt文本文件，无论是csv格式和tsv格式，都是一样的。</p><p><img data-cropselx1="0" data-cropselx2="558" data-cropsely1="0" data-cropsely2="65" data-galleryid="" data-imgfileid="100044321" data-ratio="0.1634199134199134" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCBZyZN4cV25Jh5CuDafCLtDG0QZLgLkvPYBuDiabAO9GsGk6yakiamHR0KPPXw0L1kugN7Tice0GUA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="924" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCBZyZN4cV25Jh5CuDafCLtDG0QZLgLkvPYBuDiabAO9GsGk6yakiamHR0KPPXw0L1kugN7Tice0GUA/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">使用scanpy读取如上图所示的<strong>tab</strong>文件，我们可以用<strong>read_text()<strong>这个函数进行</strong>tab</strong>文件读取，下面是简单的示范；</p><pre data-tool="mdnice编辑器"><span></span><code>read_text(filename)<br></code></pre><p data-tool="mdnice编辑器"><strong>参数：</strong></p><p data-tool="mdnice编辑器"><strong>filename</strong>：文件名，填写你要读取的tab文件，比如:"/home/my/data/GSE10086_filtered_bc.tab.gz"这样的文件路径。</p><p data-tool="mdnice编辑器">更多详情见https://scanpy.readthedocs.io/en/latest/generated/scanpy.read_text.html#scanpy.read_text</p><p data-tool="mdnice编辑器"><strong>实战：</strong></p><p data-tool="mdnice编辑器">上图中这个文件的下载地址：https://ftp.ncbi.nlm.nih.gov/geo/series/GSE131nnn/GSE131935/suppl/GSE131935%5FSS2%5F15%5F0160%5Frpkms.tab.gz</p><p data-tool="mdnice编辑器">我已经把这个文件下载好了并放在<strong>C:/Users/my/Desktop/data</strong>目录下，现在开始读取tab文件吧！</p><p data-tool="mdnice编辑器"><strong>代码如下：</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>#导入scanpy库</span><br><span>import</span> scanpy <span>as</span> sc<br><span>#读取tab文件</span><br>data=sc.read_text(<span>'C:/Users/my/Desktop/data/GSE131935_SS2_15_0160_rpkms.tab.gz'</span>)<br><span>#查看数据</span><br>print(data)<br></code></pre><p data-tool="mdnice编辑器"><strong>结果如下：</strong></p><pre data-tool="mdnice编辑器"><span></span><code>AnnData object with n_obs × n_vars = 24490 × 384<br></code></pre><p data-tool="mdnice编辑器">可以看出读取文件之后的data变量是一个AnnData数据对象，包含24490个细胞和384个基因。</p><h3 data-tool="mdnice编辑器"><span></span>4.读取10X格式的文件<span></span></h3><p><img data-galleryid="" data-imgfileid="100044324" data-ratio="0.15526601520086863" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCBZyZN4cV25Jh5CuDafCL730QKbm5Pm9U1G6T7wrDXnEa83HAibZt8OA6yFg4Fud2QcBGXiamkwXA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="921" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCBZyZN4cV25Jh5CuDafCL730QKbm5Pm9U1G6T7wrDXnEa83HAibZt8OA6yFg4Fud2QcBGXiamkwXA/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">使用scanpy读取如上图所示的10X格式文件，我们可以用**read_10x_mtx()**这个函数进行3个文件读取，下面是简单的示范；</p><pre data-tool="mdnice编辑器"><span></span><code>read_10x_mtx(path)<br></code></pre><p data-tool="mdnice编辑器"><strong>参数：</strong></p><p data-tool="mdnice编辑器"><strong>path</strong>：上图中的3个文件所在的文件目录，比如:"/home/my/data/GSE10086_RAW"这样的文件路径。</p><p data-tool="mdnice编辑器">更多详情见：https://scanpy.readthedocs.io/en/latest/generated/scanpy.read_10x_mtx.html</p><p data-tool="mdnice编辑器"><strong>实战：</strong></p><p data-tool="mdnice编辑器">上图中这3个文件的下载地址：</p><ul data-tool="mdnice编辑器"><li><section><p>https://ftp.ncbi.nlm.nih.gov/geo/samples/GSM6567nnn/GSM6567952/suppl/GSM6567952%5FControl%2Dfeatures.tsv.gz</p></section></li><li><section><p>https://ftp.ncbi.nlm.nih.gov/geo/samples/GSM6567nnn/GSM6567952/suppl/GSM6567952%5FControl%2Dbarcodes.tsv.gz</p></section></li><li><section><p>https://ftp.ncbi.nlm.nih.gov/geo/samples/GSM6567nnn/GSM6567952/suppl/GSM6567952%5FControl%2Dmatrix.mtx.gz</p></section></li></ul><p data-tool="mdnice编辑器">我已经把这3个文件下载好了并放在<strong>C:/Users/my/Desktop/data/GSM6567952</strong>目录下，并把这三个文件重命名如下：</p><pre data-tool="mdnice编辑器"><span></span><code>features.tsv.gz<br>barcodes.tsv.gz<br>matrix.mtx.gz<br></code></pre><p data-tool="mdnice编辑器">如果不重命名的话，scanpy就会识别不了这三个文件而导致不能读取文件，现在开始读取10X文件吧！</p><p data-tool="mdnice编辑器"><strong>代码如下：</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>#导入scanpy库</span><br><span>import</span> scanpy <span>as</span> sc<br><span>#读取tab文件</span><br>data=sc.read_10x_mtx(<span>'C:/Users/my/Desktop/data/GSM6567952'</span>)<br><span>#查看数据</span><br>print(data)<br></code></pre><p data-tool="mdnice编辑器"><strong>结果如下：</strong></p><pre data-tool="mdnice编辑器"><span></span><code>AnnData object with n_obs × n_vars = 6794880 × 27998<br>    var: <span>'gene_ids'</span>, <span>'feature_types'</span><br></code></pre><p data-tool="mdnice编辑器">可以看出读取文件之后的data变量是一个AnnData数据对象，包含6794880个细胞和27998个基因。</p><h3 data-tool="mdnice编辑器"><span></span>5.读取h5ad文件<span></span></h3><p data-tool="mdnice编辑器">h5ad文件本来就是Python编程语言体系的单细胞存储格式的文件，所以是最方便的，但是它对r语言用户来说就不友好了哦。</p><p><img data-galleryid="" data-imgfileid="100044325" data-ratio="0.042328042328042326" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCBZyZN4cV25Jh5CuDafCLqS9dGVVPfibwJibyk6XqEyGXzp9xAxhhFuFlz3ZpgTkVOofSRVaSYBtg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="945" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCBZyZN4cV25Jh5CuDafCLqS9dGVVPfibwJibyk6XqEyGXzp9xAxhhFuFlz3ZpgTkVOofSRVaSYBtg/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">使用scanpy读取如上图所示的<strong>h5ad</strong>文件，我们可以用<strong>read_h5ad()<strong>这个函数进行</strong>h5ad</strong>文件读取，下面是简单的示范；</p><pre data-tool="mdnice编辑器"><span></span><code>read_h5ad(filename)<br></code></pre><p data-tool="mdnice编辑器"><strong>参数：</strong></p><p data-tool="mdnice编辑器"><strong>filename</strong>：文件名，填写你要读取的tab文件，比如:"/home/my/data/GSE10086_filtered_bc.h5ad.gz"这样的文件路径。</p><p data-tool="mdnice编辑器">更多详情见：https://scanpy.readthedocs.io/en/latest/generated/scanpy.read_h5ad.html</p><p data-tool="mdnice编辑器"><strong>实战：</strong></p><p data-tool="mdnice编辑器">上图中这个文件的下载地址：https://ftp.ncbi.nlm.nih.gov/geo/samples/GSM4648nnn/GSM4648564/suppl/GSM4648564%5Fadipose%5Fraw%5Fcounts.h5ad.gz</p><p data-tool="mdnice编辑器">我已经把这个文件下载好并解压好后，放在<strong>C:/Users/my/Desktop/data</strong>目录下。</p><p data-tool="mdnice编辑器"><strong>注意：</strong>这个文件要进行解压后，scanpy才能读取文件：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#导入scanpy库</span><br><span>import</span> scanpy <span>as</span> sc<br><span>#读取h5ad文件</span><br>data=sc.read_h5ad(<span>'C:/Users/my/Desktop/data/GSM4648564_adipose_raw_counts.h5ad'</span>)<br><span>#查看数据</span><br>print(data)<br></code></pre><p data-tool="mdnice编辑器"><strong>结果如下：</strong></p><pre data-tool="mdnice编辑器"><span></span><code>AnnData object with n_obs × n_vars = 33694 × 11167<br></code></pre><p data-tool="mdnice编辑器">可以看出读取文件之后的data变量是一个AnnData数据对象，包含33694个细胞和11167个基因。</p><h3 data-tool="mdnice编辑器"><span></span>其它文件<span></span></h3><p data-tool="mdnice编辑器"><strong>常见的单细胞数数据文件差不多就这些了，不同文件使用scanpy的不同读取函数进行读取就行了。</strong></p><p data-tool="mdnice编辑器">如果是遇到了比较冷门的单细胞矩阵文件，也欢迎留言交流哈。基本上就遇河架桥，碰到问题解决问题即可。</p><h3 data-tool="mdnice编辑器"><span></span>scanpy的其它功能<span></span></h3><p data-tool="mdnice编辑器">目前scanpy是Python编程体系最流行的单细胞数据处理库了，所以它肯定是不仅仅是读取单细胞转录组表达量矩阵那么简单，它包罗万象，可以出几十个甚至上百个笔记慢慢带领大家理解它哈。它提供了许多用于处理和分析单细胞RNA测序数据的功能，以下是 <code>scanpy</code> 常见的功能：</p><ol data-tool="mdnice编辑器"><li><section><strong>数据加载：</strong></section></li></ol><ul><li><section>支持多种格式的数据加载，包括常见的文本格式（如CSV、TXT）、AnnData格式等。</section></li></ul><li><section><strong>数据预处理：</strong></section></li><ul><li><section>包括数据归一化、基因过滤、细胞过滤、批次效应消除等。</section></li></ul><li><section><strong>可视化工具：</strong></section></li><ul><li><section>提供了丰富的可视化工具，包括绘制细胞聚类、基因表达、UMAP、t-SNE等。</section></li></ul><li><section><strong>细胞聚类：</strong></section></li><ul><li><section>包括常见的聚类算法，如k均值聚类（K-means）、DBSCAN等。</section></li></ul><li><section><strong>基因标记：</strong></section></li><ul><li><section>用于标记不同细胞类型的基因，通过基因差异表达分析来鉴定。</section></li></ul><li><section><strong>细胞亚群鉴定：</strong></section></li><ul><li><section>通过分析细胞的表达模式，识别细胞亚群。</section></li></ul><li><section><strong>细胞状态推断：</strong></section></li><ul><li><section>通过分析基因表达的方式，推断细胞的状态，如细胞周期阶段。</section></li></ul><li><section><strong>差异表达分析：</strong></section></li><ul><li><section>用于比较不同细胞类型或状态之间的基因表达差异。</section></li></ul><li><section><strong>数据集整合：</strong></section></li><ul><li><section>提供了一些工具，用于整合来自不同实验或批次的单细胞数据。</section></li></ul><li><section><strong>轨迹分析：</strong></section></li><ul><li><section>用于分析单细胞数据中细胞的发育轨迹，了解细胞发育和分化过程。</section></li></ul><li><section><strong>单细胞网络分析：</strong></section></li><ul><li><section>探索单细胞数据中的细胞间相互作用网络。</section></li></ul><li><section><strong>高级可视化：</strong></section></li><ul><li><section>支持使用高级图形库，如<code>umap-learn</code>和<code>igraph</code>，进行更复杂的数据可视化。</section></li></ul></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/p2ftpTB7c8MuqOokrh9-zA",target="_blank" rel="noopener noreferrer">原文链接</a>
