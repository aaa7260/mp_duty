---
title: "R数据读取之qs包"
date: 2024-01-01T05:23:13Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞追踪"
]
categories: ["Acdemic"]
---
R数据读取之qs包 by 单细胞追踪
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">随着数据量增加，我们的数据文件的大小也逐渐增加，几个g已经是家常便饭了，但是传统的Rdata、RDS文件的保存和读取数据比较慢，尤其是数据迁移的时候，很影响我们的工作效率，而除了Rdata、RDS文件，R中还有另外一种保存方式qs文件，来源于qs包。这里我们实测以下读取速度和保存的文件大小。</p><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">首先是qs包的安装和加载，一个是直接在CRAN官网上下载，另一个是先手动下载文件后本地安装。最后libraray加载即可。</p><pre data-tool="mdnice编辑器"><span></span><code><span># CRAN version</span><br>install.packages(<span>"qs"</span>)<br><br><span># CRAN version compile from source (recommended)</span><br>remotes::install_cran(<span>"qs"</span>, type = <span>"source"</span>, configure.args = <span>"--with-simd=AVX2"</span>)<br><span>library</span>(qs)<br></code></pre><p data-tool="mdnice编辑器">以自己之前保存的Rdata文件为例，</p><p><img data-galleryid="" data-imgfileid="100000621" data-ratio="0.05232558139534884" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKdBR2hyL86XV3f58R35jV7iaSX7eFRPENd6KhPOFMbzjZVPFrXE85z0AZXlTUKxYWWKE0kGvrrkfQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="688" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKdBR2hyL86XV3f58R35jV7iaSX7eFRPENd6KhPOFMbzjZVPFrXE85z0AZXlTUKxYWWKE0kGvrrkfQ/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">然后我们将同样的数据用qs包中的函数进行重新保存为qs文件：</p><pre data-tool="mdnice编辑器"><span></span><code>qsavem(sce,sce.markers,cL_resutls,file=<span>'scRNA_after_sctype_Tcell.qs'</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100000620" data-ratio="0.04532163742690058" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKdBR2hyL86XV3f58R35jV7efRjTgALicqRNkEAyxGqiaGtgt0UoMWmsFndzaqCWR3bYqdEdtkOg81g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="684" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKdBR2hyL86XV3f58R35jV7efRjTgALicqRNkEAyxGqiaGtgt0UoMWmsFndzaqCWR3bYqdEdtkOg81g/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">然后我们可以发现相比较Rdata文件，qs文件只有四分之一，而且没有损失原文件信息，方便我们数据迁移和保存。接下来，我们观察一下读取速度：</p><pre data-tool="mdnice编辑器"><span></span><code>system.time(new&lt;-qread(<span>'scRNA_after_sctype_Tcell.qs'</span>))<br>system.time(load(<span>"scRNA_after_sctype_Tcell.Rdata"</span>))<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>   user  system elapsed <br>  0.881   0.257   1.137 <br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>   user  system elapsed <br>  1.413   0.232   1.642 <br></code></pre><p data-tool="mdnice编辑器">另外官网还给出了常见数据读取速度的比较：</p><p><img data-galleryid="" data-imgfileid="100000622" data-ratio="0.6871401151631478" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKdBR2hyL86XV3f58R35jV7WFxFC38S4EE7vwcEkP0w4nJthmvJSWyceg1ROneDXhN7S3RVUnkicWw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1042" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKdBR2hyL86XV3f58R35jV7WFxFC38S4EE7vwcEkP0w4nJthmvJSWyceg1ROneDXhN7S3RVUnkicWw/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">结果如上，发现qs的速度也是比较快的，而且根据其他测试，数据量越大，比较几个g的数据，速度差距会越来越大，因此，R数据读取可以尝试这个新的文件格式。</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/3h-lN9gn90EWs4p1y2rhRg",target="_blank" rel="noopener noreferrer">原文链接</a>
