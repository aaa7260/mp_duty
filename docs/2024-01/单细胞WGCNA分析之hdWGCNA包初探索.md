---
title: "单细胞WGCNA分析之hdWGCNA包初探索"
date: 2024-01-21T03:49:27Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞追踪"
]
categories: ["Acdemic"]
---
单细胞WGCNA分析之hdWGCNA包初探索 by 单细胞追踪
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h1 data-tool="mdnice编辑器"><span></span><span><span>由于单细胞分组较多，如果做普通差异分析，需要做很多次差异分析，相当繁琐而且很难解释，而在bulk RNA中，WGCNA的方法正好可以解决这个问题，不过由于单细胞矩阵本身的稀疏性的问题，导致WGCNA包不能直接用于单细胞，而hdWGCNA这个包的出现解决了这个问题，从而使得WGCNA也可以适用于单细胞，从而鉴别出不同模块与不同表型的关系，再从模块中找出关键的hub基因，这样就比单纯的差异分析要好得多。这里以pbmc数据为例，展示在探索hdWGCNA的时候需要的各种问题：</span><br></span></h1><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">首先遇到的问题是hdWGCNA的装包问题，官网中给出的标准安装方法是：</p><p data-tool="mdnice编辑器">devtools::install_github('smorabit/hdWGCNA', ref='dev')</p><p data-tool="mdnice编辑器">但是由于网络问题，常常这个会出现报错的，解决的方法只能是GitHub上下载压缩包之后手动安装，但是下载之后还是需要安装必须的依赖包，这个每个人遇到的可能不一致，我的是出现了harmony包版本不一致，需要自行重新更改。然后是加载包以及设置基本的设置。</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(Seurat)<br><br><span># plotting and data science packages</span><br><span>library</span>(tidyverse)<br><span>library</span>(cowplot)<br><span>library</span>(patchwork)<br><br><span># co-expression network analysis packages:</span><br><span>library</span>(WGCNA)<br><span>library</span>(hdWGCNA)<br><br><span># using the cowplot theme for ggplot</span><br>theme_set(theme_cowplot())<br><br><span># set random seed for reproducibility</span><br>set.seed(<span>12345</span>)<br><br><span># optionally enable multithreading</span><br>enableWGCNAThreads(nThreads = <span>8</span>)<br></code></pre><p data-tool="mdnice编辑器">然后加载自己数据</p><pre data-tool="mdnice编辑器"><span></span><code><span># load the Zhou et al snRNA-seq dataset</span><br>load(<span>'pbmc3k.final_for_irGSEA.Rdata'</span>)<br><span>#可视化一下看看</span><br>p &lt;- DimPlot(pbmc3k.final, group.by=<span>'seurat_annotations'</span>, label=<span>TRUE</span>) <br>p<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000712" data-ratio="0.6569978245105149" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlaQAmmy3aFmpOVQjE6tT5FiaVPiaibIogrhE9jbtQJ8OndNXrCd2ejYXSA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1379" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlaQAmmy3aFmpOVQjE6tT5FiaVPiaibIogrhE9jbtQJ8OndNXrCd2ejYXSA/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">然后我们按照标准流程去跑：</p><pre data-tool="mdnice编辑器"><span></span><code>seurat_obj&lt;-pbmc3k.final<br>seurat_obj &lt;- SetupForWGCNA(<br>  seurat_obj,<br>  gene_select = <span>"fraction"</span>, <span># the gene selection approach</span><br>  fraction = <span>0.05</span>, <span># fraction of cells that a gene needs to be expressed in order to be included</span><br>  wgcna_name = <span>"tutorial"</span> <span># the name of the hdWGCNA experiment</span><br>)<br><span>##由于pbmc数据只有一个样本，以RNA_snn_res.0.5作为样本分组。</span><br><span># construct metacells  in each group</span><br>seurat_obj &lt;- MetacellsByGroups(<br>  seurat_obj = seurat_obj,<br>  group.by = c(<span>"seurat_annotations"</span>, <span>"RNA_snn_res.0.5"</span>), <span># specify the columns in seurat_obj@meta.data to group by</span><br>  <span>#reduction = 'harmony', # select the dimensionality reduction to perform KNN on</span><br>  k = <span>25</span>, <span># nearest-neighbors parameter</span><br>  max_shared = <span>10</span>, <span># maximum number of shared cells between two metacells</span><br>  ident.group = <span>'seurat_annotations'</span> <span># set the Idents of the metacell seurat object</span><br>)<br><br><span># normalize metacell expression matrix:</span><br>seurat_obj &lt;- NormalizeMetacells(seurat_obj)<br><span>####共表达网络构建</span><br>seurat_obj &lt;- SetDatExpr(<br>  seurat_obj,<br>  group_name = <span>"B"</span>, <span># the name of the group of interest in the group.by column</span><br>  group.by=<span>'seurat_annotations'</span>, <span># the metadata column containing the cell type info. This same column should have also been used in MetacellsByGroups</span><br>  assay = <span>'RNA'</span>, <span># using RNA assay</span><br>  slot = <span>'data'</span> <span># using normalized data</span><br>)<br><span># Test different soft powers:</span><br>seurat_obj &lt;- TestSoftPowers(<br>  seurat_obj,<br>  networkType = <span>'signed'</span> <span># you can also use "unsigned" or "signed hybrid"</span><br>)<br><br><span># plot the results:</span><br>plot_list &lt;- PlotSoftPowers(seurat_obj)<br><br><span># assemble with patchwork</span><br>wrap_plots(plot_list, ncol=<span>2</span>)<br>power_table &lt;- GetPowerTable(seurat_obj)<br>head(power_table)<br></code></pre><p data-tool="mdnice编辑器">上面的代码不需要理解原理，只需要修改seurat_annotations、RNA_snn_res.0.5、B这几个参数即可，分别代表了你的实验分组名称、样本分组名称，以及需要重点关注的实验分组中的某个亚群的名称。然后根据软阈值结果去选择软阈值。</p><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000711" data-ratio="0.6585014409221902" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlf0mWQOhDVXhvCS254hNva9wicAhQrj6NjQph9WyqbOwANekIATRII5A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1388" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlf0mWQOhDVXhvCS254hNva9wicAhQrj6NjQph9WyqbOwANekIATRII5A/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">如上图，我们选择软阈值为6即可。接下来是熟悉的基因聚类树这个瀑布图：</p><pre data-tool="mdnice编辑器"><span></span><code><span># construct co-expression network:</span><br>seurat_obj &lt;- ConstructNetwork(<br>  seurat_obj, soft_power=<span>6</span>,<br>  setDatExpr=<span>FALSE</span>,<br>  tom_name = <span>'B'</span> <span># name of the topoligical overlap matrix written to disk</span><br>  )<br>PlotDendrogram(seurat_obj, main=<span>'Bcell hdWGCNA Dendrogram'</span>)<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000713" data-ratio="0.6610664718772827" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlsjxjY15DxhsxPnEibeqgyLt2mA15YIu2WAjfbrJXn3F9d7TC8e8PMeg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1369" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlsjxjY15DxhsxPnEibeqgyLt2mA15YIu2WAjfbrJXn3F9d7TC8e8PMeg/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">我们最需要的其实就是结果解读，上图中一共分为两个部分，上半部分和瀑布一样的是聚类tree，距离相近的模块往往功能相近，这个距离的算法hdWGCNA中用的是层次聚类，下半部分，不同颜色代表的是不同的模块，灰色的代表没有基因富集到，不用管，后续需要去掉这个部分。</p><p data-tool="mdnice编辑器">然后计算ME值，ME和hME是hdWGCNA中很重要的一个概念，模块特征基因(ME)是一种常用的度量方法，用于总结整个共表达模块的基因表达谱。另外，官网上还额外提供了harmony矫正的ME的方法，也就是hME。我们看一下这个两个的计算结果：</p><pre data-tool="mdnice编辑器"><span></span><code><span># compute all MEs in the full single-cell dataset</span><br>seurat_obj &lt;- ModuleEigengenes(<br>  seurat_obj,<br>  group.by.vars=<span>"RNA_snn_res.0.5"</span><br>) <span>#时间较长</span><br><span># harmonized module eigengenes:</span><br>hMEs &lt;- GetMEs(seurat_obj) <span>#每个细胞对于每个模块的特征值</span><br>head(hMEs)<br><span># module eigengenes:</span><br>MEs &lt;- GetMEs(seurat_obj, harmonized=<span>FALSE</span>)<br>head(MEs)<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-imgfileid="100000714" data-ratio="0.26031746031746034" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlAfmnGtRw9agfpicdfM8GK4ma2EPf1ApN3vmrJHLKjfObD3J6eicm7ScA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="945" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlAfmnGtRw9agfpicdfM8GK4ma2EPf1ApN3vmrJHLKjfObD3J6eicm7ScA/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-imgfileid="100000715" data-ratio="0.2614879649890591" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphl4WUl5rUnFIkVSFtbIslPEK4HCx2a3g8Zn3F3tq9ibxD1DjR51SRRnMg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="914" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphl4WUl5rUnFIkVSFtbIslPEK4HCx2a3g8Zn3F3tq9ibxD1DjR51SRRnMg/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">从结果上来看，ME和hME还是有一定区别的，后续可以分别进行分析，看看效果如何。</p><pre data-tool="mdnice编辑器"><span></span><code><span># compute eigengene-based connectivity (kME):</span><br>seurat_obj &lt;- ModuleConnectivity(<br>  seurat_obj,<br>  group.by = <span>'seurat_annotations'</span>, group_name = <span>'B'</span><br>)<br><br><span># rename the modules</span><br>seurat_obj &lt;- ResetModuleNames(<br>  seurat_obj,<br>  new_name = <span>"B"</span><br>)<br><span># plot genes ranked by kME for each module</span><br>p &lt;- PlotKMEs(seurat_obj, ncol=<span>5</span>)<br><br>p<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000716" data-ratio="0.6552727272727272" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlRWDFbOQtsq7Pib0Zqw4aIY9GSNqzClfqE4DVLdffAaAu4Lq3mJzh9Tg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1375" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlRWDFbOQtsq7Pib0Zqw4aIY9GSNqzClfqE4DVLdffAaAu4Lq3mJzh9Tg/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">这个图就是B细胞中计算出的19个模块的特异表达基因的基因谱。我们计算了特定亚群，这里是B细胞中的不同模块，我们想知道其中起到关键作用的hub基因到底有哪些，代码如下：</p><pre data-tool="mdnice编辑器"><span></span><code><span># get the module assignment table:</span><br>modules &lt;- GetModules(seurat_obj)<br><br><span># show the first 6 columns:</span><br>head(modules[,<span>1</span>:<span>6</span>])<br><span># get hub genes</span><br>hub_df &lt;- GetHubGenes(seurat_obj, n_hubs = <span>10</span>)<br><br>head(hub_df)<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>  gene_name <span>module</span>       kME<br><span>1</span>     SERP1     B1 <span>0.2584262</span><br><span>2</span>   SH3BGRL     B1 <span>0.2585542</span><br><span>3</span>    ZBTB7A     B1 <span>0.2625876</span><br><span>4</span>      FGL2     B1 <span>0.2919934</span><br><span>5</span>     MKNK2     B1 <span>0.3035171</span><br><span>6</span>    RTFDC1     B1 <span>0.3049386</span><br></code></pre><p data-tool="mdnice编辑器">回归到单细胞，我们找到了hub基因，那么这些hub基因在每个单细胞中如何表达呢？因此要计算表达活性，需要评个分，有两种，一种是seurat自带的AddModuleScore评分，另一种是UCell评分。</p><pre data-tool="mdnice编辑器"><span></span><code>seurat_obj &lt;- ModuleExprScore(<br>  seurat_obj,<br>  n_genes = <span>25</span>,<br>  method=<span>'Seurat'</span><span>#AddModuleScore</span><br>)<br><br><span># with UCell method</span><br><span>library</span>(UCell)<br>seurat_obj &lt;- ModuleExprScore(<br>  seurat_obj,<br>  n_genes = <span>25</span>,<br>  method=<span>'UCell'</span><br>)<br><span>###可视化</span><br><span># make a featureplot of hMEs for each module</span><br>plot_list &lt;- ModuleFeaturePlot(<br>  seurat_obj,<br>  features=<span>'hMEs'</span>, <span># plot the hMEs</span><br>  order=<span>TRUE</span> <span># order so the points with highest hMEs are on top</span><br>)<br><br><span># stitch together with patchwork</span><br>wrap_plots(plot_list, ncol=<span>6</span>)<br><span>##hub gene </span><br><span># make a featureplot of hub scores for each module</span><br>plot_list &lt;- ModuleFeaturePlot(<br>  seurat_obj,<br>  features=<span>'scores'</span>, <span># plot the hub gene scores</span><br>  order=<span>'shuffle'</span>, <span># order so cells are shuffled</span><br>  ucell = <span>TRUE</span> <span># depending on Seurat vs UCell for gene scoring</span><br>)<br><br><span># stitch together with patchwork</span><br>wrap_plots(plot_list, ncol=<span>6</span>)<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000717" data-ratio="0.6467589220684632" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlibU5kAUnXdpwnIKeZQJEGneZDKdWZdzdC1iaicWIpzIA9fWZKyqWINrww/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1373" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlibU5kAUnXdpwnIKeZQJEGneZDKdWZdzdC1iaicWIpzIA9fWZKyqWINrww/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">以及不用模块之间的相关性</p><pre data-tool="mdnice编辑器"><span></span><code>ModuleCorrelogram(seurat_obj)<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000718" data-ratio="0.847926267281106" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphl3NTSdH1rRvqNibqkre9k8AcolEWAAwR6snGKQxsP43SBL3jnt97TG1w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="868" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphl3NTSdH1rRvqNibqkre9k8AcolEWAAwR6snGKQxsP43SBL3jnt97TG1w/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">接下来进行</p><pre data-tool="mdnice编辑器"><span></span><code><span># get hMEs from seurat object</span><br>MEs &lt;- GetMEs(seurat_obj, harmonized=<span>TRUE</span>)<br>mods &lt;- colnames(MEs); mods &lt;- mods[mods != <span>'grey'</span>]<br><br><span># add hMEs to Seurat meta-data:</span><br>seurat_obj@meta.data &lt;- cbind(seurat_obj@meta.data, MEs)<br><span># plot with Seurat's DotPlot function</span><br>p &lt;- DotPlot(seurat_obj, features=mods, group.by = <span>'seurat_annotations'</span>)<br><br><span># flip the x/y axes, rotate the axis labels, and change color scheme:</span><br>p &lt;- p +<br>  coord_flip() +<br>  RotatedAxis() +<br>  scale_color_gradient2(high=<span>'red'</span>, mid=<span>'grey95'</span>, low=<span>'blue'</span>)<br><br><span># plot output</span><br>p<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000720" data-ratio="0.6532374100719425" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlXHzaKkFFHc8Jiaxm9icGDV2Fy6ox3wybm0G0fHTpOdIoYpRDzQYEUduQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1390" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlXHzaKkFFHc8Jiaxm9icGDV2Fy6ox3wybm0G0fHTpOdIoYpRDzQYEUduQ/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code>p &lt;- VlnPlot(<br>  seurat_obj,<br>  features = <span>'B1'</span>,<br>  group.by = <span>'seurat_annotations'</span>,<br>  pt.size = <span>0</span> <span># don't show actual data points</span><br>)<br><br><span># add box-and-whisker plots on top:</span><br>p &lt;- p + geom_boxplot(width=<span>.25</span>, fill=<span>'white'</span>)<br><br><span># change axis labels and remove legend:</span><br>p &lt;- p + xlab(<span>''</span>) + ylab(<span>'hME'</span>) + NoLegend()<br><br><span># plot output</span><br>p<br></code></pre><p data-tool="mdnice编辑器">以及不用模块在整个亚群中的活性分布。</p><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000721" data-ratio="0.6314639475600874" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphl2Zox7hnjriagzujibNzib7JICa6CzQuG9Snja4RMGlaYtLveqplxaV2Zw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1373" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphl2Zox7hnjriagzujibNzib7JICa6CzQuG9Snja4RMGlaYtLveqplxaV2Zw/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">以上两种图很重要，直接把模块与亚群，也就是表型相联系，模块中的hub基因又已经找到，至此形成闭环，完成了hdWGCNA的任务。后续的可视化方法也有很多，如下：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(igraph)<br>ModuleNetworkPlot(seurat_obj)<br></code></pre><p data-tool="mdnice编辑器">注意，整个结果是放在文件夹中的，不直接出现在画板上的。</p><figure data-tool="mdnice编辑器"><p><img data-imgfileid="100000719" data-ratio="0.7956989247311828" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlhjY0dvE0l89tZJo42CF8Zud1a1yBQmzwWjTyYTpmKficC4WZheep1dg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="558" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlhjY0dvE0l89tZJo42CF8Zud1a1yBQmzwWjTyYTpmKficC4WZheep1dg/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-imgfileid="100000723" data-ratio="0.9835796387520526" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlLYW3oEOJG8jkQNY0EOmBHGbzj1TOCSPtw8VKKaDnKmWuFMrq0xzwwQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="609" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlLYW3oEOJG8jkQNY0EOmBHGbzj1TOCSPtw8VKKaDnKmWuFMrq0xzwwQ/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">以B1整个模块为例，中间10个基因是最关键的hub基因，外面一圈地位稍差一些。</p><pre data-tool="mdnice编辑器"><span></span><code><span># hubgene network</span><br>HubGeneNetworkPlot(<br>  seurat_obj,<br>  n_hubs = <span>3</span>, n_other=<span>5</span>,<br>  edge_prop = <span>0.75</span>,<br>  mods = <span>'all'</span><br>)<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>seurat_obj &lt;- RunModuleUMAP(<br>  seurat_obj,<br>  n_hubs = <span>10</span>, <span># number of hub genes to include for the UMAP embedding</span><br>  n_neighbors=<span>15</span>, <span># neighbors parameter for UMAP</span><br>  min_dist=<span>0.1</span> <span># min distance between points in UMAP space</span><br>)<br><span># get the hub gene UMAP table from the seurat object</span><br>umap_df &lt;- GetModuleUMAP(seurat_obj)<br><br><span># plot with ggplot</span><br>ggplot(umap_df, aes(x=UMAP1, y=UMAP2)) +<br>  geom_point(<br>    color=umap_df$color, <span># color each point by WGCNA module</span><br>    size=umap_df$kME*<span>2</span> <span># size of each point based on intramodular connectivity</span><br>  ) +<br>  umap_theme()<br>ModuleUMAPPlot(<br>  seurat_obj,<br>  edge.alpha=<span>0.25</span>,<br>  sample_edges=<span>TRUE</span>,<br>  edge_prop=<span>0.1</span>, <span># proportion of edges to sample (20% here)</span><br>  label_hubs=<span>2</span> ,<span># how many hub genes to plot per module?</span><br>  keep_grey_edges=<span>FALSE</span><br>  <br>)<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000722" data-ratio="0.8680904522613065" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlFuaDh967FiahxVDsPLLciaXETjEupMUgiaQqA2c1Z2iazmxa7Yz6dJ8gbA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="796" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphlFuaDh967FiahxVDsPLLciaXETjEupMUgiaQqA2c1Z2iazmxa7Yz6dJ8gbA/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">hdWGCNA还有很多应用</p><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000724" data-ratio="1.5245901639344261" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphl2rpE83SsS6LZiby7H0Dk9UW0hdhxVrlJRkcibaOL8snmtOZq0ZSKuIMA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="549" src="https://mmbiz.qpic.cn/sz_mmbiz_png/y6jd6X97IxKTjroWjomTa3tJRY0txphl2rpE83SsS6LZiby7H0Dk9UW0hdhxVrlJRkcibaOL8snmtOZq0ZSKuIMA/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">后续再深入探索hdWGCNA，周末快乐！</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/YTIAUpTho0yf7EmfQVTYhg",target="_blank" rel="noopener noreferrer">原文链接</a>
