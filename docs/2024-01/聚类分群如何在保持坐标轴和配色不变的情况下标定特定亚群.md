---
title: "聚类分群如何在保持坐标轴和配色不变的情况下标定特定亚群"
date: 2024-01-26T10:17:17Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
聚类分群如何在保持坐标轴和配色不变的情况下标定特定亚群 by 单细胞天地
------
<div><section data-style-type="5" data-tools="新媒体排版" data-id="2430070"><section data-style-type="5" data-tools="新媒体排版" data-id="2390348"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section><br></section><section><section><section powered-by="xiumi.us"><section><section><p>分享是一种态度</p></section></section></section></section></section></section></section></section><section><section powered-by="xiumi.us"><section><section><img data-ratio="0.8738095238095238" data-type="gif" data-w="420" width="100%" data-imgfileid="100035794" data-src="https://mmbiz.qpic.cn/mmbiz_gif/siaia0BDGJdjSnnb9ibXpFagGPWQ0JjSSTNVBZthROEhicfINuLcxX2Ro3Zb600LJhrzeYIb120tLjSVXEtLn14DwA/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/mmbiz_gif/siaia0BDGJdjSnnb9ibXpFagGPWQ0JjSSTNVBZthROEhicfINuLcxX2Ro3Zb600LJhrzeYIb120tLjSVXEtLn14DwA/640?wx_fmt=gif"></section></section></section></section></section></section></section></section></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><span></span><blockquote data-tool="mdnice编辑器"><p>最近看到有这种只标定特定细胞群的聚类分群图，想想应该不是很难，应该可以用DimPlot来实现，下面就是具体的探索啦。</p></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100035803" data-ratio="0.36203703703703705" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQDgxjsicqo7BaxZeKPiakQerHiboyYBZvjHzRDyuTaUeOfaWmA29P2BuR95VGOX5p9qXhJqYo0J796Q/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQDgxjsicqo7BaxZeKPiakQerHiboyYBZvjHzRDyuTaUeOfaWmA29P2BuR95VGOX5p9qXhJqYo0J796Q/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">首先尝试只提取特定的细胞群的cell作为DimPlot的输入。但是发现只标定特定细胞群时，坐标轴和配色都发生了变化（下图中的第一和第二个子图）：</p><pre data-tool="mdnice编辑器"><span></span><code>kp1 = sce$celltype ==<span>'B'</span><br>kp2 = sce$celltype %<span>in</span>% c(<span>"Naive CD4 T"</span>,  <span>"Memory CD4 T"</span> )<br>DimPlot(sce[,kp1]) + DimPlot(sce[,kp2]) + DimPlot(sce,label = <span>TRUE</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100035802" data-ratio="0.49166666666666664" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQDgxjsicqo7BaxZeKPiakQerNHwO18NTPPW92EvBX1GKpYfQ44K7iaqbaLkUZKrQKq4gGv2CIWf18GQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQDgxjsicqo7BaxZeKPiakQerNHwO18NTPPW92EvBX1GKpYfQ44K7iaqbaLkUZKrQKq4gGv2CIWf18GQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">因为每次<code>DimPlot()</code>的坐标轴和配色配置是独立的，所以在所有聚类分群图上的坐标轴和颜色是不能自动和特定细胞群的聚类分群图统一的。那么我们需要修改代码来满足取子集的同时，让坐标轴不变化，配色也不变化。</p><p data-tool="mdnice编辑器">在查看<code>DimPlot()</code>函数介绍的时候发现<code>cells.highlight</code>参数用来高亮显示在降维可视化图(比如UMAP)中特定的细胞。这个参数接受一个向量,包含要高亮的细胞的名称。只是高亮，不会影响坐标轴结构。</p><p data-tool="mdnice编辑器">那么如何得到特定细胞群的颜色呢？我想到首先需要得到DimPlot默认所用的颜色，该函数与ggplot2类似，所以搜索发现<code>hue_pal()</code>函数可以得到默认的配色。然后找到特定细胞群名字在所有细胞群的位置，得到他的颜色。</p><p data-tool="mdnice编辑器">整体的思路就是要找到特定细胞群的颜色和细胞名称。代码如下：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 得到分组数目</span><br>tmp_length &lt;- length(levels(sce$celltype))<br><span># 获得默认的颜色</span><br>cell_type_cols &lt;- hue_pal()(tmp_length)<br><span># 找到B对应的颜色和细胞id</span><br>B_col&lt;- cell_type_cols[levels(sce$celltype) == <span>"B"</span>]<br>B_highlight&lt;- list(B=WhichCells(pbmc, idents=<span>"B"</span>))<br><span># 找到CD4对应的颜色和细胞id</span><br>CD4_col &lt;- cell_type_cols[levels(sce$celltype) %<span>in</span>% c(<span>"Naive CD4 T"</span>,  <span>"Memory CD4 T"</span> )]<br>CD4_highlight&lt;- list(<span>"Naive CD4 T"</span>=WhichCells(pbmc, idents=<span>"Naive CD4 T"</span>),<span>"Memory CD4 T"</span>=WhichCells(pbmc, idents=<span>"Memory CD4 T"</span>))<br><span># 画图</span><br>DimPlot(pbmc, cells.highlight=B_highlight,cols.highlight=B_col,label = <span>TRUE</span>)+<br>  DimPlot(pbmc, cells.highlight=CD4_highlight,cols.highlight=CD4_col,label = <span>TRUE</span>)+<br>  DimPlot(sce,label = <span>TRUE</span>,cols = cell_type_cols)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100035801" data-ratio="0.48703703703703705" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQDgxjsicqo7BaxZeKPiakQernibccnkNBc3u1xG1yiaEojPq5GzSvcgcWDjH0XdFlERDQicXZcCaDXKjw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQDgxjsicqo7BaxZeKPiakQernibccnkNBc3u1xG1yiaEojPq5GzSvcgcWDjH0XdFlERDQicXZcCaDXKjw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">看来达到了我们的目的：只标定特定细胞群，保持坐标轴和配色不变化。感兴趣的你也可以试试哦。<span></span></p><span></span></section><section><p><br></p><p><br></p><p><br></p><section data-style-type="5" data-tools="新媒体排版" data-id="2440476"><section><section><section><section><img data-ratio="0.9495798319327731" data-type="gif" data-w="119" data-width="100%" data-imgfileid="100035793" data-src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif"></section><section data-brushtype="text">往期回顾</section><section><br></section></section></section></section><section><section data-autoskip="1"><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247519406&amp;idx=1&amp;sn=f393c95d3914cac771ac9f12a77ff71d&amp;chksm=ea1c8a2cdd6b033a6cdf8f6e9df58657778a18749521a891257f20c4765f68538f8662d61fe4&amp;scene=21#wechat_redirect" textvalue="百创S3000抢先体验 || 让空间组学性能再迈一步" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>百创S3000抢先体验 || 让空间组学性能再迈一步</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247519358&amp;idx=1&amp;sn=bf3383070648e6e214fb288c3d4ea4b0&amp;chksm=ea1c8afcdd6b03ea4cb46c854904ad2c9a1712079d6eb1403dd90f85377917913146ec4048fd&amp;scene=21#wechat_redirect" textvalue="python的scanpy库读取几种常见格式的单细胞数据文件汇总" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2"><span>python的scanpy库读取几种常见格式的单细胞数据文件汇总</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247519358&amp;idx=2&amp;sn=a5422675597371f57f76226bf02aee6f&amp;chksm=ea1c8afcdd6b03ea505f95b2de74b916a3143f41003b6dea33531f380cc7688d000e037b51b3&amp;scene=21#wechat_redirect" textvalue="探索AnnData数据对象，揭开它的" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2"><span>探索AnnData数据对象，揭开它的</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247519356&amp;idx=1&amp;sn=d11ab047c4bbc13d2a7e8ab866629bd7&amp;chksm=ea1c8afedd6b03e890ecea7adcb2baaee17ca0dd1fbbae96ae4bdd6a91d4e45bf3f284a55f0d&amp;scene=21#wechat_redirect" textvalue="小鼠急性肾损伤AKI模型的单细胞分析" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>小鼠急性肾损伤AKI模型的单细胞分析</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247519335&amp;idx=1&amp;sn=e0db2e000286ba3e84e5fb483b52c2ec&amp;chksm=ea1c8ae5dd6b03f3cbba7ac3762281650f048d82d7d1d73fc04713588cb9453590fb2ce6ae18&amp;scene=21#wechat_redirect" textvalue="空间单细胞转录组必读综述之二（华大基因）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="8" tab="innerlink" data-linktype="2"><span>空间单细胞转录组必读综述之二（华大基因）</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247519304&amp;idx=1&amp;sn=5a3870beffb238acb9ad97367aaf65da&amp;chksm=ea1c8acadd6b03dc697a6c959e02118191ae41b8291b59af7d531b7955b57599123f5330475d&amp;scene=21#wechat_redirect" textvalue="空间单细胞转录组必读综述之一" linktype="text" imgurl="" imgdata="null" data-itemshowtype="8" tab="innerlink" data-linktype="2"><span>空间单细胞转录组必读综述之一</span></a><span>​</span></p></section></section><hr><p><br></p></section><section data-style-type="5" data-tools="新媒体排版" data-id="2440475"><hr><p><br></p><hr><section><p>如果你对单细胞转录组研究感兴趣，但又不知道如何入门，也许你可以关注一下下面的课程</p><p><br></p><ul><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247527207&amp;idx=1&amp;sn=fb9ca814003fc24e9ec8b1bcecbd1d56&amp;chksm=9b4b2b9cac3ca28afc5b68047e5f0587b6636d52879051decd573009e38313c5f7d6b0d1927d&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课2024年1月班" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" localeditorid="4ht0yjcyofm00000000">生信入门&amp;数据挖掘线上直播课2024年1月班</a><br></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526168&amp;idx=1&amp;sn=ebc4a9d53d675e3f7d20b1e2f97901b8&amp;chksm=9b4b27a3ac3caeb5ee0828c38f816c229067d1946be224bcaf4bac0dbdfc9eff863c621097e2&amp;scene=21#wechat_redirect" textvalue="生物信息学江湖的开创性产品-共享服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学江湖的开创性产品-共享服务器</a></p></li><br><p></p></ul><p><img data-imgfileid="100035795" data-ratio="1" data-type="gif" data-w="240" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif"><br></p><p><img data-ratio="0.05278592375366569" data-type="jpeg" data-w="341" data-imgfileid="100035792" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p></section><section><section data-id="93668"><section><section data-width="95%"><section><section><section data-width="38%"><section><section data-tools="135编辑器" data-id="93668"><section><section data-width="95%"><section><section><section data-width="61.8%"><section><section><section><p><br></p><span><strong data-burshtype="text"><img data-copyright="0" data-cropselx1="0" data-cropselx2="109" data-cropsely1="0" data-cropsely2="109" data-ratio="1" data-type="jpeg" data-w="258" title="qrcode_for_gh_5a3c482ed99f_1280.jpg" data-imgfileid="100035796" data-src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg"><strong data-burshtype="text">生物</strong><strong data-burshtype="text"> | 单细胞 | 转录组丨资料</strong></strong></span></section><section><span><strong data-burshtype="text">每天都精彩</strong></span></section></section></section><section><section><section><section><section><section><p><span>长按扫码可关注</span></p></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section><p><br></p></section></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/HwRlGKq15qjdzJFy_5EesQ",target="_blank" rel="noopener noreferrer">原文链接</a>
