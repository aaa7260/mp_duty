---
title: "读取文件时的"大坑"(python的scanpy库)"
date: 2024-01-31T10:03:06Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
读取文件时的"大坑"(python的scanpy库) by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>基于<strong>《<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247519358&amp;idx=1&amp;sn=bf3383070648e6e214fb288c3d4ea4b0&amp;chksm=ea1c8afcdd6b03ea4cb46c854904ad2c9a1712079d6eb1403dd90f85377917913146ec4048fd&amp;scene=21#wechat_redirect" textvalue="python的scanpy库读取几种常见的格式的单细胞数据文件汇总" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">python的scanpy库读取几种常见的格式的单细胞数据文件汇总</a>》</strong>的文章，不知道有没有细心的小伙伴发现，在使用scanpy读取单细胞数据txt文件或者其他格式文件时，得到的AnnData数据对象有点奇怪，其实你已经进入了一个<strong>大坑</strong>之中了。那我们来看看是怎么一回事？</p></blockquote><p data-tool="mdnice编辑器"><strong>之前没有安装scanpy库</strong>，可以进行如下操作进行安装：</p><pre data-tool="mdnice编辑器"><span></span><code>pip install scanpy -i https://pypi.tuna.tsinghua.edu.cn/simple<br></code></pre><p data-tool="mdnice编辑器"><strong>如果之前有安装过了，就不必在进行安装了!</strong></p><h4 data-tool="mdnice编辑器"><span></span><span>"探坑"</span><span></span></h4><p data-tool="mdnice编辑器"><strong>单细胞实例数据txt文件的下载地址</strong>：https://ftp.ncbi.nlm.nih.gov/geo/samples/GSM5101nnn/GSM5101014/suppl/GSM5101014%5FPt1%5FSuperficial%5FCountMatrix.txt.gz</p><p data-tool="mdnice编辑器">我已经把这个文件下载好了并放在<strong>C:/Users/my/Desktop/data</strong>目录下，现在开始读取txt文件!</p><p data-tool="mdnice编辑器">那我们来看看是什么样的一个<strong>大坑</strong>，<strong>代码如下：</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>#导入scanpy库</span><br><span>import</span> scanpy <span>as</span> sc<br><span>#读取GSE数据库的单细胞示例数据txt文件</span><br>data_1=sc.read_text(<span>'C:/Users/my/Desktop/data/GSM5101014_Pt1_Superficial_CountMatrix.txt.gz'</span>)<br><span>#查看数据</span><br>print(data_1)<br></code></pre><p data-tool="mdnice编辑器"><strong>结果如下：</strong></p><pre data-tool="mdnice编辑器"><span></span><code>AnnData object <span>with</span> n_obs × n_vars = <span>32738</span> × <span>2315</span><br></code></pre><p data-tool="mdnice编辑器">表明看上去是不是很正常，没什么奇怪的啊！别急，我们继续往下走：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#读取scanpy的内置数据集pbmc68k_reduced</span><br>data_2=sc.datasets.pbmc68k_reduced()<br><span>#查看内置数据</span><br>print(data_2)<br></code></pre><p data-tool="mdnice编辑器"><strong>pbmc68k_reduced是一个scanpy开发者已经处理过的示例数据集，我们读取这个数据集后得到的是一个正常的AnnData数据对象，我们可以用它来作为参考</strong>。</p><p data-tool="mdnice编辑器">我们查看代码结果的第一行，如下：</p><pre data-tool="mdnice编辑器"><span></span><code>AnnData object <span>with</span> n_obs × n_vars = <span>700</span> × <span>765</span><br></code></pre><p data-tool="mdnice编辑器">表明看上去是不是也很正常，没什么奇怪的啊！但是，恭喜你已经成功地不知不觉<strong>入坑</strong>了，哈哈！</p><p data-tool="mdnice编辑器">是不是觉得很奇怪，没事，等会你就会看到<strong>大坑</strong>了。</p><p data-tool="mdnice编辑器"><strong>注意</strong>，上面的<strong>data_1</strong>是我们的从GEO数据库下载并使用<strong>read_text()<strong>进行读取得到的Anndata数据对象，而</strong>data_2</strong>是读取scanpy的内置数据后的<strong>正常Anndata数据对象</strong>，两者不要混淆。</p><p data-tool="mdnice编辑器">我们先查看<strong>正常AnnData数据对象的obs信息</strong>，继续往下走：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#先查看正常AnnData数据对象的obs信息</span><br>print(data_2.obs)<br></code></pre><p data-tool="mdnice编辑器"><strong>结果如下：</strong></p><pre data-tool="mdnice编辑器"><span></span><code>                      bulk_labels  n_genes  ...  phase  louvain<br>index                                       ...                <br>AAAGCCTGGCTAAC<span>-1</span>   CD14+ Monocyte     <span>1003</span>  ...     G1        <span>1</span><br>AAATTCGATGCACA<span>-1</span>        Dendritic     <span>1080</span>  ...      S        <span>1</span><br>AACACGTGGTCTTT<span>-1</span>         CD56+ NK     <span>1228</span>  ...     G1        <span>3</span><br>AAGTGCACGTGCTA<span>-1</span>  CD4+/CD25 T Reg     <span>1007</span>  ...    G2M        <span>9</span><br>ACACGAACGGAGTG<span>-1</span>        Dendritic     <span>1178</span>  ...     G1        <span>2</span><br>                           ...      ...  ...    ...      ...<br>TGGCACCTCCAACA<span>-8</span>        Dendritic     <span>1166</span>  ...     G1        <span>2</span><br>TGTGAGTGCTTTAC<span>-8</span>        Dendritic     <span>1014</span>  ...     G1        <span>1</span><br>TGTTACTGGCGATT<span>-8</span>  CD4+/CD25 T Reg     <span>1079</span>  ...      S        <span>0</span><br>TTCAGTACCGGGAA<span>-8</span>          CD19+ B     <span>1030</span>  ...      S        <span>4</span><br>TTGAGGTGGAGAGC<span>-8</span>        Dendritic     <span>1552</span>  ...     G1        <span>2</span><br></code></pre><p data-tool="mdnice编辑器">可以看出<strong>obs是一个关于存储细胞信息的地方</strong>，也许这样不太明显，我们再贴一张图进一步说明：</p><p><img data-galleryid="" data-imgfileid="100035942" data-ratio="0.4603501544799176" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQuoKvictswxN8nfoGIrFjH1Lib6Gd9kyVyqt7Ow6HcA90WsqOOd6Q4cO3jE4Gibjj3k5tuXwGjQAaRg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="971" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQuoKvictswxN8nfoGIrFjH1Lib6Gd9kyVyqt7Ow6HcA90WsqOOd6Q4cO3jE4Gibjj3k5tuXwGjQAaRg/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">我们看红框这一列，存储所有样本的细胞。</p><p data-tool="mdnice编辑器">我们再来查看使用**read_text()**读取后的AnnData数据对象的obs信息：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#使用read_text()读取后的AnnData数据对象的obs信息</span><br>print(data_1.obs)<br></code></pre><p data-tool="mdnice编辑器"><strong>结果如下：</strong></p><p><img data-galleryid="" data-imgfileid="100035943" data-ratio="0.1919451585261354" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQuoKvictswxN8nfoGIrFjH19uE18FhCvU7oF3yOsL1m8GPhtXKG1CoWrBl0aW04XIkFlEUwwL2Bvg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1167" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQuoKvictswxN8nfoGIrFjH19uE18FhCvU7oF3yOsL1m8GPhtXKG1CoWrBl0aW04XIkFlEUwwL2Bvg/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">这时，聪明的你是不是已经发现了不同之处，恭喜你，已经看到了<strong>大坑</strong>，我们看红框里面的字样，这不就是一个个基因名称，基因信息怎么保存到存储细胞信息的地方了呀!</p><p data-tool="mdnice编辑器">我们再查看<strong>正常AnnData数据对象的var信息</strong>，继续往下走：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#查看正常AnnData数据对象的var信息</span><br>print(data_2.var)<br></code></pre><p data-tool="mdnice编辑器"><strong>结果如下：</strong></p><pre data-tool="mdnice编辑器"><span></span><code>            n_counts     means  dispersions  dispersions_norm  highly_variable<br>index                                                                         <br>HES4     <span>1153.387451</span>  <span>0.592365</span>     <span>2.028047</span>          <span>2.771764</span>             <span>True</span><br>TNFRSF4   <span>304.358154</span>  <span>0.193332</span>     <span>1.760724</span>          <span>2.746426</span>             <span>True</span><br>SSU72    <span>2530.272705</span>  <span>1.019981</span>     <span>1.208284</span>         <span>-0.631160</span>            <span>False</span><br>PARK7    <span>7451.664062</span>  <span>1.828078</span>     <span>1.288261</span>         <span>-0.544716</span>            <span>False</span><br>RBP7      <span>272.811035</span>  <span>0.174943</span>     <span>1.842789</span>          <span>3.192285</span>             <span>True</span><br>              ...       ...          ...               ...              ...<br>SUMO3    <span>2008.512939</span>  <span>0.878592</span>     <span>1.412841</span>          <span>0.174762</span>            <span>False</span><br>ITGB2    <span>7413.487793</span>  <span>1.823767</span>     <span>1.596550</span>         <span>-0.137714</span>            <span>False</span><br>S100B     <span>645.737549</span>  <span>0.373296</span>     <span>2.331789</span>          <span>5.554084</span>             <span>True</span><br>PRMT2    <span>2062.443848</span>  <span>0.894168</span>     <span>1.273153</span>         <span>-0.375588</span>            <span>False</span><br>MT-ND3   <span>1214.914185</span>  <span>0.615929</span>     <span>1.265916</span>         <span>-0.326537</span>            <span>False</span><br></code></pre><p data-tool="mdnice编辑器">可以看出<strong>var是一个关于存储基因信息的地方</strong>，也许这样不太明显，我们再贴一张图进一步说明：</p><p><img data-galleryid="" data-imgfileid="100035944" data-ratio="0.39824561403508774" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQuoKvictswxN8nfoGIrFjH1tonVBu2Jw437fvsHWrpjfNiabBpk1EYOPhAdsVic3WbVo3tQiaRWXjXRg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1140" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQuoKvictswxN8nfoGIrFjH1tonVBu2Jw437fvsHWrpjfNiabBpk1EYOPhAdsVic3WbVo3tQiaRWXjXRg/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">我们看这两个红框，可以看出<strong>var存储的是有关基因的信息</strong>。</p><p data-tool="mdnice编辑器">我们再查看使用<strong>read_text()<strong>读取后的AnnData数据对象的</strong>var信息</strong>，继续往下走：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#使用read_text()读取后的AnnData数据对象的var信息</span><br>print(data_1.var)<br></code></pre><p data-tool="mdnice编辑器"><strong>结果如下:</strong></p><p><img data-galleryid="" data-imgfileid="100035945" data-ratio="0.3219895287958115" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQuoKvictswxN8nfoGIrFjH1nmgRT62SicdU7zNhBZwcW1HzlicCGRHGY2FvzWxhTfWjCgkXm4xyGwqw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1146" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQuoKvictswxN8nfoGIrFjH1nmgRT62SicdU7zNhBZwcW1HzlicCGRHGY2FvzWxhTfWjCgkXm4xyGwqw/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">是不是有点怪呀？用来存储基因信息的地方却来存储细胞信息，这不是颠倒黑白吗？</p><p data-tool="mdnice编辑器">我们进入官网的<span>read_text()查看有没有相关介绍，地址：https://scanpy.readthedocs.io/en/latest/generated/scanpy.read_text.html#scanpy.read_text，</span>经过一番查找，没有相关具体信息说明呀！<strong>如果有知道的小伙伴，可以在留言区告诉下，在此谢过！</strong></p><p data-tool="mdnice编辑器"><strong>总结</strong></p><p data-tool="mdnice编辑器">正常AnnData数据对象的<strong>obs用来存储细胞信息</strong>，<strong>var用来存储基因信息</strong>。在使用<strong>scanpy的read_text()<strong>进行读取txt文件时，要注意了哦！你已经入坑了，</strong>这个函数会使用obs来存储基因信息</strong>，而<strong>用var来存储细胞信息</strong>，而造成阴阳颠倒，如果你使用这个颠倒的AnnData数据对象去进行后续的数据分析，那各种麻烦也会随之而来。</p><p data-tool="mdnice编辑器"><strong>注意：如果你使用的scanpy的其他的读取文件函数进行读取不同格式的文件，一定要小心了哦，一定要查看读取后Anndata的obs是不是存储细胞信息，var是不是存储基因信息！</strong></p><h4 data-tool="mdnice编辑器"><span></span><span><strong>"填坑"</strong></span><span></span></h4><p data-tool="mdnice编辑器">如果你也使用<strong>scanpy的read_text()<strong>这个函数来读取</strong>txt</strong>文件，或使用scanpy别的读文件函数读取别的格式文件，读取后的AnnData也<strong>出现上述的这种情况</strong>，别慌！既然有坑，当然要填坑了，继续往下走：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#填坑补救措施</span><br>data_1=data_1.T<br></code></pre><p data-tool="mdnice编辑器">这时的data_1就变成了<strong>一个正常的AnnData数据对象</strong>了。不信，我们可以查看一下它的<strong>obs</strong>，继续往下走：</p><pre data-tool="mdnice编辑器"><span></span><code>print(data_1.obs)<br></code></pre><p data-tool="mdnice编辑器"><strong>结果如下:</strong></p><pre data-tool="mdnice编辑器"><span></span><code>Columns: []<br>Index: [AAACCTGAGCGTTTAC-1, AAACCTGCAATCGGTT-1, AAACCTGCATACCATG-1, AAACCTGGTTCCACGG-1, AAACCTGTCACATGCA-1, AAACCTGTCACGCGGT-1, AAACCTGTCCAATGGT-1, AAACCTGTCCCTAACC-1, AAACGGGAGAGTACCG-1, AAACGGGAGCGATTCT-1, AAACGGGAGTCTCAAC-1, AAACGGGCATGCAACT-1, AAACGGGTCCGCAGTG-1, AAACGGGTCTAAGCCA-1, AAAGATGAGCAGACTG-1, AAAGATGAGTACGTAA-1, AAAGATGCATGCCTAA-1, AAAGATGGTTCAGTAC-1, AAAGCAAAGCATGGCA-1, AAAGCAAAGGCCCGTT-1, AAAGCAAGTCGACTAT-1, AAAGCAAGTTACGTCA-1, AAAGCAAGTTATGCGT-1, AAAGTAGAGACAATAC-1, AAAGTAGAGTGCGTGA-1, AAAGTAGCATCCGGGT-1, AAAGTAGTCAACGAAA-1, AAAGTAGTCGGAAACG-1, AAATGCCAGTCCGGTC-1, AAATGCCGTCCGTTAA-1, AAATGCCGTGTGCCTG-1, AAATGCCTCGAACGGA-1, AAATGCCTCGCCATAA-1, AACACGTAGAGTGACC-1, AACACGTAGTCGAGTG-1, AACACGTGTATCGCAT-1, AACCATGAGCCCAGCT-1, AACGTTGAGACAAAGG-1, AACGTTGAGACACGAC-1, AACGTTGCACAAGCCC-1, AACGTTGGTAGGACAC-1, AACGTTGGTAGGGACT-1, AACGTTGGTCTTCAAG-1, AACTCAGCAATAGAGT-1, AACTCAGCAGATAATG-1, AACTCAGGTCAGATAA-1, AACTCAGGTGCAGACA-1, AACTCCCAGAAGCCCA-1, AACTCCCAGACTAGAT-1, AACTCTTAGTGCGATG-1, AACTCTTCAGCTTCGG-1, AACTCTTCAGGACCCT-1, AACTCTTGTCAATGTC-1, AACTCTTGTGTAAGTA-1, AACTGGTAGATCCCAT-1, AACTGGTTCGTCGTTC-1, AACTGGTTCTAACGGT-1, AACTTTCAGAAACGCC-1, AACTTTCAGGGAACGG-1, AACTTTCAGTTAGGTA-1, AACTTTCGTGGACGAT-1, AACTTTCTCATCTGCC-1, AAGACCTAGATAGGAG-1, AAGACCTAGGCACATG-1, AAGACCTCAAGCCCAC-1, AAGACCTGTAGCTCCG-1, AAGACCTTCTACTCAT-1, AAGCCGCGTGAGCGAT-1, AAGCCGCTCGGAGGTA-1, AAGGAGCTCCAAAGTC-1, AAGGCAGGTAAATGAC-1, AAGGCAGGTACCCAAT-1, AAGGCAGGTACTCTCC-1, AAGGCAGGTGAGTATA-1, AAGGTTCAGAGGTACC-1, AAGGTTCAGGATCGCA-1, AAGGTTCGTTACAGAA-1, AAGGTTCGTTGCCTCT-1, AAGGTTCTCCGAGCCA-1, AAGTCTGAGCGTCAAG-1, AAGTCTGCATCGATGT-1, AAGTCTGGTGAACCTT-1, AATCCAGAGGTTACCT-1, AATCCAGAGTCAAGGC-1, AATCCAGCAGACTCGC-1, AATCCAGGTCCGTGAC-1, AATCCAGTCCGCGCAA-1, AATCCAGTCTCAAGTG-1, AATCGGTCAAGTCATC-1, AATCGGTCACGAAGCA-1, AATCGGTCATCCCACT-1, AATCGGTGTCTTCTCG-1, AATCGGTGTTCAGGCC-1, ACACCAAAGTGATCGG-1, ACACCAATCCATGAGT-1, ACACCAATCGCATGGC-1, ACACCAATCGGAAATA-1, ACACCCTAGGCTAGCA-1, ACACCCTAGTGTACGG-1, ACACCCTCACGTGAGA-1, ...]<br></code></pre><p data-tool="mdnice编辑器">可以看出<strong>obs存储的都是细胞信息</strong></p><p data-tool="mdnice编辑器">我们再来查看它的<strong>var信息</strong>，继续往下走：</p><pre data-tool="mdnice编辑器"><span></span><code>print(data_1.var)<br></code></pre><p data-tool="mdnice编辑器"><strong>结果如下：</strong></p><pre data-tool="mdnice编辑器"><span></span><code>Columns: []<br>Index: [MIR1302-10, FAM138A, OR4F5, RP11-34P13.7, RP11-34P13.8, AL627309.1, RP11-34P13.14, RP11-34P13.9, AP006222.2, RP4-669L17.10, OR4F29, RP4-669L17.2, RP5-857K21.15, RP5-857K21.1, RP5-857K21.2, RP5-857K21.3, RP5-857K21.4, RP5-857K21.5, OR4F16, RP11-206L10.3, RP11-206L10.5, RP11-206L10.4, RP11-206L10.2, RP11-206L10.9, AL669831.1, FAM87B, LINC00115, FAM41C, AL645608.2, RP11-54O7.16, RP11-54O7.1, RP11-54O7.2, RP11-54O7.3, SAMD11, AL645608.1, NOC2L, KLHL17, PLEKHN1, C1orf170, RP11-54O7.17, HES4, RP11-54O7.11, ISG15, AGRN, RP11-54O7.18, RNF223, C1orf159, RP11-465B22.5, RP11-465B22.8, TTLL10-AS1, TTLL10, TNFRSF18, TNFRSF4, SDF4, B3GALT6, FAM132A, RP5-902P8.12, UBE2J2, RP5-902P8.10, SCNN1D, ACAP3, PUSL1, CPSF3L, GLTPD1, TAS1R3, DVL1, MXRA8, AURKAIP1, CCNL2, RP4-758J18.2, MRPL20, RP4-758J18.13, ANKRD65, RP4-758J18.7, TMEM88B, RP4-758J18.10, VWA1, ATAD3C, ATAD3B, ATAD3A, TMEM240, SSU72, AL645728.1, C1orf233, RP11-345P4.9, MIB2, MMP23B, CDK11B, RP11-345P4.10, SLC35E2B, RP11-345P4.7, CDK11A, SLC35E2, NADK, GNB1, RP1-140A9.1, CALML6, TMEM52, C1orf222, RP11-547D24.1, ...]<br></code></pre><p data-tool="mdnice编辑器">可以看出<strong>var存储的都是基因信息</strong></p><p data-tool="mdnice编辑器">哈哈，我们通过"补救措施"把它变成了一个正常的AnnData数据对象了。</p><p data-tool="mdnice编辑器">如果你在使用scanpy的读文件函数要注意哦，<strong>一定要先查看obs和var存储的是什么</strong>！如果出现我们所述的这种情况，可以通过"<strong>填坑补救措施</strong>"，把它变成一个正常AnnData数据对象哦！</p><p data-tool="mdnice编辑器"><strong>我是一只单细胞小菜鸡，如果有哪些地方讲的不好或做的不好，欢迎在下方留言批评指出和纠正！您的指正是我们更新和完善的动力源泉！</strong></p><p data-tool="mdnice编辑器">春节临近，在此祝贺：</p><p data-tool="mdnice编辑器"><strong>各位老板2024年，发！发！发！天天发大财！</strong></p><p data-tool="mdnice编辑器"><strong>各位小伙伴2024年，发！发！发！天天发SCI！</strong></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/UVTFumVv2R6u3FzPQp_gZg",target="_blank" rel="noopener noreferrer">原文链接</a>
