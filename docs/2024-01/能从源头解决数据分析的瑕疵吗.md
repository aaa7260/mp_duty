---
title: "能从源头解决数据分析的瑕疵吗"
date: 2024-01-20T18:42:39Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
能从源头解决数据分析的瑕疵吗 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>前面我们在推文：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247527859&amp;idx=1&amp;sn=f4dd19d99f1110c5552b8d978a7b82b3&amp;scene=21#wechat_redirect" data-linktype="2">数据分析有错误并不可怕，造假才不可饶恕</a> 提到了这个新鲜出炉（ 2023年12月5日）的cell期刊的文章单细胞转录组数据分析环节是有一些瑕疵的。</p></blockquote><p data-tool="mdnice编辑器">首先是在 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247527870&amp;idx=1&amp;sn=19c771655d4806f27d38f9b4d872b262&amp;scene=21#wechat_redirect" data-linktype="2">单细胞水平这样的细胞比例变化可靠吗</a> 已经提到了两个分组的单细胞亚群比例变化问题，很大程度上受到了离群点的影响。另外就是总体上这个cell期刊的文章的降维聚类分群后的拿到的各个亚群的特异性高表达量的基因列表就不常见，但是如果仅仅是使用作者提供的矩阵文件那么就很难搞清楚问题出在哪里，所以我们还是从单细胞转录组的测序数据开始：</p><ul data-tool="mdnice编辑器"><li><section>https://www.ncbi.nlm.nih.gov/bioproject/PRJNA856132</section></li><li><section>https://ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE207546</section></li></ul><p data-tool="mdnice编辑器">可以看到，里面确实是15个样品，分别是常规转录组，单细胞转录组，以及空间单细胞转录组，如下所示：</p><ol data-tool="mdnice编辑器"><li><section>单细胞核转录组的6个小鼠样品，sn-seq: two exprimental groups: normal and EO771-VM-bearing mice, 3 independent replicates with 5 mice per group in each replicate.</section></li><li><section>空间单细胞转录组的3个样品，ST, 3 brain sections from 3 EO771-VM mice.</section></li><li><section>人类细胞系的6个样品，RNA-seq: human choroid plexus epithelial cell line (HCPEpiC) treated with or without tryptase (3 independent replicates per group).</section></li></ol><p data-tool="mdnice编辑器">下面的内容会涉及到：</p><ul data-tool="mdnice编辑器"><li><section>学习cellranger的定量流程</section></li><li><section>从零开始在自己的服务器安装软件</section></li><li><section>下载测序数据</section></li><li><section>走流程</section></li></ul><h3 data-tool="mdnice编辑器"><span></span>cellranger的定量流程详解：<span></span></h3><blockquote data-tool="mdnice编辑器"><p>正常走cellranger的定量流程即可，代码我已经是多次分享了。参考：</p></blockquote><ul data-tool="mdnice编辑器"><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247512340&amp;idx=3&amp;sn=1b9609a8870a0209dd27ffdcbc3cac87&amp;chksm=9b4bf1afac3c78b90674678fcec66365b9faaa275ff4b0a2255e0a05fa8b905e15222a643bea&amp;scene=21#wechat_redirect" data-linktype="2">10X单细胞转录组原始测序数据的Cell Ranger流程（仅需800元）</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247496813&amp;idx=1&amp;sn=4151bf2265618eff4e0123722c50e569&amp;scene=21#wechat_redirect" data-linktype="2">10X的单细胞转录组原始数据也可以在EBI下载</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247510920&amp;idx=1&amp;sn=c4561d34e984406693c014cdfe236c0f&amp;chksm=9b4beb33ac3c622542d894344c323ff7cca52f69119d02fc7aa4636af0cbe7df4b6c63dd5ba9&amp;scene=21#wechat_redirect" data-linktype="2">一个10x单细胞转录组项目从fastq到细胞亚群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513565&amp;idx=1&amp;sn=092e637017d176c43f00a295d3210592&amp;scene=21#wechat_redirect" data-linktype="2">一文打通单细胞上游：从软件部署到上游分析</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513605&amp;idx=1&amp;sn=e86a329c887745c6d00d3ededa39dcda&amp;chksm=9b4bf6beac3c7fa8523cef4e7189fb20b914460ddb61e6cd1dd520b5928e1b59a8b7827ce783&amp;scene=21#wechat_redirect" data-linktype="2">PRJNA713302这个10x单细胞fastq实战</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513968&amp;idx=1&amp;sn=f5a44a7bea0bdacd8af1a20c177763e5&amp;scene=21#wechat_redirect" data-linktype="2">一次曲折且昂贵的单细胞公共数据获取与上游处理</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514146&amp;idx=1&amp;sn=b9721433d49a2d963eeaab1ad47fc91b&amp;scene=21#wechat_redirect" data-linktype="2">只能下载bam文件的10x单细胞转录组项目数据处理</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247511452&amp;idx=2&amp;sn=83ec97cbc3334a6095e6d63e05e9fd6e&amp;scene=21#wechat_redirect" data-linktype="2">不知道10x单细胞转录组样品和fastq文件的对应关系</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247508521&amp;idx=2&amp;sn=2cf3158e74d37b3a741908d8bfc8f02f&amp;scene=21#wechat_redirect" data-linktype="2">10X单细胞转录组测序数据的 SRA转fastq踩坑那些事</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514395&amp;idx=2&amp;sn=96c505b76ae87dd0efa737c4c44e2270&amp;scene=21#wechat_redirect" data-linktype="2">10x的单细胞转录组fastq文件的R1和R2不能弄混哦</a></section></li></ul><p data-tool="mdnice编辑器">差不多几个小时就可以完成全部的样品的cellranger的定量流程。基础知识非常重要，我们在单细胞天地多次分享过<strong>cellranger</strong>流程的笔记（2019年5月），大家可以自行前往学习，如下：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484146&amp;idx=1&amp;sn=16e09b82d048eed1ff6100b22970abd5&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(一)数据下载</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484179&amp;idx=1&amp;sn=fe84f5243a6021fe6afea128e3ac273a&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(二) cell ranger使用前注意事项</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484206&amp;idx=1&amp;sn=edeebbdd092f79361aee87e9ce086d80&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(三) Cell Ranger使用初探</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484355&amp;idx=1&amp;sn=7860fe0c46073a55d2d3700822c3103b&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(四) Cell Ranger流程概览</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484402&amp;idx=1&amp;sn=95c2be0dc6499e4b1eb9a91d79e584d1&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(五) 理解cellranger count的结果</a></section></li></ul><h3 data-tool="mdnice编辑器"><span></span>安装自己的conda<span></span></h3><p data-tool="mdnice编辑器">在自己的服务器里面自己下载并且安装自己的conda，自己配置哈：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 首先下载文件，20M/S的话需要几秒钟即可</span><br>wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh<br><span># Miniconda3-latest-Linux-x86_64.sh 135.1 MiB 2023-12-21 09:23</span><br><span># wget https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-latest-Linux-x86_64.sh</span><br><span># 如果比较慢就切换镜像哦</span><br><br><span># 接下来使用bash命令来运行我们下载的文件，记得是一路yes下去</span><br>bash Miniconda3-latest-Linux-x86_64.sh <br><span>#  上面的bash命令安装成功后,需要更新系统环境变量文件</span><br><span>source</span> ~/.bashrc<br></code></pre><p data-tool="mdnice编辑器">首先如果是在中国大陆，需要设置好镜像：</p><pre data-tool="mdnice编辑器"><span></span><code>conda config --add channels https://mirrors.bfsu.edu.cn/anaconda/cloud/bioconda/<br>conda config --add channels https://mirrors.bfsu.edu.cn/anaconda/cloud/conda-forge/<br>conda config --add channels https://mirrors.bfsu.edu.cn/anaconda/pkgs/free/<br>conda config --add channels https://mirrors.bfsu.edu.cn/anaconda/pkgs/main/<br>conda config --<span>set</span> show_channel_urls yes <br></code></pre><p data-tool="mdnice编辑器">然后就可以使用自己的conda来安装 kingfisher 软件：</p><pre data-tool="mdnice编辑器"><span></span><code>conda install mamba<br>mamba create -n kingfisher python=3.8<br>mamba init<br>mamba list<br><span># 重启terminal：</span><br>mamba activate kingfisher<br>mamba install -c bioconda kingfisher<br></code></pre><p data-tool="mdnice编辑器">然后就一行代码下载数据</p><pre data-tool="mdnice编辑器"><span></span><code>kingfisher get -p PRJNA853539  -m ena-ascp ena-ftp prefetch aws-http<br></code></pre><p data-tool="mdnice编辑器">另外，值得注意的是，因为上面的代码耗时很久，一般来说需要使用nohup包裹一下，或者说开启screen命令。</p><h3 data-tool="mdnice编辑器"><span></span>使用kingfisher下载测序数据<span></span></h3><p data-tool="mdnice编辑器">因为我们前面拿到了测序数据相关信息：</p><ul data-tool="mdnice编辑器"><li><section>https://www.ncbi.nlm.nih.gov/bioproject/PRJNA856132</section></li><li><section>https://ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE207546</section></li></ul><p data-tool="mdnice编辑器">所以我们本次的一行代码下载数据应该是如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>kingfisher get -p PRJNA856132  -m ena-ascp ena-ftp prefetch aws-http<br></code></pre><p data-tool="mdnice编辑器">但是因为这个代码过于简单，所以它其实是在某些场合会报错，比如这个数据集就是里面有人类和小鼠数据混搭，而且人类细胞系数据呢在ena数据库里面并没有，但是在ncbi的sra数据库是有的！所以其实是可以分开下载，比如我们首先挑选小鼠数据，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 首先获取项目的全部的样品测序信息 </span><br>kingfisher  annotate -p PRJNA856132 -f csv --all-column -o ./annotate_info.csv<br><span># 从里面挑选出来小鼠相关的数据</span><br>$cat annotate_info.csv |awk -<span>F</span> <span>","</span> <span>'NR&gt;1{if($8=="Mus musculus"){print $1 "\t" $8}}'</span><br>SRR19996402     Mus musculus<br>SRR19996403     Mus musculus<br>SRR19996404     Mus musculus<br>SRR19996405     Mus musculus<br>SRR19996406     Mus musculus<br>SRR19996407     Mus musculus<br>SRR19996408     Mus musculus<br><br>cat annotate_info.csv |awk -<span>F</span> <span>","</span> <span>'NR&gt;1{if($8=="Mus musculus"){print $1 "\t" $8}}'</span>|cut -f <span>1</span> &gt; SRR_list.txt<br><br>screen -r kinf<br>/usr/bin/time -v kingfisher get --run-identifiers-list ./sample_info/SRR_list.txt -m ena-ascp ena-ftp prefetch --download-threads <span>10</span> --check-md5sums <span>1</span>&gt;down_srr_list.log <span>2</span>&gt;&amp;<span>1</span><br></code></pre><p data-tool="mdnice编辑器">这样的话，开启screen命令后，就可以使用kingfisher慢慢的下载我们的所需要的小鼠相关测序数据啦。</p><p data-tool="mdnice编辑器">如下所示的全部的测序的fq文件：</p><pre data-tool="mdnice编辑器"><span></span><code>ls -lh SRR*gz |cut -d<span>" "</span> -f 5- |head -20<br>  15G 1月  12 18:20 SRR19996402_1.fastq.gz<br>  17G 1月  12 18:31 SRR19996402_2.fastq.gz<br>  21G 1月  14 12:36 SRR19996403_1.fastq.gz<br>  26G 1月  14 12:54 SRR19996403_2.fastq.gz<br>  14G 1月  14 18:23 SRR19996404_1.fastq.gz<br>  15G 1月  14 18:32 SRR19996404_2.fastq.gz<br> 511M 1月  12 19:24 SRR19996405_1.fastq.gz<br> 320M 1月  12 19:25 SRR19996405_2.fastq.gz<br> 572M 1月  12 19:29 SRR19996406_1.fastq.gz<br> 359M 1月  12 19:30 SRR19996406_2.fastq.gz<br> 644M 1月  14 17:09 SRR19996407_1.fastq.gz<br> 554M 1月  14 17:10 SRR19996407_2.fastq.gz<br> 528M 1月  12 19:34 SRR19996408_1.fastq.gz<br> 453M 1月  12 19:34 SRR19996408_2.fastq.gz<br> 624M 1月  12 19:36 SRR19996409_1.fastq.gz<br> 415M 1月  12 19:37 SRR19996409_2.fastq.gz<br> 595M 1月  12 19:38 SRR19996410_1.fastq.gz<br> 396M 1月  12 19:39 SRR19996410_2.fastq.gz<br> 1.2G 1月  12 19:43 SRR19996411_1.fastq.gz<br> 880M 1月  12 19:44 SRR19996411_2.fastq.gz<br> ........ ........ ........ ........ ........<br></code></pre><h3 data-tool="mdnice编辑器"><span></span>cellranger的定量流程首先需要合理的文件名字<span></span></h3><p data-tool="mdnice编辑器">上面下载的全部的测序的fq文件名字是srr开头的，我们样品名字是gsm开头的， 两码事，需要有对应关系！一个简单的Linux命令就可以获取他们的对应关系</p><pre data-tool="mdnice编辑器"><span></span><code> cat annotate_info.csv |awk -F <span>","</span> <span>'NR&gt;1{if($8=="Mus musculus"){print $1 "\t" $10}}'</span> |awk -F <span>"\t|:|;"</span> <span>'{print $1 "\t" $2 "\t"$3}'</span> <br>SRR19996402     GSM6294364       ST3<br>SRR19996403     GSM6294363       ST2<br>SRR19996404     GSM6294362       ST1<br>SRR19996405     GSM6294361       treatment3<br>SRR19996406     GSM6294361       treatment3<br>SRR19996407     GSM6294358       normal3<br>SRR19996408     GSM6294358       normal3<br>SRR19996409     GSM6294360       treatment2<br>SRR19996410     GSM6294360       treatment2<br>SRR19996411     GSM6294360       treatment2<br> ........ ........ ........<br></code></pre><p data-tool="mdnice编辑器">有了这样的对应关系，就比较好改名啦，如果你熟悉10x单细胞转录组数据，就知道：</p><ul data-tool="mdnice编辑器"><li><section>首先，1-26个cycle就是测序得到了26个碱基，先是16个Barcode碱基，然后是10个UMI碱基；通常是R1文件</section></li><li><section>然后，27-34这8个cycle得到了8个碱基，就是i7的sample index；通常是I1文件</section></li><li><section>最后35-132个cycle得到了98个碱基，就是转录本reads（目前很多测序仪都是150bp了），通常是R2文件</section></li></ul><p data-tool="mdnice编辑器">也就是说R2 文件是真正的测序reads，肯定是文件比较大哦，但是我们前面看到的r1和r2文件其实很难看出来文件大小差距，因为里面的测序数据并没有被切除成为规定的碱基长度，这个并不会影响我们的cellranger的定量流程。</p><p data-tool="mdnice编辑器">因为每一个gsm的样品会对应多个srr的id编号，所以这个文件名修改会比较复杂。我们这里直接给大家最终代码让大家看看，其中的两个gsm的样品如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><span>$cat</span> change_R1.sh <br>ln -s SRR19996442_1.fastq.gz GSM6294356_normal1_S1_L001_R1_001.fastq.gz<br>ln -s SRR19996443_1.fastq.gz GSM6294356_normal1_S2_L001_R1_001.fastq.gz<br>ln -s SRR19996444_1.fastq.gz GSM6294356_normal1_S3_L001_R1_001.fastq.gz<br>ln -s SRR19996445_1.fastq.gz GSM6294356_normal1_S4_L001_R1_001.fastq.gz<br>ln -s SRR19996446_1.fastq.gz GSM6294356_normal1_S5_L001_R1_001.fastq.gz<br>ln -s SRR19996447_1.fastq.gz GSM6294356_normal1_S6_L001_R1_001.fastq.gz<br>ln -s SRR19996448_1.fastq.gz GSM6294356_normal1_S7_L001_R1_001.fastq.gz<br>ln -s SRR19996449_1.fastq.gz GSM6294356_normal1_S8_L001_R1_001.fastq.gz<br><br>ln -s SRR19996431_1.fastq.gz GSM6294357_normal2_S1_L001_R1_001.fastq.gz<br>ln -s SRR19996432_1.fastq.gz GSM6294357_normal2_S2_L001_R1_001.fastq.gz<br>ln -s SRR19996433_1.fastq.gz GSM6294357_normal2_S3_L001_R1_001.fastq.gz<br>ln -s SRR19996434_1.fastq.gz GSM6294357_normal2_S4_L001_R1_001.fastq.gz<br>ln -s SRR19996435_1.fastq.gz GSM6294357_normal2_S5_L001_R1_001.fastq.gz<br>ln -s SRR19996450_1.fastq.gz GSM6294357_normal2_S6_L001_R1_001.fastq.gz<br>ln -s SRR19996451_1.fastq.gz GSM6294357_normal2_S7_L001_R1_001.fastq.gz<br>ln -s SRR19996452_1.fastq.gz GSM6294357_normal2_S8_L001_R1_001.fastq.gz<br> <br></code></pre><p data-tool="mdnice编辑器">可以看到这些id对应关系并不是顺序编号的，具体大家可以各显神通，自己摸索这个过程哈 。</p><h3 data-tool="mdnice编辑器"><span></span>然后正常配置cellranger的定量流程<span></span></h3><p data-tool="mdnice编辑器">理论上应该是去10x的官网下载cellranger软件和数据库文件，不过我们的共享服务器已经给大家准备了，在 /home/data/refdir/10x 文件夹里面：</p><pre data-tool="mdnice编辑器"><span></span><code>ls -lh  /home/data/refdir/10x |cut -d<span>" "</span> -f 5-<br><br>391M 8月   8  2022 cellranger-6.0.1.tar.gz<br> 11G 8月   7  2022 refdata-gex-GRCh38-2020-A.tar.gz<br>9.9G 8月   7  2022 refdata-gex-GRCh38-and-mm10-2020-A.tar.gz<br>9.7G 8月   7  2022 refdata-gex-mm10-2020-A.tar.gz<br></code></pre><p data-tool="mdnice编辑器">在Linux中，你可以使用<code>tar</code>命令来解压一个<code>.tar.gz</code>文件，并将解压后的文件放到指定的文件夹。以下是具体的命令：</p><pre data-tool="mdnice编辑器"><span></span><code>tar -xzvf file.tar.gz -C /path/to/directory<br></code></pre><p data-tool="mdnice编辑器">在这个命令中：</p><ul data-tool="mdnice编辑器"><li><section><code>x</code>代表解压</section></li><li><section><code>z</code>代表gzip，表示文件是gzip格式的，需要进行解压</section></li><li><section><code>v</code>代表verbose，表示显示详细的解压过程</section></li><li><section><code>f</code>代表file，表示后面跟的是要解压的文件名</section></li><li><section><code>-C</code>代表change to directory，表示解压后的文件将被放到后面指定的目录</section></li></ul><p data-tool="mdnice编辑器">请将<code>file.tar.gz</code>替换为你的文件名，将<code>/path/to/directory</code>替换为你想要放置解压后文件的目录。</p><p data-tool="mdnice编辑器">那么，我们的命令就是：</p><pre data-tool="mdnice编辑器"><span></span><code>mkdir raw run soft <br>mv *gz raw<br>tar -xzvf /home/data/refdir/10x/cellranger-6.0.1.tar.gz  -C ./soft<br>tar -xzvf /home/data/refdir/10x/refdata-gex-mm10-2020-A.tar.gz  -C ./soft<br></code></pre><p data-tool="mdnice编辑器">值得注意的是<code>cellranger</code>是一直在更新的，所以推荐去官网下载最新版，这里<code>cellranger</code>的下载链接会失效 ，需要去官网获取：https://support.10xgenomics.com/single-cell-gene-expression/software/downloads/latest</p><p data-tool="mdnice编辑器">有了10x的官网下载cellranger软件和数据库文件，以及前面的kingfisher下载了的小鼠的6个样品的10x技术单细胞转录组上游测序数据，接下来就可以跑cellranger啦，因为是共享服务器，如果不着急的话，可以一个个样品慢慢跑代码。也可以5个样品一起运行：</p><pre data-tool="mdnice编辑器"><span></span><code>ref=../soft/refdata-gex-mm10-2020-A/<br>cellranger=../soft/cellranger-7.1.0/cellranger<br><span># ls GSM*.fastq.gz</span><br>ls ../raw/*gz|cut -d<span>"_"</span> -f 1 |sort -u|cut -d<span>"/"</span> -f 3 | cut -d <span>"_"</span> -f 1 | uniq | <span>while</span> <span>read</span> id;<span>do</span><br>nohup <span>$cellranger</span> count --id=<span>$id</span> \<br>--transcriptome=<span>$ref</span> \<br>--fastqs=../raw \<br>--sample=<span>$id</span> \<br>--nosecondary \<br>--localcores=4 \<br>--localmem=30 &amp;<br><span>done</span><br></code></pre><p data-tool="mdnice编辑器">因为是5个样品一起运行，所以每个样品耗时三五个小时，合起来也是四五个小时就足够啦。虽然说5个样品一起运行会很快，但是大家的CPU和内存可能会不够，如果是共享服务器或者云服务器，另外一个门槛是硬盘。。。。</p><p data-tool="mdnice编辑器">有可能是硬盘也不够哦。。。。如果是这样的话，上面的代码大家千万不要添加 nohup  ，应该是把上面的代码写入脚本后一个个运行。然后简单的整理一下结果矩阵和报表即可：</p><pre data-tool="mdnice编辑器"><span></span><code>pro=outputs<br>pro_folder=<span>$pro</span><br>mkdir -p <span>$pro_folder</span><br>ls -lh  <span>$pro_folder</span><br> <br>mkdir -p <span>$pro_folder</span>/html <br>ls */outs/web_summary.html |<span>while</span> <span>read</span> id;<span>do</span> (cp <span>$id</span> <span>$pro_folder</span>/html/<span>${id%%/*}</span>.html );<span>done</span><br><br>mkdir -p <span>$pro_folder</span>/matrix <br>ls -d */outs/filtered_feature_bc_matrix |<span>while</span> <span>read</span> id;<span>do</span> (cp -r  <span>$id</span> <span>$pro_folder</span>/matrix/<span>${id%%/*}</span> );<span>done</span><br></code></pre><p data-tool="mdnice编辑器">很容易拿到了小鼠的6个样品的10x技术单细胞转录组上游定量后的表达量矩阵文件和报表，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>$ tree -h PRJNA856132_outs/<br>PRJNA856132_outs/<br>├── [4.0K]  html<br>│   ├── [3.2M]  GSM6294356_normal1.html<br>│   ├── [3.2M]  GSM6294357_normal2.html<br>│   ├── [3.0M]  GSM6294358_normal3.html<br>│   ├── [2.7M]  GSM6294359_treatment1.html<br>│   ├── [2.6M]  GSM6294360_treatment2.html<br>│   └── [2.9M]  GSM6294361_treatment3.html<br>├── [4.0K]  matrix<br>│   ├── [4.0K]  GSM6294356_normal1<br>│   │   ├── [ 20K]  barcodes.tsv.gz<br>│   │   ├── [284K]  features.tsv.gz<br>│   │   └── [ 11M]  matrix.mtx.gz<br>│   ├── [4.0K]  GSM6294357_normal2<br>│   │   ├── [ 23K]  barcodes.tsv.gz<br>│   │   ├── [284K]  features.tsv.gz<br>│   │   └── [ 16M]  matrix.mtx.gz<br>│   ├── [4.0K]  GSM6294358_normal3<br>│   │   ├── [ 21K]  barcodes.tsv.gz<br>│   │   ├── [284K]  features.tsv.gz<br>│   │   └── [ 12M]  matrix.mtx.gz<br>│   ├── [4.0K]  GSM6294359_treatment1<br>│   │   ├── [ 24K]  barcodes.tsv.gz<br>│   │   ├── [284K]  features.tsv.gz<br>│   │   └── [8.5M]  matrix.mtx.gz<br>│   ├── [4.0K]  GSM6294360_treatment2<br>│   │   ├── [ 14K]  barcodes.tsv.gz<br>│   │   ├── [284K]  features.tsv.gz<br>│   │   └── [2.5M]  matrix.mtx.gz<br>│   └── [4.0K]  GSM6294361_treatment3<br>│       ├── [ 20K]  barcodes.tsv.gz<br>│       ├── [284K]  features.tsv.gz<br>│       └── [4.3M]  matrix.mtx.gz<br>└── [ 61M]  PRJNA856132_outs.tar.gz<br><br>8 directories, 25 files<br></code></pre><p data-tool="mdnice编辑器">接下来我们就可以针对这个文件夹（PRJNA856132_outs/matrix ）走我们的单细胞转录组降维聚类分群流程啦。</p><h3 data-tool="mdnice编辑器"><span></span>先看看定量结果<span></span></h3><p data-tool="mdnice编辑器">并不是说每个样品质量都不行，起码这个 GSM6294356_normal1 还算是勉强可以的，虽然说中位数的基因确实是有点寒碜，以及右边的曲线真的是一言难尽啊：</p><p><img data-cropselx1="0" data-cropselx2="558" data-cropsely1="0" data-cropsely2="358" data-galleryid="" data-imgfileid="100044250" data-ratio="0.6407407407407407" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyia3WWnIicgboFAnfJric3RY2s8XyWiaVsDibRHLgCMfbaJczq3QOxAQh5u8EudFveVJzIxiaos3bcIM7Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyia3WWnIicgboFAnfJric3RY2s8XyWiaVsDibRHLgCMfbaJczq3QOxAQh5u8EudFveVJzIxiaos3bcIM7Q/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>GSM6294356_normal1 还算是勉强可以的</figcaption></figure><p data-tool="mdnice编辑器">那么， 质量差的能到什么程度呢？让我们来看看这个GSM6294361_treatment3样品吧，我都不能理解，看到了这样的数据分析报表难道不应该是直接放弃这批样品吗？</p><p><img data-galleryid="" data-imgfileid="100044250" data-ratio="0.6416666666666667" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyia3WWnIicgboFAnfJric3RY2dSBK818NzrwP1IEBiciaksfLSLVKWLJbWcJicym6d19bUmOEwqrdD8dDA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyia3WWnIicgboFAnfJric3RY2dSBK818NzrwP1IEBiciaksfLSLVKWLJbWcJicym6d19bUmOEwqrdD8dDA/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>难道不应该是直接放弃这批样品</figcaption></figure><p data-tool="mdnice编辑器">如果这个新鲜出炉（ 2023年12月5日）的cell期刊的文章，需要靠这样的质量堪忧的单细胞转录组数据，那么它里面的生物学结论真的是值得信赖吗？</p><h3 data-tool="mdnice编辑器"><span></span>再次求助神通广大的网友们<span></span></h3><p data-tool="mdnice编辑器"><strong>文章的数据都是公开的，我相信对大家来说处理起来并不难，我们应该是抱着求知若渴的态度认真剖析一些这个单细胞转录组数据</strong>吧：</p><ul data-tool="mdnice编辑器"><li><section>https://www.ncbi.nlm.nih.gov/bioproject/PRJNA856132</section></li><li><section>https://ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE207546</section></li></ul><p data-tool="mdnice编辑器">我现在有了自己定量的单细胞转录组表达量矩阵文件（来源于PRJNA856132），也有了作者给出来的表达量矩阵文件（来源于GSE207546），接下来我们就把这两个结果都各自独立的分析去看看是否有什么冲突吧。</p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/tQ29T-eEMgFjZ2ryNkTW6A",target="_blank" rel="noopener noreferrer">原文链接</a>
