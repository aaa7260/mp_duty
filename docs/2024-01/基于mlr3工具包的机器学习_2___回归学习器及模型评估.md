---
title: "基于mlr3工具包的机器学习（2）——回归学习器及模型评估"
date: 2024-01-15T14:00:56Z
draft: ["false"]
tags: [
  "fetched",
  "R语言学堂"
]
categories: ["Acdemic"]
---
基于mlr3工具包的机器学习（2）——回归学习器及模型评估 by R语言学堂
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><strong><span>专注</span></strong><span><strong><span>系列化</span></strong></span><strong><span>、</span></strong><span><strong><span>高质量</span></strong></span><strong><span>的R语言教程</span></strong></p><p data-tool="mdnice编辑器"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2MjU1NjQ4NQ==&amp;mid=2247504509&amp;idx=1&amp;sn=6fd600fe0fdfbe5f0a5a174b2f9a3427&amp;chksm=ce048a57f973034178679b70da3110e49829627007bb84fade1b319b7abbec37172cb88f2633&amp;scene=21#wechat_redirect" textvalue="推文索‍引" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>推文索引</span></a><span> | <a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2MjU1NjQ4NQ==&amp;mid=2247490868&amp;idx=1&amp;sn=181032ee65a5ce5c9595530cceabcb8c&amp;chksm=ce07451ef970cc08dc75ed55c295e2f6ecd6c327199fe99fc3a041a597b8dece8b3a9860fc92&amp;scene=21#wechat_redirect" textvalue="联系小编" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2">联系小编</a> | <a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2MjU1NjQ4NQ==&amp;mid=2247503266&amp;idx=1&amp;sn=e43cfe33776bfc956d6f822aba8b95b0&amp;chksm=ce049588f9731c9e7a8489c13d5484fa81a60923e240e98a759d0388ad4b140607948d25b409&amp;scene=21#wechat_redirect" textvalue="咨询服务" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">咨询服务</a></span></p><hr data-tool="mdnice编辑器"></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">本系列已发推文：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=Mzg2MjU1NjQ4NQ==&amp;mid=2247500304&amp;idx=1&amp;sn=95c0e09a705ccafce25b626b672d06a5&amp;scene=21#wechat_redirect" data-linktype="2">基于mlr3工具包的机器学习（1）——数据、模型、训练、预测</a></section></li></ul><p data-tool="mdnice编辑器">本系列的上篇推文已经是很久之前推送的了，建议读者先复习下上篇推文再开始本篇推文的学习。</p><p data-tool="mdnice编辑器">本篇推文的参考资料：</p><ul data-tool="mdnice编辑器"><li><section>https://mlr3book.mlr-org.com/chapters/chapter2/data_and_basic_modeling.html</section></li></ul><p data-tool="mdnice编辑器">本篇目录如下：</p><ul><li><p>0 引言</p></li><li><p>1 回归学习器</p></li><ul><li><p>1.1 基线学习器</p></li><li><p>1.2 超参数</p></li><li><p>1.3 回归树学习器</p></li><li><p>1.4 其他回归学习器</p></li></ul><li><p>2 模型评估</p></li><ul><li><p>2.1 评估指标</p></li><li><p>2.2 回归学习的评估指标</p></li><li><p>2.3 时间评估指标</p></li></ul></ul><p data-tool="mdnice编辑器"><br></p><h2 data-tool="mdnice编辑器"><span></span><span>0 引言</span></h2><p data-tool="mdnice编辑器">在监督学习里，既有“目标”变量（target，相当于因变量），也有“特征”变量（feature，相当于自变量）。目标变量可以监督学习效果的好坏。“回归”和“分类”是监督学习的两大类。</p><p data-tool="mdnice编辑器">上篇推文已经介绍，<code>mlr3</code>有一系列的拓展包，但它本身只包含一些比较基础的功能，只有6个简单的学习器：</p><pre data-tool="mdnice编辑器"><code><span>library</span>(mlr3)<br><br>mlr_learners<br><span>## classif.debug</span><br><span>## classif.featureless</span><br><span>## classif.rpart</span><br><span>## regr.debug,</span><br><span>## regr.featureless</span><br><span>## regr.rpart</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>1 回归学习器</span></h2><p data-tool="mdnice编辑器">创建学习任务：</p><pre data-tool="mdnice编辑器"><code>task = as_task_regr(mtcars, target = <span>"mpg"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span></span><span>1.1 基线学习器</span><span></span></h3><p data-tool="mdnice编辑器">对于回归学习来说，最“差”的方法就是直接取目标变量的均值作为预测值。这种方法不需要特征变量，对应上述6种学习器中的<code>regr.featureless</code>，即基线学习器（baseline learners）：</p><pre data-tool="mdnice编辑器"><code>learn = lrn(<span>"regr.featureless"</span>)<br></code></pre><p data-tool="mdnice编辑器">为了能评价学习效果，需要将数据分为训练集和测试集。<code>partition()</code>函数默认将数据的67%作为训练集（参数<code>ratio = 0.67</code>），剩余33%作为测试集，并保持目标变量在训练集和测试集中的分布类似（参数<code>stratify = TRUE</code>）：</p><pre data-tool="mdnice编辑器"><code>set.seed(<span>0115</span>)<br>spilt = partition(task)<br><br>spilt<br><span>## $train</span><br><span>##  [1]  2  5  9 10 21 25 27 30 32  6 12 13 14 16 22 23 24 31 20 26 28</span><br><span>## </span><br><span>## $test</span><br><span>##  [1]  1  3  4  8  7 11 15 17 29 18 19</span><br></code></pre><p data-tool="mdnice编辑器">训练：</p><pre data-tool="mdnice编辑器"><code>learn$train(task = task, row_ids = spilt$train)<br></code></pre><p data-tool="mdnice编辑器">测试：</p><pre data-tool="mdnice编辑器"><code>learn$predict(task, spilt$test)<br><span>## &lt;PredictionRegr&gt; for 11 observations:</span><br><span>##     row_ids truth response</span><br><span>##           1  21.0 19.88095</span><br><span>##           3  22.8 19.88095</span><br><span>##           4  21.4 19.88095</span><br><span>## ---                       </span><br><span>##          29  15.8 19.88095</span><br><span>##          18  32.4 19.88095</span><br><span>##          19  30.4 19.88095</span><br></code></pre><blockquote data-tool="mdnice编辑器"><span></span><ul><li><section>测试结果中，<code>row_ids</code>是测试样本在原数据中的行号，<code>truth</code>是目标变量的真实值，<code>response</code>是目标变量预测值。</section></li></ul><span></span></blockquote><p data-tool="mdnice编辑器">完整代码：</p><pre data-tool="mdnice编辑器"><code>task = as_task_regr(mtcars, target = <span>"mpg"</span>)<br>learn = lrn(<span>"regr.featureless"</span>)<br><br>set.seed(<span>0115</span>)<br>spilt = partition(task)<br><br>learn$train(task = task, row_ids = spilt$train)<br>learn$predict(task, spilt$test)<br></code></pre><p data-tool="mdnice编辑器">如前所述，基线学习器直接使用目标变量的均值作为预测变量，因此测试集的所有预测结果都是训练集的目标变量均值：</p><pre data-tool="mdnice编辑器"><code>mean(mtcars$mpg[spilt$train])<br><span>## [1] 19.88095</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span></span><span>1.2 超参数</span><span></span></h3><p data-tool="mdnice编辑器">超参数（hyperparameter）可对学习器的运行方式进行设置，它们可以在学习器的<code>param_set</code>字段查看：</p><pre data-tool="mdnice编辑器"><code>learn$param_set<br><span>## &lt;ParamSet&gt;</span><br><span>##        id    class lower upper nlevels default value</span><br><span>## 1: robust ParamLgl    NA    NA       2    TRUE FALSE</span><br></code></pre><p data-tool="mdnice编辑器">在学习器的帮助文档页面，会对超参数的含义进行介绍。<code>regr.featureless</code>的帮助页面可在<code>mlr3</code>包的<code>mlr_learners_regr.featureless</code>条目查看。该文档告诉用户，如果设置超参数<code>robust = TRUE</code>，则该学习器会使用目标变量的“中位数”作为预测结果。</p><p data-tool="mdnice编辑器">超参数在<code>lrn()</code>函数中设置：</p><pre data-tool="mdnice编辑器"><code>learn = lrn(<span>"regr.featureless"</span>, robust = <span>T</span>)<br>learn$train(task = task, row_ids = spilt$train)<br>learn$predict(task, spilt$test)<br><span>## &lt;PredictionRegr&gt; for 11 observations:</span><br><span>##     row_ids truth response</span><br><span>##           1  21.0     19.2</span><br><span>##           3  22.8     19.2</span><br><span>##           4  21.4     19.2</span><br><span>## ---                       </span><br><span>##          29  15.8     19.2</span><br><span>##          18  32.4     19.2</span><br><span>##          19  30.4     19.2</span><br><br>median(mtcars$mpg[spilt$train])<br><span>## [1] 19.2</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span></span><span>1.3 回归树学习器</span><span></span></h3><p data-tool="mdnice编辑器">前述6种学习器中，属于回归学习器的还有<code>regr.debug</code>和<code>regr.rpart</code>。<code>regr.debug</code>属于调试学习器，也是直接把目标变量均值直接作为预测值，这里不再介绍。</p><p data-tool="mdnice编辑器"><code>regr.rpart</code>是回归树学习器，上篇推文已经介绍它的例子了。关于回归树和分类树的原理可参见下篇这篇推文：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=Mzg2MjU1NjQ4NQ==&amp;mid=2247501566&amp;idx=1&amp;sn=589dc955a6ecc77f95411ab9ddb3fc8c&amp;scene=21#wechat_redirect" data-linktype="2">tree | 分类回归树模型</a></section></li></ul><p data-tool="mdnice编辑器">这里直接给出回归树学习器的代码：</p><pre data-tool="mdnice编辑器"><code>learn2 = lrn(<span>"regr.rpart"</span>)<br><br>learn2$train(task, spilt$train)<br>learn2$predict(task, spilt$test)<br><span>## &lt;PredictionRegr&gt; for 11 observations:</span><br><span>##     row_ids truth response</span><br><span>##           1  21.0 16.72857</span><br><span>##           3  22.8 26.18571</span><br><span>##           4  21.4 16.72857</span><br><span>## ---                       </span><br><span>##          29  15.8 16.72857</span><br><span>##          18  32.4 26.18571</span><br><span>##          19  30.4 26.18571</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span></span><span>1.4 其他回归学习器</span><span></span></h3><p data-tool="mdnice编辑器">除了<code>mlr3</code>工具包自带的3个回归学习器，还可以使用拓展包的一些学习器，例如<code>mlr3learners</code>工具包。</p><p data-tool="mdnice编辑器">加载<code>mlr3learners</code>包后，可以看到<code>mlr_learners</code>中的学习器增多到27种：</p><pre data-tool="mdnice编辑器"><code><span>library</span>(mlr3learners)<br><br>mlr_learners<br><span>## &lt;DictionaryLearner&gt; with 27 stored values</span><br><span>## Keys: classif.cv_glmnet, classif.debug, classif.featureless,</span><br><span>##   classif.glmnet, classif.kknn, classif.lda, classif.log_reg,</span><br><span>##   classif.multinom, classif.naive_bayes, classif.nnet, classif.qda,</span><br><span>##   classif.ranger, classif.rpart, classif.svm, classif.xgboost,</span><br><span>##   regr.cv_glmnet, regr.debug, regr.featureless, regr.glmnet, regr.kknn,</span><br><span>##   regr.km, regr.lm, regr.nnet, regr.ranger, regr.rpart, regr.svm,</span><br><span>##   regr.xgboost</span><br></code></pre><p data-tool="mdnice编辑器">多出来的学习器的帮助文档可在<code>mlr3learners</code>工具包的<code>mlr_learners_*</code>条目查看，其中<code>*</code>为学习器名称。例如<code>regr.ranger</code>的帮助文档条目是<code>mlr_learners_regr.ranger</code>。</p><p data-tool="mdnice编辑器"><code>regr.ranger</code>学习器构建的是随机森林模型：</p><pre data-tool="mdnice编辑器"><code>learn3 = lrn(<span>"regr.ranger"</span>)<br><br>learn3$train(task, spilt$train)<br>learn3$predict(task, spilt$test)<br><span>## &lt;PredictionRegr&gt; for 11 observations:</span><br><span>##     row_ids truth response</span><br><span>##           1  21.0 16.72857</span><br><span>##           3  22.8 26.18571</span><br><span>##           4  21.4 16.72857</span><br><span>## ---                       </span><br><span>##          29  15.8 16.72857</span><br><span>##          18  32.4 26.18571</span><br><span>##          19  30.4 26.18571</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>2 模型评估</span></h2><h3 data-tool="mdnice编辑器"><span></span><span></span><span>2.1 评估指标</span><span></span></h3><p><mp-pay-preview-filter data-offset="63"></mp-pay-preview-filter></p></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/rI_jAx-5hmYP48kCRbQMiQ",target="_blank" rel="noopener noreferrer">原文链接</a>
