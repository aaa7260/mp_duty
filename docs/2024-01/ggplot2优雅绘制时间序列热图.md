---
title: "ggplot2优雅绘制时间序列热图"
date: 2024-01-08T23:02:19Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
ggplot2优雅绘制时间序列热图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来介绍如何使用ggplot2来处理时间序列数据并进行数据可视化，整个过程仅参考。希望对各位观众老爷能有所帮助。<strong>「数据代码已经整合上传到会员交流群」</strong>，购买过小编VIP的朋友可在所加的会员群内获取下载，有需要的朋友可关注文末介绍加入VIP交流群。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关于永久群内容的说明</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>给予长期支持我们的忠实读者们一个特别待遇：凡是购买过小编2022年或2023年VIP会员文档的朋友们，<strong>「将自动获得2024年及以后更新的绘图文档代码，无需额外付费。」</strong>目前这两年的会员文档已累记卖出1500+，质量方面各位无需担忧。简要概括就是只要购买任意1年的会员内容，2024及后期公众号所更新的绘图文档均会在已经加入的会员群内分享。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(MetBrewer)<br><span>library</span>(ggtext)<br><span>library</span>(cowplot)<br><span>library</span>(janitor)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100025280" data-ratio="0.32685185185185184" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAb3vROXb4tR037CfLQgn3TnyJhKR4x7P16NXCia53SIaBJJibe0RouGVqrfSuHyHBBqBfmhyzjZiaaFQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAb3vROXb4tR037CfLQgn3TnyJhKR4x7P16NXCia53SIaBJJibe0RouGVqrfSuHyHBBqBfmhyzjZiaaFQ/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>data = read_csv(<span>"data.csv"</span>) %&gt;% clean_names()<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据筛选</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 筛选2016年及以后的数据，并转换日期格式</span><br>data1 = data %&gt;%<br>  filter(year&gt;=<span>2016</span>) %&gt;%<br>  mutate(mth = match(months, month.name)) %&gt;%<br>  mutate(date= zoo::as.yearmon(paste(year, mth), <span>"%Y %m"</span>))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>排序</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>lev =data1 %&gt;% filter(date==max(date)) %&gt;%<br>  select(area,value, date) %&gt;% <br>  arrange(value) %&gt;%<br>  pull(area) <br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>data1 %&gt;%<br>  ggplot(aes(x=date, y=factor(area, levels=lev), fill=value)) +<br>  geom_tile(height=<span>.7</span>) +<br>  <span># 在热图上添加文本</span><br>  geom_text(data=data1 %&gt;% filter(date==max(date)), <br>            aes(x=date+<span>.8</span>, label=scales::percent(value, scale=<span>1</span>, accuracy=<span>.01</span>)), <br>            size=<span>3</span>,hjust=<span>1</span>)+<br>  <span># 添加注释</span><br>  annotate(geom=<span>"text"</span>, size=<span>3</span>,hjust=<span>.8</span>, x=<span>2024</span>, y=<span>21.8</span>, label=<span>"2023"</span>) + <br>  <span># 设置颜色渐变和标签格式</span><br>  scale_fill_gradientn(colors=met.brewer(<span>"Derain"</span>),<br>                       labels=scales::percent_format(scale=<span>1</span>))+<br>  <span># 设置X轴和Y轴</span><br>  scale_x_continuous(position=<span>"top"</span>, breaks=seq(<span>2016</span>,<span>2023</span>,<span>1</span>),<br>                     expand = expansion(mult = c(<span>0</span>,<span>0.2</span>))) +<br>  scale_y_discrete(expand = expansion(mult = c(<span>0</span>, <span>0</span>))) +<br>  <span># 设置坐标轴和主题</span><br>  coord_cartesian(clip=<span>"off"</span>) +<br>  theme_minimal_vgrid(<span>15</span>) +<br>  theme(panel.grid.major.x=element_line(color=<span>"grey70"</span>, size=<span>.3</span>),<br>        legend.position = <span>"top"</span>,<br>        axis.title=element_blank(),<br>        axis.ticks.y.left = element_blank(),<br>        legend.title=element_blank(),<br>        plot.margin=margin(<span>.5</span>,<span>.75</span>,<span>.3</span>,<span>.5</span>,unit=<span>"cm"</span>),<br>        legend.margin=margin(l=<span>26</span>),<br>        axis.text.x.top = element_text(size=<span>9</span>,face=<span>"bold"</span>),<br>        axis.text.y = element_text(size=<span>10</span>,face=<span>"bold"</span>),<br>        legend.text=element_text(size=<span>10</span>,color=<span>"black"</span>),<br>        axis.line.y = element_blank()) +<br>  <span># 设置颜色条指南</span><br>  guides(fill=guide_colorbar(barwidth = unit(<span>18</span>, <span>"lines"</span>), <br>                             barheight = unit(<span>.9</span>, <span>"lines"</span>)))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100025281" data-ratio="0.9731481481481481" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAb3vROXb4tR037CfLQgn3TnX9kHhd0cy0W3x7vhK6crq3UGaJaSZfWdI4sFR79xUyb5WiaSHyNZjLg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAb3vROXb4tR037CfLQgn3TnX9kHhd0cy0W3x7vhK6crq3UGaJaSZfWdI4sFR79xUyb5WiaSHyNZjLg/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节介绍到此结束，有需要学习数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>下单购买，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码。</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单号即邀请进新的会员交流群，无论购买那一年的会员文档都将获取<strong>「2024年及以后更新的绘图文档」</strong>，早买早享受，需要了解更多信息的朋友欢迎淘宝店铺交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝扫一扫</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-imgfileid="100025282" data-ratio="1.5681159420289854" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAb3vROXb4tR037CfLQgn3Tn7VUhLYI57zhluKG63HgMyhpEouWicJCAYiaKQ6Lo7zeWxkpFzN0n7KeA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="690" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAb3vROXb4tR037CfLQgn3Tn7VUhLYI57zhluKG63HgMyhpEouWicJCAYiaKQ6Lo7zeWxkpFzN0n7KeA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺(有需要欢迎关注)</span><span></span></h3><p><img data-galleryid="" data-imgfileid="100019415" data-ratio="1.0210420841683367" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg" data-type="jpeg" data-w="998" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><p><img data-galleryid="" data-imgfileid="100016185" data-ratio="0.3194444444444444" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYib6Vf5Lfu4s64dJIEWhdGMvrcDEx2Rxgd91TOF5sjqy47Wqf2cTO1c5Nhdibh8G5IhOnR53j6XKrw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYib6Vf5Lfu4s64dJIEWhdGMvrcDEx2Rxgd91TOF5sjqy47Wqf2cTO1c5Nhdibh8G5IhOnR53j6XKrw/640?wx_fmt=png"></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/oouSCQMH_OdbLuthExZ__A",target="_blank" rel="noopener noreferrer">原文链接</a>
