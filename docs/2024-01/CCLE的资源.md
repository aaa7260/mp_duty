---
title: "CCLE的资源"
date: 2024-01-17T00:29:01Z
draft: ["false"]
tags: [
  "fetched",
  "东林的扯淡小屋"
]
categories: ["Acdemic"]
---
CCLE的资源 by 东林的扯淡小屋
------
<div><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="ruby"><code><span>setwd(<span>"/data/yudonglin/software/CCLE_heterogeneity"</span>)</span></code><code><span><br></span></code><code><span><span># ----------------------------------------------------------------------------------------------------</span></span></code><code><span><span># Processing and quality control of UMI counts </span></span></code><code><span><span># ----------------------------------------------------------------------------------------------------</span></span></code><code><span><br></span></code><code><span><span># read data UMI counts</span></span></code><code><span>expr &lt;- read.table(<span>"UMIcount_data.txt"</span>, sep=<span>"\t"</span>, header=T, row.names=<span>1</span>, check.names=F)</span></code><code><span>expr[<span>1</span><span>:</span><span>4</span>,<span>1</span><span>:</span><span>4</span>]</span></code><code><span><span># extract annotation</span></span></code><code><span>annotation &lt;- expr[<span>1</span><span>:</span><span>2</span>,]</span></code><code><span>expr &lt;- expr[-(<span>1</span><span>:</span><span>2</span>),]</span></code><code><span><br></span></code><code><span><span># filter cells based on the number of detected genes (i.e. complexity)</span></span></code><code><span>complexity &lt;- c()   </span></code><code><span><br></span></code><code><span><span>for</span>(i <span>in</span> <span>1</span><span>:ncol</span>(expr))  {</span></code><code><span>  complexity &lt;- c(complexity, length(which(expr[,i]!=<span>0</span>)))</span></code><code><span>}                   </span></code><code><span><br></span></code><code><span>complexity_filter &lt;- complexity &gt; <span>2000</span> &amp; complexity &lt; <span>9000</span></span></code><code><span>expr &lt;- expr[,complexity_filter]</span></code><code><span>annotation &lt;- annotation[,complexity_filter]                    </span></code><code><span><br></span></code><code><span><span># filter cell lines based on the number of cells profiled</span></span></code><code><span>cells_per_celline &lt;- table(t(annotation[<span>1</span>,]))</span></code><code><span>cell_line_filter &lt;- is.element(t(annotation[<span>1</span>,]), names(cells_per_celline[cells_per_celline&gt;<span>50</span>]))</span></code><code><span><br></span></code><code><span>expr &lt;- expr[,cell_line_filter]</span></code><code><span>annotation &lt;- annotation[,cell_line_filter]</span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span><span># transform UMI counta into CPM </span></span></code><code><span>expr &lt;- t(t(expr)/colSums(expr))*<span>1000000</span></span></code><code><span>expr[<span>1</span><span>:</span><span>4</span>,<span>1</span><span>:</span><span>4</span>]</span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span><span># #下载文件</span></span></code><code><span><span># wget -c https://singlecell.broadinstitute.org/single_cell/data/public/SCP542/pan-cancer-cell-line-heterogeneity?filename=CCLE_scRNAseq_github.zip</span></span></code><code><span><span># wget -c https://singlecell.broadinstitute.org/single_cell/data/public/SCP542/pan-cancer-cell-line-heterogeneity?filename=CPM_data.txt</span></span></code><code><span><span># wget -c https://singlecell.broadinstitute.org/single_cell/data/public/SCP542/pan-cancer-cell-line-heterogeneity?filename=Metadata.txt</span></span></code><code><span><span># wget -c https://singlecell.broadinstitute.org/single_cell/data/public/SCP542/pan-cancer-cell-line-heterogeneity?filename=UMIcount_data.txt</span></span></code><code><span><br></span></code><code><span>expr &lt;- read.table(<span>"UMIcount_data.txt"</span>, sep=<span>"\t"</span>, header=T, row.names=<span>1</span>, check.names=F)</span></code><code><span>expr[<span>1</span><span>:</span><span>4</span>,<span>1</span><span>:</span><span>4</span>]</span></code><code><span><span># extract annotation</span></span></code><code><span>annotation &lt;- expr[<span>1</span><span>:</span><span>2</span>,]</span></code><code><span>expr &lt;- expr[-(<span>1</span><span>:</span><span>2</span>),]</span></code><code><span>YDL &lt;- CreateSeuratObject(counts = expr,project = <span>"CCLE"</span>)<span>#11559 features across 3637 samples</span></span></code><code><span><span>##计算每个细胞的线粒体基因转录本数的百分比（%）,使用[[ ]] 操作符存放到metadata中，mit-开头的为线粒体基因</span></span></code><code><span>YDL[[<span>"percent.mt"</span>]] &lt;- PercentageFeatureSet(object = YDL, pattern = <span>"^MT-"</span>)</span></code><code><span><span>###展示基因及线粒体百分比（这里将其进行标记并统计其分布频率，"nFeature_RNA"为基因数，"nCount_RNA"为UMI数，"percent.mt"为线粒体占比）</span></span></code><code><span>VlnPlot(object = YDL, features = c(<span>"nFeature_RNA"</span>, <span>"nCount_RNA"</span>, <span>"percent.mt"</span>), ncol = <span>3</span>)</span></code><code><span><span>#对数据进行标准化</span></span></code><code><span><span>##表达量数据标准化,LogNormalize的算法：A = log( 1 + ( UMIA ÷ UMITotal ) × 10000</span></span></code><code><span>YDL &lt;- NormalizeData(object = YDL, normalization.method = <span>"LogNormalize"</span>, scale.factor = <span>10000</span>)</span></code><code><span><span>#提取那些在细胞间变异系数较大的基因</span></span></code><code><span><span>##鉴定表达高变基因(2000个）,用于下游分析,如PCA；</span></span></code><code><span>YDL &lt;- FindVariableFeatures(object = YDL, selection.method = <span>"vst"</span>, nfeatures = <span>2000</span>)</span></code><code><span>YDL &lt;- ScaleData(object = YDL, features = rownames(YDL))</span></code><code><span><span>#线性降维（PCA）,默认用高变基因集,但也可通过features参数自己指定；</span></span></code><code><span>YDL=RunPCA(object= YDL,npcs = <span>20</span>,pc.genes=VariableFeatures(object = YDL))     <span>#PCA分析</span></span></code><code><span>ElbowPlot(YDL)<span>#选择top20个PC</span></span></code><code><span>pcSelect=<span>20</span></span></code><code><span>YDL &lt;- FindNeighbors(object = YDL, dims = <span>1</span><span>:pcSelect</span>)                <span>#计算邻接距离</span></span></code><code><span><span>##接着优化模型,resolution参数决定下游聚类分析得到的分群数,对于3K左右的细胞,设为0.4-1.2 能得到较好的结果(官方说明)；如果数据量增大,该参数也应该适当增大。</span></span></code><code><span>YDL &lt;- FindClusters(object = YDL, resolution = <span>0</span>.<span>3</span>)                  <span>#对细胞分组,优化标准模块化</span></span></code><code><span><span>##使用Idents（）函数可查看不同细胞的分群；</span></span></code><code><span>head(Idents(YDL), <span>5</span>)</span></code><code><span><br></span></code><code><span><span>##Seurat提供了几种非线性降维的方法进行数据可视化（在低维空间把相似的细胞聚在一起）,比如UMAP和t-SNE,运行UMAP需要先安装'umap-learn'包，这里不做介绍，两种方法都可以使用，但不要混用，如果混用，后面的结算结果会将先前的聚类覆盖掉，只能保留一个。</span></span></code><code><span><br></span></code><code><span><span>##这里采用基于TSNE的聚类方法。</span></span></code><code><span>YDL &lt;- RunTSNE(object = YDL, dims = <span>1</span><span>:pcSelect</span>,check_duplicates = FALSE)                      <span>#TSNE聚类</span></span></code><code><span><br></span></code><code><span><span>##这里采用基于umap的聚类方法</span></span></code><code><span><span>#这里采用基于图论的聚类方法</span></span></code><code><span>YDL &lt;- RunUMAP(object = YDL, dims = <span>1</span><span>:pcSelect</span>)                      <span>#umap聚类</span></span></code><code><span><span>##细胞周期归类</span></span></code><code><span><br></span></code><code><span>YDL&lt;- CellCycleScoring(object = YDL, g2m.features = cc.genes$g2m.genes, s.features = cc.genes$s.genes)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span>#另一个可视化的方法</span></span></code><code><span>Seurat::DimPlot(YDL,reduction = <span>"tsne"</span>,label = TRUE,pt.size = <span>1.5</span>)</span></code><code><span>DimPlot(YDL,reduction = <span>"tsne"</span>,label = TRUE,pt.size = <span>1.5</span>,split.by = <span>"orig.ident"</span>)</span></code><code><span><span>#另一个可视化的方法</span></span></code><code><span>Seurat::DimPlot(YDL,reduction = <span>"umap"</span>,label = TRUE,pt.size = <span>1.5</span>)</span></code><code><span>DimPlot(YDL,reduction = <span>"umap"</span>,label = TRUE,pt.size = <span>1.5</span>,split.by = <span>"orig.ident"</span>)</span></code><code><span><br></span></code><code><span>head(YDL@meta.data)</span></code><code><span>annotation&lt;-t(annotation)</span></code><code><span>annotation&lt;-as.data.frame(annotation)</span></code><code><span>YDL@meta.data$Cell_line&lt;-annotation$Cell_line</span></code><code><span>YDL@meta.data$Pool_ID&lt;-annotation$Pool_ID</span></code><code><span>Seurat::DimPlot(YDL,reduction = <span>"tsne"</span>,label = TRUE,pt.size = <span>1.5</span>,group.by = <span>"Cell_line"</span>)</span></code><code><span>Seurat::DimPlot(YDL,reduction = <span>"tsne"</span>,label = TRUE,pt.size = <span>1.5</span>,group.by = <span>"Cell_line"</span>)+ NoLegend()</span></code><code><span><br></span></code><code><span>YDL@meta.data$cell_name&lt;-sapply(strsplit(YDL@meta.data$Cell_line, <span>"_"</span>), function(x) x[<span>1</span>])</span></code><code><span><span># 使用sub函数替换每个字符串，只保留第一个下划线后面的部分</span></span></code><code><span>YDL@meta.data$organ&lt;-result &lt;- sub(<span>"^[^_]*_"</span>, <span>""</span>, YDL@meta.data$Cell_line)</span></code><code><span>table(YDL@meta.data$organ)</span></code><code><span>Seurat::DimPlot(YDL,reduction = <span>"tsne"</span>,label = TRUE,pt.size = <span>1.5</span>,group.by = <span>"cell_name"</span>)</span></code><code><span>Seurat::DimPlot(YDL,reduction = <span>"tsne"</span>,label = TRUE,pt.size = <span>1.5</span>,group.by = <span>"cell_name"</span>)+ NoLegend()</span></code><code><span><br></span></code><code><span>Seurat::DimPlot(YDL,reduction = <span>"tsne"</span>,label = TRUE,pt.size = <span>1.5</span>,group.by = <span>"organ"</span>)</span></code><code><span>Seurat::DimPlot(YDL,reduction = <span>"tsne"</span>,label = TRUE,pt.size = <span>1.5</span>,group.by = <span>"organ"</span>)+ NoLegend()</span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span>FeaturePlot(object = YDL, reduction = <span>"tsne"</span>,pt.size = <span>1.5</span>,features = c(<span>"PTPRC"</span>),cols = c(<span>"gray"</span>, <span>"red"</span>))<span>#actin</span></span></code><code><span>FeaturePlot(object = YDL, reduction = <span>"tsne"</span>,pt.size = <span>1.5</span>,features = c(<span>"S100A9"</span>),cols = c(<span>"gray"</span>, <span>"red"</span>))<span>#actin</span></span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span>table(YDL@meta.data$Cell_line)</span></code><code><span>Idents(YDL) &lt;- YDL@meta.data$Cell_line</span></code><code><span>YDL.markers &lt;- FindAllMarkers(YDL, only.pos = TRUE, min.pct = <span>0</span>.<span>25</span>, logfc.threshold = <span>0</span>.<span>25</span>, test.use = <span>'roc'</span>)</span></code><code><span><span># install.packages("magrittr") # package installations are only needed the first time you use it</span></span></code><code><span><span># install.packages("dplyr")    # alternative installation of the %&gt;%</span></span></code><code><span>library(magrittr) <span># needs to be run evYDL time you start R and want to use %&gt;%</span></span></code><code><span>library(dplyr)    <span># alternatively, this also loads %&gt;%</span></span></code><code><span>YDL.markers %&gt;% group_by(cluster) %&gt;% top_n(n = <span>2</span>, wt = avg_log2FC)</span></code><code><span><span>##存储marker</span></span></code><code><span><br></span></code><code><span>write.csv(YDL.markers,file=<span>"allmarker_human_cancer_celltype.csv"</span>)</span></code><code><span><span>#绘制分cluster的热图</span></span></code><code><span>top1<span>0</span> &lt;- YDL.markers %&gt;% group_by(cluster) %&gt;% top_n(n = <span>10</span>, wt = avg_log2FC)</span></code><code><span><span>#绘制marker在各个cluster的热图</span></span></code><code><span>pdf(file=<span>"tsneHeatmap_all.pdf"</span>,width=<span>12</span>,height=<span>9</span>)</span></code><code><span>DoHeatmap(object = YDL, features = top1<span>0</span>$gene) + NoLegend()</span></code><code><span>DoHeatmap(subset(YDL, downsample = <span>100</span>), features = top1<span>0</span>$gene, size = <span>3</span>)+ NoLegend()</span></code><code><span>dev.off()</span></code><code><span><br></span></code><code><span><br></span></code><code><span>write.csv(table(YDL@meta.data$Cell_line),<span>"cellline.csv"</span>)</span></code><code><span>saveRDS(YDL,<span>"CCLE.rds"</span>)</span></code><code><span><br></span></code></pre></section><p><img data-galleryid="" data-ratio="0.5990740740740741" data-s="300,640" data-type="jpeg" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBovN8xqnl6WU7m9KiaJG0ydianD6lkvOdAVwE9UlibXcoZKLkrKXHtTAJksNxt1eLmkN7qKqCqgy6R7Q/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBovN8xqnl6WU7m9KiaJG0ydianD6lkvOdAVwE9UlibXcoZKLkrKXHtTAJksNxt1eLmkN7qKqCqgy6R7Q/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.5990740740740741" data-s="300,640" data-type="jpeg" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBovN8xqnl6WU7m9KiaJG0ydiaf4kIyMtTuA27QG2qDcQ1KGQTx90Pm5S86QDmGhZGUDLTwkzF7wXFVg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBovN8xqnl6WU7m9KiaJG0ydiaf4kIyMtTuA27QG2qDcQ1KGQTx90Pm5S86QDmGhZGUDLTwkzF7wXFVg/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.5990740740740741" data-s="300,640" data-type="jpeg" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBovN8xqnl6WU7m9KiaJG0ydia11objia19kbkE3VTLv0bYQqibB6diabWuQuoMgDKnsNiaHvyxc1oQNMKmQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBovN8xqnl6WU7m9KiaJG0ydia11objia19kbkE3VTLv0bYQqibB6diabWuQuoMgDKnsNiaHvyxc1oQNMKmQ/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.11944444444444445" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBovN8xqnl6WU7m9KiaJG0ydiaR3wCTK8AsOnQKJ7g2ydLsjbtichiaroCia0SmuVQLKXYXNxlU8Zqpo0KA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBovN8xqnl6WU7m9KiaJG0ydiaR3wCTK8AsOnQKJ7g2ydLsjbtichiaroCia0SmuVQLKXYXNxlU8Zqpo0KA/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.5990740740740741" data-s="300,640" data-type="jpeg" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBovN8xqnl6WU7m9KiaJG0ydiaiblS4z8zRn5lYDCiatQ1c1vfJ3l7Gt5hhgd8B6x5gawUTpgIwyiaqpofA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBovN8xqnl6WU7m9KiaJG0ydiaiblS4z8zRn5lYDCiatQ1c1vfJ3l7Gt5hhgd8B6x5gawUTpgIwyiaqpofA/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.5990740740740741" data-s="300,640" data-type="jpeg" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBovN8xqnl6WU7m9KiaJG0ydiaLSUQwoFhsvABicu6Cc3yO311ticugHMmh2ZXRCjd9gBZGs2sp0Rhr44w/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBovN8xqnl6WU7m9KiaJG0ydiaLSUQwoFhsvABicu6Cc3yO311ticugHMmh2ZXRCjd9gBZGs2sp0Rhr44w/640?wx_fmt=png"></p><pre tabindex="0" aria-label="Console Output" role="document"><span tabindex="-1" role="document">                     2313287_STOMACH        42MGBA_CENTRAL_NERVOUS_SYSTEM <br>                                 105                                  561 <br>                       8305C_THYROID       93VU_UPPER_AERODIGESTIVE_TRACT <br>                                 459                                  573 <br>                    A204_SOFT_TISSUE                           A2058_SKIN <br>                                 253                                  469 <br>                           A375_SKIN                            ABC1_LUNG <br>                                 726                                  313 <br>                     ACCMESO1_PLEURA                       ASPC1_PANCREAS <br>                                 177                                  290 <br>                       BCPAP_THYROID                       BFTC909_KIDNEY <br>                                 156                                  423 <br>       BHY_UPPER_AERODIGESTIVE_TRACT     BICR16_UPPER_AERODIGESTIVE_TRACT <br>                                 146                                  212 <br>    BICR18_UPPER_AERODIGESTIVE_TRACT     BICR31_UPPER_AERODIGESTIVE_TRACT <br>                                   2                                  249 <br>    BICR56_UPPER_AERODIGESTIVE_TRACT      BICR6_UPPER_AERODIGESTIVE_TRACT <br>                                  81                                  287 <br>                        BT474_BREAST                         BT549_BREAST <br>                                 127                                  272 <br>                            C32_SKIN                         CAKI2_KIDNEY <br>                                 556                                  278 <br>                          CALU6_LUNG                         CAMA1_BREAST <br>                                 261                                  291 <br>                         CAOV3_OVARY          CAS1_CENTRAL_NERVOUS_SYSTEM <br>                                 222                                  140 <br>     CCFSTTG1_CENTRAL_NERVOUS_SYSTEM                CCK81_LARGE_INTESTINE <br>                                 247                                  127 <br>                CL34_LARGE_INTESTINE                  COLO680N_OESOPHAGUS <br>                                 418                                  524 <br>                        COLO741_SKIN                         COLO792_SKIN <br>                                 329                                  282 <br>                        COV434_OVARY                        DANG_PANCREAS <br>                                 101                                  143 <br>         DAOY_CENTRAL_NERVOUS_SYSTEM DETROIT562_UPPER_AERODIGESTIVE_TRACT <br>                                 304                                  168 <br>         DKMG_CENTRAL_NERVOUS_SYSTEM                            EBC1_LUNG <br>                                 272                                  186 <br>                  EFE184_ENDOMETRIUM                       EFM192A_BREAST <br>                                  86                                  351 <br>                         EFO27_OVARY                            EKVX_LUNG <br>                                  43                                  146 <br>                      FTC133_THYROID          GOS3_CENTRAL_NERVOUS_SYSTEM <br>                                 151                                  191 <br>                      HCC1419_BREAST                       HCC1428_BREAST <br>                                 234                                  128 <br>                         HCC366_LUNG                         HCC38_BREAST <br>                                 202                                  201 <br>               HCC56_LARGE_INTESTINE                         HDQP1_BREAST <br>                                 102                                   65 <br>                  HEC108_ENDOMETRIUM                   HEC151_ENDOMETRIUM <br>                                 172                                  250 <br>                  HEC251_ENDOMETRIUM                    HEC59_ENDOMETRIUM <br>                                 107                                  402 <br>                    HEC6_ENDOMETRIUM                       HEP3B217_LIVER <br>                                 161                                  118 <br>                        HMC18_BREAST                             HOS_BONE <br>                                 346                                  832 <br>                   HS729_SOFT_TISSUE                          HS852T_SKIN <br>                                 215                                  171 <br>                         HS939T_SKIN                   HT1080_SOFT_TISSUE <br>                                 236                                  659 <br>                HT1197_URINARY_TRACT                 HT1376_URINARY_TRACT <br>                                  75                                  120 <br>                HT55_LARGE_INTESTINE                 HUCCT1_BILIARY_TRACT <br>                                 211                                  243 <br>                 HUH28_BILIARY_TRACT                           HUH6_LIVER <br>                                 139                                  339 <br>                      HUPT3_PANCREAS                       HUPT4_PANCREAS <br>                                 138                                   56 <br>                           IALM_LUNG                            IGR1_SKIN <br>                                 324                                  833 <br>                          IGR37_SKIN                         IM95_STOMACH <br>                                 549                                  185 <br>                          JHH6_LIVER                           JHH7_LIVER <br>                                 227                                  199 <br>                         JHOC5_OVARY                          JHOS2_OVARY <br>                                 163                                  214 <br>    JHU006_UPPER_AERODIGESTIVE_TRACT     JHU011_UPPER_AERODIGESTIVE_TRACT <br>                                 325                                  717 <br>    JHU029_UPPER_AERODIGESTIVE_TRACT         KALS1_CENTRAL_NERVOUS_SYSTEM <br>                                 797                                  289 <br>                        KMRC3_KIDNEY         KNS42_CENTRAL_NERVOUS_SYSTEM <br>                                 253                                  172 <br>                         KPL1_BREAST            KPNSI9S_AUTONOMIC_GANGLIA <br>                                 296                                  130 <br>                  KYSE520_OESOPHAGUS                            LI7_LIVER <br>                                 343                                  287 <br>                        LMSU_STOMACH               LNCAPCLONEFGC_PROSTATE <br>                                 255                                  131 <br>              LS1034_LARGE_INTESTINE                LS180_LARGE_INTESTINE <br>                                 153                                  362 <br>                         MCF7_BREAST                      MDAMB361_BREAST <br>                                 144                                  135 <br>                     MDAMB436_BREAST                   MFE280_ENDOMETRIUM <br>                                 284                                  218 <br>                  MFE319_ENDOMETRIUM                        MKN45_STOMACH <br>                                 192                                  119 <br>                        MKN7_STOMACH                      MSTO211H_PLEURA <br>                                 267                                  303 <br>                       NCIH1048_LUNG                        NCIH1299_LUNG <br>                                 438                                  570 <br>                       NCIH1373_LUNG                        NCIH1435_LUNG <br>                                 164                                  267 <br>                       NCIH1568_LUNG                        NCIH1792_LUNG <br>                                 302                                  114 <br>                       NCIH1944_LUNG                        NCIH2073_LUNG <br>                                 450                                  176 <br>                       NCIH2077_LUNG                        NCIH2087_LUNG <br>                                 475                                  227 <br>                       NCIH2110_LUNG                        NCIH2126_LUNG <br>                                1994                                  264 <br>                       NCIH2170_LUNG                        NCIH2196_LUNG <br>                                 143                                   38 <br>                       NCIH2228_LUNG                         NCIH226_LUNG <br>                                 367                                  240 <br>                       NCIH2347_LUNG                        NCIH2444_LUNG <br>                                 147                                  237 <br>                     NCIH2452_PLEURA                         NCIH292_LUNG <br>                                 551                                  214 <br>                        NCIH358_LUNG                         NCIH446_LUNG <br>                                 351                                  198 <br>                        NCIH460_LUNG                         NCIH522_LUNG <br>                                1185                                  209 <br>                        NCIH650_LUNG                         NCIH727_LUNG <br>                                 271                                  300 <br>             NCIH747_LARGE_INTESTINE                          OAW28_OVARY <br>                                  80                                  162 <br>                       ONCODG1_OVARY                         OSRC2_KIDNEY <br>                                 270                                  126 <br>              OUMS23_LARGE_INTESTINE                         OVCAR4_OVARY <br>                                 107                                  283 <br>                         OVK18_OVARY                         OVKATE_OVARY <br>                                 493                                   32 <br>                        OVSAHO_OVARY                         OVTOKO_OVARY <br>                                 230                                  212 <br>                   PANC0203_PANCREAS                       PANC1_PANCREAS <br>                                 531                                  180 <br>                  PATU8988S_PANCREAS                         PC3_PROSTATE <br>                                 249                                  169 <br>  PECAPJ49_UPPER_AERODIGESTIVE_TRACT                       PK45H_PANCREAS <br>                                 205                                  272 <br>                       PK59_PANCREAS                      RCC10RGB_KIDNEY <br>                                 178                                  234 <br>                RCM1_LARGE_INTESTINE                       RD_SOFT_TISSUE <br>                                 131                                  285 <br>                      RERFLCAD1_LUNG                        RERFLCAI_LUNG <br>                                 244                                  763 <br>                       RERFLCKJ_LUNG                    RT4_URINARY_TRACT <br>                                  87                                  107 <br>                         RVH421_SKIN                            SBC5_LUNG <br>                                 243                                  226 <br>     SCC25_UPPER_AERODIGESTIVE_TRACT      SCC47_UPPER_AERODIGESTIVE_TRACT <br>                                1079                                  592 <br>      SCC9_UPPER_AERODIGESTIVE_TRACT      SCC90_UPPER_AERODIGESTIVE_TRACT <br>                                 475                                  258 <br>                      SH10TC_STOMACH               SIMA_AUTONOMIC_GANGLIA <br>                                 355                                   40 <br>                          SJSA1_BONE                           SKES1_BONE <br>                                 238                                   93 <br>                         SKMEL2_SKIN                          SKMEL3_SKIN <br>                                 277                                  198 <br>                        SKMEL30_SKIN                          SKMEL5_SKIN <br>                                 355                                  297 <br>                         SKMES1_LUNG              SKNAS_AUTONOMIC_GANGLIA <br>                                 144                                  235 <br>   SNU1076_UPPER_AERODIGESTIVE_TRACT                  SNU1077_ENDOMETRIUM <br>                                  53                                  196 <br>               SNU1079_BILIARY_TRACT                SNU1196_BILIARY_TRACT <br>                                  73                                  289 <br>   SNU1214_UPPER_AERODIGESTIVE_TRACT                 SNU308_BILIARY_TRACT <br>                                 188                                   94 <br>                        SNU423_LIVER                         SNU449_LIVER <br>                                 222                                  283 <br>     SNU46_UPPER_AERODIGESTIVE_TRACT        SNU738_CENTRAL_NERVOUS_SYSTEM <br>                                 236                                  379 <br>               SNU81_LARGE_INTESTINE     SNU899_UPPER_AERODIGESTIVE_TRACT <br>                                  49                                   83 <br>               SNUC4_LARGE_INTESTINE                             SQ1_LUNG <br>                                 471                                  239 <br>                     SU8686_PANCREAS        SW1088_CENTRAL_NERVOUS_SYSTEM <br>                                  82                                  128 <br>              SW1116_LARGE_INTESTINE                          SW1271_LUNG <br>                                  23                                  116 <br>              SW1463_LARGE_INTESTINE                      SW1990_PANCREAS <br>                                  22                                  325 <br>                       SW579_THYROID                          T47D_BREAST <br>                                 217                                  225 <br>                TCCSUP_URINARY_TRACT                       TE1_OESOPHAGUS <br>                                 318                                  209 <br>                     TE10_OESOPHAGUS                      TE14_OESOPHAGUS <br>                                 219                                  474 <br>                      TE6_OESOPHAGUS                       TE9_OESOPHAGUS <br>                                 576                                  249 <br>                     TEN_ENDOMETRIUM          TM31_CENTRAL_NERVOUS_SYSTEM <br>                                 320                                  116 <br>                       TOV112D_OVARY                         TOV21G_OVARY <br>                                 165                                  311 <br>                         TYKNU_OVARY        U118MG_CENTRAL_NERVOUS_SYSTEM <br>                                 117                                  244 <br>                        UACC257_SKIN                  UMUC1_URINARY_TRACT <br>                                 239                                  197 <br>                VMCUB1_URINARY_TRACT                       VMRCRCZ_KIDNEY <br>                                 531                                  310 <br>                           WM88_SKIN       YD38_UPPER_AERODIGESTIVE_TRACT <br>                                 242                                  699 <br>                        ZR751_BREAST <br></span><p><span tabindex="-1" role="document">                                 340</span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="http"><code><span><br></span></code><code><span><br></span></code><code><span><span><span>#load in the motifannotation this will load it into your environment but as the name in which is given to the list argument</span></span></span></code><code><span>data(list=<span>"motifAnnotations_hgnc_v9"</span>, package=<span>"RcisTarget"</span>)</span></code><code><span><br></span></code><code><span><span>#rename the motif annnotion by attributing it to the variable that is in the error</span></span></code><code><span>motifAnnotations_hgnc &lt;- motifAnnotations_hgnc_v9</span></code><code><span><br></span></code><code><span>set.seed(<span>123</span>)</span></code><code><span>library(Seurat)</span></code><code><span>library(tidyverse)</span></code><code><span>library(patchwork)</span></code><code><span>library(SCENIC)</span></code><code><span>library(Seurat)</span></code><code><span>library(tidyverse)</span></code><code><span>library(patchwork)</span></code><code><span>library(SCENIC)</span></code><code><span>library(plyr)</span></code><code><span>library(permute)</span></code><code><span>library(data.table)</span></code><code><span>library(SCopeLoomR)</span></code><code><span>library(<span>"doSNOW"</span>)</span></code><code><span>library(<span>"doParallel"</span>) </span></code><code><span>library(<span>"doMPI"</span>)</span></code><code><span><span>##==分析准备==##</span></span></code><code><span>dir.create(<span>"SCENIC"</span>)</span></code><code><span>dir.create(<span>"SCENIC/int"</span>)</span></code><code><span><span>#scRNA &lt;-sce.all</span></span></code><code><span><span>#YDL &lt;-readRDS("cell_matastasis.RDS")</span></span></code><code><span><span>#rm(YDL)</span></span></code><code><span>setwd(<span>"./SCENIC"</span>) </span></code><code><span><span>##准备细胞meta信息</span></span></code><code><span>cellInfo &lt;- data.frame(YDL@meta.data)</span></code><code><span>colnames(cellInfo)[which(colnames(cellInfo)==<span>"organ"</span>)] &lt;- <span>"organ"</span></span></code><code><span><span>#colnames(cellInfo)[which(colnames(cellInfo)=="seurat_clusters")] &lt;- "cluster"</span></span></code><code><span>colnames(cellInfo)[which(colnames(cellInfo)==<span>"cell_name"</span>)] &lt;- <span>"cell_name"</span></span></code><code><span>cellInfo &lt;- cellInfo[,c(<span>"organ"</span>,<span>"cell_name"</span>)]</span></code><code><span>saveRDS(cellInfo, file=<span>"int/cellInfo.Rds"</span>)</span></code><code><span><span>#为了节省计算资源，随机抽取1000个细胞的数据子集</span></span></code><code><span>subcell &lt;- sample(colnames(YDL),<span>1000</span>)</span></code><code><span>YDLsub &lt;- YDL[,subcell]</span></code><code><span>saveRDS(YDLsub, <span>"YDLsub.rds"</span>)</span></code><code><span>exprMat &lt;- as.matrix(YDLsub@assays$RNA@counts)</span></code><code><span><span># dim(exprMat)</span></span></code><code><span><span># [1] 32285  1000</span></span></code><code><span><span>#head(cellInfo)</span></span></code><code><span><span>##设置分析环境</span></span></code><code><span>mydbDIR &lt;- <span>"/data/yudonglin/reference/scenic/"</span></span></code><code><span>mydbs &lt;- c(<span>"hg19-500bp-upstream-7species.mc9nr.feather"</span>,</span></code><code><span>           <span>"hg19-tss-centered-10kb-7species.mc9nr.feather"</span>)</span></code><code><span><br></span></code><code><span>names(mydbs) &lt;- c(<span>"500bp"</span>, <span>"10kb"</span>)</span></code><code><span>scenicOptions &lt;- initializeScenic(org=<span>"hgnc"</span>, </span></code><code><span>                                  nCores=<span>60</span>,</span></code><code><span>                                  dbDir=mydbDIR, </span></code><code><span>                                  dbs = mydbs,</span></code><code><span>                                  datasetTitle = <span>"SCENIC"</span>)</span></code><code><span>saveRDS(scenicOptions, <span>"int/scenicOptions.rds"</span>)</span></code><code><span>genesKept &lt;- geneFiltering(exprMat, scenicOptions, </span></code><code><span>                           minCountsPerGene = <span>3</span> * <span>0</span>.<span>01</span> * ncol(exprMat), </span></code><code><span>                           minSamples = ncol(exprMat) * <span>0</span>.<span>01</span>)</span></code><code><span>exprMat_filtered &lt;- exprMat[genesKept, ]</span></code><code><span><span>##计算相关性矩阵</span></span></code><code><span>runCorrelation(exprMat_filtered, scenicOptions)</span></code><code><span><span>##TF-Targets相关性回归分析</span></span></code><code><span>exprMat_filtered_log &lt;- log2(exprMat_filtered+<span>1</span>)</span></code><code><span>runGenie3(exprMat_filtered_log, scenicOptions, nParts = <span>20</span>)</span></code><code><span><span>#这一步消耗的计算资源非常大，个人电脑需要几个小时的运行时间</span></span></code><code><span><span>##推断共表达模块</span></span></code><code><span>runSCENIC_1_coexNetwork2modules(scenicOptions)</span></code><code><span><span># scenicOptions &lt;- initializeScenic(org="hgnc", </span></span></code><code><span><span>#                                   nCores=9,</span></span></code><code><span><span>#                                   dbDir=mydbDIR, </span></span></code><code><span><span>#                                   dbs = mydbs,</span></span></code><code><span><span>#                                   datasetTitle = "erythrogenesis")</span></span></code><code><span><span>##推断转录调控网络（regulon）</span></span></code><code><span>runSCENIC_2_createRegulons(scenicOptions)</span></code><code><span><span>#以上代码可增加参数coexMethod=c("w001", "w005", "top50", "top5perTarget", "top10perTarget", "top50perTarget"))</span></span></code><code><span><span>#默认6种方法的共表达网络都计算，可以少选几种方法以减少计算量</span></span></code><code><span>scenicOptions &lt;- initializeScenic(org=<span>"hgnc"</span>, </span></code><code><span>                                  nCores=<span>1</span>,</span></code><code><span>                                  dbDir=mydbDIR, </span></code><code><span>                                  dbs = mydbs,</span></code><code><span>                                  datasetTitle = <span>"erythrogenesis"</span>)</span></code><code><span><span>##==regulon活性评分与可视化==##</span></span></code><code><span><span>##regulons计算AUC值并进行下游分析</span></span></code><code><span>exprMat_all &lt;- as.matrix(YDL@assays$RNA@counts)</span></code><code><span>exprMat_all &lt;- log2(exprMat_all+<span>1</span>)</span></code><code><span>saveRDS(exprMat_all,<span>"exprMat_all.rds"</span>)</span></code><code><span><span># rm(list=ls())</span></span></code><code><span><span># scenicOptions&lt;-readRDS("scenicOptions.rds")</span></span></code><code><span><span># exprMat_all&lt;-readRDS("exprMat_all.rds")</span></span></code><code><span>runSCENIC_3_scoreCells(scenicOptions, exprMat=exprMat_all)</span></code><code><span><br></span></code><code><span><span>#runSCENIC_3_scoreCells(scenicOptions, exprMat=log2(as.matrix(YDL<span>@assays</span>$RNA<span>@counts</span>)+1))</span></span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span><span># #使用shiny互动调整阈值</span></span></code><code><span><span># aucellApp &lt;- plotTsne_AUCellApp(scenicOptions, exprMat_all)</span></span></code><code><span><span># savedSelections &lt;- shiny::runApp(aucellApp)</span></span></code><code><span><span># #保存调整后的阈值</span></span></code><code><span><span># newThresholds &lt;- savedSelections$thresholds</span></span></code><code><span><span># scenicOptions<span>@fileNames</span>$int["aucell_thresholds",1] &lt;- "int/newThresholds.Rds"</span></span></code><code><span><span># saveRDS(newThresholds, file=getIntName(scenicOptions, "aucell_thresholds"))</span></span></code><code><span><span># saveRDS(scenicOptions, file="int/scenicOptions.Rds")</span></span></code><code><span>runSCENIC_4_aucell_binarize(scenicOptions, exprMat=exprMat_all)</span></code><code><span>savehistory(<span>"scenic_code.txt"</span>)</span></code><code><span><br></span></code></pre></section></pre><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Z8PCIrtcyOeW_f6_zlrJ6g",target="_blank" rel="noopener noreferrer">原文链接</a>
