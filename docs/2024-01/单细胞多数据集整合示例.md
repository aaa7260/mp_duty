---
title: "单细胞多数据集整合示例"
date: 2024-01-27T15:28:08Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
单细胞多数据集整合示例 by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span>❝</span><p>上周有小伙伴在群里提到 ” <strong>「想学习一下多个单细胞数据集合并的方法，有没有文章或者博客推荐」</strong> “，然后我想着要不要总结一下，所以之后搜索了公众号平台上的推文，发现早就比较系统的教程了。</p><p>关于单细胞多样本整合分析，有可以在R语言中运行CCA、RPCA、Harmony、BBKNN等等算法；也有可以用Python分析的BBKNN、Harmony、scVI和scANVI算法等等。</p><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg5MjcxNzg1NA==&amp;mid=2247487688&amp;idx=1&amp;sn=03fa47e197220c523cf40c884bb3ce9b&amp;scene=21#wechat_redirect" data-linktype="2">单细胞多样本整合之Scanorama</a></p><p>所以我就不打算在这里班门弄斧了。</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">有很多人有或多或少的原因并不会自己做单细胞实验送测序，加上目前单细胞转录组数据上传在公共数据库的数据也有不少了，大家会倾向于从公共数据集中筛选出多个数据集来做整合分析。所以这周推文打算从理论角度，跟大家分享一下多个数据集整合分析的代码。</p><p data-tool="mdnice编辑器">举个例子，如果只关注某一肿瘤组织中的Tcell或Bcell或髓系细胞，选取该种肿瘤样本数据集，两到三个数据集合并分析，提取Tcell或Bcell或髓系细胞亚群，那么在分析这种数据的时候就会遇到一个问题。</p><p data-tool="mdnice编辑器"><strong>「1. 是在对多个不同数据集分别降维分群后再提取各个数据集的Tcell或Bcell或髓系细胞亚群整合到一块？」</strong></p><p data-tool="mdnice编辑器"><strong>「2. 还是说在对单细胞数据集一开始分析的时候，就定义好分组整合到一块呢？」</strong></p><p data-tool="mdnice编辑器"><strong>「我个人觉得这个部分怎么分析并没有一个特定的答案或者规则，具体还是得看数据集适合以上提出的哪种分析顺序。」</strong></p><p data-tool="mdnice编辑器">例如之前有一篇文章中提到过用三个鼻咽癌单细胞转录组数据：GSE150825, GSE150430, GSE162025。不过这篇文献是对三组数据整合后，选取其中的一部分T细胞进行着重分析。<img data-imgfileid="100034974" data-ratio="0.5839653304442037" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibFaib7SEzbymj3JpwbiaZBHibzC4vibQM1bEsiamicwY1J7jJDDexgXzNavxN1U1Abte6DwfU4Gs4qEROg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="923" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibFaib7SEzbymj3JpwbiaZBHibzC4vibQM1bEsiamicwY1J7jJDDexgXzNavxN1U1Abte6DwfU4Gs4qEROg/640?wx_fmt=png&amp;from=appmsg"></p><h4 data-tool="mdnice编辑器"><span></span>这里介绍其中一种方式：三个数据集分别降维分群，亚群细分后再进行整合。<span></span></h4><h4 data-tool="mdnice编辑器"><span></span>篇幅有限，这里以GSE150430数据集为例。<span></span></h4><p data-tool="mdnice编辑器">以下代码比较详细的展示了第一次降维分群，提取髓系亚群后再次降维分群，定义细胞亚群。</p><p data-tool="mdnice编辑器">最后部分还提供怎么把三组数据合并的代码。</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br>options(stringsAsFactors = <span>F</span>) <br><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(clustree)<br><span>library</span>(cowplot)<br><span>library</span>(dplyr)<br><br><span>###### step1:导入数据 ######     </span><br><span>library</span>(data.table)<br><br>group=fread(<span>'group.txt'</span> ) <br>group=as.data.frame(t(group)[-<span>1</span>,])<br>head(group) <br><span>library</span>(stringr)<br>colnames(group)=<span>'celltype'</span><br>group$patient=str_split(rownames(group),<span>'_'</span>,simplify = <span>T</span>)[,<span>1</span>]<br>head(group)<br><br>Sys.time()<br>raw.data &lt;- fread( <span>'GSE150430_npc_scRNA_hg19_processed_data.txt.gz'</span>, <br>                       data.table = <span>F</span>,skip = <span>2</span>)<br>Sys.time()<br><br>dim(raw.data) <span># </span><br>raw.data[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>rownames(raw.data)=raw.data[,<span>1</span>]<br>raw.data=raw.data[,-<span>1</span>]<br>head(group)<br>colnames(raw.data)=rownames(group)<br>head(colnames(raw.data))  <br><br>sce.all &lt;- CreateSeuratObject(counts = raw.data) <br>sce.all &lt;- AddMetaData(object = sce.all, metadata = group)<br> <br>table(sce.all@meta.data$orig.ident)<br><span>library</span>(stringr)<br>sce.all@meta.data$group = substring( sce.all$orig.ident ,<span>1</span>,<span>1</span>) <br>table(sce.all@meta.data$group)<br></code></pre><p data-tool="mdnice编辑器"><strong>「这里省略展示QC代码」</strong></p><pre data-tool="mdnice编辑器"><span></span><code>dir.create(<span>"2-harmony"</span>)<br>getwd()<br>setwd(<span>"2-harmony"</span>)<br><br>sce=sce.all.filt <br>sce<br>sce &lt;- NormalizeData(sce, <br>                         normalization.method = <span>"LogNormalize"</span>,<br>                         scale.factor = <span>1e4</span>) <br>sce &lt;- FindVariableFeatures(sce)<br>sce &lt;- ScaleData(sce)<br>sce &lt;- RunPCA(sce, features = VariableFeatures(object = sce))<br><br><span>library</span>(harmony)<br>seuratObj &lt;- RunHarmony(sce, <span>"orig.ident"</span>)<br>names(seuratObj@reductions)<br>seuratObj &lt;- RunUMAP(seuratObj,  dims = <span>1</span>:<span>15</span>, <br>                     reduction = <span>"harmony"</span>)<br>DimPlot(seuratObj,reduction = <span>"umap"</span>,label=<span>T</span> ) <br><br>sce=seuratObj<br>sce &lt;- FindNeighbors(sce, reduction = <span>"harmony"</span>,<br>                     dims = <span>1</span>:<span>15</span>) <br>sce.all=sce<br><span>#设置不同的分辨率，观察分群效果(选择哪一个？)</span><br><span>for</span> (res <span>in</span> c(<span>0.01</span>, <span>0.05</span>, <span>0.1</span>, <span>0.2</span>, <span>0.3</span>, <span>0.5</span>,<span>0.8</span>,<span>1</span>)) {<br>  sce.all=FindClusters(sce.all, <span>#graph.name = "CCA_snn", </span><br>                       resolution = res, algorithm = <span>1</span>)<br>}<br>colnames(sce.all@meta.data)<br>apply(sce.all@meta.data[,grep(<span>"RNA_snn"</span>,colnames(sce.all@meta.data))],<span>2</span>,table)<br><br><span>#接下来分析，按照分辨率为0.8进行 </span><br>sel.clust = <span>"RNA_snn_res.0.8"</span><br>sce.all &lt;- SetIdent(sce.all, value = sel.clust)<br>table(sce.all@active.ident) <br>saveRDS(sce.all, <span>"sce.all_int.rds"</span>)<br><br>setwd(<span>"../"</span>)<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>定义细胞亚群<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br>options(stringsAsFactors = <span>F</span>)<br><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(clustree)<br><span>library</span>(cowplot)<br><span>library</span>(dplyr)<br>getwd()<br>setwd(<span>'3-cell/'</span>)<br>sce.all=readRDS( <span>"../2-harmony/sce.all_int.rds"</span>)<br>sce.all<br><br><span># 需要自行看图，定细胞亚群： </span><br><span>library</span>(ggplot2) <br>genes_to_check =list(<br>  CM=c(<span>"TTN"</span>,<span>"MYH7"</span>,<span>"MYH6"</span>,<span>"TNNT2"</span>) ,<br>  EC=c(<span>"VWF"</span>, <span>"IFI27"</span>, <span>"PECAM1"</span>,<span>"MGP"</span>),<br>  FB=c(<span>"DCN"</span>, <span>"C7"</span> ,<span>"LUM"</span>,<span>"FBLN1"</span>,<span>"COL1A2"</span>),<br>  MP=c(<span>"CD163"</span>, <span>"CCL4"</span>, <span>"CXCL8"</span>,<span>"PTPRC"</span>),<br>  SMC=c(<span>"ACTA2"</span>, <span>"CALD1"</span>, <span>"MYH11"</span>),<br>  Tc=c(<span>"CD3D"</span>,<span>"CD3E"</span>),<br>  peric=c(<span>"ABCC9"</span>,<span>"PDGFRB"</span>,<span>"RGS5"</span>)<br>)<br>p_all_markers=DotPlot(sce.all, <br>                      features = genes_to_check,<br>                      scale = <span>T</span>,assay=<span>'RNA'</span> )+<br>  theme(axis.text.x=element_text(angle=<span>45</span>,hjust = <span>1</span>))<br>p_all_markers<br><br>celltype=data.frame(ClusterID=<span>0</span>:<span>21</span>,<br>                    celltype= <span>0</span>:<span>21</span>) <br><span>#定义细胞亚群 </span><br>celltype[celltype$ClusterID %<span>in</span>% c(<span>0</span>,<span>3</span>,<span>10</span>),<span>2</span>]=<span>'Bcells'</span>   <br>celltype[celltype$ClusterID %<span>in</span>% c( <span>7</span> ),<span>2</span>]=<span>'plasma'</span>  <br> <br><br>celltype[celltype$ClusterID %<span>in</span>% c( <span>8</span>),<span>2</span>]=<span>'Cycl-T'</span>  <br>celltype[celltype$ClusterID %<span>in</span>% c(<span>1</span>,<span>17</span>),<span>2</span>]=<span>'NKT'</span>  <br>celltype[celltype$ClusterID %<span>in</span>% c(<span>2</span>),<span>2</span>]=<span>'Treg'</span>  <br>celltype[celltype$ClusterID %<span>in</span>% c(<span>4</span>),<span>2</span>]=<span>'naive-T'</span>  <br><br><br>celltype[celltype$ClusterID %<span>in</span>% c(<span>6</span>,<span>11</span> ),<span>2</span>]=<span>'Mac'</span>  <br>celltype[celltype$ClusterID %<span>in</span>% c(<span>15</span> ),<span>2</span>]=<span>'DC'</span> <br>celltype[celltype$ClusterID %<span>in</span>% c(<span>13</span>),<span>2</span>]=<span>'pDC'</span> <br> <br>celltype[celltype$ClusterID %<span>in</span>% c( <span>5</span>,<span>9</span>,<span>12</span>,<span>14</span>,<span>16</span>,<span>18</span>,<span>19</span>,<span>21</span> ),<span>2</span>]=<span>'epi'</span> <br>celltype[celltype$ClusterID %<span>in</span>% c(<span>20</span> ),<span>2</span>]=<span>'stem-epi'</span>  <br><br>head(celltype)<br>celltype<br>table(celltype$celltype)<br>sce.all@meta.data$celltype = <span>"NA"</span><br><span>for</span>(i <span>in</span> <span>1</span>:nrow(celltype)){<br>  sce.all@meta.data[which(sce.all@meta.data$RNA_snn_res.0.8 == celltype$ClusterID[i]),<span>'celltype'</span>] &lt;- celltype$celltype[i]}<br>table(sce.all@meta.data$celltype)<br><br>genes_to_check = c(<span>'PTPRC'</span>, <span>'CD3D'</span>, <span>'CD3E'</span>, <span>'CD4'</span>,<span>'CD8A'</span>, <br>                   <span>'CD68'</span>, <span>'CD163'</span>, <span>'CD14'</span>,  <br>                   <span>'C1QA'</span>,  <span>'C1QB'</span>,  <span># mac</span><br>                   <span>'S100A9'</span>, <span>'S100A8'</span>, <span>'MMP19'</span>,<span># monocyte</span><br>                   <span>'FCGR3A'</span>, <br>                   <span>'KLRB1'</span>,<span>'NCR1'</span>, <span># NK </span><br>                   <span>'FGF7'</span>,<span>'MME'</span>, <span>'ACTA2'</span>, <span>## fibo </span><br>                   <span>'DCN'</span>, <span>'LUM'</span>,  <span>'GSN'</span> , <span>## mouse PDAC fibo </span><br>                   <span>'ZEB1'</span>, <span>'ZEB2'</span>, <span>'PDGFRA'</span> , <span>'SNAI2'</span>,<br>                   <span>'CDKN1A'</span>,<span>'KLF4'</span>,<br>                   <span>'MUC1'</span> ,<span>'EPCAM'</span>,<br>                   <span>'MKI67'</span> , <span>'TOP2A'</span>, <br>                   <span>'PECAM1'</span>, <span>'VWF'</span>,  <span>## endo </span><br>                   <span>'EPCAM'</span> , <span>'KRT19'</span>, <span>'PROM1'</span>, <span>'ALDH1A1'</span> )<br>genes_to_check= unique(genes_to_check)<br>th=theme(axis.text.x = element_text(angle = <span>45</span>, <br>                                    vjust = <span>0.5</span>, hjust=<span>0.5</span>)) <br> <br>p &lt;- DotPlot(sce.all, features = unique(genes_to_check),<br>             assay=<span>'RNA'</span> ,group.by = <span>'celltype'</span> )  + coord_flip()  +th<br><br>p<br>ggsave(plot=p, filename=<span>"check_marker_by_celltype.pdf"</span>,<br>       width = <span>7</span> ,height = <span>8</span>)<br><br><span>library</span>(patchwork)<br>p_all_markers=DotPlot(sce.all, features = genes_to_check,<br>                      assay=<span>'RNA'</span> ,group.by = <span>'celltype'</span> )  + coord_flip()+th<br>p_umap=DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"celltype"</span>,label = <span>T</span>)<br>p_all_markers+p_umap<br>ggsave(<span>'markers_umap_by_celltype.pdf'</span>,width = <span>12</span>,height = <span>8</span>)<br>phe=sce.all@meta.data<br>save(phe,file = <span>'phe-by-markers.Rdata'</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100034976" data-ratio="0.6621621621621622" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibFaib7SEzbymj3JpwbiaZBHibImfQaDvBCTnh76fA9wvxyOTWGPKTpuBnwYG02DGXz3jBjibB7uf7oFQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="962" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibFaib7SEzbymj3JpwbiaZBHibImfQaDvBCTnh76fA9wvxyOTWGPKTpuBnwYG02DGXz3jBjibB7uf7oFQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><h4 data-tool="mdnice编辑器"><span></span>之后提取了 GSE150825, GSE150430, GSE162025 每个数据集中的髓系进行亚群细分，还是以GSE150430为例<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(clustree)<br><span>library</span>(cowplot)<br><span>library</span>(dplyr)<br><span>library</span>(patchwork)<br><br>getwd()<br>dir.create(<span>"./outputs"</span>)<br>setwd(<span>"./outputs/"</span>)<br><br>sce =readRDS( <span>"../../2-harmony/sce.all_int.rds"</span>)<br>sce <br>load(<span>'../../3-cell/phe-by-markers.Rdata'</span>)<br><br>colnames(sce@meta.data)<br>DimPlot(sce, reduction = <span>"umap"</span>, label = <span>T</span>) + <br>  DimPlot(sce, reduction = <span>"umap"</span>,group.by = <span>'orig.ident'</span>, label = <span>T</span>)<br>ggsave(<span>'umap_check_harmony.pdf'</span>,width = <span>15</span>)<br><br>sce@meta.data = phe<br><br>table(sce$orig.ident) <br>table(sce$celltype) <br>table(sce$group)<br><br>sce=sce[,sce$celltype %<span>in</span>% c(<span>'DC'</span>,<span>'Mac'</span>,<span>'pDC'</span>)]<br>sce<br><br>sce=CreateSeuratObject(counts = sce@assays$RNA@counts,<br>                       meta.data = sce@meta.data[,<span>1</span>:<span>9</span>])<br><span># sce@meta.data[,1:9]</span><br>save(sce,file = <span>'myeloids_sce.Rdata'</span>)<br><span>#load(file = 'myeloids_sce.Rdata')</span><br></code></pre><h4 data-tool="mdnice编辑器"><span></span>降维分群<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>sce &lt;- NormalizeData(sce, normalization.method =  <span>"LogNormalize"</span>,  <br>                     scale.factor = <span>1e4</span>)<br>GetAssay(sce,assay = <span>"RNA"</span>)<br>sce &lt;- FindVariableFeatures(sce, <br>                            selection.method = <span>"vst"</span>, nfeatures = <span>2000</span>)  <br>sce &lt;- ScaleData(sce) <br>sce &lt;- RunPCA(object = sce, pc.genes = VariableFeatures(sce)) <br>DimHeatmap(sce, dims = <span>1</span>:<span>12</span>, cells = <span>100</span>, balanced = <span>TRUE</span>)<br>ElbowPlot(sce) <br><br>sce &lt;- FindNeighbors(sce, dims = <span>1</span>:<span>15</span>)<br>sce &lt;- FindClusters(sce, resolution = <span>0.8</span>)<br>table(sce@meta.data$RNA_snn_res.0.8)  <br><br>set.seed(<span>123</span>)<br>sce &lt;- RunTSNE(object = sce, dims = <span>1</span>:<span>15</span>, do.fast = <span>TRUE</span>)<br>DimPlot(sce,reduction = <span>"tsne"</span>,label=<span>T</span>)<br>ggsave(filename = <span>'before_harmony_tsne.pdf'</span>) <br><br>sce &lt;- RunUMAP(object = sce, dims = <span>1</span>:<span>15</span>, do.fast = <span>TRUE</span>)<br>DimPlot(sce,reduction = <span>"umap"</span>,label=<span>T</span>) <br>ggsave(filename = <span>'before_harmony_umap.pdf'</span>) <br>head(sce@meta.data)<br>DimPlot(sce,reduction = <span>"umap"</span>,label=<span>T</span>,group.by = <span>'orig.ident'</span>) <br>ggsave(filename = <span>'before_harmony_umap_orig.ident.pdf'</span>) <br><br><br>sce &lt;- FindClusters(sce, resolution = <span>0.1</span>)<br>DimPlot(sce,reduction = <span>"umap"</span>,label=<span>T</span>) <br>ggsave(filename = <span>'before_harmony_umap_recluster_by_0.1.pdf'</span>) <br>DimPlot(sce,reduction = <span>"umap"</span>,label=<span>T</span>,<br>        group.by = <span>'orig.ident'</span>) <br>ggsave(filename = <span>'before_harmony_umap_sce_recluster_by_orig.ident.pdf'</span>)<br> <br><br>tab.1=table(sce@meta.data$orig.ident,sce@meta.data$seurat_clusters)<br>colnames(sce@meta.data)   <br><span>library</span>(gplots)<br>tab.1 <br>pro=<span>'before_harmony'</span><br>pdf(file = paste0(pro,<span>'  seurat_clusters VS  orig.ident.pdf'</span>),<br>    width = <span>9</span>,height  = <span>8</span>)<br>balloonplot(tab.1, main =<span>" seurat_clusters VS  orig.ident "</span>, xlab =<span>""</span>, ylab=<span>""</span>,<br>            label = <span>T</span>, show.margins = <span>F</span>)<br>dev.off() <br><br>colnames(sce@meta.data)  <br><br><span>library</span>(harmony)<br>seuratObj &lt;- RunHarmony(sce, <span>"orig.ident"</span>)<br>names(seuratObj@reductions)<br>seuratObj &lt;- RunUMAP(seuratObj,  dims = <span>1</span>:<span>15</span>, <br>                     reduction = <span>"harmony"</span>)<br>DimPlot(seuratObj,reduction = <span>"umap"</span>,label=<span>T</span> )  <br><br><br>sce=seuratObj<br>sce &lt;- FindNeighbors(sce, reduction = <span>"harmony"</span>,<br>                     dims = <span>1</span>:<span>15</span>)<br>sce &lt;- FindClusters(sce, resolution = <span>0.1</span>)<br>table(sce@meta.data$seurat_clusters)<br>DimPlot(sce,reduction = <span>"umap"</span>,label=<span>T</span>) <br>ggsave(filename = <span>'harmony_umap_recluster_by_0.1.pdf'</span>) <br>DimPlot(sce,reduction = <span>"umap"</span>,label=<span>T</span>,<br>        group.by = <span>'orig.ident'</span>) <br>ggsave(filename = <span>'harmony_umap_sce_recluster_by_orig.ident.pdf'</span>)  <br><br>tab.1=table(sce@meta.data$orig.ident,sce@meta.data$seurat_clusters)<br>colnames(sce@meta.data)   <br><span>library</span>(gplots)<br>tab.1 <br>pro=<span>'after_harmony'</span><br>pdf(file = paste0(pro,<span>'  seurat_clusters VS  orig.ident.pdf'</span>),<br>    width = <span>8</span>,height  = <span>8</span>)<br>balloonplot(tab.1, main =<span>" seurat_clusters VS  orig.ident "</span>, <br>            xlab =<span>""</span>, ylab=<span>""</span>,<br>            label = <span>T</span>, show.margins = <span>F</span>)<br>dev.off() <br><br><br>save(sce,file = <span>'first_sce.Rdata'</span>)<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>定义细胞亚群<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(clustree)<br><span>library</span>(cowplot)<br><span>library</span>(dplyr)<br><br>getwd()<br>setwd(<span>"./outputs/"</span>)<br>load(file = <span>'first_sce.Rdata'</span>)<br>colnames(sce@meta.data)<br>table(sce$orig.ident)<br>table(sce$seurat_clusters)<br><br>sce &lt;- FindClusters(sce, resolution = <span>0.8</span>)<br>DimPlot(sce,reduction = <span>"umap"</span>,label=<span>T</span> )  <br><br>sel.clust = <span>"RNA_snn_res.0.8"</span><br>sce &lt;- SetIdent(sce, value = sel.clust)<br>table(sce@active.ident)<br><br>Mac=c(<span>"CD14"</span>, <span>"CD163"</span>, <span>"APOE"</span>, <span>"C1QA"</span>, <span>"C1QB"</span>, <span>"C1QC"</span>)<br>pDC=c(<span>"LILRA4"</span>, <span>"IL3RA"</span>,<span>"TCF4"</span>,<span>"TCL1A"</span>,<span>"CLEC4C"</span>)<br>DC1=c(<span>"CLEC9A"</span>, <span>"XCR1"</span>, <span>"BATF3"</span>)  <br>DC2=c(<span>"CD1A"</span>, <span>"FCER1A"</span>, <span>"CD1C"</span>,<span>"CD1E"</span>,<span>"CLEC10A"</span>)<br>DC3=c(<span>"CCR7"</span>, <span>"LAMP3"</span>, <span>"FSCN1"</span>,<span>"CCL22"</span>,<span>"BIRC3"</span>)<br>Mono=c(<span>"VCVN"</span>, <span>"FCN1"</span>, <span>"S100A12"</span>, <span>"S100A8"</span>, <span>"S100A9"</span>,<span>'FCGR3A'</span>)<br>genes_to_check =list(<br>  Mac=Mac,<br>  pDC=pDC,<br>  DC1=DC1, <br>  DC2=DC2,<br>  DC3=DC3 ,<br>  Mono=Mono<br>)<br><span>library</span>(stringr)<br>genes_to_check = lapply(genes_to_check, str_to_upper)<br>p_all_markers=DotPlot(sce , <br>                      features = genes_to_check,<br>                      scale = <span>T</span>,assay=<span>'RNA'</span> )+<br>  theme(axis.text.x=element_text(angle=<span>45</span>,hjust = <span>1</span>))<br>p_all_markers<br>ggsave(<span>'check_myeloids_markers.pdf'</span>,height = <span>11</span>,width = <span>11</span>)<br><br>celltype=data.frame(ClusterID=<span>0</span>:<span>13</span>,<br>                      celltype=<span>0</span>:<span>13</span> )   <br>  <br>  celltype[celltype$ClusterID %<span>in</span>% c( <span>13</span> ),<span>2</span>]=<span>'mast'</span>  <br>  celltype[celltype$ClusterID %<span>in</span>% c(  <span>9</span>),<span>2</span>]=<span>'DC1'</span>  <br>  celltype[celltype$ClusterID %<span>in</span>% c( <span>2</span>,<span>10</span>,<span>11</span>),<span>2</span>]=<span>'DC2'</span>  <br>  celltype[celltype$ClusterID %<span>in</span>% c(  <span>6</span>),<span>2</span>]=<span>'DC3'</span><br>  celltype[celltype$ClusterID %<span>in</span>% c(  <span>1</span>),<span>2</span>]=<span>'pDC'</span><br>  <br>  celltype[celltype$ClusterID %<span>in</span>% c( <span>5</span>),<span>2</span>]=<span>'Mac-mono'</span><br>  celltype[celltype$ClusterID %<span>in</span>% c( <span>4</span> ),<span>2</span>]=<span>'mono'</span> <br>  celltype[celltype$ClusterID %<span>in</span>% c( <span>0</span>,<span>3</span> ),<span>2</span>]=<span>'mac'</span>   <br>  <br>  celltype[celltype$ClusterID %<span>in</span>% c( <span>8</span>),<span>2</span>]=<span>'cycling'</span>  <br>  celltype[celltype$ClusterID %<span>in</span>% c( <span>7</span>,<span>12</span>),<span>2</span>]=<span>'B-meyiod'</span> <br>  <br>  <br>  head(celltype)<br>  celltype <br>  table(celltype$celltype)<br>  <br>  sce@meta.data$celltype = <span>"NA"</span><br>  table(sce@meta.data$RNA_snn_res.0.8 )<br>  <br>  <span>for</span>(i <span>in</span> <span>1</span>:nrow(celltype)){<br>    sce@meta.data[which(sce@meta.data$RNA_snn_res.0.8 == celltype$ClusterID[i]),<span>'celltype'</span>] &lt;- celltype$celltype[i]}<br>  table(sce@meta.data$celltype)<br>  <br>  table(sce@meta.data$celltype)<br>  DimPlot(sce, reduction = <span>"umap"</span>, <br>          group.by = <span>"celltype"</span>,label = <span>T</span>,label.box = <span>T</span>) <br>  ggsave(<span>'umap_bycelltype.pdf'</span>,height = <span>7</span>,width = <span>8</span>)<br><br>sce.all=sce<br>  save(sce.all,file = <span>'second_sce.Rdata'</span>)<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>在GSE150825, GSE150430, GSE162025 每个数据集中的髓系亚群细分结束后，会存成Rdata数据，之后将三组数据整合读取重新降维分群，再继续分析。<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(clustree)<br><span>library</span>(cowplot)<br><span>library</span>(dplyr)<br><br>load(<span>'./inputs/GSE150430/second_sce.Rdata'</span>)<br>GSE150430 = sce.all<br>GSE150430$study = <span>'GSE150430'</span><br><br>load(<span>'./inputs/GSE150825/second_sce2.Rdata'</span>)<br>GSE150825 = sce.all<br>GSE150825$study = <span>'GSE150825'</span><br><br>load(<span>'./inputs/GSE162025/second_sce.Rdata'</span>)<br>GSE162025 = sce <br>GSE162025$study = <span>'GSE162025'</span><br><br>sce = merge(GSE150430,list(GSE150825,GSE162025),<br>            add.cell.ids = c(<span>'GSE150430'</span>,<span>'GSE150825'</span>,<span>'GSE162025'</span>))<br>table(sce$study)<br>colnames(sce@meta.data)<br>sce=CreateSeuratObject(counts = sce@assays$RNA@counts,<br>                       meta.data = sce@meta.data )<br>sce<br>table(sce$group)<br>save(sce,file = <span>'input.Rdata'</span>)<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>之后的步骤大家可以自己探索一下。<span></span></h4><h3 data-tool="mdnice编辑器"><span></span><span>微信交流群</span><span></span></h3><p data-tool="mdnice编辑器">如果你也想参与到群里的讨论中，给我提出一些推文更新建议的话欢迎入群。同时你也可以得到我前期更新的所有数据及代码，在群里我会把代码分享给大家，而且大家可以在群里「提出自己感兴趣的单细胞文献」<strong>「我们尽可能优先选择大家的数据集去复现和实战，也欢迎大家在群里分享更多其它资料，咱们一起进步，」</strong>比较高级的单细胞分析 我们也会一起尝试，相信你肯定是会不虚此行哈。</p><p data-tool="mdnice编辑器">附上之前推文的链接 <a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247512238&amp;idx=1&amp;sn=e0c6dc2ea0e089aabb78133e50fb5d7f&amp;scene=21#wechat_redirect" data-linktype="2">为爱发电不可取（单细胞周更需要你的支持）</a></p><p data-tool="mdnice编辑器"><strong>「「目前群里已有400多人，所以你想要进群的话就需要添加我的微信，私聊给我发99元的红包，我把你拉进群里。」」</strong></p><p data-tool="mdnice编辑器">我们这个群是真正的付费交流群，提供数据，代码，学习资料。如果介意99元的门槛且不认可我们知识分享的理念，<strong>「请不要加我好友」</strong>。因个人时间有限，不能及时回复还请见谅，再说明一下<strong>「群里并没有一对一答疑服务」</strong>，只是知识分享相互交流。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100034973" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibFaib7SEzbymj3JpwbiaZBHiburiafUHMgDOR99IAHb7dzjCkiboEOLBmsqbCcZrTHdF0gItWeSS56ZFQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="172" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibFaib7SEzbymj3JpwbiaZBHiburiafUHMgDOR99IAHb7dzjCkiboEOLBmsqbCcZrTHdF0gItWeSS56ZFQ/640?wx_fmt=png&amp;from=appmsg"></figure></section><section><p><br></p><section data-style-type="5" data-tools="新媒体排版" data-id="2440476"><section><section><section><section><img data-ratio="0.9495798319327731" data-src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif" data-type="gif" data-w="119" data-width="100%" data-imgfileid="100035820" src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif"></section><section data-brushtype="text">往期回顾</section><section><br></section></section></section></section><section><section data-autoskip="1"><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247519465&amp;idx=1&amp;sn=5c3ea4dbf522dad212081206a1d02844&amp;chksm=ea1c8a6bdd6b037d65cf0d19e1602f5cc5bab99f762ea709e31c0f3322e35f8408536de01196&amp;scene=21#wechat_redirect" textvalue="聚类分群如何在保持坐标轴和配色不变的情况下标定特定亚群" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>聚类分群如何在保持坐标轴和配色不变的情况下标定特定亚群</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247519406&amp;idx=1&amp;sn=f393c95d3914cac771ac9f12a77ff71d&amp;chksm=ea1c8a2cdd6b033a6cdf8f6e9df58657778a18749521a891257f20c4765f68538f8662d61fe4&amp;scene=21#wechat_redirect" textvalue="百创S3000抢先体验 || 让空间组学性能再迈一步" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>百创S3000抢先体验 || 让空间组学性能再迈一步</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247519358&amp;idx=1&amp;sn=bf3383070648e6e214fb288c3d4ea4b0&amp;chksm=ea1c8afcdd6b03ea4cb46c854904ad2c9a1712079d6eb1403dd90f85377917913146ec4048fd&amp;scene=21#wechat_redirect" textvalue="python的scanpy库读取几种常见格式的单细胞数据文件汇总" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2"><span>python的scanpy库读取几种常见格式的单细胞数据文件汇总</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247519358&amp;idx=2&amp;sn=a5422675597371f57f76226bf02aee6f&amp;chksm=ea1c8afcdd6b03ea505f95b2de74b916a3143f41003b6dea33531f380cc7688d000e037b51b3&amp;scene=21#wechat_redirect" textvalue="探索AnnData数据对象，揭开它的" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2"><span>探索AnnData数据对象，揭开它的</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247519356&amp;idx=1&amp;sn=d11ab047c4bbc13d2a7e8ab866629bd7&amp;chksm=ea1c8afedd6b03e890ecea7adcb2baaee17ca0dd1fbbae96ae4bdd6a91d4e45bf3f284a55f0d&amp;scene=21#wechat_redirect" textvalue="小鼠急性肾损伤AKI模型的单细胞分析" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>小鼠急性肾损伤AKI模型的单细胞分析</span></a><br></p></section></section><hr><p><br></p></section><section data-style-type="5" data-tools="新媒体排版" data-id="2440475"><hr><p><br></p><hr><section><p>如果你对单细胞转录组研究感兴趣，但又不知道如何入门，也许你可以关注一下下面的课程<span></span></p><p><br></p><ul><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247527207&amp;idx=1&amp;sn=fb9ca814003fc24e9ec8b1bcecbd1d56&amp;chksm=9b4b2b9cac3ca28afc5b68047e5f0587b6636d52879051decd573009e38313c5f7d6b0d1927d&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课2024年1月班" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信入门&amp;数据挖掘线上直播课2024年1月班</a><br></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526168&amp;idx=1&amp;sn=ebc4a9d53d675e3f7d20b1e2f97901b8&amp;chksm=9b4b27a3ac3caeb5ee0828c38f816c229067d1946be224bcaf4bac0dbdfc9eff863c621097e2&amp;scene=21#wechat_redirect" textvalue="生物信息学江湖的开创性产品-共享服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学江湖的开创性产品-共享服务器</a></p></li></ul><p><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif" data-type="gif" data-w="240" data-imgfileid="100035819" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif"><br></p><p><img data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg" data-type="other" data-w="341" data-imgfileid="100035818" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p></section><section><section data-id="93668"><section><section data-width="95%"><section><section><section data-width="38%"><section><section data-tools="135编辑器" data-id="93668"><section><section data-width="95%"><section><section><section data-width="61.8%"><section><section><section><p><br></p><span><strong data-burshtype="text"><img data-copyright="0" data-cropselx1="0" data-cropselx2="109" data-cropsely1="0" data-cropsely2="109" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg" data-type="other" data-w="258" title="qrcode_for_gh_5a3c482ed99f_1280.jpg" data-imgfileid="100035822" src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg"><strong data-burshtype="text">生物</strong><strong data-burshtype="text"> | 单细胞 | 转录组丨资料</strong></strong></span></section><section><span><strong data-burshtype="text">每天都精彩</strong></span></section></section></section><section><section><section><section><section><section><p><span>长按扫码可关注</span></p></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section><p><br></p></section></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Jn2fxT9VSm7einBhi8Tixw",target="_blank" rel="noopener noreferrer">原文链接</a>
