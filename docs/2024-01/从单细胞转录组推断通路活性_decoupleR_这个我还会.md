---
title: "从单细胞转录组推断通路活性？decoupleR：这个我还会"
date: 2024-01-18T01:01:15Z
draft: ["false"]
tags: [
  "fetched",
  "生信益站"
]
categories: ["Acdemic"]
---
从单细胞转录组推断通路活性？decoupleR：这个我还会 by 生信益站
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><figure data-tool="mdnice编辑器"><img data-imgfileid="100021814" data-ratio="0.278125" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8OGmEwrxsGHABToZMxtcEEWaaOtdw16WPKVCuUYRtOmsZkcbKl5Xp4w/640?wx_fmt=gif&amp;from=appmsg" data-type="gif" data-w="640" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8OGmEwrxsGHABToZMxtcEEWaaOtdw16WPKVCuUYRtOmsZkcbKl5Xp4w/640?wx_fmt=gif&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><code>生信益站，一点就有益</code>！<strong>「祝友友们天天开心，月月发 CNS~」</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzU1NTk0MTUxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/mhoJzVKWSibicV5ezibIjic3zhPgzQcTD8N0hm3q2fO2QgBoVFIuRWy6BKffGjfXOzI7foLDlyrHWfRUMkicOCSKq4g/0?wx_fmt=png" data-nickname="生信益站" data-alias="" data-signature="生物信息或基因测序数据分析、软件算法、科研绘图、Python/Perl/R代码分享。" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器">关于 <code>decoupleR</code>，站长已经写了 <code>2</code> 篇推文了，不过都是基于 <code>bulk RNA-seq</code>：</p><ol data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU1NTk0MTUxMg==&amp;mid=2247505149&amp;idx=1&amp;sn=0f0cc15b78ad53b739c1cb48271f9801&amp;chksm=fbce3f1accb9b60c9c14aeb95c45ce6d3e59cedd237daf46bc0f951b12d0649c3b0a2b2f9378&amp;scene=21#wechat_redirect" textvalue="哪些基因激活/抑制了你的通路？decoupleR (一)：这个我会" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">哪些基因激活/抑制了你的通路？decoupleR (一)：这个我会</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU1NTk0MTUxMg==&amp;mid=2247505188&amp;idx=1&amp;sn=a5d4693d256c72ebeedbf7ce9c99d578&amp;chksm=fbce3ec3ccb9b7d57491ab2e00d1717a59fbfb0b261b820c1c77dd5881a4bf1f95f1f74ff34a&amp;scene=21#wechat_redirect" textvalue="如何用转录组推断转录因子活性？decoupleR (二)：这个我也会！" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">如何用转录组推断转录因子活性？decoupleR (二)：这个我也会！</a></section></li></ol><p data-tool="mdnice编辑器">今天给大家带来 <code>decoupleR</code> 第 <code>3</code> 篇——从 <code>scRNA-seq</code> 推断<code>通路活性</code>。</p><h2 data-tool="mdnice编辑器"><span></span><span>加载包</span><span></span></h2><p data-tool="mdnice编辑器">首先，我们需要加载相关包，<code>Seurat</code> 用来处理 scRNA-seq 数据，<code>deCoupleR</code> 来使用统计方法。</p><pre data-tool="mdnice编辑器"><span></span><code><span>## We load the required packages</span><br><span>library</span>(Seurat)<br><span>library</span>(decoupleR)<br><br><span># Only needed for data handling and plotting</span><br><span>library</span>(dplyr)<br><span>library</span>(tibble)<br><span>library</span>(tidyr)<br><span>library</span>(patchwork)<br><span>library</span>(ggplot2)<br><span>library</span>(pheatmap)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>加载数据集</span><span></span></h2><p data-tool="mdnice编辑器">在这里，我们使用了 Seurat 小插图中使用的数据的下采样版本。我们可以这样打开数据：</p><pre data-tool="mdnice编辑器"><span></span><code>inputs_dir &lt;- system.file(<span>"extdata"</span>, package = <span>"decoupleR"</span>)<br>data &lt;- readRDS(file.path(inputs_dir, <span>"sc_data.rds"</span>))<br></code></pre><p data-tool="mdnice编辑器">我们可以观察到有不同的细胞类型：</p><pre data-tool="mdnice编辑器"><span></span><code>DimPlot(data, reduction = <span>"umap"</span>, label = <span>TRUE</span>, pt.size = <span>0.5</span>) + NoLegend()<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100021810" data-ratio="0.6175925925925926" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8RKzV5VbDF0HtBCtIzgctXDHLdicogu7pPVxUQpuMM5YDiaR6Zm7J8xgg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8RKzV5VbDF0HtBCtIzgctXDHLdicogu7pPVxUQpuMM5YDiaR6Zm7J8xgg/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>PROGENy 模型</span><span></span></h2><p data-tool="mdnice编辑器"><code>PROGENy</code>是一个综合资源，包含精选的通路及其目标基因集合，以及每个相互作用的<code>权重</code>。对于此示例，我们将使用人类体重（也可以使用其他生物体），并且我们将使用按 <code>p</code> 值排名的前 500 个响应基因。以下是每个通路的简要说明：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100021812" data-ratio="0.6592592592592592" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8Q3KQWnm2vadxqOafn9jNYtWocYzicrdyvAldZ9UZakwJ2Y4lwIjic5Yw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8Q3KQWnm2vadxqOafn9jNYtWocYzicrdyvAldZ9UZakwJ2Y4lwIjic5Yw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">要访问它，我们可以使用 <code>decoupleR</code>：</p><pre data-tool="mdnice编辑器"><span></span><code>net &lt;- get_progeny(organism = <span>'human'</span>, top = <span>500</span>)<br>net<br><span>#&gt; # A tibble: 7,000 × 4</span><br><span>#&gt;    source   target  weight  p_value</span><br><span>#&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span><br><span>#&gt;  1 Androgen TMPRSS2  11.5  2.38e-47</span><br><span>#&gt;  2 Androgen NKX3-1   10.6  2.21e-44</span><br><span>#&gt;  3 Androgen MBOAT2   10.5  4.63e-44</span><br><span>#&gt;  4 Androgen KLK2     10.2  1.94e-40</span><br><span>#&gt;  5 Androgen SARG     11.4  2.79e-40</span><br><span>#&gt;  6 Androgen SLC38A4   7.36 1.25e-39</span><br><span>#&gt;  7 Androgen MTMR9     6.13 2.53e-38</span><br><span>#&gt;  8 Androgen ZBTB16   10.6  1.57e-36</span><br><span>#&gt;  9 Androgen KCNN2     9.47 7.71e-36</span><br><span>#&gt; 10 Androgen OPRK1    -5.63 1.11e-35</span><br><span>#&gt; # ℹ 6,990 more rows</span><br></code></pre><p data-tool="mdnice编辑器">在线地址：https://saezlab.github.io/progeny/</p><h2 data-tool="mdnice编辑器"><span></span><span>使用多元线性模型 (MLM) 进行活性推断</span><span></span></h2><p data-tool="mdnice编辑器">为了推断通路富集分数，我们将运行多元线性模型 ( mlm) 方法。对于我们数据集中的每个样本 ( mat)，它拟合一个线性模型，该模型根据所有通路的通路-基因相互作用权重预测观察到的基因表达。拟合后，获得的斜率 t 值就是分数。如果它是正数，我们解释该通路是活跃的，如果它是负数，我们解释它是不活跃的。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100021813" data-ratio="0.7620370370370371" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8hEKGIK4jyPFKib2eJ6XFeIrYx5G2dxZXe31GGOdc1VTXJSnx7a2eEIg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8hEKGIK4jyPFKib2eJ6XFeIrYx5G2dxZXe31GGOdc1VTXJSnx7a2eEIg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">要运行 <code>decoupleR</code> 方法，我们需要一个输入矩阵 ( <code>mat</code>)、一个输入先验知识网络/资源 ( 上一步得到的 <code>net</code>) 以及我们要使用的网络<code>列名</code>。</p><pre data-tool="mdnice编辑器"><span></span><code><span># Extract the normalized log-transformed counts</span><br>mat &lt;- as.matrix(data@assays$RNA@data)<br><br><span># Run mlm</span><br>acts &lt;- run_mlm(mat=mat, net=net, .source=<span>'source'</span>, .target=<span>'target'</span>,<br>                .mor=<span>'weight'</span>, minsize = <span>5</span>)<br>acts<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>可视化</span><span></span></h2><p data-tool="mdnice编辑器">根据获得的结果，我们将选择活性并将它们存储在我们的对象中作为新的 <code>assay</code>，称为 <code>pathwaysmlm</code>：</p><pre data-tool="mdnice编辑器"><span></span><code><span># Extract mlm and store it in pathwaysmlm in data</span><br>data[[<span>'pathwaysmlm'</span>]] &lt;- acts %&gt;%<br>  pivot_wider(id_cols = <span>'source'</span>, names_from = <span>'condition'</span>,<br>              values_from = <span>'score'</span>) %&gt;%<br>  column_to_rownames(<span>'source'</span>) %&gt;%<br>  Seurat::CreateAssayObject(.)<br><br><span># Change assay</span><br>DefaultAssay(object = data) &lt;- <span>"pathwaysmlm"</span><br><br><span># Scale the data</span><br>data &lt;- ScaleData(data)<br>data@assays$pathwaysmlm@data &lt;- data@assays$pathwaysmlm@scale.data<br></code></pre><p data-tool="mdnice编辑器">这种新的 <code>assay</code> 可用于绘制活性图。在这里，我们可视化与细胞凋亡相关的 Trail 通路，该通路似乎在 B 细胞中更为活跃。</p><pre data-tool="mdnice编辑器"><span></span><code>p1 &lt;- DimPlot(data, reduction = <span>"umap"</span>, label = <span>TRUE</span>, pt.size = <span>0.5</span>) +<br>  NoLegend() + ggtitle(<span>'Cell types'</span>)<br>p2 &lt;- (FeaturePlot(data, features = c(<span>"Trail"</span>)) &amp;<br>  scale_colour_gradient2(low = <span>'blue'</span>, mid = <span>'white'</span>, high = <span>'red'</span>)) +<br>  ggtitle(<span>'Trail activity'</span>)<br>p1 | p2<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100021811" data-ratio="0.5" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8v9MNQXIxTMLlFk0ApjAkqc62gicQK3Lo9FGE1uNGgrYA1ww3ZKccKYQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8v9MNQXIxTMLlFk0ApjAkqc62gicQK3Lo9FGE1uNGgrYA1ww3ZKccKYQ/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>探索</span><span></span></h2><p data-tool="mdnice编辑器">我们还可以看到每组跨通路的平均活性是多少：</p><pre data-tool="mdnice编辑器"><span></span><code><span># Extract activities from object as a long dataframe</span><br>df &lt;- t(as.matrix(data@assays$pathwaysmlm@data)) %&gt;%<br>  as.data.frame() %&gt;%<br>  mutate(cluster = Idents(data)) %&gt;%<br>  pivot_longer(cols = -cluster, names_to = <span>"source"</span>, values_to = <span>"score"</span>) %&gt;%<br>  group_by(cluster, <span>source</span>) %&gt;%<br>  summarise(mean = mean(score))<br><br><span># Transform to wide matrix</span><br>top_acts_mat &lt;- df %&gt;%<br>  pivot_wider(id_cols = <span>'cluster'</span>, names_from = <span>'source'</span>,<br>              values_from = <span>'mean'</span>) %&gt;%<br>  column_to_rownames(<span>'cluster'</span>) %&gt;%<br>  as.matrix()<br><br><span># Choose color palette</span><br>palette_length = <span>100</span><br>my_color = colorRampPalette(c(<span>"Darkblue"</span>, <span>"white"</span>,<span>"red"</span>))(palette_length)<br><br>my_breaks &lt;- c(seq(-<span>2</span>, <span>0</span>, length.out=ceiling(palette_length/<span>2</span>) + <span>1</span>),<br>               seq(<span>0.05</span>, <span>2</span>, length.out=floor(palette_length/<span>2</span>)))<br><br><span># Plot</span><br>pheatmap(top_acts_mat, border_color = <span>NA</span>, color=my_color, breaks = my_breaks)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100021819" data-ratio="0.6175925925925926" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8WDnelm2gPibQCQXkyVxSVDKIlqwrL5F5FTQf4kN8fT2u63golltsjtA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8WDnelm2gPibQCQXkyVxSVDKIlqwrL5F5FTQf4kN8fT2u63golltsjtA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">在这个具体例子中，我们可以观察到 Trail 在 B 细胞中更加活跃。</p><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">OK，今天的分享到此为止。咱们明天见~</p><h2 data-tool="mdnice编辑器"><span></span><span>联系站长</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p>对<code>本篇文章有疑问</code>，或者有<code>科研服务需求</code>的友友可以在益站<code>发消息留言</code>，也欢迎各位童鞋<code>扫下面的二维码</code>加入我们的 <code>QQ</code> 交流群。</p><span>❞</span></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100021820" data-ratio="0.7277777777777777" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8olRDLbaRyxlvkTdI9qZocIA38HDbZYLePjktLibV36qP9RJxD5GJwVQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8olRDLbaRyxlvkTdI9qZocIA38HDbZYLePjktLibV36qP9RJxD5GJwVQ/640?wx_fmt=png&amp;from=appmsg"><figcaption><span></span>科研服务</figcaption></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100021818" data-ratio="1.5" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8A0EW2Jcic7l1GQuDW1OLicDSZQYdn9ht9IrjjUFYKK1NwNFW7ia0V1ryw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="512" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8A0EW2Jcic7l1GQuDW1OLicDSZQYdn9ht9IrjjUFYKK1NwNFW7ia0V1ryw/640?wx_fmt=jpeg&amp;from=appmsg"><figcaption><span></span>最新QQ群</figcaption></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100021816" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8ibpkDicWBmic4rWUzt2JKPSocso2JIHT7L4jv94SbFNyhB8iaKqlXtcA5g/640?wx_fmt=gif&amp;from=appmsg" data-type="gif" data-w="240" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/mhoJzVKWSib9clw9B3qTBwIUptBkA44R8ibpkDicWBmic4rWUzt2JKPSocso2JIHT7L4jv94SbFNyhB8iaKqlXtcA5g/640?wx_fmt=gif&amp;from=appmsg"><figcaption><span></span>您的<code>关注、点赞、在看、转发</code>是对益站最大的<code>鼓励和支持</code>哈</figcaption></figure></section><section><mp-common-profile data-pluginname="mpprofile" data-id="MzU1NTk0MTUxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/mhoJzVKWSibicV5ezibIjic3zhPgzQcTD8N0hm3q2fO2QgBoVFIuRWy6BKffGjfXOzI7foLDlyrHWfRUMkicOCSKq4g/0?wx_fmt=png" data-nickname="生信益站" data-alias="" data-signature="生物信息或基因测序数据分析、软件算法、科研绘图、Python/Perl/R代码分享。" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/kK5QlE5OJUx_COx0W4G8vA",target="_blank" rel="noopener noreferrer">原文链接</a>
