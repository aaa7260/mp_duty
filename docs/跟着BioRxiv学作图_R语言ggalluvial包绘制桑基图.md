---
title: "跟着BioRxiv学作图：R语言ggalluvial包绘制桑基图"
date: 2022-09-09T01:36:54Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Acdemic"]
---
跟着BioRxiv学作图：R语言ggalluvial包绘制桑基图 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><h2 data-tool="mdnice编辑器"><span></span><span>论文</span><span> </span></h2><blockquote data-tool="mdnice编辑器"><p>Environmentally robust cis-regulatory changes underlie rapid climatic adaptation</p></blockquote><p data-tool="mdnice编辑器">https://www.biorxiv.org/content/10.1101/2022.08.29.505745v1<span title="DOI: 10.1101/2022.08.29.505745v1" es-id-type="DOI" es-id="10.1101/2022.08.29.505745v1" es-collect-button-id="0"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewbox="0 0 1000 1000" enable-background="new 0 0 1000 1000" height="1em"><g><path d="M852.3,135.6l-47.7,48.3c157.6,178.7,157.4,451,0.1,631l48.8,49.5C1035.9,672.1,1035.5,327.2,852.3,135.6z M740.9,248.6l-49.3,49.9c96.1,115.5,96.1,285.8,0.5,402.1l48.8,49.6C863.4,606.1,863.6,391.5,740.9,248.6z M195.4,183.9l-47.7-48.3c-183.2,191.6-183.6,536.5-1.2,728.8l48.8-49.5C37.9,635,37.8,362.6,195.4,183.9z M259.1,248.6C136.4,391.5,136.6,606.1,259,750.3l48.8-49.6c-95.6-116.4-95.6-286.6,0.4-402.1L259.1,248.6z M499.8,340.4c-87.3,0-158.1,71.8-158.1,160.4c0,88.5,70.8,160.4,158.1,160.4c87.3,0,158.1-71.8,158.1-160.4C657.8,412.2,587,340.4,499.8,340.4z"></path></g></svg></span></p><p data-tool="mdnice编辑器"><code>2022.08.29.505745v1.full.pdf</code></p><p data-tool="mdnice编辑器">还没有发表,论文的数据和代码都公开https://github.com/malballinger/BallingerMack_NYBZase_2022</p><p data-tool="mdnice编辑器">今天的推文我们重复一下论文中的Figure3C</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5145161290322581" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk63h61zTaUKyQTiaJRx9dibCxn5XYCIicCpqajm3iacmKCsjtZWibUTozicTKWIvwX1DjfhicZuWg4YNSQiaQ/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk63h61zTaUKyQTiaJRx9dibCxn5XYCIicCpqajm3iacmKCsjtZWibUTozicTKWIvwX1DjfhicZuWg4YNSQiaQ/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">这里桑基图实现是借助R包 ggalluvial</p><p data-tool="mdnice编辑器">帮助文档</p><p data-tool="mdnice编辑器">https://cran.r-project.org/web/packages/ggalluvial/vignettes/ggalluvial.html#:~:text=The%20ggalluvial%20package%20is%20a,the%20feedback%20of%20many%20users.</p><p data-tool="mdnice编辑器">或者直接通过命令查看<code>help(package="ggalluvial")</code></p><h2 data-tool="mdnice编辑器"><span></span><span>首先是自己构造数据的一个简单例子</span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code><br>library(ggalluvial)<br>as.data.frame(Titanic)<br><br>dat01&lt;-data.frame(first=c(<span>"A"</span>,<span>"A"</span>,<span>"C"</span>),<br>                  second=c(<span>"B"</span>,<span>"D"</span>,<span>"E"</span>),<br>                  third=c(<span>"F"</span>,<span>"G"</span>,<span>"F"</span>),<br>                  n=c(15,30,20))<br><br>dat01<span>$first</span>&lt;-factor(dat01<span>$first</span>,<br>                    levels = c(<span>"C"</span>,<span>"A"</span>))<br>ggplot(data=dat01,<br>       aes(axis1=first,axis2=second,axis3=third,<br>           y=n))+<br>  geom_alluvium(aes(fill=second),<br>                <span>#size=3,</span><br>                <span>#color="white",</span><br>                width = 0.1,<br>                aes.bind = <span>"flows"</span>)+<br>  geom_stratum(fill=c(<span>"red"</span>,<span>"blue"</span>,<span>"green"</span>,<span>'yellow'</span>,<br>                           <span>'orange'</span>,<span>"blue"</span>,<span>"green"</span>),<br>               <span>#color="white",</span><br>               <span>#size=3,</span><br>               width=0.1)+<br>  geom_label(<span>stat</span> = <span>"stratum"</span>, aes(label = after_stat(stratum)))+<br>  scale_x_continuous(breaks = c(1,2),<br>                     labels = c(<span>"first"</span>,<span>"second"</span>),<br>                     expand = expansion(mult = c(0,0)))+<br>  theme_void()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7441860465116279" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk63h61zTaUKyQTiaJRx9dibCxEyE5ZM3w0nLB64IibicGaWxbth8ibKZR6ONWTfxS00XaBBGK6Uqc0Neyw/640?wx_fmt=png" data-type="png" data-w="989" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk63h61zTaUKyQTiaJRx9dibCxEyE5ZM3w0nLB64IibicGaWxbth8ibKZR6ONWTfxS00XaBBGK6Uqc0Neyw/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>加载需要用到的R包</span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(tidyverse)<br>library(readr)<br>library(ggplot2)<br>library(ggalluvial)<br>library(latex2exp)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>论文中的数据和图</span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>fig3c1&lt;-read_csv(<span>"figure3c1.csv"</span>)<br>fig3c1<br><br>cp2 &lt;- c(<span>"#FC7945"</span>, <span>"#4AB08C"</span>, <span>"#482870"</span>,<br>                  <span>"gray"</span>, <span>"#FC7945"</span>, <span>"#4AB08C"</span>,<br>                  <span>"#482870"</span>, <span>"gray"</span>)<br><br>fig3c1<span>$category_warm</span>&lt;-factor(fig3c1<span>$category_warm</span>,<br>                             levels = c(<span>"Amb&amp;Conserved"</span>,<br>                                        <span>"TRANS_ONLY"</span>,<br>                                        <span>"Cis&amp;Trans"</span>,<br>                                        <span>"CIS_ONLY"</span>))<br><br>fig3c1<span>$category_cold</span>&lt;-factor(fig3c1<span>$category_cold</span>,<br>                             levels = c(<span>"Amb&amp;Conserved"</span>,<br>                                        <span>"TRANS_ONLY"</span>,<br>                                        <span>"Cis&amp;Trans"</span>,<br>                                        <span>"CIS_ONLY"</span>))<br>fig3c1 %&gt;%<br>  ggplot(aes(y = n, axis1 = category_warm, axis2 = category_cold)) +<br>  geom_alluvium(aes(fill= category_warm, color = category_warm), <br>                size = 0.7, alpha = 0.6, <br>                curve_type = <span>"cubic"</span>, width = 1/4, <br>                show.legend = FALSE,<br>                aes.bind = <span>"flows"</span>) +<br>  geom_stratum( <br>               color = cp2, fill = cp2, <br>               alpha = 0.99, width = 1/4, show.legend = FALSE) +<br>  scale_fill_manual(breaks = c(<span>"Amb&amp;Conserved"</span>, <span>"Cis&amp;Trans"</span>, <span>"TRANS_ONLY"</span>, <span>"CIS_ONLY"</span>),<br>                    values = c(<span>"darkgray"</span>, <span>"#29AF7F"</span>, <span>"#3B0F6F"</span>, <span>"#FC4E07"</span>),<br>                    labels = c(<span>"Conserved"</span>, <span>"Cis + Trans"</span>, <span>"Trans"</span>, <span>"Cis"</span>)) +<br>  scale_color_manual(breaks = c(<span>"Amb&amp;Conserved"</span>, <span>"Cis&amp;Trans"</span>, <span>"TRANS_ONLY"</span>, <span>"CIS_ONLY"</span>),<br>                     values = c(<span>"darkgray"</span>, <span>"#29AF7F"</span>, <span>"#3B0F6F"</span>, <span>"#FC4E07"</span>),<br>                     labels = c(<span>"Conserved"</span>, <span>"Cis + Trans"</span>, <span>"Trans"</span>, <span>"Cis"</span>)) +<br>  scale_x_continuous(breaks = 1:2, labels = c(<span>"Warm"</span>, <span>"Cold"</span>), expand = c(0.025,0.025)) +<br>  scale_y_continuous(limits = c(0,1400), breaks = seq(0, 1400, 400),<br>                     expand = c(0,0)) +<br>  theme_classic() +<br>  theme(panel.grid = element_blank(),<br>        axis.title = element_blank(),<br>        axis.text = element_text (size = 10, <br>                                  family = <span>"sans"</span>),<br>        plot.margin = unit(c(0,1.5,0,0),<span>'cm'</span>))+<br>  coord_cartesian(clip=<span>"off"</span>)+<br>  annotate(geom=<span>"text"</span>,<br>           x=2.15,y=225,<br>           label=TeX(r<span>"(\textit{cis})"</span>),<br>           hjust=0,<br>           color=<span>"#FC7945"</span>)+<br>  annotate(geom=<span>"text"</span>,<br>           x=2.15,y=621.5,<br>           label=TeX(r<span>"(\textit{cis &amp; trans})"</span>),<br>           hjust=0,<br>           color= <span>"#4AB08C"</span>)+<br>  annotate(geom=<span>"text"</span>,<br>           x=2.15,y=892,<br>           label=TeX(r<span>"(\textit{trans})"</span>),<br>           hjust=0,<br>           color=<span>"#482870"</span>)+<br>  annotate(geom=<span>"text"</span>,<br>           x=2.15,y=1186,<br>           label=<span>"conserved\nambiguous"</span>,<br>           hjust=0,<br>           color=<span>"gray"</span>)<br><br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.8812351543942993" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk63h61zTaUKyQTiaJRx9dibCxXle8vVh8mNjiaLibKUV18B4YHiajVHTZQqAYkbRCQGAopicHj0eqHkxOoQ/640?wx_fmt=png" data-type="png" data-w="842" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk63h61zTaUKyQTiaJRx9dibCxXle8vVh8mNjiaLibKUV18B4YHiajVHTZQqAYkbRCQGAopicHj0eqHkxOoQ/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器"><span>示例数据和代码可以在论文中获取，或者给推文点赞点击在看最后留言获取</span></p><p data-tool="mdnice编辑器">欢迎大家关注我的公众号</p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzI3NzQ3MTcxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5t1sOnM0iabvBhnfIj5YpyqrMib0E1MGCd9ibcYxaOPZd0GWhQBDvK2BPEwsicQxd6y5MHLfphnwHnow/0?wx_fmt=png" data-nickname="小明的数据分析笔记本" data-alias="" data-signature="数据分析和数据可视化有意思的简单小例子~石榴研究生的笔记本" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"><strong></strong></p><blockquote data-tool="mdnice编辑器"><p>小明的数据分析笔记本 公众号 主要分享：1、R语言和python做数据分析和数据可视化的简单小例子；2、园艺植物相关转录组学、基因组学、群体遗传学文献阅读笔记；3、生物信息学入门学习资料及自己的学习笔记！</p></blockquote></section><p><img data-galleryid="" data-ratio="0.4269269269269269" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk63h61zTaUKyQTiaJRx9dibCxHHF8CD098oiay4ToVS66lBPg9icQaMupODZrGbSgRKrFvLeW5nibP7NtQ/640?wx_fmt=png" data-type="png" data-w="1998" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk63h61zTaUKyQTiaJRx9dibCxHHF8CD098oiay4ToVS66lBPg9icQaMupODZrGbSgRKrFvLeW5nibP7NtQ/640?wx_fmt=png"></p><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/fod1SV8IBqHxUQW0Q82a0w",target="_blank" rel="noopener noreferrer">原文链接</a>
