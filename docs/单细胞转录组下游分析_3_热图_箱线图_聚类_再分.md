---
title: "单细胞转录组下游分析（3）热图、箱线图、聚类、再分"
date: 2022-10-18T16:07:14Z
draft: ["false"]
tags: [
  "fetched",
  "医学生之学习生信"
]
categories: ["Acdemic"]
---
单细胞转录组下游分析（3）热图、箱线图、聚类、再分 by 医学生之学习生信
------
<div><section><p>上文完成了细胞注释，对比原文后，我调整了一些参数让图片与原文更相符。接下来是热图的绘制。</p><pre><code><span>#按照原文体现的特征基因</span><br>DoHeatmap(sce, features = c(<span>"SLC13A3"</span>,<span>"SLC34A1"</span>,<span>"GPX3"</span>,<span>"DCXR"</span>,<span>"SLC17A3"</span>,<span>"SLC22A8"</span>,<span>"SLC22A7"</span>,<span>"GNLY"</span>,<span>"NKG7"</span>,<span>"CD3D"</span>,<span>"CD3E"</span>,<span>"LYZ"</span>,<span>"CD14"</span>,<span>"KRT8"</span>,<span>"KRT18"</span>,<span>"CD24"</span>,<span>"VCAM1"</span>,<span>"UMOD"</span>,<span>"DEFB1"</span>,<span>"CLDN8"</span>,<span>"AQP2"</span>,<span>"CD79A"</span>,<span>"CD79B"</span>,<span>"ATP6V1G3"</span>,<span>"ATP6V0D2"</span>,<span>"TMEM213"</span>))</code></pre><figure><figcaption><br></figcaption><p><img data-ratio="0.4984375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/dgYTF46r3icb7MwvzkDuLheVmkK6iczeIYaXYxXic2RrcyBRetZWjEN50o2Eb95FAtUiaHxcj1M1XZPPyIfIojxv4Q/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_jpg/dgYTF46r3icb7MwvzkDuLheVmkK6iczeIYaXYxXic2RrcyBRetZWjEN50o2Eb95FAtUiaHxcj1M1XZPPyIfIojxv4Q/640?wx_fmt=jpeg"></p><figcaption>热图</figcaption></figure><p>接下来绘制箱线图</p><pre><code>VlnPlot(sce, pt.size =<span>0</span>, idents= c(<span>0</span>,<span>1</span>,<span>2</span>), features = c(<span>"GPX3"</span>, <span>"DCXR"</span>,<span>"SLC13A3"</span>,<span>"SLC34A1"</span>,<span>"SLC22A8"</span>,<span>"SLC22A7"</span>))<br>VlnPlot(sce, idents= c(<span>7</span>,<span>9</span>), features = c(<span>"AQP2"</span>, <span>"ATP6V1B1"</span>,<span>"ATP6V0D2"</span>,<span>"ATP6V1G3"</span>))<br><span>#然后我们保存一下</span><br>save(sce,file = <span>'sce2.RData'</span>)<br></code></pre><figure><p><br></p><p><img data-ratio="0.50625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/dgYTF46r3icb7MwvzkDuLheVmkK6iczeIY4iaNUIcVlcicVJ7GmeWYpg24tqjCf4V9UIqdOBqrAUIwrFEREhbOUeLA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_jpg/dgYTF46r3icb7MwvzkDuLheVmkK6iczeIY4iaNUIcVlcicVJ7GmeWYpg24tqjCf4V9UIqdOBqrAUIwrFEREhbOUeLA/640?wx_fmt=jpeg"></p><figcaption>箱线图<br></figcaption></figure><p><br></p><p><img data-ratio="0.49140625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/dgYTF46r3icb7MwvzkDuLheVmkK6iczeIYI1Qgzh01Loa18BvRjiaQWgWCn9OhMtibJRvbIVF21TWPFrqcTYwHzUGg/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_jpg/dgYTF46r3icb7MwvzkDuLheVmkK6iczeIYI1Qgzh01Loa18BvRjiaQWgWCn9OhMtibJRvbIVF21TWPFrqcTYwHzUGg/640?wx_fmt=jpeg"><span></span></p><p>根据原文，提取近端肾小管细胞进行后续分析。</p><pre><code>PT &lt;- SubsetData(sce, ident.use = c(<span>0</span>,<span>1</span>,<span>2</span>), subset.raw = <span>T</span>)<br><span>#PT = sce[,sce@meta.data$seurat_clusters %in% c(0,1,2)]</span><br><span>#保存一下~</span><br>save(PT,file=<span>'PT.rData'</span>)<br><span>#加载monocle软件R包</span><br><span>library</span>(monocle)<br><span>#提取3个特征文件，并将它们转换为CellDataSet格式：</span><br>data &lt;- as(as.matrix(PT@assays$RNA@counts), <span>'sparseMatrix'</span>)<br>pd &lt;- new(<span>'AnnotatedDataFrame'</span>, data = PT@meta.data)<br>fData &lt;- data.frame(gene_short_name = row.names(data), row.names = row.names(data))<br>fd &lt;- new(<span>'AnnotatedDataFrame'</span>, data = fData)<br>my_cds &lt;- newCellDataSet(data,<br>                         phenoData = pd,<br>                         featureData = fd,<br>                         lowerDetectionLimit = <span>0.5</span>,<br>                         expressionFamily = negbinomial.size())<br><span>#对monocle对象进行归一化：</span><br>my_cds &lt;- estimateSizeFactors(my_cds)<br>my_cds &lt;- estimateDispersions(my_cds)<br>my_cds &lt;- detectGenes(my_cds, min_expr = <span>0.1</span>) <span>##过滤掉低质量的基因。</span><br><span>#查看数据</span><br>head(fData(my_cds))<br>head(pData(my_cds))<br>pData(my_cds)$UMI &lt;- Matrix::colSums(exprs(my_cds))<br>disp_table &lt;- dispersionTable(my_cds)<br>head(disp_table)<br></code></pre><p><br></p><p><img data-ratio="0.23554301833568406" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/dgYTF46r3icb7MwvzkDuLheVmkK6iczeIYc0gNJibe0rIsN3VGwZpOyOz7iagLDLa5Uic8iaiarunwLS8eMMhorvOpoibQ/640?wx_fmt=png" data-type="png" data-w="709" src="https://mmbiz.qpic.cn/mmbiz_png/dgYTF46r3icb7MwvzkDuLheVmkK6iczeIYc0gNJibe0rIsN3VGwZpOyOz7iagLDLa5Uic8iaiarunwLS8eMMhorvOpoibQ/640?wx_fmt=png"></p><p>下面进行数据集降维，选择细胞和基因质控参数，plot_ordering_genes(spleen_monocle) setOrderingFilter 将一些用于之后聚类的基因标记起来， plot_ordering_genes根据这些基因的平均表达水平展示了基因的表达差异程度，红线表示Monocle基于这种关系对分散的期望。我们用于聚类的基因显示为黑点，而其他基因显示为灰点。</p><pre><code>table(disp_table$mean_expression&gt;=<span>0.1</span>)<br>unsup_clustering_genes &lt;- subset(disp_table, mean_expression &gt;= <span>0.1</span>)<span>#细胞平均表达量大于0.1</span><br>my_cds &lt;- setOrderingFilter(my_cds, unsup_clustering_genes$gene_id)<br>plot_ordering_genes(my_cds)<br></code></pre><p><br></p><p><img data-ratio="0.7411290322580645" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/dgYTF46r3icb7MwvzkDuLheVmkK6iczeIYTANia3mIckV0l2bUeGviaFhokyYBMETIDyXtDxOtVKuP6QaPkuecpmoA/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/dgYTF46r3icb7MwvzkDuLheVmkK6iczeIYTANia3mIckV0l2bUeGviaFhokyYBMETIDyXtDxOtVKuP6QaPkuecpmoA/640?wx_fmt=png"></p><p>继续聚类细胞，作碎石图</p><pre><code>expressed_genes &lt;- row.names(subset(fData(my_cds), num_cells_expressed &gt;= <span>10</span>)) <span>#细胞表达个数大于10</span><br>my_cds_subset &lt;- my_cds[expressed_genes, ]<br>my_cds_subset<br>head(pData(my_cds_subset))<br>my_cds_subset &lt;- detectGenes(my_cds_subset, min_expr = <span>0.1</span>)<br>fData(my_cds_subset)$use_for_ordering &lt;- fData(my_cds_subset)$num_cells_expressed &gt; <span>0.05</span> * ncol(my_cds_subset)<br>table(fData(my_cds_subset)$use_for_ordering)<br>plot_pc_variance_explained(my_cds_subset, return_all = <span>FALSE</span>)<br></code></pre><p><br></p><p><img data-ratio="0.27718960538979787" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/dgYTF46r3icb7MwvzkDuLheVmkK6iczeIYbybgcZhZW9mjefOCGQgSZhH2rNAbmvysxG2dtje3Vfm5dFPD2JURgQ/640?wx_fmt=png" data-type="png" data-w="1039" src="https://mmbiz.qpic.cn/mmbiz_png/dgYTF46r3icb7MwvzkDuLheVmkK6iczeIYbybgcZhZW9mjefOCGQgSZhH2rNAbmvysxG2dtje3Vfm5dFPD2JURgQ/640?wx_fmt=png"></p><p><br></p><p><img data-ratio="0.7411290322580645" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/dgYTF46r3icb7MwvzkDuLheVmkK6iczeIYviaZesjnKD7ZlcxdicvOWINHUWD0GR1fyWLLFGdp1SpVPHHATlKcRt4w/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/dgYTF46r3icb7MwvzkDuLheVmkK6iczeIYviaZesjnKD7ZlcxdicvOWINHUWD0GR1fyWLLFGdp1SpVPHHATlKcRt4w/640?wx_fmt=png"></p><p><br></p><p><img data-ratio="0.64" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/dgYTF46r3icbdKicicapkjCjx5TTVjab8tda6kjzqxzyNfRMZdmhJ1ggdxhhCIEEP89OU9ZA5pbhF9jXHIavhnUEg/640?wx_fmt=png" data-type="png" data-w="1000" src="https://mmbiz.qpic.cn/mmbiz_png/dgYTF46r3icbdKicicapkjCjx5TTVjab8tda6kjzqxzyNfRMZdmhJ1ggdxhhCIEEP89OU9ZA5pbhF9jXHIavhnUEg/640?wx_fmt=png"></p><section><section><section><section><section><section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section><section><section><section><section><section><section><section><section><svg viewbox="0 0 1 1"></svg><br></section></section></section></section></section></section></section></section><section><section><section><br></section></section></section></section></section></section><section><section><p>作者：陈咪祺<br>编辑：陈咪祺<br>校审：梁晓杰</p></section></section><p><br></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/1o-AmkTV-c1wEGeIlvyT2w",target="_blank" rel="noopener noreferrer">原文链接</a>
