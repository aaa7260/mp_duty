---
title: "单细胞奇技_Hotspot"
date: 2024-04-16T01:32:54Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞训练营"
]
categories: ["Acdemic"]
---
单细胞奇技_Hotspot by 单细胞训练营
------
<div><p data-mpa-powered-by="yiban.io">对于单细胞转录组学分析，数以万计的细胞可以根据表达谱的相似性被分成独立的cluster，而gene之间也可因表达特征的相似被分成离散的module，特别是癌症生物学领域十分依赖于此思路从异质性十分明显的肿瘤细胞解析出相对稳健的gene module，并根据module内的基因进行功能富集从而揭示肿瘤细胞亚群的表型，比如耐药性或倾向于转移的特征。本文介绍的Hotspot工具即是进行此类问题研究的很好的工具🔧，该方法基于python语言环境实现，安装过程友好，原理讲解通透[强烈推荐大家阅览原文]。</p><p><img data-galleryid="" data-ratio="0.7435185185185185" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuiab4UJnGJGLcHiblGvm3FRgpDWcKXZCs7RTbiaDecYzOn1AdKFvDPLwDgQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuiab4UJnGJGLcHiblGvm3FRgpDWcKXZCs7RTbiaDecYzOn1AdKFvDPLwDgQ/640?wx_fmt=png"></p><p>首先简单介绍其运行逻辑，Hotspot算法是基于图的方法进行特征基因和基因模块预测，具体来说，作者认为若gene x和gene y存在表达模式的相关性那么在图表示内距离相近的限定数目细胞中表达量的乘积应当显著大于没有相关性的一对基因，故此评估方法有别于仅考虑同一细胞内每对gene pair的表达模式的pearson计算方法不同，能够更好的解决数据稀疏造成的对rare expression gene pair的假阴性检出问题。<span></span></p><p><img data-galleryid="" data-ratio="0.7055555555555556" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuiaQM5ickzzRKIicbDibAYJmia36icGANF2x8Ou7icv0b7fbnHSS3uYOUaBicwoA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuiaQM5ickzzRKIicbDibAYJmia36icGANF2x8Ou7icv0b7fbnHSS3uYOUaBicwoA/640?wx_fmt=png"></p><p>另外，如图所示，上述cell-cell similarity的衡量方式并非单一，若在单细胞转录组情境下考量，可以是经PCA线性降维后的空间内细胞间欧式距离为考量或是考虑到批次响应以harmony处理后的空间下相对距离又或是scVI非线性降维后的相对距离作为input。对于空间转录组数据来说，可以spot在2D 10X Visium slide上的坐标作为input，那么不难想到，此输入最后求得的gene module即在空间分布模式相似的基因集合，此方面完全可以成为SpatialIDE方法的平替[效果相近，运行速度加快百倍]</p><p><img data-galleryid="" data-ratio="0.85" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuiaw3eibqsEXoEabWHeVBoAxp5qPrxBGichnr5JPNKyxuUfto5Mr4IeJk5Q/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuiaw3eibqsEXoEabWHeVBoAxp5qPrxBGichnr5JPNKyxuUfto5Mr4IeJk5Q/640?wx_fmt=png"></p><p>还有一点需要提到，为了尽可能节省计算开销并排除掉没有意义的基因，进行gene间局部correlation计算前首先需要择选出informative gene，此步简单来说与上述思路相似，但计算的是auto-correlation，即在图表示空间中的比如30个最近邻的细胞中计算同一基因不同细胞之间乘积的累加和，并进行标准化，求出每个基因的自相关统计量后进行排序，挑选前列的基因进行后续的gene-pair correlation和gene module extraction，从而进一步加强hotspot算法的运算效率和结果的可解释性！<br></p><h3 data-pm-slice="1 1 []" data-en-clipboard="true"><strong>Code [Running]</strong></h3><p>#Hotspot is installed directly from PyPI using the following command:</p><section><ul><li></ul><pre data-lang="nginx"><code><span><span>pip</span> install hotspotsc</span></code></pre></section><ol><p>1. Create the Hotspot object</p></ol><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span>import</span> hotspot</span></code><code><span>hs = hotspot.Hotspot(</span></code><code><span>  adata, <span>#Anndata object of cells by genes</span></span></code><code><span>  layer_key=<span>'counts'</span>, <span>#the layer of adata containing count information</span></span></code><code><span>  model=<span>'danb'</span>, <span>#danb selects the umi-adjusted negative binomial model</span></span></code><code><span>  latent_obsm_key = <span>'X_pca'</span>, <span>#the .obsm key of adata containing Cells x Components matrix (the PCA-reduced space)</span></span></code><code><span>  umi_counts_obs_key=<span>'total_counts'</span> <span>#the .obs key of adata with the UMI count for each cell</span></span></code><code><span>)</span></code></pre></section><p><img data-galleryid="" data-ratio="0.6675925925925926" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuiabfukoCjkeCq4U1mQtyH6ZTNG0ujBt5Fiby075HNfFbrDGhxUJIdvslg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuiabfukoCjkeCq4U1mQtyH6ZTNG0ujBt5Fiby075HNfFbrDGhxUJIdvslg/640?wx_fmt=png"></p><p>2. Compute the KNN graph</p><section><ul><li><li></ul><pre data-lang="php"><code><span><span>#The K-nearest-neighbors graph is computed by running</span></span></code><code><span>hs.create_knn_graph(weighted_graph=<span>False</span>, n_neighbors=<span>30</span>)</span></code></pre></section><p><img data-galleryid="" data-ratio="0.2796296296296296" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuiaEFia9ib9mlNWzsgIU3hF9RZFM8J5fibm5Jwsb8zCjxsfPytibNMIYDiblicQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuiaEFia9ib9mlNWzsgIU3hF9RZFM8J5fibm5Jwsb8zCjxsfPytibNMIYDiblicQ/640?wx_fmt=png"></p><p>3. Find informative genes (by gene autocorrelation)<br></p><section><ul><li><li></ul><pre data-lang="ini"><code><span><span>#To compute per-gene autocorrelations,run:</span></span></code><code><span><span>hs_results</span> = hs.compute_autocorrelations()</span></code></pre></section><p><img data-galleryid="" data-ratio="0.6083333333333333" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuiaCczLtibtSrvIdFnKR86crv9NqLap7lXKXWQibW25USefhibFNOMYWktKA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuiaCczLtibtSrvIdFnKR86crv9NqLap7lXKXWQibW25USefhibFNOMYWktKA/640?wx_fmt=png"></p><p>4. Evaluate pair-wise gene associations (gene local correlations)</p><section><ul><li><li><li></ul><pre data-lang="makefile"><code><span>hs_genes = hs_results.loc[hs_results.FDR &lt; 0.05].index <span>#select informative genes</span></span></code><code><span>local_correlations = hs.compute_local_correlations(hs_genes,jobs=4) <span>#jobs for parallelization</span></span></code><code><span><span>#The output is a genes x genes pandas DataFrame of Z-scores for the local correlation values between genes. The output is also stored in hs.local_correlation_z.</span></span></code></pre></section><p><span>‍</span></p><p><span>5. Group genes into modules</span><br></p><section><ul><li><li><li></ul><pre data-lang="makefile"><code><span>modules = hs.create_modules(min_gene_threshold=30,core_only=True,fdr_threshold=0.05)</span></code><code><span><span>#Visualizing correlation modules</span></span></code><code><span>hs.plot_local_correlations()</span></code></pre></section><p><img data-galleryid="" data-ratio="1.1712962962962963" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuial5bgsDBHDP4e6byXAR3icWJFjvfwUmNGpCnlibVAU8KR2WCvk1corGibg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuial5bgsDBHDP4e6byXAR3icWJFjvfwUmNGpCnlibVAU8KR2WCvk1corGibg/640?wx_fmt=png"></p><p>6. Compute summary per-cell module scores</p><section><ul><li><li></ul><pre data-lang="shell"><code><span><span>#</span>Summary per-cell score can be computed <span>for</span> a module, <span>which</span> is useful <span>for</span> visualizing the general pattern of expression <span>for</span> genes <span>in</span> a module.</span></code><code><span>module_scores = hs.calculate_module_scores()</span></code></pre></section><p><img data-galleryid="" data-ratio="0.7953703703703704" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuiaznkWXBpmCYu2v9DcZ5CVMGHQf0lRbMO104S81IsI9gNaOYll3Ft2bA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/LjkGSkc5VwKHX1wEAwOK2PrscIh5URuiaznkWXBpmCYu2v9DcZ5CVMGHQf0lRbMO104S81IsI9gNaOYll3Ft2bA/640?wx_fmt=png"></p><p>参考资料：</p><ul><li><p><span>https://doi.org/10.1016/j.cels.2021.04.005</span></p></li><li><p><span>https://github.com/yoseflab/hotspot</span></p></li><li><p><span>想进一步了解该算法的原理或帮助运行代码请以私信方式联系小编</span><span></span><span></span></p></li></ul><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/LA6hQ8ovp889enbvzFrrGw",target="_blank" rel="noopener noreferrer">原文链接</a>
