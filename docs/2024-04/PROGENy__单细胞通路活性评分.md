---
title: "PROGENy--单细胞通路活性评分"
date: 2024-04-16T01:40:18Z
draft: ["false"]
tags: [
  "fetched",
  "生信小博士"
]
categories: ["Acdemic"]
---
PROGENy--单细胞通路活性评分 by 生信小博士
------
<div><p><br></p><h3 data-tool="mdnice编辑器"><strong><span>写在开头</span></strong><span></span></h3><p><span>jimmy老师在他的生信游民系列提出了很多学徒任务，仔细去看每一篇文章的动机，都是科研过程中经常会经历到的。</span></p><p><span>今天我们分享的任务是来自：</span><span><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526714&amp;idx=1&amp;sn=aba39bc658288a9f607b13bfdf0a0346&amp;chksm=9b4b2981ac3ca097398092480e463c9f7ea87f72635d3bcb50e6f02af8cb2488b8a45acccaa3&amp;scene=21#wechat_redirect" textvalue="生物学功能注释三板斧" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">生物学功能注释三板斧</a>。 本次任务我计划分为四个部分来写，今天写第二部分。</span></span></p><ul><li><p><span><span>1.<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247486720&amp;idx=1&amp;sn=448a51fb82b5262aa0a6c57268afe67e&amp;chksm=ce6463e9f913eaffe7082a2f1b44e4e85e78f66969982d7352f9b9e6ae39a0ccea54f9c3f39d&amp;scene=21#wechat_redirect" textvalue="比pyscenic好用的单细胞转录因子活性评分——DoRothEA" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">比pyscenic好用的单细胞转录因子活性评分——DoRothEA</a></span></span></p></li><li><p><span><span>2.PROGENy--单细胞通路活性评分</span></span></p></li><li><p><span><span>3.<span>D</span><span>oRothEA--转录组转录因子评分</span></span></span></p></li><li><p><span><span><span>4.</span><span>PROGENy--转录组通路活性评分</span></span></span></p><hr><p><br></p><p><br></p></li></ul><p><span>正文部分</span><br></p><p><span><span>相较于其他通路活性评估算法，使用 PROGENy 能够构建通路核心基因集及基因的贡献权重，对通路活性评估更加准确有效；</span><span>同时 PROGENy 能够精确定位癌症或病变中发生关键变化的通路节点，可以为生物学研究提供更加准确可靠的结果。</span></span></p><p><img data-imgfileid="100003075" data-ratio="0.5528846153846154" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yTQe71gKsjTnRDjqr6UyR5COGyB7r6X1KSlTG5YBtibNjsKLR1jL9wASQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="832" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yTQe71gKsjTnRDjqr6UyR5COGyB7r6X1KSlTG5YBtibNjsKLR1jL9wASQ/640?wx_fmt=png&amp;from=appmsg"></p><p><span><br></span></p><p><strong><span>作者主要着眼于癌症中10种信号通路，如下c<br></span></strong></p><p><img data-galleryid="" data-imgfileid="100003077" data-ratio="0.5240793201133145" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktib3gTWF4LEjGd7hrvldy789Xywan404ib0Aic9Kj3ecfbaScfOYAnKoYW7icvGObrsApkIHlMb87mrQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="706" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktib3gTWF4LEjGd7hrvldy789Xywan404ib0Aic9Kj3ecfbaScfOYAnKoYW7icvGObrsApkIHlMb87mrQ/640?wx_fmt=png&amp;from=appmsg"></p><h2 data-tool="mdnice编辑器"><span>加载R包和数据</span></h2><p><span><br></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="objectivec"><code><span><span># Only needed for data handling and plotting</span></span></code><code><span>library(dplyr)</span></code><code><span>library(tibble)</span></code><code><span>library(tidyr)</span></code><code><span>library(patchwork)</span></code><code><span>library(ggplot2)</span></code><code><span>library(pheatmap)</span></code><code><span><br></span></code><code><span>library(Seurat)</span></code><code><span><br></span></code><code><span><span>#https://saezlab.github.io/progeny/#:~:text=PROGENy%20is%20resource%20that%20leverages%20a%20large%20compendium,infer%20pathway%20activities%20from%20bulk%20or%20single-cell%20transcriptomics.</span></span></code><code><span><span>#https://cloud.tencent.com/developer/article/2206142</span></span></code><code><span><br></span></code><code><span><span>#https://saezlab.github.io/decoupleR/articles/decoupleR.html</span></span></code><code><span>library(progeny)</span></code><code><span>library(Seurat)</span></code><code><span><span>#https://saezlab.github.io/decoupleR/articles/pw_sc.html</span></span></code><code><span><br></span></code><code><span><br></span></code><code><span><span>#BiocManager::install(<span>"OmnipathR"</span>)</span></span></code><code><span>library(decoupleR)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span>#单细胞progeny-----</span></span></code><code><span><span>#https://cloud.tencent.com/developer/article/2206142       </span></span></code><code><span>getwd()</span></code><code><span><br></span></code><code><span>dir.create(<span>"~/gzh/20240414_progeny_通路活性分析"</span>)</span></code><code><span>setwd(<span>"~/gzh/20240414_progeny_通路活性分析"</span>)</span></code><code><span>getwd()</span></code><code><span><br></span></code><code><span><br></span></code><code><span>load(<span>"~/gzh/pbmc3k_final_v4.rds"</span>)</span></code><code><span><br></span></code><code><span>table(Idents(pbmc))</span></code></pre></section><p>pbmc单细胞数据：<span></span></p><p><img data-galleryid="" data-imgfileid="100003074" data-ratio="0.8927911275415896" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yTXhkn7w4ic7YahlQv8y5oOG7VYjLibSx3O8AsGnr5icicNicorjtAYMMWkFw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="541" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yTXhkn7w4ic7YahlQv8y5oOG7VYjLibSx3O8AsGnr5icicNicorjtAYMMWkFw/640?wx_fmt=png&amp;from=appmsg"></p><h2 data-tool="mdnice编辑器"><span>计算通路活性</span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span># We create a data frame with the specification of the cells that belong to </span></span></code><code><span><span>## each cluster to match with the Progeny scores. </span></span></code><code><span><span>CellsClusters</span> &lt;- data.frame(Cell = names(Idents(pbmc)), </span></code><code><span>                            CellType = as.character(Idents(pbmc)), </span></code><code><span>                            stringsAsFactors = FALSE) </span></code><code><span>head(CellsClusters)</span></code><code><span>DimPlot(pbmc, reduction = <span>"umap"</span>, label = TRUE, pt.size = <span>0</span>.<span>5</span>) + NoLegend()</span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span><span>2</span> <span>#2-------</span></span></code><code><span><span>## We compute the Progeny activity scores and add them to our Seurat object </span></span></code><code><span><span>## as a new assay called Progeny. </span></span></code><code><span>pbmc &lt;- progeny(pbmc, scale=FALSE, organism=<span>"Human"</span>, top=<span>500</span>, perm=<span>1</span>, return_assay = TRUE)  <span>#"Human" Mouse</span></span></code><code><span>pbmc<span>@assays</span><span>$progeny</span> </span></code><code><span>pbmc<span>@assays</span><span>$progeny</span> %&gt;%dim()</span></code><code><span>pbmc<span>@assays</span><span>$progeny</span><span>@data</span>[,<span>1</span>:<span>19</span>]</span></code><code><span><span># Assay data with 14 features for 2638 cells # First 10 features: </span></span></code><code><span><span># Androgen, EGFR, Estrogen, Hypoxia, JAK-STAT, MAPK, NFkB, p53, PI3K, TGFb</span></span></code><code><span><br></span></code></pre></section><p><br></p><p>计算得到通路活性矩阵：<br></p><p><img data-galleryid="" data-imgfileid="100003076" data-ratio="0.3574074074074074" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yTnibB25ic7iauvO1icEqicicrQbCJ6jB9fRJXvyXOu4mAUbMgFJb18ArYuNuA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yTnibB25ic7iauvO1icEqicicrQbCJ6jB9fRJXvyXOu4mAUbMgFJb18ArYuNuA/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><img data-galleryid="" data-imgfileid="100003073" data-ratio="0.42771084337349397" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yTYx5uFktpiazmZ9uBB4yrZGSvR2r3ibjbHgEFHgfK4QiaXdJqwy3kicUWjg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="332" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yTYx5uFktpiazmZ9uBB4yrZGSvR2r3ibjbHgEFHgfK4QiaXdJqwy3kicUWjg/640?wx_fmt=png&amp;from=appmsg"></p><p>后续的可视化分析又是各显神通了！<br></p><h2 data-tool="mdnice编辑器"><span>对通路活性矩阵进行可视化一</span></h2><section><ul><li><li><li><li><li><li></ul><pre data-lang="properties"><code><span><span>library(viridis)</span></span></code><code><span><span>progeny_hmap</span> = <span>pheatmap(t(summarized_progeny_scores_df),</span></span></code><code><span>                        <span>fontsize</span>=<span>12, </span></span></code><code><span>                        <span>fontsize_row</span> = <span>10, color=myColor,</span></span></code><code><span>                        <span>breaks</span> = <span>progenyBreaks, main = "PROGENy", </span></span></code><code><span>                        <span>angle_col</span> = <span>45, treeheight_col = 0, border_color = NA)</span></span></code></pre></section><p><img data-galleryid="" data-imgfileid="100003078" data-ratio="0.9658738366080661" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yT5zQbumEFVpTiaHaXF539AoeBQb1yxYdiamDDePffYk6g9CDA5tSAiclGg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="967" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yT5zQbumEFVpTiaHaXF539AoeBQb1yxYdiamDDePffYk6g9CDA5tSAiclGg/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="objectivec"><code><span>progeny_hmap = pheatmap(t(summarized_progeny_scores_df),</span></code><code><span>                        fontsize=<span>12</span>, </span></code><code><span>                        fontsize_row = <span>10</span>, color=turbo(<span>90</span>), <span>#<span>"inferno"</span> <span>"magma"</span> <span>"cividis"</span> <span>"viridis"</span></span></span></code><code><span>                        <span>#  breaks = progenyBreaks,</span></span></code><code><span>                        main = <span>"PROGENy"</span>, </span></code><code><span>                        angle_col =<span>90</span>, treeheight_col = <span>0</span>, border_color = NA)</span></code><code><span><br></span></code><code><span><br></span></code></pre></section><p><img data-galleryid="" data-imgfileid="100003079" data-ratio="0.9519832985386222" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yTHfFVzmVzn1AjuIIJVnGG80fPxxJkcguk0eIcQEx1eNbsicNrq9NfLFg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="958" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yTHfFVzmVzn1AjuIIJVnGG80fPxxJkcguk0eIcQEx1eNbsicNrq9NfLFg/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><h2 data-tool="mdnice编辑器"><span>可视化二</span></h2><p><br></p><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="xml"><code><span>library(viridis)</span></code><code><span><br></span></code><code><span>DefaultAssay(pbmc) <span>&lt;<span>-</span> '<span>progeny</span>' </span></span></code><code><span><span>p1</span>= <span>FeaturePlot(pbmc,features</span> = <span>"NFkB"</span>, <span>coord.fixed</span> = <span>T,label</span> = <span>TRUE,</span></span></code><code><span>                <span>order</span> = <span>T,</span> <span>cols</span> = <span>viridis(10))</span> </span></code><code><span><span>p2</span>=<span>FeaturePlot(pbmc,features</span> = <span>"MAPK"</span>, <span>coord.fixed</span> = <span>T,</span> <span>order</span> = <span>T,</span> <span>cols</span> = <span>viridis::turbo(10))</span> </span></code><code><span><br></span></code><code><span><span>p1</span>|<span>p2</span></span></code></pre></section><p><br></p><p><img data-galleryid="" data-imgfileid="100003080" data-ratio="0.6138888888888889" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yTia2l3GibH44Ric8xGAXBo7mjJGToQ1yPEE5Ukhpic0HNaWoTxSEhzInWyw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yTia2l3GibH44Ric8xGAXBo7mjJGToQ1yPEE5Ukhpic0HNaWoTxSEhzInWyw/640?wx_fmt=png&amp;from=appmsg"></p><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg2NDcxMzYwNg==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sks7JhVxUX46ZKxPSob6ptqIZgnIEnHOn5VMwCX8sN6MQy1Pq4XXFEOJ6grAmsoQugyCDKOZictDBHA/0?wx_fmt=png" data-nickname="生信小博士" data-alias="bioinformatics_Dr" data-signature="【生物信息学】R语言开始，学习生信。Seurat，单细胞测序，空间转录组。 Python，scanpy，cell2location。资料分享" data-from="2" data-is_biz_ban="0"></mp-common-profile></section><section><ul><li><li><li><li></ul><pre data-lang="javascript"><code><span>参考：</span></code><code><span>https:<span>//saezlab.github.io/progeny/articles/ProgenySingleCell.html</span></span></code><code><span>https:<span>//www.jianshu.com/p/4058050d546e</span></span></code><code><span>https:<span>//saezlab.github.io/progeny/articles/progeny.html</span></span></code></pre></section><p><br></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/heqW7zTjt6Qfrs9es71ZxA",target="_blank" rel="noopener noreferrer">原文链接</a>
