---
title: "数据处理过程中的合理的质量控制是很有必要的"
date: 2024-04-14T23:38:50Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
数据处理过程中的合理的质量控制是很有必要的 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>单细胞转录组数据分析过程有几个难点：</p></blockquote><ul data-tool="mdnice编辑器"><li><section>去除双细胞</section></li><li><section>去除低质量细胞亚群</section></li><li><section>回归掉细胞周期等因素</section></li></ul><p data-tool="mdnice编辑器">实际上初学者完全不需要使用各种花里胡哨的工具来完成上面的步骤，因为所有的细节都在降维聚类分群结果里面看得到！让我们来演练一下：</p><p data-tool="mdnice编辑器">比如数据集GSE217845，从里面挑选出来10个单细胞转录组样品，都是10x技术的，如下所示 ：</p><p><img data-galleryid="" data-imgfileid="100045766" data-ratio="0.4457831325301205" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzmtKHibo7ian0njbbeiapRGXRsGzHfDicyTLAypMpNPNq9d1cvOXO5j4MFicYzRUBjzrjIcskwmvVScKA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="996" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzmtKHibo7ian0njbbeiapRGXRsGzHfDicyTLAypMpNPNq9d1cvOXO5j4MFicYzRUBjzrjIcskwmvVScKA/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>10个单细胞转录组样品</figcaption></figure><p data-tool="mdnice编辑器">一般来说，作者上传的10x的3文件都是过滤好的了，这个时候理论上10x技术会给每个样品产出10000个左右的细胞，我们做一个简单的批量读取即可；</p><pre data-tool="mdnice编辑器"><span></span><code><span># 参考：https://mp.weixin.qq.com/s/tw7lygmGDAbpzMTx57VvFw</span><br>dir=<span>'outputs/'</span><br>samples=list.files( dir )<br>samples <br>sceList = lapply(samples,<span>function</span>(pro){ <br>  <span># pro=samples[1] </span><br>  print(pro)  <br>  tmp = Read10X(file.path(dir,pro )) <br>  <span>if</span>(length(tmp)==<span>2</span>){<br>    ct = tmp[[<span>1</span>]] <br>  }<span>else</span>{ct = tmp}<br>  print(dim(ct))<br>  sce =CreateSeuratObject(counts =  ct ,<br>                          project =  pro  ,<br>                          min.cells = <span>5</span>,<br>                          min.features = <span>300</span> )<br>  <span>return</span>(sce)<br>}) <br>do.call(rbind,lapply(sceList, dim))<br></code></pre><p data-tool="mdnice编辑器">可以看到的是这个时候其实已经引入了第一个过滤流程，就是  min.cells = 5, min.features = 300  这两个参数，这个时候是一个非常初步的质量控制，是可以更严格的，比如提高  min.features = 500 甚至更高。不过先我们看看初步质量控制的效果吧：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; do.call(rbind,lapply(sceList, dim))<br>       [,1]  [,2]<br> [1,] 18742 14073<br> [2,] 20394  2758<br> [3,] 20273  6565<br> [4,] 18243  7600<br> [5,] 19946 14152<br> [6,] 18571  8436<br> [7,] 20354  9151<br> [8,] 21206  8856<br> [9,] 20526 15214<br>[10,] 19873  4076<br></code></pre><p data-tool="mdnice编辑器">如果大家自行看   min.cells = 5, min.features = 300  这两个参数 的效果，就会发现它仅仅是对每个样品都过滤了一千多个细胞。最后得到了 9万多个细胞的单细胞表达量矩阵；</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; sce.all<br>An object of class Seurat <br>23757 features across 90881 samples within 1 assay <br>Active assay: RNA (23757 features, 0 variable features)<br> 1 layer present: counts<br></code></pre><p data-tool="mdnice编辑器">常规的单细胞转录组降维聚类分群代码可以看 链接: https://pan.baidu.com/s/1bIBG9RciAzDhkTKKA7hEfQ?pwd=y4eh ，基本上大家只需要读入表达量矩阵文件到r里面就可以使用Seurat包做全部的流程！</p><h3 data-tool="mdnice编辑器"><span></span><span>先跑默认流程</span><span></span></h3><p data-tool="mdnice编辑器">我们默认的过滤流程里面是：</p><pre data-tool="mdnice编辑器"><span></span><code>  <span>#根据上述指标，过滤低质量细胞/基因</span><br>  <span>#过滤指标1:最少表达基因数的细胞&amp;最少表达细胞数的基因</span><br>  <span># 一般来说，在CreateSeuratObject的时候已经是进行了这个过滤操作</span><br>  <span># 如果后期看到了自己的单细胞降维聚类分群结果很诡异，就可以回过头来看质量控制环节</span><br>  <span># 先走默认流程即可</span><br>selected_c &lt;- WhichCells(input_sce, expression = nFeature_RNA &gt; <span>500</span>)<br>    selected_f &lt;- rownames(input_sce)[Matrix::rowSums(input_sce@assays$RNA$counts &gt; <span>0</span> ) &gt; <span>3</span>]<br>    input_sce.filt &lt;- subset(input_sce, features = selected_f, cells = selected_c)<br>    <br>      <span>#过滤指标2:线粒体/核糖体基因比例(根据上面的violin图)</span><br>  selected_mito &lt;- WhichCells(input_sce.filt, expression = percent_mito &lt; <span>25</span>)<br>  selected_ribo &lt;- WhichCells(input_sce.filt, expression = percent_ribo &gt; <span>3</span>)<br>  selected_hb &lt;- WhichCells(input_sce.filt, expression = percent_hb &lt; <span>1</span> )<br></code></pre><p data-tool="mdnice编辑器">走了上面的代码之后拿到的单细胞表达量矩阵是：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; sce.all.filt<br>An object of class Seurat <br>23757 features across 76347 samples within 1 assay <br>Active assay: RNA (23757 features, 0 variable features)<br> 1 layer present: counts<br></code></pre><p data-tool="mdnice编辑器">可以看到是过滤了一万多的细胞，然后就可以降维聚类分群啦，如下所示的惨不忍睹的效果 ：</p><p><img data-galleryid="" data-imgfileid="100045768" data-ratio="1.0824074074074075" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzmtKHibo7ian0njbbeiapRGXRubxIdvPVGW09MtSOYw7ia6y8g1gRtt4iczwTMrb0hGmxsfK5J3Fpgohw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzmtKHibo7ian0njbbeiapRGXRubxIdvPVGW09MtSOYw7ia6y8g1gRtt4iczwTMrb0hGmxsfK5J3Fpgohw/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>惨不忍睹的降维聚类分群</figcaption></figure><p data-tool="mdnice编辑器">并不是说没办法给出来细胞亚群的名字，标准代码会出很多图，比如里面的质量控制图就可以看出来10这个亚群就属于低质量的，说明我们的过滤标准是不够严格的。</p><p><img data-galleryid="" data-imgfileid="100045767" data-ratio="1.1842592592592593" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzmtKHibo7ian0njbbeiapRGXRQzp4lzTerKiasbUtnpjutDBJF1HiblAr6t9Fq0MQibU3jMOzkcQcpAEGw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzmtKHibo7ian0njbbeiapRGXRQzp4lzTerKiasbUtnpjutDBJF1HiblAr6t9Fq0MQibU3jMOzkcQcpAEGw/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>10这个亚群就属于低质量的</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span><span>然后自行探索最佳质量控制流程</span><span></span></h3><p data-tool="mdnice编辑器">我们做了一个简单的探索：</p><pre data-tool="mdnice编辑器"><span></span><code>sce.all.filt=subset(sce.all.filt,subset = percent_mito &lt; <span>40</span> &amp; <br>                 nCount_RNA &lt;<span>10000</span> &amp; <br>                 nFeature_RNA &lt;<span>7500</span>&amp;<br>                 nFeature_RNA&gt;<span>500</span>)<br>sce.all.filt <br>&gt; sce.all.filt <br>An object of class Seurat <br><span>23757</span> features across <span>50292</span> samples within <span>1</span> assay <br>Active assay: RNA (<span>23757</span> features, <span>0</span> variable features)<br> <span>1</span> layer present: counts<br></code></pre><p data-tool="mdnice编辑器">可以看到，如果是这个标准，最开始9万细胞到现在就只剩下了5万啦。上面的最低阈值就去除了低质量细胞，最高阈值就去除了双细胞，当然了肯定是会错杀一批。但是数据分析其实很难得到百分百准确的结果，关键是我们如何合理的展示和解释我们的结果。</p><p data-tool="mdnice编辑器">实是很严格，而且后面的降维聚类分群效果好很多啦！各个生物学功能亚群之间的距离是很清晰的，而且是能够给出来名字的！而且可以很清楚的看到细胞增殖相关单细胞亚群也不见了，虽然我们并没有去回归掉这个因素的影响。而且哪怕是我们结果里面仍然是有细胞增殖相关单细胞亚群也完全无需担心啊，你如实的命名它为细胞增殖相关单细胞亚群即可！</p><p><img data-galleryid="" data-imgfileid="100045770" data-ratio="1.136111111111111" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzmtKHibo7ian0njbbeiapRGXRgH9aJlMJibp045umauicuL8NIUg7jpYBmy715UefxL5KbwlBRIpJnicHA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzmtKHibo7ian0njbbeiapRGXRgH9aJlMJibp045umauicuL8NIUg7jpYBmy715UefxL5KbwlBRIpJnicHA/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>生物学功能亚群之间的距离是很清晰的</figcaption></figure><p data-tool="mdnice编辑器">可以看到，上图里面的标号为2的亚群就是髓系免疫细胞亚群，通常我们拿到了肿瘤相关的单细胞转录组的表达量矩阵后的第一层次降维聚类分群通常是：</p><ul data-tool="mdnice编辑器"><li><section>immune (CD45+,PTPRC),</section></li><li><section>epithelial/cancer (EpCAM+,EPCAM),</section></li><li><section>stromal (CD10+,MME,fibro or CD31+,PECAM1,endo)</section></li></ul><p data-tool="mdnice编辑器">参考我前面介绍过 <a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247488940&amp;idx=1&amp;sn=1cc8a8a74715087939b9721c0881775d&amp;scene=21#wechat_redirect" data-linktype="2">CNS图表复现08—肿瘤单细胞数据第一次分群通用规则</a>，这3大单细胞亚群构成了肿瘤免疫微环境的复杂。绝大部分文章都是抓住免疫细胞亚群进行细分，包括淋巴系（T,B,NK细胞）和髓系（单核，树突，巨噬，粒细胞）的两大类作为第二次细分亚群。但是也有不少文章是抓住stromal 里面的 fibro 和endo进行细分，并且编造生物学故事的。</p><h3 data-tool="mdnice编辑器"><span></span><span>学徒作业</span><span></span></h3><p data-tool="mdnice编辑器">理解常规的单细胞转录组降维聚类分群代码，可以看 链接: https://pan.baidu.com/s/1bIBG9RciAzDhkTKKA7hEfQ?pwd=y4eh ，基本上大家只需要读入表达量矩阵文件到r里面就可以使用Seurat包做全部的流程。</p><p data-tool="mdnice编辑器">从上面的数据集GSE217845里面的10个胰腺癌的10x技术单细胞转录组数据的第一层次降维聚类分群里面提前髓系免疫细胞后，继续细分降维聚类拿到里面的巨噬细胞，然后继续细分巨噬细胞看看能否复现文章里面的：</p><p><img data-galleryid="" data-imgfileid="100045769" data-ratio="0.5485232067510548" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzmtKHibo7ian0njbbeiapRGXRicsVUQVrWHCHhNeT30SA3WQNwA6aN0LqAkqkszdHNtVJkp4yp9MsicCw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="948" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzmtKHibo7ian0njbbeiapRGXRicsVUQVrWHCHhNeT30SA3WQNwA6aN0LqAkqkszdHNtVJkp4yp9MsicCw/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>细分巨噬细胞</figcaption></figure></section><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247529099&amp;idx=1&amp;sn=fe3be2d43a6284a36c15625c23dc9a3e&amp;chksm=9b4b3230ac3cbb26b875bd0a294f24dfbd41a2b59996fbfe79087330d267c4ec70882683c3bd&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松‍授课（买一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section><ul data-tool="mdnice编辑器"><li><section> <a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;chksm=9b4b2f10ac3ca606c1c4bac8cf112bb9b0f18e3c4262f5f2b8c0dba3bfedf2ba201507247005&amp;scene=21#wechat_redirect" textvalue="2024的共享服务器交个朋友福利价仍然是800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">2024的共享服务器交个朋友福利价仍然是800</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">千呼万唤始出来的独享生物信息学云服务器</a></section></li></ul><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/oPksS_iNMc7HoNUIDC9rcw",target="_blank" rel="noopener noreferrer">原文链接</a>
