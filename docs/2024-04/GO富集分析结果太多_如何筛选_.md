---
title: "GO富集分析结果太多，如何筛选？"
date: 2024-04-02T02:36:35Z
draft: ["false"]
tags: [
  "fetched",
  "生信小博士"
]
categories: ["Acdemic"]
---
GO富集分析结果太多，如何筛选？ by 生信小博士
------
<div><h3 data-tool="mdnice编辑器"><span>写在开头</span></h3><p>昨天我们介绍了GO、KEGG等各种富集分析方法：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247486534&amp;idx=1&amp;sn=3b42a911950a9d63cf1b84c6fe368a37&amp;chksm=ce6462aff913ebb9023983c2c7dbaafd0de00aefa25853998b7801d9729a6389549cda506265&amp;scene=21#wechat_redirect" textvalue="一文厘清富集分析：GroupGO、enrichGO、gseGO、enrichKEGG、gseKEGG、enrichMKEGG" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">一文厘清富集分析：GroupGO、enrichGO、gseGO、enrichKEGG、gseKEGG、enrichMKEGG</a>。但是富集分析的结果往往会有很多，尤其是GO数据库富集得到的结果。那么如何从众多的富集结果中锁定自己感兴趣的那个呢？</p><p>关于富集分析的结果如何选择，我们已经有了两次介绍：</p><ol><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247484857&amp;idx=1&amp;sn=4ca19c4a3b3bc6aec4ef3422c2832c71&amp;chksm=ce646b50f913e246682144f87034c63dfa533a595ad58389c48936e4be098766cbb9c5479419&amp;scene=21#wechat_redirect" textvalue="富集分析结果不理想：如何从上千个term中找到自己想要所有term？" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">富集分析结果不理想：如何从上千个term中找到自己想要所有term？</a><br></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247485212&amp;idx=1&amp;sn=cb84f9ff8269cb6da586a8b3efea3976&amp;chksm=ce6469f5f913e0e3c4a963a8128e6492e0c259441764b5617f0f563ad47b5783b39b3ac0d727&amp;scene=21#wechat_redirect" textvalue="这是学术造假吗" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">这是学术造假吗</a></p></li></ol><p><span>今天</span><span>我们来全面的分析下</span><strong>如何更好地挑选出自己想要的富集分析结果</strong><span>。</span><span></span></p><h3 data-tool="mdnice编辑器"><span>注意点</span></h3><p>【常用的富集分析数据库有两种：GO，KEGG。但是如果<span>GO，KEGG分析的结果都没有我们想要的结果，我们可能就需要换一个数据框再做富集分析看看了，比如Msigdb。】</span><br></p><p><img data-galleryid="" data-imgfileid="100002878" data-ratio="0.5037037037037037" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkutgDRTxH3b9ERSRMGlgDVPGghNTRaTeRXibZ5mkcKAoPCdiczf6QZFktd22icTHTGc7u9jx8jvEGftw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkutgDRTxH3b9ERSRMGlgDVPGghNTRaTeRXibZ5mkcKAoPCdiczf6QZFktd22icTHTGc7u9jx8jvEGftw/640?wx_fmt=png&amp;from=appmsg"></p><p><br><span>如何更好地挑选出自己想要的富集分析结果</span></p><p data-sourcepos="7:1-7:11"><span>1. 过滤结果</span></p><p data-sourcepos="9:1-9:47">可以根据GO项的P值、FDR等指标，对结果进行过滤。例如，可以只保留P值小于0.05的GO项。</p><p data-sourcepos="3:1-3:13"><span>根据自己心意来筛选结果可以参考：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247485123&amp;idx=2&amp;sn=c7dbde6be26dc804679e9d577bf998c2&amp;chksm=ce64682af913e13cc1f11c5885e51889bb1b03f02a058753f6f8318921c1fec0b9f0e82267f6&amp;scene=21#wechat_redirect" textvalue="富集分析结果不理想：如何从上千个term中找到自己想要所有term？" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">富集分析结果不理想：如何从上千个term中找到自己想要所有term？</a><br></span></p><p data-sourcepos="3:1-3:13">如果不想使用我的方法，可以使用r包中自带的函数<span><strong>filter</strong></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="css"><code><span><span>data</span>(<span>geneList</span>, <span>package</span>="<span>DOSE</span>")</span></code><code><span><span>de</span> &lt;<span>-</span> <span>names</span>(<span>geneList</span>)<span>[abs(geneList) &gt; 2]</span></span></code><code><span><span>ego</span> &lt;<span>-</span> <span>enrichGO</span>(<span>de</span>, <span>ont</span>="<span>BP</span>", <span>OrgDb</span> = '<span>org</span><span>.Hs</span><span>.eg</span><span>.db</span>')</span></code><code><span><br></span></code><code><span><span>ego2</span> &lt;<span>-</span> <span>filter</span>(<span>ego</span>, <span>p</span><span>.adjust</span> &lt; 0<span>.001</span>, <span>Count</span> &gt; 10)</span></code><code><span><br></span></code><code><span><span>ego3</span> &lt;<span>-</span> <span>mutate</span>(<span>ego</span>, <span>richFactor</span> = <span>Count</span> / <span>as</span><span>.numeric</span>(<span>sub</span>("/\\<span>d</span>+", "", <span>BgRatio</span>)))</span></code><code><span><br></span></code><code><span><span>ewp2</span> &lt;<span>-</span> <span>arrange</span>(<span>ewp</span>, <span>desc</span>(<span>abs</span>(<span>NES</span>))) %&gt;%</span></code><code><span><span>group_by</span>(<span>sign</span>(<span>NES</span>)) %&gt;%</span></code><code><span><span>slice</span>(1<span>:5)</span></span></code><code><span><span>#https</span>://<span>www</span><span>.ncbi</span><span>.nlm</span><span>.nih</span><span>.gov</span>/<span>pmc</span>/<span>articles</span>/<span>PMC8454663</span>/</span></code></pre></section><p data-sourcepos="3:1-3:13"><br></p><p data-sourcepos="3:1-3:13"><span>2. 使用简化工具</span></p><p data-sourcepos="5:1-5:102">【GO富集分析的结果冗余性很高。有一些工具可以用于简化GO富集分析的结果，例如<span><strong><code>simplify</code></strong></span>。这些工具可以根据GO项之间的<strong>语义相似</strong>性，将冗余的GO项合并在一起，从而使结果更加简洁易懂】。</p><p data-sourcepos="13:1-13:301">GO 术语以父子结构组织，因此父术语与其所有子术语之间可能存在很大比例的重叠。这会导致冗余的发现。为了解决这个问题，<code>clusterProfiler</code> 提供了 <strong><code>simplify</code></strong> 方法来减少 <code>enrichGO()</code> 和 <code>gseGO()</code> 输出中的冗余 GO 术语。该函数内部调用 <code>GOSemSim</code> (Yu et al. 2010) 来计算 GO 术语之间的语义相似性，并通过保留一个代表性术语来移除那些高度相似的术语。<code>simplify()</code> 方法应用 <code>select_fun</code> (可以是用户定义的函数) 来根据 <code>by</code> 参数从冗余术语（相似度高于 <code>cutoff</code>）中选择一个代表性术语。</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="properties"><code><span>data(geneList, package="DOSE")</span></code><code><span>de &lt;- names(geneList)[abs(geneList) &gt; 2]</span></code><code><span>bp &lt;- enrichGO(de, ont="BP", OrgDb = 'org.Hs.eg.db')</span></code><code><span>bp &lt;- pairwise_termsim(bp)</span></code><code><span><br></span></code><code><span>bp2 &lt;- simplify(bp, cutoff=0.7, by="p.adjust", select_fun=min)</span></code><code><span><br></span></code><code><span>p1 &lt;- emapplot(bp)</span></code><code><span>p2 &lt;- emapplot(bp2)</span></code><code><span>cowplot::plot_grid(p1, p2, ncol=2, labels = LETTERS[1:2])</span></code><code><span><br></span></code><code><span>#https://yulab-smu.top/biomedical-knowledge-mining-book/useful-utilities.html?q=simplify#reduce-redundancy-of-enriched-go-terms</span></code></pre></section><p><span>从下图，我们可以发现许多冗余术语形成了一个非常密集的网络。使用 </span><code>simplify()</code><span> 方法删除冗余术语后，结果更清晰，便于理解整体情况。</span><br></p><p><img data-galleryid="" data-imgfileid="100002877" data-ratio="0.523094688221709" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkutgDRTxH3b9ERSRMGlgDVPBX27MzjPdHCibsX4N8PB7lQPGXR468CCTHGceeuVuM5h3FYgCiaWvMIA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="866" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkutgDRTxH3b9ERSRMGlgDVPBX27MzjPdHCibsX4N8PB7lQPGXR468CCTHGceeuVuM5h3FYgCiaWvMIA/640?wx_fmt=png&amp;from=appmsg"></p><section><ul><li></ul><pre data-lang="sql"><code><span>Alternatively, users can <span>use</span> slim <span>version</span> <span>of</span> <span>GO</span> <span>and</span> <span>use</span> the enricher() <span>or</span> gseGO() functions <span>to</span> analyze.</span></code></pre></section><h3 data-sourcepos="3:1-3:24"><strong><code></code></strong></h3><h3 data-sourcepos="3:1-3:24"><span>3. 删除特定 GO 条目或层级</span></h3><p data-sourcepos="5:1-5:126"><code>enrichGO()</code> 函数会测试整个 GO 语料库，因此富集结果可能包含非常一般的条目。使用 <span><strong><code>dropGO</code></strong></span> 函数，用户可以从 <code>enrichGO()</code> 和 <code>compareCluster()</code> 获得的结果中删除特定的 GO 条目或 GO 层级。</p><section><ul><li><li><li><li><li></ul><pre data-lang="cpp"><code><span>data(geneList, package="DOSE")</span></code><code><span>de &lt;- names(geneList)[abs(geneList) &gt; 2]</span></code><code><span>ego &lt;- enrichGO(de, ont="BP", OrgDb = 'org.Hs.eg.db')</span></code><code><span><br></span></code><code><span>dropGO(ego, level = NULL, term = NULL)</span></code></pre></section><h3 data-sourcepos="7:1-7:24"><span>4. 在特定层级测试 GO 富集</span></h3><p data-sourcepos="9:1-9:121"><code>enrichGO()</code> 函数没有限制测试特定 GO 层级的参数。相反，我们提供了一个函数 <span><strong><code>gofilter()</code></strong></span> 来限制结果到特定的 GO 层级。它可以用于 <code>enrichGO()</code> 和 <code>compareCluster()</code> 获得的结果。</p><section><ul><li><li></ul><pre data-lang="apache"><code><span>#举例子</span></code><code><span>gofilter(ego, level = 4)</span></code></pre></section><p><br></p><p><span><strong>5. 树状图</strong></span></p><p><span>树状图生成的过程并未减少最终得到的GO term数量，而是根据pairwise_termsim()函数计算的丰富项成对相似性进行的。默认情况下，使用Jaccard相似性指数（JC）对GO term进行聚类。treeplot()函数默认采用ward.D作为聚合方法，但用户可以通过hclust_method参数指定其他方法，例如'average'、'complete'、'median'、'centroid'等。此外，treeplot()函数将树切割成若干子树，其数量由nCluster参数确定，默认为5，并使用高频词标记这些子树。</span></p><section><ul><li><li><li><li></ul><pre data-lang="properties"><code><span>edox2 &lt;- pairwise_termsim(edox)</span></code><code><span>p1 &lt;- treeplot(edox2)</span></code><code><span>p2 &lt;- treeplot(edox2, hclust_method = "average")</span></code><code><span>aplot::plot_list(p1, p2, tag_levels='A')</span></code></pre></section><p><img data-imgfileid="100002879" data-ratio="0.4287037037037037" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkutgDRTxH3b9ERSRMGlgDVPg57BfY29aPavtZ3HjXyyd5icf9dHAgTUThNTCIIscpJJJUCmQhDeMQQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkutgDRTxH3b9ERSRMGlgDVPg57BfY29aPavtZ3HjXyyd5icf9dHAgTUThNTCIIscpJJJUCmQhDeMQQ/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><span><strong>6. 生物主题比较</strong></span></p><p><span>本质上，利用语义学对类似的GO结果进行聚类，使得相似的富集分析结果能够被集中展示，这有助于我们更好地观察富集分析的结果。</span></p><p><span>emapplot函数能够处理从clusterProfiler软件包的compareCluster函数中得到的结果。除了调整cex_category和布局参数外，还可以使用legend_n参数来控制左下角圆圈的数量，如下图所示；同时，使用pie参数可以调整饼图中的聚类比例。当pie="count"时，饼图中的聚类比例取决于基因数量。</span></p><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="kotlin"><code><span>library(clusterProfiler)</span></code><code><span><span>data</span>(gcSample)</span></code><code><span>xx &lt;- compareCluster(gcSample, <span><span>fun</span>="enrichKEGG",</span></span></code><code><span>                     organism=<span>"hsa"</span>, pvalueCutoff=<span>0.05</span>)</span></code><code><span>xx &lt;- pairwise_termsim(xx)                     </span></code><code><span>p1 &lt;- emapplot(xx)</span></code><code><span>p2 &lt;- emapplot(xx, legend_n=<span>2</span>) </span></code><code><span>p3 &lt;- emapplot(xx, pie=<span>"count"</span>)</span></code><code><span>p4 &lt;- emapplot(xx, pie=<span>"count"</span>, cex_category=<span>1.5</span>, layout=<span>"kk"</span>)</span></code><code><span>cowplot::plot_grid(p1, p2, p3, p4, ncol=<span>2</span>, labels=LETTERS[<span>1</span>:<span>4</span>])</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002880" data-ratio="0.8566108007448789" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkutgDRTxH3b9ERSRMGlgDVPuKCOTcgYvVnNPoOmEiaIFTvj7esDWiaFLCeuQR3dFRgRLBd5ufMnXgtA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1074" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkutgDRTxH3b9ERSRMGlgDVPuKCOTcgYvVnNPoOmEiaIFTvj7esDWiaFLCeuQR3dFRgRLBd5ufMnXgtA/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><strong><span>其他可能用到的函数</span></strong></p><section><ul><li></ul><pre><code><span> cnetplot(xx)</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002881" data-ratio="0.8925143953934741" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkutgDRTxH3b9ERSRMGlgDVPqzF7TelU5AULYk51ibygebZehRa6v7kjBn6JkBDodibJnpwI0LyjzH8A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1042" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkutgDRTxH3b9ERSRMGlgDVPqzF7TelU5AULYk51ibygebZehRa6v7kjBn6JkBDodibJnpwI0LyjzH8A/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><section><ul><li></ul><pre><code><span>goplot(ego)</span></code></pre></section><p><img data-imgfileid="100002903" data-ratio="1.5" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktiaEaTBxcRic49fGA9jJNANQNJ5L05wKo10wufibnONuzIQ7IFbc0XUFPWqZm7W5qYEicnw12r3SicdBw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktiaEaTBxcRic49fGA9jJNANQNJ5L05wKo10wufibnONuzIQ7IFbc0XUFPWqZm7W5qYEicnw12r3SicdBw/640?wx_fmt=png&amp;from=appmsg"></p><section><ul><li><li><li></ul><pre data-lang="javascript"><code><span>参考</span></code><code><span>https://yulab-smu.top/biomedical-knowledge-mining-book/useful-utilities.html</span></code><code><span>https:<span>//www.ncbi.nlm.nih.gov/pmc/articles/PMC8454663/</span></span></code></pre></section><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg2NDcxMzYwNg==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sks7JhVxUX46ZKxPSob6ptqIZgnIEnHOn5VMwCX8sN6MQy1Pq4XXFEOJ6grAmsoQugyCDKOZictDBHA/0?wx_fmt=png" data-nickname="生信小博士" data-alias="bioinformatics_Dr" data-signature="【生物信息学】R语言开始，学习生信。Seurat，单细胞测序，空间转录组。 Python，scanpy，cell2location。资料分享" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/wjHC4N0TDjDcfmJLBRwV8Q",target="_blank" rel="noopener noreferrer">原文链接</a>
