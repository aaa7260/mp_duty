---
title: "RTN包完成转录因子活性计算"
date: 2024-04-16T01:38:52Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
RTN包完成转录因子活性计算 by 生信星球
------
<div><section data-mpa-powered-by="yiban.io"><br></section><section><span>‍</span></section><section><img data-imgfileid="100010843" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"><img data-imgfileid="100010844" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png"><span> 今天是生信星球陪你的<span><strong>第942天</strong></span></span><img data-imgfileid="100010845" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"></section><hr><section><span><span>   </span><span>大神一句话，菜鸟跑半年。我不是大神，但我可以缩短你走弯路的半年~</span></span></section><section><span>   就像歌儿唱的那样，如果你不知道该往哪儿走，就留在这学点生信好不好~</span></section><p><span>   这里有豆豆和花花的学习历程，从新手到进阶，生信路上有你有我！</span></p><p><span></span></p><section><h4><span><span> </span>0.转录调控是什么</span></h4><blockquote><p>转录调控网络 （TRN） 由一系列受调控的靶基因和转录因子 （TF） 组成。TF识别特定的DNA序列并影响整个基因组的基因表达，激活或抑制靶基因的表达。</p></blockquote><p>同样是使用<code>browseVignettes("RTN")</code>可以召唤作者写的网页教程啦。<br>本文主要介绍的是如何使用RTN包计算给定转录因子的活性分数，可以用于比较不同分组、不同亚型，反应它们之间的差别。</p><h4><span><span> </span>1.载入数据</span></h4><p>这里使用的是TCGA的CHOLtpm矩阵作为输入数据,可以从xena下载或者使用TCGAbiolinks下载。获取到的数据是ensemblID为行名，用我的trans_exp_new函数即可一键转换为symbol为行名的矩阵，主打一个方便</p><pre><code>rm(list = ls())<br>library(tinyarray)<br>library(RTN)<br>load("D:/TCGA_RNA_seq/tpm/chol_tpm.Rdata")<br>chol_tpm[1:4,1:4]<br><span><br>#</span><span>#                    TCGA-W5-AA31-11A-11R-A41I-07 TCGA-W5-AA2I-11A-11R-A41I-07</span><br><span>#</span><span># ENSG00000000003.15                   52.4879900                    50.755962</span><br><span>#</span><span># ENSG00000000005.6                     0.2202611                     0.000000</span><br><span>#</span><span># ENSG00000000419.13                   38.5619360                    26.416471</span><br><span>#</span><span># ENSG00000000457.14                    3.5424822                     2.108877</span><br><span>#</span><span>#                    TCGA-W5-AA2T-01A-12R-A41I-07 TCGA-ZH-A8Y5-01A-11R-A41I-07</span><br><span>#</span><span># ENSG00000000003.15                 195.20640279                    151.57279</span><br><span>#</span><span># ENSG00000000005.6                    0.05815264                      0.00000</span><br><span>#</span><span># ENSG00000000419.13                 106.74049022                    132.05190</span><br><span>#</span><span># ENSG00000000457.14                  16.58554100                     21.98301</span><br><br>exp = trans_exp_new(chol_tpm)<br>exp = log2(exp+1)<br>exp[1:4,1:4]<br><span><br>#</span><span>#             TCGA-W5-AA31-11A-11R-A41I-07 TCGA-W5-AA2I-11A-11R-A41I-07</span><br><span>#</span><span># DDX11L1                        0.0000000                    0.0000000</span><br><span>#</span><span># WASH7P                         0.3110852                    0.4480656</span><br><span>#</span><span># MIR6859-1                      0.0000000                    0.0000000</span><br><span>#</span><span># MIR1302-2HG                    0.0000000                    0.0000000</span><br><span>#</span><span>#             TCGA-W5-AA2T-01A-12R-A41I-07 TCGA-ZH-A8Y5-01A-11R-A41I-07</span><br><span>#</span><span># DDX11L1                         0.000000                     0.000000</span><br><span>#</span><span># WASH7P                          2.748028                     2.116400</span><br><span>#</span><span># MIR6859-1                       2.870122                     2.979347</span><br><span>#</span><span># MIR1302-2HG                     0.000000                     0.000000</span><br><br>Group = make_tcga_group(exp)<br>table(Group)<br><span><br>#</span><span># Group</span><br><span>#</span><span># normal  tumor </span><br><span>#</span><span>#      9     35</span><br></code></pre><h4><span><span> </span>2.创建对象</span></h4><p>有点单细胞的气质，直接组织成对象。</p><p>tfs是自己指定的转录因子，可以查自文献或者转录因子数据库。这里使用示例里的5个。</p><p>创建对象需要两个参数，一个是表达矩阵，一个是转录因子</p><pre><code>tfs &lt;- c(<span>"FOXM1"</span>,<span>"E2F2"</span>,<span>"E2F3"</span>,<span>"RUNX2"</span>,<span>"PTTG1"</span>)<br>rtni &lt;- tni.constructor(expData = exp,<br>                        regulatoryElements = tfs)<br><br><span>## -Preprocessing for input data...</span><br><span>## --Checking 'regulatoryElements' in 'rowAnnotation'...</span><br><span>## --Checking 'expData'...</span><br><span>## --Removing inconsistent data: standard deviation is zero for 10261 gene(s)! </span><br><span>## -Preprocessing complete!</span><br><br>str(rtni,max.level = <span>2</span>)<br><br><span>## Formal class 'TNI' [package <span>"RTN"</span>] with 10 slots</span><br><span>##   ..@ gexp              : num [1:50272, 1:44] 0 0.3111 0 0 0.0208 ...</span><br><span>##   .. ..- attr(*, <span>"dimnames"</span>)=List of 2</span><br><span>##   ..@ regulatoryElements: Named chr [1:5] <span>"E2F2"</span> <span>"E2F3"</span> <span>"FOXM1"</span> <span>"PTTG1"</span> ...</span><br><span>##   .. ..- attr(*, <span>"names"</span>)= chr [1:5] <span>"E2F2"</span> <span>"E2F3"</span> <span>"FOXM1"</span> <span>"PTTG1"</span> ...</span><br><span>##   ..@ targetElements    : chr [1:50272] <span>"DDX11L1"</span> <span>"WASH7P"</span> <span>"MIR6859-1"</span> <span>"MIR1302-2HG"</span> ...</span><br><span>##   ..@ modulators        : chr(0) </span><br><span>##   ..@ rowAnnotation     :'data.frame':   50272 obs. of  1 variable:</span><br><span>##   ..@ colAnnotation     :'data.frame':   44 obs. of  1 variable:</span><br><span>##   ..@ para              : list()</span><br><span>##   ..@ results           : list()</span><br><span>##   ..@ summary           :List of 4</span><br><span>##   ..@ status            : Named chr [1:6] <span>"[x]"</span> <span>"[ ]"</span> <span>"[ ]"</span> <span>"[ ]"</span> ...</span><br><span>##   .. ..- attr(*, <span>"names"</span>)= chr [1:6] <span>"Preprocess"</span> <span>"Permutation"</span> <span>"Bootstrap"</span> <span>"DPI.filter"</span> ...</span><br></code></pre><p>可以看到gexp里存储了表达矩阵，regulatoryElements里面存储了转录因子</p><h4><span><span> </span>3.网络计算和去冗余</span></h4><p>下面两个步骤超级慢所以设置一个存在即跳过</p><pre><code><span>tmpf</span> = <span>"rtni.tmp.Rdata"</span><br>if(!file.exists(tmpf)){<br>  <span># 并返回通过排列分析推断的 TRN（对多重假设检验进行校正）</span><br>  <span>rtni</span> &lt;- tni.permutation(rtni, nPermutations = <span>100</span>) <br>  <span># Please set nPermutations &gt;= 1000，运行超级慢，所以写个100，实战自己改动</span><br><span># 用bootstrap分析移除不稳定的互作关系，创建参考网络(refnet)</span><br>  rtni &lt;- tni.bootstrap(rtni) <span>#也是超级慢</span><br>  save(rtni,file = tmpf)<br>}<br>load(tmpf)<br>names(rtni<span>@results</span>)<br><br><span>## [1] "tn.ref"</span><br></code></pre><p>这两步运行完可以看到results里面有了refnet</p><p>tni.dpi.filter是过滤，保留显性TF-target 对，去除冗余，生成tnet(转录网络)</p><pre><code>rtni &lt;- tni.dpi.filter(rtni)<br><span><br>#</span><span># -Applying dpi filter...</span><br><span>#</span><span># -DPI filter complete!</span><br><br>names(rtni@results)<br><span><br>#</span><span># [1] "tn.ref" "tn.dpi"</span><br><span><br>#</span><span> 查看网络摘要</span><br>tni.regulon.summary(rtni)<br><span><br>#</span><span># Regulatory network comprised of 5 regulons.</span><br><span><br>#</span><span># -- DPI-filtered network:</span><br><span><br>#</span><span># regulatoryElements            Targets              Edges </span><br><span>#</span><span>#                  5               7981               9684 </span><br><span>#</span><span>#    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span><br><span>#</span><span>#     158     402    1081    1937    3192    4851</span><br><span><br>#</span><span># -- Reference network:</span><br><span><br>#</span><span># regulatoryElements            Targets              Edges </span><br><span>#</span><span>#                  5               7981              10216 </span><br><span>#</span><span>#    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span><br><span>#</span><span>#     323     662    1188    2043    3192    4851 </span><br><span>#</span><span># ---</span><br></code></pre><h4><span><span> </span>4.计算转录因子的活性分数矩阵及其可视化</span></h4><pre><code>rtni &lt;- tni.gsea2(rtni)<br><span><br>#</span><span># -Checking log space... OK!</span><br><span>#</span><span># -Performing two-tailed GSEA...</span><br><span>#</span><span># --For 5 regulon(s) and 44 sample(s)...</span><br><span>#</span><span># </span><br>|======================================================================| 100%<br><span>#</span><span># -GSEA2 complete!</span><br><br>str(rtni@results,max.level = 2)<br><span><br>#</span><span># List of 3</span><br><span>#</span><span>#  $ tn.ref         : num [1:50272, 1:5] 0 0 0 0 0 0 0 0 0 0 ...</span><br><span>#</span><span>#   ..- attr(*, "dimnames")=List of 2</span><br><span>#</span><span>#  $ tn.dpi         : num [1:50272, 1:5] 0 0 0 0 0 0 0 0 0 0 ...</span><br><span>#</span><span>#   ..- attr(*, "dimnames")=List of 2</span><br><span>#</span><span>#  $ regulonActivity:List of 7</span><br><span>#</span><span>#   ..$ differential      : num [1:44, 1:5] -1.573 -1.583 1.471 1.151 0.263 ...</span><br><span>#</span><span>#   .. ..- attr(*, "dimnames")=List of 2</span><br><span>#</span><span>#   ..$ positive          : num [1:44, 1:5] -0.656 -0.642 0.684 0.38 -0.37 ...</span><br><span>#</span><span>#   .. ..- attr(*, "dimnames")=List of 2</span><br><span>#</span><span>#   ..$ negative          : num [1:44, 1:5] 0.918 0.94 -0.787 -0.771 -0.633 ...</span><br><span>#</span><span>#   .. ..- attr(*, "dimnames")=List of 2</span><br><span>#</span><span>#   ..$ status            : num [1:44, 1:5] -1 -1 1 1 0 -1 0 -1 -1 1 ...</span><br><span>#</span><span>#   .. ..- attr(*, "dimnames")=List of 2</span><br><span>#</span><span>#   ..$ sections          : num 1</span><br><span>#</span><span>#   ..$ center            : num 0</span><br><span>#</span><span>#   ..$ regulatoryElements: Named chr [1:5] "E2F2" "E2F3" "FOXM1" "PTTG1" ...</span><br><span>#</span><span>#   .. ..- attr(*, "names")= chr [1:5] "E2F2" "E2F3" "FOXM1" "PTTG1" ...</span><br></code></pre><p>可以看到计算完后有了regulonActivity</p><blockquote><p>The maximum distance of each running sum from the x-axis represents the enrichment score. GSEA-2T produces two per-phenotype enrichment scores (ES), whose difference (dES = ESpos - ESneg) represents the regulon activity.</p></blockquote><p>differential就是上面说的dES。提取数据画热图即可</p><pre><code>regulonActivity &lt;- tni.get(rtni, what = "regulonActivity")<br>dat &lt;- regulonActivity$differential<br>dat[1:4,1:4]<br><span><br>#</span><span>#                                 E2F2    E2F3   FOXM1   PTTG1</span><br><span>#</span><span># TCGA-W5-AA31-11A-11R-A41I-07 -1.5733 -1.6902 -1.6674 -1.6580</span><br><span>#</span><span># TCGA-W5-AA2I-11A-11R-A41I-07 -1.5827 -1.7051 -1.6789 -1.6593</span><br><span>#</span><span># TCGA-W5-AA2T-01A-12R-A41I-07  1.4712  0.0236  1.4665  1.5103</span><br><span>#</span><span># TCGA-ZH-A8Y5-01A-11R-A41I-07  1.1513  0.2754  1.3606  0.7002</span><br><br>draw_heatmap(t(dat),Group,show_rownames = T)<br></code></pre><figure><img data-imgfileid="100010847" data-ratio="0.5712962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHoRIPsWeCPCdaszk7IrVVmdlIMlI5ibIvD1LZU3oFblhGIwgPYZaSXDkc5kiafkUxq7H9DlXxSpwO9Q/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="1080" title="" src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHoRIPsWeCPCdaszk7IrVVmdlIMlI5ibIvD1LZU3oFblhGIwgPYZaSXDkc5kiafkUxq7H9DlXxSpwO9Q/640?wx_fmt=other&amp;from=appmsg"><figcaption></figcaption></figure><br>虽然只是使用了示例数据里的转录因子，没有基于背景知识做任何的挑选，但是也能看出两组之间存在极其明显的差别<pre><code>draw_boxplot(t(dat),<span>Group</span>)<br></code></pre><figure><img data-imgfileid="100010846" data-ratio="0.768451519536903" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHoRIPsWeCPCdaszk7IrVVmdopFupul1wdjEzxdMRibGH0U5MicIV6LfD646p42dvWLxTM3HIj6x231A/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="691" title="" src="https://mmbiz.qpic.cn/mmbiz_jpg/8oKPbJgbBHoRIPsWeCPCdaszk7IrVVmdopFupul1wdjEzxdMRibGH0U5MicIV6LfD646p42dvWLxTM3HIj6x231A/640?wx_fmt=other&amp;from=appmsg"><figcaption></figcaption></figure></section><section><figure><figcaption></figcaption></figure></section><section><figure><figcaption></figcaption></figure></section><section><figure><figcaption></figcaption></figure></section><section><blockquote><section><span>如果因为代码看不懂，而跟不上正文的节奏，可以来找我，相当于来一个新手保护期。我的课程都是循环开课。下一期的时间，点进去咨询微信咯</span><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247494223&amp;idx=1&amp;sn=956c0412cf4235ad73269a1c219cd90c&amp;chksm=fdfba20dca8c2b1b8cfafefb05d6fa736f2f126c8883086f8963e9aafeb2af39791e2e56e254&amp;scene=21#wechat_redirect" textvalue="生信分析‍直播课程" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">生信分析直播课程</a></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247494009&amp;idx=1&amp;sn=035d253f973f65c0d1069e515eec2ce8&amp;chksm=fdfba13bca8c282de5a9222a2ab8bc0caa2ddf60cab543c2181e6d4a90b553f4dcde5f154adf&amp;scene=21#wechat_redirect" textvalue="生信新手保护学习小组‍" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">生信新手保护学习小组</a><br></section></blockquote></section><section><section><br></section></section><section><br></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/NGBTa-p_pdjdBtwotWdwuQ",target="_blank" rel="noopener noreferrer">原文链接</a>
