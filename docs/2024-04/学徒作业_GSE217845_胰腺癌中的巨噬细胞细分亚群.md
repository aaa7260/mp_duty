---
title: "学徒作业|GSE217845-胰腺癌中的巨噬细胞细分亚群"
date: 2024-04-12T13:28:47Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
学徒作业|GSE217845-胰腺癌中的巨噬细胞细分亚群 by 单细胞天地
------
<div><section data-style-type="5" data-tools="新媒体排版" data-id="2430070"><section data-style-type="5" data-tools="新媒体排版" data-id="2390348"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section><br></section><section><section><section powered-by="xiumi.us"><section><section><p>分享是一种态度</p></section></section></section></section></section></section></section></section><section><section powered-by="xiumi.us"><section><section><img data-ratio="0.8738095238095238" data-src="https://mmbiz.qpic.cn/mmbiz_gif/siaia0BDGJdjSnnb9ibXpFagGPWQ0JjSSTNVBZthROEhicfINuLcxX2Ro3Zb600LJhrzeYIb120tLjSVXEtLn14DwA/640?wx_fmt=gif" data-type="gif" data-w="420" width="100%" data-imgfileid="100037724" src="https://mmbiz.qpic.cn/mmbiz_gif/siaia0BDGJdjSnnb9ibXpFagGPWQ0JjSSTNVBZthROEhicfINuLcxX2Ro3Zb600LJhrzeYIb120tLjSVXEtLn14DwA/640?wx_fmt=gif"></section></section></section></section></section></section></section></section></section><section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>这篇推文是<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247529423&amp;idx=1&amp;sn=70a6bfce232bd955d647a69f9aa792fa&amp;scene=21#wechat_redirect" data-linktype="2">数据处理过程中的合理的质量控制是很有必要的</a>中的学徒作业，文章为：《IL-1β+ macrophages fuel pathogenic inflammation in pancreatic cancer》。数据集为GSE217845。</p></blockquote><p data-tool="mdnice编辑器">学徒作业的要求是：从上面的数据集GSE217845里面的10个胰腺癌的10x技术单细胞转录组数据的<span>第一层次降维聚类分群</span>里面提前髓系免疫细胞后，继续细分降维聚类拿到里面的<span>巨噬细胞</span>，然后继续细分巨噬细胞看看能否复现文章里面的：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100037732" data-ratio="0.5481481481481482" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1O41pZWSJ9n5p48lnaa1XF8gLxJdL6qzsmmfXxejEVrwic0Z9lX5x3mQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1O41pZWSJ9n5p48lnaa1XF8gLxJdL6qzsmmfXxejEVrwic0Z9lX5x3mQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>复现文章的图1a</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>第一层次降维聚类分群</span></h2><p data-tool="mdnice编辑器">在做学徒作业的时候，<code>sce.all.filt</code>变量与上述推文中<code>自行探索最佳质量控制流程</code>部分是一样的。<img data-imgfileid="100037729" data-ratio="0.17912552891396333" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1pepjmoodceeZrBibqyHIf0f3cAtnSwyEPCwZJ16UVKIlUqQ6GFRuhiaA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="709" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1pepjmoodceeZrBibqyHIf0f3cAtnSwyEPCwZJ16UVKIlUqQ6GFRuhiaA/640?wx_fmt=png&amp;from=appmsg">第一层次降维聚类分群的代码如下，strict version部分沿用了推文中的严格过滤参数：</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br>options(stringsAsFactors = <span>F</span>) <br><span>source</span>(<span>'scRNA_scripts/lib.R'</span>)<br>getwd()<br><br><span>###### step1: 导入数据 ######   </span><br><span># 付费环节 800 元人民币</span><br><span># 参考：https://mp.weixin.qq.com/s/tw7lygmGDAbpzMTx57VvFw</span><br><br>dir=<span>'GSE217845_RAW/'</span><br>samples=list.dirs( dir )<br>samples<br>samples=samples[grep(<span>"Tumor"</span>,samples)]<br>sceList = lapply(samples,<span>function</span>(pro){ <br>  <span># pro=samples[1] </span><br>  print(pro)  <br>  tmp = Read10X(file.path(pro )) <br>  <span>if</span>(length(tmp)==<span>2</span>){<br>    ct = tmp[[<span>1</span>]] <br>  }<span>else</span>{ct = tmp}<br>  print(dim(ct))<br>  sce =CreateSeuratObject(counts =  ct ,<br>                          project =  pro  ,<br>                          min.cells = <span>5</span>,<br>                          min.features = <span>300</span> )<br>  <span>return</span>(sce)<br>}) <br>do.call(rbind,lapply(sceList, dim))<br><br>sce.all=merge(x=sceList[[<span>1</span>]],<br>              y=sceList[ -<span>1</span> ],<br>              add.cell.ids = samples  ) <br>names(sce.all@assays$RNA@layers)<br>sce.all[[<span>"RNA"</span>]]$counts <br><span># Alternate accessor function with the same result</span><br>LayerData(sce.all, assay = <span>"RNA"</span>, layer = <span>"counts"</span>)<br>sce.all &lt;- JoinLayers(sce.all)<br>dim(sce.all[[<span>"RNA"</span>]]$counts )<br> <br>as.data.frame(sce.all@assays$RNA$counts[<span>1</span>:<span>10</span>, <span>1</span>:<span>2</span>])<br>head(sce.all@meta.data, <span>10</span>)<br>table(sce.all$orig.ident) <br><br>sp=<span>'human'</span><br><br><span>#### loose version:</span><br>{<br>  <span># 如果为了控制代码复杂度和行数 </span><br>  <span># 可以省略了质量控制环节</span><br>  <span>###### step2: QC质控 ######</span><br>  dir.create(<span>"./1-QC.loose"</span>)<br>  setwd(<span>"./1-QC.loose"</span>)<br>  <span># 如果过滤的太狠，就需要去修改这个过滤代码</span><br>  <span>source</span>(<span>'../scRNA_scripts/qc.R'</span>)<br>  sce.all.filt = basic_qc(sce.all)<br>  print(dim(sce.all))<br>  print(dim(sce.all.filt))<br>  setwd(<span>'../'</span>)<br>  getwd()<br>  <br>  <span>###### step3: harmony整合多个单细胞样品 ######</span><br>  <br>  <span>if</span>(<span>T</span>){<br>    dir.create(<span>"2-harmony.loose"</span>)<br>    getwd()<br>    setwd(<span>"2-harmony.loose"</span>)<br>    <span>source</span>(<span>'../scRNA_scripts/harmony.R'</span>)<br>    <span># 默认 ScaleData 没有添加"nCount_RNA", "nFeature_RNA"</span><br>    <span># 默认的</span><br>    sce.all.int = run_harmony(sce.all.filt)<br>    setwd(<span>'../'</span>)<br>    <br>  }<br>  <br>  <span>###### step4:  看标记基因库 ######</span><br>  <span># 原则上分辨率是需要自己肉眼判断，取决于个人经验</span><br>  <span># 为了省力，我们直接看  0.1和0.8即可</span><br>  <br>  table(Idents(sce.all.int))<br>  table(sce.all.int$seurat_clusters)<br>  table(sce.all.int$RNA_snn_res.0.1) <br>  table(sce.all.int$RNA_snn_res.0.8) <br>  <br>  getwd()<br>  dir.create(<span>'check-by-0.1.loose'</span>)<br>  setwd(<span>'check-by-0.1.loose'</span>)<br>  sel.clust = <span>"RNA_snn_res.0.1"</span><br>  sce.all.int &lt;- SetIdent(sce.all.int, value = sel.clust)<br>  table(sce.all.int@active.ident) <br>  <br>  <span>source</span>(<span>'../scRNA_scripts/check-all-markers.R'</span>)<br>  setwd(<span>'../'</span>) <br>  getwd()<br>}<br><br><span>#### strict version:</span><br>{<br>  sce.all.filt=subset(sce.all.filt,subset = percent_mito &lt; <span>40</span> &amp; <br>                        nCount_RNA &lt;<span>10000</span> &amp; <br>                        nFeature_RNA &lt;<span>7500</span>&amp;<br>                        nFeature_RNA&gt;<span>500</span>)<br>  sce.all.filt <br><br>  <span>###### step3: harmony整合多个单细胞样品 ######</span><br>  <br>  <span>if</span>(<span>T</span>){<br>    dir.create(<span>"2-harmony"</span>)<br>    getwd()<br>    setwd(<span>"2-harmony"</span>)<br>    <span>source</span>(<span>'../scRNA_scripts/harmony.R'</span>)<br>    <span># 默认 ScaleData 没有添加"nCount_RNA", "nFeature_RNA"</span><br>    <span># 默认的</span><br>    sce.all.int = run_harmony(sce.all.filt)<br>    setwd(<span>'../'</span>)<br>    <br>  }<br><br>}<br><br><span>###### step4:  看标记基因库 ######</span><br><span># 原则上分辨率是需要自己肉眼判断，取决于个人经验</span><br><span># 为了省力，我们直接看  0.1和0.8即可</span><br><br>table(Idents(sce.all.int))<br>table(sce.all.int$seurat_clusters)<br>table(sce.all.int$RNA_snn_res.0.1) <br>table(sce.all.int$RNA_snn_res.0.8) <br><br>getwd()<br>dir.create(<span>'check-by-0.1'</span>)<br>setwd(<span>'check-by-0.1'</span>)<br>sel.clust = <span>"RNA_snn_res.0.1"</span><br>sce.all.int &lt;- SetIdent(sce.all.int, value = sel.clust)<br>table(sce.all.int@active.ident) <br><br><span>source</span>(<span>'../scRNA_scripts/check-all-markers.R'</span>)<br>setwd(<span>'../'</span>) <br>getwd()<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>提取髓系细胞亚群重新进行标准化以及降维聚类分群</span></h2><p data-tool="mdnice编辑器">在0.1的分辨率下，也提取了髓系免疫细胞（cluster 2）:</p><pre data-tool="mdnice编辑器"><span></span><code>sce_myeloid &lt;- subset(sce.all.int, subset = (RNA_snn_res.0.1 %<span>in</span>% c(<span>2</span>)))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100037731" data-ratio="1.0928196147110332" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1vpPlLXzxKAULwXZplgpsic94feGricLLjA0TpoBVibukZicwibJdeFD0kqA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="571" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1vpPlLXzxKAULwXZplgpsic94feGricLLjA0TpoBVibukZicwibJdeFD0kqA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">对<code>sce_myeloid</code>对象再次进行标准化，样本整合以及细分亚群：</p><pre data-tool="mdnice编辑器"><span></span><code>sce_myeloid &lt;- CreateSeuratObject(counts = sce_myeloid@assays$RNA$counts,<br>                              meta.data = sce_myeloid@meta.data[,<span>1</span>:<span>6</span>])<br>  sce_myeloid &lt;- NormalizeData(sce_myeloid,normalization.method = <span>"LogNormalize"</span>,<br>                         scale.factor = <span>1e4</span>)<br>  GetAssay(sce_myeloid,assay = <span>"RNA"</span>)<br>  sce_myeloid &lt;- FindVariableFeatures(sce_myeloid,<br>                                selection.method = <span>"vst"</span>,nfeatures = <span>2000</span>)<br>  sce_myeloid &lt;- ScaleData(sce_myeloid)<br>  sce_myeloid &lt;- RunPCA(object = sce_myeloid,pc.genes = VariableFeatures(sce_myeloid))<br>  <br>  {<br>    sce_myeloid &lt;- RunHarmony(sce_myeloid, <span>"orig.ident"</span>)<br>    names(sce_myeloid@reductions)<br>    sce_myeloid &lt;- RunUMAP(sce_myeloid,  dims = <span>1</span>:<span>15</span>, <br>                         reduction = <span>"harmony"</span>)<br>  }<br>  <br>  sce_myeloid<br>  sce_myeloid &lt;- FindNeighbors(sce_myeloid,dims = <span>1</span>:<span>15</span>,reduction = <span>"harmony"</span>)<br>  <span>for</span> (res <span>in</span> c(<span>0.01</span>, <span>0.05</span>, <span>0.1</span>, <span>0.2</span> ,<span>0.3</span>, <span>0.5</span>, <span>0.8</span>, <span>1</span>)) {<br>    sce_myeloid = FindClusters(sce_myeloid,<br>                         resolution = res, algorithm = <span>1</span>)  <br>  }<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>复现文章中的命名</span></h2><p data-tool="mdnice编辑器">接下来想按照文章中的标记基因尝试进行命名：<img data-imgfileid="100037733" data-ratio="0.4656019656019656" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1SfibceYGU894ooY0s0743GgYpiaIM3Kj6s8W9eEHY4biccPvxQ0aWXrmA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="814" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1SfibceYGU894ooY0s0743GgYpiaIM3Kj6s8W9eEHY4biccPvxQ0aWXrmA/640?wx_fmt=png&amp;from=appmsg">在0.2的分辨率下有7个cluster，但对应文章中的标记基因不明显：<img data-imgfileid="100037730" data-ratio="0.4935185185185185" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1THV3picvqtbF8rjHAdE4VSRVEOibkUCVBDpQDngR3Tvm65LkVRicrgE5w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1THV3picvqtbF8rjHAdE4VSRVEOibkUCVBDpQDngR3Tvm65LkVRicrgE5w/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">于是提高分辨率去看，在0.8的分辨率下有17个cluster，下图中红色的标记文字为我认为标记基因对应的cluster编号。<img data-imgfileid="100037736" data-ratio="0.49444444444444446" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1ZUy8EkNZkAsZrVib03950iaqLStfFMN3gwQUfaZ9icaBayQARnEhI1GbQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1ZUy8EkNZkAsZrVib03950iaqLStfFMN3gwQUfaZ9icaBayQARnEhI1GbQ/640?wx_fmt=png&amp;from=appmsg"></p><pre data-tool="mdnice编辑器"><span></span><code>celltype=data.frame(ClusterID=<span>0</span>:<span>17</span> ,<br>                      celltype= <span>0</span>:<span>17</span> ) <br>  <span>#定义细胞亚群 </span><br>  <span># myeloids_paper_list 和上面一样</span><br>  myeloids_paper_list =list(<br>    MKI67=c(<span>"MKI67"</span>,<span>"TOP2A"</span>,<span>"PCLAF"</span>,<span>"UBE2C"</span>,<span>"TK1"</span>),<br>    HSP=c(<span>"HSPA6"</span>,<span>"SERPINH1"</span>,<span>"BAG3"</span>,<span>"HSPB1"</span>,<span>"HSPD1"</span>),<br>    SPP1=c(<span>"SPP1"</span>,<span>"MARCO"</span>,<span>"FBP1"</span>,<span>"APOC1"</span>,<span>"LIPA"</span>),<br>    IL1B=c(<span>"IL1B"</span>,<span>"IL1A"</span>,<span>"NLRP3"</span>,<span>"PTGS2"</span>,<span>"CCL3"</span>),<br>    FOLR2=c(<span>"FOLR2"</span>,<span>"LYVE1"</span>,<span>"SELENOP"</span>,<span>"SLC40A1"</span>,<span>"MRC1"</span>),<br>    MT=c(<span>"MT1H"</span>,<span>"MT1G"</span>,<span>"MT1X"</span>,<span>"MT1E"</span>,<span>"MT2A"</span>)<br>  )<br>  celltype[celltype$ClusterID %<span>in</span>% c(<span>13</span>),<span>2</span>]=<span>'MKI67+'</span>   <br>  celltype[celltype$ClusterID %<span>in</span>% c(<span>4</span>),<span>2</span>]=<span>'HSP+'</span>  <br>  celltype[celltype$ClusterID %<span>in</span>% c(<span>2</span>),<span>2</span>]=<span>'SPP1+'</span> <br>  celltype[celltype$ClusterID %<span>in</span>% c(<span>0</span>,<span>6</span>,<span>11</span>),<span>2</span>]=<span>'IL1B+'</span> <br>  celltype[celltype$ClusterID %<span>in</span>% c(<span>3</span>),<span>2</span>]=<span>'FOLR2+'</span> <br>  celltype[celltype$ClusterID %<span>in</span>% c(<span>7</span>,<span>15</span>,<span>16</span>,<span>17</span>),<span>2</span>]=<span>'MT+'</span><br>  <br>  table(celltype$celltype)<br>  <span># 1     10     12     14      5      8      9 FOLR2+   HSP+  IL1B+ MKI67+    MT+  SPP1+ </span><br>  <span># 1      1      1      1      1      1      1      1      1      3      1      4      1 </span><br></code></pre><p data-tool="mdnice编辑器">发现1,5,8,9,10,12,14还没有命名。检查了每个cluster的前10个差异基因。有以下发现：</p><ul data-tool="mdnice编辑器"><li><section>cluster 14 有S100A8，S100A12基因高表达，是中性粒细胞或者单核细胞。（S100A8、S100A9 和 S100A12 主要由中性粒细胞和单核细胞表达：https://zhuanlan.zhihu.com/p/440315960）</section></li><li><section>cluster 9 还不能确定，和IL1B+的表达模式有些接近，但是多了几个基因的表达。<img data-imgfileid="100037734" data-ratio="2.4280821917808217" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1kqwUsD8tqeIo9Ygb1da7aCRZGFC6ibxCbCAlzzYaDlxaLs9GknGlyiag/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="292" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1kqwUsD8tqeIo9Ygb1da7aCRZGFC6ibxCbCAlzzYaDlxaLs9GknGlyiag/640?wx_fmt=png&amp;from=appmsg"></section></li><li><section>cluster 5 应该是cDC2细胞，高表达 CD1C, FCER1A, CLEC10A基因。</section></li><li><section>cluster 12 有CD3E基因高表达，所以是T细胞。</section></li><li><section>cluster 10 无法确定。</section></li><li><section>cluster 8 无法确定，和 cluster 9 有点像。</section></li></ul><p data-tool="mdnice编辑器">去除非巨噬细胞的细胞类型：5是cDC2细胞，12是T细胞。将其他文章中没有出现的巨噬细胞类型命名为<code>other</code>，得到最终的命名结果。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100037737" data-ratio="1.006006006006006" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd163UOiaHzsdfUsfLukibAthnyYBQAjcxtjHnMtsY3TQYVic1VQ0x31NVNQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="666" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd163UOiaHzsdfUsfLukibAthnyYBQAjcxtjHnMtsY3TQYVic1VQ0x31NVNQ/640?wx_fmt=png&amp;from=appmsg"></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100037735" data-ratio="0.49537037037037035" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1FsKh2FYBTdXRIicxpenuvfpqOha9g5SHQpmVfjMwnyuMtvPYgD3FqTw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1FsKh2FYBTdXRIicxpenuvfpqOha9g5SHQpmVfjMwnyuMtvPYgD3FqTw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">最终命名的代码如下：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 去除非巨噬细胞的细胞类型：5是cDC2细胞，12是T细胞</span><br>  sce_myeloid = sce_myeloid[, !(Idents(sce_myeloid) %<span>in</span>% c(<span>5</span>,<span>12</span>))]<br>  <br>  celltype[celltype$ClusterID %<span>in</span>% c( <span>1</span>,<span>10</span>,<span>12</span>,<span>14</span>,<span>5</span>,<span>8</span>,<span>9</span> ),<span>2</span>]=<span>'other'</span><br>  <br>  sce_myeloid@meta.data$celltype = <span>"NA"</span><br>  <br>  <span>for</span>(i <span>in</span> <span>1</span>:nrow(celltype)){<br>    sce_myeloid@meta.data[which(sce_myeloid@meta.data$RNA_snn_res.0.8 == celltype$ClusterID[i]),<span>'celltype'</span>] &lt;- celltype$celltype[i]}<br>  Idents(sce_myeloid)=sce_myeloid$celltype<br>}<br><br><span>if</span>(<span>"celltype"</span> %<span>in</span>% colnames(sce_myeloid@meta.data ) ){<br>  <br>  sel.clust = <span>"celltype"</span><br>  sce_myeloid &lt;- SetIdent(sce_myeloid, value = sel.clust)<br>  table(sce_myeloid@active.ident) <br>  <br>  dir.create(<span>'myeloid-check-by-celltype'</span>)<br>  setwd(<span>'myeloid-check-by-celltype'</span>)<br>  <span>source</span>(<span>'../scRNA_scripts/check-paper-myeloid-markers.R'</span>)<br>  setwd(<span>'../'</span>) <br>  getwd()<br>  phe=sce_myeloid@meta.data<br>  save(phe,file = <span>'myeloid_phe.Rdata'</span>)<br>  pdf(<span>'myeloid-celltype-vs-orig.ident.pdf'</span>,width = <span>10</span>)<br>  gplots::balloonplot(table(sce_myeloid$celltype,sce_myeloid$orig.ident))<br>  dev.off()<br>  <br>  th=theme(axis.text.x=element_text(angle=<span>45</span>,hjust = <span>1</span>))<br>  <br>  DotPlot(sce_myeloid, features = myeloids_paper_list,<br>                        assay=<span>'RNA'</span> ,group.by = <span>'celltype'</span> )  + coord_flip()+th<br>  <br>  ggsave(<span>'myeloid-markers-dotplot.pdf'</span>,width = <span>12</span>,height = <span>6</span>)<br>  DimPlot(sce_myeloid, reduction = <span>"umap"</span>, group.by = <span>"celltype"</span>,label = <span>T</span>,label.box = <span>T</span>)<br>  ggsave(<span>'myeloid-markers_umap-celltype.pdf'</span>,width = <span>8</span>,height = <span>8</span>)<br>}<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>画图代码分享</span></h2><p data-tool="mdnice编辑器">附上前面标记基因（文章中的）和差异基因的dotplot图的代码。</p><h3 data-tool="mdnice编辑器"><span></span><span>标记基因（文章中）dotplot图的代码</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>pro = <span>'qc-'</span><br>myeloids_paper_list =list(<br>    MKI67=c(<span>"MKI67"</span>,<span>"TOP2A"</span>,<span>"PCLAF"</span>,<span>"UBE2C"</span>,<span>"TK1"</span>),<br>    HSP=c(<span>"HSPA6"</span>,<span>"SERPINH1"</span>,<span>"BAG3"</span>,<span>"HSPB1"</span>,<span>"HSPD1"</span>),<br>    SPP1=c(<span>"SPP1"</span>,<span>"MARCO"</span>,<span>"FBP1"</span>,<span>"APOC1"</span>,<span>"LIPA"</span>),<br>    IL1B=c(<span>"IL1B"</span>,<span>"IL1A"</span>,<span>"NLRP3"</span>,<span>"PTGS2"</span>,<span>"CCL3"</span>),<br>    FOLR2=c(<span>"FOLR2"</span>,<span>"LYVE1"</span>,<span>"SELENOP"</span>,<span>"SLC40A1"</span>,<span>"MRC1"</span>),<br>    MT=c(<span>"MT1H"</span>,<span>"MT1G"</span>,<span>"MT1X"</span>,<span>"MT1E"</span>,<span>"MT2A"</span>)<br>  )<br>  <br>  markers_list&lt;- c(<span>'myeloids_paper_list'</span>)<br>  <br>  lapply(markers_list, <span>function</span>(x){<br>    <span># x=markers_list[1]</span><br>    genes_to_check = lapply(get(x), str_to_upper)<br>    dup=names(table(unlist(genes_to_check)))[table(unlist(genes_to_check))&gt;<span>1</span>]<br>    genes_to_check = lapply(genes_to_check, <span>function</span>(x) x[!x %<span>in</span>% dup])<br>    <br>    DotPlot(sce_myeloid , features = genes_to_check )  + <br>      <span># coord_flip() + </span><br>      theme(axis.text.x=element_text(angle=<span>45</span>,hjust = <span>1</span>))<br>    <br>    w=length( unique(unlist(genes_to_check)) )/<span>5</span>+<span>6</span>;w<br>    ggsave(paste0(<span>'check_for_'</span>,x,<span>'.pdf'</span>),width  = w,height=<span>6</span>)<br>  })<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>差异基因的dotplot图的代码</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>## top10 genes</span><br>  marker_cosg &lt;- cosg(<br>    sce_myeloid,<br>    groups=<span>'all'</span>,<br>    assay=<span>'RNA'</span>,<br>    slot=<span>'data'</span>,<br>    mu=<span>1</span>,<br>    n_genes_user=<span>100</span>)<br>  <br>  <span>library</span>(dplyr)  <br>  top_10 &lt;- unique(as.character(apply(marker_cosg$names,<span>2</span>,head,<span>10</span>)))<br>  <span># width &lt;-0.006*dim(sce_myeloid)[2];width</span><br>  <span># height &lt;- 0.25*length(top_10)+4.5;height</span><br>  <br>  width &lt;- <span>15</span>+<span>0.5</span>*length(unique(Idents(sce_myeloid)));width<br>  height &lt;- <span>8</span>+<span>0.1</span>*length(top_10);height<br>  <br>  sce.Scale &lt;- ScaleData(sce_myeloid ,features =  top_10  )  <br>  <br>  DoHeatmap(  sce.Scale , top_10 , <br>              size=<span>3</span>)<br>  <br>  ggsave(filename=paste0(pro,<span>'DoHeatmap_check_top10_markers_by_clusters.pdf'</span>) ,<br>         <span># limitsize = FALSE,</span><br>         units = <span>"cm"</span>,width=width,height=height)<br>  width &lt;- <span>8</span>+<span>0.6</span>*length(unique(Idents(sce_myeloid)));width<br>  height &lt;- <span>8</span>+<span>0.2</span>*length(top_10);height<br>  DotPlot(sce_myeloid, features = top_10 ,<br>          assay=<span>'RNA'</span>  )  + coord_flip() +FontSize(y.text = <span>4</span>) + theme(axis.text.x=element_text(angle=<span>45</span>,hjust = <span>1</span>))<br>  ggsave(paste0(pro,<span>'DotPlot_check_top10_markers_by_clusters.pdf'</span>),<br>         units = <span>"cm"</span>,width=width,height=height)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>小结</span></h2><ul data-tool="mdnice编辑器"><li><section>根据分析目的，合理调整过滤参数</section></li><li><section>该文献对细胞亚群的命名规则为：提取出只在某些 cluster 中特异性、高表达的基因（假设为基因A），将其定义为 A+ 细胞。巨噬细胞的这种规则的亚群命名还是挺常见的，比如另一篇文献《<span>Pan-Cancer Single-Cell and Spatial-Resolved Profiling Reveals the Immunosuppressive Role of APOE</span>  <span>Macrophages in Immune Checkpoint Inhibitor Therapy</span>》。其他单细胞亚群的命名规则详见生信技能树最近的推文：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247529601&amp;idx=1&amp;sn=e2b082386a067cf8b428b4938a21b7e5&amp;scene=21#wechat_redirect" data-linktype="2">单细胞亚群的生物学命名的4个规则</a>。<img data-imgfileid="100037738" data-ratio="0.48333333333333334" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1tn8Dkp4SIYYVIb77hQYZgOVhOPhd83It1hfCTkGR63uXYban7JCzJg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1tn8Dkp4SIYYVIb77hQYZgOVhOPhd83It1hfCTkGR63uXYban7JCzJg/640?wx_fmt=png&amp;from=appmsg"></section></li><li><section>复现文献时，由于参数不同，结果会有一定的出入，但是在这里原则是一样的，即根据差异基因对cluster进行命名：</section></li></ul><figure data-tool="mdnice编辑器"><img data-imgfileid="100037743" data-ratio="0.20803443328550933" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1cS9AT9N96IicOGqrElqd7PEhhibv9tDfv7ib1g3xaWx46jIOh7yibx41wg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="697" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTsELcbiaZxoJictgXkmELfd1cS9AT9N96IicOGqrElqd7PEhhibv9tDfv7ib1g3xaWx46jIOh7yibx41wg/640?wx_fmt=png&amp;from=appmsg"><figcaption>文章图1a的说明</figcaption></figure></section><p><br></p><p><br></p><section data-style-type="5" data-tools="新媒体排版" data-id="2440476"><section><section><section><section><img data-ratio="0.9495798319327731" data-src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif" data-type="gif" data-w="119" data-width="100%" data-imgfileid="100037725" src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif"></section><section data-brushtype="text">往期回顾</section><section><br></section></section></section></section><section><section data-autoskip="1"><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247521350&amp;idx=1&amp;sn=f73e8712c95ca72ad6cc3b0a23b21d44&amp;chksm=ea1c92c4dd6b1bd29f082f1417afa56b996875b0710f56b16873e74981949d3f0e75a090aba0&amp;scene=21#wechat_redirect" textvalue="单细胞测序最好的教程（十六）：关于RNA速率你想知道的都在这" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>单细胞测序最好的教程（十六）：关于RNA速率你想知道的都在这</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247521349&amp;idx=1&amp;sn=94fb2b421b39c069c190b621c9c88ee0&amp;chksm=ea1c92c7dd6b1bd11cd4ba8bb3708a7539b5be013d2111c1ebe5860cf55b84b4745878ffc8f6&amp;scene=21#wechat_redirect" textvalue="scanpy的UMAP可视化高级版" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>scanpy的UMAP可视化高级版</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247521191&amp;idx=1&amp;sn=9663b0c57e8c6b73870e35d8cd100914&amp;chksm=ea1c9525dd6b1c338b933c8bb516c6334e3538856b0e31ebeab95818361025ef9f4192be7885&amp;scene=21#wechat_redirect" textvalue="瘫痪后恢复行走能力的神经元研究" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>瘫痪后恢复行走能力的神经元研究</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247521169&amp;idx=1&amp;sn=035d51bedb9b5687d7303356f8a3f127&amp;chksm=ea1c9513dd6b1c0532ea20e8d576b3a8cab6147ed4275f153597d03c33c6728330e84aae43bf&amp;scene=21#wechat_redirect" textvalue="别再浪费lncRNA信息，深度挖掘的数据工具来了！" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2"><span>别再浪费lncRNA信息，深度挖掘的数据工具来了！</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247521167&amp;idx=1&amp;sn=f866efc28984781d70979d9f2ee0c33e&amp;chksm=ea1c950ddd6b1c1bcfba7d2c823354256d2fc3e65002a8279da21705750b331d5a8f4645f96e&amp;scene=21#wechat_redirect" textvalue="单细胞测序最好的教程（十五）：最具代表性的拟时序计算模型合集" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>单细胞测序最好的教程（十五）：最具代表性的拟时序计算模型合集</span></a><br></p></section></section><hr><p><br></p></section><section data-style-type="5" data-tools="新媒体排版" data-id="2440475"><hr><p><br></p><hr><section><p>如果你对单细胞转录组研究感兴趣，但又不知道如何入门，也许你可以关注一下下面的课程<span></span></p><p><br></p><ul><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247529099&amp;idx=1&amp;sn=fe3be2d43a6284a36c15625c23dc9a3e&amp;chksm=9b4b3230ac3cbb26b875bd0a294f24dfbd41a2b59996fbfe79087330d267c4ec70882683c3bd&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课4月班" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信入门&amp;数据挖掘线上直播课4月班</a><br></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247520120&amp;idx=1&amp;sn=ad91a187458eb591129d3d366bfccf71&amp;chksm=ea1c89fadd6b00ec227d9588dadf672e1eb88d0449d500602d61f155023ee5721facdc9a5b57&amp;scene=21#wechat_redirect" textvalue="2024的共享服务器交个朋友福利价仍然是800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1">2024的共享服务器交个朋友福利价仍然是800</a></p></li></ul><p><img data-imgfileid="100037723" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif" data-type="gif" data-w="240" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif"><br></p><p><img data-imgfileid="100037722" data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg" data-type="other" data-w="341" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p></section><section><section><section data-tools="135编辑器" data-id="93668"><section><section data-width="95%"><section><section><section data-width="61.8%"><section><section><section><p><br></p><span><strong data-burshtype="text"><img data-copyright="0" data-cropselx1="0" data-cropselx2="109" data-cropsely1="0" data-cropsely2="109" data-imgfileid="100037726" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg" data-type="other" data-w="258" title="qrcode_for_gh_5a3c482ed99f_1280.jpg" src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg"><strong data-burshtype="text">生物</strong><strong data-burshtype="text"> | 单细胞 | 转录组丨资料</strong></strong></span></section><section><span><strong data-burshtype="text">每天都精彩</strong></span></section></section></section><section><section><section><section><p><span>长按扫码可关注</span></p></section></section></section></section></section></section></section></section></section></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/zvwHLHHQrvwxdSgP8xxcmg",target="_blank" rel="noopener noreferrer">原文链接</a>
