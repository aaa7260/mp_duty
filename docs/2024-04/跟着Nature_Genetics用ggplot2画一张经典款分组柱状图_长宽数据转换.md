---
title: "跟着Nature Genetics用ggplot2画一张经典款分组柱状图，长宽数据转换"
date: 2024-04-05T23:00:26Z
draft: ["false"]
tags: [
  "fetched",
  "生信七点半"
]
categories: ["Acdemic"]
---
跟着Nature Genetics用ggplot2画一张经典款分组柱状图，长宽数据转换 by 生信七点半
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>Reference</span><span> </span></h2><p data-tool="mdnice编辑器">A quantitative genomics map of rice providesgenetic insights and guides breeding</p><p data-tool="mdnice编辑器">https://doi.org/10.1038/s41588-020-00769-9</p><figure data-tool="mdnice编辑器"><img data-ratio="0.3851851851851852" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s8Xia9UfbHZ4bVVqtKKgkFPzroZzprHQeHMCd8icqkogtickEkg7DaibFEaERnSOwGibkntib3lmZmxticeA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s8Xia9UfbHZ4bVVqtKKgkFPzroZzprHQeHMCd8icqkogtickEkg7DaibFEaERnSOwGibkntib3lmZmxticeA/640?wx_fmt=png"></figure><h2 data-tool="mdnice编辑器"><span></span><span>宽长数据转换</span><span> </span></h2><p data-tool="mdnice编辑器">宽长数据转换，经常用到这里稍作简介。</p><p data-tool="mdnice编辑器">在R语言中，可以使用<code>tidyr</code>包中的<code>gather()</code>函数将宽数据转换为长数据。以下是一个示例：</p><p data-tool="mdnice编辑器">假设有以下的宽数据：</p><pre data-tool="mdnice编辑器"><span></span><code>data_wide &lt;- data.frame(<br>  ID = c(<span>1</span>, <span>2</span>, <span>3</span>),<br>  Age_0 = c(<span>25</span>, <span>30</span>, <span>28</span>),<br>  Age_1 = c(<span>26</span>, <span>31</span>, <span>29</span>),<br>  Age_2 = c(<span>27</span>, <span>32</span>, <span>30</span>)<br>)<br></code></pre><p data-tool="mdnice编辑器">可以使用<code>gather()</code>函数将它转换为长数据：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyr)<br><br>data_long &lt;- gather(data_wide, key = <span>"Age_Category"</span>, value = <span>"Age"</span>, -ID)<br></code></pre><p data-tool="mdnice编辑器">在这个示例中，<code>key</code>参数指定了新的列名，用于存储原始列的名称，而<code>value</code>参数指定了新的列名，用于存储原始列的值。<code>-ID</code>表示不包括ID列在内进行转换。</p><p data-tool="mdnice编辑器">现在，<code>data_long</code>包含了转换后的长数据。结果如下：</p><pre data-tool="mdnice编辑器"><span></span><code>  ID Age_Category Age<br>1  1        Age_0  25<br>2  2        Age_0  30<br>3  3        Age_0  28<br>4  1        Age_1  26<br>5  2        Age_1  31<br>6  3        Age_1  29<br>7  1        Age_2  27<br>8  2        Age_2  32<br>9  3        Age_2  30<br></code></pre><p data-tool="mdnice编辑器">这样，宽数据就被转换成了长数据。可以根据实际情况修改列名和数据框的名称。</p><p data-tool="mdnice编辑器">使用<code>tidyr</code>包中的<code>spread()</code>函数将长数据转换为宽数据。以下是一个示例：</p><p data-tool="mdnice编辑器">假设你有以下的长数据：</p><pre data-tool="mdnice编辑器"><span></span><code>data_long &lt;- data.frame(<br>  ID = c(<span>1</span>, <span>1</span>, <span>2</span>, <span>2</span>),<br>  Variable = c(<span>"A"</span>, <span>"B"</span>, <span>"A"</span>, <span>"B"</span>),<br>  Value = c(<span>10</span>, <span>20</span>, <span>30</span>, <span>40</span>)<br>)<br></code></pre><p data-tool="mdnice编辑器">可以使用<code>spread()</code>函数将它转换为宽数据：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyr)<br><br>data_wide &lt;- spread(data_long, key = Variable, value = Value)<br></code></pre><p data-tool="mdnice编辑器">在这个示例中，<code>key</code>参数指定了原始数据中的列名，用于创建新的列，而<code>value</code>参数指定了原始数据中的值列，用于填充新的列。<code>spread()</code>函数会自动创建新的列，并将相应的值填充到这些列中。</p><p data-tool="mdnice编辑器">现在，<code>data_wide</code>包含了转换后的宽数据。结果如下：</p><pre data-tool="mdnice编辑器"><span></span><code>  ID  A  B<br>1  1 10 20<br>2  2 30 40<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>数据格式</span><span> </span></h2><figure data-tool="mdnice编辑器"><img data-ratio="1.6493212669683257" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s8Xia9UfbHZ4bVVqtKKgkFPztLzFeaZBLBe08fyXVR7CYTP33P8d5SsPFQUTKGEkZSdUiaXhMlq4kYw/640?wx_fmt=png" data-type="png" data-w="442" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s8Xia9UfbHZ4bVVqtKKgkFPztLzFeaZBLBe08fyXVR7CYTP33P8d5SsPFQUTKGEkZSdUiaXhMlq4kYw/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code><span># 数据因子化 调整顺序 </span><br>tbl$class&lt;-factor(tbl$class,<br>                  levels = c(<span>'Lily'</span>  ,  <span>'Luck'</span>  ,  <span>'Blessing'</span>   , <span>'Charm'</span>  , <span>'Happiness'</span> ,  <span>'Magic'</span>))<br><br>tbl$group&lt;-factor(tbl$group,<br>                  levels = c(<span>"Northeast"</span>,<br>                             <span>"East"</span>,<br>                             <span>"Southeast"</span>))<br><br></code></pre><p data-tool="mdnice编辑器">这段代码是对数据框（或表格）中的两列进行因子化操作，并调整它们的顺序。</p><ol data-tool="mdnice编辑器"><li><section><p>对<code>tbl</code>数据框中的<code>class</code>列进行因子化操作：</p></section></li></ol><ul><li><section>使用<code>factor()</code>函数将<code>class</code>列转换为因子型变量。</section></li><li><section><code>levels</code>参数指定了因子水平的顺序，即类别的顺序。</section></li><li><section>类别的顺序被设置为<code>'Lily'</code>、<code>'Luck'</code>、<code>'Blessing'</code>、<code>'Charm'</code>、<code>'Happiness'</code>和<code>'Magic'</code>。</section></li></ul><li><section><p>对<code>tbl</code>数据框中的<code>group</code>列进行因子化操作：</p></section></li><ul><li><section>使用<code>factor()</code>函数将<code>group</code>列转换为因子型变量。</section></li><li><section><code>levels</code>参数指定了因子水平的顺序，即分组的顺序。</section></li><li><section>分组的顺序被设置为<code>"Northeast"</code>、<code>"East"</code>和<code>"Southeast"</code>。</section></li></ul><p data-tool="mdnice编辑器">通过这些操作，<code>class</code>列和<code>group</code>列都被转换为了因子型变量，并且它们的水平顺序被设置为指定的顺序。这可以用于控制在绘制图表或进行分析时类别或分组的顺序。</p><h2 data-tool="mdnice编辑器"><span></span><span>柱状图</span><span> </span></h2><h4 data-tool="mdnice编辑器"><span></span>毛坯<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>ggplot(data=tbl,aes(x=class,y=DEGNumber))+<br>  geom_col(aes(fill=group),<br>           position = position_dodge(<span>0.3</span>),<br>           width = <span>0.3</span>,<br>           show.legend = <span>T</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6101851851851852" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s8Xia9UfbHZ4bVVqtKKgkFPzkPkzFNNibUAC5jHhmx85FsIOHHFaYt5Xt7WUUgVOL2NbbLhic2fPeyoQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s8Xia9UfbHZ4bVVqtKKgkFPzkPkzFNNibUAC5jHhmx85FsIOHHFaYt5Xt7WUUgVOL2NbbLhic2fPeyoQ/640?wx_fmt=png"></figure><h4 data-tool="mdnice编辑器"><span></span>简装<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>ggplot(data=tbl,aes(x=class,y=DEGNumber))+<br>  geom_col(aes(fill=group),<br>           position = position_dodge(<span>0.3</span>),<br>           width = <span>0.3</span>,<br>           show.legend = <span>T</span>)+<br>  labs(x=<span>""</span>,<br>       y=<span>"DEGNumber"</span>)+<br>  scale_fill_manual(values = c(<span>"#00C5FF"</span>,<br>                               <span>"#E6E600"</span>,<br>                               <span>"#73B273"</span>))+<br>  coord_cartesian(ylim=c(-<span>0.05</span>,<span>13000</span>))+<br>  scale_y_continuous(expand = c(<span>0</span>, <span>0</span>))+<br>  theme_classic()+<br>  theme(legend.direction = <span>"horizontal"</span>,<br>        legend.position = c(<span>0.75</span>, <span>0.9</span>),<br>        legend.title = element_text(colour = <span>"white"</span>)<br>        <br>  )<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5777777777777777" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s8Xia9UfbHZ4bVVqtKKgkFPzywUxnNePXQESVFMVibNeBWyoWD30zLSI37vDTUpmHOOjn1Z0tZhIA5Q/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s8Xia9UfbHZ4bVVqtKKgkFPzywUxnNePXQESVFMVibNeBWyoWD30zLSI37vDTUpmHOOjn1Z0tZhIA5Q/640?wx_fmt=png"></figure><h4 data-tool="mdnice编辑器"><span></span>精装<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>ggplot(data=tbl,aes(x=class,y=DEGNumber))+<br>  geom_col(aes(fill=group),<br>           position = position_dodge(<span>0.3</span>),<br>           width = <span>0.3</span>,<br>           show.legend = <span>T</span>)+<br>  labs(x=<span>""</span>,<br>       y=<span>"DEGNumber"</span>)+<br>  scale_fill_manual(values = c(<span>"#00C5FF"</span>,<br>                               <span>"#E6E600"</span>,<br>                               <span>"#73B273"</span>))+<br>  coord_cartesian(ylim=c(-<span>0.05</span>,<span>13000</span>))+<br>  scale_y_continuous(expand = c(<span>0</span>, <span>0</span>))+<br>  theme_classic()+<br>  theme(legend.direction = <span>"horizontal"</span>,<br>        legend.position = c(<span>0.7</span>, <span>0.9</span>),<br>        legend.title = element_text(size=<span>0</span>),<br>        text = element_text(family = <span>'serif'</span>)<br>  )<br></code></pre><p data-tool="mdnice编辑器">新罗马一用就感觉贼高级</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5962962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s8Xia9UfbHZ4bVVqtKKgkFPz9CiaJOZqYScNSAxYibvzowFPPmibOEMyticPzd3XCs0YcVMVTWoC6rBpxw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s8Xia9UfbHZ4bVVqtKKgkFPz9CiaJOZqYScNSAxYibvzowFPPmibOEMyticPzd3XCs0YcVMVTWoC6rBpxw/640?wx_fmt=png"></figure><h2 data-tool="mdnice编辑器"><span></span><span>注释</span><span> </span></h2><ol data-tool="mdnice编辑器"><li><section><p><code>ggplot(data=tbl,aes(x=class,y=DEGNumber))</code>：这是创建ggplot2图形对象的开始。<code>data</code>参数指定数据框为<code>tbl</code>，<code>aes()</code>函数定义了图形的映射关系，<code>x=class</code>表示将<code>class</code>列用作x轴，<code>y=DEGNumber</code>表示将<code>DEGNumber</code>列用作y轴。</p></section></li><li><section><p><code>geom_col(aes(fill=group), position = position_dodge(0.3), width = 0.3, show.legend = T)</code>：这是添加柱状图层。<code>geom_col()</code>函数用于创建柱状图，<code>aes(fill=group)</code>表示根据<code>group</code>列的不同取值进行填充颜色，<code>position = position_dodge(0.3)</code>表示将柱子进行分组，<code>width = 0.3</code>表示柱子的宽度，<code>show.legend = T</code>表示显示图例。</p></section></li><li><section><p><code>labs(x="", y="DEGNumber")</code>：这里设置了x轴和y轴的标签，将x轴标签设置为空字符串，y轴标签设置为"DEGNumber"。</p></section></li><li><section><p><code>scale_fill_manual(values = c("#00C5FF", "#E6E600", "#73B273"))</code>：使用<code>scale_fill_manual()</code>函数手动设置填充颜色的映射关系，指定了三种颜色：蓝色(<code>#00C5FF</code>)、黄色(<code>#E6E600</code>)和绿色(<code>#73B273</code>)，分别对应不同的<code>group</code>值。</p></section></li><li><section><p><code>coord_cartesian(ylim=c(-0.05,13000))</code>：使用<code>coord_cartesian()</code>函数设置y轴的坐标范围，限定y轴的范围在-0.05到13000之间。</p></section></li><li><section><p><code>scale_y_continuous(expand = c(0, 0))</code>：使用<code>scale_y_continuous()</code>函数设置y轴的连续刻度，<code>expand = c(0, 0)</code>表示不要扩展刻度。</p></section></li><li><section><p><code>theme_classic()</code>：使用<code>theme_classic()</code>函数设置图表的基本主题风格。</p></section></li><li><section><p><code>theme(legend.direction = "horizontal", legend.position = c(0.75, 0.9), legend.title = element_text(colour = "white"), text = element_text(family = 'serif'))</code>：设置图表的主题选项。其中：</p></section></li></ol><ul><li><section><code>legend.direction = "horizontal"</code>设置图例的方向为水平。</section></li><li><section><code>legend.position = c(0.75, 0.9)</code>设置图例的位置在图表的右上角。</section></li><li><section><code>legend.title = element_text(colour = "white")</code>设置图例标题的颜色为白色。</section></li><li><section><code>text = element_text(family = 'serif')</code>设置图表中的文本字体为serif字体。</section></li></ul><p data-tool="mdnice编辑器">目的是创建一个带有分组柱状图的ggplot2图形，其中包含了各种视觉和主题设置，以定制和美化图表。可以根据需要进一步调整这些设置以满足特定的图表需求。</p><blockquote data-tool="mdnice编辑器"><p>下期实现分面绘图，搞成文献那样的组合图，legend还要单独放一块。</p></blockquote></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><section><strong><span></span></strong></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/DKeXXAweil_dd3kwG8zIBw",target="_blank" rel="noopener noreferrer">原文链接</a>
