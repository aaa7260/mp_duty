---
title: "细胞聚类方法比较(t-SNE&UMAP)"
date: 2024-04-06T11:50:54Z
draft: ["false"]
tags: [
  "fetched",
  "生信漫漫学"
]
categories: ["Acdemic"]
---
细胞聚类方法比较(t-SNE&UMAP) by 生信漫漫学
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span></span><span>写在开头</span><span></span></h3><p data-tool="mdnice编辑器">每天学点单细胞小知识，今天是<strong>不同细胞聚类方法的比较，主要就是UMAP和t-SNE的比较</strong></p><p data-tool="mdnice编辑器">上次整理的是<a href="https://mp.weixin.qq.com/s?__biz=MzkxOTI0Mjc3Mw==&amp;mid=2247486886&amp;idx=1&amp;sn=b7c0850890b727ed2e7fc2a5060ea455&amp;scene=21#wechat_redirect" data-linktype="2">单细胞样品批次效应去除</a></p><p data-tool="mdnice编辑器">去年就说要好好学习单细胞，但今年仍然在努力学习单细胞，hhh因为每学一点就会发现有更多基础知识可以补充，所以也会把自己学习所得都整理起来分享给大家。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100003256" data-ratio="0.6134453781512605" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhU9Qe4Fm8PBZIOKTDMJMlhtE7lqsVNeCLWiaGA3vJiabI0tu3WIpibv1INA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="476" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhU9Qe4Fm8PBZIOKTDMJMlhtE7lqsVNeCLWiaGA3vJiabI0tu3WIpibv1INA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">如果有些地方整理的不是很完善的话，欢迎大家补充交流。<strong>就是我的留言功能为什么还不能开呀，微信官方啥时候管管我这小透明！</strong></p><blockquote data-tool="mdnice编辑器"><span></span><p>内容来源联川生物《单细胞测序研究一本通 3.0》</p></blockquote><h3 data-tool="mdnice编辑器"><span></span><span></span><span>细胞聚类方法简介</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span></span><p>单细胞转录组测序产生的数据是成百上千个基因在上万个细胞中的表达情况，属于高维数据，所以需要对数据进行严格的质控与过滤，将合格的数据降维到低维子空间，对数据进行可视化。</p></blockquote><p data-tool="mdnice编辑器">所以默认的分析流程就是<strong>使用分析软件将表达矩阵标准化，然后对数据进行过滤之后通过降维，再使用t-SNE（t-distributed Stochastic Neighbor Embedding）或者UMAP（Uniform Manifold Approximation and Project）进行可视化。</strong></p><p><img data-galleryid="" data-imgfileid="100003271" data-ratio="0.7508650519031141" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhU9YyDXyJbV8KWu3PP6DibgLZo2oFP9AKGHY632INs81stQ6wjbm5oRfg/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="4624" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhU9YyDXyJbV8KWu3PP6DibgLZo2oFP9AKGHY632INs81stQ6wjbm5oRfg/640?wx_fmt=jpeg&amp;from=appmsg"></p><p data-tool="mdnice编辑器"><code>t-SEN和UMAP作用</code>：可以直接将高维空间的结构特征投影到低维空间（二维或三维）中，也就是用平面或立体空间内的点的疏密远近表现其在原本多维度状态下的疏密远近。</p><p data-tool="mdnice编辑器"><strong>降维过程：</strong></p><ul data-tool="mdnice编辑器"><li><section><p>计算各点之间的高维距离，拟合分布函数</p></section></li><li><section><p>初始化点的低维空间</p></section></li><li><section><p>计算各点的低维距离</p></section></li><li><section><p>计算降维的信息损失，优化低维分布，保留高维特征，直到预设条件</p></section></li></ul><p data-tool="mdnice编辑器"><strong>UMAP和t-SNE算法上差异：</strong></p><ul data-tool="mdnice编辑器"><li><section><p>计算高维距离时，t-SNE会计算所有点之间的距离，通过Perplexity（困惑度）参数调整全局结构与局部结构间的软边界；而UMAP择只计算个点与最近k个点之间的距离，严格限制局部的范围；</p></section></li><li><section><p>两种算法在对信息损失的计算方法也有不同，t-SNE使用KL散度衡量信息损失，在全部结构上存在失真的可能；而UMAP使用二交叉熵，全局和局部结构均有保留。</p></section></li></ul><figure data-tool="mdnice编辑器"><img data-imgfileid="100003259" data-ratio="0.5895348837209302" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUCChO81WXhaE8Iwa2T7ro9cXDlI5XwP8kFzibUfecWtoTg1QSujw0ZoA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="860" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUCChO81WXhaE8Iwa2T7ro9cXDlI5XwP8kFzibUfecWtoTg1QSujw0ZoA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>降维效果差异</span></h3><p><img data-galleryid="" data-imgfileid="100003272" data-ratio="0.7508650519031141" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUlrvCVnKgknKteILGRv3w2BHvfibW4J59k9s1ovVYEzoYaVfj9b0W2fQ/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="4624" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUlrvCVnKgknKteILGRv3w2BHvfibW4J59k9s1ovVYEzoYaVfj9b0W2fQ/640?wx_fmt=jpeg&amp;from=appmsg"></p><h3 data-tool="mdnice编辑器"><span></span></h3><h4 data-tool="mdnice编辑器"><span></span><span>1. 全局结构</span><span></span></h4><p data-tool="mdnice编辑器">在使用t-SNE降维单细胞数据时，会有<strong>同一类细胞被其他细胞分隔</strong>——这是因为其损失函数（KL散度）对低维近、高维远的惩罚较轻，所以在平面上整体差异较小的集群可能比较大的集群离的较远。<strong>t-SNE图多数情况下能不能体现真实的全局结构</strong>。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100003257" data-ratio="0.5939675174013921" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUNd5q2jZIh7JIibXLHFmejsmiczFybdwYFcmOXTO5Yth36C73Bdj3jyUw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="862" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUNd5q2jZIh7JIibXLHFmejsmiczFybdwYFcmOXTO5Yth36C73Bdj3jyUw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">UMAP顺势函数使用的是<strong>二元交叉熵</strong>，对低维近高维远或低维远高维近的惩罚都较重，所以<strong>UMAP比t-SNE更能体现真实的全局结构</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100003255" data-ratio="0.6060254924681344" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUibnEXF9S9QZYjXHKboO1FV9Btq5tG4PhCWdtoRNulEHelo5I6oic66DA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="863" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUibnEXF9S9QZYjXHKboO1FV9Btq5tG4PhCWdtoRNulEHelo5I6oic66DA/640?wx_fmt=png&amp;from=appmsg"></figure><h4 data-tool="mdnice编辑器"><span></span><span>2. 局部结构</span><span></span></h4><p data-tool="mdnice编辑器"><strong>t-SNE的局部结构更加紧密</strong></p><p data-tool="mdnice编辑器"><code>t-SNE</code>在拟合高维数据时使用高斯分布转换成概率，低维数据则使用t分布转换概率，这会是高维距离近的点在低维空间中更近，反之更远</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100003258" data-ratio="0.964095744680851" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUaPeReBmf8cAW8dCWYZZVCbfGR2iaghXt3H9hxaOuRcAMbCmm3oWDedw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="752" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUaPeReBmf8cAW8dCWYZZVCbfGR2iaghXt3H9hxaOuRcAMbCmm3oWDedw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><code>UMAP</code>设置了min_dist，在计算信息损失时，对低维距离小于min_dist的点视为同价，故而<strong>会隐藏一部分局部结构信息。</strong></p><h4 data-tool="mdnice编辑器"><span></span><span>3. 分析耗时</span><span></span></h4><p data-tool="mdnice编辑器"><strong>t-SNE的时间复杂度为O（n2），UMAP的时间复杂度为O（n1.14）</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100003264" data-ratio="1.5087378640776699" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUMyE4YIHZv8WxEWkm1ibSPb38nWFrqzxJa9GFKcHiaoFqnvEpYWyMoeiaA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="515" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUMyE4YIHZv8WxEWkm1ibSPb38nWFrqzxJa9GFKcHiaoFqnvEpYWyMoeiaA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">所以对数十万个流式细胞仪数据和单细胞数据进行降维时，<strong>UMAP较t-SNE会有数倍甚至数十倍的速度提升</strong>。</p><h4 data-tool="mdnice编辑器"><span></span><span>4. 结果稳定性</span><span></span></h4><p data-tool="mdnice编辑器">t-SNE使用随机分布初始化低维数据，而UMAP使用图拉普拉斯变换分配初始的低维坐标（根据高维数据特征进行低维数据的初始化），<strong>所以UMAP的结果具有更高的稳定性</strong>。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100003263" data-ratio="0.8387755102040816" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUd06yAJLern2BWrSoFjgiaGsxw5n2DaS9yXibWSwTPlYbRl8ic9iaHwHWQg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="490" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUd06yAJLern2BWrSoFjgiaGsxw5n2DaS9yXibWSwTPlYbRl8ic9iaHwHWQg/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>重要参数</span><span></span></h3><p data-tool="mdnice编辑器">PS:参数自行了解一下哦</p><pre data-tool="mdnice编辑器"><span></span><code><span>#UMAP</span><br><br>pbmc &lt;- RunUMAP(pbmc, dims = 1:10, umap.method = <span>"uwot"</span>, metric = <span>"cosine"</span>)<br>DimPlot(pbmc,label = T)<br><br><span>#t-SNE</span><br><br>pbmc &lt;- RunTSNE(pbmc )<br>DimPlot(pbmc,label = T,reduction = <span>'tsne'</span>,pt.size =3)<br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100003262" data-ratio="0.6439232409381663" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhU7kvhRgKhBkedxrKUPqagOiblPfLbWIibIYVWblFJpobZFE2p83J7Ibkw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="469" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhU7kvhRgKhBkedxrKUPqagOiblPfLbWIibIYVWblFJpobZFE2p83J7Ibkw/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>写在最后</span><span></span></h3><p data-tool="mdnice编辑器">一般可视化会选择UMAP，因为其<strong>分析耗时较短，结果也较为稳定并且更能体现真实的全局结构</strong></p><p><img data-galleryid="" data-imgfileid="100003273" data-ratio="0.6785403996524761" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUUCqSE8icw0DlhvnNicw2e9tb8YWIjZRibcoyufe8ibwnzmd9Mx7Uowm8lg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1151" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUUCqSE8icw0DlhvnNicw2e9tb8YWIjZRibcoyufe8ibwnzmd9Mx7Uowm8lg/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">下一章整理一下<strong>细胞鉴定方法</strong>叭，如果可以的话想尝试一下<strong>singleR自动注释</strong>，如果学会的话就直播分享给大家hhh！</p><p><img data-galleryid="" data-imgfileid="100003269" data-ratio="0.7508650519031141" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUk05gd2s7bDcsicolCMjbaO5oczHr9a32pFoC451kS118NOr8BzoYK0g/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="4624" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/icQem1PXnP9YCeqNKBbl2Fic95LcL5pBhUk05gd2s7bDcsicolCMjbaO5oczHr9a32pFoC451kS118NOr8BzoYK0g/640?wx_fmt=jpeg&amp;from=appmsg"></p><p data-tool="mdnice编辑器">之前也整理过<a href="https://mp.weixin.qq.com/s?__biz=MzkxOTI0Mjc3Mw==&amp;mid=2247486759&amp;idx=1&amp;sn=fa0dbca7a9e3a7e9e00e6909395465ee&amp;scene=21#wechat_redirect" data-linktype="2">细胞亚群在线注释网站使用</a>，大家有需要可以了解一下。</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/14JdJ4EU79zR_6zNwOMDJg",target="_blank" rel="noopener noreferrer">原文链接</a>
