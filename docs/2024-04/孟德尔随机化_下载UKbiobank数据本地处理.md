---
title: "孟德尔随机化：下载UKbiobank数据本地处理"
date: 2024-04-22T01:53:41Z
draft: ["false"]
tags: [
  "fetched",
  "医学和生信笔记"
]
categories: ["Acdemic"]
---
孟德尔随机化：下载UKbiobank数据本地处理 by 医学和生信笔记
------
<div><p><img data-galleryid="" data-imgfileid="100018013" data-ratio="0.16666666666666666" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R9fO0vCqNNWMpw3VRMCZnvHTZzG2JUNYHDwaRCDvCcJZEJFRH3KVxBylYk1YcpWMJe8rBmrmeYwjg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R9fO0vCqNNWMpw3VRMCZnvHTZzG2JUNYHDwaRCDvCcJZEJFRH3KVxBylYk1YcpWMJe8rBmrmeYwjg/640?wx_fmt=png&amp;from=appmsg"></p><hr><table><tbody><tr><td width="172" valign="top"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzOTQzNzU0NA==&amp;action=getalbum&amp;album_id=2231476971388059661&amp;uin=&amp;key=&amp;devicetype=Windows+11+x64&amp;version=63090819&amp;lang=zh_CN&amp;ascene=0&amp;session_us=gh_28ea67f3b544" textvalue="你已选中了添加链接的内容" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="1"><span><img data-cropselx1="0" data-cropselx2="151" data-cropsely1="0" data-cropsely2="127" data-galleryid="" data-imgfileid="100018017" data-ratio="0.8435185185185186" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZJVPcbVTf4Xmmz0ibmMDSDicNE8fAMebg1h5uSZJJ7nhmRNiaibJnoG6lOg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZJVPcbVTf4Xmmz0ibmMDSDicNE8fAMebg1h5uSZJJ7nhmRNiaibJnoG6lOg/640?wx_fmt=png&amp;from=appmsg"></span></a></p></td><td width="172" valign="top"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzOTQzNzU0NA==&amp;action=getalbum&amp;album_id=2267367379124928515&amp;uin=&amp;key=&amp;devicetype=Windows+11+x64&amp;version=63090819&amp;lang=zh_CN&amp;ascene=0&amp;session_us=gh_28ea67f3b544" textvalue="你已选中了添加链接的内容" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="1"><span><img data-cropselx1="0" data-cropselx2="151" data-cropsely1="0" data-cropsely2="127" data-galleryid="" data-imgfileid="100018014" data-ratio="0.8435185185185186" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZ3noGibiag7bKyuAvs4POaZWW4JTQMeUibXHqF9Jv0MEoNJLpgvY2jxaTQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZ3noGibiag7bKyuAvs4POaZWW4JTQMeUibXHqF9Jv0MEoNJLpgvY2jxaTQ/640?wx_fmt=png&amp;from=appmsg"></span></a></p></td><td width="172" valign="top"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzOTQzNzU0NA==&amp;action=getalbum&amp;album_id=2255945345983627264&amp;scene=173&amp;subscene=&amp;sessionid=svr_781993951eb&amp;enterid=1709989110&amp;from_msgid=2247500872&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="你已选中了添加链接的内容" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="1"><span><img data-cropselx1="0" data-cropselx2="151" data-cropsely1="0" data-cropsely2="127" data-galleryid="" data-imgfileid="100018015" data-ratio="0.8435185185185186" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZtVWVkXRwiaATrnk7BzxzOOOibjbZSM1AVxkMNXHRHWFybibmVTYpUb4bA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZtVWVkXRwiaATrnk7BzxzOOOibjbZSM1AVxkMNXHRHWFybibmVTYpUb4bA/640?wx_fmt=png&amp;from=appmsg"></span></a></p></td></tr><tr><td width="172" valign="top"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzOTQzNzU0NA==&amp;action=getalbum&amp;album_id=2393825487539191816&amp;scene=173&amp;subscene=&amp;sessionid=svr_20c53631f79&amp;enterid=1709989057&amp;from_msgid=2247501166&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="你已选中了添加链接的内容" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="1"><span><img data-cropselx1="0" data-cropselx2="151" data-cropsely1="0" data-cropsely2="127" data-galleryid="" data-imgfileid="100018016" data-ratio="0.8435185185185186" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZqB1xXibTCqxzWDnSCZrJSicPH8II0G8JxLBmqTEoRWcpiaEEaEoXKibKaQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZqB1xXibTCqxzWDnSCZrJSicPH8II0G8JxLBmqTEoRWcpiaEEaEoXKibKaQ/640?wx_fmt=png&amp;from=appmsg"></span></a></p></td><td width="172" valign="top"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzOTQzNzU0NA==&amp;action=getalbum&amp;album_id=3302133732023369734&amp;scene=173&amp;subscene=&amp;sessionid=svr_aba6bcd7c9d&amp;enterid=1709989036&amp;from_msgid=2247501168&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="你已选中了添加链接的内容" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="1"><span><img data-cropselx1="0" data-cropselx2="151" data-cropsely1="0" data-cropsely2="127" data-galleryid="" data-imgfileid="100018019" data-ratio="0.8435185185185186" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZEDyJ5HeuhZiaaZxAYE2vibrTo3k9PZIicu9ADibzqWtfsVJ7qsyEn8OYPA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZEDyJ5HeuhZiaaZxAYE2vibrTo3k9PZIicu9ADibzqWtfsVJ7qsyEn8OYPA/640?wx_fmt=png&amp;from=appmsg"></span></a></p></td><td width="172" valign="top"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzOTQzNzU0NA==&amp;action=getalbum&amp;album_id=3330048674143567873&amp;scene=173&amp;subscene=&amp;sessionid=undefined&amp;enterid=0&amp;from_msgid=2247501093&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="你已选中了添加链接的内容" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="1"><span><img data-cropselx1="0" data-cropselx2="151" data-cropsely1="0" data-cropsely2="127" data-galleryid="" data-imgfileid="100018020" data-ratio="0.8435185185185186" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZdBBtwWIehx7CD2kBOPBbfIIOuVPZBWCAgZa6pica4yI2DC91G1zoiaJg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZdBBtwWIehx7CD2kBOPBbfIIOuVPZBWCAgZa6pica4yI2DC91G1zoiaJg/640?wx_fmt=png&amp;from=appmsg"></span></a></p></td></tr></tbody></table><p><img data-galleryid="" data-imgfileid="100018018" data-ratio="0.3333333333333333" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZlYnHSZZLNukeic7DKOOuoenP0uPxYP0L4Ngfl5CLhoLUxogGayzREWQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZlYnHSZZLNukeic7DKOOuoenP0uPxYP0L4Ngfl5CLhoLUxogGayzREWQ/640?wx_fmt=png&amp;from=appmsg"></p><hr><p><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">今天学习下如何下载UKBiobank的数据并进行整理，把它变成<code>TwoSampleMR</code>能够使用的格式。</p><h2 data-tool="mdnice编辑器"><span></span><span>数据下载</span><span></span></h2><p data-tool="mdnice编辑器">打开ukbiobank的官网：https://www.nealelab.is/uk-biobank</p><p data-tool="mdnice编辑器">打开后往下拉，找到<code>results can be found here</code>，点击它：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100018021" data-ratio="0.7472222222222222" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYha36ep3pA6q3OeBC86Tk6oj9znibqREj0maSC9icZTsqoa89rP7agHAw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYha36ep3pA6q3OeBC86Tk6oj9znibqREj0maSC9icZTsqoa89rP7agHAw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">点击之后即可来到数据界面，首先是<code>README</code>这个sheet，这里会有一些介绍，每个文件包含哪些内容，每个文件的列名是什么意思等，都有详细的说明，大家一定要看！</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100018022" data-ratio="0.7953703703703704" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LY2936mvuiaOClL81I21jzbjoz6Bsq0sZrpIv4ojdGfqjciat2zOx8CWeQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LY2936mvuiaOClL81I21jzbjoz6Bsq0sZrpIv4ojdGfqjciat2zOx8CWeQ/640?wx_fmt=png&amp;from=appmsg"></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100018023" data-ratio="0.9203703703703704" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYb2DzrnllEqSicz4krB8tYdnOwVb5O8HXwRe2c8p1VBibq95qQ60gQrDQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYb2DzrnllEqSicz4krB8tYdnOwVb5O8HXwRe2c8p1VBibq95qQ60gQrDQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">为了方便以后使用，<strong>这个文件是可以免费下载的</strong>，建议大家直接下来，后面就可以用EXCEL随时打开查看了。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100018024" data-ratio="0.649074074074074" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYShq0TL0y3V6mwdcT7n6icJ1Q6j4hCnJUO6zzBOfggIhgNzF0eanYrWA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYShq0TL0y3V6mwdcT7n6icJ1Q6j4hCnJUO6zzBOfggIhgNzF0eanYrWA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">点击下面的<code>Manifest 201807</code>就可以来到数据详情和下载界面了，UKbiobank这个免费的数据已经好久不更新了，可以看到数据就留在2018年了。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100018025" data-ratio="0.7472222222222222" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYtVYyVz6oQ7HIUcOFDWLRuGPuk8ymkNia3xOxnzuJgFmEOiaoAE7siaRlA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYtVYyVz6oQ7HIUcOFDWLRuGPuk8ymkNia3xOxnzuJgFmEOiaoAE7siaRlA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">数据详情界面有每个数据的<code>phenotype description</code>、<code>phenotype code</code>、数据下载链接等信息。</p><p data-tool="mdnice编辑器">可以看到每个表型（phenotype）都有6个数据，分别是<code>inrt</code>和<code>raw</code>各有3种（分为female、male、both_sexes）。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100018030" data-ratio="0.7101851851851851" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYVCic2yK3AFfterYdtZVF0kQfWN3MLc4jx5TnPBp7L21MKEJRpibtnNHQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYVCic2yK3AFfterYdtZVF0kQfWN3MLc4jx5TnPBp7L21MKEJRpibtnNHQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">把下面的滚动条往右边拉到最后，就可以看到每个数据的下载链接了，你鼠标放上去就会有复制链接的提示，直接复制在浏览器或者迅雷等软件中打开即可下载数据了。</p><p data-tool="mdnice编辑器">每个表型都有6个数据，那么我们应该是用哪个呢？官方的<span>github</span><sup>[1]</sup>介绍说选择<code>irnt</code>作为接下来的分析：</p><blockquote data-tool="mdnice编辑器"><p>Overall, the results are largely consistent regardless of the choiceof IRNT(inverse rank-normal transformed) or raw untransformedphenotypes. Since IRNT does appear to provide a marginal boost to theh2g results, especially in terms of significance, we choose to treatthe IRNT version as the primary analysis for continuous phenotypes.(Results for the raw, untransformed versions will still appear in thecomplete results file though.)</p></blockquote><p data-tool="mdnice编辑器">所以我们也不纠结了，直接用<code>irnt</code>的数据分析，如果你的数据需要分开性别，那么你就单独下载某个性别的数据，要么就是下载<code>both_sexes</code>的。</p><h2 data-tool="mdnice编辑器"><span></span><span>数据读取及整理</span><span></span></h2><p data-tool="mdnice编辑器">我这里选择了<code>fat</code>这个表型的数据（上面有展示）。下载好之后直接用<code>vroom</code>读取即可：</p><pre data-tool="mdnice编辑器"><code>fat_bothsex &lt;- vroom::vroom(<span>"./ukbiobank/100004_irnt.gwas.imputed_v3.both_sexes.tsv.bgz"</span>)<br><br>dim(fat_bothsex)<br><span>## [1] 13791467       11</span><br>colnames(fat_bothsex)<br><span>##  [1] "variant"                "minor_allele"           "minor_AF"              </span><br><span>##  [4] "low_confidence_variant" "n_complete_samples"     "AC"                    </span><br><span>##  [7] "ytx"                    "beta"                   "se"                    </span><br><span>## [10] "tstat"                  "pval"</span><br></code></pre><p data-tool="mdnice编辑器">这个数据也是很大的，1000多万行，11列。</p><pre data-tool="mdnice编辑器"><code><span># 看下前6行</span><br>head(fat_bothsex)<br><span>## # A tibble: 6 × 11</span><br><span>##   variant minor_allele minor_AF low_confidence_variant n_complete_samples     AC</span><br><span>##   &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt; &lt;lgl&gt;                               &lt;dbl&gt;  &lt;dbl&gt;</span><br><span>## 1 1:1579… T             0       TRUE                                51453 0     </span><br><span>## 2 1:6948… A             2.04e-5 TRUE                                51453 2.10e0</span><br><span>## 3 1:6956… C             1.80e-4 TRUE                                51453 1.85e1</span><br><span>## 4 1:1398… T             2.03e-5 TRUE                                51453 2.09e0</span><br><span>## 5 1:6927… C             1.12e-1 FALSE                               51453 1.15e4</span><br><span>## 6 1:6937… G             1.17e-1 FALSE                               51453 1.20e4</span><br><span>## # ℹ 5 more variables: ytx &lt;dbl&gt;, beta &lt;dbl&gt;, se &lt;dbl&gt;, tstat &lt;dbl&gt;, pval &lt;dbl&gt;</span><br></code></pre><p data-tool="mdnice编辑器">这个数据的每一列是什么意思，都在前面说过的<code>README</code>部分有详细的介绍，大家一定要去看！</p><p data-tool="mdnice编辑器">比如第一列是<code>variant</code>，它的意思是<code>chr:pos:ref:alt</code>，<code>alt</code>是<code>effect allele</code>，需要使用这个和注释文件合并。这些信息都在<code>README</code>里面：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100018029" data-ratio="0.44537037037037036" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYHejCQuZ1V6h7LGzD08ckph8Jtn7h7tKOf2FVwrNQrFMkARu257iaiaGA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYHejCQuZ1V6h7LGzD08ckph8Jtn7h7tKOf2FVwrNQrFMkARu257iaiaGA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">这个数据是没有<code>rsid</code>的，但是你仔细读过<code>README</code>之后就会发现，在<code>variants.tsv.bgz</code>这个文件中是有<code>rsid</code>的，而且这个文件也有<code>chr:pos:ref:alt</code>这些信息：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100018026" data-ratio="0.7953703703703704" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LY2936mvuiaOClL81I21jzbjoz6Bsq0sZrpIv4ojdGfqjciat2zOx8CWeQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LY2936mvuiaOClL81I21jzbjoz6Bsq0sZrpIv4ojdGfqjciat2zOx8CWeQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">所以把这个文件下载下来，和我们的<code>fat_bothsex</code>文件合并一下，就有<code>rsid</code>了。<code>variants.tsv.bgz</code>这个文件就在<code>Manifest 201807</code>的第11行，找到下载链接直接下载即可：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100018027" data-ratio="0.20987654320987653" data-type="png" data-w="810" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYVZpXfNXiaINCQvCvRJFHux00ymic4l4WTl2XMyoQMdBwU3wxgASNMKUg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYVZpXfNXiaINCQvCvRJFHux00ymic4l4WTl2XMyoQMdBwU3wxgASNMKUg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">下载好之后我们把它读取进来：</p><pre data-tool="mdnice编辑器"><code>variants_anno &lt;- vroom::vroom(<span>"./ukbiobank/variants.tsv.bgz"</span>)<br>dim(variants_anno)<br><span>## [1] 13791467       25</span><br></code></pre><p data-tool="mdnice编辑器">发现这个数据和<code>fat_bothsex</code>这个数据的行数是一样的。其实在<code>README</code>的描述中人家就说的很清楚了，这个顺序就是一样的，你可以通过<code>variant</code>这一列进行合并，也可以直接复制粘贴到一起：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100018028" data-ratio="0.3490740740740741" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYZfqdCQPBOhEp3adyDxJVQ3g3B9n2obBvcWnu5eDXFiav75o9WxOUWtw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RiciaLtEn19qMuvcOC1DJr7LYZfqdCQPBOhEp3adyDxJVQ3g3B9n2obBvcWnu5eDXFiav75o9WxOUWtw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">查看前6行：</p><pre data-tool="mdnice编辑器"><code>variants_anno[<span>1</span>:<span>6</span>,]<br><span>## # A tibble: 6 × 25</span><br><span>##   variant  chr      pos ref   alt   rsid  varid consequence consequence_category</span><br><span>##   &lt;chr&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;               </span><br><span>## 1 1:15791… 1      15791 C     T     rs54… 1:15… splice_reg… missense            </span><br><span>## 2 1:69487… 1      69487 G     A     rs56… 1:69… missense_v… missense            </span><br><span>## 3 1:69569… 1      69569 T     C     rs25… 1:69… missense_v… missense            </span><br><span>## 4 1:13985… 1     139853 C     T     rs53… 1:13… splice_reg… missense            </span><br><span>## 5 1:69279… 1     692794 CA    C     1:69… 1:69… upstream_g… non_coding          </span><br><span>## 6 1:69373… 1     693731 A     G     rs12… 1:69… upstream_g… non_coding          </span><br><span>## # ℹ 16 more variables: info &lt;dbl&gt;, call_rate &lt;dbl&gt;, AC &lt;dbl&gt;, AF &lt;dbl&gt;,</span><br><span>## #   minor_allele &lt;chr&gt;, minor_AF &lt;dbl&gt;, p_hwe &lt;dbl&gt;, n_called &lt;dbl&gt;,</span><br><span>## #   n_not_called &lt;dbl&gt;, n_hom_ref &lt;dbl&gt;, n_het &lt;dbl&gt;, n_hom_var &lt;dbl&gt;,</span><br><span>## #   n_non_ref &lt;dbl&gt;, r_heterozygosity &lt;dbl&gt;, r_het_hom_var &lt;dbl&gt;,</span><br><span>## #   r_expected_het_frequency &lt;dbl&gt;</span><br></code></pre><p data-tool="mdnice编辑器">看看是不是完全一样：</p><pre data-tool="mdnice编辑器"><code><span># 肯定是完全一致</span><br>identical(variants_anno$variant, fat_bothsex$variant)<br><span>## [1] TRUE</span><br></code></pre><p data-tool="mdnice编辑器">所以我们直接合并一下即可：</p><pre data-tool="mdnice编辑器"><code>fat_bothsex &lt;- cbind.data.frame(variants_anno[,<span>2</span>:<span>6</span>], fat_bothsex)<br>head(fat_bothsex)<br><span>##   chr    pos ref alt          rsid       variant minor_allele    minor_AF</span><br><span>## 1   1  15791   C   T   rs547522712   1:15791:C:T            T 0.00000e+00</span><br><span>## 2   1  69487   G   A   rs568226429   1:69487:G:A            A 2.03879e-05</span><br><span>## 3   1  69569   T   C     rs2531267   1:69569:T:C            C 1.80062e-04</span><br><span>## 4   1 139853   C   T   rs533633326  1:139853:C:T            T 2.03117e-05</span><br><span>## 5   1 692794  CA   C 1:692794_CA_C 1:692794:CA:C            C 1.12102e-01</span><br><span>## 6   1 693731   A   G    rs12238997  1:693731:A:G            G 1.16788e-01</span><br><span>##   low_confidence_variant n_complete_samples          AC        ytx       beta</span><br><span>## 1                   TRUE              51453     0.00000    0.00000        NaN</span><br><span>## 2                   TRUE              51453     2.09804   -1.99658 -0.9567220</span><br><span>## 3                   TRUE              51453    18.52940   -2.86950 -0.1222020</span><br><span>## 4                   TRUE              51453     2.09020   -2.00107 -0.9583010</span><br><span>## 5                  FALSE              51453 11535.90000 -162.96100 -0.0233942</span><br><span>## 6                  FALSE              51453 12018.20000 -105.14000 -0.0126221</span><br><span>##          se     tstat      pval</span><br><span>## 1       NaN       NaN       NaN</span><br><span>## 2 0.6939280 -1.378710 0.1679920</span><br><span>## 3 0.2382830 -0.512845 0.6080620</span><br><span>## 4 0.6939330 -1.380970 0.1672940</span><br><span>## 5 0.0107131 -2.183700 0.0289888</span><br><span>## 6 0.0101812 -1.239750 0.2150740</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>MR分析</span><span></span></h2><p data-tool="mdnice编辑器">首先是加载R包：</p><pre data-tool="mdnice编辑器"><code><span>library</span>(TwoSampleMR)<br></code></pre><p data-tool="mdnice编辑器">现在<code>fat_bothsex</code>这个数据是一个GWAS的原始数据，你可以把它用作是<strong>结局相关的数据</strong>，也可以把它用作是<strong>暴露相关的数据</strong>。</p><p data-tool="mdnice编辑器">如果你要把这个数据用作是结局相关的数据，那就是直接进行以下代码即可：</p><pre data-tool="mdnice编辑器"><code><span># 注意列名一一对应</span><br>outcome_data &lt;- format_data(dat = fat_bothsex,<br>                      type = <span>"outcome"</span>, <span># 类型是outcome</span><br>                      snp_col = <span>"rsid"</span>,<br>                      beta_col = <span>"beta"</span>,<br>                      se_col = <span>"se"</span>,<br>                      eaf_col = <span>"minor_AF"</span>,<br>                      effect_allele_col = <span>"alt"</span>,<br>                      other_allele_col = <span>"ref"</span>,<br>                      pval_col = <span>"pval"</span>,<br>                      samplesize_col = <span>"n_complete_samples"</span>,<br>                      <span>#ncase_col = "ncase_col",</span><br>                      <span>#ncontrol_col = "ncontrol_col",</span><br>                      <span>#gene_col = "nearest_genes",</span><br>                      chr_col = <span>"chr"</span>,<br>                      pos_col = <span>"pos"</span><br>                      )<br></code></pre><p data-tool="mdnice编辑器">现在这个<code>outcome_data</code>就是一个结局数据了，如果你已经有了暴露数据，那么就可以直接进行MR分析了。</p><p data-tool="mdnice编辑器">如果你要把这个数据用作是暴露数据，那么首先需要根据P值筛选一下：</p><pre data-tool="mdnice编辑器"><code><span># 先去掉NaN</span><br>df1 &lt;- fat_bothsex[!is.nan(fat_bothsex$pval),]<br><span># 根据P值筛选,我这个数据没有小于5e-8的，所以选择了5e-6作为演示</span><br>df1 &lt;- subset(df1, pval &lt; <span>5e-6</span>)<br></code></pre><p data-tool="mdnice编辑器">然后再格式化数据：</p><pre data-tool="mdnice编辑器"><code><span># 注意列名一一对应</span><br>exposure_data &lt;- format_data(dat = df1,<br>                      type = <span>"exposure"</span>, <span># 类型是exposure</span><br>                      snp_col = <span>"rsid"</span>,<br>                      beta_col = <span>"beta"</span>,<br>                      se_col = <span>"se"</span>,<br>                      eaf_col = <span>"minor_AF"</span>,<br>                      effect_allele_col = <span>"alt"</span>,<br>                      other_allele_col = <span>"ref"</span>,<br>                      pval_col = <span>"pval"</span>,<br>                      samplesize_col = <span>"n_complete_samples"</span>,<br>                      <span>#ncase_col = "ncase_col",</span><br>                      <span>#ncontrol_col = "ncontrol_col",</span><br>                      <span>#gene_col = "nearest_genes",</span><br>                      chr_col = <span>"chr"</span>,<br>                      pos_col = <span>"pos"</span><br>                      )<br></code></pre><p data-tool="mdnice编辑器">然后再运行下clump（这个过程需要联网的，如果你想完全本地化运行，可参考<a href="https://mp.weixin.qq.com/s?__biz=MzUzOTQzNzU0NA==&amp;mid=2247501490&amp;idx=1&amp;sn=6227740d7e9c98b04ba2ff21274d84ac&amp;scene=21#wechat_redirect" data-linktype="2">下载IEU OPEN GWAS数据本地处理</a>）：</p><pre data-tool="mdnice编辑器"><code><span># 这一步需要联网</span><br>exposure_data &lt;- clump_data(exposure_data,<br>                            clump_kb=<span>10000</span>, clump_r2=<span>0.001</span>)<br></code></pre><p data-tool="mdnice编辑器">现在这个<code>exposure_data</code>就是一个暴露数据了，如果你已经有了结局数据，那么就可以直接进行MR分析了。</p><p data-tool="mdnice编辑器">其中还有一些问题并没有说，比如一个ref有多个alt，或者minor_allele有多个等问题，以后再介绍，大家遇到了也可以自己搜索下。</p><p data-tool="mdnice编辑器">搞定！easy！</p><h3 data-tool="mdnice编辑器"><span>参考资料</span></h3><section data-tool="mdnice编辑器"><span><span>[1] </span><p>github: <span>https://nealelab.github.io/UKBB_ldsc/select_topline.html</span></p></span></section></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/CCq9iIsti5wpCyItYAhmNQ",target="_blank" rel="noopener noreferrer">原文链接</a>
