---
title: "别内卷了，卷个富集圈图吧— ggplot2版"
date: 2024-04-07T00:18:59Z
draft: ["false"]
tags: [
  "fetched",
  "生信益站"
]
categories: ["Acdemic"]
---
别内卷了，卷个富集圈图吧— ggplot2版 by 生信益站
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><figure data-tool="mdnice编辑器"></figure></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><figure data-tool="mdnice编辑器"><img data-imgfileid="100024781" data-ratio="0.278125" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaGSreV7ajjibZWgQ1ib6FXKUXrL67LOGaLRlfE4aROjnxYLiagDd3iacDPA/640?wx_fmt=gif&amp;from=appmsg" data-type="gif" data-w="640" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaGSreV7ajjibZWgQ1ib6FXKUXrL67LOGaLRlfE4aROjnxYLiagDd3iacDPA/640?wx_fmt=gif&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><code>生信益站，一点就有益</code>！<strong>祝友友们天天开心，月月发 CNS~</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzU1NTk0MTUxMg==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib8n88v0Cj6koLMO8nOuGacicngmJdb0zgmMpxaXYnrB7sjV5iar1cTzTDLsicoyNKrjic1Hgric41HObSQ/0?wx_fmt=png" data-nickname="生信益站" data-signature="生物信息或基因测序数据分析、软件算法、科研绘图、Python/Perl/R代码分享。" data-from="0"></mp-common-profile></section><hr data-tool="mdnice编辑器"><figure data-tool="mdnice编辑器"><img data-imgfileid="100024779" data-ratio="0.3768518518518518" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaALbfRbXkN4fDjH0wHZ5FHPUicMCUicAUZ9oGibo0icxS6M08PqPuOgRkBA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaALbfRbXkN4fDjH0wHZ5FHPUicMCUicAUZ9oGibo0icxS6M08PqPuOgRkBA/640?wx_fmt=png&amp;from=appmsg"><figcaption>设我为🌟星标，每天就能第一时间看到推送啦~</figcaption></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100024783" data-ratio="0.7277777777777777" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaicNUwXhf292LOCGOOQGckhhDjuSWb9ITXjDIq5JnMmkwfs0ZDsXABkQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaicNUwXhf292LOCGOOQGckhhDjuSWb9ITXjDIq5JnMmkwfs0ZDsXABkQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>扫码进QQ群交流</figcaption></figure><p data-tool="mdnice编辑器">今天要画的图有多火就不用说了，连老外都在他们论坛里提问：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100024782" data-ratio="0.5703703703703704" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaHsUEaRtRYncmRQZdUeRUJfwWlmnP9Lr50nnF1oxej34wLGYCyPtvPA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaHsUEaRtRYncmRQZdUeRUJfwWlmnP9Lr50nnF1oxej34wLGYCyPtvPA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">有趣的是，评论区都认为这个图的可读性并不好，但是依然推荐了<code>circlize/pycirclize、GOplot、CirGO</code>等包。</p><p data-tool="mdnice编辑器"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU1NTk0MTUxMg==&amp;mid=2247491427&amp;idx=1&amp;sn=9c207898ea327ac8edd4ac8bfd868c68&amp;chksm=fbcdf484ccba7d925e53785d8b2bfd2ac9e27846117f1abf3f79dfc6578b59bf640a611fb128&amp;scene=21#wechat_redirect" textvalue="不用Perl不用R也可以绘制这么漂亮的circos图？" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">不用Perl不用R也可以绘制这么漂亮的circos图？</a><br></p><p data-tool="mdnice编辑器"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU1NTk0MTUxMg==&amp;mid=2247487140&amp;idx=1&amp;sn=35d89a5aac0a3715ef7631f9499a07dd&amp;chksm=fbcde543ccba6c55200d8e2957e17937a4b35bb6e5e93b68364c006298bdac8d7c6b56703d1c&amp;scene=21#wechat_redirect" textvalue="绘图专题| 使用circlize画一个环形热图" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">绘图专题| 使用circlize画一个环形热图</a><br></p><p data-tool="mdnice编辑器"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU1NTk0MTUxMg==&amp;mid=2247489264&amp;idx=2&amp;sn=c29414163377d6480ce5d415ecc8bace&amp;chksm=fbcdfd17ccba740117775510d9ce172c7f1e26ce6d37318d2c34a930a8dd43e5ff8675488c89&amp;scene=21#wechat_redirect" textvalue="绘图专题| 芭比GO了～你居然还不会用GOplot？" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">绘图专题| 芭比GO了～你居然还不会用GOplot？</a><br></p><p data-tool="mdnice编辑器"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU1NTk0MTUxMg==&amp;mid=2247507944&amp;idx=1&amp;sn=98642377b5b1da6c87efac277723ca09&amp;chksm=fbce340fccb9bd191b8cffc27d20f758fd437beb69229097478ff950643c220862206d655ded&amp;scene=21#wechat_redirect" textvalue="多个组合(logFC)的富集和弦图怎么画？" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">多个组合(logFC)的富集和弦图怎么画？</a><br></p><p data-tool="mdnice编辑器">虽然，但是，今天给大家带来的是富集圈图的<code>ggplot2</code>版本，感兴趣的可以了解下。</p><h2 data-tool="mdnice编辑器"><span></span><span>效果图</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p>一共<code>4</code>圈——<code>外圈</code>是 GO 或者 KO/KEGG ID；<code>接下来</code>是该通路背景基因的总数，用条形图长度及数字表示，颜色是显著性 qvalue 或者 pvalue 取-log10；<code>再接下来</code>是富集到该通路上下调的基因数，绿色 up 黄色 down；<code>最内圈</code>柱状图是 rich factor (0~1)。</p></blockquote><p data-tool="mdnice编辑器"><code>镂空版本</code>——好处是可以用 AI 等工具在中间 DIY 新的注释图例：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100024780" data-ratio="0.6657407407407407" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BavWVsVRmQ27YY61tgaZ1wicINPW1u706U1nicGsVNVu6pZIlq4AdLlczA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BavWVsVRmQ27YY61tgaZ1wicINPW1u706U1nicGsVNVu6pZIlq4AdLlczA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><code>图例居中</code>版——好处是节省空间：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100024786" data-ratio="0.8888888888888888" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaBpvM2iahgIAvRz0gnTvhzrkic0w9yexMEusl83pH495f2KVaMfIhwPog/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaBpvM2iahgIAvRz0gnTvhzrkic0w9yexMEusl83pH495f2KVaMfIhwPog/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>接下来，是图片绘制过程。</strong></p><h2 data-tool="mdnice编辑器"><span></span><span>加载R包</span><span></span></h2><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggplot2) <span># v3.4.4</span><br><span>library</span>(tidyverse) <span># v1.3.1</span><br><span>library</span>(ggnewscale) <span># v0.4.7</span><br><span>library</span>(geomtextpath) <span># v0.1.1</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>导入数据</span><span></span></h2><p data-tool="mdnice编辑器">示例数据一共<code>6</code>列，这里的显著性用的是<code>pvalue</code>。</p><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- read.table(<span>"A-vs-B.DEGs.kegg.top20.txt"</span>,sep=<span>"\t"</span>,header=T)<br><br>df &lt;- df %&gt;%<br>    mutate(ratio = (up_gene + down_gene) / all,<br>           pos = row_number(),<br>           up_gene_percent = up_gene / (up_gene + down_gene),<br>           down_gene_percent = down_gene / (up_gene + down_gene)<br>    )<br><br>head(df)<br></code></pre><p data-tool="mdnice编辑器">处理后，变成<code>10</code>列：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100024785" data-ratio="0.5416666666666666" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaB9oebBxmNvH96M8LkLAvJriboLMiaUGFA3fN7k7IJAMolcLyojn58YOw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaB9oebBxmNvH96M8LkLAvJriboLMiaUGFA3fN7k7IJAMolcLyojn58YOw/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>i &lt;- 0.4<br>end &lt;- max(df<span>$pos</span>)<br>max_all &lt;- max(df<span>$all</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100024784" data-ratio="0.1574074074074074" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaNRUZFaPWGEOEUNYiaUXuick3o2BovAEia8RujlHc9MON60QeSRtD2g7bg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaNRUZFaPWGEOEUNYiaUXuick3o2BovAEia8RujlHc9MON60QeSRtD2g7bg/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>绘制轮廓——4层圈图</span><span></span></h2><p data-tool="mdnice编辑器"><strong>第一步的效果如下：</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100024788" data-ratio="0.5453703703703704" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaBiaxAia3Vuh8h7uLjjVMLEN5iama3XmUHL8LKAASjRUe4uJFjBe1Ft13A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibibmSoyUao5srV0d2t56R1BaBiaxAia3Vuh8h7uLjjVMLEN5iama3XmUHL8LKAASjRUe4uJFjBe1Ft13A/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">代码如下（谨慎购买，<strong>着急要图可以去各种云平台画</strong>）：</p><p><mp-pay-preview-filter data-offset="35"></mp-pay-preview-filter></p></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/eiQDGNSLX1e0jtU6OSLV2w",target="_blank" rel="noopener noreferrer">原文链接</a>
