---
title: "spatialdata | 空间组学技术统一坐标系统概念演示"
date: 2024-04-02T01:03:06Z
draft: ["false"]
tags: [
  "fetched",
  "生信编程自修室"
]
categories: ["Acdemic"]
---
spatialdata | 空间组学技术统一坐标系统概念演示 by 生信编程自修室
------
<div><blockquote><p>由于数据量庞大、数据类型多样且异质性强，加之缺乏灵活的数据结构以存储和处理空间信息，处理单模态和多模态空间组学数据集依旧面临挑战。SpatialData是一个创新的开源框架，它为多种平台建立了统一且易于扩展的文件格式，支持统一坐标系统下的数据转换与对齐。小编认为，这一框架将成为未来空间组学数据分析的关键基石。接下来，我们将逐步深入介绍这一框架的特点和应用。</p></blockquote><p>在这个笔记中，我们将描述在<code>spatialdata.SpatialData</code>中对*变换（transformations）<em>和</em>坐标系统（coordinate systems）*的一些使用原则。</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span><span>import</span> math</span></code><code><span><br></span></code><code><span><span>import</span> matplotlib.pyplot <span>as</span> plt</span></code><code><span><span>import</span> spatialdata_plot</span></code><code><span><span>from</span> spatialdata.datasets <span>import</span> raccoon</span></code><code><span><span>from</span> spatialdata.transformations <span>import</span> (</span></code><code><span>    Affine,</span></code><code><span>    Identity,</span></code><code><span>    MapAxis,</span></code><code><span>    Scale,</span></code><code><span>    Sequence,</span></code><code><span>    Translation,</span></code><code><span>    get_transformation,</span></code><code><span>    get_transformation_between_coordinate_systems,</span></code><code><span>    set_transformation,</span></code><code><span>)</span></code></pre></section><h3>加载数据</h3><p>概念演示使用<code>spatialdata.datasets.raccoon</code> 数据集，该数据集包括：</p><ul><li><section>an image</section></li><li><section>a segmentation mask</section></li><li><section>few circles</section></li></ul><section><ul><li></ul><pre data-lang="python"><code><span>sdata = raccoon()</span></code></pre></section><pre><code>[34mINFO    [0m Transposing `data` of type: [1m&lt;[0m[1;95mclass[0m[39m [0m[32m'dask.array.core.Array'[0m[1m&gt;[0m to [1m([0m[32m'c'[0m, [32m'y'[0m, [32m'x'[0m[1m)[0m.<br></code></pre><p>该SpatialData对象的数据结构如下：</p><section><ul><li></ul><pre data-lang="python"><code><span>sdata</span></code></pre></section><pre><code>SpatialData object with:<br>├── Images<br>│     └── 'raccoon': SpatialImage[cyx] (3, 768, 1024)<br>├── Labels<br>│     └── 'segmentation': SpatialImage[yx] (768, 1024)<br>└── Shapes<br>      └── 'circles': GeoDataFrame shape: (4, 2) (2D shapes)<br>with coordinate systems:<br>▸ 'global', with elements:<br>        raccoon (Images), segmentation (Labels), circles (Shapes)<br></code></pre><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span>## 可视化该对象</span></code><code><span>fig, axs = plt.subplots(ncols=3, figsize=(12, 3))</span></code><code><span><br></span></code><code><span>sdata.pl.render_images().pl.show(ax=axs[0])</span></code><code><span>sdata.pl.render_labels().pl.show(ax=axs[1])</span></code><code><span>sdata.pl.render_shapes().pl.show(ax=axs[2])</span></code><code><span><br></span></code><code><span>sdata.pl.render_images().pl.render_labels().pl.render_shapes().pl.show(figsize=(5, 3.5))</span></code></pre></section><pre><code>~/miniconda3/envs/spatialdata/lib/python3.10/site-packages/anndata/_core/aligned_df.py:67: ImplicitModificationWarning: Transforming to str index.<br>  warnings.warn("Transforming to str index.", ImplicitModificationWarning)<br>~/miniconda3/envs/spatialdata/lib/python3.10/site-packages/anndata/_core/aligned_df.py:67: ImplicitModificationWarning: Transforming to str index.<br>  warnings.warn("Transforming to str index.", ImplicitModificationWarning)<br></code></pre><p><img data-imgfileid="100002220" data-ratio="0.3176470588235294" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2VgZiaGQGDDTj5zxINdbXAjSzAlVibXRYbW8YhTsqQqZTOqkicjDuvTuxA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="935" src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2VgZiaGQGDDTj5zxINdbXAjSzAlVibXRYbW8YhTsqQqZTOqkicjDuvTuxA/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-imgfileid="100002221" data-ratio="0.7882096069868996" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2Oqr1QrR7iaIHgkNTuSKjHN5LV8IicbqSkbjJ4LbVtN6zYx34h0DB0e1Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="458" src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2Oqr1QrR7iaIHgkNTuSKjHN5LV8IicbqSkbjJ4LbVtN6zYx34h0DB0e1Q/640?wx_fmt=png&amp;from=appmsg"></p><h3>Transformations 和 coordinate systems</h3><p>coordinate systems: 'global'是SpatialData对象创建时默认的坐标体系</p><p>Transformations: 如果没有transformations，则默认为<code>spatialdata.transformations.Identity</code></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="python"><code><span>print(sdata.coordinate_systems, end='\n\n')</span></code><code><span>print(</span></code><code><span>    '1. raccoon:', get_transformation(sdata.images["raccoon"]), '\n',</span></code><code><span>    '2. segmentation:', get_transformation(sdata.labels["segmentation"]), '\n',</span></code><code><span>    '3. circles:', get_transformation(sdata.shapes["circles"]), '\n',</span></code><code><span>)</span></code></pre></section><pre><code>['global']<br><br>1. raccoon: Identity  <br> 2. segmentation: Identity  <br> 3. circles: Identity<br></code></pre><h4>各种transformations介绍</h4><h5>Scale</h5><p>缩放，通过scale和axes两个参数来控制不同坐标轴的缩放比例</p><section><ul><li><li><li><li><li></ul><pre data-lang="python"><code><span>scale = Scale(scale= [2.0], axes=("x",))</span></code><code><span><br></span></code><code><span>set_transformation(sdata.images["raccoon"], scale, to_coordinate_system="global")</span></code><code><span><br></span></code><code><span>sdata.pl.render_images().pl.render_labels().pl.render_shapes().pl.show()</span></code></pre></section><pre><code>~/miniconda3/envs/spatialdata/lib/python3.10/site-packages/anndata/_core/aligned_df.py:67: ImplicitModificationWarning: Transforming to str index.<br>  warnings.warn("Transforming to str index.", ImplicitModificationWarning)<br></code></pre><p><img data-imgfileid="100002222" data-ratio="0.4423963133640553" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2r3C7aJpCdBgBpCGjicfLkUv71t83KbpwvVeT3MQB5BOgicGkvFvN51Kw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="651" src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2r3C7aJpCdBgBpCGjicfLkUv71t83KbpwvVeT3MQB5BOgicGkvFvN51Kw/640?wx_fmt=png&amp;from=appmsg"></p><h5>MapAxis</h5><p>对坐标轴进行重排</p><section><ul><li><li><li><li><li></ul><pre data-lang="python"><code><span>map_axis = MapAxis({<span>"x"</span>: <span>"y"</span>, <span>"y"</span>: <span>"x"</span>})</span></code><code><span><br></span></code><code><span>set_transformation(sdata.images[<span>"raccoon"</span>], map_axis, to_coordinate_system=<span>"global"</span>)</span></code><code><span><br></span></code><code><span>sdata.pl.render_images().pl.render_labels().pl.render_shapes().pl.show()</span></code></pre></section><pre><code>~/miniconda3/envs/spatialdata/lib/python3.10/site-packages/anndata/_core/aligned_df.py:67: ImplicitModificationWarning: Transforming to str index.<br>  warnings.warn("Transforming to str index.", ImplicitModificationWarning)<br></code></pre><p><img data-imgfileid="100002223" data-ratio="0.9859437751004017" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2YMibsjmJ9dsHPqpUKBFOK8alx23evsVibWGxlE29oKBX3pCCyOX1vYQA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="498" src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2YMibsjmJ9dsHPqpUKBFOK8alx23evsVibWGxlE29oKBX3pCCyOX1vYQA/640?wx_fmt=png&amp;from=appmsg"></p><h5>Rotation</h5><p>旋转通过仿射矩阵来进行控制，仿射变换推荐阅读该帖子</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span>theta = math.pi / 6</span></code><code><span>rotation = Affine(</span></code><code><span>    [</span></code><code><span>        [math.cos(theta), -math.sin(theta), 0],</span></code><code><span>        [math.sin(theta), math.cos(theta), 0],</span></code><code><span>        [0, 0, 1],</span></code><code><span>    ],</span></code><code><span>    input_axes=("x", "y"),</span></code><code><span>    output_axes=("x", "y"),</span></code><code><span>)</span></code><code><span><br></span></code><code><span>set_transformation(sdata.images["raccoon"], rotation, to_coordinate_system="global")</span></code><code><span><br></span></code><code><span>sdata.pl.render_images().pl.render_labels().pl.render_shapes().pl.show()</span></code></pre></section><pre><code>~/miniconda3/envs/spatialdata/lib/python3.10/site-packages/anndata/_core/aligned_df.py:67: ImplicitModificationWarning: Transforming to str index.<br>  warnings.warn("Transforming to str index.", ImplicitModificationWarning)<br></code></pre><p><img data-imgfileid="100002224" data-ratio="0.8436426116838488" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2kgVxPBNyffQkAbQ5j2IBSxtgjYPUm4tyRzkGJWeB1QnSkxagSyMkuA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="582" src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2kgVxPBNyffQkAbQ5j2IBSxtgjYPUm4tyRzkGJWeB1QnSkxagSyMkuA/640?wx_fmt=png&amp;from=appmsg"></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span>theta = math.pi / <span>6</span></span></code><code><span>rotation = Affine(</span></code><code><span>    [</span></code><code><span>        [math.cos(theta), math.sin(theta), <span>0</span>],</span></code><code><span>        [-math.sin(theta), math.cos(theta), <span>0</span>],</span></code><code><span>        [<span>0</span>, <span>0</span>, <span>1</span>],</span></code><code><span>    ],</span></code><code><span>    input_axes=(<span>"x"</span>, <span>"y"</span>),</span></code><code><span>    output_axes=(<span>"x"</span>, <span>"y"</span>),</span></code><code><span>)</span></code><code><span><br></span></code><code><span>set_transformation(sdata.images[<span>"raccoon"</span>], rotation, to_coordinate_system=<span>"global"</span>)</span></code><code><span><br></span></code><code><span>sdata.pl.render_images().pl.render_labels().pl.render_shapes().pl.show()</span></code></pre></section><pre><code>~/miniconda3/envs/spatialdata/lib/python3.10/site-packages/anndata/_core/aligned_df.py:67: ImplicitModificationWarning: Transforming to str index.<br>  warnings.warn("Transforming to str index.", ImplicitModificationWarning)<br></code></pre><p><img data-imgfileid="100002225" data-ratio="1.0020408163265306" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2LC0KszCVMibv7QroYFD1UeMMr7WjQ2T1OmPIcVeLZ0qn4S4IyfnuxSw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="490" src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2LC0KszCVMibv7QroYFD1UeMMr7WjQ2T1OmPIcVeLZ0qn4S4IyfnuxSw/640?wx_fmt=png&amp;from=appmsg"></p><h5>Translation</h5><p>平移</p><section><ul><li><li><li><li><li></ul><pre data-lang="python"><code><span>translation = Translation([500, 300], axes=("x", "y"))</span></code><code><span><br></span></code><code><span>set_transformation(sdata.images["raccoon"], translation, to_coordinate_system="global")</span></code><code><span><br></span></code><code><span>sdata.pl.render_images().pl.render_labels().pl.render_shapes().pl.show()</span></code></pre></section><pre><code>~/miniconda3/envs/spatialdata/lib/python3.10/site-packages/anndata/_core/aligned_df.py:67: ImplicitModificationWarning: Transforming to str index.<br>  warnings.warn("Transforming to str index.", ImplicitModificationWarning)<br></code></pre><p><img data-imgfileid="100002226" data-ratio="0.7327188940092166" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2KzGcNGUyvxyicRCyicJAX9EaZDp5XahwJoWVk2hVR6rwfic96AGNicpyPQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="651" src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2KzGcNGUyvxyicRCyicJAX9EaZDp5XahwJoWVk2hVR6rwfic96AGNicpyPQ/640?wx_fmt=png&amp;from=appmsg"></p><section><ul><li><li></ul><pre data-lang="python"><code><span><span># 平移也能得到仿射矩阵：</span></span></code><code><span>translation.to_affine_matrix(input_axes=(<span>'x'</span>, <span>'y'</span>, <span>'c'</span>), output_axes=(<span>'x'</span>, <span>'y'</span>, <span>'c'</span>))</span></code></pre></section><pre><code>array([[  1.,   0.,   0., 500.],<br>       [  0.,   1.,   0., 300.],<br>       [  0.,   0.,   1.,   0.],<br>       [  0.,   0.,   0.,   1.]])<br></code></pre><h5>Sequence</h5><p><code>spatialdata.transformations.Sequence</code> 可以用来组合变换操作</p><section><ul><li><li><li><li><li></ul><pre data-lang="python"><code><span>sequence = Sequence([rotation, scale])</span></code><code><span><br></span></code><code><span>set_transformation(sdata.images["raccoon"], sequence, to_coordinate_system="global")</span></code><code><span><br></span></code><code><span>sdata.pl.render_images().pl.render_labels().pl.render_shapes().pl.show()</span></code></pre></section><pre><code>~/miniconda3/envs/spatialdata/lib/python3.10/site-packages/anndata/_core/aligned_df.py:67: ImplicitModificationWarning: Transforming to str index.<br>  warnings.warn("Transforming to str index.", ImplicitModificationWarning)<br></code></pre><p><img data-imgfileid="100002228" data-ratio="0.5468509984639017" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT24Dwb4XHPiaEd5uMy5POo9Bv03ZbiccCrHEgLfNAAgxGXLShryR6j1eHg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="651" src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT24Dwb4XHPiaEd5uMy5POo9Bv03ZbiccCrHEgLfNAAgxGXLShryR6j1eHg/640?wx_fmt=png&amp;from=appmsg"></p><section><ul><li></ul><pre data-lang="python"><code><span>sequence.to_affine_matrix(input_axes=("x", "y"), output_axes=("x", "y"))</span></code></pre></section><pre><code>array([[ 1.73205081,  1.        ,  0.        ],<br>       [-0.5       ,  0.8660254 ,  0.        ],<br>       [ 0.        ,  0.        ,  1.        ]])<br></code></pre><section><ul><li><li></ul><pre data-lang="python"><code><span># 在raccoon上的变化包括 旋转+缩放</span></code><code><span>print('raccoon:', get_transformation(sdata.images["raccoon"]), '\n')</span></code></pre></section><pre><code>raccoon: Sequence <br>    Affine (x, y -&gt; x, y)<br>        [0.8660254 0.5       0.       ]<br>        [-0.5        0.8660254  0.       ]<br>        [0. 0. 1.]<br>    Scale (x)<br>        [2.]<br></code></pre><section><ul><li><li><li><li><li></ul><pre data-lang="python"><code><span>set_transformation(sdata.images["raccoon"], scale, to_coordinate_system="global")</span></code><code><span>set_transformation(sdata.shapes["circles"], scale, to_coordinate_system="global")</span></code><code><span>set_transformation(sdata.labels["segmentation"], rotation, to_coordinate_system="global")</span></code><code><span><br></span></code><code><span>sdata.pl.render_images().pl.render_labels().pl.render_shapes().pl.show()</span></code></pre></section><pre><code>~/miniconda3/envs/spatialdata/lib/python3.10/site-packages/anndata/_core/aligned_df.py:67: ImplicitModificationWarning: Transforming to str index.<br>  warnings.warn("Transforming to str index.", ImplicitModificationWarning)<br><br><br>[31mWARNING [0m The transformation matrix is not isotropic, the radius will be scaled by the average of the eigenvalues of<br>         the affine transformation matrix<br></code></pre><p><img data-imgfileid="100002229" data-ratio="0.6574500768049155" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2dNmG6zlVVQhLCtpAAFice2rVsVSbSyxwf4xZxpTsNrgGSWGRUWibS5uw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="651" src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2dNmG6zlVVQhLCtpAAFice2rVsVSbSyxwf4xZxpTsNrgGSWGRUWibS5uw/640?wx_fmt=png&amp;from=appmsg"></p><section><ul><li><li><li><li><li></ul><pre data-lang="python"><code><span>print(</span></code><code><span>    '1. raccoon:', get_transformation(sdata.images["raccoon"]), '\n',</span></code><code><span>    '2. segmentation:', get_transformation(sdata.labels["segmentation"]), '\n',</span></code><code><span>    '3. circles:', get_transformation(sdata.shapes["circles"]), '\n',</span></code><code><span>)</span></code></pre></section><pre><code>1. raccoon: Scale (x)<br>    [2.] <br> 2. segmentation: Affine (x, y -&gt; x, y)<br>    [0.8660254 0.5       0.       ]<br>    [-0.5        0.8660254  0.       ]<br>    [0. 0. 1.] <br> 3. circles: Scale (x)<br>    [2.]<br></code></pre><h5>Inverse transformations</h5><p>逆转变换，可以抵消之前的变化</p><section><ul><li><li><li><li><li></ul><pre data-lang="python"><code><span>sequence = Sequence([rotation, rotation.inverse(), scale, scale.inverse()])</span></code><code><span><br></span></code><code><span>set_transformation(sdata.images["raccoon"], sequence, to_coordinate_system="global")</span></code><code><span><br></span></code><code><span>sdata.pl.render_images().pl.render_labels().pl.render_shapes().pl.show()</span></code></pre></section><pre><code>~/miniconda3/envs/spatialdata/lib/python3.10/site-packages/anndata/_core/aligned_df.py:67: ImplicitModificationWarning: Transforming to str index.<br>  warnings.warn("Transforming to str index.", ImplicitModificationWarning)<br><br><br>[31mWARNING [0m The transformation matrix is not isotropic, the radius will be scaled by the average of the eigenvalues of<br>         the affine transformation matrix<br></code></pre><p><img data-imgfileid="100002230" data-ratio="0.8644366197183099" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2sMlfaib54hyqzWkYEBm80icC3ictD7YOQicacqCEyZ7D8ZGUGbH5haKMeg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="568" src="https://mmbiz.qpic.cn/mmbiz_png/rWiaFvFngFbRolFDnt9tW9TlQSibhvpdT2sMlfaib54hyqzWkYEBm80icC3ictD7YOQicacqCEyZ7D8ZGUGbH5haKMeg/640?wx_fmt=png&amp;from=appmsg"></p><h3>在coordinate systems之间进行变化操作</h3><p>通过<code>spatialdata.ops.get_transformation_between_coordinate_systems</code>函数来实现在coordinate systems之间的元素变换.</p><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span>set_transformation(sdata.images["raccoon"], rotation)</span></code><code><span><br></span></code><code><span># 从source_coordinate_system 到 target_coordinate_system 需要的变换</span></code><code><span>print(get_transformation_between_coordinate_systems(sdata,</span></code><code><span>                                                    source_coordinate_system=sdata.images["raccoon"],</span></code><code><span>                                                    target_coordinate_system="global"))</span></code><code><span><br></span></code><code><span>print(get_transformation_between_coordinate_systems(sdata, source_coordinate_system="global",</span></code><code><span>                                                    target_coordinate_system=sdata.images["raccoon"]))</span></code></pre></section><pre><code>Sequence <br>    Affine (x, y -&gt; x, y)<br>        [0.8660254 0.5       0.       ]<br>        [-0.5        0.8660254  0.       ]<br>        [0. 0. 1.]<br>Sequence <br>    Affine (x, y -&gt; x, y)<br>        [ 0.8660254 -0.5        0.       ]<br>        [0.5       0.8660254 0.       ]<br>        [0. 0. 1.]<br></code></pre><section><ul><li><li></ul><pre data-lang="python"><code><span># 注意对比上面的结果</span></code><code><span>get_transformation(sdata.images['raccoon'])</span></code></pre></section><pre><code>Affine (x, y -&gt; x, y)<br>    [0.8660254 0.5       0.       ]<br>    [-0.5        0.8660254  0.       ]<br>    [0. 0. 1.]<br></code></pre><p>接着，我们为某些元素创建一个新的坐标系（coordinate systems）</p><section><ul><li><li></ul><pre data-lang="python"><code><span>set_transformation(sdata.images["raccoon"], Identity(), "my_other_space0")</span></code><code><span>set_transformation(sdata.labels["segmentation"], Identity(), "my_other_space1")</span></code></pre></section><section><ul><li></ul><pre data-lang="python"><code><span>sdata</span></code></pre></section><pre><code>SpatialData object with:<br>├── Images<br>│     └── 'raccoon': SpatialImage[cyx] (3, 768, 1024)<br>├── Labels<br>│     └── 'segmentation': SpatialImage[yx] (768, 1024)<br>└── Shapes<br>      └── 'circles': GeoDataFrame shape: (4, 2) (2D shapes)<br>with coordinate systems:<br>▸ 'global', with elements:<br>        raccoon (Images), segmentation (Labels), circles (Shapes)<br>▸ 'my_other_space0', with elements:<br>        raccoon (Images)<br>▸ 'my_other_space1', with elements:<br>        segmentation (Labels)<br></code></pre><section><ul><li></ul><pre data-lang="python"><code><span>print(get_transformation(sdata.images["raccoon"], get_all=True))</span></code></pre></section><pre><code>{'global': Affine (x, y -&gt; x, y)<br>    [0.8660254 0.5       0.       ]<br>    [-0.5        0.8660254  0.       ]<br>    [0. 0. 1.], 'my_other_space0': Identity }<br></code></pre><p>We then get the transformation between the <code>"global"</code> coordinate system and the <code>"my_other_space0"</code> coordinate system.</p><p>As expected, it is a {class}<code>spatialdata.transformations.Sequence</code> transformation with an {class}<code>spatialdata.transformations.Affine</code> and an {class}<code>spatialdata.transformations.Identity</code> composed.</p><section><ul><li></ul><pre data-lang="python"><code><span>get_transformation_between_coordinate_systems(sdata, "global", "my_other_space0")</span></code></pre></section><pre><code>Sequence <br>    Affine (x, y -&gt; x, y)<br>        [ 0.8660254 -0.5        0.       ]<br>        [0.5       0.8660254 0.       ]<br>        [0. 0. 1.]<br>    Identity<br></code></pre><p>我们可以预见，需要做的变换应该和下面一致：</p><section><ul><li></ul><pre data-lang="python"><code><span>get_transformation(sdata.images['raccoon'],get_all=True)</span></code></pre></section><pre><code>{'global': Affine (x, y -&gt; x, y)<br>     [0.8660254 0.5       0.       ]<br>     [-0.5        0.8660254  0.       ]<br>     [0. 0. 1.],<br> 'my_other_space0': Identity }</code></pre><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/axSpDcntY_24wAdEyLxO6w",target="_blank" rel="noopener noreferrer">原文链接</a>
