---
title: "TO-GCN 时序基因共表达网络【可视化】"
date: 2024-04-29T00:06:34Z
draft: ["false"]
tags: [
  "fetched",
  "生信益站"
]
categories: ["Acdemic"]
---
TO-GCN 时序基因共表达网络【可视化】 by 生信益站
------
<div><p><span>‍</span></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><figure data-tool="mdnice编辑器"><span>‍</span><img data-imgfileid="100025669" data-ratio="0.278125" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVW11ZicTIGuG0uvvicnUyLRQzAJwu5VDQg6NxSd646yUibUAAbjEWOUVuJA/640?wx_fmt=gif&amp;from=appmsg" data-type="gif" data-w="640" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVW11ZicTIGuG0uvvicnUyLRQzAJwu5VDQg6NxSd646yUibUAAbjEWOUVuJA/640?wx_fmt=gif&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><code>生信益站，一点就有益</code>！<strong>祝友友们天天开心，月月发 CNS~</strong></p></section><section><mp-common-profile data-pluginname="mpprofile" data-id="MzU1NTk0MTUxMg==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSib8n88v0Cj6koLMO8nOuGacicngmJdb0zgmMpxaXYnrB7sjV5iar1cTzTDLsicoyNKrjic1Hgric41HObSQ/0?wx_fmt=png" data-nickname="生信益站" data-alias="" data-signature="生物信息或基因测序数据分析、软件算法、科研绘图、Python/Perl/R代码分享。" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><hr data-tool="mdnice编辑器"><figure data-tool="mdnice编辑器"><img data-imgfileid="100025665" data-ratio="0.3768518518518518" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWj2aGSfrnyia0rSJrDOKPyQmEVFictdWZmHEVCNaIibqdD5CsibWUiaDibSNg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWj2aGSfrnyia0rSJrDOKPyQmEVFictdWZmHEVCNaIibqdD5CsibWUiaDibSNg/640?wx_fmt=png&amp;from=appmsg"><figcaption>设我为🌟星标，每天就能第一时间看到推送啦~</figcaption></figure><p data-tool="mdnice编辑器">今天继续给大家画图——<strong>TO-GCN层次网络可视化。</strong></p><p data-tool="mdnice编辑器">TO-GCN最经典的应用或者论文是2019年发表早<code>PNAS</code>的文章《<code>Comparative transcriptomics method to infer gene coexpression networks and its applications to maize and rice leaf transcriptomes</code>》，通过<code>3维（基因表达、条件和时间</code>）数据结构，构建了不依赖光（在光和黑暗条件都共表达）的 TF 时序基因共表达网络。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100025666" data-ratio="1.2670588235294118" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWH7EdvibWu2LxhniadUYTciatXp6XFYA2Mu3GRsMEsCV3WbwhulPbDcmVg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="850" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWH7EdvibWu2LxhniadUYTciatXp6XFYA2Mu3GRsMEsCV3WbwhulPbDcmVg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>我画的效果如下（</strong><span><strong>觉得布局不好看可以输出为pdf/eps等格式导入AI进行拖拽</strong></span><strong>）</strong>：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100025668" data-ratio="0.9657407407407408" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWpR0HGk0SAYITe2PBrhIgPZopa9TaIib1HO6dBhCQjia9gB5bHgvySSJQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWpR0HGk0SAYITe2PBrhIgPZopa9TaIib1HO6dBhCQjia9gB5bHgvySSJQ/640?wx_fmt=png&amp;from=appmsg"></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100025667" data-ratio="1.0074074074074073" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWHqhqdmNzkVPgT004YbNlqBkE30OxVH5IRUfPjEHfuP0yMxzvjTAtQA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWHqhqdmNzkVPgT004YbNlqBkE30OxVH5IRUfPjEHfuP0yMxzvjTAtQA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong><em>更多TO-GCN教程：</em></strong></p><p data-tool="mdnice编辑器"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU1NTk0MTUxMg==&amp;mid=2247508651&amp;idx=1&amp;sn=a71852cb0753c06309c7cd6839fae59d&amp;chksm=fbce494cccb9c05aa0c345dec2cc9067851ea70b1bb44e35f28a7befa1c04032ab28142bf01a&amp;scene=21#wechat_redirect" textvalue="TO-GCN时序基因共表达网络（三）：实战" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">TO-GCN时序基因共表达网络（三）：R语言实战</a><br></p><p data-tool="mdnice编辑器"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU1NTk0MTUxMg==&amp;mid=2247508651&amp;idx=2&amp;sn=3103c3b236f40d1c14678b16f58b2189&amp;chksm=fbce494cccb9c05a80c58197a7b0904c1babe4041d2f39ee70286bc2f4d786c9a3b7fd5e5054&amp;scene=21#wechat_redirect" textvalue="TO-GCN时序基因共表达网络（二）：拓展" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">TO-GCN时序基因共表达网络（二）：</a><span>适用于二维数据</span></p><p data-tool="mdnice编辑器"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU1NTk0MTUxMg==&amp;mid=2247508651&amp;idx=3&amp;sn=5fcd0f5ca284c53d17bf6803a0771164&amp;chksm=fbce494cccb9c05a404e6d49dcbc78585b9a936550a68b93f1b31a08f8b727c8db0f768969e6&amp;scene=21#wechat_redirect" textvalue="TO-GCN时序基因共表达网络（一）：初识" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">TO-GCN时序基因共表达网络（一）：</a><span>适用于三维数据</span><br></p><h2 data-tool="mdnice编辑器"><span></span><span>数据整理</span><span></span></h2><p data-tool="mdnice编辑器">数据来自官网运行示例代码（https://github.com/petitmingchang/TO-GCN）的输出。</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggraph)<br><span>library</span>(tidyverse)<br></code></pre><p data-tool="mdnice编辑器">读取<code>TF level</code>文件：</p><pre data-tool="mdnice编辑器"><span></span><code>lev &lt;- read.csv(<span>"TF_level.csv"</span>,header = <span>T</span>)<br>lev2 &lt;- lev %&gt;% mutate(level.in.GCN = factor(paste0(<span>"lev"</span>,level.in.GCN))) <br>lev2$level.in.GCN &lt;- fct_relevel(lev2$level.in.GCN,paste0(<span>"lev"</span>,<span>1</span>:<span>16</span>))<br>head(lev2)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100025671" data-ratio="0.2962962962962963" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWQBjERPuDpwsMibbrllbfxf5c9c1gCNQNuBhb56KRGXvrf96K77E1o7A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWQBjERPuDpwsMibbrllbfxf5c9c1gCNQNuBhb56KRGXvrf96K77E1o7A/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">读取<code>TO-GCN</code>输出的<code>C1+C2+.tsv</code>（2个条件均正相关共表达）：</p><pre data-tool="mdnice编辑器"><span></span><code>pcc &lt;- read.csv(<span>"C1+C2+.csv"</span>,header = <span>T</span>)<br><br><br>pcc %&gt;% <br>    filter(TF.gene.ID %<span>in</span>% lev$TF.gene.ID, gene.ID %<span>in</span>% lev$TF.gene.ID) %&gt;% <br>    slice_head(n=<span>5000</span>) -&gt; pcc2 <br></code></pre><p data-tool="mdnice编辑器">只取<code>5000行</code>画：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100025670" data-ratio="0.3138888888888889" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWkicpRM3x3aaqOibrv12hQSjFbyaFwJhZDicRSNMcHeZBo2KCVJ7n2qXicw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWkicpRM3x3aaqOibrv12hQSjFbyaFwJhZDicRSNMcHeZBo2KCVJ7n2qXicw/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>数据转化为graph</span><span></span></h2><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(netET)<br><br>as_tbl_graph(pcc2[,c(<span>"TF.gene.ID"</span>,<span>"gene.ID"</span>)],simplify = <span>"all"</span>) %&gt;% <br>    left_join(lev2, by = c(<span>"name"</span> = <span>"TF.gene.ID"</span>))  -&gt;g<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100025672" data-ratio="0.4185185185185185" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWy0iakplhR3FI8JBfhicmh6428JZFJHrPUiaqZAJ2xIt1YicadkITNkjib4Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWy0iakplhR3FI8JBfhicmh6428JZFJHrPUiaqZAJ2xIt1YicadkITNkjib4Q/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>自定义布局</span><span></span></h2><p data-tool="mdnice编辑器">其实就是计算每个TF Gene的坐标，形成分组的circle布局：</p><pre data-tool="mdnice编辑器"><span></span><code>coord &lt;- layout_on_circle(g, group = level.in.GCN)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100025673" data-ratio="0.6231481481481481" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVW5xvEzYKKYrDaVVraGmQrApyByIIiaR8KmXKLQtttFS1CL2N1FQooJPA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVW5xvEzYKKYrDaVVraGmQrApyByIIiaR8KmXKLQtttFS1CL2N1FQooJPA/640?wx_fmt=png&amp;from=appmsg"><figcaption>可以看出coord就2列，定义了每个点的位置</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>基本图形</span><span></span></h2><pre data-tool="mdnice编辑器"><span></span><code>ggraph(g, coord, x = coord[,1],y = coord[,2]) +<br><br>    geom_edge_fan(width = 0.2, alpha = 0.1) +<br><br>    geom_node_point(aes(colour = level.in.GCN)) +<br>    <br>    coord_fixed(clip = <span>"off"</span>) +<br>    <br>    theme(panel.background = element_blank()) +<br>    <br>    labs(colour = <span>"level in GCN"</span>) <br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100025674" data-ratio="0.8175925925925925" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWfY2iaw5eGsDAX4ET0iaz1eS0nGWmwUPDchClWoMHBicSicokwHdRVywadg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWfY2iaw5eGsDAX4ET0iaz1eS0nGWmwUPDchClWoMHBicSicokwHdRVywadg/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>去掉图例</span><span></span></h2><pre data-tool="mdnice编辑器"><span></span><code>ggraph(g, coord, x = coord[,1],y = coord[,2]) +<br><br>    geom_edge_fan(width = 0.2, alpha = 0.1) +<br><br>    geom_node_point(aes(colour = level.in.GCN),<br>                    show.legend = F) +<br>    <br>    coord_fixed(clip = <span>"off"</span>) +<br>    <br>    theme(panel.background = element_blank())<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100025677" data-ratio="0.9861111111111112" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWB4RSbkL2K4EIZHYrREoTico5Y1sKv6jicrAgfDhlhO6AtADNs231HBtg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mhoJzVKWSibiccE2Fo6AKHCPbUX7hyuQVWB4RSbkL2K4EIZHYrREoTico5Y1sKv6jicrAgfDhlhO6AtADNs231HBtg/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>增加每个level的label</span><span></span></h2><p><mp-pay-preview-filter data-offset="40"></mp-pay-preview-filter></p></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/hVZy28TVJ4VF96TWRt2dZQ",target="_blank" rel="noopener noreferrer">原文链接</a>
