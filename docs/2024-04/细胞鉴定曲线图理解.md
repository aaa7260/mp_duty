---
title: "细胞鉴定曲线图理解"
date: 2024-04-17T09:32:57Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
细胞鉴定曲线图理解 by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span></span><span>cellranger细胞鉴定曲线</span><span></span></h3><p data-tool="mdnice编辑器">一般得到10X Genomics的下机数据之后，我们需要使用Cellranger软件进行上游数据的处理，并且生成网页报告。</p><p data-tool="mdnice编辑器">其中就包括了<strong>Barcode Rank Plot——细胞鉴定曲线图</strong><img data-imgfileid="100037838" data-ratio="0.6928471248246845" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGv2bhAFLic347psib4jaQr5vZNuOIbicFbXiclk9smnlg0peG3M33MGEHiang/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="713" src="https://mmbiz.qpic.cn/mmbiz_jpg/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGv2bhAFLic347psib4jaQr5vZNuOIbicFbXiclk9smnlg0peG3M33MGEHiang/640?wx_fmt=jpeg&amp;from=appmsg"></p><p data-tool="mdnice编辑器">细胞鉴定曲线图横坐标是Barcodes，纵坐标是UMI counts，都取log19.图中是<strong>将所有测序得到的Barcode按照其包含的UMI数进行降序排列，并且对细胞和非细胞标注不同的颜色，帮助区分。</strong></p><p data-tool="mdnice编辑器">然后<strong>基于细胞鉴定曲线图，设定一个cutoff值</strong>，决定去除掉哪些barcodes，并且保留下来部分Barcodes用于下游的数据分析。</p><h3 data-tool="mdnice编辑器"><span></span><span></span><span>下游数据读取及硬过滤标准</span><span></span></h3><p data-tool="mdnice编辑器">使用seurat来进行单细胞下游的数据分析，<strong>一般我们下载读取的数据都是经过上游cellranger流程处理过后的数据，保留下来几千到上万的barcodes来进行后续的数据分析。</strong></p><p data-tool="mdnice编辑器">但<code>GSE139829</code>这个数据就有所不同，它是<strong>提供了原始的矩阵信息，11个样品的数据量就高达一个G</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100037840" data-ratio="1.2742742742742743" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvmu1icdAreD9UFapOt2dABEKA9ibqOsRcS4SuPEOfxDFrpxriaJbXib0icUw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="999" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvmu1icdAreD9UFapOt2dABEKA9ibqOsRcS4SuPEOfxDFrpxriaJbXib0icUw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">如果<strong>使用简单的min.cells = 5,min.features = 500进行一个硬过滤，那就会去除掉绝大多数没有意义的Barcodes</strong>。不过我们也可以使用下游矩阵数据来复现一下cellranger的细胞鉴定曲线，找一下过滤的标准。</p><pre data-tool="mdnice编辑器"><span></span><code><span>#读取数据创建seurat对象</span><br><br>counts = Read10X(<span>"outputs/UMM061/"</span>)<br><br>sce=CreateSeuratObject(counts = counts )<br><br>&gt; dim(sce)<br>[1]  33694 737280<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100037836" data-ratio="0.21238938053097345" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvmP1hRdbhyTlVqIobaQVhaTl2Ifyrfk7m5TPsMh54omllE94rQsN8wQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="226" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvmP1hRdbhyTlVqIobaQVhaTl2Ifyrfk7m5TPsMh54omllE94rQsN8wQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">创建完seurat对象之后，在不进行任何操作时，seurat会为每个细胞创建一个元数据，保存在meta.data里面</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100037837" data-ratio="0.2613756613756614" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvjFDsicvCabc9ky6wG3sfviba6icibovI7Tt5NXVKjY62BvsqPKXOp6Bvvg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="945" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvjFDsicvCabc9ky6wG3sfviba6icibovI7Tt5NXVKjY62BvsqPKXOp6Bvvg/640?wx_fmt=png&amp;from=appmsg"></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100037839" data-ratio="0.9031847133757962" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvgxykjCPtRCH7KH76TSPEuQS9YVKIiavjunHVvJTkrwmd4iaiaFebOcKBA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="785" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvgxykjCPtRCH7KH76TSPEuQS9YVKIiavjunHVvJTkrwmd4iaiaFebOcKBA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>每一列的内容：</strong></p><ul data-tool="mdnice编辑器"><li><section><code>orig.ident</code>：通常包含所知的样品名，默认为我们赋给project的值，如果不赋值那就是SeuratProject</section></li><li><section><code>nCount_RNA</code>：每个细胞的UMI数目</section></li><li><section><code>nFeature_RNA</code>：每个细胞所检测到的基因数目</section></li></ul><p data-tool="mdnice编辑器">那我们就可以使用<code>nCount_RNA</code>或者<code>nFeature_RNA</code>在R语言里面绘制细胞鉴定曲线，找到一个合适的cutoff值。</p><h3 data-tool="mdnice编辑器"><span></span><span></span><span>细胞鉴定曲线</span><span></span></h3><p data-tool="mdnice编辑器">cellranger是<strong>将所有测序得到的Barcode按照其包含的UMI数进行降序排列，并且对细胞和非细胞标注不同的颜色，帮助区分。</strong>那我们也按照对应的数据进行绘图。</p><pre data-tool="mdnice编辑器"><span></span><code>a &lt;- sort(log10(sce<span>$nCount_RNA</span>+1),decreasing = TRUE)<br><br>plot(a,<br>     xlab = <span>"Barcodes"</span>,<br>     ylab = <span>"nCount_RNA"</span>,<br>     xlim = c(100,100000)<br>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100037845" data-ratio="0.7962166809974205" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvUSULoBh14ZPYWY3Sc9TfxOLIBrARN33AibEaPrldIROnFia9Qa9QiaNFw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1163" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvUSULoBh14ZPYWY3Sc9TfxOLIBrARN33AibEaPrldIROnFia9Qa9QiaNFw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">从cellranger的3.0以后的版本，是<strong>把所有的barcodes按照UMI数进行排序后，取前1%的那个barcode所包含的UMI数量，记为m然后再去这个m的1/10作为cutoff值</strong></p><p data-tool="mdnice编辑器">那对应到我们的737280的数据，取1%就是7372，对应的UMI差不多是5000然后再取1/10，也就是500</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100037844" data-ratio="0.7962166809974205" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvL7TJlUiauu4XAc8mKT5nIrJka6ibqQr1ChMh2HP1C4geOyjKzmrUX0Ww/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1163" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvL7TJlUiauu4XAc8mKT5nIrJka6ibqQr1ChMh2HP1C4geOyjKzmrUX0Ww/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">如果<strong>使用nFeature_RNA同样的取log10之后作图，然后按照barcode包含的基因数进行排序，因为平均一个细胞的一个基因有10个左右的UMI，所以换算为基因的阈值就无需再取1/10，那根据取1%的barcode再对应到feature上差不多就是300-500左右的样子</strong></p><pre data-tool="mdnice编辑器"><span></span><code>log_data &lt;- log10(sce<span>$nFeature_RNA</span>+1)<br><br>plot(sort(log_data,decreasing = TRUE),<br>     xlab = <span>"Barcodes"</span>,<br>     ylab = <span>"nFeature_RNA"</span>,<br>     xlim = c(100,100000))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100037843" data-ratio="0.7962166809974205" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvOaT9Vu4a4MjCqXjQiagJoePCEBdSt9kVjHQuwb1SbQicS9X8ULMsLSXw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1163" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvOaT9Vu4a4MjCqXjQiagJoePCEBdSt9kVjHQuwb1SbQicS9X8ULMsLSXw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">基于细胞中至少要表达300个基因来对数据进行过滤</p><pre data-tool="mdnice编辑器"><span></span><code><span>#基于min.features = 300进行过滤</span><br>sce2=CreateSeuratObject(counts = counts,<br>                        min.cells = 5,<br>                        min.features = 300)<br><br><br>&gt; dim(sce2)<br>[1] 19222  9755<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span></span><span>nFeature_RNA和nCount_RNA</span><span></span></h3><p data-tool="mdnice编辑器">一般很少会有下游是原始的rawcounts的数据，所以对于处理后的数据集我们可以可视化一下nFeature_RNA和nCount_RNA来辅助进行质控</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100037842" data-ratio="0.7911877394636015" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvKMw7O9cBEa5paqC0uPwIjOGq85iaZRTjVr4fsDywAyVibdz6gpiaibqbLw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1044" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQRTCdTCWCMibUG9acFYElGvKMw7O9cBEa5paqC0uPwIjOGq85iaZRTjVr4fsDywAyVibdz6gpiaibqbLw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">那下期我们可以看看nFeature_RNA和nCount_RNA！</p></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/SqsFnhx5ES4OiJk1lO0XhA",target="_blank" rel="noopener noreferrer">原文链接</a>
