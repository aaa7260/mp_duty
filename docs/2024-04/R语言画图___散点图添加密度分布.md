---
title: "R语言画图 | 散点图添加密度分布"
date: 2024-04-12T08:59:38Z
draft: ["false"]
tags: [
  "fetched",
  "被炸熟的虾"
]
categories: ["Acdemic"]
---
R语言画图 | 散点图添加密度分布 by 被炸熟的虾
------
<div><blockquote data-tool="mdnice编辑器"><section><span>前期已经整理常规散点图的绘制方法，现在我们尝试在侧面添加密度曲线/数据分布直方图。</span><span></span><span></span></section></blockquote><p><span><span><span>首先</span><span>绘</span><span>制添加拟</span><span>合曲线的散点图</span><span>，</span>依然使用iris示例数据。为了更好显示不同分组的数据分布差异，我们对不同分组分别</span></span><span>添加拟合曲线及回归方程：</span></p><ul><li><p>stat_poly_line：在 ggplot2 图形中添加多项式回归线。这个函数直接计算多项式回归模型，并将拟合线添加到图形上。它允许指定多项式的阶数，即回归方程中最高次项的次数。</p></li><li><p>stat_poly_eq：添加多项式回归方程和相关统计量(如R2、<em>p</em>值等)的标签。</p></li></ul><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggplot2)<br><span>library</span>(ggpmisc)<br>theme &lt;- theme_bw()+ <br>         theme(plot.title = element_text(hjust = <span>0.5</span>,size = <span>22</span>),<br>               axis.text.x = element_text(hjust = <span>0.5</span>,size = <span>20</span>), <br>               axis.text.y = element_text(hjust = <span>0.5</span>,size = <span>20</span>),<br>               axis.title.y = element_text(size = <span>20</span>), <br>               axis.title.x = element_text(size = <span>20</span>), <br>               legend.text = element_text(size = <span>22</span>),<br>               legend.title = element_blank(),<br>               legend.position = c(<span>0.15</span>,<span>0.8</span>),<br>               legend.background = element_blank())<br>p1 &lt;- ggplot(data = iris, aes(x = Petal.Length, y = Petal.Width, group = Species)) +<br>      geom_point(aes(color = Species), size = <span>4</span>) +<br>      scale_x_continuous(limits = c(<span>1</span>,<span>7</span>), breaks = seq(<span>1</span>,<span>7</span>,<span>1</span>),labels = seq(<span>1</span>,<span>7</span>,<span>1</span>)) +<br>      scale_y_continuous(limits = c(<span>0</span>,<span>2.5</span>), breaks = seq(<span>0</span>,<span>2.5</span>,<span>0.5</span>),labels = seq(<span>0</span>,<span>2.5</span>,<span>0.5</span>)) +<br>      stat_poly_line(aes(color = Species),formula = y ~ x,show.legend = <span>FALSE</span>) +  <span># 添加线性回归线</span><br>      stat_poly_eq(aes(color = Species,<br>           label = paste(..eq.label.., ..rr.label.., stat(p.value.label), sep = <span>"*\"; \"*"</span>)),<br>                   formula = y ~ x, label.x.npc = <span>'right'</span>, label.y.npc = <span>'bottom'</span>, <br>           size = <span>6</span>, rr.digits = <span>3</span>) + <br>      scale_color_manual(values = c(<span>"#4d97cd"</span>,<span>"#459943"</span>,<span>"#c74546"</span>)) +<br>      theme<br>p1 + guides(colour = guide_legend(override.aes = list(size = <span>5</span>)))<span>##调整图例大小</span></code></pre><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p><img data-galleryid="" data-ratio="0.9565217391304348" data-s="300,640" data-type="png" data-w="920" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3IIRreicCkbyDvFOFldt1daIPLPMlUCH77dnvtuCBKeAD8h8zaP513TUbgeCZyAq8Qf5SfyuADDgWA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3IIRreicCkbyDvFOFldt1daIPLPMlUCH77dnvtuCBKeAD8h8zaP513TUbgeCZyAq8Qf5SfyuADDgWA/640?wx_fmt=png"><span></span></p><h2 data-tool="mdnice编辑器"><span></span></h2><h2 data-tool="mdnice编辑器"><span>A、ggExtra</span></h2><section><span>使用ggExtra包的ggMarginal函数添加边缘数据分布，需要关注以下几个关键参数：</span></section><ul data-tool="mdnice编辑器"><li><section>type：边缘图类型，包括density、histogram、boxplot、violin与densigram等</section></li><li><section>margins：选择绘图边，可选项：c("both", "x", "y")</section></li><li><section>size = 5：边缘图与主图的相对大小，整数，默认为 5 ，即主图比边缘图宽 5 倍/高 5 倍。</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>pdensity &lt;- ggMarginal(p1, type = <span>"density"</span>, groupColour = <span>TRUE</span>, groupFill = <span>TRUE</span>, alpha = <span>0.75</span>, bins = <span>30</span>)  <br>pdensigram &lt;- ggMarginal(p1, type = <span>"densigram"</span>, groupColour = <span>TRUE</span>, groupFill = <span>TRUE</span>, alpha = <span>0.75</span>, bins = <span>30</span>)  <br>phistogram &lt;- ggMarginal(p1, type = <span>"histogram"</span>, groupColour = <span>TRUE</span>, groupFill = <span>TRUE</span>, alpha = <span>0.75</span>, bins = <span>30</span>)  <br>pboxplot &lt;- ggMarginal(p1, type = <span>"boxplot"</span>, groupColour = <span>TRUE</span>, groupFill = <span>TRUE</span>, alpha = <span>0.75</span>)  <br>pviolin &lt;- ggMarginal(p1, type = <span>"violin"</span>, groupColour = <span>TRUE</span>, groupFill = <span>TRUE</span>, alpha = <span>0.75</span>)  <br></code></pre><p><img data-galleryid="" data-ratio="0.3333333333333333" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3IIRreicCkbyDvFOFldt1daIqLKGcicYKtPsnQB3KbS7u8cuP72DqQEhmqJibz5ehzvrJAMCwibYyHFJA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3IIRreicCkbyDvFOFldt1daIqLKGcicYKtPsnQB3KbS7u8cuP72DqQEhmqJibz5ehzvrJAMCwibYyHFJA/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.5" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3IIRreicCkbyDvFOFldt1daIIqiaw2aJiajefkxyBVM7HroJwgKP6QHlkJxftl1g4ibicGQGHgvNBiaCgVQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3IIRreicCkbyDvFOFldt1daIIqiaw2aJiajefkxyBVM7HroJwgKP6QHlkJxftl1g4ibicGQGHgvNBiaCgVQ/640?wx_fmt=png"></p><h2 data-tool="mdnice编辑器"><span></span></h2><h2 data-tool="mdnice编辑器"><span>B、手动绘制拼图</span></h2><section><span>依然使用ggplot2绘制分布图，使用aplot拼接。绘制时去除坐标轴等无关要素，确认坐标轴框选范围一致。这里仅测试分布直方图geom_histogram：</span></section><pre><code>theme2 &lt;- theme_classic() + <br>          theme(plot.title = element_blank(),<br>                axis.text = element_blank(), <br>                axis.title = element_blank(), <br>                axis.ticks = element_blank(), <br>                axis.line = element_blank(), <br>                plot.background = element_blank(),<br>                panel.grid.major = element_blank(),<br>                panel.grid.minor = element_blank(),<br>                legend.text = element_blank(),<br>                legend.title = element_blank(),<br>                legend.position = <span>"none"</span>,<br>                legend.background = element_blank())<br><span>###top</span><br>p2 &lt;- ggplot(data = iris,aes(x = Petal.Length,fill = Species)) + <br>      geom_histogram(bins = <span>30</span>,color = <span>"black"</span>,alpha = <span>0.75</span>) + <br>      scale_x_continuous(limits = c(<span>1</span>,<span>7</span>)) +<br>      scale_y_continuous(expand = c(<span>0</span>,<span>0.2</span>)) +<br>      scale_fill_manual(values = c(<span>"#4d97cd"</span>,<span>"#459943"</span>,<span>"#c74546"</span>)) +<br>      theme2<br><span>###right</span><br>p3 &lt;- ggplot(data = iris,aes(x = Petal.Width,fill = Species)) + <br>      geom_histogram(bins = <span>30</span>,color = <span>"black"</span>,alpha = <span>0.75</span>) + <br>      scale_x_continuous(limits = c(<span>0</span>,<span>2.5</span>)) +<br>      scale_y_continuous(expand = c(<span>0</span>,<span>0.2</span>)) +<br>      coord_flip() + <br>      scale_fill_manual(values = c(<span>"#4d97cd"</span>,<span>"#459943"</span>,<span>"#c74546"</span>)) +<br>      theme2 <br></code></pre><section><span>使用aplot拼图：</span></section><pre><code><span>library</span>(aplot)<br>p4 &lt;- p1 %&gt;% insert_right(p3, width=<span>.2</span>) %&gt;% insert_top(p2, height=<span>0.2</span>)  <span></span></code></pre></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p><img data-galleryid="" data-ratio="0.762962962962963" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3IIRreicCkbyDvFOFldt1daInibiarFHmI3FMapJE9aFV32MNmJr7S8oCHOW4qTzMFL0k6NmSGficGU3Q/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3IIRreicCkbyDvFOFldt1daInibiarFHmI3FMapJE9aFV32MNmJr7S8oCHOW4qTzMFL0k6NmSGficGU3Q/640?wx_fmt=png"></p></section><section><img data-ratio="0.05278592375366569" data-type="png" data-w="341" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=png"></section><section><strong>请点个“赞”和“在看”鼓励一下吧</strong></section><section data-tools="135编辑器" data-id="116886" draggable="true"><section><section><section><section><strong data-brushtype="text">被炸熟的虾</strong></section></section><section><section><section data-width="35%"><section><img data-cropselx1="0" data-cropselx2="115" data-cropsely1="0" data-cropsely2="115" data-ratio="1" data-type="jpeg" data-w="258" data-width="100%" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=jpeg"></section></section><section data-width="63%"><section><section><strong>自己的摸索，发现问题麻烦告诉作者，光速回来改正</strong></section></section></section></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/GrWFn09vUe8N6p78yTp2fQ",target="_blank" rel="noopener noreferrer">原文链接</a>
