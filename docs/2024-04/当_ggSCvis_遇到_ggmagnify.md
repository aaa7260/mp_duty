---
title: "当 ggSCvis 遇到 ggmagnify"
date: 2024-04-21T05:19:32Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
当 ggSCvis 遇到 ggmagnify by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><h4 data-tool="mdnice编辑器"><section><mp-common-profile data-pluginname="mpprofile" data-id="MzkyMTI1MTYxNA==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezgsqIGqjITSMggCTSoViaYeoKe2xoZr1IIvNJoztibQxibYHLDDoiabwAc6Ggws3Tvdo8EPss2nLgaVQ/0?wx_fmt=png" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><span></span></h4><h2 data-tool="mdnice编辑器"><span><span>1</span></span><span>引言</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span></span><p>使用 <strong>ggmagnify</strong> 在散点图里放大某些细胞进行展示。</p></blockquote><p data-tool="mdnice编辑器"><strong>安装:</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("remotes")</span><br>remotes::install_github(<span>"hughjonesd/ggmagnify"</span>)<br></code></pre><h2 data-tool="mdnice编辑器"><span><span>2</span></span><span>测试</span><span></span></h2><p data-tool="mdnice编辑器">亚群分布:</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(ggSCvis)<br><span>library</span>(grid)<br><span>library</span>(dplyr)<br><span>library</span>(ggmagnify)<br><br>ggscplot(object = pbmc) +<br>  ggSCvis::geom_scPoint(aes(color = seurat_annotations,<br>                   cluster = seurat_annotations),<br>               label.gp = gpar(fontsize = <span>8</span>,fontface = <span>"bold.italic"</span>)) +<br>  theme_bw() +<br>  theme(strip.text = element_text(face = <span>"bold.italic"</span>,size = rel(<span>1.2</span>)),<br>        axis.text = element_blank(),<br>        axis.ticks = element_blank(),<br>        panel.grid = element_blank()) +<br>  facet_wrap(~groups,scales = <span>"free"</span>) +<br>  geom_magnify(aes(from = seurat_annotations == <span>"NK"</span>),<br>               to = c(<span>5</span>, <span>13</span>, <span>9</span>, <span>13</span>),proj.combine = <span>T</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100029189" data-ratio="0.5081967213114754" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDWnSICmuibQHeOc5tzTHsjRfExK9Uwb8YjXP4C8SbmnKEs2GAO9Xicl6cQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1037" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDWnSICmuibQHeOc5tzTHsjRfExK9Uwb8YjXP4C8SbmnKEs2GAO9Xicl6cQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">基因表达:</p><pre data-tool="mdnice编辑器"><span></span><code>genes &lt;- c(<span>"MS4A1"</span>, <span>"GNLY"</span>, <span>"CD3E"</span>, <span>"CD14"</span>)<br><br>ggscplot(object = pbmc,features = genes) +<br>  ggSCvis::geom_scPoint(aes(color = value)) +<br>  theme_bw() +<br>  theme(strip.text = element_text(face = <span>"bold.italic"</span>,size = rel(<span>1.2</span>)),<br>        axis.text = element_blank(),<br>        axis.ticks = element_blank(),<br>        panel.grid = element_blank()) +<br>  scale_color_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  facet_wrap(~gene_name,ncol = <span>4</span>,scales = <span>"fixed"</span>) +<br>  geom_magnify(aes(from = seurat_annotations == <span>"NK"</span>),<br>               to = c(<span>5</span>, <span>13</span>, <span>9</span>, <span>13</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100029191" data-ratio="0.31933381607530775" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDWDeX2GP3j4clItVaOiascpYYZOBfMl4icVMNfcKeXObsasKw1ha9Dqjiaw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1381" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDWDeX2GP3j4clItVaOiascpYYZOBfMl4icVMNfcKeXObsasKw1ha9Dqjiaw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">可以多添加几个图层对每个子图进行不同细胞的放大:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = genes) +<br>  ggSCvis::geom_scPoint(aes(color = value)) +<br>  theme_bw() +<br>  theme(strip.text = element_text(face = <span>"bold.italic"</span>,size = rel(<span>1.2</span>)),<br>        axis.text = element_blank(),<br>        axis.ticks = element_blank(),<br>        panel.grid = element_blank()) +<br>  scale_color_gradient(low = <span>"grey90"</span>,high = <span>"red"</span>) +<br>  facet_wrap(~gene_name,ncol = <span>4</span>,scales = <span>"fixed"</span>) +<br>  geom_magnify(data = . %&gt;% filter(gene_name == <span>"MS4A1"</span>),<br>               aes(from = seurat_annotations == <span>"B"</span>),<br>               to = c(<span>5</span>, <span>13</span>, <span>9</span>, <span>13</span>)) +<br>  geom_magnify(data = . %&gt;% filter(gene_name == <span>"GNLY"</span>),<br>               aes(from = seurat_annotations == <span>"NK"</span>),<br>               to = c(<span>5</span>, <span>13</span>, <span>9</span>, <span>13</span>)) +<br>  geom_magnify(data = . %&gt;% filter(gene_name == <span>"CD3E"</span>),<br>               aes(from = seurat_annotations == <span>"Naive CD4 T"</span>),<br>               to = c(<span>5</span>, <span>13</span>, <span>9</span>, <span>13</span>)) +<br>  geom_magnify(data = . %&gt;% filter(gene_name == <span>"CD14"</span>),<br>               aes(from = seurat_annotations == <span>"CD14+ Mono"</span>),<br>               to = c(<span>5</span>, <span>13</span>, <span>9</span>, <span>13</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100029190" data-ratio="0.31956521739130433" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDWnxAdx4DC3HAIMsKYQOIrQuK7kPlDEYgJJFAyRiaL3NduYQfvfa1rHYg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1380" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDWnxAdx4DC3HAIMsKYQOIrQuK7kPlDEYgJJFAyRiaL3NduYQfvfa1rHYg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">密度放大:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc) +<br>  stat_density2d(geom = <span>"raster"</span>,aes(fill = ..density..),<br>                 contour = <span>F</span>) +<br>  ggSCvis::geom_scPoint(color = <span>"white"</span>,size = <span>0.2</span>) +<br>  facet_wrap(~groups,ncol = <span>3</span>) +<br>  theme_bw() +<br>  theme(strip.text = element_text(face = <span>"bold.italic"</span>,size = rel(<span>1.2</span>)),<br>        panel.grid = element_blank(),<br>        axis.ticks = element_blank(),<br>        axis.text = element_blank()) +<br>  scale_fill_viridis_c(option = <span>"magma"</span>,direction = <span>1</span>) +<br>  coord_cartesian(expand = <span>T</span>) +<br>  geom_magnify(aes(from = seurat_annotations == <span>"NK"</span>),<br>               colour = <span>"white"</span>,<br>               to = c(<span>5</span>, <span>12</span>, <span>9</span>, <span>12</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100029192" data-ratio="0.5180972078593589" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDWNxNicSPIcVLWW3zCibRFJEeYjof3pu95LxyUhVpyOfxOIT2cXp8wQBkw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="967" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDWNxNicSPIcVLWW3zCibRFJEeYjof3pu95LxyUhVpyOfxOIT2cXp8wQBkw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">基因表达密度分布:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = genes) +<br>  stat_density2d(geom = <span>"raster"</span>,aes(fill = ..density..),<br>                 contour = <span>F</span>) +<br>  ggSCvis::geom_scPoint(aes(color = value),size = <span>0.2</span>) +<br>  scale_color_gradient(low = <span>"#996699"</span>,high = <span>"#CCFF66"</span>,name = <span>"gene expression"</span>) +<br>  facet_wrap(~gene_name,ncol = <span>4</span>) +<br>  theme_bw() +<br>  theme(panel.grid = element_blank(),<br>        axis.ticks = element_blank(),<br>        strip.background = element_blank(),<br>        strip.text = element_text(face = <span>"bold.italic"</span>,size = rel(<span>1</span>)),<br>        axis.text = element_blank()) +<br>  scale_fill_viridis_c(option = <span>"rocket"</span>,direction = <span>1</span>,name = <span>"cell density"</span>) +<br>  coord_cartesian(expand = <span>F</span>) +<br>  geom_magnify(aes(from = seurat_annotations == <span>"NK"</span>),<br>               colour = <span>"white"</span>,<br>               to = c(<span>5</span>, <span>12</span>, <span>9</span>, <span>12</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100029193" data-ratio="0.29315263908701855" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDWqqwvWj71ticAic8kDZGic3CFwsY9CsKzz3qUI3zqfy83kqPuc8QT9S5KQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1402" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDWqqwvWj71ticAic8kDZGic3CFwsY9CsKzz3qUI3zqfy83kqPuc8QT9S5KQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">不同细胞的展示:</p><pre data-tool="mdnice编辑器"><span></span><code>ggscplot(object = pbmc,features = genes) +<br>  stat_density2d(geom = <span>"raster"</span>,aes(fill = ..density..),<br>                 contour = <span>F</span>) +<br>  ggSCvis::geom_scPoint(aes(color = value),size = <span>0.2</span>) +<br>  scale_color_gradient(low = <span>"#996699"</span>,high = <span>"#CCFF66"</span>,name = <span>"gene expression"</span>) +<br>  facet_wrap(~gene_name,ncol = <span>4</span>) +<br>  theme_bw() +<br>  theme(panel.grid = element_blank(),<br>        axis.ticks = element_blank(),<br>        strip.background = element_blank(),<br>        strip.text = element_text(face = <span>"bold.italic"</span>,size = rel(<span>1</span>)),<br>        axis.text = element_blank()) +<br>  scale_fill_viridis_c(option = <span>"rocket"</span>,direction = <span>1</span>,name = <span>"cell density"</span>) +<br>  coord_cartesian(expand = <span>F</span>) +<br>  geom_magnify(data = . %&gt;% filter(gene_name == <span>"MS4A1"</span>),<br>               aes(from = seurat_annotations == <span>"B"</span>),<br>               colour = <span>"white"</span>,<br>               to = c(<span>5</span>, <span>12</span>, <span>9</span>, <span>12</span>)) +<br>  geom_magnify(data = . %&gt;% filter(gene_name == <span>"GNLY"</span>),<br>               aes(from = seurat_annotations == <span>"NK"</span>),<br>               colour = <span>"white"</span>,<br>               to = c(<span>5</span>, <span>12</span>, <span>9</span>, <span>12</span>)) +<br>  geom_magnify(data = . %&gt;% filter(gene_name == <span>"CD3E"</span>),<br>               aes(from = seurat_annotations == <span>"Naive CD4 T"</span>),<br>               colour = <span>"white"</span>,<br>               to = c(<span>5</span>, <span>12</span>, <span>9</span>, <span>12</span>)) +<br>  geom_magnify(data = . %&gt;% filter(gene_name == <span>"CD14"</span>),<br>               aes(from = seurat_annotations == <span>"CD14+ Mono"</span>),<br>               colour = <span>"white"</span>,<br>               to = c(<span>5</span>, <span>12</span>, <span>9</span>, <span>12</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100029198" data-ratio="0.3704775687409551" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDW2GTib2QkZZxo3WMZ8t5xUr4tiaAvxsrwX0jY8pdM1JfpORZ8a7LSwoCw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1382" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDW2GTib2QkZZxo3WMZ8t5xUr4tiaAvxsrwX0jY8pdM1JfpORZ8a7LSwoCw/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span><span>3</span></span><span>结尾</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span></span><p><strong>路漫漫其修远兮,吾将上下而求索。</strong></p></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">欢迎加入生信交流群。加我微信我也拉你进 <strong>微信群聊</strong> <strong>老俊俊生信交流群</strong> <strong>(微信交流群需收取 20 元入群费用,一旦交费,拒不退还!(防止骗子和便于管理))</strong> 。QQ 群可免费加入, 记得进群按格式修改备注哦。</p><section data-tool="mdnice编辑器"><section><p><strong>老俊俊微信：</strong></p><figure><img data-imgfileid="100029195" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDW6wibaX5mdh2rGkB0BTmQm7vSibQVJDAhcwnxNQaM4m0uwyJJlDHib9BCA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="430" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDW6wibaX5mdh2rGkB0BTmQm7vSibQVJDAhcwnxNQaM4m0uwyJJlDHib9BCA/640?wx_fmt=png&amp;from=appmsg"></figure><figure><img data-imgfileid="100029196" data-ratio="1.3668430335097002" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDWAicw2XfQdv6hA6RibEesnIJNqicLjaXOoSOMAzHDBpQia5QImH2QVc7ysw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="567" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDWAicw2XfQdv6hA6RibEesnIJNqicLjaXOoSOMAzHDBpQia5QImH2QVc7ysw/640?wx_fmt=png&amp;from=appmsg"></figure></section><section><p><strong>知识星球：</strong></p><figure><img data-imgfileid="100029197" data-ratio="1.5896226415094339" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDW2XyKB2tbibkNWpVHQgKYz2MZyqOk5wFbEQvly3Wicqdk7eTNq9CiaibegQ/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1060" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4usezJ5Nhc3ewJ3wYnv8ueQtDW2XyKB2tbibkNWpVHQgKYz2MZyqOk5wFbEQvly3Wicqdk7eTNq9CiaibegQ/640?wx_fmt=jpeg&amp;from=appmsg"></figure></section></section><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><strong></strong></p><center data-tool="mdnice编辑器"><strong> 往期回顾目录</strong></center><blockquote data-tool="mdnice编辑器"><span></span><p><strong></strong></p><center><strong><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247512812&amp;idx=1&amp;sn=c90eeab4ddc6aeaae7986ca163eba10e&amp;chksm=c184889df6f3018bc89c07de8b7aea1a22b7b284320dbf4280cd60ce5b4fad1a65486116ec62&amp;token=555204851&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">在模仿中精进数据可视化_使用ggcirclize绘制circos圈图</a></strong></center><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247512783&amp;idx=1&amp;sn=2535eaafd12934a3067e88f00f17d59a&amp;chksm=c18488bef6f301a8fcd1efa4dbe75d2c0d794cdedde2151528d3841e61e902d9c3ebbc2915c4&amp;token=1338300207&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">单细胞二维密度图一文拿捏!</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247512748&amp;idx=1&amp;sn=6678a6672774f1a629701ea74db526fa&amp;chksm=c18488ddf6f301cb2522153dfab8b690bd26ea46e7db2fc03dcf923daef3f594b0442dadd9a6&amp;token=1867459500&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">coord_polar2 补充极坐标图形短板</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247512715&amp;idx=1&amp;sn=e599a44ed4013bf5512dc5f926833495&amp;chksm=c18488faf6f301ecdcd5dd4b5324fb6b86a560ce381102c45111e7ac9498ff10648127086b19&amp;token=2102927728&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ggplot 绘制热图标注特定名称</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247512646&amp;idx=1&amp;sn=d9241b243771dcb355c74fd1a7f9431c&amp;chksm=c1848837f6f301216f9d4c06659f01814b54994b552b5f15d9df9c5b227f417288a7cd4061e6&amp;token=2102927728&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">听说你只有富集表格还想画 GSEA 图?</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247512269&amp;idx=1&amp;sn=0208555abacffaed2e8a8437c8b43214&amp;chksm=c1848abcf6f303aa83091c6c517b054ba4f7da2edc8de0fb86a2878064a91375a67cee89fd3b&amp;token=864433526&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ggSCvis 可视化 dot/heatmap/violin plot 示例</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247512189&amp;idx=1&amp;sn=1cc5cb6167f9d3960922dd691aa376db&amp;chksm=c1848a0cf6f3031a4b9b1ab4195d525269703553f84ef29ea312878c60accfec07ca3a3102d6&amp;token=864433526&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">给你的亚群添加编号</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247512093&amp;idx=1&amp;sn=b44680cfccfa7c0bb0a59eef29b944fc&amp;chksm=c1848a6cf6f3037ad9e74e898575125b0cbd0d372c25805315559e5e41c9168c6e8612418896&amp;token=1185565850&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ggSCvis 让你的单细胞可视化 gg 起来</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247511755&amp;idx=1&amp;sn=b5758249eef3fdf4946aae0f4e7ef592&amp;chksm=c18494baf6f31dacdbf6e4a1ba0a05817b087a9bc1ad2a6b8b79959903ce5b96156e4e1a2faf&amp;token=1185565850&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">easylift 基因组坐标轻松转换</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247511683&amp;idx=1&amp;sn=289992da1c3a551a4e5b8236fe830e94&amp;chksm=c18494f2f6f31de444ff98d314f7bfea97ade3573babe625200dd89b1cf86ccb47f287548e61&amp;token=1910483679&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">CCPlotR: 细胞通讯可视化包</a></center></strong></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/5L4dxlRbTgjZC_zwl3wReQ",target="_blank" rel="noopener noreferrer">原文链接</a>
