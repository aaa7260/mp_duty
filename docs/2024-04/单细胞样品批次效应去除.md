---
title: "单细胞样品批次效应去除"
date: 2024-04-04T12:31:56Z
draft: ["false"]
tags: [
  "fetched",
  "生信漫漫学"
]
categories: ["Acdemic"]
---
单细胞样品批次效应去除 by 生信漫漫学
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span>写在开头</span><span></span></h3><p data-tool="mdnice编辑器">嘿嘿想必大家清明假都回家祭祖或者出去玩了叭，虽然原则上<strong>老板明令禁止了公休日以及周六日不让进办公室，要劳逸结合</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100003226" data-ratio="0.7970557308096741" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9bgmTl3BnnhLOfkf6Y1cyAKH3rhwPpel1QJAyvKRWteLcn8WiaVUwxgCLNcYt7AMvDECsEiaJGjyblA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="951" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9bgmTl3BnnhLOfkf6Y1cyAKH3rhwPpel1QJAyvKRWteLcn8WiaVUwxgCLNcYt7AMvDECsEiaJGjyblA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">但耐不住距离办公室一百米不到的小谢想偷偷卷大家呀（<strong>开玩笑的，家里无线没办好，搁办公室蹭网捏</strong>）</p><p data-tool="mdnice编辑器">照常理该整理《复盘》的书籍内容，不过昨天直播分享结束感觉有些<strong>单细胞分析的概念内容</strong>需要整理一下啦，所以就又蹭上了老板开会带回来的书，偷偷学习hhh。但<strong>只要我整理分享出来就是大家一起学习了，可不能算偷偷学！</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100003227" data-ratio="0.8962962962962963" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/icQem1PXnP9bgmTl3BnnhLOfkf6Y1cyAKBU8AiaPdVEjL7Gibh0XIGopfFicsMQXEiaQpiamLsN0j3xv58cDk9icXVwibA/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/icQem1PXnP9bgmTl3BnnhLOfkf6Y1cyAKBU8AiaPdVEjL7Gibh0XIGopfFicsMQXEiaQpiamLsN0j3xv58cDk9icXVwibA/640?wx_fmt=jpeg&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">言归正传，首先来给大家分享一下<strong>单细胞样品的批次效应去除</strong><span></span></p><p data-tool="mdnice编辑器"><strong></strong></p><blockquote data-tool="mdnice编辑器"><span></span><p>内容来源联川生物《单细胞测序研究一本通 3.0》</p></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><br></span><span></span><span>单细胞样品批次效应来源</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span></span><p>单细胞数据是由多个实验环节产生，在样本时间批次、处理人员、实验批次，甚至技术平台（捕获效率差异）等方面均会存在差异。这些差异会导致数据产生<strong>批次效应（batch effect）</strong>，并且可能在数据分析过程中混淆我们感兴趣的生物变化。</p></blockquote><p><img data-galleryid="" data-imgfileid="100003233" data-ratio="1.3333333333333333" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/icQem1PXnP9bgmTl3BnnhLOfkf6Y1cyAK2gjCffqF81x2dYq8k3OsCaOHibzvTSMx6J1bYsQicWEGicsK0xibdcZicbw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/icQem1PXnP9bgmTl3BnnhLOfkf6Y1cyAK2gjCffqF81x2dYq8k3OsCaOHibzvTSMx6J1bYsQicWEGicsK0xibdcZicbw/640?wx_fmt=jpeg&amp;from=appmsg"></p><p data-tool="mdnice编辑器"><strong>批次效应来源：</strong></p><ol data-tool="mdnice编辑器"><li><section><strong>宏观（外在）因素：</strong></section></li></ol><ul data-tool="mdnice编辑器"><li><section>取样时间差异</section></li><li><section>平台系统误差</section></li><li><section>人员主观偏差</section></li><li><section>实验环境和实验方法不一致等问题</section></li></ul><ol start="2" data-tool="mdnice编辑器"><li><section><strong>微观（内部）因素：</strong></section></li></ol><ul data-tool="mdnice编辑器"><li><section>解离的细胞组分不一致</section></li><li><section>样品间mRNA不稳定</section></li><li><section>细胞破裂mRNA流出污染整个体系</section></li><li><section>样品间细胞或者mRNA捕获率不一致</section></li><li><section>测序饱和度不一致</section></li><li><section>数据质量不均一</section></li></ul><h3 data-tool="mdnice编辑器"><span></span><span>批次效应去除与否区别</span><span></span></h3><p data-tool="mdnice编辑器"><strong>一般而言，去除批次效应前不同样品之间的细胞聚类是离散的；去除后，样品之间的细胞能够很好的聚集在一起，从而消除了样本之间的批次误差。</strong></p><p data-tool="mdnice编辑器">之前整理过<a href="https://mp.weixin.qq.com/s?__biz=MzkxOTI0Mjc3Mw==&amp;mid=2247486568&amp;idx=1&amp;sn=1dc92cbaeaf5e318e90475d90a14d735&amp;scene=21#wechat_redirect" data-linktype="2">Harmony整合与否区别</a></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100003228" data-ratio="0.7287037037037037" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9bgmTl3BnnhLOfkf6Y1cyAKR9mg7e28iceeJcCkk3WTJ6VGOvCiaibcV2r2h7LeIBNPtobHzqjD04XGg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9bgmTl3BnnhLOfkf6Y1cyAKR9mg7e28iceeJcCkk3WTJ6VGOvCiaibcV2r2h7LeIBNPtobHzqjD04XGg/640?wx_fmt=png&amp;from=appmsg"></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100003229" data-ratio="1.225" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9bgmTl3BnnhLOfkf6Y1cyAKICicQ8S4hsCeVnAzaia24kJOXtreuqCfXg0lYnUsngZPn4QuC7OjhTuA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9bgmTl3BnnhLOfkf6Y1cyAKICicQ8S4hsCeVnAzaia24kJOXtreuqCfXg0lYnUsngZPn4QuC7OjhTuA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">可以根据实际数据情况以及分析需求确定是否要去除批次效应（一般简单粗暴的话就是运行Harmony去除掉批次效应）</p><h3 data-tool="mdnice编辑器"><span></span><span>批次效应去除方法</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span></span><p>批次处理效应可能是高度非线性的，需要在<strong>保留关键生物变异的同时正确地对齐不同的数据集</strong>。</p></blockquote><h4 data-tool="mdnice编辑器"><span></span><span>源头避免批次效应</span><span></span></h4><p data-tool="mdnice编辑器"><strong>从单细胞测序样品收集以及实验方面避免批次效应</strong></p><blockquote data-tool="mdnice编辑器"><span></span><p>在实验环节的一致性，包括取样时间一致性、实验条件一致性等，尽可能避免由于时间批次、实验环境造成的误差。</p></blockquote><ol data-tool="mdnice编辑器"><li><section><p>保证实验环境、实验方法一致</p></section></li><li><section><p>一次性收集所有样品，在相同条件下同时开展单细胞实验（新鲜样本集中收集）</p></section></li><li><section><p>采用速冻法固定样本，并冷冻保存，收集完所有样本之后，用提核法一次开展实验（适用于收样时间跨度久）</p></section></li><li><section><p>使用混样方式一次性完成实验来减少批次效应（不设置生物学重复）</p></section></li></ol><h4 data-tool="mdnice编辑器"><span></span><span>分析上去除批次效应</span><span></span></h4><p data-tool="mdnice编辑器">如果没办法满足实验环节的一致性操作，测序得到的单细胞数据就需要在分析上通过一些软件或者算法来实现批次效应的去除。</p><p data-tool="mdnice编辑器"><strong>目前常用的去除批次效应的算法有Harmony、Seurat、fastMNN以及mnnCorrec</strong>等</p><ul data-tool="mdnice编辑器"><li><section><code>Harmony</code>:使用迭代聚类的方法，找到一个细胞特异性线性校正函数</section></li></ul><p data-tool="mdnice编辑器"><strong>将不同批次的数据整合，使用PCA降维后进入迭代过程。</strong></p><p data-tool="mdnice编辑器">迭代过程：</p><ol data-tool="mdnice编辑器"><li><section><p>使用k-means软聚类方法进行聚类，将每个细胞分给多个潜在的类别</p></section></li><li><section><p>计算出每个类别中的质心和每个类别中每个批次的质心</p></section></li><li><section><p>根据质心计算处细胞特异性的线性校正因子</p></section></li><li><section><p>最后每个细胞可以根据每个类别的加权平均得到一个线性校正因子，因为每个细胞属于多个类别，所以每个细胞都有不同的校正因子</p></section></li></ol><ul data-tool="mdnice编辑器"><li><section><code>Seurat</code>：使用典型相关分析（CCA）进行降维，然后在标准化CCA空间寻找最小互近邻</section></li></ul><p data-tool="mdnice编辑器">为了避免非相似性细胞间异常锚的产生，会使用SNN来评估细胞类型的相似性。与MNN类似，使用细胞间的差异表达计算校正因子</p><ul data-tool="mdnice编辑器"><li><section><p><code>fastMNN</code>:在PCA空间上寻找最小互近邻，然后再进行校正</p></section></li><li><section><p><code>mnnCorrect</code>:通过寻找批次间的最小互近邻（MNN），即批次间相似类型的细胞在批次间共有的邻居，再根据这些细胞对计算批次效应，用于后续校正</p></section></li></ul><p data-tool="mdnice编辑器">mnnCorrect使用余弦归一化来标准化数据，然后计算MNN细胞对之间的欧氏距离，最后将计算出的批次效应向量应用于所有细胞。要求所有批次之间至少共享一种细胞类型，并且其假定存在的批次效应较小且与生物变异正交。</p><ul data-tool="mdnice编辑器"><li><section><code>DESC</code>：一种无监督的深度嵌入算法，通过迭代优化聚类目标函数对单细胞RNA测序的数据进行聚类，并且能够消除批次效应。</section></li></ul><p data-tool="mdnice编辑器">DESC可以再群集精度和稳定性之间取得适当的平衡，并且内存占用空间很小，不需要批次信息就可以消除批次效应</p><p><img data-galleryid="" data-imgfileid="100003234" data-ratio="1.3333333333333333" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/icQem1PXnP9bgmTl3BnnhLOfkf6Y1cyAKYUDCFFzMoZb5ria7E0YVv4V9cnqZ4aznibulicE5CvtMBrR5E2Z6jKFhg/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/icQem1PXnP9bgmTl3BnnhLOfkf6Y1cyAKYUDCFFzMoZb5ria7E0YVv4V9cnqZ4aznibulicE5CvtMBrR5E2Z6jKFhg/640?wx_fmt=jpeg&amp;from=appmsg"></p><h4 data-tool="mdnice编辑器"><span></span><span>不同方法比较</span><span></span></h4><p data-tool="mdnice编辑器">综合不同情景发现Harmony以及seurat是较好的批量混合去除批次效应的方法。</p><p data-tool="mdnice编辑器"><strong>Harmony</strong>在使用相同细胞类型和不同技术的数据集上表现良好，并且运行时间相对较短，也适用于大数据集的初始数据探索。</p><p data-tool="mdnice编辑器"><strong>seurat也能够处理大数据集</strong>，但是运行时间较长，由于它与多个批次的批次混合效果良好，因此也适用于多个批次的场景。</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/1R_y9c1J_ePZUhqYoeWJ_w",target="_blank" rel="noopener noreferrer">原文链接</a>
