---
title: "基于Seurat的TransferData函数自动化迁移单细胞转录组亚群的注释信息"
date: 2024-04-07T10:21:27Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
基于Seurat的TransferData函数自动化迁移单细胞转录组亚群的注释信息 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>前面我们推荐了方法学：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247529445&amp;idx=1&amp;sn=623e8dd62ca3ad3518d2df4db0eacc1f&amp;scene=21#wechat_redirect" data-linktype="2">使用singleR基于自建数据库来自动化注释单细胞转录组亚群</a>，广受好评，然后马上就有小伙伴留言说这个功能跟Seurat的TransferData函数类似，我就马不停蹄的尝试了一下：</p></blockquote><h3 data-tool="mdnice编辑器"><span></span><span>同样的数据集</span><span></span></h3><p data-tool="mdnice编辑器">这个GSE206528的单细胞转录组数据集，很容易构建成为Seurat对象。仍然是走常规的单细胞转录组降维聚类分群代码，可以看 链接: https://pan.baidu.com/s/1bIBG9RciAzDhkTKKA7hEfQ?pwd=y4eh ，基本上大家只需要读入表达量矩阵文件到r里面就可以使用Seurat包做全部的流程。批量读取它的9个文件的代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>dir=<span>'GSE206528_RAW/'</span><br>samples=list.files( dir )<br>samples <br>sceList = lapply(samples,<span>function</span>(pro){ <br>  <span># pro=samples[1] </span><br>  print(pro)   <br>  ct=fread( file.path(dir,pro ) ,data.table = <span>F</span>)<br>  ct[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>  rownames(ct)=ct[,<span>1</span>]<br>  ct=ct[,-<span>1</span>] <br>  sce =CreateSeuratObject(counts =  ct ,<br>                          project =  pro  ,<br>                          min.cells = <span>5</span>,<br>                          min.features = <span>300</span> )<br>  <span>return</span>(sce)<br>}) <br>do.call(rbind,lapply(sceList, dim))<br>sce.all=merge(x=sceList[[<span>1</span>]],<br>              y=sceList[ -<span>1</span> ],<br>              add.cell.ids = samples  ) <br>names(sce.all@assays$RNA@layers)<br>sce.all[[<span>"RNA"</span>]]$counts <br><span># Alternate accessor function with the same result</span><br>LayerData(sce.all, assay = <span>"RNA"</span>, layer = <span>"counts"</span>)<br>sce.all &lt;- JoinLayers(sce.all)<br>dim(sce.all[[<span>"RNA"</span>]]$counts )<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>使用TransferData函数</span><span></span></h3><p data-tool="mdnice编辑器">在前面的方法学：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247529445&amp;idx=1&amp;sn=623e8dd62ca3ad3518d2df4db0eacc1f&amp;scene=21#wechat_redirect" data-linktype="2">使用singleR基于自建数据库来自动化注释单细胞转录组亚群</a>，我们拿到了 sce.singleR.Rdata 文件里面是一个已经降维聚类分群并且注释好的Seurat对象。<strong>这个文件会很小，因为细胞数量确实是不多，但是已经是有  fibro 和endo以及周细胞和SMC 信息，以及部分免疫细胞亚群信息。</strong></p><p data-tool="mdnice编辑器">核心流程就是 FindTransferAnchors 和 TransferData 函数，即可把两个Seurat对象关联起来，其中一个Seurat里面是有单细胞亚群注释信息，就可以迁移到另外一个对象里面，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code> <br>load(file = <span>'singleR/sce.singleR.Rdata'</span>)<br>sce.singleR<br>table(sce.singleR$paper)<br>sce.ref = sce.singleR <br><br><span>source</span>(<span>'scRNA_scripts/lib.R'</span>)<br>sce.all.int = readRDS(<span>'2-harmony/sce.all_int.rds'</span>)<br>sce.query = sce.all.int<br> <br>sce.anchors &lt;- FindTransferAnchors(reference = sce.ref, <br>                                        query = sce.query, dims = <span>1</span>:<span>30</span>,<br>                                        reference.reduction = <span>"pca"</span>)<br>predictions &lt;- TransferData(anchorset = sce.anchors, <br>                            refdata = sce.ref$paper, dims = <span>1</span>:<span>30</span>)<br>sce.query &lt;- AddMetaData(sce.query, metadata = predictions)<br>table(sce.query$predicted.id )<br>DimPlot(sce.query,group.by = <span>'predicted.id'</span>,label = <span>T</span>,repel = <span>F</span>)<br>load(<span>'phe.Rdata'</span>)<br>gplots::balloonplot(table(sce.query$predicted.id,phe$celltype ))<br></code></pre><p data-tool="mdnice编辑器">可以看到的是，从效果的角度来说，跟前面我们推荐了方法学：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247529445&amp;idx=1&amp;sn=623e8dd62ca3ad3518d2df4db0eacc1f&amp;scene=21#wechat_redirect" data-linktype="2">使用singleR基于自建数据库来自动化注释单细胞转录组亚群</a>，对比，<span><strong>不知道为什么Seurat的TransferData函数没办法区分SMC和周细胞，其实在UMAP图是还是可以看到清晰可见的界限。</strong></span>前面的singleR就没有遇到这个问题：</p><p><img data-galleryid="" data-imgfileid="100045801" data-ratio="0.7064814814814815" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRiay52LY7ewgShnr1zibNp5zQRIU9d7EbTn3yScJQhoTtGYqSicCEnUticteY9PL8BicF2dywPlu7dTQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRiay52LY7ewgShnr1zibNp5zQRIU9d7EbTn3yScJQhoTtGYqSicCEnUticteY9PL8BicF2dywPlu7dTQ/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>Seurat的TransferData函数没办法区分SMC和周细胞</figcaption></figure></section><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247529099&amp;idx=1&amp;sn=fe3be2d43a6284a36c15625c23dc9a3e&amp;chksm=9b4b3230ac3cbb26b875bd0a294f24dfbd41a2b59996fbfe79087330d267c4ec70882683c3bd&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松‍授课（买一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section><ul data-tool="mdnice编辑器"><li><section> <a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;chksm=9b4b2f10ac3ca606c1c4bac8cf112bb9b0f18e3c4262f5f2b8c0dba3bfedf2ba201507247005&amp;scene=21#wechat_redirect" textvalue="2024的共享服务器交个朋友福利价仍然是800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">2024的共享服务器交个朋友福利价仍然是800</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">千呼万唤始出来的独享生物信息学云服务器</a></section></li></ul><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/-7_diRobmtQd6eysPu9Z9Q",target="_blank" rel="noopener noreferrer">原文链接</a>
