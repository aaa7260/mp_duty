---
title: "DoRothEA|CollecTRI—转录因子活性评分"
date: 2024-04-18T01:23:49Z
draft: ["false"]
tags: [
  "fetched",
  "生信小博士"
]
categories: ["Acdemic"]
---
DoRothEA|CollecTRI—转录因子活性评分 by 生信小博士
------
<div><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg2NDcxMzYwNg==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sks7JhVxUX46ZKxPSob6ptqIZgnIEnHOn5VMwCX8sN6MQy1Pq4XXFEOJ6grAmsoQugyCDKOZictDBHA/0?wx_fmt=png" data-nickname="生信小博士" data-alias="bioinformatics_Dr" data-signature="【生物信息学】R语言开始，学习生信。Seurat，单细胞测序，空间转录组。 Python，scanpy，cell2location。资料分享" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h3 data-tool="mdnice编辑器"><span><strong><span>写在开头</span></strong></span></h3><p><span>jimmy老师在他的生信游民系列提出了很多学徒任务，仔细去看每一篇文章的动机，都是科研过程中经常会经历的。</span></p><p><span>今天我们分享的任务是来自：</span><strong><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526714&amp;idx=1&amp;sn=aba39bc658288a9f607b13bfdf0a0346&amp;chksm=9b4b2981ac3ca097398092480e463c9f7ea87f72635d3bcb50e6f02af8cb2488b8a45acccaa3&amp;scene=21#wechat_redirect" textvalue="生物学功能注释三板斧" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物学功能注释三板斧</a></span></strong><span>。 本次任务我计划分为四个部分来写，今天写第四部分。</span><span></span></p><ul><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247486732&amp;idx=1&amp;sn=e7fdb946204fbcd19764c189019979eb&amp;chksm=ce6463e5f913eaf38f3a14e90f33b3aa4f417ac0cd7520ff495a5f37f80538f5dab7f5e4de74&amp;scene=21#wechat_redirect" textvalue="1.DoRothEA--单细胞转录因子评分" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>1.DoRothEA--单细胞转录因子评分</span></a><span></span></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247486720&amp;idx=1&amp;sn=448a51fb82b5262aa0a6c57268afe67e&amp;chksm=ce6463e9f913eaffe7082a2f1b44e4e85e78f66969982d7352f9b9e6ae39a0ccea54f9c3f39d&amp;scene=21#wechat_redirect" textvalue="2.PROGENy--单细胞通路活性评分" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>2.PROGENy--单细胞通路活性评分</span></a><span></span></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247486777&amp;idx=1&amp;sn=85888ea3e5c0fca9f7ec6cf12ca3e3da&amp;chksm=ce6463d0f913eac6a0e91b3510f71c92509ac6ec36feca6ad1ee1e9e818d2836f03d3b06881d&amp;scene=21#wechat_redirect" textvalue="3.PROGENy--转录组通路活性评分" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>3.PROGENy--转录组通路活性评分</span></a><span></span></p></li><li><p><span>4.<span>DoRothEA--转录组转录因子评分</span></span></p><hr><p><br></p></li></ul><p><br></p><p><span>正文部分</span><br></p><p>通常我们都是利用基因集合去做单细胞评分，那么是否可以通过<strong>有权重的基因集</strong>来计算细胞的转录活性？<span>这就是DoRothEA开发出来的意义。</span></p><h2 data-tool="mdnice编辑器"><span>CollecTRI数据集简介</span></h2><pre data-tool="mdnice编辑器"></pre><p><img data-imgfileid="100003143" data-ratio="0.75" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yTMPy6ic6MjbrbibvEskyAs80tGj9b5OFHXfFRQLic8I5mibgcgXHSdqiajuA/640?wx_fmt=other&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Skt4y6dB68KVcrmGWpkkA5yTMPy6ic6MjbrbibvEskyAs80tGj9b5OFHXfFRQLic8I5mibgcgXHSdqiajuA/640?wx_fmt=other&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><section><strong><span><span>DoRothEA是一种包含转录因子（TF）与其靶标相互作用的基因集合。这些相互作用形成了被定义为调节子（regulons）的TF及其对应靶点的集合。</span></span></strong></section><section><strong><span>CollecTRI 来源的调控子总结了从 12 种不同 转录因子（TF）-目标基因相互作用的数据库。该集合扩大了转录因子的覆盖范围，并与其他已知的 GRN 进行了比较。结果表明，在使用 knockTF 数据集根据基因表达数据识别受干扰的 TF 方面，该集合具有卓越的性能。</span></strong></section><section><strong><span>简单来说，CollecTRI 是第二代DoRothEA，对DoRothEA做了更新。</span></strong></section><section><strong><span><br></span></strong></section><p><span>加载所需数据</span></p><pre data-tool="mdnice编辑器"></pre><section><strong>本教程中，我就使用示例数据了。如果你使用自己的数据，把数据的格式调整为一样即可！</strong></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="kotlin"><code><span><br></span></code><code><span>inputs_dir &lt;- system.file(<span>"extdata"</span>, <span>package</span> = <span>"decoupleR"</span>)</span></code><code><span><span>data</span> &lt;- readRDS(file.path(inputs_dir, <span>"bk_data.rds"</span>));head(<span>data</span>())</span></code><code><span><br></span></code><code><span><br></span></code><code><span># Remove NAs and <span>set</span> row names</span></code><code><span>counts &lt;- <span>data</span>$counts %&gt;%</span></code><code><span>  dplyr::mutate_if(~ any(<span>is</span>.na(.x)), ~ if_else(<span>is</span>.na(.x),<span>0</span>,.x)) %&gt;% </span></code><code><span>  column_to_rownames(<span>var</span> = <span>"gene"</span>) %&gt;% </span></code><code><span>  <span>as</span>.matrix()</span></code><code><span>head(counts);dim(counts)</span></code><code><span><br></span></code><code><span>design &lt;- <span>data</span>$design</span></code><code><span>design</span></code><code><span><br></span></code></pre></section><p><strong>后续计算评分所需要的表达矩阵，行为基因名，列为样本名称</strong></p><p><img data-galleryid="" data-imgfileid="100003106" data-ratio="0.18018018018018017" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzOuagZjxUT9jOwIekTXpSs5wDg9sJWxL9kAasxqjc2ugUTwHLgsQibGqg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="999" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzOuagZjxUT9jOwIekTXpSs5wDg9sJWxL9kAasxqjc2ugUTwHLgsQibGqg/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100003107" data-ratio="0.5604395604395604" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzOrYASC94fIKdLjxoPib3gtcHzr6g2GdicRg7t373nrPodv0Mfmdmvu98Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="364" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktKM3MYfhrYFMPtYSTHBkzOrYASC94fIKdLjxoPib3gtcHzr6g2GdicRg7t373nrPodv0Mfmdmvu98Q/640?wx_fmt=png&amp;from=appmsg"><span></span></p><h2 data-tool="mdnice编辑器"><span>加载权重基因集</span></h2><section><ul><li><li><li><li></ul><pre data-lang="xml"><code><span><br></span></code><code><span>net <span>&lt;<span>-</span> <span>get_collectri</span>(<span>organism</span>=<span>'human'</span>, <span>split_complexes</span>=<span>FALSE)</span></span></span></code><code><span><span>net</span></span></code><code><span>#如果你是小鼠数据，改为<span>mouse</span>即可，参考之前的推文</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100003118" data-ratio="0.4649859943977591" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXKhlyFQckPIiavtVqNtDqUyVeVFuosLcrNc7Gq9FXEtXLeakrrsSdJWgQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="714" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXKhlyFQckPIiavtVqNtDqUyVeVFuosLcrNc7Gq9FXEtXLeakrrsSdJWgQ/640?wx_fmt=png&amp;from=appmsg"></p><section><strong><span>如果你是小鼠数据，改为mouse即可，参考之前的推文：</span></strong><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247486720&amp;idx=1&amp;sn=448a51fb82b5262aa0a6c57268afe67e&amp;chksm=ce6463e9f913eaffe7082a2f1b44e4e85e78f66969982d7352f9b9e6ae39a0ccea54f9c3f39d&amp;scene=21#wechat_redirect" textvalue="DoRothEA--单细胞转录因子评分" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">DoRothEA--单细胞转录因子评分</a></span><br></section><h2 data-tool="mdnice编辑器"><span>通路活性推断</span></h2><p><strong>为了推断通路活性，这里将运行加权平均法（wmean）。它通过首先将每个转录因子的下游分子乘以其相关的权重来推断该转录因子的通路活动，然后将它们求和得到一个富集分数 wmean。此外，可以对随机目标特征进行排列组合，以获得一个用于计算 z 分数 norm_wmean 的概率分布，或者通过将 wmean 乘以所得经验性 p 值的负对数来得到一个校正估计 corr_wmean。</strong></p><p><strong>在这个例子中，我们这里使用了 wmean，但我们也可以使用其他任何方法。要查看可用的方法，可以使用 show_methods()。</strong></p><p><span><strong>代码非常简单：</strong></span></p><section><ul><li><li><li><li><li></ul><pre data-lang="xml"><code><span># Run wmean</span></code><code><span>sample_acts <span>&lt;<span>-</span> <span>run_wmean</span>(<span>mat</span>=<span>counts,</span> <span>net</span>=<span>net,</span> <span>.source</span>=<span>'source'</span>, <span>.target</span>=<span>'target'</span>,</span></span></code><code><span>                         <span>.mor</span>=<span>'mor'</span>, <span>times</span> = <span>100,</span> <span>minsize</span> = <span>5)</span></span></code><code><span><span>sample_acts</span></span></code><code><span><br></span></code></pre></section><p><strong>这样我们就得到了每个样本的通路活性，这里的通路活性是以长数据的形式提供的。</strong><strong></strong></p><p><img data-galleryid="" data-imgfileid="100003119" data-ratio="0.4176334106728538" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXK8yfqo1JwdRdXEXlYSUewiarYj5cxnuicuEpibHp6wPpZylsgkiaFzaI6iaQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="862" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXK8yfqo1JwdRdXEXlYSUewiarYj5cxnuicuEpibHp6wPpZylsgkiaFzaI6iaQ/640?wx_fmt=png&amp;from=appmsg"></p><p><strong>而我们之前分享的内容得到的通路<strong>都是</strong>矩阵的形式：</strong></p><ol><li><p><strong><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247486720&amp;idx=1&amp;sn=448a51fb82b5262aa0a6c57268afe67e&amp;chksm=ce6463e9f913eaffe7082a2f1b44e4e85e78f66969982d7352f9b9e6ae39a0ccea54f9c3f39d&amp;scene=21#wechat_redirect" textvalue="DoRothEA--单细胞转录因子评分" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">DoRothEA--单细胞转录因子评分</a></strong></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247486732&amp;idx=1&amp;sn=e7fdb946204fbcd19764c189019979eb&amp;chksm=ce6463e5f913eaf38f3a14e90f33b3aa4f417ac0cd7520ff495a5f37f80538f5dab7f5e4de74&amp;scene=21#wechat_redirect" textvalue="PROGENy--单细胞通路活性评分" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">PROGENy--单细胞通路活性评分</a></p><p><br></p></li></ol><p><span><strong><em>如果你你想把长数据改为我们常见的宽数据格式，也就是通路矩阵，这里直接给出代码：</em></strong></span><span></span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247486732&amp;idx=1&amp;sn=e7fdb946204fbcd19764c189019979eb&amp;chksm=ce6463e5f913eaf38f3a14e90f33b3aa4f417ac0cd7520ff495a5f37f80538f5dab7f5e4de74&amp;scene=21#wechat_redirect" textvalue="PROGENy--单细胞通路活性评分" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"></a></p><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="cs"><code><span> <span># Transform to wide matrix</span></span></code><code><span>  sample_acts_mat &lt;- sample_acts %&gt;%</span></code><code><span>    filter(statistic == <span>'norm_wmean'</span>) %&gt;%</span></code><code><span>    pivot_wider(id_cols = <span>'condition'</span>, names_from = <span>'source'</span>,</span></code><code><span>                values_from = <span>'score'</span>) %&gt;%</span></code><code><span>    column_to_rownames(<span>'condition'</span>) %&gt;%</span></code><code><span>    <span>as</span>.matrix();sample_acts_mat[<span>1</span>:<span>6</span>,<span>1</span>:<span>6</span>]</span></code><code><span>    </span></code></pre></section><p><strong>这里要注意通路矩阵的行、列各代表什么</strong></p><p><img data-galleryid="" data-imgfileid="100003120" data-ratio="0.32605905006418484" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXKrn8twTEM8uGqSc2w0WCcn2q7yQnKwzP7UFVMEz9f9jKNQ48Dm0gGkg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="779" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXKrn8twTEM8uGqSc2w0WCcn2q7yQnKwzP7UFVMEz9f9jKNQ48Dm0gGkg/640?wx_fmt=png&amp;from=appmsg"></p><p><span><strong>得到这个通路矩阵之后，可视化又是各显神通啦！</strong></span></p><hr><p><strong>如果你想了解更多长宽数据：</strong></p><ol><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247486300&amp;idx=1&amp;sn=58551ec3be9daae010404a3d8671453c&amp;chksm=ce6465b5f913eca39c2e152147139464cd422bd302167f5d9495e89103d1f615a7409c001e00&amp;scene=21#wechat_redirect" textvalue="reshape2::melt 和 tidyr::pivot_longer对比学习：宽数据转为长数据" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">reshape2::melt 和 tidyr::pivot_longer对比学习：宽数据转为长数据</a> </p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247485531&amp;idx=1&amp;sn=a3b8477a073a71f0d2d9151683fb2715&amp;chksm=ce6466b2f913efa4ef3f38cca4c36a8490b47faff699f2d06840a7fbb2295db3d871fa4f89ed&amp;scene=21#wechat_redirect" textvalue="ggplot2画图精髓——宽数据转为长数据" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">ggplot2画图精髓——宽数据转为长数据</a></p><hr><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247485531&amp;idx=1&amp;sn=a3b8477a073a71f0d2d9151683fb2715&amp;chksm=ce6466b2f913efa4ef3f38cca4c36a8490b47faff699f2d06840a7fbb2295db3d871fa4f89ed&amp;scene=21#wechat_redirect" textvalue="ggplot2画图精髓——宽数据转为长数据" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"></a></p><p><br></p></li></ol><h2 data-tool="mdnice编辑器"><span>可视化一</span></h2><p><strong>这里我们选择变化较大的前25各tf进行可视化<br></strong></p><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="properties"><code><span> <span>n_tfs</span> <span>&lt;- 25</span></span></code><code><span><span>  </span></span></code><code><span><span>  # Get top tfs with more variable means across clusters</span></span></code><code><span>  <span>tfs</span> <span>&lt;- sample_acts %&gt;%</span></span></code><code><span>    <span>group_by(source)</span> <span>%&gt;%</span></span></code><code><span>    <span>summarise(std</span> = <span>sd(score)) %&gt;%</span></span></code><code><span>    <span>arrange(-abs(std))</span> <span>%&gt;%</span></span></code><code><span>    <span>head(n_tfs)</span> <span>%&gt;%</span></span></code><code><span>    <span>pull(source)</span></span></code><code><span>  <span>sample_acts_mat</span> <span>&lt;- sample_acts_mat[,tfs] ; sample_acts_mat[,1:9]</span></span></code></pre></section><p><img data-galleryid="" data-imgfileid="100003121" data-ratio="0.16649104320337196" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXKu6pL3Kg7JSyb2FZOke1ZNSMaaibxHVLJtYI5ibLQZQScnCMqLuLtPOlA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="949" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXKu6pL3Kg7JSyb2FZOke1ZNSMaaibxHVLJtYI5ibLQZQScnCMqLuLtPOlA/640?wx_fmt=png&amp;from=appmsg"></p><p><strong>可视化代码</strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="perl"><code><span> <span># Scale per sample</span></span></code><code><span>  sample_acts_mat &lt;- scale(sample_acts_mat)</span></code><code><span>  </span></code><code><span>  <span># Choose color palette</span></span></code><code><span>  palette_length = <span>100</span></span></code><code><span>  my_color = colorRampPalette(c(<span>"Darkblue"</span>, <span>"white"</span>,<span>"red"</span>))(palette_length)</span></code><code><span>  </span></code><code><span>  my_breaks &lt;- c(se<span>q(-3, 0, length.out=ceiling(palette_length/2)</span> + <span>1</span>),</span></code><code><span>                 se<span>q(0.05, 3, length.out=floor(palette_length/2)</span>))</span></code><code><span>  </span></code><code><span>  <span># Plot</span></span></code><code><span>  pheatmap(sample_acts_mat, border_color = NA, color=my_color, breaks = my_breaks)</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100003122" data-ratio="0.6435185185185185" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXK3jJ7MSKLg2ibHlMXpqR8NpQibEaNRicMrdPjU4Uxib8m6APCvbpBr0RXbA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXK3jJ7MSKLg2ibHlMXpqR8NpQibEaNRicMrdPjU4Uxib8m6APCvbpBr0RXbA/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><h2 data-tool="mdnice编辑器"><span>可视化二</span></h2><p><strong>所有的可视化都离不开前面得到的这个矩阵：</strong></p><p><img data-galleryid="" data-imgfileid="100003123" data-ratio="0.20473372781065088" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXKeibFTzMynsbXdicLgIFgedm7nHM1jucXwoaZwkD8xuhfUhDNTII9oTbQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="845" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXKeibFTzMynsbXdicLgIFgedm7nHM1jucXwoaZwkD8xuhfUhDNTII9oTbQ/640?wx_fmt=png&amp;from=appmsg"></p><p><strong>我们直接使用var来获取变异度最大的前50个tf进行可视化</strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span>  <span># Transform to wide matrix</span></span></code><code><span>  sample_acts_mat &lt;- sample_acts %&gt;%</span></code><code><span>    filter(statistic == <span>'norm_wmean'</span>) %&gt;%</span></code><code><span>    pivot_wider(id_cols = <span>'condition'</span>, names_from = <span>'source'</span>,</span></code><code><span>                values_from = <span>'score'</span>) %&gt;%</span></code><code><span>    column_to_rownames(<span>'condition'</span>) %&gt;%</span></code><code><span>    <span>as</span>.matrix();sample_acts_mat[<span>1</span>:<span>6</span>,<span>1</span>:<span>6</span>]</span></code><code><span>  </span></code><code><span>  </span></code><code><span><br></span></code><code><span>  <span># Transpose the matrix</span></span></code><code><span>  transposed_mat &lt;- t(sample_acts_mat)</span></code><code><span>  </span></code><code><span>  <span># Calculate the variance of each gene</span></span></code><code><span>  gene_variance &lt;- apply(transposed_mat, <span>1</span>, <span>var</span>)</span></code><code><span>  </span></code><code><span>  <span># Sort the genes by variance and select the top 50</span></span></code><code><span>  top_50_genes &lt;- names(sort(gene_variance, decreasing = <span>TRUE</span>)[<span>1</span>:<span>50</span>])</span></code><code><span>  </span></code><code><span>  <span># Extract the top 50 genes from the transposed matrix</span></span></code><code><span>  top_50_genes_mat &lt;- transposed_mat[top_50_genes, ]</span></code><code><span>  </span></code><code><span>  <span># Now, install and load the pheatmap package if you haven't already</span></span></code><code><span>  <span># install.packages("pheatmap")</span></span></code><code><span>  library(pheatmap)</span></code><code><span>  </span></code><code><span>  pheatmap:: pheatmap(top_50_genes_mat,scale = <span>'row'</span> </span></code><code><span>  )</span></code><code><span>  </span></code><code><span>  </span></code></pre></section><p><br></p><p><img data-galleryid="" data-imgfileid="100003125" data-ratio="0.8222698072805139" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXKqmjXVa1sRGVYbLjNaUfrH4US6JuI2Lp1HtUiclCMYusheN7nlzQxjjA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="934" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXKqmjXVa1sRGVYbLjNaUfrH4US6JuI2Lp1HtUiclCMYusheN7nlzQxjjA/640?wx_fmt=png&amp;from=appmsg"><strong></strong></p><p><strong>加上组别信息</strong></p><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span>  </span></code><code><span>  design=<span>as</span>.data.frame(design) </span></code><code><span>  rownames(design)=design$sample ;design </span></code><code><span>  <span># Visualize the top 50 genes using pheatmap</span></span></code><code><span>pheatmap:: pheatmap(top_50_genes_mat,scale = <span>'row'</span>,cluster_cols = <span>FALSE</span>,show_colnames = <span>FALSE</span>,</span></code><code><span>                    annotation_col = design </span></code><code><span>                     )</span></code><code><span>  </span></code></pre></section><p><br></p><p><img data-galleryid="" data-imgfileid="100003124" data-ratio="0.738728323699422" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXKg4NicicsOJ6U4kbibuiaGsyCb7XaBhtEMdGIYA9kuvP59sFCb1HjcRFj1g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="865" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktc4usgxY58LI72HnJlicpXKg4NicicsOJ6U4kbibuiaGsyCb7XaBhtEMdGIYA9kuvP59sFCb1HjcRFj1g/640?wx_fmt=png&amp;from=appmsg"></p><h2 data-tool="mdnice编辑器"><span>可视化三</span></h2><p><strong>请思考：为什么上述的这些可视化结果不太好看呢？</strong></p><p>原因就在于我们用的是变化最大的TF。<strong>如果我们使用差异TF来画热图就会很好看</strong>，这个问题就留给读者尝试吧！</p><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg2NDcxMzYwNg==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sks7JhVxUX46ZKxPSob6ptqIZgnIEnHOn5VMwCX8sN6MQy1Pq4XXFEOJ6grAmsoQugyCDKOZictDBHA/0?wx_fmt=png" data-nickname="生信小博士" data-alias="bioinformatics_Dr" data-signature="【生物信息学】R语言开始，学习生信。Seurat，单细胞测序，空间转录组。 Python，scanpy，cell2location。资料分享" data-from="2" data-is_biz_ban="0"></mp-common-profile></section><section><ul><li><li><li><li></ul><pre data-lang="ruby"><code><span>参考：</span></code><code><span><span>https:</span>/<span>/github.com/saezlab</span><span>/CollecTRI</span></span></code><code><span><span>https:/</span><span>/github.com/saezlab</span><span>/CollecTRI/blob</span><span>/main/scripts</span><span>/casestudy/</span><span>02</span>.<span>2_</span>pbmc_TFactivity.R</span></code><code><span><span>https:</span>/<span>/bioconductor.org/packages</span><span>/release/bioc</span><span>/vignettes/decouple</span>R/inst/doc/tf_bk.html</span></code></pre></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/3Ojhbf0o-f_LuonrYPQzPA",target="_blank" rel="noopener noreferrer">原文链接</a>
