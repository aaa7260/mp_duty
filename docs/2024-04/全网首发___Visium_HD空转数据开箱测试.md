---
title: "全网首发 | Visium HD空转数据开箱测试"
date: 2024-04-20T11:54:29Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
全网首发 | Visium HD空转数据开箱测试 by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">2024年1月份，10X公司预告了一个新技术10X Visium HD，分辨率可达2 μm，可实现<strong>单细胞分辨率的全转录组空间分析，并且可实现连续的组织覆盖率</strong>。千呼万唤始出来，10X官网在前几天公开了2个10X Visium HD测试数据，分别是</p><ul data-tool="mdnice编辑器"><li><section>Mouse Small Intestine，https://www.10xgenomics.com/datasets/visium-hd-cytassist-gene-expression-libraries-of-mouse-intestine</section></li><li><section>Human Colorectal Cancer （CRC），https://www.10xgenomics.com/datasets/visium-hd-cytassist-gene-expression-libraries-of-human-crc</section></li></ul><p data-tool="mdnice编辑器">我也在第一时间进行了开箱测试，<strong>然而万事开头难，在数据读入阶段就遇到一堆Bug，详见我的踩坑笔记：</strong></p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=Mzg5MjcxNzg1NA==&amp;mid=2247488030&amp;idx=1&amp;sn=e7b9c99477c1b8c3585594387baff32a&amp;scene=21#wechat_redirect" data-linktype="2">踩坑实录 | 使用R语言读入Visium HD空转数据</a></section></li></ul><p data-tool="mdnice编辑器"><strong>下文记录了CRC数据开箱测试的标准分析结果。</strong></p><h3 data-tool="mdnice编辑器"><span>Step1. 加载数据</span></h3><p data-tool="mdnice编辑器">这里读取我上期保存好的数据【<a href="https://mp.weixin.qq.com/s?__biz=Mzg5MjcxNzg1NA==&amp;mid=2247488030&amp;idx=1&amp;sn=e7b9c99477c1b8c3585594387baff32a&amp;scene=21#wechat_redirect" data-linktype="2">踩坑实录 | 使用R语言读入Visium HD空转数据</a>】：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(patchwork)<br><span>library</span>(dplyr)<br><span>library</span>(qs)<br><br><span>### 1.读入数据</span><br>CRC_data = qread(<span>"./Outdata/CRC_Visium_HD_8bin_image_solo.qs"</span>)<br>CRC_data<br><span># An object of class Seurat </span><br><span># 18085 features across 545913 samples within 1 assay </span><br><span># Active assay: Spatial (18085 features, 0 variable features)</span><br><span># 1 images present: CRC</span><br><br>p1 = SpatialDimPlot(CRC_data, alpha = <span>0</span>)<br>ggsave(filename = <span>"./Outplot/SpatialDimPlot.png"</span>, plot = p1)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100037305" data-ratio="0.7915742793791575" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWemsNoz3awNtZVUdVfaGG6tfqUt7ibicvQZ9V5M8a3bs7q8fN0xCwZZI0Q/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="902" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWemsNoz3awNtZVUdVfaGG6tfqUt7ibicvQZ9V5M8a3bs7q8fN0xCwZZI0Q/640?wx_fmt=other&amp;from=appmsg"><figcaption>image-20240329220908253</figcaption></figure><h3 data-tool="mdnice编辑器"><span>Step2. 数据质控</span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>### 2.质控</span><br>sc.QC.Spatial = <span>function</span>(merged_seurat){<br>  <span>### 1.1 Number of genes detected per UMI</span><br>  <span># Add number of genes per UMI for each cell to metadata</span><br>  merged_seurat$log10GenesPerUMI &lt;- log10(merged_seurat$nFeature_Spatial) / log10(merged_seurat$nCount_Spatial)<br>  <br>  <span>### 1.2 QC index calculation</span><br>  <span>## 1.2.1 Mitochondrial ratio</span><br>  mito_genes=rownames(merged_seurat)[grep(<span>"^MT-"</span>, rownames(merged_seurat))]<br>  print(<span>"mito_genes:"</span>)<br>  print(mito_genes)<br>  merged_seurat &lt;- PercentageFeatureSet(object = merged_seurat, pattern = <span>"^MT-"</span>,col.name = <span>"percent.mt"</span>)<br>  <br>  <span>## 1.2.2 Ribosomal ratio</span><br>  ribo_genes=rownames(merged_seurat)[grep(<span>"^RP[SL]"</span>, rownames(merged_seurat),ignore.case = <span>T</span>)]<br>  print(<span>"ribo_genes:"</span>)<br>  print(ribo_genes)<br>  <br>  merged_seurat &lt;- PercentageFeatureSet(merged_seurat,<span>"^RP[SL]"</span>,col.name = <span>"percent.ribo"</span>)<br>  print(summary(merged_seurat@meta.data$percent.ribo))<br>  <br>  <span>## 1.2.3 Erythrocyte ratio</span><br>  hb_genes &lt;- rownames(merged_seurat)[grep(<span>"^HB[^(P)]"</span>, rownames(merged_seurat),ignore.case = <span>T</span>)]<br>  print(<span>"hb_genes"</span>)<br>  print(hb_genes)<br>  merged_seurat=PercentageFeatureSet(merged_seurat, <span>"^HB[^(P)]"</span>, col.name = <span>"percent.hb"</span>)<br>  print(summary(merged_seurat@meta.data$percent.hb))<br>  <span>return</span>(merged_seurat)<br>}<br><br>CRC_data = NormalizeData(CRC_data)<br>CRC_data = sc.QC.Spatial(CRC_data)<br>p.VlnPlot = VlnPlot(CRC_data,pt.size = <span>0</span>,<br>                    features = c(<span>"nFeature_Spatial"</span>, <span>"nCount_Spatial"</span>, <span>"percent.mt"</span>),<br>                    ncol = <span>3</span>)<br>ggsave(filename = <span>"./Outplot/Step2.QC.VlnPlot.png"</span>,width = <span>14</span>,height = <span>5</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100037303" data-ratio="0.35185185185185186" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWendoibrjDd7JZXibxBUfNHib0XyicR05NRkAtuEApnKX53OOTKcoibS9t7Hw/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWendoibrjDd7JZXibxBUfNHib0XyicR05NRkAtuEApnKX53OOTKcoibS9t7Hw/640?wx_fmt=other&amp;from=appmsg"><figcaption>image-20240329211412281</figcaption></figure><p data-tool="mdnice编辑器">可以看到Visium HD空转数据的测序深度似乎比10X单细胞低一些。另外，在过滤低质量细胞过程中，我发现按照10X单细胞的过滤标准对于Visium HD空转数据而言不太合适：</p><pre data-tool="mdnice编辑器"><span></span><code><span>## 过滤</span><br>qc.test &lt;- subset(CRC_data, subset = nFeature_Spatial &gt;= <span>250</span> &amp; <br>                      nCount_Spatial&gt;= <span>500</span> &amp; percent.mt &lt; <span>20</span>)<br>qc.test <span>#过滤后 18085 features across 224858 samples</span><br>CRC_data <span>#过滤前 18085 features across 545913 samples</span><br></code></pre><p data-tool="mdnice编辑器">然后我查阅了华大的过滤标准，华大对<code>percent.mt</code>的设置为5，在这里我设置为15，其他指标和华大的过滤标准一致：</p><pre data-tool="mdnice编辑器"><span></span><code><span>## 华大QC流程：</span><br>CRC.qc &lt;- subset(CRC_data, subset = nFeature_Spatial &gt;= <span>20</span> &amp; <br>                    nCount_Spatial&gt;= <span>3</span> &amp; percent.mt &lt; <span>15</span>)<br>CRC.qc <span>#过滤后 18085 features across 497201 samples</span><br></code></pre><p data-tool="mdnice编辑器">这里我没有过滤低表达的基因。</p><h3 data-tool="mdnice编辑器"><span>Step3. 标准流程</span></h3><p data-tool="mdnice编辑器">这里我采用了Seurat单细胞的标准流程进行分析：</p><pre data-tool="mdnice编辑器"><span></span><code><span>### 三步走：标准化、特征选择和归一化分析</span><br>CRC.qc &lt;- CRC.qc %&gt;% NormalizeData(verbose = <span>F</span>) %&gt;%<br>  FindVariableFeatures(selection.method = <span>"vst"</span>, nfeatures = <span>2000</span>, verbose = <span>F</span>) %&gt;% <br>  ScaleData(verbose = <span>F</span>) %&gt;% <br>  RunPCA(npcs = <span>50</span>, verbose = <span>F</span>)<br>CRC.qc<br></code></pre><p data-tool="mdnice编辑器">这里没有使用<code>SCTransform</code>流程，因为近50w的细胞量，如果用<code>SCTransform</code>内存会爆炸的。有足够计算机资源的朋友可以试试：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#CRC.qc &lt;- SCTransform(CRC.qc, assay = "Spatial", return.only.var.genes = FALSE, verbose = FALSE)</span><br></code></pre><p data-tool="mdnice编辑器">由于是单个样本，因此不需要进行整合去批次，直接进行降维聚类即可：</p><pre data-tool="mdnice编辑器"><span></span><code>CRC.qc &lt;- RunUMAP(CRC.qc, reduction = <span>"pca"</span>, dims = <span>1</span>:<span>30</span>) %&gt;% <br>  FindNeighbors(reduction = <span>"pca"</span>, dims = <span>1</span>:<span>30</span>) %&gt;% <br>  FindClusters(verbose = <span>FALSE</span>)<br><br>p2 &lt;- DimPlot(CRC.qc, reduction = <span>"umap"</span>, label = <span>TRUE</span>, raster= <span>T</span>)<br>ggsave(filename = <span>"./Outplot/Step3.UMAP.png"</span>,<br>       plot = p2, width = <span>6</span>, height = <span>6</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100037304" data-ratio="0.9843924191750278" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWeyYJz3DWF8hRTVjaQQAV5bgicfmK6pvvDSNUVIsSBvuT226BGoSia2DIw/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="897" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWeyYJz3DWF8hRTVjaQQAV5bgicfmK6pvvDSNUVIsSBvuT226BGoSia2DIw/640?wx_fmt=other&amp;from=appmsg"><figcaption>image-20240329221425781</figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code>p3 &lt;- SpatialDimPlot(CRC.qc, label = <span>F</span>,<br>                     pt.size.factor = <span>0.15</span>, <br>                     stroke = <span>0</span>)<br>ggsave(filename = <span>"./Outplot/Step3.SpatialDimPlot.png"</span>,<br>       plot = p3, width = <span>6</span>, height = <span>6</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100037307" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWeyxkQr3LKuEybO7ckCfm1bg8wU0z81Q4YSpqibIiaLKLzjrSwLkX1qctQ/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWeyxkQr3LKuEybO7ckCfm1bg8wU0z81Q4YSpqibIiaLKLzjrSwLkX1qctQ/640?wx_fmt=other&amp;from=appmsg"><figcaption>Step3.SpatialDimPlot</figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code>SpatialDimPlot(CRC.qc, <br>               cells.highlight = CellsByIdentities(object = CRC.qc, <br>                                                   idents = c(<span>12</span>, <span>14</span>, <span>18</span>)),<br>               pt.size.factor = <span>0.15</span>,<br>               facet.highlight = <span>TRUE</span>, ncol = <span>3</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100037306" data-ratio="0.34629629629629627" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWe8EX2Ycyu6P03m50RfGibbUbgdTjyHHicDUP7Z3WvKOlptKYjjqwibjUcQ/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWe8EX2Ycyu6P03m50RfGibbUbgdTjyHHicDUP7Z3WvKOlptKYjjqwibjUcQ/640?wx_fmt=other&amp;from=appmsg"><figcaption>image-20240329225203052</figcaption></figure><p data-tool="mdnice编辑器"><strong>总体来说，聚类效果还可以，但是使用默认分辨率识别到的亚群有点多。用户可以自行更改分辨率。</strong></p><p data-tool="mdnice编辑器"><strong>对经典的marker进行可视化检查（由于我不是做CRC的，因此没有特别收集CRC上皮细胞类型的标志物）：</strong></p><pre data-tool="mdnice编辑器"><span></span><code>DotPlot(object = CRC_data,<br>        features = c(<span>"RGS1"</span>,<span>"PTPRC"</span>,<span>'TYROBP'</span>, <span>#Leukocytes (Leu) </span><br>                     <span>'CD3D'</span>,<span>'CD3E'</span>,<span>"CD3G"</span>, <span>#T cells</span><br>                     <span>"NKG7"</span>,<span>"GZMB"</span>,<span>"KLRD1"</span>, <span>#NK cells</span><br>                     <span>"IGHM"</span>,<span>"CD22"</span>,<span>"CD79A"</span>, <span>#B cells</span><br>                     <span>"JCHAIN"</span>,<span>"MZB1"</span>,<span>"PRDM1"</span>, <span>#Plasma cells</span><br>                     <span>'CD14'</span>,<span>"HLA-DQB1"</span>,<span>"C1QA"</span>, <span>#monocyte/Macrophages</span><br>                     <span>"CLEC10A"</span>,<span>"CLEC4C"</span>, <span>#DC cells</span><br>                     <span>"KIT"</span>,<span>"GATA2"</span>,<span>'TPSB2'</span>, <span>#Mast cells</span><br>                     <span>'EPCAM'</span>,<span>#Epithelial</span><br>                     <span>"REG1A"</span>,<span>"REG1B"</span>,<span>"CEACAM6"</span>,<span>"TGFBI"</span>, <span>#Tumor cells</span><br>                     <span>"MUC2"</span>,<span>"FCGBP"</span>, <span>#goblet cells</span><br>                     <span>"ACKR1"</span>,<span>'CLDN5'</span>,<span>'CDH5'</span>, <span>#Endo</span><br>                     <span>"DCN"</span>,<span>"VIM"</span>,<span>"LUM"</span>,<span>"ACTA2"</span>,<span>"MYH11"</span><span>#Fibroblast</span><br>        ),<br>        group.by = <span>"seurat_clusters"</span>)+coord_flip()<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100037308" data-ratio="0.6174055829228243" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWeAu0iautZyf3RAdlSo3wK0Sy0RDysMwAO5aEJQGnNNStU85tDVlBw6wQ/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="609" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWeAu0iautZyf3RAdlSo3wK0Sy0RDysMwAO5aEJQGnNNStU85tDVlBw6wQ/640?wx_fmt=other&amp;from=appmsg"><figcaption>image-20240329223050600</figcaption></figure><p data-tool="mdnice编辑器"><strong>这效果比10X Visium好太多了！</strong></p><p data-tool="mdnice编辑器"><strong>这里由于我对CRC不太熟悉，没有继续做亚群注释。</strong><br></p><p data-tool="mdnice编辑器"><strong>我挑选了几个经典的marker继续进行可视化：</strong></p><ul data-tool="mdnice编辑器"><li><section>例如成纤维细胞（DCN）</section></li></ul><figure data-tool="mdnice编辑器"><img data-imgfileid="100037310" data-ratio="0.9840348330914369" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWef6QQjeY2zbnDl9mmrfh4nBA4ID2SACdbKuVnic4bIkqqfTCXqQoQwmA/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="689" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWef6QQjeY2zbnDl9mmrfh4nBA4ID2SACdbKuVnic4bIkqqfTCXqQoQwmA/640?wx_fmt=other&amp;from=appmsg"><figcaption>image-20240329224131223</figcaption></figure><ul data-tool="mdnice编辑器"><li><section>上皮细胞（EPCAM）</section></li></ul><figure data-tool="mdnice编辑器"><img data-imgfileid="100037312" data-ratio="0.9913169319826338" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWeqZSaYroC9jblOEfkvnp67A1qNMtOlMX0h6uRhRmBxU1ReMfxQHMy6Q/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="691" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWeqZSaYroC9jblOEfkvnp67A1qNMtOlMX0h6uRhRmBxU1ReMfxQHMy6Q/640?wx_fmt=other&amp;from=appmsg"><figcaption>image-20240329223707998</figcaption></figure><ul data-tool="mdnice编辑器"><li><section>杯状细胞（FCGBP）</section></li></ul><figure data-tool="mdnice编辑器"><img data-imgfileid="100037311" data-ratio="0.9842180774748924" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWeHTLicgt1Co1icXtjLpniaK2ibWHWOwehUrLPILSbVKxZwZdW8WN7sQWO6Q/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="697" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWeHTLicgt1Co1icXtjLpniaK2ibWHWOwehUrLPILSbVKxZwZdW8WN7sQWO6Q/640?wx_fmt=other&amp;from=appmsg"><figcaption>image-20240329223438050</figcaption></figure><ul data-tool="mdnice编辑器"><li><section>T细胞（CD3E）</section></li></ul><figure data-tool="mdnice编辑器"><img data-imgfileid="100037309" data-ratio="0.9883720930232558" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWe44oXN4fmSvWKFkEPap26rUm0SY8lHpWvTnEQYbMPZV8BGhAxDul04Q/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="688" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWe44oXN4fmSvWKFkEPap26rUm0SY8lHpWvTnEQYbMPZV8BGhAxDul04Q/640?wx_fmt=other&amp;from=appmsg"><figcaption>image-20240329223909593</figcaption></figure><ul data-tool="mdnice编辑器"><li><section>单核细胞（CD14）</section></li></ul><figure data-tool="mdnice编辑器"><img data-imgfileid="100037317" data-ratio="0.9985294117647059" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWewUqnapVxWM0gKibKBM2iaA8fB6pkJBZcsowFvbzaicbS7oA79z36ias4bA/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="680" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los93AArlgC3yiazzKMibicF0CWewUqnapVxWM0gKibKBM2iaA8fB6pkJBZcsowFvbzaicbS7oA79z36ias4bA/640?wx_fmt=other&amp;from=appmsg"><figcaption>image-20240329224046924</figcaption></figure><h3 data-tool="mdnice编辑器"><span>总结</span></h3><p data-tool="mdnice编辑器">实际上，从标准分析流程开始，后续的分析和10X单细胞分析非常相似，但是会涉及一些空间层面的分析，例如细胞通讯及空间生态位分析，我们后续再进行讨论~</p><p data-tool="mdnice编辑器">总体来说，Visium HD空转数据的精细度相较于10X Visium大大提高。但是仍存在一些问题和挑战，例如：</p><ul data-tool="mdnice编辑器"><li><section>一张8微米的切片具有50w个单细胞，而上述单样本的分析内存最大峰值近60GB（并未涉及高级分析）。后续开展进阶/高级分析，包括差异表达分析、转录因子分析以及细胞通讯分析等，必然需要消耗极大的资源。</section></li><li><section>未来在进行多样本的Visium HD数据联合分析时，分析难度必然会陡增。</section></li><li><section>与10X Visium 相比，Visium HD空转数据可以做哪些不同角度且更深入地挖掘和分析？这点可能需要我们在阅读大量文献的基础上，结合专业背景进行设计和思考。</section></li><li><section>由于我暂时没有接触过华大等单细胞精度的空转数据，我比较好奇与其他大品牌的空转数据相比，Visium HD空转数据的表现如何？</section></li></ul><p data-tool="mdnice编辑器">当然，我只是一个空转数据的初学者，而且对CRC这个癌种也不熟悉，所以只是管中窥豹，理解不多。还请各位各抒己见，如有错误多多批评~</p></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/BDz7F5N5Mz-BvaEbgAhEEg",target="_blank" rel="noopener noreferrer">原文链接</a>
