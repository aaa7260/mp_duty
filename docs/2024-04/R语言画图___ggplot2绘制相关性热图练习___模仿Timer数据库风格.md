---
title: "R语言画图 | ggplot2绘制相关性热图练习 - 模仿Timer数据库风格"
date: 2024-04-15T00:23:44Z
draft: ["false"]
tags: [
  "fetched",
  "被炸熟的虾"
]
categories: ["Acdemic"]
---
R语言画图 | ggplot2绘制相关性热图练习 - 模仿Timer数据库风格 by 被炸熟的虾
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><section><span>年前整理了几篇</span><code>ggplot2</code><span>绘制热图的帖子：</span><span></span></section><ul><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247486105&amp;idx=1&amp;sn=037a01f5f6fa4ea12ba409ea60f3e9b7&amp;chksm=c086d651f7f15f47a4fd37bf4031f0a5bc2ae8b179756dd945fcfc20434a8fa3925d2f5e2433&amp;scene=21&amp;cur_album_id=3053206297459900416#wechat_redirect" data-linktype="2">R语言画图 | ggplot2绘制热图及个性化修饰</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247486124&amp;idx=1&amp;sn=9df90f3e476c8b0af23b5cb0a856a413&amp;chksm=c086d664f7f15f720159b841779b69d87183d3cc7d7631f7b1ffac628cfd08c37fe6e8fca6ec&amp;cur_album_id=3053206297459900416&amp;scene=21#wechat_redirect" data-linktype="2">R语言画图 | ggplot2绘制离散值热图</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247486196&amp;idx=1&amp;sn=2f31ba774d948fd79352b8976bfbab6f&amp;chksm=c086d63cf7f15f2aeacb36dc9979c4531686769f21ca3f0d7bf758eee1a897b7e7c2a1507945&amp;cur_album_id=3053206297459900416&amp;scene=21#wechat_redirect" data-linktype="2">R语言画图 | ggheatmap绘制热图及个性化修饰</a></section></li></ul><section><span>补充<span>一个相关性热图。其实相关性热图在之前的帖子中已经零零散散的展示过：</span></span></section><ul><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247486550&amp;idx=1&amp;sn=c3cc293ad2fa014a5daadc54a33dc15e&amp;chksm=c086d09ef7f159886cf20b0e80cc1d3acce842f4de202efb41c747e6ab20dcc2da11577c6b6d&amp;scene=21&amp;cur_album_id=3053206297459900416#wechat_redirect" data-linktype="2">R语言画图 | 相关性气泡图</a><strong>（付费贴）</strong></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247483894&amp;idx=1&amp;sn=1253469f69b39d87fcb2830846b8fd27&amp;scene=21#wechat_redirect" data-linktype="2">单基因泛癌分析（八）：基因集变异分析（GSVA）</a><strong>（付费贴 1个豆子）</strong><span></span></section></li></ul><p><img data-galleryid="" data-imgfileid="100002897" data-ratio="0.8" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3Kb4dwN2TZSMNabfXVhCy6xVwHLInGSsMjsUKG6K3qTQfWCP80F66XBSa1DU0AWOgHbw3Uzicn9DYQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3Kb4dwN2TZSMNabfXVhCy6xVwHLInGSsMjsUKG6K3qTQfWCP80F66XBSa1DU0AWOgHbw3Uzicn9DYQ/640?wx_fmt=png&amp;from=appmsg"></p><section><span>或者用效果更好</span><span>DotPlot</span><span>:</span></section><p><img data-galleryid="" data-imgfileid="100002898" data-ratio="0.887962962962963" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3Kb4dwN2TZSMNabfXVhCy6xKB3f0WuiaufRnkibvRXr2v5bTick7Gia03vRQfjdC4k6R6vgvlOnVEkCIw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3Kb4dwN2TZSMNabfXVhCy6xKB3f0WuiaufRnkibvRXr2v5bTick7Gia03vRQfjdC4k6R6vgvlOnVEkCIw/640?wx_fmt=png&amp;from=appmsg"></p><p><span>这里就当是一个练习，尝试复现</span><span>Timer</span><span>网站风格的相关性热图，下图展示了基因</span><span>VIM</span><span>与</span><span>CD8 T cell</span><span>免疫浸润水平的相关性：</span></p><p><img data-galleryid="" data-imgfileid="100003234" data-ratio="1" data-s="300,640" data-type="jpeg" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3LrFSAkza6z9kCdfUUW8tP77lYmp1cpuXdWicsUnsmP0FuuicesdsZQgt1ribhDxowN4HcrMhk5TZ21Q/640?wx_fmt=jpeg&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3LrFSAkza6z9kCdfUUW8tP77lYmp1cpuXdWicsUnsmP0FuuicesdsZQgt1ribhDxowN4HcrMhk5TZ21Q/640?wx_fmt=jpeg&amp;from=appmsg"></p><section><span>绘图数据网站一并提供：</span></section><ul><li><section><span></span><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247485451&amp;idx=1&amp;sn=a6e0a543baa1ae85935ad283c34b4e72&amp;scene=21#wechat_redirect" data-linktype="2"><span></span></a><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247485451&amp;idx=1&amp;sn=a6e0a543baa1ae85935ad283c34b4e72&amp;scene=21#wechat_redirect" data-linktype="2">免疫浸润 | TIMER 数据库的基础用法</a></section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls()) <br>setwd(<span>"D:/bioinformatics/R/1 Basic plot in R/8.Heatmap/Fig"</span>)<br>exprSet &lt;- read.csv(<span>"Timer2.0.csv"</span>)<br>head(exprSet)<br><span>#      cancer                       infiltrates         rho          p      adj.p</span><br><span>#1 ACC (n=79)  T cell CD8+ central memory_XCELL  0.05946370 0.61726405 0.72406340</span><br><span>#2 ACC (n=79) T cell CD8+ effector memory_XCELL  0.18163037 0.12407590 0.22457176</span><br><span>#3 ACC (n=79)           T cell CD8+ naive_XCELL  0.04072677 0.73227130 0.80913956</span><br><span>#4 ACC (n=79)             T cell CD8+_CIBERSORT -0.09637056 0.41732595 0.56586570</span><br><span>#5 ACC (n=79)         T cell CD8+_CIBERSORT-ABS  0.02373748 0.84199625 0.90294504</span><br><span>#6 ACC (n=79)                  T cell CD8+_EPIC -0.25483295 0.02957226 0.07781925</span><br>exprSet$cancer &lt;- factor(exprSet$cancer,levels = rev(unique(exprSet$cancer)))<br>exprSet$infiltrates &lt;- factor(exprSet$infiltrates,<br>                              levels = c(<span>"T cell CD8+_TIMER"</span>,<br>                                         <span>"T cell CD8+_EPIC"</span>,<br>                                         <span>"T cell CD8+_MCPCOUNTER"</span>,<br>                                         <span>"T cell CD8+_CIBERSORT"</span>,<br>                                         <span>"T cell CD8+_CIBERSORT-ABS"</span>,<br>                                         <span>"T cell CD8+_QUANTISEQ"</span>,<br>                                         <span>"T cell CD8+_XCELL"</span>,<br>                                         <span>"T cell CD8+ naive_XCELL"</span>,<br>                                         <span>"T cell CD8+ central memory_XCELL"</span>,<br>                                         <span>"T cell CD8+ effector memory_XCELL"</span>))<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>一、基础测试</span><span> </span></h2><p><span>我们先测试一下之前的模板——使用</span><code>geom_tile()</code><span>绘制矩形色块</span></p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggplot2)<br>p &lt;- ggplot(data = exprSet,aes(x = infiltrates,y = cancer)) +<br>     geom_tile(aes(fill = rho),color = <span>"grey"</span>) +<br>     theme_minimal() <br></code></pre><section><span>修改</span><code>theme</code><span>参数，调整颜色</span></section><pre data-tool="mdnice编辑器"><span></span><code>mytheme &lt;- theme(panel.grid = element_blank(),<br>                 legend.position = <span>"right"</span>,<br>                 legend.text = element_text(size = <span>14</span>),<br>                 legend.title = element_text(size = <span>14</span>),<br>                 axis.ticks.y = element_blank(),<br>                 axis.title = element_blank(),<br>                 axis.text.x = element_text(angle = <span>45</span>,hjust = <span>1</span>,size = <span>14</span>),<br>                 axis.text.y = element_text(colour = <span>'black'</span>, size = <span>14</span>))<br>p2 &lt;- p + scale_fill_gradient2(low = <span>"#0074b3"</span>, mid = <span>"white"</span>, high = <span>"#982b2b"</span>, <br>                               name = <span>"Correlation"</span>,<br>                         limits = c(-<span>1</span>,<span>1</span>),breaks = seq(-<span>1</span>,<span>1</span>,<span>0.5</span>))+<br>      mytheme<br></code></pre><section><span>添加相关性</span><span>label</span><span>：</span></section><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(dplyr)<br>tmp = case_when(as.vector(exprSet$p) &lt; <span>0.001</span>~<span>"****"</span>,<br>                as.vector(exprSet$p) &lt; <span>0.001</span>~<span>"***"</span>,<br>                as.vector(exprSet$p) &lt; <span>0.01</span>~<span>"**"</span>,<br>                as.vector(exprSet$p) &lt; <span>0.05</span>~<span>"*"</span>,<br>                <span>T</span>~ <span>""</span>)<br>exprSet$label &lt;- tmp<br>p2 &lt;-  p2 + geom_text(data = exprSet,aes(x = infiltrates,y = cancer,label = label),vjust = <span>0.7</span>)<br></code></pre><p><img data-imgfileid="100003235" data-ratio="1.4277777777777778" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LrFSAkza6z9kCdfUUW8tP7CwfrX8vH6eiboe6ticgqU4CZzWK05BIL4BlfM9yEDaORqmENPKYVUzOA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LrFSAkza6z9kCdfUUW8tP7CwfrX8vH6eiboe6ticgqU4CZzWK05BIL4BlfM9yEDaORqmENPKYVUzOA/640?wx_fmt=png&amp;from=appmsg"></p><h2 data-tool="mdnice编辑器"><span></span><span>二、开始模仿</span><span> </span></h2><p><mp-pay-preview-filter data-offset="24"></mp-pay-preview-filter></p></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/2Hb2fZAoTKIAl1SO1YwSDw",target="_blank" rel="noopener noreferrer">原文链接</a>
