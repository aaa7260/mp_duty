---
title: "tidymodels实现lasso回归及超参数调优"
date: 2024-04-03T01:33:20Z
draft: ["false"]
tags: [
  "fetched",
  "医学和生信笔记"
]
categories: ["Acdemic"]
---
tidymodels实现lasso回归及超参数调优 by 医学和生信笔记
------
<div><p><img data-galleryid="" data-imgfileid="100017852" data-ratio="0.16666666666666666" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R9fO0vCqNNWMpw3VRMCZnvHTZzG2JUNYHDwaRCDvCcJZEJFRH3KVxBylYk1YcpWMJe8rBmrmeYwjg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R9fO0vCqNNWMpw3VRMCZnvHTZzG2JUNYHDwaRCDvCcJZEJFRH3KVxBylYk1YcpWMJe8rBmrmeYwjg/640?wx_fmt=png&amp;from=appmsg"></p><hr><table><tbody><tr><td width="172" valign="top"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzOTQzNzU0NA==&amp;action=getalbum&amp;album_id=2231476971388059661&amp;uin=&amp;key=&amp;devicetype=Windows+11+x64&amp;version=63090819&amp;lang=zh_CN&amp;ascene=0&amp;session_us=gh_28ea67f3b544" textvalue="你已选中了添加链接的内容" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="1"><span><img data-cropselx1="0" data-cropselx2="151" data-cropsely1="0" data-cropsely2="127" data-galleryid="" data-imgfileid="100017855" data-ratio="0.8435185185185186" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZJVPcbVTf4Xmmz0ibmMDSDicNE8fAMebg1h5uSZJJ7nhmRNiaibJnoG6lOg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZJVPcbVTf4Xmmz0ibmMDSDicNE8fAMebg1h5uSZJJ7nhmRNiaibJnoG6lOg/640?wx_fmt=png&amp;from=appmsg"></span></a></p></td><td width="172" valign="top"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzOTQzNzU0NA==&amp;action=getalbum&amp;album_id=2267367379124928515&amp;uin=&amp;key=&amp;devicetype=Windows+11+x64&amp;version=63090819&amp;lang=zh_CN&amp;ascene=0&amp;session_us=gh_28ea67f3b544" textvalue="你已选中了添加链接的内容" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="1"><span><img data-cropselx1="0" data-cropselx2="151" data-cropsely1="0" data-cropsely2="127" data-galleryid="" data-imgfileid="100017854" data-ratio="0.8435185185185186" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZ3noGibiag7bKyuAvs4POaZWW4JTQMeUibXHqF9Jv0MEoNJLpgvY2jxaTQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZ3noGibiag7bKyuAvs4POaZWW4JTQMeUibXHqF9Jv0MEoNJLpgvY2jxaTQ/640?wx_fmt=png&amp;from=appmsg"></span></a></p></td><td width="172" valign="top"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzOTQzNzU0NA==&amp;action=getalbum&amp;album_id=2255945345983627264&amp;scene=173&amp;subscene=&amp;sessionid=svr_781993951eb&amp;enterid=1709989110&amp;from_msgid=2247500872&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="你已选中了添加链接的内容" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="1"><span><img data-cropselx1="0" data-cropselx2="151" data-cropsely1="0" data-cropsely2="127" data-galleryid="" data-imgfileid="100017856" data-ratio="0.8435185185185186" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZtVWVkXRwiaATrnk7BzxzOOOibjbZSM1AVxkMNXHRHWFybibmVTYpUb4bA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZtVWVkXRwiaATrnk7BzxzOOOibjbZSM1AVxkMNXHRHWFybibmVTYpUb4bA/640?wx_fmt=png&amp;from=appmsg"></span></a></p></td></tr><tr><td width="172" valign="top"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzOTQzNzU0NA==&amp;action=getalbum&amp;album_id=2393825487539191816&amp;scene=173&amp;subscene=&amp;sessionid=svr_20c53631f79&amp;enterid=1709989057&amp;from_msgid=2247501166&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="你已选中了添加链接的内容" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="1"><span><img data-cropselx1="0" data-cropselx2="151" data-cropsely1="0" data-cropsely2="127" data-galleryid="" data-imgfileid="100017853" data-ratio="0.8435185185185186" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZqB1xXibTCqxzWDnSCZrJSicPH8II0G8JxLBmqTEoRWcpiaEEaEoXKibKaQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZqB1xXibTCqxzWDnSCZrJSicPH8II0G8JxLBmqTEoRWcpiaEEaEoXKibKaQ/640?wx_fmt=png&amp;from=appmsg"></span></a></p></td><td width="172" valign="top"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzOTQzNzU0NA==&amp;action=getalbum&amp;album_id=3302133732023369734&amp;scene=173&amp;subscene=&amp;sessionid=svr_aba6bcd7c9d&amp;enterid=1709989036&amp;from_msgid=2247501168&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="你已选中了添加链接的内容" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="1"><span><img data-cropselx1="0" data-cropselx2="151" data-cropsely1="0" data-cropsely2="127" data-galleryid="" data-imgfileid="100017858" data-ratio="0.8435185185185186" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZEDyJ5HeuhZiaaZxAYE2vibrTo3k9PZIicu9ADibzqWtfsVJ7qsyEn8OYPA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZEDyJ5HeuhZiaaZxAYE2vibrTo3k9PZIicu9ADibzqWtfsVJ7qsyEn8OYPA/640?wx_fmt=png&amp;from=appmsg"></span></a></p></td><td width="172" valign="top"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzOTQzNzU0NA==&amp;action=getalbum&amp;album_id=3330048674143567873&amp;scene=173&amp;subscene=&amp;sessionid=undefined&amp;enterid=0&amp;from_msgid=2247501093&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="你已选中了添加链接的内容" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="1"><span><img data-cropselx1="0" data-cropselx2="151" data-cropsely1="0" data-cropsely2="127" data-galleryid="" data-imgfileid="100017859" data-ratio="0.8435185185185186" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZdBBtwWIehx7CD2kBOPBbfIIOuVPZBWCAgZa6pica4yI2DC91G1zoiaJg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZdBBtwWIehx7CD2kBOPBbfIIOuVPZBWCAgZa6pica4yI2DC91G1zoiaJg/640?wx_fmt=png&amp;from=appmsg"></span></a></p></td></tr></tbody></table><p><img data-galleryid="" data-imgfileid="100017857" data-ratio="0.3333333333333333" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZlYnHSZZLNukeic7DKOOuoenP0uPxYP0L4Ngfl5CLhoLUxogGayzREWQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicFQdAjJlXFgFpqvDjKEysZlYnHSZZLNukeic7DKOOuoenP0uPxYP0L4Ngfl5CLhoLUxogGayzREWQ/640?wx_fmt=png&amp;from=appmsg"></p><hr><p><br></p><section data-role="outer" label="edit by 135editor"><section data-role="paragraph"><section data-role="outer" label="edit by 135editor"><section data-role="paragraph"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><span><strong></strong></span></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">之前已经给大家介绍过使用<code>glmnet</code>实现lasso回归了，详情可见：<a href="https://mp.weixin.qq.com/s?__biz=MzUzOTQzNzU0NA==&amp;mid=2247499618&amp;idx=1&amp;sn=e2190a6470e1d421eb815d343fc95279&amp;scene=21#wechat_redirect" data-linktype="2">使用glmnet做lasso回归</a>。</p><p data-tool="mdnice编辑器">今天给大家演示下如何使用<code>tidymodels</code>实现lasso回归。</p><p data-tool="mdnice编辑器">整理数据的过程略，大家可以直接去粉丝QQ群文件下载整理好的数据（别问我怎么加群，加了群也别问我数据在哪里！）。</p><p data-tool="mdnice编辑器">今天使用的数据是一个回归数据，结果变量是<code>imdb_rating</code>评分，是数值型的，其余都是预测变量，数据一共有136行，32列。</p><h2 data-tool="mdnice编辑器"><span></span><span>加载R包和数据</span><span></span></h2><p data-tool="mdnice编辑器">加载数据，并分为训练集和测试集，比例为3/4：</p><pre data-tool="mdnice编辑器"><code><span>library</span>(tidyverse)<br><span>library</span>(tidymodels)<br>load(file = <span>"office.rdata"</span>)<br><br>office_split &lt;- initial_split(office, strata = season)<br>office_train &lt;- training(office_split)<br>office_test &lt;- testing(office_split)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>预处理</span><span></span></h2><p data-tool="mdnice编辑器">首先处理下<code>episode_name</code>这个变量，它既不是预测变量，也不是结果变量，但是我们需要它留在数据集中，所以为了不影响建模过程，给它分配一个新的角色：<code>ID</code>。</p><p data-tool="mdnice编辑器">去掉零方差变量，再进行中心化和标准化：</p><pre data-tool="mdnice编辑器"><code>office_rec &lt;- recipe(imdb_rating ~ ., data = office_train) %&gt;%<br>  update_role(episode_name, new_role = <span>"ID"</span>) %&gt;%<br>  step_zv(all_numeric(), -all_outcomes()) %&gt;%<br>  step_normalize(all_numeric(), -all_outcomes())<br><br>office_prep &lt;- office_rec %&gt;%<br>  prep(strings_as_factors = <span>FALSE</span>)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>建模</span><span></span></h2><p data-tool="mdnice编辑器">我们通过<code>tidymodels</code>实现lasso回归，其实还是要借助<code>glmnet</code>包的，因为<code>tidymodels</code>本身并不能实现任何算法，它只是提供一个统一的接口而已，这一点我们在之前也详细介绍过：<a href="https://mp.weixin.qq.com/s?__biz=MzUzOTQzNzU0NA==&amp;mid=2247499637&amp;idx=1&amp;sn=78839cf5f70b409ad93f6d43bfb2d970&amp;scene=21#wechat_redirect" data-linktype="2">tidymodels之parsnip的强大之处</a></p><p data-tool="mdnice编辑器"><code>glmnet</code>虽然强大，但是它的一些参数非常的不人性化，<code>tidymodels</code>根据每个参数的意义对这些参数进行了重新命名。</p><p data-tool="mdnice编辑器"><code>tidymodels</code>中的<code>mixture</code>就是<code>glmnet</code>中的<code>alpha</code>，所以<code>mixture=1</code>就是使用lasso回归。</p><p data-tool="mdnice编辑器">如果要学习<code>glmnet</code>的用法，我之前也详细介绍过：<a href="https://mp.weixin.qq.com/s?__biz=MzUzOTQzNzU0NA==&amp;mid=2247499618&amp;idx=1&amp;sn=e2190a6470e1d421eb815d343fc95279&amp;scene=21#wechat_redirect" data-linktype="2">使用glmnet做lasso回归</a></p><p data-tool="mdnice编辑器">我们先自己指定一个惩罚值（这里是0.1）看看效果如何：</p><pre data-tool="mdnice编辑器"><code>lasso_spec &lt;- linear_reg(penalty = <span>0.1</span>, mixture = <span>1</span>) %&gt;%<br>  set_engine(<span>"glmnet"</span>)<br><br>wf &lt;- workflow() %&gt;%<br>  add_recipe(office_rec)<br><br>lasso_fit &lt;- wf %&gt;%<br>  add_model(lasso_spec) %&gt;%<br>  fit(data = office_train)<br></code></pre><p data-tool="mdnice编辑器">这样模型就拟合好了，如何查看此时的变量系数呢？既然使用了<code>tidymodels</code>，就要了解它的游戏规则，当然是提取出来了。不了解<code>tidymodels</code>的后台回复<strong>tidymodels</strong>即可获取合集链接。</p><pre data-tool="mdnice编辑器"><code>lasso_fit %&gt;%<br>  pull_workflow_fit() %&gt;%<br>  tidy()<br><br><span>## # A tibble: 31 × 3</span><br><span>##    term        estimate penalty</span><br><span>##    &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;</span><br><span>##  1 (Intercept)   8.36       0.1</span><br><span>##  2 season        0          0.1</span><br><span>##  3 episode       0          0.1</span><br><span>##  4 andy          0          0.1</span><br><span>##  5 angela        0          0.1</span><br><span>##  6 darryl        0          0.1</span><br><span>##  7 dwight        0          0.1</span><br><span>##  8 jim           0.0283     0.1</span><br><span>##  9 kelly         0          0.1</span><br><span>## 10 kevin         0          0.1</span><br><span>## # ℹ 21 more rows</span><br></code></pre><p data-tool="mdnice编辑器">一目了然。</p><p data-tool="mdnice编辑器">但是用过<code>glmnet</code>的朋友都知道，它会自动使用100个惩罚值建模，然后你可以从中选择最好的。这个过程有点类似于超参数调优哦~</p><p data-tool="mdnice编辑器">下面我们在<code>tidymodels</code>中实现对惩罚值的调优，也就是找到最适合的惩罚值（即正则化大小）。</p><h2 data-tool="mdnice编辑器"><span></span><span>超参数调优</span><span></span></h2><p data-tool="mdnice编辑器">下面是设定超参数范围的过程，我之前也是详细介绍过了，基本上我的推文都有一个大致的顺序，一般是从简单到复杂，从一般到特殊，前后具有一定的连贯性，所以如果不了解<code>tidymodels</code>并且也没看过之前的推文的小伙伴可能看不太懂，因为解释很少，这时大家可以先去翻看之前的基础介绍，比如这里的超参数调优之前就介绍过了：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzUzOTQzNzU0NA==&amp;mid=2247500283&amp;idx=1&amp;sn=99a6c295f41a3441467b713335f5d48c&amp;scene=21#wechat_redirect" data-linktype="2">tidymodels使用dials设定超参数的值和范围</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzUzOTQzNzU0NA==&amp;mid=2247500647&amp;idx=1&amp;sn=0b59b0ee02f33ccb44ce5742265a6b34&amp;scene=21#wechat_redirect" data-linktype="2">tidymodels决策树规则网格超参数调优</a></section></li></ul><p data-tool="mdnice编辑器">公众号后台回复<strong>tidymodels</strong>即可获取推文合集，一些知识点可翻阅既往推文。</p><pre data-tool="mdnice编辑器"><code>set.seed(<span>1234</span>)<br>office_boot &lt;- bootstraps(office_train, strata = season)<br><br>tune_spec &lt;- linear_reg(penalty = tune(), mixture = <span>1</span>) %&gt;%<br>  set_engine(<span>"glmnet"</span>)<br><br><span># 简单的规则网格</span><br><span>#lambda_grid &lt;- grid_regular(penalty(), levels = 100)</span><br><br><span># 使用空间填充设计：拉丁超立方</span><br>set.seed(<span>1234</span>)<br>lambda_grid &lt;- grid_latin_hypercube(penalty(), size = <span>100</span>)<br></code></pre><p data-tool="mdnice编辑器">然后就是调优过程了，我们这个数据集非常小，所以也不用并行化：</p><pre data-tool="mdnice编辑器"><code>set.seed(<span>2020</span>)<br>lasso_grid &lt;- tune_grid(<br>  wf %&gt;% add_model(tune_spec),<br>  resamples = office_boot,<br>  grid = lambda_grid,<br>  control = control_grid(verbose = <span>FALSE</span>, save_pred = <span>T</span>)<br>)<br></code></pre><p data-tool="mdnice编辑器">查看模型表现：</p><pre data-tool="mdnice编辑器"><code>lasso_grid %&gt;%<br>  collect_metrics()<br><span>## # A tibble: 200 × 7</span><br><span>##     penalty .metric .estimator  mean     n std_err .config               </span><br><span>##       &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                 </span><br><span>##  1 1.13e-10 rmse    standard   0.570    25  0.0115 Preprocessor1_Model001</span><br><span>##  2 1.13e-10 rsq     standard   0.110    25  0.0129 Preprocessor1_Model001</span><br><span>##  3 1.41e-10 rmse    standard   0.570    25  0.0115 Preprocessor1_Model002</span><br><span>##  4 1.41e-10 rsq     standard   0.110    25  0.0129 Preprocessor1_Model002</span><br><span>##  5 1.94e-10 rmse    standard   0.570    25  0.0115 Preprocessor1_Model003</span><br><span>##  6 1.94e-10 rsq     standard   0.110    25  0.0129 Preprocessor1_Model003</span><br><span>##  7 2.16e-10 rmse    standard   0.570    25  0.0115 Preprocessor1_Model004</span><br><span>##  8 2.16e-10 rsq     standard   0.110    25  0.0129 Preprocessor1_Model004</span><br><span>##  9 3.06e-10 rmse    standard   0.570    25  0.0115 Preprocessor1_Model005</span><br><span>## 10 3.06e-10 rsq     standard   0.110    25  0.0129 Preprocessor1_Model005</span><br><span>## # ℹ 190 more rows</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>可视化</span><span></span></h2><p data-tool="mdnice编辑器">做<code>lasso</code>回归肯定是需要把结果画出来的，在<code>tidymodels</code>中我们需要提取数据再画图，需要一定的R语言基础。但是如果你了解<code>tidymodels</code>和<code>ggplot2</code>也是非常简单。</p><pre data-tool="mdnice编辑器"><code>lasso_grid %&gt;%<br>  collect_metrics() %&gt;%<br>  ggplot(aes(penalty, mean, color = .metric)) +<br>  geom_errorbar(aes(<br>    ymin = mean - std_err,<br>    ymax = mean + std_err<br>  ),<br>  alpha = <span>0.5</span>,width=<span>0.2</span>,linewidth=<span>1.2</span><br>  ) +<br>  geom_line(size = <span>1.5</span>) +<br>  facet_wrap(~.metric, scales = <span>"free"</span>, nrow = <span>2</span>) +<br>  scale_x_log10() +<br>  theme(legend.position = <span>"none"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100017080" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84Rib2WqYtzEHOOBL9f7ldtkDiaZDCxZfcNKjnVzSf2cuc3fMKiaO0CnKTA07QKRWbBiaojyI2ofWboLhrg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="504" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84Rib2WqYtzEHOOBL9f7ldtkDiaZDCxZfcNKjnVzSf2cuc3fMKiaO0CnKTA07QKRWbBiaojyI2ofWboLhrg/640?wx_fmt=png&amp;from=appmsg"><figcaption>plot of chunk unnamed-chunk-9</figcaption></figure><p data-tool="mdnice编辑器">这张图同时展示了<code>rmse</code>和<code>rsp</code>两个指标随惩罚值的变化，具体的解释这里就不多介绍了，可以参考之前的推文：<a href="https://mp.weixin.qq.com/s?__biz=MzUzOTQzNzU0NA==&amp;mid=2247499618&amp;idx=1&amp;sn=e2190a6470e1d421eb815d343fc95279&amp;scene=21#wechat_redirect" data-linktype="2">使用glmnet做lasso回归</a></p><h2 data-tool="mdnice编辑器"><span></span><span>确定最终模型</span><span></span></h2><p data-tool="mdnice编辑器">如何确定最好的惩罚值呢？<code>tidymodels</code>也为我们提供了几个好用的函数：</p><p data-tool="mdnice编辑器">查看最好的几个结果：</p><pre data-tool="mdnice编辑器"><code>lasso_grid %&gt;% show_best(<span>"rmse"</span>)<br><span>## # A tibble: 5 × 7</span><br><span>##   penalty .metric .estimator  mean     n std_err .config               </span><br><span>##     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                 </span><br><span>## 1  0.0497 rmse    standard   0.475    25  0.0117 Preprocessor1_Model087</span><br><span>## 2  0.0587 rmse    standard   0.476    25  0.0120 Preprocessor1_Model088</span><br><span>## 3  0.0687 rmse    standard   0.476    25  0.0120 Preprocessor1_Model089</span><br><span>## 4  0.0322 rmse    standard   0.479    25  0.0110 Preprocessor1_Model086</span><br><span>## 5  0.0998 rmse    standard   0.480    25  0.0115 Preprocessor1_Model090</span><br><br>lasso_grid %&gt;% show_best(<span>"rsq"</span>)<br><span>## # A tibble: 5 × 7</span><br><span>##   penalty .metric .estimator  mean     n std_err .config               </span><br><span>##     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                 </span><br><span>## 1  0.0198 rsq     standard   0.123    25  0.0147 Preprocessor1_Model083</span><br><span>## 2  0.0206 rsq     standard   0.123    25  0.0148 Preprocessor1_Model084</span><br><span>## 3  0.0132 rsq     standard   0.122    25  0.0144 Preprocessor1_Model082</span><br><span>## 4  0.0278 rsq     standard   0.121    25  0.0152 Preprocessor1_Model085</span><br><span>## 5  0.0116 rsq     standard   0.121    25  0.0141 Preprocessor1_Model081</span><br></code></pre><p data-tool="mdnice编辑器">选择最好的结果，有点类似于选择<code>glmnet</code>中的<code>lambda.1se/lambda.min</code>：</p><pre data-tool="mdnice编辑器"><code>lasso_grid %&gt;% select_best(<span>"rmse"</span>)<br><span>## # A tibble: 1 × 2</span><br><span>##   penalty .config               </span><br><span>##     &lt;dbl&gt; &lt;chr&gt;                 </span><br><span>## 1  0.0497 Preprocessor1_Model087</span><br></code></pre><p data-tool="mdnice编辑器">我们选择<code>rmse</code>最小的惩罚值，重新建立最终的模型：</p><pre data-tool="mdnice编辑器"><code>lowest_rmse &lt;- lasso_grid %&gt;%<br>  select_best(<span>"rmse"</span>, maximize = <span>FALSE</span>)<br><br>final_lasso &lt;- finalize_workflow(<br>  wf %&gt;% add_model(tune_spec),<br>  lowest_rmse<br>)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>测试集</span><span></span></h2><p data-tool="mdnice编辑器">把最终的模型重新在训练集进行拟合并查看在测试集的表现：</p><pre data-tool="mdnice编辑器"><code>final_lasso %&gt;% last_fit(office_split) %&gt;%<br>  collect_metrics()<br><span>## # A tibble: 2 × 4</span><br><span>##   .metric .estimator .estimate .config             </span><br><span>##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               </span><br><span>## 1 rmse    standard       0.470 Preprocessor1_Model1</span><br><span>## 2 rsq     standard       0.336 Preprocessor1_Model1</span><br></code></pre><p data-tool="mdnice编辑器">搞定！</p><p data-tool="mdnice编辑器">大家觉得和<code>glmnet</code>比起来更喜欢哪种方式呢？</p><p data-tool="mdnice编辑器">我是觉得各有千秋吧，如果只是单纯的想做一下lasso，我觉得还是直接用<code>glmnet</code>更简单一些，如果是需要做多个模型，那肯定还是<code>tidymodels</code>更合适一些。</p></section></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/UdGPhQ3tvkvpUHuPmLgOVA",target="_blank" rel="noopener noreferrer">原文链接</a>
