---
title: "认识TCGA的XENA的转录组测序表达量矩阵"
date: 2022-08-29T05:09:11Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
认识TCGA的XENA的转录组测序表达量矩阵 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>转录组测序表达量矩阵（TCGA的XENA）解析 htseq_counts.tsv.gz，6万多行是因为gtf文件，ensembl的ID，最后五行并不是基因。</p></blockquote><p data-tool="mdnice编辑器">如果你直接搜索TCGA的XENA，只能是看到它的主页：https://xena.ucsc.edu/，它上面比较好用的是一个网页工具。。。</p><p data-tool="mdnice编辑器">但是对我们生信工程师来说，最方便的其实是直接下载其各种ngs组学数据，所以前往：https://xenabrowser.net/datapages ，这里我们讲解的是 GDC TCGA  相关数据库文件，任意选择一个进入即可：</p><pre data-tool="mdnice编辑器"><span></span><code>GDC TCGA Acute Myeloid Leukemia (LAML) (15 datasets)<br>GDC TCGA Adrenocortical Cancer (ACC) (14 datasets)<br>GDC TCGA Bile Duct Cancer (CHOL) (14 datasets)<br>GDC TCGA Bladder Cancer (BLCA) (14 datasets)<br>GDC TCGA Breast Cancer (BRCA) (20 datasets)<br></code></pre><p data-tool="mdnice编辑器">比如我们选择：cohort: GDC TCGA Breast Cancer (BRCA)</p><h3 data-tool="mdnice编辑器"><span></span>生物信息学上游流程<span></span></h3><p data-tool="mdnice编辑器">今天我们要介绍的就是gene expression RNAseq ，它是 HTSeq - Counts (n=1,217) GDC Hub</p><p><img data-galleryid="" data-ratio="0.546079779917469" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibRbn4fcPwsyz0hIhMzlVb53INnZaXskPmwEjGicYiaEU9EypqzFibnpADHFaT6k1GR3Z4zSRl6674gA/640?wx_fmt=png" data-type="png" data-w="727" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibRbn4fcPwsyz0hIhMzlVb53INnZaXskPmwEjGicYiaEU9EypqzFibnpADHFaT6k1GR3Z4zSRl6674gA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">在 https://docs.gdc.cancer.gov/Data/Bioinformatics_Pipelines/Expression_mRNA_Pipeline/ 可以看到其转录组测序表达量矩阵来源的生物信息学流程，主要是比对和定量。</p><p data-tool="mdnice编辑器">其中比对的过程就顺便走了融合基因流程，流程图是：</p><p><img data-galleryid="" data-ratio="0.6156982670744139" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibRbn4fcPwsyz0hIhMzlVb5eGAJh1jk6MxnsSIKTIjsMW8lhawgDsv3TQaic0ibKebWcLksLicGYPSwg/640?wx_fmt=png" data-type="png" data-w="981" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibRbn4fcPwsyz0hIhMzlVb5eGAJh1jk6MxnsSIKTIjsMW8lhawgDsv3TQaic0ibKebWcLksLicGYPSwg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">感兴趣的可以去阅读转录组数据分析实战目录，如下所示：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514751&amp;idx=2&amp;sn=6e08d54d1a8e8ab8bc8a8fa595746ce2&amp;scene=21#wechat_redirect" data-linktype="2">（零）：RNA-seq流程前的准备——Linux与R的环境创建</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514751&amp;idx=3&amp;sn=3444c04722abc568992e6d0f5c65ce2c&amp;scene=21#wechat_redirect" data-linktype="2">（一）：上游数据下载、格式转化和质控清洗</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514824&amp;idx=1&amp;sn=e5648a7cf9f1215a1abdf098de8f375a&amp;scene=21#wechat_redirect" data-linktype="2">（二）：上游数据的比对计数——Hisat2+ featureCounts 与 Salmon</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514824&amp;idx=2&amp;sn=916bbd9e5fe778a0ad51ec8a64fbfadd&amp;scene=21#wechat_redirect" data-linktype="2">（三）：在R里面整理表达量counts矩阵</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514857&amp;idx=4&amp;sn=dcd9ea3efe72502e8ee885088993d854&amp;scene=21#wechat_redirect" data-linktype="2">（四）：差异分析前的准备——数据检查</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514857&amp;idx=5&amp;sn=6c9caffc411fbe459a30ca38140a1166&amp;scene=21#wechat_redirect" data-linktype="2">（五）：差异分析——DESeq2 edgeR limma的使用与比较</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514903&amp;idx=2&amp;sn=ce5a89b0d69bccc2f852946ff1a80a6e&amp;scene=21#wechat_redirect" data-linktype="2">（六）：GO、KEGG富集分析与enrichplot超全可视化攻略</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514903&amp;idx=3&amp;sn=f284597b9b7d152152a40fc8f75902ee&amp;scene=21#wechat_redirect" data-linktype="2">（七）：GSEA——基因集富集分析</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514959&amp;idx=2&amp;sn=76ba7b67967b20fe186afa28fa5992eb&amp;scene=21#wechat_redirect" data-linktype="2">（八）：GSVA——基因集变异分析</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514959&amp;idx=3&amp;sn=d7f0594f07e3051e30f779a08f4ce042&amp;scene=21#wechat_redirect" data-linktype="2">（九）：PPI蛋白互作网络构建（上）——STRING数据库的使用</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514989&amp;idx=3&amp;sn=4a36a1c60cc50dd41499d8a6b04a73e5&amp;scene=21#wechat_redirect" data-linktype="2">（十）：PPI蛋白互作网络构建（下）——Cytoscape软件的使用</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514989&amp;idx=4&amp;sn=6bba059b0de9280da520e2f3862b653e&amp;scene=21#wechat_redirect" data-linktype="2">（十一）：WGCNA加权基因共表达网络分析——关联基因模块与表型</a></section></li></ul><p data-tool="mdnice编辑器">这里需要注意的是定量过程使用的是 htseq-count  这个软件：</p><pre data-tool="mdnice编辑器"><span></span><code>htseq-count \<br>-m intersection-nonempty \<br>-i gene_id \<br>-r pos \<br>-s no \<br>- gencode.v22.annotation.gtf <br></code></pre><p data-tool="mdnice编辑器">而且需要注意是 gencode.v22.annotation.gtf  版本的参考基因组注释文件哦。</p><h3 data-tool="mdnice编辑器"><span></span>表达量矩阵文件<span></span></h3><p data-tool="mdnice编辑器">可以看到这个矩阵文件（TCGA-BRCA.htseq_counts.tsv.gz）其实有点古老了：</p><pre data-tool="mdnice编辑器"><span></span><code>cohort   GDC TCGA Breast Cancer (BRCA)<br>dataset ID   TCGA-BRCA.htseq_counts.tsv<br>download  https://gdc-hub.s3.us-east-1.amazonaws.com/download/TCGA-BRCA.htseq_counts.tsv.gz ; <br>samples  1217<br>version  07-18-2019<br></code></pre><p data-tool="mdnice编辑器">这个链接很方便下载，https://gdc-hub.s3.us-east-1.amazonaws.com/download/TCGA-BRCA.htseq_counts.tsv.gz</p><p data-tool="mdnice编辑器">其主页介绍的很清楚， 这个矩阵列是基因名字，行是每个病人的id</p><p><img data-galleryid="" data-ratio="0.681360201511335" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibRbn4fcPwsyz0hIhMzlVb5PUoMs7qib5kNRcMRqODdQ05vX57HI4lgoTVdvibmia0t76CdHKk0g4y7Q/640?wx_fmt=png" data-type="png" data-w="794" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibRbn4fcPwsyz0hIhMzlVb5PUoMs7qib5kNRcMRqODdQ05vX57HI4lgoTVdvibmia0t76CdHKk0g4y7Q/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>矩阵</figcaption></figure><p data-tool="mdnice编辑器">这个时候的基因名字是ensembl数据库的ID，病人的id是tcga自己命名系统。</p><h3 data-tool="mdnice编辑器"><span></span>ensembl数据库的ID<span></span></h3><p data-tool="mdnice编辑器">一般来说我们定量使用的参考基因组注释文件（比如 gencode.v22.annotation.gtf  版本 ），里面的gene_id也就是Ensembl ID，而gene_name就是我们的gene symbol ID，这些id都有自己的规则系统。</p><p data-tool="mdnice编辑器">在Ensembl数据库中，每一个转录本（或是一条成熟的mRNA）有一个编码，即 transcript ID。</p><ul data-tool="mdnice编辑器"><li><section><p>人类的转录本都由“ENST”加上后面的唯一、固定的11位数字组成，例如：“ENST00000369985”；</p></section></li><li><section><p>其它物种则会在开头字母ENST中插入其它三个字母，如：小鼠的转录本ID由“ENSMUST”开头；</p></section></li><li><section><p>部分 transcript ID的数字后还有小数点，这表示这个ID在数据库中做了几次变更。参考：</p></section></li></ul><p data-tool="mdnice编辑器">Ensemble 一共提供四个数据库服务器访问地址：</p><ul data-tool="mdnice编辑器"><li><section><p>ensembldb.ensembl.org：欧洲服务器，只有该服务器可访问 GRCh37 数据集</p></section></li><li><section><p>useastdb.ensembl.org：美洲服务器</p></section></li><li><section><p>asiadb.ensembl.org：亚洲服务器</p></section></li></ul><p data-tool="mdnice编辑器">https://asia.ensembl.org/Help/View?id=151</p><h3 data-tool="mdnice编辑器"><span></span>tcga的病人id<span></span></h3><p data-tool="mdnice编辑器">TCGA官网有样本命名的规则 ，详见  ：https://docs.gdc.cancer.gov/Encyclopedia/pages/TCGA_Barcode/  ，看完你就明白了 -01A 和 -11A 的区别，虽然很复杂，其实绝大部分小伙伴只需懂Sample列信息即可 ；</p><p><img data-galleryid="" data-ratio="0.8746081504702194" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibRbn4fcPwsyz0hIhMzlVb58SXXTMxwFyOQibLjbD9N3ZKzEZHQCtRxkdAljSU1egjjDhLfibn3Yxpg/640?wx_fmt=png" data-type="png" data-w="957" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibRbn4fcPwsyz0hIhMzlVb58SXXTMxwFyOQibLjbD9N3ZKzEZHQCtRxkdAljSU1egjjDhLfibn3Yxpg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><h3 data-tool="mdnice编辑器"><span></span>这个矩阵数值并不是整数<span></span></h3><p data-tool="mdnice编辑器">细心地小伙伴可能发现了，它矩阵里面的表达量并不是整数，但是我们的转录组定量理论上是数每个基因上面的reads的数量，不应该是小数。所以需要仔细看 官方文档，里面写的是：log2(x+1) transformed.，所以我们读取的时候需要注意，得转换：</p><pre data-tool="mdnice编辑器"><span></span><code><span>## dataset: gene expression RNAseq - HTSeq - Counts </span><br><span>## unit: log2(count+1)</span><br>a &lt;- fread( <span>'TCGA-LAML.htseq_counts.tsv.gz'</span> ,<br>           data.table = F) <span>#全部是symbol</span><br>head(a[ ,1:4])<br>tail(a[ ,1:4])<br><br>mat &lt;- a[1:60483,]<br>mat = a<br>rownames(mat) &lt;- a<span>$Ensembl_ID</span>  <span># keep point</span><br>mat[1:4,1:4]<br>mat &lt;- mat[,-1]<br>mat[1:4,1:4]<br><br><span>## tidy data</span><br>org_dat &lt;- floor(2^mat - 1 ) <span>#floor 返回小于输入值的最大整数值，即输出值将不大于输入值</span><br>org_dat[1:4,1:4] <br><br><span>## filter data</span><br>keep_feature &lt;- rowSums (org_dat &gt; 2) &gt; 10<br>table(keep_feature)<br><br>mat &lt;- org_dat[keep_feature, ]<br>mat &lt;- mat[, colSums(mat) &gt; 1000000]  <span># !!note: can change to get more genes!!</span><br>mat[1:4,1:4]<br>dim(mat) <br>head(colnames(mat))<br></code></pre><p data-tool="mdnice编辑器">而且是 HTSeq - Counts软件定量，这个表达量矩阵它最后的五行其实是需要删除的：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; head(a[ ,1:4])<br>          Ensembl_ID TCGA-AB-2949-03B TCGA-AB-2918-03A TCGA-AB-2943-03A<br>1 ENSG00000000003.13         5.129283         3.700440         5.209453<br>2  ENSG00000000005.5         1.000000         1.000000         0.000000<br>3 ENSG00000000419.11         9.972980         9.885696         9.868823<br>4 ENSG00000000457.12         9.980140        10.052568        10.965784<br>5 ENSG00000000460.15         9.517669         9.823367        10.388017<br>6 ENSG00000000938.11        11.398744        11.913263        11.738937<br>&gt; tail(a[ ,1:4])<br>                  Ensembl_ID TCGA-AB-2949-03B TCGA-AB-2918-03A TCGA-AB-2943-03A<br>60483      ENSGR0000281849.1          0.00000          0.00000          0.00000<br>60484           __no_feature         24.67842         24.44323         24.49330<br>60485            __ambiguous         20.57133         20.50281         20.39089<br>60486        __too_low_aQual          0.00000          0.00000          0.00000<br>60487          __not_aligned          0.00000          0.00000          0.00000<br>60488 __alignment_not_unique         24.61085         24.30559         24.75108<br></code></pre><p data-tool="mdnice编辑器">转换成功之后是：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; mat[1:4,1:4]<br>                   TCGA-AB-2949-03B TCGA-AB-2918-03A TCGA-AB-2943-03A TCGA-AB-2851-03A<br>ENSG00000000003.13               34               12               36                3<br>ENSG00000000419.11             1004              944              934              630<br>ENSG00000000457.12             1009             1060             1999              705<br>ENSG00000000460.15              731              904             1339              317<br></code></pre><h3 data-tool="mdnice编辑器"><span></span>人类基因通常是2万个但是gtf文件里面是6万多个基因<span></span></h3><p data-tool="mdnice编辑器">就需要解析前面的定量过程使用的参考基因组注释文件（比如 gencode.v22.annotation.gtf  版本 ），下载链接是：https://gdc-hub.s3.us-east-1.amazonaws.com/download/gencode.v22.annotation.gene.probeMap</p><pre data-tool="mdnice编辑器"><span></span><code>b &lt;- fread( <span>'gencode.v22.annotation.gene.probeMap'</span> ,header = T, data.table = F)<br>head(b)  <span># ensg has point</span><br>&gt; dim(b)  <br>[1] 60483     6<br><br></code></pre><p data-tool="mdnice编辑器">可以看到确实是6万多个基因，而且里面就有ensembl的数据库的基因的id转换成为基因的名字的信息：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; head(b)  <span># ensg has point</span><br>                 id         gene chrom chromStart chromEnd strand<br>1 ENSG00000223972.5      DDX11L1  chr1      11869    14409      +<br>2 ENSG00000227232.5       WASH7P  chr1      14404    29570      -<br>3 ENSG00000278267.1    MIR6859-3  chr1      17369    17436      -<br>4 ENSG00000243485.3 RP11-34P13.3  chr1      29554    31109      +<br>5 ENSG00000274890.1    MIR1302-9  chr1      30366    30503      +<br>6 ENSG00000237613.2      FAM138A  chr1      34554    36081      -<br></code></pre><p data-tool="mdnice编辑器">我们现在看看这些基因的属性。</p><pre data-tool="mdnice编辑器"><span></span><code>library(AnnoProbe)<br>tmp= annoGene(b<span>$gene</span>,<span>'SYMBOL'</span>)<br>tail(sort(table(tmp<span>$biotypes</span>)))<br></code></pre><p data-tool="mdnice编辑器">可以看到，因为我们使用annoGene函数的时候最新版gtf文件，转换这个v22版本会一半失败：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; tmp= annoGene(b<span>$gene</span>,<span>'SYMBOL'</span>)<br>Warning message:<br>In annoGene(b<span>$gene</span>, <span>"SYMBOL"</span>) :<br>  40.03% of input IDs are fail to annotate... <br></code></pre><p data-tool="mdnice编辑器">6万多个基因里面，留下来的绝大部分都是蛋白质编码基因，他们的基因名字很少变化：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; tail(sort(table(tmp<span>$biotypes</span>)))<br><br>unprocessed_pseudogene <br>                  1352 <br>                 miRNA <br>                  1674 <br>                 snRNA <br>                  1789 <br>                lncRNA <br>                  3818 <br>  processed_pseudogene <br>                  4981 <br>        protein_coding <br>                 18334 <br></code></pre><p data-tool="mdnice编辑器">非编码基因他们的名字是一直在变化的，但是他们的ensembl数据库的id还是可以追踪的，这就是为什么大家并不喜欢使用常规的基因的名字来进行表达量矩阵文件保存。</p></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/IIhLqs5WipObZphNDR-uzw",target="_blank" rel="noopener noreferrer">原文链接</a>
