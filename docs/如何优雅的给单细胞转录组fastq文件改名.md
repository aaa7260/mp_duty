---
title: "如何优雅的给单细胞转录组fastq文件改名"
date: 2023-01-11T09:11:31Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
如何优雅的给单细胞转录组fastq文件改名 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>一般来说，10X技术的单细胞转录组每个样品最好是有3个fq文件，分别是I1,R1,R2，其中I1理论上也可以抛弃，但是呢，很多情况下，我们同一个样品会有多个R1,R2，因为测序的 时候的上机的安排:</p><p><img data-galleryid="" data-ratio="0.6181150550795593" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxogfLbpxJicfo7ZgWvcMj5TFhXicFtCep4o3Y6lNEOic6oIFv2EGtVOPpsurflibFGAa63Sj5FbTL4Ow/640?wx_fmt=png" data-type="png" data-w="1634" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxogfLbpxJicfo7ZgWvcMj5TFhXicFtCep4o3Y6lNEOic6oIFv2EGtVOPpsurflibFGAa63Sj5FbTL4Ow/640?wx_fmt=png"></p><p>就面临改名的问题。比如：</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code>touch {A..X}_S1_L001_R1_001.fastq.gz {A..X}_S1_L001_R2_001.fastq.gz<br>ls *gz|cat |head<br><br>A_S1_L001_R1_001.fastq.gz<br>A_S1_L001_R2_001.fastq.gz<br>B_S1_L001_R1_001.fastq.gz<br>B_S1_L001_R2_001.fastq.gz<br>C_S1_L001_R1_001.fastq.gz<br>C_S1_L001_R2_001.fastq.gz<br>D_S1_L001_R1_001.fastq.gz<br>D_S1_L001_R2_001.fastq.gz<br></code></pre><p data-tool="mdnice编辑器"><strong>这个时候假设我们的 A,B,C,D四个fq文件其实是同一个病人的10x，就需要改名；</strong></p><p data-tool="mdnice编辑器">首先，我们使用如下所示的R代码来模拟的一个情况是：<strong>6个病人的样品，但是有24个fq文件：</strong></p><pre data-tool="mdnice编辑器"><span></span><code>df = data.frame(patients=paste0(<span>'p'</span>,rep(<span>1</span>:<span>6</span>,each=<span>4</span>)),<br>           samples=LETTERS[<span>1</span>:<span>24</span>])<br>df<br></code></pre><p data-tool="mdnice编辑器">每个fq文件都是独立的：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; df<br>   patients samples<br>1        p1       A<br>2        p1       B<br>3        p1       C<br>4        p1       D<br>5        p2       E<br>6        p2       F<br>7        p2       G<br>8        p2       H<br>9        p3       I<br>10       p3       J<br>11       p3       K<br>12       p3       L<br></code></pre><p data-tool="mdnice编辑器">我们其实是需要改名的， 代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><br>s=<span>0</span><br>p=<span>'p1'</span><br>apply(df,<span>1</span>,<span>function</span>(x){<br>  raw=paste0(x[<span>2</span>],<span>'_S1_L001_R1_001.fastq.gz'</span>)<br> <span># ifelse(x[1]==p,s=s+1,s=0)</span><br>  <span>if</span>(x[<span>1</span>]==p){<br>    s&lt;&lt;-s+<span>1</span><br>  }<span>else</span>{<br>    s &lt;&lt;- <span>1</span><br>    p &lt;&lt;- x[<span>1</span>]<br>  }<br>  print(p)<br>  new=paste0(x[<span>1</span>],<span>'_S'</span>,s,<span>'_L001_R1_001.fastq.gz'</span>)<br>  paste0(<span>'mv '</span>,raw,<span>" "</span>, new)<br>})<br><br></code></pre><p data-tool="mdnice编辑器">可以看到，修改名字很成功：</p><pre data-tool="mdnice编辑器"><span></span><code>[1] <span>"mv X_S1_L001_R1_001.fastq.gz p6_S4_L001_R1_001.fastq.gz"</span><br> [1] <span>"mv A_S1_L001_R1_001.fastq.gz p1_S1_L001_R1_001.fastq.gz"</span><br> [2] <span>"mv B_S1_L001_R1_001.fastq.gz p1_S2_L001_R1_001.fastq.gz"</span><br> [3] <span>"mv C_S1_L001_R1_001.fastq.gz p1_S3_L001_R1_001.fastq.gz"</span><br> [4] <span>"mv D_S1_L001_R1_001.fastq.gz p1_S4_L001_R1_001.fastq.gz"</span><br> [5] <span>"mv E_S1_L001_R1_001.fastq.gz p2_S1_L001_R1_001.fastq.gz"</span><br> [6] <span>"mv F_S1_L001_R1_001.fastq.gz p2_S2_L001_R1_001.fastq.gz"</span><br> [7] <span>"mv G_S1_L001_R1_001.fastq.gz p2_S3_L001_R1_001.fastq.gz"</span><br> [8] <span>"mv H_S1_L001_R1_001.fastq.gz p2_S4_L001_R1_001.fastq.gz"</span><br> [9] <span>"mv I_S1_L001_R1_001.fastq.gz p3_S1_L001_R1_001.fastq.gz"</span><br>[10] <span>"mv J_S1_L001_R1_001.fastq.gz p3_S2_L001_R1_001.fastq.gz"</span><br>[11] <span>"mv K_S1_L001_R1_001.fastq.gz p3_S3_L001_R1_001.fastq.gz"</span><br>[12] <span>"mv L_S1_L001_R1_001.fastq.gz p3_S4_L001_R1_001.fastq.gz"</span><br></code></pre><p data-tool="mdnice编辑器">把同一个样品会有多个R1,R2，修改为同样的规则<strong>，这样后续跑单细胞转录组定量流程就很容易啦。</strong></p><h3 data-tool="mdnice编辑器"><span></span>学徒专业<span></span></h3><p data-tool="mdnice编辑器">使用纯shell脚本完成这个改名操作：</p><pre data-tool="mdnice编辑器"><span></span><code>touch {A..X}_S1_L001_R1_001.fastq.gz {A..X}_S1_L001_R2_001.fastq.gz<br></code></pre><p data-tool="mdnice编辑器">26个fq文件的样品，对应的是6个病人，所以修改名字从S字符串开始递增即可。可以仔细观察fastq文件的名字，就会发现规律，如果以下划线为分隔符，那么</p><ul data-tool="mdnice编辑器"><li><section>第2列是S开头可以递增</section></li><li><section>第3列是L开头，可以递增</section></li><li><section>第五列是R1，R1，I1这样的3种情况</section></li></ul></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>正常走cellranger的定量流程即可，代码我已经是多次分享了。参考：</p></blockquote><ul data-tool="mdnice编辑器"><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247512340&amp;idx=3&amp;sn=1b9609a8870a0209dd27ffdcbc3cac87&amp;chksm=9b4bf1afac3c78b90674678fcec66365b9faaa275ff4b0a2255e0a05fa8b905e15222a643bea&amp;scene=21#wechat_redirect" data-linktype="2">10X单细胞转录组原始测序数据的Cell Ranger流程（仅需800元）</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247496813&amp;idx=1&amp;sn=4151bf2265618eff4e0123722c50e569&amp;scene=21#wechat_redirect" data-linktype="2">10X的单细胞转录组原始数据也可以在EBI下载</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247510920&amp;idx=1&amp;sn=c4561d34e984406693c014cdfe236c0f&amp;chksm=9b4beb33ac3c622542d894344c323ff7cca52f69119d02fc7aa4636af0cbe7df4b6c63dd5ba9&amp;scene=21#wechat_redirect" data-linktype="2">一个10x单细胞转录组项目从fastq到细胞亚群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513565&amp;idx=1&amp;sn=092e637017d176c43f00a295d3210592&amp;scene=21#wechat_redirect" data-linktype="2">一文打通单细胞上游：从软件部署到上游分析</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513605&amp;idx=1&amp;sn=e86a329c887745c6d00d3ededa39dcda&amp;chksm=9b4bf6beac3c7fa8523cef4e7189fb20b914460ddb61e6cd1dd520b5928e1b59a8b7827ce783&amp;scene=21#wechat_redirect" data-linktype="2">PRJNA713302这个10x单细胞fastq实战</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513968&amp;idx=1&amp;sn=f5a44a7bea0bdacd8af1a20c177763e5&amp;scene=21#wechat_redirect" data-linktype="2">一次曲折且昂贵的单细胞公共数据获取与上游处理</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514146&amp;idx=1&amp;sn=b9721433d49a2d963eeaab1ad47fc91b&amp;scene=21#wechat_redirect" data-linktype="2">只能下载bam文件的10x单细胞转录组项目数据处理</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247511452&amp;idx=2&amp;sn=83ec97cbc3334a6095e6d63e05e9fd6e&amp;scene=21#wechat_redirect" data-linktype="2">不知道10x单细胞转录组样品和fastq文件的对应关系</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247508521&amp;idx=2&amp;sn=2cf3158e74d37b3a741908d8bfc8f02f&amp;scene=21#wechat_redirect" data-linktype="2">10X单细胞转录组测序数据的 SRA转fastq踩坑那些事</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514395&amp;idx=2&amp;sn=96c505b76ae87dd0efa737c4c44e2270&amp;scene=21#wechat_redirect" data-linktype="2">10x的单细胞转录组fastq文件的R1和R2不能弄混哦</a></section></li></ul><p data-tool="mdnice编辑器">差不多几个小时就可以完成全部的样品的cellranger的定量流程。基础知识非常重要，我们在单细胞天地多次分享过<strong>cellranger</strong>流程的笔记（2019年5月），大家可以自行前往学习，如下：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484146&amp;idx=1&amp;sn=16e09b82d048eed1ff6100b22970abd5&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(一)数据下载</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484179&amp;idx=1&amp;sn=fe84f5243a6021fe6afea128e3ac273a&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(二) cell ranger使用前注意事项</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484206&amp;idx=1&amp;sn=edeebbdd092f79361aee87e9ce086d80&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(三) Cell Ranger使用初探</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484355&amp;idx=1&amp;sn=7860fe0c46073a55d2d3700822c3103b&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(四) Cell Ranger流程概览</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484402&amp;idx=1&amp;sn=95c2be0dc6499e4b1eb9a91d79e584d1&amp;scene=21#wechat_redirect" data-linktype="2">单细胞实战(五) 理解cellranger count的结果</a></section></li></ul></section><ul data-tool="mdnice编辑器" data-darkmode-bgcolor-16340316661513="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16340316661513="#fff|rgb(255, 255, 255)" data-darkmode-color-16340316661513="rgb(163, 163, 163)" data-darkmode-original-color-16340316661513="#fff|rgb(0, 0, 0)" data-style='margin-top: 8px; margin-bottom: 8px; padding-left: 25px; width: 577.422px; white-space: normal; outline: 0px; letter-spacing: 0.544px; background-color: rgb(255, 255, 255); caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, "PingFang SC", Cambria, Cochin, Georgia, Times, "Times New Roman", serif; font-size: 16px; text-align: left; text-size-adjust: auto;' mp-original-font-size="16" mp-original-line-height="25.600000381469727"><li><p data-darkmode-bgcolor-16340316661513="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16340316661513="#fff|rgb(255, 255, 255)" data-darkmode-color-16340316661513="rgb(163, 163, 163)" data-darkmode-original-color-16340316661513="#fff|rgb(0, 0, 0)" mp-original-font-size="16" mp-original-line-height="25.600000381469727"><span data-darkmode-bgcolor-16340316661513="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16340316661513="#fff|rgb(255, 255, 255)" data-darkmode-color-16340316661513="rgb(163, 163, 163)" data-darkmode-original-color-16340316661513="#fff|rgb(0, 0, 0)" mp-original-font-size="16" mp-original-line-height="25.600000381469727">如果你有单细胞转录组测序的原始fastq数据，或者想处理公共数据，都可以扫描下面二维码即可添加微信咨询！</span></p><section data-darkmode-bgcolor-16340316661513="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16340316661513="#fff|rgb(255, 255, 255)" data-darkmode-color-16340316661513="rgb(163, 163, 163)" data-darkmode-original-color-16340316661513="#fff|rgb(0, 0, 0)" mp-original-font-size="16" mp-original-line-height="NaN">（添加好友务必备注 高校或者工作单位+姓名，方便后续认识）</section></li><li><p data-darkmode-bgcolor-16340316661513="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16340316661513="#fff|rgb(255, 255, 255)" data-darkmode-color-16340316661513="rgb(163, 163, 163)" data-darkmode-original-color-16340316661513="#fff|rgb(0, 0, 0)|rgb(62, 62, 62)" data-style='outline: 0px; caret-color: rgb(51, 51, 51); text-size-adjust: auto; letter-spacing: 2px; color: rgb(62, 62, 62); font-family: "Helvetica Neue", Helvetica, "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif; font-size: 15px; word-spacing: 2px; text-align: center;' mp-original-font-size="15" mp-original-line-height="24"><img data-ratio="1.1700680272108843" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxvmNvIclfRGEpWuxOMxdq2rJV1jmplnEuXDDDPfEsMLbHvLCWVX4uFobR9uj6JQfxMysCQyyK9wg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="294" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxvmNvIclfRGEpWuxOMxdq2rJV1jmplnEuXDDDPfEsMLbHvLCWVX4uFobR9uj6JQfxMysCQyyK9wg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p></li></ul><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/fX0jzz9U-fc_PHa0gHV4XQ",target="_blank" rel="noopener noreferrer">原文链接</a>
