---
title: "跟着NatureMetabolism学作图：R语言ggplot2转录组差异表达火山图"
date: 2022-09-21T23:56:33Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Acdemic"]
---
跟着NatureMetabolism学作图：R语言ggplot2转录组差异表达火山图 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><h2 data-tool="mdnice编辑器"><span></span><span>论文</span><span></span><span> </span></h2><blockquote data-tool="mdnice编辑器"><p>Independent phenotypic plasticity axes define distinct obesity sub-types</p></blockquote><p data-tool="mdnice编辑器">https://www.nature.com/articles/s42255-022-00629-2#Sec15</p><p data-tool="mdnice编辑器"><code>s42255-022-00629-2.pdf</code></p><p data-tool="mdnice编辑器">论文中没有公开代码，但是所有作图数据都公开了，我们可以试着用论文中提供的数据模仿论文中的图</p><p data-tool="mdnice编辑器">今天的推文重复一下论文中的Fig3b 差异表达火山图，之前也有推文介绍过火山图，今天的推文主要学习的一个知识点是利用<code>latex2exp</code>这个R包添加文本，包括</p><ul data-tool="mdnice编辑器"><li><section>上下标</section></li><li><section>换行 换行的基本写法</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>ggplot()+<br>  geom_point(aes(x=1,y=1))+<br>  labs(x=TeX(r<span>"(\overset<span>${ABCDEF}</span>{abcde}$)"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.4083820662768031" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6ppFgViad1x9wBNzpXwlhIiaI5CicpZoSvLeQYo7j9m3oqjy3wgzo2j84P5Z0SnZoPhKmBXX1Ymodlg/640?wx_fmt=png" data-type="png" data-w="1026" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6ppFgViad1x9wBNzpXwlhIiaI5CicpZoSvLeQYo7j9m3oqjy3wgzo2j84P5Z0SnZoPhKmBXX1Ymodlg/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>火山图的部分示例数据</span><span></span><span> </span></h2><figure data-tool="mdnice编辑器"><img data-ratio="0.26129032258064516" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6ppFgViad1x9wBNzpXwlhIia4tAFAJfsKvSkU1TgeupONoDzVySjJicmtkjFSHubRm6JgQJ8mqOLW8Q/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6ppFgViad1x9wBNzpXwlhIia4tAFAJfsKvSkU1TgeupONoDzVySjJicmtkjFSHubRm6JgQJ8mqOLW8Q/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>读取数据</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(readr)<br>df&lt;-read_tsv(<span>"data/20220921/fig3b.txt"</span>)<br>head(df)<br>colnames(df)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>添加差异表达的分组</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>df %&gt;% <br>  mutate(change=case_when(<br>    log2FoldChange &gt; 1 &amp; pvalue &lt; 0.05 ~ <span>"Up"</span>,<br>    log2FoldChange &lt; -1 &amp; pvalue &lt; 0.05 ~ <span>"Down"</span>,<br>    TRUE ~ <span>"Not Sig"</span><br>  )) -&gt; new.df<br><br>table(new.df<span>$change</span>)<br>new.df %&gt;% <br>  filter(-log10(pvalue)&gt;8) -&gt; new.text.label<br></code></pre><p data-tool="mdnice编辑器">这里没有找到论文中差异表达的标准，这里是我随便写的</p><h2 data-tool="mdnice编辑器"><span></span><span>作图代码</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(ggplot2)<br>library(ggrepel)<br>library(latex2exp)<br>ggplot(data=new.df,aes(x=log2FoldChange,y=-log10(pvalue)))+<br>  geom_point(aes(color=change))+<br>  scale_color_manual(values = c(<span>"Down"</span>=<span>"#3a53a4"</span>,<br>                                <span>"Not Sig"</span>=<span>"#aaaaaa"</span>,<br>                                <span>"Up"</span>=<span>"#7acde4"</span>),<br>                     labels=c(<span>"Down"</span>=TeX(r<span>"(\textit{Nnat}<span>${^+}</span>$<span>${^/}</span>$<span>${^-}</span>$<span>${^p}</span>$-\textit{Heavy} depleted)"</span>),<br>                              <span>"Not Sig"</span>=<span>"Not Significant"</span>,<br>                              <span>"Up"</span> = TeX(r<span>"(\textit{Nnat}<span>${^+}</span>$<span>${^/}</span>$<span>${^-}</span>$<span>${^p}</span>$-\textit{Heavy} enriched)"</span>)))+<br>  theme_classic()+<br>  theme(legend.position = c(0.2,0.9),<br>        legend.text.align = 0,<br>        legend.title = element_blank())+<br>  geom_text_repel(data=new.text.label,<br>                  aes(x=log2FoldChange,y=-log10(pvalue),<br>                      label=mgi_symbol))+<br>  labs(x=TeX(r<span>"(\overset<span>${\textit{Nnat}</span>{^+}{^/}{^-}{^p}-\textit{Lean}$ versus $\textit{Nnat}{^+}{^/}{^-}{^p}-\textit{Giant}}{(log{_2}$ fold <span>$change</span>)}$)"</span>),<br>       y=TeX(r<span>"(-log<span>${_1}</span>{_0}$ {(}\textit{P}{ value}{)})"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6ppFgViad1x9wBNzpXwlhIia78RwQXH8F4meicm83Ie9ud7GQ05WZge1buMSIRV1xcxTfibMy541iaDicQ/640?wx_fmt=png" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6ppFgViad1x9wBNzpXwlhIia78RwQXH8F4meicm83Ie9ud7GQ05WZge1buMSIRV1xcxTfibMy541iaDicQ/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>制作封面图</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>p1&lt;-ggplot(data=new.df,aes(x=log2FoldChange,y=-log10(pvalue)))+<br>  geom_point(aes(color=change))+<br>  scale_color_manual(values = c(<span>"Down"</span>=<span>"#3a53a4"</span>,<br>                                <span>"Not Sig"</span>=<span>"#aaaaaa"</span>,<br>                                <span>"Up"</span>=<span>"#7acde4"</span>),<br>                     labels=c(<span>"Down"</span>=TeX(r<span>"(\textit{Nnat}<span>${^+}</span>$<span>${^/}</span>$<span>${^-}</span>$<span>${^p}</span>$-\textit{Heavy} depleted)"</span>),<br>                              <span>"Not Sig"</span>=<span>"Not Significant"</span>,<br>                              <span>"Up"</span> = TeX(r<span>"(\textit{Nnat}<span>${^+}</span>$<span>${^/}</span>$<span>${^-}</span>$<span>${^p}</span>$-\textit{Heavy} enriched)"</span>)))+<br>  theme_classic()+<br>  theme(legend.position = c(0.2,0.9),<br>        legend.text.align = 0,<br>        legend.title = element_blank())+<br>  geom_text_repel(data=new.text.label,<br>                  aes(x=log2FoldChange,y=-log10(pvalue),<br>                      label=mgi_symbol))+<br>  labs(x=TeX(r<span>"(\overset<span>${\textit{Nnat}</span>{^+}{^/}{^-}{^p}-\textit{Lean}$ versus $\textit{Nnat}{^+}{^/}{^-}{^p}-\textit{Giant}}{(log{_2}$ fold <span>$change</span>)}$)"</span>),<br>       y=TeX(r<span>"(-log<span>${_1}</span>{_0}$ {(}\textit{P}{ value}{)})"</span>))<br><br>p2&lt;-ggplot(data=new.df,aes(x=log2FoldChange,y=-log10(pvalue)))+<br>  geom_point(aes(color=change))+<br>  scale_color_manual(values = c(<span>"Down"</span>=<span>"red"</span>,<br>                                <span>"Not Sig"</span>=<span>"#aaaaaa"</span>,<br>                                <span>"Up"</span>=<span>"darkgreen"</span>),<br>                     labels=c(<span>"Down"</span>=TeX(r<span>"(\textit{Nnat}<span>${^+}</span>$<span>${^/}</span>$<span>${^-}</span>$<span>${^p}</span>$-\textit{Heavy} depleted)"</span>),<br>                              <span>"Not Sig"</span>=<span>"Not Significant"</span>,<br>                              <span>"Up"</span> = TeX(r<span>"(\textit{Nnat}<span>${^+}</span>$<span>${^/}</span>$<span>${^-}</span>$<span>${^p}</span>$-\textit{Heavy} enriched)"</span>)))+<br>  theme_classic()+<br>  theme(legend.position = c(0.2,0.9),<br>        legend.text.align = 0,<br>        legend.title = element_blank())+<br>  geom_text_repel(data=new.text.label,<br>                  aes(x=log2FoldChange,y=-log10(pvalue),<br>                      label=mgi_symbol))+<br>  labs(x=TeX(r<span>"(\overset<span>${\textit{Nnat}</span>{^+}{^/}{^-}{^p}-\textit{Lean}$ versus $\textit{Nnat}{^+}{^/}{^-}{^p}-\textit{Giant}}{(log{_2}$ fold <span>$change</span>)}$)"</span>),<br>       y=TeX(r<span>"(-log<span>${_1}</span>{_0}$ {(}\textit{P}{ value}{)})"</span>))<br><br>library(patchwork)<br>pdf(file = <span>"Rplot03.pdf"</span>,width = 14.1,height = 6)<br>p1+p2<br>dev.off()<br><br></code></pre><figure data-tool="mdnice编辑器"><img data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6ppFgViad1x9wBNzpXwlhIiaCzwCO6KDiaaeiaSqkZFUPUxII9otQq6rKRW5ibibqkMyOsTw9zJGiaicC8sg/640?wx_fmt=png" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6ppFgViad1x9wBNzpXwlhIiaCzwCO6KDiaaeiaSqkZFUPUxII9otQq6rKRW5ibibqkMyOsTw9zJGiaicC8sg/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><p>示例数据和代码可以给推文点赞 点击在看 最后留言获取</p></blockquote><p data-tool="mdnice编辑器">欢迎大家关注我的公众号</p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzI3NzQ3MTcxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5t1sOnM0iabvBhnfIj5YpyqrMib0E1MGCd9ibcYxaOPZd0GWhQBDvK2BPEwsicQxd6y5MHLfphnwHnow/0?wx_fmt=png" data-nickname="小明的数据分析笔记本" data-alias="" data-signature="数据分析和数据可视化有意思的简单小例子~石榴研究生的笔记本" data-from="0" data-is_biz_ban="0"></mp-common-profile><br></section><blockquote data-tool="mdnice编辑器"><p>小明的数据分析笔记本 公众号 主要分享：1、R语言和python做数据分析和数据可视化的简单小例子；2、园艺植物相关转录组学、基因组学、群体遗传学文献阅读笔记；3、生物信息学入门学习资料及自己的学习笔记！</p></blockquote></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Yi3umNgoM389y85GYTgc2g",target="_blank" rel="noopener noreferrer">原文链接</a>
