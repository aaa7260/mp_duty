---
title: "如何作出类似Nature子刊中的决策树? 让你的技能+1!"
date: 2022-08-31T02:53:16Z
draft: ["false"]
tags: [
  "fetched",
  "R语言和统计"
]
categories: ["Acdemic"]
---
如何作出类似Nature子刊中的决策树? 让你的技能+1! by R语言和统计
------
<div><p data-mpa-powered-by="yiban.io"><br></p><p><img data-backh="153" data-backw="561" data-ratio="0.27268959801077497" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCBySSvQZApWFK0VibtNFkfpXnIllmRXwOcniad2NIWL6dSmxsoSQlxlZJkcu3ibMf9HlNseD8p3PpD3h8A/640?wx_fmt=png" data-type="png" data-w="2413" src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCBySSvQZApWFK0VibtNFkfpXnIllmRXwOcniad2NIWL6dSmxsoSQlxlZJkcu3ibMf9HlNseD8p3PpD3h8A/640?wx_fmt=png"></p><p><br></p><p><span>小编阅读到一篇<span>发表在《</span>Nature machine intelligence》的论文，名为“An interpretable mortality prediction model for COVID-19 patients” </span><span>[1]</span><span>。</span></p><p><br></p><p><span>论文作者共分析了485例新冠病人的临床数据，包括基本信息，症状的严重程度，血液样本和实验室检查，如肝功能，肾功能，凝血功能，电解质与炎症因子。</span></p><p><br></p><p><span>根据受试者的预后（生存/死亡）建立了一个准确度达90%的single-tree XGBoost的预测模型，见下图： </span></p><section><br></section><section><img data-croporisrc="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCBySSvQZApWFK0VibtNFkfpXnIXarNvyyDr39AqvNXYZdrBWWyOibaFYZv8CRiaC9hjob89lezsAyYt9uw/640?wx_fmt=png" data-cropx1="26.21359223300971" data-cropx2="1080" data-cropy1="0" data-cropy2="920.0970873786408" data-ratio="0.872865275142315" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/pCu8RzQCByTeyOzzTnpRZxsaFIWRzqgUqqA2lQw5WqW5ecRHDWXSDlPlv09bIricCvb3hB6f0icWSBKrnAz2mg6w/640?wx_fmt=jpeg" data-type="jpeg" data-w="1054" src="https://mmbiz.qpic.cn/mmbiz_jpg/pCu8RzQCByTeyOzzTnpRZxsaFIWRzqgUqqA2lQw5WqW5ecRHDWXSDlPlv09bIricCvb3hB6f0icWSBKrnAz2mg6w/640?wx_fmt=jpeg"></section><section><span>图片来源 <span>[1]</span></span></section><section><br></section><p><span>决策树，因它的简洁易懂并且同时具备不错的预测准确性而深受研究者喜欢。</span></p><p><br></p><p><span>我们今天的任务就是作出类似上图的决策树。</span></p><p><br></p><p><span>马上进入操作部分</span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByREun8lUbavNDN3suJnWR83vSu1nHWvSXSXj04b2RY4p89tXMEKk5PhvrthjiarzRvGkibCEUib3vXhA/640?wx_fmt=png" data-type="png" data-w="20" src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByREun8lUbavNDN3suJnWR83vSu1nHWvSXSXj04b2RY4p89tXMEKk5PhvrthjiarzRvGkibCEUib3vXhA/640?wx_fmt=png"><span>！</span></p><p><br></p><section><span>首先，安装所需R包</span><span>{treeheatr}</span><span>，关于此R包的详细内容请查看参考文献 </span><span>[2]</span><span>： </span></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span><span>install</span><span>.packages</span>(</span><span>"treeheatr"</span><span>)<br mpa-from-tpl="t"></span><span>library</span><span>(treeheatr)</span></code></pre></section><p><br></p><section><span>下一步，使用到的数据是R自带的"iris"，来查看一下数据： <br></span></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span><span>summary</span>(iris)</span></code></pre></section><section><br></section><p><img data-galleryid="" data-ratio="0.20476190476190476" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByQFwc5c1tFXPwHHaVZuBb5amyowaOlQicsQYXfk2QS3eiaOaUicBOPzvgML078h6okicdXiaQHbSc5HAXQ/640?wx_fmt=png" data-type="png" data-w="1260" src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByQFwc5c1tFXPwHHaVZuBb5amyowaOlQicsQYXfk2QS3eiaOaUicBOPzvgML078h6okicdXiaQHbSc5HAXQ/640?wx_fmt=png"></p><section><br></section><p><span>在下面的作图中，Species将作为因变量，其他变量作为预测变量（predictors）。</span></p><p><span><br></span></p><p><span>制作决策树：</span></p><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span><span>heat_tree</span>(iris, target_lab = </span><span>"Species"</span><span>)</span></code></pre></section><p><br></p><p><img data-galleryid="" data-ratio="0.7061340941512125" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByT1zFEhl8XiaUlQfInaLvgfIkibx95zV0MmTGpxzAs3NuXdgxO9yy2SfqUWfLZElByFXfNqxNmllydA/640?wx_fmt=png" data-type="png" data-w="1402" src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByT1zFEhl8XiaUlQfInaLvgfIkibx95zV0MmTGpxzAs3NuXdgxO9yy2SfqUWfLZElByFXfNqxNmllydA/640?wx_fmt=png"></p><p><br></p><section><span>一行代码搞定，很简单有没有</span><img data-ratio="1" data-type="png" data-w="20" data-src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByREun8lUbavNDN3suJnWR83MaguPdAdGH2eyIoGIsHSt7KzGGnOFSbWMXLNESuu5D3WcBmia2o9Fxg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByREun8lUbavNDN3suJnWR83MaguPdAdGH2eyIoGIsHSt7KzGGnOFSbWMXLNESuu5D3WcBmia2o9Fxg/640?wx_fmt=png"><span>！<br></span></section><section><br></section><section><span>不过，要完全读懂上图则需要再加把劲</span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByREun8lUbavNDN3suJnWR83eiaBeKQy2TCX4kZkyhqbAZqveZ2icZcQBu3HdMw0pYmgtDMWBtXKGSbA/640?wx_fmt=png" data-type="png" data-w="20" src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByREun8lUbavNDN3suJnWR83eiaBeKQy2TCX4kZkyhqbAZqveZ2icZcQBu3HdMw0pYmgtDMWBtXKGSbA/640?wx_fmt=png"><span>：</span></section><section><br></section><section><span>此图主要由上下两大部分组成：决策树与热图。</span></section><section><span><br></span></section><p><span>heat_tree()</span><span>根据默认的参数筛选出两个最重要的变量（Petal.Width和Petal.Length）从而建立了这颗“树”。根据两个变量的数值大小进行Species的分类（classification）或诊断（diagnosis）。</span></p><section><br></section><section mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section><span>首先看决策树部分的最上端，Petal.Length ≤ 1.9则分向左侧，诊断为“setosa”。其中，setosa下方的颜色为紫色，并且纯度很高（无参杂其它颜色），代表模型的准确度高。<br></span></section><section><br></section><section><span>决策树中Petal.Length &gt; 1.9则分向右侧。看中间部分，Petal.Length（≤4.8 | &gt; 4.8）两分支虽然都为versicolor，但右分支下方的颜色纯度不高，提示中间部分右分支（&gt;4.8）的模型准确度相较于左侧低。</span></section><section><br></section><section><span>热图部分中的两行（Petal.Width与Petal.Length）是纳入“决策树”的两个变量。在每一行中，一个“竖着的长方形”即代表一个样本的数值，颜色越亮（或越黄）代表数值越大；反之，则越小。</span></section><section><span><br></span></section></section></section></section></section><section><span>还可以任意修改图片颜色，因为一共有三组，所以添加三种颜色：</span><span> </span></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span><span>heat_tree</span>(iris, target_lab = </span><span>"Species"</span><span>,<br mpa-from-tpl="t">          target_cols = c(</span><span>"red"</span><span>, </span><span>"royalblue1"</span><span>, </span><span>"palegreen3"</span><span>)) </span><span># 修改颜色</span></code></pre></section><p><br></p><p><img data-ratio="0.6171428571428571" data-src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByTeyOzzTnpRZxsaFIWRzqgUXvMK76b7oyRBibribicowcb5kFCoF7d6ScfcEAdamMZibz9WkWU1iaqWTBQ/640?wx_fmt=png" data-type="png" data-w="700" src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByTeyOzzTnpRZxsaFIWRzqgUXvMK76b7oyRBibribicowcb5kFCoF7d6ScfcEAdamMZibz9WkWU1iaqWTBQ/640?wx_fmt=png"><br></p><p><br></p><section><span>因为</span><span>heat_tree()</span><span>函数只筛选出最重要的两个，我们可以选择将四个变量全部在热图中展示： <br></span></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>heat_tree(iris, target_lab = </span><span>"Species"</span><span>, <br mpa-from-tpl="t">          show_all_feats = </span><span>TRUE</span><span>)</span></code></pre></section><p><br></p><p><img data-galleryid="" data-ratio="0.7073170731707317" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByT1zFEhl8XiaUlQfInaLvgfInibkR6K9qicLtHPKhaZamIjiblFGG2gcBMcn3Bv6iaJpicGicYPuGyoIbqCg/640?wx_fmt=png" data-type="png" data-w="1394" src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByT1zFEhl8XiaUlQfInaLvgfInibkR6K9qicLtHPKhaZamIjiblFGG2gcBMcn3Bv6iaJpicGicYPuGyoIbqCg/640?wx_fmt=png"></p><section><br></section><section><span>也可以将各个分类组别之间的距离加宽一些： <br></span></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span><span>heat_tree</span>(iris, target_lab = </span><span>"Species"</span><span>, <br mpa-from-tpl="t">          panel_space = </span><span>0.03</span><span>)   </span><span># 调整组别间的距离</span></code></pre></section><p><br></p><p><img data-galleryid="" data-ratio="0.7073170731707317" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByT1zFEhl8XiaUlQfInaLvgfIZyMfqgMy07ZJpcDmyh2uW26zNHfFYreRrrUm9gQNtXUBmc5KBUGiaHg/640?wx_fmt=png" data-type="png" data-w="1394" src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByT1zFEhl8XiaUlQfInaLvgfIZyMfqgMy07ZJpcDmyh2uW26zNHfFYreRrrUm9gQNtXUBmc5KBUGiaHg/640?wx_fmt=png"></p><section><br></section><section><span>如果有小伙伴只想要决策树，也可以去掉热图部分<img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByREun8lUbavNDN3suJnWR832BQqrevYTAM0ibfQqx8pxHMn5ydKg9mUdCd1w4MeOU5f0Mm8lQzvk0g/640?wx_fmt=png" data-type="png" data-w="20" src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByREun8lUbavNDN3suJnWR832BQqrevYTAM0ibfQqx8pxHMn5ydKg9mUdCd1w4MeOU5f0Mm8lQzvk0g/640?wx_fmt=png">： </span></section><p><span><br mpa-from-tpl="t"></span></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span><span>heat_tree</span>(iris, target_lab = </span><span>"Species"</span><span>,<br mpa-from-tpl="t">          show = </span><span>"tree-only"</span><span>)  </span><span># 只显示决策树</span></code></pre></section><p><br></p><p><img data-galleryid="" data-ratio="0.8916967509025271" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByT1zFEhl8XiaUlQfInaLvgfIx7TUewOIsnibTfsnJ98qwDIIBCxk4SQZebBb1qMIzE3nlibs95FRbbTg/640?wx_fmt=png" data-type="png" data-w="1108" src="https://mmbiz.qpic.cn/mmbiz_png/pCu8RzQCByT1zFEhl8XiaUlQfInaLvgfIx7TUewOIsnibTfsnJ98qwDIIBCxk4SQZebBb1qMIzE3nlibs95FRbbTg/640?wx_fmt=png"></p><section><br></section><p><span>好啦，今天的内容就到这里。</span></p><p><span><br></span></p><p><span>如果有帮助，记得分享给需要的人！<img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/U1ACLSJ0M9uMhtNcMKNjwgLB5L7lUD0JZV8wYwcy0PJ8NTMgQ9LI4044icTEJ2nqOfJOZib79icPP72uVWsMry2zg/640?wx_fmt=png" data-type="png" data-w="20" src="https://mmbiz.qpic.cn/mmbiz_png/U1ACLSJ0M9uMhtNcMKNjwgLB5L7lUD0JZV8wYwcy0PJ8NTMgQ9LI4044icTEJ2nqOfJOZib79icPP72uVWsMry2zg/640?wx_fmt=png"></span></p><section><br></section><section><span>参考文献：</span></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><section><span><span>1. </span>An interpretable mortality prediction model for COVID-19 patients, nature machine intelligence.<br mpa-from-tpl="t"><span>2. </span>treeheatr: an R package for interpretable decision tree visualizations<span>, Bioinf</span><span>ormatics.</span></span></section></pre></section><section><br></section><section><span>▌本文由</span><span><strong mpa-from-tpl="t"><span>R语言和统计</span></strong></span><span>首发，如需转载请联系我们</span></section><section><span>▌课程相关咨询可添加R师妹微信: kefu_rstats</span></section><section><span>▌编辑：June</span></section><section><span>▌邮箱：contact@rstats.cn</span></section><section><span>▌网站：www.rstats.cn</span></section><section><span>▌<strong>我们致力于</strong><strong>让R语言和统计变得简单！</strong></span></section><p data-mid=""><br></p><hr><p data-mid=""><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/QqXUBaSEU2W5D6WmsuGlng",target="_blank" rel="noopener noreferrer">原文链接</a>
