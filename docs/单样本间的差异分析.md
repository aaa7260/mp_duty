---
title: "单样本间的差异分析"
date: 2022-12-28T08:59:57Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
单样本间的差异分析 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>缘起</span><span></span></h2><p data-tool="mdnice编辑器">前两天，曾老师给了我一个8个样本8个组别的转录组数据，即每组只有一个样本的转录组数据。一看到这个数据，还是感到挺震惊的，毕竟作者这样太节省经费了。前面的推文中多次提到了1V1，想了想，此次就用之前的1V1转录组处理流程与原文简单比较下吧。虽然作者没有提供上游处理完的count矩阵，所幸，曾老师那有处理好的count矩阵。接下来，就让我们用count矩阵走自身1V1的流程，与作者的原文结果比较一下吧。</p><h2 data-tool="mdnice编辑器"><span></span><span>探究</span><span></span></h2><p data-tool="mdnice编辑器">今天，我们使用的转录组数据集源自2019年发表在Diabetes杂志上，文献名称为Sarm1 Gene Defificiency Attenuates Diabetic Peripheral Neuropathy in Mice。该数据集由8个样本组成，每个样本代表一个分组。</p><h2 data-tool="mdnice编辑器"><span></span><span>转录组数据集介绍</span><span></span></h2><p data-tool="mdnice编辑器">该数据集提交在ENA官网，其PRJ项目号是PRJNA540413。若有小伙伴想从上游开始处理，具体数据下载链接见 <span>https://www.ebi.ac.uk/ena/browser/view/PRJNA540413</span>。该数据集有8个组别，但是8个组别中分为两个部位，SC与SN，处理中含基因敲除鼠与WT鼠，以及STZ处理与药物处理。<img data-ratio="0.934487021013597" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosichIDQS2KBeicG0EhXOtbz4xkSoclhuf1OfRKVmBZwyZu7YJK1EuxCuIzP4UVdswYicgNLB1mJQEu6Q/640?wx_fmt=png" data-type="png" data-w="809" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosichIDQS2KBeicG0EhXOtbz4xkSoclhuf1OfRKVmBZwyZu7YJK1EuxCuIzP4UVdswYicgNLB1mJQEu6Q/640?wx_fmt=png"></p><h2 data-tool="mdnice编辑器"><span></span><span>正式分析</span><span></span></h2><h3 data-tool="mdnice编辑器"><span></span><span><span></span>1.清空环境，加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br><span>library</span>(edgeR)<br><span>library</span>(DESeq2)<br><span>library</span>(FactoMineR)<br><span>library</span>(factoextra)<br><span>library</span>(clusterProfiler)<br><span>library</span>(org.Hs.eg.db)<br><span>library</span>(org.Mm.eg.db)<br><span>library</span>(stringr)<br><span>library</span>(stringi)<br><span>library</span>(tidyverse)<br><span>library</span>(ggplot2)<br><span>library</span>(patchwork)<br><span>library</span>(pheatmap)<br><span>library</span>(VennDiagram)<br><span>library</span>(RColorBrewer)<br><span>library</span>(patchwork)<br><span>library</span>(ggplotify)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2.读取count数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>rawcount &lt;- read.table(<span>"./all_trim.id.txt"</span>,header = <span>T</span>,sep=<span>"\t"</span>,row.names = <span>1</span>)<br>colnames(rawcount)<br><span>##  [1] "Chr"                 "Start"               "End"                </span><br><span>##  [4] "Strand"              "Length"              "SRR8988890.sort.bam"</span><br><span>##  [7] "SRR8988891.sort.bam" "SRR8988892.sort.bam" "SRR8988893.sort.bam"</span><br><span>## [10] "SRR8988894.sort.bam" "SRR8988895.sort.bam" "SRR8988896.sort.bam"</span><br><span>## [13] "SRR8988897.sort.bam"</span><br>rawcount[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br><span>##                                                     Chr</span><br><span>## ENSMUSG00000102693.1                               chr1</span><br><span>## ENSMUSG00000064842.1                               chr1</span><br><span>## ENSMUSG00000051951.5 chr1;chr1;chr1;chr1;chr1;chr1;chr1</span><br><span>## ENSMUSG00000102851.1                               chr1</span><br><span>##                                                                        Start</span><br><span>## ENSMUSG00000102693.1                                                 3073253</span><br><span>## ENSMUSG00000064842.1                                                 3102016</span><br><span>## ENSMUSG00000051951.5 3205901;3206523;3213439;3213609;3214482;3421702;3670552</span><br><span>## ENSMUSG00000102851.1                                                 3252757</span><br><span>##                                                                          End</span><br><span>## ENSMUSG00000102693.1                                                 3074322</span><br><span>## ENSMUSG00000064842.1                                                 3102125</span><br><span>## ENSMUSG00000051951.5 3207317;3207317;3215632;3216344;3216968;3421901;3671498</span><br><span>## ENSMUSG00000102851.1                                                 3253236</span><br><span>##                             Strand</span><br><span>## ENSMUSG00000102693.1             +</span><br><span>## ENSMUSG00000064842.1             +</span><br><span>## ENSMUSG00000051951.5 -;-;-;-;-;-;-</span><br><span>## ENSMUSG00000102851.1             +</span><br><br><span># 本身就是基因表达矩阵（无需降重与ID转换）；选择二分组的样本</span><br>rawcount=rawcount[,<span>6</span>:<span>13</span>]<br>keep &lt;- rowSums(rawcount&gt;<span>0</span>) &gt;= floor(<span>0.75</span>*ncol(rawcount))<br>filter_count &lt;- rawcount[keep,] <span>#获得filter_count矩阵</span><br>express_cpm &lt;- log2(cpm(filter_count)+ <span>1</span>)<br>express_cpm[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>] <span>#获得cpm矩阵</span><br><span>##                       SRR8988890.sort.bam SRR8988891.sort.bam</span><br><span>## ENSMUSG00000051951.5            1.5845466           1.6597803</span><br><span>## ENSMUSG00000102331.1            0.5182788           0.6228564</span><br><span>## ENSMUSG00000025900.13           0.2167244           0.2165807</span><br><span>## ENSMUSG00000025902.13           3.7177481           3.7461175</span><br><span>##                       SRR8988892.sort.bam SRR8988893.sort.bam</span><br><span>## ENSMUSG00000051951.5            2.0250141           1.7654425</span><br><span>## ENSMUSG00000102331.1            0.4685779           0.8318200</span><br><span>## ENSMUSG00000025900.13           0.2196636           0.5655548</span><br><span>## ENSMUSG00000025902.13           3.9206494           4.4710626</span><br><br><br><span>#2.获取分组信息</span><br><span>#根据列的信息，提取分组信息</span><br>colnames(rawcount) <br><span>## [1] "SRR8988890.sort.bam" "SRR8988891.sort.bam" "SRR8988892.sort.bam"</span><br><span>## [4] "SRR8988893.sort.bam" "SRR8988894.sort.bam" "SRR8988895.sort.bam"</span><br><span>## [7] "SRR8988896.sort.bam" "SRR8988897.sort.bam"</span><br>group=rep(c(<span>"SC"</span>,<span>"SN"</span>),each=<span>4</span>)<br>group <span>#直接用部位作为group</span><br><span>## [1] "SC" "SC" "SC" "SC" "SN" "SN" "SN" "SN"</span><br>group_list=factor(group,levels = c(<span>"SC"</span>,<span>"SN"</span>))<br>table(group_list)<span>#检查一下组别数量</span><br><span>## group_list</span><br><span>## SC SN </span><br><span>##  4  4</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>3.绘制整体表达的箱线图与PCA图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>## 01绘制整体表达的箱线图</span><br>exprSet &lt;- express_cpm<br>class(express_cpm)<br><span>## [1] "matrix" "array"</span><br><span>## [1] "matrix" "array"</span><br>data &lt;- data.frame(expression=c(exprSet),<br>                   sample=rep(colnames(exprSet),each=nrow(exprSet)))<br><br>p1 &lt;- ggplot(data = data,aes(x=sample,y=expression,fill=sample))+ geom_boxplot() + theme(axis.text.x = element_text(angle = <span>90</span>)) + <br>  xlab(<span>NULL</span>) + ylab(<span>"log2(CPM+1)"</span>)+theme_bw()+ theme(axis.text.x = element_text(angle=<span>90</span>, hjust=<span>1</span>, vjust=<span>.5</span>))<br>p1<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosichIDQS2KBeicG0EhXOtbz4x74oExbla7xN3aPryh5JkiahSRbcTXkbrF7vyfqkl9lQFgzKYMjUYSeQ/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosichIDQS2KBeicG0EhXOtbz4x74oExbla7xN3aPryh5JkiahSRbcTXkbrF7vyfqkl9lQFgzKYMjUYSeQ/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code><span>## 02绘制PCA图（此处p2直接按照部位画看看吧）</span><br><span>## 从PCA结果中可以看出，相较于干预方式，组织部位间的差异更显著。</span><br>dat &lt;- express_cpm<br>dat &lt;- as.data.frame(t(dat))<br>dat &lt;- na.omit(dat)<br>dat$group_list &lt;- group_list<br>dat_pca &lt;- PCA(dat[,-ncol(dat)], graph = <span>FALSE</span>)<span>#画图仅需数值型数据，去掉最后一列的分组信息</span><br>p2 &lt;- fviz_pca_ind(dat_pca,<br>                   geom.ind = <span>"point"</span>, <span># 只显示点，不显示文字</span><br>                   col.ind = dat$group_list, <span># 用不同颜色表示分组</span><br>                   palette = c(<span>"#00AFBB"</span>, <span>"#E7B800"</span>),<br>                   addEllipses = <span>T</span>, <span># 是否圈起来，少于4个样圈不起来</span><br>                   legend.title = <span>"Groups"</span>) + theme_bw()<br>p1+p2<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosichIDQS2KBeicG0EhXOtbz4x4MtFXunXLUA4eTZty1gib9mymatBbHMA0zvoA6WicTResl5sl1ldYGVw/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosichIDQS2KBeicG0EhXOtbz4x4MtFXunXLUA4eTZty1gib9mymatBbHMA0zvoA6WicTResl5sl1ldYGVw/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>4.对八组中的两组进行差异分析</span><span></span></h3><p data-tool="mdnice编辑器">此处，就挑选样本号890与891结尾的两个样本SC-WT+Vehicle与SC-WT+STZ组样本进行差异分析吧。</p><pre data-tool="mdnice编辑器"><span></span><code><span>## 取出SC-WT+Vehicle与SC-WT+STZ进行差异分析</span><br>filter_count &lt;- filter_count[,c(<span>1</span>,<span>2</span>)] <span>#调整成正常在前；疾病在后</span><br>head(filter_count)<br><span>##                       SRR8988890.sort.bam SRR8988891.sort.bam</span><br><span>## ENSMUSG00000051951.5                   37                  40</span><br><span>## ENSMUSG00000102331.1                    8                  10</span><br><span>## ENSMUSG00000025900.13                   3                   3</span><br><span>## ENSMUSG00000025902.13                 225                 230</span><br><span>## ENSMUSG00000102269.1                    2                   2</span><br><span>## ENSMUSG00000098104.1                    7                   5</span><br>a=str_split(rownames(filter_count),<span>"\\."</span>,simplify = <span>T</span>)[,<span>1</span>]<br>rownames(filter_count)=a<br><br>rawcount=filter_count<br><span>##转换ID</span><br>id2symbol &lt;- bitr(rownames(rawcount),   <br>                  fromType = <span>"ENSEMBL"</span>, <br>                  toType = <span>"SYMBOL"</span>, <br>                  OrgDb = org.Mm.eg.db)<br>rawcount &lt;- cbind(GeneID=rownames(rawcount),rawcount) <span>#多一列换成基因ID</span><br>rawcount &lt;- merge(id2symbol,rawcount,<br>                  by.x=<span>"ENSEMBL"</span>,by.y=<span>"GeneID"</span>,all.y=<span>T</span>) <br>rawcount=rawcount[!duplicated(rawcount$SYMBOL),] <br>rawcount &lt;- drop_na(rawcount) <span>#去除含有NA值的行</span><br>rownames(rawcount)=rawcount$SYMBOL<br>rawcount=rawcount[,c(<span>3</span>,<span>4</span>)]<br>head(rawcount)<br><span>##       SRR8988890.sort.bam SRR8988891.sort.bam</span><br><span>## Gnai3                 732                 601</span><br><span>## Cdc45                  75                  79</span><br><span>## H19                    28                  59</span><br><span>## Scml2                   6                  12</span><br><span>## Apoh                   16                  19</span><br><span>## Narf                  996                 801</span><br><br><br>exprSet &lt;- rawcount<br>dim(exprSet)<br><span>## [1] 17964     2</span><br><span># 查看分组信息和表达矩阵数据</span><br><br><span># dim(exprSet)</span><br><span># exprSet[1:4,1:4]</span><br><span># group_list</span><br><span># table(group_list)</span><br><span># 加载包</span><br><span>library</span>(DESeq2)<br>exprSet = exprSet[,<span>1</span>:<span>2</span>]<br><br>group=rep(c(<span>"vehicle"</span>,<span>"STZ"</span>),each=<span>1</span>)<br>group<br><span>## [1] "vehicle" "STZ"</span><br>group_list=factor(group,levels = c(<span>"vehicle"</span>,<span>"STZ"</span>))<br>table(group_list)<span>#检查一下组别数量</span><br><span>## group_list</span><br><span>## vehicle     STZ </span><br><span>##       1       1</span><br>group_list=group_list[<span>1</span>:<span>2</span>]<br><br><span>#加载包</span><br><span>library</span>(edgeR) <br><span>#设置分组信息</span><br>exprSet &lt;- DGEList(counts = exprSet, group = group_list)<br>bcv = <span>0.1</span><span>#设置bcv为0.1</span><br>et &lt;- exactTest(exprSet, dispersion=bcv^<span>2</span>)<br>DEG_edgeR=as.data.frame(topTags(et, n = nrow(exprSet$counts)))<br>head(DEG_edgeR)<br><span>##            logFC   logCPM       PValue          FDR</span><br><span>## Hipk2   3.390986 5.608619 2.310790e-43 4.151103e-39</span><br><span>## Myh1    3.174025 4.787663 2.208903e-35 1.984037e-31</span><br><span>## Hoxd10 -3.781282 2.709049 1.295668e-25 7.758462e-22</span><br><span>## Mpz    -2.248826 8.213331 1.998350e-25 8.974590e-22</span><br><span>## Capn11  3.546979 2.741779 2.998023e-24 1.077130e-20</span><br><span>## Ogn    -2.443415 3.702862 1.632260e-19 4.886986e-16</span><br>write.csv(DEG_edgeR, <span>'single-sample-deg-result.csv'</span>, quote = <span>FALSE</span>)<br><br><span>#筛选上下调，设定阈值</span><br>fc_cutoff &lt;- <span>2</span><br>pvalue &lt;- <span>0.01</span><br>DEG_edgeR$regulated &lt;- <span>"normal"</span><br>loc_up &lt;- intersect(which(DEG_edgeR$logFC&gt;log2(fc_cutoff)),<br>                    which(DEG_edgeR$PValue&lt;pvalue))<br>loc_down &lt;- intersect(which(DEG_edgeR$logFC &lt; (-log2(fc_cutoff))),<br>                      which(DEG_edgeR$PValue&lt;pvalue))<br>DEG_edgeR$regulated[loc_up] &lt;- <span>"up"</span><br>DEG_edgeR$regulated[loc_down] &lt;- <span>"down"</span> <br>table(DEG_edgeR$regulated)<br><span>## </span><br><span>##   down normal     up </span><br><span>##    110  17637    217</span><br><br><span>library</span>(EnhancedVolcano)<br>EnhancedVolcano(DEG_edgeR,<br>                lab =rownames(DEG_edgeR),<br>                x = <span>'logFC'</span>,<br>                y = <span>'FDR'</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosichIDQS2KBeicG0EhXOtbz4xkvIfOK0olhQZOocHPXr2stcZTVQqS5QxUOVWU4Hst66RGpS6F2gcWw/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosichIDQS2KBeicG0EhXOtbz4xkvIfOK0olhQZOocHPXr2stcZTVQqS5QxUOVWU4Hst66RGpS6F2gcWw/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>5.看一下文章描述的几个显著变化基因</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>cg=c(<span>"Pvalb"</span>,<span>"Cox7a1"</span>,<span>"Cox6a2"</span>)<br>deg_fc=DEG_edgeR[cg,]<br>head(deg_fc)<br><span>##             logFC   logCPM       PValue        FDR regulated</span><br><span>## Pvalb  0.06243797 7.240778 0.7658528260 1.00000000    normal</span><br><span>## Cox7a1 0.02857483 2.302549 0.9565856240 1.00000000    normal</span><br><span>## Cox6a2 1.22077820 2.125091 0.0001561307 0.02018893        up</span><br></code></pre><p data-tool="mdnice编辑器">以上演示了1V1流程对8组中的2组单样本进行差异分析的结果。与原文相比的，我们的上调基因有217个，下调基因有110个，与原文具有一定的区别。但是由于作者没有提供差异基因，我们同样只能看一下作者展示的验证基因吧。<img data-ratio="0.5505263157894736" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosichIDQS2KBeicG0EhXOtbz4xNjKoibMzqhrEvsOJ9PXZVs0oONxicXesImNF9SiabF7xiayUvvqn2XmWhw/640?wx_fmt=png" data-type="png" data-w="950" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosichIDQS2KBeicG0EhXOtbz4xNjKoibMzqhrEvsOJ9PXZVs0oONxicXesImNF9SiabF7xiayUvvqn2XmWhw/640?wx_fmt=png"></p><p data-tool="mdnice编辑器">验证的差异基因中Pvalb、Cox7a1与Cox6a2中只有一个发生显著上调，与作者的原文具有一定的区别。<span>这是为什么呢？</span><span>为什么两者的分析结果存在不同呢？感兴趣的小伙伴们可以点评下。</span></p><p data-tool="mdnice编辑器"><span>除此之外，曾老师还提供了一个批量对8次差异分析结果进行差异分析的脚本。由于篇幅与时间问题，我们在下次再对其进行展示吧</span><span>。</span></p></section><p data-tool="mdnice编辑器"><br></p></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/WWuOMwI12eKEyEThuz76-g",target="_blank" rel="noopener noreferrer">原文链接</a>
