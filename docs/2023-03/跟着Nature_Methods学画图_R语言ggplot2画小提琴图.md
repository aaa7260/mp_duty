---
title: "跟着Nature Methods学画图：R语言ggplot2画小提琴图"
date: 2023-03-08T01:37:12Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Acdemic"]
---
跟着Nature Methods学画图：R语言ggplot2画小提琴图 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><blockquote data-tool="mdnice编辑器"><p>今天的推文继续学习<strong>A single-cell atlas of the peripheral immune response in patients with severe COVID-19</strong>论文中的代码。今天推文的主要内容是介绍如何使用R语言绘制散点图并且添加拟合曲线和置信区间</p></blockquote><blockquote data-tool="mdnice编辑器"><p>这篇论文是在简书 <strong>土豆学生信</strong> 分享的内容看到的。简书的链接是 https://www.jianshu.com/p/bbf9cb13b41a</p></blockquote><p data-tool="mdnice编辑器">论文是</p><figure data-tool="mdnice编辑器"><img data-ratio="0.48788927335640137" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pn87qCvQ5kZEl81Wx7royAO358w0nrTVXk3Rh7tcZtLIs9oEpUYMDpA/640?wx_fmt=png" data-type="png" data-w="1156" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pn87qCvQ5kZEl81Wx7royAO358w0nrTVXk3Rh7tcZtLIs9oEpUYMDpA/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">论文对应的代码是公开的 https://github.com/ajwilk/2020_Wilk_COVID</p><figure data-tool="mdnice编辑器"><img data-ratio="0.43306451612903224" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8p5CMu84zT0CED3OStdmmuLeSApzeQW1uic3cU6CB2QrqklCmvqs1mmLQ/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8p5CMu84zT0CED3OStdmmuLeSApzeQW1uic3cU6CB2QrqklCmvqs1mmLQ/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><blockquote data-tool="mdnice编辑器"><p>今天重复的内容是论文中的 补充材料Fig9 小提琴图</p></blockquote><figure data-tool="mdnice编辑器"><img data-ratio="1.149584487534626" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pbiaPPpia5hXrvqAticVeEnuqu6IWvPnEO8MhY8Sc9XUJ4qN8sW8TXInpQ/640?wx_fmt=png" data-type="png" data-w="1083" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pbiaPPpia5hXrvqAticVeEnuqu6IWvPnEO8MhY8Sc9XUJ4qN8sW8TXInpQ/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">数据格式如下</p><figure data-tool="mdnice编辑器"><img data-ratio="1.2962382445141065" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pew4HUCZmWhTQ2OT1yloFjdyOABTibvlnTxiarmd8p7dK0pKFr3AibYIkA/640?wx_fmt=png" data-type="png" data-w="638" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pew4HUCZmWhTQ2OT1yloFjdyOABTibvlnTxiarmd8p7dK0pKFr3AibYIkA/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><blockquote data-tool="mdnice编辑器"><p>需要示例数据可以直接在文末留言</p></blockquote><h6 data-tool="mdnice编辑器"><span></span>首先是读入数据<span></span></h6><pre data-tool="mdnice编辑器"><span></span><code>df&lt;-read.csv(<span>"Single_Cell/violineplot-1.csv"</span>,header=T)<br>colnames(df)<br>head(df)<br></code></pre><h6 data-tool="mdnice编辑器"><span></span>最基本的小提琴图<span></span></h6><pre data-tool="mdnice编辑器"><span></span><code>library(ggplot2)<br><span>#help(package="ggplot2")</span><br>ggplot(df,aes(x=cell.type,y=Complexity))+<br>  geom_violin()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9197080291970803" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8p8Retn5RUN1Wibx0oF5fn0Gm6u80LrF6lWCcpwNoVxvAO19xpVXiamZPg/640?wx_fmt=png" data-type="png" data-w="1096" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8p8Retn5RUN1Wibx0oF5fn0Gm6u80LrF6lWCcpwNoVxvAO19xpVXiamZPg/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h6 data-tool="mdnice编辑器"><span></span>更改主题设置，包括<span></span></h6><ul data-tool="mdnice编辑器"><li><section>去掉灰色背景</section></li><li><section>去掉网格线</section></li><li><section>添加坐标轴的线</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>ggplot(df,aes(x=cell.type,y=Complexity))+<br>  geom_violin()+<br>  theme(panel.grid = element_blank(),<br>        panel.background = element_blank(),<br>        axis.line = element_line())<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9197080291970803" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pxtLlPmrUkvBShj3og2LXkZh5qHp2trmeVZUYRAiaajGCpqP2P4JT1Zw/640?wx_fmt=png" data-type="png" data-w="1096" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pxtLlPmrUkvBShj3og2LXkZh5qHp2trmeVZUYRAiaajGCpqP2P4JT1Zw/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h6 data-tool="mdnice编辑器"><span></span>将x轴文字标签更改为垂直<span></span></h6><pre data-tool="mdnice编辑器"><span></span><code>ggplot(df,aes(x=cell.type,y=Complexity))+<br>  geom_violin()+<br>  theme(panel.grid = element_blank(),<br>        panel.background = element_blank(),<br>        axis.line = element_line(),<br>        axis.text.x = element_text(angle=90,hjust = 1,vjust=0.5))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9650690495532088" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pPzbzx2vO6Zia0VEoUECXZCbduQYCwB3OGGx7aQK5ao6twia3rTOaokqw/640?wx_fmt=png" data-type="png" data-w="1231" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pPzbzx2vO6Zia0VEoUECXZCbduQYCwB3OGGx7aQK5ao6twia3rTOaokqw/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h6 data-tool="mdnice编辑器"><span></span>更改坐标轴的标题，并给整幅图添加一个标题<span></span></h6><pre data-tool="mdnice编辑器"><span></span><code>ggplot(df,aes(x=cell.type,y=Complexity))+<br>  geom_violin()+<br>  theme(panel.grid = element_blank(),<br>        panel.background = element_blank(),<br>        axis.line = element_line(),<br>        axis.text.x = element_text(angle=90,hjust = 1,vjust=0.5),<br>        plot.title = element_text(hjust=0.5))+<br>  labs(x=NULL,<br>       y=NULL,<br>       title = <span>"Complexity"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9761904761904762" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pYMnlanxbvcyYuExZfbrEWejg1LqY1FpspFWXA3ChsqPvhVIsKdicWGw/640?wx_fmt=png" data-type="png" data-w="1218" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pYMnlanxbvcyYuExZfbrEWejg1LqY1FpspFWXA3ChsqPvhVIsKdicWGw/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h6 data-tool="mdnice编辑器"><span></span>填充颜色<span></span></h6><pre data-tool="mdnice编辑器"><span></span><code>ggplot(df,aes(x=cell.type,y=Complexity))+<br>  geom_violin(aes(fill=cell.type),show.legend = F)+<br>  theme(panel.grid = element_blank(),<br>        panel.background = element_blank(),<br>        axis.line = element_line(),<br>        axis.text.x = element_text(angle=90,hjust = 1,vjust=0.5),<br>        plot.title = element_text(hjust=0.5))+<br>  labs(x=NULL,<br>       y=NULL,<br>       title = <span>"Complexity"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9689034369885434" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pibRa7ib3vvPZB5xJSddKA54Oz8Fs1tZ2nnf1qyxecsbq58pL2Xjbh5icg/640?wx_fmt=png" data-type="png" data-w="1222" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pibRa7ib3vvPZB5xJSddKA54Oz8Fs1tZ2nnf1qyxecsbq58pL2Xjbh5icg/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h6 data-tool="mdnice编辑器"><span></span>叠加散点图<span></span></h6><pre data-tool="mdnice编辑器"><span></span><code>ggplot(df,aes(x=cell.type,y=Complexity))+<br>  geom_violin(aes(fill=cell.type),show.legend = F)+<br>  theme(panel.grid = element_blank(),<br>        panel.background = element_blank(),<br>        axis.line = element_line(),<br>        axis.text.x = element_text(angle=90,hjust = 1,vjust=0.5),<br>        plot.title = element_text(hjust=0.5))+<br>  labs(x=NULL,<br>       y=NULL,<br>       title = <span>"Complexity"</span>)+<br>  geom_jitter(size=0.5)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.970467596390484" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pUv7aLb5BNEg9PYab47kAWuSZaDlicfNzkZPoXxkjcPz77pmbpMiaeMCA/640?wx_fmt=png" data-type="png" data-w="1219" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8pUv7aLb5BNEg9PYab47kAWuSZaDlicfNzkZPoXxkjcPz77pmbpMiaeMCA/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><blockquote data-tool="mdnice编辑器"><p>这样的话论文中的图就复现出来了。上图叠加的散点图是矩形的，最近看到一个函数<code>geom_sina()</code>可以让散点图也以小提琴的形状显示，我们试一下用这个函数的效果，这个函数来自ggforce这个包，使用前需要先加载</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code>library(ggforce)<br>ggplot(df,aes(x=cell.type,y=Complexity))+<br>  geom_violin(aes(fill=cell.type),show.legend = F)+<br>  theme(panel.grid = element_blank(),<br>        panel.background = element_blank(),<br>        axis.line = element_line(),<br>        axis.text.x = element_text(angle=90,hjust = 1,vjust=0.5),<br>        plot.title = element_text(hjust=0.5))+<br>  labs(x=NULL,<br>       y=NULL,<br>       title = <span>"Complexity"</span>)+<br>  geom_sina(size=0.1,alpha=0.2)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9656019656019657" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8ppibplmHKibe8SSSe6NDlic67AfwfkeLAf61fFc8bkZUPXm1mDHLtTLebA/640?wx_fmt=png" data-type="png" data-w="1221" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8ppibplmHKibe8SSSe6NDlic67AfwfkeLAf61fFc8bkZUPXm1mDHLtTLebA/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">这样看起来比论文中的图好像好看一点</p><p data-tool="mdnice编辑器">欢迎大家关注我的公众号</p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><figure data-tool="mdnice编辑器"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8p5dE0LNkkrT6MplHQlUnicNERyHicM00wutrMYBOiauQDlOlwuuuKicsCVw/640?wx_fmt=jpeg" data-type="jpeg" data-w="258" src="https://mmbiz.qpic.cn/mmbiz_jpg/t1wZDoUyFk7Y0L8f4NKXIMKNg2dqqP8p5dE0LNkkrT6MplHQlUnicNERyHicM00wutrMYBOiauQDlOlwuuuKicsCVw/640?wx_fmt=jpeg"><figcaption>公众号二维码.jpg</figcaption></figure></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/tMZ5TsHIOq2htCOtO2jCvA",target="_blank" rel="noopener noreferrer">原文链接</a>
