---
title: "使用R语言用DNA序列做主成分分析（PCA）的简单小例子"
date: 2023-03-08T01:36:53Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Acdemic"]
---
使用R语言用DNA序列做主成分分析（PCA）的简单小例子 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><blockquote data-tool="mdnice编辑器"><p>之前也有人在公众号 留言问过如何用DNA序列做主成分分析，当时我也不知道，但是大体有一个思路 就是先比对，然后把比对的数据转换成通常用的snp数据应该就可以了，但是也仅限于思路，完全不知道如何操作，今天坐车回家，路上无聊，翻了一下电脑上保存的一些资料，发现了一个办法：可以借助R语言的<code>adegenet</code>包，用到的函数是<code>fasta2genlight()</code></p></blockquote><h6 data-tool="mdnice编辑器"><span></span>fasta2genlight()函数的只要作用<span></span></h6><blockquote data-tool="mdnice编辑器"><p>The function fasta2genlight extracts SNPs from alignments with fasta format. 从比对好的fasta文件中提取snp数据</p></blockquote><h6 data-tool="mdnice编辑器"><span></span>下面开始实际操作<span></span></h6><p data-tool="mdnice编辑器">adegenet这个包第一使用需要先安装，直接运行如下命令</p><pre data-tool="mdnice编辑器"><span></span><code>install.packages(<span>"adegenet"</span>)<br></code></pre><p data-tool="mdnice编辑器">今天的推文使用的数据集是这个包的内置数据集，首先是获取这个数据集的存储路径</p><pre data-tool="mdnice编辑器"><span></span><code>dfpath&lt;-system.file(<span>"files/usflu.fasta"</span>,package=<span>"adegenet"</span>)<br>dfpath<br></code></pre><h6 data-tool="mdnice编辑器"><span></span>加载包读入数据<span></span></h6><pre data-tool="mdnice编辑器"><span></span><code>library(adegenet)<br>flu&lt;-fasta2genlight(dfpath,chunkSize = 10,parallel = F)<br>flu<br></code></pre><h3 data-tool="mdnice编辑器"><span></span>数据读入以后做一些分析就比较容易了<span></span></h3><h6 data-tool="mdnice编辑器"><span></span>首先是看一下snp位点在染色体上的分布密度<span></span></h6><pre data-tool="mdnice编辑器"><span></span><code>library(ggplot2)<br>snpposi.plot(position(flu),genome.size = 1700,codon = F)+<br>  theme_bw()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5967741935483871" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6uxK57SVg4Kvv88O6icWaTZgRMUdpWzVHMxaAOp2OP0BibMyiaI8vD9XWYgBW3lErkQd68EII2jiciblQ/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6uxK57SVg4Kvv88O6icWaTZgRMUdpWzVHMxaAOp2OP0BibMyiaI8vD9XWYgBW3lErkQd68EII2jiciblQ/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h6 data-tool="mdnice编辑器"><span></span>还可以划分不同的密码子位置<span></span></h6><pre data-tool="mdnice编辑器"><span></span><code>snpposi.plot(position(flu),genome.size = 1700,codon = T)+<br>  theme_bw()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5967741935483871" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6uxK57SVg4Kvv88O6icWaTZViaWjGRVqlu1lbxhoDIRv8fl7iaEWKiaqKbURlsyYPQib6VuWeCwiboQKvg/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6uxK57SVg4Kvv88O6icWaTZViaWjGRVqlu1lbxhoDIRv8fl7iaEWKiaqKbURlsyYPQib6VuWeCwiboQKvg/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">这个图如果分面画成山脊图的形式可能会更好看，但是自己目前还不知道如何实现</p><h6 data-tool="mdnice编辑器"><span></span>还能够检测snp在染色体上是否分布均匀<span></span></h6><pre data-tool="mdnice编辑器"><span></span><code>snpposi.test(position(flu),genome.size = 1700)<br></code></pre><p data-tool="mdnice编辑器">这一步的时间可能会比较长<img data-ratio="0.41131105398457585" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6uxK57SVg4Kvv88O6icWaTZqryLh0Yy2kw2Yn7LkAictkYoOluzQ70LaibqHeh6WahDInRkGeq2fic9Q/640?wx_fmt=png" data-type="png" data-w="778" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6uxK57SVg4Kvv88O6icWaTZqryLh0Yy2kw2Yn7LkAictkYoOluzQ70LaibqHeh6WahDInRkGeq2fic9Q/640?wx_fmt=png"></p><h6 data-tool="mdnice编辑器"><span></span>接下来是做主成分分析了<span></span></h6><pre data-tool="mdnice编辑器"><span></span><code>df.pca&lt;-glPca(flu,nf=3)  <br>df.pca.scores&lt;-as.data.frame(df.pca<span>$scores</span>)  <br>df.pca.scores<br></code></pre><h5 data-tool="mdnice编辑器"><span></span>自己随便构造一个分组信息，然后用散点图加置信椭圆的方式展示结果<span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>df.pca.scores<span>$population</span>&lt;-ifelse(df.pca.scores<span>$PC1</span>&gt;0,<span>"pop1"</span>,<br>                                 ifelse(df.pca.scores<span>$PC2</span>&gt;1,<span>"pop2"</span>,<span>"pop3"</span>))<br>library(ggplot2)<br>ggplot()+<br>  geom_point(data=df.pca.scores,<br>             size=2,<br>             aes(x=PC1,y=PC2,<br>                 color=population))+<br>  theme_bw()+<br>  stat_ellipse(data=df.pca.scores,<br>               aes(x=PC1,y=PC2,fill=population),<br>               geom = <span>"polygon"</span>,alpha=0.2,lty=<span>"dashed"</span>,color=<span>"black"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5967741935483871" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6uxK57SVg4Kvv88O6icWaTZAK0Hvdkp09AuSA8UqjaGQXHskpnIPPuLeUVh1notXianezpmvje77Uw/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk6uxK57SVg4Kvv88O6icWaTZAK0Hvdkp09AuSA8UqjaGQXHskpnIPPuLeUVh1notXianezpmvje77Uw/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">欢迎大家关注我的公众号</p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><figure data-tool="mdnice编辑器"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/t1wZDoUyFk6uxK57SVg4Kvv88O6icWaTZJpMaTSsice8sAoHak6TpyV5niaZlJd0tYFAM5jlNIxUalsiblVXkXYrNg/640?wx_fmt=jpeg" data-type="jpeg" data-w="258" src="https://mmbiz.qpic.cn/mmbiz_jpg/t1wZDoUyFk6uxK57SVg4Kvv88O6icWaTZJpMaTSsice8sAoHak6TpyV5niaZlJd0tYFAM5jlNIxUalsiblVXkXYrNg/640?wx_fmt=jpeg"><figcaption>公众号二维码.jpg</figcaption></figure><blockquote data-tool="mdnice编辑器"><p>今天参考的资料是一份pdf文档，里面还有好多其他的内容，大家如果需要的话可以直接留言呀！</p></blockquote></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/1LbYkaE5doXess4nvvVaYg",target="_blank" rel="noopener noreferrer">原文链接</a>
