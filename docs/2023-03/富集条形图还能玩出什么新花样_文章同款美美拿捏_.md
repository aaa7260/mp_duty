---
title: "富集条形图还能玩出什么新花样？文章同款美美拿捏！"
date: 2023-03-12T08:44:07Z
draft: ["false"]
tags: [
  "fetched",
  "SCIPainter"
]
categories: ["Acdemic"]
---
富集条形图还能玩出什么新花样？文章同款美美拿捏！ by SCIPainter
------
<div><section data-mpa-powered-by="yiban.io"><span>富集条形图是展现富集结果的重要图表之一，今天我们就来重新回顾+学习富集条形图的三种文献常见画法，都能通过ggplot2实现，让你绘图不用愁！</span></section><section><span><br></span></section><section><span>如果想要绘制区分上下调的富集条形图，可戳往期</span><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA5NzQzOTgzMw==&amp;mid=2650972358&amp;idx=1&amp;sn=7cc19728508ea6a6309645d0abe7dde5&amp;chksm=8b56d9f0bc2150e67dfccd193af0d6b707093026ac82dfc37bce87cdd44bf6344dba14ecd53d&amp;scene=21#wechat_redirect" textvalue="《如何轻松展示上下调富集结果？2款高分同款富集条形图任选!》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">《如何轻松展示上下调富集结果？2款高分同款富集条形图任选!》</a></span><span></span></section><section><span><br></span></section><section><span>本期使用的测试数据可通过点击文末</span><span>“阅读原文”</span><span>获取。</span></section><section><br mpa-from-tpl="t"></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#相关R包载入：</span><br mpa-from-tpl="t"><span>library</span>(ggplot2)<br mpa-from-tpl="t"><span>library</span>(RColorBrewer)<br mpa-from-tpl="t"><span>#载入本地差异富集Top20结果表：</span><br mpa-from-tpl="t"><span>dt</span> &lt;- read.csv('KEGG_result.csv',header = T)<br mpa-from-tpl="t"><span>#查看列名信息：</span><br mpa-from-tpl="t"><span>colnames</span>(dt)</code></pre></section><p><br mpa-from-tpl="t"></p><section><span></span></section><section><img data-ratio="0.12654320987654322" data-type="png" data-w="972" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCofz3MwicS5GBLYnSqskPtoXbB8ia3Y9YOiaKq6wSVjXm1nhLBib1EnPnzibgA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCofz3MwicS5GBLYnSqskPtoXbB8ia3Y9YOiaKq6wSVjXm1nhLBib1EnPnzibgA/640?wx_fmt=png"></section><section><br mpa-from-tpl="t"></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#按照通路指定绘图顺序(转换为因子)：</span><br mpa-from-tpl="t"><span>dt</span>$Description &lt;- factor(dt$Description,<br mpa-from-tpl="t"><span>levels</span> = rev(dt$Description))</code></pre></section><p><br mpa-from-tpl="t"></p><section><span></span></section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p><br></p></section></section></section></section><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><p><br></p></section></section></section></section></section></section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section></section><section><section powered-by="xiumi.us"><p><strong><strong><span>1. 画法1—常规型富集条形图</span></strong></strong></p></section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section><section><br></section><section><span>首先是我们最常见的富集条形图绘制方法：</span></section><section><br mpa-from-tpl="t"></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#先自定义主题：</span><br mpa-from-tpl="t"><span>mytheme</span> &lt;- theme(<br mpa-from-tpl="t"><span>axis</span>.title = element_text(size = 13),<br mpa-from-tpl="t"><span>axis</span>.text = element_text(size = 11),<br mpa-from-tpl="t"><span>plot</span>.title = element_text(size = 14,<br mpa-from-tpl="t"><span>hjust</span> = 0.5,<br mpa-from-tpl="t"><span>face</span> = <span>"bold"</span>),<br mpa-from-tpl="t"><span>legend</span>.title = element_text(size = 13),<br mpa-from-tpl="t"><span>legend</span>.text = element_text(size = 11),<br mpa-from-tpl="t"><span>plot</span>.margin = margin(t = 5.5,<br mpa-from-tpl="t"><span>r</span> = 10,<br mpa-from-tpl="t"><span>l</span> = 5.5,<br mpa-from-tpl="t"><span>b</span> = 5.5)<br mpa-from-tpl="t">)<br mpa-from-tpl="t"><span>#常规富集条形图绘图：</span><br mpa-from-tpl="t"><span>p</span> &lt;- ggplot(data = dt, aes(x = Count, y = Description, fill = -log10(pvalue))) +<br mpa-from-tpl="t"><span>scale_fill_distiller</span>(palette = <span>"RdPu"</span>,direction = 1) + <span>#更改配色</span><br mpa-from-tpl="t"><span>geom_bar</span>(stat = <span>"identity"</span>, width = 0.8) + <span>#绘制条形图</span><br mpa-from-tpl="t"><span>labs</span>(x = <span>"Number of Gene"</span>, y = <span>""</span>, title = <span>"KEGG enrichment barplot"</span>) + <span>#修改/添加各标题</span><br mpa-from-tpl="t"><span>theme_bw</span>() + mytheme <span>#主题更改</span><br mpa-from-tpl="t"><span>p</span></code></pre></section><p><br mpa-from-tpl="t"></p><section><span></span></section><section><img data-ratio="0.6883802816901409" data-type="png" data-w="1704" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCoftCN3F1vh1TcUTTbQoPZticoGClI65J1F6q8ZaXYjAb7LHG1cCZeGIfA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCoftCN3F1vh1TcUTTbQoPZticoGClI65J1F6q8ZaXYjAb7LHG1cCZeGIfA/640?wx_fmt=png"></section><section><span><br></span></section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p><br></p></section></section></section></section><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><p><br></p></section></section></section></section></section></section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section></section><section><section powered-by="xiumi.us"><p><strong><strong><span>2. 画法2—通路标签叠加在柱子上</span></strong></strong></p></section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section><section><br></section><section><span>画法2目前在高分文献中出现的比较多，特别适合当通路标签太长时使用。</span></section><section><br mpa-from-tpl="t"></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#在自定义主题中去掉y轴通路标签:</span><br mpa-from-tpl="t"><span>mytheme2</span> &lt;- mytheme + theme(axis.text.y = element_blank())<br mpa-from-tpl="t"><span>p1</span> &lt;- ggplot(data = dt, aes(x = RichFactor, y = Description, fill = -log10(pvalue))) +<br mpa-from-tpl="t"><span>scale_fill_distiller</span>(palette = <span>"YlOrRd"</span>, direction = 1) +<br mpa-from-tpl="t"><span>geom_bar</span>(stat = <span>"identity"</span>, width = 0.8, alpha = 0.7) +<br mpa-from-tpl="t"><span>labs</span>(x = <span>"RichFactor"</span>, y = <span>""</span>, title = <span>"KEGG enrichment barplot"</span>) +<br mpa-from-tpl="t"><span>geom_text</span>(aes(x = 0.03,<span> #用数值向量控制文本标签起始位置</span><br mpa-from-tpl="t"><span>label</span> = Description),<br mpa-from-tpl="t"><span>hjust</span> = 0)+ <span>#hjust = 0,左对齐</span><br mpa-from-tpl="t"><span>theme_classic</span>() + mytheme2<br mpa-from-tpl="t"><span>p1</span></code></pre></section><p><br mpa-from-tpl="t"></p><section><span></span></section><section><img data-ratio="0.8650442477876106" data-type="png" data-w="1356" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCof4jYuN92ObsHLJXnJoY0rKa9xRO3zEgOWIliaiaj8t0qRePCQy6O7XfNw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCof4jYuN92ObsHLJXnJoY0rKa9xRO3zEgOWIliaiaj8t0qRePCQy6O7XfNw/640?wx_fmt=png"></section><section><span><br></span></section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p><br></p></section></section></section></section><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><p><br></p></section></section></section></section></section></section><section powered-by="xiumi.us"><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section></section><section><section powered-by="xiumi.us"><p><strong><strong><span>3. 画法3—双x/y轴富集条形折线散点图</span></strong></strong></p></section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section><section><br></section><section><span>前两种画法都是在柱子中通过加入渐变色映射多一维度的数据，如-</span><span>log<sub>10</sub></span><span>p，但如果你觉得相邻通路中渐变色过于接近无法直观显示时，我们可以拆分成两个图表叠加，ggplot2也有可实现的解决方案。</span></section><section><span><br></span></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#先分别绘制:</span><br mpa-from-tpl="t"><span>#绘制富集条形图展示-log10p：</span><br mpa-from-tpl="t"><span>p2</span> &lt;- ggplot(data = dt,aes(x = Description, y = -log10(pvalue))) +<br mpa-from-tpl="t"><span>geom_bar</span>(stat = <span>"identity"</span>, width = 0.8, fill = 'pink') +<br mpa-from-tpl="t"><span>scale_y_continuous</span>(limits = c(0, 25)) +<br mpa-from-tpl="t"><span>labs</span>(x = <span>""</span>, y = <span>"-log10(pvalue)"</span>, title = <span>"KEGG enrichment barplot"</span>) +<br mpa-from-tpl="t"><span>theme_classic</span>() + mytheme +<br mpa-from-tpl="t"><span>coord_flip</span>()<br mpa-from-tpl="t"><span>p2</span></code></pre></section><p><br mpa-from-tpl="t"></p><section><span></span></section><section><img data-ratio="0.7372353673723536" data-type="png" data-w="1606" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCofrwDC5R2wr4czeoTRpmA0SqpaZpicfSe5A9c2jJag4tS06fbp8JDt1icw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCofrwDC5R2wr4czeoTRpmA0SqpaZpicfSe5A9c2jJag4tS06fbp8JDt1icw/640?wx_fmt=png"></section><section><br mpa-from-tpl="t"></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#绘制折线散点图展示count数目：</span><br mpa-from-tpl="t"><span>p3</span> &lt;- ggplot(data = dt, aes(x = Description, y = Count, group = 1)) +<br mpa-from-tpl="t"><span>geom_line</span>(color = <span>"grey"</span>, cex = 0.5) + <span>#绘制折线</span><br mpa-from-tpl="t"><span>geom_point</span>(size = 2) + <span>#绘制Count散点</span><br mpa-from-tpl="t"><span>scale_y_continuous</span>(limits = c(20, 60)) +<br mpa-from-tpl="t"><span>labs</span>(x = <span>""</span>, y = <span>"Count"</span>, title = <span>"KEGG enrichment barplot"</span>) +<br mpa-from-tpl="t"><span>theme_classic</span>() + mytheme +<br mpa-from-tpl="t"><span>coord_flip</span>()<br mpa-from-tpl="t"><span>p3</span></code></pre></section><p><br mpa-from-tpl="t"></p><section><span></span></section><section><img data-ratio="0.7372353673723536" data-type="png" data-w="1606" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCoficu6eLdLJd02gE0AdfK7cXFwiabmgoamCDDDHsxz8vDA3ChbTk3OzpPw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCoficu6eLdLJd02gE0AdfK7cXFwiabmgoamCDDDHsxz8vDA3ChbTk3OzpPw/640?wx_fmt=png"></section><section><br mpa-from-tpl="t"></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#将不同坐标系图表进行组合：</span><br mpa-from-tpl="t"><span>p4</span> &lt;- ggplot() +<br mpa-from-tpl="t"><span>geom_bar</span>(data = dt, aes(x = Description, y = -log10(pvalue)),<br mpa-from-tpl="t"><span>stat</span> = <span>"identity"</span>, width = 0.8, fill = 'pink') +<br mpa-from-tpl="t"><span>scale_y_continuous</span>(limits = c(0,25),<span> #主y轴刻度限制</span><br mpa-from-tpl="t"><span>breaks</span> = seq(0,25,5),<span> #主y轴刻度线断点</span><br mpa-from-tpl="t"><span>expand</span> = c(0,0),<br mpa-from-tpl="t"><span>sec</span>.axis = sec_axis(~. *2.4, <span>#创建与主轴相对的辅助轴，通过函数计算实现1对1的转换。如主轴范围为0-25，这里我们通过*2.4实现辅助轴范围为0-60</span><br mpa-from-tpl="t"><span>name</span> = 'Count', <span>#辅助轴标题</span><br mpa-from-tpl="t"><span>breaks</span> = seq(0,60,10))) + <span>#辅助轴刻度线断点</span><br mpa-from-tpl="t"><span>geom_line</span>(data = dt, aes(x = Description, y = Count/2.4, group = 1),<br mpa-from-tpl="t"><span>color</span> = <span>"grey"</span>, cex = 0.5) +<br mpa-from-tpl="t"><span>geom_point</span>(data = dt, aes(x = Description, y = Count/2.4),<br mpa-from-tpl="t"><span>size</span> = 2) +<br mpa-from-tpl="t"><span>labs</span>(x = <span>""</span>, y = <span>"-log10(pvalue)"</span>, title = <span>"KEGG enrichment barplot"</span>) +<br mpa-from-tpl="t"><span>theme_classic</span>() +<br mpa-from-tpl="t"><span>mytheme</span> +<br mpa-from-tpl="t"><span>coord_flip</span>() <span>#由于geom_line函数绘制折线是按照变量在x轴水平方向顺序进行连接，因此这里把x/y轴对应变量交换了一下，最后再通过坐标翻转回来</span><br mpa-from-tpl="t"><span>p4</span></code></pre></section><p><br mpa-from-tpl="t"></p><section><span></span></section><section><img data-ratio="0.7868087941372418" data-type="png" data-w="1501" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCof0kmLfhPVkJjH7iaHZlicbPsj4ybI1460ibbhrRNukgIWCcCcASS2MPjgQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCof0kmLfhPVkJjH7iaHZlicbPsj4ybI1460ibbhrRNukgIWCcCcASS2MPjgQ/640?wx_fmt=png"></section><section><br></section><section><span>由于没有在ggplot2中映射颜色变量，因此这里是没有图例的，虽然也有实现的方法，不过小编觉得使用AI直接添加更加省事。</span></section><section><span><br></span></section><section><img data-ratio="0.7416666666666667" data-type="png" data-w="1680" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCofw4AibCvGObZIsJ2OTq4u7RHl2gHljZeTDrUPTk1lkGnZaic3T1Dqh1ag/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCofw4AibCvGObZIsJ2OTq4u7RHl2gHljZeTDrUPTk1lkGnZaic3T1Dqh1ag/640?wx_fmt=png"></section><section><span><br></span></section><section><span>最终效果如下：</span></section><section><span><br></span></section><section><img data-ratio="0.67390062821245" data-type="png" data-w="1751" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCofE4bNQX52arI4TfwhicXO86XK4GLOtWicibKuO0zf2qqKTAC4tOic1YmoYg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kgrmxCrAtiatVpg17uPmCofE4bNQX52arI4TfwhicXO86XK4GLOtWicibKuO0zf2qqKTAC4tOic1YmoYg/640?wx_fmt=png"></section><section><br></section><section><span>画法没有好坏之分，哪种画法更适配自己的数据就行啦。如果觉得有帮助，记得点赞分享和关注我们！</span></section><section><span><br></span></section><section><span>好啦，今天的分享就到这里！</span></section><section><span><br></span></section><section><span><strong>*未经许可，不得以任何方式复制或抄袭本篇文章之部分或全部内容。版权所有，侵权必究。</strong></span></section><section><span><br></span></section><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="105648"><section><section data-role="outer" label="Powered by 135editor.com"><section data-role="paragraph"><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="105648"><section><section><img data-ratio="0.8928571428571429" data-type="png" data-w="41" data-width="100%" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJE8VibmibGU0Jxic9iabARVRH0FT6BNE8VAglWFXBPibFAU7a6tWGibSs8wyUg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJE8VibmibGU0Jxic9iabARVRH0FT6BNE8VAglWFXBPibFAU7a6tWGibSs8wyUg/640?wx_fmt=png"></section><section><section><section data-width="35%"><section><section data-width="100%"><img data-ratio="1" data-type="jpeg" data-w="860" data-width="100%" title="SCIPainter 30cm二维码.jpg" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEv5etCBwHicqbEPwnVrkpaasxqaVibM4mT2JdIuN6yTlYWDD4mL5A427A/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEv5etCBwHicqbEPwnVrkpaasxqaVibM4mT2JdIuN6yTlYWDD4mL5A427A/640?wx_fmt=jpeg"></section></section></section><section data-width="50%"><section><section data-brushtype="text"><span><strong># SCIPainter</strong></span></section><section data-brushtype="text" hm_fix="361:593"><p>基迪奥旗下绘图公众号</p><p>分享科研绘图技能与工具</p><p>欢迎关注与转发~</p></section></section></section></section></section></section></section></section></section></section><section><br></section></section></section><section data-role="paragraph"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-ratio="1" data-type="gif" data-w="400" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEgMd0aMPtmrDjiaX8sBhfhicVteeHf1JicexSpUbS3fdS9SiboUVN7guaPw/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEgMd0aMPtmrDjiaX8sBhfhicVteeHf1JicexSpUbS3fdS9SiboUVN7guaPw/640?wx_fmt=gif"></section></section></section><section><section powered-by="xiumi.us"><section><p><span><strong>你的好友拍了拍你</strong></span></p><p><span><strong>并请你帮她点一下</strong></span><strong><span>“分享”</span></strong><span><strong><span>~</span></strong></span></p></section></section></section></section></section><p><br></p></section></section><section><span></span></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/T06XncgWiFTa4eUkOPGwIQ",target="_blank" rel="noopener noreferrer">原文链接</a>
