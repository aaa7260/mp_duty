---
title: "跨平台不同单细胞转录组数据集整合王者算法（harmony）"
date: 2023-03-21T03:11:09Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
跨平台不同单细胞转录组数据集整合王者算法（harmony） by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>看到了一个新鲜出炉（2023年3月）的单细胞转录组文章：《Single-cell Profiling of Tumor Immune Microenvironment Reveals Immune Irresponsiveness in Gastric Signet-ring Cell Carcinoma》，文章自己的数据使用的是比较小众的BD单细胞转录组平台，数据集在GSE212212，然后整合两个相关领域的两个10X单细胞转录组数据集。</p></blockquote><p data-tool="mdnice编辑器">使用的是跨平台不同单细胞转录组数据集整合王者算法：harmony，如果是R语言的代码实现起来是超级简单，使用流行的seurat包制作好单细胞对象（input_sce），然后走下面的标准流程即可：</p><pre data-tool="mdnice编辑器"><span></span><code>  print(dim(input_sce))<br>  input_sce &lt;- NormalizeData(input_sce, <br>                             normalization.method = <span>"LogNormalize"</span>,<br>                             scale.factor = <span>1e4</span>) <br>  input_sce &lt;- FindVariableFeatures(input_sce)<br>  input_sce &lt;- ScaleData(input_sce)<br>  input_sce &lt;- RunPCA(input_sce, features = VariableFeatures(object = input_sce))<br>  seuratObj &lt;- RunHarmony(input_sce, <span>"orig.ident"</span>)<br>  names(seuratObj@reductions)<br>  seuratObj &lt;- RunUMAP(seuratObj,  dims = <span>1</span>:<span>15</span>, <br>                       reduction = <span>"harmony"</span>) <br>  input_sce=seuratObj<br>  input_sce &lt;- FindNeighbors(input_sce, reduction = <span>"harmony"</span>,<br>                             dims = <span>1</span>:<span>15</span>) <br>  input_sce.all=input_sce<br></code></pre><p data-tool="mdnice编辑器">从本文可以看到，虽然涉及到到10x和BD两个不同的单细胞转录组技术平台，而且是3个数据集，但是整合效果非常好！</p><p><img data-galleryid="" data-ratio="0.5399590163934426" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzIrHMqThjia0PpbKY4icVWlO4PNa6VDDCBUoXGVlcwaWFMiaA0lfoquib1Bbb57ZQxYkr4QrYtu9yYicA/640?wx_fmt=png" data-type="png" data-w="1952" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzIrHMqThjia0PpbKY4icVWlO4PNa6VDDCBUoXGVlcwaWFMiaA0lfoquib1Bbb57ZQxYkr4QrYtu9yYicA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>整合效果非常好</figcaption></figure><p data-tool="mdnice编辑器">总体来说，10x和BD两个不同的单细胞转录组技术平台产出的单细胞转录组数据，在不同单细胞亚群层面数据质量差异并不大。</p><p><img data-galleryid="" data-ratio="0.30504587155963303" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzIrHMqThjia0PpbKY4icVWlODPdmgGxo0eax1W1Q83uDjP5HLm8kibiaBTZiaBwraTyt3SsiaHVhia6h7jQ/640?wx_fmt=png" data-type="png" data-w="1744" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzIrHMqThjia0PpbKY4icVWlODPdmgGxo0eax1W1Q83uDjP5HLm8kibiaBTZiaBwraTyt3SsiaHVhia6h7jQ/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>质量差异并不大</figcaption></figure><p data-tool="mdnice编辑器"><strong>整合后的降维聚类分群和单细胞亚群生物学命名，都可以看出来不受数据集特异性的影响。</strong></p><p><img data-galleryid="" data-ratio="0.3554817275747508" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzIrHMqThjia0PpbKY4icVWlOF102xy53bchibbnPwjt5g3benFae2hW6kHWib46EgZ5ySLCuSdvlIGpg/640?wx_fmt=png" data-type="png" data-w="1806" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzIrHMqThjia0PpbKY4icVWlOF102xy53bchibbnPwjt5g3benFae2hW6kHWib46EgZ5ySLCuSdvlIGpg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>不受数据集特异性</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span><span>学徒专业</span><span></span></h3><p data-tool="mdnice编辑器">针对任意疾病，现在很容易找到领域内的3个以上的单细胞数据集，每个数据集独立的降维聚类分群对大家来说跟吃饭喝水一样的简单了，但是多个数据集的整合有时候还看运气。我这里随便举一个例子哈：</p><pre data-tool="mdnice编辑器"><span></span><code>https://ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE152048<br>https://ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE169396<br>https://ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE162454<br></code></pre><p data-tool="mdnice编辑器">如果你觉得每个数据集的文章的作者提供的表达量矩阵不靠谱，也可以自己下载各个数据集的fq文件走单细胞转录组流程，自己拿到表达量矩阵后走跨平台不同单细胞转录组数据集整合王者算法（harmony）流程，得到什么的3个质量控制图表哈。</p><pre data-tool="mdnice编辑器"><span></span><code>nohup kingfisher get -p PRJNA638151 -m ena-ascp ena-ftp prefetch aws-http &amp;<br>nohup kingfisher get -p PRJNA716518 -m ena-ascp ena-ftp prefetch aws-http &amp;<br>nohup kingfisher get -p PRJNA681896 -m ena-ascp ena-ftp prefetch aws-http &amp;<br></code></pre><p data-tool="mdnice编辑器">如果对数据分析步骤有疑问，可以仔细研读前面的文献：《Single-cell Profiling of Tumor Immune Microenvironment Reveals Immune Irresponsiveness in Gastric Signet-ring Cell Carcinoma》</p><p><img data-galleryid="" data-ratio="0.8980099502487562" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzIrHMqThjia0PpbKY4icVWlOq0W79cibTqXvmVBHiadDTzm9da220MNGHd31b9ibsRIY4Du03l5PXfnJA/640?wx_fmt=png" data-type="png" data-w="1608" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzIrHMqThjia0PpbKY4icVWlOq0W79cibTqXvmVBHiadDTzm9da220MNGHd31b9ibsRIY4Du03l5PXfnJA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>仔细研读前面的文献</figcaption></figure><p data-tool="mdnice编辑器">一般来说单细胞转录组测序数据走完cellranger的定量流程，每个样品就会得到3个表达量矩阵文件（barcodes.tsv.gz，matrix.mtx.gz，genes.tsv.gz或者features.tsv.gz），然后就可以走seurat流程进行单细胞降维聚类分群。这样的基础分析，也可以看基础10讲：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486076&amp;idx=1&amp;sn=52bb851d7dc23461233a2cf458736151&amp;scene=21#wechat_redirect" data-linktype="2">01. 上游分析流程</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486082&amp;idx=1&amp;sn=03cadceffb2c14ba95d97fe5caf38d94&amp;scene=21#wechat_redirect" data-linktype="2">02.课题多少个样品，测序数据量如何</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486088&amp;idx=1&amp;sn=3a115338ee4937d20caab78627237553&amp;scene=21#wechat_redirect" data-linktype="2">03. 过滤不合格细胞和基因（数据质控很重要）</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486096&amp;idx=1&amp;sn=1a99c4c5800b7e0287db3e8ef369fab8&amp;scene=21#wechat_redirect" data-linktype="2">04. 过滤线粒体核糖体基因</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486098&amp;idx=1&amp;sn=bf9a71df848d74fe665ce7d5e283d5ff&amp;scene=21#wechat_redirect" data-linktype="2">05. 去除细胞效应和基因效应</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486260&amp;idx=1&amp;sn=c6abf658de73594d1d77d8e1ffa7d153&amp;scene=21#wechat_redirect" data-linktype="2">06.单细胞转录组数据的降维聚类分群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486271&amp;idx=1&amp;sn=638b434b6deee63206af1c0eeda175ab&amp;scene=21#wechat_redirect" data-linktype="2">07.单细胞转录组数据处理之细胞亚群注释</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486278&amp;idx=1&amp;sn=91250ef733833ff00371818b215dc124&amp;scene=21#wechat_redirect" data-linktype="2">08.把拿到的亚群进行更细致的分群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486287&amp;idx=1&amp;sn=49627c638ff9c04418282c53518aa7c7&amp;scene=21#wechat_redirect" data-linktype="2">09.单细胞转录组数据处理之细胞亚群比例比较</a></section></li></ul></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/xmTZC5BWux0UsaYyX9yxjA",target="_blank" rel="noopener noreferrer">原文链接</a>
