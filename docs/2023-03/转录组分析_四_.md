---
title: "转录组分析（四）"
date: 2023-03-07T11:04:27Z
draft: ["false"]
tags: [
  "fetched",
  "医学生之学习生信"
]
categories: ["Acdemic"]
---
转录组分析（四） by 医学生之学习生信
------
<div><h1><span>表达定量</span></h1><h2><span>featureCounts</span></h2><p>官网：http://bioinf.wehi.edu.au/featureCounts/</p><p>featureCounts来自Bioconductor的Rsubread包，输入的数据有两类，一类是SAM/BAM文件，另一类是GTF/GFF/SAF,其中SAM/BAM可以输入一个或多个。</p><p>输入的bam文件都需要有自己的索引bai文件</p><h3><span>主要代码</span></h3><pre><code><span>#</span><span><span># 转到进行处理的文件夹</span></span><br>cd ~/project/airway/06.counts<br><span><br>#</span><span><span># 定义输入输出文件夹</span></span><br>gtf=~/project/airway/05.mapping/Hisat2/Homo_sapiens.GRCh38.109.chr.gtf.gz<br>inputdir=~/project/airway/05.mapping/Hisat2/<br><span><br>#</span><span><span># featureCounts对bam文件进行计数</span></span><br>featureCounts -T 6 -p -t exon -g gene_id -a $gtf -o all.id.txt $inputdir/*.sorted.bam<br><span><br>#</span><span><span># 对定量结果质控，生成详细的质控文件</span></span><br>multiqc all.id.txt.summary<br></code></pre><p>featurecount的主要参数</p><pre><code><span>#</span><span><span>##featureCounts常用参数</span></span><br>-a  #输入的注释文件（即gtf文件的完整路径）<br>-g  #统计的meta-feature的名称，取值范围参考gtf第九列。默认写gene_id<br>-t  #feature的名称，取值范围参考gtf文件第三列，默认是exon<br>-o  #输出的文件<br>-F  #注释文件的格式，默认为GTF<br>-T  #线程数<br></code></pre><h3><span>数据整理</span></h3><p><br></p><p><img data-galleryid="" data-ratio="0.4239073196419168" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/dgYTF46r3icbmzhbDxICxhspia0CZsCyib0s2sbTT52icKMndr5na8omN2LHEUddNaibq64pSOMme70DQUpRFpfibnmw/640?wx_fmt=png" data-type="png" data-w="1899" src="https://mmbiz.qpic.cn/mmbiz_png/dgYTF46r3icbmzhbDxICxhspia0CZsCyib0s2sbTT52icKMndr5na8omN2LHEUddNaibq64pSOMme70DQUpRFpfibnmw/640?wx_fmt=png"></p><p>进行完以上流程后，我们就可以获得all.id.txt，但是还需要稍加整理，才能获得我们需要的count矩阵</p><p>all.id.txt的前面几列包含基因ensemble id、起始位点、终止位点、正负链、基因长度等信息，一般第七列及第七列后面每一列为一个样本，数值表示该样本中比对到注释信息上的read数目</p><p>1.需要提取ensemble id和表达信息</p><p>2.去掉表头上面多余的信息，以样本编号作为列名</p><pre><code><span>#</span><span> 处理表头，/teach/t_rna/要换成自己的路径</span><br>less -S all.id.txt |grep -v '#' |cut -f 1,7- |sed 's#/home/jiayi/project/airway/05.mapping/Hisat2//##g' |sed 's#.Hisat_aln.sorted.bam##g' &gt;raw_counts.txt<br><span><br>#</span><span> 列对齐显示</span><br>head raw_counts.txt  |column -t</code></pre><p><br>这是整理好的count矩阵</p><p><img data-galleryid="" data-ratio="0.6915807560137457" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/dgYTF46r3icbmzhbDxICxhspia0CZsCyib07FGkJSMptoicveQ3fmJsvbQibld8XVwc8wACGzRUvxT4RkdplEv4qSeg/640?wx_fmt=png" data-type="png" data-w="1164" src="https://mmbiz.qpic.cn/mmbiz_png/dgYTF46r3icbmzhbDxICxhspia0CZsCyib07FGkJSMptoicveQ3fmJsvbQibld8XVwc8wACGzRUvxT4RkdplEv4qSeg/640?wx_fmt=png"></p><h2><span>salmon</span></h2><p>salmon：alignment-free的定量，salmon可以对没有比对参考基因组的数据进行定量</p><h3><span>构建索引</span></h3><p>在表达定量之前，需要建立salmon专用的索引</p><pre><code>cd ~/project/airway/06.counts/salmon<br><span><br>#</span><span> 构建salmon索引</span><br>time salmon index -t Homo_sapiens.GRCh38.cdna.all.fa.gz -i Homo_sapiens.GRCh38.cdna.all.salmon<br><span><br>#</span><span>没有没有Homo_sapiens.GRCh38.cdna.all.fa.gz，请先下载</span><br>nohup wget -c https://ftp.ensembl.org/pub/release-109/fasta/homo_sapiens/cdna/Homo_sapiens.GRCh38.cdna.all.fa.gz &gt;allfa.log<br></code></pre><h3><span>主要分析</span></h3><p>单个样本</p><pre><code><span>cd ~/project/airway/06.counts/salmon</span><br><span><br>#</span><span> 定义文件夹</span><br><span>#</span><span>定义salmon索引文件的位置</span><br><span>index=~/project/airway/06.counts/salmon/Homo_sapiens.GRCh38.cdna.all.salmon/</span><br><span>#</span><span>定义输入文件的位置</span><br><span>input=~/project/airway/02.fq/fastqc</span><br><span>#</span><span>定义输出文件夹</span><br><span>outdir=~/project/airway/06.counts/salmon</span><br><span><br>#</span><span> 单样本测试：\后面不能有空格，否则会报错</span><br><span>salmon quant -i $index -l A -p 5 \</span><br><span>             -1 $input/SRR12097378_1_val_1.fq.gz \</span><br><span>             -2 $input/SRR12097378_2_val_2.fq.gz \</span><br><span>             -o $outdir/SRR12097378.quant</span><br><span><br>#</span><span>salmon常用参数</span><span></span><br></code></pre><p>多个样本</p><pre><code><span>#</span><span> 编写脚本，使用salmon批量对目录下所有fastq文件进行定量</span><br><span>#</span><span> vim salmon.sh</span><br>index=~/project/airway/06.counts/salmon/Homo_sapiens.GRCh38.cdna.all.salmon/<br>input=~/project/airway/02.fq/fastqc<br>outdir=~/project/airway/06.counts/salmon<br><br>ls ~/project/airway/02.fq/*.sra |while read id <br>do<br>  salmon quant -i ${index} -l A -1 ${input}/${id}_1_val_1.fq.gz -2 ${input}/${id}_2_val_2.fq.gz -p 5 -o ${outdir}/${id}.quant<br>done<br><span><br>#</span><span> 后台运行脚本</span><br>nohup bash salmon.sh 1&gt;salmon.log 2&gt;&amp;1 &amp;<br></code></pre><p>salmon常用参数</p><pre><code><span>#</span><span>1.构建索引的参数</span><br>-t  #参考基因组文件<br>-i  #索引文件夹名<br><span><br>#</span><span>2.定量参数</span><br>-l  #文库的类型，后面跟 A 代表自动搜索文库<br>-i  #salmon index索引（文件夹）<br>-r  #单端测序数据的输入文件<br>-1  #双端测序数据的1 mates<br>-2  #双端测序数据的2 mates<br>-o  #输出文件位置<br>-p  #线程数</code></pre><p><br></p><p><br></p><p><img data-ratio="0.64" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/dgYTF46r3icYVrMHp60henChZoJE9Ty5IlFw5eDmZC4lZFpwgeJtn0O7F7Yv6ia8tYdh2Uwpv8aURu2u6oF74QeA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1000" src="https://mmbiz.qpic.cn/mmbiz_jpg/dgYTF46r3icYVrMHp60henChZoJE9Ty5IlFw5eDmZC4lZFpwgeJtn0O7F7Yv6ia8tYdh2Uwpv8aURu2u6oF74QeA/640?wx_fmt=jpeg"></p><p>作者：胡嘉怡</p><p>编辑：胡嘉怡<br></p><p>校审：林炳昱</p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/sMeg87EgX8poikvuLjOr2g",target="_blank" rel="noopener noreferrer">原文链接</a>
