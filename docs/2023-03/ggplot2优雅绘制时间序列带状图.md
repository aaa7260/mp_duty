---
title: "ggplot2优雅绘制时间序列带状图"
date: 2023-03-06T15:41:03Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
ggplot2优雅绘制时间序列带状图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来介绍一个常见的绘图案例，<strong>「使用geom_ribbon图层来绘制时间序列带状图」</strong>，以往该图层主用来给线条添加阴影等，非常简单的一个小案例，喜欢的观众老爷欢迎收藏转发。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023-VIP购买方式</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>有需要购买2023年文档的朋友欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>下单购买，微信发小编订单截图即可邀请进新的交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可下单购买，需要了解更多信息的朋友欢迎交流咨询，<strong>「添加小编微信请备注，以提高沟通效率」</strong></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺个性化绘图服务</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p><span>有需要找小编做个性化绘图的朋友</span>欢迎<span>关注</span><strong>「淘宝店铺(R语言数据分析指南)」</strong><span> 有需求者可咨询下单。</span></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>require</span>(lubridate)<br><span>library</span>(zoo) <br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- data.frame(Year = as.numeric(trunc(time(AirPassengers))), <br>                 Month = month.abb[cycle(AirPassengers)], <br>                 AirPassengers = as.numeric(AirPassengers))<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code><span># 定义因子排序</span><br>df<span>$Month</span> &amp;lt;- factor(df<span>$Month</span>, levels = unique(df<span>$Month</span>))<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code><span># 创建一个日期列，将年份和月份转换为日期</span><br><br>df<span>$date</span> &lt;- make_date(df<span>$Year</span>, df<span>$Month</span>, 1)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>绘制时间序列图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><br>ggplot(df, aes(x = date, y = AirPassengers)) +<br>geom_line(color = <span>"cadetblue"</span>, linewidth = <span>1</span>) + <span># 绘制线条</span><br>geom_line(aes(y = rollmean(AirPassengers, <span>12</span>, na.pad = <span>TRUE</span>, align = <span>"right"</span>)), linewidth = <span>1</span>) + <span># 绘制12个月滚动均值的线条</span><br>theme_minimal() + <br>theme(axis.title = element_blank()) <br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.519053876478318" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZkDFISTfxHZ5I5bxI7gsENJ8BrJibthhcSp0aTOxDILuaiavYCwJkhicAMgLyU3b0hyEJ4Efbtj9iaqw/640?wx_fmt=png" data-type="png" data-w="761" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZkDFISTfxHZ5I5bxI7gsENJ8BrJibthhcSp0aTOxDILuaiavYCwJkhicAMgLyU3b0hyEJ4Efbtj9iaqw/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code><span># 计算12个月滚动均值，并添加到数据框中</span><br><br>df<span>$MA</span> &lt;- rollmean(df<span>$AirPassengers</span>, 12, na.pad = TRUE, align = <span>"right"</span>)<br><br><span># 创建两个列，一个用于保存高于滚动均值的值，一个用于保存低于滚动均值的值</span><br><br>df<span>$above_MA</span> &lt;- ifelse(df<span>$AirPassengers</span> &gt;= df<span>$MA</span>, df<span>$AirPassengers</span>, df<span>$MA</span>)<br>df<span>$below_MA</span> &lt;- ifelse(df<span>$AirPassengers</span> &lt; df<span>$MA</span>, df<span>$AirPassengers</span>, df<span>$MA</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>绘制时间序列条带图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>ggplot(df, aes(x = date, y = MA)) +<br>geom_line(color = <span>"cadetblue"</span>, linewidth = 1, linetype = 2) + <span># 绘制滚动均值的线条</span><br>geom_ribbon(aes(ymin = below_MA, ymax = MA), alpha = 0.2, fill = <span>"tomato"</span>,color=<span>"grey50"</span>) + <span># 用红色填充区分低于滚动均值的值</span><br>geom_ribbon(aes(ymin = MA, ymax = above_MA), alpha = 0.2, fill = <span>"steelblue"</span>,color=<span>"grey50"</span>) + <span># 用蓝色填充区分高于滚动均值的值</span><br>theme_minimal() +<br>theme(axis.title = element_blank())<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5470914127423823" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZkDFISTfxHZ5I5bxI7gsENtEJsBdoB81oWXGcibG1FuoxPptJVSjYIrBRFaqKDpDwgBK0vs7VoGibw/640?wx_fmt=png" data-type="png" data-w="722" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZkDFISTfxHZ5I5bxI7gsENtEJsBdoB81oWXGcibG1FuoxPptJVSjYIrBRFaqKDpDwgBK0vs7VoGibw/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>如果有合适的数据可以来试用这个案例，喜欢的观众老爷欢迎分享转发。有学习需求者欢迎到小编<strong>「淘宝店铺 R语言数据分析指南」</strong> 购买小编2023年的VIP文档，已有不少朋友学以至用用到了论文当中，<strong>「加小编微信请备注信息及来意，无需要请勿扰」</strong></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>小编微信</span><span></span></h3><p><img data-galleryid="" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg" data-type="jpeg" data-w="430" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-weui-theme="light" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501630&amp;idx=1&amp;sn=ae4076f0c916403a07321e8be5d10af9&amp;chksm=cee29fa0f99516b69e50632fd85b4d26d8440c6a115e14f3b2a5515aa19c5f4046ad3d41bac1&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.425" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZ8uSib3RQgZUFmxC1CFHPIHST2IV7u8v8n9zKD0ZqNb56mQOvicpM7YchfiaONRdenoX7RCSczLDCow/640?wx_fmt=jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZ8uSib3RQgZUFmxC1CFHPIHST2IV7u8v8n9zKD0ZqNb56mQOvicpM7YchfiaONRdenoX7RCSczLDCow/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[会员专享] R优雅绘制组合版circos图</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501515&amp;idx=1&amp;sn=580f43228fef348c5bae59a7c58b19b2&amp;chksm=cee29e55f9951743086ea5eff394ab12b5539cc51904391eb8b0446fde202f79feb9bce7b3ad&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.42592592592592593" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAacoZo5Caqaq9qKTsJR4dg5OLscTbvmMAD6VEZtYx7NnVdng6Ta2icZHf5EicTGiaZ3FEKiaD84QnPOHA/640?wx_fmt=jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAacoZo5Caqaq9qKTsJR4dg5OLscTbvmMAD6VEZtYx7NnVdng6Ta2icZHf5EicTGiaZ3FEKiaD84QnPOHA/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[会员专享] nature microbiology图表复现之基因丰度图</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501490&amp;idx=1&amp;sn=c05b62a880b411855ed0d54a6c0ab57c&amp;chksm=cee29e2cf995173ac4515faf6e223e5610afb4685b7bd13b0914011868d80c7addb80190ea4c&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.4261780104712042" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZ8IN8iaWib1mWicqL59OkdEbtPY9JUBxVIzuyMPj0eWbqyAM4siaTa3gOPic1qSicquuaibO2bu1F7n8PQQ/640?wx_fmt=jpeg" data-w="955" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZ8IN8iaWib1mWicqL59OkdEbtPY9JUBxVIzuyMPj0eWbqyAM4siaTa3gOPic1qSicquuaibO2bu1F7n8PQQ/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>NC图表复现-ggplot2绘制漂亮阴影图</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501425&amp;idx=1&amp;sn=e4023be2f4e69312474222c2b9d2499a&amp;chksm=cee29eeff99517f932eeaea90e1d79dafd7997c68fc70312815e3454d371aae27fce11768779&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.425" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaTsiaAXVLAoxX8VR6EE4RRXCPiarXOiaxQ96Tm86wg6PvQZvhw60h2pttsPY1q31ibjoiag8GSOeKOX5Q/640?wx_fmt=jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaTsiaAXVLAoxX8VR6EE4RRXCPiarXOiaxQ96Tm86wg6PvQZvhw60h2pttsPY1q31ibjoiag8GSOeKOX5Q/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[会员专享] nature biotechnology图表复现高端个性化组合图</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501341&amp;idx=1&amp;sn=7fa16fce18ea34b1871b129f14f08868&amp;chksm=cee29e83f9951795c6028080e0d365e8b364c978a30eef343b8952699e795d11ca7451a7a9d5&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.425" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAYRkWfTg5MgMcEjmqBicp330Aibx49dB4DtQeacc1wT1icZVa1K7FtmiawCs7iaNIVWnA3D3M1WkH7DX9A/640?wx_fmt=jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAYRkWfTg5MgMcEjmqBicp330Aibx49dB4DtQeacc1wT1icZVa1K7FtmiawCs7iaNIVWnA3D3M1WkH7DX9A/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[完整版] R语言版基因家族分析课程</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501313&amp;idx=1&amp;sn=de75bc4b7b362ab179adf95852bfc90e&amp;chksm=cee29e9ff995178901eab0c115fb20a6bdf928901570272ab51510240f7611c522443d3df764&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.42515723270440253" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaDG03gujU0PGeKbopfKt3DiarGyfES5Onvoa8MdYZOnbbZUmia5XtZibLYlic3HUIvq0B9hemWT8emHA/640?wx_fmt=jpeg" data-w="795" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaDG03gujU0PGeKbopfKt3DiarGyfES5Onvoa8MdYZOnbbZUmia5XtZibLYlic3HUIvq0B9hemWT8emHA/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[会员专享] ggplot2优雅绘制分布棒棒糖图</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501232&amp;idx=1&amp;sn=48dcdaecd394a47759fc716590ed186b&amp;chksm=cee29d2ef9951438f6b8a2385ebc96b162d33878f81092f9fea62422b51a92fef93d2361385a&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.42444444444444446" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZP20CGJ6EEn9qiaFUB00cic4fmOdicedBVxlibMUxJ75SdJCHVb2oJJn2fq9DaRs9ib1qWc9BtHyMqunQ/640?wx_fmt=jpeg" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZP20CGJ6EEn9qiaFUB00cic4fmOdicedBVxlibMUxJ75SdJCHVb2oJJn2fq9DaRs9ib1qWc9BtHyMqunQ/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[会员专享] circlize绘制复杂基因组图</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501195&amp;idx=1&amp;sn=4b580a378afa9ffd7f12c9cf1935a4eb&amp;chksm=cee29d15f99514037ac4ef377dae97642207cea3f9152aec3875614971eeabda6b7c70e20291&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.42407407407407405" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZhwVpX7DYXjb5ibnJKVciaPVMu8wq05xCXBYZeX0vlVZaaetQkI5zPBwkJO9BpxFtgciaO20DIq9pPQ/640?wx_fmt=jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZhwVpX7DYXjb5ibnJKVciaPVMu8wq05xCXBYZeX0vlVZaaetQkI5zPBwkJO9BpxFtgciaO20DIq9pPQ/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>ggplot2优雅绘制山脊图(进阶版)</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501179&amp;idx=1&amp;sn=20951b9ff45d822349928cce2a12a5e5&amp;chksm=cee29de5f99514f39cff1e3c3e2d1087b6f06edbf78fd1b2979f68b1d374724cdfebbfef0e7f&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.4248927038626609" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbwa2gV8dgB1mdjRFGzLAH9B0vjVMwib2dibVjia4uKBK8EOGicQsIw46dDicxRsF9upVsEYZoQZ3ibCWaA/640?wx_fmt=jpeg" data-w="932" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbwa2gV8dgB1mdjRFGzLAH9B0vjVMwib2dibVjia4uKBK8EOGicQsIw46dDicxRsF9upVsEYZoQZ3ibCWaA/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[会员专享] imeta图表复现之相关性组合热图</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247500946&amp;idx=1&amp;sn=e49e07f1bb9cc1db61fb14a9ca329ac8&amp;chksm=cee29c0cf995151a97482cda424769c81f0df123b42837425c6b4e751940f6c9a2c2390151f5&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.4243498817966903" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZcCvAFaUQ4icANdAkVsBgHHBxrM0DxmaUUREWhs1QaTmS1FYRoW1AUXWhhMg5fQUY2as54OtRhJvA/640?wx_fmt=jpeg" data-w="846" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZcCvAFaUQ4icANdAkVsBgHHBxrM0DxmaUUREWhs1QaTmS1FYRoW1AUXWhhMg5fQUY2as54OtRhJvA/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[会员专享] NC图表复现之cirzlize绘制基因组图</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247500867&amp;idx=1&amp;sn=8209cf587e3f593cbc5c8e5250c454ed&amp;chksm=cee29cddf99515cb8599de9d6b071f3a54bfbcea687f80ce0b5383537e40583f6f9cd72e53e3&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.425" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAYEpnYe3rcX8ySVgv4RVjT2S0FERYcW4LYujCdxra2edlPMCEVFIgfqRb2oRIfC4rzrzicCpZvsbibg/640?wx_fmt=jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAYEpnYe3rcX8ySVgv4RVjT2S0FERYcW4LYujCdxra2edlPMCEVFIgfqRb2oRIfC4rzrzicCpZvsbibg/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>ggplot2带你组合绘制桑基图+富集分析图</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247500843&amp;idx=1&amp;sn=675fde94ff0ac2ccf4890647c62d6f68&amp;chksm=cee29cb5f99515a337e5ce5a908db79e0a7eff68d4a47955ea1692e12a4e2f126bd74d921d6c&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.42529989094874593" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAb1FbIlGbwLGntvWJmWw3ibrO3DyBHFyPR4hQBVln4WAdpE3icyYuUMrokwLOvvDvjAbVOrr778I2nA/640?wx_fmt=jpeg" data-w="917" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAb1FbIlGbwLGntvWJmWw3ibrO3DyBHFyPR4hQBVln4WAdpE3icyYuUMrokwLOvvDvjAbVOrr778I2nA/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[会员专享] NC图表复现之华夫热图</p></section></section></section></a></section><p><br></p></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/qEUh9ZRaGx16YHkko357wg",target="_blank" rel="noopener noreferrer">原文链接</a>
