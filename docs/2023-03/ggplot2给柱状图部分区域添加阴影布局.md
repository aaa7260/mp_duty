---
title: "ggplot2给柱状图部分区域添加阴影布局"
date: 2023-03-21T04:47:01Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
ggplot2给柱状图部分区域添加阴影布局 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来介绍一个小案例如何使用<strong>「ggplot2给柱状图部分区域添加阴影」</strong>。下面来进行代码介绍过程，数据为随意处理无任何意义仅供参考。<strong>「数据+代码已经上传2023VIP群，加群的观众老爷请自行下载」</strong></p><span>❞</span></blockquote><blockquote data-tool="mdnice编辑器"><span>❝</span><p>有需要学习个性化数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>购买<strong>「2023年度会员」</strong> <code>初始价格99元</code>，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong><code>均包含数据+代码</code>；按照往年数据小编年产出约在150篇以上。</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可在淘宝店铺下单购买，需要了解更多信息的朋友欢迎交流咨询，<strong>「添加小编微信请备注，以提高沟通效率」</strong></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(xlsx)<br><span>library</span>(janitor)<br><span>library</span>(ggpattern)<br><span>library</span>(shadowtext)<br><span>library</span>(camcorder)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 从Excel文件中读取数据，sheetIndex为工作表索引，startRow和endRow指定读取的行范围</span><br>tc_n &lt;- read.xlsx(<span>"data.xls"</span>,sheetIndex = 1, startRow = 1, endRow = 2) %&gt;% <br>  clean_names() %&gt;%  <span># 将列名转换为小写字母并用下划线代替空格</span><br>  select(-ar) %&gt;%    <span># 删除名为“ar”的列</span><br>  mutate(across(everything(), as.character)) %&gt;%  <span># 将所有列转换为字符型</span><br>  pivot_longer(everything(), names_to = <span>"year"</span>, values_to = <span>"n"</span>)  <span># 将数据从宽格式转换为长格式，年份作为新的列名，n为新的值列名</span><br></code></pre><pre data-tool="mdnice编辑器"><span></span><code><span># 从Excel文件中读取数据，进行与上述代码相同的数据清洗和整理，读取的行范围为1到4行，然后只选择第3行</span><br>tc_ci &lt;- read.xlsx(<span>"data.xls"</span>,sheetIndex = <span>1</span>, startRow = <span>1</span>, endRow = <span>4</span>) %&gt;% <br>  clean_names() %&gt;% <br>  filter(row_number() == <span>3</span>) %&gt;% <br>  select(-ar) %&gt;% <br>  mutate(across(everything(), as.character)) %&gt;% <br>  pivot_longer(everything(), names_to = <span>"year"</span>, values_to = <span>"ci"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>整合数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 对两个数据集进行左连接，将ci列分成两列low_ci和high_ci，同时将所有列转换为数字型</span><br>tc &lt;- left_join(tc_n, tc_ci) %&gt;% <br>  separate(ci, into = c(<span>"low_ci"</span>, <span>"high_ci"</span>)) %&gt;% <br>  mutate(across(everything(), parse_number))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>自定义颜色</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>col = <span>"mediumpurple2"</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>ggplot(tc)+<br>  geom_col(aes(x = year, y = n), fill = col, width = <span>0.7</span>)+   <span># 绘制柱状图</span><br>  <span># 绘制95%置信区间的图案矩形</span><br>  geom_rect_pattern(aes(xmin = year - <span>0.35</span>, xmax = year + <span>0.35</span>, ymin = low_ci, ymax = high_ci),<br>                    fill = <span>NA</span>, pattern_fill = colorspace::lighten(col, <span>0.3</span>), pattern_color = <span>NA</span>,<br>                    pattern_spacing = <span>0.0075</span>, pattern_density = <span>0.4</span>) +<br>  <span># 添加特殊的图案</span><br>  geom_tile_pattern(aes(<span>2017</span>, <span>0</span>, pattern_fill = <span>"whatever"</span>), width = <span>0</span>, height = <span>0</span>, fill = <span>NA</span>, pattern_color = <span>NA</span>,<br>                    pattern_spacing = <span>0.0075</span>, pattern_density = <span>0.4</span>) + <br>  <span># 添加带阴影效果的文本标签</span><br>  geom_shadowtext(aes(x = year, y = n, label = n), nudge_y = -<span>1.5</span>,fontface = <span>"bold"</span>,size = <span>3</span>,<br>                  color = colorspace::lighten(col, <span>0.9</span>), bg.colour = colorspace::darken(col, <span>0.9</span>),<br>                  bg.r = <span>0.07</span>, hjust = <span>1</span>) +<br>  geom_text(aes(x = year, y = -<span>2</span>, label = year), hjust = <span>1</span>,size =<span>3</span>) +   <span># 添加年份标签</span><br>  scale_x_reverse() +   <span># 翻转坐标轴</span><br>  scale_y_continuous(limits = c(-<span>5</span>, <span>100</span>)) +   <span># 设置y轴范围</span><br>  <span># 设置图案颜色</span><br>  scale_pattern_fill_manual(values = colorspace::lighten(col, <span>0.3</span>),<br>                            label = <span>"95% 置信区间"</span>, name = <span>NULL</span>) +<br>  coord_flip() +  <span># 设置坐标轴翻转后的主题</span><br>  theme_void() + <span>#  清空主题</span><br>  theme(<br>    legend.position = <span>"top"</span>, <span># 图例位置</span><br>    legend.text = element_text(size=<span>8</span>,color=<span>"black"</span>), <span># 图例文本样式</span><br>    plot.background = element_rect(fill = <span>"grey97"</span>, color = <span>NA</span>), <span># 图形背景</span><br>    plot.margin = margin(<span>5</span>,<span>0</span>,<span>0</span>,<span>5</span>)) <span># 图形边距</span><br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.616643929058663" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZR9TjzzNVdKEG1VFm4sjTiaibd5pEFey4icUiaOQjc7KN4DtGlrXHQJxbVB8xWxic0MoDXl4FnibTuHh8g/640?wx_fmt=png" data-type="png" data-w="733" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZR9TjzzNVdKEG1VFm4sjTiaibd5pEFey4icUiaOQjc7KN4DtGlrXHQJxbVB8xWxic0MoDXl4FnibTuHh8g/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节介绍到此结束，喜欢的观众老爷欢迎分享转发。有学习需求者欢迎到小编<strong>「淘宝店铺 R语言数据分析指南」</strong> 购买小编2023年的VIP文档，已有不少朋友学以至用用到了论文当中，<strong>「加小编微信请备注信息及来意，无需要请勿扰」</strong></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>小编微信</span><span></span></h3><p><img data-galleryid="" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg" data-type="jpeg" data-w="430" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-weui-theme="light" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h3 data-tool="mdnice编辑器"><span></span><span><span></span>往期精彩内容</span><span></span></h3></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501979&amp;idx=1&amp;sn=1fb4129af9b5faf4e7bbe93852ae4e45&amp;chksm=cee29005f99519130378ef4a3751f67fbd2612e9f40fd1139cfe6ee593a73c466204c488ebf1&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.42555438225976766" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZKWCt0ib0F4P2F8xD4FYAWnSPQHn1jOBd5ASBEEtj2vicPTtk7ax2XkFvibTMkXNo2GPZLsjicKolYkQ/640?wx_fmt=jpeg" data-w="947" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZKWCt0ib0F4P2F8xD4FYAWnSPQHn1jOBd5ASBEEtj2vicPTtk7ax2XkFvibTMkXNo2GPZLsjicKolYkQ/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>R语言优雅的绘制交互式物种组成图</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501935&amp;idx=1&amp;sn=67925856510ed27850408609b51d717a&amp;chksm=cee290f1f99519e738572111448fdab5c77032018396eaea25e15eb14fd7362a83b5d015b43e&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.42444444444444446" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZAIkWYpHVp5MWtibb8MKh2Qy6yb7icZD0159BFZMR7uw0qch6NP0I3ibtEOUFPvPFXjtgvKnJQkSoBA/640?wx_fmt=jpeg" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZAIkWYpHVp5MWtibb8MKh2Qy6yb7icZD0159BFZMR7uw0qch6NP0I3ibtEOUFPvPFXjtgvKnJQkSoBA/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[会员专享] ggplot2绘制个性化注释哑铃图</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501920&amp;idx=1&amp;sn=60800dee31b611c4a3aff30c388ca307&amp;chksm=cee290fef99519e8c955b1a21c1ecf9d36b3750d0b8b47acb11b7ccfc46916b393b1be1541bd&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.425" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaxt1CFVZDlD0J1GgnEIXhxYLaYZZUp6grTscUBCnqEF08wkazA3RNpZpiaDvfgSiawO2uffeoia1CKA/640?wx_fmt=jpeg" data-w="600" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaxt1CFVZDlD0J1GgnEIXhxYLaYZZUp6grTscUBCnqEF08wkazA3RNpZpiaDvfgSiawO2uffeoia1CKA/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>phytools优雅的给进化树节点添加热图信息</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501894&amp;idx=1&amp;sn=63c3f160e35fd62b4fa9572afaaab4c6&amp;chksm=cee290d8f99519cec71b09e6b86eb7495b6e6022f8daa95f3cc874bb85f5ebdb1eb673bfef32&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.42444444444444446" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaPmqUsHQ6ibtGohA3AMJff1w1Rq86icUaD5WtCTQkfjREjAYSXggGjIic27K9znbDTEMdPPE3VCvBpQ/640?wx_fmt=jpeg" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaPmqUsHQ6ibtGohA3AMJff1w1Rq86icUaD5WtCTQkfjREjAYSXggGjIic27K9znbDTEMdPPE3VCvBpQ/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[会员专享] 三行代码将系统发育树映射给地图</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501813&amp;idx=1&amp;sn=5b33aa351542c8308251e17cb050b2eb&amp;chksm=cee29f6bf995167d65afe5d141453e2916813908c89451fa8ed3f57b93d27b5fc495b43823c6&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.42407407407407405" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAYwcHE3ZyxozdntkibV6Gn4K8SbfzvLe7GViaU6PZoXhBYjSl3RhdG82nNlHuyzOJgiczBvhQLqyxMiag/640?wx_fmt=jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAYwcHE3ZyxozdntkibV6Gn4K8SbfzvLe7GViaU6PZoXhBYjSl3RhdG82nNlHuyzOJgiczBvhQLqyxMiag/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[会员专享] nature communications图表复现之个性化地图绘制</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501738&amp;idx=1&amp;sn=b9c01def68c7c70a9cb4098f03bd4696&amp;chksm=cee29f34f9951622536726a079118036d894429ba1f71927e7109a623b466d422042af61279a&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.42444444444444446" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaWdnhibLaeC1cpd1iakQBXdZxm42rVfXsj4XItkCRthPpKPibTBI0Kr9GyCgUgRVkNv0XibycY9beMsw/640?wx_fmt=jpeg" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaWdnhibLaeC1cpd1iakQBXdZxm42rVfXsj4XItkCRthPpKPibTBI0Kr9GyCgUgRVkNv0XibycY9beMsw/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>qgraph让你的网络图阵营更加丰富</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501682&amp;idx=1&amp;sn=129af6929a76d751034ee99f0a46d6bd&amp;chksm=cee29fecf99516faf1dcf6baab90858c4988584edb135ca39044e751cc2b3835de931c8f467d&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.425" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaIVysx08v4nh5dugAJOJXOlpakLIhvFEVe3Fs3N5rTPH8lBCk8LVCdsQ9Hvdib7VfzlGY4Wkq5BAQ/640?wx_fmt=jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaIVysx08v4nh5dugAJOJXOlpakLIhvFEVe3Fs3N5rTPH8lBCk8LVCdsQ9Hvdib7VfzlGY4Wkq5BAQ/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>使用graphlayouts包来丰富网络图布局</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501630&amp;idx=1&amp;sn=ae4076f0c916403a07321e8be5d10af9&amp;chksm=cee29fa0f99516b69e50632fd85b4d26d8440c6a115e14f3b2a5515aa19c5f4046ad3d41bac1&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.425" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZ8uSib3RQgZUFmxC1CFHPIHST2IV7u8v8n9zKD0ZqNb56mQOvicpM7YchfiaONRdenoX7RCSczLDCow/640?wx_fmt=jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZ8uSib3RQgZUFmxC1CFHPIHST2IV7u8v8n9zKD0ZqNb56mQOvicpM7YchfiaONRdenoX7RCSczLDCow/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[会员专享] R优雅绘制组合版circos图</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501425&amp;idx=1&amp;sn=e4023be2f4e69312474222c2b9d2499a&amp;chksm=cee29eeff99517f932eeaea90e1d79dafd7997c68fc70312815e3454d371aae27fce11768779&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.425" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaTsiaAXVLAoxX8VR6EE4RRXCPiarXOiaxQ96Tm86wg6PvQZvhw60h2pttsPY1q31ibjoiag8GSOeKOX5Q/640?wx_fmt=jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaTsiaAXVLAoxX8VR6EE4RRXCPiarXOiaxQ96Tm86wg6PvQZvhw60h2pttsPY1q31ibjoiag8GSOeKOX5Q/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[会员专享] nature biotechnology图表复现高端个性化组合图</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501232&amp;idx=1&amp;sn=48dcdaecd394a47759fc716590ed186b&amp;chksm=cee29d2ef9951438f6b8a2385ebc96b162d33878f81092f9fea62422b51a92fef93d2361385a&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.42444444444444446" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZP20CGJ6EEn9qiaFUB00cic4fmOdicedBVxlibMUxJ75SdJCHVb2oJJn2fq9DaRs9ib1qWc9BtHyMqunQ/640?wx_fmt=jpeg" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZP20CGJ6EEn9qiaFUB00cic4fmOdicedBVxlibMUxJ75SdJCHVb2oJJn2fq9DaRs9ib1qWc9BtHyMqunQ/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[会员专享] circlize绘制复杂基因组图</p></section></section></section></a></section><p><br></p><section><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247501313&amp;idx=1&amp;sn=de75bc4b7b362ab179adf95852bfc90e&amp;chksm=cee29e9ff995178901eab0c115fb20a6bdf928901570272ab51510240f7611c522443d3df764&amp;scene=21#wechat_redirect" data-linktype="1"><section><section><section data-mid=""><span data-positionback="static"><img data-ratio="0.42515723270440253" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaDG03gujU0PGeKbopfKt3DiarGyfES5Onvoa8MdYZOnbbZUmia5XtZibLYlic3HUIvq0B9hemWT8emHA/640?wx_fmt=jpeg" data-w="795" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaDG03gujU0PGeKbopfKt3DiarGyfES5Onvoa8MdYZOnbbZUmia5XtZibLYlic3HUIvq0B9hemWT8emHA/640?wx_fmt=jpeg"></span></section><section data-mid=""><p>[会员专享] ggplot2优雅绘制分布棒棒糖图</p></section></section></section></a></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/zg0ln5Osmtc1HpKrfesIRw",target="_blank" rel="noopener noreferrer">原文链接</a>
