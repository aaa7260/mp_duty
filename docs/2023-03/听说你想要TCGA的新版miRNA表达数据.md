---
title: "听说你想要TCGA的新版miRNA表达数据"
date: 2023-03-10T09:47:04Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
听说你想要TCGA的新版miRNA表达数据 by 生信星球
------
<div><section data-mpa-powered-by="yiban.io"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png"><span> 今天是生信星球陪你的<span><strong>第899天</strong></span></span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"></section><hr><p><span><span>   </span><span>大神一句话，菜鸟跑半年。我不是大神，但我可以缩短你走弯路的半年~</span></span></p><p><span>   就像歌儿唱的那样，如果你不知道该往哪儿走，就留在这学点生信好不好~</span></p><p><span>   这里有豆豆和花花的学习历程，从新手到进阶，生信路上有你有我!</span><span></span></p><section><section><section><p>TCGA的下载方式更新了，miRNA也跟着动一下。</p><h4><span><span> </span>1.查看TCGA的33个癌种</span></h4><pre><code>rm(list = ls())<br><span>library</span>(TCGAbiolinks)<br><span>library</span>(stringr)<br><span>library</span>(SummarizedExperiment)<br>projs &lt;- getGDCprojects()$project_id %&gt;% <br>  str_subset(<span>"TCGA"</span>)<br>projs<br><span>## [1] "TCGA-CHOL" "TCGA-LIHC" "TCGA-DLBC" "TCGA-BLCA" "TCGA-ACC" </span><br><span>## [6] "TCGA-CESC" "TCGA-PCPG" "TCGA-PAAD" "TCGA-MESO" "TCGA-TGCT"</span><br><span>## [11] "TCGA-KIRP" "TCGA-UVM"  "TCGA-UCS"  "TCGA-THYM" "TCGA-COAD"</span><br><span>## [16] "TCGA-ESCA" "TCGA-GBM"  "TCGA-KICH" "TCGA-HNSC" "TCGA-PRAD"</span><br><span>## [21] "TCGA-OV"   "TCGA-LUSC" "TCGA-LAML" "TCGA-LGG"  "TCGA-SARC"</span><br><span>## [26] "TCGA-BRCA" "TCGA-READ" "TCGA-LUAD" "TCGA-STAD" "TCGA-THCA"</span><br><span>## [31] "TCGA-KIRC" "TCGA-SKCM" "TCGA-UCEC"</span><br></code></pre><h4><span><span> </span>2.下载数据</span></h4><p>使用的是TCGAbiolinks里面的函数，受网络限制，有可能下载不成功。</p><pre><code>project = <span>"TCGA-ESCA"</span><br><span>if</span>(<span>F</span>){<br>  query.isoform &lt;- GDCquery(<br>    project = project, <br>    experimental.strategy = <span>"miRNA-Seq"</span>,<br>    data.category = <span>"Transcriptome Profiling"</span>, <br>    data.type = <span>"Isoform Expression Quantification"</span><br>  )<br>  GDCdownload(query.isoform)<br><br>  isoform &lt;- GDCprepare(<br>    query = query.isoform,<br>    save = <span>TRUE</span>, <br>    save.filename = paste0(project,<span>"_isoform.Rdata"</span>)<br>  )  <br>}<br></code></pre><h4><span><span> </span>3.整理数据</span></h4><pre><code>rm(list = ls())<br>load(<span>"TCGA-ESCA_isoform.Rdata"</span>)<br><span>library</span>(tibble)<br><span>library</span>(dplyr)<br><span>library</span>(tidyr)<br>head(data)<br><br><span>## # A tibble: 6 × 7</span><br><span>##   miRNA_ID     isoform_coords read_…¹ reads…² cross…³ miRNA…⁴ barcode</span><br><span>##   &lt;chr&gt;        &lt;chr&gt;            &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  </span><br><span>## 1 hsa-let-7a-1 hg38:chr9:941…       1   0.316 N       precur… TCGA-V…</span><br><span>## 2 hsa-let-7a-1 hg38:chr9:941…       1   0.316 N       precur… TCGA-V…</span><br><span>## 3 hsa-let-7a-1 hg38:chr9:941…       1   0.316 N       mature… TCGA-V…</span><br><span>## 4 hsa-let-7a-1 hg38:chr9:941…       2   0.631 N       mature… TCGA-V…</span><br><span>## 5 hsa-let-7a-1 hg38:chr9:941…       5   1.58  N       mature… TCGA-V…</span><br><span>## 6 hsa-let-7a-1 hg38:chr9:941…      33  10.4   N       mature… TCGA-V…</span><br><span>## # … with abbreviated variable names ¹read_count,</span><br><span>## #   ²reads_per_million_miRNA_mapped, ³`cross-mapped`, ⁴miRNA_region</span><br><br>colnames(data)<br><br><span>## [1] "miRNA_ID"                       "isoform_coords"                </span><br><span>## [3] "read_count"                     "reads_per_million_miRNA_mapped"</span><br><span>## [5] "cross-mapped"                   "miRNA_region"                  </span><br><span>## [7] "barcode"</span><br><br>exp = data %&gt;%<br>  dplyr::select(c(miRNA_region,read_count,barcode)) %&gt;% <br>  group_by(barcode,miRNA_region) %&gt;% <br>  summarise(read_count = sum(read_count)) %&gt;% <br>  pivot_wider(names_from = barcode,<br>              values_from = read_count) %&gt;% <br>  column_to_rownames(<span>"miRNA_region"</span>) %&gt;% <br>  as.matrix()<br>exp[is.na(exp)] = <span>0</span><br>exp[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br><br><span>##                     TCGA-2H-A9GF-01A-11R-A37J-13</span><br><span>## mature,MIMAT0000062                       176657</span><br><span>## mature,MIMAT0000063                        25442</span><br><span>## mature,MIMAT0000064                         6623</span><br><span>## mature,MIMAT0000065                          813</span><br><span>##                     TCGA-2H-A9GG-01A-11R-A37J-13</span><br><span>## mature,MIMAT0000062                       127124</span><br><span>## mature,MIMAT0000063                        33978</span><br><span>## mature,MIMAT0000064                         2488</span><br><span>## mature,MIMAT0000065                          808</span><br><span>##                     TCGA-2H-A9GH-01A-11R-A37J-13</span><br><span>## mature,MIMAT0000062                       124680</span><br><span>## mature,MIMAT0000063                        18955</span><br><span>## mature,MIMAT0000064                         3896</span><br><span>## mature,MIMAT0000065                          662</span><br><span>##                     TCGA-2H-A9GI-01A-11R-A37J-13</span><br><span>## mature,MIMAT0000062                       212221</span><br><span>## mature,MIMAT0000063                        25107</span><br><span>## mature,MIMAT0000064                         1412</span><br><span>## mature,MIMAT0000065                         1874</span><br><br><span>##### 简化行名，去掉前缀</span><br>k = str_detect(rownames(exp),<span>"mature,"</span>);table(k)<br><br><span>## k</span><br><span>## FALSE  TRUE </span><br><span>##     3  2082</span><br><br>rownames(exp)[!k]<br><br><span>## [1] "precursor"   "stemloop"    "unannotated"</span><br><br>exp = exp[k,]<br>rownames(exp) = str_remove(rownames(exp),<span>"mature,"</span>)<br><span>##### 找到行名的对应关系</span><br><span>library</span>(miRBaseVersions.db)<br>mh &lt;- select(miRBaseVersions.db,<br>               keys = rownames(exp),<br>               keytype = <span>"MIMAT"</span>,<br>               columns = c(<span>"ACCESSION"</span>,<span>"NAME"</span>,<span>"VERSION"</span>))<br>head(mh)<br><br><span>##      ACCESSION          NAME VERSION</span><br><span>## 1 MIMAT0000062 hsa-let-7a-5p      22</span><br><span>## 2 MIMAT0000063 hsa-let-7b-5p      22</span><br><span>## 3 MIMAT0000064 hsa-let-7c-5p      22</span><br><span>## 4 MIMAT0000065 hsa-let-7d-5p      22</span><br><span>## 5 MIMAT0000066 hsa-let-7e-5p      22</span><br><span>## 6 MIMAT0000067 hsa-let-7f-5p      22</span><br><br>mh = mh[mh$VERSION==<span>"21"</span>,]<br>table(rownames(exp) %<span>in</span>% mh$ACCESSION)<br><br><span>## </span><br><span>## TRUE </span><br><span>## 2082</span><br><span># 转换行名</span><br><span>library</span>(tinyarray)<br>exp = trans_array(exp,mh,from = <span>"ACCESSION"</span>,to = <span>"NAME"</span>)<br>exp[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br><br><span>##               TCGA-2H-A9GF-01A-11R-A37J-13</span><br><span>## hsa-let-7a-5p                       176657</span><br><span>## hsa-let-7b-5p                        25442</span><br><span>## hsa-let-7c-5p                         6623</span><br><span>## hsa-let-7d-5p                          813</span><br><span>##               TCGA-2H-A9GG-01A-11R-A37J-13</span><br><span>## hsa-let-7a-5p                       127124</span><br><span>## hsa-let-7b-5p                        33978</span><br><span>## hsa-let-7c-5p                         2488</span><br><span>## hsa-let-7d-5p                          808</span><br><span>##               TCGA-2H-A9GH-01A-11R-A37J-13</span><br><span>## hsa-let-7a-5p                       124680</span><br><span>## hsa-let-7b-5p                        18955</span><br><span>## hsa-let-7c-5p                         3896</span><br><span>## hsa-let-7d-5p                          662</span><br><span>##               TCGA-2H-A9GI-01A-11R-A37J-13</span><br><span>## hsa-let-7a-5p                       212221</span><br><span>## hsa-let-7b-5p                        25107</span><br><span>## hsa-let-7c-5p                         1412</span><br><span>## hsa-let-7d-5p                         1874</span><br></code></pre><p>这样就整理完成咯。</p></section></section></section><section><blockquote><section><span>如果因为代码看不懂，而跟不上正文的节奏，可以来找我，系统学习。我的</span><span>课程都是循环开课。</span><span>下一期的时间，点进去咨询微信咯</span><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247492968&amp;idx=1&amp;sn=1a490af3bce46c502eed5fb96828c061&amp;chksm=fdfbad2aca8c243cd411f40dccad9bc6a459aaee66eaf67530d43c78d27773e817d1ea379fb1&amp;scene=21#wechat_redirect" textvalue="新的一年，你要不要来找我们学‍习生信" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">新的一年，你要不要来找我们学习生信</a><br></section></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/LMacx8lAOOGvR60YO7sYzQ",target="_blank" rel="noopener noreferrer">原文链接</a>
