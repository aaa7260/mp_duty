---
title: "GREAT富集分析时请使用正确的基因组版本"
date: 2023-03-27T00:12:01Z
draft: ["false"]
tags: [
  "fetched",
  "方圆之处"
]
categories: ["Acdemic"]
---
GREAT富集分析时请使用正确的基因组版本 by 方圆之处
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">GREAT分析是用来直接对基因组区间进行功能富集的一种分析方法，在这篇文章中，我将展示选择了错误的基因组版本进行分析所产生的后果。</p><p data-tool="mdnice编辑器">我们使用<strong>rGREAT</strong>包进行GREAT分析，这里我们首先载入<strong>GenomicRanges</strong>和<strong>rGREAT</strong>包。</p><pre data-tool="mdnice编辑器"><code><span>library</span>(GenomicRanges)<br><span>library</span>(rGREAT)<br></code></pre><p data-tool="mdnice编辑器">我们使用一个来自于UCSC数据库的基于人类基因组版本hg38的数据集，参数如下：</p><pre data-tool="mdnice编辑器"><code>clade = Mammal<br>genome = Human<br>assembly = GRCh38/hg38<br>group = Regulation<br>track = TF ChIP<br>table = A549 MYC (encTfChipPkENCFF542GMN)<br></code></pre><p data-tool="mdnice编辑器">读入这个bed文件，将其转化为一个<code>GRanges</code>对象，然后使用<code>great()</code>函数进行富集分析。注意<code>gr</code>是来自于基因组hg38，在这里，我们使用hg19基因组和hg38基因组，并对结果进行比较。</p><pre data-tool="mdnice编辑器"><code>df = read.table(<span>"data/A549_MYC_encTfChipPkENCFF542GMN_hg38.bed"</span>)<br>df = df[df[, <span>1</span>] %<span>in</span>% paste0(<span>"chr"</span>, c(<span>1</span>:<span>22</span>, <span>"X"</span>, <span>"Y"</span>)), ]<br>gr = GRanges(seqnames = df[, <span>1</span>], ranges = IRanges(df[, <span>2</span>]+<span>1</span>, df[, <span>3</span>]))<br><br>res_hg19 = great(gr, <span>"GO:BP"</span>, <span>"TxDb.Hsapiens.UCSC.hg19.knownGene"</span>, <span>min_gene_set_size = </span><span>0</span><span>)</span></code></pre><pre data-tool="mdnice编辑器"><code><span>## Warning: Inconsistent coordinate on 'chr5': Max end position (181261577) is</span><br><span>## larger than chromosome length (180915260).</span><br><span>## Warning: Inconsistent coordinate on 'chr17': Max end position (83110490) is</span><br><span>## larger than chromosome length (81195210).</span><br><span>## Warning: Inconsistent coordinate on 'chr18': Max end position (80034737) is</span><br><span>## larger than chromosome length (78077248).</span><br><span>## Warning: Inconsistent coordinate on 'chr20': Max end position (64131770) is</span><br><span>## larger than chromosome length (63025520).</span><br><span>## Warning: Inconsistent coordinate on 'chrX': Max end position (155881472) is</span><br><span>## larger than chromosome length (155270560).</span><br></code></pre><pre data-tool="mdnice编辑器"><code>res_hg38 = great(gr, <span>"GO:BP"</span>, <span>"TxDb.Hsapiens.UCSC.hg38.knownGene"</span>, min_gene_set_size = <span>0</span>)<br><br>tb_hg19 = getEnrichmentTable(res_hg19)<br>tb_hg38 = getEnrichmentTable(res_hg38)<br></code></pre><p data-tool="mdnice编辑器">可见如果使用了错误的基因组版本，由于染色体长度的不兼容，运行代码会产生警告信息。</p><p data-tool="mdnice编辑器">下面这张图显示了使用不同基因组版本下显著GO集合的韦恩图。可见使用不同基因组版本会产生很大的差异。</p><pre data-tool="mdnice编辑器"><code><span>library</span>(eulerr)<br>lt = list(<br>    hg19 = tb_hg19$id[tb_hg19$p_adjust &lt; <span>0.01</span>],<br>    hg38 = tb_hg38$id[tb_hg38$p_adjust &lt; <span>0.01</span>]<br>)<br>plot(euler(lt), quantities = <span>TRUE</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeg0FF7QGtXWnAqcibU6rSM61NaphtticlJEzM7j5wjy9gDVEAicGZPT2oe2icdqXwia9VJswfBiaGmoiaSQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeg0FF7QGtXWnAqcibU6rSM61NaphtticlJEzM7j5wjy9gDVEAicGZPT2oe2icdqXwia9VJswfBiaGmoiaSQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">为了直接比较两组富集结果，我们首先取出在两个结果中都有的GO集合，并且调整两个结果表格使其具有相同的行序。</p><p data-tool="mdnice编辑器">在下面的代码中，我还随机打乱了GO集合的顺序，这是为了去除富集结果表格中可能存在的预排序，可能会对下游的可视化（散点图）产生影响。</p><pre data-tool="mdnice编辑器"><code>rownames(tb_hg19) = tb_hg19$id<br>rownames(tb_hg38) = tb_hg38$id<br>cn = intersect(tb_hg19$id, tb_hg38$id)<br>cn = sample(cn)<br>tb_hg19 = tb_hg19[cn, ]<br>tb_hg38 = tb_hg38[cn, ]<br></code></pre><p data-tool="mdnice编辑器">我们首先绘制hg19和hg38下log2 fold enrichment的散点图。log2 fold enrichment被定义为<code>log2(obs/exp)</code>，其中obs是用户提供的基因组区间与某基因集合关联的个数，exp是期望个数，定义为用户提供的所有基因组区间个数x某基因集合关联区域在基因组中的百分比（请详见rGREAT或者GREAT的论文）。下面的散点图显示，hg19和hg38下的结果的相关性并不强烈。</p><pre data-tool="mdnice编辑器"><code>plot(log2(tb_hg19$fold_enrichment), <br>    log2(tb_hg38$fold_enrichment), pch = <span>16</span>, <br>    col = <span>"#00000020"</span>, xlab = <span>"hg19"</span>, ylab = <span>"hg38"</span>, <br>    main = <span>"log2 fold change"</span>,<br>    xlim = c(-<span>6</span>, <span>6</span>), ylim = c(-<span>6</span>, <span>6</span>)<br>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeg0FF7QGtXWnAqcibU6rSM6VH9J87M5libAj67n2piaTkc1iaOqeLK3KvecicLBJMkae8JPjtyO6ucAlQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeg0FF7QGtXWnAqcibU6rSM6VH9J87M5libAj67n2piaTkc1iaOqeLK3KvecicLBJMkae8JPjtyO6ucAlQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">其次我们比较基因集合关联区域在基因组中的比例。下图表示hg19和hg38下的关系具有非常强的线性相关性。这在意料之中，因为不同基因版本更多的是导致基因位置的平移，对于区间的宽度影响不大。</p><pre data-tool="mdnice编辑器"><code>plot(tb_hg19$genome_fraction, tb_hg38$genome_fraction, <br>    pch = <span>16</span>, log = <span>"xy"</span>,<br>    col = <span>"#00000020"</span>, xlab = <span>"hg19"</span>, ylab = <span>"hg38"</span>, <br>    main = <span>"genome_fraction"</span><br>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeg0FF7QGtXWnAqcibU6rSM69O3Oav4icbHRdvvUua34APELqMbwPJoQFazwzmEmoTqaGBYj8hrDic0g/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeg0FF7QGtXWnAqcibU6rSM69O3Oav4icbHRdvvUua34APELqMbwPJoQFazwzmEmoTqaGBYj8hrDic0g/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">用户提供了一组基因组区间，落在某一基因集合关联区域的区间的个数可以用一个随机变量<span><span role="presentation" data-formula="X" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -683 852 683" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="58" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g></g></g></svg></span></span>表示。<span><span role="presentation" data-formula="X" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -683 852 683" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="58" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g></g></g></svg></span></span>服从一个二项式分布，记为<span><span role="presentation" data-formula="X \sim B(p, N)" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -750 5558.2 1000" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="58" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g><g data-mml-node="mo" transform="translate(1129.8, 0)"><path data-c="223C" d="M55 166Q55 241 101 304T222 367Q260 367 296 349T362 304T421 252T484 208T554 189Q616 189 655 236T694 338Q694 350 698 358T708 367Q722 367 722 334Q722 260 677 197T562 134H554Q517 134 481 152T414 196T355 248T292 293T223 311Q179 311 145 286Q109 257 96 218T80 156T69 133Q55 133 55 166Z"></path></g><g data-mml-node="mi" transform="translate(2185.6, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mo" transform="translate(2944.6, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(3333.6, 0)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mo" transform="translate(3836.6, 0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(4281.2, 0)"><path data-c="4E" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mo" transform="translate(5169.2, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></span></span>，其中<span><span role="presentation" data-formula="N" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -683 888 683" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="4E" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g></g></g></svg></span></span>是用户提供的基因组区间总数，<span><span role="presentation" data-formula="p" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -442 503 636" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g></g></g></svg></span></span>是某一基因集合关联区域在基因组中的百分比。P值计算为<span><span role="presentation" data-formula="P=Pr(X \ge n)" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -750 6850.1 1000" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(1028.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(2084.6, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(2835.6, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(3286.6, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(3675.6, 0)"><path data-c="58" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g><g data-mml-node="mo" transform="translate(4805.3, 0)"><path data-c="2265" d="M83 616Q83 624 89 630T99 636Q107 636 253 568T543 431T687 361Q694 356 694 346T687 331Q685 329 395 192L107 56H101Q83 58 83 76Q83 77 83 79Q82 86 98 95Q117 105 248 167Q326 204 378 228L626 346L360 472Q291 505 200 548Q112 589 98 597T83 616ZM84 -118Q84 -108 99 -98H678Q694 -104 694 -118Q694 -130 679 -138H98Q84 -131 84 -118Z"></path></g><g data-mml-node="mi" transform="translate(5861.1, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(6461.1, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></span></span>。在之前的图中我们已经证实，<span><span role="presentation" data-formula="N" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -683 888 683" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="4E" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g></g></g></svg></span></span>一般是不变的，<span><span role="presentation" data-formula="p" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -442 503 636" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g></g></g></svg></span></span>在hg19和hg38下非常相似，那么影响最终P值的只有<span><span role="presentation" data-formula="n" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -442 600 453" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></span></span>，也就是落在某一基因集合关联区域的区间的个数。</p><p data-tool="mdnice编辑器">下面我们直接比较hg19和hg38下落在某一基因集合关联区域的区间的个数（在结果表格中列名为<code>observed_region_hits</code>）。在下面的代码中个，红色的点表示只在hg19下显著的GO集合，绿色的点表示只在hg38下显著的集合，蓝色的点表示同时在hg19和hg38下都显著的GO集合。</p><pre data-tool="mdnice编辑器"><code>l1 = tb_hg19$p_adjust &lt; <span>0.01</span> &amp; tb_hg38$p_adjust &gt; <span>0.01</span>   <span># only in hg19</span><br>l2 = tb_hg19$p_adjust &gt; <span>0.01</span> &amp; tb_hg38$p_adjust &lt; <span>0.01</span>   <span># only in hg38</span><br>l3 = tb_hg19$p_adjust &lt; <span>0.01</span> &amp; tb_hg38$p_adjust &lt; <span>0.01</span>   <span># both</span><br>plot(tb_hg19$observed_region_hits, tb_hg38$observed_region_hits, <br>    pch = <span>16</span>, log = <span>"xy"</span>,<br>    col = ifelse(l1, <span>"#FF000040"</span>, <br>            ifelse(l2, <span>"#00FF0040"</span>, <br>              ifelse(l3, <span>"#0000FF40"</span>, <span>"#00000060"</span>)<br>            )<br>          ), <br>    cex = ifelse(l1 | l2 | l3, <span>1</span>, <span>0.5</span>),<br>    xlab = <span>"hg19"</span>, ylab = <span>"hg38"</span>, main = <span>"observed_region_hits"</span><br>)<br>legend(<span>"topleft"</span>, pch = <span>16</span>, col = c(<span>"red"</span>, <span>"blue"</span>, <span>"green"</span>), <br>    legend = c(<span>"only sig in hg19"</span>, <span>"sig in both"</span>, <span>"only sig in hg38"</span>)<br>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeg0FF7QGtXWnAqcibU6rSM6HhNQvUZUdAsaAGRUFicib3eTZVEzjViaib9MLMFV128uWOYUyY7Dx9a7Qw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeg0FF7QGtXWnAqcibU6rSM6HhNQvUZUdAsaAGRUFicib3eTZVEzjViaib9MLMFV128uWOYUyY7Dx9a7Qw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">在上图中个，我们可以看到使用错误的基因组版本主要影响那些只关联了较少用户区间的基因集合。使用不同的基因组版本，由于基因位置的平移，一个用户区间可能会被关联到某一个基因集合中，也可能不会关联到某一个基因集合中个。对于“较小的”基因集合，变异性会变得很大（图的左下角的点）。</p><p data-tool="mdnice编辑器">我们也可以通过看每个基因集合中用户区间到基因TSS的平均距离。在下图中，我们可以很清楚的看到，如果一个GO集合有较小的“observed_region_hits”值（红色的点），离TSS的平均距离的差异很大。反之亦然。</p><pre data-tool="mdnice编辑器"><code>l = tb_hg38$observed_region_hits &lt; <span>200</span><br>plot(tb_hg19$mean_tss_dist, tb_hg38$mean_tss_dist, <br>    pch = <span>16</span>, log = <span>"xy"</span>,<br>    col = ifelse(l, <span>"#FF000020"</span>, <span>"#0000FF60"</span>), <br>    xlim = c(<span>1e2</span>, <span>1e6</span>), ylim = c(<span>1e2</span>, <span>1e6</span>),<br>    xlab = <span>"hg19"</span>, ylab = <span>"hg38"</span>, main = <span>"mean_tss_dist"</span>)<br>legend(<span>"topleft"</span>, pch = <span>16</span>, col = c(<span>"red"</span>, <span>"blue"</span>),<br>    legend = c(<span>"small n_obs in hg38 (&lt; 200)"</span>, <br>               <span>"large n_obs in hg38 (&gt;= 200)"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeg0FF7QGtXWnAqcibU6rSM6Fjic9uktrklsiaouI46DyYvrSUChcvdAxu0csvOmrGqMUhOMRcsuiaedQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8yoFdJolUibeg0FF7QGtXWnAqcibU6rSM6Fjic9uktrklsiaouI46DyYvrSUChcvdAxu0csvOmrGqMUhOMRcsuiaedQ/640?wx_fmt=png"></figure><h2 data-tool="mdnice编辑器"><span></span>结论</h2><p data-tool="mdnice编辑器">此分析表明使用错误的基因组版本会对结果产生非常大的影响，尤其是那些只关联了较少的用户基因组区间的基因集合。因此在进行GREAT分析时，选择正确的基因组版本非常重要。</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/ihIOZNXc9QcJc2JouPyzFg",target="_blank" rel="noopener noreferrer">原文链接</a>
