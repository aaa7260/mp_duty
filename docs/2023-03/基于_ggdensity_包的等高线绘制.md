---
title: "基于 ggdensity 包的等高线绘制"
date: 2023-03-10T10:46:24Z
draft: ["false"]
tags: [
  "fetched",
  "庄闪闪的R语言手册"
]
categories: ["Acdemic"]
---
基于 ggdensity 包的等高线绘制 by 庄闪闪的R语言手册
------
<div><p data-mpa-powered-by="yiban.io"><span>‍</span></p><p><span><span>‍</span>点击下方</span><span>公众号</span><span>，回复</span><span>资料分享</span><span>，收获惊喜</span></p><section><mp-common-profile data-pluginname="mpprofile" data-weui-theme="light" data-id="MzI1NjUwMjQxMQ==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHiaOjUwXredJLzMleuKP97WYf7W4ylibNiaRJlP7icneHRGekYcQEPgTLpIDbibTuuEADhn0Sv4Xqhhf4A/0?wx_fmt=png" data-nickname="庄闪闪的R语言手册" data-alias="Zss_R4ds" data-signature="在读统计博士生，R语言爱好者。来跟着我一起学 R 数据科学，可视化。" data-from="0" data-is_biz_ban="0"></mp-common-profile><span></span></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>简介</span></h2><p data-tool="mdnice编辑器">科研过程中，需要绘制某个后验密度/其他的形状。在发表论文中常常使用等高线来满足该需求。例如：<span>文献</span><sup>[1]</sup>中所给出的图：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.8237791932059448" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrVZAj5O8ibia4jRTQWV8M3ppNKVzxUBZg13FzlApeibt5z7SmCInAgPJ9Kw/640?wx_fmt=png" data-type="png" data-w="942" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrVZAj5O8ibia4jRTQWV8M3ppNKVzxUBZg13FzlApeibt5z7SmCInAgPJ9Kw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">今天小编主要学习下 <span>ggdensity</span><sup>[2]</sup> 来绘制不同类型的等高线，以便今后查阅和使用。并在此基础上，简单学习了另一种方式（<span>ggblanket</span><sup>[3]</sup> 包）构建等高线。全文使用 [ggsci]((https://nanx.me/ggsci/ "ggsci")) 来修改配色。</p><p data-tool="mdnice编辑器">主要参考的资料有<span>1</span><sup>[4]</sup>、<span>2</span><sup>[5]</sup>。</p><h2 data-tool="mdnice编辑器"><span></span><span>教程</span></h2><h3 data-tool="mdnice编辑器"><span></span><span>数据介绍</span><span></span></h3><p data-tool="mdnice编辑器">本文使用常用数据集 <code>iris</code> 来作为例子。该数据集的前 6 行数据如下所示：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.32465753424657534" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrVZ5vPI0baRNueJImPyYibgZ8XURLaz1xg5icjjQKlZAIBHRoOmr7Ka7tQ/640?wx_fmt=png" data-type="png" data-w="1460" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrVZ5vPI0baRNueJImPyYibgZ8XURLaz1xg5icjjQKlZAIBHRoOmr7Ka7tQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">使用的 R 包包括：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggdensity)<br><span>library</span>(ggblanket)<br><span>library</span>(ggsci)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>版本一</span><span></span></h3><p data-tool="mdnice编辑器">使用 <code>geom_hdr()</code> 绘制等高线，配合 <code>facet_wrap()</code> 分面和 ggsci 包中的 <code>scale_fill_aaas()</code>修改配色方案。这是最简单的版本，其实大体上已经符合我的需求了。接下来展示在此基础上的一些调整，供大家以后参考使用。</p><pre data-tool="mdnice编辑器"><span></span><code>ggplot(iris,aes(x = Sepal.Width, y = Sepal.Length, fill = Species)) +<br>  geom_hdr() + <br>  scale_fill_aaas() +<br>  facet_wrap(vars(Species)) <br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6010544815465729" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrVkGINA0Tm8AUHSTqCam7ibrktCiamS3VSqnCeYHyQC3y2G77cHuTqllyQ/640?wx_fmt=png" data-type="png" data-w="1138" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrVkGINA0Tm8AUHSTqCam7ibrktCiamS3VSqnCeYHyQC3y2G77cHuTqllyQ/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>版本二</span><span></span></h3><p data-tool="mdnice编辑器">为了说明各个点的位置，可以直接在原来基础上增加代码：<code>geom_point(shape = 21)</code>。</p><pre data-tool="mdnice编辑器"><span></span><code><span># 增加点</span><br>ggplot(iris,aes(x = Sepal.Width, y = Sepal.Length, fill = Species)) +<br>  geom_hdr() + <br>  geom_point(shape = <span>21</span>) +<br>  scale_fill_aaas() +<br>  facet_wrap(vars(Species)) <br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5950704225352113" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrV50g6dpUl9uqMjDpPvpMS3ZR2Dwsuiabl2NLZPEqibzPqpuVTdtStEw3g/640?wx_fmt=png" data-type="png" data-w="1136" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrV50g6dpUl9uqMjDpPvpMS3ZR2Dwsuiabl2NLZPEqibzPqpuVTdtStEw3g/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>版本三</span><span></span></h3><p data-tool="mdnice编辑器">使用 <code>geom_hdr_lines()</code> 配合 <code>geom_point()</code>，得到等高线（没有填充）和对应点。当然如果你觉得点的颜色太花了，可以在<code>geom_point()</code> 设置 <code>color = "black"</code>。</p><pre data-tool="mdnice编辑器"><span></span><code>ggplot(iris,aes(x = Sepal.Width, y = Sepal.Length, color = Species)) +<br>  geom_hdr_lines() +<br>  geom_point() +<br>  scale_color_aaas() +<br>  facet_wrap(vars(Species)) <br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6056338028169014" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrVa9PbhLe5PqSVgsXEibZ8f3UJIPFhEsH9NhJMPD1HaOiba4zaGOmzuXvg/640?wx_fmt=png" data-type="png" data-w="1136" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrVa9PbhLe5PqSVgsXEibZ8f3UJIPFhEsH9NhJMPD1HaOiba4zaGOmzuXvg/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code> <br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>版本四</span><span></span></h3><p data-tool="mdnice编辑器">在原来的基础上，使用 <code>geom_hdr_rug()</code> 加入地毯。</p><pre data-tool="mdnice编辑器"><span></span><code><br>ggplot(iris,aes(x = Sepal.Width, y = Sepal.Length, fill = Species)) +<br>  ggdensity::geom_hdr() + <br>  geom_point(shape = <span>21</span>) +<br>  scale_fill_aaas() +<br>  facet_wrap(vars(Species)) +<br>  geom_hdr_rug()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6021314387211367" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrVE0wcK3VWca1nFxDltc2sZsv9bYsGc3FiaIjjuaicNW59VNLVtPm6JdgA/640?wx_fmt=png" data-type="png" data-w="1126" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrVE0wcK3VWca1nFxDltc2sZsv9bYsGc3FiaIjjuaicNW59VNLVtPm6JdgA/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>版本五</span><span></span></h3><p data-tool="mdnice编辑器">这里还可以使用 {<code>ggblanket</code>} 包绘制，该包集成了 ggplot 的语法，对新手使用更加方便。例如，iris 包绘制等高线可由以下代码实现。</p><pre data-tool="mdnice编辑器"><span></span><code>iris |&gt;<br>  gg_blank(<br>    x = Sepal.Width,<br>    y = Sepal.Length,<br>    col = Species,<br>    facet = Species,<br>    col_legend_place = <span>"r"</span>) +<br>  ggdensity::geom_hdr(colour = <span>NA</span>) +<br>  labs(alpha = <span>"Probs"</span>) +<br>  theme(legend.title = element_text(margin = margin(t = <span>5</span>)))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrV4TJMpsXcMJvr57VGsqFHOGnenpmS2CYgsGh2sZPmtibrniaiaYqudSJ7Q/640?wx_fmt=png" data-type="png" data-w="1140" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrV4TJMpsXcMJvr57VGsqFHOGnenpmS2CYgsGh2sZPmtibrniaiaYqudSJ7Q/640?wx_fmt=png"></figure><h2 data-tool="mdnice编辑器"><span></span><span>小编有话说</span></h2><ul data-tool="mdnice编辑器"><li><p><br></p><section><span><span>关于文章所提的文献中的图，本文并没有做复现工作，使用 </span></span><code>geom_hdr_lines()</code><span><span>，</span></span><code>factet_wrap()</code><span><span>, </span></span><code>geom_text()</code><span><span> 和 </span></span><code>annotate()</code><span><span> 基本就可以满足需求。</span></span></section><p><br></p><p><br></p></li></ul><blockquote data-tool="mdnice编辑器"><p><strong>注意</strong>：本文的代码（.RMD）已经放到我的 GitHub 中（文末原文直达），有兴趣读者可以下载。此外，往期部分推文代码都已经公开，欢迎大家 Fork，star 使用。</p></blockquote><figure data-tool="mdnice编辑器"><img data-ratio="0.4053191489361702" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrVYT2I0jdGiaBqoD5Yqr5I3NcNY12FZibN3UjW7Vg91E5z4fnDzLyEiaJYg/640?wx_fmt=png" data-type="png" data-w="1880" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHjGAMwWEb8rAj2CibVfwadrVYT2I0jdGiaBqoD5Yqr5I3NcNY12FZibN3UjW7Vg91E5z4fnDzLyEiaJYg/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span>参考资料</span></h3><section data-tool="mdnice编辑器"><span><span>[1]</span><p>文献: <em>Fang, G. (2020). Multivariate Statistical Modeling and Analysis of Accelerated Degradation Testing Data for Reliability Prediction.</em></p></span></section><section data-tool="mdnice编辑器"><span><span>[2]</span><p>ggdensity: <em>https://cloud.r-project.org/web/packages/ggdensity/index.html</em></p></span><span><span>[3]</span><p>ggblanket: <em>https://davidhodge931.github.io/ggblanket/articles/ggblanket.html</em></p></span><span><span>[4]</span><p>1: <em>https://jamesotto852.github.io/ggdensity/</em></p></span><span><span>[5]</span><p>2: <em>https://davidhodge931.github.io/ggblanket/articles/ggblanket.html</em></p></span></section></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">推荐： 可以保存以下照片，在b站扫该二维码，或者b站搜索【庄闪闪】观看Rmarkdown系列的视频教程。Rmarkdown视频新增两节视频（写轮眼幻灯片制作）需要视频内的文档，可在公众号回复【rmarkdown】<br></p></section><p><img data-cropselx1="0" data-cropselx2="558" data-cropsely1="0" data-cropsely2="709" data-ratio="1.2697916666666667" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHgqHNBecRAPwEt9BwiazJN4FgL5hGictfWBVK6f5pS7a3CQBiaE7L8IgJwIcJCQXVdMEsQibnNkiajfoZw/640?wx_fmt=jpeg" data-type="jpeg" data-w="960" src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHgqHNBecRAPwEt9BwiazJN4FgL5hGictfWBVK6f5pS7a3CQBiaE7L8IgJwIcJCQXVdMEsQibnNkiajfoZw/640?wx_fmt=jpeg"></p><section data-mpa-template="t" data-from="yb-recommend-list"><br><section data-mpa-template="t" data-from="yb-recommend" data-recommend-article-type="normal" data-recomment-template-id="1" data-recommend-article-id="2247492028_1" data-recommend-article-time="1615811746" data-recommend-article-cover="http://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHjqYtTRnKYwYP4k7iaZoMibUQYZg8ziaLUAFiaIK4cNS6u5iazLD9ffuN9C8M9pk0Nq5y7GhM5npfTibnRw/0?wx_fmt=jpeg" data-recommend-article-title="R沟通｜Rmarkdown教程（4）" data-recommend-article-content-url="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247492028&amp;idx=1&amp;sn=9964f55b6cdc984f22620330e752226e&amp;chksm=ea271e58dd50974e35b274816cd9dde9cda3c0864487b187b4f2ac87c9773d782b02e5b28816#rd"><a href="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247492028&amp;idx=1&amp;sn=9964f55b6cdc984f22620330e752226e&amp;chksm=ea271e58dd50974e35b274816cd9dde9cda3c0864487b187b4f2ac87c9773d782b02e5b28816&amp;scene=21#wechat_redirect" data-linktype="1"><section data-recommend-type="normal" data-recommend-tid="1" data-mid=""><section data-mid=""><section data-mid=""><span data-positionback="static"><img data-ratio="0.4263322884012539" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHjqYtTRnKYwYP4k7iaZoMibUQYZg8ziaLUAFiaIK4cNS6u5iazLD9ffuN9C8M9pk0Nq5y7GhM5npfTibnRw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1276" src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHjqYtTRnKYwYP4k7iaZoMibUQYZg8ziaLUAFiaIK4cNS6u5iazLD9ffuN9C8M9pk0Nq5y7GhM5npfTibnRw/640?wx_fmt=jpeg"></span></section><section data-mid=""><p data-recommend-title="t" data-mid="">R沟通｜Rmarkdown教程（4）</p></section></section></section></a></section><br><section data-mpa-template="t" data-from="yb-recommend" data-recommend-article-type="normal" data-recomment-template-id="1" data-recommend-article-id="2247491844_1" data-recommend-article-time="1615203000" data-recommend-article-cover="http://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHjQaBFpiaqVdicmbG9Qc6jzc6libMFWfa3BibLBAuEvheHibyV9XmEElb1t3DbCLQksuL8TK9PWYaZsmrw/0?wx_fmt=jpeg" data-recommend-article-title="R沟通｜Rmarkdown教程（3）" data-recommend-article-content-url="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247491844&amp;idx=1&amp;sn=36decacb06ca6ce1fc689141174bb98f&amp;chksm=ea271ee0dd5097f615b87c27151200635a9e5ff3c3072864bcf8fe6e8fbc41c0cffc6c95148f#rd"><a href="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247491844&amp;idx=1&amp;sn=36decacb06ca6ce1fc689141174bb98f&amp;chksm=ea271ee0dd5097f615b87c27151200635a9e5ff3c3072864bcf8fe6e8fbc41c0cffc6c95148f&amp;scene=21#wechat_redirect" data-linktype="1"><section data-recommend-type="normal" data-recommend-tid="1" data-mid=""><section data-mid=""><section data-mid=""><span data-positionback="static"><img data-ratio="0.42617717478052675" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHjQaBFpiaqVdicmbG9Qc6jzc6libMFWfa3BibLBAuEvheHibyV9XmEElb1t3DbCLQksuL8TK9PWYaZsmrw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1253" src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHjQaBFpiaqVdicmbG9Qc6jzc6libMFWfa3BibLBAuEvheHibyV9XmEElb1t3DbCLQksuL8TK9PWYaZsmrw/640?wx_fmt=jpeg"></span></section><section data-mid=""><p data-recommend-title="t" data-mid="">R沟通｜Rmarkdown教程（3）</p></section></section></section></a></section><br><section data-mpa-template="t" data-from="yb-recommend" data-recommend-article-type="normal" data-recomment-template-id="1" data-recommend-article-id="2247491546_1" data-recommend-article-time="1614601800" data-recommend-article-cover="http://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHiayicgGYwRzibR9sxwM8TDrHOXun1v2WF5SpvjOYrTvQh1A9pmu8NLzId0pcZ3j1MYmib5ibeqk6icUeAA/0?wx_fmt=jpeg" data-recommend-article-title="R沟通｜Rmarkdown教程（2）" data-recommend-article-content-url="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247491546&amp;idx=1&amp;sn=00f8dea8903dbf4ec6e683ab5061a7a5&amp;chksm=ea24e03edd536928ff6c5a3600c8fbbd87cafbf9286ad47bfe4c084032cada9bf6ee7dfddcd9#rd"><a href="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247491546&amp;idx=1&amp;sn=00f8dea8903dbf4ec6e683ab5061a7a5&amp;chksm=ea24e03edd536928ff6c5a3600c8fbbd87cafbf9286ad47bfe4c084032cada9bf6ee7dfddcd9&amp;scene=21#wechat_redirect" data-linktype="1"><section data-recommend-type="normal" data-recommend-tid="1" data-mid=""><section data-mid=""><section data-mid=""><span data-positionback="static"><img data-ratio="0.42349726775956287" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHiayicgGYwRzibR9sxwM8TDrHOXun1v2WF5SpvjOYrTvQh1A9pmu8NLzId0pcZ3j1MYmib5ibeqk6icUeAA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1098" src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHiayicgGYwRzibR9sxwM8TDrHOXun1v2WF5SpvjOYrTvQh1A9pmu8NLzId0pcZ3j1MYmib5ibeqk6icUeAA/640?wx_fmt=jpeg"></span></section><section data-mid=""><p data-recommend-title="t" data-mid="">R沟通｜Rmarkdown教程（2）</p></section></section></section></a></section><br><section data-mpa-template="t" data-from="yb-recommend" data-recommend-article-type="normal" data-recomment-template-id="1" data-recommend-article-id="2247491355_1" data-recommend-article-time="1614342600" data-recommend-article-cover="http://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHgQIt6ob17tBZRRISiczGtKzRNPmiceYZib7KnNOWw2gM971ugt1KuY99tTwNicIxBB6If2AjCIicxR9TQ/0?wx_fmt=jpeg" data-recommend-article-title="R沟通｜Rmarkdown教程（1）" data-recommend-article-content-url="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247491355&amp;idx=1&amp;sn=79739adfde0822e2eedc60e7c6761820&amp;chksm=ea24e0ffdd5369e9806d20c84c669febced9c36595f15357b3ff108f82e62cc105f0a0c456fe#rd"><section data-recommend-type="normal" data-recommend-tid="1" data-mid=""><section data-mid=""><section data-mid=""><a href="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247491355&amp;idx=1&amp;sn=79739adfde0822e2eedc60e7c6761820&amp;chksm=ea24e0ffdd5369e9806d20c84c669febced9c36595f15357b3ff108f82e62cc105f0a0c456fe&amp;scene=21#wechat_redirect" data-linktype="1"><span><img data-ratio="0.42685185185185187" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHgQIt6ob17tBZRRISiczGtKzRNPmiceYZib7KnNOWw2gM971ugt1KuY99tTwNicIxBB6If2AjCIicxR9TQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/MIcgkkEyTHgQIt6ob17tBZRRISiczGtKzRNPmiceYZib7KnNOWw2gM971ugt1KuY99tTwNicIxBB6If2AjCIicxR9TQ/640?wx_fmt=jpeg"></span></a></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/IRSvobzOfqmYtfBXDpbdJw",target="_blank" rel="noopener noreferrer">原文链接</a>
