---
title: "使用refGenome加上dplyr玩转gtf文件"
date: 2023-03-28T07:34:21Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
使用refGenome加上dplyr玩转gtf文件 by 生信技能树
------
<div><blockquote><p>不是所有人都像我这样喜欢linux的黑白命令行，但是他们仍然是可以处理NGS数据的，比如最常用的gtf格式的基因组注释文件：</p><p><img data-ratio="0.25595238095238093" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwzVOhxBAbQKkxtSJNEkJercjCL6XicnrhiaoCribibnxORIquBXhfNMdvp7CvyJCvTlu95lic4CUibpjUQ/640?wx_fmt=png" data-type="png" data-w="1344" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwzVOhxBAbQKkxtSJNEkJercjCL6XicnrhiaoCribibnxORIquBXhfNMdvp7CvyJCvTlu95lic4CUibpjUQ/640?wx_fmt=png"></p></blockquote><pre><code><span>library</span>(Rsubread)<br><span># 推荐从ENSEMBL上面下载成套的参考基因组fa及基因注释GTF文件</span><br>dir=<span>'~/data/project/release1/Genomes/'</span><br><span>## 这个文件有1.4G哦！！！</span><br>gtf &lt;- file.path(dir,<span>'Homo_sapiens.GRCh38.82.gtf'</span>)<br><span>if</span>(!<span>require</span>(refGenome)) install.packages(<span>"refGenome"</span>)<br><span># create ensemblGenome object for storing Ensembl genomic annotation data</span><br>ens &lt;- ensemblGenome()<br><span># read GTF file into ensemblGenome object</span><br>read.gtf(ens,useBasedir = <span>F</span>,gtf)<br><span>## 耗时2分钟，取决于电脑配置</span><br>class(ens)  <br><span># counts all annotations on each seqname</span><br>tableSeqids(ens) <br><span># returns all annotations on mitochondria</span><br>extractSeqids(ens, <span>'MT'</span>)<br><span># summarise features in GTF file</span><br>tableFeatures(ens)<br><span># create table of genes</span><br>my_gene &lt;- getGenePositions(ens)<br>dim(my_gene)<br><span># 这样就轻松拿到了所有基因的坐标信息啦</span><br></code></pre><p>当然，这个gtf是有非常多的值得探索的地方，比如可以完成http://www.biotrainee.com/thread-626-1-1.html 我在生信技能树»生信技能树›互动作业›脚本能力实践›生信人必练的200个数据处理任务›生信编程直播第三题：hg38每条染色体基因,转录本的分布 ！</p><h3><span>深度探索gtf来理解基因结构</span></h3><p>可以针对上面的<code>my_gene</code>这个简单的数据框进行探索：</p><pre><code>&gt; colnames(my_gene)<br> [<span>1</span>] <span>"id"</span>                        <span>"seqid"</span>                    <br> [<span>3</span>] <span>"source"</span>                    <span>"start"</span>                    <br> [<span>5</span>] <span>"end"</span>                       <span>"score"</span>                    <br> [<span>7</span>] <span>"strand"</span>                    <span>"frame"</span>                    <br> [<span>9</span>] <span>"ccds_id"</span>                   <span>"exon_id"</span>                  <br>[<span>11</span>] <span>"protein_id"</span>                <span>"transcript_support_level"</span> <br>[<span>13</span>] <span>"protein_version"</span>           <span>"havana_transcript_version"</span><br>[<span>15</span>] <span>"transcript_biotype"</span>        <span>"transcript_version"</span>       <br>[<span>17</span>] <span>"transcript_source"</span>         <span>"transcript_id"</span>            <br>[<span>19</span>] <span>"havana_gene"</span>               <span>"exon_number"</span>              <br>[<span>21</span>] <span>"gene_name"</span>                 <span>"gene_biotype"</span>             <br>[<span>23</span>] <span>"tag"</span>                       <span>"havana_gene_version"</span>      <br>[<span>25</span>] <span>"exon_version"</span>              <span>"gene_id"</span>                  <br>[<span>27</span>] <span>"gene_source"</span>               <span>"havana_transcript"</span>        <br>[<span>29</span>] <span>"transcript_name"</span>           <span>"gene_version"</span>             <br></code></pre><p>下面是一些简单的考题啦，之前是强调学生用shell脚本知识完成， 现在换成R，同样的效果。</p><ol><li><p>不同类型的基因的数量，提示：<code>table(my_gene$gene_biotype)</code></p></li><li><p><span>不同染色体的基因的数量，并且按照不同基因类型分组后继续统计</span></p></li><li><p>所有<code>protein_coding</code>类型的基因的长度分布情况</p></li><li><p>所有的<code>非protein_coding</code>类型的基因的长度分布情况</p></li><li><p><span>把全部基因的坐标画在染色体上面</span></p></li></ol><p>还可以根据gtf提取转录本信息，外显子信息，这样就可以统计更多的基因特征啦。</p><h3><span>GTF背景知识</span></h3><p>Ensemble（ ensembl.org网站是常用<strong>真核生物</strong>参考<strong>基因组</strong>来源之一 ）能够对人类基因自动进行注释，包括人类，小鼠，斑马鱼，猪和大鼠等，也包括来自HAVANA的人工注释信息。<br>Ensembl是一项生物信息学研究计划，旨在开发种能够对真核生物基因组进行自动注释(automatic annotation)并加以维护的软件系统。该计划由英国Sanger研究所Wellcome基金会及欧洲分子生物学实验室所属分部欧洲生物信息学研究所共同协作运营。</p><p>Ensembl与NCBI的NCBI Map Viewer和UCSC是最为常用基因组检索数据库。</p><h4><span>Ensembl 与NCBI Map Viewer和UCSC最大区别表现在以下5点：</span></h4><ul><li><p><span>a.Ensembl的基因数据集是依据mRNA和蛋内序列的数据信息白动注释的。数据来源为新的基因组数据，UniProt/SwissProt和UniProt/TrEMBL的蛋白序列，NCBI的RefSeq里的DNA和蛋白序列和EMBL的cDNA序列。</span></p></li><li><p><span>b.Ensembl是一个开源（Perl API ）的全自动的基因注释软件系统，很多网站都采用Ensembl这套软件系</span></p></li><li><p><span>c.Ensembl拥存其特有的BioMart功能。BioMart可以依据设定的要求对基 因组进行条件性检索，检索的结果吋以以图表的形式给出。</span></p></li><li><p><span>d.与其它数据库相整合，比如DAS。</span></p></li><li><p><span>e.基因组间的比较分析。</span></p></li></ul><h4><span>基因注释机构</span></h4><p>目前从事基因注释的机构组织有很多，这里列出的只是较为常用的几个。</p><ol><li><p>Ensembl:目的是做出最好的基因注释集。<br>2.Havana (VEGA):是桑格中心的一个基因注释组织，它的目标和Eiisembl—致，因此，结合得也最紧密。</p></li><li><p><span>HGNC -给出人类基因唯一的名字和符号。</span></p></li><li><p><span>UniProt 主要集中于蛋白质的信息注释。</span></p></li></ol><p>Ensembl的通用基因注释有两种，一是Ensembl GeneBuild，它是自动化注释，速度快，实时更新，在不同物种上均适用；另一种是Wellcome基金会的 Havana (VEGA)小组的注释，它是手工注释，速度慢，但是准确，它依据的都是已经验证过的mRNA和蛋白序列来注释，比较费时。因此Ensembl基因组数据库 中，会有两种注释。</p><h4><span>Havana (VEGA)小组的注释常有以下几种类型：</span></h4><p>详细信息：http://vega.sanger.ac.uk/info/about/gene_and_transcript_types.html</p><ul><li><p><span>Protein coding： 包括开放阅读框 (ORF).</span></p></li><li><p><span>Processed transcript：没有开放阅读框（ORF）</span></p></li><li><p><span>Pseudogene：假基因，是指脱氧核糖核酸（DNA）的碱基序列中，一段与其他生物体内已知的基因序列非常相似的片段。但是这个片段由于移码突变或者无义突变破坏了ORF，无法发挥原有的基因功能，也就是无法制造出蛋白质</span></p></li><li><p><span>IG gene：免疫球蛋白家族基因</span></p></li><li><p><span>TR Gene：T细胞受体基因</span></p></li><li><p><span>TEC (To be Experimentally Confirmed)</span></p></li></ul><p>人类和小鼠基因组的GTF文件与GENCODE计划发布的gene set文件相同。<br>The GENCODE project 的目标为对人类和小鼠基因组提供高质量的注释信息和实验确证。<br>The GENCODE gene sets被其他项目作为参考而广泛使用(如 1000 Genomes).<br>详细内容：https://www.gencodegenes.org/about.html</p><p>还可以结合 Gviz 进行可视化，下回分解</p><p><br></p><section data-style-type="5" data-tools="新媒体排版" data-id="1376000"><section powered-by="xiumi.us"><section><section><section data-style-type="5" data-tools="新媒体排版" data-id="1408312"><p><strong><span><strong><span><span>■</span><span>   <span>■</span>   ■</span></span></strong></span></strong></p></section></section></section></section></section><section data-style-type="5" data-tools="新媒体排版" data-id="1376000"><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section><p><span>生信基础知识大全系列：</span><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247485662&amp;idx=1&amp;sn=e1b55e5bea539daed3e003b4f0d7e971&amp;scene=21#wechat_redirect" target="_blank"><span>生信基础知识100讲</span></a><span>   </span></p><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247486815&amp;idx=1&amp;sn=a71663abc269df5da16256c9469b3d44&amp;chksm=9b484de4ac3fc4f2d69f82c85457895fe72ebb01e4b1c6bca2075d4504ebd2ef6bd9442de3f3&amp;scene=21#wechat_redirect" target="_blank"><span>史上最强的生信自学环境准备课来啦！！</span></a><span><span> 7次改版，11节课程，14K的讲稿，30个夜晚打磨，100页PPT的课程。</span><span>   </span></span></p><p><span>如果需要组装自己的服务器；</span><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247487052&amp;idx=1&amp;sn=9b577069df20032d9cd1d8665c1efcfd&amp;chksm=9b484ef7ac3fc7e1468b54905098a7d7fec17184599663c7090cfe57f94a35cc9dd417cba1a3&amp;scene=21#wechat_redirect" target="_blank"><span>代办生物信息学服务器</span></a></p><p><span>如果需要帮忙下载海外数据(GEO/TCGA/GTEx等等)，</span><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247487025&amp;idx=1&amp;sn=18fdfdaddfa9226f0b6107986cec9043&amp;chksm=9b484e8aac3fc79cf1616837a4f5a91efb16559434a3c93fabdecb59da53a97e4a1ab9c6e778&amp;scene=21#wechat_redirect" target="_blank"><span>点我？</span></a></p><p><strong><span>如果需要线下辅导及培训，看</span></strong><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247487460&amp;idx=1&amp;sn=33cf308c824d369d4c111a96ab9fafb8&amp;chksm=9b484f5fac3fc649dc9e01399cc105fdab3f208dd088d5dce02c757ad4257e05b4217bf17b1c&amp;scene=21#wechat_redirect" target="_blank"><strong>招学徒</strong></a><strong><span> </span></strong></p><p><span>如果需要个人电脑：</span><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247487098&amp;idx=1&amp;sn=0e28a20911f5a76446bb0363c9bc9d84&amp;chksm=9b484ec1ac3fc7d70ff3e6e0a2589b29e7aa766e0fc0fd9ef106af7ae821e9ca288d316cdd23&amp;scene=21#wechat_redirect" target="_blank"><span>个人计算机推荐</span></a></p><p><span>如果需要置办生物信息学书籍，看：</span><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247487434&amp;idx=1&amp;sn=ce51f8950ca3f463138419c0cba06abe&amp;chksm=9b484f71ac3fc66772def7f28603b5edfb1f379254099d5cc9c91b113f272d140daf8d85c42b&amp;scene=21#wechat_redirect" target="_blank"><span>生信人必备书单</span></a></p><p><span>如果需要实习岗位：</span><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247487646&amp;idx=1&amp;sn=5b2af700abdad7d702f1f33c6023ed45&amp;chksm=9b485025ac3fd933b43a9a7aaf05d71ae926dce4a8dda22c22c93dd4211344cbceca23d09bee&amp;scene=21#wechat_redirect" target="_blank"><span>实习职位发布</span></a></p><p><span>如果需要售后：</span><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247487213&amp;idx=1&amp;sn=8154b0dddba81c493a649e21a9744fd0&amp;chksm=9b484e56ac3fc740bfe3b5aef3177fa11e312bd1b12624c3970c6d6a78252afff0b1f9d2bc87&amp;scene=21#wechat_redirect" target="_blank"><span>点我</span></a></p><p><span>如果需要入门资料大全：</span><span><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247487685&amp;idx=1&amp;sn=f357d26efdc9b394dc6c449272d5a50f&amp;chksm=9b48507eac3fd968bfacd5f27527687eb23158d9f2ba65744ea3cfe87bc7f3504edf6edc2198&amp;scene=21#wechat_redirect" target="_blank">点我</a></span></p></section></section></section></section></section></section></section><p><br></p><p><br></p><p><span>点击下面的阅读原文直达</span></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/YD9F2JfnXv8LAPZ4tMGA4A",target="_blank" rel="noopener noreferrer">原文链接</a>
