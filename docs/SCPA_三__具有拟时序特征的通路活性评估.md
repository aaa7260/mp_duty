---
title: "SCPA（三）：具有拟时序特征的通路活性评估"
date: 2023-01-11T12:43:50Z
draft: ["false"]
tags: [
  "fetched",
  "生信宝库"
]
categories: ["Acdemic"]
---
SCPA（三）：具有拟时序特征的通路活性评估 by 生信宝库
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>前言</span><span></span></h2><p data-tool="mdnice编辑器">单细胞的拟时序分析是利用算法模拟不同细胞之间的分化趋势，目前已经是一种相对常规化的分析手段。通过拟时序分析，可以模拟不同细胞之间的潜在分化联系，因此可以起到动态预测的作用。最近的一些文章开始利用模拟的分化路线关联基因表达和功能通路的变化，这样也能动态反应不同细胞之间功能状态的变化趋势。</p><p data-tool="mdnice编辑器">今天Immugent就来用代码实操的方式，来介绍如何使用SCPA将功能通路和拟时序分化路线联合分析。</p><p data-tool="mdnice编辑器"><br></p><hr data-tool="mdnice编辑器"><h2 data-tool="mdnice编辑器"><span></span><span>代码实操</span><span></span></h2><pre data-tool="mdnice编辑器"><code>library(SCPA)<br>library(Seurat)<br>library(tidyverse)<br>library(magrittr)<br>library(dyno)<br>library(ComplexHeatmap)<br>library(circlize)<br><br>naive_cd4 &lt;- load(<span>"naive_cd4.rds"</span>)<br>DimPlot(naive_cd4, split.by = <span>"Hour"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.375" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7cmK71pPRJVMzEDJkrDtCqBn8UVAvDDB1zllq3PgiaC4fwyjGoY4TrVxiaxU1ssz3JbRst4BIUiaaSrQ/640?wx_fmt=png" data-type="png" data-w="4800" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7cmK71pPRJVMzEDJkrDtCqBn8UVAvDDB1zllq3PgiaC4fwyjGoY4TrVxiaxU1ssz3JbRst4BIUiaaSrQ/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><code>naive_cd4 &lt;- subset(naive_cd4, idents = <span>"Treg"</span>, invert = T)<br><br>df &lt;- as.matrix(naive_cd4[[<span>"RNA"</span>]]@data)<br>var_genes &lt;- names(sort(apply(df, 1, var), decreasing = TRUE))[1:1000]<br><br>counts &lt;- Matrix::t(as(as.matrix(naive_cd4@assays<span>$RNA</span>@counts[var_genes,]), <span>'sparseMatrix'</span>))<br>expression &lt;- Matrix::t(as(as.matrix(naive_cd4@assays<span>$RNA</span>@data[var_genes,]), <span>'sparseMatrix'</span>))<br><br>dataset_n4 &lt;- wrap_expression(expression = expression,<br>                              counts = counts)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.8554502369668247" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7cmK71pPRJVMzEDJkrDtCqBz4xiaSvnqZ3swoWXJicV4vbQU0YBUrOdN5VJbO5IfLGmicmPTnNKcs8XA/640?wx_fmt=png" data-type="png" data-w="422" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7cmK71pPRJVMzEDJkrDtCqBz4xiaSvnqZ3swoWXJicV4vbQU0YBUrOdN5VJbO5IfLGmicmPTnNKcs8XA/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><code>model_n4 &lt;- infer_trajectory(dataset_n4, method = ti_slingshot(), verbose = T)<br><br>plot_dimred(model_n4, <br>            <span>"pseudotime"</span>, <br>            pseudotime = calculate_pseudotime(model_n4), <br>            hex_cells = F,<br>            plot_trajectory = T, <br>            size_cells = 1, alpha_cells = 0.8) + <br>  theme(aspect.ratio = 1)<br></code></pre><pre data-tool="mdnice编辑器"><code>plot_dimred(model_n4, <br>            grouping = group_onto_nearest_milestones(model_n4), <br>            hex_cells = F,<br>            plot_trajectory = T, <br>            size_cells = 1, alpha_cells = 0.8) + <br>  theme(aspect.ratio = 1)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7cmK71pPRJVMzEDJkrDtCqBYibKo4diak0nGlN2AnRP6hUfz7KGicPd27UronGSwC5ZrZazIlnicOGq9Q/640?wx_fmt=png" data-type="png" data-w="1350" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7cmK71pPRJVMzEDJkrDtCqBYibKo4diak0nGlN2AnRP6hUfz7KGicPd27UronGSwC5ZrZazIlnicOGq9Q/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><code>mile_group &lt;- data.frame(group_onto_nearest_milestones(model_n4)) %&gt;%<br>  set_colnames(<span>"milestone"</span>) %&gt;%<br>  rownames_to_column(<span>"cell"</span>)<br>  <br>naive_cd4<span>$milestone</span> &lt;- mile_group<span>$milestone</span><br>cd4_pseudo &lt;- list()<br><span>for</span> (i <span>in</span> 1:max(mile_group<span>$milestone</span>)) {<br>  cd4_pseudo[[i]] &lt;- seurat_extract(naive_cd4, meta1 = <span>"milestone"</span>, value_meta1 = i)<br>}<br><br>pathways &lt;- <span>"combined_metabolic_pathways.csv"</span><br><br>cd4_metabolism &lt;- compare_pathways(samples = cd4_pseudo, <br>                                   pathways = pathways)<br>                                   <br>cd4_metabolism &lt;- cd4_metabolism %&gt;%<br>  data.frame() %&gt;%<br>  select(Pathway, qval) %&gt;%<br>  column_to_rownames(<span>"Pathway"</span>)<br><br>col_hm &lt;- colorRamp2(colors = c(<span>"white"</span>, <span>"red"</span>), breaks = c(0, max(mstone_out)))<br><br>Heatmap(t(cd4_metabolism),<br>        name = <span>"Qvalue"</span>,<br>        col = col_hm,<br>        border = T,<br>        rect_gp = gpar(col = <span>"white"</span>, lwd = 0.1),<br>        heatmap_height = unit(2, <span>"cm"</span>),<br>        show_column_dend = F,<br>        show_row_names = F,<br>        show_column_names = F)                                   <br></code></pre><figure data-tool="mdnice编辑器"><br></figure><figure data-tool="mdnice编辑器"><br><img data-ratio="0.2565217391304348" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7cmK71pPRJVMzEDJkrDtCqB4ziaIqYgflno7jWnOuH8lwOb7ahOkXKWE0uj2fOOw9znibTdicnfkFnKw/640?wx_fmt=png" data-type="png" data-w="1380" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7cmK71pPRJVMzEDJkrDtCqB4ziaIqYgflno7jWnOuH8lwOb7ahOkXKWE0uj2fOOw9znibTdicnfkFnKw/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><code>plot_rank(scpa_out = cd4_metabolism, <br>          pathway = <span>"hallmark_gly"</span>,<br>          base_point_size = 2.5,<br>          highlight_point_size = 3)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.625" data-src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7cmK71pPRJVMzEDJkrDtCqBFBtq51TiccHgMdBdPH4t41AGYDusEvzbey37ePRicenC619ghSqjjt1A/640?wx_fmt=png" data-type="png" data-w="2400" src="https://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7cmK71pPRJVMzEDJkrDtCqBFBtq51TiccHgMdBdPH4t41AGYDusEvzbey37ePRicenC619ghSqjjt1A/640?wx_fmt=png"></figure><hr data-tool="mdnice编辑器"><h2 data-tool="mdnice编辑器"><span></span><span>小结</span><span></span></h2><p data-tool="mdnice编辑器">虽然拟时序分析得到的是一个连续的值，但是我们在实际分析时可以根据需要将其分成不同阶段，如：早期，中期和晚期。但是单纯的以时间分期是没有太大的意义，需要联合不同功能定义出的细胞亚群。就像T细胞可以分成naive, effector以及memory阶段一样，这样就赋予了拟时间实际的生物学意义。在此基础上，算出不同阶段之间功能通路的差异，我们就能得知每个阶段主导的功能通路。</p><p data-tool="mdnice编辑器">好啦，本期分享到此就结束了，我们下期再会~~</p><p data-tool="mdnice编辑器"><br></p><hr data-tool="mdnice编辑器"></section><p><img data-galleryid="" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/GL6g5Y3aR7f28iaAPOSZyaVreHSWoQket3gNW3WtOGwutAMDGYKSk6ZBOdhDUyS95mNMn5INvyOIibBSfHgzI6sQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="258" src="https://mmbiz.qpic.cn/mmbiz_jpg/GL6g5Y3aR7f28iaAPOSZyaVreHSWoQket3gNW3WtOGwutAMDGYKSk6ZBOdhDUyS95mNMn5INvyOIibBSfHgzI6sQ/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span>关注下方公众号下回更新不迷路</span></h3><section><mp-common-profile data-weui-theme="light" data-id="MzI4MjY5ODI1Nw==" data-pluginname="mpprofile" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/GL6g5Y3aR7f28iaAPOSZyaVreHSWoQketIFUzNSiayMfvqbyCD0TNcBv06SGnkaO1gXRsN9icoQ23IjMJ5ta3Jia9w/0?wx_fmt=png" data-nickname="生信宝库" data-alias="sxbk2020" data-signature="用于生信知识的收集与传播，以及生信人之间学习交流。本公众号各小编平时忙于科研，更新文章较其它同类型公众号较慢，但保持宁缺毋滥的本心，只更新对大家有用的推文。" data-from="2" data-is_biz_ban="0"></mp-common-profile></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/jPm4NY0yFO5Bh20UaoGOjw",target="_blank" rel="noopener noreferrer">原文链接</a>
