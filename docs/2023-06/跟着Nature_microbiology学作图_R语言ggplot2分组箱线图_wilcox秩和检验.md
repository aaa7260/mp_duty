---
title: "跟着Nature microbiology学作图：R语言ggplot2分组箱线图/wilcox秩和检验"
date: 2023-06-17T08:28:13Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Acdemic"]
---
跟着Nature microbiology学作图：R语言ggplot2分组箱线图/wilcox秩和检验 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>论文</span><span></span><span> </span></h2><blockquote data-tool="mdnice编辑器"><p>A high-quality genome compendium of the human gut microbiome of Inner Mongolians</p></blockquote><p data-tool="mdnice编辑器">https://www.nature.com/articles/s41564-022-01270-1</p><p data-tool="mdnice编辑器"><code>2023Naturemicrobiology--Ahigh-qualitygenomecompendiumofthehumangutmicrobiomeofInnerMongolians4.pdf</code></p><p data-tool="mdnice编辑器">论文中大部分作图数据都有，争取把论文中的图都复现一下</p><p data-tool="mdnice编辑器">今天的推文我们试着复现一下论文中的Figure3j</p><figure data-tool="mdnice编辑器"><img data-ratio="0.4080645161290323" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5Wgyk01OUJjR6bpLYN0F6792DDuD9Of6D7lqO6hO7D0N7OqkLcpuTuBejWK8t0Q3iaFH1sF8aXvIQ/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5Wgyk01OUJjR6bpLYN0F6792DDuD9Of6D7lqO6hO7D0N7OqkLcpuTuBejWK8t0Q3iaFH1sF8aXvIQ/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>部分示例数据截图</span><span></span><span> </span></h2><figure data-tool="mdnice编辑器"><img data-ratio="0.46044444444444443" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5Wgyk01OUJjR6bpLYN0F67eXcvVKJEAQVh8kY1hicPReptCtib3F48Zq2A5ibIFXMzia0dDX5suiaTLYQ/640?wx_fmt=png" data-type="png" data-w="1125" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5Wgyk01OUJjR6bpLYN0F67eXcvVKJEAQVh8kY1hicPReptCtib3F48Zq2A5ibIFXMzia0dDX5suiaTLYQ/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>读取数据</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(readxl)<br>library(ggplot2)<br>library(tidyverse)<br><br><br><br>datj&lt;-read_excel(<span>"data/20230305/41564_2022_1270_MOESM6_ESM.xlsx"</span>,<br>                 sheet = <span>"Fig3j"</span>)<br>head(datj)<br>colnames(datj)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>分组箱线图</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>p&lt;-ggplot(data=datj,aes(x=`ID <span>type</span>`,<br>                     y=log10(`IS region proportion`)))+<br>  geom_boxplot(aes(fill=Database),<br>               outlier.shape = 1,<br>               outlier.colour = <span>"gray"</span>,<br>               outlier.alpha = 0.2)+<br>  theme_bw()+<br>  theme(panel.grid = element_blank(),<br>        axis.text.x = element_text(angle=60,hjust=1,vjust=1),<br>        legend.position = <span>"bottom"</span>)+<br>  scale_fill_manual(values = c(<span>"IMGG"</span>=<span>"#1b9e77"</span>,<br>                               <span>"UHGG"</span>=<span>"#d95f02"</span>),<br>                    name=NULL)+<br>  labs(x=NULL,y=<span>"IS region proportion"</span>)+<br>  scale_y_continuous(breaks = c(-2,-1,0),<br>                     labels = c(<span>"0.01"</span>,<span>"0.10"</span>,<span>"1.00"</span>))<br>p<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6654578422484134" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5Wgyk01OUJjR6bpLYN0F679FfYkgqFzpicR2ZNBZJ6EU9OkEgnrtYMkHSPTfq8UAicc97oRDo1fMdg/640?wx_fmt=png" data-type="png" data-w="1103" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5Wgyk01OUJjR6bpLYN0F679FfYkgqFzpicR2ZNBZJ6EU9OkEgnrtYMkHSPTfq8UAicc97oRDo1fMdg/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">给箱线图添加上下小短线</p><pre data-tool="mdnice编辑器"><span></span><code>ggplot_build(p)<span>$data</span>[[1]] %&gt;% select(x,ymin,ymax) -&gt; errorbar.df<br><br><br><br>p.bottom&lt;-p+<br>  geom_segment(data = errorbar.df,<br>               aes(x=x-0.15,xend=x+0.15,y=ymin,yend=ymin))+<br>  geom_segment(data = errorbar.df,<br>               aes(x=x-0.15,xend=x+0.15,y=ymax,yend=ymax))<br><br>p.bottom<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6717625899280576" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5Wgyk01OUJjR6bpLYN0F67vOiaa8bVJW5MhQ1QTNGJ2B7Juf7ZrTW0Swiab21PicOicx5HggpZMicLzlg/640?wx_fmt=png" data-type="png" data-w="1112" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5Wgyk01OUJjR6bpLYN0F67vOiaa8bVJW5MhQ1QTNGJ2B7Juf7ZrTW0Swiab21PicOicx5HggpZMicLzlg/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">关于箱线图的图注英文</p><blockquote data-tool="mdnice编辑器"><p>Statistical difference was tested by Wilcoxon rank-sum test(two-sided). For all boxplots, the boxes represent the interquartile range, the lines inside the boxes represent the medians, and the whiskers denote the lowest and highest values within 1.5 times the interquartile range.</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>分组做wilcox秩和检验</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>datj %&gt;% <br>  pull(`ID <span>type</span>`) %&gt;% <br>  unique() -&gt; group.info<br><br>pvalue.df&lt;-tibble(x=character(),<br>               pvalue=numeric())<br><br><span>for</span>(info <span>in</span> group.info){<br>  datj %&gt;% <br>    filter(`ID <span>type</span>`==info) -&gt; tmp.df<br>  wilcox.test(`IS region proportion`~`Database`,<br>              data=tmp.df) -&gt; a<br>  add_row(pvalue.df,<br>          x=info,<br>          pvalue=a<span>$p</span>.value) -&gt; pvalue.df<br>}<br><br>min_p&lt;-min(pvalue.df %&gt;% filter(pvalue !=0) %&gt;% <br>      pull(pvalue))<br>pvalue.df %&gt;% <br>  mutate(new_p=case_when(<br>    pvalue == 0 ~ min_p,<br>    TRUE ~ pvalue<br>  )) -&gt;pvalue.df<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>画图展示结果</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(RColorBrewer)<br>scale_color_distiller()<br>p.top&lt;-ggplot(data = pvalue.df,aes(x=x,y=1))+<br>  geom_point(size=5,shape=15,<br>             aes(color=-log10(new_p)))+<br>  scale_color_distiller(palette = <span>"Greys"</span>,<br>                        direction = 1,<br>                        name=<span>"-log10(Pval)"</span>)+<br>  theme_void()+<br>  theme(legend.position = <span>"top"</span>,<br>        legend.key.size = unit(5,<span>'mm'</span>),<br>        legend.text = element_text(size=10))+<br>  guides(color=guide_colorbar(title.position = <span>"top"</span>,<br>                              title.hjust = 0.5,<br>                              barwidth = 20))<br><br>p.top<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.4682971014492754" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5Wgyk01OUJjR6bpLYN0F67diamGBtiaXgTcgBfjYv8rhDxQvkeZaZkzMyABh1OfSdM5pfSiawW8VsWg/640?wx_fmt=png" data-type="png" data-w="1104" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5Wgyk01OUJjR6bpLYN0F67diamGBtiaXgTcgBfjYv8rhDxQvkeZaZkzMyABh1OfSdM5pfSiawW8VsWg/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>最后是拼图</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(patchwork)<br><br>p.top+<br>  p.bottom+<br>  plot_layout(ncol = 1,heights = c(1,5))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.4266129032258065" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5Wgyk01OUJjR6bpLYN0F67ibmIoDWvkO9PxicoUyO59x1ib5zmgen1g4NXe2CIgeFubrUVPMH6G9GEw/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5Wgyk01OUJjR6bpLYN0F67ibmIoDWvkO9PxicoUyO59x1ib5zmgen1g4NXe2CIgeFubrUVPMH6G9GEw/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><blockquote data-tool="mdnice编辑器"><p>推文记录的是自己的学习笔记，很可能存在错误，请大家批判着看</p></blockquote><blockquote data-tool="mdnice编辑器"><p>示例数据和代码可以给推文打赏1元获取</p></blockquote><p data-tool="mdnice编辑器">欢迎大家关注我的公众号</p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzI3NzQ3MTcxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5t1sOnM0iabvBhnfIj5YpyqrMib0E1MGCd9ibcYxaOPZd0GWhQBDvK2BPEwsicQxd6y5MHLfphnwHnow/0?wx_fmt=png" data-nickname="小明的数据分析笔记本" data-alias="" data-signature="分享R语言和python在生物信息领域做数据分析和数据可视化的简单小例子；偶尔会分享一些组学数据处理相关的内容" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"></p><blockquote data-tool="mdnice编辑器"><p>小明的数据分析笔记本 公众号 主要分享：1、R语言和python做数据分析和数据可视化的简单小例子；2、园艺植物相关转录组学、基因组学、群体遗传学文献阅读笔记；3、生物信息学入门学习资料及自己的学习笔记！</p></blockquote></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/egy8_g5aUtpBddRQDzbscg",target="_blank" rel="noopener noreferrer">原文链接</a>
