---
title: "Featureplot美化"
date: 2023-06-25T16:15:56Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
Featureplot美化 by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span>❝</span><p>Featureplot也是一个在单细胞转录组相关的文章中出场频率很高的一个图，上周的推文是关于umap和tsne的美化，就想着还继续更figure的美化推文。</p><p>在有好的结果的同时，有个精致美观的展示方式的加成还是很重要的。</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">目前在文章中有下面几种featureplot的画法</p><p data-tool="mdnice编辑器"><img data-ratio="0.5472222222222223" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7ux1FgvUibEzaVwxXjffT4LvznI4QTCpO4ehJ4xfQcUmCZM8UctHTDTgiaA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7ux1FgvUibEzaVwxXjffT4LvznI4QTCpO4ehJ4xfQcUmCZM8UctHTDTgiaA/640?wx_fmt=png"><img data-ratio="0.4777777777777778" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7uxM8sbGeJWiblbEZPPicmKqb3jiaUOW88PXYwANYCkhRFohbyBBE2ppAtjQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7uxM8sbGeJWiblbEZPPicmKqb3jiaUOW88PXYwANYCkhRFohbyBBE2ppAtjQ/640?wx_fmt=png"></p><p data-tool="mdnice编辑器">分为有无坐标轴，是否共用图例。</p><p data-tool="mdnice编辑器">下面让我来尝试画一下~</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br><span># devtools::install_github("sajuukLyu/ggunchull", type = "source")</span><br><span># install.packages("tidydr")</span><br><span># devtools::install_github(repo = "samuel-marsh/scCustomize", ref = "develop")</span><br><span># remotes::install_github(repo = "samuel-marsh/scCustomize", ref = "develop")</span><br><span>#install.packages("scCustomize")</span><br><span>#devtools::install_github("xmc811/Scillus", ref = "development")</span><br><span>#library(Scillus)</span><br><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(cowplot)<br><span>library</span>(dplyr)<br><span>library</span>(tidydr)<br><span>library</span>(stringr)<br><span>library</span>(viridis)<br><span>library</span>(scCustomize)<br><br>getwd()<br>dir.create(<span>"./figure"</span>)<br>setwd(<span>"./figure"</span>)  <br><span>#导入数据</span><br>load(<span>"../3-cell//sce.all_by_celltype.Rdata"</span>)<br>sce.all<br><span>#以以下gene为输入gene</span><br>gene&lt;-c(<span>"ALB"</span>,<span>"CD3D"</span>,<span>"CD68"</span>,<span>"IGHG1"</span>,<span>"VWF"</span>,<span>"ACTA2"</span>)<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>颜色选择<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span># Set color palette</span><br><span># viridis提供了五种色带：</span><br><span># viridis：option D，为默认色带，翠绿色；</span><br><span># magma：option A，岩溶色；</span><br><span># inferno：option B，火焰色；</span><br><span># plasma：option C，血色；</span><br><span># cividis：option E;</span><br>pal &lt;- viridis(n = <span>10</span>, option = <span>"C"</span>)<br><span># "#0D0887FF" "#47039FFF" "#7301A8FF" "#9C179EFF" "#BD3786FF" "#D8576BFF" "#ED7953FF" "#FA9E3BFF" "#FDC926FF" "#F0F921FF"</span><br>pal &lt;- viridis(n = <span>15</span>, option = <span>"D"</span>, direction = -<span>1</span>)<br><br><span>#使用Seurat::FeaturePlot()做一个常规的可视化</span><br>FeaturePlot(object = sce.all,features = gene, cols = pal, order = <span>T</span>)<br>ggsave(file=<span>"featureplot1.pdf"</span>,width=<span>8</span>, height=<span>9</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.1371610845295055" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7uxTgyhNuGn8icqz0nPUO4AodwFXKenZDAk0FtG8DSqRPnhhzrdBy698OQ/640?wx_fmt=png" data-type="png" data-w="627" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7uxTgyhNuGn8icqz0nPUO4AodwFXKenZDAk0FtG8DSqRPnhhzrdBy698OQ/640?wx_fmt=png"><figcaption>图1</figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code><span>#之后使用scCustomize：：FeaturePlot_scCustom()函数来画一下FeaturePlot。</span><br><span>#因为通常画featureplot都是多个gene，所以在这里使用for循环。</span><br><br><span>#Continuous Palettes颜色</span><br><br><span>#viridis_plasma_dark_high</span><br><span>#viridis_plasma_light_high</span><br><span>#viridis_magma_dark_high#备选</span><br><span>#viridis_magma_light_high</span><br><span>#viridis_inferno_dark_high</span><br><span>#viridis_inferno_light_high</span><br><span>#viridis_dark_high</span><br><br>gene&lt;-c(<span>"ALB"</span>,<span>"CD3D"</span>,<span>"CD68"</span>,<span>"IGHG1"</span>,<span>"VWF"</span>,<span>"ACTA2"</span>)<br>i=<span>1</span><br>plots=list()<br><span>for</span> (i <span>in</span> <span>1</span>:length(gene)){<br>  plots[[i]]=FeaturePlot_scCustom(seurat_object = sce.all, <br>                       colors_use = viridis_magma_dark_high, <br>                       features = gene[i])+NoLegend()+NoAxes()+<br>    theme(panel.border = element_rect(fill = <span>NA</span>,color = <span>"black"</span>,<br>                                      size=<span>1.5</span>,linetype = <span>"solid"</span>))<br>}<br><span>library</span>(patchwork)<br>p&lt;-wrap_plots(plots, ncol = <span>3</span>);p<br><br>ggsave(p,file=<span>"featureplot2.pdf"</span>,width = <span>8</span>,height = <span>6</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7487684729064039" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7uxycTWWIlYqz8KmzUVCmOfBklnHcXWlfMgfxVibiaZb8Inq0AzqXjmo4jQ/640?wx_fmt=png" data-type="png" data-w="1015" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7uxycTWWIlYqz8KmzUVCmOfBklnHcXWlfMgfxVibiaZb8Inq0AzqXjmo4jQ/640?wx_fmt=png"><figcaption>图2</figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code><span>for</span> (i <span>in</span> <span>1</span>:length(gene)){<br>  plots[[i]]=FeaturePlot_scCustom(seurat_object = sce.all, <br>                                  colors_use = colorRampPalette(c(<span>"#3288BD"</span>, <span>"white"</span>, <span>"#D53E4F"</span> ))(<span>50</span>), <br>                                  features = gene[i])+NoAxes()<span>#+</span><br>    <span>#theme(panel.border = element_rect(fill = NA,color = "black",</span><br>                                      <span>#size=1.5,linetype = "solid"))</span><br>}<br><br><span>library</span>(patchwork)<br>p&lt;-wrap_plots(plots, ncol = <span>3</span>);p<br><br>ggsave(p,file=<span>"featureplot3.pdf"</span>,width = <span>8</span>,height = <span>6</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.587037037037037" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7uxYOnfstR1VAWtEibxjASibt7qnIq3Dqk2qib7EzeKvfeDRY6iaWvtySONbg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7uxYOnfstR1VAWtEibxjASibt7qnIq3Dqk2qib7EzeKvfeDRY6iaWvtySONbg/640?wx_fmt=png"><figcaption>图3</figcaption></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>去除图例：NoLegend()</p><p>去除坐标轴：NoAxes()加黑色的框：theme(panel.border = element_rect(fill = NA,color = "black", size=1.5,linetype = "solid"))</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">一般这么多的featureplot共用一个legend就可以了，因此接下来想在去除图例，去除坐标轴的前提下另外给图画个图例。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.6129629629629629" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7ux3jjMM8tqemwzENPMXbHC5XGRGVialqOTh8Fwmy6ianzPpt9mu3YuzrKw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7ux3jjMM8tqemwzENPMXbHC5XGRGVialqOTh8Fwmy6ianzPpt9mu3YuzrKw/640?wx_fmt=png"><figcaption>图4</figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ComplexHeatmap)<br><span>library</span>(circlize)<br><span>#给图例定义范围和颜色</span><br>col_fun = colorRamp2(c(<span>0</span>,<span>2</span>,<span>4</span>), c(<span>"#3288BD"</span>, <span>"white"</span>, <span>"#D53E4F"</span>))<br>lgd3 = Legend(at = c(<span>0</span>,<span>2</span>,<span>4</span>), col_fun = col_fun, <br>              nrow = <span>1</span>,<span>#border = "black",direction = "horizontal",</span><br>              legend_height = unit(<span>4</span>, <span>"cm"</span>)<br>)<br><span>#可以调整图例的方向，高度，还有加不加border。</span><br><span>#用draw把图例画在合适的位置。</span><br>draw(lgd3,x = unit(<span>0.99</span>, <span>"npc"</span>), y = unit(<span>0.4</span>, <span>"npc"</span>),<br>     just = c(<span>"right"</span>, <span>"bottom"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6651532349602725" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7uxpcwAawjMhHGicxyutA83LXbibibMoruP5ib9ibUkicX1cvZibrMrHSNhcf7qg/640?wx_fmt=png" data-type="png" data-w="881" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7uxpcwAawjMhHGicxyutA83LXbibibMoruP5ib9ibUkicX1cvZibrMrHSNhcf7qg/640?wx_fmt=png"><figcaption>图5</figcaption></figure><h4 data-tool="mdnice编辑器"><span></span>总结<span></span></h4><blockquote data-tool="mdnice编辑器"><span>❝</span><p>小伙伴们可以选择不同的颜色来展示，今天的画图就到这里了。</p><p>今天画图没有把数据提出来用ggplot画，而是采用了scCustom的FeaturePlot_scCustom函数。</p><p>对于figure颜色的选择，可以选择连续型的颜色色条，也可以选择热图常常采用的三组颜色。</p><p>以上只是个人拙见。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span>微信交流群</span><span></span></h3><p data-tool="mdnice编辑器">如果你也想参与到群里的讨论中，给我提出一些推文更新建议的话欢迎入群。同时你也可以得到我前期更新的所有数据及代码，在群里我会把代码分享给大家，而且大家可以在群里<strong>「提出自己感兴趣的单细胞文献」</strong>我们尽可能优先选择大家的数据集去复现和实战，也欢迎大家在群里分享更多其它资料，咱们一起进步，<strong>「比较高级的单细胞分析」</strong>我们也会一起尝试， 相信你肯定是会不虚此行哈。</p><p data-tool="mdnice编辑器">附上之前推文的链接 <a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247512238&amp;idx=1&amp;sn=e0c6dc2ea0e089aabb78133e50fb5d7f&amp;scene=21#wechat_redirect" data-linktype="2">为爱发电不可取（单细胞周更需要你的支持）</a></p><p data-tool="mdnice编辑器">我们这个群是真正的付费交流群，不仅提供数据，代码，学习资料，而且也会跟大家互动交流，还会坚持进行创作至少一年。</p><p data-tool="mdnice编辑器"><strong>「目前群里已经有接近200人，所以你想要进群的话就需要添加我的微信，私聊给我发99元的红包，我把你拉进群里。」</strong></p><p><span>是真正的付费交流群，因为提供数据，代码，学习资料，并且跟大家互动交流，而且会坚持进行创作至少一年。所以，如果介意99元的门槛，请不要加我好友。。。</span><strong></strong></p><figure data-tool="mdnice编辑器"><img data-ratio="1.0068181818181818" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7uxYibJQIwbvctThognOa0iaO30KAS603kBSlpP7hRNSl0WyiafISnVFCUHA/640?wx_fmt=png" data-type="png" data-w="440" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losib0o0fmuX8wcVw91hP3s7uxYibJQIwbvctThognOa0iaO30KAS603kBSlpP7hRNSl0WyiafISnVFCUHA/640?wx_fmt=png"></figure></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/r0zZrJkDY4m4pSIfDw__Og",target="_blank" rel="noopener noreferrer">原文链接</a>
