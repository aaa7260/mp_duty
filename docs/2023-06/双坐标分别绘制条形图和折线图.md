---
title: "双坐标分别绘制条形图和折线图"
date: 2023-06-30T15:35:43Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
双坐标分别绘制条形图和折线图 by 单细胞天地
------
<div><section data-style-type="5" data-tools="新媒体排版" data-id="2430070"><section data-style-type="5" data-tools="新媒体排版" data-id="2390348"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section><br></section><section><section><section powered-by="xiumi.us"><section><section><p>分享是一种态度</p></section></section></section></section></section></section></section></section><section><section powered-by="xiumi.us"><section><section><img data-ratio="0.8738095238095238" data-src="https://mmbiz.qpic.cn/mmbiz_gif/siaia0BDGJdjSnnb9ibXpFagGPWQ0JjSSTNVBZthROEhicfINuLcxX2Ro3Zb600LJhrzeYIb120tLjSVXEtLn14DwA/640?wx_fmt=gif" data-type="gif" data-w="420" width="100%" src="https://mmbiz.qpic.cn/mmbiz_gif/siaia0BDGJdjSnnb9ibXpFagGPWQ0JjSSTNVBZthROEhicfINuLcxX2Ro3Zb600LJhrzeYIb120tLjSVXEtLn14DwA/640?wx_fmt=gif"></section></section></section></section></section></section></section></section></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>本文内容:<br>1、绘制条形图并分面<br>2、条形图分面。默认分面、只展示使用的因子水平、分面宽度自动调整<br>3、添加折线图和第二坐标轴<br>4、个性化配色<br>5、给变量加上标</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>加载R包</span></h2><pre data-tool="mdnice编辑器"><span></span><code>pkgs = c(<span>'tidyverse'</span>, <span>'forcats'</span>, <span>'gtools'</span>, <span>'ggplot2'</span>, <span>'ggpubr'</span>, <span>'cowplot'</span>, <br>         <span>'scales'</span>, <span>'ggsci'</span>, <span>'viridis'</span>, <span>'hrbrthemes'</span>, <span>'Cairo'</span>, <span>'common'</span>)<br><span># install.packages('pkgs')</span><br>inst = lapply(pkgs, library, character.only = TRUE)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>读取或创建数据</span></h2><pre data-tool="mdnice编辑器"><span></span><code><span># Build dummy data</span><br>data &lt;- data.frame(<br>  date = as.Date(<span>"2019-01-01"</span>) + 0:99,<br>  day = 1:100,<br>  season = rep(c(<span>'spring'</span>, <span>'summer'</span>, <span>'autumn'</span>, <span>'winter'</span>), <span>times</span> = 25),<br>  temperature = runif(100)/10,<br>  price = runif(100)*10<br>)<br><br>data %&gt;%<br>  slice(1:3)<br><span>##         date day season temperature    price</span><br><span>## 1 2019-01-01   1 spring 0.006128101 4.149554</span><br><span>## 2 2019-01-02   2 summer 0.089528352 3.729223</span><br><span>## 3 2019-01-03   3 autumn 0.039876862 4.795942</span><br><br>set.seed(111)<br>df.raw &lt;- data %&gt;%<br>  slice_sample(n = 20)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.14166666666666666" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17t1IgfatUFvwvbJTKLoj5GWE1VuVTzndByJNCZQdjdD9ktdGoibNWWzuA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17t1IgfatUFvwvbJTKLoj5GWE1VuVTzndByJNCZQdjdD9ktdGoibNWWzuA/640?wx_fmt=png"></figure><h2 data-tool="mdnice编辑器"><span></span><span>绘图</span></h2><h3 data-tool="mdnice编辑器"><span></span><span>1、绘制条形图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>p &lt;- df.raw %&gt;%<br>  mutate(day = factor(day, levels = unique(mixedsort(day)))) %&gt;%<br>  mutate(season = factor(season, levels = c(<span>'spring'</span>, <span>'summer'</span>, <span>'autumn'</span>, <span>'winter'</span>))) %&gt;%<br>  ggplot(aes(x = day)) +<br>  geom_bar(aes(y = temperature, fill = season), <span>stat</span>=<span>"identity"</span>) <br>p<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6064814814814815" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17tIhiavGBjOUibYXCfsibuatIavicxKYM7Gf2DT66f6IFKibbQ7TOV9bUsDZg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17tIhiavGBjOUibYXCfsibuatIavicxKYM7Gf2DT66f6IFKibbQ7TOV9bUsDZg/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>2、条形图分面</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 默认条形图分面</span><br>p + facet_grid(.~season)<br><br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6027777777777777" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17t3yfYnLv7bXubvic3VONqkrWwlLnt8b6DgHiczicIXWxPBKNau3eDOPCNg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17t3yfYnLv7bXubvic3VONqkrWwlLnt8b6DgHiczicIXWxPBKNau3eDOPCNg/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code><span># 条形图分面宽度相同，只展示使用的因子水平</span><br>p + facet_grid(.~season, scale=<span>"free"</span>) <br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6268518518518519" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17tt2lC0Rte8fqPQJuxNYY92ogdv8CM4q15bWM5x6sednRKqIG7GsFp9w/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17tt2lC0Rte8fqPQJuxNYY92ogdv8CM4q15bWM5x6sednRKqIG7GsFp9w/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code><span># 条形图分面宽度自动调整</span><br>p1 &lt;- p + facet_grid(.~season, scale=<span>"free"</span>, space=<span>"free_x"</span>) <br>p1<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.625" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17tAkpWL87ug8TtfK0RtznOuu4788KdlvyqkdozecyHVvA21PE9FhBroA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17tAkpWL87ug8TtfK0RtznOuu4788KdlvyqkdozecyHVvA21PE9FhBroA/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>3、添加折线图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>p2 &lt;- p1 + geom_line(aes(y=price / 100, group = 1), size = 1, linetype = <span>'dashed'</span>) <br>p2<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6194444444444445" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17tkOX1NT4PLG9Nq1EEKbVFQWpyj5muD9P1enxEFUCvC4JWs8mOo3fsTw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17tkOX1NT4PLG9Nq1EEKbVFQWpyj5muD9P1enxEFUCvC4JWs8mOo3fsTw/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>4、添加第二坐标轴</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>p3 &lt;- p2 +  scale_y_continuous(<br>  name = <span>"First Axis"</span>,<br>  sec.axis = sec_axis(~. * 100, name=<span>'Second Axis'</span>)) <br>p3<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6453703703703704" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17tYZnl5JzaLiaicvtVmTG8bv6EiaRnhEbb9Q25yO2rdYtgs54wicCTJoRYxA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17tYZnl5JzaLiaicvtVmTG8bv6EiaRnhEbb9Q25yO2rdYtgs54wicCTJoRYxA/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>5、配色</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>p4 &lt;- p3 + theme_classic2(base_size = 16) +<br>  scale_fill_simpsons() + theme(legend.position = <span>'top'</span>)<br>p4<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6083333333333333" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17tpt88SprxnPibu2soVFqlhtSDyF5cfQFTIhOHdY3Rk1QIicsRHDYJzHeA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17tpt88SprxnPibu2soVFqlhtSDyF5cfQFTIhOHdY3Rk1QIicsRHDYJzHeA/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>6、给变量加上标</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 例如给秋天autumn加上标数字1，用函数supsc()</span><br>p &lt;- df.raw %&gt;%<br>  mutate(day = factor(day, levels = unique(mixedsort(day)))) %&gt;%<br>  mutate(season = factor(season, levels = c(<span>'spring'</span>, <span>'summer'</span>, <span>'autumn'</span>, <span>'winter'</span>))) %&gt;%<br>  mutate(season = recode(season,  <span>"autumn"</span> = paste0(<span>"autumn"</span>, supsc(<span>'1'</span>)) ) )  %&gt;%<br>  ggplot(aes(x = day)) +<br>  geom_bar(aes(y = temperature, fill = season), <span>stat</span>=<span>"identity"</span>) <br><br><br>p + facet_grid(.~season, scale=<span>"free"</span>, space=<span>"free_x"</span>) +<br>  geom_line(aes(y=price / 100, group = 1), size = 1, linetype = <span>'dashed'</span>) +<br>  scale_y_continuous(name = <span>"First Axis"</span>, sec.axis = sec_axis(~. * 100, name=<span>'Second Axis'</span>)) +<br>  theme_classic2(base_size = 16) + scale_fill_simpsons() + theme(legend.position = <span>'top'</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.600925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17tztaFhpAwUm9wIQ9T67nZ5TNmtnsZ8y1zcwdWeicpq7LQU6OXlV1VrlQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRUR2UicH5cKJunn7NP2X17tztaFhpAwUm9wIQ9T67nZ5TNmtnsZ8y1zcwdWeicpq7LQU6OXlV1VrlQ/640?wx_fmt=png"></figure><hr data-tool="mdnice编辑器"><h2 data-tool="mdnice编辑器"><span></span><span>参考资料</span></h2><ul data-tool="mdnice编辑器"><li><section>Dual Y axis with R and ggplot2<span>(https://r-graph-gallery.com/line-chart-dual-Y-axis-ggplot2.html)</span></section></li><li><section>Combine ggplot2 Line &amp; Barchart with Double-Axis in R (2 Examples)<span>(https://statisticsglobe.com/combine-ggplot2-line-barchart-double-axis-r)</span></section></li></ul></section><section><section data-style-type="5" data-tools="新媒体排版" data-id="2440476"><section><section><section><section><img data-ratio="0.9495798319327731" data-src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif" data-type="gif" data-w="119" data-width="100%" src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif"></section><section data-brushtype="text">往期回顾</section><section><br></section></section></section></section><section><section data-autoskip="1"><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247513753&amp;idx=1&amp;sn=985bc94719a512edc49efd76f8b85910&amp;chksm=ea1cb01bdd6b390d3f8760766af0cb03edf22598dfa33da6a3233e4819e9d6016cb345cd79b6&amp;scene=21#wechat_redirect" textvalue="单细胞转录组揭示了环境性肠病的上皮和免疫细胞特征" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>单细胞转录组揭示了环境性肠病的上皮和免疫细胞特征</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247513732&amp;idx=1&amp;sn=84d608eb310f77ce3e2e5fba36e8d043&amp;chksm=ea1cb006dd6b3910c3682840b0e2466d180d916a4af2e8b2e54390aaec3ad9832d0729d02a06&amp;scene=21#wechat_redirect" textvalue="单细胞课题破局计划：如何做和别人不一样的单细胞" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2"><span>单细胞课题破局计划：如何做和别人不一样的单细胞</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247513714&amp;idx=1&amp;sn=30668f33aefffd16ca8649d876f78e85&amp;chksm=ea1cb0f0dd6b39e679b3d27bea89dd225d9749a8f86bda449017ce7c58812927590af960e94b&amp;scene=21#wechat_redirect" textvalue="基于泛癌scRNAseq的T细胞图谱整合分析" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>基于泛癌scRNAseq的T细胞图谱整合分析</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247513691&amp;idx=1&amp;sn=4fc5137f297de8bc85cecfad6e5054ae&amp;chksm=ea1cb0d9dd6b39cf9d72ef7703f59db9153c80fdae1ce192633cffb667c540cb5c18b75d5eb3&amp;scene=21#wechat_redirect" textvalue="GGplot绘制个性化热图" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>GGplot绘制个性化热图</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247513649&amp;idx=1&amp;sn=7440643a1cd249768d01f24e8444f806&amp;chksm=ea1cb0b3dd6b39a5102f0a6a5102cdd7760f2c899217be48ba4a9465bfcc8b55aa0c79d67394&amp;scene=21#wechat_redirect" textvalue="手把手带你复现NC之Figure7" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>手把手带你复现NC之Figure7</span></a><br></p></section></section><hr><p><br></p></section><section data-style-type="5" data-tools="新媒体排版" data-id="2440475"><hr><p><br></p><hr><section><p>如果你对单细胞转录组研究感兴趣，但又不知道如何入门，也许你可以关注一下下面的课程<span></span></p><p><br></p><ul><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247522996&amp;idx=1&amp;sn=83c6cfa48a2dce7d54b7eb11f13a0d85&amp;chksm=9b4bda0fac3c5319e0800cb3452480080e58315bafc035d8150d7cdfe4c062fbca34ec5c18e1&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课7月班" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信入门&amp;数据挖掘线上直播课7月班</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=2&amp;sn=6cb33654c7751f4c3df0f84743f77aaf&amp;chksm=9b4bceaeac3c47b8899afc00077b96357b87a4ed6b75e7c434ba14071fd6c8448e4c218de5e0&amp;scene=21#wechat_redirect" textvalue="144线程640Gb内存服务器共享一年仍然是仅需800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">144线程640Gb内存服务器共享一年仍然是仅需800</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">千呼万唤始出来的独享生物信息学云服务器</a></p></li></ul><p><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif" data-type="gif" data-w="240" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif"><br></p><p><img data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg" data-type="other" data-w="341" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p></section><section><section data-id="93668"><section><section data-width="95%"><section><section><section data-width="38%"><section><section data-tools="135编辑器" data-id="93668"><section><section data-width="95%"><section><section><section data-width="61.8%"><section><section><section><p><br></p><span><strong data-burshtype="text"><img data-copyright="0" data-cropselx1="0" data-cropselx2="109" data-cropsely1="0" data-cropsely2="109" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg" data-type="other" data-w="258" title="qrcode_for_gh_5a3c482ed99f_1280.jpg" src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg"><strong data-burshtype="text">生物</strong><strong data-burshtype="text"> | 单细胞 | 转录组丨资料</strong></strong></span></section><section><span><strong data-burshtype="text">每天都精彩</strong></span></section></section></section><section><section><section><section><section><section><p><span>长按扫码可关注</span></p></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/3RGi9De8RxvtJ-RTJZsvLg",target="_blank" rel="noopener noreferrer">原文链接</a>
