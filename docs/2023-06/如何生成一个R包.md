---
title: "如何生成一个R包"
date: 2023-06-08T02:42:44Z
draft: ["false"]
tags: [
  "fetched",
  "生信媛"
]
categories: ["Acdemic"]
---
如何生成一个R包 by 生信媛
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器">R包的基本结构<span></span></h3><p data-tool="mdnice编辑器">最小必须：</p><pre data-tool="mdnice编辑器"><span></span><code>包的名字(包的名称只能包含字母、数字和点号。建议不要用点号，因为点号在函数名称有特殊含义)<br>|<br>|--DESCRIPTION（项目描述文件，包括包名、版本号、标题、描述、依赖关系等，用于设置项目的全局的配置）<br>|--NAMESPACE(包的命名空间文件，用于设置项目的全局的配置)<br>|--R（函数源码）<br>   |--hello.R<br>   |--……<br>|--man（帮助文档，存放函数说明文件的目录，语法大致基于 LaTeX。这些文件会被编译为 HTML、纯文本和 PDF 以供查看。）<br>   |--hello.Rd<br>   |--……<br>|--……<br></code></pre><br><section>可变部分：</section><ul data-tool="mdnice编辑器"><li><section>data（rdata）</section><section><br></section><p><img data-ratio="0.511864406779661" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDceby9xAPxuLLA3lxcoibknxMHRl6Po3fLwHg3gJEtibwibncibjfGRaymkk4Q/640?wx_fmt=png" data-type="png" data-w="1180" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDceby9xAPxuLLA3lxcoibknxMHRl6Po3fLwHg3gJEtibwibncibjfGRaymkk4Q/640?wx_fmt=png"><br></p></li></ul><figure data-tool="mdnice编辑器"><br><figcaption></figcaption></figure><ul data-tool="mdnice编辑器"><li><section>数据库(sqlite)</section><section><br></section></li><li><p><img data-ratio="0.16484375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebgRvNMK3TCoXX0KEgPnTTgbYnv3NZM01DDopYInJYiaJDog0tNko49zA/640?wx_fmt=png" data-type="png" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebgRvNMK3TCoXX0KEgPnTTgbYnv3NZM01DDopYInJYiaJDog0tNko49zA/640?wx_fmt=png"></p></li></ul><h2 data-tool="mdnice编辑器"><span></span>准备工作</h2><p data-tool="mdnice编辑器">你可以使用系统的原生的<code>package.skeleton()</code>函数，生成项目的骨架，也可以自己手动创建，或者使用Rstudio的（"文件（File）" → " 新项目（New Project）" → " 新目录（New DIrectory）" → "R 包（R Package）" ，输入R包名字，点击创建项目（Create Project）创建一个新的 R 包）。但是都比较麻烦，因为创建之后，都是需要手动写相关的帮助文档（latex）、NAMESPACE等文件，并且测试起来也不是太方便。</p><p data-tool="mdnice编辑器">这里给大家推荐由Hadley Wickham重新定义的开发流程。有3个武器，即devtools、roxygen2和testthat。</p><p data-tool="mdnice编辑器">首先安装如下几个R包：</p><ul data-tool="mdnice编辑器"><li><section>devtools：各种开发小工具的合集，让开发变得简单，非常实用。</section></li><li><section>roxygen2：将特殊格式的注释自动生成 .Rd 文件，远离LaTex的烦恼。</section></li><li><section>testthat：单元测试，让R包稳定、健壮，减少升级的痛苦。</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code><span>if</span>(!<span>require</span>(<span>"devtools"</span>))<br>  install.packages(<span>"devtools"</span>)<br><span>if</span>(!<span>require</span>(<span>"roxygen2"</span>))<br>  install.packages(<span>"roxygen2"</span>)<br><span>if</span>(!<span>require</span>(<span>"testthat"</span>))<br>  install.packages(<span>"testthat"</span>)<br><span>if</span>(!<span>require</span>(<span>"testthat"</span>))<br>  install.packages(<span>"testthat"</span>)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span>R项目生成</h2><pre data-tool="mdnice编辑器"><span></span><code>dest_path=<span>"/Users/xxx/Desktop/20200911-How_to_build_Rpkg"</span><br>pkg_path &lt;- paste(dest_path, <span>"demo"</span>, sep=.Platform$file.sep)<br><br>devtools::create(pkg_path)<br><br>✓ Creating <span>'/Users/xxx/Desktop/20200911-How_to_build_Rpkg/demo/'</span><br>✓ Setting active project to <span>'/Users/xxx/Desktop/20200911-How_to_build_Rpkg/demo'</span><br>✓ Creating <span>'R/'</span><br>✓ Writing <span>'DESCRIPTION'</span><br>Package: demo<br>Title: What the Package Does (One Line, Title Case)<br>Version: <span>0.0</span><span>.0</span><span>.9000</span><br>Authors@R (parsed):<br>    * First Last &lt;first.last@example.com&gt; [aut, cre] (&lt;https://orcid.org/YOUR-ORCID-ID&gt;)<br>Description: What the package does (one paragraph).<br>License: `use_mit_license()`, `use_gpl3_license()` or friends to<br>    pick a license<br>Encoding: UTF-<span>8</span><br>LazyData: true<br>Roxygen: list(markdown = <span>TRUE</span>)<br>RoxygenNote: <span>7.1</span><span>.1</span><br>✓ Writing <span>'NAMESPACE'</span><br>✓ Writing <span>'demo.Rproj'</span><br>✓ Adding <span>'.Rproj.user'</span> to <span>'.gitignore'</span><br>✓ Adding <span>'^demo\\.Rproj$'</span>, <span>'^\\.Rproj\\.user$'</span> to <span>'.Rbuildignore'</span><br>✓ Opening <span>'/Users/wangqingzhong/Desktop/20200911-How_to_build_Rpkg/demo/'</span> <span>in</span> new RStudio session<br>✓ Setting active project to <span>'&lt;no active project&gt;'</span><br></code></pre><figure data-tool="mdnice编辑器"><p><img data-ratio="0.15875613747954173" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebhwtk6ibiauNSMTqCOsgl2fiblez7yrTpoocib5dt0Y22m5EpFTia0QInIyQ/640?wx_fmt=png" data-type="png" data-w="1222" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebhwtk6ibiauNSMTqCOsgl2fiblez7yrTpoocib5dt0Y22m5EpFTia0QInIyQ/640?wx_fmt=png"></p><figcaption><br></figcaption></figure><ul data-tool="mdnice编辑器"><li><section>R目录是空的，因为我们还没有写任何代码</section></li><li><section>DESCRIPTION</section></li></ul><figure data-tool="mdnice编辑器"><p><img data-ratio="0.6275430359937402" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebiaEEOnkSTfzTqBsNyb9UklIdjD6Q9avTHrh7jymqU9o1j1AyJXEJGPg/640?wx_fmt=png" data-type="png" data-w="1278" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebiaEEOnkSTfzTqBsNyb9UklIdjD6Q9avTHrh7jymqU9o1j1AyJXEJGPg/640?wx_fmt=png"></p><figcaption><br></figcaption></figure><ul data-tool="mdnice编辑器"><li><section>NAMESPACE：通过roxygen2生成，不需要手动编辑</section></li></ul><figure data-tool="mdnice编辑器"><p><img data-ratio="0.16366906474820145" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDceb5ZBqdjjUpSjiaUhZ4iaQ7kTbL4SJRjqaPaQ46t6GxRkag4b90gVWDzeA/640?wx_fmt=png" data-type="png" data-w="1112" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDceb5ZBqdjjUpSjiaUhZ4iaQ7kTbL4SJRjqaPaQ46t6GxRkag4b90gVWDzeA/640?wx_fmt=png"></p><figcaption><br></figcaption></figure><h3 data-tool="mdnice编辑器"><span></span>修改DESCRIPTION文件<span></span></h3><p data-tool="mdnice编辑器">可以直接编辑该文件，或者在R里用<code>use_description</code>函数进行修改。</p><pre data-tool="mdnice编辑器"><span></span><code>setwd(pkg_path)<br><br>author.description = list(<br>  `Authors@R` = <span>'person("Ziru", "Chen", email = "xxx@xxx.cn", role = c("aut", "cre"),<br>                          comment = c(ORCID = "YOUR-ORCID-ID"))'</span>,<br>  License = <span>"GPL-3"</span>,<br>  Language =  <span>"es"</span>,<br>  Title = <span>"How to build an R package"</span>,<br>  Description = <span>"How to build an R package-20200911"</span>)<br><br>use_description(fields = author.description, check_name = <span>TRUE</span>, roxygen = <span>TRUE</span>)<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>Overwrite pre-existing file <span>'DESCRIPTION'</span>?<br><br><span>1</span>: Nope<br><span>2</span>: Negative<br><span>3</span>: I agree<br><br>Selection: <span>3</span><br>✓ Writing <span>'DESCRIPTION'</span><br>Package: demo<br>Title: How to build an R package<br>Version: <span>0.0</span><span>.0</span><span>.9000</span><br>Authors@R (parsed):<br>    * Ziru Chen &lt;chenziru@picb.ac.cn&gt; [aut, cre] (&lt;https://orcid.org/YOUR-ORCID-ID&gt;)<br>Description: How to build an R package-<span>20200911</span><br>License: GPL-<span>3</span><br>Encoding: UTF-<span>8</span><br>Language: es<br>LazyData: true<br>Roxygen: list(markdown = <span>TRUE</span>)<br>RoxygenNote: <span>7.1</span><span>.1</span><br></code></pre><figure data-tool="mdnice编辑器"><p><img data-ratio="0.78984375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebpIiceUK3o0YQtUIPFdMkxpMbtWFe4pibJGhD2jvEoYOicSiaRECrZh3m4w/640?wx_fmt=png" data-type="png" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebpIiceUK3o0YQtUIPFdMkxpMbtWFe4pibJGhD2jvEoYOicSiaRECrZh3m4w/640?wx_fmt=png"></p><figcaption><br></figcaption></figure><h4 data-tool="mdnice编辑器"><span></span>依赖包的添加<span></span></h4><p data-tool="mdnice编辑器">如果你的代码用到了别的包的函数，那么需要将这个依赖关系导入到DESCRIPTION文件。</p><pre data-tool="mdnice编辑器"><span></span><code>use_package(<span>"magrittr"</span>)<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>✓ Adding <span>'magrittr'</span> to Imports field <span>in</span> DESCRIPTION<br>● Refer to functions with `magrittr::fun()`<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-cropselx1="0" data-cropselx2="558" data-cropsely1="0" data-cropsely2="464" data-ratio="0.905608755129959" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebrU7ExcUDt5usicqDAYvgvHdvGelpZ4CMQ0NvMrDkDsu5wuPge3PQO1A/640?wx_fmt=png" data-type="png" data-w="1462" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebrU7ExcUDt5usicqDAYvgvHdvGelpZ4CMQ0NvMrDkDsu5wuPge3PQO1A/640?wx_fmt=png"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">依赖关系可以用type来指定，如果需要增加版本，可以设定<code>min_version = T</code></p><pre data-tool="mdnice编辑器"><span></span><code>&gt; use_package(package = <span>"dplyr"</span>, type = <span>"Depends"</span>, min_version = <span>TRUE</span>)<br>✓ Adding <span>'dplyr'</span> to Depends field <span>in</span> DESCRIPTION<br>● Are you sure you want Depends? Imports is almost always the better choice.<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-cropselx1="0" data-cropselx2="558" data-cropsely1="0" data-cropsely2="514" data-ratio="1.002202643171806" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebtcTHtXFnKdFia6bOO0y6rGibKOwqPOpFtHicdb2yZJy8phgkH4h6DNibsA/640?wx_fmt=png" data-type="png" data-w="908" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebtcTHtXFnKdFia6bOO0y6rGibKOwqPOpFtHicdb2yZJy8phgkH4h6DNibsA/640?wx_fmt=png"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">type：</p><ul data-tool="mdnice编辑器"><li><section><p>Depends</p><p>以上边例子为例，当使用demo包的时候，需要加载dplyr包到主搜索路径（即search（）返回的环境列表）中，demo包才可以使用（即其使用了library()来加载包）。如果希望用户每次加载你的软件包时都加载其他软件包，就使用这种方式。</p><p>存在的问题：如果加载的两个包有相同名称的函数，则后加载的包的函数会覆盖前面加载的。</p><p>除非一个包是被设计为与另一个包一起使用，没有前者，后者也没办法使用，可以用这种方式。否则一般不建议使用，更好的方式是， 将这些包使用@import导入命名空间(NAMESPACE).</p></section></li><li><section><p>Imports</p><p>在写代码的时候，使用Roxygen2注释的@import或@importFrom语句引用的包，或通过::运算符使用函数的包，都会显示在Imports下边。</p><p>Imports在安装包的时候会被一同安装，但不会被加载到环境。</p></section></li><li><section><p>Suggests</p><p>适用于并非确实必要，但在示例、编译使用指南或测试中用到的软件包。这里列出的R包不会与软件包一起被安装。</p></section></li><li><section><p>Enhance</p><p>不是很常见。</p></section></li></ul><h3 data-tool="mdnice编辑器"><span></span>NAMESPACE<span></span></h3><p data-tool="mdnice编辑器">NAMESPACE文件用于函数的访问控制。这个文件无需手动编辑，使用<code>roxygenize</code>或<code>document</code>函数的时候，会将相关函数导出到这个文件。</p><h3 data-tool="mdnice编辑器"><span></span>R代码<span></span></h3><p data-tool="mdnice编辑器">在使用roxygen2包来写R包的好处是：</p><ul data-tool="mdnice编辑器"><li><section>自动将import的包和我们写的需要导出的函数自动添加到NAMESPACE文件</section></li><li><section>自动根据代码生成man文档，无需我们手动编辑</section></li></ul><p data-tool="mdnice编辑器">来看一个例子：</p><p data-tool="mdnice编辑器">我们先在R下边编辑一个名为"bmi.R"的文件。并输入如下代码：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#' Add together two numbers. </span><br><span>#' @author Ziru Chen</span><br><span>#' \email{xxx@@xxx.cn}</span><br><span>#' @param weight weight.</span><br><span>#' @param height height.</span><br><span>#' @return The sum of \code{x} and \code{y}. </span><br><span>#' @importFrom magrittr %&gt;%</span><br><span>#' @export</span><br><span>#' @examples</span><br><span>#' bmi(50, 1.65)</span><br>bmi &lt;- <span>function</span>(weight, height) {<br>  (weight/(height^<span>2</span>)) %&gt;%  ceiling<br>}<br></code></pre><ul data-tool="mdnice编辑器"><li><section>roxygen的注释以<code>#'</code>开始，用以区别其他的注释。</section></li><li><section><code>@</code> 在 roxygen 中有特殊的意义，如果想在文档中添加 一个 <code>@</code> 符号，需要多加一个<code>@</code>，即使用<code>@@</code>，以下情况会出现@符号：</section></li><ul><li><section>电子邮件地址</section></li><li><section>访问 S4 成员变量</section></li></ul><li><section><code>@importFrom magrittr %&gt;%</code>，你也可以只写<code>@import magrittr</code>，但是前者会使得代码更加清晰，有助于自己和别人查看代码。</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>&gt; roxygenise(pkg_path)<br><br>Loading demo<br>Loading required package: dplyr<br><br>Attaching package: ‘dplyr’<br><br>The following object is masked from ‘package:testthat’:<br><br>    matches<br><br>The following objects are masked from ‘package:stats’:<br><br>    filter, lag<br><br>The following objects are masked from ‘package:base’:<br><br>    intersect, setdiff, setequal, union<br><br>Writing NAMESPACE<br>Writing NAMESPACE<br>Writing bmi.Rd<br></code></pre><p data-tool="mdnice编辑器">或者使用<code>document(pkg_path)</code>，This function is a wrapper for the <code>roxygen2::roxygenize()</code></p><p data-tool="mdnice编辑器">生成了帮助文档：bmi.Rd</p><figure data-tool="mdnice编辑器"><p><img data-ratio="0.7328125" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDceb4Bsqz8jpBTxxpAEoJjbyER6QjNsXBSpgMicf1iaicq19ChibILPR0HbgwA/640?wx_fmt=png" data-type="png" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDceb4Bsqz8jpBTxxpAEoJjbyER6QjNsXBSpgMicf1iaicq19ChibILPR0HbgwA/640?wx_fmt=png"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">将依赖的函数添加到了命名空间（NAMESPACE）文件，以及导出刚刚写的函数：</p><figure data-tool="mdnice编辑器"><p><img data-ratio="0.3057692307692308" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebnOrKmZWODSUSVtdmAib9l8zxNMtZccTezTiaMNW4rWJST3WInmb2oI7A/640?wx_fmt=png" data-type="png" data-w="1040" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebnOrKmZWODSUSVtdmAib9l8zxNMtZccTezTiaMNW4rWJST3WInmb2oI7A/640?wx_fmt=png"></p><figcaption><br></figcaption></figure><h3 data-tool="mdnice编辑器"><span></span>调试函数<span></span></h3><p data-tool="mdnice编辑器">加载R包里所有的函数：load_all()可以让你跳过安装而直接把源码包装到内存中。</p><pre data-tool="mdnice编辑器"><span></span><code>load_all()<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>&gt; weight &lt;- c(<span>50</span>,<span>60</span>)<br>&gt; height &lt;- c(<span>1.65</span>,<span>1.60</span>)<br>&gt; bmi(weight, height)<br>[<span>1</span>] <span>19</span> <span>24</span><br></code></pre><p data-tool="mdnice编辑器">更可重复的测试方法：testthat</p><pre data-tool="mdnice编辑器"><span></span><code><span># 开始testthat</span><br>usethis::use_testthat()<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-ratio="0.64296875" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebibve1iafKYnLEXkILs2KhYonyXibHGMXMSfVJXBCkfr6WPlwQDLkfbqmw/640?wx_fmt=png" data-type="png" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebibve1iafKYnLEXkILs2KhYonyXibHGMXMSfVJXBCkfr6WPlwQDLkfbqmw/640?wx_fmt=png"></p><figcaption><br></figcaption></figure><ul data-tool="mdnice编辑器"><li><section>创建了 <code>tests/testthat</code>目录</section></li><li><section>创建了<code>tests/testthat.R</code> ，当运行 <code>R CMD check</code> 时，会自动运行所有代码测试。</section></li><li><section>会将 testthat添加到  <code>DESCRIPTION</code>的 <code>Suggests</code> 部分。</section></li></ul><figure data-tool="mdnice编辑器"><p><img data-cropselx1="0" data-cropselx2="558" data-cropsely1="0" data-cropsely2="539" data-ratio="1.1224489795918366" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebjiaWJ6zrxXRFKwmSMViccj2wiara9qJwlBTOzU2uryiaaUfiaJgpKeRbkEA/640?wx_fmt=png" data-type="png" data-w="882" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebjiaWJ6zrxXRFKwmSMViccj2wiara9qJwlBTOzU2uryiaaUfiaJgpKeRbkEA/640?wx_fmt=png"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">在demo项目下刚才新建tests/testthat目录下新建“test.源文件名.R”，用来写测试代码。</p><p data-tool="mdnice编辑器">比如上边的文件名为bmi.R，其对应的测试脚本则命名为：test.bmi.R。</p><pre data-tool="mdnice编辑器"><span></span><code>test_that(<span>"str_length is number of characters"</span>, {<br>  expect_equal(bmi(<span>50</span>, <span>1.65</span>), <span>19</span>)<br>  expect_equal(bmi(c(<span>50</span>,<span>60</span>),c(<span>1.65</span>,<span>1.60</span>)), c(<span>19</span>,<span>24</span>))<br>})<br></code></pre><p data-tool="mdnice编辑器">然后运行测试：</p><pre data-tool="mdnice编辑器"><span></span><code>devtools::test()<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-ratio="0.6009501187648456" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebhficMdtuXZzj5dxyhIGAgTjlgbY51FG4V5DV6kY8gCtWlTdQz4icFNxQ/640?wx_fmt=png" data-type="png" data-w="842" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebhficMdtuXZzj5dxyhIGAgTjlgbY51FG4V5DV6kY8gCtWlTdQz4icFNxQ/640?wx_fmt=png"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">其他<code>expect_</code>请查看《R Packages·Chapter 11 Testing》：https://r-pkgs.org/tests.html</p><h3 data-tool="mdnice编辑器"><span></span>执行R包检查<span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>check(pkg_path)<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-ratio="0.3734375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDceb9m6LN2J5nfH0nrydz4t7K6rS0VgsASNibEFhibgmcZmciajY3l8Do9EWQ/640?wx_fmt=png" data-type="png" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDceb9m6LN2J5nfH0nrydz4t7K6rS0VgsASNibEFhibgmcZmciajY3l8Do9EWQ/640?wx_fmt=png"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">因为我刚才为了讲解方便，刚才导入了'dplyr'，但其实并没有用上。</p><p data-tool="mdnice编辑器">我们手动删除，再来检查一次。</p><pre data-tool="mdnice编辑器"><span></span><code>check(pkg_path)<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-ratio="0.259375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebwSWzywGOjibDUsyhB8qJNJPIakY8wU6QiaNuROT9UR3LFyQOr8rCgkEw/640?wx_fmt=png" data-type="png" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebwSWzywGOjibDUsyhB8qJNJPIakY8wU6QiaNuROT9UR3LFyQOr8rCgkEw/640?wx_fmt=png"></p><figcaption><br></figcaption></figure><h3 data-tool="mdnice编辑器"><span></span>生成R包<span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>&gt; devtools::build()<br>✓  checking <span>for</span> file ‘/Users/wangqingzhong/Desktop/<span>20200911</span>-How_to_build_Rpkg/demo/DESCRIPTION’ <span>...</span><br>─  preparing ‘demo’:<br>✓  checking DESCRIPTION meta-information <span>...</span><br>─  checking <span>for</span> LF line-endings <span>in</span> <span>source</span> and make files and shell scripts<br>─  checking <span>for</span> empty or unneeded directories<br>─  building ‘demo_0.0.0.9000.tar.gz’<br>   <br>[<span>1</span>] <span>"/Users/wangqingzhong/Desktop/20200911-How_to_build_Rpkg/demo_0.0.0.9000.tar.gz"</span><br></code></pre><figure data-tool="mdnice编辑器"><p><img data-ratio="0.18775510204081633" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebLqb24pob7Cia427tzfFQd1sIlSvmr8V8jIibqfr7srfMRmSYSdLBNNaQ/640?wx_fmt=png" data-type="png" data-w="490" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebLqb24pob7Cia427tzfFQd1sIlSvmr8V8jIibqfr7srfMRmSYSdLBNNaQ/640?wx_fmt=png"></p><figcaption><br></figcaption></figure><h2 data-tool="mdnice编辑器"><span></span>安装R包</h2><pre data-tool="mdnice编辑器"><span></span><code>&gt; install.packages(paste(dest_path, <span>"demo_0.0.0.9000.tar.gz"</span>, sep = .Platform<span>$file</span>.sep),repos=NULL, <span>type</span>=<span>'source'</span>)<br><br>&gt; library(demo)<br></code></pre><p data-tool="mdnice编辑器">一定要把设置<code>repos=NULL</code>，否则会到CRAN去寻找包（当然，找不到），于是会报错。</p><figure data-tool="mdnice编辑器"><p><img data-ratio="0.30234375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebiasqk179iahO2LLly4WWMdEwdLNH0FUyeQAhzaQW0BQQTNqOSfE892vQ/640?wx_fmt=png" data-type="png" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_png/I101ibe9h7rNJb8ia0tDHbKaws7VXpDcebiasqk179iahO2LLly4WWMdEwdLNH0FUyeQAhzaQW0BQQTNqOSfE892vQ/640?wx_fmt=png"></p><figcaption><br></figcaption></figure><h2 data-tool="mdnice编辑器"><span></span>卸载R包</h2><ul data-tool="mdnice编辑器"><li><section>在R语言的环境中用<code>remove.packages()</code>函数</section></li><li><section>命令行卸载：R CMD REMOVE R包名称</section></li></ul><h2 data-tool="mdnice编辑器"><span></span>参考资料</h2><p>本文写于2020.09.10（当时为了给学生讲解，犹疑再三还是发出来了），重度参考了以下资料：<br></p><h3 data-tool="mdnice编辑器"><span></span>书<span></span></h3><ul data-tool="mdnice编辑器"><li><section>《R包开发》：《R Packages》的中文版</section></li><li><section>《R Packages》https://r-pkgs.org/</section></li><li><section>《R的极客理想：高级开发篇 (数据分析技术丛书)》</section></li></ul><h3 data-tool="mdnice编辑器"><span></span>文章<span></span></h3><ul data-tool="mdnice编辑器"><li><section>开发 R 程序包之忍者篇：https://cosx.org/2011/05/write-r-packages-like-a-ninja/</section></li></ul></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/7847toikls80qstZbqBP9Q",target="_blank" rel="noopener noreferrer">原文链接</a>
