---
title: "RNA velocity分析代码"
date: 2023-06-06T00:21:06Z
draft: ["false"]
tags: [
  "fetched",
  "东林的扯淡小屋"
]
categories: ["Acdemic"]
---
RNA velocity分析代码 by 东林的扯淡小屋
------
<div><p>分别是R语言版本和Python版本：</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="http"><code><span><span>conda activate velocity</span></span></code><code><span>export OPENBLAS_NUM_THREADS=1</span></code><code><span>set.seed(123)</span></code><code><span>#导入包</span></code><code><span>library(Seurat)</span></code><code><span>library(tidyverse)</span></code><code><span>library(patchwork)</span></code><code><span>library(SCENIC)</span></code><code><span>library(plyr)</span></code><code><span>library(permute)</span></code><code><span>library(data.table)</span></code><code><span>library(SCopeLoomR)</span></code><code><span>library(velocyto.R)</span></code><code><span>library(pagoda2)</span></code><code><span>setwd("/data3/yudonglin/ren")</span></code><code><span>#YDL&lt;- readRDS("/data3/yudonglin/ren/10X/cell_matastasis.RDS")</span></code><code><span><br></span></code><code><span>#liver metastasized tumor from rectal cancer</span></code><code><span>x1 &lt;-velocyto.R::read.loom.matrices("/data3/yudonglin/ren/HRR016237/velocyto/HRR016237.loom")</span></code><code><span>splice&lt;-x1$spliced</span></code><code><span>unsplice&lt;-x1$unspliced</span></code><code><span>head(colnames(splice))</span></code><code><span>head(colnames(unsplice))</span></code><code><span>colnames(splice) &lt;- paste("liver metastasized tumor from rectal cancer_",substring(colnames(splice),11,26),"-1",sep="")</span></code><code><span>colnames(unsplice) &lt;- paste("liver metastasized tumor from rectal cancer_",substring(colnames(unsplice),11,26),"-1",sep="")</span></code><code><span>head(colnames(splice))</span></code><code><span>head(colnames(unsplice))</span></code><code><span>x1$spliced&lt;-splice</span></code><code><span>x1$unspliced&lt;-unsplice</span></code><code><span>table(YDL@meta.data$orig.ident)</span></code><code><span>#primary rectal cancer</span></code><code><span>x2 &lt;-velocyto.R::read.loom.matrices(file = "/data3/yudonglin/ren/HRR016238/velocyto/HRR016238.loom", engine = "hdf5r")</span></code><code><span>splice&lt;-x2$spliced</span></code><code><span>unsplice&lt;-x2$unspliced</span></code><code><span>head(colnames(splice))</span></code><code><span>head(colnames(unsplice))</span></code><code><span>colnames(splice) &lt;- paste("primary rectal cancer_",substring(colnames(splice),11,26),"-1",sep="")</span></code><code><span>colnames(unsplice) &lt;- paste("primary rectal cancer_",substring(colnames(unsplice),11,26),"-1",sep="")</span></code><code><span>head(colnames(splice))</span></code><code><span>head(colnames(unsplice))</span></code><code><span>x2$spliced&lt;-splice</span></code><code><span>x2$unspliced&lt;-unsplice</span></code><code><span>table(YDL@meta.data$orig.ident)</span></code><code><span>#adjacent non-tumor tissue of hepatocellular carcinoma</span></code><code><span>x3 &lt;-velocyto.R::read.loom.matrices(file = "/data3/yudonglin/ren/HRR016239/velocyto/HRR016239.loom", engine = "hdf5r")</span></code><code><span>splice&lt;-x3$spliced</span></code><code><span>unsplice&lt;-x3$unspliced</span></code><code><span>head(colnames(splice))</span></code><code><span>head(colnames(unsplice))</span></code><code><span>colnames(splice) &lt;- paste("adjacent non-tumor tissue of hepatocellular carcinoma_",substring(colnames(splice),11,26),"-1",sep="")</span></code><code><span>colnames(unsplice) &lt;- paste("adjacent non-tumor tissue of hepatocellular carcinoma_",substring(colnames(unsplice),11,26),"-1",sep="")</span></code><code><span>head(colnames(splice))</span></code><code><span>head(colnames(unsplice))</span></code><code><span>x3$spliced&lt;-splice</span></code><code><span>x3$unspliced&lt;-unsplice</span></code><code><span>table(YDL@meta.data$orig.ident)</span></code><code><span>#liver tumor</span></code><code><span>x4 &lt;-velocyto.R::read.loom.matrices(file = "/data3/yudonglin/ren/HRR016240/velocyto/HRR016240.loom", engine = "hdf5r")</span></code><code><span>splice&lt;-x4$spliced</span></code><code><span>unsplice&lt;-x4$unspliced</span></code><code><span>head(colnames(splice))</span></code><code><span>head(colnames(unsplice))</span></code><code><span>colnames(splice) &lt;- paste("liver tumor_",substring(colnames(splice),11,26),"-1",sep="")</span></code><code><span>colnames(unsplice) &lt;- paste("liver tumor_",substring(colnames(unsplice),11,26),"-1",sep="")</span></code><code><span>head(colnames(splice))</span></code><code><span>head(colnames(unsplice))</span></code><code><span>x4$spliced&lt;-splice</span></code><code><span>x4$unspliced&lt;-unsplice</span></code><code><span>spliced &lt;- cbind(x1[["spliced"]], x2[["spliced"]],x3[["spliced"]], x4[["spliced"]])</span></code><code><span>unspliced &lt;- cbind(x1[["unspliced"]], x2[["unspliced"]],x3[["unspliced"]], x4[["unspliced"]])</span></code><code><span>emat &lt;- spliced</span></code><code><span>nmat &lt;- unspliced</span></code><code><span># saveRDS(spliced,"spliced.rds")</span></code><code><span>#saveRDS(unspliced,"unspliced.rds")</span></code><code><span># write.csv(unspliced,"unspliced.csv")</span></code><code><span>seurat.object&lt;-YDL</span></code><code><span>emb &lt;- seurat.object@reductions$tsne@cell.embeddings</span></code><code><span># Estimate the cell-cell distances</span></code><code><span>cell.dist &lt;- as.dist(1-armaCor(t(seurat.object@reductions$tsne@cell.embeddings)))</span></code><code><span>fit.quantile &lt;- 0.02</span></code><code><span># Main velocity estimation</span></code><code><span>rvel.cd &lt;- gene.relative.velocity.estimates(emat,nmat,deltaT=2,</span></code><code><span>                                            kCells=10,</span></code><code><span>                                            cell.dist=cell.dist,</span></code><code><span>                                            fit.quantile=fit.quantile,</span></code><code><span>                                            n.cores=48)</span></code><code><span># This section gets the colors out of the seurat tSNE object so that my seurat and velocyto plots use the same color scheme.</span></code><code><span>library("Seurat")</span></code><code><span>library("ggplot2")</span></code><code><span>gg &lt;- TSNEPlot(seurat.object)</span></code><code><span>ggplot_build(gg)$data</span></code><code><span>colors &lt;- as.list(ggplot_build(gg)$data[[1]]$colour)</span></code><code><span>names(colors) &lt;- rownames(emb)</span></code><code><span>p1 &lt;- show.velocity.on.embedding.cor(emb,rvel.cd,n=30,scale='sqrt',</span></code><code><span>                                     cell.colors=ac(colors,alpha=0.5),</span></code><code><span>                                     cex=0.8,arrow.scale=60,show.grid.flow=T,</span></code><code><span>                                     min.grid.cell.mass=1.0,grid.n=50,arrow.lwd=1,</span></code><code><span>                                     do.par=F,cell.border.alpha = 0.1,</span></code><code><span>                                     n.cores=48,main="RNA Velocity")</span></code><code><span>p2&lt;-show.velocity.on.embedding.cor(emb, rvel.cd, n = 200, scale = 'sqrt',</span></code><code><span>                                   cell.colors = ac(colors, alpha = 0.5),</span></code><code><span>                                   cex = 0.8, arrow.scale = 25, show.grid.flow = T,</span></code><code><span>                                   min.grid.cell.mass = 0.5, grid.n = 40,</span></code><code><span>                                   arrow.lwd = 1,do.par = T, cell.border.alpha = 0.1,n.cores=48,main="RNA Velocity")</span></code><code><span>DimPlot(YDL, reduction = "umap", label = F, pt.size = 1.5)</span></code><code><span>p3&lt;-show.velocity.on.embedding.cor(emb, rvel.cd, n = 200, scale = 'sqrt',</span></code><code><span>                                   cell.colors = ac(colors, alpha = 0.5),</span></code><code><span>                                   cex = 0.8, arrow.scale = 50, show.grid.flow = T,</span></code><code><span>                                   min.grid.cell.mass = 0.5, grid.n = 40,</span></code><code><span>                                   arrow.lwd = 1,do.par = T, cell.border.alpha = 0.1,n.cores=48,main="RNA Velocity")</span></code><code><span>p4&lt;-show.velocity.on.embedding.cor(emb, rvel.cd, n = 200, scale = 'sqrt',</span></code><code><span>                                   cell.colors = ac(colors, alpha = 0.5),</span></code><code><span>                                   cex = 0.8, arrow.scale = 60, show.grid.flow = T,</span></code><code><span>                                   min.grid.cell.mass = 0.5, grid.n = 40,</span></code><code><span>                                   arrow.lwd = 1,do.par = T, cell.border.alpha = 0.1,n.cores=48,main="RNA Velocity")</span></code><code><span>DimPlot(YDL, reduction = "umap", label = F, pt.size = 1.5)</span></code><code><span>dev.off()</span></code><code><span>savehistory("code.txt")</span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span>library(Seurat)</span></code><code><span>library(SeuratDisk)</span></code><code><span>library(SeuratWrappers)</span></code><code><span>seurat_obj&lt;- YDL</span></code><code><span># save metadata table:</span></code><code><span>seurat_obj$barcode &lt;- colnames(seurat_obj)</span></code><code><span>seurat_obj$UMAP_1 &lt;- seurat_obj@reductions$umap@cell.embeddings[,1]</span></code><code><span>seurat_obj$UMAP_2 &lt;- seurat_obj@reductions$umap@cell.embeddings[,2]</span></code><code><span>seurat_obj$tSNE_1 &lt;- seurat_obj@reductions$tsne@cell.embeddings[,1]</span></code><code><span>seurat_obj$tSNE_2 &lt;- seurat_obj@reductions$tsne@cell.embeddings[,2]</span></code><code><span>write.csv(seurat_obj@meta.data, file='metadata.csv', quote=F, row.names=F)</span></code><code><span># write expression counts matrix</span></code><code><span>library(Matrix)</span></code><code><span>counts_matrix &lt;- GetAssayData(seurat_obj, assay='RNA', slot='counts')</span></code><code><span>writeMM(counts_matrix, file='counts.mtx')</span></code><code><span># write dimesnionality reduction matrix, in this example case pca matrix</span></code><code><span>write.csv(seurat_obj@reductions$pca@cell.embeddings, file='pca.csv', quote=F, row.names=F)</span></code><code><span># write gene names</span></code><code><span>write.table(</span></code><code><span>  data.frame('gene'=rownames(counts_matrix)),file='gene_names.csv',</span></code><code><span>  quote=F,row.names=F,col.names=F</span></code><code><span>)</span></code><code><span><br></span></code></pre></section><p><img data-galleryid="" data-ratio="0.4648148148148148" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpDTIBDwF2HVYFRHws2Q1o5ibzJQTA8aIPowuqbhTDWj3ebeSia4L6TJY83urv238EqLA4IFH2dF8Ag/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpDTIBDwF2HVYFRHws2Q1o5ibzJQTA8aIPowuqbhTDWj3ebeSia4L6TJY83urv238EqLA4IFH2dF8Ag/640?wx_fmt=png"></p><p><br></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span><br></span></code><code><span>conda activate velocity</span></code><code><span><br></span></code><code><span><span>#conda activate velocyto</span></span></code><code><span>python</span></code><code><span><span>import</span> scanpy <span>as</span> sc</span></code><code><span><span>import</span> anndata</span></code><code><span><span>from</span> scipy <span>import</span> io</span></code><code><span><span>from</span> scipy.sparse <span>import</span> coo_matrix, csr_matrix</span></code><code><span><span>import</span> numpy <span>as</span> np</span></code><code><span><span>import</span> os</span></code><code><span><span>import</span> pandas <span>as</span> pd</span></code><code><span><span>import</span> matplotlib <span>as</span> mpl</span></code><code><span><br></span></code><code><span><span>import</span> scvelo <span>as</span> scv</span></code><code><span><span>import</span> scanpy <span>as</span> sc</span></code><code><span><span>import</span> cellrank <span>as</span> cr</span></code><code><span><span>import</span> numpy <span>as</span> np</span></code><code><span><span>import</span> pandas <span>as</span> pd</span></code><code><span><span>import</span> anndata <span>as</span> ad</span></code><code><span>mpl.use(<span>'Agg'</span>)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span># load sparse matrix:</span></span></code><code><span>X = io.mmread(<span>"counts.mtx"</span>)</span></code><code><span><br></span></code><code><span><span># create anndata object</span></span></code><code><span>adata = anndata.AnnData(</span></code><code><span>  X=X.transpose().tocsr()</span></code><code><span>)</span></code><code><span><br></span></code><code><span><span># load cell metadata:</span></span></code><code><span>cell_meta = pd.read_csv(<span>"metadata.csv"</span>)</span></code><code><span><br></span></code><code><span><span># load gene names:</span></span></code><code><span><span>with</span> open(<span>"gene_names.csv"</span>, <span>'r'</span>) <span>as</span> f:</span></code><code><span>  gene_names = f.read().splitlines()</span></code><code><span><br></span></code><code><span><span># set anndata observations and index obs by barcodes, var by gene names</span></span></code><code><span>adata.obs = cell_meta</span></code><code><span>adata.obs.index = adata.obs[<span>'barcode'</span>]</span></code><code><span>adata.var.index = gene_names</span></code><code><span><br></span></code><code><span><span># load dimensional reduction:</span></span></code><code><span>pca = pd.read_csv(<span>"pca.csv"</span>)</span></code><code><span>pca.index = adata.obs.index</span></code><code><span><br></span></code><code><span><span># set pca and umap</span></span></code><code><span>adata.obsm[<span>'X_pca'</span>] = pca.to_numpy()</span></code><code><span>adata.obsm[<span>'X_umap'</span>] = np.vstack((adata.obs[<span>'UMAP_1'</span>].to_numpy(), adata.obs[<span>'UMAP_2'</span>].to_numpy())).T</span></code><code><span>adata.obsm[<span>'X_tsne'</span>] = np.vstack((adata.obs[<span>'tSNE_1'</span>].to_numpy(), adata.obs[<span>'tSNE_2'</span>].to_numpy())).T</span></code><code><span><br></span></code><code><span><span># plot a UMAP colored by sampleID to test:</span></span></code><code><span>sc.pl.umap(adata, color=[<span>'seurat_clusters'</span>], frameon=<span>False</span>, save=<span>"True.pdf"</span>)</span></code><code><span>sc.pl.tsne(adata, color=[<span>'seurat_clusters'</span>], frameon=<span>False</span>, save=<span>"True.pdf"</span>)</span></code><code><span>sc.pl.umap(adata, color=[<span>'celltype'</span>], frameon=<span>False</span>, save=<span>"Truecelltype.pdf"</span>)</span></code><code><span>sc.pl.tsne(adata, color=[<span>'celltype'</span>], frameon=<span>False</span>, save=<span>"Truecelltype.pdf"</span>)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span><span># save dataset as anndata format</span></span></code><code><span>adata.write(<span>'my_data.h5ad'</span>)</span></code><code><span><br></span></code><code><span><span># reload dataset</span></span></code><code><span>adata = sc.read_h5ad(<span>'my_data.h5ad'</span>)</span></code><code><span><br></span></code><code><span><br></span></code><code><span>ldata1=scv.read_loom(<span>"/data3/yudonglin/ren/HRR016237/velocyto/HRR016237.loom"</span>,validate=<span>False</span>)</span></code><code><span>ldata2=scv.read_loom(<span>"/data3/yudonglin/ren/HRR016238/velocyto/HRR016238.loom"</span>,validate=<span>False</span>)</span></code><code><span>ldata3=scv.read_loom(<span>"/data3/yudonglin/ren/HRR016239/velocyto/HRR016239.loom"</span>,validate=<span>False</span>)</span></code><code><span>ldata4=scv.read_loom(<span>"/data3/yudonglin/ren/HRR016240/velocyto/HRR016240.loom"</span>,validate=<span>False</span>)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span># rename barcodes in order to merge:</span></span></code><code><span>barcodes = [bc.split(<span>':'</span>)[<span>1</span>] <span>for</span> bc <span>in</span> ldata1.obs.index.tolist()]</span></code><code><span>barcodes = [<span>"liver metastasized tumor from rectal cancer_"</span>+bc[<span>0</span>:len(bc)<span>-1</span>] <span>for</span> bc <span>in</span> barcodes]</span></code><code><span>ldata1.obs.index = barcodes</span></code><code><span><br></span></code><code><span>barcodes = [bc.split(<span>':'</span>)[<span>1</span>] <span>for</span> bc <span>in</span> ldata2.obs.index.tolist()]</span></code><code><span>barcodes = [<span>"primary rectal cancer_"</span>+bc[<span>0</span>:len(bc)<span>-1</span>] <span>for</span> bc <span>in</span> barcodes]</span></code><code><span>ldata2.obs.index = barcodes</span></code><code><span><br></span></code><code><span>barcodes = [bc.split(<span>':'</span>)[<span>1</span>] <span>for</span> bc <span>in</span> ldata3.obs.index.tolist()]</span></code><code><span>barcodes = [<span>"adjacent non-tumor tissue of hepatocellular carcinoma_"</span>+bc[<span>0</span>:len(bc)<span>-1</span>] <span>for</span> bc <span>in</span> barcodes]</span></code><code><span>ldata3.obs.index = barcodes</span></code><code><span><br></span></code><code><span>barcodes = [bc.split(<span>':'</span>)[<span>1</span>] <span>for</span> bc <span>in</span> ldata4.obs.index.tolist()]</span></code><code><span>barcodes = [<span>"liver tumor_"</span>+bc[<span>0</span>:len(bc)<span>-1</span>] <span>for</span> bc <span>in</span> barcodes]</span></code><code><span>ldata4.obs.index = barcodes</span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span><br></span></code><code><span><span># make variable names unique</span></span></code><code><span>ldata1.var_names_make_unique()</span></code><code><span>ldata2.var_names_make_unique()</span></code><code><span>ldata3.var_names_make_unique()</span></code><code><span>ldata4.var_names_make_unique()</span></code><code><span><br></span></code><code><span><span>#ldata = ldata1.concatenate([ldata1, ldata2, ldata3, ldata4],join = 'outer') </span></span></code><code><span><br></span></code><code><span>ldata = ldata1.concatenate([ldata2, ldata3, ldata4]) </span></code><code><span>scv.utils.clean_obs_names(adata)</span></code><code><span>scv.utils.clean_obs_names(ldata)</span></code><code><span><br></span></code><code><span><span># concatenate the three loom</span></span></code><code><span><span>#ldata = ldata1.concatenate([ldata1, ldata2, ldata3, ldata4])         </span></span></code><code><span><span># concatenate the three loom</span></span></code><code><span><span>#ldata = ldata1.concatenate([ldata1, ldata2, ldata3, ldata4, ldata5])</span></span></code><code><span><span># merge matrices into the original adata object</span></span></code><code><span>adata = scv.utils.merge(adata, ldata)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span># plot umap to check</span></span></code><code><span>sc.pl.umap(adata, color=<span>'seurat_clusters'</span>, frameon=<span>False</span>, legend_loc=<span>'on data'</span>, title=<span>''</span>, save=<span>'_celltypes.pdf'</span>)</span></code><code><span><br></span></code><code><span>sc.pl.tsne(adata, color=<span>'seurat_clusters'</span>, frameon=<span>False</span>, legend_loc=<span>'on data'</span>, title=<span>''</span>, save=<span>'tsne.pdf'</span>)</span></code><code><span><br></span></code><code><span>sc.pl.umap(adata, color=<span>'celltype'</span>, frameon=<span>False</span>, legend_loc=<span>'on data'</span>, title=<span>''</span>, save=<span>'_celltypes.pdf'</span>)</span></code><code><span><br></span></code><code><span>sc.pl.tsne(adata, color=<span>'celltype'</span>, frameon=<span>False</span>, legend_loc=<span>'on data'</span>, title=<span>''</span>, save=<span>'tsne_celltype.pdf'</span>)</span></code><code><span><br></span></code><code><span><span>#scv.pl.proportions(adata, groupby='seurat_clusters',save="proportion.pdf")</span></span></code><code><span>scv.pl.proportions(adata,save=<span>"proportion.pdf"</span>)</span></code><code><span><br></span></code><code><span><span># pre-process</span></span></code><code><span>scv.pp.filter_and_normalize(adata)</span></code><code><span>scv.pp.moments(adata)</span></code><code><span><span># compute velocity</span></span></code><code><span>scv.tl.velocity(adata, mode=<span>'stochastic'</span>)</span></code><code><span>scv.tl.velocity_graph(adata)</span></code><code><span><br></span></code><code><span><br></span></code><code><span>scv.pl.velocity_embedding(adata, basis=<span>'umap'</span>, frameon=<span>False</span>, save=<span>'embedding_umap.pdf'</span>)</span></code><code><span>scv.pl.velocity_embedding(adata, basis=<span>'tsne'</span>, frameon=<span>False</span>, save=<span>'embedding_tsne.pdf'</span>)</span></code><code><span><br></span></code><code><span><br></span></code><code><span>scv.pl.velocity_embedding_grid(adata, basis=<span>'umap'</span>, color=<span>'seurat_clusters'</span>, save=<span>'embedding_grid_umap.pdf'</span>, title=<span>''</span>, scale=<span>0.25</span>)</span></code><code><span><br></span></code><code><span>scv.pl.velocity_embedding_grid(adata, basis=<span>'tsne'</span>, color=<span>'seurat_clusters'</span>, save=<span>'embedding_grid_tsne.pdf'</span>, title=<span>''</span>, scale=<span>0.25</span>)</span></code><code><span><br></span></code><code><span><br></span></code><code><span>scv.pl.velocity_embedding_stream(adata, basis=<span>'umap'</span>, color=<span>'seurat_clusters'</span>, save=<span>'embedding_stream_umap.pdf'</span>, title=<span>''</span>)</span></code><code><span>scv.pl.velocity_embedding_stream(adata, basis=<span>'tsne'</span>, color=<span>'seurat_clusters'</span>, save=<span>'embedding_stream_tsne.pdf'</span>, title=<span>''</span>)</span></code><code><span><br></span></code><code><span><span>#可以调节长宽比，不过最后只能输出图片，而不能是PDF</span></span></code><code><span>scv.pl.velocity_embedding_stream(adata, basis=<span>'umap'</span>, color=<span>'seurat_clusters'</span>, figsize =(<span>10</span>, <span>10</span>),save=<span>'embedding_stream_umap1.pdf'</span>, title=<span>''</span>)</span></code><code><span>scv.pl.velocity_embedding_stream(adata, basis=<span>'tsne'</span>, color=<span>'seurat_clusters'</span>, figsize =(<span>10</span>, <span>10</span>),save=<span>'embedding_stream_tsne1.pdf'</span>, title=<span>''</span>)</span></code><code><span><br></span></code></pre></section><p><img data-galleryid="" data-ratio="0.4444444444444444" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpDTIBDwF2HVYFRHws2Q1o5DC9AZrwf32MicAbVvXFK2IiaQja71ydJ7lsz4BIicqlva8iaic0mfICu5lA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpDTIBDwF2HVYFRHws2Q1o5DC9AZrwf32MicAbVvXFK2IiaQja71ydJ7lsz4BIicqlva8iaic0mfICu5lA/640?wx_fmt=png"></p><p><br></p><p><br></p><p><img data-galleryid="" data-ratio="0.4546296296296296" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpDTIBDwF2HVYFRHws2Q1o5Smma7DSe85BKsBSV0icovpbut4ganH1c4OGv0rYIjQpIk3UI8v4spWA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpDTIBDwF2HVYFRHws2Q1o5Smma7DSe85BKsBSV0icovpbut4ganH1c4OGv0rYIjQpIk3UI8v4spWA/640?wx_fmt=png"></p><p>结果具有一致性。</p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/YFyo39-cfgXrYR2I2-Ty9Q",target="_blank" rel="noopener noreferrer">原文链接</a>
