---
title: "R优雅的给环状热图添加显著性标记"
date: 2023-06-04T05:07:29Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
R优雅的给环状热图添加显著性标记 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节回答观众老爷的一个问题，如何在R中使用<strong>「ggtreeExtra」</strong>绘制环状热图并添加显著性标记星号，由于官方文档没有写出很多具体的案例因此大家有些疑惑，实际上<strong>「geom_fruit」</strong>兼容很多的<code>geom_*</code>有兴趣的朋友可以自己进行尝试，在此只介绍<strong>「geom_text」</strong>。数据为随意构建结果无实际意义，<strong>「数据+代码已经上传2023VIP群，加群的观众老爷请自行下载」</strong></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>官方文档</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>https://bioconductor.org/packages/release/bioc/vignettes/ggtreeExtra/inst/doc/ggtreeExtra.html</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-weui-theme="light" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggtreeExtra)<br><span>library</span>(ggtree)<br><span>library</span>(treeio)<br><span>library</span>(tidyverse)<br><span>library</span>(ggnewscale)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- read.delim(<span>"genus.xls"</span>,sep=<span>"\t"</span>) %&gt;% head(<span>60</span>) %&gt;% <br>  column_to_rownames(var=<span>"OTU.ID"</span>)<br><br>dat2 &lt;- df %&gt;% mutate_if(is.numeric,<span>function</span>(x) x+ <span>1</span>) %&gt;%<br>  log10() %&gt;% <br>  rownames_to_column(var=<span>"ID"</span>) %&gt;% pivot_longer(-ID) %&gt;% <br>  mutate(name = trimws(str_remove(name,<span>"(\\s+[A-Za-z]+)?[3-6-]+"</span>)))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>可视化距离矩阵</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>p &lt;- hclust(dist(df)) %&gt;% ggtree(layout=<span>"fan"</span>, open.angle=<span>10</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>绘制环状热图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>p + new_scale_fill() +<br>  geom_fruit(data=dat2, geom=geom_tile,<br>             mapping=aes(y=ID, x=name,alpha=value,fill=name),<br>             color = <span>"grey50"</span>,offset = <span>0.04</span>,size = <span>0.02</span>)+<br>  geom_fruit(data=dat2 %&gt;%<br>               mutate(text=case_when(value &gt; <span>2.5</span> ~ <span>"**"</span>,<span>TRUE</span> ~ <span>" "</span>)),<br>             geom=geom_text,<br>             mapping=aes(y=ID,x=name,label=text),<br>             color = <span>"black"</span>,offset =<span>0.01</span>,size =<span>2</span>,vjust=<span>0.5</span>)+<br>  scale_alpha_continuous(guide=<span>NULL</span>)+<br>  scale_fill_manual(values=c(<span>"#FFC125"</span>,<span>"#87CEFA"</span>,<span>"#7B68EE"</span>,<br>                             <span>"#9ACD32"</span>,<span>"#D15FEE"</span>,<span>"#FFC0CB"</span>,<br>                             <span>"#EE6A50"</span>,<span>"#8DEEEE"</span>, <span>"#006400"</span>,<span>"#800000"</span>,<br>                             <span>"#B0171F"</span>,<span>"#191970"</span>))+<br>  theme(legend.position=<span>"none"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.8612059158134243" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT1zWpyOO7t7QJnSHr1xU9RZXJPEic30G6uLic3ddqo563S5BPO2megsbWg/640?wx_fmt=png" data-type="png" data-w="879" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT1zWpyOO7t7QJnSHr1xU9RZXJPEic30G6uLic3ddqo563S5BPO2megsbWg/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>有需要学习个性化数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>购买<strong>「2023年度会员」</strong> <code>初始价格99元</code>，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；按照往年数据小编年产出约在150+以上</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可下单购买，需要了解更多信息的朋友欢迎交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝扫一扫</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="1.6136783733826248" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT1Epnwu6cCFGsMANhFiaaicvE5Y2ZpXzDJzxUIadIiaxOwb611PA5CgRibEw/640?wx_fmt=png" data-type="png" data-w="541" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT1Epnwu6cCFGsMANhFiaaicvE5Y2ZpXzDJzxUIadIiaxOwb611PA5CgRibEw/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023会员群精彩内容</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT1sCKYb76kAcp4LjoyKTDgk5Qxnibf6hQYhaJkX2RgpMXEQ8S7UfSUoWA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT1sCKYb76kAcp4LjoyKTDgk5Qxnibf6hQYhaJkX2RgpMXEQ8S7UfSUoWA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT163840HY0fx498vjXh8JEQXd0Cf1g7FBZh7QNMLFb0DJYmVTP5rAiacw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT163840HY0fx498vjXh8JEQXd0Cf1g7FBZh7QNMLFb0DJYmVTP5rAiacw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT1Sg4v8qV9YoJibuib71dzCSxDqJTFupkhgZsb8Z2I2yQo4tFuMicbgCwpA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT1Sg4v8qV9YoJibuib71dzCSxDqJTFupkhgZsb8Z2I2yQo4tFuMicbgCwpA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT1rwSjrNd2A2QXdwJ9PPZWfAzs4U5zOlVSU0f81t9EicraGIWhe2NLiciaQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT1rwSjrNd2A2QXdwJ9PPZWfAzs4U5zOlVSU0f81t9EicraGIWhe2NLiciaQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT1XjkqoSMjuJHRW5VmY5zoMKO0FqpdWde03be4Rdt8ulesgz3C8Rpiahw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT1XjkqoSMjuJHRW5VmY5zoMKO0FqpdWde03be4Rdt8ulesgz3C8Rpiahw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT1fD5Vz3O0xRujy9gpQsAS2lVcY42TuVTia4TcRBHp7tJY2rHicvQyK1JA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZCysNtn0dVibp4f00OO7ibT1fD5Vz3O0xRujy9gpQsAS2lVcY42TuVTia4TcRBHp7tJY2rHicvQyK1JA/640?wx_fmt=png"></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/7tsZNW0msJoFjWuvWNlkNw",target="_blank" rel="noopener noreferrer">原文链接</a>
