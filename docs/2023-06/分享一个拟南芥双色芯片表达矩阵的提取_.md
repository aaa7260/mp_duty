---
title: "分享一个拟南芥双色芯片表达矩阵的提取~"
date: 2023-06-19T08:41:03Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
分享一个拟南芥双色芯片表达矩阵的提取~ by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p><br></p><p><img data-galleryid="" data-ratio="0.7172995780590717" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSM3mGpMS533Dpvf38jh9vdcHhAKDiaoImvpszSwx9MFGtSkAeQW0EW9uw/640?wx_fmt=jpeg" data-type="jpeg" data-w="474" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSM3mGpMS533Dpvf38jh9vdcHhAKDiaoImvpszSwx9MFGtSkAeQW0EW9uw/640?wx_fmt=jpeg"><span></span></p><h1 data-tool="mdnice编辑器"><span>背景简介</span><span></span></h1><p data-tool="mdnice编辑器">也许是人更乐于研究自身，要么就我涉及的领域比较狭窄，到目前为止我分析的大部分芯片数据不是人类就是小鼠。最近和硕士期间的同学联系上，她说她最近在做拟南芥。</p><p data-tool="mdnice编辑器"><span>拟南芥？那个模式植物嘛~，发现了自己对其完全不了解的事实。</span></p><p data-tool="mdnice编辑器">植物能做芯片分析吗？真的之前有人做过植物的芯片分析吗？我发现自己对这些一无所知，于是自己本着学习的心态上网搜索学习了一下。（真是隔行如隔山）</p><p data-tool="mdnice编辑器">又刚好到了每周和大家分享芯片分析流程的时候了，就想着这次能不能找个拟南芥的数据跟大家分享一下。</p><h1 data-tool="mdnice编辑器"><span>找数据集</span></h1><p data-tool="mdnice编辑器">稍微在GEO搜索了一下拟南芥的名字，找到了相关的数据集</p><p data-tool="mdnice编辑器">然后</p><p data-tool="mdnice编辑器">发现了一个出乎我意料的现象~<br></p><p><img data-galleryid="" data-ratio="0.7796803652968036" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8f36y9IO3F69L0EhFD7iaQyTfmMaD2pxv6mPouDbgJ81L5hCcAv1E4XIvFdxBblPRHYuianxlh2TGA/640?wx_fmt=png" data-type="png" data-w="876" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8f36y9IO3F69L0EhFD7iaQyTfmMaD2pxv6mPouDbgJ81L5hCcAv1E4XIvFdxBblPRHYuianxlh2TGA/640?wx_fmt=png"></p><p data-tool="mdnice编辑器">我发现有个拟南芥分析相关的芯片竟然是个双色芯片。</p><p data-tool="mdnice编辑器">我一度以为双色芯片是Agilent公司的专属，这个发现还蛮出乎我意料的。</p><p data-tool="mdnice编辑器">数据集链接：https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE36457</p><p data-tool="mdnice编辑器">芯片如下：<img data-ratio="0.08977035490605428" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMTjMeEiapgKE9JTuvCkJpoS0iagfyYW5F49oliaCCokby4zcXYj52bRZNg/640?wx_fmt=png" data-type="png" data-w="479" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMTjMeEiapgKE9JTuvCkJpoS0iagfyYW5F49oliaCCokby4zcXYj52bRZNg/640?wx_fmt=png">芯片是一张做拟南芥测序的芯片，公司名字叫URGV</p><p data-tool="mdnice编辑器">但我其实还是存疑，不是很相信~</p><p data-tool="mdnice编辑器">emmm，之前分析的时候遇到过一个公司，公司名称是自己的，用的技术是安捷伦的 </p><p data-tool="mdnice编辑器">于是我就猜测有没有可能这个公司用的是Agilent的设备呢？就找到实验操作看了一眼。<img data-ratio="0.4444444444444444" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMtay6kZ691nGKQd76icYuHcCDz8WIu0QxVF63ePLghJLvBePtup939Pg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMtay6kZ691nGKQd76icYuHcCDz8WIu0QxVF63ePLghJLvBePtup939Pg/640?wx_fmt=png"></p><p data-tool="mdnice编辑器">实验流程里面也没有提及到Agilent的名字，这个双色芯片应该和Agilent没有什么太大的关系。</p><p data-tool="mdnice编辑器"><span><strong>那么问题来了，</strong></span>分组信息我可以手敲，ids文件我可以找他公司的官网。但</p><h1 data-tool="mdnice编辑器"><span></span><span>这个公司的原始数据该如何读取？</span><span></span></h1><p data-tool="mdnice编辑器">emmm，先找找别人有没有写过的。</p><h2 data-tool="mdnice编辑器"><span></span><span>通过搜索公司名称找代码</span><span></span></h2><p data-tool="mdnice编辑器">没啥思路，于是就先拿公司名称上网搜了一下。</p><p data-tool="mdnice编辑器">以下图为例，还搜了一些其他的。<img data-ratio="0.9465838509316771" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMhKUXScYkpayDhXMnocscIM4rHsiaxaCGXMnicf0TwUkMicnicL7IADjoMg/640?wx_fmt=png" data-type="png" data-w="805" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMhKUXScYkpayDhXMnocscIM4rHsiaxaCGXMnicf0TwUkMicnicL7IADjoMg/640?wx_fmt=png">额，我感觉搜索引擎的重点放在了芯片数据提取上而不是公司名称上。</p><p data-tool="mdnice编辑器">搜索无果，我寻思这个公司的芯片应用范围应该不是很广泛（相比人类）。</p><p data-tool="mdnice编辑器">这条解决问题的策略可能不太行~</p><p data-tool="mdnice编辑器">嗯，既然公司名搜索不太行，本着R对数据的识别是形式大于内容的态度，我打算先看一眼它原始数据的格式。</p><h2 data-tool="mdnice编辑器"><span></span><span>通过搜索数据类型找代码</span></h2><p data-tool="mdnice编辑器"><img data-ratio="0.16203703703703703" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMg6XnnymxicoxCMYseQFqkEYuVL6ibNzzYY87r2bSRdicka1dBmVSWjhGA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMg6XnnymxicoxCMYseQFqkEYuVL6ibNzzYY87r2bSRdicka1dBmVSWjhGA/640?wx_fmt=png">嗯，有一种叫做gpr的格式。再上网以此为关键词上网搜索一下<img data-ratio="0.9478138222849083" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMRG4ibjfqo4Cxe20NYHfKQ2E51EwUj1YM1IjEe7FM85VwOQTNwasfKcQ/640?wx_fmt=png" data-type="png" data-w="709" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMRG4ibjfqo4Cxe20NYHfKQ2E51EwUj1YM1IjEe7FM85VwOQTNwasfKcQ/640?wx_fmt=png">熟悉的人，陌生的推文~</p><p data-tool="mdnice编辑器">浏览了一下，发现用limma包就能做，我一下就想到了自己之前的推文</p><p data-tool="mdnice编辑器"><span>《</span><span>#真芯简单 No2 Step1 Agilent安捷伦双色芯片数据提取</span><span>》</span><span>https://mp.weixin.qq.com/s/rYqFN2L7-Zv91Ah_J</span><span>wOc4w</span><span></span></p><p data-tool="mdnice编辑器">都是双色果然还是存在联系。</p><p data-tool="mdnice编辑器">照着小洁老师的代码修改了一下之前公众号的代码~ </p><p data-tool="mdnice编辑器">修改的重点只有1个：原始数据读取的部分</p><pre data-tool="mdnice编辑器"><code><span>##公众号原代码</span><br>RawData &lt;- read.maimages(raw_datas,<span>source</span>=<span>"agilent"</span>)<br><span>##现代码</span><br>f &lt;- <span>function</span>(x) as.numeric(x<span>$Flags</span> &gt; -99) <br>RawData &lt;- read.maimages(raw_datas,<span>source</span>=<span>"genepix"</span>, wt.fun= f) <br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>挖一挖修改的代码-genepix参数</span><span></span></h3><p data-tool="mdnice编辑器">猜测genepix应该是扫描芯片的设备名称，因为不同的机器扫描出来的数据有不同的数据构成所以需要limma包用不同的读取策略。</p><p data-tool="mdnice编辑器">在样本介绍界面稍微看了一下，果然如此~<img data-ratio="0.18796296296296297" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMjh8hV6HlgwG1GdpbHXbrXf02xdYywqfOnSFiciaFkibefRI6xjpjzZQjw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMjh8hV6HlgwG1GdpbHXbrXf02xdYywqfOnSFiciaFkibefRI6xjpjzZQjw/640?wx_fmt=png"></p><h3 data-tool="mdnice编辑器"><span></span><span>挖一挖修改的代码-wt.fun= f参数</span><span></span></h3><p data-tool="mdnice编辑器">那么wt.fun= f是什么？f是下面函数的名称。</p><pre data-tool="mdnice编辑器"><code>f &lt;- <span>function</span>(x) as.numeric(x<span>$Flags</span> &gt; -99) <br></code></pre><p data-tool="mdnice编辑器">直接看的话，能看出来这是一个取子集比大小然后数值转换的函数，只能有0(F)和1(T)两种结果。</p><pre data-tool="mdnice编辑器"><code>&gt; as.numeric(T) <br>[1] 1<br>&gt; as.numeric(F) <br>[1] 0<br></code></pre><p data-tool="mdnice编辑器">但是这是干什么的呢？官方解释Rstudio的文件如下<img data-ratio="0.08290155440414508" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMKP6Ld62jnVeLHPVPyZUAl9foibvibFZ7k5lyzRpNSA48YMZxhBxAsVkQ/640?wx_fmt=png" data-type="png" data-w="386" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMKP6Ld62jnVeLHPVPyZUAl9foibvibFZ7k5lyzRpNSA48YMZxhBxAsVkQ/640?wx_fmt=png">只看懂是一个计算点的权重的参数（扶额），<span><strong>没理解呢</strong></span></p><p data-tool="mdnice编辑器">于是又去limma用户手册看了一眼~<img data-ratio="0.34074074074074073" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMymY3DwEoCuMRTZ70iavWDQyfxmt03I02XDHlZJGneswEPR1PcVnibwUw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMymY3DwEoCuMRTZ70iavWDQyfxmt03I02XDHlZJGneswEPR1PcVnibwUw/640?wx_fmt=png">嗯~，应该是利用flags这列设置了一个过滤系统。所以flags在哪里呢？</p><p data-tool="mdnice编辑器">emmmm，就打开原始文档看一眼<img data-ratio="0.26296296296296295" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMQwTmic4fzSsajGxSXc6bc8If1iambxiakxic6lcTVQEDJJ35mYwkb06Odw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMQwTmic4fzSsajGxSXc6bc8If1iambxiakxic6lcTVQEDJJ35mYwkb06Odw/640?wx_fmt=png">发现原始数据的最后一列就叫做flags，然后该列对应的数值有0,-50,-75（没见着-99）,(截图仅为部分)。</p><p data-tool="mdnice编辑器">能猜到这个数值大概和机器扫描时候的某个指标是相关的。所以是什么指标呢？</p><p data-tool="mdnice编辑器">再次回归limma手册<img data-ratio="0.24259259259259258" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMkibB9uaL80K091UjiaUNctF2Ht5CfanZwtmuSWTCcx4qAzbz6naReN2g/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMkibB9uaL80K091UjiaUNctF2Ht5CfanZwtmuSWTCcx4qAzbz6naReN2g/640?wx_fmt=png">原来是标记质量的指标，越负表示问题越大。</p><p data-tool="mdnice编辑器">又再往下稍微浏览了一下<img data-ratio="0.2111111111111111" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMesoAfZnFLodGwWqJZV848HRicpbKXuXWCh6Tohhva20CcPmibiap08VLA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMesoAfZnFLodGwWqJZV848HRicpbKXuXWCh6Tohhva20CcPmibiap08VLA/640?wx_fmt=png"></p><p data-tool="mdnice编辑器">发现这个参数可以按照自己的需求来修改。</p><h3 data-tool="mdnice编辑器"><span></span><span>代码分享</span><span></span></h3><p data-tool="mdnice编辑器">修改完的代码整体展示如下~，</p><pre data-tool="mdnice编辑器"><code>rm(list=ls())<br>options(stringsAsFactors=F)<br>options(warn = -1)<br>library(limma)<br>library(GEOquery)<br>library(dplyr)<br>library(stringr)<br>library(AnnoProbe)<br>library(Biobase)<br><span>#芯片基本信息</span><br>gse_number = <span>"GSE36457"</span><br>gpl_number = <span>"GPL6403"</span><br><br><span>#2-从原始数据获取exp----</span><br><span>#文件需事先解压</span><br>getwd()<span>#注意路径</span><br>raw_dir &lt;- <span>"C:/Users/PC/Desktop/230619_Arabidopsis_thaliana_14_GSE36457_GPL6403_URGV/GSE36457_RAW"</span><br>raw_datas &lt;- paste0(raw_dir,<span>"/"</span>,list.files(raw_dir))<br>raw_order &lt;- str_extract(raw_datas,<span>"GSM\\d*"</span>)<br>f &lt;- <span>function</span>(x) as.numeric(x<span>$Flags</span> &gt; -99)<br>RawData &lt;- read.maimages(raw_datas,<span>source</span>=<span>"genepix"</span>, wt.fun= f) <br><span>#show(RawData)</span><br>RGList=RawData           <span>#①原始数据</span><br>dim(RGList)<br>colnames(RGList)<br>BgCorrect=backgroundCorrect(RGList,method = <span>"normexp"</span>,offset = 50)   <span>#②背景校正</span><br>WithinArrays=normalizeWithinArrays(BgCorrect,method = <span>"loess"</span>)               <span>#③芯片内全局标准化</span><br>BGandNormalized=normalizeBetweenArrays(WithinArrays,method = <span>"Aquantile"</span>)   <span>#④双色芯片间标准化</span><br>MAList=BGandNormalized<br>SampleNames=raw_order<br><span>#exp</span><br>averMAList=avereps(MAList,ID=MAList<span>$genes</span><span>$ProbeName</span>)<br>M=averMAList<span>$M</span><br>exp=exprs.MA(averMAList)<br>row.names(exp)=rownames(averMAList<span>$A</span>)<br>colnames(exp)=paste(rep(SampleNames,each=2),rep(c(<span>"_cy3"</span>,<span>"_cy5"</span>),<span>times</span>=length(exp[1,])/2)) <span>#顺序就是cy3然后cy5</span><br>exp[1:4,1:4]<br>pheatmap::pheatmap(exp[1:4,1:8])<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7235079171741778" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMb8L3PFwufw9p0ghFlkXyibWhrpfTDEhyzazGcdn29pvcKO6fcQL7pwQ/640?wx_fmt=png" data-type="png" data-w="821" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8WyHXoK4Bmo3picuWdaIlSMb8L3PFwufw9p0ghFlkXyibWhrpfTDEhyzazGcdn29pvcKO6fcQL7pwQ/640?wx_fmt=png"></figure><p><br></p><p><strong><span>小结：原来limma包不止可以用来提取双色的Agilent芯片的原始数据，其他的双色芯片也可以提取，并且还可以自行设置过滤的参数~</span></strong></p><p><strong><span><br></span></strong></p><p><strong><span>limma包，牛的！<br></span></strong></p><p><span></span></p><h1 data-tool="mdnice编辑器"><span></span><span>致谢和直播预告</span><span></span></h1><p data-tool="mdnice编辑器">谢谢小洁老师推文，给我这次探索提供了方向，<span>谢谢各位小伙伴的阅读，有芯片相关问题或者使用代码报错的小伙伴欢迎联络</span></p><p data-tool="mdnice编辑器">我的邮箱：tytr666@163.com</p><p data-tool="mdnice编辑器">请附上你的代码、报错的截图以及其他一些你觉得对我解决问题有帮助的信息，顺利的话我将会在明天腾讯会议的时候回答你的问题。</p><p>以下是我之前整理的芯片代码模板，贴给有需要套代码的小伙伴<br></p><p>#真芯简单 No1 Step1 Affymetrix芯片数据提取</p><p>https://mp.weixin.qq.com/s/v374wBsWAM7Itbqab8A5rg</p><p>#真芯简单 No2 Step1 Agilent安捷伦双色芯片数据提取</p><p>https://mp.weixin.qq.com/s/rYqFN2L7-Zv91Ah_JwOc4w</p><p>#真芯简单 No3 Step1 Agilent安捷伦单色芯片数据提取</p><p>https://mp.weixin.qq.com/s/Tc6-gERo1mizSG0-Gf2ciw</p><p>#真芯简单 No4 Step1正常Illumina芯片数据提取-多分组</p><p>https://mp.weixin.qq.com/s/ie3bEgsAzF721foBBb8YPg</p><p>#真芯简单 NO5 Step1 非正常illumina芯片数据提取</p><p>https://mp.weixin.qq.com/s/PdDfyJd4reOyPR0CGIoRgg</p><p><br></p><p>以下是明天会议的链接：</p><p><br></p><p><img data-ratio="1.4431486880466473" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los8f36y9IO3F69L0EhFD7iaQyBQdYAXb0EosLxWRiabArKJuaZepMBcAk2Ic9fUicibzGqViba4zLPkjFmA/640?wx_fmt=jpeg" data-type="jpeg" data-w="686" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los8f36y9IO3F69L0EhFD7iaQyBQdYAXb0EosLxWRiabArKJuaZepMBcAk2Ic9fUicibzGqViba4zLPkjFmA/640?wx_fmt=jpeg"></p></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/XTLeMWGZ6_DuAMl6Uog2rA",target="_blank" rel="noopener noreferrer">原文链接</a>
