---
title: "处理单细胞转录组下游数据遇到的问题及解决办法"
date: 2023-06-03T14:41:28Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
处理单细胞转录组下游数据遇到的问题及解决办法 by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h4 data-tool="mdnice编辑器"><span></span>Question 1<span></span></h4><blockquote data-tool="mdnice编辑器"><p>最近在做一个单细胞转录组测序的数据集的时候。在降维分群后，画dotplot的时候cluster不按照正常的数字排序显示，使用factor对cluster设置levels。</p><p>first_sce.Rdata为做过QC，降维分群和harmony后的数据。</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(clustree)<br><span>library</span>(cowplot)<br><span>library</span>(dplyr)<br><br>dir.create(<span>"./2-markers"</span>)<br>setwd(<span>"./2-markers/"</span>)<br>getwd()<br>load(file = <span>'../1-QC/first_sce.Rdata'</span>) <br><br>sce &lt;- FindClusters(sce, resolution = <span>0.8</span>)<br>DimPlot(sce,reduction = <span>"umap"</span>,label=<span>T</span> )<br><br><span>library</span>(ggplot2) <br>genes_to_check = c(<span>'PTPRC'</span>, <span>'CD3D'</span>, <span>'CD3E'</span>, <br>                   <span>'CD4'</span>,<span>'CD8A'</span>,<span>'CD19'</span>, <span>'CD79A'</span>, <span>'MS4A1'</span>,<br>                   <span>'IGHG1'</span>, <span>'MZB1'</span>, <span>'SDC1'</span>,<br>                   <span>'CD68'</span>, <span>'CD163'</span>, <span>'CD14'</span>, <br>                   <span>'TPSAB1'</span> , <span>'TPSB2'</span>,  <span># mast cells,</span><br>                   <span>'RCVRN'</span>,<span>'FPR1'</span> , <span>'ITGAM'</span> ,<br>                   <span>'C1QA'</span>,  <span>'C1QB'</span>,  <span># mac</span><br>                   <span>'S100A9'</span>, <span>'S100A8'</span>, <span>'MMP19'</span>,<span># monocyte</span><br>                   <span>'LAMP3'</span>, <span>'IDO1'</span>,<span>'IDO2'</span>,<span>## DC3 </span><br>                   <span>'CD1E'</span>,<span>'CD1C'</span>, <span># DC2</span><br>                   <span>'KLRB1'</span>,<span>'NCR1'</span>, <span># NK </span><br>                   <span>'FGF7'</span>,<span>'MME'</span>, <span>'ACTA2'</span>,<br>                   <span>'PECAM1'</span>, <span>'VWF'</span>, <br>                   <span>'DCN'</span>, <span>'LUM'</span>,  <span>'GSN'</span> , <span>## mouse PDAC fibo </span><br>                   <span>'MKI67'</span>,<span>'TOP2A'</span>,<br>                   <span>'EPCAM'</span> , <span>'KRT19'</span>, <span>'PROM1'</span>, <span>'ALDH1A1'</span> )<br><span>library</span>(stringr)  <br><span># str_to_title</span><br><span># str_to_upper()</span><br>genes_to_check=str_to_upper(genes_to_check)<br>genes_to_check<br>p1 &lt;- DotPlot(sce, features = unique(genes_to_check),<br>             assay=<span>'RNA'</span> ,scale = <span>T</span>,<br>             group.by = <span>"RNA_snn_res.0.8"</span> )  + coord_flip()<br><br>p1  <br>ggsave(p1,file=<span>'check_out_cluster_RNA_snn_res.0.8.pdf'</span>,width = <span>14</span>,height = <span>10</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7139938712972421" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9EE2wVrtpfwSEbH3bKwPHJxo1KD1Q0Dqkqo3vyaR6icr1hJGh2Q0bFDhoocdGBFN9kf6utf6RyJeg/640?wx_fmt=png" data-type="png" data-w="979" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9EE2wVrtpfwSEbH3bKwPHJxo1KD1Q0Dqkqo3vyaR6icr1hJGh2Q0bFDhoocdGBFN9kf6utf6RyJeg/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code>My_levels&lt;-c(<span>"0"</span>,<span>"1"</span>,<span>"2"</span>,<span>"3"</span>,<span>"4"</span>,<span>"5"</span>,<span>"6"</span>,<span>"7"</span>,<span>"8"</span>,<span>"9"</span>,<span>"10"</span>,<span>"11"</span>,<span>"12"</span>,<span>"13"</span>,<span>"14"</span>,<span>"15"</span>,<span>"16"</span>,<span>"17"</span>,<span>"18"</span>,<span>"19"</span>,<span>"20"</span>,<span>"21"</span>,<span>"22"</span>,<span>"23"</span>,<span>"24"</span>,<span>"25"</span>,<span>"26"</span>,<span>"27"</span>,<span>"28"</span>,<span>"29"</span>,<span>"30"</span>,<span>"31"</span>)<br>sce$RNA_snn_res.0.8<br>sce$RNA_snn_res.0.8&lt;-factor(sce$RNA_snn_res.0.8,levels= My_levels)<br>sce$RNA_snn_res.0.8<br><br>genes_to_check<br>p1 &lt;- DotPlot(sce, features = unique(genes_to_check),<br>             assay=<span>'RNA'</span> ,scale = <span>T</span>,<br>             group.by = <span>"RNA_snn_res.0.8"</span> )  + coord_flip()<br><br>p1  <br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9386422976501305" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9EE2wVrtpfwSEbH3bKwPHJKwtUPWYAyWvBSoK2SNh9I96xY7gUnO928kzDGlbBdC5pEFWicB8okGw/640?wx_fmt=png" data-type="png" data-w="766" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9EE2wVrtpfwSEbH3bKwPHJKwtUPWYAyWvBSoK2SNh9I96xY7gUnO928kzDGlbBdC5pEFWicB8okGw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">这么看level就正常了。</p><h4 data-tool="mdnice编辑器"><span></span>Question 2<span></span></h4><blockquote data-tool="mdnice编辑器"><p>在跑曾老师scissor算法的代码的时候，遇到了一个报错。</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br><br><span>#devtools::install_github('sunduanchen/Scissor')</span><br><span>library</span>(Seurat)<br><span>library</span>(Scissor)<br>load(<span>'input/scRNA-seq.RData'</span>)<br>load(<span>'input/TCGA_LUAD_exp1.RData'</span>)<br>load(<span>'input/TCGA_LUAD_survival.RData'</span>)<br><br>dim(sc_dataset)<br>sc_dataset &lt;- Seurat_preprocessing(sc_dataset, <br>                                   min.cells = <span>3</span>,<br>                                   min.features = <span>400</span> ,<br>                                   verbose = <span>T</span>)<br>DimPlot(sc_dataset, reduction = <span>'umap'</span>, label = <span>T</span>, label.size = <span>10</span>)<br>sc_dataset<br><br>dim(bulk_dataset)<br>head(bulk_survival)<br>table(colnames(bulk_dataset) == bulk_survival$TCGA_patient_barcode) <span>#确认生存数据的样本顺序是和表达矩阵一致的</span><br>phenotype &lt;- bulk_survival[,<span>2</span>:<span>3</span>]<br>colnames(phenotype) &lt;- c(<span>"time"</span>, <span>"status"</span>)<br>head(phenotype)<span>#</span><br>identical(colnames(bulk_dataset) ,row.names(phenotype))<br>row.names(phenotype) = colnames(bulk_dataset)<br><br><span># 数据有56716个基因， 471个样本。</span><br><span># 执行Scissor算法，对细胞进行分类</span><br>infos1 &lt;- Scissor(bulk_dataset, sc_dataset, phenotype, alpha = <span>0.05</span>, <br>                  family = <span>"cox"</span>, Save_file = <span>'Scissor_LUAD_survival.RData'</span>)<br><br><span>#Error in normalize.quantiles(dataset0) : ERROR; return code from pthread_create() is 22</span><br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.1907051282051282" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9EE2wVrtpfwSEbH3bKwPHJzLP3kB7sMVy5JiaVicDyJltPObkKB9tgANdEc6jzxJUygS7MrkOmeLWw/640?wx_fmt=png" data-type="png" data-w="624" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9EE2wVrtpfwSEbH3bKwPHJzLP3kB7sMVy5JiaVicDyJltPObkKB9tgANdEc6jzxJUygS7MrkOmeLWw/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><p>在小郭老师和永杰的帮助下了解到这个报错是由于一个R包的问题，才造成scissor分析计算的时候报错。</p></blockquote><p data-tool="mdnice编辑器">解决方法：</p><p data-tool="mdnice编辑器">https://github.com/sunduanchen/Scissor/issues/15</p><pre data-tool="mdnice编辑器"><span></span><code><span>#使用这个代码，重新安装 preprocessCore </span><br>BiocManager::install(<span>"preprocessCore"</span>, configure.args=<span>"--disable-threading"</span>, force = <span>TRUE</span>)<br><span>#重启Rstudio 或者退出</span><br><span>#重新加载R包运行</span><br></code></pre><p data-tool="mdnice编辑器">这样就成功解决了问题，后续代码可以运行了~</p></section><section><p><br></p><section data-style-type="5" data-tools="新媒体排版" data-id="2440476"><section><section><section><section><img data-ratio="0.9495798319327731" data-src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif" data-type="gif" data-w="119" data-width="100%" src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif"></section><section data-brushtype="text">往期回顾</section><section><br></section></section></section></section><section><section data-autoskip="1"><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247513220&amp;idx=1&amp;sn=922e92c0d1f3ee2e9a704dcddbc30d63&amp;chksm=ea1cb206dd6b3b10c29302b8f2f5095fe00960d84d1a68eec28275b6d8832bcf865d2c37b09b&amp;scene=21#wechat_redirect" textvalue="单细胞转录组揭示了Semaglutide对肥胖小鼠非心肌细胞的影响" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">单细胞转录组揭示了Semaglutide对肥胖小鼠非心肌细胞的影响</a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247513202&amp;idx=1&amp;sn=3f8a4947cce8596f454fb82090f599e0&amp;chksm=ea1cb2f0dd6b3be68237d48393e535a8399b9e0e8a091dcc225b3bce2100c6fc4d31a0fd027b&amp;scene=21#wechat_redirect" textvalue="手把手带你复现NC图表之Figure 2" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">手把手带你复现NC图表之Figure 2</a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247513143&amp;idx=1&amp;sn=ac15652a0d046d28330676994ff7b1d3&amp;chksm=ea1cb2b5dd6b3ba3c5ea3836fa531a78f40ac0983dcb3f20e9b7027850a1664f536662b94b3f&amp;scene=21#wechat_redirect" textvalue="单细胞基因集合打分方法-08-UCell包-算法" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">单细胞基因集合打分方法-08-UCell包-算法</a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247513107&amp;idx=1&amp;sn=7b623fd2697efca6e0c67545d5f4c763&amp;chksm=ea1cb291dd6b3b8727f6ceac30d0bcf62397c696665be861e526c45d91cef478b6a0d49e851b&amp;scene=21#wechat_redirect" textvalue="细胞互作中的“avoidance ”是什么？" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">细胞互作中的“avoidance ”是什么？</a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247512995&amp;idx=1&amp;sn=edbebc945e1de8d0e8e09e9aa4d1ced2&amp;chksm=ea1cb521dd6b3c370ad791e86dbbad69c4199279b555bcf70028d552f48188162a9cb229e5b9&amp;scene=21#wechat_redirect" textvalue="bollito—单细胞转录组的流程化工具" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">bollito—单细胞转录组的流程化工具</a><br></p></section></section><hr><p><br></p></section><section data-style-type="5" data-tools="新媒体排版" data-id="2440475"><hr><p><br></p><hr><section><p>如果你对单细胞转录组研究感兴趣，但又不知道如何入门，也许你可以关注一下下面的课程<span></span></p><p><br></p><ul><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247522216&amp;idx=1&amp;sn=7e8a61383489f4a2c68172c4c436fa83&amp;chksm=9b4bd713ac3c5e0525da8dc1d038854366c4ad643396d3ee67f1e8a117c3657530043dda1b8d&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课6月班" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信入门&amp;数据挖掘线上直播课6月班</a><br></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=2&amp;sn=6cb33654c7751f4c3df0f84743f77aaf&amp;chksm=9b4bceaeac3c47b8899afc00077b96357b87a4ed6b75e7c434ba14071fd6c8448e4c218de5e0&amp;scene=21#wechat_redirect" textvalue="144线程640Gb内存服务器共享一年仍然是仅需800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">144线程640Gb内存服务器共享一年仍然是仅需800</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">千呼万唤始出来的独享生物信息学云服务器</a></p></li></ul><p><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif" data-type="gif" data-w="240" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif"><br></p><p><img data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg" data-type="other" data-w="341" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p></section><section><section data-id="93668"><section><section data-width="95%"><section><section><section data-width="38%"><section><section data-tools="135编辑器" data-id="93668"><section><section data-width="95%"><section><section><section data-width="61.8%"><section><section><section><p><br></p><span><strong data-burshtype="text"><img data-copyright="0" data-cropselx1="0" data-cropselx2="109" data-cropsely1="0" data-cropsely2="109" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg" data-type="other" data-w="258" title="qrcode_for_gh_5a3c482ed99f_1280.jpg" src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg"><strong data-burshtype="text">生物</strong><strong data-burshtype="text"> | 单细胞 | 转录组丨资料</strong></strong></span></section><section><span><strong data-burshtype="text">每天都精彩</strong></span></section></section></section><section><section><section><section><section><section><p><span>长按扫码可关注</span></p></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/J8ia22UIHkD-AIK6JnIk-A",target="_blank" rel="noopener noreferrer">原文链接</a>
