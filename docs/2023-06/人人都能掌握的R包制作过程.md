---
title: "人人都能掌握的R包制作过程"
date: 2023-06-08T02:41:17Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
人人都能掌握的R包制作过程 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><blockquote data-tool="mdnice编辑器"><section data-mpa-template="t" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><p data-mid="">健康贴士</p></section></section></section></section><p><span>本节来介绍如何封装函数制作R包，非常的简单粗暴；从此每个小伙伴都可以制作一个自己专属的R包；扫描文末二维码加入我的交流群更多精彩内容为您而准备<br></span></p></blockquote><h4 data-tool="mdnice编辑器"><span>第一步(编写函数)</span></h4><blockquote data-tool="mdnice编辑器"><p><span>下面这段代码定义了一个颜色卡与2个函数，这就是我们这个简单R包的主要内容,将其保存命名为<strong>work.R</strong></span></p></blockquote><pre data-tool="mdnice编辑器"><code>colors &lt;- c(<span>"#E41A1C"</span>,<span>"#1E90FF"</span>,<span>"#FF8C00"</span>,<span>"#4DAF4A"</span>,<span>"#984EA3"</span>,<br>            <span>"#40E0D0"</span>,<span>"#FFC0CB"</span>,<span>"#00BFFF"</span>,<span>"#FFDEAD"</span>,<span>"#90EE90"</span>,<br>            <span>"#EE82EE"</span>,<span>"#00FFFF"</span>,<span>"#F0A3FF"</span>, <span>"#0075DC"</span>, <br>            <span>"#993F00"</span>,<span>"#4C005C"</span>,<span>"#2BCE48"</span>,<span>"#FFCC99"</span>,<br>            <span>"#808080"</span>,<span>"#94FFB5"</span>,<span>"#8F7C00"</span>,<span>"#9DCC00"</span>,<br>            <span>"#C20088"</span>,<span>"#003380"</span>,<span>"#FFA405"</span>,<span>"#FFA8BB"</span>,<br>            <span>"#426600"</span>,<span>"#FF0010"</span>,<span>"#5EF1F2"</span>,<span>"#00998F"</span>,<br>            <span>"#740AFF"</span>,<span>"#990000"</span>,<span>"#FFFF00"</span>)<br><br>otu_filter &lt;- <span>function</span>(path) {<br>  group &lt;- read.delim(<span>"group.xls"</span>)<br>  data &lt;- path %&gt;%<br>    read.delim(check.names = FALSE,row.names = 1)<br>  data2 &lt;- data %&gt;%<br>    mutate(sum = rowSums(.), persent = sum / sum(sum) * 100, <br>           sum = NULL,) %&gt;%<br>    rbind(filter(., persent &lt; 1) %&gt;% colSums()) %&gt;%<br>    mutate(OTU = c(data %&gt;% rownames(), <span>"others"</span>))<br>  filter(data2[1:(nrow(data2) - 1),], persent &gt; 1) %&gt;%<br>    rbind(data2[nrow(data2),]) %&gt;%<br>    select(ncol(.), 1:(ncol(.) - 2)) %&gt;%<br>    set_rownames(seq_len(nrow(.))) %&gt;% <br>    pivot_longer(- OTU) %&gt;% rename(.,sample=name) %&gt;%<br>    inner_join(.,group,by=<span>"sample"</span>) %&gt;% <br>    <span>return</span>()<br>}<br><br>ggbar &lt;- <span>function</span>(data,mapping) {<br>  ggplot(data,mapping=aes(sample,value,fill=OTU))+<br>    geom_bar(<span>stat</span>=<span>"identity"</span>,position=<span>"fill"</span>)+<br>    facet_grid(. ~ group,scales = <span>"free"</span>,space=<span>"free_x"</span>)+<br>    scale_fill_manual(values = colors)+<br>    scale_y_continuous(expand=c(0,0))+theme_bw()+<br>    labs(x=NULL,y=NULL,fill=<span>""</span>)+<br>    theme(panel.spacing.x = unit(0.03,<span>"cm"</span>),<br>          axis.text.x=element_text(angle=0,size=10,<br>                                   vjust = 0.5,hjust=0.5),<br>          axis.text.y=element_text(size=10),<br>          plot.margin=unit(c(0.5,0.5,0.5,0.5),units=,<span>"cm"</span>))<br>}<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.42630651790957136" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WYA4TaAPJMx1u79HybBeG3SrYdU1TfSLMwfFWHhiblbAghcSKQYIzShJQ/640?wx_fmt=png" data-type="png" data-w="1703" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WYA4TaAPJMx1u79HybBeG3SrYdU1TfSLMwfFWHhiblbAghcSKQYIzShJQ/640?wx_fmt=png"></figure><h4 data-tool="mdnice编辑器"><span>第二步(构建R包)</span></h4><blockquote data-tool="mdnice编辑器"><p><span>打开<strong>Rstudio</strong>使用R自带的函数构建R包，<strong>name</strong>命名包名，<strong>code_files</strong>写入R脚本路径，执行下面的代码 (注:写入自己的路径)</span></p></blockquote><pre data-tool="mdnice编辑器"><code>package.skeleton(name=<span>"ggtool"</span>,code_files=<span>"work.R"</span>)<br></code></pre><blockquote data-tool="mdnice编辑器"><p><span>可以看到多了一个ggtool文件夹，这就是我们构建的R包</span></p></blockquote><figure data-tool="mdnice编辑器"><img data-ratio="0.29291154071470415" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WYrVicIEdGicyqicZURQ6weevR4eWO2R937nR6aZoImY2khG8QQAx3km64Q/640?wx_fmt=png" data-type="png" data-w="1707" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WYrVicIEdGicyqicZURQ6weevR4eWO2R937nR6aZoImY2khG8QQAx3km64Q/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器"><span>文件夹内包含如下信息，里面可以修改作者信息等一系列内容，可以自己多看看</span></p><figure data-tool="mdnice编辑器"><img data-ratio="0.2614023144996596" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WYplQiboxI0mkv9wkiceicTus0vMvDoeEpicHdZfVE2tY4ooK0CepPfw6Stg/640?wx_fmt=png" data-type="png" data-w="1469" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WYplQiboxI0mkv9wkiceicTus0vMvDoeEpicHdZfVE2tY4ooK0CepPfw6Stg/640?wx_fmt=png"></figure><ul data-tool="mdnice编辑器"><li><section><span>注:此处要修改man文件夹里面Rd文件的<strong>title</strong>,一定要修改否则打包会不成功的</span></section></li></ul><figure data-tool="mdnice编辑器"><img data-ratio="0.39404255319148934" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WYdHugBVmt5SoWQaAI2uXGKeJwlcT6wQ21Bu0rTQEB01pwA2cjkaDe5g/640?wx_fmt=png" data-type="png" data-w="1175" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WYdHugBVmt5SoWQaAI2uXGKeJwlcT6wQ21Bu0rTQEB01pwA2cjkaDe5g/640?wx_fmt=png"></figure><h4 data-tool="mdnice编辑器"><span>第三步(封装R包)</span></h4><p data-tool="mdnice编辑器"><span>打开终端执行如下命令即可,执行完可以看到出来一个压缩包，这就是我们要的R包</span></p><pre data-tool="mdnice编辑器"><code>R CMD build ggtool <br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.29188869153345176" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WYxibiag3q2WtFFAX0fEQicazydVyDUyqt9m3JjqJ9MdELmFukb37weGyBA/640?wx_fmt=png" data-type="png" data-w="1689" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WYxibiag3q2WtFFAX0fEQicazydVyDUyqt9m3JjqJ9MdELmFukb37weGyBA/640?wx_fmt=png"></figure><h4 data-tool="mdnice编辑器"><span>第四步(安装R包)</span></h4><p data-tool="mdnice编辑器"><span>本地安装即可</span><img data-ratio="0.2713780918727915" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WYTaNeux6IZQnGHWXFgGT7jJQTt4IQfpPuTEmBjiccLdJwhcSvvZNw2gw/640?wx_fmt=png" data-type="png" data-w="1415" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WYTaNeux6IZQnGHWXFgGT7jJQTt4IQfpPuTEmBjiccLdJwhcSvvZNw2gw/640?wx_fmt=png"></p><h4 data-tool="mdnice编辑器"><span>第五步(数据测试)</span></h4><p data-tool="mdnice编辑器"><span><strong>genus.xls</strong> &amp; <strong>group.xls</strong>为我们的测试文件</span></p><figure data-tool="mdnice编辑器"><img data-ratio="0.23131253678634492" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WY76C2Kt6YRZRKJQt12vZ3VOsGPOfm9guuY2ZSbYCbtPbicjRxTZcjLCA/640?wx_fmt=png" data-type="png" data-w="1699" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WY76C2Kt6YRZRKJQt12vZ3VOsGPOfm9guuY2ZSbYCbtPbicjRxTZcjLCA/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器"><span>执行如下命令即可生成下图</span></p><pre data-tool="mdnice编辑器"><code>library(tidyverse)<br>library(magrittr)<br>library(ggtool)<br><br>otu_filter(<span>"genus.xls"</span>) %&gt;% ggbar()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5860655737704918" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WYnJwOQIT3iboJBPNuqESyibEW0rO1ric7BeXvqC1pXTm7y1B8OejSbzRKQ/640?wx_fmt=png" data-type="png" data-w="732" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYkkYkR8Df4oRo1EM64X4WYnJwOQIT3iboJBPNuqESyibEW0rO1ric7BeXvqC1pXTm7y1B8OejSbzRKQ/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><p><span>后台回复<strong>20210822</strong>获取2个测试数据</span></p></blockquote><hr data-tool="mdnice编辑器"></section><p><img data-galleryid="" data-ratio="1.4182692307692308" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbK2IKoIiapgDMDkIZvnrbQ7VpkWvSXJKTVwncOmGF2bPuwWSMo2S4LKXt81Pibiap2rLtvnIibMZnkng/640?wx_fmt=png" data-type="png" data-w="416" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbK2IKoIiapgDMDkIZvnrbQ7VpkWvSXJKTVwncOmGF2bPuwWSMo2S4LKXt81Pibiap2rLtvnIibMZnkng/640?wx_fmt=png"></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><span><strong>小编微信</strong></span></section><p><img data-galleryid="" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbqBerVicDuN24tgM9vnXwXia7YOiaymyDXAM2tDGjULFnHrkSCaggjeZOcC5oZUHLYmH02e8cm3D85Q/640?wx_fmt=jpeg" data-type="jpeg" data-w="430" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbqBerVicDuN24tgM9vnXwXia7YOiaymyDXAM2tDGjULFnHrkSCaggjeZOcC5oZUHLYmH02e8cm3D85Q/640?wx_fmt=jpeg"></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><span>关注下方公众号，获取更多优质资源，如需要加入微信交流群，请在菜单栏处添加作者微信，即可邀您进群</span></p><section><mpprofile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0"></mpprofile></section></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/soPG_ull0vB6Q8zOuOB5Fw",target="_blank" rel="noopener noreferrer">原文链接</a>
