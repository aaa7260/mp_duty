---
title: "NetworkD3三步绘制优雅可交互桑基图！高分必备！"
date: 2022-09-04T13:23:47Z
draft: ["false"]
tags: [
  "fetched",
  "SCIPainter"
]
categories: ["Acdemic"]
---
NetworkD3三步绘制优雅可交互桑基图！高分必备！ by SCIPainter
------
<div><section data-mpa-powered-by="yiban.io"><span>关于桑基图或冲击图，往期我们已分享了许多教程，这里不再赘述介绍，大家可戳往期：</span><br></section><section><br></section><section><span>基于R语言：</span></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA5NzQzOTgzMw==&amp;mid=2650838980&amp;idx=1&amp;sn=408c1708c1346845c37d26af1e6c7129&amp;chksm=8b54eef2bc2367e420ae15f2bc28a873f4ad8c88b0350930d644036e04671bf90c3202de35a7&amp;scene=21#wechat_redirect" textvalue="《如何用ggalluvial绘制ceRNA网络图？》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>《如何用ggalluvial绘制ceRNA网络图？》</span></a><span></span></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA5NzQzOTgzMw==&amp;mid=2650925433&amp;idx=1&amp;sn=7c84a6f9e2f084e5fa69163b7aab1412&amp;chksm=8b55904fbc221959af8cf27d3390cc6c0174924aefdbfa6693c83dbc140d167b9e9f5e5be225&amp;scene=21#wechat_redirect" textvalue="《如何绘制让Nature编辑心动的环状桑基图？》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>《如何绘制让Nature编辑心动的环状桑基图？》</span></a><span></span></section><section><br></section><section><span>基于Origin：</span></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA5NzQzOTgzMw==&amp;mid=2650835119&amp;idx=1&amp;sn=1fddd6b415dfcf77cace2ac28813124e&amp;chksm=8b54f199bc23788f7b2a0ed9ba9243ab40b31e0e68dad1d72fbe2b599cc3d191d4c853012c06&amp;scene=21#wechat_redirect" textvalue="《绘制这种漂亮的桑基图只需“一步”？》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>《绘制这种漂亮的桑基图只需“一步”？》</span></a><span></span></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA5NzQzOTgzMw==&amp;mid=2650837489&amp;idx=1&amp;sn=1eb14ce2641f78fefea3ba757a6c826d&amp;chksm=8b54e8c7bc2361d15aca997507d49d327b190ee5bf2667c2f3a895ddc5313baa3f8eaaa2a42e&amp;scene=21#wechat_redirect" textvalue="《3分文章和30分文章图表差在哪里？》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>《3分文章和30分文章图表差在哪里？》</span></a><span></span></section><section><br></section><section><span>基于OmicShare（无需代码，最简单灵活、交互性最强）：</span></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA5NzQzOTgzMw==&amp;mid=2650889974&amp;idx=1&amp;sn=c2122a6cccb958f9a8380b0d57e0422f&amp;chksm=8b5527c0bc22aed6cd64ffe6c1161407f7fea81bf16db983e94c66f4998c8aa2080fcadadc25&amp;scene=21#wechat_redirect" textvalue="《大佬们都在用的桑基图，我找到了最简单的作图方法》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>《大佬们都在用的桑基图，我找到了最简单的作图方法》</span></a><span></span></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA5NzQzOTgzMw==&amp;mid=2650923606&amp;idx=1&amp;sn=db97a96f7ffa24eae76731cf39c59b40&amp;chksm=8b559b60bc221276b41f6db91c3c10bbf1256b64095f0ae5494d7cd99ad2fe081e8a24566cc3&amp;scene=21#wechat_redirect" textvalue="《你的论文中还缺一张“NB闪闪”的美图？》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>《你的论文中还缺一张“NB闪闪”的美图？》</span></a><span></span></section><section><br></section><section><span>使用详解：</span></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA5NzQzOTgzMw==&amp;mid=2650858833&amp;idx=1&amp;sn=8535b793cc83cf339072b1a2bbd147dc&amp;chksm=8b549c67bc23157186ef724b923a89bcdcd5aed48986ce0096097413da309f8e9d00812d4391&amp;scene=21#wechat_redirect" textvalue="《生信分析中的桑基图应用实例及绘制方法》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>《生信分析中的桑基图应用实例及绘制方法》</span></a><span></span></section><section><br></section><section data-role="splitline" data-tools="135编辑器" data-id="117092"><section><section><section><section><section><br></section></section><section data-width="100%"><section data-width="90%"><br></section></section></section><section><section data-width="100%"><section data-width="90%"><br></section></section><section><section><br></section></section></section></section></section></section><section><br></section><section><span>R中以往的方法不能实现交互，今天介绍一种使用</span><span><strong>NetworkD3</strong></span><span>绘制可交互桑基图的方法，使用三个步骤即可完美出图！</span></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#相关R包载入：</span><br mpa-from-tpl="t"><span>library</span>(networkD3)<br mpa-from-tpl="t"><span>library</span>(dplyr)<br mpa-from-tpl="t"><span>library</span>(tidyr)<br mpa-from-tpl="t"><span>library</span>(stringr)<br mpa-from-tpl="t"><span>library</span>(tibble)</code></pre></section><p><br></p><section data-mpa-template="t" mpa-from-tpl="t"><section data-mpa-template="t" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><img data-ratio="0.7727272727272727" data-w="44" data-src="https://mmbiz.qpic.cn/mmbiz_png/5oRW9lsb6kGZZoW8EXVJJwAAGrU1M8G7ukibFerB7ChdrHOrf9QXxFIRPK7nxTm7wZWQUpBU4ib5Kjib0EHTIMugQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/5oRW9lsb6kGZZoW8EXVJJwAAGrU1M8G7ukibFerB7ChdrHOrf9QXxFIRPK7nxTm7wZWQUpBU4ib5Kjib0EHTIMugQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section mpa-from-tpl="t"><span><strong mpa-from-tpl="t"><span>范例一：随机数据测试</span></strong></span></section></section></section><section data-mid="" mpa-from-tpl="t"><img data-ratio="0.90625" data-w="64" data-src="https://mmbiz.qpic.cn/mmbiz_png/UoD3pAqsgaxWJRiaGk1WZ0R07SL619UBic62Vwic8GhibQLYvuDquEKCUL8dpiau7vkHUXqbJnVN9XF4SOsWbyqcGbw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/UoD3pAqsgaxWJRiaGk1WZ0R07SL619UBic62Vwic8GhibQLYvuDquEKCUL8dpiau7vkHUXqbJnVN9XF4SOsWbyqcGbw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section></section></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#创建测试数据(source、target和value三列)：</span><br mpa-from-tpl="t"><span>links</span> &lt;- data.frame(<br mpa-from-tpl="t"><span>source</span>=c(<span>"gene_A"</span>,<span>"gene_A"</span>, <span>"gene_B"</span>, <span>"gene_C"</span>, <span>"gene_C"</span>, <span>"gene_E"</span>),<br mpa-from-tpl="t"><span>target</span>=c(<span>"gene_C"</span>,<span>"gene_D"</span>, <span>"gene_E"</span>, <span>"gene_F"</span>, <span>"gene_G"</span>, <span>"gene_H"</span>),<br mpa-from-tpl="t"><span>value</span>=c(1,3, 2, 3, 1, 2)<br mpa-from-tpl="t">)<br mpa-from-tpl="t"><span>head</span>(links)</code></pre></section><p><br></p><section><img data-ratio="0.2468354430379747" data-type="png" data-w="948" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykVicJG2MBuDwrWGK4xib22hXEwPriauSS9UvW8X9SduUrHa7ibLbGDYvHSQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykVicJG2MBuDwrWGK4xib22hXEwPriauSS9UvW8X9SduUrHa7ibLbGDYvHSQ/640?wx_fmt=png"></section><section><br></section><section><span>上述即为该包绘图所需的</span><span><strong>长数据</strong></span><span>格式，共需要3列，来源列（source）、目标列（target）和数值列（value）。绘图条带从source流向target，value对应条带的宽度，若没有对应数据，将value全部指定为1即可。</span></section><section><br></section><p><span>下面开始绘图三步曲：</span></p><section><section powered-by="xiumi.us"><section><p><span>  //  </span></p></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p><span>1. Step1：</span><span>创建节点（</span><span>nodes）数据框</span><span></span></p></section></section></section></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#将source和target两列中涉及的所有点/元素取并集</span><br mpa-from-tpl="t"><span>nodes</span> &lt;- data.frame(name = c(as.character(links$source),<br mpa-from-tpl="t"><span>as</span>.character(links$target)) %&gt;% unique()) <span>#unique去重</span><br mpa-from-tpl="t"><span>head</span>(nodes)</code></pre></section><p><br></p><p><img data-ratio="0.2468354430379747" data-type="png" data-w="948" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykm7DaJoXLSLFT1vR0eDpLtLeTgic0Ny8jKiaGAjtsNG6a9NticppwvzHBw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykm7DaJoXLSLFT1vR0eDpLtLeTgic0Ny8jKiaGAjtsNG6a9NticppwvzHBw/640?wx_fmt=png"></p><section><section powered-by="xiumi.us"><section><p><span>  //  </span></p></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p><span>2. Step2：</span><span>创建source和target列对应ID</span><span></span></p></section></section></section></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#由于在networkD3中，绘图所需的source和target无法识别原本的名称标签，需要将其转换为可识别的数字ID，从0开始索引</span><br mpa-from-tpl="t"><span>links</span>$IDsource &lt;- match(links$source, nodes$name) -1 <span>#ID必须从0开始索引，所以统一减去1</span><br mpa-from-tpl="t"><span>links</span>$IDtarget &lt;- match(links$target, nodes$name) -1<br mpa-from-tpl="t"><span>head</span>(links)</code></pre></section><p><br></p><p><img data-ratio="0.2468354430379747" data-type="png" data-w="948" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykc1cicu3wOB03tyzmUTnPAUgiaI1HmiaLXnwhpkcSSeFLbDmMvSvNKIL6Q/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykc1cicu3wOB03tyzmUTnPAUgiaI1HmiaLXnwhpkcSSeFLbDmMvSvNKIL6Q/640?wx_fmt=png"></p><section><section powered-by="xiumi.us"><section><p><span>  //  </span></p></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p><span>3. Step3：绘制桑基图</span></p></section></section></section></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>p</span> &lt;- sankeyNetwork(Links = links, <span>#含有nodes(即source和target)连接信息和value值的数据框</span><br mpa-from-tpl="t"><span>Nodes</span> = nodes,<span> #含有nodes属性的数据框</span><br mpa-from-tpl="t"><span>Source</span> = <span>"IDsource"</span>, #sourceID<br mpa-from-tpl="t"><span>Target</span> = <span>"IDtarget"</span>, #targetID<br mpa-from-tpl="t"><span>Value</span> = <span>"value"</span>,<br mpa-from-tpl="t"><span>NodeID</span> = <span>"name"</span>,<br mpa-from-tpl="t"><span>sinksRight</span> = T) <span>#布尔值，若为T，则将最后一个节点移动到绘图的右边界</span><br mpa-from-tpl="t"><span>p</span></code></pre></section><p><br></p><section><img data-ratio="0.7419354838709677" data-type="png" data-w="806" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykbrkamoAX73pBfGhNHvjKzPucibNibceRShEbPT89ow4BD1CkluUfTaZQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykbrkamoAX73pBfGhNHvjKzPucibNibceRShEbPT89ow4BD1CkluUfTaZQ/640?wx_fmt=png"></section><section><br></section><section><span>桑基图就绘制好啦！如果样式不满意，可交互页面支持我们拖拽调整：</span></section><section><br></section><section><img data-ratio="0.9548022598870056" data-type="gif" data-w="1062" data-src="https://mmbiz.qpic.cn/mmbiz_gif/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykDDia4AsVibngYIicM1pJguYgcHm1Sg9WMHbG20JmbPgY6OxZpyDlmR3ug/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/mmbiz_gif/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykDDia4AsVibngYIicM1pJguYgcHm1Sg9WMHbG20JmbPgY6OxZpyDlmR3ug/640?wx_fmt=gif"></section><section><br></section><section><span>现在我们借用一下实际数据，来巩固一下三部曲内容：</span></section><section><span><br mpa-from-tpl="t"></span></section><section data-mpa-template="t" mpa-from-tpl="t"><section data-mpa-template="t" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><img data-ratio="0.7727272727272727" data-w="44" data-src="https://mmbiz.qpic.cn/mmbiz_png/5oRW9lsb6kGZZoW8EXVJJwAAGrU1M8G7ukibFerB7ChdrHOrf9QXxFIRPK7nxTm7wZWQUpBU4ib5Kjib0EHTIMugQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/5oRW9lsb6kGZZoW8EXVJJwAAGrU1M8G7ukibFerB7ChdrHOrf9QXxFIRPK7nxTm7wZWQUpBU4ib5Kjib0EHTIMugQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section mpa-from-tpl="t"><span><strong mpa-from-tpl="t"><span>范例二：不同国家人口的迁移情况</span></strong></span></section></section></section><section data-mid="" mpa-from-tpl="t"><img data-ratio="0.90625" data-w="64" data-src="https://mmbiz.qpic.cn/mmbiz_png/UoD3pAqsgaxWJRiaGk1WZ0R07SL619UBic62Vwic8GhibQLYvuDquEKCUL8dpiau7vkHUXqbJnVN9XF4SOsWbyqcGbw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/UoD3pAqsgaxWJRiaGk1WZ0R07SL619UBic62Vwic8GhibQLYvuDquEKCUL8dpiau7vkHUXqbJnVN9XF4SOsWbyqcGbw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section></section></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#载入本地数据：</span><br mpa-from-tpl="t"><span>df</span> &lt;- read.csv('Migration.csv',header = T,row.names = 1)<br mpa-from-tpl="t"><span>head</span>(df) <span>#数据来自不同国家间人口迁移情况</span></code></pre></section><p><br></p><section><img data-ratio="0.36810344827586206" data-type="png" data-w="1160" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykoSDBUiaCpq5cpLHDDx7FLERomwiaHNdkYlKicmuPtZJsic98cYHulfQibrQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykoSDBUiaCpq5cpLHDDx7FLERomwiaHNdkYlKicmuPtZJsic98cYHulfQibrQ/640?wx_fmt=png"></section><section><br></section><section><span>这里由于是宽数据，我们先做一个长宽数据转换：</span></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#宽数据→长数据：</span><br mpa-from-tpl="t"><span>links</span> &lt;- df %&gt;%<br mpa-from-tpl="t"><span>rownames_to_column</span> %&gt;%<br mpa-from-tpl="t"><span>gather</span>(key = 'key', value = 'value', -rowname) %&gt;%<br mpa-from-tpl="t"><span>filter</span>(value &gt; 0)<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>colnames</span>(links) &lt;- c(<span>"source"</span>, <span>"target"</span>, <span>"value"</span>) <span>#三列进行重新命名</span><br mpa-from-tpl="t"><span>links</span>$target &lt;- paste(links$target, <span>" "</span>, sep=<span>""</span>)<br mpa-from-tpl="t"><span>head</span>(links)</code></pre></section><p><br></p><section><img data-ratio="0.19913793103448277" data-type="png" data-w="1160" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCByktSfPiafd2fRsXRw1LNAAVdNt5IScv6Xy7aqibIxVxTTlZP8Ot2Jf2S3w/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCByktSfPiafd2fRsXRw1LNAAVdNt5IScv6Xy7aqibIxVxTTlZP8Ot2Jf2S3w/640?wx_fmt=png"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#重复三步走即可：</span><br mpa-from-tpl="t"><span>#创建nodes：</span><br mpa-from-tpl="t"><span>nodes</span> &lt;- data.frame(name = c(as.character(links$source),<br mpa-from-tpl="t"><span>as</span>.character(links$target)) %&gt;% unique())<br mpa-from-tpl="t"><span>head</span>(nodes)</code></pre></section><p><br></p><section><img data-ratio="0.19913793103448277" data-type="png" data-w="1160" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykIKy745r7TiakVgMYIEMCAlCpSHIXgiaiaTMV5VGFBX3lnQOAO6LRNiac6Q/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykIKy745r7TiakVgMYIEMCAlCpSHIXgiaiaTMV5VGFBX3lnQOAO6LRNiac6Q/640?wx_fmt=png"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#创建ID：</span><br mpa-from-tpl="t"><span>links</span>$IDsource = match(links$source, nodes$name)-1<br mpa-from-tpl="t"><span>links</span>$IDtarget = match(links$target, nodes$name)-1<br mpa-from-tpl="t"><span>head</span>(links)</code></pre></section><p><br></p><section><img data-ratio="0.19913793103448277" data-type="png" data-w="1160" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykjz9K54NTNSA27vyOPjapMG9sCJKGBR3whWg5NUpDegeZibhdAA9BnBg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykjz9K54NTNSA27vyOPjapMG9sCJKGBR3whWg5NUpDegeZibhdAA9BnBg/640?wx_fmt=png"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#绘图：</span><br mpa-from-tpl="t"><span>p1</span> &lt;- sankeyNetwork(Links = links,<br mpa-from-tpl="t"><span>Nodes</span> = nodes,<br mpa-from-tpl="t"><span>Source</span> = <span>"IDsource"</span>,<br mpa-from-tpl="t"><span>Target</span> = <span>"IDtarget"</span>,<br mpa-from-tpl="t"><span>Value</span> = <span>"value"</span>,<br mpa-from-tpl="t"><span>NodeID</span> = <span>"name"</span>,<br mpa-from-tpl="t"><span>sinksRight</span> = FALSE,<br mpa-from-tpl="t"><span>nodeWidth</span> = 30, <span>#节点格子宽度</span><br mpa-from-tpl="t"><span>fontSize</span> = 13, <span>#文本标签字体的大小</span><br mpa-from-tpl="t"><span>nodePadding</span> = 20) <span>#节点格子间空隙宽度</span><br mpa-from-tpl="t"><span>p1</span></code></pre></section><p><br></p><section><img data-ratio="0.942741935483871" data-type="png" data-w="1240" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykSDXtHRwCSdEvrbWEnzH79JkHVib1J99BqkmeC6rJdlxw1CDGdia81GXg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykSDXtHRwCSdEvrbWEnzH79JkHVib1J99BqkmeC6rJdlxw1CDGdia81GXg/640?wx_fmt=png"></section><section><br></section><section data-mpa-template="t" mpa-from-tpl="t"><section data-mpa-template="t" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><img data-ratio="0.7727272727272727" data-w="44" data-src="https://mmbiz.qpic.cn/mmbiz_png/5oRW9lsb6kGZZoW8EXVJJwAAGrU1M8G7ukibFerB7ChdrHOrf9QXxFIRPK7nxTm7wZWQUpBU4ib5Kjib0EHTIMugQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/5oRW9lsb6kGZZoW8EXVJJwAAGrU1M8G7ukibFerB7ChdrHOrf9QXxFIRPK7nxTm7wZWQUpBU4ib5Kjib0EHTIMugQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section mpa-from-tpl="t"><span><strong mpa-from-tpl="t"><span>范例三</span></strong></span></section></section></section><section data-mid="" mpa-from-tpl="t"><img data-ratio="0.90625" data-w="64" data-src="https://mmbiz.qpic.cn/mmbiz_png/UoD3pAqsgaxWJRiaGk1WZ0R07SL619UBic62Vwic8GhibQLYvuDquEKCUL8dpiau7vkHUXqbJnVN9XF4SOsWbyqcGbw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/UoD3pAqsgaxWJRiaGk1WZ0R07SL619UBic62Vwic8GhibQLYvuDquEKCUL8dpiau7vkHUXqbJnVN9XF4SOsWbyqcGbw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section></section></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#载入本地数据：</span><br mpa-from-tpl="t"><span>links</span> &lt;- read.csv('Alluvial.eg.csv',header = T)<br mpa-from-tpl="t"><span>head</span>(links)</code></pre></section><p><br></p><section><img data-ratio="0.19913793103448277" data-type="png" data-w="1160" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykQmaUJHp6DvEIA9eVKYc6XD6NHbMEa2lpFYJBwJ921vYpqFLtbZNiaww/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykQmaUJHp6DvEIA9eVKYc6XD6NHbMEa2lpFYJBwJ921vYpqFLtbZNiaww/640?wx_fmt=png"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#继续三步走：</span><br mpa-from-tpl="t"><span>#创建nodes：</span><br mpa-from-tpl="t"><span>nodes</span> &lt;- data.frame(name = c(as.character(links$source),<br mpa-from-tpl="t"><span>as</span>.character(links$target)) %&gt;% unique())<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>#创建ID：</span><br mpa-from-tpl="t"><span>links</span>$IDsource &lt;- match(links$source, nodes$name) -1<br mpa-from-tpl="t"><span>links</span>$IDtarget &lt;- match(links$target, nodes$name) -1<br mpa-from-tpl="t"><span>head</span>(nodes)<br mpa-from-tpl="t"><span>head</span>(links)</code></pre></section><p><br></p><section><img data-ratio="0.3905172413793103" data-type="png" data-w="1160" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykPPlhJxXm2ng3MH1WXvnbicbyVRXcJ4Bvia20A0h6BW5hHO2zE9XFMZRQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykPPlhJxXm2ng3MH1WXvnbicbyVRXcJ4Bvia20A0h6BW5hHO2zE9XFMZRQ/640?wx_fmt=png"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#绘图：</span><br mpa-from-tpl="t"><span>p2</span> &lt;- sankeyNetwork(Links = links,<br mpa-from-tpl="t"><span>Nodes</span> = nodes,<br mpa-from-tpl="t"><span>Source</span> = <span>"IDsource"</span>,<br mpa-from-tpl="t"><span>Target</span> = <span>"IDtarget"</span>,<br mpa-from-tpl="t"><span>Value</span> = <span>"value"</span>,<br mpa-from-tpl="t"><span>NodeID</span> = <span>"name"</span>,<br mpa-from-tpl="t"><span>sinksRight</span> = FALSE,<br mpa-from-tpl="t"><span>nodeWidth</span> = 20,<br mpa-from-tpl="t"><span>fontSize</span> = 13,<br mpa-from-tpl="t"><span>nodePadding</span> = 15)<br mpa-from-tpl="t"><span>p2</span></code></pre></section><p><br></p><section><img data-ratio="0.7327909887359199" data-type="png" data-w="1598" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykia33NmMMb1Jj9bd8z5vw2n7a4AI10N9Xgb4KUy3AyoNk6zzKAcRN85w/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykia33NmMMb1Jj9bd8z5vw2n7a4AI10N9Xgb4KUy3AyoNk6zzKAcRN85w/640?wx_fmt=png"></section><section><br></section><section data-mpa-template="t" mpa-from-tpl="t"><section data-mpa-template="t" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><img data-ratio="0.7727272727272727" data-w="44" data-src="https://mmbiz.qpic.cn/mmbiz_png/5oRW9lsb6kGZZoW8EXVJJwAAGrU1M8G7ukibFerB7ChdrHOrf9QXxFIRPK7nxTm7wZWQUpBU4ib5Kjib0EHTIMugQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/5oRW9lsb6kGZZoW8EXVJJwAAGrU1M8G7ukibFerB7ChdrHOrf9QXxFIRPK7nxTm7wZWQUpBU4ib5Kjib0EHTIMugQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section mpa-from-tpl="t"><span><strong mpa-from-tpl="t"><span>范例四：ceRNA网络构建</span></strong></span></section></section></section><section data-mid="" mpa-from-tpl="t"><img data-ratio="0.90625" data-w="64" data-src="https://mmbiz.qpic.cn/mmbiz_png/UoD3pAqsgaxWJRiaGk1WZ0R07SL619UBic62Vwic8GhibQLYvuDquEKCUL8dpiau7vkHUXqbJnVN9XF4SOsWbyqcGbw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/UoD3pAqsgaxWJRiaGk1WZ0R07SL619UBic62Vwic8GhibQLYvuDquEKCUL8dpiau7vkHUXqbJnVN9XF4SOsWbyqcGbw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section></section></section></section></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#载入本地数据：</span><br mpa-from-tpl="t"><span>df</span> &lt;- read.csv('ceRNA.csv',header = T)<br mpa-from-tpl="t"><span>links</span> &lt;- df<br mpa-from-tpl="t"><span>head</span>(links)</code></pre></section><p><br></p><section><img data-ratio="0.2687793427230047" data-type="png" data-w="852" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykCHEQNXfiaD2t8Qj7xPCjbqwlxFFm7zTZEjNFHJECHdhmwM1MiaaKslyw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykCHEQNXfiaD2t8Qj7xPCjbqwlxFFm7zTZEjNFHJECHdhmwM1MiaaKslyw/640?wx_fmt=png"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#创建nodes：</span><br mpa-from-tpl="t"><span>nodes</span> &lt;- data.frame(name = c(as.character(links$source),<br mpa-from-tpl="t"><span>as</span>.character(links$target)) %&gt;% unique())<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>#创建ID：</span><br mpa-from-tpl="t"><span>links</span>$IDsource &lt;- match(links$source, nodes$name) -1<br mpa-from-tpl="t"><span>links</span>$IDtarget &lt;- match(links$target, nodes$name) -1<br mpa-from-tpl="t"><span>head</span>(nodes)<br mpa-from-tpl="t"><span>head</span>(links)</code></pre></section><p><br></p><section><img data-ratio="0.5387323943661971" data-type="png" data-w="852" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykEK06wIFR524nS27VN0CJMVHruzMRtiaXZrsP1LdvEr16ibNMibqXVHq1A/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCBykEK06wIFR524nS27VN0CJMVHruzMRtiaXZrsP1LdvEr16ibNMibqXVHq1A/640?wx_fmt=png"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#绘图：</span><br mpa-from-tpl="t"><span>p3</span> &lt;- sankeyNetwork(Links = links,<br mpa-from-tpl="t"><span>Nodes</span> = nodes,<br mpa-from-tpl="t"><span>Source</span> = <span>"IDsource"</span>,<br mpa-from-tpl="t"><span>Target</span> = <span>"IDtarget"</span>,<br mpa-from-tpl="t"><span>Value</span> = <span>"value"</span>,<br mpa-from-tpl="t"><span>NodeID</span> = <span>"name"</span>,<br mpa-from-tpl="t"><span>sinksRight</span> = FALSE,<br mpa-from-tpl="t"><span>nodeWidth</span> = 20,<br mpa-from-tpl="t"><span>fontSize</span> = 15,<br mpa-from-tpl="t"><span>nodePadding</span> = 15)<br mpa-from-tpl="t"><span>p3</span></code></pre></section><p><br></p><section><img data-ratio="0.7687165775401069" data-type="png" data-w="1496" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCByknNDdGoibkWNQqOWH32sdYe560ib153KEWLFhmcxibzw7STuI2sUXtq8Dw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpjH8ltVeDoTNYE3xOvsCByknNDdGoibkWNQqOWH32sdYe560ib153KEWLFhmcxibzw7STuI2sUXtq8Dw/640?wx_fmt=png"></section><section><br></section><section><span>通过三步曲，不同数据都可以完美实现桑基图绘制，非常简单！范例三和范例四使用测试数据可以从OmicShare云工具平台—动态桑基图处获得。</span></section><section><br></section><section><span>好啦，今天的分享就到这里！</span></section><section><br></section><section data-role="title" data-tools="135编辑器" data-id="113060"><section><section><section><section><section><br></section><section data-brushtype="text" hm_fix="302:513"><span><strong>参考资料</strong></span></section><section><br></section></section><section><br></section></section></section></section></section><section><span>https://github.com/christophergandrud/networkD3</span></section><section><span>https://www.data-to-viz.com/graph/sankey.html</span></section><section><br></section><section><strong><span>*未经许可，不得以任何方式复制或抄袭本篇文章之部分或全部内容。版权所有，侵权必究。</span></strong></section><section><br></section><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="105648"><section><section data-role="outer" label="Powered by 135editor.com"><section data-role="paragraph"><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="105648"><section><section><img data-ratio="0.8928571428571429" data-type="png" data-w="41" data-width="100%" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJE8VibmibGU0Jxic9iabARVRH0FT6BNE8VAglWFXBPibFAU7a6tWGibSs8wyUg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJE8VibmibGU0Jxic9iabARVRH0FT6BNE8VAglWFXBPibFAU7a6tWGibSs8wyUg/640?wx_fmt=png"></section><section><section><section data-width="35%"><section><section data-width="100%"><img data-ratio="1" data-type="jpeg" data-w="860" data-width="100%" title="SCIPainter 30cm二维码.jpg" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEv5etCBwHicqbEPwnVrkpaasxqaVibM4mT2JdIuN6yTlYWDD4mL5A427A/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEv5etCBwHicqbEPwnVrkpaasxqaVibM4mT2JdIuN6yTlYWDD4mL5A427A/640?wx_fmt=jpeg"></section></section></section><section data-width="50%"><section><section data-brushtype="text"><strong># SCIPainter</strong></section><section data-brushtype="text" hm_fix="361:593"><p>基迪奥旗下绘图公众号</p><p>分享科研绘图技能与工具</p><p>欢迎关注与转发~</p></section></section></section></section></section></section></section></section></section></section><section><br></section></section></section><section data-role="paragraph"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-ratio="1" data-type="gif" data-w="400" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEgMd0aMPtmrDjiaX8sBhfhicVteeHf1JicexSpUbS3fdS9SiboUVN7guaPw/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEgMd0aMPtmrDjiaX8sBhfhicVteeHf1JicexSpUbS3fdS9SiboUVN7guaPw/640?wx_fmt=gif"></section></section></section><section><section powered-by="xiumi.us"><section><p><span><strong>你的好友拍了拍你</strong></span></p><p><span><strong>并请你帮她点一下</strong></span><span><strong><span>“分享”</span></strong></span><span><strong><span>~</span></strong></span></p></section></section></section></section></section><p><br></p></section></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/N-Q6AfUNylnBn3RiHKTVIw",target="_blank" rel="noopener noreferrer">原文链接</a>
