---
title: "bugs 报告和修复"
date: 2023-02-10T09:41:45Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
bugs 报告和修复 by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><section><mp-common-profile data-pluginname="mpprofile" data-weui-theme="light" data-id="MzkyMTI1MTYxNA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usey42oX5qyLTVibLRO9dz8ic5G4TpEHQc9rICYlpS4MHg6Et8cgXrQDqibvibXombicTro8t9cekJRlDBcw/0?wx_fmt=png" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><section><p><img data-ratio="0.13125" data-src="https://mmbiz.qpic.cn/mmbiz_gif/f5u8u3lDeLchGaIcFTOuEzUYJyA2UibBrOwXlv6suBC8O8OrT4FvyAhBqbnIu6BpHibcXVz6icHricecu9yQrNY0aw/640?wx_fmt=gif" data-type="gif" data-w="640" src="https://mmbiz.qpic.cn/mmbiz_gif/f5u8u3lDeLchGaIcFTOuEzUYJyA2UibBrOwXlv6suBC8O8OrT4FvyAhBqbnIu6BpHibcXVz6icHricecu9yQrNY0aw/640?wx_fmt=gif"><br></p></section><p><span><br></span></p><h2 data-tool="mdnice编辑器"><span><span>1</span></span><span>引言</span><span></span></h2><blockquote data-tool="mdnice编辑器"><p>有一些小伙伴反映 <strong>GseaVis</strong> 绘制多个通路时图例颜色和曲线不符, 于是检查了代码进行了修复。</p></blockquote><blockquote data-tool="mdnice编辑器"><p>有个小伙伴在 github 上反映 <strong>ClusterGVis</strong> GO 注释条形图和 GO 条目名称对不上, 此外比如 5 个通路只显示四个柱形,这个问题之前有讲过, 于是这里将最小的柱形高度不再 scale 为 0 了,则会展示所有的柱子。</p></blockquote><figure data-tool="mdnice编辑器"><img data-ratio="0.6402439024390244" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSorWhtQpG7I3XCYIVpjJ4nRiao6XiaB1lmclxoXLcY1phSzZuXFlgTBPQ/640?wx_fmt=png" data-type="png" data-w="1148" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSorWhtQpG7I3XCYIVpjJ4nRiao6XiaB1lmclxoXLcY1phSzZuXFlgTBPQ/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><p>之前有个小伙伴拿 ClusterGVis 基于 WGCNA 的结果画图, <strong>因为有很多模块可能没有用,想着能不能提取指定的 cluster 绘图</strong>, 这里在 <strong>clusterData</strong> 函数里增加了 <em>subcluster</em> 参数来取子集。这里对于 <em>mfuzz/kmeans/WGCNA</em> 都可以取子集。</p></blockquote><h2 data-tool="mdnice编辑器"><span><span>2</span></span><span>安装</span><span></span></h2><p data-tool="mdnice编辑器">重新安装更新的包:</p><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("devtools")</span><br>devtools::install_github(<span>"junjunlab/GseaVis"</span>)<br><br><span># Note: please update your ComplexHeatmap to the latest version!</span><br><span># install.packages("devtools")</span><br>devtools::install_github(<span>"junjunlab/ClusterGVis"</span>)<br></code></pre><h2 data-tool="mdnice编辑器"><span><span>3</span></span><span>测试</span><span></span></h2><p data-tool="mdnice编辑器">GseaVis 绘制多条通路:</p><pre data-tool="mdnice编辑器"><span></span><code>library(GseaVis)<br>library(tidyverse)<br><br><span># load data</span><br>test_data &lt;- system.file(<span>"extdata"</span>, <span>"gseaRes.RDS"</span>, package = <span>"GseaVis"</span>)<br>gseaRes &lt;- readRDS(test_data)<br><br>df &lt;- data.frame(gseaRes)<br><br><span># plot</span><br>gseaNb(object = gseaRes,<br>       geneSetID = df<span>$ID</span>[sample(1:1000,5,replace = F)],<br>       curveCol= jjAnno::useMyCol(<span>'stallion'</span>,5),<br>       subPlot = 2,<br>       addPval = T,<br>       rmHt = T,<br>       pvalX = 1,<br>       pvalY = 1,<br>       rank.gene.nudgey = 1)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6175972927241963" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSPMmEjdGP0icaRiaSWNmGZyhWCwjM1kG9jichbWZFKzTGXZt5iaRyRXZG2Q/640?wx_fmt=png" data-type="png" data-w="1182" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSPMmEjdGP0icaRiaSWNmGZyhWCwjM1kG9jichbWZFKzTGXZt5iaRyRXZG2Q/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">可以看到表格,曲线颜色和图例颜色能够一一对应。</p><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">ClusterGVis 添加 GO 注释:</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ClusterGVis)<br><span>library</span>(org.Mm.eg.db)<br><br><span># load data</span><br>data(exps)<br><br><span># using mfuzz for clustering</span><br><span># mfuzz</span><br>cm &lt;- clusterData(exp = exps,<br>                  cluster.method = <span>"mfuzz"</span>,<br>                  cluster.num = <span>8</span>)<br><br><span># enrich for clusters</span><br>enrich &lt;- enrichCluster(object = cm,<br>                        OrgDb = org.Mm.eg.db,<br>                        type = <span>"BP"</span>,<br>                        pvalueCutoff = <span>0.05</span>,<br>                        topn = <span>5</span>,<br>                        seed = <span>5201314</span>)<br><br><br><span># add gene name</span><br>markGenes = rownames(exps)[sample(<span>1</span>:nrow(exps),<span>30</span>,replace = <span>F</span>)]<br><br><span># add bar plot</span><br>pdf(<span>'comb.pdf'</span>,height = <span>10</span>,width = <span>12</span>,onefile = <span>F</span>)<br>visCluster(object = cm,<br>           plot.type = <span>"both"</span>,<br>           column_names_rot = <span>45</span>,<br>           show_row_dend = <span>F</span>,<br>           markGenes = markGenes,<br>           markGenes.side = <span>"left"</span>,<br>           annoTerm.data = enrich,<br>           line.side = <span>"left"</span>,<br>           go.col = rep(jjAnno::useMyCol(<span>"stallion"</span>,n = <span>8</span>),each = <span>5</span>),<br>           add.bar = <span>T</span>,<br>           sample.group = rep(c(<span>"sample1"</span>,<span>"sample2"</span>,<span>"sample3"</span>),each = <span>2</span>))<br>dev.off()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.8328611898016998" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSSqRAGsDOD0xN67rPB7u4woU03mHT97aeVHkfgmzN8uRX73kRCkeB7Q/640?wx_fmt=png" data-type="png" data-w="1059" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSSqRAGsDOD0xN67rPB7u4woU03mHT97aeVHkfgmzN8uRX73kRCkeB7Q/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">举个例子, 我们可以看到绿色的 cluster3 的条形是按 ratio 大小排列的:</p><figure data-tool="mdnice编辑器"><img data-ratio="0.2682291666666667" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDShwYdWZCoWGDzyKKnzWCRGAicy3QQvycrWrTMFFVrA8vo2BHX9ibtiaibTg/640?wx_fmt=png" data-type="png" data-w="768" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDShwYdWZCoWGDzyKKnzWCRGAicy3QQvycrWrTMFFVrA8vo2BHX9ibtiaibTg/640?wx_fmt=png"></figure><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">ClusterGVis 取子集:</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ClusterGVis)<br><br><span># load data</span><br>data(exps)<br><br><span># using mfuzz for clustering</span><br><span># mfuzz</span><br>cm &lt;- clusterData(exp = exps,<br>                  cluster.method = <span>"mfuzz"</span>,<br>                  cluster.num = <span>8</span>)<br><br><span># retain cluster1:6</span><br>cs &lt;- clusterData(exp = exps,<br>                  cluster.method = <span>"mfuzz"</span>,<br>                  cluster.num = <span>8</span>,<br>                  subcluster = <span>1</span>:<span>6</span>)<br></code></pre><p data-tool="mdnice编辑器">绘图展示:</p><pre data-tool="mdnice编辑器"><span></span><code><span># plot line only</span><br>visCluster(object = cm,<br>           plot.type = <span>"line"</span>) +<br>  visCluster(object = cs,<br>             plot.type = <span>"line"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.27323943661971833" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSwRzJpibWuyOLmA7nibcdVavRg8tKKWGIXGia2LWIyjicyjQDWcBatqnouQ/640?wx_fmt=png" data-type="png" data-w="1775" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSwRzJpibWuyOLmA7nibcdVavRg8tKKWGIXGia2LWIyjicyjQDWcBatqnouQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">热图:</p><pre data-tool="mdnice编辑器"><span></span><code><span># supply other aruguments passed by Heatmap function</span><br>visCluster(object = cm,<br>           plot.type = <span>"heatmap"</span>,<br>           show_row_dend = <span>F</span>,<br>           column_names_rot = <span>45</span>)<br><br>visCluster(object = cs,<br>           plot.type = <span>"heatmap"</span>,<br>           show_row_dend = <span>F</span>,<br>           column_names_rot = <span>45</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.8765264586160109" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSWtneOOuyT9nS4JibrWN9hnlJ31HJ4RMALmx72jqayONvNglUN7NL9jA/640?wx_fmt=png" data-type="png" data-w="737" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSWtneOOuyT9nS4JibrWN9hnlJ31HJ4RMALmx72jqayONvNglUN7NL9jA/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">对于 WGCNA 也是一样的操作。</p><h2 data-tool="mdnice编辑器"><span><span>4</span></span><span>结尾</span><span></span></h2><blockquote data-tool="mdnice编辑器"><p>最后你想要的都在下面了: <strong><em>https://github.com/junjunlab</em></strong></p></blockquote><figure data-tool="mdnice编辑器"><img data-ratio="0.4610726643598616" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSeqA9W15pfyibiaql8ULQibfg2wnKgvCQH25lGzyLWt3qSh84zyoJYzxng/640?wx_fmt=png" data-type="png" data-w="1156" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSeqA9W15pfyibiaql8ULQibfg2wnKgvCQH25lGzyLWt3qSh84zyoJYzxng/640?wx_fmt=png"></figure><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">欢迎加入生信交流群。加我微信我也拉你进 <strong>微信群聊</strong> <strong>老俊俊生信交流群</strong> <strong>(微信交流群需收取 20 元入群费用,一旦交费,拒不退还!(防止骗子和便于管理))</strong> 。QQ 群可免费加入, 记得进群按格式修改备注哦。</p><section data-tool="mdnice编辑器"><section><p><strong>老俊俊微信：</strong></p><figure><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSJXeouRB1GdAB30v1VaaoIH3zJyuMcb1ByicbJc6UAtqltz9ZB1amBGA/640?wx_fmt=png" data-type="png" data-w="430" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSJXeouRB1GdAB30v1VaaoIH3zJyuMcb1ByicbJc6UAtqltz9ZB1amBGA/640?wx_fmt=png"></figure><figure><img data-ratio="1.3668430335097002" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSdCszmzyny3vcMQFsDZPvic2IJudRGucf8BwZ6W1Kk2ESWfkq4YpDT7g/640?wx_fmt=png" data-type="png" data-w="567" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usezdgfz68LbTOGybzh7qRkDSdCszmzyny3vcMQFsDZPvic2IJudRGucf8BwZ6W1Kk2ESWfkq4YpDT7g/640?wx_fmt=png"></figure></section><section><p><strong>知识星球：</strong></p><figure><img data-ratio="1.5896226415094339" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/G5jjcE4usezdgfz68LbTOGybzh7qRkDSzxent2ovLXtt1bwpqrphuCWTnnGvUUJ7hYHvgJicHWJnjfhDnZicPoBA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1060" src="https://mmbiz.qpic.cn/mmbiz_jpg/G5jjcE4usezdgfz68LbTOGybzh7qRkDSzxent2ovLXtt1bwpqrphuCWTnnGvUUJ7hYHvgJicHWJnjfhDnZicPoBA/640?wx_fmt=jpeg"></figure></section></section><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><br></p><center data-tool="mdnice编辑器"><strong> 往期回顾目录</strong></center><blockquote data-tool="mdnice编辑器"><ul><li><section><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247507659&amp;idx=1&amp;sn=1ab71d31c3b805a09de88f2eaf955c95&amp;chksm=c184e4baf6f36dac6fd5a322f351a09e1ea4d351ededa6b0f28b23e6a8fb3eb654fd04fab143&amp;token=139164705&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">合并生物学重复 bigwig 文件简化作图</a></center></strong></section></li><li><section><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247507643&amp;idx=1&amp;sn=704c5dd5ec052bb99c34b08efc876916&amp;chksm=c184e4caf6f36ddc92c10e6f41887c2c5b704f96d75dd9fa57b5ff5d2e0ecb94f2996a787071&amp;token=139164705&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">WiggleTools 处理 bigwig/wig 文件好帮手</a></center></strong></section></li><li><section><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247507552&amp;idx=1&amp;sn=57aacb748fb168a180d2569348eb9ee8&amp;chksm=c184e411f6f36d07f490d6dd2753cb717b762f8f9c5b23d06542569dd396ba7d363b926412a0&amp;token=1411764085&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ggplate 优雅的可视化 culture plates</a></center></strong></section></li><li><section><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247507518&amp;idx=1&amp;sn=99c95f7e874699f20489b62933a7fc9e&amp;chksm=c184e44ff6f36d59c5dee40889b8204896c71a32f02faec96946f3a971a660cf0b2cd8fb6039&amp;payreadticket=HIQRHXbxh8oH_23UPa6nk9zBwAhs-r_M_qtotZYPBTOJ3Y_ZyI0c5v5ilml8s043FMLWAgU&amp;scene=21#wechat_redirect" data-linktype="2">使用 ggplot2 美化 lasso 图</a></center></strong></section></li><li><section><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247507465&amp;idx=1&amp;sn=b6211b024d0b2715d0b3d181443b3588&amp;chksm=c184e478f6f36d6ebb8b2d9ef2d7e598185cc1e22717e742ce0c7224fa9c2249e5f18931cf0e&amp;token=341747724&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">将多分组 KM 曲线两两比较的结果添加到生存曲线图中</a></center></strong></section></li><li><section><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247507435&amp;idx=1&amp;sn=d3ee6268f58e1f2f6408c5c3615a8499&amp;chksm=c184e79af6f36e8c9a13b16c0b7836253b35114cc76d2acfdaa28f6520ddf3d3ac0de0c0e3c4&amp;token=450867742&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">经验贝叶斯分层模型鉴定 m6A 修饰</a></center></strong></section></li><li><section><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247507410&amp;idx=1&amp;sn=c33809620a13392f420a9bc1160400ac&amp;chksm=c184e7a3f6f36eb5286ca59cba9cc0f81bb2e1d8e6f769588faf5f324c945b8cfe8f50708780&amp;token=1490715219&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ClusterGVis 添加多个样本注释</a></center></strong></section></li><li><section><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247507391&amp;idx=1&amp;sn=06bc6e826c38aa15af4f5d08c0612c04&amp;chksm=c184e7cef6f36ed8dc800ac918b72b6ae0e8dd68691b48aa7dce1df3bc455bf0afb8497cc836&amp;token=133699415&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">vtree 以树形结构优雅的展示分类变量</a></center></strong></section></li><li><section><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247507317&amp;idx=1&amp;sn=0b8c4e9abed55f55d6b45ba323d26686&amp;chksm=c184e704f6f36e124fdce423c15e67b0c3eddc3b0a38f6f4a844b6824de82ea7ad3622b9e960&amp;token=1253522169&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">eulerr 优雅的可视化韦恩图</a></center></strong></section></li><li><section><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247507278&amp;idx=1&amp;sn=f22a6a5a3b99d2cd90480149a1325da8&amp;chksm=c184e73ff6f36e29ce650ed9510b325e41338ce87b86fee60d0e74f40990cdbd75689a52eaec&amp;token=1978504973&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">ClusterGVis 提供自己的数据绘图</a></center></strong></section></li></ul></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/cihxzNLDHAplgEQpKtpfBw",target="_blank" rel="noopener noreferrer">原文链接</a>
