---
title: "跟着Nature Plants学作图：R语言ggplot2甜甜圈图包裹饼图"
date: 2024-03-30T15:59:53Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Acdemic"]
---
跟着Nature Plants学作图：R语言ggplot2甜甜圈图包裹饼图 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><h2 data-tool="mdnice编辑器"><span></span><span>论文</span><span></span><span> </span></h2><blockquote data-tool="mdnice编辑器"><span></span><h1><span></span><span>Heritable microbiome variation is correlated with source environment in locally adapted maize varieties</span><span></span></h1></blockquote><p data-tool="mdnice编辑器">https://www.nature.com/articles/s41477-024-01654-7</p><p data-tool="mdnice编辑器">论文中提供了作图用到的原始数据，我们可以试着用原始数据复现论文中的图，今天的推文我们来模仿一下论文中的figure2a</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100013295" data-ratio="0.5327102803738317" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk7AmtibQjmoh2cx6zRwwSsse8SfbDiaKmkfMZRtmr74FpXRe3fiazPPyP7MSvFOHBKqnyPRjDqAlthHQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1284" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk7AmtibQjmoh2cx6zRwwSsse8SfbDiaKmkfMZRtmr74FpXRe3fiazPPyP7MSvFOHBKqnyPRjDqAlthHQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">我的思路是用scatterpie这个R包来做，首先画一个大的饼图，然后画一个稍微小一点的圆，再画一个稍微小一点的饼图就能够实现上图的效果，画圆用到的是ggforce这个R包里的</p><p data-tool="mdnice编辑器">数据整理成如下格式</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100013294" data-ratio="0.29347826086956524" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk7AmtibQjmoh2cx6zRwwSsseL8JDAnjibgmmuoPyL9ZqCnncoIX3eaRqFF1zDqAJNcJvVqkNmeIvxWg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="736" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk7AmtibQjmoh2cx6zRwwSsseL8JDAnjibgmmuoPyL9ZqCnncoIX3eaRqFF1zDqAJNcJvVqkNmeIvxWg/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">因为论文中提供的数据需要手动整理成以上的格式，为了节省时间，我这边只整理一组数据</p><h2 data-tool="mdnice编辑器"><span></span><span>加载需要用到的R包</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(readxl)<br>library(scatterpie)<br>library(ggforce)<br>library(tidyverse)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>读取数据</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>read_excel(<span>"data/20240322/41477_2024_1654_MOESM5_ESM.xlsx"</span>,<br>           sheet = <span>"Sheet1"</span>) %&gt;% <br>  mutate(x=1:4,<br>         y=c(0.12,0.1,0.22,0.14)) -&gt; dat01 <br>  <br>dat01<br><br>read_excel(<span>"data/20240322/41477_2024_1654_MOESM5_ESM.xlsx"</span>,<br>           sheet = <span>"Sheet2"</span>) %&gt;% <br>  mutate(x=1:4,<br>         y=c(0.12,0.1,0.22,0.14)) -&gt; dat02<br><br>dat02 %&gt;% colnames()<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>作图代码</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>ggplot()+<br>  geom_scatterpie(data = dat01,<br>                  aes(x=x,y=y,group=Taxa_Treatment,r=Nt/200),<br>                  cols = c(<span>"G_best(%)"</span>,<span>"EC_best(%)"</span>,<span>"G+EC_best(%)"</span>))+<br>  scale_fill_manual(values = c(<span>"#deebf7"</span>,<span>"#9ecae1"</span>,<span>"#3182bd"</span>),<br>                    name=NULL)+<br>  ggnewscale::new_scale_fill()+<br>  geom_circle(data = dat02,<br>                  aes(x0=x,y0=y,r=Nt/350),<br>                  fill=<span>"white"</span>)+<br>  geom_scatterpie(data = dat02,<br>                  aes(x=x,y=y,group=Taxa_Treatment,r=Nt/400),<br>                  cols = c(<span>"0.3&gt;PA&gt;0.1(%)"</span>,<span>"0.5&gt;PA&gt;0.3(%)"</span>,<br>                           <span>"PA&gt;0.5(%)"</span>,<span>"PA&lt;0.1(%)"</span>))+<br>  scale_fill_manual(values = c(<span>"#e5f5e0"</span>,<span>"#a1d99b"</span>,<span>"#31a354"</span>,<span>"#bebebe"</span>),<br>                    name=NULL)+<br>  coord_equal()+<br>  theme_bw()+<br>  theme(panel.grid = element_blank(),<br>        legend.box = <span>"horizontal"</span>,<br>        legend.direction = <span>"vertical"</span>,<br>        legend.position = <span>"top"</span>,<br>        legend.justification = <span>"left"</span>)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>最终效果</span><span></span><span> </span></h2><figure data-tool="mdnice编辑器"><img data-imgfileid="100013296" data-ratio="0.4229490022172949" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk7AmtibQjmoh2cx6zRwwSsseGxKSohCDTLbg4arut9etJaX2lxy6SYteaH8bmibBTNlrBtSSkrKgORw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1804" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk7AmtibQjmoh2cx6zRwwSsseGxKSohCDTLbg4arut9etJaX2lxy6SYteaH8bmibBTNlrBtSSkrKgORw/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">这里如何再添加一个图例用来表示不同的直径的数值，暂时没有想明白</p><p data-tool="mdnice编辑器"><strong>欢迎大家关注我的公众号</strong></p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzI3NzQ3MTcxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5t1sOnM0iabvBhnfIj5YpyqrMib0E1MGCd9ibcYxaOPZd0GWhQBDvK2BPEwsicQxd6y5MHLfphnwHnow/0?wx_fmt=png" data-nickname="小明的数据分析笔记本" data-alias="" data-signature="分享R语言和python在生物信息领域做数据分析和数据可视化的简单小例子；偶尔会分享一些组学数据处理相关的内容" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"><strong></strong></p><blockquote data-tool="mdnice编辑器"><span></span><p>小明的数据分析笔记本 公众号 主要分享：1、R语言和python做数据分析和数据可视化的简单小例子；2、园艺植物相关转录组学、基因组学、群体遗传学文献阅读笔记；3、生物信息学入门学习资料及自己的学习笔记！</p></blockquote><p data-tool="mdnice编辑器">微信公众号好像又有改动，如果没有将这个公众号设为星标的话，会经常错过公众号的推文，个人建议将 小明的数据分析笔记本 公众号添加星标，添加方法是 <strong>点开公众号的页面，右上角有三个点</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100013293" data-ratio="0.9693333333333334" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk7AmtibQjmoh2cx6zRwwSssemRWGzIaoNAQ8KMYiaRkgw1CjK3SdMbWpAydwYuqozS6ZcXXZ38ebRPA/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="750" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk7AmtibQjmoh2cx6zRwwSssemRWGzIaoNAQ8KMYiaRkgw1CjK3SdMbWpAydwYuqozS6ZcXXZ38ebRPA/640?wx_fmt=other&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>点击三个点，会跳出界面</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100013292" data-ratio="2.120879120879121" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk7AmtibQjmoh2cx6zRwwSssegoYVElt0C74KTcJrDTwh1I4N7qkrUrWscEHtdOap1pgQPNVhEd6lFw/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="364" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk7AmtibQjmoh2cx6zRwwSssegoYVElt0C74KTcJrDTwh1I4N7qkrUrWscEHtdOap1pgQPNVhEd6lFw/640?wx_fmt=other&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>直接点击</strong></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/hAOEeFvMbqTYtaY1xDJFww",target="_blank" rel="noopener noreferrer">原文链接</a>
