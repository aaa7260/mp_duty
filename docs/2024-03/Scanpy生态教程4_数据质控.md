---
title: "Scanpy生态教程4：数据质控"
date: 2024-03-15T05:26:26Z
draft: ["false"]
tags: [
  "fetched",
  "生信会客厅"
]
categories: ["Acdemic"]
---
Scanpy生态教程4：数据质控 by 生信会客厅
------
<div><p><br></p><section><em><span>数据质控是整个单细胞数据分析流程中的基石环节，具有至关重要的意义。首先，由于单细胞测序实验中每个细胞的起始物质量非常有限，这导致数据易受背景噪声、扩增偏好性以及技术差异的影响，从而可能产生大量非生物学变异。因此，对原始数据进行严格的质控能够有效去除低质量的细胞和基因，如那些捕获或测序效率极低的细胞，或者表达水平异常高或低且可能源于技术误差的基因。</span></em></section><p><br></p><h2><strong><span>设置分析环境</span></strong></h2><section><span>大家不要忘记启动jupyter后把内核设置为Scanpy</span><br></section><p><img data-galleryid="" data-imgfileid="100001693" data-ratio="0.30833333333333335" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6dUmDSwBqXRHxlq9VYu6OaQicdOndJlRDqibKqJqCeKiaPgrFowKK6uibIQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6dUmDSwBqXRHxlq9VYu6OaQicdOndJlRDqibKqJqCeKiaPgrFowKK6uibIQ/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><pre><code><span>import</span> numpy <span>as</span> np<br><span>import</span> pandas <span>as</span> pd<br><span>import</span> scanpy <span>as</span> sc<br><span>import</span> scrublet <span>as</span> scr<br><span>import</span> matplotlib.pyplot <span>as</span> plt<br><span>import</span> warnings<br><span>import</span> os<br><br>warnings.simplefilter(action=<span>'ignore'</span>, category=Warning)<br>sc.settings.verbosity = <span>3</span><br>sc.settings.set_figure_params(dpi=<span>80</span>)</code></pre><pre><code>%matplotlib inline</code></pre><pre><code>projpath=<span>'D:\\公众号\\2024scanpy'</span><br>chapter=<span>"02_QualityControl"</span></code></pre><pre><code>os.chdir(projpath)<br><span>if</span> <span>not</span> os.path.exists(chapter):<br>    os.makedirs(chapter)<br>os.chdir(chapter)</code></pre><h2><br></h2><h2><strong><span>读取数据</span></strong></h2><p><span>数据下载链接：https://pan.baidu.com/s/1L9DTIk4nOzMBWKNCrirmew?pwd=dtpp 提取码：dtpp</span></p><p><span>我们首先读取8个样本的PBMC示例数据（4个来自新冠患者，4个来自健康对照，每个样本细胞数抽样至1500），这套数据将在后续多个章节使用。</span></p><pre><code>covid1 = sc.read_10x_h5(<span>"data/ncov_pbmc_1.h5"</span>)<br>covid1.obs[<span>'sample'</span>] = <span>'covid_1'</span>  <span># 添加样本名称</span><br>covid1.obs[<span>'type'</span>] = <span>'Covid'</span>      <span># 添加分组信息</span><br>covid1.var_names_make_unique()<br>covid15 = sc.read_10x_h5(<span>"data/ncov_pbmc_15.h5"</span>)<br>covid15.obs[<span>'sample'</span>] = <span>'covid_15'</span><br>covid15.obs[<span>'type'</span>] = <span>'Covid'</span><br>covid15.var_names_make_unique()<br>covid16 = sc.read_10x_h5(<span>"data/ncov_pbmc_16.h5"</span>)<br>covid16.obs[<span>'sample'</span>] = <span>'covid_16'</span><br>covid16.obs[<span>'type'</span>] = <span>'Covid'</span><br>covid16.var_names_make_unique()<br>covid17 = sc.read_10x_h5(<span>"data/ncov_pbmc_17.h5"</span>)<br>covid17.obs[<span>'sample'</span>] = <span>'covid_17'</span><br>covid17.obs[<span>'type'</span>] = <span>'Covid'</span><br>covid17.var_names_make_unique()<br>ctrl5 = sc.read_10x_h5(<span>"data/normal_pbmc_5.h5"</span>)<br>ctrl5.obs[<span>'sample'</span>] = <span>'ctrl_5'</span><br>ctrl5.obs[<span>'type'</span>] = <span>'Ctrl'</span><br>ctrl5.var_names_make_unique()<br>ctrl13 = sc.read_10x_h5(<span>"data/normal_pbmc_13.h5"</span>)<br>ctrl13.obs[<span>'sample'</span>] = <span>'ctrl_13'</span><br>ctrl13.obs[<span>'type'</span>] = <span>'Ctrl'</span><br>ctrl13.var_names_make_unique()<br>ctrl14 = sc.read_10x_h5(<span>"data/normal_pbmc_14.h5"</span>)<br>ctrl14.obs[<span>'sample'</span>] = <span>'ctrl_14'</span><br>ctrl14.obs[<span>'type'</span>] = <span>'Ctrl'</span><br>ctrl14.var_names_make_unique()<br>ctrl19 = sc.read_10x_h5(<span>"data/normal_pbmc_19.h5"</span>)<br>ctrl19.obs[<span>'sample'</span>] = <span>'ctrl_19'</span><br>ctrl19.obs[<span>'type'</span>] = <span>'Ctrl'</span><br>ctrl19.var_names_make_unique()</code></pre><pre><p><span>有不少朋友给我提过建议：代码里的循环、判断和自定义函数太多，新手学习起来会比较困难。因此，<span><strong>本教程的代码将以简单易读为第一原则</strong></span>，嫌代码笨拙的朋友可以借助GPT类的助手优化。例如上面读取表达矩阵的代码，chatgpt优化后的代码如下：</span></p></pre><pre><code><span>import</span> glob<br><br><span># 获取"data"目录下所有以".h5"结尾的文件路径</span><br>all_files = glob.glob(<span>"data/*.h5"</span>)<br><br><span># 创建空列表用于存入数据</span><br>adlist = []<br><br><span># 对于每个样本</span><br><span>for</span> file <span>in</span> all_files:<br>    <span># 读取数据</span><br>    adata = sc.read_10x_h5(file)<br><br>    <span># 提取样本编号（假设文件名中数字部分代表样本编号）</span><br>    sample_id = <span>int</span>(os.path.basename(file).split(<span>"_"</span>)[-<span>1</span>].split(<span>"."</span>)[<span>0</span>])<br><br>    <span># 根据文件名确定样本类型和名称</span><br>    <span>if</span> <span>"ncov"</span> <span>in</span> os.path.basename(file):<br>        sample_type = <span>'Covid'</span><br>        sample_name = <span>'covid_{}'</span>.<span>format</span>(sample_id)<br>    <span>elif</span> <span>"normal"</span> <span>in</span> os.path.basename(file):<br>        sample_type = <span>'Ctrl'</span><br>        sample_name = <span>'ctrl_{}'</span>.<span>format</span>(sample_id)<br><br>    <span># 添加样本名称和分组信息</span><br>    adata.obs[<span>'sample'</span>] = sample_name<br>    adata.obs[<span>'type'</span>] = sample_type<br><br>    <span># 确保变量名唯一</span><br>    adata.var_names_make_unique()<br><br>    <span># 将数据存入列表</span><br>    adlist.append(adata)</code></pre><pre><p><span>为了避免混淆，我们删除循环读取的数据</span></p></pre><p><code><span>del</span> adlist <span># 删除数据</span></code></p><p><span>下面演示读取稀疏矩阵格式的三个文件，后续教程中不使用这个数据。</span></p><pre><code>demo1 = sc.read_10x_mtx(<span>"data/filtered_feature_bc_matrix/"</span>, cache=<span>True</span>)<br>demo1.var_names_make_unique()<br>demo1</code></pre><section><span>AnnData object with n_obs × n_vars = 11996 × 36601</span></section><pre><section><span>    var: 'gene_ids', 'feature_types'</span></section></pre><p><span>下面演示读取制表符分隔的txt文件，后续教程中不使用这个数据。</span></p><pre><code>mat = pd.read_csv(<span>"data/pbmc_sub.txt"</span>, sep=<span>"\t"</span>, index_col=<span>0</span>)<br>mat.iloc[:<span>5</span>, :<span>5</span>] <span># 查看5行5列</span></code></pre><p><img data-galleryid="" data-imgfileid="100001684" data-ratio="0.3177004538577912" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6PbQ49e1Q5HuyxxgGMxMJbL4OJdems7n8z9K8GhoT9ECThax0oOqYVQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="661" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6PbQ49e1Q5HuyxxgGMxMJbL4OJdems7n8z9K8GhoT9ECThax0oOqYVQ/640?wx_fmt=png&amp;from=appmsg"></p><pre><code><span>from</span> scipy.sparse <span>import</span> csr_matrix<br>mat_csr = csr_matrix(mat)<br>demo2 = sc.AnnData(X=mat_csr)<br>demo2</code></pre><pre><pre><span>AnnData object with n_obs × n_vars = 1000 × 1000</span></pre></pre><h2><br></h2><h2><strong><span>检测Doublets</span></strong></h2><p><span>在单细胞RNA测序中，同一个液滴/微孔包含两个或多个细胞是一个常见问题。在一个典型的10X实验中，doublets的比例与加载的细胞数量成线性关系。正如Chromium用户指南所指出的，doublets的比率大致如下：</span></p><figure><p><img data-galleryid="" data-imgfileid="100001685" data-ratio="0.43148148148148147" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6WG38o5BHtj50LBzKpNPFDmhqZCaQiamqLYiaEGsARjXpfYUCzK8eib7icw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6WG38o5BHtj50LBzKpNPFDmhqZCaQiamqLYiaEGsARjXpfYUCzK8eib7icw/640?wx_fmt=png&amp;from=appmsg"></p></figure><p><span>大多数doublets预测算法都是先人工模拟一些双细胞，然后把这些细胞与原数据一起降维，最后根据真实细胞与模拟双细胞在低维空间的距离来预测双细胞概率。此类软件包一般需要假设数据集中预期双细胞的数量/比例，我们根据上表细胞数量与doublets的比率设置了一个自动计算的公式：双胞率=细胞数量<span>8</span>1e-6。接下来我们使用引用数量超过1k的Scrublet执行doublets检测任务。</span></p><pre><code>ad = covid1.copy()<br>scrub = scr.Scrublet(ad.X, expected_doublet_rate=ad.n_obs*<span>8</span>*<span>1e-6</span>)<br>out = scrub.scrub_doublets(verbose=<span>False</span>, n_prin_comps=<span>20</span>)<br>scrdf = pd.DataFrame({<span>'scr_score'</span>: out[<span>0</span>], <span>'scr_pred'</span>: out[<span>1</span>]}, index=ad.obs.index)<br>ad.obs = pd.concat([ad.obs, scrdf], axis=<span>1</span>)<br>covid1 = ad.copy()</code></pre><pre><code>ad = covid15.copy()<br>scrub = scr.Scrublet(ad.X, expected_doublet_rate=ad.n_obs*<span>8</span>*<span>1e-6</span>)<br>out = scrub.scrub_doublets(verbose=<span>False</span>, n_prin_comps=<span>20</span>)<br>scrdf = pd.DataFrame({<span>'scr_score'</span>: out[<span>0</span>], <span>'scr_pred'</span>: out[<span>1</span>]}, index=ad.obs.index)<br>ad.obs = pd.concat([ad.obs, scrdf], axis=<span>1</span>)<br>covid15 = ad.copy()</code></pre><pre><code>ad = covid16.copy()<br>scrub = scr.Scrublet(ad.X, expected_doublet_rate=ad.n_obs*<span>8</span>*<span>1e-6</span>)<br>out = scrub.scrub_doublets(verbose=<span>False</span>, n_prin_comps=<span>20</span>)<br>scrdf = pd.DataFrame({<span>'scr_score'</span>: out[<span>0</span>], <span>'scr_pred'</span>: out[<span>1</span>]}, index=ad.obs.index)<br>ad.obs = pd.concat([ad.obs, scrdf], axis=<span>1</span>)<br>covid16 = ad.copy()</code></pre><pre><code>ad = covid17.copy()<br>scrub = scr.Scrublet(ad.X, expected_doublet_rate=ad.n_obs*<span>8</span>*<span>1e-6</span>)<br>out = scrub.scrub_doublets(verbose=<span>False</span>, n_prin_comps=<span>20</span>)<br>scrdf = pd.DataFrame({<span>'scr_score'</span>: out[<span>0</span>], <span>'scr_pred'</span>: out[<span>1</span>]}, index=ad.obs.index)<br>ad.obs = pd.concat([ad.obs, scrdf], axis=<span>1</span>)<br>covid17 = ad.copy()</code></pre><pre><code>ad = ctrl5.copy()<br>scrub = scr.Scrublet(ad.X, expected_doublet_rate=ad.n_obs*<span>8</span>*<span>1e-6</span>)<br>out = scrub.scrub_doublets(verbose=<span>False</span>, n_prin_comps=<span>20</span>)<br>scrdf = pd.DataFrame({<span>'scr_score'</span>: out[<span>0</span>], <span>'scr_pred'</span>: out[<span>1</span>]}, index=ad.obs.index)<br>ad.obs = pd.concat([ad.obs, scrdf], axis=<span>1</span>)<br>ctrl5 = ad.copy()</code></pre><pre><code>ad = ctrl13.copy()<br>scrub = scr.Scrublet(ad.X, expected_doublet_rate=ad.n_obs*<span>8</span>*<span>1e-6</span>)<br>out = scrub.scrub_doublets(verbose=<span>False</span>, n_prin_comps=<span>20</span>)<br>scrdf = pd.DataFrame({<span>'scr_score'</span>: out[<span>0</span>], <span>'scr_pred'</span>: out[<span>1</span>]}, index=ad.obs.index)<br>ad.obs = pd.concat([ad.obs, scrdf], axis=<span>1</span>)<br>ctrl13 = ad.copy()</code></pre><pre><code>ad = ctrl14.copy()<br>scrub = scr.Scrublet(ad.X, expected_doublet_rate=ad.n_obs*<span>8</span>*<span>1e-6</span>)<br>out = scrub.scrub_doublets(verbose=<span>False</span>, n_prin_comps=<span>20</span>)<br>scrdf = pd.DataFrame({<span>'scr_score'</span>: out[<span>0</span>], <span>'scr_pred'</span>: out[<span>1</span>]}, index=ad.obs.index)<br>ad.obs = pd.concat([ad.obs, scrdf], axis=<span>1</span>)<br>ctrl14 = ad.copy()</code></pre><pre><code>ad = ctrl19.copy()<br>scrub = scr.Scrublet(ad.X, expected_doublet_rate=ad.n_obs*<span>8</span>*<span>1e-6</span>)<br>out = scrub.scrub_doublets(verbose=<span>False</span>, n_prin_comps=<span>20</span>)<br>scrdf = pd.DataFrame({<span>'scr_score'</span>: out[<span>0</span>], <span>'scr_pred'</span>: out[<span>1</span>]}, index=ad.obs.index)<br>ad.obs = pd.concat([ad.obs, scrdf], axis=<span>1</span>)<br>ctrl19 = ad.copy()</code></pre><pre><code>ctrl19.obs.head()</code></pre><p><img data-galleryid="" data-imgfileid="100001686" data-ratio="0.42769857433808556" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6RuewAvVvicOWVwMGuWx88zO5tP4YzdhLNK6dwyPB2tvcU0j6H5fXzaQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="491" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6RuewAvVvicOWVwMGuWx88zO5tP4YzdhLNK6dwyPB2tvcU0j6H5fXzaQ/640?wx_fmt=png&amp;from=appmsg"></p><h2><br></h2><h2><strong><span>质控指标</span></strong></h2><section><span>单细胞质控一般会考虑线粒体、核糖体和血红蛋白基因的百分比，以及细胞的基因数和分子数。血红蛋白基因的比例可以指示红细胞污染的程度，线粒体指标可以提示细胞状态。低质量细胞的线粒体基因比例会升高，有文献报道了可能的机理：细胞质RNA可以从损坏的细胞膜裂缝逸出，但是线粒体比单个转录分子大，不太可能通过细胞膜的裂缝逃逸。细胞的基因数和UMI分子数也可以反映细胞的质量，数量太低可能是细胞碎片，太高则可能是两个或多个细胞结团的情况。需要注意的是部分细胞（如：肌肉、心肌、肝细胞等）的线粒体基因比例本身偏高，基因中位数也会因细胞类型不同而存在天然的差异。质量不好的细胞通常会在降维聚类前过滤掉。</span></section><pre><code><span># 合并多个样本的数据</span><br>adlist = [covid1, covid15, covid16, covid17, ctrl5, ctrl13, ctrl14, ctrl19]<br>adata = sc.concat(adlist, axis=<span>0</span>)<br></code><code><span>adata</span></code></pre><pre><span>AnnData object with n_obs × n_vars = 12000 × 33538<br>    obs: 'sample', 'type', 'scr_score', 'scr_pred'</span></pre><pre><code>sc.pp.filter_genes(adata, min_cells=<span>1</span>)<br>adata.obs[<span>'sample'</span>] = adata.obs[<span>'sample'</span>].astype(<span>'category'</span>)<br>adata.obs[<span>'type'</span>] = adata.obs[<span>'type'</span>].astype(<span>'category'</span>)<br>adata</code></pre><pre><p><span>AnnData object with n_obs × n_vars = 12000 × 22465<br>    obs: 'sample', 'type', 'scr_score', 'scr_pred'<br>    var: 'n_cells'</span></p></pre><pre><code><span># 识别线粒体、核糖体和红血球基因</span><br><span># mitochondrial genes</span><br>adata.var[<span>'mt'</span>] = adata.var_names.<span>str</span>.startswith(<span>'MT-'</span>)<br><span># ribosomal genes</span><br>adata.var[<span>'ribo'</span>] = adata.var_names.<span>str</span>.startswith((<span>"RPS"</span>, <span>"RPL"</span>))<br><span># hemoglobin genes.</span><br>adata.var[<span>'hb'</span>] = adata.var_names.<span>str</span>.contains((<span>'HBA1|HBA2|HBB|HBD|HBE1|HBG1|HBG2|HBM|HBQ1|HBZ'</span>))<br><br><span># 计算质控指标</span><br>sc.pp.calculate_qc_metrics(adata, qc_vars=[<span>'mt'</span>, <span>'ribo'</span>, <span>'hb'</span>],<br>                           percent_top=<span>None</span>, log1p=<span>False</span>, inplace=<span>True</span>)</code></pre><pre><code>adata.obs.head()</code></pre><p><img data-galleryid="" data-imgfileid="100001687" data-ratio="0.2388888888888889" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6jfmQCbicDYuwDNTvicLwJSLmVh6rwx0ZxgKWtqzW1Aiboj16FibORvbzibQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6jfmQCbicDYuwDNTvicLwJSLmVh6rwx0ZxgKWtqzW1Aiboj16FibORvbzibQ/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><pre><code>adata.write_h5ad(<span>'pbmc_8s_raw.h5ad'</span>, compression=<span>'gzip'</span>)</code></pre><h2><br></h2><h2><strong><span>数据过滤</span></strong></h2><pre><code>adata = sc.read_h5ad(<span>"pbmc_8s_raw.h5ad"</span>)</code></pre><pre><code>adata.obs_keys</code></pre><pre><section><span>obs: 'sample', 'type', 'scr_score', 'scr_pred', </span></section><section><span>'n_genes_by_counts', 'total_counts', 'total_counts_mt',</span></section><section><span>'pct_counts_mt', 'total_counts_ribo', 'pct_counts_ribo',</span></section><section><span>'total_counts_hb', 'pct_counts_hb'</span></section></pre><pre><code><span>### 查看过滤前的质控指标</span><br>sc.pl.violin(adata, [<span>'n_genes_by_counts'</span>, <span>'total_counts'</span>, <span>'scr_score'</span>], jitter=<span>0.4</span>,<br>             groupby = <span>'sample'</span>, rotation= <span>45</span>, save = <span>"_before_qc_p1.pdf"</span>)</code></pre><p><img data-galleryid="" data-imgfileid="100001688" data-ratio="0.36018518518518516" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6GFZqKEsf4dicMypD0b15HjjJGzjrdKunwSRnkGKbqJ8RLnMVEUQRfxQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6GFZqKEsf4dicMypD0b15HjjJGzjrdKunwSRnkGKbqJ8RLnMVEUQRfxQ/640?wx_fmt=png&amp;from=appmsg"></p><pre><code>sc.pl.violin(adata, [<span>'pct_counts_mt'</span>, <span>'pct_counts_hb'</span>, <span>'pct_counts_ribo'</span>], jitter=<span>0.4</span>,<br>             groupby = <span>'sample'</span>, rotation= <span>45</span>, save = <span>"_before_qc_p2.pdf"</span>)</code></pre><pre></pre><figure><p><img data-galleryid="" data-imgfileid="100001689" data-ratio="0.36666666666666664" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6EictcYib8ZvNQJSnibJb43TuCibzJ6CnmUCMOavqoujFcvzDyqDGwHINew/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6EictcYib8ZvNQJSnibJb43TuCibzJ6CnmUCMOavqoujFcvzDyqDGwHINew/640?wx_fmt=png&amp;from=appmsg"></p></figure><pre><code><span># 查看预测的doublets数量</span><br><span>sum</span>(adata.obs[<span>'scr_pred'</span>])</code></pre><pre>  <span>82</span></pre><pre><code>sc.pp.filter_cells(adata, min_genes=<span>200</span>)<br>sc.pp.filter_genes(adata, min_cells=<span>3</span>)<br>adata = adata[adata.obs[<span>'n_genes_by_counts'</span>] &lt;= <span>4000</span>, :]<br>adata = adata[adata.obs[<span>'total_counts'</span>] &lt;= <span>20000</span>, :]<br>adata = adata[adata.obs[<span>'pct_counts_mt'</span>] &lt;= <span>25</span>, :]<br>adata = adata[adata.obs[<span>'pct_counts_hb'</span>] &lt;= <span>1</span>, :]<br>adata = adata[~adata.obs[<span>'scr_pred'</span>], :]<br>adata</code></pre><pre><p><span>过滤后还剩8037个细胞和19471的基因。</span></p></pre><pre><code><span>### 查看过滤后的质控指标</span><br>sc.pl.violin(adata, [<span>'n_genes_by_counts'</span>, <span>'total_counts'</span>, <span>'scr_score'</span>], jitter=<span>0.4</span>,<br>             groupby = <span>'sample'</span>, rotation= <span>45</span>, save = <span>"_after_qc_p1.pdf"</span>)</code></pre><p><img data-galleryid="" data-imgfileid="100001690" data-ratio="0.36018518518518516" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy640H9tTBUPrGxpVOeeehS7BGNNLLEibwjYND2via2uYNdx5riacjNYrN3g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy640H9tTBUPrGxpVOeeehS7BGNNLLEibwjYND2via2uYNdx5riacjNYrN3g/640?wx_fmt=png&amp;from=appmsg"></p><pre><code>sc.pl.violin(adata, [<span>'pct_counts_mt'</span>, <span>'pct_counts_hb'</span>, <span>'pct_counts_ribo'</span>], jitter=<span>0.4</span>,<br>             groupby = <span>'sample'</span>, rotation= <span>45</span>, save = <span>"_after_qc_p2.pdf"</span>)</code></pre><p><img data-galleryid="" data-imgfileid="100001691" data-ratio="0.3675925925925926" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6Ggl1ASDlwibjWgOfOZ3n9cjJfQIpqxfSpOInPOdrt9oV33FH6HYWxicA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFhJPNrphgpbY7l3skdsFy6Ggl1ASDlwibjWgOfOZ3n9cjJfQIpqxfSpOInPOdrt9oV33FH6HYWxicA/640?wx_fmt=png&amp;from=appmsg"></p><pre><code>adata.write_h5ad(<span>"adata_qc.h5ad"</span>, compression=<span>"gzip"</span>)</code></pre><h2><strong></strong></h2><h2><br></h2><p><br></p><section><strong><span>交流合作</span></strong></section><section><strong><span>Kinesin专业从事单细胞与空转数据的分析与培训，有此需求的朋友欢迎加微信洽谈合作。本公众号交流群向</span></strong><span>科研院校师生和公司生信人员</span><strong><span>开放，希望入群的朋友也可加我微信申请。</span></strong></section><section><br></section><section><img data-imgfileid="100001692" data-ratio="0.3194444444444444" data-src="https://mmbiz.qpic.cn/mmbiz_png/VTXDic6Eia0AGtAkJEKftUWtdPkZueleqBSVLS2GsSIKZHyGr0FWAu8nRuywTXiaGlZnCNNnicibR2vBlWI19trNoHQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="1080" width="677px" src="https://mmbiz.qpic.cn/mmbiz_png/VTXDic6Eia0AGtAkJEKftUWtdPkZueleqBSVLS2GsSIKZHyGr0FWAu8nRuywTXiaGlZnCNNnicibR2vBlWI19trNoHQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section><br></section><section><br></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/1T2-IdQ4HaE9VaKaqTZ6CQ",target="_blank" rel="noopener noreferrer">原文链接</a>
