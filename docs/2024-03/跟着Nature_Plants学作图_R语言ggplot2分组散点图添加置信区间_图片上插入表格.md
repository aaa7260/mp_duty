---
title: "跟着Nature Plants学作图：R语言ggplot2分组散点图添加置信区间/图片上插入表格"
date: 2024-03-24T00:38:10Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Acdemic"]
---
跟着Nature Plants学作图：R语言ggplot2分组散点图添加置信区间/图片上插入表格 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><h2 data-tool="mdnice编辑器"><span></span><span>论文</span><span></span><span> </span></h2><blockquote data-tool="mdnice编辑器"><span></span><h1><span></span><span>Heritable microbiome variation is correlated with source environment in locally adapted maize varieties</span><span></span></h1></blockquote><p data-tool="mdnice编辑器">https://www.nature.com/articles/s41477-024-01654-7</p><p data-tool="mdnice编辑器">论文中提供了作图用到的原始数据，我们可以试着用原始数据复现论文中的图，今天的推文我们来复现一下论文中的Figure1a</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100013274" data-ratio="0.38644688644688646" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5L32MF9BvIUR5O9XnFDO2QUSdqrs68icfKgZWShb05PoFWLEnRDHnlSqiacuQgZOQK4I5BkAAFcPAg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1092" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5L32MF9BvIUR5O9XnFDO2QUSdqrs68icfKgZWShb05PoFWLEnRDHnlSqiacuQgZOQK4I5BkAAFcPAg/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">今天推文比较重要的知识点是</p><ul data-tool="mdnice编辑器"><li><section>分组添加置信椭圆</section></li><li><section>在图片上插入表格</section></li></ul><p data-tool="mdnice编辑器">插入表格主要想实现上图文字的效果：插入多行文字，有的文字是常规字体，有的文字带斜体上下标这种</p><p data-tool="mdnice编辑器">参考这个链接 https://cran.r-project.org/web/packages/gridExtra/vignettes/tableGrob.html</p><h2 data-tool="mdnice编辑器"><span></span><span>部分示例数据</span><span></span><span> </span></h2><figure data-tool="mdnice编辑器"><img data-imgfileid="100013271" data-ratio="0.44664268585131894" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5L32MF9BvIUR5O9XnFDO2QyRfYMMmMUcReiadCW3fjt2TeWiaE0lOXVY5L3wrOicibNDhichvGwmyYf1Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1668" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5L32MF9BvIUR5O9XnFDO2QyRfYMMmMUcReiadCW3fjt2TeWiaE0lOXVY5L3wrOicibNDhichvGwmyYf1Q/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>加载需要用到的R包</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(readxl)<br>library(tidyverse)<br>library(gridExtra)<br></code></pre><p data-tool="mdnice编辑器">gridExtra用来在图片上插入表格</p><h2 data-tool="mdnice编辑器"><span></span><span>读取数据</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>read_excel(<span>"D:/R_4_1_0_working_directory/env001/data/20240322/41477_2024_1654_MOESM4_ESM.xlsx"</span>,<br>           sheet = <span>"Fig1a"</span>) -&gt; fig1a.dat<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>作图代码</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>fig1a.dat %&gt;% <br>  filter(Compartment==<span>"Rhizosphere"</span>) %&gt;% <br>  ggplot(aes(x=CAP1,y=CAP2))+<br>  geom_point(aes(fill=Treatment),<br>             shape=21,size=5,<br>             color=<span>"gray"</span>,<br>             alpha=0.8)+<br>  stat_ellipse(aes(group = Treatment), <br>               size = 0.5, <br>               level = 0.95,<br>               show.legend = F,<br>               lty=<span>"dashed"</span>)+<br>  labs(x=<span>"CAP1 (22.6%)"</span>,y=<span>"CAP2 (6.8%)"</span>)+<br>  theme_bw(base_size = 15)+<br>  theme(panel.grid = element_blank(),<br>        panel.border = element_blank(),<br>        axis.line = element_line())+<br>  annotate(geom=<span>"text"</span>,x=-0.2,y=0.3,<br>           label=<span>"Rhizosphere bacteria"</span>,<br>           size=5,hjust=0)-&gt; plot.a1<br>plot.a1<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100013270" data-ratio="0.7879161528976573" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5L32MF9BvIUR5O9XnFDO2QRmucN0p3ssSNICg8SmCMymQEM5RvsUNlg3cJLNicekViaib433Zufy4hg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="811" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5L32MF9BvIUR5O9XnFDO2QRmucN0p3ssSNICg8SmCMymQEM5RvsUNlg3cJLNicekViaib433Zufy4hg/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">(论文中的图的配色不是很好看，这里就不改配色了)</p><p data-tool="mdnice编辑器">添加表格</p><pre data-tool="mdnice编辑器"><span></span><code>plot.a1 +<br>  annotation_custom(tableGrob(mytable,rows = NULL,cols = NULL,<br>                              theme = ttheme_minimal(core=list(fg_params=list(hjust=0,<br>                                                                              parse=TRUE,<br>                                                                              x=0,<br>                                                                              fontsize=15)))),<br>                    xmin=0.25, xmax=0.3, ymin=0, ymax=0.3)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100013272" data-ratio="0.7504132231404959" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5L32MF9BvIUR5O9XnFDO2QYdSdmRUQtIT8JtfYHLKTG5Eo51zeCOW1e1l0gqwTTzVL58A7WnGK5A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1210" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5L32MF9BvIUR5O9XnFDO2QYdSdmRUQtIT8JtfYHLKTG5Eo51zeCOW1e1l0gqwTTzVL58A7WnGK5A/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">第二个图也是一样的代码</p><pre data-tool="mdnice编辑器"><span></span><code>fig1a.dat %&gt;% <br>  filter(Compartment==<span>"Root"</span>) %&gt;% <br>  ggplot(aes(x=CAP1,y=CAP2))+<br>  geom_point(aes(fill=Treatment),<br>             shape=22,size=5,<br>             color=<span>"gray"</span>,<br>             alpha=0.8)+<br>  stat_ellipse(aes(group = Treatment), <br>               size = 0.5, <br>               level = 0.95,<br>               show.legend = F,<br>               lty=<span>"dashed"</span>)+<br>  labs(x=<span>"CAP1 (22.6%)"</span>,y=<span>"CAP2 (6.8%)"</span>)+<br>  theme_bw(base_size = 15)+<br>  theme(panel.grid = element_blank(),<br>        panel.border = element_blank(),<br>        axis.line = element_line())+<br>  annotate(geom=<span>"text"</span>,x=-0.2,y=0.3,<br>           label=<span>"Rhizosphere bacteria"</span>,<br>           size=5,hjust=0)+<br>  xlim(NA,1.1)+<br>  annotation_custom(tableGrob(mytable,rows = NULL,cols = NULL,<br>                              theme = ttheme_minimal(core=list(fg_params=list(hjust=0,<br>                                                                              parse=TRUE,<br>                                                                              x=0,<br>                                                                              fontsize=15)))),<br>                    xmin=1.05, xmax=1.1, ymin=0, ymax=0.3) -&gt; plot.a2<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>组合图</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(patchwork)<br>pdf(file = <span>"Rplot2.pdf"</span>,width = 18.8,height = 8)<br>plot.a1+plot.a2+<br>  plot_layout(guides=<span>"collect"</span>)&amp; theme(legend.position = <span>'bottom'</span>)<br>dev.off()<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100013273" data-ratio="0.42146017699115046" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5L32MF9BvIUR5O9XnFDO2QoibtQH6vMU881lpUunX6cugD5C662EwNViaLjz276amhQMT2ib7K2D7DQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1808" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk5L32MF9BvIUR5O9XnFDO2QoibtQH6vMU881lpUunX6cugD5C662EwNViaLjz276amhQMT2ib7K2D7DQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器"><strong>欢迎大家关注我的公众号</strong></p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzI3NzQ3MTcxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5t1sOnM0iabvBhnfIj5YpyqrMib0E1MGCd9ibcYxaOPZd0GWhQBDvK2BPEwsicQxd6y5MHLfphnwHnow/0?wx_fmt=png" data-nickname="小明的数据分析笔记本" data-alias="" data-signature="分享R语言和python在生物信息领域做数据分析和数据可视化的简单小例子；偶尔会分享一些组学数据处理相关的内容" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"><strong></strong></p><blockquote data-tool="mdnice编辑器"><span></span><p>小明的数据分析笔记本 公众号 主要分享：1、R语言和python做数据分析和数据可视化的简单小例子；2、园艺植物相关转录组学、基因组学、群体遗传学文献阅读笔记；3、生物信息学入门学习资料及自己的学习笔记！</p></blockquote><p data-tool="mdnice编辑器">微信公众号好像又有改动，如果没有将这个公众号设为星标的话，会经常错过公众号的推文，个人建议将 小明的数据分析笔记本 公众号添加星标，添加方法是 <strong>点开公众号的页面，右上角有三个点</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100013279" data-ratio="0.9693333333333334" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk5L32MF9BvIUR5O9XnFDO2QNzF2oicSyU70UeRIvBZdibvicyqteuHJzrPLRNYpgkNL7vpicvLB9k3icZw/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="750" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk5L32MF9BvIUR5O9XnFDO2QNzF2oicSyU70UeRIvBZdibvicyqteuHJzrPLRNYpgkNL7vpicvLB9k3icZw/640?wx_fmt=other&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>点击三个点，会跳出界面</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100013278" data-ratio="2.120879120879121" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk5L32MF9BvIUR5O9XnFDO2QohADAbv6ox3Kbmnp2BP8H3GIusZQRycvIte4gcPe4QdpqgibN5rsKUw/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="364" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/t1wZDoUyFk5L32MF9BvIUR5O9XnFDO2QohADAbv6ox3Kbmnp2BP8H3GIusZQRycvIte4gcPe4QdpqgibN5rsKUw/640?wx_fmt=other&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>直接点击</strong></p><p data-tool="mdnice编辑器">若有收获，就点个赞吧</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/zpvh3fNibxPxJ-xD5v4PSA",target="_blank" rel="noopener noreferrer">原文链接</a>
