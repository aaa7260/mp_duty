---
title: "ggplot2优雅绘制多元素箱线图"
date: 2024-03-15T10:58:47Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
ggplot2优雅绘制多元素箱线图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>最近在会员交流群看到大家分享一张图，簇状箱线图+p值；此图属于比较基础的一类图，但是也有不少细节需要调整，本节小编来稍微复现一下，数据为随意构建无实际意义仅供参考，希望对各位观众老爷能有所帮助。<strong>「数据代码已经整合上传到会员交流群」</strong>，购买过小编VIP的朋友可在所加的会员群内获取下载，有需要的朋友可关注文中介绍加入VIP交流群。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>案例图</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-imgfileid="100026555" data-ratio="1.1008174386920981" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZPqmXeLZ1QaiaDuiaBACN26UuS5RIQaibdVsZLlY0jcgGSKcEWAAZHOae8fpN6z2Bia2yZgHvdmK1GZg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="734" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZPqmXeLZ1QaiaDuiaBACN26UuS5RIQaibdVsZLlY0jcgGSKcEWAAZHOae8fpN6z2Bia2yZgHvdmK1GZg/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>仿图</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-imgfileid="100026553" data-ratio="1.1136842105263158" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZPqmXeLZ1QaiaDuiaBACN26UvAPnyfKjic42ZSelD70PtAT4U1L8CwNlHVrnUsWExZFpwNfcThgCiaibQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="950" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZPqmXeLZ1QaiaDuiaBACN26UvAPnyfKjic42ZSelD70PtAT4U1L8CwNlHVrnUsWExZFpwNfcThgCiaibQ/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>绘图思路</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>此图归类于簇状箱线图，图中叠加元素主要有阴影背景条带、p值、显著性条带、图例文本颜色、图例位置等，细节繁多需要调整多个参数</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关于永久群内容的说明</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>给予长期支持我们的读者们一个特别待遇：购买小编VIP会员文档的读者，<strong>「将自动获得2024年及以后更新的绘图文档代码，无需额外付费」</strong>。目前会员文档(2023+2024)<strong>「已经更新上传了140+案例文档」</strong>，每个案例都附有相应的数据和代码，并配有对应的注释文档，方便大家学习和参考。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>install.packages(<span>"ggplot2"</span>)<br><span>library</span>(tidyverse)<br><span>library</span>(rstatix)<br><span>library</span>(GGally)<br><span>library</span>(ggtext)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- read_tsv(<span>"diff_GeneExp.txt"</span>) %&gt;% <br>  pivot_longer(-ID) %&gt;% <br>  mutate(type=map_chr(name, ~str_split(.x, <span>"_"</span>)[[<span>1</span>]][length(str_split(.x, <span>"_"</span>)[[<span>1</span>]])]))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>统计分析</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df_pvalue &lt;- df %&gt;% group_by(ID) %&gt;%<br>  wilcox_test(value ~type) %&gt;%<br>  adjust_pvalue(p.col = <span>"p"</span>, method = <span>"bonferroni"</span>) %&gt;%<br>  add_significance(p.col = <span>"p.adj"</span>) %&gt;% <br>  select(ID,p.adj)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据整合</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>dff &lt;- df %&gt;% left_join(.,df_pvalue,by=<span>"ID"</span>) %&gt;% <br>  mutate(group=case_when(p.adj &lt; <span>0.00001</span> ~ <span>"Upregulated"</span>,<br>         <span>TRUE</span> ~ <span>"NS"</span>)) %&gt;% <br>  mutate(p.adj=paste(<span>"p="</span>,p.adj,sep=<span>""</span>))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>dff %&gt;% ggplot(aes(value,ID))+<br>  geom_stripped_rows(odd=<span>"grey90"</span>,xfrom =-<span>0.5</span>, xto =<span>9.5</span>)+<br>  geom_boxplot(aes(color=type),position = position_dodge(<span>0.5</span>),<br>               width=<span>0.5</span>,outliers = <span>FALSE</span>)+<br>  geom_text(data=dff %&gt;% select(<span>1</span>,p.adj) %&gt;% distinct(),<br>            aes(x=<span>8.2</span>,y=ID,label=p.adj),size=<span>3</span>,color=<span>"black"</span>)+<br>  scale_x_continuous(limits = c(<span>0</span>,<span>10</span>),breaks = c(<span>2</span>,<span>4</span>,<span>6</span>,<span>8</span>))+<br>  scale_y_discrete(expand =c(<span>0</span>,<span>0.5</span>))+<br>  scale_fill_manual(values =c(<span>"Upregulated"</span>=<span>"#7294D4"</span>,<span>"NS"</span>=<span>"grey"</span>))+<br>  labs(x=<span>NULL</span>,y=<span>NULL</span>)+<br>  theme_classic()+<br>  theme(plot.margin=unit(c(<span>0.5</span>,<span>0.5</span>,<span>0.5</span>,<span>0.5</span>),unit=<span>"cm"</span>),<br>        legend.justification.top = <span>"left"</span>,<br>        legend.text = element_markdown(),<br>        legend.background = element_blank(),<br>        axis.line.x.bottom = element_blank(),<br>        axis.text=element_text(color=<span>"black"</span>))<br></code></pre><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节介绍到此结束，有需要学习数据可视化的朋友欢迎加入小编的VIP会员群，购买小编VIP会员文档的读者，<strong>「将自动获得2024年及以后更新的绘图文档代码，无需额外付费」</strong>。目前会员文档(2023+2024)<strong>「已经更新上传了140+案例文档」</strong>，每个案例都附有相应的数据和代码，并配有对应的注释文档，方便大家学习和参考。<strong>「有需要者欢迎店铺咨询购买」</strong></p><span>❞</span></blockquote><p data-tool="mdnice编辑器"><strong>「2024更新的绘图内容同时包含数据+代码+markdown注释文档+文档清单」</strong><img data-imgfileid="100026556" data-ratio="0.6176961602671118" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZPqmXeLZ1QaiaDuiaBACN26UGg3Vp7KvTbWKJhP1GFpG7ZepbWrkHP1icuTvxoK2xb1q3ibD0vOXmznw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="2396" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZPqmXeLZ1QaiaDuiaBACN26UGg3Vp7KvTbWKJhP1GFpG7ZepbWrkHP1icuTvxoK2xb1q3ibD0vOXmznw/640?wx_fmt=png&amp;from=appmsg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺(长按二维码跳转)</span><span></span></h3><p><img data-galleryid="" data-imgfileid="100019415" data-ratio="1.0210420841683367" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg" data-type="jpeg" data-w="998" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/LJAFYTAfvVKMKrWa85FJTw",target="_blank" rel="noopener noreferrer">原文链接</a>
