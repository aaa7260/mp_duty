---
title: "GSE212199分析与Figure1部分复现"
date: 2024-03-14T11:20:01Z
draft: ["false"]
tags: [
  "fetched",
  "生信漫漫学"
]
categories: ["Acdemic"]
---
GSE212199分析与Figure1部分复现 by 生信漫漫学
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span></span><span>写在开头</span><span></span></h3><p data-tool="mdnice编辑器">其实一直在通过<strong>阅读单细胞文献学习以及扎实背景知识，也把阅读笔记分享在单细胞天地中，是<a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI1Njk4ODE0MQ==&amp;action=getalbum&amp;album_id=3100581274722926594&amp;scene=173&amp;subscene=227&amp;sessionid=1710409281&amp;enterid=1710409283&amp;from_msgid=2247520569&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" data-linktype="2">#单细胞实战100次</a></strong></p><p data-tool="mdnice编辑器">然后新的一年不仅有推文的整理，也会在生信技能树开始进行直播分享，<strong>今年技能树有个系列直播，在每周四17：00开始的《转录组和单细胞上游基于Linux的数据分析》，以及周五17：00的《转录组和单细胞下游基于R的数据分析》</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100002950" data-ratio="1.3375" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmg5qCx5w4172TiajwLMzNwqiakWTeAcv4zjNjcJibj3ygiaAZcz52C7U7pSg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="400" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmg5qCx5w4172TiajwLMzNwqiakWTeAcv4zjNjcJibj3ygiaAZcz52C7U7pSg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528733&amp;idx=2&amp;sn=75d8aa3a5e028380d1cc807e10acab56&amp;scene=21#wechat_redirect" data-linktype="2">转录组和单细胞转录组及空间组学的2024全年直播安排！</a></p><p data-tool="mdnice编辑器">那最近对<strong>GSE212199这个数据集比较感兴趣，也整理了对应文献的笔记，<a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247520569&amp;idx=1&amp;sn=e06296029c6905d6664df9aa80a9cdd2&amp;scene=21#wechat_redirect" data-linktype="2">中枢神经系统免疫细胞的单细胞RNA转录组分析</a></strong></p><p data-tool="mdnice编辑器">所以来分享一下<strong>GSE212199数据分析笔记以及细胞降维聚类分群的Figure1部分内容叭！</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100002954" data-ratio="0.6097972972972973" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgb3XPgX1nqvibibugSBWVsibnJ3RWpmuPRBPuQrpZMO46Q7MW74Efd7nog/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="592" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgb3XPgX1nqvibibugSBWVsibnJ3RWpmuPRBPuQrpZMO46Q7MW74Efd7nog/640?wx_fmt=png&amp;from=appmsg"><figcaption>Figure1 b</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>单细胞转录组数据情况</span><span></span></h3><p data-tool="mdnice编辑器">数据链接是：https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE212199</p><p data-tool="mdnice编辑器">数据情况是：有两个分组<strong>Mock以及WNV</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>#samples</span><br>GSM6513450 Female Mock F1<br>GSM6513451 Male Mock M1<br>GSM6513452 Female WNV F2<br>GSM6513453 Male WNV M2<br><br><span>#数据详情</span><br>GSM6513450_F1_barcodes.tsv.gz 5.0 Kb<br>GSM6513450_F1_features.tsv.gz 272.8 Kb<br>GSM6513450_F1_matrix.mtx.gz 5.2 Mb<br>GSM6513451_M1_barcodes.tsv.gz 7.5 Kb<br>GSM6513451_M1_features.tsv.gz 272.8 Kb<br>GSM6513451_M1_matrix.mtx.gz 8.2 Mb<br>GSM6513452_F2_barcodes.tsv.gz 6.9 Kb<br>GSM6513452_F2_features.tsv.gz 272.8 Kb<br>GSM6513452_F2_matrix.mtx.gz 7.1 Mb<br>GSM6513453_M2_barcodes.tsv.gz 7.6 Kb<br>GSM6513453_M2_features.tsv.gz 272.8 Kb<br>GSM6513453_M2_matrix.mtx.gz 8.2 Mb<br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100002952" data-ratio="0.9901685393258427" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgNLIDwlRoDvvofnsEQPpkCaibLLtwNbxIGLbpeN3ibkaJJxr2EU8vRpKQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="712" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgNLIDwlRoDvvofnsEQPpkCaibLLtwNbxIGLbpeN3ibkaJJxr2EU8vRpKQ/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>数据下载整理以及读取</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span></span><p>所有的代码及运行脚本均来源于生信技能树！</p></blockquote><p data-tool="mdnice编辑器">提供的是10X格式的标准三个文件，选择<strong>下载数据之后需要对数据进行整理，将三个文件分别整理到对应的文件夹中。</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>#整理文件</span><br>fs=list.files(<span>'./'</span>,<span>'features'</span>)<br>fs<br><br>samples1= gsub(<span>'.tsv.gz'</span>,<span>''</span>,gsub(<span>'features.'</span>,<span>''</span>,fs))<br>samples1<br><br>samples2 = samples1<br><br>lapply(1:length(samples2), <span>function</span>(i){<br>  x=samples2[i]<br>  y=fs[i]<br>  dir.create(x,recursive = T)<br>  file.copy(from= y ,<br>            to=file.path(x,  <span>'features.tsv.gz'</span> )) <br>  file.copy(from= gsub(<span>'features'</span>,<span>'matrix'</span>,gsub(<span>'tsv'</span>,<span>'mtx'</span>,y)),<br>            to= file.path(x, <span>'matrix.mtx.gz'</span> ) ) <br>  file.copy(from= gsub(<span>'features'</span>,<span>'barcodes'</span>,y),<br>            to= file.path(x, <span>'barcodes.tsv.gz'</span> )) <br>  <br>})<br><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100002953" data-ratio="0.50293542074364" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgkmjvicBEfkDGMNRYNHLefNFQJuDCn6WBJadlvnle6apxnIctuuEKyww/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1022" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgkmjvicBEfkDGMNRYNHLefNFQJuDCn6WBJadlvnle6apxnIctuuEKyww/640?wx_fmt=png&amp;from=appmsg"><figcaption>整理前</figcaption></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100002951" data-ratio="0.26204238921001927" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmghBcDxNBbUClVsUPib2cbIHC87YdcnDicQWhfpQBIa47QzWyrgTp6YvYw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1038" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmghBcDxNBbUClVsUPib2cbIHC87YdcnDicQWhfpQBIa47QzWyrgTp6YvYw/640?wx_fmt=png&amp;from=appmsg"><figcaption>整理后</figcaption></figure><p data-tool="mdnice编辑器">加载需要的R包，然后使用<strong>Read10X()函数将数据读取进来，然后创建seurta对象，即可进行后续的降维聚类分群。</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>#指定数据存放位置</span><br>samples=list.files(<span>"./GSE212199_RAW/outputs/"</span>)<br>samples<br>dir &lt;- file.path(<span>'./GSE212199_RAW/outputs/'</span>,samples)<br>names(dir) &lt;- samples<br><span>#读取数据创建Seurat对象</span><br>counts &lt;- Read10X(data.dir = dir)<br><br>sce.all = CreateSeuratObject(counts,<br>                             min.cells = 5,<br>                             min.features = 300 )<br><br>dim(sce.all)   <span>#查看基因数和细胞总数</span><br>as.data.frame(sce.all@assays<span>$RNA</span><span>$counts</span>[1:10, 1:2])<br>table(sce.all@meta.data<span>$orig</span>.ident)  <span>#查看每个样本的细胞数</span><br>head(sce.all@meta.data)<br><br><span># 整理分组信息，通常是隐含在文件名，样品名字里面</span><br>sce.all<span>$group</span>=toupper( substring(colnames(sce.all),12,13))<br><br>table(sce.all@meta.data<span>$group</span>)<br>table(sce.all@meta.data<span>$orig</span>.ident)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span></span><span>质控</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span></span><p>所有的代码及运行脚本均来源于生信技能树！</p></blockquote><p data-tool="mdnice编辑器"><strong>质控——去除掉低质量的基因与细胞</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>#step2:QC质控(运行命令)</span><br>dir.create(<span>"./1-QC"</span>)<br>setwd(<span>"./1-QC"</span>)<br><span># 如果过滤的太狠，就需要去修改这个过滤代码</span><br><span>source</span>(<span>'../scRNA_scripts/qc.R'</span>)<br>sce.all.filt = basic_qc(sce.all)<br><span>print</span>(dim(sce.all))<br><span>print</span>(dim(sce.all.filt))<br>setwd(<span>'../'</span>)<br><span>#指明物种</span><br>sp=<span>'mouse'</span><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100002958" data-ratio="0.7176664832140892" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgeUnKp2fLZcfxZEvbP6iaUibM62Ohg0B7mfcAibMrDuUfs4L2aaJef7kbw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1817" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgeUnKp2fLZcfxZEvbP6iaUibM62Ohg0B7mfcAibMrDuUfs4L2aaJef7kbw/640?wx_fmt=png&amp;from=appmsg"><figcaption>basic_qc函数</figcaption></figure><p data-tool="mdnice编辑器"><strong>过滤结果:确定一下过滤前后的数量差异，如果相差太多要修改质控代码！</strong></p><pre data-tool="mdnice编辑器"><span></span><code>&gt; <span>print</span>(dim(sce.all))<br>[1] 15968  4775<br>&gt; <span>print</span>(dim(sce.all.filt))<br>[1] 15968  4568<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100002955" data-ratio="0.7096219931271478" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmg0I6dYPP3KFOjniaU4WFYO4UHAFCHUMXpUsn0MF0872kibvYQmwbnnkPA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1164" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmg0I6dYPP3KFOjniaU4WFYO4UHAFCHUMXpUsn0MF0872kibvYQmwbnnkPA/640?wx_fmt=png&amp;from=appmsg"><figcaption>质控前</figcaption></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100002956" data-ratio="0.7179930795847751" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgG7gicfvDANRJl8AiaicuExYcoeIEHr7IOHmhd81R9ER7JMVIkJNdI9l1g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1156" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgG7gicfvDANRJl8AiaicuExYcoeIEHr7IOHmhd81R9ER7JMVIkJNdI9l1g/640?wx_fmt=png&amp;from=appmsg"><figcaption>质控后</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>harmony整合多个单细胞样品</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span></span><p>所有的代码及运行脚本均来源于生信技能树！</p></blockquote><p data-tool="mdnice编辑器">因为GSE212199有四个样品，两个分组，咱们就需要使用Harmony整合一下</p><pre data-tool="mdnice编辑器"><span></span><code><span>###### step3: harmony整合多个单细胞样品 ######</span><br>dir.create(<span>"2-harmony"</span>)<br>getwd()<br>setwd(<span>"2-harmony"</span>)<br><span>source</span>(<span>'../scRNA_scripts/harmony.R'</span>)<br><span># 默认 ScaleData 没有添加"nCount_RNA", "nFeature_RNA"</span><br><span># 默认的</span><br>sce.all.int = run_harmony(sce.all.filt)<br>setwd(<span>'../'</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100002959" data-ratio="0.6401734104046243" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgB1Zdhw8RSgaicM4V8YG1N2vmtyrtgUyL26C7bymKbQrP34F5UkbUdVw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="2076" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgB1Zdhw8RSgaicM4V8YG1N2vmtyrtgUyL26C7bymKbQrP34F5UkbUdVw/640?wx_fmt=png&amp;from=appmsg"><figcaption>harmony整合</figcaption></figure><p data-tool="mdnice编辑器"><strong>harmony整合结果：可以根据结果去选择后续的resolution</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100002957" data-ratio="1.001199040767386" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgZTOhp3uTPCbbnVSx1Za8CuicQjrQW10PaiaZsanS4aXTLHOMk0hWejyA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="834" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgZTOhp3uTPCbbnVSx1Za8CuicQjrQW10PaiaZsanS4aXTLHOMk0hWejyA/640?wx_fmt=png&amp;from=appmsg"><figcaption>Tree_diff_resolution</figcaption></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100002962" data-ratio="0.4942459115687462" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgfxAcH5K125Ku8vdG3J1icH0icOKsQDO1Dr1FUyujMXaSgeFjBmFO7QLw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1651" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgfxAcH5K125Ku8vdG3J1icH0icOKsQDO1Dr1FUyujMXaSgeFjBmFO7QLw/640?wx_fmt=png&amp;from=appmsg"><figcaption>resolution_low</figcaption></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100002963" data-ratio="0.3868131868131868" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgtxm1fDQSAehUwAYCzibBN14PJibyqcE99Jw8WRtwTU1lYN31MDiasKZVQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1820" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgtxm1fDQSAehUwAYCzibBN14PJibyqcE99Jw8WRtwTU1lYN31MDiasKZVQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>resolution_high</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>降维聚类分群</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span></span><p>所有的代码及运行脚本均来源于生信技能树！</p></blockquote><p data-tool="mdnice编辑器"><strong>降维的resolution一般我们是选择0.1以及0.8，但是这次根据文章里面的结果图，所以还选择了0.2的分辨率</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>###### step4: 降维聚类分群和看标记基因库 ######</span><br><span>#原则上分辨率是需要自己肉眼判断，取决于个人经验。为了省力，我们直接看0.1和0.8即可</span><br>table(Idents(sce.all.int))<br>table(sce.all.int<span>$seurat_clusters</span>)<br>table(sce.all.int<span>$RNA_snn_res</span>.0.1)<br>table(sce.all.int<span>$RNA_snn_res</span>.0.2) <br>table(sce.all.int<span>$RNA_snn_res</span>.0.8) <br><br>getwd()<br>dir.create(<span>'check-by-0.1'</span>)<br>setwd(<span>'check-by-0.1'</span>)<br>sel.clust = <span>"RNA_snn_res.0.1"</span><br>sce.all.int &lt;- SetIdent(sce.all.int, value = sel.clust)<br>table(sce.all.int@active.ident) <br><br><span>source</span>(<span>'../scRNA_scripts/check-all-markers.R'</span>)<br>setwd(<span>'../'</span>) <br>getwd()<br><br>dir.create(<span>'check-by-0.2'</span>)<br>setwd(<span>'check-by-0.2'</span>)<br>sel.clust = <span>"RNA_snn_res.0.2"</span><br>sce.all.int &lt;- SetIdent(sce.all.int, value = sel.clust)<br>table(sce.all.int@active.ident) <br><span>source</span>(<span>'../scRNA_scripts/check-all-markers.R'</span>)<br>setwd(<span>'../'</span>) <br>getwd()<br><br>dir.create(<span>'check-by-0.8'</span>)<br>setwd(<span>'check-by-0.8'</span>)<br>sel.clust = <span>"RNA_snn_res.0.8"</span><br>sce.all.int &lt;- SetIdent(sce.all.int, value = sel.clust)<br>table(sce.all.int@active.ident) <br><span>source</span>(<span>'../scRNA_scripts/check-all-markers.R'</span>)<br>setwd(<span>'../'</span>) <br>getwd()<br><br>last_markers_to_check<br></code></pre><p data-tool="mdnice编辑器"><strong>那就直接选择0.2进行后续的命名吧！</strong></p><h3 data-tool="mdnice编辑器"><span></span><span></span><span>亚群命名</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span></span><p>所有的代码及运行脚本均来源于生信技能树！</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code><span>###### step5: 确定单细胞亚群生物学名字 ######</span><br><span># 一般来说，为了节省工作量，我们选择0.1的分辨率进行命名</span><br><span># 因为命名这个步骤是纯人工 操作</span><br><span># 除非0.1确实分群太粗狂了，我们就选择0.8 </span><br><span>source</span>(<span>'scRNA_scripts/lib.R'</span>)<br><span>#sce.all.int = readRDS('2-harmony/sce.all_int.rds')</span><br>colnames(sce.all.int@meta.data)<br>DimPlot(sce.all.int,split.by = <span>"orig.ident"</span>  )<br>DimPlot(sce.all.int,group.by = <span>"group"</span>  )<br>FeaturePlot(sce.all.int,<span>'Apoe'</span>,split.by  = <span>"group"</span> )<br>FeaturePlot(sce.all.int,<span>'Cd74'</span>,split.by  = <span>"group"</span> )<br><br><br>astrocytes = c(<span>"AQP4"</span>, <span>"ADGRV1"</span>, <span>"GPC5"</span>, <span>"RYR3"</span>) <br>endothelial = c(<span>"CLDN5"</span>, <span>"ABCB1"</span>, <span>"EBF1"</span>) <br>excitatory = c(<span>"CAMK2A"</span>, <span>"CBLN2"</span>, <span>"LDB2"</span>) <br>inhibitory = c(<span>"GAD1"</span>, <span>"LHFPL3"</span>, <span>"PCDH15"</span>) <br>microglia = c(<span>"C3"</span>, <span>"LRMDA"</span>, <span>"DOCK8"</span>) <br>oligodendrocytes = c(<span>"MBP"</span>, <span>"PLP1"</span>, <span>"ST18"</span>) <br>OPC=<span>'Tnr,Igsf21,Neu4,Gpr17'</span><br>Ependymal=<span>'Cfap126,Fam183b,Tmem212,pifo,Tekt1,Dnah12'</span><br>pericyte=c(  <span>'DCN'</span>, <span>'LUM'</span>,  <span>'GSN'</span> ,<span>'FGF7'</span>,<span>'MME'</span>, <span>'ACTA2'</span>,<span>'RGS5'</span>)<br><br>gene_list = list(<br>  Astro = astrocytes,<br>  Endo = endothelial,<br>  Excit = excitatory,<br>  Inhib = inhibitory,<br>  Mic = microglia,<br>  Oligo = oligodendrocytes,<br>  OPC= str_to_upper(trimws(strsplit(OPC,<span>','</span>)[[1]])),<br>  Ependymal= str_to_upper(trimws(strsplit(Ependymal,<span>','</span>)[[1]])) ,<br>  peri = pericyte<br>)<br>gene_list = lapply(gene_list,<span>function</span>(x){<br>  unique( c(str_to_title(x),str_to_upper(x)))<br>} )<br>gene_list<br>p3=DotPlot(sce.all.int, assay = <span>"RNA"</span>, features = gene_list, <br>           group.by = <span>'RNA_snn_res.0.2'</span><br>) + theme(axis.text.x = element_text(angle = 45, <br>                                     vjust = 0.5, hjust=0.5))<br>p3<br>ggsave(<span>'makers_brain_RNA_snn_res.0.2.pdf'</span>,width = 9)<br><br>table(sce.all.int<span>$RNA_snn_res</span>.0.2)<br><br><span># 付费环节 800 元人民币</span><br><span>if</span>(T){<br>  sce.all.int<br>  celltype=data.frame(ClusterID=0:9,<br>                      celltype= 0:9) <br>  <span>#定义细胞亚群        </span><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 3 ),2]=<span>'CD4+ Tcells'</span><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 2),2]=<span>'CD8+ Tcells'</span><br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c(  4 ),2]=<span>'Myeloids'</span>  <br>  <br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c(  0,1,5,7 ),2]=<span>'microglia'</span>  <br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c(  8 ),2]=<span>'BCells'</span>  <br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c(  9 ),2]=<span>'pericyte'</span>  <br>  <br>  celltype[celltype<span>$ClusterID</span> %<span>in</span>% c( 6 ),2]=<span>'oligodendrocytes'</span>  <br>   <br>  head(celltype)<br>  celltype<br>  table(celltype<span>$celltype</span>)<br>  sce.all.int@meta.data<span>$celltype</span> = <span>"NA"</span><br>  <br>  <span>for</span>(i <span>in</span> 1:nrow(celltype)){<br>    sce.all.int@meta.data[<span>which</span>(sce.all.int@meta.data<span>$RNA_snn_res</span>.0.2 == celltype<span>$ClusterID</span>[i]),<span>'celltype'</span>] &lt;- celltype<span>$celltype</span>[i]}<br>  Idents(sce.all.int)=sce.all.int<span>$celltype</span><br>  <br>  sel.clust = <span>"celltype"</span><br>  sce.all.int &lt;- SetIdent(sce.all.int, value = sel.clust)<br>  table(sce.all.int@active.ident) <br>  <br>  dir.create(<span>'check-by-celltype'</span>)<br>  setwd(<span>'check-by-celltype'</span>)<br>  <span>source</span>(<span>'../scRNA_scripts/check-all-markers.R'</span>)<br>  setwd(<span>'../'</span>) <br>  getwd()<br>}<br><br>phe=sce.all.int@meta.data<br>save(phe,file = <span>'phe.Rdata'</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100002964" data-ratio="0.7284991568296796" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmg6GiceORYvNKibSBMk5Zic8ZGS8jg6DtkxRGuqfLjLJCUgFeiccJWn1pMnQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1779" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmg6GiceORYvNKibSBMk5Zic8ZGS8jg6DtkxRGuqfLjLJCUgFeiccJWn1pMnQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>Marker基因</figcaption></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100002960" data-ratio="1.0766233766233766" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgZjs5FpcXKyS7YFo4y1FdiaribKnrYAYicb01NiaUACCEOc7zHic5ibeX3tCw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="770" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgZjs5FpcXKyS7YFo4y1FdiaribKnrYAYicb01NiaUACCEOc7zHic5ibeX3tCw/640?wx_fmt=png&amp;from=appmsg"><figcaption>last_markers_and_umap</figcaption></figure><p data-tool="mdnice编辑器"><strong>最终的降维聚类分群并命名的结果与文章稍微有一点出入，但是大体是一致的！</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100002961" data-ratio="1.15" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgf57SrOfKWXNVqqvrh75a99GHLzfKlClxbd4t0e3ntcdkhKdLeNicysw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="720" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgf57SrOfKWXNVqqvrh75a99GHLzfKlClxbd4t0e3ntcdkhKdLeNicysw/640?wx_fmt=png&amp;from=appmsg"></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100002965" data-ratio="0.6097972972972973" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgb3XPgX1nqvibibugSBWVsibnJ3RWpmuPRBPuQrpZMO46Q7MW74Efd7nog/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="592" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmgb3XPgX1nqvibibugSBWVsibnJ3RWpmuPRBPuQrpZMO46Q7MW74Efd7nog/640?wx_fmt=png&amp;from=appmsg"><figcaption>Figure1 b</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>写在结尾</span><span></span></h3><p data-tool="mdnice编辑器">之前总是将文献阅读和单细胞数据分析分开，现在会尝试将两者结合起来，那明天也会在<strong>生信技能树视频号给大家分享GSE212199数据集分析的整个流程</strong>。欢迎捧场呀!</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100002969" data-ratio="1.3375" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmg5qCx5w4172TiajwLMzNwqiakWTeAcv4zjNjcJibj3ygiaAZcz52C7U7pSg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="400" src="https://mmbiz.qpic.cn/sz_mmbiz_png/icQem1PXnP9aPG9Uc07QtHtN6xPDJRjmg5qCx5w4172TiajwLMzNwqiakWTeAcv4zjNjcJibj3ygiaAZcz52C7U7pSg/640?wx_fmt=png&amp;from=appmsg"></figure></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/tEOxXADdt_stk1tXs_tTKw",target="_blank" rel="noopener noreferrer">原文链接</a>
