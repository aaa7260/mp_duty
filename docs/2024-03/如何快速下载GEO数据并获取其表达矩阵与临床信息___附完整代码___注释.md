---
title: "如何快速下载GEO数据并获取其表达矩阵与临床信息 | 附完整代码 + 注释"
date: 2024-03-21T15:44:02Z
draft: ["false"]
tags: [
  "fetched",
  "生信小白要知道"
]
categories: ["Acdemic"]
---
如何快速下载GEO数据并获取其表达矩阵与临床信息 | 附完整代码 + 注释 by 生信小白要知道
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>GEO数据库可以说是大家使用频率贼高的数据库啦！那它里面的数据怎么下载大家知道嘛！今天给大家展示一种快速获取它的表达矩阵和临床信息的方法！</p></blockquote><p data-tool="mdnice编辑器">话不多说！咱们直接开始！</p><h2 data-tool="mdnice编辑器"><span></span><span>GEO编号获取</span><span></span></h2><p data-tool="mdnice编辑器">在GEO数据库中，你找到了你需要的数据，接下来怎么办嘞！下载它！处理它！</p><p data-tool="mdnice编辑器">比如，咱们今天需要的数据是这个：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100003490" data-ratio="0.9157407407407407" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLr6OK1JpkxiaAsZxIyb7LYVnSaibl4eafFc3ZV7TgmcthOBLpZoTkeXEp9U0cOvicJK7XtO4gqIjJJuA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLr6OK1JpkxiaAsZxIyb7LYVnSaibl4eafFc3ZV7TgmcthOBLpZoTkeXEp9U0cOvicJK7XtO4gqIjJJuA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">GEO编号这不就有咯！咱们开始下载！噢对，提前吱一声，芯片数据和非芯片数据进行ID转换的时候方法不太一样，大家要注意噢！我今天会都给大家演示一下！</p><blockquote data-tool="mdnice编辑器"><span></span><p><strong>GEO数据库今天咱就不介绍了哈！我后面再专门出一期超级详细地介绍它！迫切的小伙伴可以在后台或群里催我哈哈哈哈哈哈哈哈！</strong></p><p><strong><span>另外注意：</span></strong><span>不是所有的GEO数据集都可以使用这种方法下载。不过通常来说，大部分的GEO数据集都可以通过`getGEO`函数进行下载，但也有一些例外情况，特别是单细胞数据[无奈脸]！多数情况下，应该是数据集可能不是以类似的格式存储，或者有的作者上传格式不对等等，所以就需要找其他办法或者手动下载啦！</span></p><p><span>建议就是先试试这种方法，要是里面是空的，就去手动或者其他！</span></p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>数据下载</span><span></span></h2><h3 data-tool="mdnice编辑器"><span></span><span>芯片数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>#################### GEO数据下载及表达矩阵与临床信息获取 #######################</span><br><br><span># 加载包，没有安装的记得安装一下哟！</span><br><span>library</span>(tidyverse)<br><span>library</span>(GEOquery)<br><span>library</span>(tinyarray)<br><br><span># 芯片数据</span><br><br><span># GEO编号，替换成你自己的就好啦！</span><br>geo_number = <span>"GSE66360"</span><br><br><span># 这一步啊，看运气！网络时好时坏，是个玄学！一次不行不要慌！咱多跑几次！总会成功的！</span><br>geo_data &lt;- getGEO(geo_number, destdir = <span>'./'</span>, getGPL = <span>F</span>) <span># 自己设置想保存的路径</span><br>geo_data0 &lt;- geo_data[[<span>1</span>]]<br></code></pre><p data-tool="mdnice编辑器">数据长这样！</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100003486" data-ratio="0.30277777777777776" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLr6OK1JpkxiaAsZxIyb7LYVnNEoMjLrd8QIs34U48D8ZWFDdN3KXLvaicEAVFhDwfLiaxA6WRfiajLRog/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLr6OK1JpkxiaAsZxIyb7LYVnNEoMjLrd8QIs34U48D8ZWFDdN3KXLvaicEAVFhDwfLiaxA6WRfiajLRog/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code><span># 提取表达矩阵</span><br>exp &lt;- exprs(geo_data0)<br>dim(exp)<br><span># [1] 54675    99</span><br><br>exp[<span>1</span>:<span>4</span>, <span>1</span>:<span>4</span>]<br><span>#           GSM1620819 GSM1620820 GSM1620821 GSM1620822</span><br><span># 1007_s_at   5.866378   4.948736   5.148384   5.064419</span><br><span># 1053_at     8.225790   7.525865   7.764637   7.198461</span><br><span># 117_at      6.179732   6.628137   5.859151   5.974135</span><br><span># 121_at      6.179478   6.582889   6.602135   6.545905</span><br><br><span># 可以看到这里还是探针ID，咱们后给它面转换为基因symbol！</span><br><br><span># 可以自行判断是否需要log</span><br>exp &lt;- log2(exp + <span>0.01</span>)<br><br><span># 接下来我们进行ID转换</span><br><br><span># 探针注释获取</span><br>gpl_number &lt;- geo_data0@annotation<br>ids &lt;- AnnoProbe::idmap(gpl_number)<br>head(ids)<br><span>#         probe_id symbol</span><br><span># 193731   1053_at   RFC2</span><br><span># 193732    117_at  HSPA6</span><br><span># 193733    121_at   PAX8</span><br><span># 193734 1255_g_at GUCA1A</span><br><span># 193735   1316_at   THRA</span><br><span># 193736   1320_at PTPN21</span><br><br><span># ID转换</span><br>exp &lt;- as.data.frame(exp)<br>exp$probe_id &lt;- rownames(exp)<br>exp &lt;- inner_join(ids, exp, by = <span>"probe_id"</span>)<br>exp &lt;- exp[!duplicated(exp$symbol), ] <span># 关于重复基因去重的问题，咱们后面专门出一期介绍！这里先用最大道至简的方法！</span><br>rownames(exp) &lt;- exp$symbol<br>exp &lt;- exp[ , -c(<span>1</span>,<span>2</span>)]<br>head(exp)[<span>1</span>:<span>4</span>, <span>1</span>:<span>4</span>]<br><span>#        GSM1620819 GSM1620820 GSM1620821 GSM1620822</span><br><span># RFC2     3.041907   2.913773   2.958775   2.849691</span><br><span># HSPA6    2.629877   2.730778   2.553152   2.581143</span><br><span># PAX8     2.629818   2.720911   2.725116   2.712795</span><br><span># GUCA1A   1.486482   1.436010   1.373053   1.444733</span><br><br><span># 提取临床信息</span><br>cli &lt;- pData(geo_data0)<br>head(cli)[<span>1</span>:<span>4</span>, <span>1</span>:<span>6</span>]<br><span>#                               title geo_accession                status submission_date last_update_date type</span><br><span># GSM1620819 Muse_1_DISCOVERY_Control    GSM1620819 Public on Feb 28 2015     Feb 27 2015      Feb 28 2015  RNA</span><br><span># GSM1620820 Muse_2_DISCOVERY_Control    GSM1620820 Public on Feb 28 2015     Feb 27 2015      Feb 28 2015  RNA</span><br><span># GSM1620821 Muse_3_DISCOVERY_Control    GSM1620821 Public on Feb 28 2015     Feb 27 2015      Feb 28 2015  RNA</span><br><span># GSM1620822 Muse_4_DISCOVERY_Control    GSM1620822 Public on Feb 28 2015     Feb 27 2015      Feb 28 2015  RNA</span><br><br><span># 为了后续分析，咱还可以给它进一步调整，使表达矩阵列名和临床信息的行名完全一致</span><br>p &lt;- identical(rownames(cli), colnames(exp))<br>p<br><span># [1] TRUE</span><br><br><span># 噢啦！</span><br><br><span># 噢不！还没结束！那万一不是芯片数据怎么办呢！咱们再演示一个！</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>非芯片数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 非芯片数据</span><br><br><span># 比如这个GEO数据集</span><br>geo_number = <span>"GSE16561"</span><br><br><span># 这一步啊，看运气！网络时好时坏，是个玄学！一次不行不要慌！咱多跑几次！总会成功的！</span><br>geo_data &lt;- getGEO(geo_number, destdir = <span>'./'</span>, getGPL = <span>F</span>)<br>geo_data0 &lt;- geo_data[[<span>1</span>]]<br><br><span># 提取表达矩阵</span><br>exp &lt;- exprs(geo_data0)<br>dim(exp)<br><span># [1] 54675    99</span><br><br>exp[<span>1</span>:<span>4</span>, <span>1</span>:<span>4</span>]<br><span>#                GSM416528  GSM416529  GSM416530   GSM416531</span><br><span># ILMN_1343291  0.22550488  0.7348099  0.7431908  0.63261986</span><br><span># ILMN_1651209 -0.03326082  0.5184302  0.5990343  0.25144434</span><br><span># ILMN_1651228 -0.20895290 -0.9036322 -0.3511963 -0.06179523</span><br><span># ILMN_1651229  0.18835354  0.3693209  0.3938241  0.14767408</span><br><br><span># # 可以自行判断是否需要log</span><br><span># exp &lt;- log2(exp + 1)</span><br><br><span># 大家可以看到这玩意儿不是探针，那咱们怎么办呢！</span><br></code></pre><p data-tool="mdnice编辑器">接下来我们进行非芯片数据的ID转换！</p><p data-tool="mdnice编辑器">在你的GEO数据集的主页，可以看见下面这个红框框的地方！这里代表测序平台（<strong>咱们后面会在超详细介绍GEO数据库的时候给大家进行介绍这部分内容</strong>），直接点进去就好！</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100003488" data-ratio="1.1787037037037038" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLr6OK1JpkxiaAsZxIyb7LYVnpjqiaNgt1UNc6ut3EOXv6Cc3TcZCSicicGqWM7XE26PicgAw4TINs4CNkw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLr6OK1JpkxiaAsZxIyb7LYVnpjqiaNgt1UNc6ut3EOXv6Cc3TcZCSicicGqWM7XE26PicgAw4TINs4CNkw/640?wx_fmt=png&amp;from=appmsg"></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100003489" data-ratio="0.9037037037037037" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLr6OK1JpkxiaAsZxIyb7LYVnKUkXJUu1oibzP1jwOVErmBV4m8ag2YRibiaQ551XBZpO63IXzskWQ8Ribg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLr6OK1JpkxiaAsZxIyb7LYVnKUkXJUu1oibzP1jwOVErmBV4m8ag2YRibiaQ551XBZpO63IXzskWQ8Ribg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">长这样！别急！往下滑滑！</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100003487" data-ratio="0.8305555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLr6OK1JpkxiaAsZxIyb7LYVn021ZBBcRys75HzXfV8vyPiafkulpW4awht1GhZFGmJrfYOpsZM9QONA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLr6OK1JpkxiaAsZxIyb7LYVn021ZBBcRys75HzXfV8vyPiafkulpW4awht1GhZFGmJrfYOpsZM9QONA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">哎对！就是这里！点红框框的地方！下载下来！</p><p data-tool="mdnice编辑器">来！咱们继续看看怎么搞！</p><pre data-tool="mdnice编辑器"><span></span><code><span># 文件下载地址：https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GPL6883</span><br>ids &lt;- data.table::fread(<span>"./GPL6883-11606.txt"</span>)<br><br><span># ID转换</span><br>exp &lt;- as.data.frame(exp)<br>exp$ID &lt;- rownames(exp)<br>ids &lt;- ids[ , c(<span>1</span>,<span>12</span>)] <span># 注意：这里选择的是与表达矩阵行名相匹配的列和基因symbol列</span><br>exp &lt;- inner_join(ids, exp, by = <span>"ID"</span>)<br>exp &lt;- exp[!duplicated(exp$Symbol), ]<br>exp &lt;- as.data.frame(exp)<br>rownames(exp) &lt;- exp$Symbol<br>exp &lt;- exp[ , -c(<span>1</span>,<span>2</span>)]<br>head(exp)[<span>1</span>:<span>4</span> ,<span>1</span>:<span>4</span>]<br><span>#              GSM416528  GSM416529   GSM416530  GSM416531</span><br><span># JMJD1A    -0.401840200 -0.2110777 -0.42790460 -0.4261866</span><br><span># NCOA3      0.296299930 -0.3155098 -0.01228809  0.5331011</span><br><span># LOC389834 -0.001213074  0.5300436  0.55930424  0.2009177</span><br><span># SPIRE2     0.127047540  0.5759945  0.45181800  0.4050984</span><br><br><span># 噢啦！</span><br><br><span># 老步骤！</span><br><br><span># 提取临床信息</span><br>cli &lt;- pData(geo_data0)<br>head(cli)[<span>1</span>:<span>4</span>, <span>1</span>:<span>6</span>]<br><span>#                    title geo_accession                status submission_date last_update_date type</span><br><span># GSM416528 3100083_Stroke     GSM416528 Public on Jun 01 2010     Jun 11 2009      Jun 11 2009  RNA</span><br><span># GSM416529 3100191_Stroke     GSM416529 Public on Jun 01 2010     Jun 11 2009      Jun 11 2009  RNA</span><br><span># GSM416530 3100068_Stroke     GSM416530 Public on Jun 01 2010     Jun 11 2009      Jun 11 2009  RNA</span><br><span># GSM416531 3100060_Stroke     GSM416531 Public on Jun 01 2010     Jun 11 2009      Jun 11 2009  RNA</span><br><br><span># 为了后续分析，咱还可以给它进一步调整，使表达矩阵列名和临床信息的行名完全一致</span><br>p &lt;- identical(rownames(cli), colnames(exp))<br>p<br><span># [1] TRUE</span><br></code></pre><p data-tool="mdnice编辑器">这回是真的噢啦！</p><p data-tool="mdnice编辑器">一般使用GEO数据库很可能是多个数据集合并使用，那这个时候，由于数据来源不一样，肯定会有批次效应存在，那大家一定要记得进行批次处理噢！有兴趣的小伙伴们可以查看：<a href="https://mp.weixin.qq.com/s?__biz=Mzg5NjE1NTc1OA==&amp;mid=2247486328&amp;idx=1&amp;sn=b2ef0be85592dfadb9fff61555ec869b&amp;scene=21#wechat_redirect" data-linktype="2">数据挖掘 | 批次效应的鉴定与处理 | 附完整代码 + 注释 | 看完不会来揍我</a></p><p data-tool="mdnice编辑器">在获取表达矩阵和临床信息后，我们还可以进行生存分析：<a href="https://mp.weixin.qq.com/s?__biz=Mzg5NjE1NTc1OA==&amp;mid=2247486420&amp;idx=1&amp;sn=99525c567ad57f834fd755602bcb5d30&amp;scene=21#wechat_redirect" data-linktype="2">看完不会来揍我 | 生存分析详解 | 从基础概念到生存曲线绘制 | 代码注释 + 结果解读</a></p><p data-tool="mdnice编辑器">还有差异分析：<a href="https://mp.weixin.qq.com/s?__biz=Mzg5NjE1NTc1OA==&amp;mid=2247485603&amp;idx=1&amp;sn=355722febb4d4fa8bd83eeb5d2a53df4&amp;scene=21#wechat_redirect" data-linktype="2">看完还不会来揍/找我 | 差异分析三巨头 —— DESeq2、edgeR 和 limma 包 | 附完整代码 + 注释</a></p><p data-tool="mdnice编辑器">还有富集分析：<a href="https://mp.weixin.qq.com/s?__biz=Mzg5NjE1NTc1OA==&amp;mid=2247485652&amp;idx=1&amp;sn=8310ebfd1b3c8c022297a3a65b314cdc&amp;scene=21#wechat_redirect" data-linktype="2">看完还不会来揍我 | GSEA富集分析详解（一）—— 代码实操 | MSigDB数据库介绍 | 附完整代码 + 注释</a></p><p data-tool="mdnice编辑器">哎呀，还有好多好多！大家需要什么，都可以随时搜索！像这样：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100003495" data-ratio="1.174074074074074" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLr6OK1JpkxiaAsZxIyb7LYVneuytkGsf1uicmibhyVYZibaY6kIbNicOVrQA4nxu2L52akMqtwicU27kHww/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLr6OK1JpkxiaAsZxIyb7LYVneuytkGsf1uicmibhyVYZibaY6kIbNicOVrQA4nxu2L52akMqtwicU27kHww/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">暂时还没有的，也可以催更我！！！</p><h2 data-tool="mdnice编辑器"><span></span><span>文末碎碎念</span><span></span></h2><p data-tool="mdnice编辑器">那今天的分享就到这里啦！我们下期再见哟！</p><p data-tool="mdnice编辑器">最后顺便给自己推荐一下嘿嘿嘿！</p><p data-tool="mdnice编辑器">如果我的分享对你有用的话，欢迎<strong>关注点赞在看转发分享</strong>阿巴阿巴阿巴阿巴巴巴！这可是我的第一原动力！</p><p data-tool="mdnice编辑器">蟹蟹你们的喜欢和支持！！！</p><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg5NjE1NTc1OA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLpicdicvWNnpcaTbejCVgKe4FsicHqo48FOkqJTkziaengudibCF8AW86uyjgee0pxhmhM8JoylYDkSXug/0?wx_fmt=png" data-nickname="生信小白要知道" data-alias="Bioidiot" data-signature="主打小白保姆级教程，因为自己淋过雨，所以想给大家撑把伞！ 记录从小白到现在小灰的过程，希望以后可以成为小黑！" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器">如果小伙伴们有需求的话，可以加入我们的交流群：<a href="https://mp.weixin.qq.com/s?__biz=Mzg5NjE1NTc1OA==&amp;mid=2247487109&amp;idx=1&amp;sn=22862390235151378bdecbf488c7c830&amp;scene=21#wechat_redirect" data-linktype="2">一定要知道 | 永久免费的生信交流群终于来啦！</a>！在这里，你可以稍有克制地畅所欲言！</p><p data-tool="mdnice编辑器">超级建议大家在入群前或入群后可以看一下这个：<a href="https://mp.weixin.qq.com/s?__biz=Mzg5NjE1NTc1OA==&amp;mid=2247486350&amp;idx=1&amp;sn=066dedbe912676f5c508b179167084a0&amp;scene=21#wechat_redirect" data-linktype="2">干货满满 | 给生信小白的入门小建议 | 掏心掏肺版</a>！绝对干货满满！让你不虚此看！</p><p data-tool="mdnice编辑器">如果有需要个性化定制分析服务的小伙伴，可以看看这里：<a href="https://mp.weixin.qq.com/s?__biz=Mzg5NjE1NTc1OA==&amp;mid=2247486984&amp;idx=1&amp;sn=b00b48d15e2e19e206803d3e14f05d23&amp;scene=21#wechat_redirect" data-linktype="2">你要的个性化生信分析服务今天正式开启啦！定制你的专属解决方案！全程1v1答疑！</a>！绝对包你满意！</p><p data-tool="mdnice编辑器">入群链接后续可能会不定期更新，主要是因为群满换码或是其他原因，如果小伙伴点开它之后发现，咦，怎么失效啦！不要慌！咱们辛苦一下动动小手去主页的<code>要咨询</code>那里，点击<code>进交流群</code>即可入群！</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100003494" data-ratio="1.0796296296296297" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLr6OK1JpkxiaAsZxIyb7LYVnkrXfGX0zdm4v1PRCy5WKGNccQ6QL9mMLDBO3u6JAzMAeBHchcID0iaA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLr6OK1JpkxiaAsZxIyb7LYVnkrXfGX0zdm4v1PRCy5WKGNccQ6QL9mMLDBO3u6JAzMAeBHchcID0iaA/640?wx_fmt=png&amp;from=appmsg"></figure></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/cLe_xJ_NBbeTDdUv7HjpNQ",target="_blank" rel="noopener noreferrer">原文链接</a>
