---
title: "动态确定线粒体过滤阈值筛选细胞"
date: 2024-03-28T07:05:25Z
draft: ["false"]
tags: [
  "fetched",
  "果子学生信"
]
categories: ["Acdemic"]
---
动态确定线粒体过滤阈值筛选细胞 by 果子学生信
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">线粒体比例过高可能意味着细胞处于凋亡状态，因此在单细胞数据分析中，通常会有一步过滤。最简单的操作就是，直接看小提琴图，手动选个阈值，过滤即可。</p><p data-tool="mdnice编辑器">当然，更加高级一点的做法是，找离群的细胞进行过滤，比如说下面这种</p><p data-tool="mdnice编辑器">Specifically, we fit the expression level of mitochondrial genes by using a median-centered median absolute deviation (MAD)-variance normal distribution, and then removed the cells with significantly higher expression levels than expected (determined by Benjamini-Hochberg corrected p &lt; 0.01, for CD3+ dataset: 11.13%; for CD45+ dataset: 13.33%) (Pijuan-Sala et al., 2019).</p><blockquote data-tool="mdnice编辑器"><span></span><p>Luoma, A.M., Suo, S., Williams, H.L., Sharova, T., Sullivan, K., Manos, M., Bowling, P., Hodi, F.S., Rahma, O., Sullivan, R.J., et al. (2020). Molecular pathways of colon inflammation induced by cancer immunotherapy. Cell 182, 655–671.e22. https://doi.org/10.1016/j.cell.2020.06.001.</p></blockquote><p data-tool="mdnice编辑器"><strong>Quality control</strong>: Cell libraries with low complexity (fewer than 1,000 expressed genes) were excluded. Cells with <strong>mitochondrial gene-expression fractions</strong> greater than 2.37%, 2.18%, and 3.35% for each of the wild-type atlas, _Tal1_−/− chimaeras, and wild-type chimaeras, respectively, were excluded. The thresholds were determined by considering a median-centred median absolute deviation (MAD)-variance normal distribution; cells with mitochondrial read fraction outside of the upper end of this distribution were excluded (where outside corresponds to <span>P</span> &lt; 0.05; Benjamini–Hochberg-corrected).</p><blockquote data-tool="mdnice编辑器"><span></span><p>Pijuan-Sala, B., Griffiths, J.A., Guibentif, C., Hiscock, T.W., Jawaid, W., Calero-Nieto, F.J., Mulas, C., Ibarra-Soria, X., Tyser, R.C.V., Ho, D.L.L., et al. (2019). A single-cell molecular map of mouse gastrulation and early organogenesis. Nature 566, 490–495. https://doi.org/10.1038/s41586-019-0933-9.</p></blockquote><p data-tool="mdnice编辑器">上述过滤分为两个部分，第一个部分是将数据拟合到正态分布中，第二个部分是基于正态分布计算每个值出现的概率（经过多重检验），然后筛选出不太可能出现的细胞。</p><p data-tool="mdnice编辑器">这里有一个专业术语，“Median-centred median absolute deviation (MAD)-variance normal distribution”，主要在统计学和数据分析中使用，特别是在处理有离群值的数据集时。这个术语可以分解为几个关键组成部分来理解：</p><ol data-tool="mdnice编辑器"><li><section><strong>中位数中心化（Median-centred）</strong>：这意味着数据的<strong>中心</strong>（或比较的基点）是数据集的中位数，而不是平均值。中位数是将数据集从小到大排序后位于中间的值。如果数据集的数量是偶数，则中位数是中间两个数的平均值。中位数中心化有助于减少极端值对数据分析的影响，因为中位数对离群值不如平均值那么敏感。</section></li><li><section><strong>中位数绝对偏差（Median Absolute Deviation, MAD）</strong>：MAD是一种衡量数据集变异性的方法，它计算的是各数据点与数据集中位数的绝对偏差的中位数。与标准偏差相比，MAD对离群值的影响较小，因此是一种更鲁棒的变异性度量。</section></li><li><section><strong>MAD-方差正态分布</strong>：这部分描述了使用MAD来标准化数据的过程，使得标准化后的数据有着类似于正态分布的性质，即均值为0，方差为1。在实践中，这通常通过从每个数据点中减去中位数，然后除以MAD来实现。为了使得标准化后的数据与标准正态分布的方差对齐，可能还需要乘以一个常数（如1.4826，这个值是在假设原始数据是正态分布的情况下推导出的）。</section></li></ol><p data-tool="mdnice编辑器">有了这些基本知识后，我们可以写一个代码进行实现</p><pre data-tool="mdnice编辑器"><span></span><code><span>import</span> numpy <span>as</span> np<br><span>import</span> scipy.stats <span>as</span> stats<br><span>from</span> statsmodels.stats.multitest <span>import</span> multipletests<br><span>import</span> scanpy <span>as</span> sc<br><br><span><span>def</span> <span>mad_based_normalization</span><span>(data, mad_constant =  <span>1.4826</span>)</span>:</span><br>    median = np.median(data)<br>    absolute_deviation = np.abs(data - median)<br>    mad = np.median(absolute_deviation)<br>    normalized_data = (data - median) / (mad * mad_constant)<br>    <span>return</span> normalized_data<br><br><span><span>def</span> <span>filter_cells_with_mitochondrial_fraction</span><span>(mitochondrial_fraction, mad_constant = <span>1.4826</span>, alpha=<span>0.05</span>)</span>:</span><br>    <span>"""<br>    根据线粒体读取比例排除细胞, 返回一个Bool列表，记录那些数据应该被保留<br>    <br>    :mitochondrial_fraction 线粒体占比<br>    :param alpha: 显著性水平阈值。<br>    :return: of List of Bool for cell to keep<br>    """</span><br>    <span># 计算每个细胞的线粒体基因表达比例</span><br>    <br>    <span># 对线粒体读取比例应用MAD基于中位数的标准化</span><br>    normalized_mitochondrial_fraction = mad_based_normalization(mitochondrial_fraction, mad_constant)<br>    <br>    <span># 计算z分数</span><br>    z_scores = normalized_mitochondrial_fraction<br>    <br>    <span># 计算P值</span><br>    p_values = stats.norm.sf(z_scores)  <span># 一尾检验</span><br>    <br>    <span># 应用Benjamini-Hochberg校正</span><br>    _, corrected_p_values, _, _ = multipletests(p_values, alpha=alpha, method=<span>'fdr_bh'</span>)<br>    <br>    <span># 保留 &gt;= alpha的结果</span><br>    filtered_cells = corrected_p_values &gt;= alpha<br><br>    <span>return</span> filtered_cells<br><br></code></pre><p data-tool="mdnice编辑器">使用方法如下，从adata中提取线粒体比例这一列，然后调用函数获取保留的细胞，并对原始数据进行过滤</p><pre data-tool="mdnice编辑器"><span></span><code>percent_mt = adata.obs[<span>'pct_counts_mt'</span>].copy()<br>keep_cell = filter_cells_with_mitochondrial_fraction(percent_mt)<br><br>adata.obs[<span>'keep_mito'</span>] = [<span>'keep'</span> <span>if</span> keep <span>else</span> <span>'filter'</span> <span>for</span> keep <span>in</span> keep_cell]<br><span># 可视化</span><br>ax = sc.pl.violin(adata_sub, [<span>'pct_counts_mt'</span>],  groupby=<span>"keep_mito"</span>,  jitter=0.4)<br></code></pre><p data-tool="mdnice编辑器">类似于下图中这个效果，相当于动态确定了阈值，而不是一个固定阈值过滤。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="503253362" data-ratio="0.6638888888888889" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/NDy5aEnReX0bMxXXibgicaBvicRF2Jll9340Sge4SDuoTsedTmqlKOZHHgjHdCvZYWrlZC5PMzURWcvsDia6rr6ylg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/NDy5aEnReX0bMxXXibgicaBvicRF2Jll9340Sge4SDuoTsedTmqlKOZHHgjHdCvZYWrlZC5PMzURWcvsDia6rr6ylg/640?wx_fmt=png&amp;from=appmsg"><figcaption><br></figcaption></figure></section><p><br></p><p>文章部分文字和代码由GPT-4生成，我负责校验，可能仍存在错误，请自行甄别。</p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/xwQXMJRVxWMFYl2HfNhGpw",target="_blank" rel="noopener noreferrer">原文链接</a>
