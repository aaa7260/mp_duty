---
title: "R包推荐|patchwork快速实现多图布局拼图"
date: 2024-03-15T01:22:33Z
draft: ["false"]
tags: [
  "fetched",
  "生信七点半"
]
categories: ["Acdemic"]
---
R包推荐|patchwork快速实现多图布局拼图 by 生信七点半
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><code>patchwork</code>是一个强大的R包，由Thomas Lin Pederson开发，专为简化<code>ggplot2</code>图形的组合而设计。与其他包如<code>gridExtra::grid.arrange()</code>和<code>cowplot::plot_grid()</code>相比，<code>patchwork</code>提供了更为直观和灵活的语法来组合多个<code>ggplot</code>图形。本推文就学习如何使用<code>patchwork</code>包来布局多个<code>ggplot</code>图形。</p><h3 data-tool="mdnice编辑器"><span></span><span>安装</span><span></span></h3><p data-tool="mdnice编辑器"><code>patchwork</code>包最初只在GitHub上的开发版本中可用。可以使用以下代码从GitHub安装<code>patchwork</code>：</p><pre data-tool="mdnice编辑器"><span></span><code><span>if</span>(!<span>require</span>(devtools)) install.packages(<span>"devtools"</span>)<br>devtools::install_github(<span>"thomasp85/patchwork"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>加载所需的R包</span><span></span></h3><p data-tool="mdnice编辑器">加载<code>ggplot2</code>包和<code>patchwork</code>包，并设置默认<code>ggplot2</code>主题为<code>theme_bw()</code>，图例位于图表顶部：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggplot2)<br><span>library</span>(patchwork)<br>theme_set(<br>  theme_bw() +<br>    theme(legend.position = <span>"top"</span>)<br>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>创建一些基础图形</span><span></span></h3><p data-tool="mdnice编辑器">以下R代码创建了4个图形，包括箱形图、点图、线图和密度图：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 自定义颜色调色板并准备数据</span><br>my3cols &lt;- c(<span>"#E7B800"</span>, <span>"#2E9FDF"</span>, <span>"#FC4E07"</span>)<br>ToothGrowth$dose &lt;- as.factor(ToothGrowth$dose)<br><br><span># 创建箱形图 (bxp)</span><br>p &lt;- ggplot(ToothGrowth, aes(x = dose, y = len))<br>bxp &lt;- p + geom_boxplot(aes(color = dose)) +<br>  scale_color_manual(values = my3cols)<br><br><span># 创建点图 (dp)</span><br>dp &lt;- p + geom_dotplot(aes(color = dose, fill = dose), <br>                       binaxis=<span>'y'</span>, stackdir=<span>'center'</span>) +<br>  scale_color_manual(values = my3cols) + <br>  scale_fill_manual(values = my3cols)<br><br><span># 创建线图 (lp)</span><br>lp &lt;- ggplot(economics, aes(x = date, y = psavert)) + <br>  geom_line(color = <span>"#E46726"</span>) <br><br><span># 创建密度图 (dens)</span><br>dens &lt;- ggplot(iris, aes(Sepal.Length)) +<br>  geom_density(aes(color = Species)) +<br>  scale_color_manual(values = my3cols)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>水平布局</span><span></span></h3><p data-tool="mdnice编辑器">使用<code>patchwork</code>的用法很简单：只需将图形相加即可！</p><pre data-tool="mdnice编辑器"><span></span><code>bxp + dens<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100005132" data-ratio="0.5" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKvXFlYDsIkU5lAKDkMc9jmVGEbc4QDtUSCgY46Mw27nT9HnK9aEXfLA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKvXFlYDsIkU5lAKDkMc9jmVGEbc4QDtUSCgY46Mw27nT9HnK9aEXfLA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>垂直布局</span><span></span></h3><p data-tool="mdnice编辑器">可以通过添加<code>plot_layout()</code>调用到组合中来指定布局。这允许你定义网格的尺寸以及分配给不同行和列的空间。</p><pre data-tool="mdnice编辑器"><span></span><code>bxp + dens + plot_layout(ncol = <span>1</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100005130" data-ratio="1.5" data-type="png" data-w="768" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKR7cS3OmUml4VPczKgvhSXcZsMbhgvZAmPms0MvDUFpsh1nzoBdvZ0g/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKR7cS3OmUml4VPczKgvhSXcZsMbhgvZAmPms0MvDUFpsh1nzoBdvZ0g/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">通过<code>patchwork</code>，我们可以轻松地将多个<code>ggplot2</code>图形组合在一起，无论是水平还是垂直布局，都能通过简单的语法和灵活的布局选项来实现。这使得创建复杂的图形展示变得异常简单，大大提高了数据可视化的效率和效果。</p><h3 data-tool="mdnice编辑器"><span></span><span>改变高度</span><span></span></h3><p data-tool="mdnice编辑器">如果您想要在垂直布局中改变各个图形的高度，可以通过<code>heights</code>参数来实现。以下示例将<code>bxp</code>图形的高度设置为<code>dens</code>图形的三分之一：</p><pre data-tool="mdnice编辑器"><span></span><code>bxp + dens + plot_layout(ncol = <span>1</span>, heights = c(<span>1</span>, <span>3</span>))<br></code></pre><p data-tool="mdnice编辑器">这里，<code>ncol = 1</code>指定了一列布局，<code>heights = c(1, 3)</code>意味着第一个图形（<code>bxp</code>）的高度是第二个图形（<code>dens</code>）高度的1/3。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100005134" data-ratio="1.5" data-type="png" data-w="768" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKUmqRCoJ8sSsN1ELsHRmCsSMqPDQjNZJtehyAQD2pLQvXEXYzjAsbaA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKUmqRCoJ8sSsN1ELsHRmCsSMqPDQjNZJtehyAQD2pLQvXEXYzjAsbaA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>改变宽度</span><span></span></h3><p data-tool="mdnice编辑器">如果您想要在水平布局中改变各个图形的宽度，可以通过<code>widths</code>参数来实现。以下示例将<code>bxp</code>图形的宽度设置为<code>dens</code>图形的一半：</p><pre data-tool="mdnice编辑器"><span></span><code>bxp + dens + plot_layout(ncol = <span>2</span>, widths = c(<span>1</span>, <span>2</span>))<br></code></pre><p data-tool="mdnice编辑器">这里，<code>ncol = 2</code>指定了两列布局，<code>widths = c(1, 2)</code>意味着第一个图形（<code>bxp</code>）的宽度是第二个图形（<code>dens</code>）宽度的一半。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100005133" data-ratio="0.6666666666666666" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKZ6ibJKiaJPl54NKqBlIhVdaNVEwCQ6uIRMPFBXr9BicFZrwo9nlDUmMrA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKZ6ibJKiaJPl54NKqBlIhVdaNVEwCQ6uIRMPFBXr9BicFZrwo9nlDUmMrA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>添加图形间的间隔</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>bxp + plot_spacer() + dens<br></code></pre><p data-tool="mdnice编辑器"><code>plot_spacer()</code>函数用于在图形之间添加空白间隔，这在调整图形布局时非常有用。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100005131" data-ratio="0.5833333333333334" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKlR82QYQTLOOIhr72qicO0p2auAoPmS77mOfbLOGfUbQyXW7P2Q2ichAA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKlR82QYQTLOOIhr72qicO0p2auAoPmS77mOfbLOGfUbQyXW7P2Q2ichAA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>嵌套布局</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>lp + {<br>  dens + {<br>    bxp +<br>    dp +<br>    plot_layout(ncol = <span>1</span>)<br>  }<br>} +<br>plot_layout(ncol = <span>1</span>)<br></code></pre><p data-tool="mdnice编辑器">通过使用花括号<code>{}</code>，您可以创建嵌套布局，这允许在不同的嵌套级别上应用布局规则。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100005139" data-ratio="1.1666666666666667" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hK4ZMAz2aLfETVMn1yiaqlSrMxd9yTXXmwLRXRUZp7N6pMic2VkRWaMcVA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hK4ZMAz2aLfETVMn1yiaqlSrMxd9yTXXmwLRXRUZp7N6pMic2VkRWaMcVA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>高级功能</span><span></span></h3><p data-tool="mdnice编辑器"><code>patchwork</code>提供了一些其他操作符，例如<code>-</code>，它的行为类似于<code>+</code>，但将左右两侧放在相同的嵌套级别上。</p><pre data-tool="mdnice编辑器"><span></span><code>bxp + dp - lp + plot_layout(ncol = <span>1</span>)<br></code></pre><p data-tool="mdnice编辑器">在这个例子中，<code>bxp + dp</code>和<code>lp</code>处于同一级别。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100005135" data-ratio="1" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKJOLlSl8mQTblWaASCOicBlgcKZdURENFshc38ibW1icjibItqCwZeOSamw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKJOLlSl8mQTblWaASCOicBlgcKZdURENFshc38ibW1icjibItqCwZeOSamw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">此外，<code>patchwork</code>还提供了<code>|</code>和<code>/</code>操作符，用于水平和垂直布局，它们可以组合使用，实现直观的布局语法：</p><pre data-tool="mdnice编辑器"><span></span><code>(bxp | lp | dp) / dens<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100005136" data-ratio="1.1666666666666667" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKdgydmgJyurYhd5ewqR2AACXA5NkibWUiaQzb1eqqJDiaXm2kbjN0AN9Uw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKdgydmgJyurYhd5ewqR2AACXA5NkibWUiaQzb1eqqJDiaXm2kbjN0AN9Uw/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>(bxp | lp ) / (dp | dens)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100005138" data-ratio="1.1666666666666667" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKaAReGKpBDhjAme3LBia0d1d1aTFEbHyVuxj3qseD9iaeyUN0uUJ0LNgw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKaAReGKpBDhjAme3LBia0d1d1aTFEbHyVuxj3qseD9iaeyUN0uUJ0LNgw/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>(bxp / lp / dp) | dens<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100005137" data-ratio="1.1666666666666667" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKOL6Y4zHJVRIAI57n3vur4jxoAlncdEEXnTea3wqlyZAZTp1atzibkUw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKOL6Y4zHJVRIAI57n3vur4jxoAlncdEEXnTea3wqlyZAZTp1atzibkUw/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>减少代码重复</span><span></span></h3><p data-tool="mdnice编辑器">当您想要为组合中的所有图形更改主题时，可以使用<code>&amp;</code>或<code>*</code>来向所有子图添加元素。两者的区别在于<code>*</code>只影响当前嵌套级别的图形，而<code>&amp;</code>会递归到嵌套级别中：</p><pre data-tool="mdnice编辑器"><span></span><code>(bxp + (dp + dens) + lp + plot_layout(ncol = <span>1</span>)) * theme_gray()<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100005143" data-ratio="1.6" data-type="png" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKVtJEPK2MJDDmbckU9fV45xC77sbZwfCBrdIUpQHialndR8t2fMgZJWg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKVtJEPK2MJDDmbckU9fV45xC77sbZwfCBrdIUpQHialndR8t2fMgZJWg/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>(bxp + (dp + dens) + lp + plot_layout(ncol = <span>1</span>)) &amp; theme_gray()<br></code></pre><p data-tool="mdnice编辑器">在前一个例子中，由于<code>*</code>操作符的优先级更高，所以需要使用括号。而后一个例子是最常见的用法，因此设计为更容易使用。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100005144" data-ratio="1.6" data-type="png" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKXugn4RbGXuPVHJRy0PWvzjt9LmrqrmHIYmOtSshtsxNWq84AFaeqEw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/owuibmRdV9s9l90C2SN4ibDToKuRKMZ3hKXugn4RbGXuPVHJRy0PWvzjt9LmrqrmHIYmOtSshtsxNWq84AFaeqEw/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>参考资料</span><span></span></h3><p data-tool="mdnice编辑器">https://github.com/thomasp85/patchwork</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/9UA7gcGdzkj-74d0zjxejw",target="_blank" rel="noopener noreferrer">原文链接</a>
