---
title: "reshape2::melt 和 tidyr::pivot_longer对比学习：宽数据转为长数据"
date: 2024-03-15T00:55:13Z
draft: ["false"]
tags: [
  "fetched",
  "生信小博士"
]
categories: ["Acdemic"]
---
reshape2::melt 和 tidyr::pivot_longer对比学习：宽数据转为长数据 by 生信小博士
------
<div><section><section powered-by="xiumi.us"><section><section><p><span>    </span></p><p><br></p><p><span>简介</span><br></p></section></section></section></section><p data-sourcepos="5:1-5:94"><strong><span>reshape2::melt 和 tidyr::pivot_longer 都是 R 语言中用于将数据从宽格式转换为长格式的函数。两种函数都非常有用，但它们在功能和语法上</span></strong><strong><span>有一些差异。</span></strong></p><p data-sourcepos="5:1-5:94"><span>功能比较</span></p><table data-sourcepos="9:1-15:46" width="614"><tbody><tr data-sourcepos="9:1-9:45"><th data-sourcepos="9:1-9:4">功能</th><th data-sourcepos="9:6-9:21">reshape2::melt</th><th data-sourcepos="9:23-9:43">tidyr::pivot_longer</th></tr><tr data-sourcepos="11:1-11:38"><td data-sourcepos="11:1-11:6">核心功能</td><td data-sourcepos="11:8-11:21">将宽格式数据转换为长格式</td><td data-sourcepos="11:23-11:36">将宽格式数据转换为长格式</td></tr><tr data-sourcepos="12:1-12:39"><td data-sourcepos="12:1-12:7">支持的格式</td><td data-sourcepos="12:9-12:29">支持多种格式，包括数据框、矩阵、列表等</td><td data-sourcepos="12:31-12:37">支持数据框</td></tr><tr data-sourcepos="13:1-13:58"><td data-sourcepos="13:1-13:6">变量类型</td><td data-sourcepos="13:8-13:31">可以处理不同类型的变量，包括数值型、字符型等</td><td data-sourcepos="13:33-13:56">可以处理不同类型的变量，包括数值型、字符型等</td></tr><tr data-sourcepos="14:1-14:27"><td data-sourcepos="14:1-14:5">缺失值</td><td data-sourcepos="14:7-14:15">可以处理缺失值</td><td data-sourcepos="14:17-14:25">可以处理缺失值</td></tr><tr data-sourcepos="15:1-15:46"><td data-sourcepos="15:1-15:6">其他功能</td><td data-sourcepos="15:8-15:22">支持多列熔化、计算新变量等</td><td data-sourcepos="15:24-15:44">支持多个值列、多个键列、自定义值名称等</td></tr></tbody></table><p><br></p><p data-sourcepos="17:1-17:8"><span>语法比较</span></p><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="objectivec"><code><span><span># reshape2::melt</span></span></code><code><span>data_melted &lt;- melt(data, <span>id</span>.vars = c(<span>"id"</span>, <span>"group"</span>))</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span># tidyr::pivot_longer</span></span></code><code><span>data_melted &lt;- pivot_longer(data, </span></code><code><span>                          cols = c(-<span>id</span>, -group), </span></code><code><span>                          names_to = <span>"variable"</span>, </span></code><code><span>                          values_to = <span>"value"</span>)</span></code></pre></section><p data-sourcepos="32:1-32:8"><span>代码解析</span></p><ul data-sourcepos="34:1-38:0"><li><p><code>id.vars</code> 参数指定要保留的原始列。</p></li><li><p><code>cols</code> 参数指定要转换的列。</p></li><li><p><code>names_to</code> 参数指定转换后新列的名称。</p></li><li><p><code>values_to</code> 参数指定转换后新列的值。</p></li></ul><p data-sourcepos="39:1-39:8"><span>案例演示</span></p><p data-sourcepos="41:1-41:19">假设我们有一个如下所示的宽格式数据框：</p><section><ul><li><li><li><li></ul><pre data-lang="swift"><code><span>data &lt;- data.frame(id = <span>c</span>(<span>1</span>, <span>2</span>, <span>3</span>),</span></code><code><span>                   group = <span>c</span>(<span>"A"</span>, <span>"B"</span>, <span>"C"</span>),</span></code><code><span>                   value1 = <span>c</span>(<span>10</span>, <span>20</span>, <span>30</span>),</span></code><code><span>                   value2 = <span>c</span>(<span>40</span>, <span>50</span>, <span>60</span>))</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002638" data-ratio="0.3877118644067797" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkuqiclekJMBn7ALVDGSib5qFSjbiczgv1eQsKF6hfhe0I2hLety6LucK6Rh06GvzQxgdFpngQ1PDgOUg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="472" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkuqiclekJMBn7ALVDGSib5qFSjbiczgv1eQsKF6hfhe0I2hLety6LucK6Rh06GvzQxgdFpngQ1PDgOUg/640?wx_fmt=png&amp;from=appmsg"></p><p data-sourcepos="50:1-50:53"><br></p><p data-sourcepos="50:1-50:53"><span><strong>使用 </strong><strong><code>reshape2::melt</code> 和 <code>tidyr::pivot_longer</code> 将其转换为长格式：</strong></span></p><pre><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="objectivec"><code><span><span># reshape2::melt</span></span></code><code><span><br></span></code><code><span>data_melted_melt &lt;- melt(data, <span>id</span>.vars = c(<span>"id"</span>, <span>"group"</span>))</span></code><code><span><br></span></code><code><span><span># tidyr::pivot_longer</span></span></code><code><span><br></span></code><code><span>data_melted_pivot_longer &lt;- pivot_longer(data, </span></code><code><span>                                       cols = c(-<span>id</span>, -group), <span>#边长的数据中不计这两列</span></span></code><code><span>                                       names_to = <span>"variable"</span>, </span></code><code><span>                                       values_to = <span>"value"</span>)</span></code></pre></section></pre><p data-sourcepos="65:1-65:8"><span>结果比较</span></p><p><img data-galleryid="" data-imgfileid="100002639" data-ratio="0.5292620865139949" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkuqiclekJMBn7ALVDGSib5qFS0Vl1etIYhVjO6PTISyZ3WiaVTyPXNibxZFKDsvPWUubAL9bKFDic9z1Fg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="786" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkuqiclekJMBn7ALVDGSib5qFS0Vl1etIYhVjO6PTISyZ3WiaVTyPXNibxZFKDsvPWUubAL9bKFDic9z1Fg/640?wx_fmt=png&amp;from=appmsg"></p><p data-sourcepos="95:1-95:23"><br></p><p data-sourcepos="95:1-95:23"><span>两种函数都将数据转换为长格式，但结果略有不同</span><strong>。</strong></p><ul data-sourcepos="97:1-99:0"><li><p><code>reshape2::melt</code> 将 <code>value1</code> 和 <code>value2</code> 合并为一个列，并添加一个名为 <code>variable</code> 的新列来指示每个值的来源。</p></li><li><p><code>tidyr::pivot_longer</code> 将 <code>value1</code> 和 <code>value2</code> 保留为单独的列，并添加一个名为 <code>variable</code> 的新列来指示每个值的来源。</p></li><li><p>仔细看他们的顺序是不同的，且后一个为tibble<br></p></li></ul><p data-sourcepos="100:1-100:8"><br></p><p><img data-imgfileid="100002650" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" data-type="gif" data-w="240" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"><br></p><p><img data-imgfileid="100002649" data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="other" data-w="341" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/kYSvGj8SdcNVEWEIDvSvPQ",target="_blank" rel="noopener noreferrer">原文链接</a>
