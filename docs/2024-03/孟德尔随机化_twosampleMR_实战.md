---
title: "孟德尔随机化：twosampleMR 实战"
date: 2024-03-11T01:34:33Z
draft: ["false"]
tags: [
  "fetched",
  "医学和生信笔记"
]
categories: ["Acdemic"]
---
孟德尔随机化：twosampleMR 实战 by 医学和生信笔记
------
<div><section><span>关注公众号，发送</span><strong>R语言</strong><span>或</span><strong>python</strong><span>，可获取资料</span><span></span></section><section><mp-common-profile data-pluginname="mpprofile" data-id="MzUzOTQzNzU0NA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R9YDc8IDhqWAHTrZsMuhDpFlw4scqOl1ZVWpeY77cdibaSzPeGALfkEhdVpwHzVibHCRSYZg4csB43g/0?wx_fmt=png" data-nickname="医学和生信笔记" data-alias="yxhsxbj" data-signature="外科医生👨‍⚕️的R语言和生信学习🔖" data-from="2" data-weuitheme="light"></mp-common-profile></section><section data-role="outer" label="edit by 135editor"><section data-role="paragraph"><section data-role="outer" label="edit by 135editor"><section data-role="paragraph"><section data-role="outer" label="edit by 135editor"><section data-role="paragraph"><section data-role="outer"><section data-role="outer" label="edit by 135editor"><section data-tools="135编辑器" data-id="28"><p data-brushtype="text" hm_fix="440:185"><span>💡专注R语言在🩺生物医学中的使用</span></p></section></section></section></section></section><hr><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><span><span>设为“</span><strong><span>星标</span></strong><span>”，精彩不错过</span></span><br></p><hr><p data-tool="mdnice编辑器"><span><strong></strong></span></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">两样本孟德尔随机化专用R包<code>TwoSampleMR</code>，可以和 IEU open GWAS 数据库无缝连接，可通过在线的方式直接查询数据库资源，并实现分析、下载等功能。</p><p data-tool="mdnice编辑器">除此之外，还可以使用本地数据进行MR分析，是目前用的最多的MR分析R包，只要你做MR分析，基本上不可能绕过这个包。所以我认真学习了它的官方文档，整理下分享给大家~</p><p data-tool="mdnice编辑器">本文目录：</p><ul><li><p>安装</p></li><li><p>overview</p></li><li><p>基础使用</p></li><li><p>敏感性分析</p></li><li><p>Steiger方向性检验</p></li><li><p>1-to-many forest plot</p></li><ul><li><p>例1</p></li><li><p>例2</p></li></ul><li><p>多变量MR（MVMR）</p></li><li><p>MR-MoE</p></li><li><p>整合所有结果</p></li></ul><p data-tool="mdnice编辑器"><br></p><h2 data-tool="mdnice编辑器"><span></span><span>安装</span><span></span></h2><pre data-tool="mdnice编辑器"><code>remotes::install_github("MRCIEU/TwoSampleMR")<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>overview</span><span></span></h2><p data-tool="mdnice编辑器">使用<code>TwoSampleMR</code>进行MR分析主要就是4步：</p><ol data-tool="mdnice编辑器"><li><section>为暴露因素选择合适的工具变量（必要时进行连锁不平衡的过滤）</section></li><li><section>对感兴趣的结局提取工具变量</section></li><li><section>统一暴露因素和结局的数据，使得reference allele保持一致</section></li><li><section>进行MR分析、敏感性分析、可视化</section></li></ol><figure data-tool="mdnice编辑器"><img data-imgfileid="100017481" data-ratio="1.1858304297328688" data-type="png" data-w="861" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpich957n4vJG38T0tAeycVdibTxpiaiabveSS7EZCCuLMAbibqu3cTBlFhuf5g/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpich957n4vJG38T0tAeycVdibTxpiaiabveSS7EZCCuLMAbibqu3cTBlFhuf5g/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>基础使用</span><span></span></h2><p data-tool="mdnice编辑器">直接使用IEU的API，使用在线的方式查询、分析、提取IEU open GWAS 数据库中的工具变量。这个功能其实是借助<code>ieugwasr</code>实现的。</p><p data-tool="mdnice编辑器">首先我们要选择合适的暴露因素和结局，暴露因素我这里选的是BMI（body mass index），结局选的是CHD（冠心病）。也就是我想研究BMI对冠心病的因果关系。</p><p data-tool="mdnice编辑器">BMI在IEU open GWAS 数据库中的ID是<code>ieu-a-2</code>，CHD的ID是<code>ieu-a-7</code>。</p><p data-tool="mdnice编辑器"><img data-imgfileid="100017482" data-ratio="0.5203703703703704" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpichgYSec2N4yWia0oakuxj0z738Cd4XQMbEJ6UVzlP8ha0DibWicAWzZK6ug/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpichgYSec2N4yWia0oakuxj0z738Cd4XQMbEJ6UVzlP8ha0DibWicAWzZK6ug/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100017483" data-ratio="0.5203703703703704" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpichN65UEtkKxImp6zQ5bqpLiaMM6X7mwJwdoKtCtxkQDhhLlBnMArlZtoQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpichN65UEtkKxImp6zQ5bqpLiaMM6X7mwJwdoKtCtxkQDhhLlBnMArlZtoQ/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">选好之后，就是用代码查询暴露和结局相关的SNP。</p><p data-tool="mdnice编辑器">在提取暴露因素相关的工具变量时，会自动进行<strong>去除连锁不平衡的SNP</strong>，由于这一步是在线进行的，需要联网，所以这一步对网络有要求，有可能会经常失败，此时我们也可以下载数据到本地进行处理（下次再讲），也可以得到一样的结果。</p><p data-tool="mdnice编辑器">提取结局相关的SNP这一步也是在线进行的，也有可能会失败。</p><p data-tool="mdnice编辑器"><code>harmonise_data</code>这一步是必须的，以确保暴露和结局的SNP的效应等位基因是一样的。</p><pre data-tool="mdnice编辑器"><code>library(TwoSampleMR)<br><br># Registered S3 method overwritten by 'data.table':<br>#   method           from<br># print.data.table     <br># TwoSampleMR version 0.5.8 <br># [&gt;] New: Option to use non-European LD reference panels for clumping etc<br># [&gt;] Some studies temporarily quarantined to verify effect allele<br># [&gt;] See news(package='TwoSampleMR') and https://gwas.mrcieu.ac.uk for further details<br><br># List available GWASs<br>#ao &lt;- available_outcomes()<br><br># 提取暴露相关的SNP<br>exposure_dat &lt;- extract_instruments("ieu-a-2", access_token = NULL)<br><br># API: public: http://gwas-api.mrcieu.ac.uk/<br>#save(exposure_dat,file = "./ieu/exposure_data_ieu-a-2.rdata")<br><br># 提取结局相关的SNP<br>outcome_dat &lt;- extract_outcome_data(snps=exposure_dat$SNP, <br>                                    outcomes = "ieu-a-7",<br>                                    access_token = NULL)<br><br># Extracting data for 79 SNP(s) from 1 GWAS(s)<br>#save(outcome_dat, file = "./ieu/outcome_data_ieu-a-7.rdata")<br><br># 统一数据<br>dat &lt;- harmonise_data(exposure_dat, outcome_dat)<br><br># Harmonising Body mass index || id:ieu-a-2 (ieu-a-2) <br># and Coronary heart disease || id:ieu-a-7 (ieu-a-7)<br><br># 进行MR分析<br>res &lt;- mr(dat)<br><br># Analysing 'ieu-a-2' on 'ieu-a-7'<br><br>res<br><br># id.exposure id.outcome                              outcome<br># 1     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7<br># 2     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7<br># 3     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7<br># 4     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7<br># 5     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7<br># exposure                    method nsnp<br># 1 Body mass index || id:ieu-a-2                  MR Egger   79<br># 2 Body mass index || id:ieu-a-2           Weighted median   79<br># 3 Body mass index || id:ieu-a-2 Inverse variance weighted   79<br># 4 Body mass index || id:ieu-a-2               Simple mode   79<br># 5 Body mass index || id:ieu-a-2             Weighted mode   79<br># b         se         pval<br># 1 0.5024935 0.14396056 8.012590e-04<br># 2 0.3870065 0.07111020 5.258272e-08<br># 3 0.4459091 0.05898302 4.032020e-14<br># 4 0.3401554 0.15985362 3.650217e-02<br># 5 0.3888249 0.10593531 4.412728e-04<br></code></pre><p data-tool="mdnice编辑器">结果中给出了：</p><ul data-tool="mdnice编辑器"><li><section><code>method</code>:使用的因果效应估计方法</section></li><li><section><code>nsnp</code>:SNP的数量</section></li><li><section><code>b</code>:暴露因素对结局的效应量</section></li><li><section><code>se</code>:效应量的标准差</section></li><li><section><code>pval</code>:MR分析的P值，小于0.05说明有因果关系。</section></li></ul><p data-tool="mdnice编辑器">还可以计算OR值和可信区间：</p><pre data-tool="mdnice编辑器"><code>generate_odds_ratios(res)<br><br><span># id.exposure id.outcome                              outcome</span><br><span># 1     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7</span><br><span># 2     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7</span><br><span># 3     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7</span><br><span># 4     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7</span><br><span># 5     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7</span><br><span># exposure                    method nsnp</span><br><span># 1 Body mass index || id:ieu-a-2                  MR Egger   79</span><br><span># 2 Body mass index || id:ieu-a-2           Weighted median   79</span><br><span># 3 Body mass index || id:ieu-a-2 Inverse variance weighted   79</span><br><span># 4 Body mass index || id:ieu-a-2               Simple mode   79</span><br><span># 5 Body mass index || id:ieu-a-2             Weighted mode   79</span><br><span># b         se         pval      lo_ci     up_ci       or</span><br><span># 1 0.5024935 0.14396056 8.012590e-04 0.22033081 0.7846562 1.652838</span><br><span># 2 0.3870065 0.07111020 5.258272e-08 0.24763049 0.5263825 1.472566</span><br><span># 3 0.4459091 0.05898302 4.032020e-14 0.33030238 0.5615158 1.561909</span><br><span># 4 0.3401554 0.15985362 3.650217e-02 0.02684233 0.6534685 1.405166</span><br><span># 5 0.3888249 0.10593531 4.412728e-04 0.18119168 0.5964581 1.475246</span><br><span># or_lci95 or_uci95</span><br><span># 1 1.246489 2.191653</span><br><span># 2 1.280987 1.692797</span><br><span># 3 1.391389 1.753328</span><br><span># 4 1.027206 1.922196</span><br><span># 5 1.198645 1.815676</span><br></code></pre><p data-tool="mdnice编辑器"><code>or</code>就是OR值，如果大于1就是风险因素，小于1就是保护因素，然后再结合<code>pval</code>，如果小于0.05就是有因果关系。</p><p data-tool="mdnice编辑器">主要是看<code>Inverse variance weighted</code>的结果，其他方法作为辅助即可。</p><p data-tool="mdnice编辑器">对MR分析结果进行可视化，这个图很明显使用<code>ggplot2</code>画的，所以可以使用相关语法进行修改：</p><pre data-tool="mdnice编辑器"><code>library(ggplot2)<br>library(ggsci)<br>p1 &lt;- mr_scatter_plot(res, dat = dat)<br><br>p1[[1]]+scale_color_lancet()+coord_fixed(0.5)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100017479" data-ratio="1.1875881523272214" data-type="png" data-w="709" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpichhRMSh14mKBJlGldXOibXoy4TGlNqMUhqWE123ktEpVjnXDHDRapYia2w/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpichhRMSh14mKBJlGldXOibXoy4TGlNqMUhqWE123ktEpVjnXDHDRapYia2w/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">横坐标是SNP对暴露的效应，纵坐标是SNP对结局的效应，</p><p data-tool="mdnice编辑器">这个图中每一个黑点表示一个SNP，横线表示SNP对暴露因素的效应量的可信区间（beta±se），竖线表示SNP对结局因素的效应量的可信区间（beta±se）。</p><p data-tool="mdnice编辑器">5条直线是5种方法的拟合线（图中有2条线重合了），每种方法其实就是进行一种回归分析，所以有5条拟合线。每条直线的斜率（就是上面结果中的<code>b</code>）表示该方法估计的因果效应大小，如果斜率大于0，就表示是风险因素，如果小于0就表示保护因素。</p><p data-tool="mdnice编辑器">支持多种因果效应估计方法，其中还给出了部分方法的参考文献，<code>use_by_default</code>会告诉你是不是默认的方法，<code>heterogeneity_test</code>会告诉你该方法能不能用于异质性检验：</p><pre data-tool="mdnice编辑器"><code><span># 18种方法</span><br>mr_method_list()<br><br><span># 1                  mr_wald_ratio</span><br><span># 2               mr_two_sample_ml</span><br><span># 3            mr_egger_regression</span><br><span># 4  mr_egger_regression_bootstrap</span><br><span># 5               mr_simple_median</span><br><span># 6             mr_weighted_median</span><br><span># 7   mr_penalised_weighted_median</span><br><span># 8                         mr_ivw</span><br><span># 9                  mr_ivw_radial</span><br><span># 10                    mr_ivw_mre</span><br><span># 11                     mr_ivw_fe</span><br><span># 12                mr_simple_mode</span><br><span># 13              mr_weighted_mode</span><br><span># 14         mr_weighted_mode_nome</span><br><span># 15           mr_simple_mode_nome</span><br><span># 16                       mr_raps</span><br><span># 17                       mr_sign</span><br><span># 18                        mr_uwr</span><br><span># 省略</span><br></code></pre><p data-tool="mdnice编辑器">如果你要更改方法也是非常简单：</p><pre data-tool="mdnice编辑器"><code>mr(dat, method_list = c(<span>"mr_egger_regression"</span>, <span>"mr_ivw"</span>))<br><br><span># Analysing 'ieu-a-2' on 'ieu-a-7'</span><br><span># id.exposure id.outcome                              outcome</span><br><span># 1     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7</span><br><span># 2     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7</span><br><span># exposure                    method nsnp</span><br><span># 1 Body mass index || id:ieu-a-2                  MR Egger   79</span><br><span># 2 Body mass index || id:ieu-a-2 Inverse variance weighted   79</span><br><span># b         se        pval</span><br><span># 1 0.5024935 0.14396056 8.01259e-04</span><br><span># 2 0.4459091 0.05898302 4.03202e-14</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>敏感性分析</span><span></span></h2><p data-tool="mdnice编辑器">属于事后检验，目的是看看MR分析的结果是否靠谱。主要包括4个方面：</p><ul data-tool="mdnice编辑器"><li><section>异质性检验</section></li><li><section>水平多效性</section></li><li><section>单个SNP分析</section></li><li><section>留一法分析</section></li></ul><p data-tool="mdnice编辑器">异质性检验就是检验不同的工具变量（SNP）之间是不是有非常大的差异，如果差异很大，可能会对结果的可靠性产生影响。</p><p data-tool="mdnice编辑器">1行代码即可实现，某些方法既能进行因果效应分析，又可以进行异质性检验，比如MR-Egger和IVM：</p><pre data-tool="mdnice编辑器"><code>mr_heterogeneity(dat)<br><br><span># id.exposure id.outcome                              outcome</span><br><span># 1     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7</span><br><span># 2     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7</span><br><span># exposure                    method        Q</span><br><span># 1 Body mass index || id:ieu-a-2                  MR Egger 143.3046</span><br><span># 2 Body mass index || id:ieu-a-2 Inverse variance weighted 143.6508</span><br><span># Q_df       Q_pval</span><br><span># 1   77 6.841585e-06</span><br><span># 2   78 8.728420e-06</span><br></code></pre><p data-tool="mdnice编辑器">主要就是看结果中的<code>Q_pval</code>，也就是 Cochran's Q，小于0.05就是没有异质性。</p><p data-tool="mdnice编辑器">也支持更改方法（支持的方法参考<code>mr_method_list()</code>）：</p><pre data-tool="mdnice编辑器"><code>mr_heterogeneity(dat, method_list = c(<span>"mr_egger_regression"</span>, <span>"mr_ivw"</span>))<br><br><span># id.exposure id.outcome                              outcome</span><br><span># 1     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7</span><br><span># 2     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7</span><br><span># exposure                    method        Q</span><br><span># 1 Body mass index || id:ieu-a-2                  MR Egger 143.3046</span><br><span># 2 Body mass index || id:ieu-a-2 Inverse variance weighted 143.6508</span><br><span># Q_df       Q_pval</span><br><span># 1   77 6.841585e-06</span><br><span># 2   78 8.728420e-06</span><br></code></pre><p data-tool="mdnice编辑器">下面是进行水平多效性检验，工具变量的多效性是指一个工具变量（也就是遗传变异，或者SNP）对多个表型（也就是暴露因素）都会产生影响的现象，这是违反独立性假设和排他性假设的。</p><p data-tool="mdnice编辑器">这个水平多效性的检验是通过<code>MR-Egger</code>法的截距来判断的，如果截距（<code>egger_intercept</code>）在0附近（可以结合上面的图），且<code>pval</code>大于0.05说明没有水平多效性。</p><pre data-tool="mdnice编辑器"><code>mr_pleiotropy_test(dat)<br><br><span># id.exposure id.outcome                              outcome</span><br><span># 1     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7</span><br><span># exposure egger_intercept          se</span><br><span># 1 Body mass index || id:ieu-a-2    -0.001719304 0.003985962</span><br><span># pval</span><br><span># 1 0.6674266</span><br></code></pre><p data-tool="mdnice编辑器">单个SNP分析，也就是对每一个SNP单独进行一次MR分析，目的就是看看是不是有某个SNP明显和其他的SNP不一样，识别离群值：</p><pre data-tool="mdnice编辑器"><code>res_single &lt;- mr_singlesnp(dat)<br>head(res_single)<br><br><span># exposure</span><br><span># 1 Body mass index || id:ieu-a-2</span><br><span># 2 Body mass index || id:ieu-a-2</span><br><span># 3 Body mass index || id:ieu-a-2</span><br><span># 4 Body mass index || id:ieu-a-2</span><br><span># 5 Body mass index || id:ieu-a-2</span><br><span># 6 Body mass index || id:ieu-a-2</span><br><span># outcome id.exposure id.outcome</span><br><span># 1 Coronary heart disease || id:ieu-a-7     ieu-a-2    ieu-a-7</span><br><span># 2 Coronary heart disease || id:ieu-a-7     ieu-a-2    ieu-a-7</span><br><span># 3 Coronary heart disease || id:ieu-a-7     ieu-a-2    ieu-a-7</span><br><span># 4 Coronary heart disease || id:ieu-a-7     ieu-a-2    ieu-a-7</span><br><span># 5 Coronary heart disease || id:ieu-a-7     ieu-a-2    ieu-a-7</span><br><span># 6 Coronary heart disease || id:ieu-a-7     ieu-a-2    ieu-a-7</span><br><span># samplesize        SNP          b        se          p</span><br><span># 1     184305  rs1000940 -0.7901087 0.5347554 0.13953788</span><br><span># 2     184305 rs10132280  0.5506335 0.4825339 0.25381623</span><br><span># 3     184305  rs1016287  0.6178509 0.4637632 0.18277634</span><br><span># 4     184305 rs10182181  0.5920712 0.3002913 0.04864884</span><br><span># 5     184305 rs10733682  0.2415426 0.5066223 0.63352560</span><br><span># 6     184305 rs10840100  0.7086893 0.4623010 0.12528548</span><br></code></pre><p data-tool="mdnice编辑器">这个结果也是可以获取OR值和可信区间的：</p><pre data-tool="mdnice编辑器"><code>head(generate_odds_ratios(res_single))<br><br><span># exposure</span><br><span># 1 Body mass index || id:ieu-a-2</span><br><span># 2 Body mass index || id:ieu-a-2</span><br><span># 3 Body mass index || id:ieu-a-2</span><br><span># 4 Body mass index || id:ieu-a-2</span><br><span># 5 Body mass index || id:ieu-a-2</span><br><span># 6 Body mass index || id:ieu-a-2</span><br><span># outcome id.exposure id.outcome</span><br><span># 1 Coronary heart disease || id:ieu-a-7     ieu-a-2    ieu-a-7</span><br><span># 2 Coronary heart disease || id:ieu-a-7     ieu-a-2    ieu-a-7</span><br><span># 3 Coronary heart disease || id:ieu-a-7     ieu-a-2    ieu-a-7</span><br><span># 4 Coronary heart disease || id:ieu-a-7     ieu-a-2    ieu-a-7</span><br><span># 5 Coronary heart disease || id:ieu-a-7     ieu-a-2    ieu-a-7</span><br><span># 6 Coronary heart disease || id:ieu-a-7     ieu-a-2    ieu-a-7</span><br><span># samplesize        SNP          b        se          p</span><br><span># 1     184305  rs1000940 -0.7901087 0.5347554 0.13953788</span><br><span># 2     184305 rs10132280  0.5506335 0.4825339 0.25381623</span><br><span># 3     184305  rs1016287  0.6178509 0.4637632 0.18277634</span><br><span># 4     184305 rs10182181  0.5920712 0.3002913 0.04864884</span><br><span># 5     184305 rs10733682  0.2415426 0.5066223 0.63352560</span><br><span># 6     184305 rs10840100  0.7086893 0.4623010 0.12528548</span><br><span># lo_ci    up_ci        or  or_lci95 or_uci95</span><br><span># 1 -1.838229348 0.258012 0.4537955 0.1590989 1.294354</span><br><span># 2 -0.395133032 1.496400 1.7343514 0.6735904 4.465584</span><br><span># 3 -0.291124912 1.526827 1.8549373 0.7474223 4.603545</span><br><span># 4  0.003500324 1.180642 1.8077287 1.0035065 3.256464</span><br><span># 5 -0.751437234 1.234522 1.2732116 0.4716881 3.436737</span><br><span># 6 -0.197420583 1.614799 2.0313271 0.8208453 5.026879</span><br></code></pre><p data-tool="mdnice编辑器">结果可视化:</p><pre data-tool="mdnice编辑器"><code>p2 &lt;- mr_forest_plot(res_single)<br>p2[[<span>1</span>]]<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100017480" data-ratio="1.9914712153518124" data-type="png" data-w="469" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpichtXTPygahPLcqAibicaxW4icwR7rZO3CYia7QtgLMqKM8XsicQN3xcib0RiaQA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpichtXTPygahPLcqAibicaxW4icwR7rZO3CYia7QtgLMqKM8XsicQN3xcib0RiaQA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">这个图是一个森林图，展示了单个SNP对CHD（冠心病）的影响，如果黑色水平线条完全在0的左边说明这个SNP是保护因素，完全在右边说明是危险因素，如果穿过了0说明没有意义。但是通常都是多个SNP一起作用的，所以单看一个没有太大说服力，直接看最低下的红色线条即可，这是汇总的效应，上图展示了两种方法的汇总效应，都是完全在0的右侧的。</p><p data-tool="mdnice编辑器">单个SNP分析默认是Wald ratio检验，可以更改，比如使用固定效应meta分析法：</p><pre data-tool="mdnice编辑器"><code>res_single &lt;- mr_singlesnp(dat, single_method = <span>"mr_meta_fixed"</span>)<br></code></pre><p data-tool="mdnice编辑器">总的效应默认是IVW法和MR-Egger法，也可以更改：</p><pre data-tool="mdnice编辑器"><code>res_single &lt;- mr_singlesnp(dat, all_method = <span>"mr_two_sample_ml"</span>,<br>                           single_method = <span>"mr_meta_fixed"</span>)<br></code></pre><p data-tool="mdnice编辑器">单个SNP分析还可以使用漏斗图进行可视化，主要是为了看看有没有明显的离群点，正常的话应该是左右基本对称分布的，如果某个点离得很远，可能需要把该SNP去掉：</p><pre data-tool="mdnice编辑器"><code>res_single &lt;- mr_singlesnp(dat)<br>p4 &lt;- mr_funnel_plot(res_single)<br>p4[[<span>1</span>]]<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100017488" data-ratio="0.5966921119592875" data-type="png" data-w="786" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpichetRPOnQHZ6nkdN4cEnRh8YfsBylicvhkFELic6N7BxMGUObpCEdtxw7Q/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpichetRPOnQHZ6nkdN4cEnRh8YfsBylicvhkFELic6N7BxMGUObpCEdtxw7Q/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">留一法分析，即每次去掉一个SNP，对剩下的SNP进行MR分析，和单个SNP分析刚好相反。这一步也是看看有没有强影响点，正常来说去除某一个SNP之后，总体的效应应该变化不大（如下图所示），如果去掉某个SNP之后产生了很大的变化，说明这个SNP有问题，需要去掉。</p><pre data-tool="mdnice编辑器"><code>res_loo &lt;- mr_leaveoneout(dat)<br>p3 &lt;- mr_leaveoneout_plot(res_loo)<br>p3[[<span>1</span>]]<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100017486" data-ratio="1.9936575052854122" data-type="png" data-w="473" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpich5b4QSPwiaT1FSpm0icOgMroYPfnauWGBJEdJ8xNOArpylmUiakr4ubcPg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpich5b4QSPwiaT1FSpm0icOgMroYPfnauWGBJEdJ8xNOArpylmUiakr4ubcPg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">这个进行分析的方法同样也是可以更改的哈。</p><h2 data-tool="mdnice编辑器"><span></span><span>Steiger方向性检验</span><span></span></h2><p data-tool="mdnice编辑器">MR-Steiger方向性检验，主要是看结局和暴露之间是不是有反向因果关系：</p><pre data-tool="mdnice编辑器"><code>directionality_test(dat)<br><br><span># r.exposure and/or r.outcome not present.</span><br><span># Calculating approximate SNP-exposure and/or SNP-outcome correlations, </span><br><span># assuming all are quantitative traits. Please pre-calculate r.exposure </span><br><span># and/or r.outcome using get_r_from_lor() for any binary traits</span><br><span># id.exposure id.outcome                      exposure</span><br><span># 1     ieu-a-2    ieu-a-7 Body mass index || id:ieu-a-2</span><br><span># outcome snp_r2.exposure</span><br><span># 1 Coronary heart disease || id:ieu-a-7      0.01580819</span><br><span># snp_r2.outcome correct_causal_direction  steiger_pval</span><br><span># 1    0.001350485                     TRUE 1.748577e-207</span><br></code></pre><p data-tool="mdnice编辑器">该检验可以计算SNP对结局和暴露的 r^2^ ，也就是对结局的解释程度和对暴露的解释程度，理论上肯定是对暴露的解释程度更高（r^2^更大），因为SNP是和暴露因素强相关的。P值很小说明没有反向因果关系。</p><h2 data-tool="mdnice编辑器"><span></span><span>1-to-many forest plot</span><span></span></h2><p data-tool="mdnice编辑器">1-to-many森林图可以用来可视化<strong>多个暴露因素对一个结局的分析结果</strong>或者<strong>一个暴露因素对多个结局的分析结果</strong>。</p><p data-tool="mdnice编辑器">对于小于50个结果的展示比较好，如果有多于50个结果建议分成两张图然后再拼起来。</p><h3 data-tool="mdnice编辑器"><span></span><span>例1</span><span></span></h3><p data-tool="mdnice编辑器">结局还是使用CHD，下面我们使用多个暴露因素：</p><pre data-tool="mdnice编辑器"><code><span># 6个暴露因素</span><br>exp_dat &lt;- extract_instruments(<br>  outcomes = c(<span>"ieu-a-2"</span>, <span>"ieu-a-100"</span>, <span>"ieu-a-104"</span>, <br>               <span>"ieu-a-1"</span>, <span>"ieu-a-72"</span>, <span>"ieu-a-999"</span>))<br><span># 查看每个暴露因素有几个SNP</span><br>table(exp_dat$exposure)<br><br><span># 提取结局相关的SNP</span><br>chd_out_dat &lt;- extract_outcome_data(<br>  snps = exp_dat$SNP,<br>  outcomes = <span>"ieu-a-7"</span><br>)<br><br>dat2 &lt;- harmonise_data(<br>  exposure_dat = exp_dat, <br>  outcome_dat = chd_out_dat<br>)<br>res2 &lt;- mr(dat2)<br></code></pre><p data-tool="mdnice编辑器"><code>subset_on_method</code>函数对每一个暴露-结局组合只保留一个结果，如果工具变量大于1个就保留IVW法的结果，如果只有1个工具变量就保留Wald-ratio的结果。</p><pre data-tool="mdnice编辑器"><code><span># 只保留1个结果</span><br>res2 &lt;- subset_on_method(res2) <br><span># 排序</span><br>res2 &lt;- sort_1_to_many(res2, b = <span>"b"</span>, sort_action = <span>4</span>) <span># 按照效应递减排个序</span><br><br><span># 把 Adiponectin || id:ieu-a-1 这种，去掉后面的id，好看一点</span><br>res2 &lt;- split_exposure(res2) <br><br><span># 计算下权重，以便森林图的黑色方块可以有不同的大小</span><br>res2$weight &lt;- <span>1</span>/res2$se<br><br><span># 计算下95%可信区间的上下限，方便画图时确定上下端点的值</span><br>min(exp(res2$b - <span>1.96</span>*res2$se)) <span># 0.3233985，'lo' </span><br>max(exp(res2$b + <span>1.96</span>*res2$se)) <span># 2.489726，'up'</span><br><br><span># 画图</span><br>forest_plot_1_to_many(<br>  res2,<br>  b = <span>"b"</span>,<br>  se = <span>"se"</span>,<br>  exponentiate = <span>TRUE</span>,<br>  ao_slc = <span>FALSE</span>,<br>  lo = <span>0.3</span>,<br>  up = <span>2.5</span>,<br>  TraitM = <span>"exposure"</span>,<br>  col1_width = <span>2</span>,<br>  by = <span>NULL</span>,<br>  trans = <span>"log2"</span>,<br>  xlab = <span>"OR for CHD per SD increase in risk factor (95% CI)"</span>,<br>  weight = <span>"weight"</span><br>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100017484" data-ratio="0.5956907477820025" data-type="png" data-w="789" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpich5g5HHCYDm3L4o89GAxJTgSIgt0u4AoQzftiaxPqjjz5eZY8iaK2f4JiaA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpich5g5HHCYDm3L4o89GAxJTgSIgt0u4AoQzftiaxPqjjz5eZY8iaK2f4JiaA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">这张图就同时展示了6个暴露因素和结局，分别进行MR分析的结果，可以方便的看出每个暴露因素对结局的效应大小，最上面的效应最大，还展示了可信区间等。</p><p data-tool="mdnice编辑器">还可以多添加几列信息，比如把P值和SNP的数量加到森林图中一起展示：</p><pre data-tool="mdnice编辑器"><code><span># 改下P值的显示方法</span><br>res2$pval&lt;-formatC(res2$pval, format = <span>"e"</span>, digits = <span>2</span>)<br><br>forest_plot_1_to_many(<br>  res2,<br>  b = <span>"b"</span>,<br>  se = <span>"se"</span>,<br>  exponentiate = <span>TRUE</span>,<br>  ao_slc = <span>FALSE</span>,<br>  lo = <span>0.3</span>,<br>  up = <span>2.5</span>,<br>  TraitM = <span>"exposure"</span>,<br>  by = <span>NULL</span>,<br>  trans = <span>"log2"</span>,<br>  xlab = <span>"OR for CHD per SD increase in risk factor (95% CI)"</span>,<br>  weight = <span>"weight"</span>,<br>  subheading_size = <span>11</span>,<br>  col1_title = <span>"Risk factor"</span>,<br>  col1_width = <span>2.5</span>,<br>  col_text_size = <span>4</span>,<br>  addcols = c(<span>"nsnp"</span>, <span>"pval"</span>), <span># 把这两列加进去</span><br>  addcol_widths = c(<span>1.0</span>, <span>1.0</span>) <span># 这两列的宽度</span><br>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100017485" data-ratio="0.6202046035805626" data-type="png" data-w="782" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpichBc1orxgxNlcibcAHXYCvj5Nc8bBaJG6asuRlqJA8axEYKl4usm7rDHw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpichBc1orxgxNlcibcAHXYCvj5Nc8bBaJG6asuRlqJA8axEYKl4usm7rDHw/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>例2</span><span></span></h3><p data-tool="mdnice编辑器">上面是合并展示不同的暴露因素，每个MR分析只选了一种分析方法的结果进行展示。也可以根据暴露因素分层，每个暴露因素和结局的MR分析展示多个方法的结果。</p><pre data-tool="mdnice编辑器"><code>res2 &lt;- mr(dat2)<br>res2 &lt;- split_exposure(res2) <br><br>res2 &lt;-<br>  sort_1_to_many(<br>    res2,<br>    group = <span>"exposure"</span>, <span># 分层变量</span><br>    sort_action = <span>3</span>, <span># 相同暴露因素的MR分析结果放在一起</span><br>    priority = <span>"Inverse variance weighted"</span>, <span># 哪种方法放在最上面</span><br>    trait_m = <span>"method"</span><br>  )<br><br>forest_plot_1_to_many(<br>  res2,<br>  b = <span>"b"</span>,<br>  se = <span>"se"</span>,<br>  exponentiate = <span>TRUE</span>,<br>  trans = <span>"log2"</span>,<br>  ao_slc = <span>FALSE</span>,<br>  lo = <span>0.03</span>,<br>  up = <span>22</span>,<br>  col1_width = <span>2</span>,<br>  by = <span>"exposure"</span>, <span># 分层变量</span><br>  TraitM = <span>"method"</span>,<br>  xlab = <span>"OR for CHD per SD increase in risk factor (95% CI)"</span>,<br>  subheading_size = <span>12</span>,<br>  col_text_size = <span>4</span><br>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100017487" data-ratio="2.3486973947895793" data-type="png" data-w="499" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpichy5CpArKv1DibLr9JOPlicgy7shfRh5O0aRLvA8GyyJyXSbtwlWcTHQcw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RicpaO98VzZqtk1ibibeGJFpichy5CpArKv1DibLr9JOPlicgy7shfRh5O0aRLvA8GyyJyXSbtwlWcTHQcw/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>多变量MR（MVMR）</span><span></span></h2><p data-tool="mdnice编辑器">当SNP和多个暴露因素都有关系时，可以进行多变量MR分析（Multivariable MR）。大概的过程是这样的：</p><ol data-tool="mdnice编辑器"><li><section>提取每个暴露因素的SNP</section></li><li><section>合并这些SNP</section></li><li><section>去除连锁不平衡的SNP</section></li><li><section>重新从以上数据中提取SNP</section></li><li><section>统一数据，确保effect allele一样</section></li><li><section>使用多变量MR方法进行分析</section></li></ol><p data-tool="mdnice编辑器">实际用代码实现是非常简单的过程。</p><p data-tool="mdnice编辑器">比如我们有以下3个暴露因素，它们彼此之间是相关的：</p><ul data-tool="mdnice编辑器"><li><section>HDL:ieu-a-299</section></li><li><section>LDL:ieu-a-300</section></li><li><section>total cholesterol:ieu-a-302</section></li></ul><p data-tool="mdnice编辑器">结局是冠心病：</p><p data-tool="mdnice编辑器">coronary heart disease (CHD):ieu-a-7</p><pre data-tool="mdnice编辑器"><code>id_exposure &lt;- c(<span>"ieu-a-299"</span>, <span>"ieu-a-300"</span>, <span>"ieu-a-302"</span>)<br>id_outcome &lt;- <span>"ieu-a-7"</span><br></code></pre><p data-tool="mdnice编辑器">首先查找这几个暴露相关的SNP，这个函数会自定进行合并、去除LD等，1行代码就解决了：</p><pre data-tool="mdnice编辑器"><code><span># 提取SNP</span><br>exposure_datm &lt;- mv_extract_exposures(id_exposure)<br><br><span># Please look at vignettes for options on running this locally if you need to run many instances of this command.</span><br><span># Clumping 1, 214 variants, using EUR population reference</span><br><span># Removing 70 of 214 variants due to LD with other variants or absence from LD reference panel</span><br><span># Extracting data for 144 SNP(s) from 3 GWAS(s)</span><br><span># Harmonising HDL cholesterol || id:ieu-a-299 (ieu-a-299) and LDL cholesterol || id:ieu-a-300 (ieu-a-300)</span><br><span># Harmonising HDL cholesterol || id:ieu-a-299 (ieu-a-299) and Triglycerides || id:ieu-a-302 (ieu-a-302)</span><br><br><br>head(exposure_datm[order(exposure_datm$SNP),],<span>12</span>)<br><br><span>#     SNP                        exposure id.exposure</span><br><span># 1   rs10019888 HDL cholesterol || id:ieu-a-299   ieu-a-299</span><br><span># 145 rs10019888 LDL cholesterol || id:ieu-a-300   ieu-a-300</span><br><span># 289 rs10019888   Triglycerides || id:ieu-a-302   ieu-a-302</span><br><span># 2     rs103294 HDL cholesterol || id:ieu-a-299   ieu-a-299</span><br><span># 146   rs103294 LDL cholesterol || id:ieu-a-300   ieu-a-300</span><br><span># 290   rs103294   Triglycerides || id:ieu-a-302   ieu-a-302</span><br><span># 3   rs10468017 HDL cholesterol || id:ieu-a-299   ieu-a-299</span><br><span># 147 rs10468017 LDL cholesterol || id:ieu-a-300   ieu-a-300</span><br><span># 291 rs10468017   Triglycerides || id:ieu-a-302   ieu-a-302</span><br><span># 4    rs1047891 HDL cholesterol || id:ieu-a-299   ieu-a-299</span><br><span># 148  rs1047891 LDL cholesterol || id:ieu-a-300   ieu-a-300</span><br><span># 292  rs1047891   Triglycerides || id:ieu-a-302   ieu-a-302</span><br><span>#     effect_allele.exposure other_allele.exposure eaf.exposure</span><br><span># 1                        G                     A       0.1636</span><br><span># 145                      G                     A       0.1636</span><br><span># 289                      G                     A       0.1636</span><br><span># 2                        T                     C       0.1860</span><br><span># 146                      T                     C       0.1860</span><br><span># 290                      T                     C       0.1860</span><br><span># 3                        T                     C       0.2757</span><br><span># 147                      T                     C       0.2757</span><br><span># 291                      T                     C       0.2757</span><br><span># 4                        A                     C       0.3021</span><br><span># 148                      A                     C       0.3021</span><br><span># 292                      A                     C       0.3021</span><br><span>#     beta.exposure se.exposure pval.exposure</span><br><span># 1         -0.0270      0.0046   4.90095e-08</span><br><span># 145        0.0182      0.0050   3.23199e-04</span><br><span># 289        0.0228      0.0045   2.28302e-06</span><br><span># 2          0.0523      0.0044   3.99485e-30</span><br><span># 146        0.0073      0.0047   1.22500e-01</span><br><span># 290       -0.0021      0.0042   7.52101e-01</span><br><span># 3          0.1179      0.0038  1.21060e-188</span><br><span># 147        0.0020      0.0042   7.46799e-01</span><br><span># 291        0.0379      0.0039   7.55962e-21</span><br><span># 4         -0.0269      0.0039   8.72991e-10</span><br><span># 148        0.0079      0.0042   1.42200e-01</span><br><span># 292        0.0000      0.0038   8.60200e-01</span><br></code></pre><p data-tool="mdnice编辑器">可以看到每个SNP对应3种暴露。</p><p data-tool="mdnice编辑器">然后提取和结局相关的SNP：</p><pre data-tool="mdnice编辑器"><code>outcome_datm &lt;- extract_outcome_data(exposure_datm$SNP, id_outcome)<br><br><span># Extracting data for 144 SNP(s) from 1 GWAS(s)</span><br><span># Finding proxies for 1 SNPs in outcome ieu-a-7</span><br><span># Extracting data for 1 SNP(s) from 1 GWAS(s)</span><br></code></pre><p data-tool="mdnice编辑器">统一数据：</p><pre data-tool="mdnice编辑器"><code>mvdat &lt;- mv_harmonise_data(exposure_datm, outcome_datm)<br><span># Harmonising HDL cholesterol || id:ieu-a-299 (ieu-a-299) and Coronary </span><br><span># heart disease || id:ieu-a-7 (ieu-a-7)</span><br></code></pre><p data-tool="mdnice编辑器">进行多变量MR分析：</p><pre data-tool="mdnice编辑器"><code>resm &lt;- mv_multiple(mvdat)<br>resm<br><br><span># $result</span><br><span># id.exposure                        exposure id.outcome</span><br><span># 1   ieu-a-299 HDL cholesterol || id:ieu-a-299    ieu-a-7</span><br><span># 2   ieu-a-300 LDL cholesterol || id:ieu-a-300    ieu-a-7</span><br><span># 3   ieu-a-302   Triglycerides || id:ieu-a-302    ieu-a-7</span><br><span># outcome nsnp           b         se</span><br><span># 1 Coronary heart disease || id:ieu-a-7   79 -0.08919724 0.05970552</span><br><span># 2 Coronary heart disease || id:ieu-a-7   68  0.37853543 0.04976846</span><br><span># 3 Coronary heart disease || id:ieu-a-7   42  0.13584165 0.06738291</span><br><span># pval</span><br><span># 1 1.351879e-01</span><br><span># 2 2.828614e-14</span><br><span># 3 4.380354e-02</span><br></code></pre><p data-tool="mdnice编辑器">结果说明<code>ieu-a-299</code>，也就是HDL对冠心病是没有因果关系的。</p><p data-tool="mdnice编辑器">如果你单独对每个暴露因素做MR分析，结果可能和多变量MR的结果不同。</p><h2 data-tool="mdnice编辑器"><span></span><span>MR-MoE</span><span></span></h2><p data-tool="mdnice编辑器">使用机器学习方法确定最佳的MR方法。MR-MoE:Using a mixture of experts machine learning approach</p><p data-tool="mdnice编辑器">可以使用随机森林算法评估11种MR方法的准确性。</p><p data-tool="mdnice编辑器">相关的参考文献（详细的方法学介绍）可以通过链接查看：https://www.biorxiv.org/content/10.1101/173682v2<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="22px" height="22px" viewbox="0 0 32 32" enable-background="new 0 0 32 32"><image width="32" height="32" x="0" y="0"></image></svg></p><p data-tool="mdnice编辑器">使用方法是很简单的，首先需要下载官方制作的训练数据，下载链接：https://www.dropbox.com/s/5la7y38od95swcf/rf.rdata?dl=0</p><p data-tool="mdnice编辑器">然后通过以下代码即可实现使用<strong>随机森林</strong>确定最佳的MR方法：</p><pre data-tool="mdnice编辑器"><code><span># 前面的步骤都是一样的</span><br>exposure_dat &lt;- extract_instruments(<span>"ieu-a-2"</span>)<br>outcome_dat &lt;- extract_outcome_data(exposure_dat$SNP, <span>"ieu-a-7"</span>)<br>dat &lt;- harmonise_data(exposure_dat, outcome_dat)<br><br><span># 加载下载的数据</span><br>load(<span>"./ieu/rf.rdata"</span>)<br><br><span># 整合所有MR方法的结果</span><br>res1 &lt;- mr_wrapper(dat)<br><br><span># Performing MR analysis of 'ieu-a-2' on 'ieu-a-7'</span><br><span># Body mass index || id:ieu-a-2 - Coronary heart disease || id:ieu-a-7</span><br><span># Body mass index || id:ieu-a-2 - Coronary heart disease || id:ieu-a-7</span><br><span># Body mass index || id:ieu-a-2 - Coronary heart disease || id:ieu-a-7</span><br><span># Body mass index || id:ieu-a-2 - Coronary heart disease || id:ieu-a-7</span><br> <br><br><span>library</span>(dplyr)<br><span># MR-MoE：预测每种方法的性能</span><br>res_moe &lt;- mr_moe(res1, rf)<br></code></pre><p data-tool="mdnice编辑器">结果查看：</p><pre data-tool="mdnice编辑器"><code>res_moe$`ieu-a-2.ieu-a-7`$estimates<br><br><span># A tibble: 44 × 14</span><br>   id.exposure id.outcome method     nsnp     b     se ci_low ci_upp<br>   &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;<br> <span>1</span> ieu-a-<span>2</span>     ieu-a-<span>7</span>    FE IVW       <span>69</span> <span>0.464</span> <span>0.0415</span>  <span>0.383</span>  <span>0.546</span><br> <span>2</span> ieu-a-<span>2</span>     ieu-a-<span>7</span>    RE IVW       <span>69</span> <span>0.464</span> <span>0.0415</span>  <span>0.383</span>  <span>0.546</span><br> <span>3</span> ieu-a-<span>2</span>     ieu-a-<span>7</span>    Simple m…    <span>69</span> <span>0.439</span> <span>0.0465</span>  <span>0.348</span>  <span>0.530</span><br> <span>4</span> ieu-a-<span>2</span>     ieu-a-<span>7</span>    FE IVW       <span>79</span> <span>0.446</span> <span>0.0439</span>  <span>0.330</span>  <span>0.561</span><br> <span>5</span> ieu-a-<span>2</span>     ieu-a-<span>7</span>    RE IVW       <span>69</span> <span>0.464</span> <span>0.0415</span>  <span>0.383</span>  <span>0.546</span><br> <span>6</span> ieu-a-<span>2</span>     ieu-a-<span>7</span>    Simple m…    <span>79</span> <span>0.393</span> <span>0.0683</span>  <span>0.259</span>  <span>0.527</span><br> <span>7</span> ieu-a-<span>2</span>     ieu-a-<span>7</span>    Simple m…    <span>69</span> <span>0.397</span> <span>0.0687</span>  <span>0.262</span>  <span>0.532</span><br> <span>8</span> ieu-a-<span>2</span>     ieu-a-<span>7</span>    FE IVW       <span>69</span> <span>0.464</span> <span>0.0415</span>  <span>0.383</span>  <span>0.546</span><br> <span>9</span> ieu-a-<span>2</span>     ieu-a-<span>7</span>    Weighted…    <span>69</span> <span>0.383</span> <span>0.0747</span>  <span>0.236</span>  <span>0.529</span><br><span>10</span> ieu-a-<span>2</span>     ieu-a-<span>7</span>    FE IVW       <span>79</span> <span>0.446</span> <span>0.0439</span>  <span>0.330</span>  <span>0.561</span><br><span># ℹ 34 more rows</span><br><span># ℹ 6 more variables: pval &lt;dbl&gt;, steiger_filtered &lt;lgl&gt;,</span><br><span>#   outlier_filtered &lt;lgl&gt;, selection &lt;chr&gt;, method2 &lt;chr&gt;,</span><br><span>#   MOE &lt;dbl&gt;</span><br><span># ℹ Use `print(n = ...)` to see more rows</span><br></code></pre><p data-tool="mdnice编辑器">这个结果<code>res_moe</code>是一个列表，主要包含以下几个元素：</p><ul data-tool="mdnice编辑器"><li><section><code>estimates</code>：每种MR方法的结果</section></li><li><section><code>heterogeneity</code>：异质性检验的结果</section></li><li><section><code>directional_pleiotropy</code>：egger intercepts的结果</section></li><li><section><code>info</code>：用于产生MOE的指标</section></li></ul><p data-tool="mdnice编辑器">主要是看<code>estimates</code>中的<code>MOE</code>列，这是每个方法的AUC值，越大说明这个方法越好。</p><h2 data-tool="mdnice编辑器"><span></span><span>整合所有结果</span><span></span></h2><p data-tool="mdnice编辑器">就是把所有结果放到一个数据框中，感觉用处不大...</p><pre data-tool="mdnice编辑器"><code>res &lt;- mr(dat)<br>het &lt;- mr_heterogeneity(dat)<br>plt &lt;- mr_pleiotropy_test(dat)<br>sin &lt;- mr_singlesnp(dat)<br><br><span># 合并所有结果</span><br>all_res &lt;-<br>  combine_all_mrresults(<br>    res,<br>    het,<br>    plt,<br>    sin,<br>    ao_slc = <span>TRUE</span>,<br>    Exp = <span>TRUE</span>,<br>    split.exposure = <span>FALSE</span>,<br>    split.outcome = <span>TRUE</span><br>  )<br>head(all_res[, c(<br>  <span>"Method"</span>,<br>  <span>"outcome"</span>,<br>  <span>"exposure"</span>,<br>  <span>"nsnp"</span>,<br>  <span>"b"</span>,<br>  <span>"se"</span>,<br>  <span>"pval"</span>,<br>  <span>"intercept"</span>,<br>  <span>"intercept_se"</span>,<br>  <span>"intercept_pval"</span>,<br>  <span>"Q"</span>,<br>  <span>"Q_df"</span>,<br>  <span>"Q_pval"</span>,<br>  <span>"consortium"</span>,<br>  <span>"ncase"</span>,<br>  <span>"ncontrol"</span>,<br>  <span>"pmid"</span>,<br>  <span>"population"</span><br>)])<br><br><span># 1 Inverse variance weighted Coronary heart disease</span><br><span># 2                  MR Egger Coronary heart disease</span><br><span># 3               Simple mode Coronary heart disease</span><br><span># 4                Wald ratio Coronary heart disease</span><br><span># 5                Wald ratio Coronary heart disease</span><br><span># 6                Wald ratio Coronary heart disease</span><br><span>#                       exposure nsnp          b         se</span><br><span># 1 Body mass index || id:ieu-a-2   79  0.4459091 0.05898302</span><br><span># 2 Body mass index || id:ieu-a-2   79  0.5024935 0.14396056</span><br><span># 3 Body mass index || id:ieu-a-2   79  0.3401554 0.15878926</span><br><span># 4 Body mass index || id:ieu-a-2    1  1.1494985 0.37045723</span><br><span># 5 Body mass index || id:ieu-a-2    1 -0.7901087 0.53475543</span><br><span># 6 Body mass index || id:ieu-a-2    1  0.5506335 0.48253394</span><br><span>#           pval    intercept intercept_se intercept_pval        Q</span><br><span># 1 4.032020e-14           NA           NA             NA 143.6508</span><br><span># 2 8.012590e-04 -0.001719304  0.003985962      0.6674266 143.3046</span><br><span># 3 3.529868e-02           NA           NA             NA       NA</span><br><span># 4 1.916225e-03           NA           NA             NA       NA</span><br><span># 5 1.395379e-01           NA           NA             NA       NA</span><br><span># 6 2.538162e-01           NA           NA             NA       NA</span><br><span>#              Q_df       Q_pval        consortium ncase ncontrol     pmid</span><br><span># 1   78 8.728420e-06 CARDIoGRAMplusC4D 60801   123504 26343387</span><br><span># 2   77 6.841585e-06 CARDIoGRAMplusC4D 60801   123504 26343387</span><br><span># 3   NA           NA CARDIoGRAMplusC4D 60801   123504 26343387</span><br><span># 4   NA           NA CARDIoGRAMplusC4D 60801   123504 26343387</span><br><span># 5   NA           NA CARDIoGRAMplusC4D 60801   123504 26343387</span><br><span># 6   NA           NA CARDIoGRAMplusC4D 60801   123504 26343387</span><br><span>#    population</span><br><span># 1      Mixed</span><br><span># 2      Mixed</span><br><span># 3      Mixed</span><br><span># 4      Mixed</span><br><span># 5      Mixed</span><br><span># 6      Mixed</span><br></code></pre><p data-tool="mdnice编辑器">OVER！</p><p data-tool="mdnice编辑器">后面的推文就是介绍如何从各大数据库下载数据到本地进行MR分析了。</p></section><p><span><br></span></p><hr><blockquote><p><span><strong>联系我们，关注我们</strong></span></p><ol><li><section>免费QQ交流群1：613637742</section></li><li><section>免费QQ交流群2：608720452</section></li><li><section>公众号消息界面关于作者获取联系方式</section></li><li><section>知乎、CSDN、简书同名账号</section></li><li><section>哔哩哔哩：阿越就是我</section></li></ol></blockquote></section></section></section></section></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Db_eeCoPn0Gv2ilROh642g",target="_blank" rel="noopener noreferrer">原文链接</a>
