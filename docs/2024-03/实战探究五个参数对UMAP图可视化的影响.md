---
title: "实战探究五个参数对UMAP图可视化的影响"
date: 2024-03-23T15:01:01Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
实战探究五个参数对UMAP图可视化的影响 by 单细胞天地
------
<div><section data-style-type="5" data-tools="新媒体排版" data-id="2430070"><section data-style-type="5" data-tools="新媒体排版" data-id="2390348"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section><br></section><section><section><section powered-by="xiumi.us"><section><section><p>分享是一种态度</p></section></section></section></section></section></section></section></section><section><section powered-by="xiumi.us"><section><section><img data-imgfileid="100037087" data-ratio="0.8738095238095238" data-src="https://mmbiz.qpic.cn/mmbiz_gif/siaia0BDGJdjSnnb9ibXpFagGPWQ0JjSSTNVBZthROEhicfINuLcxX2Ro3Zb600LJhrzeYIb120tLjSVXEtLn14DwA/640?wx_fmt=gif" data-type="gif" data-w="420" width="100%" src="https://mmbiz.qpic.cn/mmbiz_gif/siaia0BDGJdjSnnb9ibXpFagGPWQ0JjSSTNVBZthROEhicfINuLcxX2Ro3Zb600LJhrzeYIb120tLjSVXEtLn14DwA/640?wx_fmt=gif"></section></section></section></section></section></section></section></section></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><blockquote><p>这篇文章《<strong>A comprehensive single-cell map of T cell exhaustion-associated immune environ- ments in human breast cancer</strong>》的UMAP图中T细胞和B细胞是分开的，但之前复现的时候发现T细胞和B细胞是连接在一起的。有很多小伙伴纠结于为什么我复现的可视化图和原文献很不一样呢。其实也不用太紧张，有的参数只是影响了肉眼但不会影响细胞的本质的属性（也就是分群）。但是如果想较真还是可以探索一下参数的影响滴。</p></blockquote></blockquote><p data-tool="mdnice编辑器">这篇推文的目的是探索一些重要参数对后续分群UMAP可视化的影响。参数主要考虑：<span>高变基因个数；pca维数；UMAP中的n_neighbors，min_dist和dims参数</span>。影响主要看T细胞和B细胞是否分开。</p><p data-tool="mdnice编辑器"><span>marker基因的背景知识：</span></p><ul data-tool="mdnice编辑器"><li><section>T细胞（CD3D,CD3E）</section></li><li><section>B细胞（MS4A1,CD79A）</section></li></ul><h2 data-tool="mdnice编辑器"><span></span><span>参数定义</span></h2><ul data-tool="mdnice编辑器"><li><section>FindVariableFeatures 的 nfeatures 参数（高变基因个数）</section></li><li><section>RunPCA 的 npcs 参数（PCA的维数）</section></li><li><section>RunUMAP 的 n.neighbors 和 min.dist 参数</section></li><ul><li><section>n_neighbors -- 用于构建初始高维图的近似最近邻点的数量。它有效地控制了UMAP如何平衡局部结构和全局结构--低值会促使UMAP在分析高维数据时，通过约束考虑的邻点数量，更加关注局部结构，而高值则会促使UMAP倾向于表示大局结构，同时失去精细的细节。</section></li><li><section>min_dist -- 是低维空间中点之间的最小距离。这个参数控制了UMAP将点紧密地聚集在一起的程度，数值越低，嵌入的点就越紧密。更大的min_dist值会使UMAP将点更松散地包装在一起，而专注于保存广泛的拓扑结构。</section></li><li><section>dims -- 考虑的特征维数（Which dimensions to use as input features, used only if features is NULL）</section></li></ul></ul><p data-tool="mdnice编辑器"><span>下面来看看控制一个参数变量改变的影响吧：</span></p><h2 data-tool="mdnice编辑器"><span></span><span>高变基因的影响</span></h2><h3 data-tool="mdnice编辑器"><span></span><span>高变基因个数为3000：</span><span></span></h3><p data-tool="mdnice编辑器">具体参数：</p><ul data-tool="mdnice编辑器"><li><section>高变基因3000；</section></li><li><section>pca维数110；</section></li><li><section>UMAP参数：n_neighbors为50，min_dist为0.1，dims为1:15</section></li></ul><p data-tool="mdnice编辑器"><img data-imgfileid="100037094" data-ratio="0.49648946840521563" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tp2RyDYJ5K79DWNHXh8iaQzgO1xJTHW9RuZEicWODDT6Wff1nWgsZThog/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="997" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tp2RyDYJ5K79DWNHXh8iaQzgO1xJTHW9RuZEicWODDT6Wff1nWgsZThog/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100037092" data-ratio="0.49846153846153846" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1toPytWt6Qlc1jlbC4ibyRjdkweTUfXQobyDenG4RyKX9CNacwqlkgCYg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="975" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1toPytWt6Qlc1jlbC4ibyRjdkweTUfXQobyDenG4RyKX9CNacwqlkgCYg/640?wx_fmt=png&amp;from=appmsg"></p><h3 data-tool="mdnice编辑器"><span></span><span>高变基因个数为2000：</span><span></span></h3><p data-tool="mdnice编辑器">具体参数：</p><ul data-tool="mdnice编辑器"><li><section>高变基因2000；</section></li><li><section>pca维数110；</section></li><li><section>UMAP参数：n_neighbors为50，min_dist为0.1，dims为1:15</section></li></ul><p data-tool="mdnice编辑器"><img data-imgfileid="100037095" data-ratio="0.4942922374429224" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tomAVgf3VZoibeKHKEyTCOHTaicL2NibeuxDicrpAuZvMoR8wyDcMc0XSMg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="876" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tomAVgf3VZoibeKHKEyTCOHTaicL2NibeuxDicrpAuZvMoR8wyDcMc0XSMg/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100037091" data-ratio="0.4929078014184397" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tia4kv7LGUvWyJafTiaBKze8aSR1gdkYfxG6wW5VVq5xrY5KicNLib06Uog/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="846" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tia4kv7LGUvWyJafTiaBKze8aSR1gdkYfxG6wW5VVq5xrY5KicNLib06Uog/640?wx_fmt=png&amp;from=appmsg"></p><blockquote data-tool="mdnice编辑器"><p>可以看到在高变基因3000的时候，T细胞和B细胞是分开的。然而在高变基因2000的时候，T细胞和B细胞是连接在一起的。</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>PCA维数的影响</span></h2><h3 data-tool="mdnice编辑器"><span></span><span>PCA维数（npcs）为110：</span><span></span></h3><p data-tool="mdnice编辑器">具体参数：</p><ul data-tool="mdnice编辑器"><li><section>高变基因3000；</section></li><li><section>pca维数110；</section></li><li><section>UMAP参数：n_neighbors为30，min_dist为0.3，dims为1:15</section></li></ul><figure data-tool="mdnice编辑器"><img data-imgfileid="100037093" data-ratio="0.4824016563146998" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tibjpZ2EaKBUrEaLTPLib56yzdECU17jkftVI9IpHLB7M01ZaJG80WFpQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="966" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tibjpZ2EaKBUrEaLTPLib56yzdECU17jkftVI9IpHLB7M01ZaJG80WFpQ/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>PCA维数（npcs）为30：</span><span></span></h3><p data-tool="mdnice编辑器">具体参数：</p><ul data-tool="mdnice编辑器"><li><section>高变基因3000；</section></li><li><section>pca维数30；</section></li><li><section>UMAP参数：n_neighbors为30，min_dist为0.3，dims为1:15</section></li></ul><figure data-tool="mdnice编辑器"><img data-imgfileid="100037100" data-ratio="0.49074074074074076" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1t9TkJvSSx1SwlrogicdfLUWt5FfUf475rlbE56pibZoqyLCq5XzmNolLQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1t9TkJvSSx1SwlrogicdfLUWt5FfUf475rlbE56pibZoqyLCq5XzmNolLQ/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><p>在PCA维数为110和30的情况下，T细胞和B细胞是连接着的。但是PCA维数为110的时候，T细胞分为了两个部分，而维数为30的时候，T细胞是一个部分。</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>UMAP参数中的n_neighbors的影响</span></h2><h3 data-tool="mdnice编辑器"><span></span><span>n_neighbors为50：</span><span></span></h3><p data-tool="mdnice编辑器">具体参数：</p><ul data-tool="mdnice编辑器"><li><section>高变基因3000；</section></li><li><section>pca维数50；</section></li><li><section>UMAP参数：n_neighbors为50，min_dist为0.3，dims为1:15</section></li></ul><figure data-tool="mdnice编辑器"><img data-imgfileid="100037099" data-ratio="0.49427679500520294" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tkI9MzEDSNfLpBDs0R3N9IOc721xReFZaXVKic424mSTYiaDmWib5EvNIQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="961" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tkI9MzEDSNfLpBDs0R3N9IOc721xReFZaXVKic424mSTYiaDmWib5EvNIQ/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>n_neighbors为20：</span><span></span></h3><p data-tool="mdnice编辑器">具体参数：</p><ul data-tool="mdnice编辑器"><li><section>高变基因3000；</section></li><li><section>pca维数50；</section></li><li><section>UMAP参数：n_neighbors为20，min_dist为0.3，dims为1:15</section></li></ul><figure data-tool="mdnice编辑器"><img data-imgfileid="100037097" data-ratio="0.48956158663883087" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tKZYnVekdWyafudQa4TudODnfic7xpb4ibtPLChk6960f8v80QVxIxrzA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="958" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tKZYnVekdWyafudQa4TudODnfic7xpb4ibtPLChk6960f8v80QVxIxrzA/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><p>这个参数的影响不大</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>UMAP参数中的min_dist的影响</span></h2><h3 data-tool="mdnice编辑器"><span></span><span>min_dist为0.01：</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-imgfileid="100037096" data-ratio="0.4932920536635707" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tvVCg6hFPVcuicHrkUp2ib33QN0GDUBsWPkrWHanibXJz25PTkF2EnMPVQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="969" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tvVCg6hFPVcuicHrkUp2ib33QN0GDUBsWPkrWHanibXJz25PTkF2EnMPVQ/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>min_dist为0.5：</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-imgfileid="100037098" data-ratio="0.49631190727081137" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tZfxicaoRiaiaia5vTZ0Ft4k66Fs84icuMHZE1XV9Je7d7iaxZIePRiaGiaT26g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="949" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tZfxicaoRiaiaia5vTZ0Ft4k66Fs84icuMHZE1XV9Je7d7iaxZIePRiaGiaT26g/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><p>这个参数的影响挺大的。min_dist为0.01的时候，可以将T细胞和B细胞分开。</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>UMAP中dims参数的影响</span></h2><h3 data-tool="mdnice编辑器"><span></span><span>dims参数为1:27：</span><span></span></h3><p data-tool="mdnice编辑器"><img data-imgfileid="100037104" data-ratio="0.4959016393442623" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tDwLKMaGNFB2Umy8j5K9sZmPngQIjSaaBY4mjz7sp0vzG5xQR69ibp0A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="976" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tDwLKMaGNFB2Umy8j5K9sZmPngQIjSaaBY4mjz7sp0vzG5xQR69ibp0A/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100037102" data-ratio="0.4959514170040486" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tS4mmBv9bicFjHQfTxZ9qibwR4g8KTzKIxfU8S5arLVuB9MqlafY50pHA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="988" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tS4mmBv9bicFjHQfTxZ9qibwR4g8KTzKIxfU8S5arLVuB9MqlafY50pHA/640?wx_fmt=png&amp;from=appmsg"></p><h3 data-tool="mdnice编辑器"><span></span><span>dims参数为1:15：</span><span></span></h3><p data-tool="mdnice编辑器"><img data-imgfileid="100037103" data-ratio="0.503030303030303" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tic9eQ4fVykXeE3QnaGicc1MKBAIdArf2hy3FX4rveClCcibzE6HqEV3fQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="990" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tic9eQ4fVykXeE3QnaGicc1MKBAIdArf2hy3FX4rveClCcibzE6HqEV3fQ/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100037105" data-ratio="0.4886128364389234" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tSHzKX6LyAnXgJrhO0XS6YWUTjvSP20zGm4ErMqA0ibhicJVwGibdSVaYA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="966" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjT1qPR84vCZPtRlibMFzjib1tSHzKX6LyAnXgJrhO0XS6YWUTjvSP20zGm4ErMqA0ibhicJVwGibdSVaYA/640?wx_fmt=png&amp;from=appmsg"></p><blockquote data-tool="mdnice编辑器"><p>可以看到在dims参数为1:27的时候，T细胞和B细胞是分开的。然而在dims参数为1:15的时候，T细胞和B细胞是连接在一起的。</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>小结</span></h2><h3 data-tool="mdnice编辑器"><span></span><span>会影响分群和UMAP可视化的参数：</span><span></span></h3><p data-tool="mdnice编辑器">从这次的结果看，增加高变基因数目会把T细胞和B细胞分开。而PCA维数的增加没有使T细胞和B细胞分开，但是把T细胞分成了两个部分。</p><p data-tool="mdnice编辑器">之前在这篇推文<a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247520109&amp;idx=1&amp;sn=03e509ee8b7381c8dd2cb0a58ef0891a&amp;scene=21#wechat_redirect" data-linktype="2">初探单细胞分析 — 标准化与降维聚类分群的理解</a>提到过：高变基因个数越多，PCs的数目越多，保留的数据信息也就越多，更有可能引入噪音，运行速度也越慢。但是也不能太少，否则会丢失很多数据信息。</p><p data-tool="mdnice编辑器">所以有可能是增加的高变基因使得T细胞和B细胞之间有更多的差异，可以分开。而PCA维数的增加把T细胞分成了两个部分，可能是由于有噪音引入。</p><h3 data-tool="mdnice编辑器"><span></span><span>不会影响分群，只会影响UMAP可视化的参数：</span><span></span></h3><p data-tool="mdnice编辑器">UMAP参数中的n_neighbors，min_dist和dims这三个参数，是不会影响细胞的本质属性的，只是影响UMAP可视化的图。可以看到减小的min_dist和增加的dims会把T细胞和B细胞分开。n_neighbors的影响不大。</p><p data-tool="mdnice编辑器">希望大家看完之后对参数改变对UMAP图的影响有一些大致的理解。</p><h2 data-tool="mdnice编辑器"><span></span><span>附实例代码</span></h2><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br>options(stringsAsFactors = <span>F</span>) <br><span>source</span>(<span>'../scRNA_scripts/lib.R'</span>)<br>getwd()<br><br><span>###### step1: 导入数据 ######   </span><br><span># 付费环节 800 元人民币</span><br><span># 参考：https://mp.weixin.qq.com/s/tw7lygmGDAbpzMTx57VvFw</span><br>dir=<span>'../inputs/'</span><br>samples=list.files( dir )<br>samples = samples[str_detect(samples,<span>"singlecell_count_matrix.txt"</span>)]<br>sceList = lapply(samples,<span>function</span>(pro){ <br>  <span># pro=samples[7] </span><br>  print(pro)  <br>  ct &lt;- data.table::fread( file.path(dir,pro),<br>                           data.table = <span>F</span>)<br>  ct[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>  rownames(ct)=ct[,<span>1</span>]<br>  ct=ct[,-<span>1</span>]<br>  <span>#ct=t(ct) </span><br>  sce =CreateSeuratObject(counts =  ct ,<br>                          project =  gsub(<span>'_singlecell_count_matrix.txt.gz'</span>,<span>''</span>,pro)  ,<br>                          min.cells = <span>5</span>,<br>                          min.features = <span>300</span> )<br>  <span>return</span>(sce)<br>}) <br>do.call(rbind,lapply(sceList, dim))<br>sce.all=merge(x=sceList[[<span>1</span>]],<br>              y=sceList[ -<span>1</span> ],<br>              add.cell.ids = samples  ) <br>names(sce.all@assays$RNA@layers)<br>sce.all[[<span>"RNA"</span>]]$counts <br><span># Alternate accessor function with the same result</span><br>LayerData(sce.all, assay = <span>"RNA"</span>, layer = <span>"counts"</span>)<br>sce.all &lt;- JoinLayers(sce.all)<br>dim(sce.all[[<span>"RNA"</span>]]$counts )<br><br>as.data.frame(sce.all@assays$RNA$counts[<span>1</span>:<span>10</span>, <span>1</span>:<span>2</span>])<br>head(sce.all@meta.data, <span>10</span>)<br>table(sce.all$orig.ident) <br><br><span>library</span>(stringr)<br>sce.all$orig.ident=str_split(colnames(sce.all),<span>'[-_]'</span>,simplify = <span>T</span>)[,<span>1</span>]<br>table(sce.all$orig.ident) <br>sce.all<br><br><span># 如果为了控制代码复杂度和行数 </span><br><span># 可以省略了质量控制环节</span><br><span>###### step2: QC质控 ######</span><br>dir.create(<span>"./1-QC"</span>)<br>setwd(<span>"./1-QC"</span>)<br><span># 如果过滤的太狠，就需要去修改这个过滤代码</span><br><span>source</span>(<span>'../../scRNA_scripts/qc.R'</span>)<br>sce.all.filt = basic_qc(sce.all)<br>print(dim(sce.all))<br>print(dim(sce.all.filt))<br>setwd(<span>'../'</span>)<br>sp=<span>'human'</span><br>getwd()<br><br>sce.all.filt &lt;- NormalizeData(sce.all.filt, <br>                           normalization.method = <span>"LogNormalize"</span>,<br>                           scale.factor = <span>1e4</span>) <br><br><span>## 评估参数的影响</span><br>variable_nums &lt;- c(<span>2000</span>,<span>3000</span>,<span>4000</span>)<br>npcs_nums &lt;- c(<span>30</span>,<span>50</span>,<span>70</span>,<span>90</span>,<span>110</span>)<br>neighbors_nums &lt;- c(<span>20</span>,<span>30</span>,<span>40</span>,<span>50</span>)<br>min_dist_nums &lt;- c(<span>0.001</span>,<span>0.01</span>,<span>0.1</span>,<span>0.3</span>,<span>0.5</span>) <br><span># https://zhuanlan.zhihu.com/p/352461768</span><br><span># RunUMAP: n.neighbors default is 30[5-50]; min.dist default is 0.3[0.001-0.5]</span><br><span>if</span>(<span>F</span>){<br>variable_nums=<span>2000</span><br>npcs_nums=<span>50</span><br>neighbors_nums=<span>30</span><br>min_dist_nums=<span>0.001</span><br>}<br><br><span>for</span> (i <span>in</span> variable_nums){<br>  <span>for</span> (j <span>in</span> npcs_nums){<br>    tmp_sce &lt;- FindVariableFeatures(sce.all.filt, selection.method = <span>"vst"</span>,<br>                                    nfeatures = i)<br>    tmp_sce &lt;- ScaleData(tmp_sce)<br>    tmp_sce &lt;- RunPCA(tmp_sce, features = VariableFeatures(object = tmp_sce), <br>                      verbose = <span>FALSE</span>, npcs= j)<br>    tmp_sce &lt;- RunHarmony(tmp_sce, <span>"orig.ident"</span>)<br>    tmp_sce &lt;- FindNeighbors(tmp_sce, dims = <span>1</span>:<span>10</span>, verbose = <span>FALSE</span>,reduction = <span>"harmony"</span>)<br>    tmp_sce &lt;- FindClusters(tmp_sce, resolution = <span>0.5</span>, verbose = <span>FALSE</span>)<br>    table(tmp_sce$seurat_clusters)<br>    <br>    <span>for</span> (n <span>in</span> neighbors_nums){<br>      <span>for</span> (d <span>in</span> min_dist_nums){<br>        tmp_sce &lt;- RunUMAP(tmp_sce, dims = <span>1</span>:<span>15</span>, umap.method = <span>"uwot"</span>, metric = <span>"cosine"</span>, reduction = <span>"harmony"</span>, n.neighbors=n, min.dist=d)<br>        <br>        pdf(paste0(<span>"pca_object_v"</span>,i,<span>".pca_"</span>,j,<span>"neighbors_"</span>,n,<span>"dist_"</span>,d,<span>".pdf"</span>))<br>        p1 &lt;- DimPlot(tmp_sce,label = <span>T</span>,reduction = <span>"umap"</span>,raster=<span>F</span>)<br>        print(p1)<br>        genes_to_check = c(<span>"CD3E"</span>,<span>"CD3D"</span>,<span>"MS4A1"</span>,<span>"CD79A"</span>)<br>        T_genes = c(<span>"CD3E"</span>,<span>"CD3D"</span>)<br>        B_genes = c(<span>"MS4A1"</span>,<span>"CD79A"</span>)<br>        p2 &lt;- DotPlot(tmp_sce , features = genes_to_check )   +<br>        coord_flip()  +<br>        theme(axis.text.x=element_text(angle=<span>45</span>,hjust = <span>1</span>))<br>        print(p2)<br>        p3 &lt;- FeaturePlot(object = tmp_sce, features = T_genes,raster=<span>F</span>) <br>        print(p3)<br>        p4 &lt;- FeaturePlot(object = tmp_sce, features = B_genes,raster=<span>F</span>) <br>        print(p4)        <br>        dev.off()<br>      }<br>    }<br>  }<br>}<br></code></pre></section><section><p><br></p><p><br></p><section data-style-type="5" data-tools="新媒体排版" data-id="2440476"><section><section><section><section><img data-imgfileid="100037083" data-ratio="0.9495798319327731" data-src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif" data-type="gif" data-w="119" data-width="100%" src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif"></section><section data-brushtype="text">往期回顾</section><section><br></section></section></section></section><section><section data-autoskip="1"><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247520728&amp;idx=1&amp;sn=884c659d1824f2034a780406f5a7773a&amp;chksm=ea1c975add6b1e4cf0aa78e674ebec2c1a6b25af50fe4d392825bb81ab1ea194fa3c4cbf6e36&amp;scene=21#wechat_redirect" textvalue="单细胞RNA测序揭示了胶质母细胞瘤进展过程中免疫景观的演化" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>单细胞RNA测序揭示了胶质母细胞瘤进展过程中免疫景观的演化</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247520707&amp;idx=1&amp;sn=381d27deb525e7e9ab318ee409c7d037&amp;chksm=ea1c9741dd6b1e57c9723ffe65be22bc90e786854a5ca0ce11b36877662a894b091c13bd3cf2&amp;scene=21#wechat_redirect" textvalue="scanpy和seurat的所有Marker基因可视化方法帮你打包好啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>scanpy和seurat的所有Marker基因可视化方法帮你打包好啦</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247520676&amp;idx=1&amp;sn=3cab626b09db15807da40c7b230bf07d&amp;chksm=ea1c9726dd6b1e302a522a742a768570d6a51f53f42fea5aed223d2218c31d2aba7f39f00e7e&amp;scene=21#wechat_redirect" textvalue="小鼠和人类斑秃的转录图谱" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>小鼠和人类斑秃的转录图谱</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247520646&amp;idx=1&amp;sn=3d874ed24e4540aa3c76227188c629ff&amp;chksm=ea1c9704dd6b1e12cbaf8d697c2b0932b9ed3540e302c8b99bf91edec1a34a4d4c9d30b081cc&amp;scene=21#wechat_redirect" textvalue="整合单细胞和bulk RNA数据确定心力衰竭的关键细胞类型和生物标志物" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>整合单细胞和bulk RNA数据确定心力衰竭的关键细胞类型和生物标志物</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247520597&amp;idx=1&amp;sn=ecbdc314efcde02b8780c774b221bb41&amp;chksm=ea1c97d7dd6b1ec1a1180bb06e2c5f11dec65cc950e0d56190075ec162a92afbdc6f98047291&amp;scene=21#wechat_redirect" textvalue="乳腺癌第一层次降维聚类分群复现" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>乳腺癌第一层次降维聚类分群复现</span></a><br></p></section></section><hr><p><br></p></section><section data-style-type="5" data-tools="新媒体排版" data-id="2440475"><hr><p><br></p><hr><section><p>如果你对单细胞转录组研究感兴趣，但又不知道如何入门，也许你可以关注一下下面的课程<span></span></p><p><br></p><ul><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247520017&amp;idx=1&amp;sn=e6637adaaef9bf79177a277b9274a62a&amp;chksm=ea1c8993dd6b00854bbe54509577cdded9dbea4e961cb0b7740695530c419947256edc494f66&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课3月班" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1">生信入门&amp;数据挖掘线上直播课3月班</a><br></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247520120&amp;idx=1&amp;sn=ad91a187458eb591129d3d366bfccf71&amp;chksm=ea1c89fadd6b00ec227d9588dadf672e1eb88d0449d500602d61f155023ee5721facdc9a5b57&amp;scene=21#wechat_redirect" textvalue="2024的共享服务器交个朋友福利价仍然是800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1">2024的共享服务器交个朋友福利价仍然是800</a></p></li></ul><p><img data-imgfileid="100037086" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif" data-type="gif" data-w="240" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif"><br></p><p><img data-imgfileid="100037085" data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg" data-type="other" data-w="341" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p></section><section><section data-tools="135编辑器" data-id="93668"><section><section data-width="95%"><section><section><section data-width="61.8%"><section><section><section><p><br></p><span><strong data-burshtype="text"><img data-copyright="0" data-cropselx1="0" data-cropselx2="109" data-cropsely1="0" data-cropsely2="109" data-imgfileid="100037084" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg" data-type="other" data-w="258" title="qrcode_for_gh_5a3c482ed99f_1280.jpg" src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg"><strong data-burshtype="text">生物</strong><strong data-burshtype="text"> | 单细胞 | 转录组丨资料</strong></strong></span></section><section><span><strong data-burshtype="text">每天都精彩</strong></span></section></section></section><section><section><section><section><p><span>长按扫码可关注</span></p></section></section></section></section></section></section></section></section></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/2DCGx7GwDKnzub313ay2tQ",target="_blank" rel="noopener noreferrer">原文链接</a>
