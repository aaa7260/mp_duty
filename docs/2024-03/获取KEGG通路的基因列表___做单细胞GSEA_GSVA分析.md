---
title: "获取KEGG通路的基因列表   做单细胞GSEA、GSVA分析"
date: 2024-03-15T00:54:28Z
draft: ["false"]
tags: [
  "fetched",
  "生信小博士"
]
categories: ["Acdemic"]
---
获取KEGG通路的基因列表   做单细胞GSEA、GSVA分析 by 生信小博士
------
<div><section><section powered-by="xiumi.us"><section><section><section><section powered-by="xiumi.us"><section><section><p><br></p></section></section></section></section></section></section></section></section><section><section powered-by="xiumi.us"><section><section><p>使用KEGG通路的基因列表进行单细胞GSEA GSVA分析的过程，我们需要遵循以下步骤：</p><ol><li><p><strong><span>获取KEGG通路的基因列表</span>：</strong>这通常涉及使用专门的R包，如<code>KEGGREST</code>或<code>biomaRt</code>，来查询KEGG数据库并检索特定通路的基因列表。</p></li><li><p><strong><span>准备单细胞表达数据</span>：</strong>这包括加载单细胞RNA-seq数据，通常使用Seurat或其他单细胞分析包进行预处理。</p></li><li><p><span><strong>执行GSVA分析</strong></span>：使用<code>GSVA</code>包对单细胞数据执行基因集变异分析（GSVA），根据KEGG通路的基因列表评估每个单细胞样本的通路活性。</p></li><li><p><span><strong>可视化GSVA结</strong></span><span>果</span>：最后，基于GSVA分析结果，绘制热图或其他类型的图表来展示不同单细胞样本中通路活性的变化。</p></li></ol><p><strong><br></strong></p><p><strong>今天我们主要关注第一步，如何获取<strong><span>KEGG通路的基因列表？</span></strong></strong></p><h3><span>问题来源<span></span></span></h3><h3 data-tool="mdnice编辑器"><span>不管是转录组数据还是单细胞数据都可以做gsva分析。gsva需要两个文件作为输入：</span></h3><p><span>1. 表达矩阵<br></span></p><p><span>2. 基因集</span></p><p><strong><span><br></span></strong></p><p><strong><span>表达矩阵容易获得，但是如果我们想做kegg数据库的通路分析怎么办？如何获取kegg的通路列表？</span></strong></p><h3><span>获取kegg的通路列表代码</span></h3><ul><li><p><span>方法一：使用msigdb</span></p></li></ul><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="perl"><code><span> library(msigdbr)</span></code><code><span>    genesets = msigdbr(species = <span>"Homo sapiens"</span>  ) <span>#msigdbr提供多个物种的基因集数据</span></span></code><code><span>    <span># View(msigdbr_collections()) #查看msigdbr包中所有的基因集</span></span></code><code><span>    unique(genesets$gs_subcat)  <span># 有多个数据库来源的基因集可选，这里选用KEGG</span></span></code><code><span>    genesets &lt;- subset(genesets, gs_subcat==<span>"CP:KEGG"</span>, <span>select</span> = c(<span>"gs_name"</span>, <span>"gene_symbol"</span>))</span></code><code><span>    unique(genesets$gs_name) <span>#查看有多少条通路（186个）</span></span></code><code><span>    </span></code></pre></section><h3 data-tool="mdnice编辑器"><span><span>但是这里面的kegg只有186个基因集合</span></span></h3><p><img data-galleryid="" data-imgfileid="100002546" data-ratio="0.6773333333333333" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkuZLUuwe8OHIBDiamN2cRjZhib8U6DianIyQoXRtUkn4pI8ADfmGcTdUTyZZx4EzlHsqH9iau9aIdrZlg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="375" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkuZLUuwe8OHIBDiamN2cRjZhib8U6DianIyQoXRtUkn4pI8ADfmGcTdUTyZZx4EzlHsqH9iau9aIdrZlg/640?wx_fmt=png&amp;from=appmsg"></p><p><span><span></span></span></p><p><img data-galleryid="" data-imgfileid="100002544" data-ratio="0.5348360655737705" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkuZLUuwe8OHIBDiamN2cRjZhA9n3YZGB5wbd50dQ97c69mQNHmj9OQTTnZxmtXnwN6p1BpUrYiaqCjw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="976" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkuZLUuwe8OHIBDiamN2cRjZhA9n3YZGB5wbd50dQ97c69mQNHmj9OQTTnZxmtXnwN6p1BpUrYiaqCjw/640?wx_fmt=png&amp;from=appmsg"></p><section data-tools="135编辑器" data-id="135403"><section><section><section data-width="100%"><br></section></section></section></section><section data-tools="135编辑器" data-id="135403"><section><section><section data-width="100%"><br></section><section data-width="100%"><br></section><section data-width="100%"><br></section><section><section><br></section></section></section><ul><li><section data-tools="135编辑器" data-id="135403"><section><section><span>方法二 使用 KEGGREST</span></section></section></section><p><br></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><span>#BiocManager::install("KEGGREST")</span></span></code><code><span>    <span>#BiocManager::install("EnrichmentBrowser")</span></span></code><code><span>    library(<span>"KEGGREST"</span>)</span></code><code><span>    library(<span>"EnrichmentBrowser"</span>)</span></code><code><span>    KEGGREST:: listDatabases()</span></code><code><span>    KEGGREST::keggList(database =<span>'kegg'</span>)</span></code><code><span>    keggList(<span>"organism"</span>) <span>## returns the list of KEGG organisms with</span></span></code><code><span>    <span>#step2: check and obtain a list of entry identifiers (in this case: sar) and associated definition for a given database or a given set of database entries.</span></span></code><code><span>    res &lt;- keggList(<span>"pathway"</span>, <span>"hsa"</span>) <span>## returns the list of human pathways</span></span></code><code><span>    length(res)</span></code><code><span>    res=<span>as</span>.data.frame(res)</span></code><code><span>    head(res)</span></code><code><span>    <span>#step 3: download the pathways of that organism:</span></span></code><code><span>    hsapathway &lt;- downloadPathways(<span>"hsa"</span>)</span></code><code><span>    head(hsapathway)</span></code><code><span>    idTypes(org = <span>'hsa'</span> )</span></code><code><span>    <span>#step 4: retrieve gene sets for an organism from databases such as GO and KEGG:</span></span></code><code><span>    hsa_kegg_genesets &lt;- getGenesets(org = <span>"hsa"</span>, db = <span>"kegg"</span>,</span></code><code><span>                                     gene.id.type = <span>"SYMBOL"</span>,</span></code><code><span>                                     cache = <span>TRUE</span>, <span>return</span>.type=<span>"list"</span>)</span></code><code><span>    </span></code><code><span>    <span>#step5: Parse and write the gene sets to a flat text file in GMT format for other pathway enrichment analysis programs (e.g., GSEA):</span></span></code><code><span>    writeGMT(hsa_kegg_genesets, gmt.file = <span>"kegg_hsa_kegg_genesets_gmt"</span>)</span></code><code><span>    save(hsa_kegg_genesets,file = <span>"~/heart_muscle/hsa_kegg_genesets.rds"</span>)</span></code></pre></section></li></ul></section></section><p><img data-galleryid="" data-imgfileid="100002545" data-ratio="0.49444444444444446" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkuZLUuwe8OHIBDiamN2cRjZhG2M1XfcicZRxaGiaBiaenztFne5gibsQAicKdMuhyJCdJBhsdaic9YldoAdg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkuZLUuwe8OHIBDiamN2cRjZhG2M1XfcicZRxaGiaBiaenztFne5gibsQAicKdMuhyJCdJBhsdaic9YldoAdg/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>我们可以看到这里的kegg数据集合有357个</span></strong><br></p><p><br></p><h3><span>做gsva分析<span></span></span></h3><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="perl"><code><span> library(GSVA);<span>print</span>(getwd())</span></code><code><span>  load(<span>"~/heart_muscle/hsa_kegg_genesets.rds"</span>)</span></code><code><span>  genesets_kegg=hsa_kegg_genesets</span></code><code><span>  <span>print</span>(<span>length</span>(hsa_kegg_genesets))</span></code><code><span>  <span>#kegg---</span></span></code><code><span>  gssea.res &lt;- gsva(expr, genesets_kegg [<span>1</span>:<span>50</span>], method=<span>"ssgsea"</span>,kcdf=<span>"Poisson"</span>,min.sz &gt; <span>3</span>,max.sz=<span>200</span> ,parallel.sz=<span>10</span> ) </span></code><code><span>  saveRDS(gssea.res, paste<span>0</span>(new_dir,file_name,<span>"_gssea.res_kegg.rds"</span>  )  )</span></code><code><span>  </span></code><code><span>  gssea.df &lt;- data.frame(Genesets=rownames(gssea.res),gssea.res, check.names = F)</span></code><code><span>  write.csv(gssea.df,  paste<span>0</span>(new_dir,file_name,<span>"gssea_res_kegg.csv"</span> ), row.names = F) </span></code><code><span>  </span></code><code><span>   </span></code><code><span>  <span># ssgsea-----</span></span></code><code><span>  <span>#library(GSVA);print(getwd())</span></span></code><code><span>  <span>#gssea.res &lt;- gsva(expr, genesets_GO [1:50], method="ssgsea",kcdf="Poisson",min.sz &gt; 3,max.sz=200 ,parallel.sz=10 )  #,parallel.sz=10</span></span></code><code><span>  <span>#saveRDS(gssea.res, paste0(new_dir,file_name,"_gssea.res_go.rds"  )  )</span></span></code><code><span>  </span></code><code><span>  <span>#gssea.df &lt;- data.frame(Genesets=rownames(gssea.res), gssea.res, check.names = F)</span></span></code><code><span>  <span>#write.csv(gssea.df,  paste0(new_dir,file_name,"gssea_res_go.csv"), row.names = F) </span></span></code><code><span>  <span>#print("done-------");print(getwd())</span></span></code><code><span><br></span></code></pre></section><p><strong><span>这里的expr是行为基因列为样本的 表达矩阵。</span></strong></p><section><ul><li><li><li></ul><pre data-lang="javascript"><code><span>参考：</span></code><code><span>https:<span>//biobeat.wordpress.com/category/r/</span></span></code><code><span>https:<span>//www.researchgate.net/post/How_i_can_get_a_list_of_KEGG_pathways_and_its_list_of_genes</span></span></code></pre></section><p><strong><br></strong></p><p><strong>分析完成之后，可以使用新得到的通路矩阵进行差异分析。下期见~</strong></p><p><span></span><strong></strong></p><p><img data-imgfileid="100002538" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" data-type="gif" data-w="240" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"><br></p><p><img data-imgfileid="100002537" data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="other" data-w="341" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p><p><span><br></span></p></section></section></section></section><p><br></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Q7fWcoIid3ypdvdtOSj2NA",target="_blank" rel="noopener noreferrer">原文链接</a>
