---
title: "jupyter调用多个R，python kernel"
date: 2024-03-06T00:26:19Z
draft: ["false"]
tags: [
  "fetched",
  "seqyuan"
]
categories: ["Acdemic"]
---
jupyter调用多个R，python kernel by seqyuan
------
<div><p>jupyter notebook是非常流行的调试代码方式，对于R和python这种脚本语言能时时反馈每一行代码的运行结果，对于调试画图代码很便捷，而且能够<strong>有效记录数据分析过程</strong>。jupyter支持R kernel (已经放弃Rstudio许久)，有时候我们有多个R和python安装路径（例如多个conda环境下的R），本文记录的是jupyter调用多个kernel的设置步骤。</p><h2>启动jupyter服务</h2><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span><span># 建立jupyter配置文件目录</span></span></code><code><span>mdkir -p ~/.jupyter</span></code><code><span><span># 设置密码</span></span></code><code><span>jupyter lab password</span></code><code><span><span># 建立文件目录和设置密码的步骤只需要做一次</span></span></code><code><span><span># 启动jupyter</span></span></code><code><span><span># --notebook-dir参数可以自定义jupyter的启动路径，对于打开和保存文件便利</span></span></code><code><span>jupyter lab --port=<span>1031</span> --notebook-dir=<span>/seqyuan/</span>project/</span></code></pre></section><p>不想用时可以<code>control + c</code> 停掉服务，或直接关掉terminal界面；</p><p>如果jupyter服务建立在服务器上，想长期使用，下面可以确保在关掉terminal的时候服务仍然运行 <code>nohup jupyter lab --port=1008 --notebook-dir=/seqyuan/project/ &amp;</code></p><h2>添加python kernel</h2><p>启动jupyter服务的时候，默认会把jupyter所在环境的python加到<strong>jupyter kernel list</strong>里，不需要重复添加，如果想要把其他python加入到jupyter kernel，对应的python先安装ipykernel这个包</p><section><ul><li><li><li><li><li></ul><pre data-lang="bash"><code><span>/customPYpath/envs/seurat4/bin/pip install ipykernel</span></code><code><span><span># 下面就是添加 kernel代码</span></span></code><code><span><span># --display-name 参数可以自定义设置要展示的kernel名称</span></span></code><code><span>/customPYpath/envs/seurat4/bin/python -m ipykernel install \</span></code><code><span>  --user --name seurat4_py --display-name <span>"seurat4py"</span></span></code></pre></section><h2>添加R kernel</h2><p>如果想要把R加入到jupyter kernel list，对应的R要先安装IRkernel这个包</p><section><ul><li><li></ul><pre data-lang="r"><code><span>install.packages(<span>'IRkernel'</span>)</span></code><code><span><span># devtools::install_github('IRkernel/IRkernel')</span></span></code></pre></section><section><ul><li><li></ul><pre data-lang="bash"><code><span><span># 在启动jupyter的user 同环境下打开R命令行</span></span></code><code><span><span>/customPYpath/</span>envs/deeptools/bin/R</span></code></pre></section><section><ul><li><li></ul><pre data-lang="php"><code><span><span># 可以给kernel命名和展示名称可以不一致IRkernel::installspec(name='R4deeptools', displayname='deeptools_R')</span></span></code><code><span><br></span></code></pre></section><blockquote><p>有一点要特别注意：添加kernel时python和R的添加kernel命令一定要和启动jupyter的环境和user一致，不然会导致添加不上。</p></blockquote><p>使用上面的方法，任何R和python路径都可以被添加到jupyter的kernel list，只要有IRkernel（或ipykernel）包就行，另外就是注意命名要区别开。</p><h2>使用jupyter服务</h2><h3><strong>本地电脑建立的jupyter服务</strong></h3><p>可以在浏览器输入<code>localhost:1031</code>即可使用jupyter服务，</p><p>添加新的软件kernel不需要关闭jupyter服务，在新kernel添加之后，点击<code>红圈的+</code>号即可看到新增的R在kernel列表里了。</p><p><img data-galleryid="" data-imgfileid="100000743" data-ratio="0.9332321699544764" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/SiacuSjV1nDxGRr8TcmSaPialjKzDEjldNiaibmiaR8488friaYbiaDY1SpMsic7S8uY1afPzqRicK3mvTicrcgwfdGPJvicw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="659" src="https://mmbiz.qpic.cn/mmbiz_png/SiacuSjV1nDxGRr8TcmSaPialjKzDEjldNiaibmiaR8488friaYbiaDY1SpMsic7S8uY1afPzqRicK3mvTicrcgwfdGPJvicw/640?wx_fmt=png&amp;from=appmsg"></p><h3><strong>在linux服务器建立的jupyter服务访问方法</strong></h3><p>在浏览器输入的应该是服务器的IP地址+端口， <code>IP:1031</code></p><p>如果需要跳转才能访问服务器，使用jupyter服务的方法可以参见本号之前的文章：</p><p><a href="https://mp.weixin.qq.com/s?__biz=MzU1MDMyNzUyNQ==&amp;mid=2247484341&amp;idx=1&amp;sn=cf92984929d32bafe6cc5b49342dbab3&amp;scene=21#wechat_redirect" title="实用ssh命令|端口转发访问远程集群jupyter服务" data-linktype="2">实用ssh命令|端口转发访问远程集群jupyter服务</a></p><h2>使用注意事项</h2><p>有时候服务器会打开很多notenooks，这些notebooks有时会load比较大的数据，积累多了容易使服务器卡顿，需要及时关闭不需要使用的kernel，可以通过下图中红圈所示的按钮查看在后台运行的notebook，选择性及时关闭。</p><p><img data-galleryid="" data-imgfileid="100000744" data-ratio="1.210344827586207" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/SiacuSjV1nDxGRr8TcmSaPialjKzDEjldN7tTSReiazgG51vKFrQlQn2IKQtxIa6iaqgibCTE2lU1ibkRS4tXWWd1WyA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="290" src="https://mmbiz.qpic.cn/mmbiz_png/SiacuSjV1nDxGRr8TcmSaPialjKzDEjldN7tTSReiazgG51vKFrQlQn2IKQtxIa6iaqgibCTE2lU1ibkRS4tXWWd1WyA/640?wx_fmt=png&amp;from=appmsg"></p><h3>关联阅读</h3><p><span><span>•</span><a href="https://mp.weixin.qq.com/s?__biz=MzU1MDMyNzUyNQ==&amp;mid=2247484389&amp;idx=1&amp;sn=46adb99f0c5290cde13a98e6f1f9d6a7&amp;scene=21#wechat_redirect" title="生信分析软件环境搭建-conda-R-python" data-linktype="2">生信分析软件环境搭建-conda-R-python</a></span><span><span>•</span><a href="https://mp.weixin.qq.com/s?__biz=MzU1MDMyNzUyNQ==&amp;mid=2247484341&amp;idx=1&amp;sn=cf92984929d32bafe6cc5b49342dbab3&amp;scene=21#wechat_redirect" title="实用ssh命令|端口转发访问远程集群jupyter服务" data-linktype="2">实用ssh命令|端口转发访问远程集群jupyter服务</a></span><span><span>•</span><span>https://blog.jcharistech.com/2018/01/01/how-to-add-r-kernel-and-javascriptsnode-js-to-jupyter-notebook/</span></span></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/O_YGNsIWylVKuQTuL18x0Q",target="_blank" rel="noopener noreferrer">原文链接</a>
