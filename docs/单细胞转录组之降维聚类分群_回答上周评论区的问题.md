---
title: "单细胞转录组之降维聚类分群-回答上周评论区的问题"
date: 2022-12-15T04:54:40Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
单细胞转录组之降维聚类分群-回答上周评论区的问题 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>上周推文评论区中有人提到 ”小编复现的降维聚类图形状和原文长的不一样，没有关系么？您定义的celltype和作者定义的celltype重叠度怎么样呢？“ 这周推文来简要说一下我的看法。</p></blockquote><p data-tool="mdnice编辑器">小编复现的图：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.8694968553459119" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic4Ov1ktjg8xrG7hGCS7qiaA9GgicBv71XdNpbIq8kIbKOl8Jrg9iahV6KWBk2Dib4OpKriaIdJTqYhcow/640?wx_fmt=png" data-type="png" data-w="636" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic4Ov1ktjg8xrG7hGCS7qiaA9GgicBv71XdNpbIq8kIbKOl8Jrg9iahV6KWBk2Dib4OpKriaIdJTqYhcow/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">文章中的图：<img data-ratio="0.8004201680672269" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic4Ov1ktjg8xrG7hGCS7qiaAWjKANnojuZOVxLgicicDXia3SibiabTRYTNFk8Sj9Q2TMWR0JJ59UNnOthg/640?wx_fmt=png" data-type="png" data-w="476" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic4Ov1ktjg8xrG7hGCS7qiaAWjKANnojuZOVxLgicicDXia3SibiabTRYTNFk8Sj9Q2TMWR0JJ59UNnOthg/640?wx_fmt=png"></p><h4 data-tool="mdnice编辑器"><span></span>首先对于复现文献中的 umap 图或者 tsne 图和原文长的不一样应该是很正常的。<span></span></h4><p data-tool="mdnice编辑器">在我刚开始做单细胞转录组测序的相关分析时，我也有这个疑惑，为什么复现文章中的降维分群与原文形状不一致呢？</p><p data-tool="mdnice编辑器">基于我针对多篇文章多个数据集的复现发现，有种种原因都会造成这个现象:</p><ul data-tool="mdnice编辑器"><li><section>换台电脑，一样的代码就会使得降维聚类的位置形状都会发生改变。</section></li><li><section>同一数据的UMAP 和 tSNE 图的位置形状肯定也不一样。</section></li><li><section>复现文献只能尽量的按照文献中提到的参数来修改我们的标准代码，然后按照标准代码把流程跑一下。尽量做到和文章一致。</section></li><li><section>文章中用于细胞命名的marker gene与我们所用的也并不一致。我们一般倾向于将细胞命名为常见的几群细胞：髓系，T, B, Fibo, Endo, Epi。当然如果文章中出现一些特定疾病的相关细胞也会找相关marker gene而进行命名。</section></li><li><section>在整合数据时选用harmony还是CCA。文献中使用的CCA, 而我使用的是harmony。之前有推文比较过CCA和harmony的区别。<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247506110&amp;idx=1&amp;sn=f2f274f2680395756b47db043a90ae16&amp;scene=21#wechat_redirect" data-linktype="2">CCA 和 Harmony在整合pbmc3k和pbmc5k的效果比较</a></section></li></ul><h4 data-tool="mdnice编辑器"><span></span>再深层次追究可能就是基于降维聚类分群的问题了，之前曾老师写过相关的推文。<span></span></h4><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486260&amp;idx=1&amp;sn=c6abf658de73594d1d77d8e1ffa7d153&amp;scene=21#wechat_redirect" data-linktype="2">单细胞转录组数据处理之降维聚类分群</a></p><ul data-tool="mdnice编辑器"><li><section><p>降维</p><p>首先来说做单细胞转录组测序流程中所用的 <strong>FindVariableFeatures</strong> 和 <strong>RunPCA</strong> 函数就是两种不同策略的降维。</p></section></li><ul><li><section>FindVariableFeatures：<code>sce &lt;- FindVariableFeatures(sce, selection.method = "vst", nfeatures = 2000)</code>   一般是根据一些统计指标，比如 sd,mad,vst 等来判断输入的单细胞表达矩阵里面的 2 万多个基因里面，选出最重要的 2000 个基因，其余的 1.8 万个基因下游分析就不考虑了。</section></li><li><section>RunPCA 函数：<code>sce &lt;- RunPCA(sce, features = VariableFeatures(object = sce))</code>  在跑完之后2000 个基因会转变为 2000 个维度，但是我们通常看前 15/20 个维度就可以了，所以这个也是一个效率非常高的降维方式。</section></li></ul><li><section><p>聚类</p><p>聚类分群往往是根据细胞各个基因表达模式的相似度或者距离来进行聚类的，相似度高或者距离近的就归为一个cluster。而对于单细胞转录组测序的细胞聚类算法有很多种，像KNN、SNN、Louvain算法等等。</p><p>曾老师也提到，需要注意的是二维平面空间，三维球体空间的细胞距离很方便计算，但是如果是50个维度的空间，计算几万个细胞之间的距离就很可怕了，如果是2000个维度，甚至是2万个维度，基本上个人计算机就可以放弃了。这就是<strong>为什么我们前面通常是需要降维的。</strong></p></section></li></ul><h4 data-tool="mdnice编辑器"><span></span>而后就是关于tSNE和UMAP的一些相关知识。<span></span></h4><p data-tool="mdnice编辑器">tSNE: 参考这篇推文的介绍<a href="https://mp.weixin.qq.com/s?__biz=MzU4NjgwOTU4Nw==&amp;mid=2247483989&amp;idx=1&amp;sn=00d184e29d3108a5d7d19759ac1129bb&amp;scene=21#wechat_redirect" data-linktype="2">单细胞中的流形（一）：理解 tSNE中的perplexity</a></p><p data-tool="mdnice编辑器">tSNE (t-distributed stochastic neighbor embedding) 是一种非线性降维的算法，是流形学习的一种。参考上述推文曾老师提到以下几点。</p><ul data-tool="mdnice编辑器"><li><section>困惑度（perplexity）可以表示细胞的邻近个数，在tSNE图上的直观反映是细胞点的分布是否紧凑。perplexity设置越大，细胞分布越紧凑。</section></li><li><section>tSNE的参数设置：perplexity &lt; (细胞数-1)/3，建议perplexity = 细胞数 / 50；</section></li><li><section>tSNE倾向于保留数据的局部结构。</section></li></ul><p data-tool="mdnice编辑器">UMAP:参考这篇推文的介绍 <a href="https://mp.weixin.qq.com/s?__biz=MzU4NjgwOTU4Nw==&amp;mid=2247484008&amp;idx=1&amp;sn=cafd6aa1fb1501a99840013d40014730&amp;scene=21#wechat_redirect" data-linktype="2">单细胞中的流形（二）：UMAP与tSNE的区别</a></p><p data-tool="mdnice编辑器">UMAP (Uniform manifold approximation and projection)  是一种非线性降维的算法，相对于t-SNE，UMAP算法更加快速，该方法的原理是利用流形学和投影技术，达到降维目的。</p><ul data-tool="mdnice编辑器"><li><section>维度不像PCA的主成分或者非负矩阵分解的因子可解释。只能用于可视化。</section></li><li><section>样本较小时（n &lt; 500），可能效果不好，需要慎重选择参数。</section></li><li><section>局部的聚类效果有时没有tSNE的效果好，相似的细胞分群靠得太近，区分度不高，如果数据质量较差，会影响可视化效果。</section></li><li><section>比tSNE更能反映全局结构，但不代表UMAP是最好的全局结构展示方法。</section></li></ul><h4 data-tool="mdnice编辑器"><span></span>总结<span></span></h4><p data-tool="mdnice编辑器">要想复现的降维聚类图形状和原文一致，影响因素有很多。因此的确可以通过自己定义的celltype和作者定义的celltype重叠度来看，复现出的结果与原文的重合度。但又恰恰很多文章并没有提供相关的数据，因此只能通过尽量保持参数一致来复现。</p><blockquote data-tool="mdnice编辑器"><p>因此关于我定义的celltype和作者定义的celltype重叠度怎么样这个问题，经过我查找文献中提交到GEO和补充材料的数据，并没有发现作者提交的有关celltype信息的数据，所以可能对比不了。</p><p>如有小伙伴找到相关信息的可以留言告知，谢谢。</p></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/q-hnkPx4lNMuyUek9a3aXA",target="_blank" rel="noopener noreferrer">原文链接</a>
