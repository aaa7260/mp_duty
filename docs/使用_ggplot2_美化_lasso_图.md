---
title: "使用 ggplot2 美化 lasso 图"
date: 2023-02-10T09:45:47Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
使用 ggplot2 美化 lasso 图 by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><section><mp-common-profile data-pluginname="mpprofile" data-weui-theme="light" data-id="MzkyMTI1MTYxNA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usey42oX5qyLTVibLRO9dz8ic5G4TpEHQc9rICYlpS4MHg6Et8cgXrQDqibvibXombicTro8t9cekJRlDBcw/0?wx_fmt=png" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><section data-support="96编辑器" data-style-id="39798"><section data-width="100%"><img data-ratio="0.2" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWiaD31enw8xDOLVj1ZaVlkg4YESlMenlPAP4wGfmARZ1bkVYSLxYcEISlPGpZSWpoelbofkb9EZSuw/640?wx_fmt=gif" data-w="600" data-width="100%" src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWiaD31enw8xDOLVj1ZaVlkg4YESlMenlPAP4wGfmARZ1bkVYSLxYcEISlPGpZSWpoelbofkb9EZSuw/640?wx_fmt=gif"></section></section><p><br></p><h2 data-tool="mdnice编辑器"><span><span>1</span></span><span>引言</span></h2><blockquote data-tool="mdnice编辑器"><p>此篇内容来自粉丝 <strong>中国医科大学路易李四</strong> 的投稿和分享。感谢分享!</p></blockquote><h2 data-tool="mdnice编辑器"><span><span>2</span></span><span>投稿内容</span></h2><p data-tool="mdnice编辑器">使用 lasso 的同学们都知道，一般用了 lasso 就需要放两张图上去，虽然这两张图没啥多大信息，但是，它们是 lasso 的标志，就是那种 <strong>“一看到这两张图，就知道用了 lasso”</strong>。相当于身份证一般。但是，使用 <code>plot()</code>画出来的图，比较丑。</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(ggsci)<br><span>library</span>(reshape2)<br><span>library</span>(glmnet)<br><br>load(<span>'lasso_replot.Rdata'</span>)<br><br><span>#首先，画一下未经美化的图，前两张图是文章里最常见的，后两张仅做陪衬</span><br>pdf(<span>'未美化.pdf'</span>,width = <span>8</span>,height = <span>6</span>)<br>plot(cvfit)<br>plot(fit,xvar = <span>'lambda'</span>,label = <span>F</span>)<br><span>#这是两张最常用的图</span><br>plot(fit)<br>plot(fit,xvar = <span>'dev'</span>)<br>dev.off()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.518987341772152" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usewdhHIPKazxricz0HjJYRoIPvHB6kJQGtmlC9puj2VHVia6SWH17yJJkl0cPyqTfVjsNTUveJAtggBA/640?wx_fmt=png" data-type="png" data-w="474" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usewdhHIPKazxricz0HjJYRoIPvHB6kJQGtmlC9puj2VHVia6SWH17yJJkl0cPyqTfVjsNTUveJAtggBA/640?wx_fmt=png"></figure><figure data-tool="mdnice编辑器"><img data-ratio="1.543103448275862" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usewdhHIPKazxricz0HjJYRoIPbmOmMzrkDXGUyFiaKShO8l2J4rBYfaJkkwbL3tLA2icBW71LmOzd7UWg/640?wx_fmt=png" data-type="png" data-w="464" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usewdhHIPKazxricz0HjJYRoIPbmOmMzrkDXGUyFiaKShO8l2J4rBYfaJkkwbL3tLA2icBW71LmOzd7UWg/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">在这里添加 <strong>未美化.pdf</strong> 里的四张图,主要是前两张用的多。后两张也画上了，后面也一样会进行美化。</p><p data-tool="mdnice编辑器">在此，使用 <strong>ggplot2</strong> 美化一下。绘图思路是：<code>提取出源数据，整理成需要用的格式。（不理解 lasso 的同学可以自行研究，不再详细说明。）</code></p><h3 data-tool="mdnice编辑器"><span></span><span>第一张，交叉验证的图</span><span></span></h3><p data-tool="mdnice编辑器">在这里添加 <strong>plot.pdf</strong> 里的第一张图,其实这个图就是<code>点图+误差棒图</code>，然后根据变量数上色。翻看元数据。找到点的大小的值，以及误差棒上下对应的值。然后就是双 X 轴，但是上面那个 X 轴的刻度得要是变量数。开始绘图：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#重绘的关键在于寻找画图的源数据</span><br><span>#先画这个简单的</span><br>aaa &lt;- data.frame(lamda = cvfit[[<span>"lambda"</span>]]%&gt;%log()%&gt;%round(.,<span>3</span>),<br>                  cvm = cvfit[[<span>"cvm"</span>]],<br>                  cvup = cvfit[[<span>"cvup"</span>]],<br>                  cvlo = cvfit[[<span>"cvlo"</span>]],<br>                  nzero = as.numeric(cvfit[[<span>"nzero"</span>]]))<br>aaa$nzero2 &lt;- aaa$nzero<br>aaa$nzero2 &lt;- factor(aaa$nzero2)<br><br><span>#画上面那个坐标轴</span><br>xbreaks &lt;- aaa$lamda[seq(<span>1</span>,<span>100</span>,<span>10</span>)]<br>xlabels &lt;- as.character(aaa$nzero[seq(<span>1</span>,<span>100</span>,<span>10</span>)])<br><span>#实际大小相同，但是改变label</span><br><br><span>#先画交叉验证的那个，p1</span><br>p1 &lt;- ggplot(data = aaa)+<br>  geom_errorbar(aes(x=lamda,ymin = cvlo,ymax = cvup,color = nzero2),<br>                linewidth = <span>.5</span>,width = <span>0.1</span>,alpha = <span>0.5</span>)+<br>  geom_point(aes(x=lamda,y = cvm,color = nzero2))+<br>  scale_color_d3(c(<span>'category20'</span>))+<br>  scale_x_continuous(sec.axis = sec_axis(~.,breaks = xbreaks,labels = xlabels))+<span>#上面那个X轴</span><br>  labs(x = <span>'Log Lambda'</span>, y = <span>'Binomial Deviance'</span>,color = <span>'vars'</span>)+ <span>#color修改的事图例的标题</span><br>  geom_vline(xintercept = log(c(cvfit$lambda.min,cvfit$lambda.1se)),lty = <span>2</span>,col = <span>'grey50'</span>)+<br>  theme_classic()+<br>  theme(axis.title = element_text(size = <span>15</span>),<br>        axis.text = element_text(size = <span>12</span>),<br>        axis.line = element_line(linewidth = <span>.5</span>),<br>        legend.position = c(<span>0.85</span>,<span>0.6</span>),<br>        legend.background = element_blank())+<br>  guides(colour = guide_legend(ncol = <span>2</span>, byrow = <span>F</span>))<span>#图例拆分为2列</span><br>p1<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7348643006263048" data-src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usewdhHIPKazxricz0HjJYRoIPI4NyJGapOyJCZqC5zpfRsjSq4GHC6bmKE8DfyUmOAFc8NbhKbhTuIQ/640?wx_fmt=png" data-type="png" data-w="958" src="https://mmbiz.qpic.cn/mmbiz_png/G5jjcE4usewdhHIPKazxricz0HjJYRoIPI4NyJGapOyJCZqC5zpfRsjSq4GHC6bmKE8DfyUmOAFc8NbhKbhTuIQ/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>于是，第一张交叉验证的图久画好了,下面开整剩下的 3 张：</span><span></span></h3><p><mp-pay-preview-filter></mp-pay-preview-filter></p></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/KAZpk5XxT3IWiUYwkARsCA",target="_blank" rel="noopener noreferrer">原文链接</a>
