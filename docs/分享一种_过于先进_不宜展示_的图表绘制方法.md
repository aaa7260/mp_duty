---
title: "分享一种“过于先进，不宜展示”的图表绘制方法"
date: 2022-10-17T17:07:55Z
draft: ["false"]
tags: [
  "fetched",
  "SCIPainter"
]
categories: ["Acdemic"]
---
分享一种“过于先进，不宜展示”的图表绘制方法 by SCIPainter
------
<div><p data-mpa-powered-by="yiban.io"><span>一般而言，对于传统的火山图，一张图一次只能展示一个比较组的差异基因。那么，如何一次性展示多个比较组的差异基因呢？一篇空间转录组的Cell文章给出了一种解决方案，如下图（H），可一次性展示多个比较组（细胞亚群）的差异基因。</span></p><p><span><br></span></p><p><img data-ratio="0.5908119658119658" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdztX4vajJMSrn1ibcnapIL7S1fHNmgJaLrMXHy5PUqSW5CtMRdjkxjJzg/640?wx_fmt=png" data-type="png" data-w="936" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdztX4vajJMSrn1ibcnapIL7S1fHNmgJaLrMXHy5PUqSW5CtMRdjkxjJzg/640?wx_fmt=png"></p><p><span>（<em>Cell</em>, 2019）</span></p><p><br></p><p><span>之前，在</span><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA5NzQzOTgzMw==&amp;mid=2650923608&amp;idx=1&amp;sn=a4dbde841f0b8cdffe19af088f6cdaa3&amp;chksm=8b559b6ebc221278b36923c2243509b311705e849394a36cbf93c5f36e1ac3d3ea855b69bbef&amp;scene=21#wechat_redirect" textvalue="《三步复刻40分顶刊的多组差异分析火山图！》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">《三步复刻40分顶刊的多组差异分析火山图！》</a></span><span>一文中已经为大家介绍过如何绘制这种多组散点图。那么，对于常规的转录组、蛋白组等差异分析数据能不能以这种方式展示呢？以下是我自己尝试使用传统转录组的差异分析数据进行绘图得到的效果。</span></p><p><span><br></span></p><p><img data-ratio="0.7159590043923866" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzkpWv5BGib51dCgetxHCv6e4DNTqwUtDTZO6ia4uHvdCYLNEp94ZB7GZw/640?wx_fmt=png" data-type="png" data-w="683" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzkpWv5BGib51dCgetxHCv6e4DNTqwUtDTZO6ia4uHvdCYLNEp94ZB7GZw/640?wx_fmt=png"></p><p><br></p><p><span>闲言少叙，下面就一起看看具体如何绘制吧！</span></p><p><span><br></span></p><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><p><br></p></section></section></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><p><strong>1. 数据的整理</strong></p></section></section></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p><br></p></section></section></section></section></section></section></section></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#读入测试数据；</span><br mpa-from-tpl="t"><span>dt</span> &lt;- read.csv(<span>"multy.csv"</span>,header = T)<br mpa-from-tpl="t"><span>#row.names(dt) &lt;- dt$id</span><br mpa-from-tpl="t"><span>#预览数据；</span><br mpa-from-tpl="t"><span>head</span>(dt)</p></pre></section><p><span></span></p><p><img data-ratio="0.5749486652977412" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzbxHXCLUTBSPozuvJZrYoZJRFS9xKyrBtWiambtKHz4nXxElraApOeMw/640?wx_fmt=png" data-type="png" data-w="974" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzbxHXCLUTBSPozuvJZrYoZJRFS9xKyrBtWiambtKHz4nXxElraApOeMw/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#拆分数据（将差异倍数和Pvalue数据分开）；</span><br mpa-from-tpl="t"><span>#指定比较组数；</span><br mpa-from-tpl="t"><span>n</span> &lt;- 6<br mpa-from-tpl="t"><span>#指定数据所在的列数；</span><br mpa-from-tpl="t"><span>i_fc</span> &lt;- seq(2, by=2, length.out= n )<br mpa-from-tpl="t"><span>i_p</span> &lt;- seq(3, by=2, length.out= n )<br mpa-from-tpl="t"><span>#提取差异倍数数据；</span><br mpa-from-tpl="t"><span>dt_log2FC</span> &lt;- dt[c(1,i_fc)]<br mpa-from-tpl="t"><span>str</span> &lt;- colnames(dt)[c(1,i_fc)]<br mpa-from-tpl="t"><span>#生成新列名；</span><br mpa-from-tpl="t"><span>colname</span> &lt;- unlist(strsplit(str,<span>"_log2FC"</span>))<br mpa-from-tpl="t"><span>colnames</span>(dt_log2FC ) &lt;- colname<br mpa-from-tpl="t"><span>#预览数据；</span><br mpa-from-tpl="t"><span>head</span>(dt_log2FC)<br mpa-from-tpl="t"><span>#提取Pvalue数据；</span><br mpa-from-tpl="t"><span>dt_PValue</span> &lt;- dt[c(1,i_p)]<br mpa-from-tpl="t"><span>colnames</span>(dt_PValue ) &lt;- colname<br mpa-from-tpl="t"><span>#预览数据；</span><br mpa-from-tpl="t"><span>head</span>(dt_PValue)</p></pre></section><p><span></span></p><p><img data-ratio="0.46621621621621623" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzmTWc4uLsxScBWvSaCOhKhRsncuPv5AGdicXaiaWibSIov1FdZBSPjrsUw/640?wx_fmt=png" data-type="png" data-w="1036" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzmTWc4uLsxScBWvSaCOhKhRsncuPv5AGdicXaiaWibSIov1FdZBSPjrsUw/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#载入reshape2；</span><br mpa-from-tpl="t"><span>library</span>(reshape2)<br mpa-from-tpl="t"><span>#将宽型数据转成长型数据；</span><br mpa-from-tpl="t"><span>df1</span> &lt;- melt(dt_log2FC,id.vars=<span>"gene_id"</span>,<br mpa-from-tpl="t"><span>measure</span>.vars = colnames(dt_log2FC)[2:7],<br mpa-from-tpl="t"><span>variable</span>.name = <span>"Groups"</span>,<br mpa-from-tpl="t"><span>value</span>.name = <span>"log2FC"</span>)<br mpa-from-tpl="t"><span>df2</span> &lt;- melt(dt_PValue,id.vars=<span>"gene_id"</span>,<br mpa-from-tpl="t"><span>measure</span>.vars = colnames(dt_PValue)[2:7],<br mpa-from-tpl="t"><span>variable</span>.name = <span>"Groups"</span>,<br mpa-from-tpl="t"><span>value</span>.name = <span>"PValue"</span>)<br mpa-from-tpl="t"><span>#id.vars表示不需要合并的列；</span><br mpa-from-tpl="t"><span>#measure.vars表示需要合并的列；</span><br mpa-from-tpl="t"><span>#variable.name表示列名合并后的新列名；</span><br mpa-from-tpl="t"><span>#value.name表示数值合并后的新列名。</span><br mpa-from-tpl="t"><span>#合并两个表格；</span><br mpa-from-tpl="t"><span>df3</span> &lt;- data.frame(df1,df2[3])<br mpa-from-tpl="t"><span>#查看转换后的数据；</span><br mpa-from-tpl="t"><span>head</span>(df3)</p></pre></section><p><span></span></p><p><img data-ratio="0.274859287054409" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzhH9MYJ7um4ibaibObcicUHiaXeoIFjZfDiaSlnBnQWfEaQyjkliaXBWsUQRQ/640?wx_fmt=png" data-type="png" data-w="1066" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzhH9MYJ7um4ibaibObcicUHiaXeoIFjZfDiaSlnBnQWfEaQyjkliaXBWsUQRQ/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#载入dplyr包；</span><br mpa-from-tpl="t"><span>library</span>(dplyr)<br mpa-from-tpl="t"><span>#过滤差异基因；</span><br mpa-from-tpl="t"><span>tb</span> &lt;- as_tibble(df3)<br mpa-from-tpl="t"><span>head</span>(tb)<br mpa-from-tpl="t"><span>df4</span> &lt;-filter(tb,abs(log2FC)&gt;=1,PValue&lt;0.05)<br mpa-from-tpl="t"><span>dim</span>(df4)</p></pre></section><p><span></span></p><p><img data-ratio="0.45170193192272307" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzNyuldzLR6kcFTWBYaVIvcFn3T7cwziaGKHoXUJlaDLrHzkuPsDAfZrA/640?wx_fmt=png" data-type="png" data-w="1087" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzNyuldzLR6kcFTWBYaVIvcFn3T7cwziaGKHoXUJlaDLrHzkuPsDAfZrA/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#添加上下调标签；</span><br mpa-from-tpl="t"><span>df4</span>$Label &lt;- case_when(df4$log2FC &gt; 0 ~ <span>"Up"</span>,<br mpa-from-tpl="t"><span>df4</span>$log2FC &lt; 0 ~ <span>"Down"</span>)<br mpa-from-tpl="t"><span>#筛选每个分组中差异倍数TOP2的基因（上下调各1个）；</span><br mpa-from-tpl="t"><span>df5</span> &lt;- df4 %&gt;% group_by(Groups,Label) %&gt;% top_n(1,abs(log2FC))<br mpa-from-tpl="t"><span>#筛选每个分组中差异倍数TOP10的基因（上下调共10个）；</span><br mpa-from-tpl="t"><span>#df5 &lt;- df4 %&gt;% group_by(Groups) %&gt;% top_n(10,abs(log2FC))</span><br mpa-from-tpl="t"><span>print</span>(df5)</p></pre></section><p><span></span></p><p><img data-ratio="0.4785172704296546" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzlr8nYrTqWfK12o2xnCH4SlAUrtlJwvyT9R9j9lGanwtiahlpmiazVXvg/640?wx_fmt=png" data-type="png" data-w="1187" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzlr8nYrTqWfK12o2xnCH4SlAUrtlJwvyT9R9j9lGanwtiahlpmiazVXvg/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#根据所需目的基因，进一步对数据分组；</span><br mpa-from-tpl="t"><span>groups</span> &lt;- unique(df4$Groups)<br mpa-from-tpl="t"><span>df_sub</span> &lt;- data.frame()<br mpa-from-tpl="t"><span>for</span> (i in groups){<br mpa-from-tpl="t"><span>df4_sub</span>&lt;- filter(df4,Groups == i)<br mpa-from-tpl="t"><span>df5_sub</span>&lt;- filter(df5,Groups == i)<br mpa-from-tpl="t"><span>df4_sub</span>$Top &lt;-case_when(df4_sub$gene_id %in% df5_sub$gene_id ~ <span>"Yes"</span>,<br mpa-from-tpl="t">!(<span>df4_sub</span>$gene_id %in% df5_sub$gene_id ) ~ <span>"No"</span>)<br mpa-from-tpl="t"><span>df_sub</span> &lt;-rbind(df_sub,df4_sub) <br mpa-from-tpl="t">}<br mpa-from-tpl="t"><span>#提取非Top2的基因表格；</span><br mpa-from-tpl="t"><span>df6</span> &lt;- filter(df_sub,df_sub$Top==<span>"No"</span>)<br mpa-from-tpl="t"><span>#提取Top2的基因表格；</span><br mpa-from-tpl="t"><span>df7_up</span> &lt;- filter(df_sub,df_sub$Top==<span>"Yes"</span>&amp; df_sub$Label==<span>"Up"</span>)<br mpa-from-tpl="t"><span>df7_down</span> &lt;- filter(df_sub,df_sub$Top==<span>"Yes"</span> &amp; df_sub$Label==<span>"Down"</span>)<br mpa-from-tpl="t"><span>#提取symbol号；</span><br mpa-from-tpl="t"><span>#symbol &lt;- dt[df7_up$id,14]</span><br mpa-from-tpl="t"><span>#symbol &lt;- dt[df7_down$id,14]</span><br mpa-from-tpl="t"><span>#导出作图数据；</span><br mpa-from-tpl="t"><span>write</span>.csv(df_sub,<span>"figdata.csv"</span>)<br mpa-from-tpl="t"><span>#预览作图数据；</span><br mpa-from-tpl="t"><span>head</span>(df_sub)</p></pre></section><p><span></span></p><p><img data-ratio="0.3060796645702306" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzXrnjiccrNxXViccQjhLzOiaSajbczlRibDk5LcIDsm30ciaPfkfy4l2ib32A/640?wx_fmt=png" data-type="png" data-w="1431" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzXrnjiccrNxXViccQjhLzOiaSajbczlRibDk5LcIDsm30ciaPfkfy4l2ib32A/640?wx_fmt=png"></p><p><br></p><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><p><br></p></section></section></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><p><strong>2. 绘制多组差异散点图</strong></p></section></section></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p><br></p></section></section></section></section></section></section></section></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#数据准备；</span><br mpa-from-tpl="t"><span>dt7_up</span> &lt;- as_tibble(df7_up)<br mpa-from-tpl="t"><span>up</span> &lt;- dt7_up %&gt;% group_by(Groups) %&gt;% summarise(max(log2FC))<br mpa-from-tpl="t"><span>dt7_down</span> &lt;- as_tibble(df7_down)<br mpa-from-tpl="t"><span>down</span> &lt;- dt7_down %&gt;% group_by(Groups) %&gt;% summarise(min(log2FC))<br mpa-from-tpl="t"><span>#生成数据框；</span><br mpa-from-tpl="t"><span>df_col</span> &lt;- data.frame(up,down[2])<br mpa-from-tpl="t"><span>max</span> &lt;- max(max(df_col$max.log2FC.),max(abs(df_col$min.log2FC.)))<br mpa-from-tpl="t"><span>expan</span> &lt;- max/20<br mpa-from-tpl="t"><span>#绘制背景条；</span><br mpa-from-tpl="t"><span>library</span>(ggplot2)<br mpa-from-tpl="t"><span>p</span> &lt;- ggplot()+<br mpa-from-tpl="t"><span>geom_col</span>(data = df_col,<br mpa-from-tpl="t"><span>aes</span>(x = Groups, y = max.log2FC.+expan),width =0.8,<br mpa-from-tpl="t"><span>fill</span> = <span>"grey90"</span>,alpha=0.4,show.legend = F)+<br mpa-from-tpl="t"><span>geom_col</span>(data = df_col,aes(x = Groups, y = min.log2FC.-expan),width =0.8,<br mpa-from-tpl="t"><span>fill</span> = <span>"grey90"</span>,alpha=0.4,show.legend = F)<br mpa-from-tpl="t"><span>p</span>+theme_minimal()</p></pre></section><section><span><br></span></section><p><img data-ratio="0.7664576802507836" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzPqAViblIp0uA1Xia5w92WIYHQY9QVPcYKuRrbUNkibXZlTWGxY9AF47FQ/640?wx_fmt=png" data-type="png" data-w="638" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzPqAViblIp0uA1Xia5w92WIYHQY9QVPcYKuRrbUNkibXZlTWGxY9AF47FQ/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#使用不同组的差异基因绘图；</span><br mpa-from-tpl="t"><span>p1</span> &lt;- p+geom_jitter(data = df6,<br mpa-from-tpl="t"><span>aes</span>(x = Groups, y = log2FC, color = Label),<br mpa-from-tpl="t"><span>size</span> = 0.6,width =0.4,show.legend = F)<br mpa-from-tpl="t"><span>p1</span>+theme_minimal()</p></pre></section><p><span></span></p><p><img data-ratio="0.7680491551459293" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzlLo1nWBkNR5hFS7Xs3nLc2XXsibicgvKORKJ3556duhLj7MAmxicRgZMQ/640?wx_fmt=png" data-type="png" data-w="651" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzlLo1nWBkNR5hFS7Xs3nLc2XXsibicgvKORKJ3556duhLj7MAmxicRgZMQ/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#继续添加Top2基因对应的点；</span><br mpa-from-tpl="t"><span>p2</span> &lt;- p1+geom_jitter(data = df7_down,<br mpa-from-tpl="t"><span>aes</span>(x = Groups, y = log2FC, color = Label),<br mpa-from-tpl="t"><span>size</span> = 1.8,alpha=1,width =0.4,show.legend = T)+<br mpa-from-tpl="t"><span>geom_jitter</span>(data = df7_up,<br mpa-from-tpl="t"><span>aes</span>(x = Groups, y = log2FC, color = Label),<br mpa-from-tpl="t"><span>size</span> = 1.8,alpha=1,width =0.4,show.legend = T)<br mpa-from-tpl="t"><span>p2</span>+theme_minimal()</p></pre></section><p><br></p><p><img data-ratio="0.7688243064729194" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzQxeicgHG7NJm0RJDRomWllK6aIUeM58UbUslmFEibIfzpPnxqEdgXMgw/640?wx_fmt=png" data-type="png" data-w="757" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzQxeicgHG7NJm0RJDRomWllK6aIUeM58UbUslmFEibIfzpPnxqEdgXMgw/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#自定义半透明颜色（绿红）；</span><br mpa-from-tpl="t"><span>#mycol &lt;- c("#99CC00","#FF99CC")</span><br mpa-from-tpl="t"><span>#mycol &lt;- c("#99CC00","#FF9999")</span><br mpa-from-tpl="t"><span>#mycol &lt;- c("#00a99e","#6bc72b")</span><br mpa-from-tpl="t"><span>mycol</span> &lt;- c(<span>"#6bc72b"</span>,<span>"#ff5a20"</span>)<br mpa-from-tpl="t"><span>p3</span> &lt;- p2 + scale_colour_manual(name=<span>""</span>,values=alpha(mycol,0.9))<br mpa-from-tpl="t"><span>p3</span>+theme_minimal()</p></pre></section><p><span></span></p><p><img data-ratio="0.7696793002915452" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzy3txl2jJt59UbicTjQBDaJhe5qkczbLslaOfTfp7ovLTzIU7gT0iaAEA/640?wx_fmt=png" data-type="png" data-w="686" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzy3txl2jJt59UbicTjQBDaJhe5qkczbLslaOfTfp7ovLTzIU7gT0iaAEA/640?wx_fmt=png"></p><p><br></p><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><p><br></p></section></section></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><p><strong>3. 添加目的基因标签</strong></p></section></section></section></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><p><br></p></section></section></section></section></section></section></section></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#载入所需R包；</span><br mpa-from-tpl="t"><span>library</span>(ggrepel)<br mpa-from-tpl="t"><span>p4</span> &lt;- p3+geom_text_repel(data=df7_up,aes(x = Groups, y = log2FC,label=gene_id),<br mpa-from-tpl="t"><span>force</span>=1,<br mpa-from-tpl="t"><span>color</span>=<span>"grey20"</span>,<br mpa-from-tpl="t"><span>size</span>=2.5,<br mpa-from-tpl="t"><span>point</span>.padding = 0.1,<br mpa-from-tpl="t"><span>arrow</span> = arrow(length = unit(0.01, <span>"npc"</span>), type = <span>"open"</span>, ends = <span>"last"</span>),<br mpa-from-tpl="t"><span>segment</span>.color=<span>"grey20"</span>,<br mpa-from-tpl="t"><span>segment</span>.size=0.4,<br mpa-from-tpl="t"><span>segment</span>.alpha=0.8)+<br mpa-from-tpl="t"><span>geom_text_repel</span>(data=df7_down,aes(x = Groups, y = log2FC,label=gene_id),<br mpa-from-tpl="t"><span>force</span>=1,<br mpa-from-tpl="t"><span>color</span>=<span>"grey20"</span>,<br mpa-from-tpl="t"><span>size</span>=2.5,<br mpa-from-tpl="t"><span>point</span>.padding = 0.1,<br mpa-from-tpl="t"><span>arrow</span> = arrow(length = unit(0.01, <span>"npc"</span>), type = <span>"open"</span>, ends = <span>"last"</span>),<br mpa-from-tpl="t"><span>segment</span>.color=<span>"grey20"</span>,<br mpa-from-tpl="t"><span>segment</span>.size=0.4,<br mpa-from-tpl="t"><span>segment</span>.alpha=0.8)<br mpa-from-tpl="t"><span>p4</span>+theme_minimal()</p></pre></section><p><span></span></p><p><img data-ratio="0.7652916073968705" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzAvaJ3HNHwSAiagLvE2p2ibwtGOBUib6iaTTIvvTIFo0xONRhpfDL0h0WJw/640?wx_fmt=png" data-type="png" data-w="703" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzAvaJ3HNHwSAiagLvE2p2ibwtGOBUib6iaTTIvvTIFo0xONRhpfDL0h0WJw/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#添加X轴的cluster色块标签：</span><br mpa-from-tpl="t"><span>dfbox</span>&lt;-data.frame(groups,<br mpa-from-tpl="t"><span>y</span>=0,<br mpa-from-tpl="t"><span>label</span>=c(1:length(groups)))<br mpa-from-tpl="t"><span>#使用geom_bar比geom_tile的图例更干净一点；</span><br mpa-from-tpl="t"><span>p5</span> &lt;- p4+geom_bar(data=dfbox,<br mpa-from-tpl="t"><span>aes</span>(x=groups,y=y+0.8,fill=groups),stat = <span>"identity"</span>,width = 0.8)+<br mpa-from-tpl="t"><span>geom_bar</span>(data=dfbox,<br mpa-from-tpl="t"><span>aes</span>(x=groups,y=y-0.8,fill=groups),stat = <span>"identity"</span>,width = 0.8)<br mpa-from-tpl="t"><span>p5</span>+theme_minimal()</p></pre></section><p><span></span></p><p><img data-ratio="0.7676470588235295" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzpjLJ4RsGfcgVywoIgMxiaA08iamtgibw3hfgbCqq8Qvwt8vF0WZ1zqvDA/640?wx_fmt=png" data-type="png" data-w="680" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzpjLJ4RsGfcgVywoIgMxiaA08iamtgibw3hfgbCqq8Qvwt8vF0WZ1zqvDA/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#自定义颜色；</span><br mpa-from-tpl="t"><span>mycolor</span> &lt;- c(<span>"#0077c1"</span>,<span>"#00a99e"</span>,<span>"#6bc72b"</span>,<span>"#ff5a20"</span>,<span>"#ff1620"</span>,<span>"#752995"</span>)<br mpa-from-tpl="t"><span>p6</span> &lt;- p5+scale_fill_manual(name=<span>"Groups"</span>,values=alpha(mycolor,1))<br mpa-from-tpl="t"><span>p6</span>+theme_minimal()</p></pre></section><p><span></span></p><p><img data-ratio="0.7694483734087695" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzDFOwJHIkc0JyibGR4YhibQKQ2FFpGeas6p69tZDAo9HvGE4xU3wh0v5Q/640?wx_fmt=png" data-type="png" data-w="707" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzDFOwJHIkc0JyibGR4YhibQKQ2FFpGeas6p69tZDAo9HvGE4xU3wh0v5Q/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#修改X/Y轴标题，添加序号：</span><br mpa-from-tpl="t"><span>p7</span> &lt;- p6+labs(x=<span>""</span>,y=<span>"log2FC"</span>)+<br mpa-from-tpl="t"><span>scale_y_continuous</span>(limits = c(-15, 15),<br mpa-from-tpl="t"><span>breaks</span> = c(-15, -10, -5,0,5,10,15),<br mpa-from-tpl="t"><span>expand</span> = expansion(add = 0))+<br mpa-from-tpl="t"><span>geom_text</span>(data=dfbox,<br mpa-from-tpl="t"><span>aes</span>(x=groups,y=y,label=label),<br mpa-from-tpl="t"><span>size</span> =5,<br mpa-from-tpl="t"><span>color</span> =<span>"white"</span>)<br mpa-from-tpl="t"><span>p7</span>+theme_minimal()</p></pre></section><p><span></span></p><p><img data-ratio="0.7613636363636364" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzhQ1yqIs7HDX6TnBfUp4WbwM1wDL3BJORBHAQB5030CIj8cH2meWIag/640?wx_fmt=png" data-type="png" data-w="704" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzhQ1yqIs7HDX6TnBfUp4WbwM1wDL3BJORBHAQB5030CIj8cH2meWIag/640?wx_fmt=png"></p><p><br mpa-from-tpl="t"></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#自定义主题；</span><br mpa-from-tpl="t"><span>mytheme</span> &lt;- theme_classic()+theme(axis.line.x = element_blank(),<br mpa-from-tpl="t"><span>axis</span>.ticks.x = element_blank(),<br mpa-from-tpl="t"><span>axis</span>.text.x = element_blank())<br mpa-from-tpl="t"><span>p7</span>+mytheme</p></pre></section><p><span></span></p><p><img data-ratio="0.7536656891495601" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzicEs0SQxeI2k38Jv0q4bjcX9aic5UfXQKLtT2dibR4OVX9sdIv1fGv50w/640?wx_fmt=png" data-type="png" data-w="682" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzicEs0SQxeI2k38Jv0q4bjcX9aic5UfXQKLtT2dibR4OVX9sdIv1fGv50w/640?wx_fmt=png"></p><p><br></p><p><span>当然，如果觉得方格子的图例不好看，也可以使用Ai(Adobe illustrator)改成圆形，最终的效果如下：</span></p><p><span><br></span></p><p><img data-ratio="0.7161383285302594" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzIBojgfS89Jt5QDpD6VH0zoWRWJkaA1DJfuaoJMyF2FhhXiaXkAfSmBg/640?wx_fmt=png" data-type="png" data-w="694" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgmwKeKpdxLPbhPU0wEEWdzIBojgfS89Jt5QDpD6VH0zoWRWJkaA1DJfuaoJMyF2FhhXiaXkAfSmBg/640?wx_fmt=png"></p><p><br></p><section data-role="title" data-tools="135编辑器" data-id="113060"><section><section><section><section><section><br></section><section data-brushtype="text" hm_fix="302:513"><span><strong>参考文献</strong></span></section><section><br></section></section><section><br></section></section></section></section></section><p><span>Asp M, Giacomello S, Larsson L, et al. A spatiotemporal organ-wide gene </span><span>expression and </span><span>cell atlas of the developing human heart[J]. Cell, 2019, 179(7): 1647-1660. e19.</span></p><p><span><br></span></p><p><span><strong><span>*未经许可，不得以任何方式复制或抄袭本篇文章之部分或全部内容。版权所有，侵权必究。</span></strong></span></p><p><span><strong><span><br></span></strong></span></p><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="105648"><section><section data-role="outer" label="Powered by 135editor.com"><section data-role="paragraph"><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="105648"><section><section><img data-ratio="0.8928571428571429" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJE8VibmibGU0Jxic9iabARVRH0FT6BNE8VAglWFXBPibFAU7a6tWGibSs8wyUg/640?wx_fmt=png" data-type="png" data-w="41" data-width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJE8VibmibGU0Jxic9iabARVRH0FT6BNE8VAglWFXBPibFAU7a6tWGibSs8wyUg/640?wx_fmt=png"></section><section><section><section data-width="35%"><section><section data-width="100%"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEv5etCBwHicqbEPwnVrkpaasxqaVibM4mT2JdIuN6yTlYWDD4mL5A427A/640?wx_fmt=jpeg" data-type="jpeg" data-w="860" data-width="100%" title="SCIPainter 30cm二维码.jpg" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEv5etCBwHicqbEPwnVrkpaasxqaVibM4mT2JdIuN6yTlYWDD4mL5A427A/640?wx_fmt=jpeg"></section></section></section><section data-width="50%"><section><section data-brushtype="text"><strong># SCIPainter</strong></section><section data-brushtype="text" hm_fix="361:593"><p>基迪奥旗下绘图公众号</p><p>分享科研绘图技能与工具</p><p>欢迎关注与转发~</p></section></section></section></section></section></section></section></section></section></section><section><br></section></section></section><section data-role="paragraph"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEgMd0aMPtmrDjiaX8sBhfhicVteeHf1JicexSpUbS3fdS9SiboUVN7guaPw/640?wx_fmt=gif" data-type="gif" data-w="400" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEgMd0aMPtmrDjiaX8sBhfhicVteeHf1JicexSpUbS3fdS9SiboUVN7guaPw/640?wx_fmt=gif"></section></section></section><section><section powered-by="xiumi.us"><section><p><span><strong>你的好友拍了拍你</strong></span></p><p><span><strong>并请你帮她点一下</strong></span><span><strong><span>“分享”</span></strong></span><span><strong><span>~</span></strong></span></p></section></section></section></section></section><p><span></span><br></p></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/YZ038qgKo2FNPEB0TD6gJQ",target="_blank" rel="noopener noreferrer">原文链接</a>
