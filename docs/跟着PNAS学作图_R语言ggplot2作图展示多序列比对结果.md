---
title: "跟着PNAS学作图：R语言ggplot2作图展示多序列比对结果"
date: 2022-11-26T04:45:11Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Acdemic"]
---
跟着PNAS学作图：R语言ggplot2作图展示多序列比对结果 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><h2 data-tool="mdnice编辑器"><span></span><span>论文</span><span> </span></h2><blockquote data-tool="mdnice编辑器"><p>The evidence remains clear: SARS-CoV-2 emerged via the wildlife trade</p></blockquote><p data-tool="mdnice编辑器">https://www.pnas.org/doi/10.1073/pnas.2214427119</p><p data-tool="mdnice编辑器">在 饶毅科学 公众号 看到的推文 <strong>美国科学院院刊：逐条反驳新冠是实验室产物的错误说法</strong></p><p data-tool="mdnice编辑器">其中有一个图是</p><figure data-tool="mdnice编辑器"><img data-ratio="0.4645161290322581" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk75beKUz7h04oXgAyqU13fzXGAwaHiaqh4pS0TnhX7XHdYBvC78HTkH5bmf7Yy2pku5l6mcAKia0wKw/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk75beKUz7h04oXgAyqU13fzXGAwaHiaqh4pS0TnhX7XHdYBvC78HTkH5bmf7Yy2pku5l6mcAKia0wKw/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">今天的推文我们来试着复现一下这个图</p><h2 data-tool="mdnice编辑器"><span></span><span>首先是一个多序列比对文件</span><span> </span></h2><figure data-tool="mdnice编辑器"><img data-ratio="0.8399629972247918" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk75beKUz7h04oXgAyqU13fz2qtxOGojjdhtKeJ6C7soBGB71qNBOcy5ryyeVkRKVnePBID35gibpbg/640?wx_fmt=png" data-type="png" data-w="1081" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk75beKUz7h04oXgAyqU13fz2qtxOGojjdhtKeJ6C7soBGB71qNBOcy5ryyeVkRKVnePBID35gibpbg/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>读取数据</span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- phylotools::read.fasta(<span>"data/20221126/pnas.fasta"</span>) <br>df<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>把序列拆分成一个碱基一列</span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>df %&gt;% <br>  tidyr::separate(seq.text,paste0(<span>"col"</span>,str_pad(1:28,2,side = <span>"left"</span>,pad = <span>"0"</span>)),<span>''</span>) %&gt;% <br>  select(-col01) %&gt;% <br>  mutate(seq.name=factor(seq.name,levels = rev(seq.name))) %&gt;% <br>  pivot_longer(!seq.name) -&gt; new.df<br></code></pre><p data-tool="mdnice编辑器">这里有一个问题是序列是27个碱基，拆分的时候需要指定28列，然后第一列是空的，暂时没有想明白是为啥</p><h2 data-tool="mdnice编辑器"><span></span><span>首先是多序列比对</span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>p1&lt;-new.df %&gt;% <br>  ggplot(aes(x=name,y=seq.name))+<br>  geom_tile(fill=<span>"white"</span>,alpha=0)+<br>  geom_text(aes(label=value))+<br>  theme_bw()+<br>  theme(axis.text.x = element_blank(),<br>        axis.ticks = element_blank(),<br>        panel.grid = element_blank(),<br>        panel.border = element_blank()) <br>p1<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6841574167507568" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk75beKUz7h04oXgAyqU13fzhccicibYXicHdkn9tVmL4x6wLgIa8Sdq2VxS9kTmc5dTmnFS9e12puoog/640?wx_fmt=png" data-type="png" data-w="991" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk75beKUz7h04oXgAyqU13fzhccicibYXicHdkn9tVmL4x6wLgIa8Sdq2VxS9kTmc5dTmnFS9e12puoog/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>添加左右两侧的数字</span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>df1&lt;-data.frame(x=0,<br>                y=11:1,<br>                label=c(671,668,669,666,744,743,756,736,706,747,759))<br>df2&lt;-data.frame(x=28,<br>                y=11:1,<br>                label=c(695,692,693,690,770,665,777,761,727,768,780))<br>  <br>p1+<br>  geom_text(data=df1,<br>            aes(x=x,y=y,label=label),<br>            inherit.aes = FALSE,hjust=1)+<br>  geom_text(data=df2,<br>            aes(x=x,y=y,label=label),<br>            inherit.aes = FALSE,hjust=0)+<br>  coord_equal(xlim = c(-1,29)) -&gt; p2<br>p2<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.37985865724381623" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk75beKUz7h04oXgAyqU13fzAev62D1G9wQzrqwYyRpsgSn3R9m4rf2VnCd5ow2INUGsnlwmUMzXUA/640?wx_fmt=png" data-type="png" data-w="1132" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk75beKUz7h04oXgAyqU13fzAev62D1G9wQzrqwYyRpsgSn3R9m4rf2VnCd5ow2INUGsnlwmUMzXUA/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>在自己感兴趣的地方添加背景色</span><span> </span></h2><p data-tool="mdnice编辑器">部分示例数据</p><figure data-tool="mdnice编辑器"><img data-ratio="0.6307977736549165" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk75beKUz7h04oXgAyqU13fzVjReF5G7ECtueVfibQ3hNI6ibCzDvWiaWAKtM8TGicibR1q7j7o81vGniaeg/640?wx_fmt=png" data-type="png" data-w="539" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk75beKUz7h04oXgAyqU13fzVjReF5G7ECtueVfibQ3hNI6ibCzDvWiaWAKtM8TGicibR1q7j7o81vGniaeg/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code>df3&lt;-readxl::read_excel(<span>"data/20221126/data.xlsx"</span>)<br>df3<br><br><br>p2 +<br>  geom_tile(data=df3,aes(x=x,y=y,fill=group),<br>            color=<span>"white"</span>,show.legend = FALSE)+<br>  geom_text(data=df3,aes(x=x,y=y,label=label),<br>            color=<span>"white"</span>)+<br>  scale_fill_manual(values = c(<span>"#00adef"</span>,<span>"#ed1b24"</span>))+<br>  labs(x=NULL,y=NULL)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.4258064516129032" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk75beKUz7h04oXgAyqU13fzePOWfzYjyGMCbn5tjbreBqsq0e025iaVEIUd8icictOqfEia1X4sEMqZ6Q/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk75beKUz7h04oXgAyqU13fzePOWfzYjyGMCbn5tjbreBqsq0e025iaVEIUd8icictOqfEia1X4sEMqZ6Q/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><blockquote data-tool="mdnice编辑器"><p>示例数据和代码可以给推文点赞，点击在看，最后留言获取</p></blockquote><p data-tool="mdnice编辑器">欢迎大家关注我的公众号</p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzI3NzQ3MTcxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5t1sOnM0iabvBhnfIj5YpyqrMib0E1MGCd9ibcYxaOPZd0GWhQBDvK2BPEwsicQxd6y5MHLfphnwHnow/0?wx_fmt=png" data-nickname="小明的数据分析笔记本" data-alias="" data-signature="数据分析和数据可视化有意思的简单小例子~石榴研究生的笔记本" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"><br></p><blockquote data-tool="mdnice编辑器"><p>小明的数据分析笔记本 公众号 主要分享：1、R语言和python做数据分析和数据可视化的简单小例子；2、园艺植物相关转录组学、基因组学、群体遗传学文献阅读笔记；3、生物信息学入门学习资料及自己的学习笔记！</p></blockquote></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/H5TvN_ZpuRHT_waPXRW_tg",target="_blank" rel="noopener noreferrer">原文链接</a>
