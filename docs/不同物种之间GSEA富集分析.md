---
title: "不同物种之间GSEA富集分析"
date: 2022-11-26T15:18:01Z
draft: ["false"]
tags: [
  "fetched",
  "生信小知识"
]
categories: ["Acdemic"]
---
不同物种之间GSEA富集分析 by 生信小知识
------
<div><section><h2><span>不同物种之间GSEA富集分析</span></h2><blockquote><p>微信公众号：<strong>生信小知识</strong><br>关注可了解更多的生物信息学教程及知识。问题或建议，请公众号留言;</p></blockquote><h3><span>目录</span></h3><p><span><span>前言</span></span><span><span>1. 安装R包</span></span><span><span>2. gmt数据下载</span></span><span><span>3. GSEA输入数据</span></span><span><span>4. GSEA分析</span></span><span><span><span>4.1 fgsea</span></span></span><span><span><span>4.2 GSEA</span></span></span><span><span><span>4.3 两种结果的比较</span></span></span><span><span>后记</span></span></p><h3><span>前言</span></h3><p>之前介绍过不同物种之间的GO和KEGG富集分析：</p><ul><li><p>GO需要通过指定 <code>OrgDb</code> 对象来提供物种的信息，因为在 <code>OrgDb</code> 对象中包含了该物种GO的数据信息。</p></li><li><p><span>KEGG需要从官网拉取不同物种的数据，当然也可以直接制作成本底的KEGG数据包，方便结果的重复。</span></p></li></ul><p>具体可以参考之前的推文：<a href="https://mp.weixin.qq.com/s?__biz=MjM5NTk0Mzg2Nw==&amp;mid=2247488511&amp;idx=1&amp;sn=4cab1d4829d0b3be871c5458c6a2b765&amp;scene=21#wechat_redirect" data-linktype="2">不同物种的GO和KEGG富集分析</a></p><p>那么，如果我们想对其他物种进行GSEA分析时，需要怎么办呢？</p><p>根据GSEA的算法逻辑，我们需要的其实只是一个 <code>gmt</code> 文件罢了。所以现在的问题就是——去哪弄 <code>gmt</code> 文件？</p><p>这里推荐使用 <code>msigdbr</code> R包。</p><blockquote><p><code>msigdbr</code> R包是GSEA官方出品的软件包，所以相对可信，可以放心使用</p></blockquote><p>官方说明见：https://cran.r-project.org/web/packages/msigdbr/vignettes/msigdbr-intro.html</p><h3><span>1. 安装R包</span></h3><pre><code>install.packages(<span>"msigdbr"</span>)<br></code></pre><h3><span>2. gmt数据下载</span></h3><p>我们首先找到可以获取的全部物种信息：</p><pre><code><span>library</span>(msigdbr)<br>msigdbr_species()<br><span>#&gt; # A tibble: 20 × 2</span><br><span>#&gt;    species_name                    species_common_name                                    </span><br><span>#&gt;    &lt;chr&gt;                           &lt;chr&gt;                                                  </span><br><span>#&gt;  1 Anolis carolinensis             Carolina anole, green anole                            </span><br><span>#&gt;  2 Bos taurus                      bovine, cattle, cow, dairy cow, domestic cattle, domes…</span><br><span>#&gt;  3 Caenorhabditis elegans          &lt;NA&gt;                                                   </span><br><span>#&gt;  4 Canis lupus familiaris          dog, dogs                                              </span><br><span>#&gt;  5 Danio rerio                     leopard danio, zebra danio, zebra fish, zebrafish      </span><br><span>#&gt;  6 Drosophila melanogaster         fruit fly                                              </span><br><span>#&gt;  7 Equus caballus                  domestic horse, equine, horse                          </span><br><span>#&gt;  8 Felis catus                     cat, cats, domestic cat                                </span><br><span>#&gt;  9 Gallus gallus                   bantam, chicken, chickens, Gallus domesticus           </span><br><span>#&gt; 10 Homo sapiens                    human                                                  </span><br><span>#&gt; 11 Macaca mulatta                  rhesus macaque, rhesus macaques, Rhesus monkey, rhesus…</span><br><span>#&gt; 12 Monodelphis domestica           gray short-tailed opossum                              </span><br><span>#&gt; 13 Mus musculus                    house mouse, mouse                                     </span><br><span>#&gt; 14 Ornithorhynchus anatinus        duck-billed platypus, duckbill platypus, platypus      </span><br><span>#&gt; 15 Pan troglodytes                 chimpanzee                                             </span><br><span>#&gt; 16 Rattus norvegicus               brown rat, Norway rat, rat, rats                       </span><br><span>#&gt; 17 Saccharomyces cerevisiae        baker's yeast, brewer's yeast, S. cerevisiae           </span><br><span>#&gt; 18 Schizosaccharomyces pombe 972h- &lt;NA&gt;                                                   </span><br><span>#&gt; 19 Sus scrofa                      pig, pigs, swine, wild boar                            </span><br><span>#&gt; 20 Xenopus tropicalis              tropical clawed frog, western clawed frog</span><br></code></pre><p>可以看到，我们一共可以使用的物种信息有20种，理论上应该可以覆盖我们所需要的大多数情况了。</p><p>接下来我们还是以大鼠 Rattus norvegicus 为例进行演示。</p><p>我们需要拿到大鼠的gmt文件，我们可以通过函数完成：</p><pre><code>target_species &lt;- <span>"Rattus norvegicus"</span><br>all_gene_sets = msigdbr(species = target_species)<br>table(all_gene_sets$gs_cat)<br><span>#     C1      C2      C3      C4      C5      C6      C7      C8       H </span><br><span>#  17771  504876  758373   88729 1200716   28777  953611  109760    7300</span><br></code></pre><p>这样我们就拿到了所有的gmt文件。当然了，如果我们有特定的需求，例如前面我们可以看到所有的基因基其实可以分为C1-C8，加上H，一共9个类别，这9类的含义分别是：</p><p><img data-ratio="0.6737160120845922" data-src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJpaDlrsPMkq62REBCsBlYnOdbkPicNmRv5xMGNicSzibQw5W7ZibW2iciaDgpnfl69C4ibIE9OIZtCAKvianQ/640?wx_fmt=png" data-type="png" data-w="662" src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJpaDlrsPMkq62REBCsBlYnOdbkPicNmRv5xMGNicSzibQw5W7ZibW2iciaDgpnfl69C4ibIE9OIZtCAKvianQ/640?wx_fmt=png"></p><p>如果我们只对免疫信号感兴趣，或者只对T细胞相关信号感兴趣，又或者我们只是对某些特定的数据集感兴趣，我们也可以只提取感兴趣的基因集。</p><p>但是首先我们需要先知道，都有哪些数据集，我们可以利用函数来检查都有哪些数据集类型可以获取：</p><pre><code>msigdbr_collections()<br><span>#&gt; # A tibble: 23 × 3</span><br><span>#&gt;    gs_cat gs_subcat         num_genesets</span><br><span>#&gt;    &lt;chr&gt;  &lt;chr&gt;                    &lt;int&gt;</span><br><span>#&gt;  1 C1     ""                         299</span><br><span>#&gt;  2 C2     "CGP"                     3384</span><br><span>#&gt;  3 C2     "CP"                        29</span><br><span>#&gt;  4 C2     "CP:BIOCARTA"              292</span><br><span>#&gt;  5 C2     "CP:KEGG"                  186</span><br><span>#&gt;  6 C2     "CP:PID"                   196</span><br><span>#&gt;  7 C2     "CP:REACTOME"             1615</span><br><span>#&gt;  8 C2     "CP:WIKIPATHWAYS"          664</span><br><span>#&gt;  9 C3     "MIR:MIRDB"               2377</span><br><span>#&gt; 10 C3     "MIR:MIR_Legacy"           221</span><br><span>#&gt; 11 C3     "TFT:GTRD"                 518</span><br><span>#&gt; 12 C3     "TFT:TFT_Legacy"           610</span><br><span>#&gt; 13 C4     "CGN"                      427</span><br><span>#&gt; 14 C4     "CM"                       431</span><br><span>#&gt; 15 C5     "GO:BP"                   7658</span><br><span>#&gt; 16 C5     "GO:CC"                   1006</span><br><span>#&gt; 17 C5     "GO:MF"                   1738</span><br><span>#&gt; 18 C5     "HPO"                     5071</span><br><span>#&gt; 19 C6     ""                         189</span><br><span>#&gt; 20 C7     "IMMUNESIGDB"             4872</span><br><span>#&gt; 21 C7     "VAX"                      347</span><br><span>#&gt; 22 C8     ""                         700</span><br><span>#&gt; 23 H      ""                          50</span><br></code></pre><p>这里为了方便验证，我选择使用<strong>GO中的BP</strong>数据集进行分析，那么我们可以只提取C5的数据集就可以了，这个目的我们也可以通过 <code>msigdbr</code> 函数做到：</p><pre><code>target_category &lt;- <span>"C5"</span><br>subcategory &lt;- <span>"BP"</span><br>target_gene_sets = msigdbr(species = target_species,category = target_category,subcategory = subcategory)<br>table(all_gene_sets$gs_cat)<br><span>#     C5 </span><br><span># 596303</span><br><br>target_gene_sets &lt;- as.data.frame(target_gene_sets[,c(<span>"gs_name"</span>,<span>"ensembl_gene"</span>)])<br>random &lt;- sample(unique(target_gene_sets$gs_name),<span>100</span>)<br>target_gene_sets &lt;- target_gene_sets[target_gene_sets$gs_name %<span>in</span>% random,]<br>head(target_gene_sets)<br><span>#                                                      gs_name       ensembl_gene</span><br><span># 2860 GOBP_ACTIVATION_OF_CYSTEINE_TYPE_ENDOPEPTIDASE_ACTIVITY ENSRNOG00000008022</span><br><span># 2861 GOBP_ACTIVATION_OF_CYSTEINE_TYPE_ENDOPEPTIDASE_ACTIVITY ENSRNOG00000007445</span><br><span># 2862 GOBP_ACTIVATION_OF_CYSTEINE_TYPE_ENDOPEPTIDASE_ACTIVITY ENSRNOG00000021147</span><br><span># 2863 GOBP_ACTIVATION_OF_CYSTEINE_TYPE_ENDOPEPTIDASE_ACTIVITY ENSRNOG00000000485</span><br><span># 2864 GOBP_ACTIVATION_OF_CYSTEINE_TYPE_ENDOPEPTIDASE_ACTIVITY ENSRNOG00000012331</span><br><span># 2865 GOBP_ACTIVATION_OF_CYSTEINE_TYPE_ENDOPEPTIDASE_ACTIVITY ENSRNOG00000012944</span><br></code></pre><h3><span>3. GSEA输入数据</span></h3><p>拿到了 <code>gmt</code> 文件后，对于进行GSEA分析而言，我们还需要另外一个数据：排序后的差异分析结果。</p><p>什么是排序后的差异分析结果呢？</p><p>其实就是一个向量，数值是差异分析的logFC值，名字是基因。</p><p>具体而言：</p><pre><code>geneList &lt;- deg$logFC<br>names(geneList) &lt;- deg$gene_id<br>geneList = sort(geneList, decreasing = <span>TRUE</span>)<br>head(geneList)<br><span># ENSRNOG00000023686 ENSRNOG00000039931 ENSRNOG00000027380 ENSRNOG00000006878 ENSRNOG00000049743 ENSRNOG00000014409 </span><br><span>#           6.886050           6.305090           6.296671           6.062613           6.036807           5.903429</span><br></code></pre><p>可以看到，这里的 <code>geneList</code> 是一个数值型向量，这个向量有个名字，对应的是基因ID。</p><p>下面我们就需要利用这个数据进行GSEA分析了。</p><h3><span>4. GSEA分析</span></h3><p>关于GSEA分析的原理很多地方已经做过详细解读了，我就不再做过多解释。但是对于没有做过该分析的同学，我推荐去看GSEA的原始paper，因为我印象中这个paper中写的还是很清晰的，而且作为官方的解读，肯定会比经过其他人解读后的东西更加真实可靠。</p><ul><li><p><span>GSEA的原始paper：https://www.ncbi.nlm.nih.gov/pubmed/16199517</span></p></li></ul><figure><img data-ratio="0.5381984036488028" data-src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJpaDlrsPMkq62REBCsBlYnORu6VBtvogy8lNpPXz0BD9Hyib2FHx8vtoemfRN8k975T07ibYZM4vVUg/640?wx_fmt=png" data-type="png" data-w="877" src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJpaDlrsPMkq62REBCsBlYnORu6VBtvogy8lNpPXz0BD9Hyib2FHx8vtoemfRN8k975T07ibYZM4vVUg/640?wx_fmt=png"><figcaption>论文中的fig1</figcaption></figure><p>在实践分析中，GSEA的分析有2种方式：</p><ul><li><p><code>fgsea::fgsea()</code></p></li><li><p><code>clusterProfiler::GSEA()</code></p></li></ul><p>其原理大致是相同的，只是在一些细节之处有一定的修改，所以，选择哪个，你可以自由决定。</p><p>这里两种方法都做演示。</p><h4><span>4.1 fgsea</span></h4><pre><code>msigdbr_list = split(x = target_gene_sets$ensembl_gene, f = target_gene_sets$gs_name)<br>result1 &lt;- fgsea::fgsea(pathways = msigdbr_list, geneList)<br>dim(result1)<br><span># [1] 100   8</span><br>sum(result1$pval&lt;<span>0.01</span>,na.rm = <span>T</span>)<br><span># [1] 12</span><br><br><span># 可视化</span><br>fgsea::plotEnrichment(msigdbr_list[[<span>1</span>]],geneList)<br></code></pre><figure><img data-ratio="0.6126279863481229" data-src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJpaDlrsPMkq62REBCsBlYnOplud7KQNyvMNUKxdFCa3DmeypnQ0XiafcZ8Zhl7PjkNA5Y4NnqBtiawQ/640?wx_fmt=png" data-type="png" data-w="2344" src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJpaDlrsPMkq62REBCsBlYnOplud7KQNyvMNUKxdFCa3DmeypnQ0XiafcZ8Zhl7PjkNA5Y4NnqBtiawQ/640?wx_fmt=png"><figcaption>fgsea</figcaption></figure><h4><span>4.2 GSEA</span></h4><pre><code>result2_dat &lt;- clusterProfiler::GSEA(geneList,<br>                                     TERM2GENE = target_gene_sets, <br>                                     minGSSize = <span>1</span>,<br>                                     maxGSSize = <span>5000</span>,<br>                                     pvalueCutoff = <span>1</span>,<br>                                     nPermSimple = <span>5000</span>)<br>result2 &lt;- result2_dat@result<br>dim(result2)<br><span># [1] 100   11</span><br>sum(result2$pvalue&lt;<span>0.01</span>,na.rm = <span>T</span>)<br><span># [1] 11</span><br><br><span># 可视化</span><br>enrichplot::gseaplot(result2_dat,geneSetID=names(msigdbr_list)[<span>1</span>])<br>enrichplot::gseaplot2(result2_dat,geneSetID=names(msigdbr_list)[<span>1</span>])<br></code></pre><figure><img data-ratio="0.5675446049277825" data-src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJpaDlrsPMkq62REBCsBlYnOia5WBagRf3IgubkEMCedrXWodW9OebemTFliaEeYd8Zp7DGzWRIhz11g/640?wx_fmt=png" data-type="png" data-w="2354" src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJpaDlrsPMkq62REBCsBlYnOia5WBagRf3IgubkEMCedrXWodW9OebemTFliaEeYd8Zp7DGzWRIhz11g/640?wx_fmt=png"><figcaption>gseaplot</figcaption></figure><figure><img data-ratio="0.6085470085470085" data-src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJpaDlrsPMkq62REBCsBlYnO4BibvYR1zBUPHQibWZMM6aUiaVbMB8BJll4jrg0fRkibszEVEcprCNibNvA/640?wx_fmt=png" data-type="png" data-w="2340" src="https://mmbiz.qpic.cn/mmbiz_png/fOo3cmIWvJpaDlrsPMkq62REBCsBlYnO4BibvYR1zBUPHQibWZMM6aUiaVbMB8BJll4jrg0fRkibszEVEcprCNibNvA/640?wx_fmt=png"><figcaption>gseaplot2</figcaption></figure><h4><span>4.3 两种结果的比较</span></h4><pre><code>r1 &lt;- result1$pathway[result1$pval&lt;<span>0.01</span>]<br>r2 &lt;- result2[result2$pvalue&lt;<span>0.01</span>,<span>"ID"</span>]<br>length(intersect(r1,r2))<br><span># 11</span><br></code></pre><p>所以，在 <code>P&lt;0.01</code> 的标准下，两种方法分别检查到显著的信号通路有12条和11条，但是其中11条是共有的。</p><p>所以说明这两种算法整体结果是很相似的。</p><h3><span>后记</span></h3><p>后续有新需求再做补充~</p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/OrzFsO4I1aV-zBJiURv4cA",target="_blank" rel="noopener noreferrer">原文链接</a>
