---
title: "ggraph优雅的绘制环状网络图(2)"
date: 2022-08-30T23:56:57Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
ggraph优雅的绘制环状网络图(2) by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来继续介绍一个<strong>「ggraph」</strong>绘制网络图的案例，各位观众老爷细细品味；那么下面通过一个小栗子来进行展示，<strong>「数据代码已经上传VIP群，请自行下载」</strong></p><span>❞</span></blockquote><blockquote data-tool="mdnice编辑器"><span>❝</span><p><code>有需要学习数据可视化的观众老爷欢迎加入小编的VIP群</code>，目前已经上传<strong>「2021-2022两年公众号文档数据+代码约190篇左右」</strong>包含付费文档，扫描文末尾二维码加小编微信<strong>「付费99元」</strong>后邀请进群，<strong>「由于群名额有限人满之后将不在添加新成员」</strong>，有需要的请尽早加入，早进早享受；<strong>「一定让你感受到物超所值」</strong>，<code>加入小编的VIP如果你有一些让我感兴趣的图表提供示例数据小编若有时间会写成推文发送</code></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>library(tidyverse)<br>library(glue)<br>library(tidygraph)<br>library(ggraph)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- readr::read_csv(<span>'data.csv'</span>)<br><br><span># 构建颜色分类数据集</span><br>category_color &lt;- tibble(category = c(<span>"Knowledge"</span>,<span>"Leadership"</span>, <span>"Creativity"</span>, <span>"Identity"</span>),<br>                         color = c(<span>"#5686C3"</span>,<span>"#973CB6"</span>,<span>"#F5A300"</span>,<span>"#75C500"</span>)) <br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据整合</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df_nodes &lt;- df %&gt;% <br>  left_join(category_color) %&gt;% <br>  select(name,category,country,color)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>生成点文件</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>nodes &lt;- tibble(node = c(<span>'root'</span>, unique(df<span>$category</span>), unique(df<span>$name</span>))) %&gt;% <br>  filter(node != <span>"All"</span>, node != <span>"Unsung hero"</span>) %&gt;% <br>  mutate(level = case_when(node == <span>"root"</span> ~ 1,<br>                           node %<span>in</span>% category_color<span>$category</span> ~ 2,<br>                           TRUE ~ 3))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>生成边文件</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>lvl_one_edges &lt;- df %&gt;% <br>  filter(category != <span>"All"</span>) %&gt;% <br>  distinct(category) %&gt;% <br>  mutate(from = <span>"root"</span>) %&gt;% <br>  left_join(category_color) %&gt;% <br>  rename(to = category)<br><br>lvl_two_edges &lt;- df %&gt;% <br>  filter(category != <span>"All"</span>) %&gt;% <br>  left_join(category_color) %&gt;% <br>  select(to = name,<br>         from = category, <br>         color)<br><span># 合并边文件</span><br>edges &lt;- bind_rows(lvl_one_edges, lvl_two_edges)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>整合点文件与边文件</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>graph  &lt;- tbl_graph(nodes,edges) <br></code></pre><blockquote data-tool="mdnice编辑器"><span>❝</span><p>在此使用create_layout()函数得到节点位置的数据集</p><span>❞</span></blockquote><pre data-tool="mdnice编辑器"><span></span><code>portraits &lt;- create_layout(graph, layout = <span>'dendrogram'</span>, circular = TRUE) %&gt;% <br>  left_join(df_nodes, by = c(<span>"node"</span> = <span>"name"</span>)) %&gt;% <br>  left_join(category_color, by = c(<span>"node"</span> = <span>"category"</span>)) %&gt;% <br>  mutate(color = coalesce(color.x, color.y)) %&gt;% <br>  select(-color.x, -color.y)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>ggraph(graph, layout = <span>'dendrogram'</span>, circular = TRUE) + <br>  geom_edge_diagonal(aes(colour = color), width = 1) +<br>  geom_node_point(data = filter(portraits, level == 3),<br>                  size=3,aes(color=color))+<br><span># 添加内部节点标签                  </span><br>  geom_node_text(data = filter(portraits, level == 2),<br>                 aes(label = toupper(node),color = color,<br>                     x = 0.75*x, y = 0.75 * y,<br>                     hjust = c(1, 1, 0.8, -0.1),<br>                     vjust = c(0, 0,0, 0)),size=4) +<br><span># 添加外部节点标签                     </span><br>  geom_node_text(data = filter(portraits, level == 3),<br>                 aes(label = node, color = color, x = x*1.05, y = y*1.05,<br>                     angle = -((-node_angle(x, y)+90)%%180)+90,<br>                     hjust = ifelse(between(node_angle(x,y), 90,270),1,0)),size = 3) +<br>  labs(x = NULL,y = NULL) +<br><span># 设置边线条颜色</span><br>  scale_edge_color_manual(values=c(<span>"#5686C3"</span>,<span>"#973CB6"</span>,<span>"#F5A300"</span>,<span>"#75C500"</span>,<span>"#D9D9D9"</span>))+<br>  scale_color_manual(values=c(<span>"#5686C3"</span>,<span>"#973CB6"</span>,<span>"#F5A300"</span>,<span>"#75C500"</span>,<span>"#D9D9D9"</span>)) +<br>  theme(axis.text.x = element_blank(),<br>        axis.text.y = element_blank(),<br>        panel.background = element_blank(),<br>        legend.position = <span>"non"</span>,<br>        plot.margin=unit(c(2.5,0.1,2.3,0.1),units=,<span>"cm"</span>)) +<br>  coord_equal(clip = <span>"off"</span>) <br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9106566200215285" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYzobyibPnVlZTYbBdV9iaCibfMZjtlRnoqLMWKZBF3iaMRRslKbmySia8S4JxJEqajtiaibMcvYOokxdWfA/640?wx_fmt=png" data-type="png" data-w="929" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYzobyibPnVlZTYbBdV9iaCibfMZjtlRnoqLMWKZBF3iaMRRslKbmySia8S4JxJEqajtiaibMcvYOokxdWfA/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>好了本节介绍到此结束，喜欢的观众老爷欢迎分享转发；<strong>「当然更推荐大家加入我的VIP交流群」</strong>扫描下方二维码加小编微信<strong>「付费99元」</strong>后邀请进群，<strong>「一定让你感受到物超所值」</strong>，<strong>「添加小编微信请备注来意，以便高效处理」</strong></p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>小编微信</span><span></span></h3><p><img data-galleryid="" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg" data-type="jpeg" data-w="430" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/zg-6mflEAzw0xtwFWpO4sA",target="_blank" rel="noopener noreferrer">原文链接</a>
