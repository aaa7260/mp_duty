---
title: "如何轻松绘制多颜色尺度图例+嵌套分面的图表？"
date: 2022-12-31T09:38:50Z
draft: ["false"]
tags: [
  "fetched",
  "SCIPainter"
]
categories: ["Acdemic"]
---
如何轻松绘制多颜色尺度图例+嵌套分面的图表？ by SCIPainter
------
<div><section data-mpa-powered-by="yiban.io"><span>往期分享了一个能够对图表目标区域进行局部放大或圈选标注的R包ggforce，有兴趣可戳</span><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzIyOTY3MDA3MA==&amp;mid=2247507323&amp;idx=1&amp;sn=af36722d1e62ccd0672d66e367042f5b&amp;chksm=e8bdb0a2dfca39b449d0fd1fcb211dec7bd9e16c4b72874b0c592e28c9e5e8ff06ed9e33e040&amp;scene=21#wechat_redirect" textvalue="《绝绝子！一键放大或圈选出你的目标区域！》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">《绝绝子！一键放大或圈选出你的目标区域！》</a></span><span>。</span></section><section><span><br></span></section><section><span>今天继续分享一个有意思的ggplot2扩展包ggh4x，使用该R包可以轻易在一个图表中同时使用多个颜色尺度图例，以及进行嵌套分面，如下。下面就赶紧来学习一番吧！</span></section><section><span><br></span></section><section><img data-ratio="0.7146326654523376" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyMZkaAicMsBkGwFkyQKiaEgbWGosgmc7qzSpGagMf7CSria02s6hibjJUHw/640?wx_fmt=png" data-type="png" data-w="1647" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyMZkaAicMsBkGwFkyQKiaEgbWGosgmc7qzSpGagMf7CSria02s6hibjJUHw/640?wx_fmt=png"></section><section><br mpa-from-tpl="t"></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#相关R包安装与载入：</span><br mpa-from-tpl="t"><span>devtools</span>::install_github(<span>"teunbrand/ggh4x"</span>)<br mpa-from-tpl="t"><span>library</span>(ggh4x)<br mpa-from-tpl="t"><span>library</span>(scales)<br mpa-from-tpl="t"><span>#使用iris数据集测试：</span><br mpa-from-tpl="t"><span>df</span> &lt;- iris<br mpa-from-tpl="t"><span>head</span>(df)</code></pre></section><p><br mpa-from-tpl="t"></p><section><span></span></section><section><img data-ratio="0.2566079295154185" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyQoGIaz6ic45aW9tOktufr7fpujN4wlTNprmaVnj8veqI4SwF8X9ZRhw/640?wx_fmt=png" data-type="png" data-w="908" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyQoGIaz6ic45aW9tOktufr7fpujN4wlTNprmaVnj8veqI4SwF8X9ZRhw/640?wx_fmt=png"></section><section><br mpa-from-tpl="t"></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#增加一个叶长的分组：</span><br mpa-from-tpl="t"><span>df</span> &lt;- transform(<br mpa-from-tpl="t"><span>df</span>,<br mpa-from-tpl="t"><span>Leaves</span> = ifelse(Species == <span>"setosa"</span>, <span>"Short Leaves"</span>, <span>"Long Leaves"</span>)<br mpa-from-tpl="t">)<br mpa-from-tpl="t"><span>head</span>(df)</code></pre></section><p><br mpa-from-tpl="t"></p><section><span></span></section><section><img data-ratio="0.21755368814192344" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGySvian5azxGfW2pXqDAGDkVUiarWLC9qicLO16Jicwn8F3uWGPWQicsUEeRw/640?wx_fmt=png" data-type="png" data-w="1071" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGySvian5azxGfW2pXqDAGDkVUiarWLC9qicLO16Jicwn8F3uWGPWQicsUEeRw/640?wx_fmt=png"></section><section><br mpa-from-tpl="t"></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#ggplot2散点图绘制：</span><br mpa-from-tpl="t"><span>p</span> &lt;- ggplot(df,<br mpa-from-tpl="t"><span>aes</span>(Petal.Length, Petal.Width, colour = Species)) + <span>#颜色根据Species分组</span><br mpa-from-tpl="t"><span>geom_point</span>() +<br mpa-from-tpl="t"><span>theme_classic</span>()<br mpa-from-tpl="t"><span>p</span></code></pre></section><p><br mpa-from-tpl="t"></p><section><span></span></section><section><img data-ratio="0.8277074542897328" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyDCAHnJPxmcD4OtNS7YEMepia93eae6c07WnECUXIFVQFXu1rwib4KMMg/640?wx_fmt=png" data-type="png" data-w="1422" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyDCAHnJPxmcD4OtNS7YEMepia93eae6c07WnECUXIFVQFXu1rwib4KMMg/640?wx_fmt=png"></section><section><span></span></section><section><br></section><section><span>这只我们常规的散点图绘制方法，可以用颜色区分不同的分组（Species）。那么，假如不仅想用不同颜色区分Species，还想在这基础上给每个分组使用渐变色板，映射多一维度的数据，要怎么操作呢？下面就来！</span></section><section><span><br></span></section><section data-tools="135编辑器" data-id="121691"><section><section><section><section><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyYcBAbWvNsdYgdVjULMIVJyyUWhDrOe0OfucicrRTLibl1yRQtolnvYqg/640?wx_fmt=png" data-type="png" data-w="38" data-width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyYcBAbWvNsdYgdVjULMIVJyyUWhDrOe0OfucicrRTLibl1yRQtolnvYqg/640?wx_fmt=png"></section></section><section><span><strong data-brushtype="text">1. 制作图层</strong></span></section><section><section><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyYcBAbWvNsdYgdVjULMIVJyyUWhDrOe0OfucicrRTLibl1yRQtolnvYqg/640?wx_fmt=png" data-type="png" data-w="38" data-width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyYcBAbWvNsdYgdVjULMIVJyyUWhDrOe0OfucicrRTLibl1yRQtolnvYqg/640?wx_fmt=png"></section></section></section></section></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#P1-P3：为不同Species制作Petal.Length层；</span><br mpa-from-tpl="t"><span>p1</span> &lt;- ggplot(df, aes(Petal.Length, Petal.Width)) +<br mpa-from-tpl="t"><span>geom_point</span>(aes(P1 = Petal.Length),<br mpa-from-tpl="t"><span>data</span> = ~ subset(., Species == <span>"setosa"</span>)) +<br mpa-from-tpl="t"><span>geom_point</span>(aes(P2 = Petal.Length),<br mpa-from-tpl="t"><span>data</span> = ~ subset(., Species == <span>"versicolor"</span>)) +<br mpa-from-tpl="t"><span>geom_point</span>(aes(P3 = Petal.Length),<br mpa-from-tpl="t"><span>data</span> = ~ subset(., Species == <span>"virginica"</span>)) +<br mpa-from-tpl="t"><span>theme_classic</span>()<br mpa-from-tpl="t"><span>p1</span><br mpa-from-tpl="t"><span>#此时出现的Warning可忽略</span></code></pre></section><p><br mpa-from-tpl="t"></p><section><span></span></section><section><img data-ratio="0.8277074542897328" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGy0qOTl6d4ic9elhicCscs3okccKj9P5h9Fw7Kt6KXsbPxmsGKv4dUliasA/640?wx_fmt=png" data-type="png" data-w="1422" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGy0qOTl6d4ic9elhicCscs3okccKj9P5h9Fw7Kt6KXsbPxmsGKv4dUliasA/640?wx_fmt=png"></section><section><br></section><section data-tools="135编辑器" data-id="121691"><section><section><section><section><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyYcBAbWvNsdYgdVjULMIVJyyUWhDrOe0OfucicrRTLibl1yRQtolnvYqg/640?wx_fmt=png" data-type="png" data-w="38" data-width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyYcBAbWvNsdYgdVjULMIVJyyUWhDrOe0OfucicrRTLibl1yRQtolnvYqg/640?wx_fmt=png"></section></section><section><span><strong data-brushtype="text">2. 多尺度颜色映射</strong></span></section><section><section><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyYcBAbWvNsdYgdVjULMIVJyyUWhDrOe0OfucicrRTLibl1yRQtolnvYqg/640?wx_fmt=png" data-type="png" data-w="38" data-width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyYcBAbWvNsdYgdVjULMIVJyyUWhDrOe0OfucicrRTLibl1yRQtolnvYqg/640?wx_fmt=png"></section></section></section></section></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#将不同渐变色图例映射到各个图层上；</span><br mpa-from-tpl="t"><span>p2</span> &lt;- p1 +<br mpa-from-tpl="t"><span>scale_colour_multi</span>(<br mpa-from-tpl="t"><span>aesthetics</span> = c(<span>"P1"</span>, <span>"P2"</span>, <span>"P3"</span>),<span> #图层</span><br mpa-from-tpl="t"><span>name</span> = list(<span>"Petal.Length:setosa"</span>, <span>#指定图层图例名</span><br mpa-from-tpl="t">"<span>Petal</span>.Length:versicolor<span>",<br mpa-from-tpl="t">"</span>Petal.Length:virginica<span>"),<br mpa-from-tpl="t">colours = list(<br mpa-from-tpl="t">brewer_pal(palette = "</span>YlGn<span>")(6), </span><span>#为每个图层指定颜色</span><span><br mpa-from-tpl="t">brewer_pal(palette = "</span>PuRd<span>")(6),<br mpa-from-tpl="t">brewer_pal(palette = "</span>Blues<span>")(6)<br mpa-from-tpl="t">),<br mpa-from-tpl="t">guide = guide_colorbar(barheight = unit(60, "</span>pt<span>"))<br mpa-from-tpl="t">)<br mpa-from-tpl="t">p2</span></code></pre></section><p><br mpa-from-tpl="t"></p><section><span></span></section><section><img data-ratio="0.7146326654523376" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyvtwB4S3y9Rqibgyju2r461Jjs18OWprxrkvRcKJH46LeaiboNdby26eQ/640?wx_fmt=png" data-type="png" data-w="1647" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyvtwB4S3y9Rqibgyju2r461Jjs18OWprxrkvRcKJH46LeaiboNdby26eQ/640?wx_fmt=png"></section><section><br mpa-from-tpl="t"></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#挑选其它列用于图层制作(根据需求自定即可)：</span><br mpa-from-tpl="t"><span>p3</span> &lt;- ggplot(df, aes(Petal.Length, Petal.Width)) +<br mpa-from-tpl="t"><span>geom_point</span>(aes(P1 = Sepal.Length),<br mpa-from-tpl="t"><span>data</span> = ~ subset(., Species == <span>"setosa"</span>)) +<br mpa-from-tpl="t"><span>geom_point</span>(aes(P2 = Sepal.Width),<br mpa-from-tpl="t"><span>data</span> = ~ subset(., Species == <span>"versicolor"</span>)) +<br mpa-from-tpl="t"><span>geom_point</span>(aes(P3 = Petal.Width),<br mpa-from-tpl="t"><span>data</span> = ~ subset(., Species == <span>"virginica"</span>)) +<br mpa-from-tpl="t"><span>theme_classic</span>()<br mpa-from-tpl="t"><span>#多尺度渐变色图例映射：</span><br mpa-from-tpl="t"><span>p4</span> &lt;- p3 +<br mpa-from-tpl="t"><span>scale_colour_multi</span>(<br mpa-from-tpl="t"><span>aesthetics</span> = c(<span>"P1"</span>, <span>"P2"</span>, <span>"P3"</span>), <span>#图层</span><br mpa-from-tpl="t"><span>name</span> = list(<span>"Sepal.Length:setosa"</span>, <span>#图例名称</span><br mpa-from-tpl="t">"<span>Sepal</span>.Width:versicolor<span>",<br mpa-from-tpl="t">"</span>Petal.Width:virginica<span>"),<br mpa-from-tpl="t">colours = list(<br mpa-from-tpl="t">brewer_pal(palette = "</span>YlGnBu<span>")(6), </span><span>#为每个图层指定颜色</span><span><br mpa-from-tpl="t">brewer_pal(palette = "</span>RdPu<span>")(6),<br mpa-from-tpl="t">brewer_pal(palette = "</span>YlOrRd<span>")(6)<br mpa-from-tpl="t">),<br mpa-from-tpl="t">guide = guide_colorbar(barheight = unit(60, "</span>pt<span>"))<br mpa-from-tpl="t">)<br mpa-from-tpl="t">p4</span></code></pre></section><p><br mpa-from-tpl="t"></p><section><span></span></section><section><img data-ratio="0.7146326654523376" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGy4n2TzDSblqV2016KvxkcffDybscR4SbI20hyvKiaJnyicDWpickB5MZWA/640?wx_fmt=png" data-type="png" data-w="1647" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGy4n2TzDSblqV2016KvxkcffDybscR4SbI20hyvKiaJnyicDWpickB5MZWA/640?wx_fmt=png"></section><section><br></section><section><span>现在，我们不仅可以用颜色区分不同的Species，渐变色还对应了我们所指定的不同列数据。一张图表能展示的内容更加丰富。</span></section><section><span><br></span></section><section><span>除了进行多尺度颜色图例的映射，我们还可以轻松制作嵌套分面！</span></section><section><span><br></span></section><section data-tools="135编辑器" data-id="121691"><section><section><section><section><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyYcBAbWvNsdYgdVjULMIVJyyUWhDrOe0OfucicrRTLibl1yRQtolnvYqg/640?wx_fmt=png" data-type="png" data-w="38" data-width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyYcBAbWvNsdYgdVjULMIVJyyUWhDrOe0OfucicrRTLibl1yRQtolnvYqg/640?wx_fmt=png"></section></section><section><span><strong data-brushtype="text">3. 嵌套分组面制作</strong></span></section><section><section><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyYcBAbWvNsdYgdVjULMIVJyyUWhDrOe0OfucicrRTLibl1yRQtolnvYqg/640?wx_fmt=png" data-type="png" data-w="38" data-width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyYcBAbWvNsdYgdVjULMIVJyyUWhDrOe0OfucicrRTLibl1yRQtolnvYqg/640?wx_fmt=png"></section></section></section></section></section><section><span></span></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#根据Leaves和Species两个分组列进行嵌套；</span><br mpa-from-tpl="t"><span>p5</span> &lt;- p4 +<br mpa-from-tpl="t"><span>facet_nested</span>(~ Leaves + Species, scales = <span>"free"</span>,<br mpa-from-tpl="t"><span>nest_line</span> = TRUE)<br mpa-from-tpl="t"><span>p5</span></code></pre></section><p><br mpa-from-tpl="t"></p><section><span></span></section><section><img data-ratio="0.7146326654523376" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyMZkaAicMsBkGwFkyQKiaEgbWGosgmc7qzSpGagMf7CSria02s6hibjJUHw/640?wx_fmt=png" data-type="png" data-w="1647" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kQQl21GNcl3WQW8wFd5DGyMZkaAicMsBkGwFkyQKiaEgbWGosgmc7qzSpGagMf7CSria02s6hibjJUHw/640?wx_fmt=png"></section><section><br></section><section><span>是不是so easy！当然，目前只牛刀小试了一番，更多的功能详见该R包作者的说明。</span></section><section><span><br></span></section><section><span>好啦，今天的分享就到这里！</span></section><section><span><br></span></section><section data-role="paragraph"><section><section hm_fix="368:481"><section><img data-ratio="0.8181818181818182" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kdRWPGPVk0Jicy3oS1NOGPJiaibgVcD3zKfzGGjtvINqicLCPZHmicLKs8bT3f5IiceLBYf6w8sNGqiblnA/640?wx_fmt=png" data-type="png" data-w="44" data-width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kdRWPGPVk0Jicy3oS1NOGPJiaibgVcD3zKfzGGjtvINqicLCPZHmicLKs8bT3f5IiceLBYf6w8sNGqiblnA/640?wx_fmt=png"></section><section><section data-brushtype="text"><strong><span>参考资料</span></strong></section><section data-width="100%"><br></section></section></section></section></section><p><span>https://teunbrand.github.io/ggh4x/index.html</span><br></p><section><span><br></span></section><section><span><strong><span>*未经许可，不得以任何方式复制或抄袭本篇文章之部分或全部内容。版权所有，侵权必究。</span></strong></span></section><section><span><br></span></section><section data-tools="135编辑器" data-id="94256"><section><section data-width="100%"><section><section data-width="50%"><section data-width="40%"><img data-ratio="0.4842592592592593" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lBPktXHkyIib5ytrlXEoVQgTJeg3ULyUollsqU0NhaLocfuAz6Sia0k9ia9EcjibKbSfT9xia5YsrO0rg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lBPktXHkyIib5ytrlXEoVQgTJeg3ULyUollsqU0NhaLocfuAz6Sia0k9ia9EcjibKbSfT9xia5YsrO0rg/640?wx_fmt=png"></section><section data-width="60%"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6lBPktXHkyIib5ytrlXEoVQgD7CvCQjABJSibf1tMltMN02Yw17iaibIBOnHVicyj8MPRIjFXlzckYmktw/640?wx_fmt=jpeg" data-type="jpeg" data-w="860" data-width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6lBPktXHkyIib5ytrlXEoVQgD7CvCQjABJSibf1tMltMN02Yw17iaibIBOnHVicyj8MPRIjFXlzckYmktw/640?wx_fmt=jpeg"></section></section><section><section data-brushtype="text"><p><span><strong>SCIPainter</strong></span></p><p><span><strong>基迪奥旗下绘图公众号</strong></span></p></section></section></section></section></section></section><section><span></span></section><section><br></section><section><span></span></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/KYlhmRHlj1ysfbXvlBRn-Q",target="_blank" rel="noopener noreferrer">原文链接</a>
