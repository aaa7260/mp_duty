---
title: "R 语言 | ggforce 给散点图按分类添加外边界（轮廓）"
date: 2022-10-05T12:08:51Z
draft: ["false"]
tags: [
  "fetched",
  "生物慕课"
]
categories: ["Acdemic"]
---
R 语言 | ggforce 给散点图按分类添加外边界（轮廓） by 生物慕课
------
<div><p>给散点图按聚类添加边框，目前还没看到完美解决办法。如果想获得理想的轮廓效果，可能还要依靠手工添加，而无法编程实现。</p><p><br></p><p>一个编程解决方法是使用 ggforce 包的 <span>geom_mark_xxx 系列函数，该函数目前有4个实现：</span></p><p><strong>Annotation</strong></p><p>Annotation is important for storytelling, and ggforce provides a family of geoms that makes it easy to draw attention to, and describe, features of the plot. <strong>They all work in the same way</strong>, but differ in the way they enclose the area you want to draw attention to.</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span># https://ggforce.data-imaginist.com/reference/index.html</span></span></code><code><span><br></span></code><code><span><span>#Annotate areas with rectangles</span></span></code><code><span><span>geom_mark_rect</span>()  </span></code><code><span><br></span></code><code><span><span>#Annotate areas with circles</span></span></code><code><span><span>geom_mark_circle</span>() </span></code><code><span><br></span></code><code><span><span>#Annotate areas with ellipses</span></span></code><code><span><span>geom_mark_ellipse</span>() </span></code><code><span><br></span></code><code><span><span>#Annotate areas with hulls</span></span></code><code><span><span>geom_mark_hull</span>() </span></code></pre></section><p><br></p><p>本文尝试使用最后一个函数  <span>geom_mark_hull</span>，画不规则形状的散点图的边界。<br></p><p><br></p><p>效果如下：<br></p><p><img data-cropselx1="32" data-cropselx2="546" data-cropsely1="0" data-cropsely2="470" data-ratio="0.8127413127413128" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaF1T4nQ8WAnFks7rTicjC5YKk6aXe9QWbynribpzQibMwZPRonD9u3IWaX8br0eHruUVduwI0F2cibP4IKloEiaicSFw/640?wx_fmt=png" data-type="png" data-w="518" src="https://mmbiz.qpic.cn/mmbiz_png/iaF1T4nQ8WAnFks7rTicjC5YKk6aXe9QWbynribpzQibMwZPRonD9u3IWaX8br0eHruUVduwI0F2cibP4IKloEiaicSFw/640?wx_fmt=png"></p><p><br></p><p>代码如下：</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>library(ggforce)</span></code><code><span>library(ggplot2)</span></code><code><span>g1=FetchData(pbmc, vars=c(<span>"UMAP_1"</span>, <span>"UMAP_2"</span>, <span>"seurat_clusters"</span>)) |&gt;</span></code><code><span>  ggplot( aes(UMAP_1, UMAP_2))+</span></code><code><span>  geom_point(mapping=aes(color=seurat_clusters), size=0.2)+</span></code><code><span>  theme_classic(base_size = 12)+</span></code><code><span>  guides( color = guide_legend(ncol=2, <span>override</span>.aes = list(size=5)))+ <span>#两列，放大图例</span></span></code><code><span>  geom_mark_hull(aes(fill=seurat_clusters), </span></code><code><span>                 show.legend = F,</span></code><code><span>                 alpha=0.2,</span></code><code><span>                 cex=0.5,</span></code><code><span>                 color=<span>"#666666"</span>,  <span>#曲线边界</span></span></code><code><span>                 expand = unit(2, <span>"mm"</span>),  <span>#边界与散点的距离</span></span></code><code><span>                 radius = unit(4.5, <span>"mm"</span>),  <span>#越大转角的曲线越光滑</span></span></code><code><span>                 linetype=2);g1  <span>#虚线边框</span></span></code><code><span><br></span></code><code><span>pdf(file = <span>"dustbin/scatter_with_hull.pdf"</span>, width=5.5, height=4.5)</span></code><code><span>g1</span></code><code><span>dev.off()</span></code></pre></section><p><br></p><ul><li><p>参数 radius 越大边界越平滑。</p></li><li><p>边界的效果与整个图的大小密切相关，图缩小时，有些cluster可能不绘制边界。</p></li><li><p>图太小边界难看，图太大可能不符合最终图片要求。</p></li></ul><p><br></p><p>结论：先尝试这个包，能用就用；不能用就输出pdf，导入到 illustrator 手工添加边界。</p><p><span>  -- End --</span><br></p><p><img data-galleryid="" data-ratio="0.3649122807017544" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaF1T4nQ8WAnzYh5gWEof7SgiaHZ5kBxDbnStFlru7zIJJQSC4pgLicmlqFAtEh8eO9tcHB7I09icEU3sibub3BB19Q/640?wx_fmt=png" data-type="png" data-w="1710" src="https://mmbiz.qpic.cn/mmbiz_png/iaF1T4nQ8WAnzYh5gWEof7SgiaHZ5kBxDbnStFlru7zIJJQSC4pgLicmlqFAtEh8eO9tcHB7I09icEU3sibub3BB19Q/640?wx_fmt=png"></p><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/dLCkf-iCnB2D13eDAvWNAA",target="_blank" rel="noopener noreferrer">原文链接</a>
