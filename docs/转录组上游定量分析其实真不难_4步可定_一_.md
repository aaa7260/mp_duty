---
title: "转录组上游定量分析其实真不难，4步可定（一）"
date: 2022-10-26T04:38:06Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
转录组上游定量分析其实真不难，4步可定（一） by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>缘起</span><span></span></h2><p data-tool="mdnice编辑器">这段时间我们做了一系列转录组下游推文分享，忽略了<strong><span>转录组上游分享</span></strong>。然而，有些小伙伴们一谈到上游，一谈到Linux，一谈到要跑转录组的流程，还要注意区分单端与双端，内心就会有些小畏惧。这一次，我们就把分析拉到上游，按照曾老师的<strong>「</strong><strong><span>物种</span></strong><span><strong>（人与鼠）与单双端四种组合</strong></span><strong>」</strong>方式，进行四种上游分析的分享，帮助小伙伴们简化这个流程，并打破这份畏惧。<strong>「今天，我们先分享人单端转录组测序的上游分析流程吧。」</strong></p><p data-tool="mdnice编辑器">若您觉得有些<strong>「忙」</strong>或者<strong>「没有服务器」</strong>，还是有这个需求的话，那可以找生信技能树哈，<strong><span>忙的话</span></strong>具体可以看看推文<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247517299&amp;idx=2&amp;sn=f808fb599dea6aaedf1ba75369f727ff&amp;scene=21#wechat_redirect" data-linktype="2">普通转录组上游定量分析服务（仅需800每个项目）</a>；<strong><span>需要服务器的话</span></strong>，那就点击这个<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247518150&amp;idx=1&amp;sn=9e7764a48a43b4fe810bb7458c409fa4&amp;scene=21#wechat_redirect" data-linktype="2">96线程512G内存500G硬盘服务器一年仅需800</a>。</p><h2 data-tool="mdnice编辑器"><span></span><span>流程归纳（四步曲）</span><span></span></h2><p data-tool="mdnice编辑器">1.数据下载（自身数据的话，此步可忽略）</p><p data-tool="mdnice编辑器">2.质控过滤（质控前用fastqc与multiqc初看数据效果、trimmgalore进行质控过滤与fastqc、multiqc查看质控后的效果）</p><p data-tool="mdnice编辑器">3.Hisat2比对</p><p data-tool="mdnice编辑器">4.featureCounts定量</p><h2 data-tool="mdnice编辑器"><span></span><span>探究</span><span></span></h2><p data-tool="mdnice编辑器">今天，我们使用标题为  Novel azetidine-based Stat3 inhibitors induce misfolded protein response, endoplasmic reticulum stress and mitophagy, and inhibit breast tumor growth in vivo  的GSE180123数据集进行探究，数据集的链接如下  <span>https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE180123</span> ，感兴趣的小伙伴可以看看。进入页面，我们可以看到该数据集<strong>「种属为人」</strong>，使用的是<strong>「单端测序」</strong>，有<strong>「六个样本」</strong>，那我们就正式分析一下这个<strong>「人的单端转录组测序」</strong>吧。<img data-ratio="0.25970149253731345" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibeSe5duibLSnzfpFauqY1S4Piah5icCqlT6PrCyiaaJEKHfZSIfFVozQT9Gc1LGaJehEfNiauZaxXnfrQ/640?wx_fmt=png" data-type="png" data-w="670" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibeSe5duibLSnzfpFauqY1S4Piah5icCqlT6PrCyiaaJEKHfZSIfFVozQT9Gc1LGaJehEfNiauZaxXnfrQ/640?wx_fmt=png"><img data-ratio="0.2581648522550544" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibeSe5duibLSnzfpFauqY1S4yQfLIQW4ZhCuywrxtumnvv4V4l6Nhibicgp1QIKJM8uFX3xHLarMKKdg/640?wx_fmt=png" data-type="png" data-w="643" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibeSe5duibLSnzfpFauqY1S4yQfLIQW4ZhCuywrxtumnvv4V4l6Nhibicgp1QIKJM8uFX3xHLarMKKdg/640?wx_fmt=png"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>1.数据下载</span><span></span></h3><h4 data-tool="mdnice编辑器"><span></span><span><span></span>01 下载数据下载的网页链接文件（SRA_Acc_list）</span><span></span></h4><p data-tool="mdnice编辑器">由于快速下载的Aspera最近不能用了，我们打算利用prefetch下载SRA数据，进行转录组数据分析。在GSE数据集对应网页如 这个https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE180123，点击SRA对应的链接，进一步点击Send to对应的Run Selector，最终下载跳转页面的Accession List；<strong>「获得下载的SRA_Acc_list后，我们就能在服务器上用prefech命令进行数据下载」</strong>。<img data-ratio="0.25245441795231416" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibeSe5duibLSnzfpFauqY1S4LkhsvR7YFibWK7Jsb8EencsNEKoSqcqlzeLDoDmZpxeeOvbOw08cia8Q/640?wx_fmt=png" data-type="png" data-w="713" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibeSe5duibLSnzfpFauqY1S4LkhsvR7YFibWK7Jsb8EencsNEKoSqcqlzeLDoDmZpxeeOvbOw08cia8Q/640?wx_fmt=png"><img data-ratio="0.4036144578313253" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibeSe5duibLSnzfpFauqY1S4OSjPS7uibH31zTsQyuyppTmEnVKCNYFyicSYiaDNoajcKgGAibicYIPjR4A/640?wx_fmt=png" data-type="png" data-w="830" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibeSe5duibLSnzfpFauqY1S4OSjPS7uibH31zTsQyuyppTmEnVKCNYFyicSYiaDNoajcKgGAibicYIPjR4A/640?wx_fmt=png"><img data-ratio="0.2076271186440678" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibeSe5duibLSnzfpFauqY1S4r7dXRnJZ1LqLNVQ2mOUZSTe0WJaNqUJk3tCHn6fU5u4NtwDkiaRugLw/640?wx_fmt=png" data-type="png" data-w="944" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibeSe5duibLSnzfpFauqY1S4r7dXRnJZ1LqLNVQ2mOUZSTe0WJaNqUJk3tCHn6fU5u4NtwDkiaRugLw/640?wx_fmt=png"><img data-ratio="0.0549618320610687" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibeSe5duibLSnzfpFauqY1S4dynxqlzSpZfh3ka9mo3qK9Yc5B51fcwSrEBFweFKbic5dIAUqXJicAvg/640?wx_fmt=png" data-type="png" data-w="655" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibeSe5duibLSnzfpFauqY1S4dynxqlzSpZfh3ka9mo3qK9Yc5B51fcwSrEBFweFKbic5dIAUqXJicAvg/640?wx_fmt=png">SRA_Acc_list的样子：</p><pre data-tool="mdnice编辑器"><span></span><code>SRR15142000<br>SRR15142001<br>SRR15142002<br>SRR15142003<br>SRR15142004<br>SRR15142005<br></code></pre><h4 data-tool="mdnice编辑器"><span></span><span><span></span>02 服务器上，通过网页链接文件SRA_Acc_list下载数据</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span> 1.上传下载的SRR_Ac_List.txt到服务器上</span><br><span>#</span><span> 2.激活包含prefech命令的SRAtoolkits软件的小环境</span><br>conda activate download<br><span>#</span><span> 3.开始数据下载（此命令为批量全部下载，样本量大时，需谨慎服务器资源）</span><br>cat SRR_Acc_List.txt |while read id;do (prefetch -X 100G $id &amp;);done<br></code></pre><p data-tool="mdnice编辑器">由于prefeth下载的SRA数据本身自带md5验证，所以无需md5验证。但是我们分析一般是用fastq数据进行转录组正式分析，所以需要将prefech下载的SRA文件转换成fastq结尾的fastq文件。此外，由于fastq.gz文件更加省内存，我们一般会将fastq文件进一步压缩成fastq.gz文件。</p><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span> 1.批量将SRA文件转换fastq文件</span><br>ls SRR* | while read id;do ( nohup fasterq-dump -O ./ --split-files -e 2 ./$id --include-technical &amp; );done<br><span>#</span><span> 2.批量将fastq文件压缩成fastq.gz文件</span><br>ls *fastq |while read id;do (nohup gzip $id &amp;);done<br></code></pre><p data-tool="mdnice编辑器">下载好的sra文件：</p><pre data-tool="mdnice编辑器"><span></span><code><span>$</span><span> ls -lh  SRR*|cut -d<span>" "</span> -f 5-</span><br>SRR15142000:<br>514M 10月 25 11:05 SRR15142000.sra<br>SRR15142001:<br>725M 10月 25 11:06 SRR15142001.sra<br>SRR15142002:<br>585M 10月 25 11:05 SRR15142002.sra<br>SRR15142003:<br>739M 10月 25 11:06 SRR15142003.sra<br>SRR15142004:<br>658M 10月 25 11:06 SRR15142004.sra<br>SRR15142005:<br>593M 10月 25 11:05 SRR15142005.sra<br></code></pre><p data-tool="mdnice编辑器">压缩完成的fastq.gz文件：</p><pre data-tool="mdnice编辑器"><span></span><code><span>$</span><span> ls -lh *fastq.gz |cut -d<span>" "</span> -f 5-</span><br>923M 10月 25 11:10 SRR15142000.fastq.gz<br>1.3G 10月 25 11:11 SRR15142001.fastq.gz<br>1.1G 10月 25 11:10 SRR15142002.fastq.gz<br>1.3G 10月 25 11:11 SRR15142003.fastq.gz<br>1.2G 10月 25 11:10 SRR15142004.fastq.gz<br>1.1G 10月 25 11:10 SRR15142005.fastq.gz<br></code></pre><p data-tool="mdnice编辑器">获得fastq.gz文件，接着我们就可以进行转录组分析的2.质控过滤、3.比对以及4.定量了。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2.质控过滤</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span> 一：质控前的初看测序数据质量：fastqc与multiqc</span><br><span>#</span><span> 1.激活专门用于RNAseq数据处理的小环境rna,进行fastqc与multiqc</span><br>conda activate rna #激活转录组测序数据处理的小环境<br><span>#</span><span> 2.先进行fastqc</span><br>nohup fastqc -t 6 -o ./ SRR*.fastq.gz &gt;qc.log &amp;  <br><span>#</span><span> 3.对fastqc后的zip数据进行multiqc</span><br>nohup multiqc ./*.zip -o ./ &gt; ./multiqc.log &amp;<br><span><br>#</span><span> 二:trimmgalore质控</span><br>ls *gz |while read id;do (nohup trim_galore  -q 25 --phred33 --length 36 --stringency 3 -o ./  $id &amp; );done<br><span><br>#</span><span>三:质控后数据也需要用fastqc与multiqc看看质控效果</span><span><br>#</span><span> 01批量fastqc</span><br>nohup fastqc -t 12 -o ./ SRR*_trimmed.fq.gz &gt;qc_trimmed.log &amp; <br><span>#</span><span> 02开始multiqc</span><br>nohup multiqc *.zip -o ./ &gt; ./multiqc_t.log &amp;<br></code></pre><p data-tool="mdnice编辑器">得到trimmglare质控过滤的文件：</p><pre data-tool="mdnice编辑器"><span></span><code><span>$</span><span> ls -lh  *_trimmed.fq.gz|cut -d<span>" "</span> -f 5-</span><br> 891M 10月 25 13:47 SRR15142000_trimmed.fq.gz<br> 1.3G 10月 25 13:55 SRR15142001_trimmed.fq.gz<br>1017M 10月 25 14:01 SRR15142002_trimmed.fq.gz<br> 1.3G 10月 25 14:09 SRR15142003_trimmed.fq.gz<br> 1.2G 10月 25 14:16 SRR15142004_trimmed.fq.gz<br> 1.1G 10月 25 14:22 SRR15142005_trimmed.fq.gz<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>3.比对</span><span></span></h3><p data-tool="mdnice编辑器">比对的话需要自身构建索引，我们已经搭建好了索引，直接进行比对就好。若小伙伴们需要自身搭建索引，请参考州更老师的<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247484720&amp;idx=1&amp;sn=4bb3e3d2182ffe937d58dc135b4bbd24&amp;scene=21#wechat_redirect" data-linktype="2">从零开始学转录组（5）序列比对</a></p><pre data-tool="mdnice编辑器"><span></span><code>ls *_trimmed.fq.gz|while read id;do <br> gtf='$HOME/database/GRCh38.106/Homo_sapiens.GRCh38.106.chr.gtf'<br> hisat_index="$HOME/database/GRCh38.106/Hisat2Index/GRCh38.106"<br> nohup sh -c " hisat2 -p 2 -x ${hisat_index} -U $id 2&gt;${id%%_*}.log  | samtools sort -@ 2 -o ${id%%_*}.bam  " &amp; <br>done<br></code></pre><p data-tool="mdnice编辑器">得到比对后的文件：</p><pre data-tool="mdnice编辑器"><span></span><code><span>$</span><span> ls -lh *bam |cut -d<span>" "</span> -f 5-</span><br>557M 10月 25 15:27 SRR15142000.Hisat_aln.sorted.bam<br>736M 10月 25 15:30 SRR15142001.Hisat_aln.sorted.bam<br>640M 10月 25 15:29 SRR15142002.Hisat_aln.sorted.bam<br>764M 10月 25 15:32 SRR15142003.Hisat_aln.sorted.bam<br>697M 10月 25 15:31 SRR15142004.Hisat_aln.sorted.bam<br>645M 10月 25 15:28 SRR15142005.Hisat_aln.sorted.bam<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>4.定量</span><span></span></h3><p data-tool="mdnice编辑器">一定要注意配套的基因组fa文件，以及配套的版本正确的gtf文件即可，一步定量,就能获得咱们心心念念的转录组定量上游的最终文件<span>Ensenmble count矩阵了。</span></p><pre data-tool="mdnice编辑器"><span></span><code>gtf=$HOME/database/GRCh38.106/Homo_sapiens.GRCh38.106.chr.gtf<br>nohup featureCounts -T 5 -p -t exon -g gene_id  -a $gtf \<br>-o  all.id.txt  *bam  1&gt;counts.id.log 2&gt;&amp;1 &amp;<br></code></pre><p data-tool="mdnice编辑器"><span>获得了Ensenmble count矩阵后，我们就能进行下游分析了。</span>从文中可以看出，其实转录组上游这几步并不难，感兴趣的或者有需求的小伙伴可以尝试以下额。<strong>「但要注意，咱们这篇推文针对的是种属为人，单端测序的转录组数据哈」</strong>。</p><p data-tool="mdnice编辑器"><span><strong> </strong></span><strong><span>诸君若想看人双端上游处理的话，且待下回推解</span></strong></p><p data-tool="mdnice编辑器"><strong><span></span></strong></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Z5YNRkJ6tlY_tAeuUfL8SA",target="_blank" rel="noopener noreferrer">原文链接</a>
