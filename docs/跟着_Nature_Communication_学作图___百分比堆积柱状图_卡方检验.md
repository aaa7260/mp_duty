---
title: "跟着 Nature Communication 学作图 | 百分比堆积柱状图+卡方检验"
date: 2022-08-30T03:22:55Z
draft: ["false"]
tags: [
  "fetched",
  "木舟笔记"
]
categories: ["Acdemic"]
---
跟着 Nature Communication 学作图 | 百分比堆积柱状图+卡方检验 by 木舟笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><figure data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-type="jpeg" data-w="900" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/aMicyicM8Ll19c737aCufefibs3AvicicIPjwELZk1fvMSK3wEbW29a8QrvDKbrJicOPqgGpuf9C13iao4PibsM2QHolUQ/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/mmbiz_jpg/aMicyicM8Ll19c737aCufefibs3AvicicIPjwELZk1fvMSK3wEbW29a8QrvDKbrJicOPqgGpuf9C13iao4PibsM2QHolUQ/640?wx_fmt=jpeg"><figcaption><span></span>stack_barplot</figcaption></figure><p data-tool="mdnice编辑器"><span>今天我们复现一幅2021年6月发表在<code>nature communications</code>上的</span><span><span>百分比堆积柱状图</span></span><span>。</span></p><blockquote data-tool="mdnice编辑器"><span>❝</span><p><em><strong>「Title：」</strong></em>Molecular determinants of response to PD-L1 blockade across tumor types</p><p><em><strong>「DOI：」</strong></em>https://doi.org/10.1038/s41467-021-24112-w</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">之前复现过的<strong>「堆积柱状图」</strong>：</p><ol data-tool="mdnice编辑器"><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzIxMDExNDE0OQ==&amp;mid=2247486935&amp;idx=1&amp;sn=63d7b2bd3e52b8f6ecb113a3b484e9b3&amp;chksm=9768cedda01f47cb16da94e9450d2b6df3e70b2e6144f19747240da0ffff3284b87e1f374555&amp;scene=21#wechat_redirect" data-linktype="2">跟着Nat Commun学作图 | 3.物种丰度堆积柱状图</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzIxMDExNDE0OQ==&amp;mid=2247488533&amp;idx=1&amp;sn=09c8e3ca5f0c6c3c0576302981f4e3ce&amp;chksm=9768d71fa01f5e095c19c88c7c799613b81b09169a57ac6c8296060f2efacd33dac3fceef1ba&amp;scene=21#wechat_redirect" data-linktype="2">R绘图 | 圆角堆叠柱状图(ggchicklet )</a></section></li></ol><section><mp-common-profile data-pluginname="mpprofile" data-id="MzIxMDExNDE0OQ==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ib0O4bhukQJ50YEnDwcMTIvaj1jSnOACbZmy7XsUAmicqyoF1WkNzzwian0IUUbGlNmaniaMDXLsa6pA/0?wx_fmt=png" data-nickname="木舟笔记" data-alias="MZBJNOTE" data-signature="分享学习干货，生信教程，机器学习基础。" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h2 data-tool="mdnice编辑器"><span></span><span>本期图片</span><span></span></h2><figure data-tool="mdnice编辑器"><img data-ratio="0.7584014532243415" data-type="png" data-w="1101" data-src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll19c737aCufefibs3AvicicIPjwoNWasRkRtibxeT6giaR5ZFOEcTTn1KPibfrRFqxA6ZLmxqbrxd1CXqaKg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll19c737aCufefibs3AvicicIPjwoNWasRkRtibxeT6giaR5ZFOEcTTn1KPibfrRFqxA6ZLmxqbrxd1CXqaKg/640?wx_fmt=png"><figcaption><span></span>NC_stack_barplot</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>结果展示</span><span></span></h2><figure data-tool="mdnice编辑器"><img data-ratio="0.7521150592216582" data-type="png" data-w="1182" data-src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll19c737aCufefibs3AvicicIPjwHyMQQibAGOZOaR4y7Urt6J7TVX3ROWoATic0IfuM7k1RYHrcgmVibEDVg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll19c737aCufefibs3AvicicIPjwHyMQQibAGOZOaR4y7Urt6J7TVX3ROWoATic0IfuM7k1RYHrcgmVibEDVg/640?wx_fmt=png"><figcaption><span></span>复现结果</figcaption></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>以上是在R中复现的图片，剩下的细节可以在<code>AI</code>中修改，本文不再赘述。</p><span>❞</span></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>示例数据和代码领取</span><span></span></h2><p data-tool="mdnice编辑器"><code>点赞</code>、<code>在看</code> 本文，分享至朋友圈<code>集赞20个</code>并<code>保留30分钟</code>，截图发至微信<code>mzbj0002</code>领取。</p><p data-tool="mdnice编辑器"><strong>「木舟笔记2022年度VIP可免费领取」</strong>。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>木舟笔记2022年度VIP企划</span><span></span></h3><p data-tool="mdnice编辑器"><strong>「权益：」</strong></p><ol data-tool="mdnice编辑器"><li><section><p><strong>「2022」</strong>年度木舟笔记所有推文示例数据及代码(<strong>「在VIP群里实时更新」</strong>)。</p><figure><img data-ratio="0.4869942196531792" data-type="png" data-w="1384" data-src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll19c737aCufefibs3AvicicIPjwUgQkUwOADVoB86jtoR96V4O4fb7l4OL4ymETtBNOia99SprkYSuRHicA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll19c737aCufefibs3AvicicIPjwUgQkUwOADVoB86jtoR96V4O4fb7l4OL4ymETtBNOia99SprkYSuRHicA/640?wx_fmt=png"><figcaption><span></span>data+code</figcaption></figure></section></li><li><section><p>木舟笔记<strong>「科研交流群」</strong>。</p></section></li><li><section><p><strong>「半价」</strong>购买<code>跟着Cell学作图系列合集</code><a href="http://mp.weixin.qq.com/s?__biz=MzIxMDExNDE0OQ==&amp;mid=2247486072&amp;idx=1&amp;sn=d579a62420f722285eac318c4114d199&amp;chksm=9768c972a01f4064a84f30fd48b8c2107af543c31b6adb5f36234b1377ac42c8af54f45efda9&amp;scene=21#wechat_redirect" data-linktype="2">(免费教程+代码领取)|跟着Cell学作图系列合集</a>。</p></section></li></ol><p data-tool="mdnice编辑器"><strong>「收费：」</strong></p><p data-tool="mdnice编辑器">	<strong>「99￥/人」</strong>。可添加微信：<code>mzbj0002</code> 转账，或直接在文末打赏。</p><span><span><img data-ratio="1.1384615384615384" data-type="png" data-w="520" data-src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll19c737aCufefibs3AvicicIPjwiacdhIMqTWaPWT3ZD8yIpOmDHMm5YbbEG0ollqqDdsRxzkgUaiaB4q6Q/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll19c737aCufefibs3AvicicIPjwiacdhIMqTWaPWT3ZD8yIpOmDHMm5YbbEG0ollqqDdsRxzkgUaiaB4q6Q/640?wx_fmt=png"></span></span><h2 data-tool="mdnice编辑器"><span></span><span>绘制</span><span></span></h2><pre data-tool="mdnice编辑器"><span></span><code><span># 建立数据</span><br>mydata &lt;- data.frame(id = <span>1</span>:<span>98</span>,<br>                     ORR = c(rep(<span>"SD"</span>, <span>54</span>), rep(<span>"CR"</span>, <span>44</span>)),<br>                     PD_1 = c(rep(<span>"TC0"</span>, <span>8</span>), rep(<span>"TC1"</span>, <span>19</span>), rep(<span>"TC2"</span>, <span>27</span>),<br>                                  rep(<span>"TC0"</span>, <span>6</span>), rep(<span>"TC1"</span>, <span>13</span>), rep(<span>"TC2"</span>, <span>25</span>)))<br><br>head(mydata) <span># 查看前6行</span><br><br><span># 卡方检验</span><br><span>## 将数据整理为四格表</span><br>ka&lt;-xtabs(~mydata$PD_1+mydata$ORR,data=mydata)<br>ka<br><span># 卡方检验</span><br>chisq.test(ka)<br><span># 百分比柱状图</span><br><span>library</span>(scales)<br><span>library</span>(ggplot2)<br><span>library</span>(RColorBrewer)<br>p &lt;- ggplot(mydata, aes(x = ORR, fill = PD_1)) +<br>  geom_bar(width = <span>0.9</span>, position = <span>"fill"</span>) + <span># 百分比柱状图</span><br>  scale_fill_brewer(palette = <span>"Greens"</span>)  +<br>  scale_y_continuous(labels = percent) +<br>  labs(title = <span>"mUC"</span>,<br>       y = <span>"Patients Percentage"</span>)+<br>  theme(panel.grid.major=element_blank(),<br>        panel.grid.minor=element_blank(),<br>        panel.background = element_blank(),<br>        axis.text.x = element_blank(),<br>        axis.ticks.x = element_blank(),<br>        axis.title.x = element_blank(),<br>        plot.title = element_text(hjust = <span>0.5</span>, face=<span>"bold"</span>))<br>p<br><br>p1 &lt;- p + coord_cartesian(clip = <span>'off'</span>, ylim = c(<span>0</span>,<span>1</span>))+ <br>  theme(plot.margin = margin(<span>0.5</span>,<span>0.5</span>,<span>1.2</span>,<span>0.5</span>,<span>'cm'</span>))+ <span>#自定义图片上左下右的边框宽度</span><br>  annotate( <span>"text"</span>,<br>           cex=<span>5</span>,<br>           x=<span>1.5</span>, y=-<span>0.15</span>, <span># 根据自己的数据调节p value的位置</span><br>           label=<span>'p = 0.760'</span>, <span># 添加P值</span><br>           color=<span>"black"</span>)+<br>  annotate(<span>"rect"</span>, xmin = <span>0.55</span>, xmax = <span>1.45</span>, ymin = -<span>0.1</span>, ymax = -<span>0.02</span>, <br>           fill = <span>"#40a1cf"</span>)+<br>  annotate(<span>"rect"</span>, xmin = <span>1.55</span>, xmax = <span>2.45</span>, ymin = -<span>0.1</span>, ymax = -<span>0.02</span>, <br>           fill = <span>"#dd816d"</span>)<br>p1<br><span>## 同理话另外两个 且不显示y轴</span><br>p2 &lt;- p1+theme(<br>  axis.text.y = element_blank(),<br>  axis.ticks.y = element_blank(),<br>  axis.title.y = element_blank()<br>)<br>p2<br><br><span>## 拼图</span><br><span>#install.packages("patchwork")</span><br><span>library</span>(patchwork)<br>p1+ p2+ p2 + plot_layout(guides = <span>'collect'</span>)<br>ggsave(<span>'stack_barplot.pdf'</span>,width = <span>8</span>,height = <span>6</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7521150592216582" data-type="png" data-w="1182" data-src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll19c737aCufefibs3AvicicIPjwHyMQQibAGOZOaR4y7Urt6J7TVX3ROWoATic0IfuM7k1RYHrcgmVibEDVg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll19c737aCufefibs3AvicicIPjwHyMQQibAGOZOaR4y7Urt6J7TVX3ROWoATic0IfuM7k1RYHrcgmVibEDVg/640?wx_fmt=png"><figcaption><span></span>复现结果</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>往期内容</span><span></span></h2><ol data-tool="mdnice编辑器"><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzIxMDExNDE0OQ==&amp;mid=2247490045&amp;idx=1&amp;sn=2c4257bc2e41d8366b242efaf143d1c7&amp;chksm=9768daf7a01f53e1e20723e850727fe2d886631fb58c53b03c8cde7c48bb846228a4f6326d34&amp;scene=21#wechat_redirect" data-linktype="2">即将满员！CNS图表复现|生信分析|R绘图 资源分享&amp;讨论群！(内附推文合集)</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzIxMDExNDE0OQ==&amp;mid=2247489957&amp;idx=1&amp;sn=da6369670c3271aa7c4df0e65e238a93&amp;chksm=9768daafa01f53b9c72abeb4f41fdffa5dece23a50ae844e0b52e82682ec37cd50f510581ead&amp;scene=21#wechat_redirect" data-linktype="2">跟着 Nature Communication 学作图 | 热图+格子注释(通路富集相关)</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzIxMDExNDE0OQ==&amp;mid=2247490085&amp;idx=1&amp;sn=a1414bb25eb7f0ff4d728d66ef563a67&amp;chksm=9768d92fa01f5039cd049417432780447f4f33d461b1e3b1cf67fabc2c09eb604e9c61d08f8c&amp;scene=21#wechat_redirect" data-linktype="2">R绘图 | 时间线热图</a></section></li></ol><hr data-tool="mdnice编辑器"><figure data-tool="mdnice编辑器"><img data-ratio="0.6676163342830009" data-type="png" data-w="1053" data-src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll19c737aCufefibs3AvicicIPjwfibvkuicOvjOJNJZ4nCNia0z7rdgJ5PXuDyBKndaVicX8iaFCSXg0h7qOnA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll19c737aCufefibs3AvicicIPjwfibvkuicOvjOJNJZ4nCNia0z7rdgJ5PXuDyBKndaVicX8iaFCSXg0h7qOnA/640?wx_fmt=png"><figcaption><span></span>木舟笔记矩阵</figcaption></figure></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/2CMeO6h_RfOB0CH2K9vMAw",target="_blank" rel="noopener noreferrer">原文链接</a>
