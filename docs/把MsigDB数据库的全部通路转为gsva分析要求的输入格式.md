---
title: "把MsigDB数据库的全部通路转为gsva分析要求的输入格式"
date: 2022-12-14T06:37:46Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
把MsigDB数据库的全部通路转为gsva分析要求的输入格式 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>首先了解一下超几何分布检验和GSEA富集分析的区别：</p></blockquote><ul data-tool="mdnice编辑器"><li><section><p>通常拿到了上下调差异基因列表，然后说的GO/KEGG数据库注释，指的是<strong>超几何分布检验</strong>。</p></section></li><li><section><p>但是如果我们并不是在差异分析结果里面的自定义阈值，定上下调差异基因列表，而是根据某个指标（比如logFC）把全部的基因排序，再去进行GO/KEGG数据库注释，一般来说就是<strong>GSEA分析</strong>啦。</p></section></li></ul><p data-tool="mdnice编辑器">无论是超几何分布检验和GSEA富集分析，都离不开生物学功能数据库，数据库不仅仅是GO/KEGG哦，目前最齐全的应该是属于  MSigDB（Molecular Signatures Database）数据库中定义了已知的基因集合：http://software.broadinstitute.org/gsea/msigdb 包括H和C1-C7八个系列（Collection），每个系列分别是：</p><ul data-tool="mdnice编辑器"><li><section>H: hallmark gene sets （癌症）特征基因集合，共50组，最常用；</section></li><li><section>C1: positional gene sets 位置基因集合，根据染色体位置，共326个，用的很少；</section></li><li><section>C2: curated gene sets：（专家）校验基因集合，基于通路、文献等：</section></li><li><section>C3: motif gene sets：模式基因集合，主要包括microRNA和转录因子靶基因两部分</section></li><li><section>C4: computational gene sets：计算基因集合，通过挖掘癌症相关芯片数据定义的基因集合；</section></li><li><section>C5: GO gene sets：Gene Ontology 基因本体论，包括BP（生物学过程biological process，细胞原件cellular component和分子功能molecular function三部分）</section></li><li><section>C6: oncogenic signatures：癌症特征基因集合，大部分来源于NCBI GEO  发表芯片数据</section></li><li><section>C7: immunologic signatures: 免疫相关基因集合。</section></li></ul><p data-tool="mdnice编辑器">可以看到，GO/KEGG是最出名的，但不是唯一的，起码和kegg数据库并列的就有Reactome数据库哈。</p><h3 data-tool="mdnice编辑器"><span></span>也可以自定义基因集<span></span></h3><p data-tool="mdnice编辑器">而且有各种各样的参考文献基因列表，比如转录因子列表，关于转录因子列表我在生信菜鸟团公众号看到了有一个介绍：<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247506156&amp;idx=1&amp;sn=e7357f1ce51d51ea3c6c496d8dbd6c6f&amp;scene=21#wechat_redirect" data-linktype="2">TCGA数据挖掘常见基因集合</a>，首先是Cancer Manag Res. 2020的文章《Prognostic and Predictive Value of a 15 Transcription Factors (TFs) Panel for Hepatocellular Carcinoma》就提到了：</p><ul data-tool="mdnice编辑器"><li><section>The TF list was downloaded from the Human Transcription Factors website (http://humantfs.ccbr.utoronto.ca/.</section></li></ul><p data-tool="mdnice编辑器">然后是2021的文章《A Transcription Factor-Based Risk Model for Predicting the Prognosis of Prostate Cancer and Potential Therapeutic Drugs》提到一个出处：</p><ul data-tool="mdnice编辑器"><li><section>Atotal of 1665 transcription factors were obtained from the Animal TFDB database。（AnimalTFDB 3.0 ），链接：http://bioinfo.life.hust.edu.cn/AnimalTFDB/#!/</section></li></ul><p data-tool="mdnice编辑器">这两个数据库关于转录因子的收录，都是接近于2000个基因。</p><p data-tool="mdnice编辑器">这些来源于参考文献基因列表往往是千奇百怪的格式，它们并不会遵循MSigDB的gmt文件标准（其实绝大部分人应该是都没有听说过这个标准），绝大部分都是Excel里面的列表格式。</p><p data-tool="mdnice编辑器">要么是长表，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>pathway1  gene1 <br>pathway1  gene2 <br>pathway1  gene3<br>pathway2  gene4 <br>pathway2  gene2<br></code></pre><p data-tool="mdnice编辑器">要么是不整齐的宽表格，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>pathway1  gene1 gene2 gene3<br>pathway2  gene4 gene2<br></code></pre><p data-tool="mdnice编辑器">这些就需要读入到R里面进行整理，然后才能承接到后面的注释步骤。详见；基因集合的数据框，列表和对象形式</p><h3 data-tool="mdnice编辑器"><span></span>转化 MsigDB数据库的全部通路转为gsva分析要求的输入格式<span></span></h3><p data-tool="mdnice编辑器">如果是从 MsigDB数据库下载，通常是gmt文件格式， 可以读入。之前我们的学徒作业，都是以公众号推文的方式发布出来，希望更多人加入一起学习，前面两次的作业是：</p><ul data-tool="mdnice编辑器"><li><section>写一个函数把基因集，写出成为gmt文件。详见： <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247492213&amp;idx=2&amp;sn=226c41a9538b9b8f6da21d886275e612&amp;scene=21#wechat_redirect" data-linktype="2">GSVA或者GSEA各种算法都是可以自定义基因集的</a></section></li><li><section>自行读取作者给出的Nanostring表达矩阵，做差异分析，然后跟作者的结果进行比较。 详见：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247492213&amp;idx=3&amp;sn=d898cda464f2196da1086d53bfd28cf2&amp;scene=21#wechat_redirect" data-linktype="2">Nanostring的表达矩阵分析也是大同小异</a></section></li><li><section>使用TCGA数据源，制作生存分析，看看显著与否！详见：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247492232&amp;idx=2&amp;sn=9583c237f3cb4c19a680891d026c4753&amp;scene=21#wechat_redirect" data-linktype="2">并不是只有TCGA才有临床信息用来做生存分析</a></section></li></ul><p data-tool="mdnice编辑器">其中写一个函数把基因集，写出成为gmt文件，我看到学徒完成的作业惨不忍睹。</p><p data-tool="mdnice编辑器">这个时候其实有一个取巧的办法，就是使用msigdbr这个包，比如msigdbr包提取 KEGG数据信息：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(msigdbr)  <span>#install.packages("msigdbr") </span><br><span>## msigdbr包提取下载  KEGG数据集</span><br>KEGG_df_all &lt;-  msigdbr(species = <span>"Homo sapiens"</span>, <span># Homo sapiens or Mus musculus</span><br>                        category = <span>"C2"</span>,<br>                        subcategory = <span>"CP:KEGG"</span>) <br>colnames(KEGG_df_all)<br>KEGG_df &lt;- dplyr::select(KEGG_df_all,gs_exact_source,gs_exact_source,ensembl_gene)  <br>kegg_list &lt;- split(KEGG_df$ensembl_gene, KEGG_df$gs_exact_source)  <br>kegg_list<br></code></pre><p data-tool="mdnice编辑器">不过呢， 值得提醒的是msigdbr包提取 KEGG数据受限于 MsigDB数据库本身，里面的kegg信息是过时的，所以仍然是建议使用kegg数据库官方来源哈。</p><h3 data-tool="mdnice编辑器"><span></span>gsva是针对表达量矩阵进行分析<span></span></h3><p data-tool="mdnice编辑器">这个时候表达量矩阵很容易获得，多个基因在多个样品的表达量行列式而已，但是这个msigdbr这个包里面的通路信息没办法直接被gsva函数使用，需要一点点转化，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(msigdbr)<br>all_gene_sets = msigdbr(species = <span>"Homo sapiens"</span>,<br>                        category=<span>'H'</span>) <span>#从Msigdb中获取信号通路，此处H是癌症的标志物</span><br><br><span>#?msigdbr #可改成相应的感兴趣的数据集：C1-C7;H</span><br><span># https://www.jianshu.com/p/f750ddcc440d （MsigDB）</span><br><br>length(unique(table(all_gene_sets$gs_name))) <span>#癌症Marker对应的H有41条通路</span><br>tail(table(all_gene_sets$gs_name))<br><br><span># 制作gsva分析所需要的genelist</span><br>gs=split(all_gene_sets$gene_symbol,all_gene_sets$gs_name)<br>gs = lapply(gs, unique)<br>head(gs)<br>gsc &lt;- GeneSetCollection(mapply(<span>function</span>(geneIds, keggId) {<br>  GeneSet(geneIds, geneIdType=EntrezIdentifier(),<br>          collectionType=KEGGCollection(keggId),<br>          setName=keggId)<br>}, gs, names(gs)))<br>head(gsc)<br>geneset &lt;- gsc<br></code></pre><p data-tool="mdnice编辑器">这个时候如果你有表达量矩阵，就可以很容易跑gsva啦，比如如下所示的代码里面的X变量就是多个基因在多个样品的表达量行列式矩阵：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 运行gsva</span><br>es.max &lt;- gsva(X, geneset, <br>               mx.diff=<span>FALSE</span>, verbose=<span>FALSE</span>, <br>               parallel.sz=<span>8</span>)<br><span># 保存gsva分析所需要的结果</span><br>write.csv(es.max,file=<span>'es.max.csv'</span>)<br>head(es.max)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span>gsea是针对单个样品的表达量排序<span></span></h3><p data-tool="mdnice编辑器">如果是多个基因在多个样品的表达量行列式矩阵，需要一个个样品独立跑gsea分析，可以是每个样品的全部的基因自己的表达量排序，也可以某次差异分析两个分组后全部的基因在这个差异分析的变化倍数排序 ，示例代码如下所示 。</p><pre data-tool="mdnice编辑器"><span></span><code>geneList = DEG_DESeq2$log2FoldChange<br>names(geneList)= rownames(DEG_DESeq2)<br>geneList=sort(geneList,decreasing = <span>T</span>)<br>head(geneList)<br><br>all_gene_sets = msigdbr(species =  <span>"Mus musculus"</span>, <span># Homo sapiens or Mus musculus</span><br>                        category = <span>"H"</span> ) <br>egmt &lt;- GSEA(geneList, TERM2GENE= all_gene_sets[,c(<span>'gs_name'</span>,<span>'gene_symbol'</span>)] , <br>             minGSSize = <span>1</span>,<br>             pvalueCutoff = <span>1</span>,<br>             verbose=<span>FALSE</span>)<br>head(egmt)<br>egmt@result <br>gsea_results_df &lt;- egmt@result <br>rownames(gsea_results_df) <br></code></pre></section><h4 data-tool="mdnice编辑器"><span>文末友情宣传</span></h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519083&amp;idx=1&amp;sn=61f07b390469617ca2e9924f5b3929ab&amp;scene=21#wechat_redirect" data-linktype="2">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li></ul><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/b1raOVbD_YPNSjhc2Bb3lA",target="_blank" rel="noopener noreferrer">原文链接</a>
