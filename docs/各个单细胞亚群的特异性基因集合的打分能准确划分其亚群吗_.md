---
title: "各个单细胞亚群的特异性基因集合的打分能准确划分其亚群吗？"
date: 2022-11-05T14:26:34Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
各个单细胞亚群的特异性基因集合的打分能准确划分其亚群吗？ by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>绝大部分初学者在拿到了单细胞表达量矩阵后就直接开始降维聚类分群，都是有标准代码，遇到的第一个拦路虎就是亚群的生物学命名，因为这个步骤并不是代码技巧反而是生物学背景。往往是有一个错误的预期，就是各个单细胞亚群泾渭分明，非此即彼，区分的清清楚楚。</p></blockquote><p data-tool="mdnice编辑器">而实际情况下，不同层次的细胞亚群的界限容忍度就不一样。比如肿瘤相关单细胞数据集常规分析都是拿到表达量矩阵后的第一层次降维聚类分群通常是：</p><ul data-tool="mdnice编辑器"><li><section>immune (CD45+,PTPRC),</section></li><li><section>epithelial/cancer (EpCAM+,EPCAM),</section></li><li><section>stromal (CD10+,MME,fibo or CD31+,PECAM1,endo)</section></li></ul><p data-tool="mdnice编辑器">参考我前面介绍过 <a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247488940&amp;idx=1&amp;sn=1cc8a8a74715087939b9721c0881775d&amp;scene=21#wechat_redirect" data-linktype="2">CNS图表复现08—肿瘤单细胞数据第一次分群通用规则</a>，这3大单细胞亚群构成了肿瘤免疫微环境的复杂。绝大部分文章都是抓住免疫细胞亚群进行细分，包括淋巴系（T,B,NK细胞）和髓系（单核，树突，巨噬，粒细胞）的两大类作为第二次细分亚群。但是也有不少文章是抓住stromal 里面的fibo 和endo进行细分，并且编造生物学故事的。</p><p data-tool="mdnice编辑器">在第一层次降维聚类分群，当然是免疫细胞和上皮细胞界限非常明晰，除非是背景污染没有去除或者少量的实验环节引入误差，比如：<a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247508421&amp;idx=1&amp;sn=9826fcd0ee60858989e12581ba7da66f&amp;scene=21#wechat_redirect" data-linktype="2">不知道为什么偶尔能看到T淋巴细胞跟肿瘤细胞在umap临近</a> 就是这样的情况。而往往是在第3层次，很多亚群其实就本来是不应该是有清晰的界限，比如我们熟知的pbmc3k数据集里面的部分免疫细胞就比较类似：</p><pre data-tool="mdnice编辑器"><span></span><code><span># devtools::install_github('satijalab/seurat-data')</span><br><span>library</span>(SeuratData) <span>#加载seurat数据集  </span><br>getOption(<span>'timeout'</span>)<br>options(timeout=<span>10000</span>)<br><span># InstallData("pbmc3k")  </span><br>data(<span>"pbmc3k"</span>)  <br><span>library</span>(Seurat) <br>sce &lt;- pbmc3k.final <br>p1=DimPlot(sce, reduction = <span>"umap"</span>, label = <span>TRUE</span>, pt.size = <span>0.5</span>) + NoLegend()<br>p1<br><br><span># 需要合并一些单细胞亚群：</span><br>levels(Idents(sce))<br><span>## Assigning cell type identity to clusters</span><br>new.cluster.ids &lt;- c(<span>"CD4 T"</span>,<span>"CD4 T"</span>, <span>"Mono"</span>,  <span>"B"</span>, <span>"CD8 T"</span>,<br>                     <span>"Mono"</span>, <span>"NK"</span>, <span>"DC"</span>, <span>"Platelet"</span>)<br>names(new.cluster.ids) &lt;- levels(sce)<br>sce &lt;- RenameIdents(sce, new.cluster.ids)<br>p2 = DimPlot(sce, reduction = <span>"umap"</span>, label = <span>TRUE</span>, pt.size = <span>0.5</span>) + NoLegend()<br><br><span>library</span>(patchwork)<br>p1+p2<br></code></pre><p data-tool="mdnice编辑器">如下所示，两个CD4的T细胞比较类似，两个单核细胞也是如此，CD8和NK也是如此：</p><p><img data-galleryid="" data-ratio="0.5743756786102063" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCpPibDjxq4QQnWN6GicGvS6DicaYJMZY4mdOtK1ceAzog8MMZiaDkqQEzes6Yia9N8aGiaNgUHQm2KRNA/640?wx_fmt=png" data-type="png" data-w="1842" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCpPibDjxq4QQnWN6GicGvS6DicaYJMZY4mdOtK1ceAzog8MMZiaDkqQEzes6Yia9N8aGiaNgUHQm2KRNA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>比较类似</figcaption></figure><p data-tool="mdnice编辑器">因为比较类似，如果你没有十足的把握在这个umap把它们区分开来， 就可以不用那么细致的命名。这个时候我们来做一个有意思的探索， 就是各个单细胞亚群的特异性基因集合的打分能准确划分其亚群吗？</p><pre data-tool="mdnice编辑器"><span></span><code>future::plan(<span>"multiprocess"</span>, workers = <span>4</span>) <br>sce.markers &lt;- FindAllMarkers(object = sce, only.pos = <span>TRUE</span>, <br>                              min.pct = <span>0.25</span>, <br>                              thresh.use = <span>0.25</span>)<br>save(sce.markers,file = <span>'sce.markers.FindAllMarkers.pbmc.Rdata'</span>)<br><br><span>library</span>(dplyr) <br>top10 &lt;- sce.markers %&gt;% group_by(cluster) %&gt;% top_n(<span>10</span>, avg_log2FC) <br>DoHeatmap(sce ,unique(top10$gene))<br>ggplot2::ggsave(<span>'top10_DoHeatmap.pdf'</span>,height = <span>10</span>)<br><br></code></pre><p data-tool="mdnice编辑器">可以看到，两个CD4的T细胞其实大量共享高表达量基因，两个单核细胞也是如此，而CD8和NK也是如此：</p><p><img data-galleryid="" data-ratio="0.865137614678899" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCpPibDjxq4QQnWN6GicGvS66E8z7uMPMJf5ib68tjoX5wdibVtNB3btSWO0v1wSKYYRS00deJHULPHg/640?wx_fmt=png" data-type="png" data-w="2180" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCpPibDjxq4QQnWN6GicGvS66E8z7uMPMJf5ib68tjoX5wdibVtNB3btSWO0v1wSKYYRS00deJHULPHg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>大量共享高表达量基因</figcaption></figure><p data-tool="mdnice编辑器">这本来就是符合生物学背景的，当然了如果你换一个算法，或者修改FindAllMarkers的参数，也可以达到每个单细胞亚群可以寻找到更加特异一点的高表达量基因列表。</p><p data-tool="mdnice编辑器">如果我们替换成为了top基因的打分，然后可视化，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>top10 = split(top10$gene,top10$cluster)<br><br>names(top10)<br><span># ?AddModuleScore()</span><br>sce = AddModuleScore(sce,top10)<br>names(sce@meta.data)<br>colnames(sce@meta.data)[<span>8</span>:<span>16</span>]  = levels(Idents(sce))<br>VlnPlot(sce,features = levels(Idents(sce))  , <br>        stack = <span>T</span>) <br>ggplot2::ggsave(<span>'top10_AddModuleScore_VlnPlot.pdf'</span> )<br><br></code></pre><p data-tool="mdnice编辑器">可以看到区分度好了一点：</p><p><img data-galleryid="" data-ratio="0.5559038662486938" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCpPibDjxq4QQnWN6GicGvS6TjvhyPy295cpMwQfnIpjerqpia9XT0KkNhrN7nibnr4El79SKPAAG3OA/640?wx_fmt=png" data-type="png" data-w="1914" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCpPibDjxq4QQnWN6GicGvS6TjvhyPy295cpMwQfnIpjerqpia9XT0KkNhrN7nibnr4El79SKPAAG3OA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>top基因的打分</figcaption></figure><p data-tool="mdnice编辑器">如果把top10的基因替换成为top100，你会发现肉眼看上去，区分情况会有一点点好转。</p><p data-tool="mdnice编辑器">如果我们把这个pbmc3k数据集区分的粗糙一点，效果会更好一点，说明这个时候的cd8和nk其实并不是很好的界限，本来就是可以提取子集后继续细分，这个时候的pbmc3k的示范命名反而并不是很合理。</p><p><img data-galleryid="" data-ratio="0.42779456193353477" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCpPibDjxq4QQnWN6GicGvS6yTQkP2xzH7l048H5ibJQo5h4xx2AtmhjLiavyicl8ibduL6pmSaWicrxzBg/640?wx_fmt=png" data-type="png" data-w="3310" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCpPibDjxq4QQnWN6GicGvS6yTQkP2xzH7l048H5ibJQo5h4xx2AtmhjLiavyicl8ibduL6pmSaWicrxzBg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>cd8和nk的混入</figcaption></figure></section><h2 data-tool="mdnice编辑器">写在文末</h2><p data-tool="mdnice编辑器">我在《生信技能树》，《生信菜鸟团》，《单细胞天地》的大量推文教程里面共享的代码都是复制粘贴即可使用的， 有任何疑问欢迎留言讨论，也可以发邮件给我，详细描述你遇到的困难的前因后果给我，我的邮箱地址是 jmzeng1314@163.com</p><p data-tool="mdnice编辑器">如果你确实觉得我的教程对你的科研课题有帮助，让你茅塞顿开，或者说你的课题大量使用我的技能，烦请日后在发表自己的成果的时候，加上一个简短的致谢，如下所示：</p><p data-tool="mdnice编辑器">We thank Dr.Jianming Zeng(University of Macau), and all the members of his bioinformatics team, biotrainee, for generously sharing their experience and codes.</p><p data-tool="mdnice编辑器">十年后我环游世界各地的高校以及科研院所（当然包括中国大陆）的时候，如果有这样的情谊，我会优先见你。</p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/3DCdxI2rwdylYwub7Vqpaw",target="_blank" rel="noopener noreferrer">原文链接</a>
