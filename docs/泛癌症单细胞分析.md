---
title: "泛癌症单细胞分析"
date: 2022-12-25T09:12:45Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
泛癌症单细胞分析 by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>上周的推文中提到看细胞亚群分布可以通过对不同实体肿瘤进行分组tumor, normal 和 adjacent，文章中也有相关分析。</p><p>由于上周看GSE210347数据集的时候没有注意到作者也同时上传了meta数据,其中包括了分组信息，不用自己根据文章提供的补充信息来分。因此这周推文就想看一下如何利用作者已经上传的meta信息。</p></blockquote><p data-tool="mdnice编辑器"><strong>数据集：</strong></p><figure data-tool="mdnice编辑器"><img data-ratio="0.11595466434176112" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibzDdb5mtTdiabOa2deaupCcIr5GAYEkQYJZY6GhscwEvViamFdQxM0CKCM3NvZ5L90FGsp6J2DTQog/640?wx_fmt=png" data-type="png" data-w="1147" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibzDdb5mtTdiabOa2deaupCcIr5GAYEkQYJZY6GhscwEvViamFdQxM0CKCM3NvZ5L90FGsp6J2DTQog/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><p>其上传的meta信息包括[ nCount_RNA,nFeature_RNA, SampleID, percent.mt, seurat_clusters, clusters, celltype,  tissue  group], 后续分析提取了tissue和group信息</p></blockquote><p data-tool="mdnice编辑器"><strong>复现的图：</strong></p><figure data-tool="mdnice编辑器"><img data-ratio="0.9541284403669725" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibzDdb5mtTdiabOa2deaupCcJTYIKNcvoWVeibpsSbyCgpCK1AiaNWUVNypTRCgQyqhqUeQqEb4BC6LQ/640?wx_fmt=png" data-type="png" data-w="545" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibzDdb5mtTdiabOa2deaupCcJTYIKNcvoWVeibpsSbyCgpCK1AiaNWUVNypTRCgQyqhqUeQqEb4BC6LQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器"><strong>代码：</strong></p><p data-tool="mdnice编辑器"><strong>step1 导入数据</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span># 1.加载R包 ----</span><br>rm(list=ls()) <br><span>library</span>(ggplot2) <br><span>library</span>(cowplot) <br><span>library</span>(paletteer)  <br><span>library</span>(gplots)<br><span>library</span>(ggpubr)    <br><span>library</span>(ggsci) <br><span>library</span>(stringr)<br><br><span># 2.设置工作路径 ----</span><br>getwd() <br>dir.create(<span>"../4_group"</span>)<br>setwd(<span>"../4_group/"</span>)<br><br><span>#3.读取数据 ----</span><br>sce=readRDS(<span>"../2-harmony/sce.all_int.rds"</span>)<br><br>getwd()<br>meta&lt;-fread(<span>"GSE210347_meta.txt"</span>,data.table = <span>F</span>)<br>meta[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>rownames(meta)=meta[,<span>1</span>]<br>meta=meta[,-<span>1</span>]<br>head(meta)<br><br><span>#把meta信息中的group提取出来放到读取的数据中</span><br>sce$group=meta$group<br>table(sce$group)<br><span>#Adjacent   Normal    Tumor </span><br> <span># 189830   162627   485931 </span><br><br><br><span>#把meta信息中的tissue提取出来放到读取的数据中</span><br>sce$tumor=meta$tissue<br>table(sce$tumor)<br><span>#   bladder     breast colorectal    gastric        ICC      liver       lung    ovarian       PDAC </span><br><span>#     85384      43751      62203      59874      42609      26904     207411      41094     165197 </span><br><span>#  prostate    thyroid </span><br><span>#     43193      60768 </span><br></code></pre><p data-tool="mdnice编辑器"><strong>step2 细胞亚群命名</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>#具体命名所用marker详见上周四推文</span><br>sce.all=sce<br>table(sce.all@meta.data$RNA_snn_res.0.3)<br><span>#细胞分群命名</span><br>celltype=data.frame(ClusterID=<span>0</span>:<span>29</span>,<br>                    celltype= <span>0</span>:<span>29</span>) <br><br><span>#定义细胞亚群  </span><br>celltype[celltype$ClusterID %<span>in</span>% c(<span>0</span>,<span>15</span>,<span>17</span>,<span>19</span>,<span>21</span>,<span>22</span>),<span>2</span>]=<span>'T cells'</span><br>celltype[celltype$ClusterID %<span>in</span>% c(<span>16</span>,<span>26</span>,<span>9</span>),<span>2</span>]=<span>'B cells'</span><br>celltype[celltype$ClusterID %<span>in</span>% c(<span>18</span>),<span>2</span>]=<span>'mast'</span><br>celltype[celltype$ClusterID %<span>in</span>% c(<span>1</span>,<span>23</span>,<span>5</span>,<span>28</span>),<span>2</span>]=<span>'myeloid'</span><br><br>celltype[celltype$ClusterID %<span>in</span>% c(<span>4</span>,<span>6</span>,<span>7</span>,<span>10</span>,<span>11</span>,<span>12</span>,<span>13</span>,<span>24</span>,<span>25</span>,<span>27</span>,<span>14</span>,<span>20</span>),<span>2</span>]=<span>'epi'</span><br>celltype[celltype$ClusterID %<span>in</span>% c(<span>29</span>,<span>3</span>),<span>2</span>]=<span>'Endo'</span><br>celltype[celltype$ClusterID %<span>in</span>% c(<span>2</span>,<span>8</span>),<span>2</span>]=<span>'fibo'</span><br><br><br>head(celltype)<br>celltype<br>table(celltype$celltype)<br>sce.all@meta.data$celltype = <span>"NA"</span><br><span>for</span>(i <span>in</span> <span>1</span>:nrow(celltype)){<br>  sce.all@meta.data[which(sce.all@meta.data$RNA_snn_res.0.3 == celltype$ClusterID[i]),<span>'celltype'</span>] &lt;- celltype$celltype[i]}<br>table(sce.all@meta.data$celltype)<br><br><br><span>library</span>(ggsci)<br>color = c(pal_d3(<span>"category20"</span>)(<span>20</span>),<br>          pal_d3(<span>"category20b"</span>)(<span>20</span>),<br>          pal_d3(<span>"category20c"</span>)(<span>20</span>),<br>          pal_d3(<span>"category10"</span>)(<span>10</span>))<br><br>DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"celltype"</span>,<br>        cols = color,<br>        pt.size = <span>1.5</span>,<br>        label = <span>T</span>,label.box = <span>T</span><br>) <br>ggsave(<span>'celltype-umap_2.pdf'</span>,height = <span>6</span>,width = <span>8</span>) <br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7489539748953975" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibzDdb5mtTdiabOa2deaupCcmp3Itd0E8kNoqqRLribCbk7xlRxcTCzu1NqpVjW5UABkAibkBpSvRJgA/640?wx_fmt=png" data-type="png" data-w="956" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibzDdb5mtTdiabOa2deaupCcmp3Itd0E8kNoqqRLribCbk7xlRxcTCzu1NqpVjW5UABkAibkBpSvRJgA/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器"><strong>每种细胞类型中，分组所占比例及可视化</strong></p><pre data-tool="mdnice编辑器"><span></span><code>phe=sce.all@meta.data<br><span>##每种细胞类型中，分组所占比例 ----</span><br><span>library</span>(tidyr)<br><span>library</span>(reshape2) <br><span>library</span>(dplyr)<br><span>library</span>(ggplot2)<br><br>bar_data &lt;- as.data.frame(table(phe$tumor,phe$group))<br><br>bar_per &lt;- bar_data %&gt;% <br>  group_by(Var1) %&gt;%<br>  mutate(sum(Freq)) %&gt;%<br>  mutate(percent = Freq / `sum(Freq)`)<br> <br>write.csv(bar_per,file = <span>"celltype_by_orig.ident_percent.csv"</span>)<br>ggplot(bar_per, aes(x = percent, y =Var1 )) +<br>  geom_bar(aes(fill = Var2) , stat = <span>"identity"</span>) + coord_flip() +<br>  theme(axis.ticks = element_line(linetype = <span>"blank"</span>),<br>        legend.position = <span>"top"</span>,<br>        panel.grid.minor = element_line(colour = color,linetype = <span>"blank"</span>), <br>        panel.background = element_rect(fill = <span>NA</span>),<br>        plot.background = element_rect(colour = color)) +<br>  labs(y = <span>"% Relative cell source"</span>, fill = <span>NULL</span>)+labs(x = <span>NULL</span>)+<br>  scale_fill_d3()<br><br>ggsave(<span>"celltype_by_orig.ident_percent-2.pdf"</span>,units = <span>"cm"</span>,<br>       width = <span>15</span>,height = <span>12</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7932960893854749" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibzDdb5mtTdiabOa2deaupCcvcR6JPur84Heiazslwgvicwe3rDIVyANrjLzEPdbGvDmFAAjxvDczq2A/640?wx_fmt=png" data-type="png" data-w="895" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibzDdb5mtTdiabOa2deaupCcvcR6JPur84Heiazslwgvicwe3rDIVyANrjLzEPdbGvDmFAAjxvDczq2A/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><p>其中文章中把liver分组的信息去除了，可能由于其只有normal组。</p></blockquote></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/ook0fWAZZ05YGO7p2d3ykw",target="_blank" rel="noopener noreferrer">原文链接</a>
