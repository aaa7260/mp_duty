---
title: "给你几条蛋白序列，用R语言怎么比对？"
date: 2023-01-06T03:18:46Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
给你几条蛋白序列，用R语言怎么比对？ by 生信星球
------
<div><p><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrLfDiavqTPmkMHiaIAkPgmZR9LERh1l5td8g2LicMYNcCHjh1ibIxqJys9neR8ibDH1IAzcxia9jrLP1tw/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrLfDiavqTPmkMHiaIAkPgmZR9LERh1l5td8g2LicMYNcCHjh1ibIxqJys9neR8ibDH1IAzcxia9jrLP1tw/640?wx_fmt=png"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrLfDiavqTPmkMHiaIAkPgmZRXmgtHtmB3L1qaPWfQYBIXPXWsv4xSThfiaveuJxFcribXCVia6S1Q5OWw/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrLfDiavqTPmkMHiaIAkPgmZRXmgtHtmB3L1qaPWfQYBIXPXWsv4xSThfiaveuJxFcribXCVia6S1Q5OWw/640?wx_fmt=png"><span> 今天是生信星球陪你的<span><strong>第785天</strong></span></span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrLfDiavqTPmkMHiaIAkPgmZR9LERh1l5td8g2LicMYNcCHjh1ibIxqJys9neR8ibDH1IAzcxia9jrLP1tw/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrLfDiavqTPmkMHiaIAkPgmZR9LERh1l5td8g2LicMYNcCHjh1ibIxqJys9neR8ibDH1IAzcxia9jrLP1tw/640?wx_fmt=png"><br></p><hr><p><span><span>   </span><span>大神一句话，菜鸟跑半年。我不是大神，但我可以缩短你走弯路的半年~</span></span></p><p><span><span>   就像歌儿唱的那样，如果你不知道该往哪儿走，就留在这学点生信好不好~</span></span></p><p><span>   这里有豆豆和花花的学习历程，从新手到进阶，生信路上有你有我！</span></p><section><blockquote><span>豆豆写于2021.2.2</span><p>今天我们以两条蛋白序列为例，来看看用R怎么比对，并且重点是要找到目标位点的比对结果。当然，今天这个R包不仅可以比对蛋白序列，还支持DNA, RNA</p></blockquote><h3><span>安装R包</span></h3><pre><code>rm(list=ls())<br>options(stringsAsFactors = <span>F</span>)<br><br><span># BiocManager::install("msa") </span><br>suppressMessages(<span>library</span>(msa))<br><span>library</span>(stringr)<br></code></pre><h3><span>下载蛋白序列</span></h3><p>首页（https://www.uniprot.org/）输入：<code>基因名_物种</code>，获取ID号</p><figure><img data-ratio="0.5193798449612403" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxF4Yf42nWomTIL12SdQveyQP9TmI6g1jfkp52icjDAK1NYCEAePXwXwQ/640?wx_fmt=png" data-type="png" data-w="1548" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxF4Yf42nWomTIL12SdQveyQP9TmI6g1jfkp52icjDAK1NYCEAePXwXwQ/640?wx_fmt=png"></figure><figure><img data-ratio="0.5386702849389416" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxggbObIboUcvhT3Qu5HsicbeWDcdS08Gh2qmYmf2PrfWyC5KbbtzNcqA/640?wx_fmt=png" data-type="png" data-w="1474" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxggbObIboUcvhT3Qu5HsicbeWDcdS08Gh2qmYmf2PrfWyC5KbbtzNcqA/640?wx_fmt=png"></figure><p>然后就可以下载到小鼠该基因的蛋白序列</p><blockquote><p><strong>注意网页链接的规律</strong></p></blockquote><p>https://www.uniprot.org/uniprot/P48754.fasta</p><p>同理，我们也获取到human的该基因蛋白序列: https://www.uniprot.org/uniprot/P38398.fasta</p><h3><span>R中继续操作</span></h3><blockquote><p>官方文档在：<br>https://bioconductor.org/packages/release/bioc/vignettes/msa/inst/doc/msa.pdf</p></blockquote><pre><code><span># 读取序列</span><br>hg &lt;- readAAStringSet(<span>'P38398.fasta'</span>)<br>mm &lt;- readAAStringSet(<span>'P48754.fasta'</span>)<br><span># 结果保存为AAStringSet对象。当然，还支持读入 DNAStringSet, and RNAStringSet对象</span><br></code></pre><figure><img data-ratio="0.0817717206132879" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxxoWLrjDD1lnLt7j4CI82g3dwMyjcumBFEcMnQKsXMKBReRO8cjQXqQ/640?wx_fmt=png" data-type="png" data-w="2348" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxxoWLrjDD1lnLt7j4CI82g3dwMyjcumBFEcMnQKsXMKBReRO8cjQXqQ/640?wx_fmt=png"></figure><pre><code><span># 进行比对</span><br>mySequences=c(mm,hg)<br>myFirstAlignment &lt;- msa(mySequences)<br></code></pre><figure><img data-ratio="0.21391752577319587" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxpCHeaZbSUGqXibAteltwibHCx1yh0NicaJZlzqHP8jENBdx06Tj9DDLSA/640?wx_fmt=png" data-type="png" data-w="2328" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxpCHeaZbSUGqXibAteltwibHCx1yh0NicaJZlzqHP8jENBdx06Tj9DDLSA/640?wx_fmt=png"></figure><h5><span>可以查看全部比对结果</span></h5><pre><code>print(myFirstAlignment, show=<span>"complete"</span>)<br></code></pre><figure><img data-ratio="0.6669456066945607" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxjTdzCvxkofibX2YPa55dakLIcuK33APgXX9WmRWBkzVzjiaJANOcEfew/640?wx_fmt=png" data-type="png" data-w="2390" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxjTdzCvxkofibX2YPa55dakLIcuK33APgXX9WmRWBkzVzjiaJANOcEfew/640?wx_fmt=png"></figure><h5><span>还可以输出为pdf</span></h5><pre><code>msaPrettyPrint(myFirstAlignment, output=<span>"pdf"</span>, showNames=<span>"none"</span>,showLogo=<span>"none"</span>, askForOverwrite=<span>FALSE</span>, verbose=<span>FALSE</span>)<br></code></pre><figure><img data-ratio="0.34466403162055337" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxrciagV7Vr6rjowYJAYyW9gTdc3RBBiayDIPEiakAUcRpoazicWhO0RibrTg/640?wx_fmt=png" data-type="png" data-w="1265" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxrciagV7Vr6rjowYJAYyW9gTdc3RBBiayDIPEiakAUcRpoazicWhO0RibrTg/640?wx_fmt=png"></figure><p>其中感叹号<code>!</code>就是全部比对上的，<code>*</code>就是存在gap的位点</p><h5><span>当然，如果比对的序列很多，还可以增加logo</span></h5><pre><code><span># 示例代码</span><br>msaPrettyPrint(myFirstAlignment, output=<span>"asis"</span>, y=c(<span>164</span>, <span>213</span>),subset=c(<span>1</span>:<span>6</span>), showNames=<span>"none"</span>, showLogo=<span>"top"</span>,logoColors=<span>"rasmol"</span>, shadingMode=<span>"similar"</span>,showLegend=<span>FALSE</span>, askForOverwrite=<span>FALSE</span>)<br></code></pre><figure><img data-ratio="0.30648769574944074" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxd5wZt3yDuuAAFFJv8iazSv4wBb5PPSeKiboLL5Iicib0iaAIS8iaqPjfXicuw/640?wx_fmt=png" data-type="png" data-w="894" title="image-20210202143631003" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxd5wZt3yDuuAAFFJv8iazSv4wBb5PPSeKiboLL5Iicib0iaAIS8iaqPjfXicuw/640?wx_fmt=png"><figcaption><br></figcaption></figure><h3><span>接下来才是重点</span></h3><blockquote><p>上面函数使用很简单，<strong>关键是我们得到了比对的结果，怎么提取我想要的位点呢</strong></p></blockquote><p>其实之前biostar上也有人提出了这个问题：https://www.biostars.org/p/467870/</p><p>也就是说，<strong>他之前感兴趣的位点是82位的AA，想要看看比对后这个AA对应着哪个AA。但是他发现，比对后原来的AA位置变成了95。所以不知道应该怎么去统计</strong></p><figure><img data-ratio="0.36220472440944884" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxwCtL4Kly5w0Z9F5tqiaEH5Lz8MVtDgPlicsf0SZ4j2kM7KtLlIa9ccmg/640?wx_fmt=png" data-type="png" data-w="1524" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxwCtL4Kly5w0Z9F5tqiaEH5Lz8MVtDgPlicsf0SZ4j2kM7KtLlIa9ccmg/640?wx_fmt=png"></figure><h4><span>这里给出我自己的理解</span></h4><p><strong>首先明确，比对前后的差异在什么地方？</strong>=》原来可以比对的当然能对应，但是不能比对的分了两种情况：一个是硬比对（比如<code>D</code>比对到了<code>N</code>）；一个是软比对，即增加了gap（比如<code>D</code> 比对到<code>.</code> ）。</p><p>麻烦就出在gap身上，原来序列没有，比对过程加上去。</p><p>因此，我们在统计的时候，就需要考虑进来gap的数量</p><p>这里以小鼠为query，人为target。也就是说，小鼠的位点可以按照之前下载的序列，但是人的位点，就需要加上gap。</p><h5><span>以下面👇这个位点`Q`为例</span></h5><figure><img data-ratio="0.13511390416339356" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxe0dS5vmicl4iaQD8eYbpG7gv8ynytmSwMrcjkFyRggiaYW50NVBhMiaFuQ/640?wx_fmt=png" data-type="png" data-w="1273" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxe0dS5vmicl4iaQD8eYbpG7gv8ynytmSwMrcjkFyRggiaYW50NVBhMiaFuQ/640?wx_fmt=png"></figure><ul><li><p>这里显示的一条序列长度是120，正因为混入了两个gap（蓝色的星号表示），所以原本238的位置，现在处于240【所以，<strong>比对结果右侧数字记录的就是：原始的位点所处的位置</strong>】</p></li><li><p>我们可以轻松得到小鼠原来第238位的位点：</p></li></ul><pre><code>  &gt; pos=<span>238</span><br>  &gt; str_sub(as.character(mm),pos,pos)<br>  [<span>1</span>] <span>"Q"</span><br></code></pre><ul><li><p><span>那human呢？用同样的方法能行吗？</span></p></li></ul><pre><code>  &gt; str_sub(as.character(hg),pos,pos)<br>  [<span>1</span>] <span>"H"</span><br></code></pre><p>结果显然不对，它应该是<code>Q</code>，但这里显示<code>H</code> 。因此，我们应该把gap考虑进来</p><ul><li><p><span>在小鼠的第238位点之前，一共有几个gap？</span></p></li></ul><pre><code>  <span># 这里需要从比对结果（myFirstAlignment@unmasked）中提取，即myFirstAlignment@unmasked[1]</span><br>  &gt; ngap=str_sub(as.character(myFirstAlignment@unmasked[<span>1</span>]),<span>1</span>,pos) %&gt;% str_count(<span>'-'</span>)<br>  &gt; ngap<br>  [<span>1</span>] <span>2</span><br></code></pre><ul><li><p><span>这2个gap也符合我们的肉眼验证，因此human此时对应的位置应该是：</span></p></li></ul><pre><code>  &gt; hg_site=str_sub(as.character(myFirstAlignment@unmasked[<span>2</span>]),<span>pos</span>+ngap,<span>pos</span>+ngap)<br>  &gt; hg_site<br>  [<span>1</span>] <span>"Q"</span><br></code></pre><h5><span>原以为这样就结束了，其实并没有</span></h5><p>我测试了好多个，结果都对，但又随机挑选了一个<code>502</code>位点，发现了错误：</p><p>正确的应该是：<code>S&lt;=&gt;T</code>，但我得到的是：<code>S&lt;=&gt;R</code></p><figure><img data-ratio="0.06347962382445141" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxkwnxEgXB3Fe3Oib394KQibS0dfKIXvVPf9mU1ycBH4kiaDan9gmOt0wibw/640?wx_fmt=png" data-type="png" data-w="1276" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpPLbOsKsuicHpTicT99modBxkwnxEgXB3Fe3Oib394KQibS0dfKIXvVPf9mU1ycBH4kiaDan9gmOt0wibw/640?wx_fmt=png"></figure><pre><code>&gt; pos=<span>502</span><br><span># 小鼠的</span><br>&gt; str_sub(as.character(mm),pos,pos)<br>[<span>1</span>] <span>"S"</span><br><span># 人的</span><br>&gt;         ngap=str_sub(as.character(myFirstAlignment@unmasked[<span>1</span>]),<span>1</span>,pos+ngap)%&gt;% str_count(<span>'-'</span>)<br>&gt; str_sub(as.character(myFirstAlignment@unmasked[<span>2</span>]),pos+ngap,pos+ngap)<br>[<span>1</span>] <span>"R"</span><br></code></pre><p>错误原因就是<code>ngap</code>计算错误：</p><pre><code><span># 此时计算的是</span><br>&gt; ngap<br><span># 但其实数一数，在502位点前，其实还有2个，因此是7个</span><br></code></pre><h5><span>但为什么gap会统计错误呢？</span></h5><p>因为我们这里给出的<code>pos=502</code>，在比对结果中，是落在了真实<code>502</code>位置的前面，而且恰巧也落在了那2个新的gap的前面，所以没有统计上。这里我想了一种解决方案，就是增加一步<code>while</code>循环，来探索在比对结果的<code>502</code>位点之后，有没有新的gap出现</p><pre><code>ngap=str_sub(as.character(myFirstAlignment@unmasked[<span>1</span>]),<span>1</span>,pos) %&gt;% str_count(<span>'-'</span>)<br>new_ngap=str_sub(as.character(myFirstAlignment@unmasked[<span>1</span>]),<span>1</span>,pos+ngap) %&gt;% str_count(<span>'-'</span>)<br><span>while</span> (new_ngap != ngap) {<br>       ngap=new_ngap<br>       <span>next</span><br>}<br><br>mm_site=str_sub(as.character(mm),pos,pos)<br>hg_site=str_sub(as.character(myFirstAlignment@unmasked[<span>2</span>]),pos+ngap,pos+ngap)<br></code></pre></section><p><span></span></p><section><hr></section><p><strong><span>点击底部的“阅读原文”，获得更好的阅读体验哦</span></strong><span>😻</span></p><p><span><strong><span>初学生信，很荣幸带你迈出第一步</span></strong></span><br></p><p><span><strong>🤓</strong></span><strong><span>生信星球 </span></strong><span><strong>🌎</strong></span><span><span><strong>~ </strong></span><strong><span>一个不拽术语、通俗易懂的生信知识平台</span></strong></span><span></span></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/7wu7NjFgqzeg-1WEDvHJ2A",target="_blank" rel="noopener noreferrer">原文链接</a>
