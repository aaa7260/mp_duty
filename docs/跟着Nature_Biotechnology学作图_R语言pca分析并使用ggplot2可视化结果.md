---
title: "跟着Nature Biotechnology学作图:R语言pca分析并使用ggplot2可视化结果"
date: 2022-11-10T03:05:24Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Acdemic"]
---
跟着Nature Biotechnology学作图:R语言pca分析并使用ggplot2可视化结果 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><h2 data-tool="mdnice编辑器"><span></span><span>论文</span><span></span><span> </span></h2><blockquote data-tool="mdnice编辑器"><p>Removing unwanted variation from large-scale RNA sequencing data with PRPS</p></blockquote><p data-tool="mdnice编辑器">https://www.nature.com/articles/s41587-022-01440-w#data-availability</p><h2 data-tool="mdnice编辑器"><span></span><span>数据链接</span><span></span><span> </span></h2><p data-tool="mdnice编辑器">https://zenodo.org/record/6459560#.Y2D2NHZBzid</p><p data-tool="mdnice编辑器">https://zenodo.org/record/6392171#.Y2D2SXZBzid</p><h2 data-tool="mdnice编辑器"><span></span><span>代码链接</span><span></span><span> </span></h2><p data-tool="mdnice编辑器">https://github.com/RMolania/TCGA_PanCancer_UnwantedVariation</p><p data-tool="mdnice编辑器">今天推文重复的图没有出现在论文中，是论文中提供的代码里的一个图</p><figure data-tool="mdnice编辑器"><img data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JX4hYvVNfqeokPa3f8sz2PpKHj9edUsHJGYxRTzMN5l7oicEYiawtyumUmOKRr4xes3XQf6KzVL9A/640?wx_fmt=png" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JX4hYvVNfqeokPa3f8sz2PpKHj9edUsHJGYxRTzMN5l7oicEYiawtyumUmOKRr4xes3XQf6KzVL9A/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">但是没有能够重复出来论文中用到的作图数据，所以这里用R语言自带的鸢尾花数据集来演示</p><p data-tool="mdnice编辑器">首先是论文中提供的两个自定义函数，一个是用来做主成分分析的pca,</p><pre data-tool="mdnice编辑器"><span></span><code>.pca &lt;- <span>function</span>(data, is.log) {<br>  <span>if</span> (is.log)<br>    data &lt;- data<br>  <span>else</span><br>    data &lt;- log2(data + 1)<br>  svd &lt;- base::svd(scale(<br>    x = t(data),<br>    center = TRUE,<br>    scale = FALSE<br>  ))<br>  percent &lt;- svd<span>$d</span> ^ 2 / sum(svd<span>$d</span> ^ 2) * 100<br>  percent &lt;-<br>    sapply(seq_along(percent),<br>           <span>function</span>(i) {<br>             round(percent[i], 1)<br>           })<br>  <span>return</span>(list(<br>    sing.val = svd,<br>    variation = percent))<br>}<br></code></pre><p data-tool="mdnice编辑器">一个是用来作图展示结果的用到了ggplot2 ggpubr 和 cowplot 包</p><pre data-tool="mdnice编辑器"><span></span><code>.scatter.density.pc &lt;- <span>function</span>(<br>  pcs, <br>  pc.var, <br>  group.name, <br>  group, <br>  color, <br>  strokeSize, <br>  pointSize, <br>  strokeColor,<br>  alpha,<br>  title<br>){<br>  pair.pcs &lt;- utils::combn(ncol(pcs), 2)<br>  pList &lt;- list()<br>  <span>for</span>(i <span>in</span> 1:ncol(pair.pcs)){<br>    <span>if</span>(i == 1){<br>      x &lt;- pair.pcs[1,i]<br>      y &lt;- pair.pcs[2,i]<br>      p &lt;- ggplot(mapping = aes(<br>        x = pcs[,x], <br>        y = pcs[,y], <br>        fill = group)) +<br>        xlab(paste0(<span>'PC'</span>, x, <span>' ('</span>, pc.var[x], <span>'%)'</span>)) +<br>        ylab(paste0(<span>'PC'</span>, y, <span>' ('</span>, pc.var[y], <span>'%)'</span>)) +<br>        geom_point(<br>          aes(fill = group), <br>          pch = 21, <br>          color = strokeColor, <br>          stroke = strokeSize, <br>          size = pointSize,<br>          alpha = alpha) +<br>        scale_x_continuous(breaks = scales::pretty_breaks(n = 5)) +<br>        scale_y_continuous(breaks = scales::pretty_breaks(n = 5)) +<br>        ggtitle(title) +<br>        theme(<br>          legend.position = <span>"right"</span>,<br>          panel.background = element_blank(), <br>          axis.line = element_line(colour = <span>"black"</span>, size = 1.1),<br>          legend.background = element_blank(),<br>          legend.text = element_text(size = 12),<br>          legend.title = element_text(size = 14),<br>          legend.key = element_blank(),<br>          axis.text.x = element_text(size = 10),<br>          axis.text.y = element_text(size = 10),<br>          axis.title.x = element_text(size = 14),<br>          axis.title.y = element_text(size = 14)) +<br>        guides(fill = guide_legend(override.aes = list(size = 4))) + <br>        scale_fill_manual(name = group.name, values = color)<br>      <br>      le &lt;- ggpubr::get_legend(p)<br>    }<span>else</span>{<br>      x &lt;- pair.pcs[1,i]<br>      y &lt;- pair.pcs[2,i]<br>      p &lt;- ggplot(mapping = aes(<br>        x = pcs[,x], <br>        y = pcs[,y], <br>        fill = group)) +<br>        xlab(paste0(<span>'PC'</span>, x, <span>' ('</span>,pc.var[x],  <span>'%)'</span>)) +<br>        ylab(paste0(<span>'PC'</span>, y, <span>' ('</span>,pc.var[y], <span>'%)'</span>)) +<br>        geom_point(<br>          aes(fill = group), <br>          pch = 21, <br>          color = strokeColor, <br>          stroke = strokeSize,<br>          size = pointSize,<br>          alpha = alpha) +<br>        scale_x_continuous(breaks = scales::pretty_breaks(n = 5)) +<br>        scale_y_continuous(breaks = scales::pretty_breaks(n = 5)) +<br>        theme(<br>          panel.background = element_blank(), <br>          axis.line = element_line(colour = <span>"black"</span>, size = 1.1),<br>          legend.position = <span>"none"</span>,<br>          axis.text.x = element_text(size = 10),<br>          axis.text.y = element_text(size = 10),<br>          axis.title.x = element_text(size = 14),<br>          axis.title.y = element_text(size = 14)) +<br>        scale_fill_manual(values = color, name = group.name)<br>    }<br>    p &lt;- p + theme(legend.position = <span>"none"</span>)<br>    xdens &lt;- cowplot::axis_canvas(p, axis = <span>"x"</span>)+<br>      geom_density(<br>        mapping = aes(<br>          x = pcs[,x], <br>          fill = group),<br>        alpha = 0.7, <br>        size = 0.2<br>      ) +<br>      theme(legend.position = <span>"none"</span>) +<br>      scale_fill_manual(values = color)<br>    <br>    ydens &lt;- cowplot::axis_canvas(<br>      p, <br>      axis = <span>"y"</span>, <br>      coord_flip = TRUE) +<br>      geom_density(<br>        mapping = aes(<br>          x = pcs[,y],<br>          fill = group),<br>        alpha = 0.7,<br>        size = 0.2) +<br>      theme(legend.position = <span>"none"</span>) +<br>      scale_fill_manual(name = group.name, values = color) +<br>      coord_flip()<br>    <br>    p1 &lt;- insert_xaxis_grob(<br>      p,<br>      xdens,<br>      grid::unit(.2, <span>"null"</span>),<br>      position = <span>"top"</span><br>    )<br>    p2 &lt;- insert_yaxis_grob(<br>      p1,<br>      ydens,<br>      grid::unit(.2, <span>"null"</span>),<br>      position = <span>"right"</span><br>    )<br>    pList[[i]] &lt;- ggdraw(p2)<br>  }<br>  pList[[i+1]] &lt;- le<br>  <span>return</span>(pList)<br>}<br></code></pre><p data-tool="mdnice编辑器">这两个自定义函数在函数名前都加了一个点，暂时不知道加这个点和不加有什么区别，将这两个函数放到一个文件里</p><pre data-tool="mdnice编辑器"><span></span><code><span>source</span>(<span>"pca_and_ggplot2.R"</span>)<br><br>library(ggplot2)<br>library(ggpubr)<br>library(cowplot)<br><br>pca.ncg&lt;-.pca(data = iris[,1:4],<br>              is.log = FALSE)<br>.scatter.density.pc(pcs = pca.ncg<span>$sing</span>.val<span>$v</span>[, 1:3],<br>                    pc.var = pca.ncg<span>$variation</span>,<br>                    strokeColor = <span>'gray30'</span>,<br>                    strokeSize = .2,<br>                    pointSize = 2,<br>                    alpha = .6,<br>                    title = <span>"A"</span>,<br>                    group.name = <span>"B"</span>,<br>                    group=iris<span>$Species</span>,<br>                    color=c(<span>"red"</span>,<span>"blue"</span>,<span>"green"</span>)) -&gt; p<br><br>do.call(<br>  gridExtra::grid.arrange,<br>  c(p,ncol=4))<br></code></pre><figure data-tool="mdnice编辑器"><figcaption><br></figcaption></figure><p><img data-galleryid="" data-ratio="0.42763819095477384" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JX4hYvVNfqeokPa3f8sz2qc3gU7ibAyQWZkhuyWuaFjZZAtU0OicAiaR07nqaPMYVZhRSgfgPS6wrg/640?wx_fmt=png" data-type="png" data-w="1990" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JX4hYvVNfqeokPa3f8sz2qc3gU7ibAyQWZkhuyWuaFjZZAtU0OicAiaR07nqaPMYVZhRSgfgPS6wrg/640?wx_fmt=png"></p><p data-tool="mdnice编辑器"><span>这里自定义的pca结果可视化函数参数</span><span>还</span><span>挺多的，这里就不逐个介绍了，争取抽时间录制成视频介绍，敬请期待</span><br></p><blockquote data-tool="mdnice编辑器"><p>示例数据和代码可以给推文点赞 点击在看 最后留言获取</p></blockquote><p data-tool="mdnice编辑器">欢迎大家关注我的公众号</p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzI3NzQ3MTcxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5t1sOnM0iabvBhnfIj5YpyqrMib0E1MGCd9ibcYxaOPZd0GWhQBDvK2BPEwsicQxd6y5MHLfphnwHnow/0?wx_fmt=png" data-nickname="小明的数据分析笔记本" data-alias="" data-signature="数据分析和数据可视化有意思的简单小例子~石榴研究生的笔记本" data-from="0" data-is_biz_ban="0"></mp-common-profile><br></section><blockquote data-tool="mdnice编辑器"><p>小明的数据分析笔记本 公众号 主要分享：1、R语言和python做数据分析和数据可视化的简单小例子；2、园艺植物相关转录组学、基因组学、群体遗传学文献阅读笔记；3、生物信息学入门学习资料及自己的学习笔记！</p></blockquote></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/VimQSZWZ27Si6RP27gqHPw",target="_blank" rel="noopener noreferrer">原文链接</a>
