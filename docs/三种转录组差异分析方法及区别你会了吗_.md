---
title: "三种转录组差异分析方法及区别你会了吗？"
date: 2022-10-12T04:40:38Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
三种转录组差异分析方法及区别你会了吗？ by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span>缘起</span><span></span></h2><p data-tool="mdnice编辑器">在做项目时，曾有小伙伴对我用edgeR进行差异分析筛选出的具体显著差异基因表示质疑，<span>因为发表的文章清楚的说明某个基因是差异基因，但是我edgeR的分析结果并没有表明</span>。在小伙伴的质疑下，我认真看了下文章，发现文章用的是DEseq2进行差异分析。值得注意的是该小伙伴关注的差异基因是一个离散比较大的基因，此处的离散较大可以理解为假定对照组为5，6，7；实验组则为14，13，3的情况。那为什么这个基因在edgeR分析下不是显著差异基因，然而在DEseq2的分析下是差异基因呢？这应该很大程度源于算法判定显著差异基因的区别。接着，我看了关于DEseq2与edgeR区别的描述，发现<strong>「edgeR与Deseq2都是基于负二项分布模型做的，两者处理同一组数据时，相同阈值处理大部分基因是一样的，但是也会有一部分基因会因为离散度不同导致差异不同」</strong>，如刚刚示例的基因离散度被DEseq2识别为差异，但是不被edgeR识别，所以两种算法获取的差异基因与数目是存在细微区别的。</p><p data-tool="mdnice编辑器">小伙伴们可能也会好奇，除了上述的edgeR与DEseq2，不是还有第三种差异分析方法imma吗，它分析的结果与前两种差异分析方法有什么区别？<strong>「具体分析时，我们应该从三种差异分析方法中选择何种方法进行分析呢？」</strong></p><p data-tool="mdnice编辑器">小编觉得，如果不是针对特定的基因去找，其实这三种差异分析方法都可以（虽然目前推DEseq2与edgeR的比较多些）。但是，如果说你要根据固定的基因去选择，你可以尝试一下三种差异分析的方法，看看效果再决定。</p><p data-tool="mdnice编辑器">在本文中，我们拟通过三个<strong>「check上调基因的箱线图」</strong>说明三种差异分析方法没有造成上下调差异基因结果相反的情况；通过<strong>「Veen图」</strong>查看了差异基因在三种差异分析方法间的交集情况，通过<strong>「相关性分析」</strong>看看不同差异分析方法分析共同差异基因logFC的相关性。<strong>接下来就让我们探究一下三种差异分析方法（DEseq2、edgeR与limma）在转录组差异分析的方式与具体流程吧。</strong></p><h2 data-tool="mdnice编辑器"><span></span><span>探究</span><span></span></h2><p data-tool="mdnice编辑器">今天，我们使用标题为 Single base-pair resolution analysis of binding motif with diffMotif uncovers the oncogenic impact of CTCF mutations in breast cancer 的数据集GSE190114进行探究，数据集的介绍链接如下h<span>ttps://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE190114</span>，感兴趣的小伙伴可以点进去看看作者的总体设计。在此，小编对文章进行简单归纳，作者主要通过转录组测序探究了CTCF锌指结构的突变对于乳腺癌的影响，使用的是MCF10A乳腺癌细胞系。</p><h2 data-tool="mdnice编辑器"><span>转录组数据集介绍</span><span></span></h2><p data-tool="mdnice编辑器">GSE190114数据集的样本分组如下，三个分组三个重复样本，我们重点对前两个分组的重复样本进行差异分析<img data-ratio="0.3516042780748663" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJwxkRN8BNw0WpLI3ibHBy2bAflugzUL1qY5Uyjn9Xl6YbGiaIyUKX3ckw/640?wx_fmt=png" data-type="png" data-w="748" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJwxkRN8BNw0WpLI3ibHBy2bAflugzUL1qY5Uyjn9Xl6YbGiaIyUKX3ckw/640?wx_fmt=png">处理数据的话，作者上传了基因count矩阵，我们就可以直接走基因count矩阵的差异分析流程进行分析，链接见<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247506188&amp;idx=1&amp;sn=63d8e3afa55a3276f8e785e29e1ec234&amp;scene=21#wechat_redirect" data-linktype="2">如何做单样本之间的差异分析</a>。</p><p data-tool="mdnice编辑器">以下为基因count矩阵下载链接：https://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE190114&amp;format=file&amp;file=GSE190114%5FRNA%5FSeq%5FCountMatrix%2Etxt%2Egz；感兴趣的小伙伴可以下载试试。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>0.清控环境，加载包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br><span>library</span>(edgeR)<br><span>library</span>(DESeq2)<br><span>library</span>(FactoMineR)<br><span>library</span>(factoextra)<br><span>library</span>(clusterProfiler)<br><span>library</span>(org.Hs.eg.db)<br><span>library</span>(org.Mm.eg.db)<br><span>library</span>(stringr)<br><span>library</span>(stringi)<br><span>library</span>(tidyverse)<br><span>library</span>(ggplot2)<br><span>library</span>(patchwork)<br><span>library</span>(pheatmap)<br><span>library</span>(VennDiagram)<br><span>library</span>(RColorBrewer)<br><span>library</span>(patchwork)<br><span>library</span>(ggplotify)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>1.读取数据，获得基因表达矩阵以及cpm矩阵</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>rawcount &lt;- read.table(<span>"./GSE190114_RNA_Seq_CountMatrix.txt"</span>,header = <span>T</span>,sep=<span>"\t"</span>,row.names = <span>1</span>)<br>colnames(rawcount)<br><span>## [1] "WT"     "WT.2"   "WT.3"   "KI2.1"  "KI2.2"  "KI2.3"  "KIKI.1" "KIKI.2"</span><br><span>## [9] "KIKI.3"</span><br>rawcount[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br><span>##           WT WT.2 WT.3 KI2.1</span><br><span>## A1BG     176  292  151   235</span><br><span>## A1BG-AS1 242  366  179   361</span><br><span>## A1CF       2    5    2    18</span><br><span>## A2M        5    1    3    18</span><br><span># 本身就是基因表达矩阵（无需降重与ID转换）；选择二分组的样本</span><br>rawcount=rawcount[,<span>1</span>:<span>6</span>]<br>keep &lt;- rowSums(rawcount&gt;<span>0</span>) &gt;= floor(<span>0.75</span>*ncol(rawcount))<br>filter_count &lt;- rawcount[keep,] <span>#获得filter_count矩阵</span><br>express_cpm &lt;- log2(cpm(filter_count)+ <span>1</span>)<br>express_cpm[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>] <span>#获得cpm矩阵</span><br><span>##                  WT       WT.2       WT.3     KI2.1</span><br><span>## A1BG     1.71773149 1.73333170 1.62106406 1.7477082</span><br><span>## A1BG-AS1 2.05228844 1.96869792 1.79117863 2.2087259</span><br><span>## A1CF     0.03704971 0.05632098 0.03913408 0.2395589</span><br><span>## A2M      0.09089915 0.01144147 0.05831012 0.2395589</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2.获取分组信息</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>#根据列的信息，提取分组信息</span><br>colnames(rawcount) <br><span>## [1] "WT"    "WT.2"  "WT.3"  "KI2.1" "KI2.2" "KI2.3"</span><br>group=rep(c(<span>"WT"</span>,<span>"KI2"</span>),each=<span>3</span>)<br>group<br><span>## [1] "WT"  "WT"  "WT"  "KI2" "KI2" "KI2"</span><br>group_list=factor(group,levels = c(<span>"WT"</span>,<span>"KI2"</span>))<br>table(group_list)<span>#检查一下组别数量</span><br><span>## group_list</span><br><span>##  WT KI2 </span><br><span>##   3   3</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>3.初看两组分析的数据与样本分组分布（箱线图与PCA图）</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>## 01绘制整体表达的箱线图</span><br>exprSet &lt;- express_cpm<br>class(express_cpm)<br><span>## [1] "matrix" "array"</span><br>data &lt;- data.frame(expression=c(exprSet),<br>                   sample=rep(colnames(exprSet),each=nrow(exprSet)))<br><br>p1 &lt;- ggplot(data = data,aes(x=sample,y=expression,fill=sample))+ geom_boxplot() + theme(axis.text.x = element_text(angle = <span>90</span>)) + <br>  xlab(<span>NULL</span>) + ylab(<span>"log2(CPM+1)"</span>)+theme_bw()<br><br><span>## 02绘制PCA图</span><br>dat &lt;- express_cpm<br>dat &lt;- as.data.frame(t(dat))<br>dat &lt;- na.omit(dat)<br>dat$group_list &lt;- group_list<br>dat_pca &lt;- PCA(dat[,-ncol(dat)], graph = <span>FALSE</span>)<span>#画图仅需数值型数据，去掉最后一列的分组信息</span><br>p2 &lt;- fviz_pca_ind(dat_pca,<br>                   geom.ind = <span>"point"</span>, <span># 只显示点，不显示文字</span><br>                   col.ind = dat$group_list, <span># 用不同颜色表示分组</span><br>                   palette = c(<span>"#00AFBB"</span>, <span>"#E7B800"</span>),<br>                   addEllipses = <span>T</span>, <span># 是否圈起来，少于4个样圈不起来</span><br>                   legend.title = <span>"Groups"</span>) + theme_bw()<br>p1+p2<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJSuiaeVBjsETC4GsYfml7g9aRjbgKB1wusKoOzABLR10oYLwNAwl8rxA/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJSuiaeVBjsETC4GsYfml7g9aRjbgKB1wusKoOzABLR10oYLwNAwl8rxA/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>4.1利用edgeR进行差异分析</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>exprSet &lt;- filter_count<br>design &lt;- model.matrix(~<span>0</span>+rev(factor(group_list))) <br>rownames(design) &lt;- colnames(exprSet)<br>colnames(design) &lt;- levels(factor(group_list))<br>DEG &lt;- DGEList(counts=exprSet,  <span>#构建edgeR的DGEList对象</span><br>               group=factor(group_list))<br>DEG$samples$lib.size <br><span>## [1]  76883155 125594216  72735392  99650302  71125317  76094379</span><br>DEG &lt;- calcNormFactors(DEG)<br>DEG$samples$norm.factors<br><span>## [1] 0.9866259 0.9777153 0.9815402 1.0129029 1.0155286 1.0267555</span><br><span># 计算线性模型的参数</span><br>DEG &lt;- estimateGLMCommonDisp(DEG,design)<br>DEG &lt;- estimateGLMTrendedDisp(DEG, design)<br>DEG &lt;- estimateGLMTagwiseDisp(DEG, design)<br><span># 拟合线性模型</span><br>fit &lt;- glmFit(DEG, design)<br>lrt &lt;- glmLRT(fit, contrast=c(<span>1</span>,-<span>1</span>)) <br><span># 提取过滤差异分析结果</span><br>DEG_edgeR &lt;- as.data.frame(topTags(lrt, n=nrow(DEG)))<br>head(DEG_edgeR)<br><span>##                logFC   logCPM       LR PValue FDR</span><br><span>## POSTN     -11.242714 5.157621 7274.735      0   0</span><br><span>## PDE3B     -10.528824 2.818691 2202.143      0   0</span><br><span>## SNURF      -8.407920 4.325858 6381.568      0   0</span><br><span>## SNRPN      -8.407659 4.325598 6382.522      0   0</span><br><span>## CADM3      -7.784327 5.237820 8566.661      0   0</span><br><span>## CADM3-AS1  -7.618800 4.317397 5508.679      0   0</span><br><span># 设定阈值，筛选显著上下调差异基因</span><br>fc &lt;- <span>2.0</span><br>p &lt;- <span>0.05</span><br>DEG_edgeR$regulated &lt;- ifelse(DEG_edgeR$logFC&gt;log2(fc)&amp;DEG_edgeR$PValue&lt;p,<br>                              <span>"up"</span>,ifelse(DEG_edgeR$logFC&lt;(-log2(fc))&amp;DEG_edgeR$PValue&lt;p,<span>"down"</span>,<span>"normal"</span>))<br><span>## 检查edgeR的顺序有没有弄反（易错点哈）</span><br>up=head(DEG_edgeR[DEG_edgeR$regulated==<span>"up"</span>,])[<span>1</span>,] <span>#直接选取第一列上调基因</span><br>upgene &lt;- rownames(up)<br>exp &lt;- c(t(express_cpm[match(upgene,rownames(express_cpm)),]))<br>exp<br><span>## [1] 0.5794278 0.6242658 0.4698412 3.9551960 3.8294548 3.9683540</span><br>test &lt;- data.frame(value=exp, group=group_list)<br><span>library</span>(ggplot2)<br>check_edgeR=ggplot(data=test,aes(x=group,y=value,fill=group)) + geom_boxplot()<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>4.2利用DEseq2进行差异分析</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 查看分组信息和表达矩阵数据</span><br>exprSet &lt;- filter_count<br>dim(exprSet)<br><span>## [1] 18206     6</span><br>table(group_list)<br><span>## group_list</span><br><span>##  WT KI2 </span><br><span>##   3   3</span><br><span># 加载包</span><br><span>library</span>(DESeq2)<br><span># 第一步，构建DESeq2的DESeq对象(建立DEseq数据矩阵)</span><br>colData &lt;- data.frame(row.names=colnames(exprSet),group_list=group_list)<br>dds &lt;- DESeqDataSetFromMatrix(countData = exprSet,colData = colData,design = ~ group_list)<br><span># 第二步，进行差异表达分析</span><br>dds2 &lt;- DESeq(dds)<br><span># 提取差异分析结果，trt组对untrt组的差异分析结果</span><br>tmp &lt;- results(dds2,contrast=c(<span>"group_list"</span>,<span>"KI2"</span>,<span>"WT"</span>))<br>DEG_DESeq2 &lt;- as.data.frame(tmp[order(tmp$padj),])<br>head(DEG_DESeq2)<br><span>##          baseMean log2FoldChange      lfcSE      stat pvalue padj</span><br><span>## ABCC2    8345.615       2.813938 0.03718825  75.66738      0    0</span><br><span>## ADGRL1   2542.280      -2.059138 0.05003988 -41.14994      0    0</span><br><span>## AFAP1L1  2330.490      -2.138101 0.05388025 -39.68246      0    0</span><br><span>## ALDH3A1 11106.359       2.713628 0.03726390  72.82189      0    0</span><br><span>## CADM3    3188.967      -7.792886 0.16262614 -47.91903      0    0</span><br><span>## CD99L2   7041.834      -1.545442 0.03461663 -44.64450      0    0</span><br><span># 去除差异分析结果中包含NA值的行</span><br>DEG_DESeq2 = na.omit(DEG_DESeq2)<br><span># 筛选上下调差异基因，设定阈值</span><br>fc_cutoff &lt;-<span>2.0</span><br>fdr &lt;- <span>0.05</span> <span>#p值</span><br>DEG_DESeq2$regulated &lt;- <span>"normal"</span><br>loc_up &lt;- intersect(which(DEG_DESeq2$log2FoldChange&gt;log2(fc_cutoff)),<br>                    which(DEG_DESeq2$pvalue&lt;fdr))<br>loc_down &lt;- intersect(which(DEG_DESeq2$log2FoldChange&lt; (-log2(fc_cutoff))),<br>                      which(DEG_DESeq2$pvalue&lt;fdr))<br>DEG_DESeq2$regulated[loc_up] &lt;- <span>"up"</span><br>DEG_DESeq2$regulated[loc_down] &lt;- <span>"down"</span><br>table(DEG_DESeq2$regulated)<br><span>## </span><br><span>##   down normal     up </span><br><span>##    694  15679   1127</span><br>DEG_DESeq2$genenames &lt;- rownames(DEG_DESeq2)<br>DEG_DESeq2 &lt;- select(DEG_DESeq2,genenames,everything())<br><span>## 取一个显著上调基因，看看其在标准化的数据中是否上调</span><br>up=head(DEG_DESeq2[DEG_DESeq2$regulated==<span>"up"</span>,])[<span>2</span>,] <span>#直接选取第一列上调基因</span><br>upgene &lt;- rownames(up)<br>exp &lt;- c(t(express_cpm[match(upgene,rownames(express_cpm)),]))<br>test &lt;- data.frame(value=exp, group=group_list)<br><span># 绘制检查箱线图</span><br><span>library</span>(ggplot2)<br>check_DEseq2=ggplot(data=test,aes(x=group,y=value,fill=group)) + geom_boxplot()<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>4.3利用limma做差异分析</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>###limma----voom差异分析</span><br><span>library</span>(limma)<br>exp=filter_count<br>Group=group_list<br>dge &lt;- edgeR::DGEList(counts=exp)<br>dge &lt;- edgeR::calcNormFactors(dge)<br>design &lt;- model.matrix(~Group)<br>v &lt;- voom(dge,design, normalize=<span>"quantile"</span>)<br>fit &lt;- lmFit(v, design)<br>fit= eBayes(fit)<br>DEG_limma = topTable(fit, coef=<span>2</span>, n=<span>Inf</span>)<br>DEG_limma = na.omit(DEG_limma)<br>pvalue_t=<span>0.05</span><br>logFC_t=<span>1</span><br>k1 = (DEG_limma$P.Value &lt; pvalue_t)&amp;(DEG_limma$logFC &lt; -logFC_t)<br>k2 = (DEG_limma$P.Value &lt; pvalue_t)&amp;(DEG_limma$logFC &gt; logFC_t)<br>DEG_limma$regulated = ifelse(k1,<span>"down"</span>,ifelse(k2,<span>"up"</span>,<span>"not"</span>))<br>table(DEG_limma$regulated)<br><span>## </span><br><span>##  down   not    up </span><br><span>##   896 16211  1099</span><br><br>head(DEG_limma[DEG_limma$regulated==<span>"up"</span>,])<br><span>##            logFC  AveExpr        t      P.Value    adj.P.Val        B regulated</span><br><span>## ALDH3A1 2.763111 6.481185 77.56984 1.139142e-21 3.963795e-18 39.88181        up</span><br><span>## ABCC2   2.861579 6.032458 76.89266 1.306315e-21 3.963795e-18 39.61690        up</span><br><span>## FTL     1.248969 9.154473 63.03928 2.901312e-20 5.869031e-17 36.85718        up</span><br><span>## EPGN    1.399917 8.304812 60.89337 4.979348e-20 9.065401e-17 36.33538        up</span><br><span>## NQO1    1.557891 9.092813 58.42708 9.486858e-20 1.570161e-16 35.65063        up</span><br><span>## TP53I3  1.662681 6.665246 55.92285 1.877716e-19 2.848808e-16 35.01935        up</span><br>up=head(DEG_limma[DEG_limma$regulated==<span>"up"</span>,])[<span>1</span>,] <span>#直接选取第一列上调基因</span><br>upgene &lt;- rownames(up)<br>exp &lt;- c(t(express_cpm[match(upgene,rownames(express_cpm)),]))<br>exp<br><span>## [1] 5.129804 5.091980 5.164549 7.864878 7.901136 7.812083</span><br>test &lt;- data.frame(value=exp, group=group_list)<br><span># 绘制检查箱线图</span><br><span>library</span>(ggplot2)<br>check_limma=ggplot(data=test,aes(x=group,y=value,fill=group)) + geom_boxplot()<br>check_DEseq2+check_edgeR+check_limma<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJKhE7NWq91iciczb5D0yWmnw9QwG0UcRibZLZQb4V1Gdge2SP2w3YFia83w/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJKhE7NWq91iciczb5D0yWmnw9QwG0UcRibZLZQb4V1Gdge2SP2w3YFia83w/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>5.绘制三种差异分析的火山图及拼图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>## 01绘制DEG_edgeR的普通版火山图</span><br>data &lt;- DEG_edgeR<br>colnames(data)<br><span>## [1] "logFC"     "logCPM"    "LR"        "PValue"    "FDR"       "regulated"</span><br><span>library</span>(ggplot2)<br>p1.1 &lt;- ggplot(data=data, aes(x=logFC, y=-log10(PValue),color=regulated)) + <br>  geom_point(alpha=<span>0.5</span>, size=<span>1.8</span>) + <br>  theme_set(theme_set(theme_bw(base_size=<span>20</span>))) + <br>  xlab(<span>"log2FC"</span>) + ylab(<span>"-log10(Pvalue)"</span>) +<br>  scale_colour_manual(values = c(<span>'blue'</span>,<span>'black'</span>,<span>'red'</span>))+theme_bw()<br><br><span>## 02绘制DEG_DESeq2的普通版火山图</span><br>data &lt;- DEG_DESeq2<br>colnames(data)<br><span>## [1] "genenames"      "baseMean"       "log2FoldChange" "lfcSE"         </span><br><span>## [5] "stat"           "pvalue"         "padj"           "regulated"</span><br><span>library</span>(ggplot2)<br>p1.2 &lt;- ggplot(data=data, aes(x=log2FoldChange, y=-log10(pvalue),color=regulated)) + <br>  geom_point(alpha=<span>0.5</span>, size=<span>1.8</span>) + <br>  theme_set(theme_set(theme_bw(base_size=<span>20</span>))) + <br>  xlab(<span>"log2FC"</span>) + ylab(<span>"-log10(Pvalue)"</span>) +<br>  scale_colour_manual(values = c(<span>'blue'</span>,<span>'black'</span>,<span>'red'</span>))+theme_bw()<br><br><span>## 03绘制DEG_limma的普通版火山图</span><br>data &lt;- DEG_limma<br>colnames(data)<br><span>## [1] "logFC"     "AveExpr"   "t"         "P.Value"   "adj.P.Val" "B"        </span><br><span>## [7] "regulated"</span><br><span>library</span>(ggplot2)<br>p1.3 &lt;- ggplot(data=data, aes(x=logFC, y=-log10(P.Value),color=regulated)) + <br>  geom_point(alpha=<span>0.5</span>, size=<span>1.8</span>) + <br>  theme_set(theme_set(theme_bw(base_size=<span>20</span>))) + <br>  xlab(<span>"log2FC"</span>) + ylab(<span>"-log10(Pvalue)"</span>) +<br>  scale_colour_manual(values = c(<span>'blue'</span>,<span>'black'</span>,<span>'red'</span>))+theme_bw()<br><br>p1.1+p1.2+p1.3<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJQLQSVvXAR7pvkIMzDxVjyWjv4UGw09icemIsUpOzX72qOATQFcGbKpg/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJQLQSVvXAR7pvkIMzDxVjyWjv4UGw09icemIsUpOzX72qOATQFcGbKpg/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>6.绘制三种差异分析差异基因的韦恩图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>## 由于图表实在太多，Veen图主看下差异基因，感兴趣的可以自身看下上下调差异基因</span><br>deg_edger= rownames(DEG_edgeR[DEG_edgeR$regulated!=<span>"normal"</span>,])<br>deg_deseq2= rownames(DEG_DESeq2[DEG_DESeq2$regulated!=<span>"normal"</span>,])<br>deg_limma= rownames(DEG_limma[DEG_limma$regulated!=<span>"not"</span>,])<br><br><span>library</span>(ggvenn)<br>deg&lt;-list(`deg_edger`=deg_edger,<br>          `deg_deseq2`=deg_deseq2,<br>          `deg_limma`=deg_limma)<br>p2 &lt;- ggvenn(deg,<br>             show_percentage = <span>F</span>,<br>             stroke_color = <span>"white"</span>,<br>             fill_color = c(<span>"#b2d4ec"</span>,<span>"#ffb2b2"</span>,<span>"#d3c0e2"</span>),<br>             set_name_color = c(<span>"#ff0000"</span>,<span>"#4a9b83"</span>,<span>"#b2e7cb"</span>))<br>p2<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJERh9k1wvXU6GrjCqCQVzRm3aO5OD2Z9HTyonyawxr9yM9JbLhlEyCQ/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJERh9k1wvXU6GrjCqCQVzRm3aO5OD2Z9HTyonyawxr9yM9JbLhlEyCQ/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>7.绘制三种差异分析的相关性散点图看看</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>##### 1.先比较edger与DEseq2差异分析的相关性</span><br><span># 01看一看分别比较的整体相关性（此处就看整体差异基因吧）</span><br><span>library</span>(ggstatsplot)<br><span>library</span>(ggpmisc)<br>ids1 = intersect(deg_edger,deg_deseq2) <span>#只有40条，所以得换用富集方法</span><br><span># 02构建可视化所需的矩阵（相关性就两行值）</span><br>df1=data.frame(<br>  deg1=DEG_edgeR[ids1,<span>"logFC"</span>],<br>  deg2=DEG_DESeq2[ids1,<span>"log2FoldChange"</span>] <span>#就是两列logFC的值（散点图）</span><br>)<br>colnames(DEG_DESeq2)<br><span>## [1] "genenames"      "baseMean"       "log2FoldChange" "lfcSE"         </span><br><span>## [5] "stat"           "pvalue"         "padj"           "regulated"</span><br><span># 03绘制相关性图形</span><br>p3.1 &lt;- ggplot(df1, aes(x=df1$deg1,<br>                    df1$deg2))+    <br>  geom_point()+<br>  labs(x = <span>"DEG_edgeR"</span>,<br>       y = <span>"DEG_DESeq2"</span>)+<br>  scale_color_manual(values=c(<span>"blue"</span>, <span>"grey"</span>,<span>"red"</span>))+<br>  geom_vline(xintercept = c( -<span>1.5</span>,<span>0</span>,<span>1.5</span>),lty=<span>4</span>,col=<span>"#ec183b"</span>,lwd=<span>0.8</span>) +<br>  geom_hline(yintercept =  c( -<span>1.5</span>,<span>0</span>,<span>1.5</span>),lty=<span>4</span>,col=<span>"#18a5ec"</span>,lwd=<span>0.8</span>) +<br>  <span>#xlim(-5,5)+</span><br>  <span>#ylim(-3,3)+</span><br>  theme_ggstatsplot()+<br>  theme(panel.grid.minor = element_blank(),<br>        panel.grid.major = element_blank())<br>p3.1=p3.1+stat_poly_eq(aes(label=paste(..eq.label..,..adj.rr.label..,..p.value.label..,sep = <span>"~~~~"</span>)),formula = y~x,parse=<span>T</span>,size=<span>3.0</span>)<br>p3.1<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJTsZm2BkqsniaUW0LT6IrcBcF2tLLyF2XCLm68m7g1Lvic0hevuZtnOxw/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJTsZm2BkqsniaUW0LT6IrcBcF2tLLyF2XCLm68m7g1Lvic0hevuZtnOxw/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code><span>##### 2.比较edger与limma差异分析的相关性</span><br>ids2 = intersect(deg_edger,deg_limma) <br><span># 02构建可视化所需的矩阵（相关性就两行值）</span><br>df2=data.frame(<br>  deg1=DEG_edgeR[ids2,<span>"logFC"</span>],<br>  deg2=DEG_limma[ids2,<span>"logFC"</span>] <span>#就是两列logFC的值（散点图）</span><br>)<br>colnames(DEG_limma)<br><span>## [1] "logFC"     "AveExpr"   "t"         "P.Value"   "adj.P.Val" "B"        </span><br><span>## [7] "regulated"</span><br><span># 03绘制相关性图形</span><br>p3.2 &lt;- ggplot(df2, aes(x=df2$deg1,<br>                    df2$deg2))+    <br>  geom_point()+<br>  labs(x = <span>"DEG_edgeR"</span>,<br>       y = <span>"DEG_limma"</span>)+<br>  scale_color_manual(values=c(<span>"blue"</span>, <span>"grey"</span>,<span>"red"</span>))+<br>  geom_vline(xintercept = c( -<span>1.5</span>,<span>0</span>,<span>1.5</span>),lty=<span>4</span>,col=<span>"#ec183b"</span>,lwd=<span>0.8</span>) +<br>  geom_hline(yintercept =  c( -<span>1.5</span>,<span>0</span>,<span>1.5</span>),lty=<span>4</span>,col=<span>"#18a5ec"</span>,lwd=<span>0.8</span>) +<br>  <span>#xlim(-5,5)+</span><br>  <span>#ylim(-3,3)+</span><br>  theme_ggstatsplot()+<br>  theme(panel.grid.minor = element_blank(),<br>        panel.grid.major = element_blank())<br>p3.2=p3.2+stat_poly_eq(aes(label=paste(..eq.label..,..adj.rr.label..,..p.value.label..,sep = <span>"~~~~"</span>)),formula = y~x,parse=<span>T</span>,size=<span>3.0</span>)<br>p3.2<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJiaAiaBCfdltOZHAj0nSTSGQPW31icePylvicBgV8Uzy1iaAMREhwppQjiaPg/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJiaAiaBCfdltOZHAj0nSTSGQPW31icePylvicBgV8Uzy1iaAMREhwppQjiaPg/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code><span>##### 3.比较DEseq2与limma差异分析的相关性</span><br>ids3 = intersect(deg_deseq2,deg_limma) <br><span># 02构建可视化所需的矩阵（相关性就两行值）</span><br>df3=data.frame(<br>  deg1=DEG_DESeq2[ids3,<span>"log2FoldChange"</span>],<br>  deg2=DEG_limma[ids3,<span>"logFC"</span>] <span>#就是两列logFC的值（散点图）</span><br>)<br>colnames(DEG_DESeq2)<br><span>## [1] "genenames"      "baseMean"       "log2FoldChange" "lfcSE"         </span><br><span>## [5] "stat"           "pvalue"         "padj"           "regulated"</span><br><span># 03绘制相关性图形</span><br>p3.3 &lt;- ggplot(df3, aes(x=df3$deg1,<br>                    df3$deg2))+    <br>  geom_point()+<br>  labs(x = <span>"DEG_DESeq2"</span>,<br>       y = <span>"DEG_limma"</span>)+<br>  scale_color_manual(values=c(<span>"blue"</span>, <span>"grey"</span>,<span>"red"</span>))+<br>  geom_vline(xintercept = c( -<span>1.5</span>,<span>0</span>,<span>1.5</span>),lty=<span>4</span>,col=<span>"#ec183b"</span>,lwd=<span>0.8</span>) +<br>  geom_hline(yintercept =  c( -<span>1.5</span>,<span>0</span>,<span>1.5</span>),lty=<span>4</span>,col=<span>"#18a5ec"</span>,lwd=<span>0.8</span>) +<br>  <span>#xlim(-5,5)+</span><br>  <span>#ylim(-3,3)+</span><br>  theme_ggstatsplot()+<br>  theme(panel.grid.minor = element_blank(),<br>        panel.grid.major = element_blank())<br>p3.3=p3.3+stat_poly_eq(aes(label=paste(..eq.label..,..adj.rr.label..,..p.value.label..,sep = <span>"~~~~"</span>)),formula = y~x,parse=<span>T</span>,size=<span>3.0</span>)<br>p3.3<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJeJ32jHj1B3cWEQRicD5GiaWHGn24EeoRxJK1y4NeiaPY6Dkfz0iak4H1Hw/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJeJ32jHj1B3cWEQRicD5GiaWHGn24EeoRxJK1y4NeiaPY6Dkfz0iak4H1Hw/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code><span>## 拼图看一下，样本之间的相关性</span><br>p3.1+p3.2+p3.3<br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJuSuWh9980L5E1l3ApdTaU8xgxmgbIV9Yr7KbYw7vCYfXtPD1JibNdmg/640?wx_fmt=png" data-type="png" data-w="672" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los95RQLs9BnTia2kP40LpCDQJuSuWh9980L5E1l3ApdTaU8xgxmgbIV9Yr7KbYw7vCYfXtPD1JibNdmg/640?wx_fmt=png"><span>以上就是转录组常见的三种差异分析方法以及三种差异分析方法的区别。</span></p><p data-tool="mdnice编辑器"><strong>「总结：」</strong><span><strong>从韦恩图中可见</strong></span>，三种差异分析的差异基因大部分一样，但是因为判定的标准不同，有些差异基因在某些方法中是差异基因，在某些方法中不是差异基因。<span><strong>相关性分析结果表明</strong></span>，三种差异分析方法中两种差异分析获得的<span>共同差异基因的</span>logFC判定具有非常强的相关性，表明它们的趋势基本完全相同。</p><p data-tool="mdnice编辑器"><span>感兴趣的小伙伴可以尝试分析一下这个数据集哈。在分析自身课题的转录组结果时，可以试试三种方式去分析，多探究探究自己的数据，看看能否获得自身感兴趣的结果。</span></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/2q-wUZHPnsvtn9C3x52Zwg",target="_blank" rel="noopener noreferrer">原文链接</a>
