---
title: "两样本原代乳腺癌细胞与肺部扩散癌细胞单细胞测序数据分析"
date: 2022-09-11T07:42:46Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
两样本原代乳腺癌细胞与肺部扩散癌细胞单细胞测序数据分析 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><pre data-tool="mdnice编辑器"><span></span><code>这周跟大家分享一个乳腺癌两样本单细胞测序数据的背景知识和简单分析。<br></code></pre><p data-tool="mdnice编辑器"><strong>样本处理：</strong></p><p data-tool="mdnice编辑器">将 RFP-Luc 细胞【MCF7（原位ER阳性乳腺癌细胞系）】注射到NSG雌性小鼠的导管树中。导管内注射6个月后，处死2只小鼠;然后将乳腺和肺收集并消化成单个细胞，随后根据 RFP 对 FACS 进行分类。</p><p data-tool="mdnice编辑器">FACS：Fluorescence-activated Cell Sorting 流式细胞荧光分选技术</p><p data-tool="mdnice编辑器">RFP：Red Fluorecent Protein 红色荧光蛋白</p><p data-tool="mdnice编辑器">当我看到单细胞测序数据是人的时候，有点疑惑将细胞注射进小鼠体内后再收集乳腺和肺的细胞，最后测序数据还是人。具体这个原理我还是没有想明白，平时所说的 PDX 模型是将人的肿瘤组织种到小鼠体内，而这个恰恰是将细胞注射进小鼠体内，还是有一定区别的，大家如果有相关背景知识可以留言，让我学习一下。</p><p data-tool="mdnice编辑器"><strong>背景知识：</strong>雌激素受体 α 阳性 (ER+) 乳腺癌 (BCs) 占所有乳腺癌的70%以上，并构成了一个特殊的临床挑战，因为它们在最初诊断和治疗后长达几十年复发。由于缺乏足够的模型，控制肿瘤细胞休眠和潜伏疾病的机制仍然难以捉摸。在这里，比较了 ER+ 和三阴性 TNBC 亚型与临床相关的小鼠导管内异种移植的肿瘤进展。ER+ 和 TNBC 细胞在原位期就已经扩散。然而 TN 扩散性肿瘤细胞 DTCs 增殖速度与原发部位细胞相同，并可引起大转移。ER+ DTCs 增殖指数低，仅形成微转移，从而失去上皮特征。</p><p data-tool="mdnice编辑器"><strong>数据集及链接：</strong>GSE196936  GEO Accession viewer (nih.gov)</p><p data-tool="mdnice编辑器"><strong>数据：</strong></p><figure data-tool="mdnice编辑器"><img data-ratio="0.07186234817813765" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibdKrxfjnf73lRo5asS43Skq6vPHmhpYN6BpcDjmGzXHpBBl0HGgqUZiaDaNDr6XQUibLdxHCrUfwug/640?wx_fmt=png" data-type="png" data-w="988" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibdKrxfjnf73lRo5asS43Skq6vPHmhpYN6BpcDjmGzXHpBBl0HGgqUZiaDaNDr6XQUibLdxHCrUfwug/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code>GSM5904917 Primary_Breast_ Tumor_Cells      <span>#原代乳腺肿瘤细胞</span><br>GSM5904918 Lung_Disseminated_Tumor_Cells    <span>#肺部扩散性肿瘤细胞</span><br><span>#这周所用的数据集是csv格式的</span><br></code></pre><p data-tool="mdnice编辑器"><strong>数据处理：</strong></p><p data-tool="mdnice编辑器"><strong>这个数据集细胞量是比较少的，可能是由于分选过？<br></strong></p><pre data-tool="mdnice编辑器"><span></span><code>Lung Primary <br><span>255</span>    <span>3272</span> <br>过滤后<br>Lung Primary <br> <span>164</span>    <span>2092</span> </code></pre><p data-tool="mdnice编辑器"><strong>导入数据</strong></p><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br>options(stringsAsFactors = <span>F</span>) <br><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(clustree)<br><span>library</span>(cowplot)<br><span>library</span>(dplyr)<br><br><span>###### step1:导入数据 ######   </span><br><span>library</span>(data.table)<br>setwd(<span>"../"</span>)<br>getwd()<br>dir=<span>'./GSE196936_RAW/'</span> <br>samples=list.files( dir )<br>samples<br><br><span>library</span>(data.table)<br>sceList = lapply(samples,<span>function</span>(pro){ <br>  <span># pro=samples[1] </span><br>  print(pro) <br>  <span>#ct=fread( file.path(dir,pro),data.table = F) </span><br>  sce =CreateSeuratObject(counts =  read.csv( file.path(dir,pro)) ,<br>                          project =   gsub(<span>'.csv'</span>,<span>''</span>,gsub(<span>'^GSM[0-9]*_MCF7_'</span>,<span>''</span>,pro) ) ,<br>                          min.cells = <span>5</span>,<br>                          min.features = <span>300</span> )<br>  <span>return</span>(sce)<br>})<br>sceList <br>samples<br><span># gsub('^GSM[0-9]*','',samples) </span><br>sce.all=merge(x=sceList[[<span>1</span>]],<br>              y=sceList[ -<span>1</span> ],<br>              add.cell.ids =   gsub(<span>'.csv'</span>,<span>''</span>,gsub(<span>'^GSM[0-9]*_MCF7_'</span>,<span>''</span>,samples) )  )<br><br>as.data.frame(sce.all@assays$RNA@counts[<span>1</span>:<span>10</span>, <span>1</span>:<span>2</span>])<br>head(sce.all@meta.data, <span>10</span>)<br>table(sce.all$orig.ident)<br><br><span>library</span>(stringr)<br>sce.all$group=sce.all$orig.ident<br>table(sce.all@meta.data$group)<br>table(sce.all@meta.data$orig.ident<br><span>#rm(list=ls())</span><br><span>###### step2:QC质控 ######</span><br>dir.create(<span>"./1-QC"</span>)<br>setwd(<span>"./1-QC"</span>)<br><span># sce.all=readRDS("../sce.all_raw.rds")</span><br><span>#计算线粒体基因比例</span><br><span># 人和鼠的基因名字稍微不一样 </span><br>mito_genes=rownames(sce.all)[grep(<span>"^MT-"</span>, rownames(sce.all))] <br>mito_genes <span>#13个线粒体基因</span><br>sce.all=PercentageFeatureSet(sce.all, <span>"^MT-"</span>, col.name = <span>"percent_mito"</span>)<br>fivenum(sce.all@meta.data$percent_mito)<br><span>#计算核糖体基因比例</span><br>ribo_genes=rownames(sce.all)[grep(<span>"^Rp[sl]"</span>, rownames(sce.all),ignore.case = <span>T</span>)]<br>ribo_genes<br>sce.all=PercentageFeatureSet(sce.all, <span>"^RP[SL]"</span>, col.name = <span>"percent_ribo"</span>)<br>fivenum(sce.all@meta.data$percent_ribo)<br><span>#计算红血细胞基因比例</span><br>rownames(sce.all)[grep(<span>"^Hb[^(p)]"</span>, rownames(sce.all),ignore.case = <span>T</span>)]<br>sce.all=PercentageFeatureSet(sce.all, <span>"^HB[^(P)]"</span>, col.name = <span>"percent_hb"</span>)<br>fivenum(sce.all@meta.data$percent_hb)<br><span>#可视化细胞的上述比例情况</span><br>feats &lt;- c(<span>"nFeature_RNA"</span>, <span>"nCount_RNA"</span>, <span>"percent_mito"</span>, <span>"percent_ribo"</span>, <span>"percent_hb"</span>)<br>feats &lt;- c(<span>"nFeature_RNA"</span>, <span>"nCount_RNA"</span>)<br>p1=VlnPlot(sce.all, group.by = <span>"orig.ident"</span>, features = feats, pt.size = <span>0</span>, ncol = <span>2</span>) + <br>  NoLegend()<br>p1<br><span>library</span>(ggplot2) <br>ggsave(filename=<span>"Vlnplot1.pdf"</span>,plot=p1)<br>feats &lt;- c(<span>"percent_mito"</span>, <span>"percent_ribo"</span>, <span>"percent_hb"</span>)<br>p2=VlnPlot(sce.all, group.by = <span>"orig.ident"</span>, features = feats, pt.size = <span>0</span>, ncol = <span>3</span>, same.y.lims=<span>T</span>) + <br>  scale_y_continuous(breaks=seq(<span>0</span>, <span>100</span>, <span>5</span>)) +<br>  NoLegend()<br>p2 <br>ggsave(filename=<span>"Vlnplot2.pdf"</span>,plot=p2)<br><br>p3=FeatureScatter(sce.all, <span>"nCount_RNA"</span>, <span>"nFeature_RNA"</span>, group.by = <span>"orig.ident"</span>, pt.size = <span>0.5</span>)<br>ggsave(filename=<span>"Scatterplot.pdf"</span>,plot=p3)<br><span>#根据上述指标，过滤低质量细胞/基因</span><br><span>#过滤指标1:最少表达基因数的细胞&amp;最少表达细胞数的基因</span><br>selected_c &lt;- WhichCells(sce.all, expression = nFeature_RNA &gt; <span>300</span>)<br>selected_f &lt;- rownames(sce.all)[Matrix::rowSums(sce.all@assays$RNA@counts &gt; <span>0</span> ) &gt; <span>3</span>]<br><br>sce.all.filt &lt;- subset(sce.all, features = selected_f, cells = selected_c)<br>dim(sce.all) <br>dim(sce.all.filt) <br><span>#  可以看到，主要是过滤了基因，其次才是细胞</span><br>C=sce.all.filt@assays$RNA@counts<br>dim(C)<br>C=Matrix::t(Matrix::t(C)/Matrix::colSums(C)) * <span>100</span><br><span># 这里的C 这个矩阵，有一点大，可以考虑随抽样</span><br>C=C[,sample(<span>1</span>:ncol(C),<span>1000</span>)]<br>most_expressed &lt;- order(apply(C, <span>1</span>, median), decreasing = <span>T</span>)[<span>50</span>:<span>1</span>]<br>pdf(<span>"TOP50_most_expressed_gene.pdf"</span>,width=<span>14</span>)<br>boxplot(as.matrix(Matrix::t(C[most_expressed, ])),<br>        cex = <span>0.1</span>, las = <span>1</span>, <br>        xlab = <span>"% total count per cell"</span>, <br>        col = (scales::hue_pal())(<span>50</span>)[<span>50</span>:<span>1</span>], <br>        horizontal = <span>TRUE</span>)<br>dev.off()<br>rm(C)<br><span>#过滤指标2:线粒体/核糖体基因比例(根据上面的violin图)</span><br>selected_mito &lt;- WhichCells(sce.all.filt, expression = percent_mito &lt; <span>15</span>)<br>selected_ribo &lt;- WhichCells(sce.all.filt, expression = percent_ribo &gt; <span>3</span>)<br>selected_hb &lt;- WhichCells(sce.all.filt, expression = percent_hb &lt; <span>1</span> )<br>length(selected_hb)<br>length(selected_ribo)<br>length(selected_mito)<br>sce.all.filt &lt;- subset(sce.all.filt, cells = selected_mito)<br>sce.all.filt &lt;- subset(sce.all.filt, cells = selected_ribo)<br>sce.all.filt &lt;- subset(sce.all.filt, cells = selected_hb)<br>dim(sce.all.filt)<br>table(sce.all.filt$orig.ident) <br><br><span>#可视化过滤后的情况</span><br>feats &lt;- c(<span>"nFeature_RNA"</span>, <span>"nCount_RNA"</span>)<br>p1_filtered=VlnPlot(sce.all.filt, group.by = <span>"orig.ident"</span>, features = feats, pt.size = <span>0</span>, ncol = <span>2</span>) + <br>  NoLegend()<br>ggsave(filename=<span>"Vlnplot1_filtered.pdf"</span>,plot=p1_filtered)<br><br>feats &lt;- c(<span>"percent_mito"</span>, <span>"percent_ribo"</span>, <span>"percent_hb"</span>)<br>p2_filtered=VlnPlot(sce.all.filt, group.by = <span>"orig.ident"</span>, features = feats, pt.size = <span>0</span>, ncol = <span>3</span>) + <br>  NoLegend()<br>ggsave(filename=<span>"Vlnplot2_filtered.pdf"</span>,plot=p2_filtered)<br><span>#过滤指标3:过滤特定基因</span><br><span># Filter MALAT1 管家基因</span><br>sce.all.filt &lt;- sce.all.filt[!grepl(<span>"MALAT1"</span>, rownames(sce.all.filt),ignore.case = <span>T</span>), ]<br><span># Filter Mitocondrial 线粒体基因</span><br>sce.all.filt &lt;- sce.all.filt[!grepl(<span>"^MT-"</span>, rownames(sce.all.filt),ignore.case = <span>T</span>), ]<br><span># 当然，还可以过滤更多</span><br>dim(sce.all.filt) <br>dim(sce.all) <br>saveRDS(sce.all.filt, <span>"sce.all_qc2_noG.rds"</span>)<br><span>#sce.all.fit 212.5MB</span><br>setwd(<span>'../'</span>)<br><span>source</span>(<span>'step2-harmony.R'</span>)<br><span>source</span>(<span>'step3.1-check-marker.R'</span>)<br></code></pre><p data-tool="mdnice编辑器"><strong>降维分群</strong></p><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br>dir.create(<span>"./20220901_GSE196936/2-harmony"</span>)<br>getwd()<br>setwd(<span>"./20220901_GSE196936/2-harmony"</span>)<br>sce.all=readRDS(<span>"./1-QC/sce.all_qc2_noG.rds"</span>)<br>sce=sce.all<br>sce<br>sce &lt;- NormalizeData(sce, <br>                         normalization.method = <span>"LogNormalize"</span>,<br>                         scale.factor = <span>1e4</span>) <br>sce &lt;- FindVariableFeatures(sce)<br>sce &lt;- ScaleData(sce)<br>sce &lt;- RunPCA(sce, features = VariableFeatures(object = sce))<br><br><span>library</span>(harmony)<br>seuratObj &lt;- RunHarmony(sce, <span>"orig.ident"</span>)<br>names(seuratObj@reductions)<br>seuratObj &lt;- RunUMAP(seuratObj,  dims = <span>1</span>:<span>15</span>, <br>                     reduction = <span>"harmony"</span>)<br>DimPlot(seuratObj,reduction = <span>"umap"</span>,label=<span>T</span> ) <br><br>sce=seuratObj<br>sce &lt;- FindNeighbors(sce, reduction = <span>"harmony"</span>,<br>                     dims = <span>1</span>:<span>15</span>) <br>sce.all=sce<br><span>#设置不同的分辨率，观察分群效果</span><br><span>for</span> (res <span>in</span> c(<span>0.01</span>, <span>0.05</span>, <span>0.1</span>, <span>0.2</span>, <span>0.3</span>, <span>0.5</span>,<span>0.8</span>,<span>1</span>)) {<br>  sce.all=FindClusters(sce.all, <span>#graph.name = "CCA_snn", </span><br>                       resolution = res, algorithm = <span>1</span>)<br>}<br>colnames(sce.all@meta.data)<br>apply(sce.all@meta.data[,grep(<span>"RNA_snn"</span>,colnames(sce.all@meta.data))],<span>2</span>,table)<br><br>p1_dim=plot_grid(ncol = <span>3</span>, DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"RNA_snn_res.0.01"</span>) + <br>                   ggtitle(<span>"louvain_0.01"</span>), DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"RNA_snn_res.0.1"</span>) + <br>                   ggtitle(<span>"louvain_0.1"</span>), DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"RNA_snn_res.0.2"</span>) + <br>                   ggtitle(<span>"louvain_0.2"</span>))<br>ggsave(plot=p1_dim, filename=<span>"Dimplot_diff_resolution_low.pdf"</span>,width = <span>14</span>)<br><br>p1_dim=plot_grid(ncol = <span>3</span>, DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"RNA_snn_res.0.8"</span>) + <br>                   ggtitle(<span>"louvain_0.8"</span>), DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"RNA_snn_res.1"</span>) + <br>                   ggtitle(<span>"louvain_1"</span>), DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"RNA_snn_res.0.3"</span>) + <br>                   ggtitle(<span>"louvain_0.3"</span>))<br>ggsave(plot=p1_dim, filename=<span>"Dimplot_diff_resolution_high.pdf"</span>,width = <span>18</span>)<br><br>p2_tree=clustree(sce.all@meta.data, prefix = <span>"RNA_snn_res."</span>)<br>ggsave(plot=p2_tree, filename=<span>"Tree_diff_resolution.pdf"</span>)<br><br><span>#接下来分析，按照分辨率为0.1进行 </span><br>sel.clust = <span>"RNA_snn_res.0.1"</span><br>sce.all &lt;- SetIdent(sce.all, value = sel.clust)<br>table(sce.all@active.ident) <br>saveRDS(sce.all, <span>"sce.all_int.rds"</span>)<br>sce.all=readRDS(<span>"./2-harmony/sce.all_int.rds"</span>)<br></code></pre><p data-tool="mdnice编辑器"><strong>检查常见分群情况</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>###### step5:检查常见分群情况  ######</span><br>setwd(<span>'../'</span>)<br>dir.create(<span>"3-cell"</span>)<br>setwd(<span>"3-cell"</span>)  <br>getwd()<br>DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"seurat_clusters"</span>,label = <span>T</span>) <br>DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"RNA_snn_res.0.1"</span>,label = <span>T</span>) <br>ggsave(<span>'umap_by_RNA_snn_res.0.1.pdf'</span>)<br><br><span>library</span>(stringr)<br><span>#刚开始只找了一些基础marker分不太开</span><br><span>#genes_to_check = c('PTPRC', 'CD3D', 'CD3E', 'CD8A',</span><br>             <span># 'CD19', 'CD79A', 'MS4A1' , 'IGHG1', </span><br>             <span># 'MZB1', 'SDC1',</span><br>                <span>#   'CD68', 'CD163', 'CD14', </span><br>                  <span># 'RCVRN',</span><br>                  <span># 'FGF7','MME',</span><br>                  <span># 'PECAM1', 'VWF', </span><br>                <span>#'EPCAM' , 'KRT19', 'PROM1', 'ALDH1A1')</span><br><br><span>#genes_to_check=unique(genes_to_check)</span><br><span>#genes_to_check = str_to_upper(genes_to_check)</span><br><span>#因此又多找了一些marker</span><br>genes_to_check = (<span>"PTPRC"</span>,<span>"CD3D"</span>,<span>"CD3E"</span>,<span>"CD8A"</span>,<span>"CD19"</span>,<br>              <span>"CD79A"</span>,<span>"MS4A1"</span>,<span>"IGHG1"</span>,<span>"MZB1"</span>,<span>"SDC1"</span>,<br>              <span>"CD68"</span>,<span>"CD163"</span>,<span>"CD14"</span>,<span>"RCVRN"</span>,<span>"FGF7"</span>,    <br>              <span>"MME"</span>, <span>"PECAM1"</span>,<span>"VWF"</span>,<span>"EPCAM"</span>,<span>"KRT19"</span>,   <br>          <span>"PROM1"</span>,<span>"ALDH1A1"</span>,<span>"AGER"</span>,<span>"SFTPA1"</span>,<span>"SCGB1A1"</span>, <br>                <span>"KRT17"</span>,<span>"TPPP3"</span>,<span>"KRT4"</span>,<span>"KRT14"</span>,<span>"KRT8"</span>, <br>                <span>"KRT18"</span>,<span>"CD4"</span>,<span>"CCR7"</span>,<span>"SELL"</span>,<span>"TCF7"</span>,    <br>             <span>"CXCR6"</span>,<span>"ITGA1"</span>,<span>"FOXP3"</span>,<span>"IL2RA"</span>,<span>"CTLA4"</span>,   <br>                <span>"GZMB"</span>,<span>"GZMK"</span>,<span>"CCL5"</span>,<span>"IFNG"</span>,<span>"CCL4"</span>,    <br>                <span>"CCL3"</span>,<span>"PRF1"</span>,<span>"NKG7"</span>,<span>"CD22"</span>,<span>"TCL1A"</span>,  <br>           <span>"CD83"</span>,<span>"CD38"</span>,<span>"TNFRSF17"</span>, <span>"IGHG4"</span>,<span>"TPSAB1"</span>, <br>             <span>"TPSB2"</span>,<span>"Krt17"</span>,<span>"Krt14"</span>,<span>"Krt5"</span>,<span>"Acta2"</span> ,  <br>              <span>"Myl9"</span>,<span>"Mylk"</span>, <span>"Myh11"</span>,<span>"Krt19"</span>, <span>"Krt18"</span> , <br>                <span>"Krt8"</span>,<span>"Prlr"</span>, <span>"Cited1"</span> <span>"Pgr"</span>, <span>"Prom1"</span>, <br>                <span>"Esr1"</span>,<span>"Mfge8"</span>,<span>"Trf"</span>,<span>"Csn3"</span>,<span>"Wfdc18"</span>,  <br>            <span>"Elf5"</span>,<span>"Ltf"</span>, <span>"Kit"</span>,<span>"Aldh1a3"</span>,<span>"Cd14"</span>,    <br>               <span>"CD45+"</span>, <span>"CD10+"</span>,<span>"CD31+"</span>,<span>"ACTA2"</span>,<span>"APOE"</span>, <br>                <span>"TIMP1"</span>, <span>"TAGLN"</span>,<span>"SLPI"</span>,<span>"LTF"</span>,<span>"AGR2"</span>,   <br>              <span>"KLRD1"</span>,<span>"FCGR3B"</span>,<span>"RPE65"</span>,<span>"MKI67"</span>,<span>"TOP2A"</span>, <br>                <span>"MLANA"</span>,<span>"MITF"</span>,<span>"DCT"</span>,<span>"PRAME"</span>, <span>"GEP"</span>,   <br>                <span>"CD24"</span>,<span>"ZEB2"</span>,<span>"CDH1"</span>,<span>"ESR1"</span>,<span>"VIM"</span>     <br>                <span>"FN1"</span>,<span>"ELN"</span>,<span>"COL3A1"</span>) <br>genes_to_check=unique(genes_to_check)<br>genes_to_check = str_to_upper(genes_to_check)<br><br><span>library</span>(stringr)  <br>p_paper_markers &lt;- DotPlot(sce.all, features = genes_to_check,<br>                           assay=<span>'RNA'</span>  )  + coord_flip()<br><br>p_paper_markers<br>ggsave(plot=p_paper_markers,<br>       filename=<span>"check_paper_marker_by_seurat_cluster.pdf"</span>,width = <span>12</span>)<br></code></pre><p data-tool="mdnice编辑器">除了上述情况我在找乳腺上皮细胞的marker的时候看到之前单细胞天地发的 ” 乳腺上皮细胞单细胞亚群“ 的推文<a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247502849&amp;idx=1&amp;sn=07ab747e457553e8d9e05fea707a6333&amp;scene=21#wechat_redirect" data-linktype="2">乳腺上皮细胞单细胞亚群 (qq.com)</a></p><pre data-tool="mdnice编辑器"><span></span><code>Myo=c(<span>"Krt17"</span>, <span>"Krt14"</span>, <span>"Krt5"</span>, <span>"Acta2"</span>, <span>"Myl9"</span>, <span>"Mylk"</span>, <span>"Myh11"</span>)<br>Lum=c(<span>"Krt19"</span>, <span>"Krt18"</span>, <span>"Krt8"</span>)<br>Hs=c(<span>"Prlr"</span>, <span>"Cited1"</span>, <span>"Pgr"</span>, <span>"Prom1"</span>, <span>"Esr1"</span>)  <br>AV=c(<span>"Mfge8"</span>, <span>"Trf"</span>, <span>"Csn3"</span>, <span>"Wfdc18"</span>, <span>"Elf5"</span>, <span>"Ltf"</span>)<br>Lp=c(<span>"Kit"</span>, <span>"Aldh1a3"</span>, <span>"Cd14"</span>)<br>genes_to_check = list(<br>  Myo=Myo,<br>  Lum=Lum,<br>  Hs=Hs, <br>  AV=AV,<br>  Lp=Lp ) <br></code></pre><p><img data-ratio="0.9975845410628019" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosibdKrxfjnf73lRo5asS43Skyh9PA8vWeURcAJNRVa1n9fb7yE83PhU0WQjwTWQiauK7RXL4a486CSA/640?wx_fmt=jpeg" data-type="jpeg" data-w="828" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosibdKrxfjnf73lRo5asS43Skyh9PA8vWeURcAJNRVa1n9fb7yE83PhU0WQjwTWQiauK7RXL4a486CSA/640?wx_fmt=jpeg"></p><p data-tool="mdnice编辑器"><strong>细胞生物学命名注释</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span># 需要自行看图，定细胞亚群： </span><br><span># 为了方便，直接 RNA_snn_res.0.1， 放弃 RNA_snn_res.0.8 </span><br>celltype=data.frame(ClusterID=<span>0</span>:<span>5</span> ,<br>                    celltype= <span>0</span>:<span>5</span>) <br><span>#定义细胞亚群      </span><br>celltype[celltype$ClusterID %<span>in</span>% c( <span>5</span>),<span>2</span>]=<span>'fibo'</span>  <br>celltype[celltype$ClusterID %<span>in</span>% c( <span>3</span>),<span>2</span>]=<span>'low-cell'</span> <br>celltype[celltype$ClusterID %<span>in</span>% c( <span>0</span>,<span>1</span>,<span>4</span>),<span>2</span>]=<span>'epi'</span> <br>celltype[celltype$ClusterID %<span>in</span>% c( <span>2</span>),<span>2</span>]=<span>'cycling cell'</span><br>head(celltype)<br>celltype<br>table(celltype$celltype)<br>sce.all@meta.data$celltype = <span>"NA"</span><br><br><span>for</span>(i <span>in</span> <span>1</span>:nrow(celltype)){<br>  sce.all@meta.data[which(sce.all@meta.data$RNA_snn_res.0.1 == celltype$ClusterID[i]),<span>'celltype'</span>] &lt;- celltype$celltype[i]}<br>table(sce.all@meta.data$celltype)<br><br>th=theme(axis.text.x = element_text(angle = <span>45</span>, <br>                                    vjust = <span>0.5</span>, hjust=<span>0.5</span>)) <br> <br>p &lt;- DotPlot(sce.all, features = unique(genes_to_check),<br>             assay=<span>'RNA'</span> ,group.by = <span>'celltype'</span> )  + coord_flip()  +th<br><br>p<br>ggsave(plot=p, filename=<span>"check_marker_by_celltype.pdf"</span>,<br>       width = <span>8</span> ,height = <span>10</span>)<br><br>DotPlot(sce.all, features = genes_to_check,<br>        assay=<span>'RNA'</span> ,group.by = <span>'celltype'</span> ) + <br>  coord_flip()+ scale_y_discrete(guide = guide_axis(n.dodge = <span>2</span>)) +<br>  <span>NULL</span><br><br>table(sce.all@meta.data$celltype,sce.all@meta.data$RNA_snn_res.0.1)<br>table(sce.all@meta.data$celltype,sce.all@meta.data$orig.ident)<br><br><span>#拼图  </span><br><span>library</span>(patchwork)<br>p_umap=DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"celltype"</span>,label = <span>F</span>)<br>p+p_umap<br>ggsave(<span>'markers_umap_by_celltype_2.pdf'</span>,width = <span>12</span>,height = <span>10</span>)<br></code></pre><p><img data-ratio="0.8308004052684904" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosibdKrxfjnf73lRo5asS43SkfqD33f4sOjflFNspxicN9qrQ4QskZicpMkIRl3XRDSXEbhOYBHaibkscA/640?wx_fmt=jpeg" data-type="jpeg" data-w="987" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosibdKrxfjnf73lRo5asS43SkfqD33f4sOjflFNspxicN9qrQ4QskZicpMkIRl3XRDSXEbhOYBHaibkscA/640?wx_fmt=jpeg"></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p><strong>重新降维和细分亚群</strong></p><pre><code>rm(list=ls())<br><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(clustree)<br><span>library</span>(cowplot)<br><span>library</span>(dplyr)<br> getwd()<br>sce=readRDS(<span>'E:/sxjns/公众号文献解读/20220901_GSE196936_乳腺癌/20220901_GSE196936/2-harmony/sce.all_int.rds'</span>)<br>colnames(sce@meta.data)<br>table(sce$RNA_snn_res.0.1)<br><br>sce=sce[,sce$RNA_snn_res.0.1 %<span>in</span>% c(<span>0</span>,<span>1</span>,<span>2</span>)]<br>DimPlot(sce, reduction = <span>"umap"</span>, label = <span>T</span>) + <br>    DimPlot(sce, reduction = <span>"umap"</span>,group.by = <span>'orig.ident'</span>, label = <span>T</span>)<br>pp&lt;-FeaturePlot(sce,<span>'EPCAM'</span>)<br>pp<br>ggsave(<span>"epcam.pdf"</span>,width = <span>6</span>,height = <span>6</span>)<br><br>sce<br>sce=CreateSeuratObject(counts = sce@assays$RNA@counts,<br>                       meta.data = sce@meta.data)<br>sce &lt;- NormalizeData(sce, normalization.method =  <span>"LogNormalize"</span>,  <br>                     scale.factor = <span>1e4</span>)<br>GetAssay(sce,assay = <span>"RNA"</span>)<br>sce &lt;- FindVariableFeatures(sce, <br>                            selection.method = <span>"vst"</span>, nfeatures = <span>2000</span>)  <br>sce &lt;- ScaleData(sce) <br>sce &lt;- RunPCA(object = sce, pc.genes = VariableFeatures(sce)) <br>DimHeatmap(sce, dims = <span>1</span>:<span>12</span>, cells = <span>100</span>, balanced = <span>TRUE</span>)<br>ElbowPlot(sce) <br><br>sce &lt;- FindNeighbors(sce, dims = <span>1</span>:<span>15</span>)<br>sce &lt;- FindClusters(sce, resolution = <span>0.8</span>)<br>table(sce@meta.data$RNA_snn_res.0.8)  <br><br>set.seed(<span>123</span>)<br>sce &lt;- RunTSNE(object = sce, dims = <span>1</span>:<span>15</span>, do.fast = <span>TRUE</span>)<br>DimPlot(sce,reduction = <span>"tsne"</span>,label=<span>T</span>)<br><br>sce &lt;- RunUMAP(object = sce, dims = <span>1</span>:<span>15</span>, do.fast = <span>TRUE</span>)<br>DimPlot(sce,reduction = <span>"umap"</span>,label=<span>T</span>) <br>head(sce@meta.data)<br>DimPlot(sce,reduction = <span>"umap"</span>,label=<span>T</span>,group.by = <span>'orig.ident'</span>) <br><br><span># sce &lt;- FindClusters(sce, resolution = 0.1)</span><br><br>getwd()<br>dir.create(<span>"./outputs_figure"</span>)<br>setwd(<span>"E:/sxjns/公众号文献解读/20220901_GSE196936_乳腺癌/20220901_GSE196936/sub_epi/outputs_figure/"</span>)<br><span>#figure正图</span><br>DimPlot(sce,reduction = <span>"umap"</span>,label=<span>T</span>) <br>ggsave(filename = <span>'umap_recluster_by_0.8.pdf'</span>,width = <span>8</span>,height = <span>7</span>) <br>DimPlot(sce,reduction = <span>"umap"</span>,label=<span>T</span>,<br>        group.by = <span>'orig.ident'</span>) <br>ggsave(filename = <span>'umap_sce_recluster_by_orig.ident.pdf'</span>,width = <span>8</span>,height = <span>7</span>)<br><br>tab.1=table(sce@meta.data$seurat_clusters,sce@meta.data$orig.ident)<br>colnames(sce@meta.data)   <br><span>library</span>(gplots)<br>tab.1 <br>pro=<span>'before_harmony'</span><br>pdf(file = paste0(pro,<span>'  seurat_clusters VS  orig.ident.pdf'</span>),<br>    width = <span>10</span>,height  = <span>10</span>)<br>balloonplot(tab.1, main =<span>" seurat_clusters VS  orig.ident "</span>, xlab =<span>""</span>, ylab=<span>""</span>,<br>            label = <span>T</span>, show.margins = <span>F</span>)<br>dev.off() <br><br>colnames(sce@meta.data)  <br><br><span>library</span>(harmony)<br>seuratObj &lt;- RunHarmony(sce, <span>"orig.ident"</span>)<br>names(seuratObj@reductions)<br>seuratObj &lt;- RunUMAP(seuratObj,  dims = <span>1</span>:<span>15</span>, <br>                     reduction = <span>"harmony"</span>)<br>DimPlot(seuratObj,reduction = <span>"umap"</span>,label=<span>T</span> )  <br><br><br>sce=seuratObj<br>sce &lt;- FindNeighbors(sce, reduction = <span>"harmony"</span>,<br>                     dims = <span>1</span>:<span>15</span>)<br>sce &lt;- FindClusters(sce, resolution = <span>0.8</span>)<br>table(sce@meta.data$seurat_clusters)<br>DimPlot(sce,reduction = <span>"umap"</span>,label=<span>T</span>) <br>ggsave(filename = <span>'harmony_umap_recluster_by_0.8.pdf'</span>,width = <span>8</span>,height = <span>7</span>) <br>DimPlot(sce,reduction = <span>"umap"</span>,label=<span>T</span>,<br>        group.by = <span>'orig.ident'</span>) <br>ggsave(filename = <span>'harmony_umap_sce_recluster_by_orig.ident.pdf'</span>,width = <span>8</span>,height = <span>7</span>) <br><br>tab.1=table(sce@meta.data$orig.ident,sce@meta.data$seurat_clusters)<br>colnames(sce@meta.data)   <br><span>library</span>(gplots)<br>tab.1 <br>pro=<span>'after_harmony'</span><br>pdf(file = paste0(pro,<span>'  seurat_clusters VS  orig.ident.pdf'</span>),<br>    width = <span>8</span>,height  = <span>8</span>)<br>balloonplot(tab.1, main =<span>" seurat_clusters VS  orig.ident "</span>, xlab =<span>""</span>, ylab=<span>""</span>,<br>            label = <span>T</span>, show.margins = <span>F</span>)<br>dev.off() <br>save(sce,file = <span>'first_sce.Rdata'</span>)<br><br><span>library</span>(ggplot2)<br>Myo=c(<span>"Krt17"</span>, <span>"Krt14"</span>, <span>"Krt5"</span>, <span>"Acta2"</span>, <span>"Myl9"</span>, <span>"Mylk"</span>, <span>"Myh11"</span>)<br>Lum=c(<span>"Krt19"</span>, <span>"Krt18"</span>, <span>"Krt8"</span>)<br>Hs=c(<span>"Prlr"</span>, <span>"Cited1"</span>, <span>"Pgr"</span>, <span>"Prom1"</span>, <span>"Esr1"</span>)  <br>AV=c(<span>"Mfge8"</span>, <span>"Trf"</span>, <span>"Csn3"</span>, <span>"Wfdc18"</span>, <span>"Elf5"</span>, <span>"Ltf"</span>)<br>Lp=c(<span>"Kit"</span>, <span>"Aldh1a3"</span>, <span>"Cd14"</span>)<br>genes_to_check = list(<br>  Myo=Myo,<br>  Lum=Lum,<br>  Hs=Hs, <br>  AV=AV,<br>  Lp=Lp ) <br>genes_to_check=unique(unlist(genes_to_check))<br>genes_to_check = str_to_upper(genes_to_check)<br>p1 &lt;- DotPlot(sce, features = genes_to_check,<br>             assay=<span>'RNA'</span> ,<br>             group.by = <span>"RNA_snn_res.0.8"</span> )  + coord_flip()<br>p1  <br>p2 &lt;- DimPlot(sce,reduction = <span>"umap"</span>,label=<span>T</span>,<br>        group.by = <span>"RNA_snn_res.0.8"</span> ) <br><span>library</span>(patchwork)<br>p1+p2<br>ggsave(<span>'harmony_res.0.1_umap_markers.pdf'</span>,width = <span>15</span>,height = <span>10</span>)<span></span></code></pre></section></section><p><img data-ratio="0.661847389558233" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosibdKrxfjnf73lRo5asS43SkeVdzS7jrFe7Vwk4cPV6F75pek3NgOsbJ8lViaVaqaW6f0epHd8GQUGw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1245" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosibdKrxfjnf73lRo5asS43SkeVdzS7jrFe7Vwk4cPV6F75pek3NgOsbJ8lViaVaqaW6f0epHd8GQUGw/640?wx_fmt=jpeg"></p><p><span><span>根据乳腺癌的Myo,Lum,Hs,Av,Lp的几种分型marker来看,每个分群都有"Krt19", "Krt18", "Krt8","ESR1"四个marker，可能细分后的这些都属于Luminal上皮细胞亚群。</span></span><br></p><p><span><span>针对该数据还可以继续做两个样本的差异分析，大家可以一块来试试。</span></span></p><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/sgz1jBRa_92b_ltflX5cww",target="_blank" rel="noopener noreferrer">原文链接</a>
