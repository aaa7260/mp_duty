---
title: "大佬高分文章中的富集条形图怎么画？轻松展示上下调！"
date: 2023-02-26T03:25:35Z
draft: ["false"]
tags: [
  "fetched",
  "SCIPainter"
]
categories: ["Acdemic"]
---
大佬高分文章中的富集条形图怎么画？轻松展示上下调！ by SCIPainter
------
<div><p data-mpa-powered-by="yiban.io"><span>关于文献常用的两种富集条形图的绘制可戳往期：</span><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA5NzQzOTgzMw==&amp;mid=2650965027&amp;idx=2&amp;sn=a67b766d6da06ac1aae3029d86b23a3a&amp;chksm=8b56fd15bc217403898aa4e081a8fd277b2310be689d0c7d7817868dec43c5d39510499ca083&amp;scene=21#wechat_redirect" textvalue="《拿捏2种富集条形图绘制方法！》" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">《拿捏2种富集条形图绘制方法！》</a></span></p><p><span><br></span></p><p><span>不过使用常规富集条形图展示富集结果时，无法在图中显示上下调。那如何在一图中展现上下调结果呢？今天就来学习一种双侧柱形图的绘制方法，复现案例如下图：</span></p><p><span><br></span></p><p><img data-ratio="0.8262008733624454" data-type="png" data-w="1145" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTezLfpZuVEEDfaia5OQdiaRIibB4JdYovBwsVJticL9sGbShpicSwnob9hlw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTezLfpZuVEEDfaia5OQdiaRIibB4JdYovBwsVJticL9sGbShpicSwnob9hlw/640?wx_fmt=png"></p><p><span>（<em>Nat Commun</em>，2022）</span></p><p><br></p><p><span>使用这样的双侧条形图，可以在一张图中轻松展示上调和下调基因（</span><span>log<sub>2</sub></span><span>FC）的KEGG或GO富集结果，又或是用于展示GSEA的正负ES/NES得分等。</span></p><p><br></p><p><span>且这张图中的pathway标签位置分别位于条形图左右两测而非仅全在左边，也是今天我们需要掌握的重点。话不多说，下面开始今天的学习，由浅入深、层层递进、包学包会！</span></p><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><section><span>#相关R包载入：</span><br mpa-from-tpl="t"><span>library</span>(tidyverse)<br mpa-from-tpl="t"><span>library</span>(ggplot2)<br mpa-from-tpl="t"><span>library</span>(cols4all)<br mpa-from-tpl="t"><span>library</span>(patchwork)<br mpa-from-tpl="t"><span>#测试数据读入：</span><br mpa-from-tpl="t"><span>##将上下调数据通过正负区分</span><br mpa-from-tpl="t"><span>dt</span> &lt;- read.csv('testdt.csv',header = T)<br mpa-from-tpl="t"><span>head</span>(dt)<br mpa-from-tpl="t"><span>tail</span>(dt)</section></pre></section><section><img data-ratio="0.4759959141981614" data-type="png" data-w="979" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTtu029tueFfbPSHCtKx8ZIyYh9fZL4HR7xA3gooQzKQetfniaL1HR6Sw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTtu029tueFfbPSHCtKx8ZIyYh9fZL4HR7xA3gooQzKQetfniaL1HR6Sw/640?wx_fmt=png"></section><section><br></section><section><span>大家可以分别使用上调和下调基因完成富集，将下调基因富集到的通路p值标注为负数，和上调做区分，最后整合成范例中的长数据格式即可。</span></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><section><span>#添加上下调分组标签：</span><br mpa-from-tpl="t"><span>dt</span>$group &lt;- case_when(dt$LogP &gt; 0 ~ 'up',<br mpa-from-tpl="t"><span>dt</span>$LogP &lt; 0 ~ 'down')<br mpa-from-tpl="t"><span>head</span>(dt)</section></pre></section><section><img data-ratio="0.23785926660059464" data-type="png" data-w="1009" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTibRAZgib3vDu5h2RsDUXQCDAWPNh1jIDGqyVM54GUR49CXgibIHC9GdNQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTibRAZgib3vDu5h2RsDUXQCDAWPNh1jIDGqyVM54GUR49CXgibIHC9GdNQ/640?wx_fmt=png"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><section><span>#指定因子；调整顺序：</span><br mpa-from-tpl="t"><span>dt</span>$Description &lt;- factor(dt$Description,levels = rev(dt$Description))</section></pre></section><section data-role="title" data-tools="135编辑器" data-id="122930"><section><section><section><img data-ratio="1.5703125" data-type="gif" data-w="256" data-width="100%" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6k1uAMIp4fiaXCqTOMzIdS3Hm29WEuftOPVb49icZQ3Z3LfEOuKYeQlBMsmibiczTfYmbag6bKXyrN90Q/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6k1uAMIp4fiaXCqTOMzIdS3Hm29WEuftOPVb49icZQ3Z3LfEOuKYeQlBMsmibiczTfYmbag6bKXyrN90Q/640?wx_fmt=gif"></section></section><section><section><span><strong data-brushtype="text">1. 常规版上下调富集条形图绘制</strong></span></section><section data-width="100%"><br></section></section></section></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#基础版上下调富集柱形图绘制：</span><br mpa-from-tpl="t"><span>p</span> &lt;- ggplot(dt,<br mpa-from-tpl="t"><span>aes</span>(x =LogP, y = Description, fill = group)) + <span>#数据映射</span><br mpa-from-tpl="t"><span>geom_col</span>() + <span>#绘制添加条形图</span><br mpa-from-tpl="t"><span>theme_bw</span>()<br mpa-from-tpl="t"><span>p</span></p></pre></section><section><img data-ratio="0.7198776758409786" data-type="png" data-w="1635" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTpUylXDxmWr3DQgfrcDiaqUJbFFSupIaWbJhSFD84YNkLnbXbFDkhO9w/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTpUylXDxmWr3DQgfrcDiaqUJbFFSupIaWbJhSFD84YNkLnbXbFDkhO9w/640?wx_fmt=png"></section><section><br></section><section><span>基础版也就是我们最简单和常用的一种表达，即标签全显示在y轴左侧。喜欢这个样式的童鞋可以画到这里，或再改个配色即可。</span><span></span></section><section data-role="title" data-tools="135编辑器" data-id="122930"><section><section><section><img data-ratio="1.5703125" data-type="gif" data-w="256" data-width="100%" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6k1uAMIp4fiaXCqTOMzIdS3Hm29WEuftOPVb49icZQ3Z3LfEOuKYeQlBMsmibiczTfYmbag6bKXyrN90Q/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6k1uAMIp4fiaXCqTOMzIdS3Hm29WEuftOPVb49icZQ3Z3LfEOuKYeQlBMsmibiczTfYmbag6bKXyrN90Q/640?wx_fmt=gif"></section></section><section><section><span><strong data-brushtype="text">2. 进阶版上下调富集条形图绘制</strong></span></section><section data-width="100%"><br></section></section></section></section><section><span></span></section><section><br></section><section><span>下面开始进阶版的学习。首先，我们需要去掉边框、背景线和全部通路标签：</span></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#自定义主题调整：</span><br mpa-from-tpl="t"><span>mytheme</span> &lt;- theme(<br mpa-from-tpl="t"><span>legend</span>.position = 'none',<br mpa-from-tpl="t"><span>axis</span>.text.y = element_blank(),<br mpa-from-tpl="t"><span>axis</span>.ticks.y = element_blank(),<br mpa-from-tpl="t"><span>panel</span>.grid.major = element_blank(),<br mpa-from-tpl="t"><span>panel</span>.grid.minor = element_blank(),<br mpa-from-tpl="t"><span>panel</span>.border = element_blank(),<br mpa-from-tpl="t"><span>axis</span>.line.x = element_line(color = 'grey60',size = 1.1),<br mpa-from-tpl="t"><span>axis</span>.text = element_text(size = 12)<br mpa-from-tpl="t">)<br mpa-from-tpl="t"><span>p1</span> &lt;- p + mytheme<br mpa-from-tpl="t"><span>p1</span></p></pre></section><section><img data-ratio="0.7346559206447613" data-type="png" data-w="1613" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTsJWmiadgWZOhPf9DibXsUUUhEdhYZSW17xc0tJe2RPAO6B1A5mOvBflQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTsJWmiadgWZOhPf9DibXsUUUhEdhYZSW17xc0tJe2RPAO6B1A5mOvBflQ/640?wx_fmt=png"></section><section><br></section><section><span>然后我们在条形图两侧分别添加对应的通路标签：</span></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#先根据上下调标签拆分数据框：</span><br mpa-from-tpl="t"><span>up</span> &lt;- dt[which(dt$LogP &gt; 0),]<br mpa-from-tpl="t"><span>down</span> &lt;- dt[which(dt$LogP &lt; 0),]<br mpa-from-tpl="t"><span>#添加上调pathway标签：</span><br mpa-from-tpl="t"><span>p2</span> &lt;- p1 +<br mpa-from-tpl="t"><span>geom_text</span>(data = up,<br mpa-from-tpl="t"><span>aes</span>(x = -0.2, y = Description, label = Description),<br mpa-from-tpl="t"><span>size</span> = 3.5,<br mpa-from-tpl="t"><span>hjust</span> = 1) <span>#标签右对齐</span><br mpa-from-tpl="t"><span>p2</span></p></pre></section><section><img data-ratio="0.7346559206447613" data-type="png" data-w="1613" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTdfGqehIUkRugzaic1icLMYBkkRK7H6iamicljGepMB7WAPWWRMcz8whtLQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTdfGqehIUkRugzaic1icLMYBkkRK7H6iamicljGepMB7WAPWWRMcz8whtLQ/640?wx_fmt=png"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#添加下调pathway标签：</span><br mpa-from-tpl="t"><span>p3</span> &lt;- p2 +<br mpa-from-tpl="t"><span>geom_text</span>(data = down,<br mpa-from-tpl="t"><span>aes</span>(x = 0.2, y = Description, label = Description),<br mpa-from-tpl="t"><span>size</span> = 3.5,<br mpa-from-tpl="t"><span>hjust</span> = 0) <span>#标签左对齐</span><br mpa-from-tpl="t"><span>p3</span></p></pre></section><section><img data-ratio="0.7346559206447613" data-type="png" data-w="1613" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTwo1XIDR9QZDeNtgzrMKmbrryNFbiaxUCSFCicicueq5ES7iczwrdblwOSQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTwo1XIDR9QZDeNtgzrMKmbrryNFbiaxUCSFCicicueq5ES7iczwrdblwOSQ/640?wx_fmt=png"></section><section><br></section><section><span>下面就是小细节和配色的调整了，即哪不顺眼改哪：</span></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#继续调整细节：</span><br mpa-from-tpl="t"><span>p4</span> &lt;- p3 +<br mpa-from-tpl="t"><span>scale_x_continuous</span>(breaks=seq(-4, 6, 2)) + <span>#x轴刻度修改</span><br mpa-from-tpl="t"><span>labs</span>(x = 'log(Pvalue)', y = ' ', title = 'Enriched Pathway') + <span>#修改x/y轴标签、标题添加</span><br mpa-from-tpl="t"><span>theme</span>(plot.title = element_text(hjust = 0.5, size = 14)) <span>#主标题居中、字号调整</span><br mpa-from-tpl="t"><span>p4</span></p></pre></section><section><img data-ratio="0.7346559206447613" data-type="png" data-w="1613" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTP41d0mSkOVzUmJw0EBRzppoR9zprMeCDPlGaia3apQiaYHJOPc9Fmb9A/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTP41d0mSkOVzUmJw0EBRzppoR9zprMeCDPlGaia3apQiaYHJOPc9Fmb9A/640?wx_fmt=png"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#颜色修改：</span><br mpa-from-tpl="t"><span>c4a_gui</span>()<br mpa-from-tpl="t"><span>mycol</span> &lt;- c4a('bright',2)<br mpa-from-tpl="t"><span>mycol</span><br mpa-from-tpl="t"><span>p5</span> &lt;- p4 +<br mpa-from-tpl="t"><span>scale_fill_manual</span>(values = mycol)<br mpa-from-tpl="t"><span>p5</span></p></pre></section><section><img data-ratio="0.7346559206447613" data-type="png" data-w="1613" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTzw6oHtMv0TAwkf1n2micjchzxFJ2C4GTJtbwicVwvEVx2E2Nybosdgqg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTzw6oHtMv0TAwkf1n2micjchzxFJ2C4GTJtbwicVwvEVx2E2Nybosdgqg/640?wx_fmt=png"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#最后添加上下调提示标签：</span><br mpa-from-tpl="t"><span>p6</span> &lt;- p5 +<br mpa-from-tpl="t"><span>geom_text</span>(x = 6, y = 14, label = <span>"Up"</span>, size = 6, color = '#EE6677') +<br mpa-from-tpl="t"><span>geom_text</span>(x = -4.5, y = 3.5, label = <span>"Down"</span>, size = 6, color = '#4477AA')<br mpa-from-tpl="t"><span>p6</span></p></pre></section><section><img data-ratio="0.7346559206447613" data-type="png" data-w="1613" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTSAsayNBnfhEqnoJWJ3BP7eubrADqC7L8FwDlLF0NQZmbTj3V2WbfWQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTSAsayNBnfhEqnoJWJ3BP7eubrADqC7L8FwDlLF0NQZmbTj3V2WbfWQ/640?wx_fmt=png"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><p><span>#对比一下两种样式：</span><br mpa-from-tpl="t"><span>p</span> + p6</p></pre></section><section><img data-ratio="0.378740157480315" data-type="png" data-w="1270" data-src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTpAkF8aNE3n0WOnickLvfYRiarynMuWBOzH1eyTqgkfUWw8wTEhpIia2SQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/6kvRq2WRXpgy1wlrzMiawsYTiaM46LMFibTpAkF8aNE3n0WOnickLvfYRiarynMuWBOzH1eyTqgkfUWw8wTEhpIia2SQ/640?wx_fmt=png"></section><section><br></section><section><span>两种样式可按自己的喜好选择！如果还想对重点/目标/显著通路用不同颜色进行强调，推荐大家使用AI调整，相比R更为便捷。</span></section><section><br></section><section><span>好啦，今天的分享就到这里！</span></section><section data-role="title" data-tools="135编辑器" data-id="113060"><section><section><section><section><section><br></section><section data-brushtype="text" hm_fix="302:513"><span><strong>参考文献</strong></span></section><section><br></section></section><section><br></section></section></section></section></section><section><span>Yu, W., Wang, Z., Yu, X. et al. Kir2.1-mediated membrane potential promotes nutrient acquisition and inflammation through regulation of nutrient transporters. Nat Commun 13, 3544 (2022).</span></section><section><br></section><section><strong><span>*未经许可，不得以任何方式复制或抄袭本篇文章之部分或全部内容。版权所有，侵权必究。</span></strong></section><section><br></section><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="105648"><section><section data-role="outer" label="Powered by 135editor.com"><section data-role="paragraph"><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="105648"><section><section><img data-ratio="0.8928571428571429" data-type="png" data-w="41" data-width="100%" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJE8VibmibGU0Jxic9iabARVRH0FT6BNE8VAglWFXBPibFAU7a6tWGibSs8wyUg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJE8VibmibGU0Jxic9iabARVRH0FT6BNE8VAglWFXBPibFAU7a6tWGibSs8wyUg/640?wx_fmt=png"></section><section><section><section data-width="35%"><section><section data-width="100%"><img data-ratio="1" data-type="jpeg" data-w="860" data-width="100%" title="SCIPainter 30cm二维码.jpg" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEv5etCBwHicqbEPwnVrkpaasxqaVibM4mT2JdIuN6yTlYWDD4mL5A427A/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEv5etCBwHicqbEPwnVrkpaasxqaVibM4mT2JdIuN6yTlYWDD4mL5A427A/640?wx_fmt=jpeg"></section></section></section><section data-width="50%"><section><section data-brushtype="text"><span><strong># SCIPainter</strong></span></section><section data-brushtype="text" hm_fix="361:593"><p>基迪奥旗下绘图公众号</p><p>分享科研绘图技能与工具</p><p>欢迎关注与转发~</p></section></section></section></section></section></section></section></section></section></section><section><br></section></section></section><section data-role="paragraph"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-ratio="1" data-type="gif" data-w="400" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEgMd0aMPtmrDjiaX8sBhfhicVteeHf1JicexSpUbS3fdS9SiboUVN7guaPw/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEgMd0aMPtmrDjiaX8sBhfhicVteeHf1JicexSpUbS3fdS9SiboUVN7guaPw/640?wx_fmt=gif"></section></section></section><section><section powered-by="xiumi.us"><section><p><span><strong>你的好友拍了拍你</strong></span></p><p><span><strong>并请你帮她点一下</strong></span><strong><span>“分享”</span></strong><span><strong><span>~</span></strong></span></p></section></section></section></section></section><p><br></p></section></section><section></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/aVy5ubaKc6Q8_wf-R9TVGQ",target="_blank" rel="noopener noreferrer">原文链接</a>
