---
title: "WGCNA,all in 还是DEGs？"
date: 2023-02-14T04:38:42Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
WGCNA,all in 还是DEGs？ by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p><span>WGCNA的教程网上已经有很多，对上树的菜鸟来说，run scripts不是一件难事，但是我们拿到数据集以后，该如何运用WGCNA呢？这是我们想要搞清楚的，希望这篇文章能够给大家提供一点启发。</span></p></blockquote><h2 data-tool="mdnice编辑器"><span>WGCNA的主要功能</span></h2><p data-tool="mdnice编辑器"><span>WGCNA从数以千计的基因水平出发，识别出临床上有趣的基因模块，最后利用模内连接性、基因重要性（例如基于基因表达谱与样本性状的相关性）来识别疾病途径中的关键基因，以便进一步验证。</span></p><p data-tool="mdnice编辑器"><span>WGCNA不是将数以千计的基因与微阵列样本性状联系起来，而是关注少数（通常少于10个）模块与样本性状之间的关系。因为这些模块可能与生物途径相对应，将分析的重点放在模块内的中心基因（或模块的eigengenes）上，相当于一个以生物学为动机的缩小目标方案（也是Jimmy老师常说的缩小目标基因数量的过程）。由于模块内中心基因的表达谱具备高度相关性，通常会产生几十个候选生物标志物（hub gene）。</span></p><h2 data-tool="mdnice编辑器"><span>WGCNA的分析流程</span></h2><p data-tool="mdnice编辑器"><span>WGCNA分析转录组数据的流程大致如下：</span></p><figure data-tool="mdnice编辑器"><img data-ratio="0.4318681318681319" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9kP3Ob33JdjnI7IvOUjzicIiaChibj74dLCoN8AEUmDf9KGttZH122ibNic3UTbaJlY2tO4rCZ3Jc3dHQ/640?wx_fmt=png" data-type="png" data-w="910" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9kP3Ob33JdjnI7IvOUjzicIiaChibj74dLCoN8AEUmDf9KGttZH122ibNic3UTbaJlY2tO4rCZ3Jc3dHQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器"><span>首先，为了构建可信的基因共表达网络，基因表达谱数据应进行适当的数据归一化，保证样品间基因表达谱的可比性。</span></p><p data-tool="mdnice编辑器"><span>第二，计算基因表达相关矩阵即所有基因之间两两相关系数，基因<span>i</span>和基因<span>j</span>的相关系数为<span>sij</span>=|<span>cor</span>(<span>i</span>, <span>j</span>)|，则基因表达相关矩阵为S=[<span>sij</span>]。</span></p><p data-tool="mdnice编辑器"><span>通过幂指数<span>aij</span>=|<span>sij</span>|<span>β</span>加权将S转化为<strong>邻接矩阵</strong>(Adjacency matrix) A=[<span>aij</span>]。构建的网络不具方向性，A是非负对称矩阵，是所有后继分析的基础。</span></p><p data-tool="mdnice编辑器"><span>第三，A被转换为<strong>拓扑矩阵</strong>Ω=[<span>ωij</span>]，拓扑矩阵在生物学网络中很有用。1-<span>ωij</span>用来定义节点相异度(Dissimilarity)，对节点相异度进行聚类分析来鉴定网络模块。</span></p><p data-tool="mdnice编辑器"><span>然后，对模块内基因的连接度(Intramodular connectivity)进行计算，连接度高的基因可能是<strong>模块关键基因</strong>。</span></p><p data-tool="mdnice编辑器"><span>最后，对模块或关键基因和外部信息进行关联，如临床信息，挖掘出有生物学意义的模块或关键基因。</span></p><blockquote data-tool="mdnice编辑器"><p><span>PS：组织中占少数比例的细胞其基因共表达信号可能受其他细胞掩盖，最好的方法就是使用细胞基因表达数据进行WGCNA。</span></p></blockquote><p data-tool="mdnice编辑器"><span>对于初学者而言，了解一个包，可以从官方文档开始，下面是官方对大家比较关心的问题做的答疑，在开始你的WGCNA分析之前，可以参考：</span></p><h2 data-tool="mdnice编辑器"><span>上树需注意</span></h2><blockquote data-tool="mdnice编辑器"><p>Tutorials for WGCNA R package (ucla.edu)</p></blockquote><blockquote data-tool="mdnice编辑器"><p><span>DeepL翻译</span></p><ol><li><section><p><span>我需要几个样本？</span></p><p><span>≥15</span></p></section></li><li><section><p><span>要过滤基因或探针吗？</span></p><p><span>可以根据表达量的平均值或方差来过滤</span></p><p><span><strong>特别要注意的是</strong></span></p><p><span><strong>不建议通过差异表达来过滤基因</strong>。WGCNA被设计成一种无监督的分析方法，根据基因的表达谱进行聚类。通过差异表达过滤基因将导致一组相关的基因，这些基因将基本上形成一个（或几个高度相关的）模块。这也使无标度拓扑假设完全失效，所以通过无标度拓扑拟合来选择软阈值的power将会失败。</span></p></section></li><li><section><p><span>有什么参数推荐？</span></p><p><span>一般来说，选择默认的参数即可。</span></p></section></li></ol><ul><li><section><span><strong>Signed networks.</strong> The choice of signed vs. unsigned networks is complex, but in general we <strong>prefer</strong> signed (or "signed hybrid") networks to unsigned networks.</span></section></li><li><section><span><strong>Robust correlation.</strong> The default correlation method in all functions in WGCNA is <span>standard Pearson correlation</span>. In general, unless there is good reason to believe that there are no outlier measurements, we recommend (and use ourselves) <span>the biweight mid-correlation</span> as a robust alternative.</span></section></li></ul><li><section><p><span><strong>RNA-Seq</strong> 数据适用吗？</span></p><p><span>是的。对于WGCNA分析来说，无论使用RPKM、FPKM还是简单的归一化计数，只要所有样品都以相同的方式处理，就不会有太大的区别。</span></p></section></li><li><section><p><span>数据存在异质性还可以用WGCNA吗？</span></p><p><span>数据的异质性可能会影响到任何统计分析，而像WGCNA这样的无监督分析更是如此。如果要对分析进行修改，主要取决于异质性（或其基本驱动因素）是否被认为对分析者试图回答的问题 "有趣"。如果幸运的话，样本差异的主要驱动因素是一个人研究的治疗/条件，在这种情况下，WGCNA可以原封不动地应用于数据。不幸的是，往往异质性驱动因素是无趣的，应该加以调整。这些因素可以是技术性的（批次效应、技术变量如死后间隔等）或生物性的（如性别、组织或物种差异）。</span></p></section></li><li><section><p><span>无论我把软阈值功率设置得多高，我都无法得到一个好的无标度拓扑指数。</span></p><p><span>首先应确保变量（探针集、基因等）没有被与样品性状有关的差异表达所过滤。适当的软阈值功率可以根据样本的数量来选择，如下表所示⬇</span></p></section></li><figure><img data-ratio="0.253671562082777" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9kP3Ob33JdjnI7IvOUjzicIO4rkWxBibRl3eDdNrhJnbvia6lL2EBCzBicaqsPOOJHMIib7ZibW62UgDgg/640?wx_fmt=png" data-type="png" data-w="749" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9kP3Ob33JdjnI7IvOUjzicIO4rkWxBibRl3eDdNrhJnbvia6lL2EBCzBicaqsPOOJHMIib7ZibW62UgDgg/640?wx_fmt=png"></figure></blockquote><blockquote data-tool="mdnice编辑器"><ol start="7"><li><section><p><span>TOMsimilarity 和 TOMsimilarityFromExpr函数得到的结果有一点差异</span></p><p><span>在TOMsimilarityFromExpr函数中将参数设置为TOMType="unsigned"就能得到相同的结果。</span></p></section></li><li><section><p><span>运行中报错</span></p><p><span>参考【Runtime errors】</span><span></span></p></section></li></ol></blockquote><p data-tool="mdnice编辑器"><span>以上是根据官方教程的部分答疑，接下来用试试用全部基因和差异基因的表达矩阵跑WGCNA，看看有什么差别吧~</span></p><figure data-tool="mdnice编辑器"><img data-ratio="1.0015220700152208" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9kP3Ob33JdjnI7IvOUjzicIm69Bw12ib6j63E6Q9wDo0SZvzfHnh1NsbibWxfnU1T7ziapXCwziaiblbfg/640?wx_fmt=png" data-type="png" data-w="657" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9kP3Ob33JdjnI7IvOUjzicIm69Bw12ib6j63E6Q9wDo0SZvzfHnh1NsbibWxfnU1T7ziapXCwziaiblbfg/640?wx_fmt=png"><figcaption><span>all in</span></figcaption><figcaption><span><br></span></figcaption></figure><figure data-tool="mdnice编辑器"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9kP3Ob33JdjnI7IvOUjzicIPc5BqedHV10RPIxULqe3n46gDicCTTBPvSaSnmdCxQD5Gtnsev7SsNA/640?wx_fmt=png" data-type="png" data-w="656" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9kP3Ob33JdjnI7IvOUjzicIPc5BqedHV10RPIxULqe3n46gDicCTTBPvSaSnmdCxQD5Gtnsev7SsNA/640?wx_fmt=png"><figcaption><span>DEG+WGCNA</span></figcaption></figure><p data-tool="mdnice编辑器"><span>下图是根据差异基因进行WGCNA出现的结果，可以看到，两种情况下得到的模块数量并不一致。同时在运行代码过程中发现，软阈值power也不同，这与官方所述问题是一样的。</span></p><blockquote data-tool="mdnice编辑器"><p><span>两种方式去跑，得到的模块存在差异，那么后续在进行表型关联分析和富集分析时，会不会丢失一些关键信息呢？比如，可能模块3与研究疾病的关联性更大，但由于我用差异基因来进行分析，导致模块3信息丢失，最后得到的hub基因真的是“hub gene”吗？</span></p></blockquote><p data-tool="mdnice编辑器"><br></p><p data-tool="mdnice编辑器"><span>看到我的疑问之后，曾老师给了我一篇文献，原来真的有人去做了几种方法的比较，甚至还提出了更好的方案，我们来看看——</span></p><blockquote data-tool="mdnice编辑器"><p><span>7.364（2区）</span></p><p><span>Improved biomarker discovery through a plot twist in transcriptomic data analysis</span></p><ul><li><section><span>PMCID: </span><span>PMC9509653</span></section></li><li><section><span>DOI: </span><span>10.1186/s12915-022-01398-w</span></section></li></ul></blockquote><h2 data-tool="mdnice编辑器"><span>all in + DEGs</span></h2><figure data-tool="mdnice编辑器"><img data-ratio="0.7904624277456648" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9kP3Ob33JdjnI7IvOUjzicIRf3dpf7ibFe8wwcnP8nQfR5RX0mX0GicQmsTWh10CZRwPhbuybeJYXsQ/640?wx_fmt=png" data-type="png" data-w="692" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9kP3Ob33JdjnI7IvOUjzicIRf3dpf7ibFe8wwcnP8nQfR5RX0mX0GicQmsTWh10CZRwPhbuybeJYXsQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器"><span>可以看到，目前市面上对转录组数据的分析主要是4种：</span></p><ul data-tool="mdnice编辑器"><li><section><span>直接差异分析</span></section></li><li><section><span>全部基因WGCNA</span></section></li><li><section><span>差异分析然后再WGCNA</span></section></li><li><section><span>全部基因WGCNA再差异分析</span></section></li></ul><p data-tool="mdnice编辑器"><span>作者用<strong>正在经历性别分化的脊椎动物性腺</strong>的转录组数据【转录组学上最复杂的组织和微妙的过程之一】分别进行了WGCNA+DEGs与DEGs+WGCNA测试：</span></p><figure data-tool="mdnice编辑器"><img data-ratio="0.9601769911504425" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9kP3Ob33JdjnI7IvOUjzicIicxJn08YmPNvWicCLbdmibibLsc4yY0jfQriaqYTAkZiadrqRBXhO6lGHKDw/640?wx_fmt=png" data-type="png" data-w="678" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9kP3Ob33JdjnI7IvOUjzicIicxJn08YmPNvWicCLbdmibibLsc4yY0jfQriaqYTAkZiadrqRBXhO6lGHKDw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器"><span>结论鲜明：<strong>在所有情况下，WGCNA + DEGs的表现明显优于DEGs + WGCNA</strong>。</span></p><p data-tool="mdnice编辑器"><span>另，对于DEGs+WGCNA，作者指出：DEGs+WGCNA会影响网络的结构并导致错误的结论。此外，这种方法的有效性从未被证实，官方也并不建议在WGCNA之前应用DEGs。</span></p><blockquote data-tool="mdnice编辑器"><p><span>看到这里，你知道应该如何正确运用WGCNA了吧~</span></p><p><span>如果有心的话，还能从这篇文献中获得发文新思路【方法学的比较】，与诸君共勉</span></p></blockquote><h2 data-tool="mdnice编辑器"><span>参考</span></h2><blockquote data-tool="mdnice编辑器"><ul><li><section><span>权重基因共表达网络分析在生物医学中的应用 (im.ac.cn)</span></section></li><li><section><span>WGCNA分析，简单全面的最新教程 - 简书 (jianshu.com)</span></section></li><li><section><span>WGCNA（5）：模块导出至其他可视化软件 - 简书 (jianshu.com)</span></section></li><li><section><span>WGCNA是我最拿手的教程 | 生信菜鸟团 (bio-info-trainee.com)</span></section></li><li><section><span>WGCNA应用现状及存在问题 - 哔哩哔哩 (bilibili.com)</span></section></li></ul></blockquote></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/4kqja4KnG6yii_oEwtGB9g",target="_blank" rel="noopener noreferrer">原文链接</a>
