---
title: "gtex数据下载和整理"
date: 2023-01-27T02:09:48Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
gtex数据下载和整理 by 生信星球
------
<div><section data-mpa-powered-by="yiban.io"><img data-ratio="1" data-type="png" data-w="20" width="20px" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"><img data-ratio="1" data-type="png" data-w="20" width="20px" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png"><span> 今天是生信星球陪你的<span><strong>第896天</strong></span></span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"></section><hr><p><span><span>   </span><span>大神一句话，菜鸟跑半年。我不是大神，但我可以缩短你走弯路的半年~</span></span></p><p><span>   就像歌儿唱的那样，如果你不知道该往哪儿走，就留在这学点生信好不好~</span></p><p><span>   这里有豆豆和花花的学习历程，从新手到进阶，生信路上有你有我!</span></p><section><h4><span>数据下载</span></h4><p>官网访问有障碍，直接去xena吧。<br>https://xenabrowser.net/datapages/?cohort=GTEX&amp;removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443<br>下载tpm和临床信息。</p><h4><span>1.读取表达矩阵</span></h4><pre><code>rm(list = ls())<br>dat = data.table::fread("gtex_RSEM_gene_tpm.gz",data.table = F)<br>dat[1:4,1:4]<br><span><br>#</span><span><span>#               sample GTEX-S4Q7-0003-SM-3NM8M GTEX-QV31-1626-SM-2S1QC</span></span><br><span>#</span><span><span># 1  ENSG00000242268.2                 -3.4580                 -9.9658</span></span><br><span>#</span><span><span># 2  ENSG00000259041.1                 -9.9658                 -9.9658</span></span><br><span>#</span><span><span># 3  ENSG00000270112.3                 -3.6259                 -2.1779</span></span><br><span>#</span><span><span># 4 ENSG00000167578.16                  4.5988                  4.6294</span></span><br><span>#</span><span><span>#   GTEX-13QIC-0011-R1a-SM-5O9CJ</span></span><br><span>#</span><span><span># 1                      -9.9658</span></span><br><span>#</span><span><span># 2                      -9.9658</span></span><br><span>#</span><span><span># 3                      -1.8314</span></span><br><span>#</span><span><span># 4                       6.4989</span></span><br></code></pre><pre><code>library(tidyverse)<br>exp = column_to_rownames(dat,"sample") %&gt;% as.matrix()<br>rownames(exp) = rownames(exp) %&gt;% str_split("\\.",simplify = T) %&gt;% .[,1]<br>exp[1:4,1:4]<br><span><br>#</span><span><span>#                 GTEX-S4Q7-0003-SM-3NM8M GTEX-QV31-1626-SM-2S1QC</span></span><br><span>#</span><span><span># ENSG00000242268                 -3.4580                 -9.9658</span></span><br><span>#</span><span><span># ENSG00000259041                 -9.9658                 -9.9658</span></span><br><span>#</span><span><span># ENSG00000270112                 -3.6259                 -2.1779</span></span><br><span>#</span><span><span># ENSG00000167578                  4.5988                  4.6294</span></span><br><span>#</span><span><span>#                 GTEX-13QIC-0011-R1a-SM-5O9CJ GTEX-ZPCL-0126-SM-4WWC8</span></span><br><span>#</span><span><span># ENSG00000242268                      -9.9658                 -9.9658</span></span><br><span>#</span><span><span># ENSG00000259041                      -9.9658                 -9.9658</span></span><br><span>#</span><span><span># ENSG00000270112                      -1.8314                 -9.9658</span></span><br><span>#</span><span><span># ENSG00000167578                       6.4989                  5.5358</span></span><br><span><br>#</span><span> 转换行名</span><br>library(AnnoProbe)<br>library(tinyarray)<br>an = annoGene(rownames(exp),ID_type = "ENSEMBL")<br>exp = trans_array(exp,ids = an,from = "ENSEMBL",to = "SYMBOL")<br>exp[1:4,1:4]<br><span><br>#</span><span><span>#             GTEX-S4Q7-0003-SM-3NM8M GTEX-QV31-1626-SM-2S1QC</span></span><br><span>#</span><span><span># DDX11L1                     -5.0116                 -9.9658</span></span><br><span>#</span><span><span># WASH7P                       4.4283                  3.8370</span></span><br><span>#</span><span><span># MIR6859-1                   -9.9658                 -9.9658</span></span><br><span>#</span><span><span># MIR1302-2HG                 -9.9658                 -9.9658</span></span><br><span>#</span><span><span>#             GTEX-13QIC-0011-R1a-SM-5O9CJ GTEX-ZPCL-0126-SM-4WWC8</span></span><br><span>#</span><span><span># DDX11L1                          -9.9658                 -9.9658</span></span><br><span>#</span><span><span># WASH7P                            3.5863                  3.6793</span></span><br><span>#</span><span><span># MIR6859-1                        -9.9658                 -9.9658</span></span><br><span>#</span><span><span># MIR1302-2HG                      -9.9658                 -9.9658</span></span><br></code></pre><h4><span>2. 读取注释信息</span></h4><pre><code>clinical = data.table::fread("GTEX_phenotype.gz")<br><span>table(clinical$</span><span>`_primary_site`)</span><br><span><br>#</span><span><span># </span></span><br><span>#</span><span><span>#  &lt;not provided&gt;  Adipose Tissue   Adrenal Gland         Bladder           Blood </span></span><br><span>#</span><span><span>#               5             621             161              13             595 </span></span><br><span>#</span><span><span>#    Blood Vessel     Bone Marrow           Brain          Breast    Cervix Uteri </span></span><br><span>#</span><span><span>#             753             102            1426             221              11 </span></span><br><span>#</span><span><span>#           Colon       Esophagus  Fallopian Tube           Heart          Kidney </span></span><br><span>#</span><span><span>#             384             805               7             493              38 </span></span><br><span>#</span><span><span>#           Liver            Lung          Muscle           Nerve           Ovary </span></span><br><span>#</span><span><span>#             141             381             478             335             112 </span></span><br><span>#</span><span><span>#        Pancreas       Pituitary        Prostate  Salivary Gland            Skin </span></span><br><span>#</span><span><span>#             203             126             122              71             977 </span></span><br><span>#</span><span><span># Small Intestine          Spleen         Stomach          Testis         Thyroid </span></span><br><span>#</span><span><span>#             106             121             209             208             366 </span></span><br><span>#</span><span><span>#          Uterus          Vagina </span></span><br><span>#</span><span><span>#              93              99</span></span><br><br>clinical = clinical[clinical$`_primary_site`!="&lt;not provided&gt;",]<br>colnames(clinical)[3] = "site"<br></code></pre><h4><span>3.表达矩阵和临床信息对应起来</span></h4><pre><code>s = intersect(colnames(exp),clinical$Sample)<br>clinical = clinical[match(s,clinical$Sample),]<br>exp = exp[,s]<br><span>identical(clinical$</span><span>Sample,colnames(exp))</span><br><span><br>#</span><span><span># [1] TRUE</span></span><br><br>exp[1:4,1:4]<br><span><br>#</span><span><span>#             GTEX-S4Q7-0003-SM-3NM8M GTEX-QV31-1626-SM-2S1QC</span></span><br><span>#</span><span><span># DDX11L1                     -5.0116                 -9.9658</span></span><br><span>#</span><span><span># WASH7P                       4.4283                  3.8370</span></span><br><span>#</span><span><span># MIR6859-1                   -9.9658                 -9.9658</span></span><br><span>#</span><span><span># MIR1302-2HG                 -9.9658                 -9.9658</span></span><br><span>#</span><span><span>#             GTEX-13QIC-0011-R1a-SM-5O9CJ GTEX-ZPCL-0126-SM-4WWC8</span></span><br><span>#</span><span><span># DDX11L1                          -9.9658                 -9.9658</span></span><br><span>#</span><span><span># WASH7P                            3.5863                  3.6793</span></span><br><span>#</span><span><span># MIR6859-1                        -9.9658                 -9.9658</span></span><br><span>#</span><span><span># MIR1302-2HG                      -9.9658                 -9.9658</span></span><br></code></pre><h4><span>4. 单基因表达量画图</span></h4><pre><code>library(dplyr)<br><span>#"METTL3","SETD2","TP53"</span><br>g = <span>"METTL3"</span><br>pdat = cbind(gene = exp[g,],clinical[,c(1,3)])<br>library(tidyr)<br>pdat = drop_na(pdat,site)<br>su = group_by(pdat,site) %&gt;% <br>  summarise(a = median(gene)) %&gt;% <br>  arrange(desc(a))<br>pdat$site = factor(pdat$site,levels = su$site)<br>library(ggplot2)<br>library(RColorBrewer)<br>mypalette &lt;- colorRampPalette(brewer.pal(8,<span>"Set1"</span>))<br>ggplot(pdat,aes(x = site,y = gene,fill = site))+<br>  geom_boxplot()+<br>  theme_bw()+<br>  theme(axis.text.x = element_text(vjust = 1,hjust = 1,angle = 70),legend.position = <span>"bottom"</span>)+<br>  scale_fill_manual(values = mypalette(31))+<br>  guides (fill=guide_legend (nrow=3, byrow=TRUE))<br></code></pre><figure><img data-ratio="0.714516129032258" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHo1bxGjbC15UTpoBicj8CEFaEdoVvbM7Dj9qCTxBN2XrWJj0suuWibRg1hsI4XBXia0Kibxppy7l1oPPw/640?wx_fmt=png" data-type="png" data-w="1240" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHo1bxGjbC15UTpoBicj8CEFaEdoVvbM7Dj9qCTxBN2XrWJj0suuWibRg1hsI4XBXia0Kibxppy7l1oPPw/640?wx_fmt=png"></figure></section><p><span></span><br></p><section><blockquote><section><span>如果因为代码看不懂，而跟不上正文的节奏，可以来找我，系统学习。我的</span><span>课程都是循环开课。</span><span>下一期的时间，点进去咨询微信咯</span><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247492627&amp;idx=1&amp;sn=614671537676eece45244aa1cbe94b15&amp;chksm=fdfbac51ca8c25475c71ed3b7b3506391a8d08149acfd62d0666193e382b33634382bef4f80d&amp;scene=21#wechat_redirect" textvalue="产假结束，核酸尚阴，期待遇见2023年的你" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">产假结束，核酸尚阴，期待遇见2023年的你</a><br></section></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/6djEPfpbiWgyjiCafqvtFg",target="_blank" rel="noopener noreferrer">原文链接</a>
