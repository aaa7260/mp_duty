---
title: "TCGA数据库8个应用领域之2—RTCGA探索（铜死亡）单个分子在各类肿瘤的差异情况文章"
date: 2022-11-08T02:07:33Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
TCGA数据库8个应用领域之2—RTCGA探索（铜死亡）单个分子在各类肿瘤的差异情况文章 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">上次我们介绍了用TCGA数据探索各类肿瘤的不同临床特征（性别、年龄、种族、临床分期）预后（生存曲线），本次是TCGA数据库8个应用领域之2——探索各类肿瘤与对照的单个分子（如mRNA，lncRNA，miRNA，甲基化，蛋白）水平的差异情况（箱线图），使用的包是RTCGA。</p><p data-tool="mdnice编辑器">关于RTCGA以往的应用可以看：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247486585&amp;idx=1&amp;sn=3035f6420904aad2c8161b362cdeb472&amp;scene=21#wechat_redirect" data-linktype="2">TCGA的28篇教程- 使用R语言的RTCGA包获取TCGA数据</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247489583&amp;idx=1&amp;sn=66a64550bd98a1535520157c65ade535&amp;scene=21#wechat_redirect" data-linktype="2">TCGA之miRNA预测临床表现</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247493576&amp;idx=3&amp;sn=f1b0b52738cc17ae2347f3bbaf58eeb9&amp;scene=21#wechat_redirect" data-linktype="2">连最基础服务都不让我们专业人士来做了</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247512212&amp;idx=1&amp;sn=e592a247005e9c9f8d451ca9e51f2856&amp;scene=21#wechat_redirect" data-linktype="2">使用R包RTCGA把TCGA数据本地化</a></section></li></ul><h4 data-tool="mdnice编辑器"><span></span>准备工作<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br>options(stringsAsFactors = <span>F</span>)<br><span>library</span>(cgdsr) <br><span>library</span>(DT) <br><span>library</span>(RTCGA)<br><span>library</span>(glmSparseNet)<br><span># BiocManager::install("RTCGA.rnaseq") ##  (612.6 MB)</span><br><span># 本地安装 https://bioconductor.org/packages/3.6/data/experiment/src/contrib/RTCGA.rnaseq_20151101.8.0.tar.gz</span><br><span>#devtools::install_local(path="02-boxplot-df/RTCGA.rnaseq_20151101.8.0.tar.gz")  </span><br><span>library</span>(RTCGA.rnaseq)<br></code></pre><h5 data-tool="mdnice编辑器"><span></span>筛选出所有的癌症的队列<span></span></h5><p data-tool="mdnice编辑器">开始debug</p><pre data-tool="mdnice编辑器"><span></span><code>cohorts &lt;- infoTCGA() %&gt;%     <span>#读取网页中的表格，癌症的队列cohorts这一列</span><br>    rownames() %&gt;% <br>    sub(<span>"-counts"</span>, <span>""</span>, x=.)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.1231281198003327" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibbr7p8icoNiaoDDibN3iaf2tia2WRDNbVfLtuVibicbappQL29cUWRmP8l6KTORselGmjcK04pl3xO4qSvw/640?wx_fmt=png" data-type="png" data-w="601" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibbr7p8icoNiaoDDibN3iaf2tia2WRDNbVfLtuVibicbappQL29cUWRmP8l6KTORselGmjcK04pl3xO4qSvw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器"><code>infoTCGA()</code>会报错<code>failed to load external entity "http://gdac.broadinstitute.org/"</code>，但网址是能打开的。曾老师查看函数<code>infoTCGA</code>：</p><pre data-tool="mdnice编辑器"><span></span><code>function () <br>{<br>    x &lt;- do.call(rbind, readHTMLTable("http://gdac.broadinstitute.org/")[-39])<br>    names(x) &lt;- gsub(names(x), pattern = "\n", replacement = "", <br>        fixed = TRUE)<br>    x<br>}<br></code></pre><p data-tool="mdnice编辑器">是<code>readHTMLTable("http://gdac.broadinstitute.org/")</code>的问题，下载更新XML包，不行；<code>http</code>改成<code>https</code>，还是不行。</p><p data-tool="mdnice编辑器">在小伙伴的帮助下再尝试：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(XML)<br><span>library</span>(RCurl)<br>url = <span>"http://gdac.broadinstitute.org/"</span><br>xmldoc &lt;- getURL(url)<br>df2 &lt;- readHTMLTable(xmldoc, stringsAsFactors = <span>F</span>)<br><br><span>library</span>(httr)<br>tabs &lt;- GET(url)<br>df3 &lt;- readHTMLTable(rawToChar(tabs$content), as.data.frame = <span>T</span>, stringsAsFactors = <span>F</span>)<br></code></pre><p data-tool="mdnice编辑器">还是不行，试试https呢？</p><pre data-tool="mdnice编辑器"><span></span><code>library(RCurl)<br>url = "https://gdac.broadinstitute.org/"<br>xmldoc &lt;- getURL(url)<br>df2 &lt;- readHTMLTable(xmldoc, stringsAsFactors = F)<br>#可以！<br><br>library(httr)<br>tabs &lt;- GET(url)<br>df3 &lt;- readHTMLTable(rawToChar(tabs$content), as.data.frame = T, stringsAsFactors = F)<br>#也可以！<br></code></pre><p data-tool="mdnice编辑器">emm自己把<code>readHTMLTable("http://gdac.broadinstitute.org/")</code>替换成df2搞成个新函数</p><pre data-tool="mdnice编辑器"><span></span><code>infoTCGA1 = function () <br>{<br>  x &lt;- do.call(rbind, df2[-39])<br>  names(x) &lt;- gsub(names(x), pattern = "\n", replacement = "", <br>                   fixed = TRUE)<br>  x<br>}<br>infoTCGA1()<br><br>cohorts &lt;- infoTCGA1() %&gt;% <br>    rownames() %&gt;% <br>    sub("-counts", "", x=.)<br>head(cohorts)<br>#[1] "ACC"  "BLCA" "BRCA" "CESC" "CHOL" "COAD"<br></code></pre><h5 data-tool="mdnice编辑器"><span></span>因为是RNA-seq数据，所以基因名是得转换一下的<span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>expr &lt;- expressionsTCGA(OV.rnaseq) <span>#expressionsTCGA从本地R包里面获取表达量信息</span><br>ids = colnames(expr) <span>#查看基因名</span><br>tail(ids)<br><span>#[1] "ZYX|7791"         "ZZEF1|23140"      "ZZZ3|26009"       "psiTPTE22|387590" "tAKR|389932" </span><br><span># 不是我们一般用的基因名，是"基因名|数字"的形式</span><br><span># 这里面的| 特别难处理，是逻辑运算符，后面匹配基因名会出问题</span><br><span># "[|]" 就可以强制逻辑运算符，下面会用上这个方法</span><br><br><span>#输入你想查看的基因</span><br><span>#这里输入的是10个铜死亡的基因</span><br>cg = c(<span>'FDX1'</span>,<br>       <span>'LIAS'</span>,<br>       <span>'LIPT1'</span>,<br>       <span>'DLD'</span>,<br>       <span>'DLAT'</span>,<br>       <span>'PDHA1'</span>,<br>       <span>'PDHB'</span>,<br>       <span>'MTF1'</span>,<br>       <span>'GLS'</span>,<br>       <span>'CDKN2A'</span><br>)<br><span>#然后通过ids把10个基因名转换成"基因名|数字"的形式</span><br><span>for</span> (i <span>in</span> <span>1</span>:length(cg)) {<br>  gene = cg[i]<br>  gene &lt;-ids[grep(paste0(<span>"^"</span>,gene,<span>"[|]"</span>),ids)]  <span>#这里才不会匹配到多个基因。</span><br>  cg[i] = gene<br>}<br>cg <br><span># [1] "FDX1|2230"   "LIAS|11019"  "LIPT1|51601" "DLD|1738"    "DLAT|1737"   "PDHA1|5160"  "PDHB|5162"   "MTF1|4520"   "GLS|2744"   </span><br><span># [10] "CDKN2A|1029"</span><br></code></pre><h5 data-tool="mdnice编辑器"><span></span>获取表达矩阵<span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>head(cohorts)<br><span>#[1] "ACC"  "BLCA" "BRCA" "CESC" "CHOL" "COAD"</span><br><br>cohorts = noquote(paste0(cohorts,<span>".rnaseq"</span>,sep=<span>","</span>)) <span>#去掉引号</span><br>head(cohorts)<br><span>#[1] ACC.rnaseq,  BLCA.rnaseq, BRCA.rnaseq, CESC.rnaseq, CHOL.rnaseq, COAD.rnaseq,</span><br><br>cohorts = paste(cohorts,collapse=<span>"\n"</span>) <span>#整个向量变成一个字符串，便于....接下来复制去expressionsTCGA函数中提取表达矩阵</span><br>cohorts<br><span>#[1] "ACC.rnaseq,\nBLCA.rnaseq,\nBRCA.rnaseq,\nCESC.rnaseq,\nCHOL.rnaseq,\nCOAD.rnaseq,\nCOADREAD.rnaseq,\nDLBC.rnaseq,\nESCA.rnaseq,\nFPPP.rnaseq,\nGBM.rnaseq,\nGBMLGG.rnaseq,\nHNSC.rnaseq,\nKICH.rnaseq,\nKIPAN.rnaseq,\nKIRC.rnaseq,\nKIRP.rnaseq,\nLAML.rnaseq,\nLGG.rnaseq,\nLIHC.rnaseq,\nLUAD.rnaseq,\nLUSC.rnaseq,\nMESO.rnaseq,\nOV.rnaseq,\nPAAD.rnaseq,\nPCPG.rnaseq,\nPRAD.rnaseq,\nREAD.rnaseq,\nSARC.rnaseq,\nSKCM.rnaseq,\nSTAD.rnaseq,\nSTES.rnaseq,\nTGCT.rnaseq,\nTHCA.rnaseq,\nTHYM.rnaseq,\nUCEC.rnaseq,\nUCS.rnaseq,\nUVM.rnaseq,"</span><br><br>cat(b) <span># paste结合换行符\n使用，直接打印还是只能看到\n；需要cat才能显示换行的效果</span><br><span># ACC.rnaseq,</span><br><span># BLCA.rnaseq,</span><br><span># BRCA.rnaseq,</span><br><span># CESC.rnaseq,</span><br><span># CHOL.rnaseq,</span><br><span># COAD.rnaseq,</span><br><span># COADREAD.rnaseq,</span><br><span># DLBC.rnaseq,</span><br><span># ESCA.rnaseq,</span><br><span># FPPP.rnaseq,</span><br><span># GBM.rnaseq,</span><br><span># GBMLGG.rnaseq,</span><br><span># HNSC.rnaseq,</span><br><span># KICH.rnaseq,</span><br><span># KIPAN.rnaseq,</span><br><span># KIRC.rnaseq,</span><br><span># KIRP.rnaseq,</span><br><span># LAML.rnaseq,</span><br><span># LGG.rnaseq,</span><br><span># LIHC.rnaseq,</span><br><span># LUAD.rnaseq,</span><br><span># LUSC.rnaseq,</span><br><span># MESO.rnaseq,</span><br><span># OV.rnaseq,</span><br><span># PAAD.rnaseq,</span><br><span># PCPG.rnaseq,</span><br><span># PRAD.rnaseq,</span><br><span># READ.rnaseq,</span><br><span># SARC.rnaseq,</span><br><span># SKCM.rnaseq,</span><br><span># STAD.rnaseq,</span><br><span># STES.rnaseq,</span><br><span># TGCT.rnaseq,</span><br><span># THCA.rnaseq,</span><br><span># THYM.rnaseq,</span><br><span># UCEC.rnaseq,</span><br><span># UCS.rnaseq,</span><br><span># UVM.rnaseq,</span><br><br>?expressionsTCGA <br>expr &lt;- expressionsTCGA(ACC.rnaseq,<br>                        BLCA.rnaseq,<br>                        BRCA.rnaseq,<br>                        CESC.rnaseq,<br>                        CHOL.rnaseq,<br>                        COAD.rnaseq,<br>                        COADREAD.rnaseq,<br>                        DLBC.rnaseq,<br>                        ESCA.rnaseq,<br>                        <span>#FPPP.rnaseq,</span><br>                        GBM.rnaseq,<br>                        GBMLGG.rnaseq,<br>                        HNSC.rnaseq,<br>                        KICH.rnaseq,<br>                        KIPAN.rnaseq,<br>                        KIRC.rnaseq,<br>                        KIRP.rnaseq,<br>                        LAML.rnaseq,<br>                        LGG.rnaseq,<br>                        LIHC.rnaseq,<br>                        LUAD.rnaseq,<br>                        LUSC.rnaseq,<br>                        <span>#MESO.rnaseq,</span><br>                        OV.rnaseq,<br>                        PAAD.rnaseq,<br>                        PCPG.rnaseq,<br>                        PRAD.rnaseq,<br>                        READ.rnaseq,<br>                        SARC.rnaseq,<br>                        SKCM.rnaseq,<br>                        STAD.rnaseq,<br>                        STES.rnaseq,<br>                        TGCT.rnaseq,<br>                        THCA.rnaseq,<br>                        THYM.rnaseq,<br>                        UCEC.rnaseq,<br>                        UCS.rnaseq,<br>                        UVM.rnaseq,<span>#前面对向量的处理就是为了这里，属于对包理解不到位的剑走偏锋了</span><br>                        extract.cols =  cg) <span>#extract.cols提取想要查看的基因名</span><br>dim(as.data.frame(expr))<br><span># [1] 12193    12</span><br>expr[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br><span>#   bcr_patient_barcode          dataset    `FDX1|2230` `LIAS|11019`</span><br><span>#   &lt;chr&gt;                        &lt;chr&gt;            &lt;dbl&gt;        &lt;dbl&gt;</span><br><span># 1 TCGA-OR-A5J1-01A-11R-A29S-07 ACC.rnaseq      13351.         117.</span><br><span># 2 TCGA-OR-A5J2-01A-11R-A29S-07 ACC.rnaseq       2274.         184.</span><br><span># 3 TCGA-OR-A5J3-01A-11R-A29S-07 ACC.rnaseq      17702.         233.</span><br><span># 4 TCGA-OR-A5J5-01A-11R-A29S-07 ACC.rnaseq       4819.         359.</span><br><span># expr$dataset = gsub('.rnaseq','',expr$dataset)</span><br><br>boxplot(expr[,<span>3</span>:<span>5</span>],las=<span>2</span>)  <br><br><span># 处理一下这个矩阵</span><br>expr[,-c(<span>1</span>,<span>2</span>)]=log2(expr[,-c(<span>1</span>,<span>2</span>)]+<span>1</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5296875" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibbr7p8icoNiaoDDibN3iaf2tia2kf5NCVJBOfObe6nDPFOYhSxVrrvsqibd8iaMBA1iavAqj9rtibfWUcshkA/640?wx_fmt=png" data-type="png" data-w="1920" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibbr7p8icoNiaoDDibN3iaf2tia2kf5NCVJBOfObe6nDPFOYhSxVrrvsqibd8iaMBA1iavAqj9rtibfWUcshkA/640?wx_fmt=png"></figure><h4 data-tool="mdnice编辑器"><span></span>画图<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>#做一个循环来画图</span><br><span>#画图：每个基因，一张图，</span><br><span>#每张图里面都是36个癌症的比较。</span><br>dir.create(<span>"./02-boxplot-df/RNAsep_boxplot"</span>)<br><span>for</span> (i <span>in</span> <span>1</span>:length(cg)) {<br>  <span># i=1</span><br>  gene = cg[i]<br>  nb_samples &lt;- table(expr$dataset)<br>  nb_samples<br>  <span>library</span>(ggpubr)<br>  <span>#调色板要选择好，jama不行。颜色太少了。defualt才有足够的颜色</span><br>  p = ggboxplot(expr, x = <span>"dataset"</span>, y = gene,<br>                title = gene, <br>                ylab = <span>"Expression"</span>,<br>                color = <span>"dataset"</span>, <br>                palette = <span>"defualt"</span>,<br>                rotate = <span>F</span><br>  )+theme(axis.text.x = element_text(angle = <span>45</span>, hjust = <span>0.5</span>, vjust = <span>0.5</span>))<br>  <span>#theme(axis.text.x = element_text(angle = 35,vjust = 0.5,hjust = 0.5))</span><br>  <span># p+theme(axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5))</span><br>  <br>  id = gsub(<span>'[|]'</span>,<span>'-'</span>,gene)<br>  ggsave(p,width = <span>10</span>, height = <span>6</span>,filename = paste0(<span>"02-boxplot-df/RNAsep_boxplot/"</span>,id,<span>"RNA_boxplot.png"</span>))<br>}<br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.6" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibbr7p8icoNiaoDDibN3iaf2tia2G6mlficbGWzq9O90qmjBBcj4dR5qOPAwZU8zh9eT9wc0uIEnQJC0Ujg/640?wx_fmt=png" data-type="png" data-w="3000" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibbr7p8icoNiaoDDibN3iaf2tia2G6mlficbGWzq9O90qmjBBcj4dR5qOPAwZU8zh9eT9wc0uIEnQJC0Ujg/640?wx_fmt=png"><img data-ratio="0.6324972737186477" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibbr7p8icoNiaoDDibN3iaf2tia21F0qp3nCz8upic34t6JgJ74RHku2ricGZ2ePsEoHVnXFMggXrISLd6fw/640?wx_fmt=png" data-type="png" data-w="917" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibbr7p8icoNiaoDDibN3iaf2tia21F0qp3nCz8upic34t6JgJ74RHku2ricGZ2ePsEoHVnXFMggXrISLd6fw/640?wx_fmt=png"></p><p data-tool="mdnice编辑器">因为RTCGA包提到 Data source is illumina hiseq Level 3 RSEM normalized expression data. 而不是我们一般用的cpm、tpm，这里用网页工具GEPIA检查下它们的趋势是否一致，...其实还应该画成网页工具这种tumor和normal分组对照的形式，然而学艺不精只能先止步于此了，还要向大家继续学习，定个小目标争取早日超过网页工具。</p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/lpKut7bigc4_6urEQ2HuHA",target="_blank" rel="noopener noreferrer">原文链接</a>
