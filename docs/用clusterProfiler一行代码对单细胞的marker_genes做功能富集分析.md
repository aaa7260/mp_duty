---
title: "用clusterProfiler一行代码对单细胞的marker genes做功能富集分析"
date: 2022-12-15T02:19:50Z
draft: ["false"]
tags: [
  "fetched",
  "YuLabSMU"
]
categories: ["Acdemic"]
---
用clusterProfiler一行代码对单细胞的marker genes做功能富集分析 by YuLabSMU
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><p data-tool="mdnice编辑器">曾老师发来他写的《<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519131&amp;idx=1&amp;sn=5556ce59eb1a694c85e8f35d67005f89&amp;scene=21#wechat_redirect" data-linktype="2">单细胞各个亚群特异性高表达基因的数据库注释（包括GO,KEGG,ReactomePA）</a>》，我看了一下，还能更简单一些。</p><p data-tool="mdnice编辑器">我本来是想着，我是不是可以写点小代码衔接一下，结果啥也不用写，已然是衔接得很好了。</p><h2 data-tool="mdnice编辑器"><span></span>首先是数据</h2><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(SeuratData)<br>data(<span>"pbmc3k"</span>)<br>sce &lt;- pbmc3k.final<br></code></pre><h2 data-tool="mdnice编辑器"><span></span>再者是marker基因的鉴定</h2><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(Seurat)<br>sce.markers &lt;- FindAllMarkers(object = sce, only.pos = <span>TRUE</span>, <br>                            min.pct = <span>0.25</span>,<br>                            thresh.use = <span>0.25</span>)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span>总要过滤一下吧</h2><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(dplyr)<br>markers &lt;- sce.markers |&gt; group_by(cluster) |&gt;<br>    filter(p_val_adj &lt; <span>0.001</span>) |&gt;<br>    ungroup()<br></code></pre><h2 data-tool="mdnice编辑器"><span></span>clusterProfiler上场</h2><p data-tool="mdnice编辑器">首先假如我们需要换个ID，只需要用<code>bitr</code>函数。然后对着data.frame的结果，来个<code>full_join</code>即可，并不需要list倒腾过来，又倒腾过去。</p><pre data-tool="mdnice编辑器"><span></span><code>library(clusterProfiler)<br>gid &lt;- bitr(unique(markers<span>$gene</span>), <span>'SYMBOL'</span>, <span>'ENTREZID'</span>, OrgDb= <span>'org.Hs.eg.db'</span>)<br>markers &lt;- full_join(markers, gid, by=c(<span>'gene'</span> = <span>'SYMBOL'</span>))<br></code></pre><p data-tool="mdnice编辑器">然后这样的data.frame就可以直接分析啦。如果你还不了解，那么你应该看我们<code>clusterProfiler</code> 4.0的文章。</p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI5NjUyNzkxMg==&amp;mid=2247491077&amp;idx=1&amp;sn=33379dcc1ef819042a73ba5416dd1c11&amp;chksm=ec43af42db34265434fc1fc1451b6b756cc69ed9acbbee65f0427a92e7b1df23a348826bb1ec&amp;scene=21#wechat_redirect" textvalue="‍‍" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-backh="257" data-backw="558" data-galleryid="" data-ratio="0.46029776674937967" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4lftB2YQgxroJIaRDzPLvXT8fPiaDXSzKJZ3mpcMsgoNicCHwaDYX7JDm7BaMCDZd5Xia2pz9qpxTDFg/640?wx_fmt=png" data-type="png" data-w="806" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4lftB2YQgxroJIaRDzPLvXT8fPiaDXSzKJZ3mpcMsgoNicCHwaDYX7JDm7BaMCDZd5Xia2pz9qpxTDFg/640?wx_fmt=png"></span></a></p><pre data-tool="mdnice编辑器"><span></span><code>x = compareCluster(ENTREZID ~ cluster, data = markers, fun=<span>'enrichKEGG'</span>)<br></code></pre><p data-tool="mdnice编辑器">然后就是出图了：</p><pre data-tool="mdnice编辑器"><span></span><code>dotplot(x, label_format=40) + theme(axis.text.x = element_text(angle=45, hjust=1)) <br></code></pre><p><img data-ratio="1.1109375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4lftB2YQgxroJIaRDzPLvXTrwLV26KgI9mFsldfTWVicRgBQfsOFibbzIoPoE1KbwkPCSm4Qicbp6adw/640?wx_fmt=png" data-type="png" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4lftB2YQgxroJIaRDzPLvXTrwLV26KgI9mFsldfTWVicRgBQfsOFibbzIoPoE1KbwkPCSm4Qicbp6adw/640?wx_fmt=png"></p><hr data-tool="mdnice编辑器"><h2 data-tool="mdnice编辑器"><span></span>假如我们是用COSG</h2><p data-tool="mdnice编辑器">那么还是一样，先找marker：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(COSG)<br>marker_cosg &lt;- cosg(<br>      sce,<br>      groups=<span>'all'</span>,<br>      assay=<span>'RNA'</span>,<br>      slot=<span>'data'</span>,<br>      mu=<span>1</span>,<br>      n_genes_user=<span>100</span>)<br></code></pre><p data-tool="mdnice编辑器">输出的list的第一个元素是个这样子的data.frame：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; head(marker_cosg[[<span>1</span>]])<br>  Naive CD4 <span>T</span> Memory CD4 <span>T</span> CD14+ Mono         B CD8 <span>T</span>  FCGR3A+ Mono     NK<br><span>1</span>        CCR7      TNFRSF4     S100A8     CD79A  GZMK        CDKN1C   GZMB<br><span>2</span>        FHIT         AQP3     LGALS2     MS4A1  CCL5          HES4   GNLY<br><span>3</span>        LEF1         IL7R     S100A9     TCL1A  CD8A         MS4A7  SPON2<br><span>4</span>        LDHB          CD2       CD14     CD79B KLRG1           CKB FGFBP2<br><span>5</span>   PRKCQ-AS1        CRIP2     MS4A6A LINC00926  LAG3 RP11-290F20.3 AKR1C3<br><span>6</span>     PIK3IP1        TRADD       FCN1    VPREB3  NKG7        MS4A4A   PRF1<br>        DC   Platelet<br><span>1</span>   FCER1A        GP9<br><span>2</span> SERPINF1        PF4<br><span>3</span>  CLEC10A AP001189.4<br><span>4</span>     ENHO     ITGA2B<br><span>5</span>    CLIC2      GNG11<br><span>6</span>   CLEC4C     TMEM40<br></code></pre><p data-tool="mdnice编辑器">每一个column是一个cluster，有多少个clusters就有多少个columns,然后因为大家都取前100个基因，所以等长，形成一个data.frame。大家都知道<code>compareCluster</code>的默认输入是一个named list，很多人在学R的时候，也了解到data.frame其实是个等长的list,这时候能够变通的人就很少了，它是个list,而且是个named list,名字就是column names啊。所以这个结果，直接就可以是<code>clusterProfiler</code>的输入了。</p><p data-tool="mdnice编辑器">于是一行代码搞定。</p><pre data-tool="mdnice编辑器"><span></span><code>y = compareCluster(marker_cosg[[<span>1</span>]], fun=<span>'enrichGO'</span>, <br>          OrgDb = <span>'org.Hs.eg.db'</span>, keyType = <span>'SYMBOL'</span>, ont=<span>"MF"</span>)<br></code></pre><p data-tool="mdnice编辑器">翠花上<span>酸菜</span>图片：</p><pre data-tool="mdnice编辑器"><span></span><code>dotplot(y, label_format=<span>60</span>) + theme(axis.text.x = element_text(angle=<span>45</span>, hjust=<span>1</span>))<br></code></pre><p><img data-ratio="1.6" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4lftB2YQgxroJIaRDzPLvXTsaWsb5pWtb178vibbCJohp07GrMAvUWtewlutA3WZZqvGBJ1p3STMpw/640?wx_fmt=png" data-type="png" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4lftB2YQgxroJIaRDzPLvXTsaWsb5pWtb178vibbCJohp07GrMAvUWtewlutA3WZZqvGBJ1p3STMpw/640?wx_fmt=png"></p></section><p><img data-backh="437" data-backw="578" data-galleryid="" data-ratio="0.7569141193595342" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nvniclelibxKccSkHuSlbxv3G4DS8D4V3NgyD6QHImhumicj6tp3cUrfazebQvLpLbvJxlofuqdiaNaw/640?wx_fmt=png" data-type="png" data-w="687" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nvniclelibxKccSkHuSlbxv3G4DS8D4V3NgyD6QHImhumicj6tp3cUrfazebQvLpLbvJxlofuqdiaNaw/640?wx_fmt=png"></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><code>clusterProfiler</code>以其易用性著称，许多人说这是他们学生信所学的第一个R包。但显而易见，这个包，比大家想象中的还容易用的。</p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/nvOXM2hpZq3UI_Npjhk8HQ",target="_blank" rel="noopener noreferrer">原文链接</a>
