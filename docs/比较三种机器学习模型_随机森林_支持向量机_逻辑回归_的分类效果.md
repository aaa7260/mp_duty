---
title: "比较三种机器学习模型（随机森林，支持向量机，逻辑回归）的分类效果"
date: 2022-09-07T02:44:27Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
比较三种机器学习模型（随机森林，支持向量机，逻辑回归）的分类效果 by 生信技能树
------
<div><section data-tools="新媒体管家" data-label="powered by xmt.cn"></section><section><figure><img data-backh="467" data-backw="654" data-before-oversubscription-url="http://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJey4T5YbyXRECKEuVbUPzJicMOmDppKEb3pLoHjIVicDmF1fW2Uo2KicrG8w/?wx_fmt=other" data-ratio="0.7140939597315437" data-src="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJey4T5YbyXRECKEuVbUPzJicMOmDppKEb3pLoHjIVicDmF1fW2Uo2KicrG8w/640?wx_fmt=other" data-type="other" data-w="745" title="img" src="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJey4T5YbyXRECKEuVbUPzJicMOmDppKEb3pLoHjIVicDmF1fW2Uo2KicrG8w/640?wx_fmt=other"><p><span>原文题目：The Pan-Cancer analysis of pseudogene expression reveals biologically and clinically relevant tumour subtypes</span></p><p><span><br></span></p></figure><p><span>这是2014年发表在nature communication上的一张图，大意如下：</span></p><p><span><span><strong><span> a </span></strong></span><strong> </strong>作者想用181个假基因预测癌症亚型，将306个样本分成训练集（223个），验证集（83个）。</span></p><p><span><span><strong><span> b </span></strong></span><strong> </strong>用训练集的数据（n=223）进行分析，采用五折交叉验证避免过拟合，选用随机森林，支持向量机，逻辑回归三种机器学习方法进行分类。</span></p><p><span><span><strong><span> c </span></strong></span><strong> </strong>三种机器学习方法的AUC曲线，发现SVM的效果最好。（AUC=0.962）</span></p><p><span><span><strong><span> d </span></strong></span><strong> </strong>用整个训练集（n=223）对验证集（n=83）进行分析，用SVM进行分类，AUC为0.922。</span></p><p><br></p><p><span><strong>我把这个思路搬运到我的课题里，复现图如下：</strong></span></p><figure><img data-backh="632" data-backw="654" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJeyEgeVIlf0MicxOvHDMy9kRXtx4HN9zqHdLqjkCCELAyeUjS3IGWdZ2Hg/?wx_fmt=other" data-ratio="0.9652173913043478" data-src="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJeyEgeVIlf0MicxOvHDMy9kRXtx4HN9zqHdLqjkCCELAyeUjS3IGWdZ2Hg/640?wx_fmt=other" data-type="other" data-w="805" title="img" src="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJeyEgeVIlf0MicxOvHDMy9kRXtx4HN9zqHdLqjkCCELAyeUjS3IGWdZ2Hg/640?wx_fmt=other"><p><br></p></figure><p><span>相似度：75%。a和b是用AI画的，所以今天分享下c和d的代码</span></p><h3><span> 一 </span><span> 差异分析</span></h3><p><span>假设我们有了这样的一个表达矩阵，叫Expr_all。以及表示表型数据的temp (character)。差异分析你可以用DESeq，但本次我就用T检验。</span></p><figure><img data-backh="475" data-backw="654" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJeyJdFibxIYTMsLx5H8FWwmYic46Zh0XgrATyhnRXctF2Fo6d3Mtpb8tPOw/?wx_fmt=other" data-ratio="0.7260981912144703" data-src="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJeyJdFibxIYTMsLx5H8FWwmYic46Zh0XgrATyhnRXctF2Fo6d3Mtpb8tPOw/640?wx_fmt=other" data-type="other" data-w="774" title="img" src="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJeyJdFibxIYTMsLx5H8FWwmYic46Zh0XgrATyhnRXctF2Fo6d3Mtpb8tPOw/640?wx_fmt=other"><p><br></p></figure><figure><img data-ratio="0.532" data-src="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJey1h0666XfnYRJXqpvMwDwv1PyGolbTcF0CSPrlwzSmc8dvBhTWmTjcA/640?wx_fmt=other" data-type="other" data-w="1000" title="img" src="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJey1h0666XfnYRJXqpvMwDwv1PyGolbTcF0CSPrlwzSmc8dvBhTWmTjcA/640?wx_fmt=other"><p><br></p></figure><pre><p><span><span>##转置</span><br>Expr_all&lt;-t(Expr_all)<br><span>##将每列变成numeric</span><br>Expr_all[,<span>1</span>]&lt;-<span>as</span>.numeric(Expr_all[,<span>1</span>])<br><span>for</span>(i in <span>2</span>:<span>535</span>){Expr_all[,i]&lt;-<span>as</span>.numeric(Expr_all[,i])}<br><span>##T检验</span><br>pvalue&lt;-sapply(<span>1</span>:<span>266</span>,<span><span>function</span><span>(i)</span></span>{t.test(Expr_all[which(temp==<span>"cancer"</span>),i],Expr_all[which(temp==<span>"normal"</span>),i])[[<span>3</span>]]})<br><span>##将T检验得到的P值进行矫正，降低假阳性</span><br>pvalue1&lt;-p.adjust(pvalue1)<br><span>##挑出P&lt;0.05的基因</span><br>t_expr&lt;-Expr_all[,which(pvalue1&lt;<span>0.05</span>)]<br>t_expr&lt;-<span>as</span>.data.frame(t_expr)<br>t_expr&lt;-t(t_expr)<br>t_expr&lt;-cbind(temp,t_expr)</span></p></pre><p><span>得到的t_expr矩阵如下</span></p><figure><img data-backh="319" data-backw="654" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJey7QYEMXI7Jl8CWz8cXzbRRWpnzeJ66CNwO50bTkr7ZpBsTUR5U2YlSA/?wx_fmt=other" data-ratio="0.488" data-src="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJey7QYEMXI7Jl8CWz8cXzbRRWpnzeJ66CNwO50bTkr7ZpBsTUR5U2YlSA/640?wx_fmt=other" data-type="other" data-w="1000" title="img" src="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJey7QYEMXI7Jl8CWz8cXzbRRWpnzeJ66CNwO50bTkr7ZpBsTUR5U2YlSA/640?wx_fmt=other"><p><br></p><p><br></p><p><br></p></figure><h3><span> 二 </span><span> 构建三种机器学习模型</span></h3><h4><span>1. 划分训练集和验证集</span></h4><pre><p><span><span>library</span>(randomForest)<br><span>library</span>(caret)<br><span>library</span>(pROC)<br><span>library</span>(caret)<br>inTrain&lt;-createDataPartition(y=t_expr[,<span>1</span>],p=<span>0.25</span>,list=<span>F</span>)<br>test&lt;-t_expr[inTrain,]<br>train&lt;-t_expr[-inTrain,]</span></p></pre><h4><span><br></span></h4><h4><span>2. 构建五折交叉验证RF模型</span></h4><pre><p><span>folds&lt;-createFolds(y=test[,<span>1</span>],k=<span>5</span>)<br><span>max</span>=<span>0</span><br>num=<span>0</span><br>fc&lt;-as.numeric()<br>mod_pre&lt;-as.numeric()<br><span>for</span>(i <span>in</span> <span>1</span>:<span>5</span>){<br>  fold_test&lt;-train[folds<span>[[i]]</span>,]<br>  fold_train&lt;-train[-folds<span>[[i]]</span>,]<br>  model&lt;-randomForest(temp~.,data=fold_train,proximity=T,importance=T)<br>  model_pre&lt;-predict(model,newdata = fold_test,<span>type</span>=<span>"prob"</span>)<br>  fc&lt;-append(fc,as.numeric(fold_test$temp))<br>  mod_pre&lt;-append(mod_pre,model_pre[,<span>1</span>])<br>}<br>df&lt;-cbind(fc,as.numeric(mod_pre))</span></p></pre><h4><span><br></span></h4><h4><span>3. 构建五折交叉验证SVM模型</span></h4><pre><p><span><span>max</span>=<span>0</span><br>num=<span>0</span><br>fc&lt;-as.numeric()<br>mod_pre&lt;-as.numeric()<br><span>for</span>(i <span>in</span> <span>1</span>:<span>5</span>){<br>  fold_test&lt;-t_expr[folds<span>[[i]]</span>,]<br>  fold_train&lt;-t_expr[-folds<span>[[i]]</span>,]<br>  model&lt;-svm(temp~.,data=fold_train,probability=T)<br>  model_pre&lt;-predict(model,newdata = fold_test,decision.values = TRUE, probability = TRUE)<br>  fc&lt;-append(fc,as.numeric(fold_test$temp))<br>  mod_pre&lt;-append(mod_pre,as.numeric(attr(model_pre, <span>"probabilities"</span>)[,<span>2</span>]))<br>}<br>df&lt;-cbind(df,cbind(fc,mod_pre))</span></p></pre><h4><span><br></span></h4><h4><span>4. 构建五折交叉验证LR模型</span></h4><pre><p><span><span>max</span>=<span>0</span><br>num=<span>0</span><br>fc&lt;-as.numeric()<br>mod_pre&lt;-as.numeric()<br><span>for</span>(i <span>in</span> <span>1</span>:<span>5</span>){<br>  fold_test&lt;-train[folds<span>[[i]]</span>,]<br>  fold_train&lt;-train[-folds<span>[[i]]</span>,]<br>  model&lt;-glm(temp~.,family=binomial(link=logit),data=fold_train)<br>  model_pre&lt;-predict(model,<span>type</span>=<span>'response'</span>,newdata=fold_test)<br>  fc&lt;-append(fc,fold_test$temp)<br>  mod_pre&lt;-append(mod_pre,as.numeric(model_pre))<br>}<br>df&lt;-cbind(df,cbind(fc,mod_pre))</span></p></pre><h4><span><br></span></h4><h4><span>5. 画三者的AUC曲线</span></h4><pre><p><span>pdf(<span>"/Users/baiyunfan/desktop/ROC.pdf"</span>,height=<span>6</span>,width=<span>6</span>)<br>mycol &lt;- c(<span>"slateblue"</span>,<span>"seagreen3"</span>,<span>"dodgerblue"</span>,<span>"firebrick1"</span>,<span>"lightgoldenrod"</span>,<span>"magenta"</span>,<span>"orange2"</span>)<br>x&lt;-plot.roc(df[,<span>1</span>],df[,<span>2</span>],<br>            smooth=<span>F</span>,<br>            lwd=<span>2</span>,<br>            ylim=c(<span>0</span>,<span>1</span>),<br>            xlim=c(<span>1</span>,<span>0</span>),<br>            legacy.axes=<span>T</span>,<br>            main=<span>""</span>,<br>            col=mycol[<span>2</span>])<br>x&lt;-plot.roc(df[,<span>3</span>],df[,<span>4</span>],<br>            smooth=<span>F</span>,<br>            add=<span>T</span>,<br>            lwd=<span>2</span>,<br>            ylim=c(<span>0</span>,<span>1</span>),<br>            xlim=c(<span>1</span>,<span>0</span>),<br>            legacy.axes=<span>T</span>,<br>            main=<span>""</span>,<br>            col=mycol[<span>3</span>])<br>x&lt;-plot.roc(df[,<span>5</span>],df[,<span>6</span>],<br>            smooth=<span>F</span>,<br>            add=<span>T</span>,<br>            lwd=<span>2</span>,<br>            ylim=c(<span>0</span>,<span>1</span>),<br>            xlim=c(<span>1</span>,<span>0</span>),<br>            legacy.axes=<span>T</span>,<br>            main=<span>""</span>,<br>            col=mycol[<span>4</span>])<br><br>legend.name &lt;- c(paste(<span>"RF"</span>,<span>"AUC"</span>,<span>0.9836</span>,sep=<span>" "</span>),paste(<span>"SVM"</span>,<span>"AUC"</span>,<span>0.9903</span>,sep=<span>" "</span>),paste(<span>"LR"</span>,<span>"AUC"</span>,<span>0.9986</span>,sep=<span>" "</span>))<br>legend(<span>"bottomright"</span>, <br>       legend=legend.name,<br>       col = mycol[<span>2</span>:<span>4</span>],<br>       lwd = <span>2</span>,<br>       bty=<span>"n"</span>)<br>dev.off()</span></p></pre><figure><img data-backh="623" data-backw="624" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJeyPh6YiaQpXPvgnCicVkYkq5icgAJSetp03wVGLFZGko9ylsox9jE1BG4VQ/?wx_fmt=other" data-ratio="0.9983974358974359" data-src="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJeyPh6YiaQpXPvgnCicVkYkq5icgAJSetp03wVGLFZGko9ylsox9jE1BG4VQ/640?wx_fmt=other" data-type="other" data-w="624" title="img" src="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJeyPh6YiaQpXPvgnCicVkYkq5icgAJSetp03wVGLFZGko9ylsox9jE1BG4VQ/640?wx_fmt=other"><p><br></p></figure><p><span>发现LR的AUC最高，于是单拿出来用整个train对test画</span></p><p><span><br></span></p><h4><span>6. 用整个训练集对验证集建立LR模型以及AUC曲线</span></h4><pre><p><span>model&lt;<span>-glm(temp~.,data=train,family=binomial(link=logit))</span><br>model_pre&lt;-predict(model,type=<span>'response'</span>,newdata=<span>test)</span><br>pdf("/Users/baiyunfan/desktop/RF.pdf",height=<span>6,width</span>=<span>6)</span><br>x&lt;-plot.roc(test[,1],model_pre,<br>            smooth=<span>F,</span><br>            lwd=<span>2,</span><br>            ylim=<span>c(0,1),</span><br>            xlim=<span>c(1,0),</span><br>            legacy.axes=<span>T,</span><br>            main=<span>""</span>,<br>            col=<span>mycol[4])</span><br>legend.name &lt;- paste("LR","AUC",0.9557,sep=<span>" "</span>)<br>legend("bottomright", <br>       legend=<span>legend.name,</span><br>       col = <span>mycol[4],</span><br>       lwd = <span>2,</span><br>       bty=<span>"n"</span>)<br>dev.off()</span></p></pre><figure><img data-backh="614" data-backw="634" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJeymiaVVwTJI6UJ9M3HzaWuJvhNzOArF7JbrjzRNmfcIqI5CxR1ovjibFgA/?wx_fmt=other" data-ratio="0.9699842022116903" data-src="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJeymiaVVwTJI6UJ9M3HzaWuJvhNzOArF7JbrjzRNmfcIqI5CxR1ovjibFgA/640?wx_fmt=other" data-type="other" data-w="633" title="img" src="https://mmbiz.qpic.cn/mmbiz/cZNhZQ6j4wzFAPbkdkx6RuLC4n00iaJeymiaVVwTJI6UJ9M3HzaWuJvhNzOArF7JbrjzRNmfcIqI5CxR1ovjibFgA/640?wx_fmt=other"><p><br></p></figure><p><span>AUC掉下来了，0.9557，大家来探讨下为什么吧～</span></p><p>如果你完全没有看懂我们在讲什么，那你可能需要下面的课程：</p><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247488803&amp;idx=1&amp;sn=96b8642121587d5c3a782998a601dcf0&amp;chksm=9b485598ac3fdc8edf0bfe90d6b20811bdbae6d93c966939712e1f229399c932e3576c78fba1&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2">生信技能树（爆款入门培训课）全国巡讲约你</a></p><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247488873&amp;idx=2&amp;sn=5981e4addaa57886ad573f35103401cb&amp;chksm=9b4855d2ac3fdcc4da261d113248b4e95e51d79e31bf8e2fa2ad5fb3efc3c238d616bc3c59d7&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2">生信技能树（爆款入门培训课）巡讲第一站-重庆</a><span>  （已结束）</span></p><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247489054&amp;idx=2&amp;sn=37b1bb99333db1077b03cc9ecdfe115b&amp;chksm=9b4856a5ac3fdfb30791cfb069687f6a00e2052f0980d14a1bedf83d8ea5a790724b0ff29618&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2">生物信息学全国巡讲之<strong>粤港澳大湾区</strong>专场</a><span> </span><span>（已结束）</span></p><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247489101&amp;idx=2&amp;sn=4536cd2d9e0d89979a84bfc26720693b&amp;chksm=9b4856f6ac3fdfe0ec2734117294015ee03b5665801b597dbf714fe645ab680a6ff2e7aa6ed6&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2"><span>生信技能树（爆款入门培训课）巡讲第二站-<strong>济南 </strong></span></a><span><span><strong><span>（3.16-3.18正在报名）</span></strong></span></span></p><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247489139&amp;idx=1&amp;sn=738b5b7050a85bb24671313247009f14&amp;chksm=9b4856c8ac3fdfde49eaccaef1e3fe4b95012d9312142f2d8f918807672da28560977831c78a&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2"><span>生信技能树（爆款入门培训课）巡讲-千呼万唤</span><span>进</span><span><strong><span><strong>北京</strong></span></strong></span></a><span><strong><span><strong><span>（连续两场正在报名）</span></strong></span></strong></span></p><p><br></p><p>另外，点击<strong><span>下面的阅读原文</span></strong>，可以直达作者博客，关注她更多教程！</p></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/sJOnRYbq-PG3E3rEBwqdnw",target="_blank" rel="noopener noreferrer">原文链接</a>
