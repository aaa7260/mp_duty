---
title: "R可视化——图片颜色提取及应用（以jpg格式图片为例）"
date: 2022-11-24T06:15:37Z
draft: ["false"]
tags: [
  "fetched",
  "科研后花园"
]
categories: ["Acdemic"]
---
R可视化——图片颜色提取及应用（以jpg格式图片为例） by 科研后花园
------
<div><section><p><img data-ratio="0.6666666666666666" data-src="https://mmbiz.qpic.cn/mmbiz_gif/W4pAicbaFuzXwGrEHHaiatjHJ3p0gYPMuyQibMKZJcfyXBticHcre13PFnxmO5xstr5Pz0cmqIO2DpHCFyUOnuTR8g/640?wx_fmt=gif" data-type="gif" data-w="750" src="https://mmbiz.qpic.cn/mmbiz_gif/W4pAicbaFuzXwGrEHHaiatjHJ3p0gYPMuyQibMKZJcfyXBticHcre13PFnxmO5xstr5Pz0cmqIO2DpHCFyUOnuTR8g/640?wx_fmt=gif"></p></section><section><section><section><section><section><img data-ratio="1.0789473684210527" data-src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JgqMVy0icaicmkPIicGh1kKicUJ4lztgzav2eEp1ibopuez43v4wMW2IPeE2kXrXXJq9Oibic3J0icpxsaCBg/640" data-type="png" data-w="38" src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JgqMVy0icaicmkPIicGh1kKicUJ4lztgzav2eEp1ibopuez43v4wMW2IPeE2kXrXXJq9Oibic3J0icpxsaCBg/640"></section><section><p><span>设置工作目录、加载R包</span></p></section></section></section></section></section><section><section><section><section><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span>rm(<span>list</span> = ls())</span></code><code><span><span>#设置工作目录</span></span></code><code><span>setwd(<span>"D:\\图片颜色提取"</span>)</span></code><code><span><span>#加载R包</span></span></code><code><span>library(RImagePalette)</span></code><code><span>library(imager)</span></code><code><span>library(scales)</span></code><code><span>library(ggplot2)</span></code><code><span>library(ggprism)</span></code><code><span>library(reshape)</span></code><code><span>library(ggalluvial)</span></code></pre></section></section></section></section></section><section><section><section><section><section><img data-ratio="1.0789473684210527" data-src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JgqMVy0icaicmkPIicGh1kKicUJ4lztgzav2eEp1ibopuez43v4wMW2IPeE2kXrXXJq9Oibic3J0icpxsaCBg/640" data-type="png" data-w="38" src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JgqMVy0icaicmkPIicGh1kKicUJ4lztgzav2eEp1ibopuez43v4wMW2IPeE2kXrXXJq9Oibic3J0icpxsaCBg/640"></section><section><p><span>加载图片并提取颜色</span></p></section></section></section></section></section><section><section><section><section><p><span><strong>1、图片加载及预览——jpg格式图片加载主要基于imager包中的load.image()函数：</strong></span></p><section><ul><li><li><li></ul><pre data-lang="nginx"><code><span>##图1</span></code><code><span>imgjpg1 &lt;- load.image("test1.jpg")#读取图片</span></code><code><span>plot(imgjpg1,xlim = c(1,width(imgjpg1)),ylim = c(height(imgjpg1),1)) #显示图片</span></code></pre></section><p><img data-galleryid="" data-ratio="0.6241666666666666" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSZzveiamZQb0xJCrdCcj66DTHkSVBIbEMQOuzzeP74Lnko9UkRZJXeAQ/640?wx_fmt=png" data-type="png" data-w="1200" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSZzveiamZQb0xJCrdCcj66DTHkSVBIbEMQOuzzeP74Lnko9UkRZJXeAQ/640?wx_fmt=png"></p><p><strong><span>2、提取图片颜色——主要基于RImagePalette包中的image_palette()函数：</span></strong></p><section><ul><li><li><li></ul><pre data-lang="nginx"><code><span>#提取图片颜色</span></code><code><span>df_color1 &lt;- image_palette(imgjpg1,n=10)</span></code><code><span>show_col(df_color1)#展示</span></code></pre></section><p><img data-galleryid="" data-ratio="0.7463002114164905" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSQFxPeDtgopcsCxwvEfCQtO3OBpPI8LhymH564kMKf3XCppdbpRiaglg/640?wx_fmt=png" data-type="png" data-w="473" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSQFxPeDtgopcsCxwvEfCQtO3OBpPI8LhymH564kMKf3XCppdbpRiaglg/640?wx_fmt=png"></p><p><span><strong>3、同样的原理提取其他图片颜色：</strong></span></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span>##图2</span></span></code><code><span><span>imgjpg2</span> &lt;- load.image(<span>"test2.jpg"</span>)<span>#读取图片</span></span></code><code><span>plot(imgjpg2,xlim = c(<span>1</span>,width(imgjpg2)),ylim = c(height(imgjpg2),<span>1</span>)) <span>#显示图片</span></span></code><code><span><span>#提取图片颜色</span></span></code><code><span>df_color2 &lt;- image_palette(imgjpg2,n=<span>10</span>)</span></code><code><span>show_col(df_color2)</span></code></pre></section><p><img data-galleryid="" data-ratio="0.64" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnS05ibgzVTBVbkonlwdibiaESSgrJchJgC5V7TNb2CATNViaVV8SYzz0tFeA/640?wx_fmt=png" data-type="png" data-w="1150" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnS05ibgzVTBVbkonlwdibiaESSgrJchJgC5V7TNb2CATNViaVV8SYzz0tFeA/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.7342047930283224" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSNrfbmibyWSHK3syNQakjvgrssQLDHLSXQ0TpiaY0UmjK4MDywVicpFmqg/640?wx_fmt=png" data-type="png" data-w="459" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSNrfbmibyWSHK3syNQakjvgrssQLDHLSXQ0TpiaY0UmjK4MDywVicpFmqg/640?wx_fmt=png"></p><p><br></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span>##图3</span></span></code><code><span><span>imgjpg3</span> &lt;- load.image(<span>"test3.jpg"</span>)<span>#读取图片</span></span></code><code><span>plot(imgjpg3,xlim = c(<span>1</span>,width(imgjpg3)),ylim = c(height(imgjpg3),<span>1</span>)) <span>#显示图片</span></span></code><code><span><span>#提取图片颜色</span></span></code><code><span>df_color3 &lt;- image_palette(imgjpg3,n=<span>10</span>)</span></code><code><span>show_col(df_color3)</span></code></pre></section><p><img data-galleryid="" data-ratio="0.585" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSFV7ibpC64AFNHbHQC28lYtREo8AJZLibq54dicb9xChxvB9gwicVRYQ7Tg/640?wx_fmt=png" data-type="png" data-w="1200" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSFV7ibpC64AFNHbHQC28lYtREo8AJZLibq54dicb9xChxvB9gwicVRYQ7Tg/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.7505376344086021" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnScbfIVNNsQUrbQxQAuFN5uETABZ1EyTQ57VXUreiaBNs7O5GTcdCkzTQ/640?wx_fmt=png" data-type="png" data-w="465" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnScbfIVNNsQUrbQxQAuFN5uETABZ1EyTQ57VXUreiaBNs7O5GTcdCkzTQ/640?wx_fmt=png"></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span>##图4</span></span></code><code><span><span>imgjpg4</span> &lt;- load.image(<span>"test4.jpg"</span>)<span>#读取图片</span></span></code><code><span>plot(imgjpg4,xlim = c(<span>1</span>,width(imgjpg4)),ylim = c(height(imgjpg4),<span>1</span>)) <span>#显示图片</span></span></code><code><span><span>#提取图片颜色</span></span></code><code><span>df_color4 &lt;- image_palette(imgjpg4,n=<span>10</span>)</span></code><code><span>show_col(df_color4)</span></code></pre></section><p><img data-galleryid="" data-ratio="0.6369150779896013" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnS5TmJC3paCyNzWG0uWRMj5iaaTtTcicWlEicMjADzh8sMdDMBwf12Q8Kug/640?wx_fmt=png" data-type="png" data-w="1154" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnS5TmJC3paCyNzWG0uWRMj5iaaTtTcicWlEicMjADzh8sMdDMBwf12Q8Kug/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.7387580299785867" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSvJ4FIOTLjaIcalqwaAm7CicUz5ACeharPKsxXTmG7aJEK5OQ9oDC8EA/640?wx_fmt=png" data-type="png" data-w="467" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSvJ4FIOTLjaIcalqwaAm7CicUz5ACeharPKsxXTmG7aJEK5OQ9oDC8EA/640?wx_fmt=png"></p></section></section></section></section><section><section><section><section><section><img data-ratio="1.0789473684210527" data-src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JgqMVy0icaicmkPIicGh1kKicUJ4lztgzav2eEp1ibopuez43v4wMW2IPeE2kXrXXJq9Oibic3J0icpxsaCBg/640" data-type="png" data-w="38" src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JgqMVy0icaicmkPIicGh1kKicUJ4lztgzav2eEp1ibopuez43v4wMW2IPeE2kXrXXJq9Oibic3J0icpxsaCBg/640"></section><section><p><span>应用提取图片的颜色绘图</span></p></section></section></section></section></section><section><section><section><section><p><span><strong><span>1、构造绘图数据</span></strong></span></p><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span>df&lt;-data.frame(samples=c(<span>'a'</span>,<span>'b'</span>,<span>'c'</span>,<span>'d'</span>,<span>'e'</span>,<span>'f'</span>,<span>'g'</span>,<span>'h'</span>,<span>'i'</span>,<span>'j'</span>),</span></code><code><span>               A=c(0.12,0.15,0.1,0.07,0.1,0.1,0.08,0.1,0.13,0.05),</span></code><code><span>               B=c(0.35,0.1,0.05,0.05,0.05,0.1,0.1,0.05,0.1,0.05),</span></code><code><span>               C=c(0.25,0.15,0.1,0.07,0.1,0.1,0.05,0.05,0.08,0.05),</span></code><code><span>               D=c(0.05,0.2,0.1,0.2,0.1,0.1,0.1,0.05,0.05,0.05))</span></code><code><span><span>#变量格式转换,宽数据转化为长数据,方便后续作图</span></span></code><code><span>df1 &lt;- melt(df,id.vars = <span>'samples'</span>,measure.vars = c(<span>'A'</span>,<span>'B'</span>,<span>'C'</span>,<span>'D'</span>))</span></code><code><span>names(df1)[1:2] &lt;- c(<span>"group"</span>,<span>"X"</span>)  <span>#修改列名</span></span></code></pre></section><p><img data-galleryid="" data-ratio="2.3807106598984773" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSUnjBxd2p8nI7eW5t9iaDRPLYAfO5BjO0y5yNLjCl64Y1jp2tHJ8rpMg/640?wx_fmt=png" data-type="png" data-w="197" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSUnjBxd2p8nI7eW5t9iaDRPLYAfO5BjO0y5yNLjCl64Y1jp2tHJ8rpMg/640?wx_fmt=png"></p><p><br></p><p><span><strong>2、绘图</strong></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="cs"><code><span><span>#绘图</span></span></code><code><span>p&lt;-ggplot(df1, aes( x = X,y=<span>100</span> * <span>value</span>,fill = <span>group</span>,</span></code><code><span>                 stratum = <span>group</span>, alluvium = <span>group</span>))+</span></code><code><span>  geom_stratum(width = <span>0.7</span>, color=<span>'white'</span>)+</span></code><code><span>  geom_alluvium(alpha = <span>0.5</span>,</span></code><code><span>                width = <span>0.7</span>,</span></code><code><span>                color=<span>'white'</span>,</span></code><code><span>                size = <span>1</span>,</span></code><code><span>                curve_type = <span>"linear"</span>)+</span></code><code><span>  scale_y_continuous(expand = c(<span>0</span>,<span>0</span>))+</span></code><code><span>  labs(x=<span>"Samples"</span>,y=<span>"Relative Abundance(%)"</span>,</span></code><code><span>       fill=<span>"group"</span>)+</span></code><code><span>  theme_prism(palette = <span>"candy_bright"</span>,</span></code><code><span>              base_fontface = <span>"plain"</span>, </span></code><code><span>              base_family = <span>"serif"</span>, </span></code><code><span>              base_size = <span>16</span>, </span></code><code><span>              base_line_size = <span>0.8</span>, </span></code><code><span>              axis_text_angle = <span>45</span>)+ </span></code><code><span>  theme(legend.position = <span>'top'</span>)</span></code><code><span>p</span></code></pre></section><p><img data-galleryid="" data-ratio="0.75" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSSI1Sjemkc2sleAWeU30cGGaRNEjZe7jCAEuM1BnEFvR0RZ0heBacnQ/640?wx_fmt=png" data-type="png" data-w="1200" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSSI1Sjemkc2sleAWeU30cGGaRNEjZe7jCAEuM1BnEFvR0RZ0heBacnQ/640?wx_fmt=png"></p><p><span><strong>3、应用绘图颜色并拼图</strong></span><br></p><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="perl"><code><span><span>#应用颜色</span></span></code><code><span>p2&lt;-p+scale_fill_manual(<span>values</span> = df_color1)</span></code><code><span>p3&lt;-p+scale_fill_manual(<span>values</span> = df_color2)</span></code><code><span>p4&lt;-p+scale_fill_manual(<span>values</span> = df_color3)</span></code><code><span>p5&lt;-p+scale_fill_manual(<span>values</span> = df_color4)</span></code><code><span><span>#拼图</span></span></code><code><span>cowplot::plot_grid(p2,p3,p4,p5,ncol = <span>2</span>)</span></code></pre></section><p><img data-galleryid="" data-ratio="0.75" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSmTPPu7eyibMibKdr6IMAZIUGTKCa6BNlb5GW86ZeQb0UnRnGILSEXuHg/640?wx_fmt=png" data-type="png" data-w="1200" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lr5tUubdMjYJhdoibRJxlnSmTPPu7eyibMibKdr6IMAZIUGTKCa6BNlb5GW86ZeQb0UnRnGILSEXuHg/640?wx_fmt=png"></p><p><br></p><p><br></p></section></section></section></section><p><strong><em><span>图片来源于网络（https://zhuanlan.zhihu.com/p/155963612），仅用于学习交流！</span></em></strong><br></p><section><mp-common-profile data-id="MzkzODM4NzQ1NQ==" data-pluginname="mpprofile" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0nc718ED9sAicaiaEia0mmkzpsjzyEWWDDIRbGeHIvsucukFjsTthP2qOvNBnc6qriaLnZ62mUoEAknxw/0?wx_fmt=png" data-nickname="科研后花园" data-alias="wzsBio" data-signature="主要发布内容包括：基于R、Python的数据可视化、科研网站介绍、科研小技巧、文献解读等，希望能帮助大家。" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><section><section><section><section><section><section><img data-ratio="1.1666666666666667" data-type="png" data-src="https://mmbiz.qpic.cn/mmbiz_gif/oMlX8Lll9JhkUet5fvlicjFF5aZJEiaicOpLARnFoXla2IEPib6LDXlJgO9xx4jcACxEJaElosrhJu3nichwuaaRgsA/640" data-w="48" src="https://mmbiz.qpic.cn/mmbiz_gif/oMlX8Lll9JhkUet5fvlicjFF5aZJEiaicOpLARnFoXla2IEPib6LDXlJgO9xx4jcACxEJaElosrhJu3nichwuaaRgsA/640"></section><section><section><img data-ratio="2" data-type="png" data-src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JhkUet5fvlicjFF5aZJEiaicOpmSwdSfgT9icYDfawf9DcunguK2pYuriayK0bNASniagibj4iaKoakQr5sicg/640" data-w="17" src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JhkUet5fvlicjFF5aZJEiaicOpmSwdSfgT9icYDfawf9DcunguK2pYuriayK0bNASniagibj4iaKoakQr5sicg/640"></section><section><p>爱我请给我好看!</p></section></section><section><img data-ratio="1.1666666666666667" data-type="png" data-src="https://mmbiz.qpic.cn/mmbiz_gif/oMlX8Lll9JhkUet5fvlicjFF5aZJEiaicOpLARnFoXla2IEPib6LDXlJgO9xx4jcACxEJaElosrhJu3nichwuaaRgsA/640" data-w="48" src="https://mmbiz.qpic.cn/mmbiz_gif/oMlX8Lll9JhkUet5fvlicjFF5aZJEiaicOpLARnFoXla2IEPib6LDXlJgO9xx4jcACxEJaElosrhJu3nichwuaaRgsA/640"></section></section></section></section></section></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/t1S7dELtnhD9u-LaAjY-kw",target="_blank" rel="noopener noreferrer">原文链接</a>
