---
title: "ggplot2进阶绘制蜂窝图"
date: 2023-10-29T00:02:48Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
ggplot2进阶绘制蜂窝图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来解释如何使用ggbeeswarm与packcircles来绘制蜂窝图，小编将通过一个精选案例进行详细演示，这里展示的图形仅用于示范目的，整个过程仅参考。希望对各位观众老爷能有所帮助。数据代码已经整合上传到2023VIP交流群，加群的观众老爷可自行下载，有需要的朋友可关注文末介绍加入VIP交流群。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(ggbeeswarm)<br><span>library</span>(packcircles)<br><span>library</span>(ggtext)<br><span>library</span>(ggrepel)<br><span>library</span>(camcorder)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- read_csv(<span>'data.csv'</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>cent_bee &lt;- df %&gt;% group_by(gender) %&gt;% arrange(-age) %&gt;% <br>  mutate(g_rank = row_number(), name = fct_reorder(name, age)) %&gt;% ungroup()<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>绘制一个基础图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>p &lt;- ggplot(cent_bee) + <br>  geom_beeswarm(aes(age, <span>"group"</span>), groupOnX = <span>FALSE</span>) +<br>  theme_minimal() +<br>  theme(plot.background = element_rect(fill = <span>"grey99"</span>, color = <span>NA</span>))<br><br><span># 构建ggplot图形，将结果存储在pp变量中</span><br>pp &lt;- ggplot_build(p)<br><br><span># 从pp对象中提取数据，并创建一个新的数据框pp_df</span><br><span># 包含x, y坐标，半径r，以及cent_bee数据框中的其他相关列</span><br>pp_df &lt;- data.frame(<br>  x = pp$data[[<span>1</span>]]$x, <br>  y = pp$data[[<span>1</span>]]$y,<br>  r = <span>0.03</span>,<br>  place = cent_bee$place_of_death_or_residence,<br>  gender = cent_bee$gender,<br>  name = cent_bee$name,<br>  age = cent_bee$age,<br>  still_alive = cent_bee$still_alive,<br>  g_rank = cent_bee$g_rank<br>) %&gt;% <br>  arrange(x) %&gt;%  <span># 根据x坐标排序</span><br>  mutate(id = row_number())  <span># 为每行添加一个唯一的id</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>调整点的位置</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 使用circleRepelLayout函数调整点的位置，以避免重叠</span><br>pp_repel &lt;- circleRepelLayout(pp_df, wrap = <span>FALSE</span>, sizetype = <span>"area"</span>)<br><span># 使用circleLayoutVertices函数获取调整后的点的坐标</span><br>pp_repel_out &lt;- circleLayoutVertices(pp_repel$layout)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据整合</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>pp_plot &lt;- pp_repel_out %&gt;% <br>  left_join(pp_df, by = <span>"id"</span>) %&gt;% <br>  mutate(x = x.x,y = y.x,color = case_when(place == <span>"United States"</span> ~ <span>"#3B9AB2"</span>,<br>                                           place == <span>"Japan"</span> ~ <span>"#78B7C5"</span>,<span>TRUE</span> ~ <span>"grey20"</span>),<br>    color2 = if_else(still_alive == <span>"alive"</span>, color, colorspace::lighten(color, <span>0.8</span>))) %&gt;% <br>  select(-x.x,-y.x,-x.y,-y.y) %&gt;% select(x,y,color,color2,id,gender)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>ggplot(pp_plot) +<br>  annotate(<span>"text"</span>, x = c(<span>110.3</span>, <span>113.3</span>), y = c(<span>8</span>, <span>4.5</span>), label = c(<span>"Men"</span>, <span>"Women"</span>),hjust = <span>1</span>, size = <span>6</span>,color=<span>"black"</span>) +<br>  geom_polygon(aes(x, y + <span>3.5</span> * as.numeric(factor(gender)), group = id, fill = color2)) +<br>  geom_polygon(aes(x, y + <span>3.5</span> * as.numeric(factor(gender)), group = id, color = alpha(color, <span>0.6</span>)), fill = <span>NA</span>, linewidth = <span>0.5</span>) +<br>  scale_x_continuous(breaks = seq(<span>110</span>, <span>124</span>, <span>2</span>), limits = c(<span>110</span>, <span>124</span>)) +<br>  scale_color_identity() +<br>  scale_fill_identity() +<br>  coord_fixed() +<br>  theme_minimal() +<br>  theme(legend.position = <span>"none"</span>,plot.background = element_blank(),<br>    axis.title = element_blank(),<br>    axis.text.y = element_blank(),<br>    axis.text.x = element_text(color=<span>"black"</span>,size=<span>8</span>),<br>    panel.grid.major.y = element_blank(),<br>    panel.grid.minor.y = element_blank(),<br>    plot.margin = margin(<span>10</span>, <span>0</span>, <span>10</span>, <span>0</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5509259259259259" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJpoYN3VzxUkW1iaic0RO1ibbez2ciaicgJm2T3h9BDrBeqyk7NxtNerB9n0Q/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJpoYN3VzxUkW1iaic0RO1ibbez2ciaicgJm2T3h9BDrBeqyk7NxtNerB9n0Q/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节内容介绍到此结束，过程仅供参考；有需要学习个性化数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>购买<strong>「2023年度会员文档」</strong>同步更新中<strong>「售价149元」</strong>，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；按照往年数据小编年产出约在150+以上</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可下单购买，需要了解更多信息的朋友欢迎淘宝店铺交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023VIP会员文档(淘宝扫一扫)</span><span></span></h3><p><img data-croporisrc="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJLkh8ib9mUkNvxOiaxmz74xZd3kcSPXu7OvzZ4KJgLyMxiaS53SV4k3DuA/0?wx_fmt=jpeg" data-cropx1="126.77419354838709" data-cropx2="1060.6774193548385" data-cropy1="393.7264325323475" data-cropy2="1898.7774730189017" data-galleryid="" data-ratio="1.6113490364025695" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJHM2Fib3U72zNZvNCTvjfZpGA1PMuKT3uZAgHIPn6lMovCu5uwPyt2GA/640?wx_fmt=jpeg" data-type="jpeg" data-w="934" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJHM2Fib3U72zNZvNCTvjfZpGA1PMuKT3uZAgHIPn6lMovCu5uwPyt2GA/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023会员群案例展示</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJIkBCKot5S1IzPuA7fsokFbQSBejL7LbibpkzhjbaXkDKZCLn3fhYjXw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJIkBCKot5S1IzPuA7fsokFbQSBejL7LbibpkzhjbaXkDKZCLn3fhYjXw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJOZ1FyNn044ibugPGHrKW8roGd4PEInHRLw05wzbjO59WkxSICia3TlPQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJOZ1FyNn044ibugPGHrKW8roGd4PEInHRLw05wzbjO59WkxSICia3TlPQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJAoe0VWHCNiacL96GToquHtcetCNyazAg6XbiaKHe1hmJ76OKYxG81BPQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJAoe0VWHCNiacL96GToquHtcetCNyazAg6XbiaKHe1hmJ76OKYxG81BPQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJXKUmicqjafxamkicmU14lX1n4kTbCXJrX7KkcOy2bUjREk6y6z6fUQYQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJXKUmicqjafxamkicmU14lX1n4kTbCXJrX7KkcOy2bUjREk6y6z6fUQYQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJuYia8iaGncLNYMVPLYg8J3BQ9LoKcHQQaHyVk8LsOibuvv8UhHV4PV5WQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJuYia8iaGncLNYMVPLYg8J3BQ9LoKcHQQaHyVk8LsOibuvv8UhHV4PV5WQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJwtwxR63KaY5MchOrWG2pmn7TiaLuFvIiaibdnzKKuLtQqWibAZJQSRxMug/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJwtwxR63KaY5MchOrWG2pmn7TiaLuFvIiaibdnzKKuLtQqWibAZJQSRxMug/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJAEoG3a6oVCabsicYIVxic8FaKjItqVZtNglK76Ll0MibObiarTic27dcUVA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJAEoG3a6oVCabsicYIVxic8FaKjItqVZtNglK76Ll0MibObiarTic27dcUVA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJgwPZWfZIUibAMOIRMZvTVTcCcflDys58dDvbycfpXAGWIROxa9j1Olw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJgwPZWfZIUibAMOIRMZvTVTcCcflDys58dDvbycfpXAGWIROxa9j1Olw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJjFHutAtLCLlOJf0Q82btKEuviakVXkFPTWtHSE8EnJibZkias8oXU9HZQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJjFHutAtLCLlOJf0Q82btKEuviakVXkFPTWtHSE8EnJibZkias8oXU9HZQ/640?wx_fmt=png"></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/OWfo2gClQhXnOO_wv1uR2w",target="_blank" rel="noopener noreferrer">原文链接</a>
