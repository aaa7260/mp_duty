---
title: "如何判断PCA哪些主成分是有意义"
date: 2023-10-03T10:57:54Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
如何判断PCA哪些主成分是有意义 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">最近在学GWAS涉及到了使用PCA方法校正群体结构，联系我们前面转录组讨论的那么多PCA情况，我有了一些新的感悟所以有了本文</p><p data-tool="mdnice编辑器">各种降维手段，在我们的转录组分析中十分常用，特别是PCA，在单细胞里我们加上了UMAP和tSNE</p><p data-tool="mdnice编辑器">在这篇 <a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247513657&amp;idx=1&amp;sn=5f9c7b4f3c6476128bafe1efc3a68890&amp;chksm=fa457304cd32fa12638d2bf41c9bfaca963334613b53d0f38fa521ff5e27d76ada075e3f1b6a&amp;scene=21&amp;cur_album_id=2545418429466607617#wechat_redirect" data-linktype="2">Harvard Chan Bioinformatics Core学习资源介绍</a> 推文中，我们详细介绍了如何逐步进行PCA来寻找主要影响因素</p><p data-tool="mdnice编辑器">我觉得这里面的例子非常好</p><figure data-tool="mdnice编辑器"><img data-ratio="0.7382753403933434" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZy1ibVJiaZk9lTMqBDUwUUTc63A9xlvmWXfPcXHh8YH7S6jZ4WUqLr4KQ/640?wx_fmt=png" data-type="png" data-w="661" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZy1ibVJiaZk9lTMqBDUwUUTc63A9xlvmWXfPcXHh8YH7S6jZ4WUqLr4KQ/640?wx_fmt=png"></figure><ul data-tool="mdnice编辑器"><li><section>先进行初步PCA看看不同treatment分组有没有根据PC1 和 PC2分开</section></li><li><section>如果没有分开，那就说明可能存在其它影响因素，如不同的sex和感染不同菌株strain</section></li><li><section>这时就可以对可能的影响因素进行分组，看看能否解释PC1 和 PC2（在例子中，strain解释了PC1，sex解释了PC2，当然这是非常理想的情况，需要有比较完善的metadata）</section></li><li><section>接下来就需要考虑，我们真正关心的treatment属于第几个主成分呢，就可以往后取，拿PC3和PC4来作图（在例子中，不同treatment分组在PC3上分离）</section></li></ul><p data-tool="mdnice编辑器">这基本上是一个很好的探索流程</p><p data-tool="mdnice编辑器">从PC1 PC2到 PC3 PC4，可解释方差会越来越小</p><blockquote data-tool="mdnice编辑器"><p>综上，即使你的样本没有通过PC1或PC2分离，或者你不能确定变异的来源，你仍然可以从差异分析分析中获得生物学相关的结果，所以如果你没有获得大量的DE基因，不要感到惊讶。为了使检测差异表达基因的工具更有效，如果你能识别出主要的、已知的变异源，最好说明它们（如上述案例中的sex和strain）；这包括批处理效应。</p></blockquote><p data-tool="mdnice编辑器">当然</p><p data-tool="mdnice编辑器">我觉得如果你的初步PCA效果不理想，像上面那个流程一步步找其它影响因素，寻找可解释treatment的主成分，存在两个问题：</p><p data-tool="mdnice编辑器">①你不一定有那么完善的metadata</p><p data-tool="mdnice编辑器">②假如初步PCA分出来10个主成分，你往后找，找个PC8 PC9来解释treatment，也没有多大意义，这些PC可解释方差很小</p><p data-tool="mdnice编辑器">说了这么多终于引到 <strong>如何判断PCA哪些主成分是有意义</strong> 这个topic上了，后面主要围绕这个问题展开讨论</p><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">另外，暑期我看到过的一个解决因为批次效应PCA效果不好的处理方法也贴在这里，希望能起到抛砖引玉的作用，后面有时间我也想细看一下</p><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzUzMjA4Njc1MA==&amp;mid=2247508477&amp;idx=1&amp;sn=7a73e3b120aab3085d04421a925aa1c7&amp;scene=21#wechat_redirect" data-linktype="2">iMeta | 青岛大学朱素杰组开发了基于集成学习的新冠患者疾病严重程度打分</a></p><blockquote data-tool="mdnice编辑器"><p>使用集成学习方法建立鲁棒模型是一种很好的方法，因为在许多预测任务中，集成学习方法与单一机器学习方法相比表现出较高的准确性。集成模型的准确性和鲁棒性经常受到特征筛选过程和基模型多样性的影响。为了建立有效的集成学习模型来预测COVID-19患者的严重程度，我们使用了自适应最佳子集选择算法和遗传算法辅助的集成学习评分（AGAE评分）来进行预测。消融实验证实，使用基因配对方法可消除不同患者队列和转录组数据间的批次效应，ABESS算法和遗传算法能提高模型的准确性。AGAE评分已被部署为网页工具(https://kwkxbioinfor.shinyapps.io/COVID19/)。</p></blockquote><p data-tool="mdnice编辑器">当然这篇文章里PCA效果不好指的是“当尝试直接使用基因表达量在5个测试队列中进行PCA时，我们发现选择用于构建AGAE分数的基因的表达量在这些队列中是不重合的（图3A）”</p><p data-tool="mdnice编辑器">因为批次效应的存在而导致的分组不重合（希望是重合的）</p><p data-tool="mdnice编辑器">作者使用了基因配对方法来消除批次效应，但不像ComBat那样影响原始表达量</p><p data-tool="mdnice编辑器">我们常用log2(cpm+1)的归一化计数，经过去除批次效应后，进行主成分分析（PCA）和层次聚类来评估样本之间的相似性</p><p data-tool="mdnice编辑器">在bulk RNAseq中去不去除似乎没有特别重视，但是scRNAseq中因为已经到了单个细胞的水平，有的时候一个去除可能差异全都抹平了，可以参考 <a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247515454&amp;idx=1&amp;sn=9baf3f82940d8cb2685bc140122fb686&amp;chksm=ea1cbbbcdd6b32aad5953a0d0e80766f0ec50e232c2df6208b8f2c340ff0f04a9a2c54a20726&amp;scene=21&amp;cur_album_id=3019915773533913092#wechat_redirect" data-linktype="2">harmony、不harmony，这是个问题</a></p><p data-tool="mdnice编辑器">当然这又是另外一个topic了，本期不谈</p><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">回到正题，如何判断PCA哪些主成分是有意义的呢？</p><p data-tool="mdnice编辑器"><strong>在GWAS中，群体结构（population structure），或者说群体分层（population stratification），指由于个体之间非随机交配而导致的群体中亚群之间等位基因频率的系统差异，是混杂因素的主要来源，可以造成非常大的假阳性，需要作为协变量纳入分析过程</strong></p><blockquote data-tool="mdnice编辑器"><p>这和我们上面那个RNAseq的例子是类似的，sex和strain就是混杂因素，需要作为协变量纳入分析过程</p></blockquote><p data-tool="mdnice编辑器">而PCA的主成分被纳入到GWAS的分析（post-GWAS，如PRS）中作为协变量，以求尽量降低群体结构的影响</p><p data-tool="mdnice编辑器">这就直接要求我们<strong>判断PCA哪些主成分是有意义的，如何选择合适数量的PCs</strong></p><blockquote data-tool="mdnice编辑器"><p>PCA 个数的选择对结果影响很大。如果选择的个数太少，无法有效校正群体结构，假阳性仍然会很大。但如果选择的个数太多，会影响 GWAS 的 power</p><p>参考：PCA方法校正群体结构，GWAS该用多少个主成分？</p></blockquote><h2 data-tool="mdnice编辑器"><span></span>基于PCA散点图</h2><p data-tool="mdnice编辑器">最基础的就是你一个个PC往下画图，看看这个PC有没有把treatment分组分开</p><p data-tool="mdnice编辑器">但这个过程比较主观</p><p data-tool="mdnice编辑器">在这篇 <a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247513115&amp;idx=1&amp;sn=dbcbb4ff2963b496d7420c6d9acbbf7e&amp;chksm=fa457126cd32f830efa9497bbe194215833e5e117fc88fb294ec2887c531f64cd69cf1488b2e&amp;scene=21&amp;cur_album_id=2545418429466607617#wechat_redirect" data-linktype="2">明明PCA区分非常好，但是差异基因数量很少？</a> 推文中我也提到过这个问题</p><blockquote data-tool="mdnice编辑器"><p>①作者为什么认为三种RNA类型都可以很好区分实验分组，有没有统计量可以评估PCA的效果？，②为什么认为“lncRNA表达谱的性能最佳”，mRNA、lncRNA、miRNA进行PCA时，PC1和PC2可解释的方差并不相同，也可以进行比较吗？</p></blockquote><p data-tool="mdnice编辑器">我贴出了一个ANOSIM相似性分析方法</p><blockquote data-tool="mdnice编辑器"><p>ANOSIM分析（Analysis of Similarities）即相似性分析，主要用于分析高维数据组间相似性，为数据间差异显著性评价提供依据。在一些高维数据分析中，需要使用PCA、PCoA、NMDS等方法进行降维，但这些方法并不显示组间差异的显著性指标，因此可以使用ANOSIM分析解决此问题。</p><p>ANOSIM相似性分析是一种非参数检验（permutation），用来检验组间（两组或多组）差异是否显著大于组内差异，从而判断分组是否有意义。首先利用Bray-Curtis算法计算两两样品间的距离，然后将所有距离从小到大进行排序，并计算R和P值。R值用于不同组间属否存在差异，P值用于说明是否存在显著差异。</p></blockquote><p data-tool="mdnice编辑器">本期也相当于是再次回答了这个问题</p><p data-tool="mdnice编辑器">主观上不好搞，还是要借助统计学方法</p><p data-tool="mdnice编辑器">后面“基于可解释方差”和“基于主成分显著性检验”两部分中的后者，我想就可以解决我上面的这两个问题</p><h2 data-tool="mdnice编辑器"><span></span>基于可解释方差</h2><p data-tool="mdnice编辑器">在一些过去的推文中碎石图 或者 肘部图是比较常见的方法</p><blockquote data-tool="mdnice编辑器"><p>PCA方法校正群体结构，GWAS该用多少个主成分？(https://zhuanlan.zhihu.com/p/296656871)</p><p>PCA 解释方差骤降图（ElbowPlot）拐点的量化识别(https://www.jianshu.com/p/feac6263faee)</p></blockquote><figure data-tool="mdnice编辑器"><img data-ratio="0.7745358090185677" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZPzyfgT48WlTnuNibnPdF09Fle1fSiaSRFyZs4dkj1Jq6Q94ZzOz4NgfA/640?wx_fmt=png" data-type="png" data-w="754" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZPzyfgT48WlTnuNibnPdF09Fle1fSiaSRFyZs4dkj1Jq6Q94ZzOz4NgfA/640?wx_fmt=png"></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.4764044943820225" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZvRgibsebceoGkOBD3g5KTdzWTQr640RzMSdSObWYpTW7Wiaicl8D2VNicQ/640?wx_fmt=png" data-type="png" data-w="890" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZvRgibsebceoGkOBD3g5KTdzWTQr640RzMSdSObWYpTW7Wiaicl8D2VNicQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">直接选累计解释 80-90% 的前 k 个主成分</p><p data-tool="mdnice编辑器">其实，在单细胞中我们也见过 如何判断PCA哪些主成分是有意义的</p><p data-tool="mdnice编辑器">如 <a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247514316&amp;idx=1&amp;sn=139a39771f22b6e7a484523313909f4c&amp;chksm=ea1cbe4edd6b3758f6c9564ca49ff66db7ea727ddf9d2391fa4a88132ac8f582a336ffcfd157&amp;scene=21&amp;cur_album_id=3019915773533913092#wechat_redirect" data-linktype="2">初探单细胞下游</a></p><p data-tool="mdnice编辑器">回顾单细胞下游基本流程：质控 - 标准化 - 识别高变基因 - 归一化 - 降维 - 可视化 - marker鉴定亚型</p><p data-tool="mdnice编辑器">关注一下“识别高变基因 - 归一化 - 降维 - 可视化”，单细胞中我们使用高变基因来做PCA，但在bulk中我们是不推荐拿DEGs来做的，PCA的结果会被用来进行后续的分析，如FindNeighbors</p><blockquote data-tool="mdnice编辑器"><p>FindNeighbors函数通过计算数据集中每个细胞之间的相似性，找到每个细胞的k个最近邻，并可选地计算共享最近邻图。这些最近邻关系可以用来构建细胞之间的连接，用于后续的聚类分析、可视化和其他细胞间关系的研究</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code>pbmc &lt;- RunPCA(pbmc, features = VariableFeatures(object = pbmc)) <span>##默认会输出5个主成分</span><br>pbmc &lt;- FindNeighbors(pbmc, dims = 1:10)  <span># 使用维度非输出维度</span><br><br></code></pre><p data-tool="mdnice编辑器">所以细致的话，需要判断拿多少个 PC 进行下游分析</p><p data-tool="mdnice编辑器">PCA 解释方差骤降图（ElbowPlot）拐点的量化识别(https://www.jianshu.com/p/feac6263faee) 这篇文章也介绍了一些方法：</p><blockquote data-tool="mdnice编辑器"><p>Seurat 官方提供了一个通过PCA随机检验的方式选择有效主成分的方法JackStraw，它也可以帮助确定要考虑多少 PC 进行下游分析。不过该方法因为它依赖于数据的排列检验，它的计算过程非常缓慢。它所做的是估计每个主成分的统计显着性(是否显著有效)，但同样，“显著” PC 并不意味着它具有信息量。当细胞数量增加时，越来越多的 PC 在统计上变得“显着”，即使它们解释的变异并不大</p><p>相比起Seurat 随机检验识别拐点方法，另一种高效的方式可以从PCA的定义和肘部图的特点出发来设计识别拐点：</p><ul><li><section>通过筛选贡献 小于5% 方差和累计贡献 90% 方差的PC截断点作为曲线拐点；</section></li><li><section>连续 PC 之间的差异方差贡献百分比变化小于 0.1% 的点作为曲线拐点</section></li></ul></blockquote><p data-tool="mdnice编辑器">其实类似碎石图 肘部图这样的图，在我们确定参数时经常看得到</p><p data-tool="mdnice编辑器">比如在WGCNA中对最佳power值的选取也是类似这么个图</p><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247523474&amp;idx=1&amp;sn=d879233dc7182ab9a9635e58ca68e8cf&amp;scene=21#wechat_redirect" data-linktype="2">WGCNA仅仅是划分基因模块，其它都是附加分析</a></p><figure data-tool="mdnice编辑器"><img data-ratio="1.4361158432708687" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZaib9CRpG5GYBTvInBJcIecGicyV2tm4Jv3wrIg8DyxwMlys4vGlp99SQ/640?wx_fmt=png" data-type="png" data-w="587" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZaib9CRpG5GYBTvInBJcIecGicyV2tm4Jv3wrIg8DyxwMlys4vGlp99SQ/640?wx_fmt=png"></figure><h2 data-tool="mdnice编辑器"><span></span>基于主成分显著性检验</h2><h3 data-tool="mdnice编辑器"><span></span>ANOVA<span></span></h3><blockquote data-tool="mdnice编辑器"><p>觉得画图不够客观，或者太过麻烦，如果知道群体的个数的话也可以对主成分进行 ANOVA 分析，<strong>检验主成分在不同人群中是否显著</strong></p></blockquote><p data-tool="mdnice编辑器">我这里用的是之前的这篇推文的数据  <a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247512469&amp;idx=1&amp;sn=364469f90477204a6319cd57211e8264&amp;chksm=fa4574a8cd32fdbe68badc2b6c922a164ce3be815877c5e4fed59628c72fd590f0a140752831&amp;scene=21&amp;cur_album_id=2545418429466607617#wechat_redirect" data-linktype="2">使用TPM/FPKM/RPKM进行差异分析真的可以消除系统误差吗？</a></p><p data-tool="mdnice编辑器">因为这篇推文里我拿到各个样本在PC1 CP2上的坐标划分了新的得分分组，就直接改一下代码拿来看看</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; dat_pca<span>$ind</span><span>$coord</span><br>           Dim.1       Dim.2         Dim.3       Dim.4      Dim.5<br>N1    -42.697221   48.471466   -0.01802349  -51.996373 -78.906714<br>N2    -55.049781   25.822642  -11.71097345   -5.258264 -37.157315<br>N3    -27.145816  -43.599142    3.14504011   -4.610429 -36.605097<br>N4    -24.872502 -115.792678  -29.68094545   27.082929 -26.057198<br>N5      7.429535  -92.824602  -53.05090174   37.702733  -1.257852<br>N6     -7.526837  -87.070793  -13.08492177    4.288801 -25.069545<br>N7    -42.938110  -93.624790    9.39586410   11.840125 -29.762697<br>N8   -157.180039   -9.622364  -58.19122538  -23.936501 -38.142273<br>N9    177.824000  -85.220595  -43.40426793  -42.000875 -12.490097<br>N10    35.899562   88.914218 -225.77882025  -78.717206 102.339891<br>N11   107.498198  -42.934338   -8.30785140   22.826873  29.391063<br>N12   153.851223  108.084702   16.91995819   82.260888 -52.293131<br>N13    36.909382  -21.925832    0.72005811   14.509805 -38.871533<br>C1     51.156995   71.620587   40.40040716    6.346468  -6.974374<br>C2     29.786544  -24.459016   52.79422607  -24.215639  36.346680<br>C3   -106.299122  -19.655137   36.62580614  109.087082 133.023740<br>C4    -75.654262   42.668270  -20.87482078  -33.477635 -24.097647<br>C5     22.590662  -64.625159  -16.85585649  -10.950335  -9.132749<br>C6    -26.266407   33.949259   94.15362809 -107.893144  18.046073<br>C7    -23.672120  156.955641  -50.03799767  135.162893 -36.954364<br>N8.1   15.942145  -27.812306    9.82777515   23.047832 -12.357030<br>C9    -91.342273   50.515530    2.89712530  -20.000462 -11.026132<br>C10   -31.269435  -10.596238   31.03241012   10.554894  45.530344<br>C11    23.633895   75.940864   83.72085402  -63.289104   8.483452<br>C12    13.699250  -26.145634   70.30003935   20.632039  70.161552<br>C13    35.692536   62.965448   79.06341390  -38.997393  33.832952<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>&gt; group_list<br> [1] Non-IBD Non-IBD Non-IBD Non-IBD Non-IBD Non-IBD Non-IBD Non-IBD Non-IBD Non-IBD<br>[11] Non-IBD Non-IBD Non-IBD CD      CD      CD      CD      CD      CD      CD   <br>[21] CD      CD      CD      CD      CD      CD   <br></code></pre><p data-tool="mdnice编辑器">虽然这部分标题是ANOVA但并不真的能用ANOVA</p><p data-tool="mdnice编辑器">对于一个treatment来说，单因素方差分析（one-way ANOVA），检验方差相等的多个正态总体 均值是否相等，进而判断对试验指标（这里是表达谱）的影响是否显著</p><p data-tool="mdnice编辑器">但这个实验是二分组的，所以应该做双样本均值分析而不是多样本，也就是最简单的t-test</p><p data-tool="mdnice编辑器">在做之前我们也应该看看独立t-test前提条件</p><ul data-tool="mdnice编辑器"><li><section>正态分布</section></li><li><section>方差齐性</section></li><li><section>形成对照的两组样本之间没有关系（在很多试验中需要比较的两组样本往往有关系的，比如一组病人服药前后的变化，每个人以自己为对照。所谓非独立双样本，就是在第一组样本中的每个数据点都和第二组样本中唯一的数据点对应）</section></li></ul><p data-tool="mdnice编辑器">我们这里每组就13个样本，方差看都不用看肯定是不齐的</p><p data-tool="mdnice编辑器">这个实验设计对照是IBD患者、非IBD患者，所以初步满足独立性</p><p data-tool="mdnice编辑器">所以我们这里做独立双样本Wilcoxon 秩和检验进行非参数检验</p><p data-tool="mdnice编辑器">相关知识点可以参考 语雀平台 生物统计从理论到实践 https://www.yuque.com/biotrainee/biostat/chapter1-5</p><blockquote data-tool="mdnice编辑器"><p>非参数方法在数据分布不明确的时候往往有更好的效果</p><p>如 <a href="https://mp.weixin.qq.com/s?__biz=MzA5OTM1ODg5NA==&amp;mid=2649679823&amp;idx=1&amp;sn=491fffd5ba95b265bf6f51c1ffce8891&amp;scene=21#wechat_redirect" data-linktype="2">熊读文献｜别再用DEseq2和edgeR进行大样本差异表达基因分析了</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247514171&amp;idx=1&amp;sn=93900aad88b9f3270fffeb58379ccbc5&amp;chksm=fa457d06cd32f410ad7688e415fa1fb415150760b0f0033d07062a3032eaabebe9cb1726fdc5&amp;scene=21&amp;cur_album_id=2545418429466607617#wechat_redirect" data-linktype="2">使用Clipper控制FDR应对高通量数据分析p值失真问题</a></p></blockquote><pre data-tool="mdnice编辑器"><span></span><code>&gt; <span>for</span> (i <span>in</span> seq(1,5)){<span>print</span>(wilcox.test(tmp1[,i][group_list==<span>"Non-IBD"</span>],tmp1[,i][group_list==<span>"CD"</span>],exact = F))}<br><br> Wilcoxon rank sum <span>test</span> with continuity correction<br><br>data:  tmp1[, i][group_list == <span>"Non-IBD"</span>] and tmp1[, i][group_list == <span>"CD"</span>]<br>W = 93, p-value = 0.6816<br>alternative hypothesis: <span>true</span> location <span>shift</span> is not equal to 0<br><br><br> Wilcoxon rank sum <span>test</span> with continuity correction<br><br>data:  tmp1[, i][group_list == <span>"Non-IBD"</span>] and tmp1[, i][group_list == <span>"CD"</span>]<br>W = 50, p-value = 0.08123<br>alternative hypothesis: <span>true</span> location <span>shift</span> is not equal to 0<br><br><br> Wilcoxon rank sum <span>test</span> with continuity correction<br><br>data:  tmp1[, i][group_list == <span>"Non-IBD"</span>] and tmp1[, i][group_list == <span>"CD"</span>]<br>W = 30, p-value = 0.005619<br>alternative hypothesis: <span>true</span> location <span>shift</span> is not equal to 0<br><br><br> Wilcoxon rank sum <span>test</span> with continuity correction<br><br>data:  tmp1[, i][group_list == <span>"Non-IBD"</span>] and tmp1[, i][group_list == <span>"CD"</span>]<br>W = 92, p-value = 0.7196<br>alternative hypothesis: <span>true</span> location <span>shift</span> is not equal to 0<br><br><br> Wilcoxon rank sum <span>test</span> with continuity correction<br><br>data:  tmp1[, i][group_list == <span>"Non-IBD"</span>] and tmp1[, i][group_list == <span>"CD"</span>]<br>W = 32, p-value = 0.007661<br>alternative hypothesis: <span>true</span> location <span>shift</span> is not equal to 0<br></code></pre><h3 data-tool="mdnice编辑器"><span></span>twstats<span></span></h3><blockquote data-tool="mdnice编辑器"><p>如果不能很好定义人群，ANOVA 的方法也不太好用</p><p>基于 Tracy–Widom statistics，对各个主成分进行显著性检验。在模拟结果中，Tracy–Widom statistics 的显著性检验结果与 ANOVA 比较吻合，可靠性不错。</p><figure><img data-ratio="0.48020434227330777" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZySdiazpIS7Re69qfxm3YOPaWFcVnHcFfTtEOOQBfSKa42JUSulywiaqw/640?wx_fmt=png" data-type="png" data-w="783" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZySdiazpIS7Re69qfxm3YOPaWFcVnHcFfTtEOOQBfSKa42JUSulywiaqw/640?wx_fmt=png"></figure><p>参考：PCA方法校正群体结构，GWAS该用多少个主成分？(https://zhuanlan.zhihu.com/p/296656871)</p></blockquote><blockquote data-tool="mdnice编辑器"><p>http://aps.ecnu.edu.cn/CN/Y2016/V32/I6/551</p><p>Tracy和Widom 1990年代在研究高维随机矩阵特征根时发现一种新型分布, 文献中普遍称为Tracy-Widom分布, <strong>它用于描述极值特征根的渐近性质. 随后二十多年的研究表明, Tracy-Widom分布如同经典的正态分布那样具有普适性, 适用于各种极值型随机现象</strong></p></blockquote><p data-tool="mdnice编辑器">Tracy-Widom检验是随机矩阵理论中使用的一种统计检验方法，<strong>用于确定协方差矩阵或相关矩阵中特征值的显著性。它有助于了解主成分分析（PCA）中观察到的特征值是否与仅由偶然发生相比具有显著差异。</strong></p><p data-tool="mdnice编辑器">主成分分析（PCA）是一种用于降低数据集维度的技术，同时尽量保留尽可能多的相关信息。它涉及计算数据的协方差矩阵或相关矩阵的特征值和特征向量。</p><p data-tool="mdnice编辑器">以下是使用Tracy-Widom检验来评估PCA特征值显著性的一般方法：</p><ol data-tool="mdnice编辑器"><li><section><p><strong>计算特征值：</strong>对数据集进行PCA，并获取协方差矩阵或相关矩阵的特征值。这些特征值代表每个主成分解释的方差。</p></section></li><li><section><p><strong>排序特征值：</strong>将特征值按降序排列，因为它们代表每个主成分解释的方差大小。</p></section></li><li><section><p><strong>评估显著性：</strong>将观察到的特征值与基于随机矩阵理论的期望特征值分布进行比较。通常使用Tracy-Widom分布进行这种比较。</p></section></li><li><section><p><strong>应用Tracy-Widom检验：</strong>使用Tracy-Widom检验确定观察到的特征值是否具有统计显著性。Tracy-Widom分布提供不同置信水平的临界值，可帮助评估每个特征值的显著性。</p><p>Tracy-Widom分布的参数可能取决于数据的维度和所处理的随机矩阵集合的类型（例如，高斯分布，Wishart分布等）。</p></section></li><li><section><p><strong>解释结果：</strong>根据Tracy-Widom分布提供的临界值，您可以评估哪些特征值在统计上是显著的，并对数据结构做出重要贡献。超过临界值的特征值可以被视为显著的。</p></section></li></ol><p data-tool="mdnice编辑器">参考知乎文中给出了在linux命令行下的使用方法</p><figure data-tool="mdnice编辑器"><img data-ratio="1.4205776173285198" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZfx2ZybXq1eOUN0P9xTianSMtAO53boQIDtvzt0goojvjTFCwcgNmejw/640?wx_fmt=png" data-type="png" data-w="554" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZfx2ZybXq1eOUN0P9xTianSMtAO53boQIDtvzt0goojvjTFCwcgNmejw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">我这里也放一个R包来完成twstats检验</p><p data-tool="mdnice编辑器">LEA: an R package for Landscape and Ecological Association Studies</p><p data-tool="mdnice编辑器">https://www.bioconductor.org/packages/release/bioc/html/LEA.html</p><p data-tool="mdnice编辑器">打开进行PCA的原始文件genotypes.lfmm，可以看到，行是样本，列是基因型</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5176600441501104" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZmOHHnyFtPz2AdLb2Yib6icyJ5uvP5L4FDQpCfUGXCKoibufyny1okeg6w/640?wx_fmt=png" data-type="png" data-w="906" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZmOHHnyFtPz2AdLb2Yib6icyJ5uvP5L4FDQpCfUGXCKoibufyny1okeg6w/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">运行示例代码</p><pre data-tool="mdnice编辑器"><span></span><code>library(LEA)<br><span># Creation of the genotype file "genotypes.lfmm"</span><br><span># with 1000 SNPs for 165 individuals.</span><br>data(<span>"tutorial"</span>)<br>write.lfmm(tutorial.R,<span>"genotypes.lfmm"</span>)<br><br><span>#################</span><br><span># Perform a PCA #</span><br><span>#################</span><br><br><span># run of PCA</span><br><span># Available     options, K (the number of PCs calculated), </span><br><span>#               center and scale. </span><br><span># Creation of   genotypes.pcaProject - the pcaProject object.</span><br><span>#               a directory genotypes.pca containing:</span><br><span># Create files: genotypes.eigenvalues - eigenvalues,  </span><br><span>#               genotypes.eigenvectors - eigenvectors,</span><br><span>#               genotypes.sdev - standard deviations,</span><br><span>#               genotypes.projections - projections,</span><br><span># Create a pcaProject object: pc.</span><br>pc = pca(<span>"genotypes.lfmm"</span>, scale = TRUE)<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>[1] <span>"******************************"</span><br>[1] <span>" Principal Component Analysis "</span><br>[1] <span>"******************************"</span><br>summary of the options:<br><br>        -n (number of individuals)          50<br>        -L (number of loci)                 400<br>        -K (number of principal components) 50<br>        -x (genotype file)                  D:\workspace\biotrainee\PCA_PCs\GSE159751\genotypes.lfmm<br>        -a (eigenvalue file)                D:\workspace\biotrainee\PCA_PCs\GSE159751\genotypes.pca/genotypes.eigenvalues<br>        -e (eigenvector file)               D:\workspace\biotrainee\PCA_PCs\GSE159751\genotypes.pca/genotypes.eigenvectors<br>        -d (standard deviation file)        D:\workspace\biotrainee\PCA_PCs\GSE159751\genotypes.pca/genotypes.sdev<br>        -p (projection file)                D:\workspace\biotrainee\PCA_PCs\GSE159751\genotypes.pca/genotypes.projections<br>        -s data centered and scaled <br></code></pre><pre data-tool="mdnice编辑器"><span></span><code><span>#############################</span><br><span># Perform Tracy-Widom tests #</span><br><span>#############################</span><br><br><span># Perfom Tracy-Widom tests on all eigenvalues.</span><br><span># Create file:  genotypes.tracyWidom - tracy-widom test information, </span><br><span>#               in the directory genotypes.pca/.</span><br>tw = tracy.widom(pc)<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>[1] <span>"*******************"</span><br>[1] <span>" Tracy-Widom tests "</span><br>[1] <span>"*******************"</span><br>summary of the options:<br><br>        -n (number of eigenvalues)          50<br>        -i (input file)                     D:/workspace/biotrainee/PCA_PCs/GSE159751/genotypes.pca/genotypes.eigenvalues<br>        -o (output file)                    D:/workspace/biotrainee/PCA_PCs/GSE159751/genotypes.pca/genotypes.tracywidom<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code><span># Plot the percentage of variance explained by each component.</span><br>plot(tw<span>$percentage</span>)<br><br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5016538037486218" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZfc9iaeyyl9J73CqQTYCS6dSRXu7OfMvkyJicmwj2qfOMcP2TpicviaDmCA/640?wx_fmt=png" data-type="png" data-w="907" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9p5QEtx5r3iaEYFMFyYL1qZfc9iaeyyl9J73CqQTYCS6dSRXu7OfMvkyJicmwj2qfOMcP2TpicviaDmCA/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code><span># Display the p-values for the Tracy-Widom tests. </span><br>tw<span>$pvalues</span><br></code></pre><pre data-tool="mdnice编辑器"><span></span><code> [1] 8.000e-09 8.000e-09 8.000e-09 1.503e-04 3.152e-02 4.215e-01 6.565e-01 6.859e-01<br> [9] 6.738e-01 9.363e-01 7.937e-01 9.827e-01 9.709e-01 9.425e-01 9.240e-01 8.119e-01<br>[17] 9.734e-01 9.870e-01 9.996e-01 9.972e-01 9.973e-01 9.904e-01 9.959e-01 9.835e-01<br>[25] 9.953e-01 9.777e-01 9.801e-01 9.354e-01 8.465e-01 9.499e-01 8.092e-01 8.500e-01<br>[33] 7.492e-01 9.638e-01 9.114e-01 8.908e-01 9.402e-01 9.173e-01 7.407e-01 8.460e-01<br>[41] 8.067e-01 7.215e-01 4.396e-01 2.428e-01 6.246e-01 2.789e-01 6.168e-01 3.909e-01<br>[49] 7.257e-01<br></code></pre><p data-tool="mdnice编辑器">但是我还没看到twstats检验应用到转录组数据的文章，特别是单细胞</p><hr data-tool="mdnice编辑器"><h2 data-tool="mdnice编辑器"><span></span>小结</h2><p data-tool="mdnice编辑器">需要注意的是</p><p data-tool="mdnice编辑器">bulk RANseq的数据PCA主要是为了找协变量和找到treatment对应的主成分（及其可解释方差）,而GWAS和scRNAseq拿到的为前k个统计学上显著或者可解释方差80~90%的所有主成分进行后续的分析，他们的目的和最终所需要的形式都是存在区别的，这篇文章只是概括性地放在一起谈谈。</p></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/jjHwHZC6nXyRAT0Se-nzVQ",target="_blank" rel="noopener noreferrer">原文链接</a>
