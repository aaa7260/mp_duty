---
title: "AddModuleScore 对单细胞基因集打分及可视化"
date: 2023-10-06T05:32:11Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
AddModuleScore 对单细胞基因集打分及可视化 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span>❝</span><p>上周推文总结了一下使用自定义基因集对单细胞数据进行打分的函数和R包，所以这周使用真实的单细胞数据来做一下可视化展示。</p><span>❞</span></blockquote><h4 data-tool="mdnice编辑器"><span></span>导入数据<span></span></h4><blockquote data-tool="mdnice编辑器"><span>❝</span><p>这里使用的数据是2022年10月20日推文，细胞注释好的数据,原文链接附上。</p><span>❞</span></blockquote><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247506984&amp;idx=1&amp;sn=bd7ac63a4c5ed523e865bc16ca1e0c88&amp;scene=21#wechat_redirect" data-linktype="2">文献数据复现——原发性和转移性肝细胞癌多细胞生态系统的单细胞图谱</a></p><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(dplyr)<br><span>library</span>(clusterProfiler)<br><span>library</span>(org.Hs.eg.db)<br><span>library</span>(stringr)<br><span>library</span>(msigdbr)<br><br>getwd()<br><span>#setwd("./3-cell")  </span><br>load(<span>"sce.all_by_celltype.Rdata"</span>)<br><br><span>#取文章中列出的marker gene</span><br>paper&lt;-<span>"ALB,SERPINA1,HNF4A,EPCAM,CD3D,CD3E,NKG7,CD68,CD14,CD163,<br>CD1C,CLEC4C,KIT, IGHG1,JCHAIN,CD79A,VWF,PECAM1,<br>FCGR2B,ACTA2,COL1A1,COL1A2"</span><br>papermarker&lt;-str_to_upper(trimws(strsplit(paper,<span>','</span>)[[<span>1</span>]]))<br>papermarker<br><br><span># 将基因转为list </span><br>features &lt;- list(papermarker)<br><span>#直接使用文件中基因向量，并转为list形式</span><br>homo_KEGG = msigdbr(species = <span>"Homo sapiens"</span>,<br>                     category = <span>"C2"</span>,<br>                     subcategory = <span>"KEGG"</span>) %&gt;% dplyr::select(gs_name,gene_symbol)<span>#这里可以选择gene symbol，也可以选择ID</span><br><span>#基因集是list</span><br>homo_KEGG_gene = homo_KEGG %&gt;% split(x =.$gene_symbol, f =.$gs_name)<br><br><span>#选择其中一条通路（我这里选择的是氨基酸和核苷酸糖代谢），将其也转为list</span><br>features &lt;- list(homo_KEGG_gene$KEGG_AMINO_SUGAR_AND_NUCLEOTIDE_SUGAR_METABOLISM)<br><br><span>#使用Seurat包自带的AddModuleScore函数打分</span><br>sce_score&lt;- AddModuleScore(sce.all,<br>                       features = features,<br>                       ctrl = <span>100</span>,<br>                       name = <span>"features"</span>)<br>head(sce_score@meta.data)<br><span>#这里就得到了基因集评分结果，但是注意列名为 features1</span><br>colnames(sce_score@meta.data)[<span>22</span>] &lt;- <span>'Score'</span><br><br>sce_score@meta.data[<span>1</span>:<span>2</span>,<span>1</span>:<span>22</span>]<br><span>#                     orig.ident nCount_RNA nFeature_RNA group percent_mito percent_ribo</span><br><span>#HCC01T_AAACCTGAGGGCATGT   HCC01T       5412         1768     T     3.782703     32.07799</span><br><span>#HCC01T_AAACCTGAGTCGCCGT   HCC01T      12726         2813     T     5.395268     31.67196</span><br><span>#                        percent_hb  S.Score G2M.Score Phase old.ident RNA_snn_res.0.01</span><br><span>#HCC01T_AAACCTGAGGGCATGT 0.00000000 -0.0406769 -0.04946085   G1   HCC01T                0</span><br><span>#HCC01T_AAACCTGAGTCGCCGT 0.02163878 -0.0578437 -0.09095275    G1  HCC01T               2</span><br><span>#                        seurat_clusters RNA_snn_res.0.05 RNA_snn_res.0.1 RNA_snn_res.0.2</span><br><span>#HCC01T_AAACCTGAGGGCATGT               0                0               0               0</span><br><span>#HCC01T_AAACCTGAGTCGCCGT               3                1               1               3</span><br> <span>#                       RNA_snn_res.0.3 RNA_snn_res.0.5 RNA_snn_res.0.8 RNA_snn_res.1</span><br><span>#HCC01T_AAACCTGAGGGCATGT               0               0               0             0</span><br><span>#HCC01T_AAACCTGAGTCGCCGT               3               3               3             3</span><br><span>#                        celltype       Score</span><br><span>#HCC01T_AAACCTGAGGGCATGT     T/NK -0.13832027</span><br><span>#HCC01T_AAACCTGAGTCGCCGT  myeloid -0.06321127</span><br></code></pre><h4 data-tool="mdnice编辑器"><span></span>可视化，小提琴图<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggpubr)<br>ggviolin(sce_score@meta.data, <br>         x=<span>"celltype"</span>, y=<span>"Score"</span>, <br>         width = <span>0.8</span>,color = <span>"black"</span>,<span>#轮廓颜色</span><br>         fill=<span>"celltype"</span>,<span>#填充 </span><br>         xlab = <span>F</span>, <span>#不显示x轴的标签 </span><br>         add = <span>'mean_sd'</span>, <br>         bxp.errorbar=<span>T</span>,<span>#显示误差条         </span><br>         bxp.errorbar.width=<span>0.05</span>, <span>#误差条大小          </span><br>         size=<span>0.5</span>, <span>#箱型图边线的粗细</span><br>         palette = <span>"npg"</span>, <br>         legend = <span>"right"</span>)<br>ggsave(filename=<span>"violin.pdf"</span>,width = <span>8</span>,height = <span>5</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6266009852216748" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9mMUUuyIrvcW6JA7qtYVJu4kaDQcibEjfC5b06n8LQic7NaCv3yISGuKn97mFpShwn8bnMUvHaNlOw/640?wx_fmt=png" data-type="png" data-w="1015" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9mMUUuyIrvcW6JA7qtYVJu4kaDQcibEjfC5b06n8LQic7NaCv3yISGuKn97mFpShwn8bnMUvHaNlOw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">在此选择的pathway通路及基因集（基于文章给出的部分基因）是我自己选用，并没有特别的生物学意义，只是做一下可视化展示。</p><h3 data-tool="mdnice编辑器"><span></span><span>微信交流群</span><span></span></h3><p data-tool="mdnice编辑器">如果你也想参与到群里的讨论中，给我提出一些推文更新建议的话欢迎入群。同时你也可以得到我前期更新的所有数据及代码，在群里我会把代码分享给大家，而且大家可以在群里「提出自己感兴趣的单细胞文献」<strong>「我们尽可能优先选择大家的数据集去复现和实战，也欢迎大家在群里分享更多其它资料，咱们一起进步，」</strong>「比较高级的单细胞分析」**我们也会一起尝试， 相信你肯定是会不虚此行哈。</p><p data-tool="mdnice编辑器">附上之前推文的链接 <a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247512238&amp;idx=1&amp;sn=e0c6dc2ea0e089aabb78133e50fb5d7f&amp;scene=21#wechat_redirect" data-linktype="2">为爱发电不可取（单细胞周更需要你的支持）</a></p><p data-tool="mdnice编辑器"><strong>「「目前群里已经有300多人，所以你想要进群的话就需要添加我的微信，私聊给我发99元的红包，我把你拉进群里。」」</strong></p><p data-tool="mdnice编辑器">我们这个群是真正的付费交流群，提供数据，代码，学习资料，也会跟大家互动交流，还会坚持进行创作至少一年。如果介意99元的门槛且不认可我们知识分享的理念，<strong>「请不要加我好友」</strong>。。</p><figure data-tool="mdnice编辑器"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9mMUUuyIrvcW6JA7qtYVJuo5uRuMd3epiabMIt9Q7KCCatTTXMoz4Og2tiaWFDRbDfh6buc52Z2jyw/640?wx_fmt=png" data-type="png" data-w="172" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9mMUUuyIrvcW6JA7qtYVJuo5uRuMd3epiabMIt9Q7KCCatTTXMoz4Og2tiaWFDRbDfh6buc52Z2jyw/640?wx_fmt=png"></figure></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/QXiHfZbLCxA0xj80HatDmQ",target="_blank" rel="noopener noreferrer">原文链接</a>
