---
title: "R可视乎｜主成分分析结果可视化"
date: 2023-10-02T13:43:28Z
draft: ["false"]
tags: [
  "fetched",
  "庄闪闪的R语言手册"
]
categories: ["Acdemic"]
---
R可视乎｜主成分分析结果可视化 by 庄闪闪的R语言手册
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><h2 data-tool="mdnice编辑器"><span></span></h2><p><span>点击下方</span><span>公众号</span><span>，回复</span><span>资料分享</span><span>，收获惊喜</span></p><p><span><br></span></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzI1NjUwMjQxMQ==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHiaOjUwXredJLzMleuKP97WYf7W4ylibNiaRJlP7icneHRGekYcQEPgTLpIDbibTuuEADhn0Sv4Xqhhf4A/0?wx_fmt=png" data-nickname="庄闪闪的R语言手册" data-alias="Zss_R4ds" data-signature="在读统计博士生，R语言爱好者。来跟着我一起学 R 数据科学，可视化。" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>写于2021年，旧文重发。头条为主成分结果可视化，次条为主成分介绍与代码实现。</p></blockquote></section><h2 data-tool="mdnice编辑器"><span>简介</span></h2><p data-tool="mdnice编辑器">主成分分析法是很常用的一种<span>数据降维方法</span><sup>[1]</sup>。该方法可以减少数据的维数，并保持对方差贡献最大的特征，相当于保留低阶主成分，忽略高阶主成分。</p><p data-tool="mdnice编辑器">关于主成分的理论介绍和R语言代码实现可见前段时间赵西西写的推文：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247485340&amp;idx=1&amp;sn=6f1dc4e3447a9e18ef56df92c215b477&amp;chksm=ea24f878dd53716ec9fe64d0fca6d4587d751103982d5a18cb637a6c611a502b893de8b96851&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">主成分分析</a>（见次条）。<span>但是后面留了一个小尾巴，如果想对主成分结果进行可视化，那得怎么实现？</span><span>有没有简便的方法呢？</span></p><p data-tool="mdnice编辑器">正好这几天有读者问起，那今天就来说说这个问题吧。</p><h2 data-tool="mdnice编辑器"><span></span><span>方法一</span></h2><p data-tool="mdnice编辑器">使用<span>ggbiplot包</span><sup>[2]</sup>中的<code>ggbiplot()</code>函数，该函数 使用ggplot2对主成分进行可视化。函数内部参数如下</p><pre data-tool="mdnice编辑器"><span></span><code>  ggbiplot(pcobj, choices = 1:2, scale = 1, pc.biplot =<br>  TRUE, obs.scale = 1 - scale, var.scale = scale, groups =<br>  NULL, ellipse = FALSE, ellipse.prob = 0.68, labels =<br>  NULL, labels.size = 3, alpha = 1, var.axes = TRUE, circle<br>  = FALSE, circle.prob = 0.69, varname.size = 3,<br>  varname.adjust = 1.5, varname.abbrev = FALSE, ...)<br></code></pre><p data-tool="mdnice编辑器">内部参数过多，就不做详细解释。如果对内部参数有兴趣可以通过帮助文档进行查询（?ggbiplot）。</p><p data-tool="mdnice编辑器">这里使用鸢尾花数据，给出一个简单的例子。大家可以将自己的数据进行导入（如何导入？可见推文：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1NjUwMjQxMQ==&amp;mid=2247489655&amp;idx=1&amp;sn=0fb004c7434066ef8777749670a47879&amp;chksm=ea24e793dd536e856e19476a2c2807e271d94503de6f81a455761d8543087cb6d65d781ae6b8&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">R数据科学|第八章内容介绍</a>），替换鸢尾花数据。</p><blockquote data-tool="mdnice编辑器"><p>注意：检查自己数据集的数据结构是否和鸢尾花数据结构一致</p></blockquote><p data-tool="mdnice编辑器">这个包在github中，官方说可以使用以下参数进行下载（但是小编下载不了，只能通过强暴的方法进行，具体可见推文：。该压缩包已经处理成tar.gz放到公众号内了，如有需要，后台回复<strong>[ggbiplot]</strong>即可获得）。</p><p data-tool="mdnice编辑器">使用<code>prcomp()</code>进行主成分分析，然后将结果保存到res.pca变量中。之后使用<code>ggbiplot()</code>进行可视化。其中观测的尺度因子为1（<code>obs.scale = 1</code>），变量的尺度因子为1（<code>var.scale = 1</code>），每组绘制一个椭圆（<code>ellipse = TRUE</code>）并添加相关系数的圆。</p><pre data-tool="mdnice编辑器"><span></span><code># install_github("vqv/ggbiplot")<br>library(ggbiplot)<br>res.pca &lt;- prcomp(iris[, -5],  scale = TRUE)<br>ggbiplot(res.pca, obs.scale = 1, var.scale = 1, ellipse = TRUE, circle = TRUE)<br><br></code></pre><p><img data-ratio="0.8553971486761711" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHhOeP4hHAgEr0jB12w85mCX1tUF4x0ibVvo5acnBsaZmoIicuXwCSXUxT45VYSulNrKXxqiaJZr1IoZg/640?wx_fmt=png" data-type="png" data-w="982" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHhOeP4hHAgEr0jB12w85mCX1tUF4x0ibVvo5acnBsaZmoIicuXwCSXUxT45VYSulNrKXxqiaJZr1IoZg/640?wx_fmt=png"></p><p data-tool="mdnice编辑器">如果想给不同组别添加分别显示不同颜色，则可以使用参数groups，然后设定为原始数据对应的组别向量（如果你的原始数据没有该列数据，可以自行构造一个向量。）<br></p><pre data-tool="mdnice编辑器"><span></span><code># 添加组别颜色<br>ggbiplot(res.pca, obs.scale = 1, var.scale = 1, ellipse = TRUE,groups = iris$Species, circle = TRUE)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7240740740740741" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHhOeP4hHAgEr0jB12w85mCX1bqOv2QQdXbZ6iac6xZm2qfGD1Czn5rAP5MCCtb016cH5Rfzm2pkYjw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHhOeP4hHAgEr0jB12w85mCX1bqOv2QQdXbZ6iac6xZm2qfGD1Czn5rAP5MCCtb016cH5Rfzm2pkYjw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">当然你可以在此基础上加入ggplot内部的参数，比如更改主题，更改颜色，添加标题等一系列操作。</p><pre data-tool="mdnice编辑器"><span></span><code># 更改主题<br>ggbiplot(res.pca, obs.scale = 1, var.scale = 1, ellipse = TRUE,groups = iris$Species, circle = TRUE) +<br>  theme_bw() +<br>  theme(panel.grid = element_blank()) +<br>  scale_color_brewer(palette = "Set2") +<br>  labs(title = "庄闪闪的R语言手册",subtitle = "快来关注这个宝藏公众号呀！",caption ="绘于：洞头岛")<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7916666666666666" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHhOeP4hHAgEr0jB12w85mCXAsdG1VvRx150H9oicdN72WLaPbJOQ9GySzJ0VTnfEy23eeJQMTjeicCw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHhOeP4hHAgEr0jB12w85mCXAsdG1VvRx150H9oicdN72WLaPbJOQ9GySzJ0VTnfEy23eeJQMTjeicCw/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><p>小编最近有幸上了两节线上的<strong>R语言数据可视化</strong>公益课，把R语言base包以及ggplot语法系统的过了一遍，如果需要补补可视化基础的朋友，可移步我的b站[<strong>账号名：庄闪闪</strong>]，视频回放已等你多时了😅。</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>方法二</span></h2><p data-tool="mdnice编辑器">使用<span>FactoMineR包</span><sup>[3]</sup>的<code>PCA()</code>函数或者使用基础包的<code>prcomp()</code>函数进行数据降维处理，然后使用<span>factoextra包</span><sup>[4]</sup>的<code>fviz_pca_ind()</code>函数对结果进行可视化。</p><p data-tool="mdnice编辑器">这里还是以鸢尾花的数据作为例子，沿用方法一的主成分分析结果res.pca。</p><p data-tool="mdnice编辑器">这个包内部有四个主要绘制主成分结果的函数。</p><ul data-tool="mdnice编辑器"><li><section><p>fviz_pca_ind(): 各样本的散点图</p></section></li><li><section><p>fviz_pca_var(): 变量图</p></section></li><li><section><p>fviz_pca_biplot(): 各个样本和变量的联合图</p></section></li><li><section><p>fviz_pca(): fviz_pca_biplot()的别名</p></section></li></ul><p data-tool="mdnice编辑器">内部参数不做过多介绍，有兴趣的读者请看帮助文档。这里只对下面的代码中出现的参数进行解释。</p><h3 data-tool="mdnice编辑器"><span></span><span>各样本的散点图</span><span></span></h3><p data-tool="mdnice编辑器">使用散点图进行绘制（<code>geom = "point"</code>），颜色使用"cos2"（<code>col.ind="cos2"</code>），使用3阶梯度颜色（<code>gradient.cols = c("white", "#2E9FDF", "#FC4E07" )</code>）。</p><pre data-tool="mdnice编辑器"><span></span><code>library(ggplot2)<br>library(factoextra) #可以直接通过install.packages()进行下载<br># 各个样本图<br>fviz_pca_ind(res.pca, col.ind="cos2", geom = "point",<br>             gradient.cols = c("white", "#2E9FDF", "#FC4E07" ))<br></code></pre><p><img data-ratio="0.6925925925925925" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHhOeP4hHAgEr0jB12w85mCXAiasiboXzcxYRmfhsy7y1c2hW4xIYqicAMmTsfcXyHgw0urMOyE6uqV4A/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHhOeP4hHAgEr0jB12w85mCXAiasiboXzcxYRmfhsy7y1c2hW4xIYqicAMmTsfcXyHgw0urMOyE6uqV4A/640?wx_fmt=png"></p><h3 data-tool="mdnice编辑器"><span></span><span>展示分组变量信息</span><span></span><br></h3><p data-tool="mdnice编辑器">如果想展示分组变量信息，可以通过habillage参数设定，和第一种方法类似，这里还加入了一些细节：各组添加椭圆（<code>addEllipses=TRUE</code>），图的版式使用"Dark2"（<code>palette = "Dark2"</code>）。</p><pre data-tool="mdnice编辑器"><span></span><code>fviz_pca_ind(res.pca, label="none", habillage=iris$Species,<br>             addEllipses=TRUE, ellipse.level=0.95, palette = "Dark2")<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6601851851851852" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHhOeP4hHAgEr0jB12w85mCXbGbPH6ib8yaFKChodVwfmklIGhbTbWribiblhvPknXWB60iahRrtWYXa6w/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHhOeP4hHAgEr0jB12w85mCXbGbPH6ib8yaFKChodVwfmklIGhbTbWribiblhvPknXWB60iahRrtWYXa6w/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">当然可以使用<code>palette = c("#999999", "#E69F00", "#56B4E9")</code>，根据论文全文配色，进行手动调整。</p><pre data-tool="mdnice编辑器"><span></span><code>fviz_pca_ind(res.pca, label="none", habillage=iris$Species,<br>             addEllipses=TRUE, ellipse.level=0.95,<br>             palette = c("#999999", "#E69F00", "#56B4E9"))<br></code></pre><p><img data-ratio="0.7361111111111112" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHhOeP4hHAgEr0jB12w85mCXNJ0Yiao6WmxMiad1TDCGXVwb21yeK1hH37ibGCIOSq8iaq8Y9bfQoUZaMw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHhOeP4hHAgEr0jB12w85mCXNJ0Yiao6WmxMiad1TDCGXVwb21yeK1hH37ibGCIOSq8iaq8Y9bfQoUZaMw/640?wx_fmt=png"></p><h3 data-tool="mdnice编辑器"><span></span><span>个体和变量的双图</span><span></span><br></h3><p data-tool="mdnice编辑器">如果想绘制个体和变量的双图，可以使用<code>fviz_pca_biplot()</code>，内部其他参数构造相同，然后可以添加各种其他ggplot的函数，例如：</p><pre data-tool="mdnice编辑器"><span></span><code># 个体和变量的双图<br># 只保留变量的标签 #按组改变颜色，添加省略号<br>fviz_pca_biplot(res.pca, label = "var", habillage=iris$Species,<br>                addEllipses=TRUE, ellipse.level=0.95,<br>                ggtheme = theme_bw()) +<br>  theme(panel.grid = element_blank()) +<br>  scale_color_brewer(palette = "Set1") +<br>  labs(title = "庄闪闪的R语言手册",subtitle = "快来关注这个宝藏公众号呀！",caption ="绘于：洞头岛")<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7555555555555555" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHhOeP4hHAgEr0jB12w85mCX7PNCicMrEF5yh7SHO1XO9M7F1Zp14RYb6XsRd7Tlc84MNiag5b8Ht50g/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHhOeP4hHAgEr0jB12w85mCX7PNCicMrEF5yh7SHO1XO9M7F1Zp14RYb6XsRd7Tlc84MNiag5b8Ht50g/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span>参考资料</span></h3><section data-tool="mdnice编辑器"><span><span>[1]</span><p>数据降维方法: <em>https://github.com/EasyChart/Beautiful-Visualization-with-R</em></p></span><span><span>[2]</span><p>ggbiplot包: <em>https://github.com/vqv/ggbiplot</em></p></span><span><span>[3]</span><p>FactoMineR包: <em>https://cran.r-project.org/web/packages/FactoMineR/index.html</em></p></span><span><span>[4]</span><p>factoextra包: <em>https://cran.r-project.org/web/packages/factoextra/index.html</em></p></span></section></section><p><br></p><p><br></p><p><span>既往专辑</span></p><section><br></section><table interlaced="disabled" width="677"><tbody><tr><td width="268" valign="top"><section><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1619465081568673792&amp;__biz=MzI1NjUwMjQxMQ==#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-cropselx1="0" data-cropselx2="317" data-cropsely1="0" data-cropsely2="64" data-ratio="0.4212962962962963" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHgtWkkjvtCfz4xFMeT934s0kPFzsVVpoFRpawjKmfjeqG55VadDCtj83buZKLMibOl9Wj8q0KzsPTw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHgtWkkjvtCfz4xFMeT934s0kPFzsVVpoFRpawjKmfjeqG55VadDCtj83buZKLMibOl9Wj8q0KzsPTw/640?wx_fmt=png"></span></a></section></td><td width="268" valign="top"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1476187590709002243&amp;__biz=MzI1NjUwMjQxMQ==#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-cropselx1="0" data-cropselx2="317" data-cropsely1="0" data-cropsely2="66" data-ratio="0.4203703703703704" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHgtWkkjvtCfz4xFMeT934s0oRrRLyegX1PnkSA51V4vx9yzqxd8NzrMgCicocTIOGmv6vtZN0ALQCw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHgtWkkjvtCfz4xFMeT934s0oRrRLyegX1PnkSA51V4vx9yzqxd8NzrMgCicocTIOGmv6vtZN0ALQCw/640?wx_fmt=png"></span></a></p></td></tr><tr><td width="268" valign="top"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1472907153257578500&amp;__biz=MzI1NjUwMjQxMQ==#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-cropselx1="0" data-cropselx2="317" data-cropsely1="0" data-cropsely2="61" data-ratio="0.41759259259259257" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHgtWkkjvtCfz4xFMeT934s0eQ2ojfYdbIibselT3gyjxewMpLXVvE6YucKZTzIvb3GpYl4tlibOwXpQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHgtWkkjvtCfz4xFMeT934s0eQ2ojfYdbIibselT3gyjxewMpLXVvE6YucKZTzIvb3GpYl4tlibOwXpQ/640?wx_fmt=png"></span></a></p></td><td width="268" valign="top"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=1500563134116315139&amp;__biz=MzI1NjUwMjQxMQ==#wechat_redirect" textvalue="你已选中了添加链接的内容" tab="innerlink" data-linktype="1"><span data-positionback="static"><img data-cropselx1="0" data-cropselx2="317" data-cropsely1="0" data-cropsely2="59" data-ratio="0.41759259259259257" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHgtWkkjvtCfz4xFMeT934s0enfUmzxoXGI7PcgkQ8jpn7y1Ak6Qj0aKYd730Pv74sM9jg4DjShhWQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/MIcgkkEyTHgtWkkjvtCfz4xFMeT934s0enfUmzxoXGI7PcgkQ8jpn7y1Ak6Qj0aKYd730Pv74sM9jg4DjShhWQ/640?wx_fmt=png"></span></a></p></td></tr></tbody></table><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/finAVbrqwTQwsES2gzg7Kg",target="_blank" rel="noopener noreferrer">原文链接</a>
