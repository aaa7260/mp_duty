---
title: "生信小课堂(2) 并行运算那些事"
date: 2023-10-04T17:35:58Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
生信小课堂(2) 并行运算那些事 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来介绍如何在命令行终端执行并行运算，使用并行可以极大的提高效率充分利用机器的性能。并行运算的方式有很多，在此主要介绍<strong>「parallel」</strong>。parallel是一个命令行工具，用于并行执行作业。它可以在单台机器上的多个核心或多台机器上并行执行命令。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>基本特性</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section>1.并行执行：parallel可以并行执行命令，从而充分利用多核心CPU。</section></li><li><section>2.输出控制：parallel可以确保输出不会混合，即使在并行执行时也是如此。</section></li><li><section>3.灵活性：parallel可以与许多其他Unix命令结合使用，如find、grep和awk。</section></li><li><section>4.远程执行：parallel可以在多台机器上并行执行命令，只需提供SSH访问权限。</section></li></ul><h3 data-tool="mdnice编辑器"><span></span><span><span></span>软件安装</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>sudo apt-get install parallel <span># ubuntu系统安装parallel</span><br>brew install parallel  <span># mac安装parallel</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>基本用法</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>parallel --will-cite <span>"echo {}; mkdir {}"</span> ::: dir1 dir2 dir3<br>ls *.txt | parallel gzip {} # 并行压缩文件<br><br>cat urls.txt | parallel wget # 并行下载文件<br>ls *.png | parallel convert {} {.}.jpg<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>主要参数</span><span></span></h3><p data-tool="mdnice编辑器"><code>parallel</code>的<code>-j</code>参数是一个非常重要的参数，用于指定同时运行的作业数。<code>-j</code>参数后跟一个数字，表示同时运行的最大作业数。这通常与你的 CPU 核心数有关，但也可以根据任务的性质和资源需求进行调整。</p><p data-tool="mdnice编辑器"><strong>「默认值」</strong>：如果不指定 <code>-j</code> 参数，<code>parallel</code> 默认会启动与CPU核心数相同的作业数。</p><pre data-tool="mdnice编辑器"><span></span><code>parallel -j 4 <span>command</span> ::: input1 input2 input3 ...<br></code></pre><section><strong>「使用所有可用的CPU核心」</strong>：只需省略<code>-j</code>参数或设置为0,<code>parallel</code>将使用所有可用的CPU 核心。</section><blockquote data-tool="mdnice编辑器"><span>❝</span><p>在parallel命令中，<code>:::</code>是一个特殊的符号，用于分隔命令和输入参数。它允许用户为命令提供多个输入参数，并使命令并行地对每个输入参数执行一次。当使用<code>command ::: input1 input2 input3</code>这样的结构时，parallel会为每个输入参数执行一次命令。</p><span>❞</span></blockquote><pre data-tool="mdnice编辑器"><span></span><code>parallel echo ::: A B C<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>A<br>B<br>C<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>parallel echo {} {} ::: A B ::: <span>1</span> <span>2</span><br></code></pre><pre data-tool="mdnice编辑器"><span></span><code><span>echo</span> A 1<br><span>echo</span> A 2<br><span>echo</span> B 1<br><span>echo</span> B 2<br></code></pre><h4 data-tool="mdnice编辑器"><span></span><span><span></span>文本检索</span><span></span></h4><p data-tool="mdnice编辑器">假设有三个文本文件：file1.txt, file2.txt, 和 file3.txt，你想并行地对每个文件执行 grep 命令来搜索某个词汇，可以这样做：</p><pre data-tool="mdnice编辑器"><span></span><code>parallel grep <span>'search_term'</span> ::: file1.txt file2.txt file3.txt<br></code></pre><p data-tool="mdnice编辑器">这种结构使得parallel命令非常灵活和强大</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span><code>--will-cite</code></span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>当你首次运行<code>parallel</code>时会显示一个消息，建议你引用<code>parallel</code>的相关文献,以支持其开发。<code>--will-cite</code>参数是一个告知<code>parallel</code>你知道这个请求并且可能会引用它(或者只是想消除这个消息)的方式。使用这个参数后<code>parallel</code>将不再显示引用请求消息。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>生信中的并行应用</span><span></span></h3><h4 data-tool="mdnice编辑器"><span></span><span><span></span>并行下载原始数据</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>cat sra_explorer_fastq_aspera_download.sh| parallel -j <span>6</span> --will-cite<br></code></pre><h4 data-tool="mdnice编辑器"><span></span><span><span></span>并行解压缩</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>parallel -j <span>6</span> -P <span>5</span> <span>'gzip -d {}'</span> ::: *.fastq.gz<br></code></pre><h4 data-tool="mdnice编辑器"><span></span><span><span></span>并行质控</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>parallel -j <span>10</span> --max-args=<span>2</span> <br>fastp \<br>--thread <span>8</span> \<br>--in1 <span>"{1}"</span> \<br>--in2 <span>"{2}"</span> \<br>--out1 <span>"./clean/{1/}"</span> \<br>--out2 <span>"./clean/{2/}"</span> \<br>-h <span>"./clean_fp/{1/}"</span>.fastp.html \<br>-j <span>"./clean_fp/{1/}"</span>.fastp.json \<br>::: ./rawdata/*.fastq<br></code></pre><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节内容介绍到此结束过程仅供参考，关于并行运算还有很多的案例等着大家去探索；有需要学习个性化数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>购买<strong>「2023年度会员文档」</strong>同步更新中<strong>「售价149元」</strong>，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；按照往年数据小编年产出约在150+以上</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可下单购买，需要了解更多信息的朋友欢迎交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺</span><span></span></h3><p><img data-galleryid="" data-ratio="1.0210420841683367" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg" data-type="jpeg" data-w="998" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023会员群案例展示</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpXMklTicZBSIViaGK2Zcuf9U0mC4ibBKwZvZKE73PTiaDibzUiag6iakwvsNYIg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpXMklTicZBSIViaGK2Zcuf9U0mC4ibBKwZvZKE73PTiaDibzUiag6iakwvsNYIg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpX7BBjicGLchtyop93eiapZJQt2fBreZbeBoiaRmQRMggPicqF0kuGcndMTQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpX7BBjicGLchtyop93eiapZJQt2fBreZbeBoiaRmQRMggPicqF0kuGcndMTQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpX3ibTpR68icQSPLDXnOVoTXnWID8INbNUyzoLbpGPokQQDH9d2QrlvyBQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpX3ibTpR68icQSPLDXnOVoTXnWID8INbNUyzoLbpGPokQQDH9d2QrlvyBQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpXAaPfw1QuudzwrGoric9wpUwPF5Z6JKtfXB8LjJtHLFdeo14wrZ26sibg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpXAaPfw1QuudzwrGoric9wpUwPF5Z6JKtfXB8LjJtHLFdeo14wrZ26sibg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpXUMAOvtMSkh6XKtTvwPp84upDRI7wmLMzEb5kd6MoXdiaklqw0XklesQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpXUMAOvtMSkh6XKtTvwPp84upDRI7wmLMzEb5kd6MoXdiaklqw0XklesQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpX5I1KficLzYvO52vYCAaOqlcgFCGkw33K7tLOITibibseoMkxlmFUQxhOQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpX5I1KficLzYvO52vYCAaOqlcgFCGkw33K7tLOITibibseoMkxlmFUQxhOQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpXlRKjNPJe08INJhZ8nWry2VEcVyFPEPFXwc4pTY8pHzsIxuenck6UFg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpXlRKjNPJe08INJhZ8nWry2VEcVyFPEPFXwc4pTY8pHzsIxuenck6UFg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpXvXadO7uarejyE5jdnXuO9cGPiamiaI8okvn0NmoVBJamZEib5qZ6tUfLA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpXvXadO7uarejyE5jdnXuO9cGPiamiaI8okvn0NmoVBJamZEib5qZ6tUfLA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpXmUA6RzibHfjhTpl6ibJzkPJqiaKWjhZ0Qsbcpc7tVfBDRwLPUHXaIUOibA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZyOwHcWERIzWrJ8VfBMTpXmUA6RzibHfjhTpl6ibJzkPJqiaKWjhZ0Qsbcpc7tVfBDRwLPUHXaIUOibA/640?wx_fmt=png"></p></section><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/X8gp5CUzK1Qbimhz1fIIFQ",target="_blank" rel="noopener noreferrer">原文链接</a>
