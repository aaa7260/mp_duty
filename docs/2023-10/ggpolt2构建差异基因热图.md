---
title: "ggpolt2构建差异基因热图"
date: 2023-10-10T20:25:22Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
ggpolt2构建差异基因热图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节分享如何基于差异基因分析的结果来绘制热图，主要还是基于ggplot2体系来实现，针对以往的代码风格，这次小编通过拆分数据定义每一部分的函数来编写新的代码，希望对各位观众老爷能有新的帮助，数据和代码已经被打包并上传到小编的2023VIP会员交流群。已经加群的朋友可以自行下载。如果你需要，可以参考文末的方式进行购买。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(ggtree)<br><span>library</span>(aplot)<br><span>library</span>(scico)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>读取并处理数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>process_data &lt;- <span>function</span>() {<br>  gene &lt;- read_tsv(<span>"diff.txt"</span>) %&gt;% <br>    arrange(desc(abs(logFC))) %&gt;% <br>    head(<span>11</span>) %&gt;% <br>    pull(id)<br>  <br>  df &lt;- read_tsv(<span>"diffGeneExp.txt"</span>) %&gt;% <br>    pivot_longer(-id) %&gt;% <br>    filter(id %<span>in</span>% gene) %&gt;% <br>    pivot_wider(., names_from=name, values_from=value) %&gt;% <br>    column_to_rownames(var=<span>"id"</span>)<br>  <br>  dff &lt;- df %&gt;% <br>    scale() %&gt;% <br>    as.data.frame() %&gt;% <br>    rownames_to_column(var=<span>"id"</span>) %&gt;% <br>    pivot_longer(-id) %&gt;% <br>    mutate(type = map_chr(name, ~str_split(.x, <span>"_"</span>)[[<span>1</span>]][length(str_split(.x, <span>"_"</span>)[[<span>1</span>]])]))<br>  <br>  list(df = df, dff = dff)<br>}<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>生成热图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>generate_heatmap &lt;- <span>function</span>(dff) {<br>  ggplot(dff, aes(name, id, fill=value)) +<br>    geom_tile() +<br>    scale_y_discrete(position = <span>"right"</span>, expand = c(0,0)) +<br>    scale_fill_scico(palette = <span>'cork'</span>) +<br>    labs(x=NULL, y=NULL) +<br>    theme(axis.text.x=element_blank(),<br>          axis.text.y=element_text(color=<span>"black"</span>, size=8),<br>          axis.ticks = element_blank(),<br>          panel.background = element_blank(),<br>          plot.background = element_blank(),<br>          legend.background = element_blank(),<br>          legend.title =element_blank())<br>}<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>生成树状图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>generate_tree &lt;- <span>function</span>(df) {<br>  hclust(dist(df, method = <span>"binary"</span>)) %&gt;% <br>    ggtree(layout=<span>"rectangular"</span>, branch.length=<span>"none"</span>) +<br>    theme_void()<br>}<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>生成类型图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>generate_type_plot &lt;- <span>function</span>(dff) {<br>  dff %&gt;% <br>    mutate(Type=<span>'Type'</span>) %&gt;% <br>    ggplot(aes(name, Type, fill=type)) +<br>    geom_tile() +<br>    scale_y_discrete(position = <span>"right"</span>, expand = c(<span>0</span>,<span>0</span>)) +<br>    scale_fill_manual(values=c(<span>"#3B9AB2"</span>,<span>"#78B7C5"</span>)) +<br>    theme(panel.background = element_blank(),<br>          axis.ticks = element_blank(),<br>          axis.title = element_blank(),<br>          axis.text.x = element_blank(),<br>          plot.background = element_blank())<br>}<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>主函数</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>main &lt;- <span>function</span>() {<br>  data &lt;- process_data()<br>  heatmap &lt;- generate_heatmap(data$dff)<br>  phr &lt;- generate_tree(data$df)<br>  type_plot &lt;- generate_type_plot(data$dff)<br>  <br>  heatmap %&gt;% <br>    insert_left(phr, width = <span>0.2</span>) %&gt;% <br>    insert_top(type_plot, height = <span>0.08</span>)<br>}<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>绘图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>main()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.39444444444444443" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPTx18fcF9CbUXCgNlRMM9rk59wIcxMyRkj5FZeRIYDO6U3wQj4Olqqw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPTx18fcF9CbUXCgNlRMM9rk59wIcxMyRkj5FZeRIYDO6U3wQj4Olqqw/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节内容介绍到此结束，过程仅供参考；有需要学习个性化数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>购买<strong>「2023年度会员文档」</strong>同步更新中<strong>「售价149元」</strong>，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；按照往年数据小编年产出约在150+以上</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可下单购买，需要了解更多信息的朋友欢迎淘宝店铺交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺(淘宝扫一扫)</span><span></span></h3><p><img data-galleryid="" data-ratio="1.0210420841683367" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg" data-type="jpeg" data-w="998" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023会员群案例展示</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPuicA0fv7U6U7VJos49alAsuxIGy3GWGkBJTIvWNFILhxgvY5FmAf3LA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPuicA0fv7U6U7VJos49alAsuxIGy3GWGkBJTIvWNFILhxgvY5FmAf3LA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPULOMHnncY63ZaLwqKr1XozialtEbsMfsJouxHlzQaGntv6exmjU9miaQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPULOMHnncY63ZaLwqKr1XozialtEbsMfsJouxHlzQaGntv6exmjU9miaQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPvvJDCxg00VJ50g5tvyiaPgyS2EpY1SHUlPbHVnj4rNc7HXzfL9RXPCg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPvvJDCxg00VJ50g5tvyiaPgyS2EpY1SHUlPbHVnj4rNc7HXzfL9RXPCg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAP1LIlXF3InLTtW7ruVIGicvYwIG0KOqVIicw6rCDIn5yEaTlRd4o4OYNQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAP1LIlXF3InLTtW7ruVIGicvYwIG0KOqVIicw6rCDIn5yEaTlRd4o4OYNQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPzLFtk5I032OX8j2KHmswCbtvPoI8fMaNX9oc8OicxLptl70YRZOxQBA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPzLFtk5I032OX8j2KHmswCbtvPoI8fMaNX9oc8OicxLptl70YRZOxQBA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPtevCUU8dbUCDjFFeVblVm6YagIicztl3IJrKe1OqyGXqcKzDZ8LicUPQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPtevCUU8dbUCDjFFeVblVm6YagIicztl3IJrKe1OqyGXqcKzDZ8LicUPQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPv4EAqyxjgS9TBRxIESmKzuStaVxm3O5vibqlrfzOHuicDj65Do62gI7A/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPv4EAqyxjgS9TBRxIESmKzuStaVxm3O5vibqlrfzOHuicDj65Do62gI7A/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAP2Uo0icKNHib8qPU53qFCsZ4SrjyGFvBT0IKTUuWkAM0yu9Y3AmRE4Xicg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAP2Uo0icKNHib8qPU53qFCsZ4SrjyGFvBT0IKTUuWkAM0yu9Y3AmRE4Xicg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPPcIQG45GibXAGdevzNE2YPPbYvB0egvQaRXMF0icbwIYdbIx6lGlukJg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbN63IibBKzPkypTUkcpsxAPPcIQG45GibXAGdevzNE2YPPbYvB0egvQaRXMF0icbwIYdbIx6lGlukJg/640?wx_fmt=png"></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Raa0fzbduQtCxNsYaGVZug",target="_blank" rel="noopener noreferrer">原文链接</a>
