---
title: "ggplot2自定义正负分布图文本颜色"
date: 2023-10-25T23:44:04Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
ggplot2自定义正负分布图文本颜色 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本周会员交流群中看到有朋友询问一个问题，如何给文本添加不同的颜色，图形为正负分布条图。本节就来通过绘图案例展示一下如何实现这一功能，过程仅供参考，希望对各位观众老爷能有新的帮助，数据和代码已经被打包并上传到小编的2023VIP会员交流群。已经加群的朋友可以自行下载。如果你需要，可以参考文末的方式进行购买。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h3 data-tool="mdnice编辑器"><span></span><span><span></span>图形解读</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="0.6231481481481481" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPW5w93UtM57EpduPmYTdQgaV8K4KFWMxI71XQibvFnIDuDve2h1Ajb9A/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPW5w93UtM57EpduPmYTdQgaV8K4KFWMxI71XQibvFnIDuDve2h1Ajb9A/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>主要实现的功能为将条形图的填充颜色与文本颜色对应，那么对于此问题我们可以有如下的解决方法</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">1.根据文本内容构建分组<br>2.针对分组构建不同的颜色<br>3.构建颜色与文本之间的映射关系</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(grid)<br><span>library</span>(ggtext)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>chocolate &lt;- read_csv(<span>'data.csv'</span>)<br>mean &lt;- mean(chocolate$rating)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- chocolate  %&gt;%<br>  group_by(company_location) %&gt;% <br>  summarise(n = n(),min_rating = min(rating),max_rating = max(rating),<br>            avg_rating = mean(rating, na.rm = <span>T</span>)) %&gt;% <br>  mutate(company_location = fct_reorder(company_location, avg_rating)) %&gt;% <br>  filter(n &gt; <span>3</span>) %&gt;% <br>  mutate(rating_diff = avg_rating - mean) %&gt;% <br>  filter(abs(rating_diff) &gt;<span>0.05</span>) %&gt;% as.data.frame() %&gt;%<br>  mutate(group = rep(rep(c(<span>"A"</span>, <span>"B"</span>, <span>"C"</span>,<span>"D"</span>,<span>"H"</span>), times = c(<span>10</span>, <span>6</span>, <span>9</span>,<span>4</span>,<span>10</span>)), length.out = <span>39</span>)) %&gt;% <br>  mutate(col=case_when(group==<span>"A"</span> ~ <span>"#E6956F"</span>,<br>                       group==<span>"B"</span> ~ <span>"#788FCE"</span>,<br>                       group==<span>"C"</span> ~ <span>"#A6BA96"</span>,<br>                       group==<span>"D"</span> ~ <span>"#CDC3D4"</span>,<br>                       group==<span>"H"</span> ~ <span>"#A88AD2"</span>))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建文本与颜色映射</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>color_mapping &lt;- df %&gt;% <br>  distinct(company_location, col) %&gt;%<br>  deframe()<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df %&gt;%<br>  ggplot() + <br>  geom_col(aes(x = rating_diff, y = company_location, fill = company_location),<br>           size = <span>0.25</span>, color = <span>"white"</span>)+<br>  geom_point(aes(x = rating_diff,y = company_location,color=company_location),size=<span>5</span>)+<br>  geom_text(aes(x = ifelse(rating_diff &gt; <span>0</span>, -<span>.005</span>, <span>.005</span>),y = company_location, <br>                label = company_location,color = company_location,<br>                hjust = ifelse(rating_diff &gt; <span>0</span>, <span>1</span>, <span>0</span>)),size = <span>4</span>)+<br>  geom_vline(xintercept=<span>0</span>,size=<span>1</span>,color=<span>"grey40"</span>)+<br>  scale_x_continuous(expand = expansion(add = c(<span>0</span>,<span>.2</span>)),<br>                     breaks = seq(-<span>.4</span>,<span>.2</span>, by = <span>.2</span>)) + <br>  scale_y_discrete(expand = c(<span>.025</span>,<span>.025</span>))+<br>  scale_fill_manual(values = color_mapping) +<br>  scale_color_manual(values = color_mapping)+<br>  coord_cartesian(clip = <span>"off"</span>) +<br>  theme_minimal() +<br>  theme(panel.grid = element_blank(),<br>        plot.background = element_rect(fill=<span>"Aliceblue"</span>,color=<span>"Aliceblue"</span>),<br>        axis.text.y=element_blank(),<br>        axis.title = element_blank(),<br>        legend.position = <span>"none"</span>,<br>        axis.text.x = element_text(face = <span>"bold"</span>, size =rel(<span>1</span>), color = <span>"black"</span>))<br></code></pre><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节内容介绍到此结束，过程仅供参考；有需要学习个性化数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>购买<strong>「2023年度会员文档」</strong>同步更新中<strong>「售价149元」</strong>，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；按照往年数据小编年产出约在150+以上</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可下单购买，需要了解更多信息的朋友欢迎淘宝店铺交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺(淘宝扫一扫)</span><span></span></h3><p><img data-galleryid="" data-ratio="1.0210420841683367" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg" data-type="jpeg" data-w="998" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023会员群案例展示</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPfAxayhdL70YxbWGiaRKt0Dq3kDklFrhLlncZNblQYOicvy1IYGvCwjhQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPfAxayhdL70YxbWGiaRKt0Dq3kDklFrhLlncZNblQYOicvy1IYGvCwjhQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPKWqjf4oGknMpicIZ1qhqpoHf7QGxVUFs6vria15z5xe3wD8aHicT4C70A/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPKWqjf4oGknMpicIZ1qhqpoHf7QGxVUFs6vria15z5xe3wD8aHicT4C70A/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPW6eZNbIrxBRHoK1NbAFHd6uia8jribmo3JF02QgyaI3LUdC4ytCias9dQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPW6eZNbIrxBRHoK1NbAFHd6uia8jribmo3JF02QgyaI3LUdC4ytCias9dQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPicwGjJVxQdOpk4ds86emy3jr55tezmibhsH3aXxVVEaZkukwgxPrQv9Q/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPicwGjJVxQdOpk4ds86emy3jr55tezmibhsH3aXxVVEaZkukwgxPrQv9Q/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPep5xgVMCRwPIHv2DwtFxzcDqO0eMciavkItR8obEVEcwC77Vz9hZEGg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPep5xgVMCRwPIHv2DwtFxzcDqO0eMciavkItR8obEVEcwC77Vz9hZEGg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPJqjvWibdyJLwrhgxeA8icOmIgexIIeoU5XByewnAYdrvM1UWb6xjsNow/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPJqjvWibdyJLwrhgxeA8icOmIgexIIeoU5XByewnAYdrvM1UWb6xjsNow/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPcRSmDYRDQvhodZsCl4e2KUhmCXicBNtkVrhrviavaISOgkHvyUicYEWqA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPcRSmDYRDQvhodZsCl4e2KUhmCXicBNtkVrhrviavaISOgkHvyUicYEWqA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPAK9qxcAVaZdJ0Mcq9TCWddoPQqfwUJDnibuEicUNGrMCSENKxZAz8Vmw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPAK9qxcAVaZdJ0Mcq9TCWddoPQqfwUJDnibuEicUNGrMCSENKxZAz8Vmw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPdYX4Wwy3IHkloqTbsQrfgIsdmO8pXwUTALRV3boNJxIB1PK8OuYYGQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZmlgic7LvKicSLpmFBLBuJRPdYX4Wwy3IHkloqTbsQrfgIsdmO8pXwUTALRV3boNJxIB1PK8OuYYGQ/640?wx_fmt=png"></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/5RxqSxzvDdXQdmIQqFegIw",target="_blank" rel="noopener noreferrer">原文链接</a>
