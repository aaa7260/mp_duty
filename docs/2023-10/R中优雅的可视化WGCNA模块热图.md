---
title: "R中优雅的可视化WGCNA模块热图"
date: 2023-10-13T23:51:53Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
R中优雅的可视化WGCNA模块热图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节分享如何基于WGCNA的结果来绘制模块热图，过程仅供参考在此介绍两种热图的绘制方法，希望对各位观众老爷能有新的帮助，数据和代码已经被打包并上传到小编的2023VIP会员交流群。已经加群的朋友可以自行下载。如果你需要，可以参考文末的方式进行购买。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(ggthemes)<br><span>library</span>(magrittr)<br><span>library</span>(WGCNA)<br><span>library</span>(linkET)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入WGCNA结果</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>load(<span>"df.Rdata"</span>)<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>gene_exp &lt;- read.table(file =<span>'heatmap.txt'</span>,row.names=<span>1</span>) %&gt;% dplyr::select(<span>1</span>:<span>24</span>)<br><br><span># 转置</span><br>datExpr0 &lt;- t(gene_exp)<br><br><span># 缺失数据及无波动数据过滤</span><br>gsg &lt;- goodSamplesGenes(datExpr0,minFraction = <span>1</span>/<span>2</span>) <span>#基因的缺失数据比例阈值</span><br>datExpr &lt;- datExpr0[gsg$goodSamples, gsg$goodGenes]<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>WGCNA绘制模块热图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>MEs2 &lt;- MEs %&gt;% dplyr::select(1:20)<br><br>moduleTraitCor &lt;- cor(MEs2,design %&gt;% dplyr::select(1:6),<br>                      use = <span>"p"</span>,method = <span>'pearson'</span>)<br><br><span># 计算 Pvalue</span><br>moduleTraitPvalue &lt;- corPvalueStudent(moduleTraitCor,nrow(datExpr))<br>sizeGrWindow(10,6)<br><br><span># 连接相关性和 pvalue</span><br>textMatrix &lt;- paste(signif(moduleTraitCor, 2), <span>"\n("</span>,<br>                    signif(moduleTraitPvalue, 1), <span>")"</span>, sep = <span>""</span>);<br>dim(textMatrix) &lt;- dim(moduleTraitCor)<br><span># heatmap 画图</span><br>par(mar = c(5,7,3,1))<br><br>labeledHeatmap(Matrix = moduleTraitCor,<br>                     xLabels = names(design %&gt;% dplyr::select(1:6)),<br>                     yLabels = names(MEs2),<br>                     ySymbols = names(MEs2),<br>                     colorLabels = FALSE,<br>                     colors = blueWhiteRed(50),<br>                     textMatrix = textMatrix,<br>                     setStdMargins = FALSE,<br>                     cex.text = 0.5,<br>                     zlim = c(-1,1),<br>                     main = paste(<span>"Module-trait relationships"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.628635346756152" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBTNtfF9UbrMPZqctaqmBdImT1JIhLBUl2oiaeouJY1Be2AMDmibRNaEtA/640?wx_fmt=png" data-type="png" data-w="894" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBTNtfF9UbrMPZqctaqmBdImT1JIhLBUl2oiaeouJY1Be2AMDmibRNaEtA/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>绘制模块热图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>link_cor &lt;- mantel_test(design %&gt;% select(<span>1</span>,<span>2</span>,<span>3</span>,<span>4</span>,<span>5</span>,<span>6</span>),MEs2,<br>                        spec_select =list(CAR15=<span>1</span>,CAR5=<span>2</span>,<br>                                      Cd_CK=<span>3</span>,Cd_treatment=<span>4</span>,<br>                                      CK_elo=<span>5</span>,CK_mat=<span>6</span>)) %&gt;% <br>  mutate(rd=cut(r,breaks=c(-<span>Inf</span>,<span>0.2</span>,<span>0.6</span>,<span>Inf</span>),<br>                labels=c(<span>"&lt;0.2"</span>,<span>"0.2-0.6"</span>,<span>"&gt;=0.6"</span>)),<br>         pd=cut(p,breaks=c(-<span>Inf</span>,<span>0.01</span>,<span>0.5</span>,<span>Inf</span>),<br>                labels=c(<span>"&lt;0.01"</span>,<span>"0.01-0.05"</span>,<span>"&gt;=0.05"</span>)))<br><br>qcorrplot(correlate(MEs2),type = <span>"upper"</span>, diag = <span>FALSE</span>) +<br>  geom_square() +<br>  geom_couple(aes(colour = pd, size = rd), data = link_cor, <br>              curvature = nice_curvature()) +<br>  scale_fill_gradientn(colours = rev(RColorBrewer::brewer.pal(<span>11</span>, <span>"RdBu"</span>)))+<br>  scale_size_manual(values = c(<span>0.5</span>, <span>1</span>, <span>2</span>)) +<br>  scale_colour_manual(values = color_pal(<span>3</span>)) +<br>  guides(size = guide_legend(title = <span>"Mantel's r"</span>,override.aes = list(colour = <span>"grey35"</span>), order = <span>2</span>),<br>         colour = guide_legend(title = <span>"Mantel's p"</span>, override.aes = list(size = <span>3</span>), order = <span>1</span>),<br>         fill = guide_colorbar(title = <span>"Pearson's r"</span>,order = <span>3</span>))+<br>  theme(plot.margin = unit(c(<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>),units=<span>"cm"</span>),<br>        legend.background = element_blank(),<br>        legend.key = element_blank())<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7833333333333333" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBSEyTqibET1dwTibQTyL0bt8T5xrusja4kdbEaWVqzP09rKOsFESCMH3g/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBSEyTqibET1dwTibQTyL0bt8T5xrusja4kdbEaWVqzP09rKOsFESCMH3g/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节内容介绍到此结束，过程仅供参考；有需要学习个性化数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>购买<strong>「2023年度会员文档」</strong>同步更新中<strong>「售价149元」</strong>，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；按照往年数据小编年产出约在150+以上</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可下单购买，需要了解更多信息的朋友欢迎淘宝店铺交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺(淘宝扫一扫)</span><span></span></h3><p><img data-galleryid="" data-ratio="1.0210420841683367" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg" data-type="jpeg" data-w="998" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023会员群案例展示</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBmibQZZeZmlyy7HYbm7tBsMQEL612glD75AISn2ecZqk3icMG6Q3Rkt6g/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBmibQZZeZmlyy7HYbm7tBsMQEL612glD75AISn2ecZqk3icMG6Q3Rkt6g/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBQkc6tsmeSzCkWl2n7vuCRyL7orxWrsVqMsicKYbgoibt3bBPUzeOg1Qg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBQkc6tsmeSzCkWl2n7vuCRyL7orxWrsVqMsicKYbgoibt3bBPUzeOg1Qg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBnn0kn9bhibSficAE7k7pWUry6zHibuHqVKFUSsib2cicDUWBiagBic9Aia4WMg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBnn0kn9bhibSficAE7k7pWUry6zHibuHqVKFUSsib2cicDUWBiagBic9Aia4WMg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBbLVfexszjgic9Zky1xmRfCUzIiakfMibJmx5Ckv5C6AUV4IYTdgMzRtEw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBbLVfexszjgic9Zky1xmRfCUzIiakfMibJmx5Ckv5C6AUV4IYTdgMzRtEw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBcpU6Y6F71EgiaheQOhMYaqic74Z9Zofic6DDsASzzYib3VmJRQm4iaG4a4g/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBcpU6Y6F71EgiaheQOhMYaqic74Z9Zofic6DDsASzzYib3VmJRQm4iaG4a4g/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBghMKzx1ZXdZHTBl9EiavNc2X0XmlD70cgPNPKKicrZKcI2EmiavvsdIJA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBghMKzx1ZXdZHTBl9EiavNc2X0XmlD70cgPNPKKicrZKcI2EmiavvsdIJA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBrCj5STdRJL1GwdmTiafhvsFMVu68wCbUAV4gZBly1dicDsbHia7tLdPVA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBrCj5STdRJL1GwdmTiafhvsFMVu68wCbUAV4gZBly1dicDsbHia7tLdPVA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBUemCseaGFicYvU5EzxOeHxFMIm27S15OqYa8FOYppTjwyrKsfZxT5Cw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyBUemCseaGFicYvU5EzxOeHxFMIm27S15OqYa8FOYppTjwyrKsfZxT5Cw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyB7WDvaW3JB7N5FCSkMVCZrt3YRicmLAWKBLL63S6RTSgV6Ge2TFGPrNg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYuzCAcZM19cfgtvK2OTbyB7WDvaW3JB7N5FCSkMVCZrt3YRicmLAWKBLL63S6RTSgV6Ge2TFGPrNg/640?wx_fmt=png"></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Gy-2t8UIrX7Qy_nt7bMIjw",target="_blank" rel="noopener noreferrer">原文链接</a>
