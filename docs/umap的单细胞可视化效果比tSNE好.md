---
title: "umap的单细胞可视化效果比tSNE好"
date: 2023-01-11T03:15:05Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
umap的单细胞可视化效果比tSNE好 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>昨晚有幸听了上海长海医院任善成教授的关于前列腺癌的精准诊疗的演讲，任教授提到了他们2021年1月在在 Nature Cell Biology 杂志发表了题为《Single-cell analysis reveals transcriptomic remodellings in distinct cell types that contribute to human prostate cancer progression》论文.</p></blockquote><p data-tool="mdnice编辑器">我就顺手下载了打开读了一下，发现他们的单细胞转录组数据降维聚类分群后的可视化选择的是tSNE，感觉看起来呢各个单细胞亚群之间的边界线有点不清晰。所以想着下载作者提供的单细胞表达量矩阵自己走一遍流程使用umap可视化看看。作者的tSNE图如下所示：</p><p><img data-galleryid="" data-ratio="0.9907529722589168" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwxjstYatbEmOKuEvmeibicc4THumOd2bQogWicia7MbiaXrwpf79gCS2W1yD99XpVyug0PXAmLMJczQfA/640?wx_fmt=png" data-type="png" data-w="1514" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwxjstYatbEmOKuEvmeibicc4THumOd2bQogWicia7MbiaXrwpf79gCS2W1yD99XpVyug0PXAmLMJczQfA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>tSNE图</figcaption></figure><p data-tool="mdnice编辑器">表达量矩阵在：https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE141445</p><p data-tool="mdnice编辑器">是 36,424 single-cells from 13 prostate tumors ，作者的实验技术很棒，取样的病人肿瘤组织样品而且里面绝大部分都是恶性肿瘤上皮细胞，在其它癌症很少看到这样的完美的的结果。作者提供的表达量矩阵是：</p><pre data-tool="mdnice编辑器"><span></span><code>GSM4203181_data.matrix.txt.gz 675.4 Mb<br>GSM4203181_data.raw.matrix.txt.gz 81.6 Mb<br></code></pre><p data-tool="mdnice编辑器">大家很容易自行下载，然后读取就可以成为Seurat对象啦 ：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(data.table)<br>Sys.time()<br>raw.data &lt;- fread( <span>'GSM4203181_data.raw.matrix.txt.gz'</span>, <br>                   data.table = <span>F</span>)<br>Sys.time()<br>dim(raw.data) <span># </span><br>raw.data[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>rownames(raw.data)=raw.data[,<span>1</span>]<br>raw.data=raw.data[,-<span>1</span>]<br>head(colnames(raw.data))  <br><span>library</span>(stringr)<br>metadata &lt;- as.data.frame(str_split(colnames(raw.data),<span>'[-]'</span>,<br>                                    simplify = <span>T</span>))<br>head(metadata) <br>table(metadata[,<span>2</span>])<br>metadata=metadata[,c(<span>2</span>,<span>1</span>)]<br>colnames(metadata)=c(<span>'orig.ident'</span> ,<span>'barcode'</span>)<br>metadata$orig.ident=paste0(<span>'p'</span>,metadata$orig.ident) <br>table(metadata$orig.ident)<br>rownames(metadata) = colnames(raw.data)<br>identical(rownames(metadata),colnames(raw.data))<br>sce.all &lt;- CreateSeuratObject(counts = raw.data) <br>sce.all &lt;- AddMetaData(object = sce.all, metadata = metadata)<br>as.data.frame(sce.all@assays$RNA@counts[<span>1</span>:<span>10</span>, <span>1</span>:<span>2</span>])<br>head(sce.all@meta.data, <span>10</span>)<br>table(sce.all@meta.data$orig.ident)<br></code></pre><p data-tool="mdnice编辑器">并且对这个Seurat对象进行降维聚类分群，参考前面的例子：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247497956&amp;idx=1&amp;sn=5d4deb7cf7b7848b3e2273cbd663bb6a&amp;scene=21#wechat_redirect" data-linktype="2">人人都能学会的单细胞聚类分群注释</a> ，而且每个亚群找高表达量基因，如果你对单细胞数据分析还没有基础认知，可以看基础10讲：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486076&amp;idx=1&amp;sn=52bb851d7dc23461233a2cf458736151&amp;scene=21#wechat_redirect" data-linktype="2">01. 上游分析流程</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486082&amp;idx=1&amp;sn=03cadceffb2c14ba95d97fe5caf38d94&amp;scene=21#wechat_redirect" data-linktype="2">02.课题多少个样品，测序数据量如何</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486088&amp;idx=1&amp;sn=3a115338ee4937d20caab78627237553&amp;scene=21#wechat_redirect" data-linktype="2">03. 过滤不合格细胞和基因（数据质控很重要）</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486096&amp;idx=1&amp;sn=1a99c4c5800b7e0287db3e8ef369fab8&amp;scene=21#wechat_redirect" data-linktype="2">04. 过滤线粒体核糖体基因</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486098&amp;idx=1&amp;sn=bf9a71df848d74fe665ce7d5e283d5ff&amp;scene=21#wechat_redirect" data-linktype="2">05. 去除细胞效应和基因效应</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486260&amp;idx=1&amp;sn=c6abf658de73594d1d77d8e1ffa7d153&amp;scene=21#wechat_redirect" data-linktype="2">06.单细胞转录组数据的降维聚类分群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486271&amp;idx=1&amp;sn=638b434b6deee63206af1c0eeda175ab&amp;scene=21#wechat_redirect" data-linktype="2">07.单细胞转录组数据处理之细胞亚群注释</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486278&amp;idx=1&amp;sn=91250ef733833ff00371818b215dc124&amp;scene=21#wechat_redirect" data-linktype="2">08.把拿到的亚群进行更细致的分群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486287&amp;idx=1&amp;sn=49627c638ff9c04418282c53518aa7c7&amp;scene=21#wechat_redirect" data-linktype="2">09.单细胞转录组数据处理之细胞亚群比例比较</a></section></li></ul><p data-tool="mdnice编辑器">因为前面的例子：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247497956&amp;idx=1&amp;sn=5d4deb7cf7b7848b3e2273cbd663bb6a&amp;scene=21#wechat_redirect" data-linktype="2">人人都能学会的单细胞聚类分群注释</a> ，是很早期的笔记，那个时候还没有采用harmony这样的节省时间的多个单细胞样品整合的算法。第一次默认分群和简单的可视化基因如下所示：</p><p><img data-galleryid="" data-ratio="0.3953313253012048" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwxjstYatbEmOKuEvmeibicc4sq0kHxg9jnibTURJJic21FbYzhl5vM1B9icMiaAbXsXJYYxZKHo04P57icw/640?wx_fmt=png" data-type="png" data-w="2656" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwxjstYatbEmOKuEvmeibicc4sq0kHxg9jnibTURJJic21FbYzhl5vM1B9icMiaAbXsXJYYxZKHo04P57icw/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>简单的可视化基因</figcaption></figure><p data-tool="mdnice编辑器">因为我这个是标准流程，所以主要是第一层次降维聚类分群，区分上皮细胞，免疫细胞，间质细胞即可。就是：</p><ul data-tool="mdnice编辑器"><li><section>immune (CD45+,PTPRC),</section></li><li><section>epithelial/cancer (EpCAM+,EPCAM),</section></li><li><section>stromal (CD10+,MME,fibo or CD31+,PECAM1,endo)</section></li></ul><p data-tool="mdnice编辑器">参考我前面介绍过 <a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247488940&amp;idx=1&amp;sn=1cc8a8a74715087939b9721c0881775d&amp;scene=21#wechat_redirect" data-linktype="2">CNS图表复现08—肿瘤单细胞数据第一次分群通用规则</a>，这3大单细胞亚群构成了肿瘤免疫微环境的复杂。绝大部分文章都是抓住免疫细胞亚群进行细分，包括淋巴系（T,B,NK细胞）和髓系（单核，树突，巨噬，粒细胞）的两大类作为第二次细分亚群。但是也有不少文章是抓住stromal 里面的fibo 和endo进行细分，并且编造生物学故事的。</p><p data-tool="mdnice编辑器">大家可以自己去读文章， 复制粘贴里面的单细胞分群规则以及对应的基因。我们直接看看默认命名后的结果：</p><p><img data-galleryid="" data-ratio="0.7190900098911969" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwxjstYatbEmOKuEvmeibicc4lgARpqQgyHxuaDZ3QfTrBBvvnJYDYFwicbkTwicKAx1dnOeZ6oeWzichQ/640?wx_fmt=png" data-type="png" data-w="2022" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwxjstYatbEmOKuEvmeibicc4lgARpqQgyHxuaDZ3QfTrBBvvnJYDYFwicbkTwicKAx1dnOeZ6oeWzichQ/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">我自己觉得，我们复现后的降维聚类分群结果，理论上比文章的好看一点，这就是我先表达的结论：umap的单细胞可视化效果比tSNE好</p><p data-tool="mdnice编辑器">不知道你是否认同呢？</p><h3 data-tool="mdnice编辑器"><span></span>学徒作业<span></span></h3><p data-tool="mdnice编辑器">从我们上面的简单的降维聚类分群来块，我们所命名的成纤维和内皮其实仍然是异质性比较大的群，比如上面的成纤维里面肯定是有周细胞和平滑肌细胞，需要细分。另外内皮细胞也是有很多，要是区分成为了淋巴内皮和血管内皮， 其中血管可以细分为动脉静脉和毛细血管：</p><ul data-tool="mdnice编辑器"><li><section>lymphatic ECs (LECs; <em>CCL21, PROX1</em>).</section></li><li><section>arteries (<em>HEY1, IGFBP3</em>), capillaries (<em>CD36, CA4</em>), veins (<em>ACKR1</em>)</section></li></ul><p data-tool="mdnice编辑器">而且这个内皮细胞里面的还混入了周细胞，特别麻烦，有可能是双细胞也有可能是全新的有功能的真实单细胞亚群。</p><p data-tool="mdnice编辑器">作业就是，提取上面的成纤维和内皮单细胞亚群后进行亚群细分，继续划分子集，并且尝试命名或者给出生物学意义。</p></section><h4 data-tool="mdnice编辑器"><span>文末友情宣传</span></h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519083&amp;idx=1&amp;sn=61f07b390469617ca2e9924f5b3929ab&amp;scene=21#wechat_redirect" data-linktype="2">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li></ul><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/k6iQgkL67BYmQBPdWBCPIA",target="_blank" rel="noopener noreferrer">原文链接</a>
