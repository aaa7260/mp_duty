---
title: "两次单细胞差异分析后的结果进行相关性散点图绘制"
date: 2023-09-12T09:58:47Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
两次单细胞差异分析后的结果进行相关性散点图绘制 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>前些天学徒在单细胞数据分析交流会议上面分享了2021发表在 Cell Reports 杂志的文章：《TREM2-independent oligodendrocyte, astrocyte, and T cell responses to tau and amyloid pathology in mouse models of Alzheimer disease》，提到了如何对两次单细胞差异分析后的结果进行相关性散点图绘制，如下所示：</p></blockquote><p><img data-galleryid="" data-ratio="1.0059171597633136" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTQv17VwBOeia82hy7GuXcNg3t9Ktka9fA5cERMu6pbP47pRfnHLupMaTAaj7KWIz2P4r2ohibWHiabQ/640?wx_fmt=png" data-type="png" data-w="676" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTQv17VwBOeia82hy7GuXcNg3t9Ktka9fA5cERMu6pbP47pRfnHLupMaTAaj7KWIz2P4r2ohibWHiabQ/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>相关性散点图绘制</figcaption></figure><p data-tool="mdnice编辑器">图例也写的很清楚：</p><ul data-tool="mdnice编辑器"><li><section>Scatterplot comparing microglia gene expression fold changes from PS2APP versus nonTg analysis (x axis) against fold changes from TauPS2APP versus nonTg analysis (y axis).</section></li><li><section>Only genes called as DEGs (FDR &lt; 0.05, fold change &gt;2 or &lt; 2) for either comparison are shown.</section></li></ul><p data-tool="mdnice编辑器">也就是说，它并不是拿两次差异分析各自统计学显著的基因的交集去绘图，而是把在两次差异分析至少有一次是统计学显著的基因拿过去。（说起来一样的绕口，让我们看看后面的代码）</p><p data-tool="mdnice编辑器">我们这里仍然是以为pbmc3k例子：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(SeuratData) <span>#加载seurat数据集  </span><br>getOption(<span>'timeout'</span>)<br>options(timeout=<span>10000</span>)<br><span>#InstallData("pbmc3k")  </span><br>data(<span>"pbmc3k"</span>)  <br>sce &lt;- pbmc3k.final  <br><span>library</span>(Seurat)<br>table(Idents(sce))<br></code></pre><p data-tool="mdnice编辑器">可以看到这个数据集被注释成为了9个单细胞亚群：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; as.data.frame(table(Idents(sce)))<br>          Var1 Freq<br>1  Naive CD4 T  697<br>2 Memory CD4 T  483<br>3   CD14+ Mono  480<br>4            B  344<br>5        CD8 T  271<br>6 FCGR3A+ Mono  162<br>7           NK  155<br>8           DC   32<br>9     Platelet   14<br></code></pre><p data-tool="mdnice编辑器">我们可以看看   CD14+ Mono 和 FCGR3A+ Mono   这两个单核细胞亚群，各自跟B细胞的差异基因，是否有比较好的相关性。</p><h3 data-tool="mdnice编辑器"><span></span>首先做两次单细胞差异分析：<span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>CD14_deg = FindMarkers(sce,ident.1 = <span>'CD14+ Mono'</span>,<br>                  ident.2 = <span>'B'</span>)<br>head(CD14_deg[order(CD14_deg$p_val),])<br>FCGR3A_deg = FindMarkers(sce,ident.1 = <span>'FCGR3A+ Mono'</span>,<br>                       ident.2 = <span>'B'</span>)<br>head(FCGR3A_deg[order(FCGR3A_deg$p_val),])<br></code></pre><p data-tool="mdnice编辑器">如果这个时候，我们拿两次差异分析各自统计学显著的基因的交集去绘图，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>ids=intersect(rownames(CD14_deg),<br>              rownames(FCGR3A_deg))<br>df= data.frame(<br>  FCGR3A_deg = FCGR3A_deg[ids,<span>'avg_log2FC'</span>],<br>  CD14_deg = CD14_deg[ids,<span>'avg_log2FC'</span>]<br>)<br><span>library</span>(ggpubr)<br>ggscatter(df, x = <span>"FCGR3A_deg"</span>, y = <span>"CD14_deg"</span>,<br>          color = <span>"black"</span>, shape = <span>21</span>, size = <span>3</span>, <span># Points color, shape and size</span><br>          add = <span>"reg.line"</span>,  <span># Add regressin line</span><br>          add.params = list(color = <span>"blue"</span>, fill = <span>"lightgray"</span>), <span># Customize reg. line</span><br>          conf.int = <span>TRUE</span>, <span># Add confidence interval</span><br>          cor.coef = <span>TRUE</span>, <span># Add correlation coefficient. see ?stat_cor</span><br>          cor.coeff.args = list(method = <span>"pearson"</span>,  label.sep = <span>"\n"</span>)<br>)<br><br></code></pre><p data-tool="mdnice编辑器">可以看到相关性，非常：</p><p><img data-galleryid="" data-ratio="0.6464019851116626" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTQv17VwBOeia82hy7GuXcNgTUA5ZXMrxlgjLJRb3y2fJGhh628AF0pCpenYfibkzbAQ8AGiaiaC2Pn3A/640?wx_fmt=png" data-type="png" data-w="1612" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTQv17VwBOeia82hy7GuXcNgTUA5ZXMrxlgjLJRb3y2fJGhh628AF0pCpenYfibkzbAQ8AGiaiaC2Pn3A/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>两次差异分析各自统计学显著的基因的交集去绘图</figcaption></figure><p data-tool="mdnice编辑器">不过，作者是把在两次差异分析至少有一次是统计学显著的基因拿过去绘图，英文的描述是Only genes called as DEGs (FDR &lt; 0.05, fold change &gt;2 or &lt; 2) for either comparison are shown.</p><p data-tool="mdnice编辑器">所以前面的 FindMarkers 函数需要调整参数哦，首先是推荐    logfc.threshold = 0,以及 min.pct = 0 ，这样返回全部的基因的差异分析结果。修改好 的代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>CD14_deg = FindMarkers(sce,ident.1 = <span>'CD14+ Mono'</span>,<br>                  ident.2 = <span>'B'</span>,<br>                  logfc.threshold = <span>0</span>,<br>                  min.pct = <span>0</span><br>                  )<br>head(CD14_deg[order(CD14_deg$p_val),])<br>FCGR3A_deg = FindMarkers(sce,ident.1 = <span>'FCGR3A+ Mono'</span>,<br>                       ident.2 = <span>'B'</span>,<br>                       logfc.threshold = <span>0</span>,<br>                       min.pct = <span>0</span>)<br>head(FCGR3A_deg[order(FCGR3A_deg$p_val),])<br><br><br>ids=c(rownames(CD14_deg[abs(CD14_deg$avg_log2FC)&gt;<span>2</span>,]),<br>              rownames(FCGR3A_deg[abs(FCGR3A_deg$avg_log2FC)&gt;<span>2</span>,]))<br>ids<br>df= data.frame(<br>  FCGR3A_deg = FCGR3A_deg[ids,<span>'avg_log2FC'</span>],<br>  CD14_deg = CD14_deg[ids,<span>'avg_log2FC'</span>]<br>)<br><span>library</span>(ggpubr)<br>ggscatter(df, x = <span>"FCGR3A_deg"</span>, y = <span>"CD14_deg"</span>,<br>          color = <span>"black"</span>, shape = <span>21</span>, size = <span>3</span>, <span># Points color, shape and size</span><br>          add = <span>"reg.line"</span>,  <span># Add regressin line</span><br>          add.params = list(color = <span>"blue"</span>, fill = <span>"lightgray"</span>), <span># Customize reg. line</span><br>          conf.int = <span>TRUE</span>, <span># Add confidence interval</span><br>          cor.coef = <span>TRUE</span>, <span># Add correlation coefficient. see ?stat_cor</span><br>          cor.coeff.args = list(method = <span>"pearson"</span>,  label.sep = <span>"\n"</span>)<br>)<br></code></pre><p data-tool="mdnice编辑器">出图如下所示;</p><p><img data-galleryid="" data-ratio="0.6469864698646987" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTQv17VwBOeia82hy7GuXcNgFP7FibB4bYWwMxKRms95Xq4QicqPV0J9T95oJ5t8H46rY52NXehF048A/640?wx_fmt=png" data-type="png" data-w="1626" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTQv17VwBOeia82hy7GuXcNgFP7FibB4bYWwMxKRms95Xq4QicqPV0J9T95oJ5t8H46rY52NXehF048A/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">这个时候，会出现一下基因在两个差异分析结果里面出现冲突了，并不是在两次差异里面都统计学显著。</p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">如果你对单细胞数据分析还没有基础认知，可以看基础10讲：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486076&amp;idx=1&amp;sn=52bb851d7dc23461233a2cf458736151&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">01. 上游分析流程</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486082&amp;idx=1&amp;sn=03cadceffb2c14ba95d97fe5caf38d94&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">02.课题多少个样品，测序数据量如何</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486088&amp;idx=1&amp;sn=3a115338ee4937d20caab78627237553&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">03. 过滤不合格细胞和基因（数据质控很重要）</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486096&amp;idx=1&amp;sn=1a99c4c5800b7e0287db3e8ef369fab8&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">04. 过滤线粒体核糖体基因</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486098&amp;idx=1&amp;sn=bf9a71df848d74fe665ce7d5e283d5ff&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">05. 去除细胞效应和基因效应</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486260&amp;idx=1&amp;sn=c6abf658de73594d1d77d8e1ffa7d153&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">06.单细胞转录组数据的降维聚类分群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486271&amp;idx=1&amp;sn=638b434b6deee63206af1c0eeda175ab&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">07.单细胞转录组数据处理之细胞亚群注释</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486278&amp;idx=1&amp;sn=91250ef733833ff00371818b215dc124&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">08.把拿到的亚群进行更细致的分群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486287&amp;idx=1&amp;sn=49627c638ff9c04418282c53518aa7c7&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">09.单细胞转录组数据处理之细胞亚群比例比较</a></section></li></ul></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">最基础的往往是降维聚类分群，参考前面的例子：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247497956&amp;idx=1&amp;sn=5d4deb7cf7b7848b3e2273cbd663bb6a&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">人人都能学会的单细胞聚类分群注释</a></p></section><section data-style-type="5" data-tools="新媒体排版" data-id="2440476"><section><section><section><section><img data-ratio="0.9495798319327731" data-type="gif" data-w="119" data-width="100%" data-src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif"></section><section data-brushtype="text">往期回顾</section><section><br></section></section></section></section><section><section data-autoskip="1"><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247500736&amp;idx=1&amp;sn=8bb9379c755cef7ff0db0e832c583a26&amp;chksm=ea1cc542dd6b4c540f89eb4cdb91b423599d058a4bb14f448a97bf8a3f85dd2583c835fe4ece&amp;scene=21#wechat_redirect" textvalue="MACA: 一款自动注释细胞类型的工具" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">MACA: 一款自动注释细胞类型的工具</a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247500719&amp;idx=1&amp;sn=f5f191e2f0dad1e9398fbb0f1ce7c4b8&amp;chksm=ea1cc52ddd6b4c3b2199f746ce0316d568831dea12ecfb23ce1fd0116040818f10847e2362ca&amp;scene=21#wechat_redirect" textvalue="肺癌四阶段：AAH-AIS-MIA-IA的单细胞图谱" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">肺癌四阶段：AAH-AIS-MIA-IA的单细胞图谱</a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247500691&amp;idx=1&amp;sn=982f64aa971ad25fc8234929baa8f52d&amp;chksm=ea1cc511dd6b4c077cfef98c29efa6bf67f5519d2a58daeece5cff57d1ff08f9e8b99b711927&amp;scene=21#wechat_redirect" textvalue="iSEE：单细胞数据可视化辅助网页工具" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">iSEE：单细胞数据可视化辅助网页工具</a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247500608&amp;idx=1&amp;sn=1b5e3c0404e186efba412cd531ed6acf&amp;chksm=ea1cc5c2dd6b4cd49b89b2adb3b990f13ef2790aaaf4e47b765a5e2cfab7cf03cce6704bc9d5&amp;scene=21#wechat_redirect" textvalue="你认为是双细胞人家说是全新细胞亚群" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">你认为是双细胞人家说是全新细胞亚群</a><br></p></section></section><hr><p><br></p></section><section data-style-type="5" data-tools="新媒体排版" data-id="2440475"><hr><p><br></p><hr><section><p>如果你对单细胞转录组研究感兴趣，但又不知道如何入门，也许你可以关注一下下面的课程<span></span></p><p><br></p><ul><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247500595&amp;idx=1&amp;sn=0d453625cec576b0cdafd2ec43e61ed3&amp;chksm=ea1cc5b1dd6b4ca78f1a24173059e43c4c3b46396463a61d52ca613e74d2fe8f74e60d69194a&amp;scene=21#wechat_redirect" textvalue="生信入门课-2021第11期（年度收官）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">生信入门课-2021第11期（年度收官）</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247500595&amp;idx=2&amp;sn=835469b6b33f3b9c2914849433320c2d&amp;chksm=ea1cc5b1dd6b4ca7fd14ca9d979f43b0ac8007ee107054d2038c51454fe5fe853129ccdc0f3c&amp;scene=21#wechat_redirect" textvalue="数据挖掘（GEO,TCGA,单细胞）2021第11期（年度收官）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2" wah-hotarea="click" hasload="1">数据挖掘（GEO,TCGA,单细胞）2021第11期（年度收官）</a><br></p></li></ul><p><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif" data-type="gif" data-w="240" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif"><br></p><p><img data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg" data-type="jpeg" data-w="341" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p></section><section><section data-id="93668"><section><section data-width="95%"><section><section><section data-width="38%"><section><section data-tools="135编辑器" data-id="93668"><section><section data-width="95%"><section><section><section data-width="61.8%"><section><section><section><p><br></p><span><strong data-burshtype="text"><img data-copyright="0" data-cropselx1="0" data-cropselx2="109" data-cropsely1="0" data-cropsely2="109" data-ratio="1" data-type="jpeg" data-w="430" title="qrcode_for_gh_5a3c482ed99f_1280.jpg" data-src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg"><strong data-burshtype="text">生物</strong><strong data-burshtype="text"> | 单细胞 | 转录组丨资料</strong></strong></span></section><section><span><strong data-burshtype="text">每天都精彩</strong></span></section></section></section><section><section><section><section><section><section><p><span>长按扫码可关注</span></p></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section><p><br></p><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/76hSRtF7m3V9AXonrCNc8w",target="_blank" rel="noopener noreferrer">原文链接</a>
