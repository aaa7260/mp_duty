---
title: "GEO数据下载方式总结"
date: 2023-09-13T02:28:21Z
draft: ["false"]
tags: [
  "fetched",
  "生信小知识"
]
categories: ["Acdemic"]
---
GEO数据下载方式总结 by 生信小知识
------
<div><section><h2><span>GEO数据下载方式总结</span></h2><blockquote><p>微信公众号：<strong>生信小知识</strong><br>关注可了解更多的生物信息学教程及知识。问题或建议，请公众号留言;</p></blockquote><h3><span>目录</span></h3><p><span><span>前言</span></span><span><span>1. SRA浏览器下载fastq格式文件</span></span><span><span><span>1.1 aria2下载</span></span></span><span><span><span>1.2 ascp下载</span></span></span><span><span><span>1.3 系统自带下载工具下载——wget/curl</span></span></span><span><span>2. 下载sra格式文件</span></span><span><span><span>2.1 SRR编号的获取</span></span></span><span><span><span>2.2 SRA数据下载</span></span></span><span><span><span>2.3 SRA文件转fastq文件 (fastq-dump)</span></span></span><span><span><span>2.4 SRA文件转fastq文件 (fasterq-dump)</span></span></span><span><span>后记</span></span></p><h3><span>前言</span></h3><p>近来下载一个WGBS的GEO数据，本是个非常简单的事情，但是在下载过程中却遇到了一些问题，这里简单整理下关于下载GEO数据的方法，以供自己后续使用。</p><p>大家知道WGBS的数据非常的大，这可能是导致我下载失败的主要原因吧我猜？</p><p>我之所以会发现下载的数据有问题，第一次是因为使用FastqQC检测数据质量时出现了报错，提示Fastq文件格式错误：</p><p><img data-galleryid="" data-ratio="0.12962962962962962" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/fOo3cmIWvJqibEFSAw7I518TprfCkhRMnEatgmPQTyJrn8dbl8NeHiaFbXfuAI5DDaClklZaWBAbzAO6aLkXH8lQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/fOo3cmIWvJqibEFSAw7I518TprfCkhRMnEatgmPQTyJrn8dbl8NeHiaFbXfuAI5DDaClklZaWBAbzAO6aLkXH8lQ/640?wx_fmt=png"></p><p>而后根据提示找到对应的行数，发现的确文件格式出错了。</p><p><img data-galleryid="" data-ratio="0.2962962962962963" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/fOo3cmIWvJqibEFSAw7I518TprfCkhRMnibVVnY4fVrQqDBicFHqDCSMUhG0icBA1AakzYVr90lUv6GS78dI6CDm3w/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/fOo3cmIWvJqibEFSAw7I518TprfCkhRMnibVVnY4fVrQqDBicFHqDCSMUhG0icBA1AakzYVr90lUv6GS78dI6CDm3w/640?wx_fmt=png"></p><p>这就提示我数据在下载过程中可能出错了。</p><p>为了保证数据下载合格，我选择对每个数据下载2次，并比较2个重复之间的MD5值，如果2次下载的MD5都是一致的，那我便可以认为数据下载是完整的。</p><p>结果相同数据我下载了多次，每次的MD5都不一样。</p><p>这就尴尬了，于是我更换了不同的下载方式。这里就简单记录下不同下载方式的脚本。</p><h3><span>1. SRA浏览器下载fastq格式文件</span></h3><p>这一般是我首选的方法，因为其下载的文件直接就是fastq格式，无需额外转换格式。</p><p>具体地址：https://sra-explorer.info/</p><h4><span>1.1 aria2下载</span></h4><p>在SRA浏览器中，我们可以找到具体下载文件的下载地址，我一般会选择使用aria2工具进行下载，因为其具备一定的优势，例如断点续传、多线程下载等。</p><p>具体参考：</p><ul><li><p><a href="https://mp.weixin.qq.com/s?__biz=MjM5NTk0Mzg2Nw==&amp;mid=2247487561&amp;idx=1&amp;sn=a14e7f3ad46917427c277571aaad45c7&amp;scene=21#wechat_redirect" data-linktype="2">Centos7中安装aria2</a></p></li></ul><p>具体下载格式如下：</p><pre><code><span>#!/bin/bash<br></span><br><span># output</span><br>output_dir=<span>$HOME</span>/Database/8.DNA_Methylation/2.GEO<br>output_filename=293T_WGBS.fq.gz<br>download_url=http://ftp.sra.ebi.ac.uk/vol1/fastq/SRR101/003/SRR1016003/SRR1016003.fastq.gz<br><br>aria2c -d <span>${output_dir}</span> -o <span>${output_filename}</span> <span>${download_url}</span> 1&gt;log.std 2&gt;log.err<br></code></pre><p>测试中使用该工具下载的多个数据之间MD5值不匹配</p><h4><span>1.2 ascp下载</span></h4><p><code>ascp</code> 是 <code>Aspera</code> 下的一个子命令，其也是在下载GEO数据中常常用到的。</p><p>安装时只需运行下面脚本即可：</p><pre><code><span>#!/bin/bash</span><br><span>## The URI below is not persistent!</span><br><span>## Check for latest link: https://www.ibm.com/aspera/connect/</span><br>wget -qO- https://ak-delivery04-mul.dhe.ibm.com/sar/CMA/OSA/0a07f/0/ibm-aspera-connect_4.1.0.46-linux_x86_64.tar.gz | tar xvz<br><br><span>## run it</span><br>chmod +x ibm-aspera-connect_4.1.0.46-linux_x86_64.sh<br>./ibm-aspera-connect_4.1.0.46-linux_x86_64.sh<br><br><span>## add it to the path now and in the future</span><br><span>export</span> PATH=<span>$PATH</span>:~/.aspera/connect/bin/<br><span>echo</span> <span>'export PATH=$PATH:~/.aspera/connect/bin/'</span> &gt;&gt; ~/.bash_profile<br></code></pre><p>安装完成后，我们按照下述格式即可下载数据（具体脚本直接来自SRA浏览器）：</p><pre><code><span>#!/bin/bash</span><br>openssh_key=<span>$HOME</span>/.aspera/connect/etc/asperaweb_id_dsa.openssh<br>output_dir=<span>$HOME</span>/Database/8.DNA_Methylation/2.GEO<br><br>ascp -QT -l 300m -P33001 -i <span>${openssh_key}</span> era-fasp@fasp.sra.ebi.ac.uk:vol1/fastq/SRR892/005/SRR8926885/SRR8926885_1.fastq.gz <span>${output_dir}</span><br></code></pre><p><img data-galleryid="" data-ratio="0.5518518518518518" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/fOo3cmIWvJqibEFSAw7I518TprfCkhRMnIKI0CGhesNxe8eVfr1lpUy4Kvm4TedHoplsbibUtJvzIOiaavXOm9n2Q/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/fOo3cmIWvJqibEFSAw7I518TprfCkhRMnIKI0CGhesNxe8eVfr1lpUy4Kvm4TedHoplsbibUtJvzIOiaavXOm9n2Q/640?wx_fmt=png"></p><p>有部分文件下载失败。</p><h4><span>1.3 系统自带下载工具下载——wget/curl</span></h4><p>同样我也尝试过使用系统自带的下载工具进行下载，发现同样无法完整下载，这里只是记录下下载脚本格式：</p><pre><code><span>#!/bin/bash</span><br>output_dir=<span>$HOME</span>/Database/8.DNA_Methylation/2.GEO<br>output_filename=293T_WGBS.fq.gz<br>download_url=http://ftp.sra.ebi.ac.uk/vol1/fastq/SRR101/003/SRR1016003/SRR1016003.fastq.gz<br><br><span># curl</span><br>curl -L <span>${download_url}</span> -o <span>${output_dir}</span>/<span>${output_filename}</span> 1&gt;log.std 2&gt;log.err<br><span># wget</span><br>wget -c -O <span>${output_dir}</span>/<span>${output_filename}</span> <span>${download_url}</span> 1&gt;log.std 2&gt;log.err<br></code></pre><h3><span>2. 下载sra格式文件</span></h3><p>既然下载fastq文件总是报错，那我就尝试下载最原始的文件格式——SRA格式。</p><p>下载SRA文件需要找到需要下载数据的SRR编号，即从GEO/GSM转换到SRR格式。</p><h4><span>2.1 SRR编号的获取</span></h4><p>这个的实现也有多种方法，我简单列举2个方法：</p><ol><li><p><span>SRA浏览器提取</span></p></li><li><p>pysradb工具转换：<a href="https://mp.weixin.qq.com/s?__biz=MjM5NTk0Mzg2Nw==&amp;mid=2247488753&amp;idx=1&amp;sn=90c93abbd94a9969b457fd083f4a853d&amp;scene=21#wechat_redirect" data-linktype="2">SRA，ENA，GEO数据便捷下载</a></p></li></ol><h4><span>2.2 SRA数据下载</span></h4><p>在拿到具体的SRR编号后，我们可以使用prefetch工具进行下载：</p><pre><code><span>#!/bin/bash<br></span><br>output_dir=<span>$HOME</span>/Database/8.DNA_Methylation/2.GEO/SRR8926885<br>SRR_id=SRR8926885<br><br><span># GSM3731843</span><br>prefetch --max-size 60G -O <span>${output_dir}</span> <span>${SRR_id}</span> 1&gt;SRR8926885.std 2&gt;SRR8926885.err<br></code></pre><blockquote><p>因为WGBS数据都非常大，故这里需要额外指定最大文件体积60G</p></blockquote><h4><span>2.3 SRA文件转fastq文件 (fastq-dump)</span></h4><p>下好了SRA文件后，我们需要将其转换为fastq格式：</p><pre><code><span>#!/bin/bash</span><br>sra_file=<span>$HOME</span>/Database/8.DNA_Methylation/2.GEO/SRR8926885/SRR8926885.sra<br>output_dir=<span>$HOME</span>/Database/8.DNA_Methylation/2.GEO/SRR8926885/fastq<br><br>fastq-dump --gzip --split-3 --defline-qual <span>'+'</span> --defline-seq <span>'@\$ac-\$si/\$ri'</span> -O <span>${output_dir}</span> <span>${sra_file}</span><br></code></pre><blockquote><p>From: https://www.jianshu.com/p/a8d70b66794c</p><p>默认情况下输出的文件的ID都是SRR开头,但其实原始数据名字不是这样子,比如说：</p><ul><li><p><code>@ST-E00600:143:H3LJWALXX:1:1101:5746:1016 2:N:0:CCTCCTGA</code></p></li><li><p><code>@HWI-ST620:248:HB11HADXX:2:1101:1241:2082#0/1</code></p></li></ul><p>如果你想看到原始的文件格式，而不是SRR，你需要怎么做呢？可以通过如下三个选项进行修改：</p><ul><li><p><code>F|--origfmt</code>：仅保留数据名字</p></li><li><p><code>--defline-seq<fmt></fmt></code>：定义readsID的显示方式</p></li><li><p><code>--defline-qual<fmt></fmt></code>：定义质量的显示方式</p></li></ul><p>其中fmt按照如下要求定义：</p><p><img data-galleryid="" data-ratio="0.575139146567718" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/fOo3cmIWvJqibEFSAw7I518TprfCkhRMnuJZ862B9zBFftfyNPocf92D7FbVo1srCwC5BL7N5aL9tQTlId0sjDQ/640?wx_fmt=other" data-type="png" data-w="539" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/fOo3cmIWvJqibEFSAw7I518TprfCkhRMnuJZ862B9zBFftfyNPocf92D7FbVo1srCwC5BL7N5aL9tQTlId0sjDQ/640?wx_fmt=other"></p><figure><figcaption>fmt</figcaption></figure></blockquote><h4><span>2.4 SRA文件转fastq文件 (fasterq-dump)</span></h4><p>fastq-dump只能单个线程，所以速度特别的慢。</p><p>在2018年的6月份，sra-tools更新了一个新的sra解压工具，<code>fasterq-dump, a faster fastq-dump</code>，它能利用临时文件和多线程加速从SRA文件提取FASTQ。</p><p><code>fasterq-dump</code> 的用法和 <code>fastq-dump</code> 一样，如下所示：</p><pre><code><span>#!/bin/bash</span><br>sra_file=<span>$HOME</span>/Database/8.DNA_Methylation/2.GEO/SRR8926885/SRR8926885.sra<br>output_dir=<span>$HOME</span>/Database/8.DNA_Methylation/2.GEO/SRR8926885/fastq<br><br>fasterq-dump --qual-defline <span>'+'</span> --seq-defline <span>'@\$ac-\$si/\$ri'</span> --split-3 -e 6 -O <span>${output_dir}</span> <span>${sra_file}</span><br></code></pre><blockquote><p><code>-e</code>：指定线程</p></blockquote><p><code>fasterq-dump</code> 与 <code>fastq-dump</code> 相比，不能将文件进行压缩，即无 <code>--gzip</code> 参数。但是这对于我们而言，无关痛痒，完成转换后使用 <code>pigz</code> 进行压缩即可</p><h3><span>后记</span></h3><p>目前暂时主要依赖这几种方法进行数据下载，后续有新方法再做补充</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/pKRi6de8YjdYFacGLcetrw",target="_blank" rel="noopener noreferrer">原文链接</a>
