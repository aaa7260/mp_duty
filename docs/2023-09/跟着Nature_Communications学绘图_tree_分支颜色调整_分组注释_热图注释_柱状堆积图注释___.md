---
title: "跟着Nature Communications学绘图—tree+分支颜色调整+分组注释+热图注释+柱状堆积图注释！！！"
date: 2023-09-25T09:53:50Z
draft: ["false"]
tags: [
  "fetched",
  "科研后花园"
]
categories: ["Acdemic"]
---
跟着Nature Communications学绘图—tree+分支颜色调整+分组注释+热图注释+柱状堆积图注释！！！ by 科研后花园
------
<div><section><section><section> </section><section><p>点击上方</p><p>“科研后花园”</p><p>关注我们</p></section></section></section><p><br></p><section><section><article><section><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/oMlX8Lll9Jiaea3YIKcpLeSJaaiaWVK358mlJiaS3TCG4bukuV5NGSclSxyPmuEsjYyqSglniau1UlOkpezmO4I3Hg/640" data-type="png" data-w="64" src="https://mmbiz.qpic.cn/mmbiz_gif/oMlX8Lll9Jiaea3YIKcpLeSJaaiaWVK358mlJiaS3TCG4bukuV5NGSclSxyPmuEsjYyqSglniau1UlOkpezmO4I3Hg/640"><section><section><p><strong><span>灵感来源</span></strong></p></section></section><section><section><br></section></section></section></article></section></section><section><section><section><p><img data-galleryid="" data-ratio="0.3475991649269311" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKud005Ssao9Ecrr7E1esecCVUsZ7YhiadwDKRTcQQsqaMpbiaxpnJ8YzA/640?wx_fmt=png" data-type="png" data-w="958" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKud005Ssao9Ecrr7E1esecCVUsZ7YhiadwDKRTcQQsqaMpbiaxpnJ8YzA/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.8577586206896551" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKzpicnvFxpJvBuax491VkPHpKL2bHV1RBngyRwJnOCiaKkTxUyue0sphQ/640?wx_fmt=png" data-type="png" data-w="696" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKzpicnvFxpJvBuax491VkPHpKL2bHV1RBngyRwJnOCiaKkTxUyue0sphQ/640?wx_fmt=png"></p></section></section></section><section><section><article><section><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/oMlX8Lll9Jiaea3YIKcpLeSJaaiaWVK358mlJiaS3TCG4bukuV5NGSclSxyPmuEsjYyqSglniau1UlOkpezmO4I3Hg/640" data-type="png" data-w="64" src="https://mmbiz.qpic.cn/mmbiz_gif/oMlX8Lll9Jiaea3YIKcpLeSJaaiaWVK358mlJiaS3TCG4bukuV5NGSclSxyPmuEsjYyqSglniau1UlOkpezmO4I3Hg/640"><section><section><p><strong><span>绘制代码</span></strong><br></p></section></section><section><section><br></section></section></section></article></section></section><section><section><section><img data-ratio="1.1666666666666667" data-type="png" data-src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JjB5uiaTvI787pe1FTCC0O7euXpJv05wlDqOXUs92rbU4E7N2ia33O08M4DX3Z7Yu4ppVpiaJsfdhHIQ/640?wx_fmt=png" data-w="42" src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JjB5uiaTvI787pe1FTCC0O7euXpJv05wlDqOXUs92rbU4E7N2ia33O08M4DX3Z7Yu4ppVpiaJsfdhHIQ/640?wx_fmt=png"></section><section><section><section><section><section>设置工作环境并加载R包</section></section><section><br></section></section></section><section><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span>rm(<span>list</span>=ls())<span>#clear Global Environment</span></span></code><code><span>setwd(<span>'D:/桌面/tree+分支颜色调整+分组注释+热图注释+柱状堆积图注释'</span>)<span>#设置工作路径</span></span></code><code><span><br></span></code><code><span><span>#加载包</span></span></code><code><span>library(ggtree) <span># an R package for visualization of tree and annotation data</span></span></code><code><span>library(ape) <span># Analyses of Phylogenetics and Evolution</span></span></code><code><span>library(vegan) <span># Community Ecology Package</span></span></code><code><span>library(ggtreeExtra) <span># An R Package To Add Geometric Layers On Circular Or Other Layout Tree Of "ggtree"</span></span></code><code><span>library(ggnewscale) <span># Multiple Fill and Colour Scales in 'ggplot2'</span></span></code><code><span>library(ggstar) <span># Multiple Geometric Shape Point Layer for 'ggplot2'</span></span></code></pre></section></section><section><section><section><section><img data-ratio="1.1666666666666667" data-src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JjB5uiaTvI787pe1FTCC0O7euXpJv05wlDqOXUs92rbU4E7N2ia33O08M4DX3Z7Yu4ppVpiaJsfdhHIQ/640?wx_fmt=png" data-type="png" data-w="42" src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JjB5uiaTvI787pe1FTCC0O7euXpJv05wlDqOXUs92rbU4E7N2ia33O08M4DX3Z7Yu4ppVpiaJsfdhHIQ/640?wx_fmt=png"></section><section>加载数据并构建进化树</section></section><section><br></section></section></section><section><section><ul><li><li></ul><pre data-lang="cs"><code><span><span>#读取数据</span></span></code><code><span>OTU &lt;- read.table(<span>"OTU.txt"</span>,check.names = F, row.names = <span>1</span>, header = <span>1</span>, sep = <span>"\t"</span>)</span></code></pre></section><p><img data-galleryid="" data-ratio="0.5949519230769231" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKJNns0ppAxvb4dmTkvpu9nTdmsNLzPAm1Su8KjoVmomCXu8qkbnI02g/640?wx_fmt=png" data-type="png" data-w="832" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKJNns0ppAxvb4dmTkvpu9nTdmsNLzPAm1Su8KjoVmomCXu8qkbnI02g/640?wx_fmt=png"></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="cs"><code><span><span>#计算距离矩阵</span></span></code><code><span>df_dist &lt;- vegdist(t(OTU),method = <span>'bray'</span>)<span>#使用bray curtis方法计算距离矩阵</span></span></code><code><span><span>####进行层次聚类,可选择方法有single、complete、median、mcquitty、average 、centroid 、ward </span></span></code><code><span>df_hc &lt;- hclust(df_dist,method=<span>"average"</span>)<span>#使用类平均法进行聚类</span></span></code><code><span><br></span></code><code><span><span># 将聚类结果转成系统发育格式</span></span></code><code><span>df_tree &lt;- <span>as</span>.phylo(df_hc)</span></code><code><span><span># 对树分组</span></span></code><code><span>sample &lt;- list(A=c(<span>"A_1"</span>,<span>"A_2"</span>,<span>"A_3"</span>,<span>"A_4"</span>,<span>"A_5"</span>,<span>"A_6"</span>,<span>"A_7"</span>,<span>"A_8"</span>),</span></code><code><span>            B=c(<span>"B_1"</span>,<span>"B_2"</span>,<span>"B_3"</span>,<span>"B_4"</span>,<span>"B_5"</span>,<span>"B_6"</span>,<span>"B_7"</span>,<span>"B_8"</span>),</span></code><code><span>            C=c(<span>"C_1"</span>,<span>"C_2"</span>,<span>"C_3"</span>,<span>"C_4"</span>,<span>"C_5"</span>,<span>"C_6"</span>,<span>"C_7"</span>,<span>"C_8"</span>),</span></code><code><span>            D=c(<span>"D_1"</span>,<span>"D_2"</span>,<span>"D_3"</span>,<span>"D_4"</span>,<span>"D_5"</span>,<span>"D_6"</span>,<span>"D_7"</span>,<span>"D_8"</span>),</span></code><code><span>            E=c(<span>"E_1"</span>,<span>"E_2"</span>,<span>"E_3"</span>,<span>"E_4"</span>,<span>"E_5"</span>,<span>"E_6"</span>,<span>"E_7"</span>,<span>"E_8"</span>),</span></code><code><span>            F=c(<span>"F_1"</span>,<span>"F_2"</span>,<span>"F_3"</span>,<span>"F_4"</span>,<span>"F_5"</span>,<span>"F_6"</span>,<span>"F_7"</span>,<span>"F_8"</span>),</span></code><code><span>            G=c(<span>"G_1"</span>,<span>"G_2"</span>,<span>"G_3"</span>,<span>"G_4"</span>,<span>"G_5"</span>,<span>"G_6"</span>,<span>"G_7"</span>,<span>"G_8"</span>))</span></code><code><span><span># 将分组信息和进化树组合到一起</span></span></code><code><span>tree&lt;-groupOTU(df_tree,sample)</span></code><code><span><br></span></code><code><span><span># ggtree初步展示</span></span></code><code><span>ggtree(tree,size=<span>0.8</span>, layout=<span>"circular"</span>, </span></code><code><span>             ladderize=FALSE, branch.length=<span>"none"</span>, aes(col=<span>group</span>),show.legend = F)+</span></code><code><span>  geom_tiplab(aes(color=<span>group</span>),size=<span>4</span>,align = F,</span></code><code><span>              offset = <span>0.001</span>,show.legend = F)</span></code></pre></section><p><img data-galleryid="" data-ratio="1.0477815699658704" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKhdiaz1Nia0XjIq9PKEqwxs5ngkB0Kkvzg4Cb2Rz55bxVXbGdiagr64ia5A/640?wx_fmt=png" data-type="png" data-w="586" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKhdiaz1Nia0XjIq9PKEqwxs5ngkB0Kkvzg4Cb2Rz55bxVXbGdiagr64ia5A/640?wx_fmt=png"></p></section><section><section><section><section><img data-ratio="1.1666666666666667" data-src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JjB5uiaTvI787pe1FTCC0O7euXpJv05wlDqOXUs92rbU4E7N2ia33O08M4DX3Z7Yu4ppVpiaJsfdhHIQ/640?wx_fmt=png" data-type="png" data-w="42" src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JjB5uiaTvI787pe1FTCC0O7euXpJv05wlDqOXUs92rbU4E7N2ia33O08M4DX3Z7Yu4ppVpiaJsfdhHIQ/640?wx_fmt=png"></section><section>整理注释所需数据</section></section><section><br></section></section></section><section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="powershell"><code><span><span>##读取分组注释信息</span></span></code><code><span>group &lt;- read.table(<span>"sample.txt"</span>,check.names = F, row.names = <span>1</span>, header = <span>1</span>, sep = <span>"\t"</span>)</span></code><code><span>group<span>$sample</span> &lt;- rownames(group)</span></code><code><span><br></span></code><code><span><span>##计算各样本的物种丰度信息</span></span></code><code><span><span>#读取分类信息</span></span></code><code><span>tax &lt;- read.table(<span>"tax.txt"</span>,check.names = F, header = <span>1</span>, sep = <span>"\t"</span>)</span></code><code><span><span>#根据OTUID合并OTU数据和分类信息</span></span></code><code><span>OTU2 &lt;- OTU</span></code><code><span>OTU2<span>$OTU_id</span> &lt;- rownames(OTU2)</span></code><code><span>df &lt;- merge(tax,OTU2,by=<span>"OTU_id"</span>)</span></code><code><span><span>#提取属水平的信息</span></span></code><code><span>data_Genus &lt;- df[,c(<span>7</span>,<span>9</span>:<span>64</span>)]</span></code><code><span><span>##利用循环处理具有重复的数据</span></span></code><code><span><span>#初始化</span></span></code><code><span><span>data</span>&lt;-aggregate(A_1 ~ Genus,<span>data</span>=data_Genus,sum)</span></code><code><span><span>#重命名</span></span></code><code><span>colnames(<span>data</span>)[<span>2</span>]&lt;-<span>"example"</span></span></code><code><span><span>for</span> (i <span>in</span> colnames(data_Genus)[<span>2</span>:length(colnames(data_Genus))]){</span></code><code><span>  <span>#计算每列的和</span></span></code><code><span>  <span>data</span>1&lt;-aggregate(data_Genus[,i]~Genus,<span>data</span>=data_Genus,sum)</span></code><code><span>  colnames(<span>data</span>1)[<span>2</span>]&lt;-i  </span></code><code><span>  <span>#合并列</span></span></code><code><span>  <span>data</span>&lt;-merge(<span>data</span>,<span>data</span>1,by=<span>"Genus"</span>)</span></code><code><span>}</span></code><code><span>df2&lt;-data[,-<span>2</span>]</span></code><code><span>rownames(df2)=df2<span>$Genus</span><span>#修改行名</span></span></code><code><span>df3=df2[,-<span>1</span>]<span>#删除多的列</span></span></code><code><span><br></span></code><code><span><span>#计算物种总丰度并降序排列</span></span></code><code><span>df3<span>$rowsum</span> &lt;- apply(df3,<span>1</span>,sum)</span></code><code><span>df4 &lt;- df3[order (df3<span>$rowsum</span>,decreasing=TRUE),]</span></code><code><span>df5 = df4[,-<span>57</span>]<span>#删除求和列</span></span></code><code><span><span>#求物种相对丰度</span></span></code><code><span>df6 &lt;- apply(df5,<span>2</span>,<span>function</span>(x) x/sum(x))</span></code><code><span><span>#由于之间已经按照每行的和进行过升序排列，所以可以直接取前10行</span></span></code><code><span>df7 &lt;-  df6[<span>1</span>:<span>10</span>,]</span></code><code><span>df8 &lt;- <span>1</span>-apply(df7, <span>2</span>, sum) <span>#计算剩下物种的总丰度</span></span></code><code><span><span>#合并数据</span></span></code><code><span>df9 &lt;- rbind(df7,df8)</span></code><code><span>row.names(df9)[<span>11</span>]=<span>"Others"</span></span></code><code><span>df9 &lt;- as.data.frame(df9)</span></code><code><span>df10 &lt;- as.data.frame(t(df9))</span></code><code><span>df10<span>$sample</span> &lt;- rownames(df10)</span></code><code><span><br></span></code><code><span><span>##根据样本名称合并分组与丰度信息</span></span></code><code><span>group &lt;- merge(group,df10,by=<span>"sample"</span>)</span></code><code><span><br></span></code><code><span><span>##第二层注释的数据</span></span></code><code><span><span>data</span>2 &lt;- group[,c(<span>1</span>,<span>4</span>:<span>11</span>)]</span></code><code><span><span>data</span>2 &lt;- melt(<span>data</span>2)</span></code><code><span><span>data</span>2$`Diet (detailed)` &lt;- as.character(<span>data</span>2<span>$variable</span>)</span></code><code><span><span>data</span>2<span>$value</span> &lt;- as.character(<span>data</span>2<span>$value</span>)</span></code><code><span><br></span></code><code><span><span>##第六层注释的数据</span></span></code><code><span><span>data</span>6 &lt;- group[,c(<span>1</span>,<span>15</span>:<span>25</span>)]</span></code><code><span><span>data</span>6 &lt;- melt(<span>data</span>6)</span></code></pre></section><p><span><strong>group</strong></span></p><p><img data-galleryid="" data-ratio="0.4064814814814815" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKicVbpCQ9Bia818Kv1l4Mvd1mMgemP5GicZtcXWqFTwyVw7KjddftiaKAPQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKicVbpCQ9Bia818Kv1l4Mvd1mMgemP5GicZtcXWqFTwyVw7KjddftiaKAPQ/640?wx_fmt=png"></p><p><strong>data2</strong></p><p><img data-galleryid="" data-ratio="1.3774193548387097" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKVGdRzbibpNLp9sDmSf12GMx3SPZTyOcrfmEPo7Kwasia1UW6bfB4ibiaiaQ/640?wx_fmt=png" data-type="png" data-w="310" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKVGdRzbibpNLp9sDmSf12GMx3SPZTyOcrfmEPo7Kwasia1UW6bfB4ibiaiaQ/640?wx_fmt=png"></p><p><strong></strong></p><p><strong>data6</strong></p><p><img data-galleryid="" data-ratio="1.7966804979253113" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKzFc9nXb0PwY05721wgRUJ46N7fSXvlRMA6DHSJH8CY8IzRCuMAn1ew/640?wx_fmt=png" data-type="png" data-w="241" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKzFc9nXb0PwY05721wgRUJ46N7fSXvlRMA6DHSJH8CY8IzRCuMAn1ew/640?wx_fmt=png"></p><section><section><section><section><img data-ratio="1.1666666666666667" data-src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JjB5uiaTvI787pe1FTCC0O7euXpJv05wlDqOXUs92rbU4E7N2ia33O08M4DX3Z7Yu4ppVpiaJsfdhHIQ/640?wx_fmt=png" data-type="png" data-w="42" src="https://mmbiz.qpic.cn/mmbiz_png/oMlX8Lll9JjB5uiaTvI787pe1FTCC0O7euXpJv05wlDqOXUs92rbU4E7N2ia33O08M4DX3Z7Yu4ppVpiaJsfdhHIQ/640?wx_fmt=png"></section><section>绘制进化树并逐层添加注释信息</section></section><section><br></section></section></section><section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="sql"><code><span><span>###为进化树添加注释信息</span></span></code><code><span>ggtree(tree,size=0.8, layout="circular", </span></code><code><span>       ladderize=FALSE, branch.length="none", aes(col=group),show.legend = F)+<span>#图形主体</span></span></code><code><span>  geom_tiplab(aes(color=<span>group</span>),<span>size</span>=<span>3</span>,align = F,</span></code><code><span>              <span>offset</span> = <span>0.001</span>,show.legend = F)+<span>#分支标签</span></span></code><code><span>  scale_color_manual(</span></code><code><span>    <span>values</span>=c(<span>"black"</span>, <span>"#0ebeff"</span>, <span>"#47cf73"</span>,<span>"#ae63e4"</span>,</span></code><code><span>             <span>"#fcd000"</span>,<span>"#ff3c41"</span>,<span>"#b62b6e"</span>,<span>"#00b7c9"</span>))+<span>#自定义分支颜色</span></span></code><code><span>  <span>#第一层注释_Diet</span></span></code><code><span>  new_scale_fill() + </span></code><code><span>  geom_fruit(</span></code><code><span>    <span>data</span>=<span>group</span>,</span></code><code><span>    geom=geom_tile,</span></code><code><span>    <span>mapping</span>=aes(y=<span>sample</span>, fill=Diet),</span></code><code><span>    width = <span>0.4</span>,<span>#注释的宽度</span></span></code><code><span>    <span>offset</span>=<span>0.3</span> <span>#位置</span></span></code><code><span>  )+</span></code><code><span>  scale_fill_manual(</span></code><code><span>    <span>values</span>=c(<span>"#00ff01"</span>, <span>"#fecc32"</span>, <span>"#ff0100"</span>),</span></code><code><span>    guide=guide_legend(keywidth=<span>1</span>, keyheight=<span>1</span>, <span>order</span>=<span>1</span>))+</span></code><code><span>  <span>#第二层注释_Diet (detailed)</span></span></code><code><span>  new_scale_fill() +</span></code><code><span>  geom_fruit(</span></code><code><span>    <span>data</span>=data2,</span></code><code><span>    geom=geom_tile,</span></code><code><span>    <span>mapping</span>=aes(y=<span>sample</span>, x=<span>`Diet (detailed)`</span>, fill=<span>value</span>),</span></code><code><span>    color=<span>"grey80"</span>,</span></code><code><span>    pwidth=<span>0.8</span>,</span></code><code><span>    <span>offset</span>=<span>0.05</span>, <span>#位置</span></span></code><code><span>    axis.params=<span>list</span>(</span></code><code><span>      axis=<span>"x"</span>, <span># 添加图层的轴文本</span></span></code><code><span>      text.angle=<span>0</span>, <span>#x 轴的文本角度</span></span></code><code><span>      hjust=<span>0.5</span>,  <span># 调整文字轴的水平位置</span></span></code><code><span>      text.size = <span>4</span>,<span>#文字大小</span></span></code><code><span>      line.alpha = <span>0</span></span></code><code><span>    )</span></code><code><span>  )+</span></code><code><span>  scale_fill_manual(</span></code><code><span>    <span>values</span>=c(<span>"#000000"</span>, <span>"#a95401"</span>, <span>"#ff8000"</span>,<span>"#ffff00"</span>),</span></code><code><span>    guide=guide_legend(keywidth=<span>1</span>, keyheight=<span>1</span>, <span>order</span>=<span>2</span>),</span></code><code><span>    <span>name</span>=<span>"Diet (detailed)"</span>)+</span></code><code><span>  <span>#添加第三层注释——Habitat</span></span></code><code><span>  new_scale_fill() +</span></code><code><span>  geom_fruit(<span>data</span>=<span>group</span>,</span></code><code><span>             geom = geom_star,</span></code><code><span>             <span>mapping</span> = aes(y=<span>sample</span>,fill = Habitat), </span></code><code><span>             starshape = <span>13</span>, color = NA,</span></code><code><span>             <span>size</span> = <span>5</span>, starstroke = <span>0</span>, pwidth = <span>2</span>, <span>offset</span> = <span>0.2</span>,</span></code><code><span>             grid.params=<span>list</span>(</span></code><code><span>               linetype=<span>3</span>,</span></code><code><span>               <span>size</span>=<span>0.4</span></span></code><code><span>             ))+</span></code><code><span>  scale_fill_manual(</span></code><code><span>    <span>values</span>=c(<span>"#ff9901"</span>, <span>"#01ccff"</span>, <span>"#999601"</span>, <span>"#663300"</span>),</span></code><code><span>    guide=guide_legend(keywidth=<span>1</span>, keyheight=<span>1</span>, <span>order</span>=<span>3</span>)</span></code><code><span>  )+</span></code><code><span>  <span>#添加第四层注释——Captive-wild</span></span></code><code><span>  new_scale_fill() +</span></code><code><span>  geom_fruit(<span>data</span>=<span>group</span>,</span></code><code><span>             geom = geom_star,</span></code><code><span>             <span>mapping</span> = aes(y=<span>sample</span>,fill = <span>`Captive-wild`</span>), </span></code><code><span>             starshape = <span>13</span>, color = NA,</span></code><code><span>             <span>size</span> = <span>5</span>, starstroke = <span>0</span>, pwidth = <span>2</span>, <span>offset</span> = <span>0.2</span>,</span></code><code><span>             grid.params=<span>list</span>(</span></code><code><span>               linetype=<span>3</span>,</span></code><code><span>               <span>size</span>=<span>0.4</span></span></code><code><span>             ))+</span></code><code><span>  scale_fill_manual(</span></code><code><span>    <span>values</span>=c(<span>"#ff9901"</span>, <span>"#0000ff"</span>, <span>"#009900"</span>),</span></code><code><span>    guide=guide_legend(keywidth=<span>1</span>, keyheight=<span>1</span>, <span>order</span>=<span>4</span>)</span></code><code><span>  )+</span></code><code><span>  <span>#添加第五层注释——Captive-wild</span></span></code><code><span>  new_scale_fill() +</span></code><code><span>  geom_fruit(<span>data</span>=<span>group</span>,</span></code><code><span>             geom = geom_star,</span></code><code><span>             <span>mapping</span> = aes(y=<span>sample</span>,fill = <span>`Sample type`</span>), </span></code><code><span>             starshape = <span>13</span>, color = NA,</span></code><code><span>             <span>size</span> = <span>5</span>, starstroke = <span>0</span>, pwidth = <span>2</span>, <span>offset</span> = <span>0.2</span>,</span></code><code><span>             grid.params=<span>list</span>(</span></code><code><span>               linetype=<span>3</span>,</span></code><code><span>               <span>size</span>=<span>0.4</span>,</span></code><code><span>             ))+</span></code><code><span>  scale_fill_manual(</span></code><code><span>    <span>values</span>=c(<span>"#663300"</span>, <span>"#cc9a00"</span>),</span></code><code><span>    guide=guide_legend(keywidth=<span>1</span>, keyheight=<span>1</span>, <span>order</span>=<span>5</span>)</span></code><code><span>  )+</span></code><code><span>  new_scale_fill() +</span></code><code><span>  geom_fruit(</span></code><code><span>    <span>data</span>=data6,</span></code><code><span>    geom=geom_bar,</span></code><code><span>    <span>mapping</span>=aes(y=<span>sample</span>, x=<span>value</span>, fill=<span>variable</span>),</span></code><code><span>    pwidth=<span>1</span>,</span></code><code><span>    width = <span>0.6</span>,</span></code><code><span>    <span>offset</span> = <span>0.1</span>,</span></code><code><span>    stat=<span>"identity"</span>,</span></code><code><span>    orientation=<span>"y"</span>,</span></code><code><span>    axis.params = <span>list</span>(axis = <span>"x"</span>,</span></code><code><span>                       text.size = <span>2</span>,</span></code><code><span>                       vjust = <span>0.5</span>,</span></code><code><span>                       hjust = <span>0</span>,</span></code><code><span>                       text.angle = <span>-90</span>,</span></code><code><span>                       limits = c(<span>0</span>,<span>1</span>)),</span></code><code><span>    grid.params = <span>list</span>(linetype = <span>3</span>)</span></code><code><span>  )+</span></code><code><span>  scale_fill_manual(</span></code><code><span>    <span>values</span>=c(<span>"#4078c0"</span>, <span>"#6cc644"</span>, <span>"#bd2c00"</span>,<span>"#c9510c"</span>, <span>"#6e5494"</span>,</span></code><code><span>             <span>"#fbbc05"</span>,<span>"#ec6400"</span>, <span>"#d5df00"</span>, <span>"#e30061"</span>,<span>"#009ee3"</span>,</span></code><code><span>             <span>"#aca6a2"</span>),</span></code><code><span>    guide=guide_legend(keywidth=<span>1</span>, keyheight=<span>1</span>, <span>order</span>=<span>6</span>),</span></code><code><span>    <span>name</span> = <span>"Genus"</span></span></code><code><span>  )</span></code></pre></section></section><p><img data-galleryid="" data-ratio="0.7042682926829268" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKeZwSVyb7PvicuMAvxd342VV3IQ8M8MY08vbFt0dM1UVzKG2Ad2QEw5Q/640?wx_fmt=png" data-type="png" data-w="984" src="https://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0lMqbWPqrBhV9WC1Bwx5icqKeZwSVyb7PvicuMAvxd342VV3IQ8M8MY08vbFt0dM1UVzKG2Ad2QEw5Q/640?wx_fmt=png"></p></section></section></section></section><p><strong><span>PS: <span>以上</span><span>内容是</span>小编个人学习代码笔记分享，</span><span>仅供参考学习，欢迎大家一起交流学习。</span></strong></p><p><br></p><p><span><strong><span>完整代码（附带注释）及原始数据获取：</span></strong></span><span></span></p><p><strong><span>夸克网盘</span></strong><span>（手机端下载夸克APP进行搜索提取）：</span></p><p>链接：https://pan.quark.cn/s/4f3a5dd45b6d</p><p>提取码：njGn</p><section><mp-common-profile data-id="MzkzODM4NzQ1NQ==" data-pluginname="mpprofile" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/RB50ficWibY0nc718ED9sAicaiaEia0mmkzpsjzyEWWDDIRbGeHIvsucukFjsTthP2qOvNBnc6qriaLnZ62mUoEAknxw/0?wx_fmt=png" data-nickname="科研后花园" data-alias="wzsBio" data-signature="主要发布内容包括：基于R、Python的数据可视化、科研网站介绍、科研小技巧、文献解读等，希望能帮助大家。" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><section><section>更多推荐</section><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487926&amp;idx=1&amp;sn=43cdf8eb4b4133e367bb6295c7b444cb&amp;chksm=c281a326f5f62a30ee0cd35a983a5935557c205c44b65d00351d6a08df3b36b038b48be70f5d&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>R绘图模板——散点+回归曲线+多项式拟合+分组！！！</section></section></a><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487919&amp;idx=1&amp;sn=3d82d8c2f0f1b9c02b859d67b3f05fc0&amp;chksm=c281a33ff5f62a29f550ddc802cf2fa19acff5d1205a9aff756122736198c40ebda33bf7524a&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>R绘图模板——散点图+热图注释！！！</section></section></a><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487890&amp;idx=1&amp;sn=8a252b155dc337c195e75f88415ab35e&amp;chksm=c281a302f5f62a148de417b4dbaed52215e1a05703ae4f84d0b397d8d23a42919038deed1fd4&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>R可视化——基于MicrobiotaProcess包进行Alpha多样性分析！</section></section></a><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487824&amp;idx=1&amp;sn=b22982d9aa2e78bd5c6a6368e75bb4a8&amp;chksm=c281a3c0f5f62ad6dea2e37f99482dc65cec0893cade1e2cab66826c45b35466540d463ef3eb&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>R绘图模板——条形图+黑白色填充+条纹+显著性！！！</section></section></a><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487785&amp;idx=1&amp;sn=c904fe3ebc81ff7a56a9b184af94193b&amp;chksm=c281a3b9f5f62aafd20b26af4ac740bcf842686e74a893668a25fea5672f7c7da0d3f5a8c31c&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>R绘图模板——分组箱线图！！！</section></section></a><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487798&amp;idx=1&amp;sn=27c418b49d2753dbde07cd9d50c3151b&amp;chksm=c281a3a6f5f62ab01ef87adab84d487865af03a1134c191a8f65252e0950185202afccd99246&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>不会代码？没关系，决策链统计软件帮你进行数据清洗！</section></section></a><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487801&amp;idx=1&amp;sn=a0a1586a0c7a99de9b92bd06cd92413a&amp;chksm=c281a3a9f5f62abf03d791220c5063c2069e102c4e6296adbbf845523a95615efc8279b545f1&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>决策链统计软件：基于R包twang进行倾向性（PSM）评分！</section></section></a><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487777&amp;idx=1&amp;sn=d05cd6e2aa778adcadac285e329aca0e&amp;chksm=c281a3b1f5f62aa7cedf350ddd46fa1869a588a17ec98f47db1dcdb4885175bea800fe2308f5&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>R可视化——基于MicrobiotaProcess包进行物种群落结构组成分析！</section></section></a><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487711&amp;idx=1&amp;sn=28e21b53ecc076b530504245a6bc34c8&amp;chksm=c281a24ff5f62b59b7f31fb514dd33dbf907337359ab9eed565f628a84fd95ca6694049a0eab&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>R绘图模板——环状柱状堆积图+分组+显著性！！！</section></section></a><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487695&amp;idx=1&amp;sn=872624538914b6e8607d0057e0c691f1&amp;chksm=c281a25ff5f62b4953b3e2d4c7592d86ac1cfca882fd4d274274e6bde2f8a644c2c286e71dcd&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>R绘图模板——散点+回归线+误差线+显著性！！！</section></section></a><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487686&amp;idx=1&amp;sn=9a3a54eed168967a53789d064cbbc91b&amp;chksm=c281a256f5f62b406190e158d68efe8aee08083d224525a50c304ed683f8fde7f3443e296e77&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>R绘图模板——散点+分组+size+显著性！！！</section></section></a><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487677&amp;idx=1&amp;sn=d8786d61b6f8d8f8de599c7eb0119f33&amp;chksm=c281a22df5f62b3b8b1b06fdb4198f4266fad45a3990c7e91aa642fb2b68a2b9953391dd63ef&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>R可视化——基于MicrobiotaProcess包进行物种差异分析！</section></section></a><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487653&amp;idx=1&amp;sn=341b74602622741c25268041d5611f3b&amp;chksm=c281a235f5f62b2384f45113eb38d19147943124e1fcc3fd339ac14d4596021877fba925e802&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>R绘图模板——气泡图+注释+配对连线！！！</section></section></a><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487547&amp;idx=1&amp;sn=04bfeab2abb0504ea74f8d0585332532&amp;chksm=c281a2abf5f62bbd5d6a00ef8aa94e9b3861835275ae2417077d619571542eddb3b61ca423f8&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>基于MicrobiotaProcess包进行PCoA分析！</section></section></a><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487526&amp;idx=1&amp;sn=641f63ae9986be2b41c683153d5ec7b6&amp;chksm=c281a2b6f5f62ba0beaf86a85227a26fd1454d8b0b9a3386c67d87174a54b2ad4677a3796271&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>跟着Nature学绘图——柱状图+散点+配对连线+显著性！！！</section></section></a><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487463&amp;idx=2&amp;sn=bd7ed18c30e33d78abe0ff00b632d83f&amp;chksm=c281bd77f5f6346172db943247d5da1050d26bf31e8c75b01782582b9483e192bbe1fb4a94e6&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><section><span><section><br></section></span><section>扩增子测序数据分析还不会？小编整理的全套R语言代码助您轻松解决问题！</section></section></a><section><span><section><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487463&amp;idx=3&amp;sn=d3f6b4561227de02df7933ff3a5678b9&amp;chksm=c281bd77f5f6346135dbb08df5df3eac0a92d18200cd3c96a7076c5af4bfe2f2026ee7d8118d&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2"><br></a></section></span><section><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247487463&amp;idx=3&amp;sn=d3f6b4561227de02df7933ff3a5678b9&amp;chksm=c281bd77f5f6346135dbb08df5df3eac0a92d18200cd3c96a7076c5af4bfe2f2026ee7d8118d&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2">R绘图模板源代码获取！</a></section></section></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/yrI9ZtikotmwmuWWUwgMEA",target="_blank" rel="noopener noreferrer">原文链接</a>
