---
title: "ggplot2绘制logo版环状条形图"
date: 2023-09-05T13:56:20Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
ggplot2绘制logo版环状条形图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来介绍如何使用<strong>「ggplot2结合ggflags」</strong>来给环状条形图添加地理图标注释，下面小编通过一个案例来进行展示，图形仅供展示用，希望各位观众老爷能够喜欢。数据代码已经整合上传到2023VIP交流群，加群的观众老爷可自行下载。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span># install.packages("countrycode")</span><br><span>library</span>(countrycode)<br><span># devtools::install_github('rensa/ggflags')</span><br><span>library</span>(ggflags)<br><span>library</span>(ggtext) <br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>wins &lt;- read_csv(<span>"data.csv"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>wins_by_cat &lt;- wins %&gt;% <br>  group_by(Nationality, Category) %&gt;%  <span># 按国籍和类别分组</span><br>  summarise(cat_total = n()) %&gt;%  <span># 计算每组的总数</span><br>  group_by(Category) %&gt;%  <span># 再按类别分组</span><br>  mutate(rank = rank(-cat_total, ties.method = <span>"min"</span>)) %&gt;%  <span># 对每组进行排名</span><br>  arrange(Category, desc(cat_total)) %&gt;%  <span># 排序</span><br>  filter(rank &lt;= <span>10</span>) %&gt;%  <span># 只保留前10名</span><br>  ungroup() %&gt;%  <span># 取消分组</span><br>  mutate(Nationality = case_when(  <span># 修改国籍名称</span><br>    Nationality == <span>"United Kingdom"</span> ~ <span>"UK"</span>,<br>    Nationality == <span>"United States"</span> ~ <span>"USA"</span>,<br>    Nationality == <span>"Soviet Union"</span> ~ <span>"Russia"</span>,<br>    <span>TRUE</span> ~ Nationality<br>  )) %&gt;% <br>  mutate(code = countrycode(Nationality, <span>"country.name"</span>, <span>"iso2c"</span>) %&gt;% tolower())  <span># 转换为国家代码</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>添加空行用于图形分割</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>empty_nrow = <span>3</span><br>to_add &lt;- data.frame(matrix(<span>NA</span>, nrow = empty_nrow * n_distinct(wins_by_cat$Category), ncol = ncol(wins_by_cat)))<br>colnames(to_add) &lt;- colnames(wins_by_cat)<br>to_add$Category &lt;- rep(unique(wins_by_cat$Category), each = empty_nrow)<br><br><span># 添加空行到数据集</span><br>wins_by_cat_space &lt;- wins_by_cat %&gt;% <br>  rbind(to_add) %&gt;% <br>  arrange(Category, desc(cat_total)) %&gt;% <br>  mutate(seq_id = row_number())<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>计算坐标标签</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>label_data &lt;- wins_by_cat_space<br>nBar &lt;- nrow(label_data)<br>angle &lt;- <span>90</span> - <span>360</span> * (label_data$seq_id - <span>0.5</span>) / nBar<br>label_data$hjust &lt;- ifelse(angle &lt; -<span>90</span>, <span>1</span>, <span>0</span>)<br>label_data$angle &lt;- ifelse(angle &lt; -<span>90</span>, angle + <span>180</span>, angle)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>设置颜色</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>bg_color &lt;- <span>"#13293d"</span><br>line_color &lt;- <span>"#e9f1f2"</span><br>font_color &lt;- <span>"white"</span><br>bar_pal &lt;- c(<span>"Men"</span> = <span>"#679289"</span>, <span>"Wheelchair Men"</span> = <span>"#c9cba3"</span>,<br>             <span>"Women"</span> = <span>"#ee2e31"</span>, <span>"Wheelchair Women"</span> = <span>"#f4c095"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建极坐标柱状图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>polar_barplot &lt;- ggplot(wins_by_cat_space) +<br>  geom_bar(aes(x = seq_id, y = cat_total, fill = Category),<br>           stat = <span>"identity"</span>, position = <span>"dodge"</span>,<br>           show.legend = <span>FALSE</span>, alpha = <span>0.9</span>, color = line_color, linewidth = <span>0.5</span>) +<br>  coord_polar() +<br>  scale_y_continuous(limits = c(-<span>8</span>, <span>20</span>)) +<br>  scale_fill_manual(values = bar_pal, guide = <span>"none"</span>) +<br>  scale_color_manual(values = bar_pal, guide = <span>"none"</span>) +<br>  theme_minimal() +<br>  labs(x = <span>NULL</span>, y = <span>NULL</span>) +<br>  theme(panel.background = element_rect(fill = bg_color, colour = bg_color),<br>        plot.background = element_rect(fill = bg_color, colour = bg_color),<br>        text = element_text(color = line_color),<br>        axis.text = element_blank(),<br>        panel.grid.major = element_blank(),<br>        panel.grid.minor = element_blank(),<br>        plot.margin = margin(<span>0</span>, <span>0</span>, <span>0</span>, <span>0</span>))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建分组条带和标签数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>base_data &lt;- wins_by_cat_space %&gt;% <br>  group_by(Category) %&gt;% <br>  summarize(start = min(seq_id), end = max(seq_id) - empty_nrow) %&gt;% <br>  rowwise() %&gt;%<br>  mutate(title = mean(c(start, end)),<br>         printname = case_when(<br>           Category == <span>"Men"</span> ~ <span>"MEN"</span>,<br>           Category == <span>"Women"</span> ~ <span>"WOMEN"</span>,<br>           Category == <span>"Wheelchair Men"</span> ~ <span>"Wheelchair\nMEN"</span>,<br>           Category == <span>"Wheelchair Women"</span> ~ <span>"Wheelchair\nWOMEN"</span><br>         ),<br>         angle = <span>360</span> * (title) / nrow(wins_by_cat_space),<br>         angle = ifelse(angle &lt; <span>180</span>, angle - <span>90</span>, angle + <span>90</span>))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>添加分组标签与条带</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>polar_barplot +<br>  <span># 添加数值标签</span><br>  geom_text(data = label_data, <br>            aes(x = seq_id, y = cat_total - <span>1.5</span>, label = ifelse(rank &lt;= <span>3</span>, cat_total, <span>""</span>), hjust = hjust), <br>            color = font_color, fontface = <span>"bold"</span>,<br>            alpha = <span>1</span>, size = <span>3</span>, angle = label_data$angle, inherit.aes = <span>FALSE</span>) +<br>  <span># 添加国旗</span><br>  ggflags::geom_flag(data = label_data, <br>                     aes(x = seq_id, y = cat_total + <span>1.25</span>, country = code), size = <span>3.5</span>) +<br>  <span># 添加国家名称</span><br>  geom_text(data = label_data, <br>            aes(x = seq_id, y = cat_total + <span>2.5</span>, label = Nationality, hjust = hjust), <br>            color = font_color, fontface = <span>"bold"</span>,<br>            alpha = <span>0.7</span>, size = <span>3</span>, angle = label_data$angle, inherit.aes = <span>FALSE</span>) +<br>  <span># 添加分组条带</span><br>  geom_segment(data = base_data, <br>               aes(x = start + <span>1</span>, y = max(wins_by_cat_space$cat_total, na.rm = <span>TRUE</span>) + <span>0.5</span>, <br>                   xend = end, yend = max(wins_by_cat_space$cat_total, na.rm = <span>TRUE</span>) + <span>0.5</span>,<br>                   color = Category), <br>               alpha = <span>0.8</span>, size = <span>0.6</span>, inherit.aes = <span>FALSE</span>) +<br>  <span># 添加分组名称</span><br>  geom_text(data = base_data, <br>            aes(x = title + <span>0.5</span>, y = max(wins_by_cat_space$cat_total, na.rm = <span>TRUE</span>) - <span>1.5</span>, <br>                label = printname, angle = angle, colour = Category), <br>            hjust = c(<span>1</span>, <span>0.5</span>, <span>0.5</span>, <span>0.5</span>), <br>            alpha = <span>1</span>, size = <span>3.25</span>, fontface = <span>"bold"</span>, inherit.aes = <span>FALSE</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9935185185185185" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDELRRR3YYgu07TSPpFIdcX2J6uiaG3knQ2cpd69McknJA5dCiaUGlIXTZQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDELRRR3YYgu07TSPpFIdcX2J6uiaG3knQ2cpd69McknJA5dCiaUGlIXTZQ/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节内容介绍到此结束，有需要学习个性化数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>购买<strong>「2023年度会员文档」</strong>同步更新中<strong>「售价149元」</strong>，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；按照往年数据小编年产出约在150+以上</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可下单购买，需要了解更多信息的朋友欢迎交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝扫一扫</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="1.6141479099678457" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDEuwAn8G3GKael9STgEP3nWlzQe5WkIecicdTuLbLibPWMVJl4FP8Dt0OA/640?wx_fmt=png" data-type="png" data-w="622" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDEuwAn8G3GKael9STgEP3nWlzQe5WkIecicdTuLbLibPWMVJl4FP8Dt0OA/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023会员群案例展示</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDEfS9I5TpTiaryBosqC6AiccwS2T4icibXfCs2xMiaHN79qX5GSBLaOgVqjqA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDEfS9I5TpTiaryBosqC6AiccwS2T4icibXfCs2xMiaHN79qX5GSBLaOgVqjqA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDE8vticQPchXauJrr5d8fjfpoicc9GiagYicKicSvu27FWrRY92mgh4ibaNuKA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDE8vticQPchXauJrr5d8fjfpoicc9GiagYicKicSvu27FWrRY92mgh4ibaNuKA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDEreNA66wE7SIbUqclwLaicJzMwPAQDz3hxZ58WxfmqTcufib9wum2ZYuA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDEreNA66wE7SIbUqclwLaicJzMwPAQDz3hxZ58WxfmqTcufib9wum2ZYuA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDE8CdNiaB0o2ZIeYLxN4R5fe30lLrt3tl66AgmxdibzufmxB7efUhsUicQg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDE8CdNiaB0o2ZIeYLxN4R5fe30lLrt3tl66AgmxdibzufmxB7efUhsUicQg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDED4Pichr44cPWSd74zibBYzWEhIW4K1Z29Vs9ZzZ23SgRFrguYb9tZUpg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDED4Pichr44cPWSd74zibBYzWEhIW4K1Z29Vs9ZzZ23SgRFrguYb9tZUpg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDEqv0Unjv6ylrGuze4CE9hlOrTb0nWGNphwB5K2aBqdico4uGHF3nYaYA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDEqv0Unjv6ylrGuze4CE9hlOrTb0nWGNphwB5K2aBqdico4uGHF3nYaYA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDEYX98bmpaVASh5Q3SzZJeC9ibqb2b6xFCzrOXep6JxVPpaQBOlib8t8CA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDEYX98bmpaVASh5Q3SzZJeC9ibqb2b6xFCzrOXep6JxVPpaQBOlib8t8CA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDEaAXTxox5nhOqZc08x1uLQlMFRY8r0frq5VBcq1HfxnXMBEIc0JaaCQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDEaAXTxox5nhOqZc08x1uLQlMFRY8r0frq5VBcq1HfxnXMBEIc0JaaCQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDEbTSxypKErQ6Gh3Jdmibibv3clsozRUjtCJXJUjvhuyJC95PakibkmynPQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa7yorEF4xskjrSFFfYonDEbTSxypKErQ6Gh3Jdmibibv3clsozRUjtCJXJUjvhuyJC95PakibkmynPQ/640?wx_fmt=png"></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/SNfYZvLeUyLL06XnaSq5tA",target="_blank" rel="noopener noreferrer">原文链接</a>
