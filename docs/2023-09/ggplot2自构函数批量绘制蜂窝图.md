---
title: "ggplot2自构函数批量绘制蜂窝图"
date: 2023-09-12T15:39:44Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
ggplot2自构函数批量绘制蜂窝图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来介绍如何使用<strong>「ggplot2结合ggbeeswarm」</strong>来自定义函数批量绘制蜂窝图，下面小编通过一个案例来进行展示，图形仅供展示用，希望各位观众老爷能够喜欢。数据代码已经整合上传到2023VIP交流群，加群的观众老爷可自行下载，有需要的朋友可关注文末介绍加入VIP交流群</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(janitor)<br><span>library</span>(glue)<br><span>library</span>(ggtext)<br><span>library</span>(forcats)<br><span>library</span>(ggbeeswarm)<br><span>library</span>(emojifont)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- read_tsv(<span>"data.tsv"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>定义颜色调色板</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>pal &lt;- c(<span>"#7B2CBF"</span>, <span>"#953B98"</span>, <span>"#AF4A72"</span>, <span>"#CA5A4C"</span>, <span>"#E46926"</span>, <span>"#FF7900"</span>)<br>bright &lt;- c(<span>"#540d6e"</span>, <span>"#ee4266"</span>, <span>"#ffd23f"</span>, <span>"#3bceac"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df_mean &lt;- df %&gt;% <br>  group_by(type) %&gt;% <br>  summarise(n_artists = sum(artists_n, na.rm = <span>TRUE</span>)) %&gt;% <br>  ungroup() %&gt;% <br>  mutate(p_mean = n_artists/sum(n_artists)) %&gt;% <br>  select(type, p_mean)<br><br>df_base &lt;- artists %&gt;% <br>  group_by(type, state) %&gt;% <br>  summarise(<br>    n_artists = sum(artists_n, na.rm = <span>TRUE</span>),<br>    lq = sum(log(location_quotient)*artists_n/sum(artists_n, na.rm = <span>TRUE</span>), na.rm = <span>TRUE</span>)) %&gt;% <br>  filter(is.finite(lq)) %&gt;% <br>  group_by(state) %&gt;% <br>  mutate(p = n_artists/sum(n_artists)) %&gt;% <br>  ungroup() %&gt;% <br>  mutate(lab = type,type = as.numeric(fct_reorder(type, lq, median)))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>定义绘图函数</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>make_plot &lt;- <span>function</span>(.state, .x) {<br>  <span># 筛选特定州的数据</span><br>  df_state &lt;- df_base %&gt;% <br>    filter(state == .state)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df_base %&gt;% <br>    ggplot(aes(type,lq)) +<br>    geom_text(aes(type, -<span>4</span>, label = str_wrap(lab, <span>25</span>)), df_state,<br>              size = <span>20</span>, colour = <span>"grey20"</span>, hjust = <span>0</span>, lineheight = <span>0.3</span>, vjust = <span>0.5</span>) +<br>    geom_beeswarm(size = <span>4</span>, alpha = <span>0.5</span>, colour = <span>"grey40"</span>) +<br>    geom_point(aes(x, y), tibble(x = <span>1</span>:<span>13</span>, y = <span>0</span>), colour = <span>"grey20"</span>, size = <span>3</span>) +<br>    geom_point(aes(type, lq), df_state, size = <span>6</span>, colour = .x) +<br>    annotate(<span>"text"</span>, y = -<span>1.2</span>, x = <span>14</span>, label = <span>"Less than the national share"</span>,size = <span>12</span>, colour = <span>"grey20"</span>) +<br>    annotate(<span>"text"</span>, y = <span>1.2</span>, x = <span>14</span>, label = <span>"More than the national share"</span>,size = <span>12</span>, colour = <span>"grey20"</span>) +<br>    scale_y_continuous(breaks = log(c(<span>0.1</span>, <span>0.25</span>, <span>0.5</span>, <span>1</span>, <span>2</span>, <span>4</span>, <span>8</span>)),<br>                       labels = round(c(<span>0.1</span>, <span>0.25</span>, <span>0.5</span>, <span>1</span>, <span>2</span>, <span>4</span>, <span>8</span>), <span>1</span>)) +<br>    coord_flip(clip = <span>"off"</span>) +<br>    theme_void() +<br>    labs(y = <span>"Location Quotient (log scale)"</span>) +<br>    theme(text = element_text(colour = <span>"grey20"</span>, size = <span>36</span>),<br>      plot.background = element_rect(fill = <span>"white"</span>),<br>      plot.margin = margin(t = <span>30</span>, b = <span>10</span>, l = <span>30</span>, r = <span>30</span>),<br>      axis.text.x = element_text(),<br>      axis.title.x = element_text(margin = margin(t = <span>10</span>)))<br><br>  <span># 保存图像</span><br>  ggsave(glue(<span>"plot/artists-{.state}.png"</span>), height = <span>12</span>, width = <span>8.5</span>)<br>}<br></code></pre><h4 data-tool="mdnice编辑器"><span></span><span><span></span>绘制单个图</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>make_plot(<span>"California"</span>, pal[<span>6</span>])<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.4055555555555554" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyytREgywoHWIYrW7dOugA7ib7fDU3wtnqUZsmWptKSd58HeERP8cYWqkQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyytREgywoHWIYrW7dOugA7ib7fDU3wtnqUZsmWptKSd58HeERP8cYWqkQ/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>批量绘图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>states &lt;- c(<span>"South Dakota"</span>, <span>"District of Columbia"</span>, <span>"Nevada"</span>, <span>"New York"</span>)<br>walk2(states, bright, make_plot)<br></code></pre><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节内容介绍到此结束，有需要学习个性化数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>购买<strong>「2023年度会员文档」</strong>同步更新中<strong>「售价149元」</strong>，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；按照往年数据小编年产出约在150+以上</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可下单购买，需要了解更多信息的朋友欢迎交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝扫一扫</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="1.6141479099678457" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyylVEKXS70IQEkibFibn0t0LHxs9fVRtcUmWh4pdiaWEsSKJ9kEECTTwu9A/640?wx_fmt=png" data-type="png" data-w="622" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyylVEKXS70IQEkibFibn0t0LHxs9fVRtcUmWh4pdiaWEsSKJ9kEECTTwu9A/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023会员群案例展示</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyLMILUVn9pqp5CgqZPoM4gKAIbbGbXKPSFDdHcLJZEtciapzUPibibq6pA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyLMILUVn9pqp5CgqZPoM4gKAIbbGbXKPSFDdHcLJZEtciapzUPibibq6pA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyXfJKK4QFkicSJWkTu3lX7YZTfyOMy78Dr8TzKBaKL5G7LH11VLSupMQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyXfJKK4QFkicSJWkTu3lX7YZTfyOMy78Dr8TzKBaKL5G7LH11VLSupMQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyykuPo8KAwcej3yCj8q2H54coNnEHZibCkUuU1jmYdKwLUITVlysC0OHw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyykuPo8KAwcej3yCj8q2H54coNnEHZibCkUuU1jmYdKwLUITVlysC0OHw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyyCj9JiahDYx0Oa2NBicyvDGG8ErVIJn3ibvmiayu3UPTRRYE1fVAudGK4w/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyyCj9JiahDYx0Oa2NBicyvDGG8ErVIJn3ibvmiayu3UPTRRYE1fVAudGK4w/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyDt5ShGJiakKAHQLaTz1qx9BWQf8bTKNfiawPdxYKSoHjZ39uLuGchyYw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyDt5ShGJiakKAHQLaTz1qx9BWQf8bTKNfiawPdxYKSoHjZ39uLuGchyYw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyZFYxbQMsMyTCUX47UF3fPJzC6b6IEaHsJVPqkx9RSOabFAvZibxz1Yw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyZFYxbQMsMyTCUX47UF3fPJzC6b6IEaHsJVPqkx9RSOabFAvZibxz1Yw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyiaiauNUb9OO04JvkHLclvTHLX6mebVA3jnhLbUQWNicuavEeXTVtHZzLg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyiaiauNUb9OO04JvkHLclvTHLX6mebVA3jnhLbUQWNicuavEeXTVtHZzLg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyrSIDRW9K6qCL0tp9WUKKkuvEPicURiaZmwkCTpPT4VmUVwNaMK4SvE9w/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyrSIDRW9K6qCL0tp9WUKKkuvEPicURiaZmwkCTpPT4VmUVwNaMK4SvE9w/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyGz7aTXJ9dHObR9ibHX5c8BFaDmBObgmfD8OqibE8US440pNTA7EGdozw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbvWR7bQlGxXz0Vgem29XyyGz7aTXJ9dHObR9ibHX5c8BFaDmBObgmfD8OqibE8US440pNTA7EGdozw/640?wx_fmt=png"></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/EyM4TZhZUBwn7jLDD1kOCg",target="_blank" rel="noopener noreferrer">原文链接</a>
