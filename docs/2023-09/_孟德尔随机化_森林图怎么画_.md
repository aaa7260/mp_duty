---
title: "【孟德尔随机化】森林图怎么画？"
date: 2023-09-13T07:27:49Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
【孟德尔随机化】森林图怎么画？ by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">本来想复现上周的那篇<span>文献导</span><span>读，但是找了很久都没找到他的原始数据，就……很绝望。。。所以给大家补一个森林图的画图方式~</span></p><p data-tool="mdnice编辑器">我们常在MR文献中看到的森林图咋画呢？</p><figure data-tool="mdnice编辑器"><img data-ratio="0.4527777777777778" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9b4ldbnibTWQZ4df22LrpmicNMZ1iaUB12UnBsYyUqwfhtAlb6CRnH3HWG3yfz0l9Pvx4ibzDIMV64ww/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9b4ldbnibTWQZ4df22LrpmicNMZ1iaUB12UnBsYyUqwfhtAlb6CRnH3HWG3yfz0l9Pvx4ibzDIMV64ww/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">今天简单来画一下：</p><p data-tool="mdnice编辑器">假如原始表格长这样</p><pre data-tool="mdnice编辑器"><span></span><code>View(outresult)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7165217391304348" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9b4ldbnibTWQZ4df22Lrpmic2oU8PLgRr6SoK7Yic7OTlxXLEFsWlqeQjghV03qVMsgHHye6wYjHjVw/640?wx_fmt=png" data-type="png" data-w="575" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9b4ldbnibTWQZ4df22Lrpmic2oU8PLgRr6SoK7Yic7OTlxXLEFsWlqeQjghV03qVMsgHHye6wYjHjVw/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code>out_multi &lt;- outresult<br><span># out_multi[,2:ncol(out_multi)] &lt;- as.numeric(unlist(out_multi[,2:ncol(out_multi)]))</span><br>hz &lt;- paste(round(out_multi$HR,<span>3</span>),<br>            <span>"("</span>,round(out_multi$L95CI,<span>3</span>),<br>            <span>"-"</span>,round(out_multi$H95CI,<span>3</span>),<span>")"</span>,sep = <span>""</span>)<br><br><br>tabletext &lt;- cbind(c(<span>NA</span>,<span>"CELL"</span>,out_multi$CELL),<br>                   c(<span>NA</span>,<span>"Coefficient"</span>,round(out_multi$coef,<span>3</span>)),<br>                   c(<span>NA</span>,<span>"P value"</span>,ifelse(out_multi$pvalue&lt;<span>0.001</span>,<span>"P &lt; 0.001"</span>,round(out_multi$pvalue,<span>3</span>))),<br>                   c(<span>NA</span>,<span>"Hazard Ratio(95% CI)"</span>,hz))<br><br>png(<span>"../rawdata/based_unicox_Hazard_Ratio.png"</span>, width=<span>1000</span>, height=<span>600</span>)<br>pforest &lt;- forestplot(labeltext=tabletext, <br>           graph.pos=<span>3</span>,  <span>#为Pvalue箱线图所在的位置</span><br>           col=fpColors(box=<span>"#D55E00"</span>, lines=<span>"#CC79A7"</span>, zero = <span>"gray50"</span>),<br>           mean=c(<span>NA</span>,<span>NA</span>,out_multi$HR),<br>           lower=c(<span>NA</span>,<span>NA</span>,out_multi$L95CI), <span>#95%置信区间下限</span><br>           upper=c(<span>NA</span>,<span>NA</span>,out_multi$H95CI), <span>#95%置信区间上限</span><br>           xlab=<span>"Unicox−analytic Hazard Ratio of immune cell population"</span>,<br>           boxsize=<span>0.3</span>,lwd.ci=<span>2</span>,   <span>#箱子大小，线的宽度</span><br>           ci.vertices.height = <span>0.08</span>,ci.vertices=<span>TRUE</span>, <span>#置信区间用线宽、高、型</span><br>           zero=<span>1</span>,lwd.zero=<span>1</span>,      <span>#zero线宽 基准线的位置</span><br>           colgap=unit(<span>5</span>,<span>"mm"</span>),    <span>#列间隙</span><br>           xticks = c(<span>0.5</span>, <span>1</span>,<span>4</span>), <span>#横坐标刻度</span><br>           lwd.xaxis=<span>1</span>,            <span>#X轴线宽</span><br>           lineheight = unit(<span>1</span>,<span>"cm"</span>), <span>#固定行高</span><br>           graphwidth = unit(<span>.3</span>,<span>"npc"</span>), <span>#图在表中的宽度比例</span><br>           cex=<span>0.9</span>, fn.ci_norm = fpDrawCircleCI, <span>#误差条显示方式</span><br>           hrzl_lines=list(<span>"2"</span> = gpar(lwd=<span>2</span>, col=<span>"black"</span>),<br>                           <span>"3"</span> = gpar(lwd=<span>2</span>, col=<span>"black"</span>), <span>#第三行顶部加黑线，引号内数字标记行位置</span><br>                           <span>"16"</span> = gpar(lwd=<span>2</span>, col=<span>"black"</span>)),<span>#最后一行底部加黑线,"29"中数字为nrow(tabletext)+1</span><br>           mar=unit(rep(<span>0.1</span>, times = <span>4</span>), <span>"mm"</span>),<span>#图形页边距</span><br>           <span># #fpTxtGp函数中的cex参数设置各个组件的大小</span><br>           txt_gp=fpTxtGp(label=gpar(cex=<span>1</span>),<br>                          ticks=gpar(cex=<span>1.5</span>),<br>                          xlab=gpar(cex = <span>1.25</span>),<br>                          title=gpar(cex = <span>1.2</span>))<br>           )<br>pforest<br>dev.copy(png, <span>"../Hazard_Ratio.png"</span>)<br>dev.off()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7712962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9b4ldbnibTWQZ4df22LrpmicSiblOac6Bnd7HQNOo1PibMKiayLlT109uu9GJXuKWjOTlkNdzpm86oS6g/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9b4ldbnibTWQZ4df22LrpmicSiblOac6Bnd7HQNOo1PibMKiayLlT109uu9GJXuKWjOTlkNdzpm86oS6g/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">大家可以根据自己的<code>outresult</code>进行调整，应该就能得到满意的森林图啦~</p></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/etSecuOet1ORKY_W64EsOw",target="_blank" rel="noopener noreferrer">原文链接</a>
