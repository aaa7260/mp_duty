---
title: "十分钟完成上周的Science杂志的玉米单细胞文章的数据处理"
date: 2023-09-26T16:14:50Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
十分钟完成上周的Science杂志的玉米单细胞文章的数据处理 by 生信技能树
------
<div><section powered-by="xiumi.us"><section><section><section><img data-ratio="0.91875" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wztsZWIld4dbSAHficyAXWgkicrhjjacU8Ey0UKM56qbSnedHStMqWUfTPQxbqxNTVZy1g59nNW3BSg/640?wx_fmt=jpeg" data-type="jpeg" data-w="640" src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wztsZWIld4dbSAHficyAXWgkicrhjjacU8Ey0UKM56qbSnedHStMqWUfTPQxbqxNTVZy1g59nNW3BSg/640?wx_fmt=jpeg"></section></section><span title="" opera-tn-ra-cell="_$.pages:0.layers:0.comps:0.title1"><p><br></p></span></section><section><section powered-by="xiumi.us"><p><span>我们有一个学徒培养环节，主打《单细胞数据处理交流》，全部的的数据分析，目前已经进行到70%，文末有参加交流会的腾讯会议直播方式！</span></p></section></section></section><section powered-by="xiumi.us"><section data-tools="新媒体排版" data-id="763890" data-style-type="undefined"><section placeholder="请输入标题">下面12月份学徒的投稿</section></section></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><span>但是仍然是有</span><span>部分学徒迟迟不肯</span><span>开始</span><span>，</span><span>觉得单细胞过于复杂，</span><span>为了最大化激励大家行动起来，我们甚至承诺大家只需放开手</span><span>分享，提供带有数据集的文献，我们直接帮忙写代码，让学徒们去理解和解读。</span><span>手把手教学</span></p><p data-tool="mdnice编辑器">然后有一个小伙伴发在交流群的pdf文献，就是上周（2021年12月2日）的文章，<em>Science</em>在线发表的美国纽约大学Kenneth D. Birnbaum团队题为《Ground tissue circuitry regulates organ complexity in maize and Setaria》的研究论文，使用的是是Seurat的标准降维聚类分群流程，所以得到了编号为 0-20这21个单细胞亚群，如下所示：</p><p><img data-galleryid="" data-ratio="0.6329411764705882" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxC5TcxzuzzaHQENm48NPPXuhSmaToiaWhObJguy8vm4ypx2Zl6IqFcYXTZopOtXnNOPr09zgnJxjw/640?wx_fmt=png" data-type="png" data-w="850" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxC5TcxzuzzaHQENm48NPPXuhSmaToiaWhObJguy8vm4ypx2Zl6IqFcYXTZopOtXnNOPr09zgnJxjw/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>编号为 0-20这21个单细胞亚群</figcaption></figure><p data-tool="mdnice编辑器">可以看到，在Seurat的标准降维聚类分群流程后，研究者们就直接给了这些细胞亚群一个生物学名字，一般来说亚群命名都是需要特定的标记基因，来源于过去一百多年的生命科学领域蓬勃发展的文章。但是我看了看文章里面的：</p><p><img data-galleryid="" data-ratio="0.9943820224719101" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxC5TcxzuzzaHQENm48NPPXAL5VhFeKmCN7a0qTsDmjhqdDOWLd0lrnkCcBqIgeWsgOU57ubW28fg/640?wx_fmt=png" data-type="png" data-w="712" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxC5TcxzuzzaHQENm48NPPXAL5VhFeKmCN7a0qTsDmjhqdDOWLd0lrnkCcBqIgeWsgOU57ubW28fg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>特定的标记基因</figcaption></figure><p data-tool="mdnice编辑器">感觉基因名字都稀奇古怪的，简单的一个编号而已，也不知道是哪个团队在规范和维护这样的基因名字。</p><h3 data-tool="mdnice编辑器"><span></span><span>下面开始10分钟复现这个Science杂志的玉米单细胞文章的数据处理</span><span></span></h3><p data-tool="mdnice编辑器">其单细胞数据集在 https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE173087 ，可以看到是9个样品：</p><pre data-tool="mdnice编辑器"><span></span><code>GSM5259613 Zmroot_sc_read1/2_rep1<br>GSM5259614 Zmroot_sc_read1/2_rep2<br>GSM5259615 Zmroot_sc_read1/2_rep3<br>GSM5603496 Zmroot_sc_read1/2_rep4<br>GSM5603497 Zmroot_sc_read1/2_rep5<br>GSM5603498 Zmroot_sc_read1/2_rep6<br>GSM5603499 Zmroot_sc_read1/2_rep7<br>GSM5603500 Zmroot_sc_read1/2_rep8<br>GSM5603501 Zmroot_sc_read1/2_rep9<br></code></pre><p data-tool="mdnice编辑器">其中下面的 17.4 Mb 文件存储了不到5000个单细胞：</p><pre data-tool="mdnice编辑器"><span></span><code>GSE173087_Maize_rootsc_counts.txt.gz <br></code></pre><p data-tool="mdnice编辑器">大家需要简单下载它，然后复制粘贴我的30行左右的代码就可以运行啦：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(Seurat)<br><br><span>library</span>(data.table) <br><span># 读取   17.4 Mb 文件 文件 </span><br>ct=fread( <span>'GSE173087_Maize_rootsc_counts.txt.gz'</span>,data.table = <span>F</span>)<br>ct[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>rownames(ct)=ct[,<span>1</span>]<br>ct=ct[,-<span>1</span>] <br><span>## Initialize the Seurat object with the raw (non-normalized data).</span><br>maize &lt;- CreateSeuratObject(counts = ct, <br>                           project = <span>"maize"</span>, <br>                           min.cells = <span>3</span>, <br>                           min.features = <span>200</span>)<br>maize <br><span>## Normalizing the data</span><br>maize &lt;- NormalizeData(maize, normalization.method = <span>"LogNormalize"</span>, <br>                      scale.factor = <span>10000</span>)<br><br>maize &lt;- NormalizeData(maize)<br><br><span>## Identify the 2000 most highly variable genes</span><br>maize &lt;- FindVariableFeatures(maize, selection.method = <span>"vst"</span>, nfeatures = <span>2000</span>)<br><br><span>## In addition we scale the data</span><br>all.genes &lt;- rownames(maize)<br>maize &lt;- ScaleData(maize, features = all.genes)<br><br>maize &lt;- RunPCA(maize, features = VariableFeatures(object = maize), <br>               verbose = <span>FALSE</span>)<br>maize &lt;- FindNeighbors(maize, dims = <span>1</span>:<span>10</span>, verbose = <span>FALSE</span>)<br>maize &lt;- FindClusters(maize, resolution = <span>0.5</span>, verbose = <span>FALSE</span>)<br>maize &lt;- RunUMAP(maize, dims = <span>1</span>:<span>10</span>, umap.method = <span>"uwot"</span>, metric = <span>"cosine"</span>)<br>table(maize$seurat_clusters)<br>phe=maize@meta.data<br>save(phe,file = <span>'phe-by-basic-seurat.Rdata'</span>)<br><br><span># maize.markers &lt;- FindAllMarkers(maize, only.pos = TRUE, min.pct = 0.25,  logfc.threshold = 0.25, verbose = FALSE)</span><br>DimPlot(maize, reduction = <span>"umap"</span>, group.by = <span>'seurat_clusters'</span>,<br>        label = <span>TRUE</span>, pt.size = <span>0.5</span>) <br></code></pre><p data-tool="mdnice编辑器">我上面的代码其实就是Seurat的标准降维聚类分群流程，可以看到是编号为0-18的单细胞亚群：</p><p><img data-galleryid="" data-ratio="0.9776785714285714" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxC5TcxzuzzaHQENm48NPPXLXfZQ7pQx4BTOzE8NmsFmz8nYibZNCsr1mMwLxIxnhEVaMIxsEfmYAg/640?wx_fmt=png" data-type="png" data-w="1344" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxC5TcxzuzzaHQENm48NPPXLXfZQ7pQx4BTOzE8NmsFmz8nYibZNCsr1mMwLxIxnhEVaMIxsEfmYAg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>编号为0-18的单细胞亚群</figcaption></figure><p data-tool="mdnice编辑器">接下来需要对它们进行已知的标记基因的可视化，代码也是超级的简单：</p><pre data-tool="mdnice编辑器"><span></span><code><br>head(rownames(maize))<br>cg= c( <span>'ZmMYB46'</span>,<span>'ZmCO2'</span>,<span>'ZmLBD29'</span>,<span>'ZmLCR'</span>,<span>'ZmRHD6'</span>)<br>cg=c(<span>'d012714'</span>,<span>'d013033'</span>,<span>'d052952'</span>,<span>'d002191'</span>,<span>'d023651'</span>,<br>     <span>'d035689'</span>,<span>'d051478'</span>,<span>'d017508'</span>,<span>'d046778'</span>,<span>'d043242'</span>,<br>     <span>'d048131'</span>,<span>'d019985'</span>,<span>'d042035'</span>,<span>'d041611'</span>,<span>'d049606'</span>,<br>     <span>'d025402'</span>,<span>'d011156'</span>,<span>'d008925'</span>,<span>'d022457'</span>,<span>'d046186'</span>,<span>'d026406'</span>)<br><span>library</span>(ggplot2)<br>p1=DotPlot(maize, features =paste0(<span>'Zm00001'</span>,cg) ,<br>        group.by = <span>'seurat_clusters'</span>)  + coord_flip()<br>p2=DimPlot(maize, reduction = <span>"umap"</span>, <br>        label = <span>TRUE</span>, pt.size = <span>0.5</span>) + NoLegend()<br>ggsave(p1,filename = <span>'markers.pdf'</span>)<br>ggsave(p2,filename = <span>'umap.pdf'</span>)<br><span>library</span>(patchwork)<br>p1+p2<br>ggsave( filename = <span>'markers-and-umap.pdf'</span>,width = <span>15</span>)<br><br><span>if</span>(<span>F</span>){<br>  <span>## Assigning cell type identity to clusters</span><br>  new.cluster.ids &lt;- c(<span>"Naive CD4 T"</span>, <span>"CD14+ Mono"</span>, <span>"Memory CD4 T"</span>, <span>"B"</span>, <span>"CD8 T"</span>,<br>                       <span>"FCGR3A+ Mono"</span>, <span>"NK"</span>, <span>"DC"</span>, <span>"Platelet"</span>)<br>  names(new.cluster.ids) &lt;- levels(maize)<br>  maize &lt;- RenameIdents(maize, new.cluster.ids)<br>} <br></code></pre><p data-tool="mdnice编辑器">出图 如下所示：</p><p><img data-galleryid="" data-ratio="0.63671875" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxC5TcxzuzzaHQENm48NPPXrjRLWP70bl02ryvf3444k6QnhaXWYich8ekuJLjqZ2pLdqvgcJN8z2g/640?wx_fmt=png" data-type="png" data-w="2048" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxC5TcxzuzzaHQENm48NPPXrjRLWP70bl02ryvf3444k6QnhaXWYich8ekuJLjqZ2pLdqvgcJN8z2g/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>奇奇怪怪的基因名字</figcaption></figure><p data-tool="mdnice编辑器">可以看到这些基因名字都是加上了一个前缀  Zm00001，我不知道为什么这个玉米物种的数据库的特殊性版本啊！</p><h3 data-tool="mdnice编辑器"><span></span><span>看到了这里如果你10分钟无法完成我们这个教程的两个核心图表</span><span></span></h3><p data-tool="mdnice编辑器">说明你不懂R语言，不知道如何去安装我教程里面的提到的R包，不知道如何复制粘贴运行代码。</p><p data-tool="mdnice编辑器">当然了，出图并不意味着结束，我们确实是10分钟出来了这个Science杂志的玉米单细胞文章的数据处理的重要图表，可是我们对这个Science文献的理解完全没有任何增长。</p><p data-tool="mdnice编辑器">期待大家加入我们的单细胞交流群啊，只需要你找到感兴趣的单细胞文章，而且愿意分享它，我们就给你写代码分析它！</p><p data-tool="mdnice编辑器">你分享，我分析，强强联合！</p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p><img data-galleryid="" data-ratio="1.3826815642458101" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4ww1iapFCaLNqhhcpTSZUBACL88IS4H8OWU2jvV8NmO7DicWGIulnrgrx2uRDmJeVDicvoxQK5ibgULNkQ/640?wx_fmt=png" data-type="png" data-w="1074" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4ww1iapFCaLNqhhcpTSZUBACL88IS4H8OWU2jvV8NmO7DicWGIulnrgrx2uRDmJeVDicvoxQK5ibgULNkQ/640?wx_fmt=png"></p><p data-tool="mdnice编辑器">每晚九点，持续100次！欢迎对单细胞感兴趣的小伙伴加入一起讨论学习以及 提高！（入会密码是 1024 ）</p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">虽然说上面的代码都是复制粘贴即可运行，但是如果要更好地完成上面的图表，通常是需要掌握5个R包，分别是: <strong>scater,monocle,Seurat,scran,M3Drop</strong>，需要熟练掌握它们的对象，：<a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247489054&amp;idx=1&amp;sn=e154fe4c7d9a16dd2a5ec7830c551db3&amp;chksm=9b4856a5ac3fdfb3f5dee750f5a78dcbada8c9efbddd836d128620ec8d4ff49797e67341ea22&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">一些单细胞转录组R包的对象</a> 而且分析流程也大同小异：</p><ul data-tool="mdnice编辑器"><li><section>step1: 创建对象</section></li><li><section>step2: 质量控制</section></li><li><section>step3: 表达量的标准化和归一化</section></li><li><section>step4: 去除干扰因素(多个样本整合)</section></li><li><section>step5: 判断重要的基因</section></li><li><section>step6: 多种降维算法</section></li><li><section>step7: 可视化降维结果</section></li><li><section>step8: 多种聚类算法</section></li><li><section>step9: 聚类后找每个细胞亚群的标志基因</section></li><li><section>step10: 继续分类</section></li></ul><p data-tool="mdnice编辑器">单细胞转录组数据分析的标准降维聚类分群，并且进行生物学注释后的结果。可以参考前面的例子：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247497956&amp;idx=1&amp;sn=5d4deb7cf7b7848b3e2273cbd663bb6a&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">人人都能学会的单细胞聚类分群注释</a> ，我们演示了第一层次的分群。</p><p data-tool="mdnice编辑器">如果你对单细胞数据分析还没有基础认知，可以看基础10讲：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486076&amp;idx=1&amp;sn=52bb851d7dc23461233a2cf458736151&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">01. 上游分析流程</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486082&amp;idx=1&amp;sn=03cadceffb2c14ba95d97fe5caf38d94&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">02.课题多少个样品，测序数据量如何</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486088&amp;idx=1&amp;sn=3a115338ee4937d20caab78627237553&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">03. 过滤不合格细胞和基因（数据质控很重要）</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486096&amp;idx=1&amp;sn=1a99c4c5800b7e0287db3e8ef369fab8&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">04. 过滤线粒体核糖体基因</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486098&amp;idx=1&amp;sn=bf9a71df848d74fe665ce7d5e283d5ff&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">05. 去除细胞效应和基因效应</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486260&amp;idx=1&amp;sn=c6abf658de73594d1d77d8e1ffa7d153&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">06.单细胞转录组数据的降维聚类分群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486271&amp;idx=1&amp;sn=638b434b6deee63206af1c0eeda175ab&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">07.单细胞转录组数据处理之细胞亚群注释</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486278&amp;idx=1&amp;sn=91250ef733833ff00371818b215dc124&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">08.把拿到的亚群进行更细致的分群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486287&amp;idx=1&amp;sn=49627c638ff9c04418282c53518aa7c7&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">09.单细胞转录组数据处理之细胞亚群比例比较</a></section></li></ul></section><h3 data-tool="mdnice编辑器">写在文末</h3><p data-tool="mdnice编辑器"><span>咱们现在这个专栏《</span><span><strong><span>100个单细胞转录组数据降维聚类分群图表复现</span></strong></span><span>》分享的代码是到此为止，但是一般来说单细胞文章数据分析还有很多进阶图表制作，比如inferCNV看肿瘤拷贝数变异，monocle看拟时序等等。如果你也需要，可以加入我们这个<span>专栏《</span><span><strong><span>100个单细胞转录组数据降维聚类分群图表复现</span></strong></span><span>》</span>创作团队，获取进阶指引哦！见：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247503683&amp;idx=1&amp;sn=6872a7825afbcdf096f717dc78af0116&amp;chksm=9b4b8ff8ac3c06eebace288d15dafdbc183c067ba0e1c1c5150818c48aa271becc608c16a014&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" wah-hotarea="click">急！计划招募100个单细胞爱好者，免费学全套单细胞降维聚类分群和生物学亚群注释</a></span></p><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/YvhXhEV4DXRRU872XmI4Ag",target="_blank" rel="noopener noreferrer">原文链接</a>
