---
title: "制作非模式生物的单细胞参考基因组"
date: 2023-09-18T13:20:00Z
draft: ["false"]
tags: [
  "fetched",
  "芬菲随笔"
]
categories: ["Acdemic"]
---
制作非模式生物的单细胞参考基因组 by 芬菲随笔
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">本文分享的是前几年处理过的非模式生物如<span>毛果杨、牛、蝙蝠、鳝鱼、插入基因小鼠</span>等单细胞参考基因组的制作过程。</p><p data-tool="mdnice编辑器">制作参考基因组链接：https://support.10xgenomics.com/single-cell-gene-expression/software/release-notes/build#grch38_3.0.0</p><h1 data-tool="mdnice编辑器"><span></span><span>1、下载基因组和注释文件</span></h1><h2 data-tool="mdnice编辑器"><span></span><span>1-1 下载基因组和注释文件常用方式如NCBI、Ensembl</span></h2><pre data-tool="mdnice编辑器"><span></span><code><span># 下载基因组和注释文件</span><br>NCBI：https://www.genome.jp/kegg/catalog/org_list.html<br>Ensembl：https://asia.ensembl.org/info/data/ftp/index.html<br>10X：https://support.10xgenomics.com/single-cell-gene-expression/software/release-notes/build<span>#mm10_3.0.0</span><br></code></pre><pre data-tool="mdnice编辑器"><span></span><code><span># 毛果杨 Populus trichocarpa (black cottonwood)</span><br>wget ftp://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/002/775/GCF_000002775.4_Pop_tri_v3/GCF_000002775.4_Pop_tri_v3_genomic.fna.gz<br>wget ftp://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/002/775/GCF_000002775.4_Pop_tri_v3/GCF_000002775.4_Pop_tri_v3_genomic.gtf.gz<br><br><span># 牛 Bos taurus (cow)</span><br>axel -n 20 ftp://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/002/263/795/GCF_002263795.1_ARS-UCD1.2/GCF_002263795.1_ARS-UCD1.2_genomic.fna.gz<br>axel -n 20 https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/002/263/795/GCF_002263795.1_ARS-UCD1.2/GCF_002263795.1_ARS-UCD1.2_genomic.fna.gz<br><br>axel -n 20 ftp://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/002/263/795/GCF_002263795.1_ARS-UCD1.2/GCF_002263795.1_ARS-UCD1.2_genomic.gtf.gz<br><br><span># 蝙蝠 little brown (bat)</span><br>axel -n 20 https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/147/115/GCF_000147115.1_Myoluc2.0/GCF_000147115.1_Myoluc2.0_genomic.fna.gz<br>axel -n 20 https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/147/115/GCF_000147115.1_Myoluc2.0/GCF_000147115.1_Myoluc2.0_genomic.gtf.gz<br><br><span># 鳝鱼 monopterus albus (swamp eel)</span><br>axel -n 20 https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/001/952/655/GCF_001952655.1_M_albus_1.0/GCF_001952655.1_M_albus_1.0_genomic.fna.gz<br>wget https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/001/952/655/GCF_001952655.1_M_albus_1.0/GCF_001952655.1_M_albus_1.0_genomic.gtf.gz<br><br><span># 插入基因小鼠</span><br>axel -n 20 ftp://ftp.ensembl.org/pub/release-93/fasta/mus_musculus/dna/Mus_musculus.GRCm38.dna.primary_assembly.fa.gz<br>wget ftp://ftp.ensembl.org/pub/release-93/gtf/mus_musculus/Mus_musculus.GRCm38.93.gtf.gz<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>1-2 查看文件完整性</span></h2><pre data-tool="mdnice编辑器"><span></span><code><span># 查看下载文件</span><br>find ./ -name <span>"*.gz"</span> | xargs -i <span>echo</span> {}<br></code></pre><figure data-tool="mdnice编辑器"><figcaption><p><img data-galleryid="" data-ratio="0.4516765285996055" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXiaghgCc5gOGsfsyugureBMibmr0LceaBx3NnFMibtxVjSxobbHHpkMibicQ/640?wx_fmt=png" data-type="png" data-w="507" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXiaghgCc5gOGsfsyugureBMibmr0LceaBx3NnFMibtxVjSxobbHHpkMibicQ/640?wx_fmt=png"></p></figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code><span># 检查文件完整性</span><br>gzip -t *.gz <span># test compressed file integrity</span><br><br><span># 检查文件完整性</span><br>find ./ -name <span>"*.gz"</span> | xargs -i gzip -t {}<br><br><span># 解压压缩文件</span><br>find ./ -name <span>"*.gz"</span> | xargs -i gunzip {}<br></code></pre><h1 data-tool="mdnice编辑器"><span></span><span>2、制作参考基因组</span></h1><h2 data-tool="mdnice编辑器"><span></span><span>2-1 下载cellranger软件</span></h2><p data-tool="mdnice编辑器">https://support.10xgenomics.com/single-cell-gene-expression/software/downloads/latest?</p><figure data-tool="mdnice编辑器"><figcaption><p><img data-galleryid="" data-ratio="0.562037037037037" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXpHWBkWRan2oY9W1L74SuoW4am8BvdJ2BCH8Eyu1W0THYhNNqoyNs9g/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXpHWBkWRan2oY9W1L74SuoW4am8BvdJ2BCH8Eyu1W0THYhNNqoyNs9g/640?wx_fmt=png"></p><p><span><span>下载cellranger</span></span></p></figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code>wget -O cellranger-7.1.0.tar.gz <span>"https://cf.10xgenomics.com/releases/cell-exp/cellranger-7.1.0.tar.gz?Expires=1695046656&amp;Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cHM6Ly9jZi4xMHhnZW5vbWljcy5jb20vcmVsZWFzZXMvY2VsbC1leHAvY2VsbHJhbmdlci03LjEuMC50YXIuZ3oiLCJDb25kaXRpb24iOnsiRGF0ZUxlc3NUaGFuIjp7IkFXUzpFcG9jaFRpbWUiOjE2OTUwNDY2NTZ9fX1dfQ__&amp;Signature=d8omRVd2nl0y3uShZ~3GOo1NiwGXvo3FZHzhmPmbEzqWflLM86Dg6zXdJa9UIA9rulGEewBvGX5qkC0nP620hXKqFZp7-p0T1yYDaEiqBQ33QpOy7rrT7Ow0enZeOqfY6BZL2IY4LFV3WNN4PaCrDX64BHQ~EtdNYYpwuOFB8yhba3-46M4sKGrnhr2nMiy9j5VGT1IVajWYDCIjbNSprIqoqdEYPCG6HoGpaMXe0xRjgo7qr~lfjhcJDKiQJTm1ImvVb67P3nYHnXZzfWvJF74tDWHVyNtIrxfnHQcLjTgARNqoFcavU1XwgVm6kQUlFzznC8cmTk-1QVF61Whfeg__&amp;Key-Pair-Id=APKAI7S6A5RYOXBWRPDA"</span><br>tar -zxvf cellranger-7.1.0.tar.gz<br>cellranger=/home/data/t160457/ZFF/Year2023/softwares/cellranger-7.1.0/bin/cellranger<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>2-2 毛果杨pop</span></h2><p data-tool="mdnice编辑器">（1）设置变量</p><pre data-tool="mdnice编辑器"><span></span><code><span># cellranger软件目录</span><br>cellranger=/home/data/t160457/ZFF/Year2023/softwares/cellranger-7.1.0/bin/cellranger<br><br><span># 自定义的基因组名称</span><br>genome=pop<br><br><span># 基因组fasta文件</span><br>fasta=/home/data/t160457/ZFF/Year2023/ReferenceRaw/pop/GCF_000002775.4_Pop_tri_v3_genomic.fna<br><br><span># 基因组注释文件</span><br>rawgtf=/home/data/t160457/ZFF/Year2023/ReferenceRaw/pop/GCF_000002775.4_Pop_tri_v3_genomic.gtf<br><br><span># 过滤后的基因组注释文件</span><br>filteredgtf=<span>${rawgtf%.*}</span>.filtered.gtf<br></code></pre><p data-tool="mdnice编辑器">（2）运行cellranger mkgtf</p><pre data-tool="mdnice编辑器"><span></span><code><span># 确认变量是否正确设置</span><br><span># echo $cellranger $genome $fasta $filteredgtf</span><br><br><span>$cellranger</span> mkgtf <span>$rawgtf</span> <span>$filteredgtf</span> \<br>                 --attribute=gene_biotype:protein_coding \<br>                 --attribute=gene_biotype:lincRNA \<br>                 --attribute=gene_biotype:antisense \<br>                 --attribute=gene_biotype:IG_LV_gene \<br>                 --attribute=gene_biotype:IG_V_gene \<br>                 --attribute=gene_biotype:IG_V_pseudogene \<br>                 --attribute=gene_biotype:IG_D_gene \<br>                 --attribute=gene_biotype:IG_J_gene \<br>                 --attribute=gene_biotype:IG_J_pseudogene \<br>                 --attribute=gene_biotype:IG_C_gene \<br>                 --attribute=gene_biotype:IG_C_pseudogene \<br>                 --attribute=gene_biotype:TR_V_gene \<br>                 --attribute=gene_biotype:TR_V_pseudogene \<br>                 --attribute=gene_biotype:TR_D_gene \<br>                 --attribute=gene_biotype:TR_J_gene \<br>                 --attribute=gene_biotype:TR_J_pseudogene \<br>                 --attribute=gene_biotype:TR_C_gene<br></code></pre><figure data-tool="mdnice编辑器"><figcaption><p><img data-galleryid="" data-ratio="0.32592592592592595" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXB1vGDappLSZs2miafosrGnP96C1tzdSKqRrpvnjYphTiapEQJg58XmFg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXB1vGDappLSZs2miafosrGnP96C1tzdSKqRrpvnjYphTiapEQJg58XmFg/640?wx_fmt=png"></p></figcaption></figure><p data-tool="mdnice编辑器">（3）解决报错</p><pre data-tool="mdnice编辑器"><span></span><code><span># sed -i 's/?/+/' GCF_000002775.4_Pop_tri_v3_genomic.gtf，无效，提示有重复基因</span><br><span># sed -i '/?/d' GCF_000002775.4_Pop_tri_v3_genomic.gtf，无效</span><br><br><span># 查找重复行</span><br>cat GCF_000002775.4_Pop_tri_v3_genomic.gtf | awk <span>'$3 == "gene" {print $0}'</span>| cut -f9| cut -d <span>" "</span> -f2 |sort | uniq -d<br><br><span># 有两个基因存在重复</span><br>cat GCF_000002775.4_Pop_tri_v3_genomic.gtf | awk <span>'$3 == "gene" {print $0}'</span>| grep -nE <span>"Poptr_cp071|Poptr_cp091"</span><br></code></pre><figure data-tool="mdnice编辑器"><figcaption><p><img data-galleryid="" data-ratio="0.18378887841658811" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXpQ4QoiauI1EPLaY503sdzWusZvdYE9j1BUUEbUUuM1MfUdvWxngH42A/640?wx_fmt=png" data-type="png" data-w="1061" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXpQ4QoiauI1EPLaY503sdzWusZvdYE9j1BUUEbUUuM1MfUdvWxngH42A/640?wx_fmt=png"></p></figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code><span># 查看重复基因所在的行</span><br>cat -n GCF_000002775.4_Pop_tri_v3_genomic.gtf | awk <span>'$4 == "gene" {print $0}'</span> | cut -f1,10| grep -E <span>"Poptr_cp071|Poptr_cp091"</span><br><br><span># 确认重复基因所在的行</span><br>cat GCF_000002775.4_Pop_tri_v3_genomic.gtf | sed -n <span>'932598p'</span> <br><br><span># 删除重复基因所在的行</span><br>cat GCF_000002775.4_Pop_tri_v3_genomic.gtf | sed <span>'932598d;932762d'</span><br><br><span># 确认重复基因所否删除</span><br>cat GCF_000002775.4_Pop_tri_v3_genomic.gtf | sed <span>'932598d;932762d'</span> | awk <span>'$3 == "gene" {print $0}'</span>| cut -f9| cut -d <span>" "</span> -f2 |sort | uniq -d<br>cat GCF_000002775.4_Pop_tri_v3_genomic.gtf | sed <span>'932598d;932762d'</span> | awk <span>'$3 == "gene" {print $0}'</span>| cut -f9| cut -d <span>" "</span> -f2 | grep -E <span>"Poptr_cp071|Poptr_cp091"</span><br><br><span># 保存删除重复基因后的注释文件</span><br>sed -i <span>'932598d;932762d'</span> GCF_000002775.4_Pop_tri_v3_genomic.gtf<br>sed -i <span>'/?/d'</span> GCF_000002775.4_Pop_tri_v3_genomic.gtf<br><br><span># 再次mkgtf</span></code></pre><figure data-tool="mdnice编辑器"><figcaption><p><img data-galleryid="" data-ratio="0.175" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXK3A0YRZfSd2tx5GibSdssaNam1qkMjEp7eiaqzJfYMzmDm217cAYgbOQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXK3A0YRZfSd2tx5GibSdssaNam1qkMjEp7eiaqzJfYMzmDm217cAYgbOQ/640?wx_fmt=png"></p></figcaption></figure><p data-tool="mdnice编辑器">（4）再次运行mkgtf和mkref</p><pre data-tool="mdnice编辑器"><span></span><code><span># mkref</span><br><span>$cellranger</span> mkref --genome=<span>$genome</span> \<br>                 --fasta=<span>$fasta</span> \<br>                 --genes=<span>$filteredgtf</span><br></code></pre><figure data-tool="mdnice编辑器"><figcaption><p><img data-galleryid="" data-ratio="0.5793201133144475" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXQPkyhs55LcQy5HQTjgicnF0mNgbWNYwpIWDx5qI8jFgFwG45EGNiaoOw/640?wx_fmt=png" data-type="png" data-w="706" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXQPkyhs55LcQy5HQTjgicnF0mNgbWNYwpIWDx5qI8jFgFwG45EGNiaoOw/640?wx_fmt=png"></p></figcaption></figure><figure data-tool="mdnice编辑器"><figcaption><p><img data-galleryid="" data-ratio="0.589238845144357" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXsRkCqDKmViaB0bb1SzHv3ORZxeSf6q7TNibKONDz5gfyY9TOC3FA34qw/640?wx_fmt=png" data-type="png" data-w="762" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXsRkCqDKmViaB0bb1SzHv3ORZxeSf6q7TNibKONDz5gfyY9TOC3FA34qw/640?wx_fmt=png"></p></figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>2-3 牛cow</span></h2><p data-tool="mdnice编辑器">（1）设置变量</p><pre data-tool="mdnice编辑器"><span></span><code><span># cellranger软件目录</span><br>cellranger=/home/data/t160457/ZFF/Year2023/softwares/cellranger-7.1.0/bin/cellranger<br><br><span># 自定义的基因组名称</span><br>genome=cow<br><br><span># 基因组fasta文件</span><br>fasta=/home/data/t160457/ZFF/Year2023/ReferenceRaw/cow/GCF_002263795.1_ARS-UCD1.2_genomic.fna<br><br><span># 基因组注释文件</span><br>rawgtf=/home/data/t160457/ZFF/Year2023/ReferenceRaw/cow/GCF_002263795.1_ARS-UCD1.2_genomic.gtf<br><br><span># 过滤后的基因组注释文件</span><br>filteredgtf=<span>${rawgtf%.*}</span>.filtered.gtf<br></code></pre><p data-tool="mdnice编辑器">（2）运行cellranger mkgtf</p><pre data-tool="mdnice编辑器"><span></span><code><span># 确认变量是否正确设置</span><br><span># echo $cellranger $genome $fasta $filteredgtf</span><br><br><span>$cellranger</span> mkgtf <span>$rawgtf</span> <span>$filteredgtf</span> \<br>                 --attribute=gene_biotype:protein_coding \<br>                 --attribute=gene_biotype:lincRNA \<br>                 --attribute=gene_biotype:antisense \<br>                 --attribute=gene_biotype:IG_LV_gene \<br>                 --attribute=gene_biotype:IG_V_gene \<br>                 --attribute=gene_biotype:IG_V_pseudogene \<br>                 --attribute=gene_biotype:IG_D_gene \<br>                 --attribute=gene_biotype:IG_J_gene \<br>                 --attribute=gene_biotype:IG_J_pseudogene \<br>                 --attribute=gene_biotype:IG_C_gene \<br>                 --attribute=gene_biotype:IG_C_pseudogene \<br>                 --attribute=gene_biotype:TR_V_gene \<br>                 --attribute=gene_biotype:TR_V_pseudogene \<br>                 --attribute=gene_biotype:TR_D_gene \<br>                 --attribute=gene_biotype:TR_J_gene \<br>                 --attribute=gene_biotype:TR_J_pseudogene \<br>                 --attribute=gene_biotype:TR_C_gene</code></pre><figure data-tool="mdnice编辑器"><figcaption><p><img data-galleryid="" data-ratio="0.3901734104046243" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXBrl304XoiaU1FBtG2WWgSXa1z7lkWXnmpnzXVSKs1Z8onkic3gnKNH0Q/640?wx_fmt=png" data-type="png" data-w="1038" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXBrl304XoiaU1FBtG2WWgSXa1z7lkWXnmpnzXVSKs1Z8onkic3gnKNH0Q/640?wx_fmt=png"></p></figcaption></figure><p data-tool="mdnice编辑器">（3）解决报错</p><pre data-tool="mdnice编辑器"><span></span><code><span># 删除gene_id列为空的行</span><br>cat GCF_002263795.1_ARS-UCD1.2_genomic.gtf | grep -v <span>'gene_id ""'</span> &gt; GCF_002263795.1_ARS-UCD1.2_genomic2.gtf<br><br><span># 确认gene_id列为空的行是否删除</span><br>cat GCF_002263795.1_ARS-UCD1.2_genomic2.gtf | grep <span>'gene_id ""'</span> <br><br><span># 修改rawgtf变量名</span><br>rawgtf=/home/data/t160457/ZFF/Year2023/ReferenceRaw/cow/GCF_002263795.1_ARS-UCD1.2_genomic2.gtf<br></code></pre><p data-tool="mdnice编辑器">（4）再次运行mkgtf和mkref</p><p><img data-galleryid="" data-ratio="0.5824964131994261" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXcvXQbHAaooYpyVDicZumazWKYibZUEibTPScuNYE2VBrUXQky3eWkiaBBw/640?wx_fmt=png" data-type="png" data-w="697" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXcvXQbHAaooYpyVDicZumazWKYibZUEibTPScuNYE2VBrUXQky3eWkiaBBw/640?wx_fmt=png"></p><p><br></p><pre data-tool="mdnice编辑器"><span></span><code><span># mkref</span><br><span>$cellranger</span> mkref --genome=<span>$genome</span> \<br>                 --fasta=<span>$fasta</span> \<br>                 --genes=<span>$filteredgtf</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>2-4 蝙蝠bat</span></h2><p data-tool="mdnice编辑器">（1）设置变量</p><pre data-tool="mdnice编辑器"><span></span><code><span># cellranger软件目录</span><br>cellranger=/home/data/t160457/ZFF/Year2023/softwares/cellranger-7.1.0/bin/cellranger<br><br><span># 自定义的基因组名称</span><br>genome=bat<br><br><span># 基因组fasta文件</span><br>fasta=/home/data/t160457/ZFF/Year2023/ReferenceRaw/bat/GCF_000147115.1_Myoluc2.0_genomic.fna<br><br><span># 基因组注释文件</span><br>rawgtf=/home/data/t160457/ZFF/Year2023/ReferenceRaw/bat/GCF_000147115.1_Myoluc2.0_genomic.gtf<br><br><span># 过滤后的基因组注释文件</span><br>filteredgtf=<span>${rawgtf%.*}</span>.filtered.gtf<br></code></pre><p data-tool="mdnice编辑器">（2）运行cellranger mkgtf</p><pre data-tool="mdnice编辑器"><span></span><code><span># 确认变量是否正确设置</span><br><span># echo $cellranger $genome $fasta $filteredgtf</span><br><br><span>$cellranger</span> mkgtf <span>$rawgtf</span> <span>$filteredgtf</span> \<br>                 --attribute=gene_biotype:protein_coding \<br>                 --attribute=gene_biotype:lincRNA \<br>                 --attribute=gene_biotype:antisense \<br>                 --attribute=gene_biotype:IG_LV_gene \<br>                 --attribute=gene_biotype:IG_V_gene \<br>                 --attribute=gene_biotype:IG_V_pseudogene \<br>                 --attribute=gene_biotype:IG_D_gene \<br>                 --attribute=gene_biotype:IG_J_gene \<br>                 --attribute=gene_biotype:IG_J_pseudogene \<br>                 --attribute=gene_biotype:IG_C_gene \<br>                 --attribute=gene_biotype:IG_C_pseudogene \<br>                 --attribute=gene_biotype:TR_V_gene \<br>                 --attribute=gene_biotype:TR_V_pseudogene \<br>                 --attribute=gene_biotype:TR_D_gene \<br>                 --attribute=gene_biotype:TR_J_gene \<br>                 --attribute=gene_biotype:TR_J_pseudogene \<br>                 --attribute=gene_biotype:TR_C_gene<br></code></pre><figure data-tool="mdnice编辑器"><figcaption><p><img data-galleryid="" data-ratio="0.5816993464052288" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXrh9X0LbUSo3W1hyJJ3mD7ZnZs0wU6nHX7zL64JNib3k4Ts0VgndKESg/640?wx_fmt=png" data-type="png" data-w="765" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXrh9X0LbUSo3W1hyJJ3mD7ZnZs0wU6nHX7zL64JNib3k4Ts0VgndKESg/640?wx_fmt=png"></p></figcaption></figure><p data-tool="mdnice编辑器">（3）解决报错</p><p data-tool="mdnice编辑器">没有报错</p><p data-tool="mdnice编辑器">（4）再次运行mkgtf和mkref</p><pre data-tool="mdnice编辑器"><span></span><code><span># mkref</span><br><span>$cellranger</span> mkref --genome=<span>$genome</span> \<br>                 --fasta=<span>$fasta</span> \<br>                 --genes=<span>$filteredgtf</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>2-5 鳝鱼fish</span></h2><p data-tool="mdnice编辑器">（1）设置变量</p><pre data-tool="mdnice编辑器"><span></span><code><span># cellranger软件目录</span><br>cellranger=/home/data/t160457/ZFF/Year2023/softwares/cellranger-7.1.0/bin/cellranger<br><br><span># 自定义的基因组名称</span><br>genome=fish<br><span># 基因组fasta文件</span><br>fasta=/home/data/t160457/ZFF/Year2023/ReferenceRaw/fish/GCF_001952655.1_M_albus_1.0_genomic.fna<br><span># 基因组注释文件</span><br>rawgtf=/home/data/t160457/ZFF/Year2023/ReferenceRaw/fish/GCF_001952655.1_M_albus_1.0_genomic.gtf<br><br><span># 过滤后的基因组注释文件</span><br>filteredgtf=<span>${rawgtf%.*}</span>.filtered.gtf<br></code></pre><p data-tool="mdnice编辑器">（2）运行cellranger mkgtf</p><pre data-tool="mdnice编辑器"><span></span><code><span># 确认变量是否正确设置</span><br><span># echo $cellranger $genome $fasta $filteredgtf</span><br><br><span>$cellranger</span> mkgtf <span>$rawgtf</span> <span>$filteredgtf</span> \<br>                 --attribute=gene_biotype:protein_coding \<br>                 --attribute=gene_biotype:lincRNA \<br>                 --attribute=gene_biotype:antisense \<br>                 --attribute=gene_biotype:IG_LV_gene \<br>                 --attribute=gene_biotype:IG_V_gene \<br>                 --attribute=gene_biotype:IG_V_pseudogene \<br>                 --attribute=gene_biotype:IG_D_gene \<br>                 --attribute=gene_biotype:IG_J_gene \<br>                 --attribute=gene_biotype:IG_J_pseudogene \<br>                 --attribute=gene_biotype:IG_C_gene \<br>                 --attribute=gene_biotype:IG_C_pseudogene \<br>                 --attribute=gene_biotype:TR_V_gene \<br>                 --attribute=gene_biotype:TR_V_pseudogene \<br>                 --attribute=gene_biotype:TR_D_gene \<br>                 --attribute=gene_biotype:TR_J_gene \<br>                 --attribute=gene_biotype:TR_J_pseudogene \<br>                 --attribute=gene_biotype:TR_C_gene<br></code></pre><figure data-tool="mdnice编辑器"><figcaption><p><img data-galleryid="" data-ratio="0.5558698727015559" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXx2xaUqcicictiaZpHciaOa5hcWWtRicvWtPw5TnRZBibrpSeP4DibkouJ1Evw/640?wx_fmt=png" data-type="png" data-w="707" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXx2xaUqcicictiaZpHciaOa5hcWWtRicvWtPw5TnRZBibrpSeP4DibkouJ1Evw/640?wx_fmt=png"></p></figcaption></figure><p data-tool="mdnice编辑器">（3）解决报错</p><p data-tool="mdnice编辑器">没有报错</p><p data-tool="mdnice编辑器">（4）再次运行mkgtf和mkref</p><pre data-tool="mdnice编辑器"><span></span><code><span># mkref</span><br><span>$cellranger</span> mkref --genome=<span>$genome</span> \<br>                 --fasta=<span>$fasta</span> \<br>                 --genes=<span>$filteredgtf</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>2-6 插入基因小鼠mouse</span></h2><p data-tool="mdnice编辑器">（1）制作插入基因的注释文件</p><p data-tool="mdnice编辑器">注释文件格式：https://zhuanlan.zhihu.com/p/283198445</p><pre data-tool="mdnice编辑器"><span></span><code><span># 查看插入基因序列</span><br>cat two_genes.fa<br><br><span># 统计两个插入基因长度</span><br>cat two_genes.fa | paste - - | awk <span>'{print $1, length($2)}'</span><br>&gt;geneA_contig 1881<br>&gt;geneB_contig 3936<br></code></pre><figure data-tool="mdnice编辑器"><figcaption><p><img data-galleryid="" data-ratio="0.5625879043600562" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXUJicEU2T5Yic2vmD5KSdDr0RkTgZRKqiaPopnnyKdgR0mZ0euBdVyiaNMw/640?wx_fmt=png" data-type="png" data-w="711" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXUJicEU2T5Yic2vmD5KSdDr0RkTgZRKqiaPopnnyKdgR0mZ0euBdVyiaNMw/640?wx_fmt=png"></p></figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code><span># 根据fasta制作gtf文件</span><br><span># 假设插入基因为基因组中两个组装短contig，制作gtf文件</span><br><br><br><span># 合并插入基因的fasta和gtf文件到小鼠中</span><br>cat Mus_musculus.GRCm38.dna.primary_assembly.fa two_genes.fa &gt; genome.fa<br>cat Mus_musculus.GRCm38.93.gtf two_genes.gtf &gt; genome.gtf<br><br></code></pre><figure data-tool="mdnice编辑器"><figcaption><p><img data-galleryid="" data-ratio="0.30185185185185187" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXVgWGNVa1HS2Be1POib8eXgltzA4bjDXF2jZ8Rk15z0JCcsAHkk4LW3g/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXVgWGNVa1HS2Be1POib8eXgltzA4bjDXF2jZ8Rk15z0JCcsAHkk4LW3g/640?wx_fmt=png"></p></figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code><span># 确认合并后的gtf文件</span><br>tail genome.gtf<br>tail genome.fa<br></code></pre><figure data-tool="mdnice编辑器"><figcaption><p><img data-galleryid="" data-ratio="0.5052631578947369" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXMiam08BoXbicTCptzOialia6vWxqjLdTxu6aHIrKuicI4kAkboZ4EeTgGibA/640?wx_fmt=png" data-type="png" data-w="760" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXMiam08BoXbicTCptzOialia6vWxqjLdTxu6aHIrKuicI4kAkboZ4EeTgGibA/640?wx_fmt=png"></p></figcaption></figure><figure data-tool="mdnice编辑器"><figcaption><p><img data-galleryid="" data-ratio="0.8333333333333334" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXyKXmqGxfT41ckiaOU74iaU2icSRVuxvG23NS7EF9ic2zLFGpdcSAjiaiaU1w/640?wx_fmt=png" data-type="png" data-w="558" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzXyKXmqGxfT41ckiaOU74iaU2icSRVuxvG23NS7EF9ic2zLFGpdcSAjiaiaU1w/640?wx_fmt=png"></p></figcaption></figure><p data-tool="mdnice编辑器">（2）设置变量</p><pre data-tool="mdnice编辑器"><span></span><code><span># cellranger软件目录</span><br>cellranger=/home/data/t160457/ZFF/Year2023/softwares/cellranger-7.1.0/bin/cellranger<br><br><span># 自定义的基因组名称</span><br>genome=mouse<br><br><span># 基因组fasta文件</span><br>fasta=/home/data/t160457/ZFF/Year2023/ReferenceRaw/mouse/genome.fa<br><br><span># 基因组注释文件</span><br>rawgtf=/home/data/t160457/ZFF/Year2023/ReferenceRaw/mouse/genome.gtf<br><br><span># 过滤后的基因组注释文件</span><br>filteredgtf=<span>${rawgtf%.*}</span>.filtered.gtf<br></code></pre><p data-tool="mdnice编辑器">（3）运行cellranger mkgtf</p><pre data-tool="mdnice编辑器"><span></span><code><span># 确认变量是否正确设置</span><br><span># echo $cellranger $genome $fasta $filteredgtf</span><br><br><span>$cellranger</span> mkgtf <span>$rawgtf</span> <span>$filteredgtf</span> \<br>                 --attribute=gene_biotype:protein_coding \<br>                 --attribute=gene_biotype:lincRNA \<br>                 --attribute=gene_biotype:antisense \<br>                 --attribute=gene_biotype:IG_LV_gene \<br>                 --attribute=gene_biotype:IG_V_gene \<br>                 --attribute=gene_biotype:IG_V_pseudogene \<br>                 --attribute=gene_biotype:IG_D_gene \<br>                 --attribute=gene_biotype:IG_J_gene \<br>                 --attribute=gene_biotype:IG_J_pseudogene \<br>                 --attribute=gene_biotype:IG_C_gene \<br>                 --attribute=gene_biotype:IG_C_pseudogene \<br>                 --attribute=gene_biotype:TR_V_gene \<br>                 --attribute=gene_biotype:TR_V_pseudogene \<br>                 --attribute=gene_biotype:TR_D_gene \<br>                 --attribute=gene_biotype:TR_J_gene \<br>                 --attribute=gene_biotype:TR_J_pseudogene \<br>                 --attribute=gene_biotype:TR_C_gene<br></code></pre><figure data-tool="mdnice编辑器"><figcaption><p><img data-galleryid="" data-ratio="0.5823293172690763" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzX4icEr2bPae5VUoMDmgaiape86LvvXPF6ZSe8KJJBibia3vPgnRVSNcx8Fw/640?wx_fmt=png" data-type="png" data-w="747" src="https://mmbiz.qpic.cn/sz_mmbiz_png/9YXSPb9ydSa8ibH6QPCYLI4QsgIRJzRzX4icEr2bPae5VUoMDmgaiape86LvvXPF6ZSe8KJJBibia3vPgnRVSNcx8Fw/640?wx_fmt=png"></p></figcaption></figure><p data-tool="mdnice编辑器">（4）解决报错</p><p data-tool="mdnice编辑器">（5）再次运行mkgtf和mkref</p><pre data-tool="mdnice编辑器"><span></span><code><span># mkref</span><br><span>$cellranger</span> mkref --genome=<span>$genome</span> \<br>                 --fasta=<span>$fasta</span> \<br>                 --genes=<span>$filteredgtf</span><br></code></pre><h1 data-tool="mdnice编辑器"><span></span><span>3、使用参考基因组</span></h1><p data-tool="mdnice编辑器">cellranger count</p><pre data-tool="mdnice编辑器"><span></span><code><span># fastq文件命名规则：</span><br>https://www.10xgenomics.com/support/software/cell-ranger/analysis/inputs/cr-specifying-fastqs<br>[Sample Name]_S1_L00[Lane Number]_[Read Type]_001.fastq.gz Where Read Type is one of:<br><br>例如，fastq文件为<br>YS_S1_L001_R1_001.fastq.gz<br>YS_S1_L001_R2_001.fastq.gz<br>此时，SampleName=YS<br><span>$INDEX</span>=/home/data/t160457/ZFF/Year2023/ReferenceRaw/pop/pop<br><span>$fastq</span>=fastq_directory<br><br><span># cellranger count</span><br>cellranger count --id=<span>$sample</span><br>             --transcriptome=<span>$INDEX</span><br>             --fastqs=<span>$fastq</span><br>             --sample=<span>$sample</span><br></code></pre></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/EG9MxTo9_LsNovOymqBS4g",target="_blank" rel="noopener noreferrer">原文链接</a>
