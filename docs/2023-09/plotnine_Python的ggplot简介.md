---
title: "plotnine：Python的ggplot简介"
date: 2023-09-22T04:44:46Z
draft: ["false"]
tags: [
  "fetched",
  "空间数据分析学习笔记"
]
categories: ["Acdemic"]
---
plotnine：Python的ggplot简介 by 空间数据分析学习笔记
------
<div><p><span>数据可视化是以图形、图表或绘图的形式显示数据的技术。可视化数据更容易分析数据中可能存在的趋势或模式。plotine模仿R语言中的ggplot2库，通常被称为Python的ggplot2，其API与R语言中的ggplot2非常相似。ggplot2是基于图形语法的。</span></p><h3><span>图形语法</span></h3><p><span>采用图层的设计方式，图层之间的叠加是靠“+”实现的，越往后，其图层越在上方。</span></p><p><img data-galleryid="" data-ratio="0.5282296650717704" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EQiaLhsRGAaQdWxEa9G4crb12KCzibJy4RCCTbtEib7Xan8Yepaib9qgiaDw/640?wx_fmt=png" data-type="png" data-w="1045" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EQiaLhsRGAaQdWxEa9G4crb12KCzibJy4RCCTbtEib7Xan8Yepaib9qgiaDw/640?wx_fmt=png"></p><p><span>组成：</span></p><p><span>1.数据是用于绘制绘图的数据集。</span></p><p><span>2.美学（Aesthetics，aes）是数据变量和绘图函数参数之间的映射，例如x轴、y轴、颜色、填充、大小、标签、alpha、形状、线宽、线型。</span></p><p><span>3.几何对象Geometric Objects (geoms)是要使用的绘图类型或几何对象，例如点、线、直方图、条形图、箱线图等。</span></p><p><span>上面三个属于基本的组成部分，还可添加额外的信息使绘图更有意义和更具表现力。</span></p><p><span>1.分面允许将数据划分为组，并分别绘制每个组的图。</span></p><p><span>2.统计转换：在绘制数据之前先进行数据统计。</span></p><p><span>3.定义对象在二维平面中的位置。</span></p><p><span>4.主题定义：数据的表示形式，如字体、颜色等。</span></p><pre><span><span></span></span></pre><section><ul><li><li><li><li></ul><pre data-lang="python"><code><span><span># 安装</span></span></code><code><span><span># pip install plotnine</span></span></code><code><span><span>from</span> plotnine.data <span>import</span> mpg, presidential, economics</span></code><code><span>mpg.head(<span>5</span>)</span></code></pre></section><pre><span><span></span></span></pre><section><ul><li></ul><pre data-lang="css"><code><span><span>economics</span><span>.head</span>(5)</span></code></pre></section><pre><br></pre><p><span><span><span>散点图</span></span></span><span></span></p><section><ul><li></ul><pre data-lang="javascript"><code><span><span>from</span> plotnine <span>import</span> ggplot, aes, geom_point, labs, theme</span></code></pre></section><pre><span><span></span></span></pre><section><ul><li><li><li></ul><pre data-lang="makefile"><code><span>chart = ggplot(data=mpg, mapping=aes(x=<span>"hwy"</span>, y=<span>"cty"</span>))+</span></code><code><span>        geom_point()</span></code><code><span>chart</span></code></pre></section><pre><img data-ratio="0.75" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EosqyJ5kAFGcGrQ5tBHFT9UXo06olgTN8jibnwa2Ey1WybrZliam48icicQ/640?wx_fmt=png" data-type="png" data-w="1080" height="480" width="640" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EosqyJ5kAFGcGrQ5tBHFT9UXo06olgTN8jibnwa2Ey1WybrZliam48icicQ/640?wx_fmt=png"></pre><p><span></span></p><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>chart1=ggplot()+ geom_point(data=mpg,</span></code><code><span>                 mapping=aes(x=<span>"hwy"</span>, y=<span>"cty"</span>, color=<span>"cyl"</span>),</span></code><code><span>                    shape=<span>"^"</span>,</span></code><code><span>                    size=3,</span></code><code><span>                    alpha=0.8</span></code><code><span>                    )</span></code><code><span>chart1</span></code></pre></section><p><img data-ratio="0.75" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EOzUvxus5BGNlkQKW0mC6cf7xygvbS6VJgn3nn57CIKiaicwLqTNZMXGw/640?wx_fmt=png" data-type="png" data-w="1080" height="480" width="640" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EOzUvxus5BGNlkQKW0mC6cf7xygvbS6VJgn3nn57CIKiaicwLqTNZMXGw/640?wx_fmt=png"><span>添加轴标签和标题</span></p><pre><span><span></span></span></pre><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>chart = ggplot(data=mpg, mapping=aes(x=<span>"hwy"</span>, y=<span>"cty"</span>, shape=<span>"factor(cyl)"</span>, color=<span>"factor(cyl)"</span>))</span></code><code><span>points = geom_point(size=3,alpha=0.8)</span></code><code><span>labels = labs(x=<span>"Highway MPG"</span>, y=<span>"City MPG"</span>,</span></code><code><span>              title=<span>"Highway MPG vs City MPG Colored by Cylinders"</span>,</span></code><code><span>              shape=<span>"Cylinder"</span>, color=<span>"Cylinder"</span>)</span></code><code><span><br></span></code><code><span>scatter3 = chart + points + labels</span></code><code><span><br></span></code><code><span>scatter3</span></code></pre></section><pre><span><span></span><br></span></pre><p><img data-ratio="0.75" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EXAO5KXPJXjgib564DxB5OM8pyzXuN2DDuB3V5HibTOHshibZ1gZFzDR3g/640?wx_fmt=png" data-type="png" data-w="1080" height="480" width="640" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EXAO5KXPJXjgib564DxB5OM8pyzXuN2DDuB3V5HibTOHshibZ1gZFzDR3g/640?wx_fmt=png"></p><p><span>修改theme参数</span><span></span></p><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>chart = ggplot(data=mpg, mapping=aes(x=<span>"hwy"</span>, y=<span>"cty"</span>, size=<span>"displ"</span>))</span></code><code><span>points = geom_point(alpha=0.5)</span></code><code><span>labels = labs(x=<span>"Highway MPG"</span>, y=<span>"City MPG"</span>, </span></code><code><span>         title=<span>"Highway MPG vs City MPG by Engine Displacement"</span>, </span></code><code><span>        size=<span>"Engine Displacement"</span>)</span></code><code><span>theme_grammer = theme(figure_size=(10,5))</span></code><code><span>scatter4 = chart + points + labels + theme_grammer</span></code><code><span>scatter4</span></code></pre></section><p><img data-ratio="0.5" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1Eo3oXaMpswmGwSMq3cawhjPTY4NEibyMTebPENvZe8UrbicR9xZslUtaQ/640?wx_fmt=png" data-type="png" data-w="1080" height="500" width="1000" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1Eo3oXaMpswmGwSMq3cawhjPTY4NEibyMTebPENvZe8UrbicR9xZslUtaQ/640?wx_fmt=png"></p><pre><span></span></pre><p><span>利用qplot（）方法，只需一行代码就可以快速创建一个图。</span></p><pre><span><span></span></span></pre><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="javascript"><code><span><span>from</span> plotnine <span>import</span> qplot</span></code><code><span><br></span></code><code><span>scatter5 = qplot(x=<span>"hwy"</span>,y=<span>"cty"</span>, data=mpg, geom=<span>"point"</span>, </span></code><code><span>                 color=<span>"factor(cyl)"</span>,</span></code><code><span>                 xlab=<span>"Highway MPG"</span>, ylab=<span>"City MPG"</span>,</span></code><code><span>                 main=<span>"Highway MPG vs City MPG by Cylinder"</span></span></code><code><span>                )</span></code><code><span>scatter5</span></code></pre></section><pre><span><span></span><br></span></pre><p><img data-ratio="0.75" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EX7jvNYAicLyh9Vc6wce4r7R3MBK3Mic6IRdLcIqSYepacsOQvvonXSDg/640?wx_fmt=png" data-type="png" data-w="1080" height="480" width="640" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EX7jvNYAicLyh9Vc6wce4r7R3MBK3Mic6IRdLcIqSYepacsOQvvonXSDg/640?wx_fmt=png"></p><pre><span></span></pre><p><span>柱状图</span></p><pre><span><span></span></span></pre><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>from plotnine import geom_bar</span></code><code><span>chart = ggplot(data=mpg, mapping=aes(x=<span>"manufacturer"</span>))</span></code><code><span>bars = geom_bar()</span></code><code><span>labels = labs(x=<span>"Manufacturer"</span>, y=<span>"Model Counts"</span>, </span></code><code><span>        title=<span>"Model per Manufacturer"</span>)</span></code><code><span>theme_grammer = theme(figure_size=(11,5))</span></code><code><span>bar1 = chart + bars + labels + theme_grammer</span></code><code><span>bar1</span></code></pre></section><pre><span><span></span><br></span></pre><p><img data-ratio="0.4546296296296296" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1E0P71BWkmuuqj5yJGXUzo6mfyX9FjLm5fFkUMKLJI7sh7fnj2evXMCQ/640?wx_fmt=png" data-type="png" data-w="1080" height="500" width="1100" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1E0P71BWkmuuqj5yJGXUzo6mfyX9FjLm5fFkUMKLJI7sh7fnj2evXMCQ/640?wx_fmt=png"><span></span></p><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>chart = ggplot(data=mpg, mapping=aes(x=<span>"manufacturer"</span>, fill=<span>"factor(cyl)"</span>))</span></code><code><span>bars = geom_bar()</span></code><code><span>labels = labs(x=<span>"Manufacturer"</span>, y=<span>"Model Counts"</span>, </span></code><code><span>    title=<span>"Model Counts per Manufacturer colored by Cylinder"</span>)</span></code><code><span>theme_grammer = theme(figure_size=(11,5))</span></code><code><span>bar2 = chart + bars + labels + theme_grammer</span></code><code><span>bar2</span></code></pre></section><p><img data-ratio="0.4546296296296296" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1ETFa6uTRDrkKtRicgU5LAsul3ParoUia2ic2RW2XO7m3PiakXrTfvBmkhpQ/640?wx_fmt=png" data-type="png" data-w="1080" height="500" width="1100" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1ETFa6uTRDrkKtRicgU5LAsul3ParoUia2ic2RW2XO7m3PiakXrTfvBmkhpQ/640?wx_fmt=png"><br></p><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>from plotnine import coord_flip</span></code><code><span>chart = ggplot(data=mpg, mapping=aes(x=<span>"manufacturer"</span>, fill=<span>"factor(cyl)"</span>))</span></code><code><span>bars = geom_bar()</span></code><code><span>labels = labs(x=<span>"Manufacturer"</span>, y=<span>"Model Counts"</span>, </span></code><code><span>          title=<span>"Model Counts per Manufacturer colored by Cylinder"</span>, </span></code><code><span>          fill=<span>"Cylinder"</span>)</span></code><code><span>theme_grammer = theme(figure_size=(8,6))</span></code><code><span>bar3 = chart + bars + labels + theme_grammer</span></code></pre></section><p><span><span></span><br><span>bar3</span> <span>+</span> <span>coord_flip</span><span>()</span><br></span></p><p><img data-ratio="0.75" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EibDJYRQUHZW47gfxFiaIiaEA4EibcgjkZEKZqlpz6D4ubTeZJKxw61u5NQ/640?wx_fmt=png" data-type="png" data-w="1080" height="600" width="800" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EibDJYRQUHZW47gfxFiaIiaEA4EibcgjkZEKZqlpz6D4ubTeZJKxw61u5NQ/640?wx_fmt=png"></p><p><span></span></p><section><ul><li><li></ul><pre data-lang="makefile"><code><span>mpg_by_manuf = mpg.groupby(by=<span>"manufacturer"</span>).mean(numeric_only=True).reset_index()</span></code><code><span>mpg_by_manuf.head(3)</span></code></pre></section><pre><span><span></span></span></pre><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>from plotnine import geom_col, geom_text</span></code><code><span>chart = ggplot(data=mpg_by_manuf, mapping=aes(x=<span>"manufacturer"</span>, y=<span>"hwy"</span>))</span></code><code><span>bars = geom_col()</span></code><code><span>labels = labs(x=<span>"Manufacturer"</span>, y=<span>"Highway MPG"</span>, title=<span>"Average Highway MPG per Manufacturer"</span>)</span></code><code><span>theme_grammer = theme(figure_size=(11,5.5))</span></code><code><span>text = geom_text(mapping=aes(label=<span>"hwy"</span>), format_string='{:.2f}', va=<span>"bottom"</span>)</span></code><code><span>bar4 = chart + bars + labels + theme_grammer + text</span></code><code><span>bar4</span></code></pre></section><pre><span><span></span><br></span></pre><p><img data-ratio="0.5" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EqCYBo7YhxOCUPyo1jHXvUf3nV1HutV69O3ricmXp6acx2435RopYt9Q/640?wx_fmt=png" data-type="png" data-w="1080" height="550" width="1100" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EqCYBo7YhxOCUPyo1jHXvUf3nV1HutV69O3ricmXp6acx2435RopYt9Q/640?wx_fmt=png"></p><p><span></span></p><section><ul><li><li><li><li></ul><pre data-lang="makefile"><code><span>mpg_by_manuf_cyl = mpg.groupby(by=[<span>"manufacturer"</span>,<span>"cyl"</span>])\</span></code><code><span>    .mean(numeric_only=True)\</span></code><code><span>    .loc[[<span>"audi"</span>, <span>"chevrolet"</span>, <span>"dodge"</span>, <span>"volkswagen"</span>]].dropna().reset_index()</span></code><code><span><span># mpg_by_manuf_cyl</span></span></code></pre></section><pre><span><span></span></span></pre><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>chart = ggplot(data=mpg_by_manuf_cyl, mapping=aes(x=<span>"manufacturer"</span>, y=<span>"hwy"</span>, fill=<span>"factor(cyl)"</span>))</span></code><code><span>bars = geom_col(position=<span>"dodge"</span>)</span></code><code><span>labels = labs(x=<span>"Manufacturer"</span>, y=<span>"Highway MPG"</span>,</span></code><code><span>              title=<span>"Average Highway MPG per Manufacturer by Cylinder"</span>,</span></code><code><span>              fill=<span>"Cylinder"</span></span></code><code><span>             )</span></code><code><span>theme_grammer = theme(figure_size=(11,5.5))</span></code><code><span>bar5 = chart + bars + labels + theme_grammer</span></code><code><span>bar5</span></code></pre></section><pre><span><span></span><br></span></pre><p><img data-ratio="0.5" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EogGEqsTFibS1MkecxklW4HRRZwekOq46CM37QKYO8U1lEPJpZTiaDjLw/640?wx_fmt=png" data-type="png" data-w="1080" height="550" width="1100" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EogGEqsTFibS1MkecxklW4HRRZwekOq46CM37QKYO8U1lEPJpZTiaDjLw/640?wx_fmt=png"><span></span></p><pre><span><span></span></span></pre><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>from plotnine import position_dodge</span></code><code><span>chart = ggplot(data=mpg_by_manuf_cyl, mapping=aes(x=<span>"manufacturer"</span>, y=<span>"hwy"</span>, fill=<span>"factor(cyl)"</span>))</span></code><code><span>bars = geom_col(position=<span>"dodge"</span>)</span></code><code><span>labels = labs(x=<span>"Manufacturer"</span>, y=<span>"Highway MPG"</span>,</span></code><code><span>              title=<span>"Average Highway MPG per Manufacturer by Cylinder"</span>,</span></code><code><span>              fill=<span>"Cylinder"</span></span></code><code><span>             )</span></code><code><span>theme_grammer = theme(figure_size=(11,5.5))</span></code><code><span>text = geom_text(mapping=aes(label=<span>"hwy"</span>),</span></code><code><span>                 position=position_dodge(width=0.9),</span></code><code><span>                 format_string='{:.2f}', va=<span>"bottom"</span>)</span></code><code><span>bar6 = chart + bars + labels + theme_grammer + text</span></code><code><span>bar6</span></code></pre></section><pre><span><span></span><br></span></pre><p><img data-ratio="0.5" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EjadokQ3lObyfYwujjSNzM4RZiaiaJq8geLQWibWR5gvzUY9rfcGR6vH7A/640?wx_fmt=png" data-type="png" data-w="1080" height="550" width="1100" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EjadokQ3lObyfYwujjSNzM4RZiaiaJq8geLQWibWR5gvzUY9rfcGR6vH7A/640?wx_fmt=png"><span></span></p><pre><span><span></span></span></pre><section><ul><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>from plotnine import geom_line</span></code><code><span>chart = ggplot(data=economics)</span></code><code><span>line = geom_line(mapping=aes(x=<span>"date"</span>, y=<span>"pop"</span>))</span></code><code><span>labels = labs(x=<span>"Date"</span>, y=<span>"Population (thousands)"</span>, title=<span>"US Population Chart"</span>)</span></code><code><span>line_chart1 = chart + line + labels</span></code><code><span>line_chart1</span></code></pre></section><pre><span><span></span><br></span></pre><p><img data-ratio="0.75" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1E9qIbZ8pSTuibS8Q8SLm6ldXETsuxGz5tqFvkKKvh4icIE2H0R4j6LpFw/640?wx_fmt=png" data-type="png" data-w="1080" height="480" width="640" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1E9qIbZ8pSTuibS8Q8SLm6ldXETsuxGz5tqFvkKKvh4icIE2H0R4j6LpFw/640?wx_fmt=png"><span></span></p><pre><span><span></span></span></pre><section><ul><li><li><li></ul><pre data-lang="javascript"><code><span><span>import</span> pandas <span>as</span> pd</span></code><code><span>economics2 = pd.melt(economics, id_vars=[<span>"date"</span>], value_vars=[<span>"psavert"</span>, <span>"uempmed"</span>], var_name=<span>"Attributes"</span>, value_name=<span>"Attr_Value"</span>)</span></code><code><span>economics2.head()</span></code></pre></section><pre><span><span></span></span></pre><section><ul><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>chart = ggplot(data=economics2)</span></code><code><span>line = geom_line(mapping=aes(x=<span>"date"</span>, y=<span>"Attr_Value"</span>, color=<span>"Attributes"</span>))</span></code><code><span>labels = labs(x=<span>"Date"</span>, y=<span>""</span>, title=<span>"Personal Savings Rate/Unemployment Duration Line Chart"</span>)</span></code><code><span>line_chart2 = chart + line + labels</span></code><code><span>line_chart2</span></code></pre></section><pre><span><span></span><br></span></pre><p><img data-ratio="0.75" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EPpAVJCkoeMvGSCeUjKxMgAMb7yGQdeMUnh0ElnicPibXuy6rI2SuYGOg/640?wx_fmt=png" data-type="png" data-w="1080" height="480" width="640" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EPpAVJCkoeMvGSCeUjKxMgAMb7yGQdeMUnh0ElnicPibXuy6rI2SuYGOg/640?wx_fmt=png"><span>直方图</span></p><pre><span><span></span></span></pre><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>from plotnine import geom_histogram</span></code><code><span>chart = ggplot(data=mpg)</span></code><code><span>hist1 = geom_histogram(mapping=aes(x=<span>"cty"</span>), bins=15, binwidth=0.95, fill=<span>"red"</span>, alpha=0.5)</span></code><code><span>hist2 = geom_histogram(mapping=aes(x=<span>"hwy"</span>), bins=15, binwidth=0.95, fill=<span>"green"</span>, alpha=0.5)</span></code><code><span>labels = labs(x=<span>"City/Highway MPG"</span>, y=<span>"Freq"</span>, title=<span>"City/Highway MPG Histogram"</span>)</span></code><code><span>histogram2 = chart + hist1 + hist2 + labels</span></code><code><span>histogram2</span></code></pre></section><pre><span><span></span><br></span></pre><p><img data-ratio="0.75" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EtFZthm1XZMziaLYTicyxtSuEN4UCMDavmSK9uWEA3Pjia0WM0OgIrc4tw/640?wx_fmt=png" data-type="png" data-w="1080" height="480" width="640" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EtFZthm1XZMziaLYTicyxtSuEN4UCMDavmSK9uWEA3Pjia0WM0OgIrc4tw/640?wx_fmt=png"></p><pre><span></span></pre><h1><span>Heatmap</span></h1><pre><span><span></span></span></pre><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="powershell"><code><span>mpg_corr = mpg.corr(numeric_only=True)</span></code><code><span><span>data</span> = []</span></code><code><span><span>for</span> val1 <span>in</span> mpg_corr.index:</span></code><code><span>    <span>for</span> val2 <span>in</span> mpg_corr.columns:</span></code><code><span>        data.append([val1, val2, mpg_corr.loc[val1, val2]])</span></code><code><span>mpg_corr = pd.DataFrame(<span>data</span>=<span>data</span>, columns=[<span>"Val1"</span>, <span>"Val2"</span>, <span>"Correlation"</span>])</span></code><code><span><span>#mpg_corr</span></span></code></pre></section><pre><span><span></span></span></pre><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>from plotnine import geom_tile, geom_text</span></code><code><span>chart = ggplot(data=mpg_corr)</span></code><code><span>tile = geom_tile(mapping=aes(x=<span>"Val1"</span>, y=<span>"Val2"</span>, fill=<span>"Correlation"</span>))</span></code><code><span>text = geom_text(aes(x=<span>"Val1"</span>, y=<span>"Val2"</span>, label='Correlation'),format_string='{:.2f}', size=10)</span></code><code><span>labels = labs(x=<span>""</span>, y=<span>""</span>, title=<span>"MPG Dataset Columns Correlation Heatmap"</span>)</span></code><code><span>heatmap1 = chart + tile + text + labels</span></code><code><span>heatmap1</span></code></pre></section><pre><span><span></span><br></span></pre><p><img data-ratio="0.75" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1Ep7S9SwILjH5TRDJ0ibIVcVw1u5oD3VePWhmUuoyRNy4MPIib1tCPy3tA/640?wx_fmt=png" data-type="png" data-w="1080" height="480" width="640" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1Ep7S9SwILjH5TRDJ0ibIVcVw1u5oD3VePWhmUuoyRNy4MPIib1tCPy3tA/640?wx_fmt=png"><span></span></p><pre><span><span></span></span></pre><section><ul><li><li></ul><pre data-lang="javascript"><code><span><span>from</span> plotnine <span>import</span> scale_fill_cmap</span></code><code><span>heatmap1 + scale_fill_cmap(cmap_name=<span>"Purples"</span>)</span></code></pre></section><pre><span><span></span><br></span></pre><p><img data-ratio="0.75" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EhJZQFbGmf9dttPorOfYBVbYPJCmxwyIlRiaZ4PUhXgZ8Z99vO2Yl2vQ/640?wx_fmt=png" data-type="png" data-w="1080" height="480" width="640" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1EhJZQFbGmf9dttPorOfYBVbYPJCmxwyIlRiaZ4PUhXgZ8Z99vO2Yl2vQ/640?wx_fmt=png"><span></span></p><pre><span><span></span></span></pre><section><ul><li><li></ul><pre data-lang="ini"><code><span><span>mpg2</span> = mpg.groupby([<span>"manufacturer"</span>, <span>"class"</span>]).mean(numeric_only=<span>True</span>).fillna(<span>0</span>).reset_index()</span></code><code><span><span>#mpg2</span></span></code></pre></section><pre><span><span></span></span></pre><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span>from plotnine import scale_fill_cmap</span></code><code><span><br></span></code><code><span>chart = ggplot(data=mpg2)</span></code><code><span>tile = geom_tile(mapping=aes(x=<span>"class"</span>, y=<span>"manufacturer"</span>, fill=<span>"hwy"</span>, width=.98, height=.98))</span></code><code><span>text = geom_text(aes(x=<span>"class"</span>, y=<span>"manufacturer"</span>, label='hwy'),format_string='{:.2f} mpg', size=10)</span></code><code><span>labels = labs(x=<span>"Class"</span>, y=<span>"Manufacturer"</span>, title=<span>"Average Highway MPG per Manufacturer per Class"</span>,</span></code><code><span>              fill=<span>"Highway MPG"</span></span></code><code><span>             )</span></code><code><span>theme_grammer = theme(figure_size=(11,7))</span></code><code><span>heatmap2 = chart + tile + text + labels + theme_grammer + scale_fill_cmap(cmap_name=<span>"Blues"</span>)</span></code><code><span>heatmap2</span></code></pre></section><pre><span><span></span><br></span></pre><p><img data-ratio="0.6361111111111111" data-src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1Eec6Ar7wTAtkkXI1EwCKUUeAI6uOHtvXWAhef8qMzlC708F0Zt4VWdA/640?wx_fmt=png" data-type="png" data-w="1080" height="700" width="1100" src="https://mmbiz.qpic.cn/mmbiz_png/BIUPcLCMUmKOYWAcRBJem6kKu6DquB1Eec6Ar7wTAtkkXI1EwCKUUeAI6uOHtvXWAhef8qMzlC708F0Zt4VWdA/640?wx_fmt=png"></p><p>参考资料：</p><p>[1]https://coderzcolumn.com/tutorials/data-science/plotnine-simple-guide-to-create-charts-using-grammar-of-graphics</p><p>[2]https://www.geeksforgeeks.org/data-visualization-using-plotnine-and-ggplot2-in-python/</p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/2jwuV1hj-CG9nPG5lPLQ8Q",target="_blank" rel="noopener noreferrer">原文链接</a>
