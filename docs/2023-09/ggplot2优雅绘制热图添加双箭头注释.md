---
title: "ggplot2优雅绘制热图添加双箭头注释"
date: 2023-09-04T15:42:21Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
ggplot2优雅绘制热图添加双箭头注释 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来介绍如何使用<strong>「ggplot2」</strong>来绘制热图并添加双向箭头添加注释，下面小编通过一个案例来进行展示，图形仅供展示用，希望各位观众老爷能够喜欢。数据代码已经整合上传到2023VIP交流群，加群的观众老爷可自行下载。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h3 data-tool="mdnice编辑器"><span></span><span><span></span>原图</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="1.6333333333333333" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafswmh1B40ccEcVAKQ3FbyHhkjY0K7ibVDOpbCicVHRhmvCnU4cZicyU5Eg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafswmh1B40ccEcVAKQ3FbyHhkjY0K7ibVDOpbCicVHRhmvCnU4cZicyU5Eg/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>结果图</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="1.7452830188679245" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafy8H6GvZics8t75lqDT2axiaEcia4fGpAmxqfRZ2NIAYAweul4SQUX6l4Q/640?wx_fmt=png" data-type="png" data-w="848" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafy8H6GvZics8t75lqDT2axiaEcia4fGpAmxqfRZ2NIAYAweul4SQUX6l4Q/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(readxl)<br><span>library</span>(magrittr)<br><span>library</span>(grid)<br><span>library</span>(cowplot)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 从Excel文件中读取数据，并设置行名</span><br>df &lt;- read_excel(<span>"F1.xlsx"</span>, sheet = <span>"Fig 1c KEGG module"</span>) %&gt;% <br>  column_to_rownames(var=<span>"...1"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 对数据进行预处理，只选取前60行和前13列，并进行数据透视</span><br>df2 &lt;- df %&gt;% rownames_to_column(var=<span>"ID"</span>) %&gt;% head(60) %&gt;% select(1:13) %&gt;%  <br>  pivot_longer(-1) %&gt;% set_colnames(c(<span>"ID"</span>,<span>"name"</span>,<span>"value"</span>))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>p &lt;- df2 %&gt;% <br>  ggplot(aes(name,ID,fill=value))+  <span># 设置ggplot的aes参数</span><br>  geom_tile()+  <span># 使用geom_tile()添加瓦片</span><br>  coord_cartesian(clip = <span>"off"</span>) +  <span># 关闭坐标轴裁剪</span><br>  labs(x=NULL,y=NULL)+  <span># 移除x和y轴标签</span><br>  scale_y_discrete(expand=c(0,0),position=<span>"right"</span>)+  <span># 设置y轴</span><br>  scale_x_discrete(expand=c(0,0))+  <span># 设置x轴</span><br>  scale_fill_gradient2(mid=<span>"#FBFEF9"</span>,low=<span>"#0C6291"</span>,high=<span>"#A63446"</span>) +  <span># 设置填充颜色</span><br>  coord_cartesian(clip = <span>"off"</span>) +  <span># 再次关闭坐标轴裁剪（可能是重复的步骤）</span><br>  theme_test()+  <span># 使用theme_test主题</span><br>  theme(axis.text.x=element_text(color=<span>"black"</span>,size=8,face=<span>"bold"</span>,angle = 90,vjust=0.5),  <span># 自定义x轴文本</span><br>        axis.text.y=element_text(color=<span>"black"</span>,size=8,face=<span>"bold"</span>,angle = 0,vjust=0.5),  <span># 自定义y轴文本</span><br>        axis.ticks = element_blank(),  <span># 移除轴刻度</span><br>        legend.title = element_blank(),  <span># 移除图例标题</span><br>        legend.background = element_blank(),  <span># 设置图例背景为透明</span><br>        legend.text = element_text(size=8,color=<span>"black"</span>,face=<span>"bold"</span>),  <span># 自定义图例文本</span><br>        legend.position =c(-0.2,0.9),  <span># 设置图例位置</span><br>        legend.spacing.x = unit(0.01,<span>"in"</span>),  <span># 设置图例内部的水平间距</span><br>        plot.margin = ggplot2::margin(10,60,10,60))  <span># 设置图的边距</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>添加注释</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 使用cowplot的ggdraw和draw_plot函数来组合图形和其他元素</span><br>ggdraw(xlim = c(<span>0</span>, <span>1.1</span>), ylim = c(<span>0</span>,<span>1</span>))+  <span># 设置绘图区域的界限</span><br>  draw_plot(p,x = <span>0</span>, y =<span>0</span>) +  <span># 添加主图（热图）</span><br>  draw_line(x = c(<span>0.9</span>,<span>0.9</span>), y = c(<span>0.08</span>,<span>0.98</span>),lineend = <span>"butt"</span>,size =<span>1</span>, col = <span>"grey80"</span>,  <span># 添加箭头</span><br>            arrow=arrow(angle = <span>30</span>, length = unit(<span>0.4</span>,<span>"inches"</span>),ends = <span>"both"</span>, type = <span>"closed"</span>))+<br>  draw_grob(grid::grid.rect(gp=grid::gpar(fill=<span>"grey80"</span>,col=<span>"grey80"</span>)),x=<span>0.875</span>,y=<span>0.11</span>,height = <span>0.85</span>,width=<span>0.05</span>)+  <span># 添加一个灰色的矩形</span><br>  draw_text(text = <span>"EDC genes"</span>, size = <span>12</span>, x = <span>0.9</span>, y = <span>0.55</span>, angle = <span>90</span>,color=<span>"black"</span>,fontface = <span>"bold"</span>,hjust = <span>0.5</span>)  <span># 添加文本标签</span><br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.7452830188679245" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafy8H6GvZics8t75lqDT2axiaEcia4fGpAmxqfRZ2NIAYAweul4SQUX6l4Q/640?wx_fmt=png" data-type="png" data-w="848" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafy8H6GvZics8t75lqDT2axiaEcia4fGpAmxqfRZ2NIAYAweul4SQUX6l4Q/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节内容介绍到此结束，有需要学习个性化数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>购买<strong>「2023年度会员文档」</strong>同步更新中<strong>「售价149元」</strong>，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；按照往年数据小编年产出约在150+以上</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可下单购买，需要了解更多信息的朋友欢迎交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝扫一扫</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="1.6141479099678457" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiaf5tN8sBeKxStXXWzbg0CoOMhTrt7qfx48Lh6tQ3q5kQsLkAicu832VKQ/640?wx_fmt=png" data-type="png" data-w="622" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiaf5tN8sBeKxStXXWzbg0CoOMhTrt7qfx48Lh6tQ3q5kQsLkAicu832VKQ/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023会员群案例展示</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafibKqen04doh9gEeTgcExrMnNibBrxtRjTBibozuoY7vAVx9RdYaSDPQibg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafibKqen04doh9gEeTgcExrMnNibBrxtRjTBibozuoY7vAVx9RdYaSDPQibg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafMLpqEmkU5aicjdFUhibcuqXlRMQFicGbmib25uKcVdKdS1p7X9pNBmbSmw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafMLpqEmkU5aicjdFUhibcuqXlRMQFicGbmib25uKcVdKdS1p7X9pNBmbSmw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiaflLqugIuRKY4fF79aB301pq12DKtpuoptPqUsnJSocicSTDUGB5aEshQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiaflLqugIuRKY4fF79aB301pq12DKtpuoptPqUsnJSocicSTDUGB5aEshQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafoHgE18t75MAwNLklpVUtLniabEmiaLeJtg4xXVQIBicbY7RLq1qCmc9bg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafoHgE18t75MAwNLklpVUtLniabEmiaLeJtg4xXVQIBicbY7RLq1qCmc9bg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiaflPmHUH18NyLSFKHAne31oFNJzqbfMl7QWQWiaRAp3iaib5VZvYWMqOqrw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiaflPmHUH18NyLSFKHAne31oFNJzqbfMl7QWQWiaRAp3iaib5VZvYWMqOqrw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafp4EOSibOtpNB4PsW3micUwibYJREowezPojkCib41LLW2NG5ichyUNgYdWw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafp4EOSibOtpNB4PsW3micUwibYJREowezPojkCib41LLW2NG5ichyUNgYdWw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiaffLxeOiaYaBGPUVZX9qstiawjvYpZ7xXTPOfk1I0Ej7U4cv6ym471orHg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiaffLxeOiaYaBGPUVZX9qstiawjvYpZ7xXTPOfk1I0Ej7U4cv6ym471orHg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafg38lZBaLXA9pnP2SZBYhRUW9LjnpaN0sUfU39jMB7TuYicyMRBGr34w/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafg38lZBaLXA9pnP2SZBYhRUW9LjnpaN0sUfU39jMB7TuYicyMRBGr34w/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafpqTB056YyJ4P7Sd5WSpdOjEcaSEG9nlvv40LPvs6ay3gKk5ZcU5DiaQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAaG6lkFZAKKQmJDDibLibkJiafpqTB056YyJ4P7Sd5WSpdOjEcaSEG9nlvv40LPvs6ay3gKk5ZcU5DiaQ/640?wx_fmt=png"></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/xCk0lX314WjNySbmGnygkg",target="_blank" rel="noopener noreferrer">原文链接</a>
