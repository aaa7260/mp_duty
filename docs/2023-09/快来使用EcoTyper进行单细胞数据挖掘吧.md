---
title: "快来使用EcoTyper进行单细胞数据挖掘吧"
date: 2023-09-09T02:28:50Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
快来使用EcoTyper进行单细胞数据挖掘吧 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>早在2021的CELL文章：《Atlas of clinically distinct cell states and ecosystems across human solid tumors》就介绍了这个EcoTyper，它能根据肿瘤的单细胞转录组数据集的降维聚类分群结果，去以前常规的bulk转录组数据集（包括表达量芯片和转录组测序）里面去推断各个单细胞亚群比例后汇总成为不同的细胞状态组合情况以及多细胞群落情况。</p></blockquote><p data-tool="mdnice编辑器">那个2021的CELL文章的作者为了评估EcoTyper定义的71种细胞状态的保真度，他们探究了4种人类癌症的200,000个单细胞转录组中每种状态的存在情况。在scRNA-seq数据中，94%的细胞状态（71个中的67个）可显著恢复，而且无论平台、细胞类型或数据集如何，恢复率都很高，突显了结果的可靠性。并且绘制了15,008例肿瘤中69种细胞状态的预后图。在发现队列调查的16种上皮癌类型中，大多数细胞状态（69种中的39种）与总生存率显著相关。</p><p data-tool="mdnice编辑器">既然这些细胞状态组合情况以及多细胞群落情况，在肿瘤里面是跟预后会有关系， 那么毫无疑问，每个癌症都是可以做同样的数据分析啦。比如2023年7月的文章：《Deep immunophenotyping reveals clinically distinct cellular states and ecosystems in large-scale colorectal cancer》就是收集了14个GEO数据集1725个CRC样本和TCGA的625个样本，样品数量很大，如下所示：</p><p><img data-galleryid="" data-ratio="1.260377358490566" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wymOibmicnmYyttEBqIvMZoqj3iavL0VMrwlZNZ1Nibicr0FDszKt8Q16uic830GHIVamhDicyzDjmOpD0tQ/640?wx_fmt=png" data-type="png" data-w="530" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wymOibmicnmYyttEBqIvMZoqj3iavL0VMrwlZNZ1Nibicr0FDszKt8Q16uic830GHIVamhDicyzDjmOpD0tQ/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>14个GEO数据集1725个CRC样本和TCGA的625个样本</figcaption></figure><p data-tool="mdnice编辑器">但凡是做过自己疾病的背景调研，很容易收集到几十个甚至上百个常规的bulk转录组数据集（包括表达量芯片和转录组测序），而且绝大部分数据集都被反反复复挖掘过一次啦。</p><p data-tool="mdnice编辑器">同理，任意疾病的单细胞数据集那也是几十个以上了，比如这个文章就是取了 GSE132465 (n = 23) 和 E-MTAB-8107 (n = 7)这两个数据集 ，进行降维聚类分群：</p><p><img data-galleryid="" data-ratio="0.7233606557377049" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wymOibmicnmYyttEBqIvMZoqj8ibNEjdlgKiaGjavY9647XdjkyFuiclCIht7g4EuNw3nW9KCeSVfgPJww/640?wx_fmt=png" data-type="png" data-w="976" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wymOibmicnmYyttEBqIvMZoqj8ibNEjdlgKiaGjavY9647XdjkyFuiclCIht7g4EuNw3nW9KCeSVfgPJww/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>GSE132465 (n = 23) 和 E-MTAB-8107 (n = 7)这两个数据集</figcaption></figure><p data-tool="mdnice编辑器">这样的单细胞转录组数据分析的标准降维聚类分群，并且进行生物学注释后的结果。可以参考前面的例子：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247497956&amp;idx=1&amp;sn=5d4deb7cf7b7848b3e2273cbd663bb6a&amp;scene=21#wechat_redirect" data-linktype="2">人人都能学会的单细胞聚类分群注释</a> ，我们演示了第一层次的分群。如果你对单细胞数据分析还没有基础认知，可以看基础10讲：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486076&amp;idx=1&amp;sn=52bb851d7dc23461233a2cf458736151&amp;scene=21#wechat_redirect" data-linktype="2">01. 上游分析流程</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486082&amp;idx=1&amp;sn=03cadceffb2c14ba95d97fe5caf38d94&amp;scene=21#wechat_redirect" data-linktype="2">02.课题多少个样品，测序数据量如何</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486088&amp;idx=1&amp;sn=3a115338ee4937d20caab78627237553&amp;scene=21#wechat_redirect" data-linktype="2">03. 过滤不合格细胞和基因（数据质控很重要）</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486096&amp;idx=1&amp;sn=1a99c4c5800b7e0287db3e8ef369fab8&amp;scene=21#wechat_redirect" data-linktype="2">04. 过滤线粒体核糖体基因</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486098&amp;idx=1&amp;sn=bf9a71df848d74fe665ce7d5e283d5ff&amp;scene=21#wechat_redirect" data-linktype="2">05. 去除细胞效应和基因效应</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486260&amp;idx=1&amp;sn=c6abf658de73594d1d77d8e1ffa7d153&amp;scene=21#wechat_redirect" data-linktype="2">06.单细胞转录组数据的降维聚类分群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486271&amp;idx=1&amp;sn=638b434b6deee63206af1c0eeda175ab&amp;scene=21#wechat_redirect" data-linktype="2">07.单细胞转录组数据处理之细胞亚群注释</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486278&amp;idx=1&amp;sn=91250ef733833ff00371818b215dc124&amp;scene=21#wechat_redirect" data-linktype="2">08.把拿到的亚群进行更细致的分群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486287&amp;idx=1&amp;sn=49627c638ff9c04418282c53518aa7c7&amp;scene=21#wechat_redirect" data-linktype="2">09.单细胞转录组数据处理之细胞亚群比例比较</a></section></li></ul><h3 data-tool="mdnice编辑器"><span></span>这个文章非常优秀提供了全部的代码<span></span></h3><ul data-tool="mdnice编辑器"><li><section>The codes of EcoTyper were obtained from https://ecotyper.stanford.edu/carcinoma/.</section></li><li><section>Other codes used in this study are available from https://github.com/ComputationalEpigeneticsLab/Tumor-cellular-states-and-ecosystems-in-CRC</section></li></ul><p data-tool="mdnice编辑器">比如我们打开作者的代码，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>    60 Distribution of cellular states <span>in</span> CEs.R<br>     211 Hallmark+immune enrichment analysis.R<br>     198 Molecular characteristics of seven CEs.R<br>      78 TFs predict clinical survival.R<br>     354 TFs regulating the genes.R<br>      83 The GO enrichment analysis.R<br>      43 The analysis of 198 drugs.R<br>     108 The expression of TF.R<br>      71 The expression of fib-gene.R<br>     460 The plot of GSEA.R<br>      37 The proportion of CRC patients recovered <span>in</span> validation cohorts.R<br>      35 The proportions of cell types <span>in</span> CEs.R<br>      28 The proportions of patients.R<br>      24 UMAP projection of cellular states.R<br></code></pre><p data-tool="mdnice编辑器">可以看到绝大部分代码都不复杂，主要就是可视化，部分代码相信大家肯定是用得到，比如：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#### sankey</span><br><span>library</span>(ggalluvial)<br><span>library</span>(RColorBrewer)<br><span>library</span>(randomcoloR)<br><br>col_sankey&lt;-c(<span>'B.cells'</span>=<span>"#E6AB02"</span>, <span>'CD4.T.cells'</span>=<span>"#E7298A"</span>, <span>'CD8.T.cells'</span>=<span>"#7570B3"</span>, <br>              <span>'Dendritic.cells'</span>=<span>"#D95F02"</span>,<span>'Endothelial.cells'</span>=<span>"#1B9E77"</span>,<span>'Epithelial.cells'</span>=<span>"#CAB2D6"</span>,<br>              <span>'Fibroblasts'</span>=<span>"#FDBF6F"</span>,<span>'Mast.cells'</span>=<span>"#F7AEB3"</span>,<br>              <span>'Monocytes.and.Macrophages'</span>=<span>"#B2DF8A"</span>,<span>'NK.cells'</span>=<span>"#A6CEE3"</span>,<span>'PCs'</span>=<span>"#999999"</span>,<span>'PMNs'</span>=<span>"#F780BF"</span>,<br>              <span>'E1'</span>=<span>"#D6372E"</span>,<span>'E2'</span>=<span>"#FADD4B"</span>,<span>'E3'</span>=<span>"#70B460"</span>,<span>'E4'</span>=<span>"#E690C1"</span>,<br>              <span>'E5'</span>=<span>"#985EA8"</span>,<span>'E6'</span>=<span>"#A3A3A3"</span>,<span>'E7'</span>=<span>"#B7D3E5"</span>)<br><br>pdf(<span>"state_ecotype_sankey2.pdf"</span>,width = <span>6</span>,height = <span>8</span>)<br>ggplot(state_ecotype, aes(x = variable, y = link,<br>                          stratum = value, alluvium = flow, fill = value)) +<br>  geom_stratum() + <br>  geom_flow(aes.flow = <span>'forward'</span>) + <br>  scale_fill_manual(values = col_sankey[rank(<span>1</span>:<span>44</span>)]) + <br>  guides(fill=<span>FALSE</span>)+<br>  geom_text(stat = <span>'stratum'</span>, infer.label = <span>TRUE</span>, size = <span>2.5</span>) + <br>  labs(x = <span>''</span>, y = <span>''</span>) + <br>  theme(legend.position = <span>'none'</span>, panel.background = element_blank(),<br>        line = element_blank(), axis.text.y = element_blank())+<br>  scale_x_discrete(limits = c(<span>'CellType'</span>, <span>'Ecotype'</span>))<br><br>dev.off()  <br><br></code></pre><p data-tool="mdnice编辑器">得到如下所示的右图（sankey）：</p><p><img data-galleryid="" data-ratio="0.8263665594855305" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wymOibmicnmYyttEBqIvMZoqjhL8rdBib9fKc4ja77n6XFlYpHjbw9sW4mFYzTr96VNKDkiayhmns1OSg/640?wx_fmt=png" data-type="png" data-w="622" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wymOibmicnmYyttEBqIvMZoqjhL8rdBib9fKc4ja77n6XFlYpHjbw9sW4mFYzTr96VNKDkiayhmns1OSg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>右图（sankey）</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span>还等什么呢<span></span></h3><p data-tool="mdnice编辑器">在任意癌症上面复现吧，数据处理的过程中，相信大家就有会有自己的不一样的生物学故事。比如上面的文章侧重于肿瘤成纤维，大家可以侧重于其它单细胞亚群，</p><blockquote data-tool="mdnice编辑器"><p>通常我们拿到了肿瘤相关的单细胞转录组的表达量矩阵后的第一层次降维聚类分群通常是：</p></blockquote><ul data-tool="mdnice编辑器"><li><section>immune (CD45+,PTPRC),</section></li><li><section>epithelial/cancer (EpCAM+,EPCAM),</section></li><li><section>stromal (CD10+,MME,fibro or CD31+,PECAM1,endo)</section></li></ul><p data-tool="mdnice编辑器">参考我前面介绍过 <a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247488940&amp;idx=1&amp;sn=1cc8a8a74715087939b9721c0881775d&amp;scene=21#wechat_redirect" data-linktype="2">CNS图表复现08—肿瘤单细胞数据第一次分群通用规则</a>，这3大单细胞亚群构成了肿瘤免疫微环境的复杂。绝大部分文章都是抓住免疫细胞亚群进行细分，包括淋巴系（T,B,NK细胞）和髓系（单核，树突，巨噬，粒细胞）的两大类作为第二次细分亚群。但是也有不少文章是抓住stromal 里面的 fibro 和endo进行细分，并且编造生物学故事的。</p><p data-tool="mdnice编辑器">前面我们已经介绍了<strong>心肝脾肺肾</strong>等多个器官的<strong>上皮细胞</strong>的细分亚群， 以及免疫细胞里面的髓系和B细胞细分亚群：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247506948&amp;idx=1&amp;sn=025d7f91abfa1b68d7910c86cf709e43&amp;scene=21#wechat_redirect" data-linktype="2">B细胞细分亚群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247506971&amp;idx=1&amp;sn=f0242285e2c827d922f938d9858d4ffe&amp;scene=21#wechat_redirect" data-linktype="2">髓系免疫细胞细分亚群</a></section></li></ul><p data-tool="mdnice编辑器">其中<a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247506971&amp;idx=1&amp;sn=f0242285e2c827d922f938d9858d4ffe&amp;scene=21#wechat_redirect" data-linktype="2">髓系免疫细胞细分亚群</a>也可以看张泽民课题组的泛癌层面数据挖掘文章，2021年2月发表在CELL的《A pan-cancer single-cell transcriptional atlas of tumor infiltrating myeloid cells》</p><h3 data-tool="mdnice编辑器"><span></span>值得注意的是这个EcoTyper工具不好用哦<span></span></h3><p data-tool="mdnice编辑器">作者还构建的是shiny网页工具，而不是公开的R包方便大家使用，详细的链接是：https://ecotyper.stanford.edu/carcinoma/#shiny-tab-explore</p><p data-tool="mdnice编辑器">有体验 过这个工具的小伙伴可以分享一下使用心得哈， 我感觉这个思路其实很简单的， 就是<strong>任意去卷积软件把单细胞转录组降维聚类分群的信息拿去常规的bulk转录组数据集（包括表达量芯片和转录组测序）去推断各个单细胞亚群比例后，使用这个比例信息进行分子分型即可！</strong></p></section><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524240&amp;idx=1&amp;sn=94c9ef8c3d8080c30c8372d4fb5999ab&amp;chksm=9b4bdf2bac3c563def9232bb78f43bcaa13d7c3442b00cf83aaa32ae98f4500883fa8803fb98&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授课（买一‍得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247522831&amp;idx=2&amp;sn=1744efdf428465425a145ff3a982198b&amp;chksm=9b4bdab4ac3c53a28fbecbbff4f254f470b54a7a20468bb753b295b930315e1ec45bcbabc10b&amp;scene=21#wechat_redirect" textvalue="144线程640Gb内存服务器共享一年‍仍然是仅需800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">144线程640Gb内存服务器共享一年仍然是仅需800</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">千呼万唤始出来的独享生物信息学云服务器</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"></a><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524275&amp;idx=1&amp;sn=fa592ee29f636f34387491d0fceadd8e&amp;chksm=9b4bdf08ac3c561e0881974b3817beb0a0e514dc1a8df4c34c2b6653da6fa78e09acb03c70c2&amp;scene=21#wechat_redirect" textvalue="生信技能树知识整理实习生又又又开放申请啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信技能树知识整理实习生又又又开放申请啦</a></section></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524432&amp;idx=1&amp;sn=5b33b0c6807a9e6939c332c58fabff89&amp;chksm=9b4b20ebac3ca9fdb3d8bfaf2bef5552f64eb70e7fae557cc7197fb1a23b3e8bc31b585bf829&amp;scene=21#wechat_redirect" textvalue="生信共享办公室出租" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信共享办公室出租</a></p></li></ul><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/DCYz4i42Kj4gRnpzIaIXJQ",target="_blank" rel="noopener noreferrer">原文链接</a>
