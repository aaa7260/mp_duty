---
title: "院士课题组的WGCNA数据挖掘文章能复现吗"
date: 2023-09-15T15:39:43Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
院士课题组的WGCNA数据挖掘文章能复现吗 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>看到了交流群小伙伴分享了一系列数据挖掘文章，都是浙江大学李兰娟院士的学生的成果。其中一个《<strong>Characteristic Analysis of Featured Genes Associated with Cholangiocarcinoma Progression</strong>》倒是蛮简单的，挑选TCGA数据库里面的 [GDC TCGA Bile Duct Cancer (CHOL)](https://xenabrowser.net/datapages/?cohort=GDC TCGA Bile Duct Cancer (CHOL)&amp;removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443) 数据集，然后根据里面的样品的二分类属性（肿瘤样品和正常组织对照）做一个简单的差异分析，然后基于差异分析后的基因列表进行go和kegg的数据库注释，以及使用WGCNA算法构建网络，然后挑选合适的网络看里面的hub基因而已。</p></blockquote><p><img data-galleryid="" data-ratio="1.4061855670103092" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxRFO2btzssj1QibmqBNc0jJ4RrcLRA4uluvXcQ7o6Os7gInx5OchF1gA/640?wx_fmt=png" data-type="png" data-w="970" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxRFO2btzssj1QibmqBNc0jJ4RrcLRA4uluvXcQ7o6Os7gInx5OchF1gA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>使用WGCNA算法构建网络</figcaption></figure><p data-tool="mdnice编辑器">我们分两步走，完成这个数据挖掘的复现。</p><h3 data-tool="mdnice编辑器"><span></span>首先是差异分析<span></span></h3><p data-tool="mdnice编辑器">挑选TCGA数据库里面的 [GDC TCGA Bile Duct Cancer (CHOL)](https://xenabrowser.net/datapages/?cohort=GDC TCGA Bile Duct Cancer (CHOL)&amp;removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443) 数据集，然后根据里面的样品的二分类属性（肿瘤样品和正常组织对照）做一个简单的差异分析，表达量矩阵文件路径是；</p><ul data-tool="mdnice编辑器"><li><section>https://gdc-hub.s3.us-east-1.amazonaws.com/download/TCGA-CHOL.htseq_counts.tsv.gz</section></li></ul><p data-tool="mdnice编辑器">有了这个文件，差异分析非常简单，也是分成3步走，代码如下所示：</p><h4 data-tool="mdnice编辑器"><span></span>首先是解析表达量矩阵<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span># 魔幻操作，一键清空</span><br>rm(list = ls()) <br>options(stringsAsFactors = <span>F</span>)<br><span>library</span>(data.table)<br>a1=fread( <span>'TCGA-CHOL.htseq_counts.tsv.gz'</span> , <br>          data.table = <span>F</span>)<br>dim(a1)<br>a1[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>a1[(nrow(a1)-<span>5</span>):nrow(a1),<span>1</span>:<span>4</span>]<br>dim(a1)<br><span># all data is then log2(x+1) transformed.</span><br><br><span>#length(unique(a1$AccID))</span><br><span>#length(unique(a1$GeneName))</span><br><br>mat= a1[,<span>2</span>:ncol(a1)] <br>mat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>] <br>mat=mat[<span>1</span>:(nrow(a1)-<span>4</span>),]<br>mat=ceiling(<span>2</span>^(mat)-<span>1</span>) <span>#log2(x+1) transformed.</span><br>mat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>] <br><br>rownames(mat) = gsub(<span>'[.][0-9]+'</span>,<span>''</span>,a1$Ensembl_ID[<span>1</span>:(nrow(a1)-<span>4</span>)])<br>keep_feature &lt;- rowSums (mat &gt; <span>1</span>) &gt; <span>1</span><br>colSums(mat)/<span>1000000</span><br>table(keep_feature)<br>mat &lt;- mat[keep_feature, ]<br>mat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>] <br>mat=mat[,  colSums(mat)/<span>1000000</span> &gt;<span>10</span>]<br>dim(mat) <br>colnames(mat) <br>ensembl_matrix=mat<br>colnames(ensembl_matrix) <br>ensembl_matrix[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br></code></pre><p data-tool="mdnice编辑器">上面的表达量矩阵目前是ensembl数据库的id格式，不符合人类正常的阅读习惯，我们接下来需要进行简单的id转换</p><h4 data-tool="mdnice编辑器"><span></span>简单的id转换<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><br><span>library</span>(AnnoProbe)<br>head(rownames(ensembl_matrix))<br>ids=annoGene(rownames(ensembl_matrix),<span>'ENSEMBL'</span>,<span>'human'</span>)<br>head(ids)<br>ids=ids[!duplicated(ids$SYMBOL),]<br>ids=ids[!duplicated(ids$ENSEMBL),]<br>symbol_matrix= ensembl_matrix[match(ids$ENSEMBL,<br>                                    rownames(ensembl_matrix)),]<br><br>rownames(symbol_matrix) = ids$SYMBOL<br><span>#symbol_matrix = ensembl_matrix</span><br>symbol_matrix[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>然后确定样品的分组后差异分析<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(stringr)<br>symbol_matrix[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>colnames(symbol_matrix)<br><span># group_list=ifelse( grepl('PLVX',colnames(symbol_matrix)),'control','case' )</span><br>group_list=ifelse(substring(colnames(symbol_matrix),<span>14</span>,<span>15</span>)==<span>'11'</span>,<br>                  <span>'control'</span>,<span>'case'</span> )<br>table(group_list)<br>group_list = factor(group_list,levels = c(<span>'control'</span>,<span>'case'</span> ))<br>group_list<br><span># save(symbol_matrix, group_list,</span><br><span>#      file='symbol_matrix.Rdata')</span><br><span># load(  file='symbol_matrix.Rdata')</span><br>colnames(symbol_matrix)<br><br>save(symbol_matrix,group_list,file = <span>'symbol_matrix.Rdata'</span>)<br><br></code></pre><p data-tool="mdnice编辑器">前面的symbol_matrix和group_list制作成功后，两分组实验设计的转录组测序后的差异分析和富集分析都是无需修改的代码，默认跑一下即可：</p><pre data-tool="mdnice编辑器"><span></span><code><br><span>source</span>(<span>'scripts/step2-qc-counts.R'</span>)<br><span>source</span>(<span>'scripts/step3-deg-deseq2.R'</span>)<br><span>source</span>(<span>'scripts/step3-deg-edgeR.R'</span>)<br><span>source</span>(<span>'scripts/step3-deg-limma-voom.R'</span>) <br><span>source</span>(<span>'scripts/step4-qc-for-deg.R'</span>) <br><span>source</span>(<span>'scripts/step5-anno-by-GSEA.R'</span>) <br><span>source</span>(<span>'scripts/step5-anno-by-ORA.R'</span>)  <br> <br></code></pre><p data-tool="mdnice编辑器">很简单的可以看到我们默认不会有表达量变化的GAPDH在这里居然也是很明显的差异基因，在肿瘤里面上调了 ：</p><p><img data-galleryid="" data-ratio="0.30833333333333335" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxyVgDwk2k8BSmYHDhvlYhFRYeL0KFhura91aD7cVILB4LokKXqlRruQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxyVgDwk2k8BSmYHDhvlYhFRYeL0KFhura91aD7cVILB4LokKXqlRruQ/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>image-20230828201428942</figcaption></figure><p data-tool="mdnice编辑器">差异分析的结果也可以看到，上下调基因数量实在是太多了：</p><p><img data-galleryid="" data-ratio="0.38333333333333336" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxsTTB7ySM36aHMSehJILj6k21X3d2LviaTnO1icu0lAiaOARzsHXWo3Sfw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxsTTB7ySM36aHMSehJILj6k21X3d2LviaTnO1icu0lAiaOARzsHXWo3Sfw/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>上下调基因数量实在是太多了</figcaption></figure><p data-tool="mdnice编辑器">所以，我们的阈值必须变化，但是文章里面呢，Volcano plot of 1613 DEGs in between CCA patients and normal tissue (adjusted <em>p</em>-value &lt; 0.05; |log2fold change| &gt; 1) 很明显是有问题的，无论是使用什么样的转录组差异分析算法，都不太可能使用这样的阈值可以拿到这样的数据量的差异基因。</p><p><img data-galleryid="" data-ratio="0.44907407407407407" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxEtTia9COK7WEP5icZATFLugMdcKw1cN2a4WRW1tRCdE2BZdRJRlouFGA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxEtTia9COK7WEP5icZATFLugMdcKw1cN2a4WRW1tRCdE2BZdRJRlouFGA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>这样的数据量的差异基因</figcaption></figure><p data-tool="mdnice编辑器">那么到底是问题出在哪里呢？我们的代码是公开的：</p><ul data-tool="mdnice编辑器"><li><section>https://cowtransfer.com/s/e1817982ce974c 点击链接查看 [ 2023-浙江大学李兰娟院士-WGCNA数据挖掘-step1-deg.zip ] ，或访问奶牛快传 cowtransfer.com 输入传输口令 uwiucz 查看；</section></li></ul><p data-tool="mdnice编辑器">感兴趣的小伙伴可以帮我们检查一下哦！</p><p data-tool="mdnice编辑器">另外，预告一下，前面的差异基因拿到了之后，接下来我们要视频号直播wgcna数据分析过程啦。</p></section><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524240&amp;idx=1&amp;sn=94c9ef8c3d8080c30c8372d4fb5999ab&amp;chksm=9b4bdf2bac3c563def9232bb78f43bcaa13d7c3442b00cf83aaa32ae98f4500883fa8803fb98&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授课（买一‍得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247522831&amp;idx=2&amp;sn=1744efdf428465425a145ff3a982198b&amp;chksm=9b4bdab4ac3c53a28fbecbbff4f254f470b54a7a20468bb753b295b930315e1ec45bcbabc10b&amp;scene=21#wechat_redirect" textvalue="144线程640Gb内存服务器共享一年‍仍然是仅需800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">144线程640Gb内存服务器共享一年仍然是仅需800</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">千呼万唤始出来的独享生物信息学云服务器</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"></a><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524275&amp;idx=1&amp;sn=fa592ee29f636f34387491d0fceadd8e&amp;chksm=9b4bdf08ac3c561e0881974b3817beb0a0e514dc1a8df4c34c2b6653da6fa78e09acb03c70c2&amp;scene=21#wechat_redirect" textvalue="生信技能树知识整理实习生又又又开放申请啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">生信技能树知识整理实习生又又又开放申请啦</a></section></li></ul><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/D0NxMBLWYQ5qDB1IOhwdrw",target="_blank" rel="noopener noreferrer">原文链接</a>
