---
title: "R语言进行时间序列分析和预测"
date: 2023-09-24T16:17:53Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
R语言进行时间序列分析和预测 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来介绍如何使用<strong>「tidyverse与bsts包」</strong>来处理数据并进行时间序列分析及预测，下面小编通过一个案例来进行展示，图形仅供展示用，希望各位观众老爷能够喜欢。数据代码已经整合上传到2023VIP交流群，加群的观众老爷可自行下载，有需要的朋友可关注文末介绍加入VIP交流群</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span></h3><p><img data-galleryid="" data-ratio="0.3194444444444444" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYib6Vf5Lfu4s64dJIEWhdGMvrcDEx2Rxgd91TOF5sjqy47Wqf2cTO1c5Nhdibh8G5IhOnR53j6XKrw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYib6Vf5Lfu4s64dJIEWhdGMvrcDEx2Rxgd91TOF5sjqy47Wqf2cTO1c5Nhdibh8G5IhOnR53j6XKrw/640?wx_fmt=png"></p><p data-tool="mdnice编辑器"><br></p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(stringr)<br><span>library</span>(janitor)<br><span>library</span>(tsibble)<br><span>library</span>(ggtext)<br><span>library</span>(bsts)<br><span>library</span>(tidybayes)<br><span>library</span>(ggfx)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>data &lt;- readr::read_csv(<span>"data.txt"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- data %&gt;%<br>  clean_names() %&gt;%    <span># 清理列名</span><br>  mutate(date = ymd(date)) %&gt;%  <span># 将date列转换为日期格式</span><br>  rename(avg_price = apu000072610) %&gt;% <br>  filter(date &gt; <span>"2006-12-01"</span>) %&gt;%    <span># 过滤出日期大于2006-12-01的数据</span><br>  mutate(avg_price = as.numeric(avg_price)) %&gt;% <br>  <span># 提取年、月、日信息</span><br>  mutate(year = year(date), month = month(date), day = day(date)) %&gt;%<br>  <span># 将日期向下取整到月</span><br>  mutate(date = floor_date(as_date(date), <span>"month"</span>)) %&gt;% <br>  <span># 将日期转换为年月格式</span><br>  mutate(date = yearmonth(date))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建预测数据</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>用bsts函数对avg_price进行拟合和预测。bsts包是用于Bayesian structural time series模型的R包，它可以用于时间序列数据的分析和预测。</p><span>❞</span></blockquote><pre data-tool="mdnice编辑器"><span></span><code>set.seed(<span>1234</span>) <span># 设置随机种子</span><br><span># 添加局部线性趋势</span><br>ss &lt;- AddLocalLinearTrend(list(), df$avg_price)<br>ss &lt;- AddSeasonal(ss, df$avg_price, nseasons = <span>12</span>) <span># 添加季节性</span><br><span># 使用bsts函数拟合模型</span><br>model &lt;- bsts(df$avg_price, state.specification = ss, niter = <span>1000</span>)<br>horizon &lt;- <span>48</span> <span># 设置预测的时间范围</span><br><br><span># 创建预测数据框</span><br>df_forecast &lt;- data.frame(date = max(df$date) + <span>1</span>:horizon) %&gt;% <br>  <span># 添加预测值</span><br>  add_draws(predict(model, horizon = horizon, burn = SuggestBurn(<span>0.1</span>, model), <br>                    quantiles = c(<span>0.25</span>, <span>0.75</span>))$distribution) %&gt;% =<br>  sample_draws(<span>200</span>)   <span># 随机抽取1000个样本</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>ggplot() +<br>  <span># 添加原始数据的线条图层</span><br>  geom_line(data = df, aes(x = as.Date(date), y = avg_price), color = <span>"#FFFFFF"</span>, linewidth = <span>0.8</span>) +<br>  <span># 使用外发光效果添加预测数据的线条图层</span><br>  with_outer_glow(<br>    geom_line(data = df_forecast, aes(x = as.Date(date), y = .value, group = .draw), <br>              linewidth = <span>0.3</span>, color = <span>"#69F0AE"</span>, alpha = <span>0.5</span>),<br>    color = <span>"#69F0AE"</span>, sigma = <span>7</span>) +<br>  <span># 设置y轴的范围和刻度</span><br>  scale_y_continuous(limits = c(<span>0</span>, <span>NA</span>), breaks = seq(<span>0</span>, <span>0.3</span>, by = <span>0.04</span>)) +<br>  <span># 设置x轴的日期格式和刻度</span><br>  scale_x_date(date_breaks = <span>"2 years"</span>, date_labels = <span>"%Y"</span>) +<br>  <span># 使用最小主题</span><br>  theme_minimal() +<br>  <span># 设置图例、轴文本、轴标题、轴线、网格线和图背景的样式</span><br>  theme(legend.position = <span>"none"</span>,<br>        axis.text = element_text(size = <span>8</span>,color = <span>"black"</span>),<br>        axis.title.y = element_text(size = <span>8</span>,color = <span>"black"</span>, margin  = margin(r = <span>5</span>)),<br>        axis.title.x = element_text(size = <span>8</span>,color = <span>"black"</span>, margin = margin(t = <span>20</span>)),<br>        axis.line = element_line(color = <span>"black"</span>, linewidth = <span>0.3</span>),<br>        panel.grid = element_line(color = <span>"#616161"</span>, linewidth = <span>0.2</span>, linetype = <span>"dashed"</span>),<br>        plot.margin = unit(c(<span>1</span>, <span>1</span>, <span>1</span>, <span>1</span>), <span>"cm"</span>),<br>        plot.background = element_rect(color = <span>NA</span>, fill = <span>"grey80"</span>)) <br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7685185185185185" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSTeOdpnrf5sRE482yhUvibQSuUDDCZy3yA2Oiaa6bYe7ibpIUe8ziagFsUA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSTeOdpnrf5sRE482yhUvibQSuUDDCZy3yA2Oiaa6bYe7ibpIUe8ziagFsUA/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">本节内容介绍到此结束，过程仅供参考；有需要学习个性化数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>购买<strong>「2023年度会员文档」</strong>同步更新中<strong>「售价149元」</strong>，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；按照往年数据小编年产出约在150+以上</p><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可下单购买，需要了解更多信息的朋友欢迎交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>小编微信</span><span></span></h3><p><img data-galleryid="" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg" data-type="jpeg" data-w="430" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023会员群案例展示</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSDTiaPJGxyWpPwmFibfHibrFGeMh7qoLQ3ASuaVcufico6QOxXGJLjMypBA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSDTiaPJGxyWpPwmFibfHibrFGeMh7qoLQ3ASuaVcufico6QOxXGJLjMypBA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSy7IeV2n4lFlh6LxJfwsSW3lV3iaCiaOGz1rQXzH85c8bxJr5K2XEw9Hw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSy7IeV2n4lFlh6LxJfwsSW3lV3iaCiaOGz1rQXzH85c8bxJr5K2XEw9Hw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSV99Gf6k2yCbyhZFXlKDApGhPqKJBgjTicg13WpnyiaGJrGzz2eCRxO2w/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSV99Gf6k2yCbyhZFXlKDApGhPqKJBgjTicg13WpnyiaGJrGzz2eCRxO2w/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSWKJe6d6ndE2gsibZuqpSheuh2lMhQLgxhOqV237lJ34QIxFtomqVPNQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSWKJe6d6ndE2gsibZuqpSheuh2lMhQLgxhOqV237lJ34QIxFtomqVPNQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoStg6dnRePicRgo3uictsZUXwpAbbEvQgSp7fgBB4QlrqVXMYpPicTfCSVQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoStg6dnRePicRgo3uictsZUXwpAbbEvQgSp7fgBB4QlrqVXMYpPicTfCSVQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSRFIyuRbg8ibVPY75JtdQribSribrsRAtNlONAW3Ulib4kmMpda0ArpKgBg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSRFIyuRbg8ibVPY75JtdQribSribrsRAtNlONAW3Ulib4kmMpda0ArpKgBg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSZF4ia2anJeCJSPibIAJFFmoicryiboicqWRPRe8F07MlZpRTWuvyqQmpN0A/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSZF4ia2anJeCJSPibIAJFFmoicryiboicqWRPRe8F07MlZpRTWuvyqQmpN0A/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSustHGsg6ouSIiaz3evc5qLepFNnLdVcia0VNPzIDf3fXUmynz4AXeoMg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSustHGsg6ouSIiaz3evc5qLepFNnLdVcia0VNPzIDf3fXUmynz4AXeoMg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSuAtvC9M2v8fawNWj9jKCCHmRKRjILRat9H4icr03WGd4bq5vBFG2Rww/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYCI2QnF5lf0tatx7SAtXoSuAtvC9M2v8fawNWj9jKCCHmRKRjILRat9H4icr03WGd4bq5vBFG2Rww/640?wx_fmt=png"></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/ME2JIdSnH-UPt74ZPhzVwA",target="_blank" rel="noopener noreferrer">原文链接</a>
