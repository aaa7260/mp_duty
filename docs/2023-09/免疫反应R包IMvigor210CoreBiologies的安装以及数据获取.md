---
title: "免疫反应R包IMvigor210CoreBiologies的安装以及数据获取"
date: 2023-09-02T01:10:17Z
draft: ["false"]
tags: [
  "fetched",
  "果子学生信"
]
categories: ["Acdemic"]
---
免疫反应R包IMvigor210CoreBiologies的安装以及数据获取 by 果子学生信
------
<div><section><p>这是一个当前十分流行的免疫反应队列数据包。<br>如果你搞免疫反应的signature，这个包应该没办法错过。</p><p>他有个专门的指导页面<br>http://research-pub.gene.com/IMvigor210CoreBiologies/<br>里面有R包的下载地址，以及安装过程，但是尽管如此，还是有很多人安装不上。<br>这一节，我们就以这个R包的安装为例，讲解一下本地包的安装流程，作为大课内容的补充。</p><p>在开始之前，我们最好已经度过了第一个阶段，你的电脑里面应该有R和Rstudio，并且你已经知道了正常R包的安装方法。<br>如果不清楚，就不要往下看了，以你当前的能力，不足以处理这个数据。<br>如果想要补课，就按照这个流程做一下。<br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650736317&amp;idx=1&amp;sn=c4e2d0162c39e805a82d0907895f333e&amp;scene=21#wechat_redirect" data-linktype="2">新手第1课，配置一个好用的R语言工作环境</a></p><p>本地R包安装流畅正式开始</p><h4><span>第一，下载R包，并直接安装</span></h4><p>下载的链接在网页中提供了，但是当前可能失效，我已经下载到了本地的resource文件夹中。</p><p>以下代码是直接安装本地包</p><pre><code>install.packages(<span>"resource/IMvigor210CoreBiologies_1.0.0.tar.gz"</span>, repos = <span>NULL</span>, <span>type</span> = <span>"source"</span>)<br></code></pre><p>第一次安装，肯定是不可能成功的，他会报错并且提示有些R包没有安装。<br>注意，这里每个人的电脑显示的都不一样，有多少就需要自己手工安装多少<br></p><figure><img data-ratio="0.08433734939759036" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5vgWsAVr3kqsxiaPIq5CXNzFT9svpAWmxw6c6mib6BdricOicZXwDbjywn8w/640?wx_fmt=png" data-type="png" data-w="1743" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5vgWsAVr3kqsxiaPIq5CXNzFT9svpAWmxw6c6mib6BdricOicZXwDbjywn8w/640?wx_fmt=png"></figure><h4><span>第二，手工安装依赖的R包</span></h4><p>把刚才缺失的R包，一个个确定安装方式，要么是CRAN的就用<code>install.packages()</code><br>要么就是Bioconductor的，就用 <code>BiocManager::install()</code></p><p>因为这些R包的安装代码是判断语句，不会重复安装，可以重复运行，确保都安装成功</p><pre><code><span>### 设置镜像</span><br>options(<span>"repos"</span>=c(CRAN=<span>"https://mirrors.tuna.tsinghua.edu.cn/CRAN/"</span>))<br>options(BioC_mirror=<span>"https://mirrors.tuna.tsinghua.edu.cn/bioconductor"</span>)<br><span>### 安装缺失的R包-CRAN</span><br><span>if</span>(!requireNamespace(<span>"dplyr"</span>,quietly = <span>TRUE</span>)) install.packages(<span>"dplyr"</span>)<br><span>if</span>(!requireNamespace(<span>"DT"</span>,quietly = <span>TRUE</span>)) install.packages(<span>"DT"</span>)<br><span>if</span>(!requireNamespace(<span>"ggplot2"</span>,quietly = <span>TRUE</span>)) install.packages(<span>"ggplot2"</span>)<br><span>if</span>(!requireNamespace(<span>"reshape2"</span>,quietly = <span>TRUE</span>)) install.packages(<span>"reshape2"</span>)<br><span>if</span>(!requireNamespace(<span>"plyr"</span>,quietly = <span>TRUE</span>)) install.packages(<span>"plyr"</span>)<br><span>if</span>(!requireNamespace(<span>"survival"</span>,quietly = <span>TRUE</span>)) install.packages(<span>"survival"</span>)<br><span>if</span>(!requireNamespace(<span>"circlize"</span>,quietly = <span>TRUE</span>)) install.packages(<span>"circlize"</span>)<br><span>if</span>(!requireNamespace(<span>"lsmeans"</span>,quietly = <span>TRUE</span>)) install.packages(<span>"lsmeans"</span>)<br><span>if</span>(!requireNamespace(<span>"spatstat"</span>,quietly = <span>TRUE</span>)) install.packages(<span>"spatstat"</span>)<br><span>if</span>(!requireNamespace(<span>"corrplot"</span>,quietly = <span>TRUE</span>)) install.packages(<span>"corrplot"</span>)<br><span>### 安装缺失的R包-Bioconductor</span><br><span>if</span>(!requireNamespace(<span>"ComplexHeatmap"</span>,quietly = <span>TRUE</span>)) BiocManager::install(<span>"ComplexHeatmap"</span>)<br><span>if</span>(!requireNamespace(<span>"biomaRt"</span>,quietly = <span>TRUE</span>)) BiocManager::install(<span>"biomaRt"</span>)<br><span>if</span>(!requireNamespace(<span>"DESeq2"</span>,quietly = <span>TRUE</span>)) BiocManager::install(<span>"DESeq2"</span>)<br><span>if</span>(!requireNamespace(<span>"edgeR"</span>,quietly = <span>TRUE</span>)) BiocManager::install(<span>"edgeR"</span>)<br><span>if</span>(!requireNamespace(<span>"limma"</span>,quietly = <span>TRUE</span>)) BiocManager::install(<span>"limma"</span>)<br></code></pre><h4><span>第三，特殊情况特殊处理(optional)</span></h4><p>一般的R包安装，没有这个步骤。此处IMvigor210CoreBiologies依赖Deseq包，但是这个包在当前版本中已经不存在(R4.2.1)<br>这时候，我们就需要去既往的储存中翻出这个R包的是存档，手工安装。<br>在这个链接中<br>https://bioconductor.statistik.tu-dortmund.de/packages/3.8/bioc/html/DESeq.html<br>下载这个链接到本地<br></p><figure><img data-ratio="0.3188405797101449" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5vv03UticdoRx6Oq6Br1tpiaV0TBgibbJzCF9kLc46jYFc02y5iaMR7YcLKg/640?wx_fmt=png" data-type="png" data-w="897" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5vv03UticdoRx6Oq6Br1tpiaV0TBgibbJzCF9kLc46jYFc02y5iaMR7YcLKg/640?wx_fmt=png"></figure><p>现在我们就进入一个循环，安装本地的Deseq包，需要手工安装依赖，好在本次并不需要(因为按照我之前的R包安装流程，他需要的都安装好了，注意，这是巧合，并不是每个R包都这样，该安装的还是要手工安装)</p><pre><code>install.packages(<span>"resource/DESeq_1.34.1.tar.gz"</span>, repos = <span>NULL</span>, <span>type</span> = <span>"source"</span>)<br></code></pre><p>加载测试</p><pre><code><span>library</span>(DESeq)<br></code></pre><p>他还会提示你，想要更好的体验，可以尝试Deseq2, 我只能呵呵一笑，世人只知道Deseq2，并不知道Deseq 1代啊</p><pre><code>载入需要的程辑包：lattice<br>    Welcome <span>to</span> <span>'DESeq'</span>. <span>For</span> improved performance,<br>    usability <span>and</span> functionality, please consider<br>    migrating <span>to</span> <span>'DESeq2'</span>.<br></code></pre><h4><span>第四，安装本地R包，加载测试</span></h4><pre><code><span>### 最后安装IMvigor210CoreBiologies</span><br>install.packages(<span>"resource/IMvigor210CoreBiologies_1.0.0.tar.gz"</span>, repos = <span>NULL</span>, <span>type</span> = <span>"source"</span>)<br><span>### 加载R包</span><br><span>library</span>(IMvigor210CoreBiologies)<br></code></pre><p>最终就成功了。</p><h4><span>第五，使用安装好的R包，提取内部数据</span></h4><p>这里，我们在乎的是他里面的数据，可以直接提取一下</p><pre><code><span>data</span>(cds)<br>expreSet &lt;- <span>as</span>.<span>data</span>.frame(counts(cds))<br>annoData &lt;- fData(cds)<br>phenoData &lt;- pData(cds)<br></code></pre><p>expreSet 是个是表达矩阵，行是基因31286，列是样本348<br></p><figure><img data-ratio="0.45403508771929824" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5vxK51O4pBCCvbDrkI5kmaGFMzdr5fJ6npe5q0JefkibbhpWiaDY7npFEw/640?wx_fmt=png" data-type="png" data-w="1425" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5vxK51O4pBCCvbDrkI5kmaGFMzdr5fJ6npe5q0JefkibbhpWiaDY7npFEw/640?wx_fmt=png"></figure><p>annoData就是基因的注释信息<br></p><figure><img data-ratio="0.611954459203036" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5vxS3au1ltibGg0NImHNdbjicTq3C5GIiaiaEx8v6Itiarr5v9IMjibsQ0F8yQ/640?wx_fmt=png" data-type="png" data-w="1054" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5vxS3au1ltibGg0NImHNdbjicTq3C5GIiaiaEx8v6Itiarr5v9IMjibsQ0F8yQ/640?wx_fmt=png"></figure><p>phenoData就是样本信息啦，有25列信息，挺丰富的。<br></p><figure><img data-ratio="0.5383022774327122" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5vYP3tqgYgHYchxicFaLcickEmLVh9tBR7CMzfQj8HCWIia4eMkQeJTGtNA/640?wx_fmt=png" data-type="png" data-w="1449" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5vYP3tqgYgHYchxicFaLcickEmLVh9tBR7CMzfQj8HCWIia4eMkQeJTGtNA/640?wx_fmt=png"></figure><p>我把这些数据合并成一个Rdata，放在了公众号</p><pre><code><span>save</span>(expreSet,annoData,phenoData,file = <span>"resource/IMvigor210CoreBiologies.Rdata"</span>)<br></code></pre><p>也就意味着，你可以不安装这个R包，直接来用数据啦，直接load加载，三个数据全部导入R语言中</p><pre><code><span>load</span>(<span>file</span> = <span>"resource/IMvigor210CoreBiologies.Rdata"</span>)<br></code></pre><p>这样，差异分析，富集分析，建模，signature提取，这些常规的操作都能做起来了。<br>对于我教过的学员，我提醒一句，用课程中的技能好好分析这个数据，你肯定能得到更多的信息。<br>比如，为什么有些人对PD-1治疗敏感呢，数据就明摆着，但是分析靠认知和技能。</p><p>除此之外，如果没有思路，咱们可以用<code>IMvigor210CoreBiologies</code>这个关键词去Pubmed检索，<br>出来的都是使用过他的文章，提取分数高一点的，模仿一下，思路就来啦！</p><h4><span>可能的替代方案</span></h4><p>此刻，一句代码就把数据导入了R语言，我认为其他方法都不好使啦。<br>比如，有人把这个数据打包到了<code>easierData</code>这个R包中。</p><pre><code><span>if</span>(!requireNamespace(<span>"easierData"</span>,quietly = TRUE)) BiocManager::install(<span>"easierData"</span>)<br>library(easierData)<br>library(SummarizedExperiment)<br><span>data</span> &lt;- get_Mariathasan2018_PDL1_treatment()<br>expreSet &lt;- assay(<span>data</span>)<br>phenoData &lt;- <span>as</span>.<span>data</span>.frame(colData(<span>data</span>))<br></code></pre><p>这样也能提取数据<br>expreSet是个行是基因，列是样本的表达矩阵。<br>这个表达矩阵的基因个数是31087， 少于之前的数据，推测是删除了重复的基因名称<br></p><figure><img data-ratio="0.5358333333333334" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5voRl1Ed3HMJHwMATQDQeONmss3INnbmIH7o4StgibiaBoZYS0ZFsiawRibA/640?wx_fmt=png" data-type="png" data-w="1200" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5voRl1Ed3HMJHwMATQDQeONmss3INnbmIH7o4StgibiaBoZYS0ZFsiawRibA/640?wx_fmt=png"></figure><p>他的样本是192，具体原因我没看文章，也不清楚，但是之前的数据，临床信息都放在那里，很容易就提取出来</p><p>他的phenoData只有三列<br></p><figure><img data-ratio="0.6583941605839416" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5vga8XDdGVicbWq6yo6pDdRDqAicvhOMAR8DQeXKNX0yZvicJl98FVB1vBA/640?wx_fmt=png" data-type="png" data-w="685" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5vga8XDdGVicbWq6yo6pDdRDqAicvhOMAR8DQeXKNX0yZvicJl98FVB1vBA/640?wx_fmt=png"></figure><p>因此该方案我不喜欢。</p><h4><span>能不能得到TPM格式的数据？</span></h4><p>能！<br>有三种方法<br>第一，easierData的包中自带，可以直接提取。</p><pre><code><span>library</span>(easierData)<br><span>library</span>(SummarizedExperiment)<br>data &lt;- get_Mariathasan2018_PDL1_treatment()<br>expreSet_tpm &lt;- data<span>@assays</span><span>@data</span>$tpm<br></code></pre><p>缺点是样本是192个，可能不全。</p><p>第二，自己转换。<br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650735763&amp;idx=1&amp;sn=1420bf4e4b7d963771ffe614ddda6bff&amp;scene=21#wechat_redirect" data-linktype="2">以Counts转TPM为例, 感受一下生信自学中阳性对照的重要性</a></p><p>在这里要注意的是，counts转TPM，最重要的是获取基因长度。<br>这个只要知道作者使用的gtf文件，就可以获取（以v36版本为例）</p><pre><code>library(GenomicFeatures)<br><span>#</span><span><span># 1.读取GTF文件</span></span><br>txdb &lt;- makeTxDbFromGFF("resource/gencode.v36.annotation.gtf")<br><span>#</span><span><span># 2.提取外显子信息</span></span><br>exonic &lt;- exonsBy(txdb, by="gene")<br><span>#</span><span><span># 3.外显子长度求和</span></span><br>exonic.gene.sizes &lt;- sum(width(reduce(exonic)))<br><span>#</span><span><span># 4.结果整理</span></span><br>mygeneids &lt;- data.frame(gene_id=names(exonic.gene.sizes),width=exonic.gene.sizes)<br></code></pre><p>本文中需要大家自己去methods部分读一下，找出正确的gtf版本<br>在该R包提供的基因注释文件中，也出现了length字样的列<br></p><figure><img data-ratio="0.6961789375582479" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5vMFibvIVQPaQpyuMIoPWIZcIxpFXxxgsJJ3ibzEP8QK4aTic2P6E1UmjYg/640?wx_fmt=png" data-type="png" data-w="1073" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX24iawyS4nEmGhRM9KqpPO5vMFibvIVQPaQpyuMIoPWIZcIxpFXxxgsJJ3ibzEP8QK4aTic2P6E1UmjYg/640?wx_fmt=png"></figure><p>注意，这个来路不明，可能不是正确的基因长度</p><p>第三，从原始数据开始，下载RNAseq数据，走转录组的上游分析。<br>就可以直接获取counts和TPM文件。<br>从7月份的课程开始，我们的课程中增加了这部分内容，感兴趣的可以自行分析一下。</p><h4><span>数据获取</span></h4><p>R包安装以及数据获取，直接在果子学生信公众号，回复"<strong>果子IMvigor210</strong>"自组获取。</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/8zJ5nCrVzig5TRnK1KTdsA",target="_blank" rel="noopener noreferrer">原文链接</a>
