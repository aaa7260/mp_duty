---
title: "跟着PNAS学绘图｜树状地图"
date: 2023-09-26T00:56:30Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
跟着PNAS学绘图｜树状地图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来尝试绘制<strong>「PNAS」</strong>中的一张论文图，树状地图由于作者为提供原始数据，小编自己导入数据进行了图形绘制，过程仅参考，希望各位观众老爷能够喜欢。数据代码已经整合上传到2023VIP交流群，加群的观众老爷可自行下载，有需要的朋友可关注文末介绍加入VIP交流群</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><p><img data-galleryid="" data-ratio="0.3194444444444444" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYib6Vf5Lfu4s64dJIEWhdGMvrcDEx2Rxgd91TOF5sjqy47Wqf2cTO1c5Nhdibh8G5IhOnR53j6XKrw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYib6Vf5Lfu4s64dJIEWhdGMvrcDEx2Rxgd91TOF5sjqy47Wqf2cTO1c5Nhdibh8G5IhOnR53j6XKrw/640?wx_fmt=png"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>论文</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="0.3675925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvWaVgWNZ6Y620AOxhJc3WR98pX7Dia460OZJzhXaPicslN4hnNteQMVYw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvWaVgWNZ6Y620AOxhJc3WR98pX7Dia460OZJzhXaPicslN4hnNteQMVYw/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>论文图</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="0.7675925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvcAMnAc1brA1SlkmErMVEjacXO0dzoL59nsDF7JzwzQ3nSDo146defA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvcAMnAc1brA1SlkmErMVEjacXO0dzoL59nsDF7JzwzQ3nSDo146defA/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(ggtext)<br><span>library</span>(glue)<br><span>#install.packages("rcartocolor")</span><br><span>library</span>(rcartocolor)<br><span>library</span>(VoronoiPlus) <br><span># devtools::install_github("AllanCameron/VoronoiPlus")</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>all_countries &lt;- read_csv(<span>"all_countries.csv"</span>)<br>country_regions &lt;- read_csv(<span>"country_regions.csv"</span>)<br>global_economic_activity &lt;- read_csv(<span>"global_economic_activity.csv"</span>)<br>global_human_day &lt;- read_csv(<span>"global_human_day.csv"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>au_data &lt;- all_countries |&gt; <br>  select(Category, Subcategory, hoursPerDayCombined, country_iso3) |&gt; <br>  left_join(country_regions, by = <span>"country_iso3"</span>) |&gt; <br>  filter(country_name == <span>"Australia"</span>) |&gt; <br>  select(Category, Subcategory, hoursPerDayCombined)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建绘图数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>au_vor &lt;- voronoi_treemap(hoursPerDayCombined ~ Category + Subcategory,<br>                          data = au_data)<br>                          <br>set.seed(1234)<br>groups &lt;- filter(au_vor, level == 1)<br><br>subgroups &lt;- filter(au_vor, level == 2) |&gt; <br>  group_by(group) |&gt; <br>  mutate(alpha = runif(1, 0, 0.6)) |&gt; <br>  ungroup()<br><br>r &lt;- 1.1<br>theta &lt;- seq(0, (2 * pi), length.out = 13)[1:12]<br>clock_data &lt;- tibble(<br>  x = r * cos(theta),<br>  y = r * sin(theta),<br>  angle = 90 + 360 * (theta / (2 * pi)),<br>  label = c(<span>"III"</span>, <span>"II"</span>, <span>"I"</span>, <span>"XII"</span>, <span>"XI"</span>, <span>"X"</span>, <span>"IX"</span>, <span>"VIII"</span>, <span>"VII"</span>, <span>"VI"</span>, <span>"V"</span>, <span>"IV"</span>)<br>)<br>theta2 &lt;- seq(0, (2 * pi), length.out = 61)[1:60]<br>clock_data2 &lt;- tibble(<br>  x = r * cos(theta2),<br>  y = r * sin(theta2))<br>clock_data3 &lt;- tibble(<br>  x = c(0.9, 0.7) * cos(theta[c(2, 6)]),<br>  y = c(0.9, 0.7) * sin(theta[c(2, 6)]),<br>  grp = c(1, 2)<br>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>定义颜色</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>cols_vec = rcartocolor::carto_pal(length(unique(au_data$Category))+<span>1</span>, <span>"Prism"</span>)[<span>1</span>:length(unique(au_data$Category))]<br>names(cols_vec) = unique(au_data$Category)<br><br>highlight_col &lt;- cols_vec[<span>1</span>]<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>ggplot() +<br>  geom_polygon(data = groups,mapping = aes(x = x, y = y, group = group, fill = group),<br>               colour = <span>"#fafafa"</span>,linewidth = <span>1</span>) +<br>  geom_polygon(data = subgroups,<br>               mapping = aes(x = x, y = y, group = group, alpha = alpha),<br>               fill = <span>"#fafafa"</span>,colour = <span>"#fafafa"</span>,linewidth = <span>0.3</span>) +<br>  geom_label(data = clock_data,<br>             mapping = aes(x = x, y = y, label = label),<br>             size = <span>8</span>,label.size = <span>0</span>,fill = <span>"#fafafa"</span>,<br>             colour = <span>"grey10"</span>,fontface = <span>"bold"</span>)+<br>  geom_point(data = data.frame(),mapping = aes(x = <span>0</span>, y = <span>0</span>),<br>             size = <span>3</span>,colour = <span>"grey10"</span>) +<br>  geom_segment(data = clock_data3,<br>               mapping = aes(x = <span>0</span>, y = <span>0</span>, xend = x, yend = y, group = grp),<br>               linewidth = <span>1</span>,<br>               colour = <span>"grey10"</span>) +<br>  geom_point(data = clock_data2,<br>             mapping = aes(x = x, y = y),<br>             size = <span>0.5</span>,<br>             colour = <span>"grey10"</span>) +<br>  scale_alpha_identity() +<br>  scale_fill_manual(values = cols_vec) +<br>  coord_equal() +<br>  theme_void(base_size = <span>12</span>) +<br>  theme(<br>    legend.background = element_blank(),<br>    legend.spacing.x = unit(<span>0</span>,<span>"in"</span>),<br>    legend.key.height = unit(<span>0.2</span>,<span>"in"</span>),<br>    legend.key.width = unit(<span>0.2</span>,<span>"in"</span>),<br>    legend.title = element_blank(),<br>    plot.background = element_rect(fill = <span>"#fafafa"</span>, colour = <span>'#fafafa'</span>),<br>    panel.background = element_rect(fill = <span>"#fafafa"</span>, colour = <span>"#fafafa"</span>),<br>    plot.margin = margin(<span>10</span>, <span>10</span>, <span>10</span>, <span>10</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7953703703703704" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSv7ZT2cx6X9nKAaqVlBujHO6BpB1QotsfdlfcZAFxJdpH4IoSQtjXtBQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSv7ZT2cx6X9nKAaqVlBujHO6BpB1QotsfdlfcZAFxJdpH4IoSQtjXtBQ/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节内容介绍到此结束，过程仅供参考；有需要学习个性化数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>购买<strong>「2023年度会员文档」</strong>同步更新中<strong>「售价149元」</strong>，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；按照往年数据小编年产出约在150+以上</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可下单购买，需要了解更多信息的朋友欢迎交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>小编微信</span><span></span></h3><p><img data-galleryid="" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg" data-type="jpeg" data-w="430" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAaNu6sU2UCYkxFq9ibq75wuaO0lqFoYz1icUo4jh3N2icAWECmibgPvqyReur0FCp7JNKO0icnRAsbO9ug/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023会员群案例展示</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvy0gWP0fPeg3nZMEdN4alxA5oia9EkKesapeK3krZrSNO6x2YaPQyzaQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvy0gWP0fPeg3nZMEdN4alxA5oia9EkKesapeK3krZrSNO6x2YaPQyzaQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvx2WAgWr7xS47ewoMD3wjEYfS6PX8HZ9Ky5PfgOFYWH3khK8TtLrMzg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvx2WAgWr7xS47ewoMD3wjEYfS6PX8HZ9Ky5PfgOFYWH3khK8TtLrMzg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvhR93F9zzDamZeGRZISDWhJmwhyzIzmYAlL7WeZOK8PxVekZwFibjDyQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvhR93F9zzDamZeGRZISDWhJmwhyzIzmYAlL7WeZOK8PxVekZwFibjDyQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvS72QqcpNptEn4VGPO7OY2bnrx1zhH1ERHmEDr4SQdddzicdq2Aicyb0A/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvS72QqcpNptEn4VGPO7OY2bnrx1zhH1ERHmEDr4SQdddzicdq2Aicyb0A/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvO37veoTYKPdwSJG8pBtrtoIOm6MicIVjzs42FlQLrW4MpEv8kPUVlHg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvO37veoTYKPdwSJG8pBtrtoIOm6MicIVjzs42FlQLrW4MpEv8kPUVlHg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvmjibQ3FehmX51nwKB6gSv2UwGYXjGbTRWiaUgs3C4QMNH1wrs1PnnHxw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvmjibQ3FehmX51nwKB6gSv2UwGYXjGbTRWiaUgs3C4QMNH1wrs1PnnHxw/640?wx_fmt=png"><span></span></p><p data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSv7Sdibha1tZ6uCrS9ibC7CSEJiaibks7o154Fko3jaqqfY1N6VHGlwZkFqA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSv7Sdibha1tZ6uCrS9ibC7CSEJiaibks7o154Fko3jaqqfY1N6VHGlwZkFqA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvRVfogzrJQA8ejB16HBvcyZCAqyXXXcbxr7J7SXsxSLxCVDjmyQS2ZA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYglR89IZtyFTBBITibMbiaSvRVfogzrJQA8ejB16HBvcyZCAqyXXXcbxr7J7SXsxSLxCVDjmyQS2ZA/640?wx_fmt=png"></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/nfhjztmjaGv72gn8MY--iA",target="_blank" rel="noopener noreferrer">原文链接</a>
