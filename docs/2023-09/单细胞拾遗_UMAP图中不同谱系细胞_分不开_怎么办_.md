---
title: "单细胞拾遗：UMAP图中不同谱系细胞“分不开”怎么办？"
date: 2023-09-03T09:57:36Z
draft: ["false"]
tags: [
  "fetched",
  "生信随笔"
]
categories: ["Acdemic"]
---
单细胞拾遗：UMAP图中不同谱系细胞“分不开”怎么办？ by 生信随笔
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">在阅读单细胞文献或者我自己在分析实战过程中，特别针对是首次分群，偶尔会遇到不同细胞谱系有交叉的情况。最简单的一个例子就是UMAP图上T细胞与上皮细胞存在部分交叉（藕断丝连），无法做到泾渭分明的情况。例如我在实战过程遇到的：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.7220779220779221" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqia0kJF3oHDwoRn2iaeXSVbYULHyEHCM55AtHJIgFYmxd2S4Hs4AAb0UhQ/640?wx_fmt=other" data-type="other" data-w="770" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqia0kJF3oHDwoRn2iaeXSVbYULHyEHCM55AtHJIgFYmxd2S4Hs4AAb0UhQ/640?wx_fmt=other"><figcaption>image-20230903162907233</figcaption></figure><ul data-tool="mdnice编辑器"><li><section>另外，我在分析一个脑相关数据集中也遇到这种情况：</section></li></ul><figure data-tool="mdnice编辑器"><img data-ratio="0.7766143106457243" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiaibAVlTvg9OSzL8Tml6iaQUeFQP8oyWJm2ghSkPicMQnY4O7zS5euepZLA/640?wx_fmt=other" data-type="other" data-w="573" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiaibAVlTvg9OSzL8Tml6iaQUeFQP8oyWJm2ghSkPicMQnY4O7zS5euepZLA/640?wx_fmt=other"><figcaption>image-20230903163032806</figcaption></figure><p data-tool="mdnice编辑器"><strong>其实即便是高分文章，也会有这种情况，例如：</strong></p><ul data-tool="mdnice编辑器"><li><section>2022年发表在Cancer Discovery的胃癌文章（PMID: 34642171）：</section></li></ul><figure data-tool="mdnice编辑器"><img data-ratio="0.6696428571428571" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiaSQUfVAgwRicl1StfMDQJkHXXI675W4BibUOFsf4tb1icuBibj4AepswgiaQ/640?wx_fmt=other" data-type="other" data-w="560" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiaSQUfVAgwRicl1StfMDQJkHXXI675W4BibUOFsf4tb1icuBibj4AepswgiaQ/640?wx_fmt=other"><figcaption>image-20230903155502807</figcaption></figure><ul data-tool="mdnice编辑器"><li><section>2022年发表在NC上的泛癌文章（PMID: 36333338），这个谱系交叉就更加严重了：</section></li></ul><figure data-tool="mdnice编辑器"><img data-ratio="0.8733031674208145" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqia92ibuUC14puuySsiayqWcDccARLIcSRY8icCkfeae3LiceyH3WfRBEI4Pw/640?wx_fmt=other" data-type="other" data-w="663" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqia92ibuUC14puuySsiayqWcDccARLIcSRY8icCkfeae3LiceyH3WfRBEI4Pw/640?wx_fmt=other"><figcaption>image-20230903155114550</figcaption></figure><p data-tool="mdnice编辑器"><strong>比较漂亮的UMAP图应该是泾渭分明的，例如：</strong></p><ul data-tool="mdnice编辑器"><li><section>2022年发表在NC上的胃癌文章（PMID: 35999201）：</section></li></ul><figure data-tool="mdnice编辑器"><img data-ratio="1.1149193548387097" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqia1bibAfHFLCc1mLd38NJWgicInk6emeIeq1ic4VvmlCNfEAPvuibXtmZcLg/640?wx_fmt=other" data-type="other" data-w="496" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqia1bibAfHFLCc1mLd38NJWgicInk6emeIeq1ic4VvmlCNfEAPvuibXtmZcLg/640?wx_fmt=other"><figcaption>image-20230903161604495</figcaption></figure><ul data-tool="mdnice编辑器"><li><section><p>2022年发表在GB上的胃癌文章（PMID: 36550535）：<img data-ratio="0.7410468319559229" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiadLHXjklDuqMFGIM11RJhefEZdrSH0bNaPyfEk997rp2ca1qWudibBibQ/640?wx_fmt=other" data-type="other" data-w="726" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiadLHXjklDuqMFGIM11RJhefEZdrSH0bNaPyfEk997rp2ca1qWudibBibQ/640?wx_fmt=other"></p></section></li><li><section><p>2022年发表在NC上的CRC文章（PMID: 35365629）</p></section></li></ul><figure data-tool="mdnice编辑器"><img data-ratio="0.5572005383580081" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiaRMdPurQoqMpsnTT8hmKSkvzxcs6Fjs9hhO0uPH7uCQcxMGibtBeXlicA/640?wx_fmt=other" data-type="other" data-w="743" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiaRMdPurQoqMpsnTT8hmKSkvzxcs6Fjs9hhO0uPH7uCQcxMGibtBeXlicA/640?wx_fmt=other"><figcaption>image-20230903162328395</figcaption></figure><ul data-tool="mdnice编辑器"><li><section><p>如果说NC那篇泛癌文章（PMID: 36333338）是因为挖掘的公共数据集，批次效应太大了而造成的严重谱系交叉，那么这篇肺癌文章（PMID: 36368318）做出了一个很好的示例。同样是公共数据集挖掘，同样是超大细胞量，这篇文章的UMAP图显示不同谱系间仍然是泾渭分明的：</p><figure><img data-ratio="0.9279279279279279" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiaN21fSgFqUlrgYicf9tRGWY4tmzkgHBBc6BZm2yWOBb9W2vCR0jnN7mQ/640?wx_fmt=other" data-type="other" data-w="333" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiaN21fSgFqUlrgYicf9tRGWY4tmzkgHBBc6BZm2yWOBb9W2vCR0jnN7mQ/640?wx_fmt=other"><figcaption>image-20230903163547682</figcaption></figure></section></li></ul><p data-tool="mdnice编辑器"><strong>那么，如果在初次分群时这种不同细胞谱系的交叉/藕断丝连情况会带来哪些问题呢？又有哪些解决方案呢？</strong></p><p data-tool="mdnice编辑器">很久以来，我一直在思考这个问题。</p><p data-tool="mdnice编辑器">首先，不同细胞谱系“分不开”带来的最显著问题是UMAP图不美观。当然，也有朋友指出来，UMAP图是二维的，也许在空间上不同细胞谱系可能是泾渭分明的，只是视觉上的问题。</p><p data-tool="mdnice编辑器">第二，是否有悖生物学常识（审稿人也许会对此进行质疑）？<strong>在考虑生物学背景的前提下</strong>，上皮/免疫/基质细胞这些细胞具有相当不同的谱系特征，因此理论上应该是泾渭分明的。</p><p data-tool="mdnice编辑器">第三，我的经验上来说（针对这点，我认为我还需要更多经验），<strong>如果首次分群是藕断丝连的，再聚类时，容易造成细胞类型的误判（也许数量不会特别多），从而影响到二次分群。</strong></p><p data-tool="mdnice编辑器">第四，事出反常必有原因？从我的经验上来说，出现这种情况也有可能是数据存在双细胞/低质量细胞，从而造成了这种情况。所以说，出现了不同细胞谱系“分不开”的情况，也许可以提示分析者，反过去检查细胞的质量问题。这个问题的详细示例可见下文。</p><p data-tool="mdnice编辑器">...（也许还会有一些别的问题，之后想到了再更新）</p><p data-tool="mdnice编辑器"><strong>那么，解决方案有哪些？</strong></p><ul data-tool="mdnice编辑器"><li><section>按照我的经验思路来说，初次分群遇到这种藕断丝连的UMAP图，我一般会继续进行聚类分析，选择合适的分辨率后，先检查细胞质量（低质量细胞/双细胞），例如这个数据集中，我发现C2是一群低质量细胞的集合体，因此无法注释C2，且C2的存在导致了“藕断丝连”的情况。在删除这群细胞后再次降维聚类，这个问题就解决了。</section></li></ul><figure data-tool="mdnice编辑器"><img data-ratio="0.48579545454545453" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiaUZmHhdr01BBQdO6tL2J33mHNiaofytLyeKd4IPpANia2qpx9fNUWib0Ng/640?wx_fmt=other" data-type="other" data-w="704" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiaUZmHhdr01BBQdO6tL2J33mHNiaofytLyeKd4IPpANia2qpx9fNUWib0Ng/640?wx_fmt=other"><figcaption>image-20230903170701625</figcaption></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.5456885456885456" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiaY5wMLqnZOGPtaH3Q2Qicyf1WZ4JCNlw2icbibvTVXsiaBrArhd5IRXW7Bg/640?wx_fmt=other" data-type="other" data-w="777" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiaY5wMLqnZOGPtaH3Q2Qicyf1WZ4JCNlw2icbibvTVXsiaBrArhd5IRXW7Bg/640?wx_fmt=other"><figcaption>image-20230903171026771</figcaption></figure><ul data-tool="mdnice编辑器"><li><section><p>第二，排除不同变异源。一种可能的原因是去批次时指定的<code>batch</code>标签未正确设置。此外，检查异常细胞是否是增殖相关的细胞（高表达MKI67，TOP2A），有可能是因为增殖的特性导致这种现象，因此可以考虑校正细胞周期，可参考 <a href="https://mp.weixin.qq.com/s?__biz=Mzg5MjcxNzg1NA==&amp;mid=2247483968&amp;idx=1&amp;sn=ec13abc2b635574e613eba2006419050&amp;scene=21#wechat_redirect" data-linktype="2">单细胞归一化注意事项：校正变异源</a></p></section></li><li><section><p>第三，整合函数或者UMAP调参，例如整合函数中，是以sample为batch，还是不同的data.set为batch？<code>RunUMAP</code>函数调参可以考虑调整PCA的个数，<code>min.dist</code>等等。</p></section></li><li><section><p>第四，使用不同的整合方案。关于单细胞整合算法，我前期已介绍了很多种算法了，例如在R语言中运行CCA、RPCA、Harmony和BBKNN等算法：</p><p>我也有用python做过BBKNN、Harmony和scVI：</p></section></li><ul><li><section><a href="https://mp.weixin.qq.com/s?__biz=Mzg5MjcxNzg1NA==&amp;mid=2247484778&amp;idx=1&amp;sn=45f99192489b835d895bd2bd4d93e774&amp;scene=21#wechat_redirect" data-linktype="2">巧用Python加速单细胞分析</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=Mzg5MjcxNzg1NA==&amp;mid=2247487358&amp;idx=1&amp;sn=a9dff19083623ef3063df6ccce9ee411&amp;scene=21#wechat_redirect" data-linktype="2">单细胞多样本整合之scVI和scANVI</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=Mzg5MjcxNzg1NA==&amp;mid=2247484318&amp;idx=1&amp;sn=daf04a599413de0514afda07928eecb9&amp;scene=21#wechat_redirect" data-linktype="2">CCA单细胞多样本整合和插槽选择（一）</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=Mzg5MjcxNzg1NA==&amp;mid=2247484384&amp;idx=1&amp;sn=e114a00e1594e8996bed895df64303a2&amp;scene=21#wechat_redirect" data-linktype="2">单细胞多样本整合之RPCA</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=Mzg5MjcxNzg1NA==&amp;mid=2247484506&amp;idx=1&amp;sn=98d7fe9265243c073a1444030fcd4a30&amp;scene=21#wechat_redirect" data-linktype="2">单细胞多样本整合之Harmony，LIGER和LISI</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=Mzg5MjcxNzg1NA==&amp;mid=2247485666&amp;idx=1&amp;sn=ae0da39f47190da11c0d379c2b5bbefb&amp;scene=21#wechat_redirect" data-linktype="2">R版BBKNN整合去批次</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247515099&amp;idx=1&amp;sn=02d4a6448e3fec0ed76e2f8c85494320&amp;scene=21#wechat_redirect" data-linktype="2">单细胞多样本整合之R语言版scVI</a></section></li></ul></ul><p data-tool="mdnice编辑器">思考一下，这些大牛为何要前赴后继的开发出如此之多的整合算法？我想原因应该在于每一种算法都有其局限与优势。可能这种算法适合这种类型的数据，可能那种算法适合另外一种类型的数据。总而言之，如何判断到底哪款整合算法适合我当下分析的这个数据集？我觉得除了都跑一遍以外，没有别的好办法。例如我跑的另一个数据集：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5212962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiaibMaJckiaBKLY2FKfWtDYoQFguibTydAezIqHaObotOcIVkAeKARR3hVw/640?wx_fmt=other" data-type="other" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/fTW9zRI3eqVia44rca869SBhcia0pw3ibqiaibMaJckiaBKLY2FKfWtDYoQFguibTydAezIqHaObotOcIVkAeKARR3hVw/640?wx_fmt=other"><figcaption>image-20230903172018866</figcaption></figure><p data-tool="mdnice编辑器">除了CCA以外，其他算法的结果都还可以。总之，我相信整合算法那么多，总有一款算法适合自己的数据。</p><p data-tool="mdnice编辑器">以上是我分析过程中的一些思考和总结，希望能给小伙伴们一些启发。当然，有不对的地方还请各位批评指正。</p><span>- END -</span></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/MvdzRPCxkTbrU9JmMkK8VQ",target="_blank" rel="noopener noreferrer">原文链接</a>
