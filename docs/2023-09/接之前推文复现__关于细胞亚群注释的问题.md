---
title: "接之前推文复现--关于细胞亚群注释的问题"
date: 2023-09-07T04:52:04Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
接之前推文复现--关于细胞亚群注释的问题 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h4 data-tool="mdnice编辑器"><span></span><strong>「接上上周的复现推文，我来继续复现啦」</strong><span></span></h4><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247515995&amp;idx=1&amp;sn=1fa3424e1a4534f23c3c1d62bcf00883&amp;scene=21#wechat_redirect" data-linktype="2">文献复现及简介—胰腺癌的单细胞水平肿瘤异质性</a>  https://mp.weixin.qq.com/s/gWz-Jl5baz4vRUjhLrYN7Q</p><p data-tool="mdnice编辑器">文章中的细胞类型注释</p><p data-tool="mdnice编辑器">Endo内皮; Mes,间质; B, B细胞; Hep,肝细胞; DC，树突状细胞; pDC，浆细胞样树突状细胞; Mac,巨噬细胞; T, T细胞; NK，自然杀伤细胞。</p><figure data-tool="mdnice编辑器"><img data-ratio="1.6125" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibia4DaIkMlsjPIoliayKeaP656LZmP2mRBnCFF1uOqb0gict9VGZKibSUyTdJiaVtovaoDvOLdgWEicEmQ/640?wx_fmt=png" data-type="png" data-w="320" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibia4DaIkMlsjPIoliayKeaP656LZmP2mRBnCFF1uOqb0gict9VGZKibSUyTdJiaVtovaoDvOLdgWEicEmQ/640?wx_fmt=png"></figure><h4 data-tool="mdnice编辑器"><span></span><strong>「上上周是做到降维分群部分，这周来进行细胞亚群注释」</strong><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br>options(stringsAsFactors = <span>F</span>)<br><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(clustree)<br><span>library</span>(cowplot)<br><span>library</span>(dplyr)<br>getwd()<br>dir.create(<span>"3-cell"</span>)<br>setwd(<span>'3-cell/'</span>)<br>sce.all=readRDS( <span>"../2-harmony/sce.all_int.rds"</span>)<br>sce.all<br><br>sce.all<br>sce=sce.all <br><span>library</span>(ggplot2) <br><br><span>#细胞生物学命名marker</span><br>genes_to_check = c(<span>'PTPRC'</span>, <span>'CD3D'</span>, <span>'CD3E'</span>, <span>'CD4'</span>,<span>'CD8A'</span>,<br>                   <span>'CD19'</span>, <span>'CD79A'</span>, <span>'MS4A1'</span> ,<br>                   <span>'IGHG1'</span>, <span>'MZB1'</span>, <span>'SDC1'</span>,<br>                   <span>'CD68'</span>, <span>'CD163'</span>, <span>'CD14'</span>, <br>                   <span>'TPSAB1'</span> , <span>'TPSB2'</span>,  <span># mast cells,</span><br>                   <span>'RCVRN'</span>,<span>'FPR1'</span> , <span>'ITGAM'</span> ,<br>                   <span>'C1QA'</span>,  <span>'C1QB'</span>,  <span># mac</span><br>                   <span>'S100A9'</span>, <span>'S100A8'</span>, <span>'MMP19'</span>,<span># monocyte</span><br>                   <span>'FCGR3A'</span>,<br>                   <span>'LAMP3'</span>, <span>'IDO1'</span>,<span>'IDO2'</span>,<span>## DC3 </span><br>                   <span>'CD1E'</span>,<span>'CD1C'</span>, <span># DC2</span><br>                   <span>'KLRB1'</span>,<span>'NCR1'</span>, <span># NK </span><br>                   <span>'FGF7'</span>,<span>'MME'</span>, <span>'ACTA2'</span>,<span>"CD10"</span>, <span>## human  fibo </span><br>                   <span>'DCN'</span>, <span>'LUM'</span>,  <span>'GSN'</span> , <span>## mouse PDAC fibo </span><br>                   <span>'MKI67'</span> , <span>'TOP2A'</span>, <span>'PECAM1'</span>, <span>'VWF'</span>,  <span>## endo </span><br>                   <span>'EPCAM'</span> , <span>'KRT19'</span>,<span>'KRT7'</span>, <span># epi </span><br>                   <span>'FYXD2'</span>, <span>'TM4SF4'</span>, <span>'ANXA4'</span>,<span># cholangiocytes</span><br>                   <span>'APOC3'</span>, <span>'FABP1'</span>,  <span>'APOA1'</span>,  <span># hepatocytes</span><br>                   <span>'Serpina1c'</span>,<span>'PROM1'</span>, <span>'ALDH1A1'</span>,<br>                   <span>"NKG7"</span><span>#NKT</span><br>                   )<br><br><span>library</span>(stringr)  <br>genes_to_check=str_to_upper(genes_to_check)<br>genes_to_check<br>p &lt;- DotPlot(sce.all, features = unique(genes_to_check),<br>             assay=<span>'RNA'</span>  )  + coord_flip()<br><br>p <br>ggsave(<span>'check_last_markers.pdf'</span>,height = <span>11</span>,width = <span>11</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9962358845671268" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibia4DaIkMlsjPIoliayKeaP6LibRzPUpwUJtyLmpMlyAL4N9s8wfr74yY977bDBNg5WPiaUJ1diaAN4iag/640?wx_fmt=png" data-type="png" data-w="797" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibia4DaIkMlsjPIoliayKeaP6LibRzPUpwUJtyLmpMlyAL4N9s8wfr74yY977bDBNg5WPiaUJ1diaAN4iag/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code><span>#髓系</span><br>Mac=c(<span>"CD14"</span>, <span>"CD163"</span>, <span>"APOE"</span>, <span>"C1QA"</span>, <span>"C1QB"</span>, <span>"C1QC"</span>)<br>pDC=c(<span>"LILRA4"</span>, <span>"IL3RA"</span>,<span>"TCF4"</span>,<span>"TCL1A"</span>,<span>"CLEC4C"</span>)<br>DC1=c(<span>"CLEC9A"</span>, <span>"XCR1"</span>, <span>"BATF3"</span>)  <br>DC2=c(<span>"CD1A"</span>, <span>"FCER1A"</span>, <span>"CD1C"</span>,<span>"CD1E"</span>,<span>"CLEC10A"</span>)<br>DC3=c(<span>"CCR7"</span>, <span>"LAMP3"</span>, <span>"FSCN1"</span>,<span>"CCL22"</span>,<span>"BIRC3"</span>)<br>Mono=c(<span>"VCVN"</span>, <span>"FCN1"</span>, <span>"S100A12"</span>, <span>"S100A8"</span>, <span>"S100A9"</span>,<span>'FCGR3A'</span>)<br>genes_to_check =list(<br>  Mac=Mac,<br>  pDC=pDC,<br>  DC1=DC1, <br>  DC2=DC2,<br>  DC3=DC3 ,<br>  Mono=Mono<br>)<br><span>library</span>(stringr)<br>genes_to_check = lapply(genes_to_check, str_to_upper)<br>p_all_markers=DotPlot(sce.all , <br>                      features = genes_to_check,<br>                      scale = <span>T</span>,assay=<span>'RNA'</span> )+<br>  theme(axis.text.x=element_text(angle=<span>45</span>,hjust = <span>1</span>))<br>p_all_markers<br>ggsave(<span>'check_myeloids_markers.pdf'</span>,height = <span>11</span>,width = <span>11</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9959677419354839" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibia4DaIkMlsjPIoliayKeaP6aA8e4HtzcjdO3iah9CXna6JPUbKb6iaUdddBuCj7ImUDLrpuAtexYHFg/640?wx_fmt=png" data-type="png" data-w="744" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibia4DaIkMlsjPIoliayKeaP6aA8e4HtzcjdO3iah9CXna6JPUbKb6iaUdddBuCj7ImUDLrpuAtexYHFg/640?wx_fmt=png"></figure><h4 data-tool="mdnice编辑器"><span></span>定细胞亚群<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span># 需要自行看图,定细胞亚群：</span><br><span># 文章里面的 ：  </span><br><br><span># 3,4,5: Mac</span><br><span># 17:pDC</span><br><span># 7: cDC2</span><br><span># 13：Plasma</span><br><span># 9：B</span><br><span># 1,2,6,10,11,19,20：Epi-tumor</span><br><span># 8：fibo</span><br><span># 0,18:T/NK</span><br><span># 12: T</span><br><span># 16: Meyoid</span><br><span># 15: Hep</span><br><span># 14：14</span><br><span># 21,22:干扰亚群</span><br><br>celltype=data.frame(ClusterID=<span>0</span>:<span>22</span>,<br>                    celltype= <span>0</span>:<span>22</span>) <br><br><span>#定义细胞亚群 </span><br>celltype[celltype$ClusterID %<span>in</span>% c(<span>3</span>,<span>4</span>,<span>5</span> ),<span>2</span>]=<span>'Mac'</span>  <br>celltype[celltype$ClusterID %<span>in</span>% c( <span>17</span>),<span>2</span>]=<span>'pDC'</span>   <br>celltype[celltype$ClusterID %<span>in</span>% c(<span>7</span>),<span>2</span>]=<span>'cDC2'</span>  <br>celltype[celltype$ClusterID %<span>in</span>% c( <span>13</span> ),<span>2</span>]=<span>'Plasma'</span>  <br>celltype[celltype$ClusterID %<span>in</span>% c( <span>9</span>),<span>2</span>]=<span>'B'</span>   <br>celltype[celltype$ClusterID %<span>in</span>% c( <span>1</span>,<span>2</span>,<span>6</span>,<span>11</span>,<span>19</span>,<span>20</span>),<span>2</span>]=<span>'Epi-tumor'</span> <br>celltype[celltype$ClusterID %<span>in</span>% c( <span>8</span>),<span>2</span>]=<span>'fibo'</span> <br>celltype[celltype$ClusterID %<span>in</span>% c(<span>0</span>,<span>18</span>),<span>2</span>]=<span>'T/NK'</span> <br>celltype[celltype$ClusterID %<span>in</span>% c(<span>10</span>),<span>2</span>]=<span>'10'</span><br>celltype[celltype$ClusterID %<span>in</span>% c(<span>12</span>),<span>2</span>]=<span>'T'</span><br><br>celltype[celltype$ClusterID %<span>in</span>% c( <span>16</span>),<span>2</span>]=<span>'Meyoid'</span> <br>celltype[celltype$ClusterID %<span>in</span>% c(<span>15</span>),<span>2</span>]=<span>'Hep'</span> <br>celltype[celltype$ClusterID %<span>in</span>% c(<span>14</span>),<span>2</span>]=<span>'14'</span> <br>celltype[celltype$ClusterID %<span>in</span>% c(<span>21</span>,<span>22</span>),<span>2</span>]=<span>'干扰亚群'</span><br><br>head(celltype)<br>celltype<br>table(celltype$celltype)<br><br>sce.all@meta.data$celltype = <span>"NA"</span><br><span>for</span>(i <span>in</span> <span>1</span>:nrow(celltype)){<br>  sce.all@meta.data[which(sce.all@meta.data$RNA_snn_res.0.8== celltype$ClusterID[i]),<span>'celltype'</span>] &lt;- celltype$celltype[i]}<br>table(sce.all@meta.data$celltype)<br><br><br>th=theme(axis.text.x = element_text(angle = <span>45</span>, <br>                                    vjust = <span>0.5</span>, hjust=<span>0.5</span>)) <br> <br><span>#可视化</span><br><span>library</span>(patchwork)<br>p_all_markers=DotPlot(sce.all, features = genes_to_check,<br>                      assay=<span>'RNA'</span> ,group.by = <span>'celltype'</span> )  + coord_flip()+th<br>p_umap=DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"celltype"</span>,label = <span>T</span>,label.box = <span>T</span>)<br>p_all_markers+p_umap<br><span>#ggsave('markers_umap_by_celltype_2.pdf',width = 13,height = 8)</span><br><br>sce.all=RunTSNE(sce.all,  dims = <span>1</span>:<span>15</span>, <br>        reduction = <span>"harmony"</span>)<br>p_tsne=DimPlot(sce.all, reduction = <span>"tsne"</span>, group.by = <span>"celltype"</span>,label = <span>T</span>)<br>p_all_markers+p_tsne<br><span>#ggsave('markers_tsne_by_celltype.pdf',width = 12,height = 8)</span><br><br>save(sce.all,file = <span>'sce-by-markers.Rdata'</span>)<br></code></pre><h4 data-tool="mdnice编辑器"><span></span>去除低质量干扰亚群<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span># 去除干扰亚群</span><br>table(sce.all$celltype)<br>sce.all &lt;- sce.all[, !(sce.all$celltype %<span>in</span>% c( <span>'干扰亚群'</span>))]<br>DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"celltype"</span>,<br>        label = <span>T</span>,label.box = <span>T</span>)<br>ggsave(<span>'last_umap_by_celltype.pdf'</span>,height = <span>7</span>,width = <span>8</span>)<br><br><span>library</span>(ggsci)<br>color = c(pal_d3(<span>"category20"</span>)(<span>20</span>),<br>          pal_d3(<span>"category20b"</span>)(<span>20</span>),<br>          pal_d3(<span>"category20c"</span>)(<span>20</span>),<br>          pal_d3(<span>"category10"</span>)(<span>10</span>))<br><br>p_tsne=DimPlot(sce.all, reduction = <span>"tsne"</span>, group.by = <span>"celltype"</span>,label = <span>T</span>,<br>               label.box = <span>T</span>,<br>               cols = color)<br>p_all_markers+p_tsne<br>ggsave(<span>'markers_tsne_by_celltype_end.pdf'</span>,width = <span>12</span>,height = <span>8</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6685185185185185" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibia4DaIkMlsjPIoliayKeaP6nEAqqkeQOjpa9yh655TQsUsx4GVRZia9mJOBV1Mk7ia2B8cvoRuo04lQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibia4DaIkMlsjPIoliayKeaP6nEAqqkeQOjpa9yh655TQsUsx4GVRZia9mJOBV1Mk7ia2B8cvoRuo04lQ/640?wx_fmt=png"></figure><pre data-tool="mdnice编辑器"><span></span><code>p_umap=DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"celltype"</span>,label = <span>T</span>,label.box = <span>T</span>,<br>               cols = color)<br>p_all_markers+p_umap<br>ggsave(<span>'markers_umap_by_celltype_end.pdf'</span>,width = <span>13</span>,height = <span>8</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6166666666666667" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibia4DaIkMlsjPIoliayKeaP6OiatdALxeqBR0YLibwJTdWIqyH6PVjnyUywOOGKOiae9yd42q01U4lZ6Q/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibia4DaIkMlsjPIoliayKeaP6OiatdALxeqBR0YLibwJTdWIqyH6PVjnyUywOOGKOiae9yd42q01U4lZ6Q/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">以上图来看给10,12,14亚群定义细胞分类，并没有那么明确，tsne图和umap图是有一些冲突的，<strong>「我想给10：Epi-tumor; 12:T, 14：fibo。」</strong></p><p data-tool="mdnice编辑器">如果这么给定的话，tsne图上还说的过去，但是umap图上就比较勉强，因为10的给定是关系到后续做infercnv的恶性和非恶性的划分，小伙伴们也可以自己尝试复现一下，<strong>「看看这几类细胞亚群定义成什么比较合适」</strong>~</p><p data-tool="mdnice编辑器">同时也附上各个亚群的细胞数</p><figure data-tool="mdnice编辑器"><img data-ratio="0.13473684210526315" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibia4DaIkMlsjPIoliayKeaP62h1M8t7MexuSVAK9dPHziadb6Avlaia5pDhsJwGic9tUrPAFszAWQrbSg/640?wx_fmt=png" data-type="png" data-w="950" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibia4DaIkMlsjPIoliayKeaP62h1M8t7MexuSVAK9dPHziadb6Avlaia5pDhsJwGic9tUrPAFszAWQrbSg/640?wx_fmt=png"></figure><h4 data-tool="mdnice编辑器"><span></span>后续的计划<span></span></h4><p data-tool="mdnice编辑器"><strong>「以T/NK细胞、内皮细胞、成纤维细胞和肝细胞为参照，显示用于分析恶性和非恶性的CNV评分(每个细胞改变的均方); 数据按非恶性(n = 15,302)和恶性(7,740)身份划分。」</strong>我们普遍是把Epi-tumor亚群定义为恶性细胞，后续就以部分继续做infercnv,尝试后续的复现~</p><h3 data-tool="mdnice编辑器"><span></span><span>微信交流群</span><span></span></h3><p data-tool="mdnice编辑器">如果你也想参与到群里的讨论中，给我提出一些推文更新建议的话欢迎入群。同时你也可以得到我前期更新的所有数据及代码，在群里我会把代码分享给大家，而且大家可以在群里「提出自己感兴趣的单细胞文献」<strong>「我们尽可能优先选择大家的数据集去复现和实战，也欢迎大家在群里分享更多其它资料，咱们一起进步，」</strong>「比较高级的单细胞分析」**我们也会一起尝试， 相信你肯定是会不虚此行哈。</p><p data-tool="mdnice编辑器">附上之前推文的链接 <a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247512238&amp;idx=1&amp;sn=e0c6dc2ea0e089aabb78133e50fb5d7f&amp;scene=21#wechat_redirect" data-linktype="2">为爱发电不可取（单细胞周更需要你的支持）</a></p><p data-tool="mdnice编辑器"><strong>「「目前群里已经有300多人，所以你想要进群的话就需要添加我的微信，私聊给我发99元的红包，我把你拉进群里。」」</strong></p><p data-tool="mdnice编辑器">我们这个群是真正的付费交流群，不仅提供数据，代码，学习资料，而且也会跟大家互动交流，还会坚持进行创作至少一年。所以，如果介意99元的门槛且不认可我们知识分享的理念，<strong>「请不要加我好友」</strong>。。</p><figure data-tool="mdnice编辑器"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibia4DaIkMlsjPIoliayKeaP6CzHhrBQHOvP3ic4lkMMrxMsRG8ygia7keOgyfx7FOyBicxtbCEibpzGOHQ/640?wx_fmt=png" data-type="png" data-w="172" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losibia4DaIkMlsjPIoliayKeaP6CzHhrBQHOvP3ic4lkMMrxMsRG8ygia7keOgyfx7FOyBicxtbCEibpzGOHQ/640?wx_fmt=png"><figcaption>                         </figcaption></figure></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/hPccTTuY-Lt5OdPNXcJZcw",target="_blank" rel="noopener noreferrer">原文链接</a>
