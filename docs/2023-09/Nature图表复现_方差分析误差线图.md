---
title: "Nature图表复现|方差分析误差线图"
date: 2023-09-21T15:23:26Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
Nature图表复现|方差分析误差线图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来复现<strong>「nature communications」</strong>中的一张论文图，<strong>「进行单向方差分析并做数据可视化」</strong>。由于作者为提供原始数据，因此结果会有所不同。下面小编通过一个案例来进行展示，图形仅供展示用过程仅参考，希望各位观众老爷能够喜欢。数据代码已经整合上传到2023VIP交流群，加群的观众老爷可自行下载，有需要的朋友可关注文末介绍加入VIP交流群</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h3 data-tool="mdnice编辑器"><span></span><span><span></span>论文</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="0.2712962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyj0xJIgLEWPeFn6kgEGuheRwpqXuOVGVG608a7hTPRll5KmRNUB1qCA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyj0xJIgLEWPeFn6kgEGuheRwpqXuOVGVG608a7hTPRll5KmRNUB1qCA/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>论文原图</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="0.5462962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyVYvppg7lichICDZUdic5xicSmXYudlibYYSIQ44shYbv69MibticxhAWFOAw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyVYvppg7lichICDZUdic5xicSmXYudlibYYSIQ44shYbv69MibticxhAWFOAw/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(ggtext)<br><span>library</span>(ggprism)<br><span>library</span>(ggsignif)<br><span>library</span>(rstatix)<br><span>library</span>(ggpubr)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- read_tsv(<span>"data.txt"</span>) %&gt;% pivot_longer(-Type) %&gt;% <br>  dplyr::filter(Type==<span>"Day 5"</span>) %&gt;% select(-Type)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>方差分析</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>result.aov &lt;- aov(value ~ name, data = df)<br>result.tukey &lt;- TukeyHSD(result.aov)<br><br><span># 转换p值</span><br>aov_pvalue &lt;- result.tukey$name %&gt;% as.data.frame() %&gt;% <br>  rownames_to_column(var=<span>"group"</span>) %&gt;% <br>  dplyr::select(<span>1</span>,`p adj`) %&gt;% <br>  separate(`group`, into=c(<span>"group2"</span>, <span>"group1"</span>), sep=<span>"CAR T-"</span>, convert = <span>TRUE</span>) %&gt;% <br>  mutate(group1=str_replace_all(`group1`, <span>"CAR T"</span>,<span>""</span>)) %&gt;% <br>  select(<span>2</span>,<span>1</span>,<span>3</span>) %&gt;% <br>  select(-<span>1</span>,-<span>2</span>) %&gt;% <br>  mutate(p_signif=symnum(`p adj`, corr = <span>FALSE</span>, na = <span>FALSE</span>,  <br>                         cutpoints = c(<span>0</span>, <span>0.01</span>, <span>0.05</span>,<span>1</span>), <br>                         symbols = c(<span>"**"</span>, <span>"*"</span>, <span>"ns"</span>)))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建显著性标记文件</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>在此先使用rstatix包内置的wilcox_test函数来进行统计分析得到显著性的位置信息，之后将方差分析的结果合并这样方便后期使用函数自动添加显著性标记。</p><span>❞</span></blockquote><pre data-tool="mdnice编辑器"><span></span><code>df_pvalue &lt;- df %&gt;% <br>  mutate(`name`=str_replace_all(`name`, <span>"CAR T"</span>,<span>""</span>)) %&gt;% <br>  mutate(name=str_trim(name)) %&gt;% <br>  wilcox_test(value ~ name) %&gt;% <br>  add_significance(p.col=<span>"p.adj"</span>) %&gt;% <br>  add_xy_position(x=<span>"name"</span>) %&gt;% select(-p.adj) %&gt;% <br>  bind_cols(aov_pvalue)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df %&gt;%<br>  mutate(`name`=str_replace(`name`, <span>"CAR T"</span>,<span>""</span>)) %&gt;% <br>  ggplot(aes(name,value))+<br>  stat_summary(fun = mean,geom = <span>"errorbar"</span>, width=<span>.2</span>,<br>               fun.max = <span>function</span>(x) mean(x) + sd(x),<br>               fun.min = <span>function</span>(x) mean(x) - sd(x)) +<br>  stat_summary(fun = mean, geom = <span>"crossbar"</span>,width = <span>0.4</span>,color = <span>"black"</span>,size=<span>0.5</span>) +<br>  geom_jitter(aes(fill=name,color=name,shape=name),width = <span>0.1</span>, height = <span>0</span>)+<br>  stat_pvalue_manual(df_pvalue,label=<span>"p_signif"</span>,label.size=<span>5</span>,hide.ns=<span>T</span>)+<br>  scale_shape_manual(values = c(<span>21</span>,<span>22</span>,<span>23</span>,<span>24</span>)) +<br>  scale_fill_manual(values=c(<span>"#679289"</span>,<span>"#ee2e31"</span>,<span>"#c9cba3"</span>,<span>"#f4c095"</span>))+<br>  scale_color_manual(values=c(<span>"#679289"</span>,<span>"#ee2e31"</span>,<span>"#c9cba3"</span>,<span>"#f4c095"</span>))+<br>  scale_y_continuous(guide = <span>"prism_minor"</span>,<br>                     limits = c(<span>0</span>, <span>40</span>),<br>                     expand = c(<span>0</span>, <span>0</span>))+<br>  labs(x=<span>NULL</span>,y=<span>"CAR T cells x (10&lt;sup&gt;3&lt;/sup&gt;/g)"</span>)+<br>  theme_prism()+<br>  theme(strip.background = element_blank(),<br>        legend.background = element_rect(color=<span>NA</span>),<br>        legend.key = element_blank(),<br>        legend.spacing.x = unit(-<span>0.09</span>,<span>"in"</span>),<br>        legend.spacing.y = unit(-<span>0.09</span>,<span>"in"</span>),<br>        legend.text = element_text(color=<span>"black"</span>,size=<span>6</span>,face=<span>"bold"</span>),<br>        legend.position = <span>"top"</span>,<br>        axis.text.x=element_blank(),<br>        axis.text.y=element_text(color=<span>"black"</span>,size=<span>8</span>),<br>        axis.title.y = element_markdown(color=<span>"black"</span>,face=<span>"bold"</span>,size=<span>10</span>),<br>        axis.ticks.x = element_blank())+<br>  guides(shape = guide_legend(override.aes = list(size=<span>3</span>),<br>                              direction = <span>"horizontal"</span>,<br>                              nrow=<span>3</span>, byrow=<span>TRUE</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.1576923076923078" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyho48Nk574AMd7CEG3b6LZe6hoE79hL5AlXfWsIS1o9ibkhxWlExyRUw/640?wx_fmt=png" data-type="png" data-w="520" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyho48Nk574AMd7CEG3b6LZe6hoE79hL5AlXfWsIS1o9ibkhxWlExyRUw/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节内容介绍到此结束，过程仅供参考；有需要学习个性化数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>购买<strong>「2023年度会员文档」</strong>同步更新中<strong>「售价149元」</strong>，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；按照往年数据小编年产出约在150+以上</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可下单购买，需要了解更多信息的朋友欢迎交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝扫一扫</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="1.6141479099678457" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyGROyTicMK73TdMiaPSNNzE142KAEwibtt4x3wibOth4nrLBXCArI7hKeKg/640?wx_fmt=png" data-type="png" data-w="622" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyGROyTicMK73TdMiaPSNNzE142KAEwibtt4x3wibOth4nrLBXCArI7hKeKg/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023会员群案例展示</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParygsqSrHFcM8WjJfSnyvVq0icq2RBZ9ZAlJ3JhDNiaTBYueRicMakiaYHq0A/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParygsqSrHFcM8WjJfSnyvVq0icq2RBZ9ZAlJ3JhDNiaTBYueRicMakiaYHq0A/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyJSibo4ys1MiapoZg83cYiaOALJc55QUbpZfcm3hfOaWTpib745jIlE5hLQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyJSibo4ys1MiapoZg83cYiaOALJc55QUbpZfcm3hfOaWTpib745jIlE5hLQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyNSEGUFtfoOFMiaZ2sOo3h33wflgiazswgLr7desSCk4nOSm0r7d9oFVw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyNSEGUFtfoOFMiaZ2sOo3h33wflgiazswgLr7desSCk4nOSm0r7d9oFVw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyLkkUbTIT2jicibLm4T6S6Jic0JPSVm89A1OVxt7GmibGArJDDpcPlTMUWA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyLkkUbTIT2jicibLm4T6S6Jic0JPSVm89A1OVxt7GmibGArJDDpcPlTMUWA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyowHa4QPIFjIoXeMQRv0xEaou52VGEP7u43yyut8iaXjV6D6mQmz3KXw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyowHa4QPIFjIoXeMQRv0xEaou52VGEP7u43yyut8iaXjV6D6mQmz3KXw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParygnhsBAvcKian4dbJSftQ1VSxWojJCHiafoV7HG7MKRyXibnTMTdAuUuhg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParygnhsBAvcKian4dbJSftQ1VSxWojJCHiafoV7HG7MKRyXibnTMTdAuUuhg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyKibnDqichgDPI9UJYiabgASicK9icDAGsuK5Rib3sgdU7DX6hWQInFO13Urg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nParyKibnDqichgDPI9UJYiabgASicK9icDAGsuK5Rib3sgdU7DX6hWQInFO13Urg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nPary6sCvTVRoFUJdcUTHx3MxsY0LiaA5eL8XiaPOteZkicoYX6wN8FDQrn2Kw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nPary6sCvTVRoFUJdcUTHx3MxsY0LiaA5eL8XiaPOteZkicoYX6wN8FDQrn2Kw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nPary1O9ZUjHSHbefIoGpZAA5Y9dG42ic2NT78hq8YmG08ZTVHOLowkyujibg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1XoaDkB7Ed987Im2nPary1O9ZUjHSHbefIoGpZAA5Y9dG42ic2NT78hq8YmG08ZTVHOLowkyujibg/640?wx_fmt=png"></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/k2yZklttjje_1OM9MzxVlQ",target="_blank" rel="noopener noreferrer">原文链接</a>
