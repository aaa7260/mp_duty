---
title: "[R包分享]aPEAR优雅绘制富集分析网络图"
date: 2023-11-21T23:57:26Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
[R包分享]aPEAR优雅绘制富集分析网络图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来介绍一款新R包<strong>「aPEAR」</strong>其主要用来可视化富集分析的结果，非常的好用并且兼容ggplot2,更多详细内容请参考作者官方文档。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>官方文档</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>https://academic.oup.com/bioinformatics/article/39/11/btad672/7342237?login=falsehttps://gitlab.com/vugene/aPEAR/-/blob/main/vignettes/aPEAR-vignette.Rmd?ref_type=heads</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>install.packages(<span>"aPEAR"</span>) <br><span>library</span>(data.table)<br><span>library</span>(tidyverse) <br><span>library</span>(clusterProfiler) <br><span>library</span>(DOSE) <br><span>library</span>(org.Hs.eg.db)<br><span>library</span>(aPEAR)<br>data(geneList)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100024606" data-ratio="0.3888888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAahefUohV9waKKPFTDhlSibBTwA7Kib3tTNUcQYE1unhB0DF2dduzdL3lPfJSFgicXtoYf57vibnf6WjA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAahefUohV9waKKPFTDhlSibBTwA7Kib3tTNUcQYE1unhB0DF2dduzdL3lPfJSFgicXtoYf57vibnf6WjA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>富集分析</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 设置随机数种子，确保结果的可重复性</span><br>set.seed(<span>42</span>)<br><span># 使用gseGO函数进行基因本体论（GO）的富集分析</span><br><span># geneList是待分析的基因列表，OrgDb指定了基因的注释数据库，ont指定了本体论类型（这里是'CC'，即细胞组分）</span><br>enrich &lt;- gseGO(geneList, OrgDb = org.Hs.eg.db, ont = <span>'CC'</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>富集分析网络图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 设置另一个随机数种子，用于后续的可视化过程</span><br>set.seed(<span>654824</span>)<br><span># 创建富集分析的网络图，这里使用enrich@result作为输入数据</span><br>enrichmentNetwork(enrich@result)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100024604" data-ratio="0.7981481481481482" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAahefUohV9waKKPFTDhlSibB9nhYvUN2zBseJHLnRy3OJhpZTCeEaibavAQgibFfKYLQa0x7cdTkajZw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAahefUohV9waKKPFTDhlSibB9nhYvUN2zBseJHLnRy3OJhpZTCeEaibavAQgibFfKYLQa0x7cdTkajZw/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>提取富集分析结果</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 提取富集分析的结果，并进行数据处理</span><br><span># 这里首先将结果转换为data.table格式，然后选取前5行，提取特定的列，并对core_enrichment列的内容进行截断处理</span><br>enrichmentData &lt;- enrich@result %&gt;%<br>  as.data.table() %&gt;%<br>  .[ <span>1</span>:<span>5</span> ] %&gt;%<br>  .[ , list(Description, pathwayGenes = core_enrichment, NES, Size = setSize) ] %&gt;%<br>  .[ , pathwayGenes := str_trunc(pathwayGenes, <span>20</span>) ]<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code><span># 提取富集分析的完整结果，不进行截断处理</span><br>enrichmentData &lt;- enrich@result %&gt;%<br>  as.data.table() %&gt;%<br>  .[ , list(Description, pathwayGenes = core_enrichment, NES, Size = setSize) ]<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>NES富集网络图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 创建基于NES（归一化富集得分）和Size（路径大小）的富集网络图</span><br><span># colorBy参数指定了节点颜色的依据，nodeSize指定了节点大小的依据，verbose = TRUE表示打印详细信息</span><br>p &lt;- enrichmentNetwork(enrichmentData, colorBy = <span>'NES'</span>, nodeSize = <span>'Size'</span>, verbose = <span>TRUE</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100024608" data-ratio="0.7981481481481482" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAahefUohV9waKKPFTDhlSibBezwicUQ7Ol4YhdhlJHWUfGG1pEHqe9ISGhIz3ysINyKcAFxiaDFgVL8g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAahefUohV9waKKPFTDhlSibBezwicUQ7Ol4YhdhlJHWUfGG1pEHqe9ISGhIz3ysINyKcAFxiaDFgVL8g/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>基于p值的富集网络图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 设置随机数种子，用于可视化的稳定性</span><br>set.seed(<span>348934</span>)<br><span># 创建基于p值的富集网络图，这里指定了颜色类型为p值，pCutoff为p值的截断阈值</span><br>enrichmentNetwork(enrich@result, colorBy = <span>'pvalue'</span>, colorType = <span>'pval'</span>, pCutoff = -<span>5</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100024607" data-ratio="0.7981481481481482" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAahefUohV9waKKPFTDhlSibBzhUV1qrZj0hVafib4q26XrqBPgy1hfOENWgrLlNcIruqZABBdmj3nWQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAahefUohV9waKKPFTDhlSibBzhUV1qrZj0hVafib4q26XrqBPgy1hfOENWgrLlNcIruqZABBdmj3nWQ/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>聚类网络图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 找出富集分析结果中的路径聚类</span><br><span># cluster参数指定了聚类方法，这里使用层次聚类，minClusterSize指定了最小聚类大小</span><br>clusters &lt;- findPathClusters(enrich@result, cluster = <span>'hier'</span>, minClusterSize = <span>6</span>)<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code><span># 显示前5个聚类的信息</span><br>clusters$clusters[ <span>1</span>:<span>5</span> ]<br><br><span># 提取并显示特定聚类的路径</span><br><span># 这里首先提取前5个聚类的路径，然后计算这些路径之间的相似度</span><br>pathways &lt;- clusters$clusters[ <span>1</span>:<span>5</span>, Pathway ]<br>clusters$similarity[ pathways, pathways ]<br><br><span># 设置随机数种子，用于图形的稳定性</span><br>set.seed(<span>238923</span>)<br><span># 绘制路径聚类的图形</span><br><span># 这里指定了富集结果、相似度矩阵、聚类信息以及其他绘图参数</span><br>plotPathClusters(<br>  enrichment = enrich@result,<br>  sim = clusters$similarity,<br>  clusters = clusters$clusters,<br>  fontSize = <span>4</span>,<br>  outerCutoff = <span>0.01</span>, <br>  drawEllipses = <span>TRUE</span><br>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100024605" data-ratio="0.7981481481481482" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAahefUohV9waKKPFTDhlSibBiaEiaibv9k4y8pQVdMqAF6pqSTdapEWs00ICHkoI3wHMjtxIYZPJmtfCw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAahefUohV9waKKPFTDhlSibBiaEiaibv9k4y8pQVdMqAF6pqSTdapEWs00ICHkoI3wHMjtxIYZPJmtfCw/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关于永久群内容的说明</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>给予长期支持我们的忠实读者们一个特别待遇：凡是购买过小编2022年或2023年VIP会员文档的朋友们，<strong>「将自动获得2024年及以后的绘图资料和代码更新，无需额外付费。」</strong>目前这两年的会员文档已累记卖出1500+，质量方面各位无需担忧。简要概括就是只要购买任意1年的会员内容，2024及后期公众号所更新的绘图文档均会在已经加入的会员群内分享。</p><span>❞</span></blockquote><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节介绍到此结束，有需要学习数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>下单购买，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，无论购买那一年的会员文档都将获取<strong>「2024年及以后更新的绘图文档」</strong>，早买早享受，需要了解更多信息的朋友欢迎淘宝店铺交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝扫一扫</span><span></span></h3><p><img data-croporisrc="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJLkh8ib9mUkNvxOiaxmz74xZd3kcSPXu7OvzZ4KJgLyMxiaS53SV4k3DuA/0?wx_fmt=jpeg" data-cropx1="107.75806451612902" data-cropx2="1067.016129032258" data-cropy1="397.22580645161287" data-cropy2="1872.032258064516" data-galleryid="" data-ratio="1.5354166666666667" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAahefUohV9waKKPFTDhlSibBzhRsaCLeu2AG5VsAxuG8ymlCr2ROY09I4dzOxTt8icibGGrhHvX0JUXA/640?wx_fmt=jpeg" data-type="jpeg" data-w="960" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAahefUohV9waKKPFTDhlSibBzhRsaCLeu2AG5VsAxuG8ymlCr2ROY09I4dzOxTt8icibGGrhHvX0JUXA/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺(有需要欢迎关注)</span><span></span></h3><p><img data-galleryid="" data-ratio="1.0210420841683367" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg" data-type="jpeg" data-w="998" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"><br></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/upJj5SPLaZHrtvl1qOSjTg",target="_blank" rel="noopener noreferrer">原文链接</a>
