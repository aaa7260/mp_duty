---
title: "R中循环处理多组间相关性分析"
date: 2023-11-30T00:25:41Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
R中循环处理多组间相关性分析 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来回答VIP会员群一个朋友的问题，内容主要围绕按分组拆分数据两两之间进行相关性分析后绘图，其难点主要在于数据清洗，小编使用tidyverse及循环来整理函数，整个过程仅参考。希望对各位观众老爷能有所帮助。<strong>「数据代码已经整合上传到2023VIP交流群」</strong>，加群的观众老爷可自行下载，有需要的朋友可关注文末介绍加入VIP交流群。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关于永久群内容的说明</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>给予长期支持我们的忠实读者们一个特别待遇：凡是购买过小编2022年或2023年VIP会员文档的朋友们，<strong>「将自动获得2024年及以后更新的绘图文档代码，无需额外付费。」</strong>目前这两年的会员文档已累记卖出1500+，质量方面各位无需担忧。简要概括就是只要购买任意1年的会员内容，2024及后期公众号所更新的绘图文档均会在已经加入的会员群内分享。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(readxl)<br><span>library</span>(psych)<br><span>library</span>(reshape2)<br><span>library</span>(magrittr)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df1 &lt;- read_excel(<span>"env.xlsx"</span>) %&gt;% <br>  mutate(group=ID) %&gt;% <br>  mutate(group = str_replace_all(group, <span>"[0-9]"</span>, <span>""</span>)) %&gt;% <br>  select(-ID) %&gt;% <br>  group_by(group) %&gt;% <br>  nest()<br><br>df2 &lt;- read_excel(<span>"SOC.xlsx"</span>) %&gt;% <br>  mutate(group=ID) %&gt;% <br>  mutate(group = str_replace_all(group, <span>"[0-9]"</span>, <span>""</span>)) %&gt;%<br>  select(-ID) %&gt;% <br>  group_by(group) %&gt;% <br>  nest()<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>循环整合数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 初始化一个空的数据框来存储结果</span><br>results_df &lt;- data.frame(group = character(),<br>                         cor = numeric(),<br>                         pvalue = numeric(),<br>                         stringsAsFactors = FALSE)<br><br><span># 循环处理每一对数据集</span><br><span>for</span> (i <span>in</span> 1:5) {<br>  pp &lt;- corr.test(df1<span>$data</span>[[i]], df2<span>$data</span>[[i]], method = <span>"pearson"</span>, adjust = <span>"fdr"</span>)<br>  results_df &lt;- rbind(results_df, data.frame(<br>    group = paste0(<span>"cor"</span>, i),<br>    cor = pp<span>$r</span>,<br>    pvalue = pp<span>$p</span>,<br>    stringsAsFactors = FALSE<br>  ))<br>}<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>results_df %&gt;% set_colnames(c(<span>"group"</span>,<span>"rvalue"</span>,<span>"pvalue"</span>)) %&gt;% <br>  rownames_to_column(var=<span>"env"</span>) %&gt;% <br>  mutate(env = str_replace_all(env, <span>"[0-9]"</span>, <span>""</span>)) %&gt;%<br>  mutate(p_signif=symnum(pvalue, corr = FALSE, na = FALSE,  <br>                         cutpoints = c(0, 0.001, 0.01, 0.05, 0.1, 1), <br>                         symbols = c(<span>"***"</span>, <span>"**"</span>, <span>"*"</span>, <span>""</span>, <span>" "</span>))) %&gt;% <br>  <br>  ggplot(aes(group,env,fill=rvalue))+<br>  geom_tile()+<br>  geom_text(aes(label=p_signif),<br>            size=6,color=<span>"white"</span>,hjust=0.5,vjust=0.5)+<br>  labs(x=NULL,y=NULL)+<br>  scale_color_gradientn(colours = rev(RColorBrewer::brewer.pal(3,<span>"RdBu"</span>)))+<br>  scale_fill_gradientn(colours = rev(RColorBrewer::brewer.pal(3,<span>"RdBu"</span>)))+<br>  scale_y_discrete(expand=c(0,0))+<br>  scale_x_discrete(expand=c(0,0)) +<br>  theme(axis.text.x=element_text(angle =0,hjust =1,vjust =0.5,<br>                                 color=<span>"black"</span>,size = 8),<br>        axis.text.y=element_text(color=<span>"black"</span>,size =8),<br>        axis.ticks= element_blank(),<br>        panel.spacing.y = unit(0,<span>"cm"</span>),<br>        plot.background = element_blank(),<br>        panel.background = element_blank(),<br>        legend.title = element_blank())+<br>  scale_size(range=c(1,10),guide=NULL)+<br>  guides(fill=guide_colorbar(direction=<span>"vertical"</span>,reverse=F,barwidth=unit(.5,<span>"cm"</span>),<br>                             barheight=unit(8,<span>"cm"</span>)))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100024743" data-ratio="1.2444444444444445" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYLFqrROoUYaOwnuKJF1fZlYIcQ69ttAOYpSxzRdrjfEvUs4qYJuibFS8CqeLGWiadaYDVkSV95jibAQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="450" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYLFqrROoUYaOwnuKJF1fZlYIcQ69ttAOYpSxzRdrjfEvUs4qYJuibFS8CqeLGWiadaYDVkSV95jibAQ/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节介绍到此结束，有需要学习数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>下单购买，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，无论购买那一年的会员文档都将获取<strong>「2024年及以后更新的绘图文档」</strong>，早买早享受，需要了解更多信息的朋友欢迎淘宝店铺交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺(有需要欢迎关注)</span><span></span></h3><p><img data-galleryid="" data-ratio="1.0210420841683367" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg" data-type="jpeg" data-w="998" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"><br></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/kvjTt0D08KZ49WwE5hcgPw",target="_blank" rel="noopener noreferrer">原文链接</a>
