---
title: "[Microbiome图表复现] 常规热图添加一些新元素"
date: 2023-11-27T14:55:09Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
[Microbiome图表复现] 常规热图添加一些新元素 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来复现绘制<strong>「Microbiome」</strong>上的一张图，还是常见的相关性热图主要通过一些细节的修改来添加一些新的元素，整个过程仅参考。希望对各位观众老爷能有所帮助。<strong>「数据代码已经整合上传到2023VIP交流群」</strong>，加群的观众老爷可自行下载，有需要的朋友可关注文末介绍加入VIP交流群。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关于永久群内容的说明</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>给予长期支持我们的忠实读者们一个特别待遇：凡是购买过小编2022年或2023年VIP会员文档的朋友们，<strong>「将自动获得2024年及以后更新的绘图文档代码，无需额外付费。」</strong>目前这两年的会员文档已累记卖出1500+，质量方面各位无需担忧。简要概括就是只要购买任意1年的会员内容，2024及后期公众号所更新的绘图文档均会在已经加入的会员群内分享。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>论文原文</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-imgfileid="100024715" data-ratio="0.3388888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZIzh97EaItW1Gwibgvibby7hhmluyL812MgyhfcvVUQ4MqjdxG1GjvwGWDGyofu7icHDeqsMQujPB7w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZIzh97EaItW1Gwibgvibby7hhmluyL812MgyhfcvVUQ4MqjdxG1GjvwGWDGyofu7icHDeqsMQujPB7w/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>图形解读</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-imgfileid="100024714" data-ratio="0.8408759124087591" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZIzh97EaItW1Gwibgvibby7hvuJQSUXTvB5rZZ9SP6yGwg2UBlb5XFzoLKhleBoCyVyopPtMxqfHnw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="685" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZIzh97EaItW1Gwibgvibby7hvuJQSUXTvB5rZZ9SP6yGwg2UBlb5XFzoLKhleBoCyVyopPtMxqfHnw/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>作为常见的相关性热图，此图在细节方面做了调整，用星代替以往的点来表示R值，同时通过透明度来调节梯度，线条也根据P值大小做了调节。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(linkET)<br><span>library</span>(psych)<br><span>library</span>(reshape2)<br><span>library</span>(magrittr)<br><span>library</span>(ggtext)<br><span>library</span>(ggstar)<br><span>library</span>(ggnewscale)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100024712" data-ratio="0.31851851851851853" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZIzh97EaItW1Gwibgvibby7hPl07655ZaSomZUP6ib1lqIqnEcpkXlls2tX8AnngQmgtey6vIcms0TA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZIzh97EaItW1Gwibgvibby7hPl07655ZaSomZUP6ib1lqIqnEcpkXlls2tX8AnngQmgtey6vIcms0TA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>导入数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>env &lt;- read_tsv(<span>"env.tsv"</span>)<br>spe &lt;- read_tsv(<span>"spe.tsv"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>pp &lt;- corr.test(spe,env,method=<span>"pearson"</span>,adjust = <span>"fdr"</span>)<br>cor &lt;- pp$r<br>pvalue &lt;- pp$p<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>df &lt;- melt(cor) %&gt;% mutate(pvalue=melt(pvalue)[,<span>3</span>],<br>                           p_signif=symnum(pvalue, corr = <span>FALSE</span>, na = <span>FALSE</span>,  <br>                                           cutpoints = c(<span>0</span>, <span>0.001</span>, <span>0.01</span>, <span>0.05</span>, <span>0.1</span>, <span>1</span>), <br>                                           symbols = c(<span>"***"</span>, <span>"**"</span>, <span>"*"</span>, <span>""</span>, <span>" "</span>))) %&gt;% <br>  set_colnames(c(<span>"env"</span>,<span>"genus"</span>,<span>"r"</span>,<span>"p"</span>,<span>"p_signif"</span>))<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>cordata &lt;- df %&gt;% <br>  filter(genus %<span>in</span>% c(<span>"N"</span>,<span>"K"</span>,<span>"Ca"</span>)) %&gt;% <br>  select(<span>2</span>,<span>1</span>,<span>3</span>,<span>4</span>,<span>5</span>) %&gt;% <br>  mutate(rd = cut(r, breaks = c(-<span>Inf</span>, <span>0</span>, <span>0.4</span>, <span>Inf</span>),<br>                  labels = c(<span>"&lt; 0"</span>, <span>"0 - 0.4"</span>, <span>"&gt;= 0.4"</span>)),<br>         pd = cut(p, breaks = c(-<span>Inf</span>, <span>0.05</span>, <span>Inf</span>),<br>                  labels = c(<span>"&lt; 0.05"</span>,<span>"&gt;= 0.05"</span>)))<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>qcorrplot(correlate(spe,method = <span>"pearson"</span>),diag=F,<span>type</span>=<span>"lower"</span>)+<br>  geom_star(aes(size=r,fill=r,alpha=r),color=NA)+<br>  scale_fill_gradientn(colours = rev(RColorBrewer::brewer.pal(11,<span>"RdBu"</span>)))+<br>  new_scale_fill()+<br>  geom_couple(aes(colour=pd,linetype=pd),data=cordata,label.colour = <span>"black"</span>,<br>              curvature=nice_curvature(0.1),nudge_x=0.3,<br>              label.fontface=2,<br>              label.size =3,drop =T)+<br>  scale_colour_manual(values =c(<span>"red"</span>,<span>"#1B9E77"</span>)) +<br>  scale_linetype_manual(values = c(<span>"solid"</span>,<span>"dashed"</span>))+<br>  guides(size = guide_legend(title = <span>" "</span>,override.aes = list(colour = <span>"grey35"</span>), order = 2),<br>         colour = guide_legend(title = <span>"Mantel's p"</span>,override.aes = list(size = 3), order = 1),<br>         linetype=guide_legend(title = <span>"Mantel's p"</span>,override.aes = list(size = 3), order = 1),<br>         alpha = <span>"none"</span>)+<br>  theme(plot.margin = unit(c(0,-3,0,-2),units=<span>"cm"</span>),<br>        panel.background = element_blank(),<br>        plot.background = element_blank(),<br>        axis.text=element_markdown(color=<span>"black"</span>,size=8,face=<span>"bold"</span>),<br>        legend.background = element_blank(),<br>        legend.key = element_blank(),<br>        legend.title = element_text(margin = margin(b= 5)),<br>        legend.spacing.y = unit(0,<span>"cm"</span>),<br>        legend.key.height = unit(0.5,<span>"cm"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100024713" data-ratio="0.65" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZIzh97EaItW1Gwibgvibby7hB14zIVX0fPlkhy5hicmUFCoSVRhYkFiaicny4x9BLJtYo4Ug2p8OyichQQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZIzh97EaItW1Gwibgvibby7hB14zIVX0fPlkhy5hicmUFCoSVRhYkFiaicny4x9BLJtYo4Ug2p8OyichQQ/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节介绍到此结束，有需要学习数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>下单购买，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，无论购买那一年的会员文档都将获取<strong>「2024年及以后更新的绘图文档」</strong>，早买早享受，需要了解更多信息的朋友欢迎淘宝店铺交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝扫一扫</span><span></span></h3><p><img data-croporisrc="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZIzh97EaItW1Gwibgvibby7hCXTY1kgG8kDozTCVy4W1ca7NcNSu4XuTPiankPgAtqrK9FxeUkXBmiag/0?wx_fmt=jpeg&amp;from=appmsg" data-cropx1="122.54838709677419" data-cropx2="1062.7903225806451" data-cropy1="395.1129032258064" data-cropy2="1884.7096774193546" data-galleryid="" data-imgfileid="100024736" data-ratio="1.5840425531914895" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZIzh97EaItW1Gwibgvibby7hFqMrr59R9mBkgKcMOPiasicX9Id8hgngg0K4X15ibnG6WsxlEiaQicxenTA/640?wx_fmt=jpeg" data-type="jpeg" data-w="940" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAZIzh97EaItW1Gwibgvibby7hFqMrr59R9mBkgKcMOPiasicX9Id8hgngg0K4X15ibnG6WsxlEiaQicxenTA/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺(有需要欢迎关注)</span><span></span></h3><p><img data-galleryid="" data-ratio="1.0210420841683367" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg" data-type="jpeg" data-w="998" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/3Lehv0VLo-RRlXRuFitxlQ",target="_blank" rel="noopener noreferrer">原文链接</a>
