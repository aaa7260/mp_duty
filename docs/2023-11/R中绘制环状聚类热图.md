---
title: "R中绘制环状聚类热图"
date: 2023-11-15T15:16:50Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
R中绘制环状聚类热图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>最近有朋友需要绘制环状热图叠加多层注释，本节来通过一个例子来简单介绍一下如何实现，主要通过<strong>「ggtreeExtra」</strong>来实现，聚类分析使用<strong>「ape」</strong>包来进行更加适用于生物信息相关的数据。后续还可根据需要在此图上叠加更多的数据，整个过程仅参考。希望对各位观众老爷能有所帮助。<strong>「数据代码已经整合上传到2023VIP交流群」</strong>，加群的观众老爷可自行下载，有需要的朋友可关注文末介绍加入VIP交流群。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关于永久群内容的说明</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>给予长期支持我们的忠实读者们一个特别待遇：凡是购买过小编2022年或2023年VIP会员文档的朋友们，<strong>「将自动获得2024年及以后的绘图资料和代码更新，无需额外付费。」</strong>目前这两年的会员文档已累记卖出1500+，质量方面各位无需担忧**。简要概括就是只要购买任意1年的会员内容，2024及后期公众号所更新的绘图文档均会在已经加入的会员群内分享。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(ggtree)<br><span>library</span>(treeio)<br><span>library</span>(ape)<br><span>library</span>(magrittr)<br><span>library</span>(ggnewscale)<br><span>library</span>(ggtreeExtra)<br><span>library</span>(RColorBrewer)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据清洗</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>data &lt;- read_tsv(<span>"data.xls"</span>) %&gt;% select(-Group) %&gt;% <br>  group_by(id,Phylum) %&gt;% <br>  summarise(across(where(is.numeric), ~ sum(.x, na.rm=<span>TRUE</span>))) %&gt;% <br>  pivot_wider(names_from = <span>"Phylum"</span>,values_from = <span>"Abundance"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建表达信息</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>exp &lt;- data %&gt;% pivot_longer(-id)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建树文件</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>tree &lt;- data %&gt;% column_to_rownames(var=<span>"id"</span>) %&gt;% <br>  dist() %&gt;% ape::bionj()<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>构建分组文件</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>group &lt;- read_tsv(<span>"data.xls"</span>) %&gt;% select(id,Group) %&gt;% <br>  mutate(group=<span>"group"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>ggtree(tree,branch.length = <span>"none"</span>, layout = <span>"circular"</span>,<br>       linetype = <span>1</span>,size = <span>0.5</span>, ladderize = <span>T</span>)+<br>  layout_fan(angle =<span>180</span>)+ <span># 调整开口</span><br>  theme(plot.margin=margin(<span>0</span>,<span>1</span>,-<span>7</span>,<span>0</span>,<span>"cm"</span>))+<br>  geom_tiplab(offset=<span>10.5</span>,show.legend=<span>FALSE</span>,size=<span>2.8</span>,<br>              color = <span>"black"</span>,starstroke = <span>0</span>)+<br>  geom_fruit(data=exp,geom=geom_tile,<br>             mapping=aes(y=id,x=name,fill=value),<br>             pwidth=<span>0.6</span>,offset=<span>0.02</span>,<br>             axis.params=list(axis=<span>"x"</span>,text.angle=-<span>90</span>,text.size=<span>2</span>,hjust=<span>0</span>))+<br>  scale_fill_gradientn(colours = rev(RColorBrewer::brewer.pal(<span>11</span>,<span>"RdBu"</span>)))+<br>  new_scale_fill()+<br>  geom_fruit(data=group,geom=geom_tile,<br>             mapping=aes(y=id,x=group,fill=Group),color=<span>"white"</span>,<br>             pwidth=<span>1</span>,offset=<span>0.4</span>)+<br>  scale_fill_manual(values = c(<span>"#EDB749"</span>,<span>"#3CB2EC"</span>,<span>"#9C8D58"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6342592592592593" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYD9FKYKkZibEbePeFrfTExGicTIrO6kQTJiaOibpK5hnxK4ibp4aWWeKs3ZbkaarOWtZMDBXtMhNNVtUw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAYD9FKYKkZibEbePeFrfTExGicTIrO6kQTJiaOibpK5hnxK4ibp4aWWeKs3ZbkaarOWtZMDBXtMhNNVtUw/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>此图只是叠加了两层注释信息，实际分析中有更多信息的还可以继续叠加；有需要学习数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>下单购买，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，无论购买那一年的会员文档都将获取<strong>「2024年及以后更新的绘图文档」</strong>，早买早享受，需要了解更多信息的朋友欢迎淘宝店铺交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝扫一扫</span><span></span></h3><p><img data-croporisrc="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbHbWpAoGOP2icXGDsjm40BJLkh8ib9mUkNvxOiaxmz74xZd3kcSPXu7OvzZ4KJgLyMxiaS53SV4k3DuA/0?wx_fmt=jpeg" data-cropx1="105.64516129032258" data-cropx2="1073.3548387096773" data-cropy1="382.43548387096774" data-cropy2="1886.8225806451612" data-galleryid="" data-ratio="1.5537190082644627" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAYD9FKYKkZibEbePeFrfTExGK2icu5eOiatqxSQ4RO4OaftkZonqBJVmV7LITxIZkWX6DV4PWAlP2aCw/640?wx_fmt=jpeg" data-type="jpeg" data-w="968" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAYD9FKYKkZibEbePeFrfTExGK2icu5eOiatqxSQ4RO4OaftkZonqBJVmV7LITxIZkWX6DV4PWAlP2aCw/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝店铺(有需要欢迎关注)</span><span></span></h3><p><img data-galleryid="" data-ratio="1.0210420841683367" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg" data-type="jpeg" data-w="998" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbvhPDLGT8NaialEsht92PTYNJWpmVLfoYGic1uha5FyBrDCibibZCLjiazgvpT1XcdwibfVywD2el0VAgg/640?wx_fmt=jpeg"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/p26BqddVYBwJSvf55P_QGg",target="_blank" rel="noopener noreferrer">原文链接</a>
