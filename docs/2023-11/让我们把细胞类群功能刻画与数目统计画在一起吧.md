---
title: "让我们把细胞类群功能刻画与数目统计画在一起吧"
date: 2023-11-30T00:19:01Z
draft: ["false"]
tags: [
  "fetched",
  "YuLabSMU"
]
categories: ["Acdemic"]
---
让我们把细胞类群功能刻画与数目统计画在一起吧 by YuLabSMU
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><p data-tool="mdnice编辑器">一如即往，来一段无脑的Seurat操作：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(Seurat)<br>pbmc_counts &lt;- Read10X(<br>  data.dir = file.path(input_dir, <span>"filtered_gene_bc_matrices/hg19/"</span>)<br>)<br>pbmc &lt;- CreateSeuratObject(counts = pbmc_counts, project = <span>"pbmc3k"</span>,<br>                           min.cells = <span>3</span>)<br><br>pbmc[[<span>"percent.mt"</span>]] &lt;- PercentageFeatureSet(pbmc, pattern = <span>"^MT-"</span>)<br>pbmc &lt;- subset(pbmc,<br>  subset = nFeature_RNA &gt; <span>200</span> &amp; nFeature_RNA &lt; <span>2500</span> &amp; percent.mt &lt; <span>5</span><br>)<br>pbmc &lt;- NormalizeData(pbmc, normalization.method = <span>"LogNormalize"</span>,<br>                      scale.factor = <span>10000</span>)<br>pbmc &lt;- ScaleData(pbmc)<br><br>pbmc &lt;- FindVariableFeatures(pbmc, selection.method = <span>"vst"</span>,<br>                             nfeatures = <span>2000</span>)<br>pbmc &lt;- RunPCA(pbmc, features = VariableFeatures(object = pbmc))<br>pbmc &lt;- RunUMAP(pbmc, dims = <span>1</span>:<span>10</span>)<br><br>pbmc &lt;- FindNeighbors(pbmc, dims = <span>1</span>:<span>10</span>)<br>pbmc &lt;- FindClusters(pbmc, resolution = <span>0.5</span>)<br><br><br>seurat_cluster_id &lt;- c(<span>"Naive CD4 T"</span>, <span>"CD14+ Mono"</span>, <span>"Memory CD4 T"</span>, <span>"B"</span>,<br>                       <span>"CD8 T"</span>, <span>"FCGR3A+ Mono"</span>, <span>"NK"</span>, <span>"DC"</span>, <span>"Platelet"</span>)<br>names(seurat_cluster_id) &lt;- levels(pbmc)<br>pbmc &lt;- RenameIdents(pbmc, seurat_cluster_id)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span>找找Markers吧</h2><pre data-tool="mdnice编辑器"><span></span><code>pbmc.markers &lt;- FindAllMarkers(pbmc, only.pos = TRUE)<br><br>pbmc.markers %&gt;%<br>    group_by(cluster) %&gt;%<br>    dplyr::filter(avg_log2FC &gt; 1) %&gt;%<br>    slice_head(n = 20) %&gt;%<br>    ungroup() -&gt; top20<br></code></pre><p data-tool="mdnice编辑器">拿出前20来当Markers。</p><h2 data-tool="mdnice编辑器"><span></span>来个富集分析吧</h2><pre data-tool="mdnice编辑器"><span></span><code><br>library(clusterProfiler)<br>bitr(top20<span>$gene</span>, <span>'SYMBOL'</span>, <span>'ENTREZID'</span>, <span>'org.Hs.eg.db'</span>) -&gt; gg<br><br>top20 &lt;- merge(top20, gg, by.x=<span>'gene'</span>, by.y = <span>'SYMBOL'</span>)<br>head(top20)<br>kk &lt;- compareCluster(ENTREZID~cluster, data = top20, fun=enrichKEGG)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span>可视化来串场吧</h2><p data-tool="mdnice编辑器">先来一段我们富集分析的经典点图：</p><pre data-tool="mdnice编辑器"><span></span><code>library(enrichplot)<br>g &lt;- dotplot(kk) + <br>  aes(x=sub(<span>"\n.*"</span>, <span>""</span>, Cluster)) + <br>  xlab(<span>"Cell Clusters"</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100009925" data-ratio="1.000925925925926" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4k2lR6odxVk6RxCicOCWZhZxx92BBC1ASyRgWh9ibzvTFLu47Mz5ewsWuKoibW9CgE71gEpI2YicsTVNQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4k2lR6odxVk6RxCicOCWZhZxx92BBC1ASyRgWh9ibzvTFLu47Mz5ewsWuKoibW9CgE71gEpI2YicsTVNQ/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzI5NjUyNzkxMg==&amp;mid=2247493445&amp;idx=1&amp;sn=ec732ce54aa57c7f68af0af60e803038&amp;chksm=ec405602db37df14c7be649bb494167316413d768993ee34952667f4091a94940012ade332ff&amp;token=432571648&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">【和降维图保持一致的细胞类群统计图】</a>，再用这篇文章介绍的方法先来画图：</p><pre data-tool="mdnice编辑器"><span></span><code>librrary(ggsc)<br>p = sc_dim(pbmc) + sc_dim_geom_label()<br>p2 = sc_dim_count(p) + <br>  coord_cartesian() + <br>  ggfun::theme_noxaxis() +<br>  xlab(NULL)<br></code></pre><p><img data-galleryid="" data-imgfileid="100009926" data-ratio="0.5010964912280702" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4k2lR6odxVk6RxCicOCWZhZxnuHDicBrX8O47lX9peRULeLeSMOctkP3sSNvxQ4weIIkSzIovUXrWOw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="912" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4k2lR6odxVk6RxCicOCWZhZxnuHDicBrX8O47lX9peRULeLeSMOctkP3sSNvxQ4weIIkSzIovUXrWOw/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">见证奇怪的时刻到了：</p><pre data-tool="mdnice编辑器"><span></span><code>library(aplot)<br>insert_top(g, p2, height=.2)<br></code></pre><p><img data-galleryid="" data-imgfileid="100009924" data-ratio="0.9925925925925926" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4k2lR6odxVk6RxCicOCWZhZxoeZJCibLTNn2fwUjRrwaMIYMH3ialFocJpfqibOMqJuaUdWtyrg36w4ZQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4k2lR6odxVk6RxCicOCWZhZxoeZJCibLTNn2fwUjRrwaMIYMH3ialFocJpfqibOMqJuaUdWtyrg36w4ZQ/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">有了<code>aplot</code>这个神奇的包，本来两个对不齐的图，现在完美地对齐了。于是能够同时展示细胞类型的数目，和刻画通路的富集分析结果。这也对应到了上次说到的KISS原则，简单简洁优雅。</p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/_W1OT8fEcD8k3pLgCB0Oqw",target="_blank" rel="noopener noreferrer">原文链接</a>
