---
title: "R语言ggplot2簇状柱形图和堆积柱形图组合到一起的效果"
date: 2023-11-14T11:59:50Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Acdemic"]
---
R语言ggplot2簇状柱形图和堆积柱形图组合到一起的效果 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><figure data-tool="mdnice编辑器"><img data-ratio="0.44684252597921664" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk7BhC5NGlG1wSicqMfgjp9RcwTX4GAKD0b4ODyx83EccRYkGPeibnlqk49wsGWeYoBXkGFgsNlqphicQ/640?wx_fmt=png" data-type="png" data-w="1251" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk7BhC5NGlG1wSicqMfgjp9RcwTX4GAKD0b4ODyx83EccRYkGPeibnlqk49wsGWeYoBXkGFgsNlqphicQ/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">在一个交流群看到有人问这个图怎么实现，今天的推文我们来介绍一下如何用R预言的ggplot2实现上面这个图。</p><p data-tool="mdnice编辑器">首先是准备作图数据，作图数据整理成如下格式，我这里用excel存储</p><figure data-tool="mdnice编辑器"><img data-ratio="1.649805447470817" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk7BhC5NGlG1wSicqMfgjp9RcHJWSNxbAlMKO1pJPrPQKibMFUH4g1yT8VIBTzZOialkTD6VibTJbx2ialQ/640?wx_fmt=png" data-type="png" data-w="257" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk7BhC5NGlG1wSicqMfgjp9RcHJWSNxbAlMKO1pJPrPQKibMFUH4g1yT8VIBTzZOialkTD6VibTJbx2ialQ/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>读取数据</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>library(readxl)<br>library(ggplot2)<br>library(tidyverse)<br>dat&lt;-read_excel(<span>"data/20231114/data.xlsx"</span>)<br>dat<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>作图代码</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>ggplot()+<br>  geom_segment(data=data.frame(y=seq(0,200,by=20),<br>                               yend=seq(0,200,by=20)),<br>               aes(x=0.5,xend=5.5,y=y,yend=yend),<br>               color=<span>"gray"</span>)+<br>  geom_bar(data=dat,aes(x=x,y=value,fill=<span>"Total value"</span>),<span>stat</span>=<span>"identity"</span>)+<br>  geom_bar(<span>stat</span>=<span>"identity"</span>,position = <span>"dodge"</span>,<br>           data=dat,aes(x=x,y=value,fill=group))+<br>  theme_bw(base_size = 20)+<br>  theme(panel.grid = element_blank(),<br>        legend.position = <span>"top"</span>,<br>        legend.title = element_blank(),<br>        panel.border = element_blank(),<br>        axis.ticks = element_blank(),<br>        axis.line.x = element_line())+<br>  scale_y_continuous(expand = expansion(mult=c(0,0)),<br>                     limits = c(0,200),<br>                     breaks = seq(0,200,by=20))+<br>  scale_x_discrete(labels=c(2000,<span>"01"</span>,<span>"02"</span>,<span>"03"</span>,<span>"04"</span>))+<br>  labs(x=NULL,y=NULL)+<br>  geom_text(data=dat %&gt;% group_by(x) %&gt;% summarise(sum_value=sum(value)),<br>            aes(x=x,y=sum_value,label=sum_value),<br>            vjust=-1,size=5)+<br>  scale_fill_manual(values = c(<span>"#f8766d"</span>,<span>"#a3a500"</span>,<span>"#00bf7d"</span>,<span>"#00b0f6"</span>,<span>"gray"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.8545966228893058" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk7BhC5NGlG1wSicqMfgjp9RcK3eibhVgOhvOT8VnpGHdyJUZOHUThI9es1sR7ia1nmHR21hTmS7S0lJQ/640?wx_fmt=png" data-type="png" data-w="1066" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk7BhC5NGlG1wSicqMfgjp9RcK3eibhVgOhvOT8VnpGHdyJUZOHUThI9es1sR7ia1nmHR21hTmS7S0lJQ/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">背后灰色的柱子是堆积柱形图，只不过没有按照分组添加颜色，统一填充了同样的颜色灰色。前面的柱子是簇状柱形图</p><blockquote data-tool="mdnice编辑器"><p>示例数据和代码可以给推文打赏1元获取</p></blockquote><p data-tool="mdnice编辑器"><strong>欢迎大家关注我的公众号</strong></p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzI3NzQ3MTcxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5t1sOnM0iabvBhnfIj5YpyqrMib0E1MGCd9ibcYxaOPZd0GWhQBDvK2BPEwsicQxd6y5MHLfphnwHnow/0?wx_fmt=png" data-nickname="小明的数据分析笔记本" data-alias="" data-signature="分享R语言和python在生物信息领域做数据分析和数据可视化的简单小例子；偶尔会分享一些组学数据处理相关的内容" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"></p><blockquote data-tool="mdnice编辑器"><p>小明的数据分析笔记本 公众号 主要分享：1、R语言和python做数据分析和数据可视化的简单小例子；2、园艺植物相关转录组学、基因组学、群体遗传学文献阅读笔记；3、生物信息学入门学习资料及自己的学习笔记！</p></blockquote><figure data-tool="mdnice编辑器"><img data-ratio="0.42280022136137246" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk7BhC5NGlG1wSicqMfgjp9Rctp9ZBOZceLliaMUibse7wuwDD3B3oGwsbHYQm1xo0FBwbmTZCXJgqQRQ/640?wx_fmt=png" data-type="png" data-w="1807" src="https://mmbiz.qpic.cn/sz_mmbiz_png/t1wZDoUyFk7BhC5NGlG1wSicqMfgjp9Rctp9ZBOZceLliaMUibse7wuwDD3B3oGwsbHYQm1xo0FBwbmTZCXJgqQRQ/640?wx_fmt=png"><figcaption>image.png</figcaption></figure></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/KEhPeXP_YmToCCsmirGuiw",target="_blank" rel="noopener noreferrer">原文链接</a>
