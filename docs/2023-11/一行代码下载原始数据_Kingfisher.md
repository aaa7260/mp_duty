---
title: "一行代码下载原始数据—Kingfisher"
date: 2023-11-14T14:42:16Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
一行代码下载原始数据—Kingfisher by 生信菜鸟团
------
<div><section><section><section><section data-md5="f3078"><section data-md5="f3078"><section data-md5="f3078"><section data-md5="f3078"><section data-md5="f3078"><section data-md5="f3078"><section data-md5="f3078"><p data-md5="f3078"><span><strong>工欲善其事，必先利其器</strong></span></p></section></section></section></section></section></section></section><section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">kingfisher是由昆士兰科技大学微生物组研究中心的 Ben J. Woodcroft 教授开发的一款专门用于高通量测序数据下载的工具。</p><ul data-tool="mdnice编辑器"><li><section>Github网址：https://github.com/wwood/kingfisher-download</section></li></ul><h2 data-tool="mdnice编辑器"><span><span>1</span></span><span>简要用途：</span></h2><p data-tool="mdnice编辑器">一行代码下载原始数据</p><ul data-tool="mdnice编辑器"><li><section><p>Kingfisher 是一个快速灵活的程序，用于从公共数据库（ENA、NCBI、SRA、Amazon AWS 和 Google Cloud）获取序列文件及其元数据注释。其输入可以是一个或多个“Run" accession（例如DRR001970），或一个 BioProject accessions（例如PRJNA621514或SRP260223）。它有两种主要模式：<code>get</code> 模式用于下载序列数据，<code>annotate</code> 模式用于下载元数据。</p></section></li><li><section><p>在 <code>get</code> 子命令中，Kingfisher 会从一系列冗余源下载数据，直到其中一个有效。然后，下载的数据根据需要转换为SRA/FASTQ/FASTA/GZIP 文件格式。下载和提取阶段通常比使用NCBI的SRA工具包更快。特别是，如果从ENA下载，意味着直接下载的是 FASTQ文件，因此不需要提取步骤。</p></section></li></ul><h2 data-tool="mdnice编辑器"><span><span>2</span></span><span>如何安装</span></h2><p data-tool="mdnice编辑器">一般我们推荐是conda安装</p><pre data-tool="mdnice编辑器"><span></span><code>conda create -n kingfisher python=3.8<br>conda activate kingfisher<br>conda install -c bioconda kingfisher<br></code></pre><h2 data-tool="mdnice编辑器"><span><span>3</span></span><span>最小化使用</span></h2><h3 data-tool="mdnice编辑器"><span></span><span>get 模式 ——下载并选择转换序列数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span><span>#下载整个Bioproject</span></span><br>kingfisher get -p PRJNA486534 -m ena-ascp ena-ftp prefetch aws-http 1&gt;down_prjan486534.log 2&gt;&amp;1<br><span><br>#</span><span><span>#下载单个样本</span></span><br>kingfisher get -r SRR14615558 -m ena-ascp ena-ftp prefetch aws-http --download-threads 10  1&gt;down.log 2&gt;&amp;1<br><span><br>#</span><span><span>#下载多个样本</span></span><br>kingfisher get --run-identifiers-list SRR_list.csv -m ena-ascp ena-ftp prefetch --download-threads 10 --check-md5sums 1&gt;down_srr_list.log 2&gt;&amp;1<br><br>-p ：批量下载BioProject IDs 中的所有数据<br>-m ：指定下载源 ena-ascp、ena-ftp、prefetch、aws-http、aws-cp、gcp-cp 等<br>-r ：下载某个确定的SRA数据 <br>--run-identifiers-list ：SRR样本列表文件，单列SRR号<br>--download-threads -t :  指定线程数<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>extract 模式——转换 .sra文件格式</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span><span>#调用16个线程将 `.sra` 文件转换为 fastq文件</span></span><br>kingfisher extract --sra ERR1739691.sra -t 16 -f fastq.gz<br><br>-t ：线程数 <br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>annotate 模式 —— 获取元数据表</span><span></span></h3><p data-tool="mdnice编辑器">默认是标准输出，当然也可以指定输出到文件</p><pre data-tool="mdnice编辑器"><span></span><code>kingfisher annotate -r SRR11181996<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.13148148148148148" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9Xl9fRIEQiahD2yNvC975hBNv7vOl5vZGibRqhvD3icGkRR9OBSNO5RIoSic5dM7OL0zmZ8bdmw9UiciaQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9Xl9fRIEQiahD2yNvC975hBNv7vOl5vZGibRqhvD3icGkRR9OBSNO5RIoSic5dM7OL0zmZ8bdmw9UiciaQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">可选参数</p><ul data-tool="mdnice编辑器"><li><section><code>--all-column</code> 获得更完整的信息集，</section></li><li><section><code>-f</code>  指定以 CSV、 TSV、 JSON、feather或 parquet 格式输出。</section></li><li><section><code>-o</code>  指定输出文件的写入路径（默认：标准输出stdout）。</section></li></ul><figure data-tool="mdnice编辑器"><img data-ratio="0.1" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9Xl9fRIEQiahD2yNvC975hB4yGELtbibYu1bWLzNZZ8lOAibemABLXYvU4SBV0xzSzickKZb5p8eiaV0g/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9Xl9fRIEQiahD2yNvC975hB4yGELtbibYu1bWLzNZZ8lOAibemABLXYvU4SBV0xzSzickKZb5p8eiaV0g/640?wx_fmt=png"></figure><h2 data-tool="mdnice编辑器"><span><span>4</span></span><span>其他参数</span></h2><h3 data-tool="mdnice编辑器"><span></span><span>get 模式 <code>-m</code></span><span></span></h3><section data-tool="mdnice编辑器"><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>ena-ascp</td><td>通过Aspera从ENA下载.fastq.gz文件，之后可以进一步转换。这是最快的方法，因为不需要使用fasterq-dump。</td></tr><tr><td>ena-ftp</td><td>通过curl从ENA下载.fastq.gz文件，之后可以进一步转换。这是相对较快的方法，因为不需要使用fasterq-dump。</td></tr><tr><td>prefetch</td><td>使用NCBI的prefetch从sra-tools下载.SRA文件，然后用fasterq-dump提取。</td></tr><tr><td>aws-http</td><td>使用aria2c通过多个连接线程从AWS Open Data Program下载.SRA文件，之后用fasterq-dump提取。</td></tr><tr><td>aws-cp</td><td>使用aws s3 cp从AWS下载.SRA文件，然后用fasterq-dump提取。通常不需要支付费用或AWS账户。</td></tr><tr><td>gcp-cp</td><td>使用Google Cloud gsutil1下载.SRA文件，然后用fasterq-dump提取。需要支付费用和Google Cloud账户。</td></tr></tbody></table></section><ul data-tool="mdnice编辑器"><li><section><p><code>--run-identifiers-list</code> ：以换行分隔的运行标识符列表的文本文件，即1列 CSV 文件。</p></section></li><li><section><p><code>-f</code> ：指定转换输出的文件格式，支持 fastq,fastq.gz,fasta,fasta.gz ，默认为fastq</p></section></li><li><section><p><code>--hide-download-progress</code>：在下载过程中不显示进度条（默认显示进度）。</p></section></li><li><section><p><code>--ascp-ssh-key ASCP_SSH_KEY</code>：用于Aspera的openssh密钥路径（默认：使用Kingfisher附带的密钥）。</p></section></li><li><section><p><code>--ascp-args ASCP_ARGS</code>：传递给ascp的额外参数，例如'-k 2'用于通过稀疏文件校验和恢复（默认：'-k 2'）。</p></section></li><li><section><p><code>--prefetch-max-size PREFETCH_MAX_SIZE</code>：使用prefetch下载默认限制为20G文件大小。Kingfisher禁用了这一限制。使用此选项重新设置文件大小限制，例如--prefetch-max-size "1G"表示1 GB限制（默认：不使用）。</p></section></li><li><section><p><code>--check-md5sums</code>：检查下载文件的md5sums。这仅对ena-ftp、ena-ascp和aws-http下载方法实现。prefetch、aws-cp和gcp-cp方法在下载过程中计算校验和（默认：不使用）。</p></section></li><li><section><p><code>-f, --output-format-possibilities {sra,fastq,fastq.gz,fasta,fasta.gz}</code>：允许的输出格式。如果指定了多个，则尽可能少处理下载的数据（默认："fastq fastq.gz"）。</p></section></li><li><section><p><code>--force</code>：即使文件已存在也重新下载/提取（默认：不重新下载/提取）。</p></section></li><li><section><p><code>--unsorted</code>：以任意顺序输出序列，通常是它们在.sra文件中出现的顺序。即使是成对的读取可能也是正常顺序，但可以从名称中识别出哪对是哪对，哪个是正向读取，哪个是反向读取（默认：不这样做）。目前只能从NCBI而不是ENA下载。</p></section></li><li><section><p><code>--stdout</code>：将序列输出到STDOUT。目前需要 <code>--unsorted</code>（默认：不这样做）。</p></section></li><li><section><p><code>-t, --extraction-threads EXTRACTION_THREADS</code>：提取.sra文件时使用的线程数。当指定了<code>--unsorted</code>时会忽略（默认：8线程）。</p></section></li><li><section><p><code>--quiet</code>  ：仅输出报错信息</p></section></li></ul><h2 data-tool="mdnice编辑器"><span><span>5</span></span><span>测试</span></h2><h3 data-tool="mdnice编辑器"><span>是否可以下载单独指定的Fastq文件？</span><span></span></h3><p data-tool="mdnice编辑器">有时候一个数据集下载完成之后，但是发现仅有个别样本，数据完整性校验不通过，这时候就需要单个fastq文件重新下载，那么 Kingfisher 可以实现吗？</p><pre data-tool="mdnice编辑器"><span></span><code>kingfisher get -r SRR14615558_2.fastq.gz -m ena-ascp ena-ftp prefetch aws-http --download-threads 10 <br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.49537037037037035" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9Xl9fRIEQiahD2yNvC975hBiaWsiccNa2N7rMiarVTLm00MncsBSNcyNicVwoTRuLiaFNz9zFhGdawZwHg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9Xl9fRIEQiahD2yNvC975hBiaWsiccNa2N7rMiarVTLm00MncsBSNcyNicVwoTRuLiaFNz9zFhGdawZwHg/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">运行报错，说明可以单独下载指定的SRA文件，但是不能具体指定下载 fastq1 还是fastq2。查看说明文档，也仅有 <code>-r</code> 和 <code>-p</code> 这两个参数，并没有针对 fastq 文件的可选项。</p></section><p><br></p><p><br></p><section><section><section><section act="xmy"><section data-id="123409" data-type="lspecial02,lspecial04" powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><br></section><section powered-by="xmyeditor.com" data-md5="8b46d"><img data-ratio="0.6940298507462687" data-type="gif" data-w="134" data-src="https://mmbiz.qpic.cn/mmbiz_gif/iaRJcrq2LosibrvQnXTV3PMktpwwmDsjia2JG4e3ibpLQ1G6M4nktW4PiaiaKfnpiaRmNbTT6St7QLfzAMAomKgWxQ4kA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" src="https://mmbiz.qpic.cn/mmbiz_gif/iaRJcrq2LosibrvQnXTV3PMktpwwmDsjia2JG4e3ibpLQ1G6M4nktW4PiaiaKfnpiaRmNbTT6St7QLfzAMAomKgWxQ4kA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section><section powered-by="xmyeditor.com" data-md5="8b46d"><br></section></section></section></section></section></section><p><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526014&amp;idx=1&amp;sn=44afb387fc49b89276386e5182db7bc9&amp;chksm=9b4b26c5ac3cafd35616b2fe9df7fea664e59d75e9970feb322a477beb222ac023f7daebb3dc&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授课（买一得‍五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247525661&amp;idx=2&amp;sn=a0662fa3a9ebc7c840d45049eaca2c8c&amp;chksm=9b4b25a6ac3cacb0e9ba90eeb97452a9ee4eaed6bbbab1133f7a4836631047451c0cf295c93b&amp;scene=21#wechat_redirect" textvalue="搭配GPU服务再升级—256线程2Tb内存服务器共享一年仍然是仅需800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">搭配GPU服务再升级—256线程2Tb内存服务器共享一年仍然是仅需800</a><br></section><section><br></section></li></ul></section></section></section></section></section></section></section></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/G-53DHGOxhJaz5u9QEuZjA",target="_blank" rel="noopener noreferrer">原文链接</a>
