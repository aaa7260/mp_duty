---
title: "来源于多个物种的单细胞转录组表达量矩阵如何处理"
date: 2023-11-12T01:42:16Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
来源于多个物种的单细胞转录组表达量矩阵如何处理 by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>PDX模型（Patient-Derived Xenograft Model）对肿瘤研究的小伙伴来说非常熟悉了，这样的癌症研究模型，它涉及将来自患者的癌细胞或组织移植到小鼠等动物宿主体内培养。这种模型的目的是更好地模拟人体内癌症的特性，以进行更真实、更有效的药物测试和研究。</p></blockquote><p data-tool="mdnice编辑器">在建立PDX模型时，通常是将来自患者的肿瘤组织移植到小鼠中，这种肿瘤组织中包含了患者原发癌症的细胞。因此，取样时主要涉及的是人体内的肿瘤组织，但是同时也会有小鼠细胞混合，如果拿去做单细胞转录组建库测序，得到的测序数据里面就会有两个物种。</p><p data-tool="mdnice编辑器"><code>cellranger</code>是一个常用的工具，特别适用于处理10x Genomics平台生成的数据。如果你的样品来源于人和鼠的混合细胞，你需要考虑到物种差异，以便在进行分析时正确识别和区分来源于人和鼠的细胞。首先需要安装了<code>cellranger</code>软件，你可以从10x Genomics官方网站上下载并安装最新版本。同样的，在官方网站可以下载到含人和鼠的混合基因组的参考文件，来自Illumina测序的fastq文件准备好，并确保它们按照<code>cellranger</code>的要求进行命名。接下来就可以<strong>运行<code>cellranger count</code>命令</strong>即可拿到表达量矩阵文件。</p><h3 data-tool="mdnice编辑器"><span></span>解析表达量矩阵文件<span></span></h3><p data-tool="mdnice编辑器">矩阵文件需要按照每个样品独立的文件夹，并且文件夹里面是3个文件，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>tree -h ../inputs/<br>[ 160]  ../inputs/<br>├── [ 160]  s1<br>│   ├── [ 34K]  barcodes.tsv.gz<br>│   ├── [670K]  features.tsv.gz<br>│   └── [ 71M]  matrix.mtx.gz<br>└── [ 160]  s2<br>    ├── [ 66K]  barcodes.tsv.gz<br>    ├── [670K]  features.tsv.gz<br>    └── [124M]  matrix.mtx.gz<br></code></pre><p data-tool="mdnice编辑器">就可以使用下面的默认代码进行读取啦：</p><pre data-tool="mdnice编辑器"><span></span><code> <br>dir=<span>'../inputs/'</span> <br>samples=list.files( dir )<br>samples<br><br><span># samples = head(samples,10) </span><br>sceList = lapply(samples,<span>function</span>(pro){ <br>  <span># pro=samples[1] </span><br>  print(pro)  <br>  sce =CreateSeuratObject(counts =  Read10X(file.path(dir,pro )) ,<br>                          project = gsub(<span>'^GSM[0-9]*_'</span>,<span>''</span>,<br>                                         gsub(<span>'filtered_feature_bc_matrix'</span>,<span>''</span>,pro) )  ,<span># pro, #</span><br>                          min.cells = <span>5</span>,<br>                          min.features = <span>500</span> )<br>  print(dim(sce))<br>  print(sce@assays$RNA@counts[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>])<br>  <span>return</span>(sce)<br>})<br>names(sceList) <br>sceList[[<span>1</span>]]<br>as.data.frame(sceList[[<span>1</span>]]@assays$RNA@counts[<span>1</span>:<span>10</span>, <span>1</span>:<span>2</span>])<br>as.data.frame(tail(sceList[[<span>1</span>]]@assays$RNA@counts[ , <span>1</span>:<span>2</span>]))<br><span># GRCh38-</span><br><span># mm10---</span><br><br></code></pre><p data-tool="mdnice编辑器">可以很清晰的看到其中一个样品如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; sceList[[1]]<br>An object of class Seurat <br>38379 features across 6379 samples within 1 assay <br>Active assay: RNA (38379 features, 0 variable features)<br>&gt; as.data.frame(sceList[[1]]@assays<span>$RNA</span>@counts[1:10, 1:2])<br>                  AAACCCAAGAGTACCG-1 AAACCCAAGGTATAGT-1<br>GRCh38-AL627309.1                  0                  0<br>GRCh38-AL627309.5                  0                  0<br>GRCh38-AP006222.2                  0                  0<br>GRCh38-LINC01409                   0                  0<br>GRCh38-FAM87B                      0                  0<br>GRCh38-LINC01128                   0                  0<br>GRCh38-LINC00115                   0                  0<br>GRCh38-FAM41C                      0                  0<br>GRCh38-AL645608.6                  0                  0<br>GRCh38-AL645608.2                  0                  0<br>&gt; as.data.frame(tail(sceList[[1]]@assays<span>$RNA</span>@counts[ , 1:2]))<br>                      AAACCCAAGAGTACCG-1 AAACCCAAGGTATAGT-1<br>mm10---CAAA01118383.1                  0                  0<br>mm10---Csprs                           0                  0<br>mm10---Vamp7                           0                  0<br>mm10---Tmlhe                           0                  0<br>mm10---CAAA01147332.1                  0                  0<br>mm10---AC149090.1                      0                  0<br></code></pre><p data-tool="mdnice编辑器">虽然说是6379多个细胞，有38379个基因，但是里面肯定是有人和小鼠，我们可以简单的拆分，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>sceList = lapply(sceList,<span>function</span>(sce){<br>  <span>#sce = sceList[[1]]</span><br>  ct = sce@assays$RNA@counts<br>  kp=grepl(<span>'mm10---'</span>,rownames(ct))<br>  table(kp)<br>  ct = ct[!kp,]<br>  rownames(ct) = gsub(<span>'GRCh38-'</span>,<span>''</span>,rownames(ct))<br>  ct[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>  sce = CreateSeuratObject(<br>    counts = ct,  min.cells = <span>5</span>,<br>    min.features = <span>500</span><br>  )<br>  print(dim(sce))<br>  print(sce@assays$RNA@counts[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>])<br>  <span>return</span>(sce)<br>})<br><br><span># gsub('^GSM[0-9]*','',samples)</span><br>sce.all=merge(x=sceList[[<span>1</span>]],<br>              y=sceList[ -<span>1</span> ],<br>              add.cell.ids =  gsub(<span>'^GSM[0-9]*_'</span>,<span>''</span>,<br>                                   gsub(<span>'filtered_feature_bc_matrix'</span>,<span>''</span>,samples))    )<br><span># gsub('_gene_cell_exprs_table.txt.gz','',</span><br><span>#      gsub('^GSM[0-9]*_','',samples) )  </span><br><br>as.data.frame(sce.all@assays$RNA@counts[<span>1</span>:<span>10</span>, <span>1</span>:<span>2</span>])<br>head(sce.all@meta.data, <span>10</span>)<br>table(sce.all$orig.ident) <br><span># GRCh38-</span><br><span># mm10---</span><br></code></pre><p data-tool="mdnice编辑器">主要是根据表达量矩阵里面的 GRCh38和mm10前缀，它们在基因名字前面，是可以筛选和切除的。上面演示的是保留人类基因名字的矩阵，简单的修改过滤的逻辑就是保留小鼠基因的表达量矩阵进行后续的降维聚类分群啦。</p><h3 data-tool="mdnice编辑器"><span></span>也可以是物种+病毒<span></span></h3><p data-tool="mdnice编辑器">前面的PDX模型（Patient-Derived Xenograft Model）是来源于多个物种的单细胞转录组表达量矩阵的典型例子， 其实类似的案例还有很多，比如各种癌症都有对应的病毒，如果你想探索就需要<a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247508801&amp;idx=1&amp;sn=00b13944439e0cc04061d8fbb4185c57&amp;scene=21#wechat_redirect" data-linktype="2">单细胞转录组定量的时候需要修改参考基因组</a>。</p><p data-tool="mdnice编辑器">而且非洲猪瘟也是如此，恰好看到了2022的文章《Transcriptome profiling in swine macrophages infected with African swine fever virus at single-cell resolution》，描述了很清楚这个定量过程：</p><p><img data-cropselx1="0" data-cropselx2="558" data-cropsely1="0" data-cropsely2="262" data-galleryid="" data-ratio="0.5824607329842932" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQnhClhN0dtu3mDczJy1V7Ls1VrSiat7QNJUYjTwTObURag1xAd0xLdb1CTbnrQ4iarfabdIzicIgEtg/640?wx_fmt=png" data-type="png" data-w="1528" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQnhClhN0dtu3mDczJy1V7Ls1VrSiat7QNJUYjTwTObURag1xAd0xLdb1CTbnrQ4iarfabdIzicIgEtg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>定量过程</figcaption></figure><p data-tool="mdnice编辑器">就是前面提到的首先需要安装了<code>cellranger</code>软件，你可以从10x Genomics官方网站上下载并安装最新版本。然后制作两个物种的混合基因组的参考文件，来自Illumina测序的fastq文件准备好，并确保它们按照<code>cellranger</code>的要求进行命名。接下来就可以<strong>运行<code>cellranger count</code>命令</strong>即可拿到表达量矩阵文件。</p><p data-tool="mdnice编辑器">它的<strong>运行<code>cellranger count</code>命令</strong>即可拿到表达量矩阵文件就是在数据集：https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE168113</p><pre data-tool="mdnice编辑器"><span></span><code>GSM5129158 UninfectedGroup_T0<br><br>GSM5129159 UninfectedGroup_T2<br>GSM5129160 UninfectedGroup_T6<br>GSM5129161 UninfectedGroup_T10<br>GSM5129162 UninfectedGroup_T15<br>GSM5129163 UninfectedGroup_T24<br>GSM5129164 UninfectedGroup_T36<br><br>GSM5129165 InfectedGroup_T2<br>GSM5129166 InfectedGroup_T6<br>GSM5129167 InfectedGroup_T10<br>GSM5129168 InfectedGroup_T15<br>GSM5129169 InfectedGroup_T24<br>GSM5129170 InfectedGroup_T36<br></code></pre><p data-tool="mdnice编辑器">需要同样的整理它提供的表达量矩阵，然后读取后，可以看到表达量矩阵里面也是被加入了前缀 ；</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; head(sce.all@assays<span>$RNA</span>@counts[ , 1:2])<br>6 x 2 sparse Matrix of class <span>"dgCMatrix"</span> <br>                        InfectedGroup_T10_AAACCCAAGACCTCCG-1<br>Georgia------MGF-360-1L                                    3<br>Georgia------MGF-360-2L                                    1<br>Georgia------KP177R                                        .<br>Georgia------L83L                                         10<br>Georgia------L60L                                          .<br>Georgia------MGF-360-3L                                    .<br><br>&gt; tail(sce.all@assays<span>$RNA</span>@counts[ , 1:2])<br>6 x 2 sparse Matrix of class <span>"dgCMatrix"</span><br>                                InfectedGroup_T10_AAACCCAAGAATCTAG-1<br>Sus-scrofa11-ZNF594                                                .<br>Sus-scrofa11-NT5M                                                  .<br>Sus-scrofa11-ENSSSCG00000027662                                    .<br>Sus-scrofa11-ENSSSCG00000028362                                    .<br>Sus-scrofa11-CCDC38                                                .<br>Sus-scrofa11-ENSSSCG00000038934                                    . <br></code></pre><p data-tool="mdnice编辑器">很明显就需要切割，主要的表达量矩阵进入Seurat流程进行降维聚类分群，然后很容易做的如下所示图（不过，值得注意的 感染与否的两个分组居然可以相差如此之大，可能是需要仔细看文章的methods描述） ：</p><p><img data-galleryid="" data-ratio="0.4694835680751174" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQnhClhN0dtu3mDczJy1V7LmqB1iboYy64Ug9bYMkOQibUqaoVj6BMV0SMHOvxV1huKib6YsP8ibAx4hQ/640?wx_fmt=png" data-type="png" data-w="1278" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQnhClhN0dtu3mDczJy1V7LmqB1iboYy64Ug9bYMkOQibUqaoVj6BMV0SMHOvxV1huKib6YsP8ibAx4hQ/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>进入Seurat流程进行降维聚类分群</figcaption></figure><p data-tool="mdnice编辑器">还会有一个矩阵是保存了病毒的基因表达量矩阵，就可以做丰富的<strong>叠加可视化</strong>，在前面的umap的基础上面可以把这些病毒基因表达量含量作为细胞的列属性，而不是基因表达量的行 ：</p><p><img data-galleryid="" data-ratio="1.528169014084507" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQnhClhN0dtu3mDczJy1V7LE6YEe7VdYzMsbbPc3Efkk1iaTaxoeQ9Wbia4cyUlCqPxictNKvrP1gJgg/640?wx_fmt=png" data-type="png" data-w="568" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQnhClhN0dtu3mDczJy1V7LE6YEe7VdYzMsbbPc3Efkk1iaTaxoeQ9Wbia4cyUlCqPxictNKvrP1gJgg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>叠加可视化</figcaption></figure><p data-tool="mdnice编辑器">如果是我们自己处理这个数据集，其实会看到每个样品的都会被很好的融合在一起，如下所示：</p><p><img data-galleryid="" data-ratio="0.5127153404429861" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQnhClhN0dtu3mDczJy1V7LQCEricicD4oPNh1kjBiaia8NoeA2h4BOF3UXBROAtnTUhWPiakygYVibf5DA/640?wx_fmt=png" data-type="png" data-w="2438" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQnhClhN0dtu3mDczJy1V7LQCEricicD4oPNh1kjBiaia8NoeA2h4BOF3UXBROAtnTUhWPiakygYVibf5DA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">细胞数据量确实有点大：</p><p><img data-galleryid="" data-ratio="0.6666666666666666" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQnhClhN0dtu3mDczJy1V7LO2iaDKNlJe1X3NXbQgVRmE7Bd6KjybjiatZahfrqR01bvvjPK3zQBncw/640?wx_fmt=png" data-type="png" data-w="1938" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQnhClhN0dtu3mDczJy1V7LO2iaDKNlJe1X3NXbQgVRmE7Bd6KjybjiatZahfrqR01bvvjPK3zQBncw/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><h3 data-tool="mdnice编辑器"><span></span>值得思考的问题<span></span></h3><ul data-tool="mdnice编辑器"><li><section><strong>为什么这个单细胞转录组数据集的降维聚类分群结果里面绝大部分细胞都是巨噬细胞呢？</strong></section></li><li><section>这个数据集的物种是猪，它的巨噬细胞跟人类肿瘤里面的巨噬细胞差异很大，没有我们前面提到的M1和M2，详见：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247515731&amp;idx=1&amp;sn=6d728661b6d022a9185e72b94a9267c5&amp;scene=21#wechat_redirect" data-linktype="2">M1和M2的巨噬细胞差异就在CD86和CD163吗</a>，而且也没有CXCL9 and SPP1的排他性，TREM2联合SPP1去和FOLR2基因的排他性。。。</section></li><li><section><strong>这个数据集是两个分组各自内部多个时间点，理论上可以做pseudo-bulk 分析，也是可以根据数据分析结果拿到一个独立的生物学故事。</strong></section></li></ul></section><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526014&amp;idx=1&amp;sn=44afb387fc49b89276386e5182db7bc9&amp;chksm=9b4b26c5ac3cafd35616b2fe9df7fea664e59d75e9970feb322a477beb222ac023f7daebb3dc&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授课（买一得‍五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247522831&amp;idx=2&amp;sn=1744efdf428465425a145ff3a982198b&amp;chksm=9b4bdab4ac3c53a28fbecbbff4f254f470b54a7a20468bb753b295b930315e1ec45bcbabc10b&amp;scene=21#wechat_redirect" textvalue="144线程640Gb内存服务器共享一年‍仍然是仅需800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">144线程640Gb内存服务器共享一年仍然是仅需800</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">千呼万唤始出来的独享生物信息学云服务器</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"></a><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524275&amp;idx=1&amp;sn=fa592ee29f636f34387491d0fceadd8e&amp;chksm=9b4bdf08ac3c561e0881974b3817beb0a0e514dc1a8df4c34c2b6653da6fa78e09acb03c70c2&amp;scene=21#wechat_redirect" textvalue="生信技能树知识整理实习生又又又开放申请啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信技能树知识整理实习生又又又开放申请啦</a><span><strong>（不招了，谢谢）</strong></span></section></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524432&amp;idx=1&amp;sn=5b33b0c6807a9e6939c332c58fabff89&amp;chksm=9b4b20ebac3ca9fdb3d8bfaf2bef5552f64eb70e7fae557cc7197fb1a23b3e8bc31b585bf829&amp;scene=21#wechat_redirect" textvalue="生信共享办公室出租" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信共享办公室出租</a></p></li></ul><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/uuqyGnFkw1TfwKyAGnF9Uw",target="_blank" rel="noopener noreferrer">原文链接</a>
