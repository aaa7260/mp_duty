---
title: "和降维图保持一致的细胞类群统计图"
date: 2023-11-30T00:24:14Z
draft: ["false"]
tags: [
  "fetched",
  "YuLabSMU"
]
categories: ["Acdemic"]
---
和降维图保持一致的细胞类群统计图 by YuLabSMU
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><p data-tool="mdnice编辑器">首先来个Seurat的套路代码：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(Seurat)<br>dir = <span>"data/filtered_gene_bc_matrices/hg19"</span><br><br>pbmc.data &lt;- Read10X(data.dir = dir)<br>pbmc &lt;- CreateSeuratObject(counts = pbmc.data, project = <span>"pbmc3k"</span>, <br>                          min.cells=<span>3</span>, min.features=<span>200</span>)<br>pbmc[[<span>"percent.mt"</span>]] &lt;- PercentageFeatureSet(pbmc, pattern = <span>"^MT-"</span>)<br>pbmc &lt;- subset(pbmc,<br>  subset = nFeature_RNA &gt; <span>200</span> &amp; nFeature_RNA &lt; <span>2500</span> &amp; percent.mt &lt; <span>5</span><br>)<br><br>pbmc &lt;- NormalizeData(pbmc, normalization.method = <span>"LogNormalize"</span>,<br>                      scale.factor = <span>10000</span>)<br>pbmc &lt;- ScaleData(pbmc)<br><br>pbmc &lt;- FindVariableFeatures(pbmc, selection.method = <span>"vst"</span>,<br>                             nfeatures = <span>2000</span>)<br>pbmc &lt;- RunPCA(pbmc, features = VariableFeatures(object = pbmc))<br>pbmc &lt;- RunUMAP(pbmc, dims = <span>1</span>:<span>10</span>)<br><br>pbmc &lt;- FindNeighbors(pbmc, dims = <span>1</span>:<span>10</span>)<br>pbmc &lt;- FindClusters(pbmc, resolution = <span>0.5</span>)<br><br><span>## Assigning cell type identity to clusters</span><br>cluster.ids &lt;- c(<span>"Naive CD4 T"</span>, <span>"CD14+ Mono"</span>, <span>"Memory CD4 T"</span>, <br>            <span>"B"</span>, <span>"CD8 T"</span>, <span>"FCGR3A+ Mono"</span>, <span>"NK"</span>, <span>"DC"</span>, <span>"Platelet"</span>)<br>names(cluster.ids) &lt;- levels(pbmc)<br>pbmc &lt;- RenameIdents(pbmc, cluster.ids)<br></code></pre><p data-tool="mdnice编辑器">再来画个降维图：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggplot2)<br><span>library</span>(ggsc)<br><br>p &lt;- sc_dim(pbmc) + sc_dim_geom_label()<br>p<br></code></pre><p><img data-galleryid="" data-ratio="0.567987567987568" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4lKESUNOpYXEByibO3J8IaOjdSjmiaGENMSSktAKPw9p5M7eBmEqWmMcgpGlUzoeouqHkFSWVcyicAJg/640?wx_fmt=png" data-type="png" data-w="1287" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4lKESUNOpYXEByibO3J8IaOjdSjmiaGENMSSktAKPw9p5M7eBmEqWmMcgpGlUzoeouqHkFSWVcyicAJg/640?wx_fmt=png"></p><p data-tool="mdnice编辑器">如果你想可视化不同类别的细胞数目，是不是还稍微有点麻烦，统计一下，画个柱状图，这个一点都不麻烦，麻烦的是你要和你的降维图保持颜色对应。所以有一些解决方案，是写个函数，同时把两个图都出了，画在一起。但这样子绑死呢，就会降低灵活性。我的一向思路是保持最简单，然后可组合。那么在<code>ggsc</code>我们是怎么做的？那就是你画你的降维图，然后拿降维图来做为输入，画柱状图，让柱状图和降维图保持一致。</p><p data-tool="mdnice编辑器">一条指令出图：</p><pre data-tool="mdnice编辑器"><span></span><code>sc_dim_count(p)<br></code></pre><p><img data-galleryid="" data-ratio="0.567987567987568" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4lKESUNOpYXEByibO3J8IaOjaaXX515g5RLjYKEJlaMibpsUN4lK4WtfcThWKBJW69xSek80uSRTDuQ/640?wx_fmt=png" data-type="png" data-w="1287" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4lKESUNOpYXEByibO3J8IaOjaaXX515g5RLjYKEJlaMibpsUN4lK4WtfcThWKBJW69xSek80uSRTDuQ/640?wx_fmt=png"></p><p data-tool="mdnice编辑器">假设我换个配色方案，柱状图跟着变：</p><pre data-tool="mdnice编辑器"><span></span><code>p &lt;- p + scale_color_viridis_d()<br>p2 &lt;- sc_dim_count(p)<br>aplot::plot_list(p, p2, widths=c(<span>1</span>, <span>.5</span>))<br></code></pre><p><img data-galleryid="" data-ratio="0.567987567987568" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4lKESUNOpYXEByibO3J8IaOjWoxiaXjdJ41Weibxw6RORstQeKXMOJjIZbmt7uuX0qx02BGM4VMx6nSA/640?wx_fmt=png" data-type="png" data-w="1287" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4lKESUNOpYXEByibO3J8IaOjWoxiaXjdJ41Weibxw6RORstQeKXMOJjIZbmt7uuX0qx02BGM4VMx6nSA/640?wx_fmt=png"></p><p data-tool="mdnice编辑器">另外如果你是用Seurat画的图，也是可以支持的。</p><pre data-tool="mdnice编辑器"><span></span><code>p3 &lt;- DimPlot(pbmc, reduction = <span>"umap"</span>,<br>          label = <span>TRUE</span>, pt.size = <span>0.5</span>) <br>p4 &lt;- sc_dim_count(p3)<br>aplot::plot_list(p3, p4, widths=c(<span>1</span>, <span>.5</span>))<br></code></pre></section><p><img data-galleryid="" data-ratio="0.567987567987568" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4lKESUNOpYXEByibO3J8IaOjyT3fX4Ilcgch2oWWacow7aQ1bFVib9gI6YtSFAgwfazziapROxIWAzrA/640?wx_fmt=png" data-type="png" data-w="1287" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4lKESUNOpYXEByibO3J8IaOjyT3fX4Ilcgch2oWWacow7aQ1bFVib9gI6YtSFAgwfazziapROxIWAzrA/640?wx_fmt=png"></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">KISS（Keep It Simple and Stupid）原则是我们所追求的。<img data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Firecracker.png" data-ratio="1" data-w="128" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Firecracker.png"></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/PRStNRokP3oCgGStbiNRLw",target="_blank" rel="noopener noreferrer">原文链接</a>
