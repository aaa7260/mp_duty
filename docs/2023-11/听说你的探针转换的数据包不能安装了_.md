---
title: "听说你的探针转换的数据包不能安装了？"
date: 2023-11-17T05:13:29Z
draft: ["false"]
tags: [
  "fetched",
  "果子学生信"
]
categories: ["Acdemic"]
---
听说你的探针转换的数据包不能安装了？ by 果子学生信
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">学员在探针转换时，发现需要用到“IlluminaHumanMethylation450k.db”，于是用如下命令安装</p><pre data-tool="mdnice编辑器"><span></span><code>BiocManager::install(<span>"IlluminaHumanMethylation450k.db"</span>)<br></code></pre><p data-tool="mdnice编辑器">却遇到了如下的问题</p><pre data-tool="mdnice编辑器"><span></span><code>Warning message:<br>package ‘IlluminaHumanMethylation450k.db’ is not available <span>for</span> Bioconductor version <span>'3.16'</span><br><br>A version of this package <span>for</span> your version of R might be available elsewhere,<br>see the ideas at<br>https://cran.r-project.org/doc/manuals/r-patched/R-admin.html<span>#Installing-packages </span><br></code></pre><p data-tool="mdnice编辑器">于是，我去搜索了下，找到Bioconductor相应的页面。我发现这个安装命令有点老旧啊（见下图1），于是我点了下图2的链接。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="503253278" data-ratio="1.0842592592592593" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/NDy5aEnReX1fjMmnSR0PbsibaehAPUcao4ZJUXd4ib84t7rICB2tf7Gmo90e69CtqB4vHWsL0DV3FPxdzlxQ4FdQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/NDy5aEnReX1fjMmnSR0PbsibaehAPUcao4ZJUXd4ib84t7rICB2tf7Gmo90e69CtqB4vHWsL0DV3FPxdzlxQ4FdQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">可恶，居然这个包被移除了，而且是两次！这是啥情况啊！</p><figure data-tool="mdnice编辑器"><img data-imgfileid="503253279" data-ratio="0.9953703703703703" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/NDy5aEnReX1fjMmnSR0PbsibaehAPUcaoiaTZQE8fjoM5Thd3Vj11AWHoMdymmzjrFa9GzrTpH1FPR0rYIzV2K0Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/NDy5aEnReX1fjMmnSR0PbsibaehAPUcaoiaTZQE8fjoM5Thd3Vj11AWHoMdymmzjrFa9GzrTpH1FPR0rYIzV2K0Q/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">咋办呢？这难不成我们，因为我知道Bioconductor的数据包，本质上是sqlite数据的封装而已，只要我能够下载源代码，我就能进行解析。但离谱是，官方站点的地址给我一个Error。</p><pre data-tool="mdnice编辑器"><span></span><code>Error&gt;<br>&lt;Code&gt;NoSuchKey&lt;/Code&gt;<br>&lt;BucketName&gt;bir190004-bucket01&lt;/BucketName&gt;<br>&lt;RequestId&gt;tx00000f0c9eb33edbd6227-006556ed22-6142ee-default&lt;/RequestId&gt;<br>&lt;HostId&gt;6142ee-default-default&lt;/HostId&gt;<br>&lt;/Error&gt;<br></code></pre><p data-tool="mdnice编辑器">还好互联网上有很多备份，我找到了一个可用的地址：https://bioconductor.riken.jp/packages/3.5/data/annotation/src/contrib/IlluminaHumanMethylation450k.db_2.0.9.tar.gz</p><p data-tool="mdnice编辑器">我尝试用 install.packages的方式直接安装，但是估计是底层的包发生了变动，导致安装失败嘞。</p><pre data-tool="mdnice编辑器"><span></span><code>install.packages(<span>"https://bioconductor.riken.jp/packages/3.5/data/annotation/src/contrib/IlluminaHumanMethylation450k.db_2.0.9.tar.gz"</span>,repos = NULL)<br><br><span># 错误信息</span><br>Error: package or namespace load failed <span>for</span> ‘IlluminaHumanMethylation450k.db’:<br> .onLoad failed <span>in</span> loadNamespace() <span>for</span> <span>'IlluminaHumanMethylation450k.db'</span>, details:<br>  call: NULL<br>  error: <span>'fun'</span> is defunct.<br>Use <span>'FDb.InfiniumMethylation.hg19'</span> instead.<br>Use <span>'FDb.InfiniumMethylation.hg18'</span> instead.<br>Use <span>'mapToGenome() function in minfi or methylumi'</span> instead.<br>See <span>help</span>(<span>"Defunct"</span>)<br>Error: loading failed<br>Execution halted<br>ERROR: loading failed<br>* removing ‘/Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/library/IlluminaHumanMethylation450k.db’<br>Warning <span>in</span> install.packages :<br>  installation of package ‘/var/folders/65/zlf_hpss17x0s_qcjgsjwcch0000gn/T//Rtmp4eAzEn/downloaded_packages/IlluminaHumanMethylation450k.db_2.0.9.tar.gz’ had non-zero <span>exit</span> status<br></code></pre><p data-tool="mdnice编辑器">于是，我只能单独下载这个tar.gz文件，将其解压缩，使用RSQLite直接读取。</p><pre data-tool="mdnice编辑器"><span></span><code>library(RSQLite)<br><br><span># 连接到SQLite数据库</span><br>con &lt;- dbConnect(RSQLite::SQLite(), <span>"~/Desktop/IlluminaHumanMethylation450k.db/inst/extdata/IlluminaHumanMethylation450k.sqlite"</span>)<br><br><span># 获取数据库中的所有表名</span><br>tables &lt;- dbListTables(con)<br><br><span># 关闭数据库连接</span><br>dbDisconnect(con)<br><br><span># 查看所有表名</span><br><span>print</span>(tables)<br><br><span># 显示内容如下</span><br> [1] <span>"accessions"</span>     <span>"controlprobes"</span>  <span>"cpgi"</span>           <span>"cpgilocation"</span>   <span>"cpgirelations"</span>  <span>"cpgislandnames"</span><br> [7] <span>"cpgiview"</span>       <span>"dmr"</span>            <span>"fantom"</span>         <span>"featuregroups"</span>  <span>"featurenames"</span>   <span>"map_counts"</span>    <br>[13] <span>"map_metadata"</span>   <span>"metadata"</span>       <span>"probedesign"</span>    <span>"probedesign1"</span>   <span>"probedesign2"</span>   <span>"probelocation"</span> <br>[19] <span>"probes"</span>         <span>"probesummary"</span>   <span>"reglocation"</span>    <span>"regulatory"</span>     <span>"regview"</span>        <span>"relations"</span>     <br>[25] <span>"snps"</span>   <br></code></pre><p data-tool="mdnice编辑器">那里面的probes不出意外，应该就是我们需要的内容了。</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(RSQLite)<br><br><span># 连接到SQLite数据库</span><br>con &lt;- dbConnect(RSQLite::SQLite(), <span>"~/Desktop/IlluminaHumanMethylation450k.db/inst/extdata/IlluminaHumanMethylation450k.sqlite"</span>)<br><br><span># 读取表中的数据</span><br>result &lt;- dbGetQuery(con, <span>"SELECT * FROM probes"</span>)<br><br><span># 关闭数据库连接</span><br>dbDisconnect(con)<br><br><span># 查看读取的结果</span><br>print(head(result))<br><br><span># 结果如下</span><br>    probe_id gene_id is_multiple<br><span>1</span> cg00000029    <span>5934</span>           <span>0</span><br><span>2</span> cg00000108  <span>339883</span>           <span>0</span><br><span>3</span> cg00000109   <span>64778</span>           <span>0</span><br><span>4</span> cg00000165    &lt;<span>NA</span>&gt;           <span>0</span><br><span>5</span> cg00000236    <span>7419</span>           <span>0</span><br><span>6</span> cg00000289      <span>87</span>           <span>0</span><br></code></pre><p data-tool="mdnice编辑器">那么只要将这个结果保存到本地，后续就能够使用了。</p><pre data-tool="mdnice编辑器"><span></span><code>saveRDS(result,file=<span>"~/Desktop/IlluminaHumanMethylation450k_probe.Rds"</span>)<br></code></pre><p data-tool="mdnice编辑器">如果，你想要自己测试这个sqlite数据，可以在果子公众号后台回复 <strong>洲更debug</strong>，就可以获取数据下载地址。</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/TyZc3HeSxcFcK2CcLaD3hw",target="_blank" rel="noopener noreferrer">原文链接</a>
