---
title: "一文拿捏GO功能富集与可视化（clusterProfiler版）！"
date: 2023-11-25T04:02:32Z
draft: ["false"]
tags: [
  "fetched",
  "SCIPainter"
]
categories: ["Acdemic"]
---
一文拿捏GO功能富集与可视化（clusterProfiler版）！ by SCIPainter
------
<div><section data-mpa-powered-by="yiban.io"><span></span><span>上期我们学习了基于</span><span>clusterProfiler包</span><span>的KEGG富集分析与可视化，具体可戳：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzIyOTY3MDA3MA==&amp;mid=2247530601&amp;idx=1&amp;sn=5ddbe9d7766f64c9e86dc302f2a49da7&amp;chksm=e8bd15b0dfca9ca651c95544b5bb4154e5ee03cd32edbd0710159429cc425d9dc17c31ebb9ff&amp;scene=21#wechat_redirect" textvalue="一文拿捏KEGG功能富集与可视化（clusterProfiler版）！" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">一文拿捏KEGG功能富集与可视化（clusterProfiler版）！</a></span></section><section><br></section><section><span>本期我们继续学习GO（Gene Ontology）富集分析与可视化，建议先学习上期后本期体验更加。话不多说，下面进入正题！</span></section><p><br mpa-from-tpl="t"></p><section data-mpa-template="t" mpa-from-tpl="t"><section data-mpa-template="t" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><p data-mid=""><strong mpa-from-tpl="t"><span>1</span></strong></p></section><section data-mid="" mpa-from-tpl="t"><img data-ratio="0.5" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/WDyHvzhkyuO7occO7q58Eiaia0lEEs6ZoE41TykPaohJO6lnxKfn2HLD9BB5PkZiam7iaLwExdpibnd5JBOdWBzzB0g/640?wx_fmt=png" data-w="16" data-imgfileid="100047107" src="https://mmbiz.qpic.cn/sz_mmbiz_png/WDyHvzhkyuO7occO7q58Eiaia0lEEs6ZoE41TykPaohJO6lnxKfn2HLD9BB5PkZiam7iaLwExdpibnd5JBOdWBzzB0g/640?wx_fmt=png"></section></section><section data-mid="" mpa-from-tpl="t"><br mpa-from-tpl="t"></section></section><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><p data-mid="">GO富集分析</p></section></section><section data-mid="" mpa-from-tpl="t"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/DHQ0ibK0hBdlvVkTKl8rOH5nx63g7EzwlD1Oy3LbOsM7ktbtfRA31908GJBvkaJibFiaV9nR4cKia13RK5eBJC0CCA/640?wx_fmt=png" data-w="16" data-imgfileid="100047108" src="https://mmbiz.qpic.cn/sz_mmbiz_png/DHQ0ibK0hBdlvVkTKl8rOH5nx63g7EzwlD1Oy3LbOsM7ktbtfRA31908GJBvkaJibFiaV9nR4cKia13RK5eBJC0CCA/640?wx_fmt=png"></section></section></section></section></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#所需R包载入：</span><br mpa-from-tpl="t"><span>library</span>(dplyr)<br mpa-from-tpl="t"><span>library</span>(stringr)<br mpa-from-tpl="t"><span>library</span>(org.Hs.eg.db) <span>#智人注释包</span><br mpa-from-tpl="t"><span>library</span>(clusterProfiler)<br mpa-from-tpl="t"><span>library</span>(ggplot2)<br mpa-from-tpl="t"><span>library</span>(RColorBrewer)<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>#载入DESeq2差异分析结果表：</span><br mpa-from-tpl="t"><span>DESeq2</span> &lt;- read.csv('TCGA-CHOL-DESeq2.csv', header = T, row.names = 1, check.names = F)<br mpa-from-tpl="t"><span>head</span>(DESeq2)</code></pre></section><p><br></p><section><span></span></section><section><img data-imgfileid="100046967" data-ratio="0.1935185185185185" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnNT51GHqQmVcTZrQvNyznSMc6jpXyfPIgxbIqEkmewG66SwYC1ibnSSA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnNT51GHqQmVcTZrQvNyznSMc6jpXyfPIgxbIqEkmewG66SwYC1ibnSSA/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#差异基因集提取：</span><br mpa-from-tpl="t"><span>up</span> &lt;- rownames(DESeq2)[DESeq2$group == <span>"Up"</span>]<span>#</span><span>差异上调</span><br mpa-from-tpl="t"><span>down</span> &lt;- rownames(DESeq2)[DESeq2$group == <span>"Down"</span>]<span>#差异下调</span><br mpa-from-tpl="t"><span>diff</span> &lt;- c(up, down)<span>#所有差异基因</span><br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>#ID转换：</span><br mpa-from-tpl="t"><span>##以总差异基因集为例进行转换：</span><br mpa-from-tpl="t"><span>diff_entrez</span> &lt;- bitr(diff,<br mpa-from-tpl="t">                    <span>fromType</span> = <span>"SYMBOL"</span>,<br mpa-from-tpl="t">                    <span>toType</span> = <span>"ENTREZID"</span>,<br mpa-from-tpl="t">                    <span>OrgDb</span> = <span>"org.Hs.eg.db"</span>)<br mpa-from-tpl="t"><span>head</span>(diff_entrez)</code></pre></section><p><br></p><section><span></span></section><section><img data-imgfileid="100046966" data-ratio="0.4195121951219512" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4Qcn8PEzukW1ENq0fQZLricnbEFuiaAPCzicIuMiajdmiaSPlXzMmnwUWNiberOw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="615" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4Qcn8PEzukW1ENq0fQZLricnbEFuiaAPCzicIuMiajdmiaSPlXzMmnwUWNiberOw/640?wx_fmt=png&amp;from=appmsg"></section><section><span><br></span></section><section><span>GO分为三个Ontology，分别为</span><span>分子功能(MF，Molecular Function)</span><span>、</span><span>细胞组分(CC，Cellular Component)</span><span>及</span><span>生物过程(BP，Biological Process)</span><span>。我们在进行GO富集时，可根据自己的背景需要，对某个Ontology单独富集，或者选择合并富集。</span></section><section><span><br mpa-from-tpl="t"></span></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#单个Ontology富集(CC为例):</span><br mpa-from-tpl="t"><span>GO_CC_diff</span> &lt;- enrichGO(gene = diff_entrez$ENTREZID, <br mpa-from-tpl="t">                       <span>OrgDb</span> = org.Hs.eg.db, <span>#指定包含该物种注释信息的org包</span><br mpa-from-tpl="t">                       <span>ont</span> = <span>"CC"</span>, <span>#"BP"，"MF","CC"三选一,或"ALL"合并</span><br mpa-from-tpl="t">                       <span>pAdjustMethod</span> = <span>"BH"</span>,<br mpa-from-tpl="t">                       <span>pvalueCutoff</span> = 0.05,<br mpa-from-tpl="t">                       <span>qvalueCutoff</span> = 0.05,<br mpa-from-tpl="t">                       <span>minGSSize</span> = 10,<br mpa-from-tpl="t">                       <span>maxGSSize</span> = 500,<br mpa-from-tpl="t">                       <span>readable</span> = T) <span>#结果表中将entrez转回symbol</span><br mpa-from-tpl="t"><span>#提取结果表格：</span><br mpa-from-tpl="t"><span>GO_CC_result</span> &lt;- GO_CC_diff@result<br mpa-from-tpl="t"><span>View</span>(GO_CC_result)</code></pre></section><p><br></p><section><span></span></section><section><img data-imgfileid="100046968" data-ratio="0.49722222222222223" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnvzEskGx9icBMVdVlDJhcSNA8lPqKuXb7vORhic4gyBicnXuyVm8IcBfOg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnvzEskGx9icBMVdVlDJhcSNA8lPqKuXb7vORhic4gyBicnXuyVm8IcBfOg/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#三个Ontology合并富集：</span><br mpa-from-tpl="t"><span>GO_all_diff</span> &lt;- enrichGO(gene = diff_entrez$ENTREZID, <br mpa-from-tpl="t">                        <span>OrgDb</span> = org.Hs.eg.db,<br mpa-from-tpl="t">                        <span>ont</span> = <span>"ALL"</span>, <br mpa-from-tpl="t">                        <span>pAdjustMethod</span> = <span>"BH"</span>, <br mpa-from-tpl="t">                        <span>pvalueCutoff</span> = 0.05,<br mpa-from-tpl="t">                        <span>qvalueCutoff</span> = 0.05,<br mpa-from-tpl="t">                        <span>minGSSize</span> = 10,<br mpa-from-tpl="t">                        <span>maxGSSize</span> = 500,<br mpa-from-tpl="t">                        <span>readable</span> = T) <br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>#提取结果表格：</span><br mpa-from-tpl="t"><span>##富集倍数和富集因子计算见上期（文首推文链接），这里不再重复</span><br mpa-from-tpl="t"><span>GO_all_result</span> &lt;- GO_all_diff@result<br mpa-from-tpl="t"><span>View</span>(GO_all_result)</code></pre></section><p><br></p><section><span></span></section><section><img data-imgfileid="100046969" data-ratio="0.49722222222222223" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcngxCdicbfePAW1LtMOP2OwIsuuYpvwodn2OoZcoUSZ8uyZ8Iy5Sn37mQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcngxCdicbfePAW1LtMOP2OwIsuuYpvwodn2OoZcoUSZ8uyZ8Iy5Sn37mQ/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section><span>合并富集得到的结果表中会多一列ONTOLOGY，表格分别按各个Ontology的pvalue从小到大排列。</span></section><section><span><br mpa-from-tpl="t"></span></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>##保存GO富集结果：</span><br mpa-from-tpl="t"><span>save</span>(GO_CC_diff, GO_CC_result, <br mpa-from-tpl="t">     <span>GO_all_diff</span>, GO_all_result, <br mpa-from-tpl="t">     <span>file</span> = c(<span>"TCGA-CHOL-GO-diff.Rdata"</span>))<br mpa-from-tpl="t"><span>write</span>.csv(GO_all_result, file = c('TCGA-CHOL-GO-diff.csv'))</code></pre></section><p><br></p><section><span></span></section><section><img data-imgfileid="100046970" data-ratio="0.7425925925925926" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnSL4xJGl31JI01G7tN33UkE5khqBA1r04t8b3nTdpXucXRfj8dLk2fA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnSL4xJGl31JI01G7tN33UkE5khqBA1r04t8b3nTdpXucXRfj8dLk2fA/640?wx_fmt=png&amp;from=appmsg"></section><section><span><br></span></section><section><span>得到的结果表为10列（单个Ontology富集则9列），部分易混淆列的含义如下：</span></section><section><span><br></span></section><p><strong><span>ONTOLOGY</span></strong><span>：</span><span>区分MF、CC和BP</span></p><p><span><strong>ID</strong></span><span>：</span><span>GO term ID号</span></p><p><span><strong>Description</strong></span><span>：</span><span>GO term的功能描述</span></p><p><span><strong>GeneRatio</strong></span><span>：</span><span>差异基因中富集到该GO term的基因数/富集到所有GO term的总差异基因数目</span></p><p><span><strong>BgRatio</strong></span><span>：</span><span>背景基因中富集到该GO term的基因数/背景基因总数</span></p><p><span><strong>Count</strong></span><span>：</span><span>差异基因中富集到该GO term的基因数</span></p><section><span><br mpa-from-tpl="t"></span></section><section data-mpa-template="t" mpa-from-tpl="t"><section data-mpa-template="t" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><p data-mid=""><strong mpa-from-tpl="t"><span>2</span></strong></p></section><section data-mid="" mpa-from-tpl="t"><img data-ratio="0.5" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/WDyHvzhkyuO7occO7q58Eiaia0lEEs6ZoE41TykPaohJO6lnxKfn2HLD9BB5PkZiam7iaLwExdpibnd5JBOdWBzzB0g/640?wx_fmt=png" data-w="16" data-imgfileid="100047109" src="https://mmbiz.qpic.cn/sz_mmbiz_png/WDyHvzhkyuO7occO7q58Eiaia0lEEs6ZoE41TykPaohJO6lnxKfn2HLD9BB5PkZiam7iaLwExdpibnd5JBOdWBzzB0g/640?wx_fmt=png"></section></section><section data-mid="" mpa-from-tpl="t"><br mpa-from-tpl="t"></section></section><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><p data-mid="">GO富集结果可视化（快速版）</p></section></section><section data-mid="" mpa-from-tpl="t"><img data-imgfileid="100047110" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/DHQ0ibK0hBdlvVkTKl8rOH5nx63g7EzwlD1Oy3LbOsM7ktbtfRA31908GJBvkaJibFiaV9nR4cKia13RK5eBJC0CCA/640?wx_fmt=png" data-w="16" src="https://mmbiz.qpic.cn/sz_mmbiz_png/DHQ0ibK0hBdlvVkTKl8rOH5nx63g7EzwlD1Oy3LbOsM7ktbtfRA31908GJBvkaJibFiaV9nR4cKia13RK5eBJC0CCA/640?wx_fmt=png"></section></section></section></section></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>BiocManager</span>::install(<span>"topGO"</span>)<br mpa-from-tpl="t"><span>library</span>(topGO)<br mpa-from-tpl="t"><span>library</span>(enrichplot)<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>#GO有向无环图绘制：</span><br mpa-from-tpl="t"><span>goplot</span>(GO_CC_diff)</code></pre></section><p><br></p><section><span></span></section><section><img data-imgfileid="100046974" data-ratio="1.0878186968838528" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnSj6xI1DZyy8hia09aBfbx6j1mUyO5DV3e3Em52DsL5NaEFfwcvEcZMA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1059" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnSj6xI1DZyy8hia09aBfbx6j1mUyO5DV3e3Em52DsL5NaEFfwcvEcZMA/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>plotGOgraph</span>(GO_CC_diff)</code></pre></section><p><br></p><section><img data-imgfileid="100046975" data-ratio="0.9462962962962963" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnsqCBzriafxiaWAwKh3Zvdzbics9N54ibrCEG31iaKJdGSD230PWpN0JYkBw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnsqCBzriafxiaWAwKh3Zvdzbics9N54ibrCEG31iaKJdGSD230PWpN0JYkBw/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#GO富集条形图绘制：</span><br mpa-from-tpl="t"><span>barplot</span>(<br mpa-from-tpl="t">  <span>GO_CC_diff</span>, <br mpa-from-tpl="t">  <span>x</span> = <span>"Count"</span>,<br mpa-from-tpl="t">  <span>color</span> = <span>"pvalue"</span>, <br mpa-from-tpl="t">  <span>showCategory</span> = 20,<br mpa-from-tpl="t">  <span>font</span>.size = 12,<br mpa-from-tpl="t">  <span>title</span> = <span>"Cellular Component enrichment barplot"</span>,<br mpa-from-tpl="t">  <span>label_format</span> = 50<br mpa-from-tpl="t">)</code></pre></section><p><br></p><section><span></span></section><section><img data-imgfileid="100046971" data-ratio="0.8583333333333333" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnPLEW7dJz9fynwsDZWmXz4URQ5Bjvfjlvvo0LAmDK21dDDuJUIJMW7g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnPLEW7dJz9fynwsDZWmXz4URQ5Bjvfjlvvo0LAmDK21dDDuJUIJMW7g/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#GO富集气泡图：</span><br mpa-from-tpl="t"><span>dotplot</span>(<br mpa-from-tpl="t">  <span>GO_CC_diff</span>, <br mpa-from-tpl="t">  <span>x</span> = <span>"GeneRatio"</span>, <br mpa-from-tpl="t">  <span>color</span> = <span>"p.adjust"</span>,<br mpa-from-tpl="t">  <span>title</span> = <span>"Top 20 of GO CC terms Enrichment"</span>,<br mpa-from-tpl="t">  <span>showCategory</span> = 20,<br mpa-from-tpl="t">  <span>label_format</span> = 50<br mpa-from-tpl="t">)</code></pre></section><p><br></p><section><span></span></section><section><img data-imgfileid="100046973" data-ratio="0.8583333333333333" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4Qcnjs3IrS3B2sgkibsmIFDZ0DUXiaU4AN24hNMNaFkRplBapxoydUicBwUicw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4Qcnjs3IrS3B2sgkibsmIFDZ0DUXiaU4AN24hNMNaFkRplBapxoydUicBwUicw/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#富集网络图:</span><br mpa-from-tpl="t"><span>edo</span> &lt;- pairwise_termsim(GO_CC_diff)<br mpa-from-tpl="t"><span>emapplot</span>(edo,<br mpa-from-tpl="t">         <span>layout</span> = <span>"kk"</span>, <span>#布</span><span>局形式</span><br mpa-from-tpl="t">         <span>showCategory</span> = 30) <span>#显示top30 terms</span></code></pre></section><p><br></p><section><span></span></section><section><img data-imgfileid="100046972" data-ratio="0.8518518518518519" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4Qcn8JLU23VyWPn3tJxgxtybHYDyw7aAdPV1ic30ZmAp6icicxQC2BZia5WCRg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4Qcn8JLU23VyWPn3tJxgxtybHYDyw7aAdPV1ic30ZmAp6icicxQC2BZia5WCRg/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-template="t" mpa-from-tpl="t"><section data-mpa-template="t" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><p data-mid=""><strong mpa-from-tpl="t"><span>3</span></strong></p></section><section data-mid="" mpa-from-tpl="t"><img data-ratio="0.5" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/WDyHvzhkyuO7occO7q58Eiaia0lEEs6ZoE41TykPaohJO6lnxKfn2HLD9BB5PkZiam7iaLwExdpibnd5JBOdWBzzB0g/640?wx_fmt=png" data-w="16" data-imgfileid="100047112" src="https://mmbiz.qpic.cn/sz_mmbiz_png/WDyHvzhkyuO7occO7q58Eiaia0lEEs6ZoE41TykPaohJO6lnxKfn2HLD9BB5PkZiam7iaLwExdpibnd5JBOdWBzzB0g/640?wx_fmt=png"></section></section><section data-mid="" mpa-from-tpl="t"><br mpa-from-tpl="t"></section></section><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><p data-mid="">GO富集结果可视化(ggplot2个性化版)</p></section></section><section data-mid="" mpa-from-tpl="t"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/DHQ0ibK0hBdlvVkTKl8rOH5nx63g7EzwlD1Oy3LbOsM7ktbtfRA31908GJBvkaJibFiaV9nR4cKia13RK5eBJC0CCA/640?wx_fmt=png" data-w="16" data-imgfileid="100047111" src="https://mmbiz.qpic.cn/sz_mmbiz_png/DHQ0ibK0hBdlvVkTKl8rOH5nx63g7EzwlD1Oy3LbOsM7ktbtfRA31908GJBvkaJibFiaV9nR4cKia13RK5eBJC0CCA/640?wx_fmt=png"></section></section></section></section></section><p><br></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#取各分类富集结果表top20：</span><br mpa-from-tpl="t"><span>BP</span> &lt;- GO_all_result[GO_all_result$ONTOLOGY=='BP',][1:20,]<br mpa-from-tpl="t"><span>CC</span> &lt;- GO_all_result[GO_all_result$ONTOLOGY=='CC',][1:20,]<br mpa-from-tpl="t"><span>MF</span> &lt;- GO_all_result[GO_all_result$ONTOLOGY=='MF',][1:20,]<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>#在MF的Description中存在过长字符串，我们将长度超过50的部分用...代替：</span><br mpa-from-tpl="t"><span>MF</span>$term &lt;- str_trunc(MF$Description, width = 50, side = <span>"right"</span>)<br mpa-from-tpl="t"><span>MF</span>$term</code></pre></section><p><br></p><section><span></span></section><section><img data-imgfileid="100046976" data-ratio="0.575" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4Qcn9kqKpgg9WWJNq7tGlUGqrjZHQOZwYWSZ0JQUDrNdPLHtElKGEA4XibA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4Qcn9kqKpgg9WWJNq7tGlUGqrjZHQOZwYWSZ0JQUDrNdPLHtElKGEA4XibA/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#指定绘图顺序（转换为因子）：</span><br mpa-from-tpl="t"><span>CC</span>$term &lt;- factor(CC$Description, levels = rev(CC$Description))<br mpa-from-tpl="t"><span>BP</span>$term &lt;- factor(BP$Description, levels = rev(BP$Description))<br mpa-from-tpl="t"><span>MF</span>$term &lt;- factor(MF$term, levels = rev(MF$term))<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>#GO富集柱形图绘制</span><br mpa-from-tpl="t"><span>#自定义主题：</span><br mpa-from-tpl="t"><span>mytheme</span> &lt;- theme(axis.title = element_text(size = 13),<br mpa-from-tpl="t">                 <span>axis</span>.text = element_text(size = 11), <br mpa-from-tpl="t">                 <span>plot</span>.title = element_text(size = 14, hjust = 0.5, face = <span>"bold"</span>), <br mpa-from-tpl="t">                 <span>legend</span>.title = element_text(size = 13), <br mpa-from-tpl="t">                 <span>legend</span>.text = element_text(size = 11)) <br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>#创建一个可套用的绘图函数减少重复代码：</span><br mpa-from-tpl="t"><span>GO_bar</span> &lt;- function(x){<br mpa-from-tpl="t">  <span>y</span> &lt;- get(x)<br mpa-from-tpl="t">  <span>ggplot</span>(data = y, aes(x = Count, y = term, fill = -log10(pvalue))) +<br mpa-from-tpl="t">    <span>geom_bar</span>(stat = <span>"identity"</span>, width = 0.8) + <br mpa-from-tpl="t">    <span>scale_y_discrete</span>(labels = function(y) str_wrap(y, width = 30) ) + <span>#label换行，部分term描述太长</span><br mpa-from-tpl="t">    <span>labs</span>(x = <span>"Gene Number"</span>, y = <span>""</span>,<br mpa-from-tpl="t">         <span>title</span> = paste0(x, <span>" of GO enrichment barplot"</span>)) +<br mpa-from-tpl="t">    <span>theme_bw</span>() +<br mpa-from-tpl="t">    <span>mytheme</span><br mpa-from-tpl="t">}<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>p1</span> &lt;- GO_bar(<span>"MF"</span>)+scale_fill_distiller(palette = <span>"Blues"</span>,direction = 1)</code></pre></section><p><br></p><section><span></span></section><section><img data-imgfileid="100046977" data-ratio="0.7351851851851852" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcntstU1mS4iasC2wuj972CRjrqtyq5btARoKoFYGQZEUJx9Z8vGGFrGibg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcntstU1mS4iasC2wuj972CRjrqtyq5btARoKoFYGQZEUJx9Z8vGGFrGibg/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>p2</span> &lt;- GO_bar(<span>"CC"</span>)+scale_fill_distiller(palette = <span>"Reds"</span>,direction = 1)</code></pre></section><p><br></p><section><img data-imgfileid="100046980" data-ratio="0.7777777777777778" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnGjqxqFbtpMWp3RY91ZbTKe1ibePgxBTibTsPHjmIlonVdVEO7Lgr0k0w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnGjqxqFbtpMWp3RY91ZbTKe1ibePgxBTibTsPHjmIlonVdVEO7Lgr0k0w/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>p3</span> &lt;- GO_bar(<span>"BP"</span>)+scale_fill_distiller(palette = <span>"Oranges"</span>,direction = 1)</code></pre></section><p><br></p><section><img data-imgfileid="100046978" data-ratio="0.7620370370370371" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnLHriaXicviaiaRPb2GXAjdBhU749eWR8BdouicxoxVhOuu86TQLTSqymluQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnLHriaXicviaiaRPb2GXAjdBhU749eWR8BdouicxoxVhOuu86TQLTSqymluQ/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#GO富集气泡图绘制</span><br mpa-from-tpl="t"><span>GO_dot</span> &lt;- function(x){<br mpa-from-tpl="t">  <span>y</span> = get(x)<br mpa-from-tpl="t">  <span>ggplot</span>(data = y, aes(x = Count, y = term)) + <br mpa-from-tpl="t">    <span>geom_point</span>(aes(size = Count, color = -log10(pvalue))) + <br mpa-from-tpl="t">    <span>scale_y_discrete</span>(labels = function(y) str_wrap(y, width = 50) ) +<br mpa-from-tpl="t">    <span>labs</span>(x = <span>"Gene Number"</span>, y = <span>""</span>,<br mpa-from-tpl="t">         <span>title</span> = paste0(x,<span>" of GO enrichment Dotplot"</span>),<br mpa-from-tpl="t">         <span>size</span> = <span>"Gene Number"</span>) +<br mpa-from-tpl="t">    <span>theme_bw</span>()+ <br mpa-from-tpl="t">    <span>mytheme</span><br mpa-from-tpl="t">}<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>pp1</span> &lt;- GO_dot(<span>"MF"</span>) + scale_color_distiller(palette = <span>"YlOrRd"</span>, direction = 1)</code></pre></section><p><br></p><section><span></span></section><section><img data-imgfileid="100046979" data-ratio="0.7240740740740741" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnYuNMP2YdebicCbIGKKiaib4YRx1PaBpgFSAA63CNOODlXGXcHwRosHVKg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnYuNMP2YdebicCbIGKKiaib4YRx1PaBpgFSAA63CNOODlXGXcHwRosHVKg/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>pp2</span> &lt;- GO_dot(<span>"CC"</span>) + scale_color_distiller(palette = <span>"YlGnBu"</span>, direction = 1)</code></pre></section><p><br></p><section><img data-imgfileid="100046982" data-ratio="0.7601851851851852" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnQVI9uiab3ICkicq86RudjIya7xomBQ1YdO6ZicDg9b9HAHvzYicmLB2Pew/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnQVI9uiab3ICkicq86RudjIya7xomBQ1YdO6ZicDg9b9HAHvzYicmLB2Pew/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>pp3</span> &lt;- GO_dot(<span>"BP"</span>) + scale_color_distiller(palette = <span>"YlOrBr"</span>, direction = 1)</code></pre></section><p><br></p><section><img data-imgfileid="100046981" data-ratio="0.7601851851851852" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4Qcn5MiaDvow8U9hPvzicDAmdAiccgdZ5icMoQsVSwVrM2xCRIBiaLshV0TT7Ug/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4Qcn5MiaDvow8U9hPvzicDAmdAiccgdZ5icMoQsVSwVrM2xCRIBiaLshV0TT7Ug/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section><span>除了针对单个ontology的结果分别可视化，我们也可以按pvalue从小到大拉通排序，探究总显著性。下面分享一种富集棒棒糖图的绘制方法，同时用颜色区分不同ontology。</span></section><section><span><br mpa-from-tpl="t"></span></section><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" mpa-preserve="t" mpa-from-tpl="t"><pre><code><span>#结果表按pvalue拉通重排序：</span><br mpa-from-tpl="t"><span>all_result</span> &lt;- arrange(GO_all_result, pvalue) <span>#默认升序</span><br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>#取top30：</span><br mpa-from-tpl="t"><span>all</span> &lt;- all_result[1:30,]<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>#指定绘图顺序（转换为因子）：</span><br mpa-from-tpl="t"><span>all</span>$term &lt;- str_trunc(<span>all</span>$Description, width = 50, side = <span>"right"</span>)<br mpa-from-tpl="t"><span>all</span>$term &lt;- factor(<span>all</span>$term, levels = rev(<span>all</span>$term))<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>#自定义y轴标签颜色(区分不同ontology)：</span><br mpa-from-tpl="t"><span>col_function</span> &lt;- function(x){<br mpa-from-tpl="t">  <span>col</span> &lt;- rep(<span>"black"</span>, length(x))<br mpa-from-tpl="t">  <span>BP</span> &lt;- which(x %in% c(<span>"BP"</span>))<br mpa-from-tpl="t">  <span>CC</span> &lt;- which(x %in% c(<span>"CC"</span>))<br mpa-from-tpl="t">  <span>MF</span> &lt;- which(x %in% c(<span>"MF"</span>))<br mpa-from-tpl="t">  <span>col</span>[BP] &lt;- <span>"#fc4d26"</span><br mpa-from-tpl="t">  <span>col</span>[CC] &lt;- <span>"#1792c1"</span><br mpa-from-tpl="t">  <span>col</span>[MF] &lt;- <span>"#3fad5d"</span><br mpa-from-tpl="t">  <span>col</span><br mpa-from-tpl="t">}<br mpa-from-tpl="t"><span>y_text_color</span> &lt;- col_function(<span>all</span>$ONTOLOGY)<br mpa-from-tpl="t"><br mpa-from-tpl="t"><span>ppp</span>&lt;- ggplot(data = <span>all</span>, aes(x = -log10(pvalue), y = term, fill = -log10(pvalue))) +<br mpa-from-tpl="t">  <span>geom_col</span>(width = 0.1) + <br mpa-from-tpl="t">  <span>geom_point</span>(aes(size = Count, color = -log10(pvalue))) +<br mpa-from-tpl="t">  <span>scale_size_continuous</span>(range = c(2, 7)) +<br mpa-from-tpl="t">  <span>scale_y_discrete</span>(labels = function(x) str_wrap(x, width = 50) ) + <br mpa-from-tpl="t">  <span>scale_fill_distiller</span>(palette = <span>"YlOrRd"</span>,direction = 1) +<br mpa-from-tpl="t">  <span>scale_color_distiller</span>(palette = <span>"YlOrRd"</span>,direction = 1) +<br mpa-from-tpl="t">  <span>labs</span>(x = <span>"-log10(pvalue)"</span>, y = <span>""</span>,<br mpa-from-tpl="t">       <span>title</span> = <span>"Top30 GO enrichment barplot"</span>) +<br mpa-from-tpl="t">  <span>theme_bw</span>() +<br mpa-from-tpl="t">  <span>mytheme</span> +<br mpa-from-tpl="t">  <span>theme</span>(axis.text.y = element_text(color = rev(y_text_color))) <span>#y轴标签颜色</span><br mpa-from-tpl="t"><span>ppp</span></code></pre></section><p><br></p><section><span></span></section><section><img data-imgfileid="100046983" data-ratio="0.7768518518518519" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnEn0ricibQHUlm8vnibUE0m6Licia92mibEMppzZTdxDJv1RGiaBGMT2ne8mNA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6lvEZqQB3icicebDdOg3c4QcnEn0ricibQHUlm8vnibUE0m6Licia92mibEMppzZTdxDJv1RGiaBGMT2ne8mNA/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section><span>好啦，今日分享毕！</span></section><section><span><br mpa-from-tpl="t"></span></section><section data-mpa-template="t" mpa-from-tpl="t"><section data-mpa-template="t" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><br></section><section data-mid="" mpa-from-tpl="t"><section data-mid="" mpa-from-tpl="t"><p data-mid="" mpa-is-content="t"><span>参考资料</span></p></section></section></section></section></section></section><p><br></p><section><span>https://yulab-smu.top/biomedical-knowledge-mining-book/clusterprofiler-kegg.html</span></section><section><span><br></span></section><section><span><br></span></section><p><strong><span>*未经许可，不得以任何方式复制或抄袭本篇文章之部分或全部内容。版权所有，侵权必究。</span></strong></p><p><br></p><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="105648"><section><section data-role="outer" label="Powered by 135editor.com"><section data-role="paragraph"><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="105648"><section><section><img data-ratio="0.8780487804878049" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJE8VibmibGU0Jxic9iabARVRH0FT6BNE8VAglWFXBPibFAU7a6tWGibSs8wyUg/640?wx_fmt=png" data-type="png" data-w="41" data-width="100%" data-imgfileid="100047104" src="https://mmbiz.qpic.cn/sz_mmbiz_png/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJE8VibmibGU0Jxic9iabARVRH0FT6BNE8VAglWFXBPibFAU7a6tWGibSs8wyUg/640?wx_fmt=png"></section><section><section><section data-width="35%"><section><section data-width="100%"><img data-imgfileid="100047103" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEv5etCBwHicqbEPwnVrkpaasxqaVibM4mT2JdIuN6yTlYWDD4mL5A427A/640?wx_fmt=jpeg" data-type="jpeg" data-w="860" data-width="100%" title="SCIPainter 30cm二维码.jpg" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEv5etCBwHicqbEPwnVrkpaasxqaVibM4mT2JdIuN6yTlYWDD4mL5A427A/640?wx_fmt=jpeg"></section></section></section><section data-width="50%"><section><section data-brushtype="text"><span><strong># SCIPainter</strong></span></section><section data-brushtype="text" hm_fix="361:593"><p>基迪奥旗下绘图公众号</p><p>分享科研绘图技能与工具</p><p>欢迎关注与转发~</p></section></section></section></section></section></section></section></section></section></section><section><br></section></section></section><section data-role="paragraph"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEgMd0aMPtmrDjiaX8sBhfhicVteeHf1JicexSpUbS3fdS9SiboUVN7guaPw/640?wx_fmt=gif" data-type="gif" data-w="400" data-imgfileid="100047102" src="https://mmbiz.qpic.cn/sz_mmbiz_gif/tgUVxVRjT6kCKJYcEqEIfoJYG621mPJEgMd0aMPtmrDjiaX8sBhfhicVteeHf1JicexSpUbS3fdS9SiboUVN7guaPw/640?wx_fmt=gif"></section></section></section><section><section powered-by="xiumi.us"><section><p><span><strong>你的好友拍了拍你</strong></span></p><p><span><strong>并请你帮她点一下</strong></span><strong><span>“分享”</span></strong><span><strong><span>~</span></strong></span></p></section></section></section></section></section><p><br></p></section></section><section><span><br></span></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/URe4jXkp26o-RhNz-sybNQ",target="_blank" rel="noopener noreferrer">原文链接</a>
