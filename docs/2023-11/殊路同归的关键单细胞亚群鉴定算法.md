---
title: "殊路同归的关键单细胞亚群鉴定算法"
date: 2023-11-01T10:35:15Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
殊路同归的关键单细胞亚群鉴定算法 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>前面我们介绍了正向鉴定关键单细胞亚群的流程，就是首先降维聚类分群然后看哪个亚群是有临床意义，详见：</p></blockquote><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526007&amp;idx=1&amp;sn=cf7e7a308ea1b968a36f7921d8aa6462&amp;scene=21#wechat_redirect" data-linktype="2">关键单细胞亚群辅助判定之生存分析</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526014&amp;idx=2&amp;sn=56f7e054b33d14e344454fd991459270&amp;scene=21#wechat_redirect" data-linktype="2">最简单的统计学之取交集</a></section></li></ul><p data-tool="mdnice编辑器">同时也给出来了反向鉴定关键单细胞亚群的流程，就是发表在2021年Nature Biotechnology上的Scissor算法，它们的结果非常一致，说明了算法的可靠性，而且类似的算法还有一个发表在NAR的一篇算法文章《scAB detects multiresolution cell states with clinical significance by integrating single-cell genomics and bulk sequencing data》，DOI10.1093/nar/gkac1109</p><p data-tool="mdnice编辑器">因为我不是做算法开发的生信工程师，所以我没办法去给大家推理这两个软件背后的统计学原理或者代码底层架构，但是我用实例给出来了算法和运行和理解，而且我们可以从另外一个侧面来做同样的反向鉴定关键单细胞亚群，未必就不比这些发表在好的杂志上面的算法效果差！</p><h3 data-tool="mdnice编辑器"><span></span>首先载入前面的批量生存分析结果以及单细胞对象<span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br><span>library</span>(Seurat)<br><span>library</span>(preprocessCore)<br><span>library</span>(survival)<br><span>library</span>(survminer) <br><span>library</span>(ggstatsplot) <br><span>library</span>(remotes)<br><span># remotes::install_github("carmonalab/UCell")</span><br><span>library</span>(UCell)<br><br>load( file = <span>'../01-tcga_luad_from_xena/batch_cox_results.Rdata'</span>)<br>cox_results = as.data.frame(cox_results)<br>cox_results=cox_results[order(cox_results$HR,decreasing = <span>T</span>),]<br><br>load(<span>'scRNA_for_scAB_Scissor.Rdata'</span>)<br>scRNA<br>table(scRNA$celltype)<br>p1=DimPlot(scRNA, reduction =<span>"umap"</span>, group.by=<span>"celltype"</span>,label = <span>T</span>)<br>p1<br>cox_results=cox_results[rownames(cox_results)%<span>in</span>% rownames(scRNA),]<br>cox_markers=list(<br>  pos = head(rownames(cox_results),<span>100</span>),<br>  neg = tail(rownames(cox_results),<span>100</span>)<br>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span>拿统计学显著的基因列表去单细胞打分<span></span></h3><p data-tool="mdnice编辑器">我们这里采取平平无奇的AddModuleScore_UCell函数即可：</p><pre data-tool="mdnice编辑器"><span></span><code>sc_dataset &lt;- AddModuleScore_UCell(scRNA, <br>                                   features = cox_markers) <br>signature.names &lt;- paste0(names(cox_markers), <span>"_UCell"</span>) <br>options(repr.plot.width=<span>6</span>, repr.plot.height=<span>4</span>)<br>colnames(sc_dataset@meta.data)<br>VlnPlot(sc_dataset, features = signature.names, <br>        <span>#group.by = "celltype", </span><br>        stack=<span>TRUE</span> ) + NoLegend()<br>FeaturePlot(sc_dataset,<span>'pos_UCell'</span>)<br>table(sc_dataset$pos_UCell&gt; <span>0</span>)<br>fivenum(sc_dataset$pos_UCell)<br>b1=table(sc_dataset$pos_UCell&gt; fivenum(sc_dataset$pos_UCell)[<span>4</span>],<br>      sc_dataset$celltype)<br>gplots::balloonplot(b1)<br>phe=sc_dataset@meta.data<br></code></pre><p data-tool="mdnice编辑器">很容易看到，那些风险基因在cycle亚群是打分很高，如下所示：</p><p><img data-galleryid="" data-ratio="0.4981481481481482" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyPx7pVCAJJdEGjTianD2vZFycicoMDfKd19tHQ4APelibUT8PR4xvNHWy0VaHy3diczyAYOdqqzFftlg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyPx7pVCAJJdEGjTianD2vZFycicoMDfKd19tHQ4APelibUT8PR4xvNHWy0VaHy3diczyAYOdqqzFftlg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>风险基因在cycle亚群是打分很高</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span>查看Scissor算法和打分结果一致性；<span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>load(file = <span>'output_of_Scissor.Rdata'</span>)  <br>sc_dataset<span>$pos_UCell</span> = phe<span>$pos_UCell</span><br>FeaturePlot(sc_dataset,<span>'pos_UCell'</span>,split.by =<span>'scissor'</span> )<br>sc_dataset<span>$neg_UCell</span> = phe<span>$neg_UCell</span><br>FeaturePlot(sc_dataset,<span>'neg_UCell'</span>,split.by =<span>'scissor'</span> )<br><br>table(sc_dataset<span>$celltype</span>)<br>table(sc_dataset<span>$scissor</span>)<br>b1=table(sc_dataset<span>$pos_UCell</span>&gt; fivenum(sc_dataset<span>$pos_UCell</span>)[4],<br>         sc_dataset<span>$scissor</span>)<br>gplots::balloonplot(b1)<br>boxplot(sc_dataset<span>$pos_UCell</span> ~ sc_dataset<span>$scissor</span>)<br><br></code></pre><p data-tool="mdnice编辑器">很容易看到，Scissor算法判定的阳性细胞就是富集了那些生存分析的风险基因的细胞亚群。</p><p><img data-galleryid="" data-ratio="0.46296296296296297" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyPx7pVCAJJdEGjTianD2vZFO87iayFLceWyiavjofeaByQfDUQBw5tJckTzSfSdCD21J8CG6YdylB8w/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyPx7pVCAJJdEGjTianD2vZFO87iayFLceWyiavjofeaByQfDUQBw5tJckTzSfSdCD21J8CG6YdylB8w/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>Scissor算法判定的阳性细胞就是富集了那些生存分析的风险基因的细胞亚群</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span>差异分析和生存分析结果交集<span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>#Idents(sc_dataset)= sc_dataset$scissor </span><br>deg_Scissor_markers &lt;- FindMarkers(sc_dataset, <br>                           ident.1 = <span>"Scissor+"</span>, <br>                           group.by = <span>'scissor'</span>, <br>                           logfc.threshold = <span>0.25</span> )<br><br>deg_Scissor_markers &lt;- deg_Scissor_markers[which(deg_Scissor_markers$p_val_adj&lt;<span>0.05</span>),]<br>head(deg_Scissor_markers)<br>cox_markers$up = rownames(deg_Scissor_markers)[deg_Scissor_markers$avg_log2FC&gt;<span>0</span>]<br>cox_markers$down = rownames(deg_Scissor_markers)[deg_Scissor_markers$avg_log2FC &lt; <span>0</span>]<br><br><span>require</span>(<span>"VennDiagram"</span>)<br>grid.newpage()<br>venn.plot &lt;- venn.diagram(cox_markers , <span>NULL</span>,<br>                          fill=c(<span>"red"</span>, <span>"blue"</span>,<span>'green'</span>,<span>'black'</span>),<br>                          alpha=c(<span>0.5</span>,<span>0.5</span>,<span>0.5</span>,<span>0.5</span>), cex = <span>2</span>, cat.fontface=<span>4</span>,<br>                          category.names= names(cox_markers),<br>                          main=<span>"venn.diagram"</span>)<br>grid.draw(venn.plot)<br><br>pdf(<span>'Scissor_select.venn.plot.pdf'</span>)<br>grid.draw(venn.plot)<br>dev.off()<br><br></code></pre><p data-tool="mdnice编辑器">也是非常漂亮的结果啦，Scissor算法判定的阳性细胞的高表达量基因绝大部分都是生存分析的风险基因啦。</p><p><img data-galleryid="" data-ratio="0.48518518518518516" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyPx7pVCAJJdEGjTianD2vZFYLjrTrv43mhWE4vGJvibPIBlsKBrm9mRB9oJMib3PvKSxAibaVTKI7xIg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyPx7pVCAJJdEGjTianD2vZFYLjrTrv43mhWE4vGJvibPIBlsKBrm9mRB9oJMib3PvKSxAibaVTKI7xIg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>非常漂亮的结果</figcaption></figure></section><h2 data-tool="mdnice编辑器">后记</h2><p data-tool="mdnice编辑器">我们按照文章的思路， 定位到了特殊的也就是具有统计学生存分析意义的亚群，详见：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247525924&amp;idx=1&amp;sn=aaa305d856a835adda2f842840b96ec2&amp;scene=21#wechat_redirect" data-linktype="2">换一个分析策略会导致文章的全部论点都得推倒重来吗</a>，但是也有其它思路可以拿到同样的结果。但是上面的代码已经是足够复杂啦，<strong>我们还是等待大家运行后我们先视频号答疑后，再分享后面的思路哈！代码会持续更新在这个链接哈，大家一定要抽空测试：</strong></p><pre data-tool="mdnice编辑器"><span></span><code>链接: https://pan.baidu.com/s/1geW1MTLRizcJWEESdjMN7g?<span>pwd</span>=96t6 提取码: 96t6<br></code></pre><p data-tool="mdnice编辑器"><strong>我们会在视频号直播互动答疑，欢迎预约我们的直播链接！</strong></p><section><mp-common-videosnap data-pluginname="mpvideosnap" data-headimgurl="https://wx.qlogo.cn/finderhead/PiajxSqBRaEI7scvWIPdECSfnUpSjTib9Y7RI14r1VVzxaA57PjcCERw/0" data-username="v2_060000231003b20faec8c7e1881bcad2ca06ec35b07788412aec898c89eb1e34f9a354475e8c@finder" data-nickname="生信技能树" data-desc="将在11月01日 18:00 直播" data-livewording="预约" data-intro="单细胞+生存分析" data-type="live" data-status="0" data-noticeid="finderlivenotice-v2_060000231003b20faec8c7e1881bcad2ca06ec35b07788412aec898c89eb1e34f9a354475e8c@finder-1698583822270546-1422988549" data-isdisabled="0" data-errortips=""></mp-common-videosnap></section><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247526014&amp;idx=1&amp;sn=44afb387fc49b89276386e5182db7bc9&amp;chksm=9b4b26c5ac3cafd35616b2fe9df7fea664e59d75e9970feb322a477beb222ac023f7daebb3dc&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授课（买一得‍五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247522831&amp;idx=2&amp;sn=1744efdf428465425a145ff3a982198b&amp;chksm=9b4bdab4ac3c53a28fbecbbff4f254f470b54a7a20468bb753b295b930315e1ec45bcbabc10b&amp;scene=21#wechat_redirect" textvalue="144线程640Gb内存服务器共享一年‍仍然是仅需800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">144线程640Gb内存服务器共享一年仍然是仅需800</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">千呼万唤始出来的独享生物信息学云服务器</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"></a><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524275&amp;idx=1&amp;sn=fa592ee29f636f34387491d0fceadd8e&amp;chksm=9b4bdf08ac3c561e0881974b3817beb0a0e514dc1a8df4c34c2b6653da6fa78e09acb03c70c2&amp;scene=21#wechat_redirect" textvalue="生信技能树知识整理实习生又又又开放申请啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信技能树知识整理实习生又又又开放申请啦</a><span><strong>（不招了，谢谢）</strong></span></section></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524432&amp;idx=1&amp;sn=5b33b0c6807a9e6939c332c58fabff89&amp;chksm=9b4b20ebac3ca9fdb3d8bfaf2bef5552f64eb70e7fae557cc7197fb1a23b3e8bc31b585bf829&amp;scene=21#wechat_redirect" textvalue="生信共享办公室出租" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信共享办公室出租</a></p></li></ul><p><br></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/aClaAQGbTXAuynTPdYUEdQ",target="_blank" rel="noopener noreferrer">原文链接</a>
