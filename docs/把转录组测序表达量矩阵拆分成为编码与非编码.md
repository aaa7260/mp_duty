---
title: "把转录组测序表达量矩阵拆分成为编码与非编码"
date: 2022-09-12T04:35:50Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
把转录组测序表达量矩阵拆分成为编码与非编码 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">上一讲我们留了下来一个思考题：需要解析 gencode.v22.annotation.gtf.gz 拿到每个基因对应的基因类型信息，现在我们就来演示这个过程。</p><p data-tool="mdnice编辑器">在其官网可以看到：https://www.gencodegenes.org/human/releases.html，这个文件有点旧了：</p><pre data-tool="mdnice编辑器"><span></span><code>	gencode.v22.annotation.gtf.gz	<span>2015</span>-<span>03</span>-<span>09</span> <span>12</span>:<span>21</span>	39M	 https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_22/gencode.v22.annotation.gtf.gz<br></code></pre><p data-tool="mdnice编辑器">我们可以使用 rtracklayer包的import函数来读取这个gencode.v22.annotation.gtf.gz文件，代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><span># BiocManager::install('rtracklayer')</span><br><span># 这个包依赖于很多其它包，比如：Rhtslib, rjson, XML, Biostrings, Rsamtools, GenomicAlignments, BiocIO, restfulr</span><br><span># 但是BiocManager::install会自动帮你安装它的依赖，所以非常方便</span><br><br>gtf = rtracklayer::import(<span>'gencode.v22.annotation.gtf.gz'</span>)<br>gtf_df = as.data.frame(gtf) <br><br>table(gtf_df$type)<br><span>##           gene     transcript           exon            CDS    start_codon </span><br><span>##          60483         198442        1172082         699443          82228 </span><br><span>##     stop_codon            UTR Selenocysteine </span><br><span>##          74337         276542            114</span><br><span>#</span><br></code></pre><p data-tool="mdnice编辑器">因为比较熟悉R里面的基础数据框结构，所以我们做了 as.data.frame(gtf)  操作，这样后续都是基础R语法。</p><p data-tool="mdnice编辑器">可以看到是6万多个基因，20万个左右的转录本 ，虽然计算起来平均是每个基因3个左右的转录本，其实有两个原因，1.可以看到表中因为外显子内含子的存在，会有一个gene_id对应多个transcript_id的情况，2.以及蛋白质编码基因会有多个转录本，而一般的基因其实大多就一个转录本。</p><pre data-tool="mdnice编辑器"><span></span><code>n =  unlist(lapply(split(gtf_df$transcript_id,gtf_df$gene_id), length))<br>fivenum(n)<br><span>##ENSG00000020219.9  ENSG00000260711.2  ENSG00000270961.1  ENSG00000169291.8 ##ENSG00000155657.22 </span><br><span>##                 3                  3                  4                 34           ##    4063 </span><br>fivenum(as.numeric(n))<br><span>##[1]    3    3    4   34 4063</span><br><br>df = na.omit(unique(gtf_df[,c(<span>'gene_id'</span>,<span>'transcript_id'</span>)]))  <span>#因为外显子内含子的存在，会有一个gene_id对应多个transcript_id的情况，我们先去重、去na</span><br>a = split(df$transcript_id,df$gene_id)<span>#根据gene_id切割transcript_id，就可以得到每个基因对应的转录本列表</span><br>n = unlist(lapply(split(df$transcript_id,df$gene_id), length))<span>#计算每个列表的长度，也就是每个基因对应了多少个转录本</span><br><br>fivenum(n)<br><span>##ENSG00000001561.6  ENSG00000234338.1  ENSG00000266899.1 </span><br><span>##                1                  1                  1 </span><br><span>##ENSG00000247157.5 ENSG00000179818.12 </span><br><span>##                3                170 </span><br>fivenum(as.numeric(n)) <br><span>##[1]   1   1   1   3 170</span><br><br><span>#蛋白编码基因的转录本数量：</span><br>gtf_por = gtf_df[gtf_df$gene_type ==<span>"protein_coding"</span>,]<br>df1 = na.omit(unique(gtf_por[,c(<span>'gene_id'</span>,<span>'transcript_id'</span>)])) <br>n1 = unlist(lapply(split(df1$transcript_id,df1$gene_id), length))<br>fivenum(n1)<br><span>##ENSG00000001561.6  ENSG00000044524.9 ENSG00000072832.13 </span><br><span>##                1                  3                  6 </span><br><span>##ENSG00000143363.14 ENSG00000205336.10 </span><br><span>##                10                 77 </span><br>fivenum(as.numeric(n1)) <br><span>##[1]  1  3  6 10 77</span><br><br></code></pre><p data-tool="mdnice编辑器">我们查看第一个基因DDX11L1 ，在gtf_df里面可以看到它有两个转录本 ：<img data-ratio="0.34797297297297297" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibC0O9FAxlhbI55aQOSicHV85pPdnic7BC7A6GB5z8BJFwicOhvxK2yNPW4MiariaibCQ3ibEbXQlKia9B81A/640?wx_fmt=png" data-type="png" data-w="888" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibC0O9FAxlhbI55aQOSicHV85pPdnic7BC7A6GB5z8BJFwicOhvxK2yNPW4MiariaibCQ3ibEbXQlKia9B81A/640?wx_fmt=png">在 ensembe数据库也可以查看它：https://grch37.ensembl.org/Homo_sapiens/Gene/Summary?db=core;g=ENSG00000223972;r=1:11869-14412 ，如下所示是4个转录本，上面的3个转录本都是类似的3个外显子组合而成，但是最后一个转录本是6个外显子。<img data-ratio="0.6011964107676969" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibC0O9FAxlhbI55aQOSicHV8lvbAgWWtprHkHX4SpMe3kpSRpPsicLeEB8C2cFFAoAwmY7m0CziaKCFQ/640?wx_fmt=png" data-type="png" data-w="1003" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibC0O9FAxlhbI55aQOSicHV8lvbAgWWtprHkHX4SpMe3kpSRpPsicLeEB8C2cFFAoAwmY7m0CziaKCFQ/640?wx_fmt=png"></p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>需要熟悉gtf文件的定义</span><span></span></h3><p data-tool="mdnice编辑器">很容易找到gtf包含的信息的中文介绍：</p><section data-tool="mdnice编辑器"><table><thead><tr><th>列</th><th>列名</th><th>包含的信息</th></tr></thead><tbody><tr><td>1</td><td>seq_id</td><td>序列的编号，一般为染色体号或者scaffold的号</td></tr><tr><td>2</td><td>source</td><td>注释的来源，一般为数据库或者注释的机构，如果是未知来源，用'.'代替</td></tr><tr><td>3</td><td>type</td><td>注释信息的类型，一般为Gene，cDNA，mRNA，CDS等</td></tr><tr><td>4</td><td>start</td><td>该基因或者转录本在参考序列上的起始位置</td></tr><tr><td>5</td><td>end</td><td>该基因或者转录本在参考序列上的终止位置</td></tr><tr><td>6</td><td>score</td><td>对注释信息的准确性进行打分，可以是序列比对时的相似性的份E-value，也可以是基因预测是的p-value</td></tr><tr><td>7</td><td>strand</td><td>仅该基因或者转录本位于参考序列的正链或者负链上</td></tr><tr><td>8</td><td>phase</td><td>该注释仅对CDs有效，仅对注释类型为“CDS”有效，表示起始编码的位置，有效值为0、1、2(对于编码蛋白质的CDS来说，本列指定下一个密码子开始的位置。每3个核苷酸翻译一个氨基酸，从0开始，CDS的起始位置，除以3，余数就是这个值，，表示到达下一个密码子需要跳过的碱基个数。该编码区第一个密码子的位置，取值0,1,2。0表示该编码框的第一个密码子第一个碱基位于其5'末端；1表示该编码框的第一个密码子的第一个碱基位于该编码区外；2表示该编码框的第一个密码子的第一、二个碱基位于该编码区外；如果Feature为CDS时，必须指明具体值。</td></tr><tr><td>9</td><td>attributes</td><td>不同属性的列表</td></tr></tbody></table></section><p data-tool="mdnice编辑器">我们下载的这个 这个 gencode.v22.annotation.gtf.gz文件 如下所示，可以看到第9列是  attributes 不同属性的列表 ，可以无限制扩充：<img data-ratio="0.5696296296296296" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibC0O9FAxlhbI55aQOSicHV87Me9GwgP2om2rsUb3mF0GtcgCh57XibQNUDgKeUCQkib2nKDWyu83CyA/640?wx_fmt=png" data-type="png" data-w="1350" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibC0O9FAxlhbI55aQOSicHV87Me9GwgP2om2rsUb3mF0GtcgCh57XibQNUDgKeUCQkib2nKDWyu83CyA/640?wx_fmt=png">这个 gencode.v22.annotation.gtf.gz文件被rtracklayer包的import函数读取后，成为了R里面的数据框，里面的列非常多，因为gtf的第9列被拆分了。所以我们做了 as.data.frame()  操作以后的gtf有27列。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>注释信息</span><span></span></h3><p data-tool="mdnice编辑器">可以看到type列有各种分类，这里也简单介绍一下：</p><h5 data-tool="mdnice编辑器"><span></span>基于转录本上的概念<span></span></h5><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">外显子和内含子：</p><p data-tool="mdnice编辑器">基因 DNA 分为编码区和非编码区，编码区包含外显子和内含子，一般非编码区具有基因表达的调控功能，如启动子在非编码区。编码区则转录为 mRNA 并最终翻译成蛋白质。</p><p data-tool="mdnice编辑器">外显子和内含子都被转录到 mRNA 前体 hnRNA 中，当 hnRNA 进行剪接变为成熟的 mRNA 时，内含子被切除，而外显子保留。实际上真正编码蛋白质的是外显子，而内含子则无编码功能。</p><p data-tool="mdnice编辑器">内含子存在于DNA 中，在转录的过程中，DNA 上的内含子也会被转录到前体 RNA 中，但前体 RNA 上的内含子会在 RNA 离开细胞核进行翻译前被切除。</p><p data-tool="mdnice编辑器"><code>promoter</code>不属于intron和exon的任何一个，属于noncoding sequence.</p><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">开放读码框ORF</p><p data-tool="mdnice编辑器">开放读码框是从一个起始密码子开始到一个终止密码子结束的一段序列；不是所有读码框都能被表达出蛋白产物，或者能表达出占有优势或者能产生生物学功能的蛋白。内含子和外显子指的就是一个开放阅读框（ORF）内编码的部分和不编码的部分。</p><h5 data-tool="mdnice编辑器"><span></span>基于翻译上的概念<span></span></h5><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">mRNA 包括 UTR 和 CDS</p><p data-tool="mdnice编辑器">UTR：UTR,Untranslated Regions一班指的是一个转录本（transcript）3'和5'不参与编码的区域即非翻译区，是信使RNA（mRNA）分子两端的非编码片段。UTR区不参与编码，但是不是说他们没有功能，只是不被翻译成具有功能的蛋白质。多数基因都有UTR,它们也是外显子拼接的产物。UTR在DNA序列中是算外显子的区域。</p><p data-tool="mdnice编辑器">CDS：CDS,Sequencecodingfor aminoacids in protein 蛋白质编码区 ，CDS 是 Coding sequence的缩写，是编码一段蛋白产物的序列，CDS 必定是一个 ORF 。但也可能包括很多 ORF 。反之，每个 ORF 不一定都是 CDS 。</p><p data-tool="mdnice编辑器">外显子与 CDS 区不是完全一致的，CDS 区一定属于外显子，但是外显子不一定是 CDS 区，也就是说外显子不一定都能翻译成蛋白。</p><p data-tool="mdnice编辑器"><code>三张图片帮助理解</code></p><figure data-tool="mdnice编辑器"><img data-ratio="0.43951612903225806" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosibC0O9FAxlhbI55aQOSicHV8Xnjfhwnn6ibeu9QBzy9ztpp6iaibWB0z0n3DoVUn1ub6N71GiaKjGzblaQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1984" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosibC0O9FAxlhbI55aQOSicHV8Xnjfhwnn6ibeu9QBzy9ztpp6iaibWB0z0n3DoVUn1ub6N71GiaKjGzblaQ/640?wx_fmt=jpeg"><figcaption><span></span>图1</figcaption></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.41846153846153844" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosibC0O9FAxlhbI55aQOSicHV8ibN5j5Zdsn4D5KToYeqrHRKLRiaqwOe41vb25qu8yljhibTRlziavsqvnw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1300" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosibC0O9FAxlhbI55aQOSicHV8ibN5j5Zdsn4D5KToYeqrHRKLRiaqwOe41vb25qu8yljhibTRlziavsqvnw/640?wx_fmt=jpeg"><figcaption><span></span>图2</figcaption></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.5462392108508015" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosibC0O9FAxlhbI55aQOSicHV8icxlMsjpdX9QicEXs04TA7ibsVKpicuZsmm36sicWkGzz2ak1y6U7pmaUJw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1622" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosibC0O9FAxlhbI55aQOSicHV8icxlMsjpdX9QicEXs04TA7ibsVKpicuZsmm36sicWkGzz2ak1y6U7pmaUJw/640?wx_fmt=jpeg"><figcaption><span></span>图3</figcaption></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong>「外显子和内含子是转录本上面的概念，是基于转录这个行为的定义。」</strong></p><p><strong>「而5端UTR区域和CDS区域，还有3端UTR区域,是基于翻译这种行为的定义！」</strong></p><span>❞</span></blockquote><p data-tool="mdnice编辑器">再附加一张图：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.15975103734439833" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibC0O9FAxlhbI55aQOSicHV8uFjr6HMzgZZFFohkUcKic0jfdQS2wwbmUAYr5ibLJEnRUgcuNuD3g6Pw/640?wx_fmt=png" data-type="png" data-w="482" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosibC0O9FAxlhbI55aQOSicHV8uFjr6HMzgZZFFohkUcKic0jfdQS2wwbmUAYr5ibLJEnRUgcuNuD3g6Pw/640?wx_fmt=png"><figcaption><span></span>img</figcaption></figure><p data-tool="mdnice编辑器">我们把属于基因的信息拿出来：</p><pre data-tool="mdnice编辑器"><span></span><code>gene = gtf_df[gtf_df$type=="gene",]<br>head(gene)<br>##    seqnames start   end width strand  source type score phase           gene_id<br>## 1      chr1 11869 14409  2541      +  HAVANA gene    NA    NA ENSG00000223972.5<br>## 13     chr1 14404 29570 15167      -  HAVANA gene    NA    NA ENSG00000227232.5<br>## 26     chr1 17369 17436    68      - ENSEMBL gene    NA    NA ENSG00000278267.1<br>## 29     chr1 29554 31109  1556      +  HAVANA gene    NA    NA ENSG00000243485.3<br>## 37     chr1 30366 30503   138      + ENSEMBL gene    NA    NA ENSG00000274890.1<br>## 40     chr1 34554 36081  1528      -  HAVANA gene    NA    NA ENSG00000237613.2<br>##                             gene_type gene_status    gene_name level<br>## 1  transcribed_unprocessed_pseudogene       KNOWN      DDX11L1     2<br>## 13             unprocessed_pseudogene       KNOWN       WASH7P     2<br>## 26                              miRNA       KNOWN    MIR6859-3     3<br>## 29                            lincRNA       NOVEL RP11-34P13.3     2<br>## 37                              miRNA       KNOWN    MIR1302-9     3<br>## 40                            lincRNA       KNOWN      FAM138A     2<br>##             havana_gene transcript_id transcript_type transcript_status<br>## 1  OTTHUMG00000000961.2          &lt;NA&gt;            &lt;NA&gt;              &lt;NA&gt;<br>## 13 OTTHUMG00000000958.1          &lt;NA&gt;            &lt;NA&gt;              &lt;NA&gt;<br>## 26                 &lt;NA&gt;          &lt;NA&gt;            &lt;NA&gt;              &lt;NA&gt;<br>## 29 OTTHUMG00000000959.2          &lt;NA&gt;            &lt;NA&gt;              &lt;NA&gt;<br>## 37                 &lt;NA&gt;          &lt;NA&gt;            &lt;NA&gt;              &lt;NA&gt;<br>## 40 OTTHUMG00000000960.1          &lt;NA&gt;            &lt;NA&gt;              &lt;NA&gt;<br>##    transcript_name        tag transcript_support_level havana_transcript<br>## 1             &lt;NA&gt;       &lt;NA&gt;                     &lt;NA&gt;              &lt;NA&gt;<br>## 13            &lt;NA&gt;       &lt;NA&gt;                     &lt;NA&gt;              &lt;NA&gt;<br>## 26            &lt;NA&gt;       &lt;NA&gt;                     &lt;NA&gt;              &lt;NA&gt;<br>## 29            &lt;NA&gt; ncRNA_host                     &lt;NA&gt;              &lt;NA&gt;<br>## 37            &lt;NA&gt;       &lt;NA&gt;                     &lt;NA&gt;              &lt;NA&gt;<br>## 40            &lt;NA&gt;       &lt;NA&gt;                     &lt;NA&gt;              &lt;NA&gt;<br>##    exon_number exon_id  ont protein_id ccdsid<br>## 1         &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;<br>## 13        &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;<br>## 26        &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;<br>## 29        &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;<br>## 37        &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;<br>## 40        &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;<br></code></pre><p data-tool="mdnice编辑器">就可以拿到gene_id和gene_name的对应关系：</p><pre data-tool="mdnice编辑器"><span></span><code>colnames(gene)<br>##  [1] "seqnames"                 "start"                   <br>##  [3] "end"                      "width"                   <br>##  [5] "strand"                   "source"                  <br>##  [7] "type"                     "score"                   <br>##  [9] "phase"                    "gene_id"                 <br>## [11] "gene_type"                "gene_status"             <br>## [13] "gene_name"                "level"                   <br>## [15] "havana_gene"              "transcript_id"           <br>## [17] "transcript_type"          "transcript_status"       <br>## [19] "transcript_name"          "tag"                     <br>## [21] "transcript_support_level" "havana_transcript"       <br>## [23] "exon_number"              "exon_id"                 <br>## [25] "ont"                      "protein_id"              <br>## [27] "ccdsid"<br><br>ensembID2type = gene[,c("gene_id","gene_name")]<br>head(ensembID2type)<br>##              gene_id    gene_name<br>## 1  ENSG00000223972.5      DDX11L1<br>## 13 ENSG00000227232.5       WASH7P<br>## 26 ENSG00000278267.1    MIR6859-3<br>## 29 ENSG00000243485.3 RP11-34P13.3<br>## 37 ENSG00000274890.1    MIR1302-9<br>## 40 ENSG00000237613.2      FAM138A<br><br>write.table(ensembID2type,file = 'ensembID2type.txt')<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>基因类型</span><span></span></h3><p data-tool="mdnice编辑器">以及每个基因对应的基因类型信息，也就是我们上次说的ensembID2type.txt：</p><pre data-tool="mdnice编辑器"><span></span><code>gene_type = gene[,c("gene_name","gene_type")]<br>head(gene_type)<br>##       gene_name                          gene_type<br>## 1       DDX11L1 transcribed_unprocessed_pseudogene<br>## 13       WASH7P             unprocessed_pseudogene<br>## 26    MIR6859-3                              miRNA<br>## 29 RP11-34P13.3                            lincRNA<br>## 37    MIR1302-9                              miRNA<br>## 40      FAM138A                            lincRNA<br><br>as.data.frame(tail(sort(table(gene_type$gene_type))))<br></code></pre><p data-tool="mdnice编辑器">拿出蛋白质编码基因名和长非编码基因名：</p><pre data-tool="mdnice编辑器"><span></span><code>protein_gene = gene_type$gene_name[gene_type$gene_type=="protein_coding"]<br><br>lnc &lt;- c("3prime_overlapping_ncRNA", "antisense", <br>         "lincRNA", "macro_lncRNA", "non_coding",<br>         "sense_intronic" , "sense_overlapping")<br>lnc_gene = gene_type$gene_name[gene_type$gene_type %in% lnc]<br><br></code></pre><p data-tool="mdnice编辑器">就可以从我们之前预处理的LAML表达量矩阵拿出蛋白质编码基因和长非编码基因的表达量矩阵了：</p><pre data-tool="mdnice编辑器"><span></span><code>protein_dat &lt;- dat[protein_gene,]<br>lnc_dat &lt;- dat[lnc_gene,]<br>save(lnc_dat, <br>     protein_dat, <br>     file = 'output/rdata/0.lnc_protein_expression_data.Rdata')<br></code></pre></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/BO3olxxbPbHEdazUiyRh1A",target="_blank" rel="noopener noreferrer">原文链接</a>
