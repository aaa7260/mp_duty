---
title: "qPCR验证完RNAseq数据后做个条形图"
date: 2022-09-18T23:43:41Z
draft: ["false"]
tags: [
  "fetched",
  "猪猪生信"
]
categories: ["Acdemic"]
---
qPCR验证完RNAseq数据后做个条形图 by 猪猪生信
------
<div><section>在公众号内，回复<span><strong>学习资源</strong></span><span>，获得惊喜喔</span></section><section><mpprofile data-pluginname="mpprofile" data-id="MzkyNDE5ODAyNA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/hlasRQiaooRzYLYjkyvLNQuMich74jXmia2QnSkZkYwWZyAmMiaVbXWAXhtQ0lgW9eaUPqStNCRQBf3eFrV71IMBOg/0?wx_fmt=png" data-nickname="猪猪生信" data-alias="Piglet-BioInfo" data-signature="欢迎关注交流，猪猪生信主要分享R语言绘图技巧，Linux多组学测序数据上游分析，可在公众号内提问，一起学习进步吧！" data-from="0"></mpprofile></section><section><p>普通转录组测序数据做完后, 一般都需要挑基因做下荧光定量PCR的验证, 下面是在你做完qPCR得到验证数据后, 联合RNAseq数据画个图</p><h2><span>读入测试数据</span></h2><p>测试数据一共有三列, 第一列为log2FC, 第二列是基因名,第三列是数据类型(rna为测序数据, qpcr为荧光定量pcr的实验验证数据), 测试数据存储在excel表格中</p><pre><code><span>#</span><span> 加载R包</span><br>library(tidyverse)<br>library(openxlsx)<br><span><br>#</span><span> 读入测试数据</span><br>dat &lt;- read.xlsx("./testData.xlsx") %&gt;% <br>  arrange(desc(log2FC)) %&gt;% <br>  mutate(gene=fct_inorder(gene))<br><span><br>#</span><span> 查看数据</span><br>head(dat)<br><span>#</span><span>&gt;&gt;&gt;     log2FC    gene <span>type</span></span><br><span>#</span><span>&gt;&gt;&gt; 1 3.258473 gene_13 qpcr</span><br><span>#</span><span>&gt;&gt;&gt; 2 3.018859 gene_13  rna</span><br><span>#</span><span>&gt;&gt;&gt; 3 2.162413  gene_3 qpcr</span><br><span>#</span><span>&gt;&gt;&gt; 4 1.814188  gene_3  rna</span><br><span>#</span><span>&gt;&gt;&gt; 5 1.398031  gene_7  rna</span><br><span>#</span><span>&gt;&gt;&gt; 6 1.270967  gene_1 qpcr</span><br><span><br>table(dat$</span><span><span>type</span>)</span><br><span>#</span><span>&gt;&gt;&gt; </span><br><span>#</span><span>&gt;&gt;&gt; qpcr  rna </span><br><span>#</span><span>&gt;&gt;&gt;   13   13</span><br></code></pre><h2><span>绘图</span></h2><pre><code><span># 选取颜色</span><br>library(MetBrewer)<br><span>MetBrewer::display_all()</span><br></code></pre><p><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/hlasRQiaooRwEx792Mpu7XFt5V2ko4EtY79dx9Kr2766S2iaI0aEZb8CBthtiaef0VFHMhH432pmQHbBBDe0NX3HQ/640?wx_fmt=png" data-type="png" data-w="672" height="85%" width="75%" src="https://mmbiz.qpic.cn/mmbiz_png/hlasRQiaooRwEx792Mpu7XFt5V2ko4EtY79dx9Kr2766S2iaI0aEZb8CBthtiaef0VFHMhH432pmQHbBBDe0NX3HQ/640?wx_fmt=png"></p><pre><code>colors <span>&lt;<span>-</span> <span>MetBrewer::met.brewer</span>("<span>Egypt</span>",<span>2</span>)<br><br># 绘图<br><span>ggplot</span>(<span>dat</span>) +<br>  <span>geom_bar</span>(<span>aes</span>(<span>gene</span>, <span>log2FC</span>, <span>fill</span> = <span>type),</span> <span>stat</span> = <span>"identity"</span>,<span>position</span> = <span>position_dodge(),</span> <span>width</span>=<span>0.75)</span> +<br>  <span>scale_fill_manual</span>(<span>labels</span> = <span>c(</span>"<span>qRT-PCR</span>","<span>RNA-seq</span>"),<br>                     <span>values</span> =<span>colors)</span> + #  <span>c</span>("#<span>82ccdd</span>", "#<span>b8e994</span>")<br>  <span>labs</span>(<span>x</span>=<span>""</span>,<span>y</span>=<span>"log2 (Fold Change)"</span>) +<br>  <span>geom_hline</span>(<span>yintercept</span> = <span>0,size</span>=<span>.75)+</span><br>  <span>theme_classic</span>(<span>base_size</span> = <span>14)</span> +<br>  <span>theme</span>(<span>legend.title</span> = <span>element_blank(),</span><br>        <span>axis.line.x</span>=<span>element_line(linetype</span> = <span>"solid"</span>,<span>size</span>=<span>1),</span><br>        <span>axis.text</span>=<span>element_text(angle</span> = <span>90))</span><br></span></code></pre><p><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/hlasRQiaooRwEx792Mpu7XFt5V2ko4EtY3fHgdvoral6saYTSvaicGbD0Y2Dt0iaUDn7gP944RYEYQmZcVTnoLxYw/640?wx_fmt=png" data-type="png" data-w="672" height="85%" width="75%" src="https://mmbiz.qpic.cn/mmbiz_png/hlasRQiaooRwEx792Mpu7XFt5V2ko4EtY3fHgdvoral6saYTSvaicGbD0Y2Dt0iaUDn7gP944RYEYQmZcVTnoLxYw/640?wx_fmt=png"></p><h2><span>添加相关性和pvalue</span></h2><pre><code><span># 计算相关性<br>cdat <span>&lt;<span>-</span> <span>dat</span> %&gt;</span>%  pivot_wider(names_from = type, values_from = log2FC)<br>cor_result <span>&lt;<span>-</span> <span>cor.test</span>(<span>cdat</span>$<span>qpcr</span>,<span>cdat</span>$<span>rna</span>)<br><span>p_value</span> &lt;<span>-</span> <span>cor_result</span>$<span>p.value</span><br><span>cor_value</span> &lt;<span>-</span> <span>cor_result</span>$<span>estimate</span><br><br><br># 添加到图上<br><span>text</span> &lt;<span>-</span> <span>paste0</span>("<span>R</span>=<span>",signif(cor_value,4),"</span>\<span>n</span>",<br>               "<span>P</span>=<span>",signif(p_value,4))<br>text<br>#&gt;&gt;&gt; [1] "</span><span>R</span>=<span>0.9198\nP</span>=<span>8.572e-06</span>"<br><br><span>ggplot</span>(<span>dat</span>) +<br>  <span>geom_bar</span>(<span>aes</span>(<span>gene</span>, <span>log2FC</span>, <span>fill</span> = <span>type),</span> <span>stat</span> = <span>"identity"</span>,<span>position</span> = <span>position_dodge(),</span> <span>width</span>=<span>0.75)</span> +<br>  <span>scale_fill_manual</span>(<span>labels</span> = <span>c(</span>"<span>qRT-PCR</span>","<span>RNA-seq</span>"),<br>                     <span>values</span> =<span>colors)</span> + #  <span>c</span>("#<span>82ccdd</span>", "#<span>b8e994</span>")<br>  <span>labs</span>(<span>x</span>=<span>""</span>,<span>y</span>=<span>"log2 (Fold Change)"</span>) +<br>  # 添加相相关性和<span>pvale</span><br>  <span>annotate</span>("<span>text</span>",<span>label</span>=<span>text,x</span>=<span>6,</span> <span>y</span>=<span>2.5,</span> <span>size</span>=<span>5)</span> +<br>  <span>geom_hline</span>(<span>yintercept</span> = <span>0,size</span>=<span>.75)+</span><br>  <span>theme_classic</span>(<span>base_size</span> = <span>14)</span> +<br>  <span>theme</span>(<span>legend.title</span> = <span>element_blank(),</span><br>        <span>axis.line.x</span>=<span>element_line(linetype</span> = <span>"solid"</span>,<span>size</span>=<span>1),</span><br>        <span>axis.text</span>=<span>element_text(angle</span> = <span>90))</span><br></span></span></code></pre><p><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/hlasRQiaooRwEx792Mpu7XFt5V2ko4EtYTQOIaM89LsPfvrsdotYbI7tcyWib2iaM64eoJiaXlicva5iaRwyvg3jX8jw/640?wx_fmt=png" data-type="png" data-w="672" height="85%" width="75%" src="https://mmbiz.qpic.cn/mmbiz_png/hlasRQiaooRwEx792Mpu7XFt5V2ko4EtYTQOIaM89LsPfvrsdotYbI7tcyWib2iaM64eoJiaXlicva5iaRwyvg3jX8jw/640?wx_fmt=png"></p></section><section><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkyNDE5ODAyNA==&amp;mid=2247485229&amp;idx=1&amp;sn=ee3f54859d973e3e14430b1aa06252a4&amp;chksm=c1d832caf6afbbdcc204efb66b172d4b715d4c7181d5f7371704470614bfb7b9385f948836ae&amp;scene=21#wechat_redirect" textvalue="遇到报错就该这么解决" linktype="image" imgurl="http://mmbiz.qpic.cn/mmbiz_jpg/hlasRQiaooRyuWWVjxNCoZxnq5zcibkfvbXpmT3lse52sT0dvsBfWIjrm4YOia4rVbRiaLvfEIOGwPoJ9WDT0JqxNw/0?wx_fmt=jpeg" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="1"><span data-positionback=""><img data-ratio="0.562962962962963" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/hlasRQiaooRyuWWVjxNCoZxnq5zcibkfvbXpmT3lse52sT0dvsBfWIjrm4YOia4rVbRiaLvfEIOGwPoJ9WDT0JqxNw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/hlasRQiaooRyuWWVjxNCoZxnq5zcibkfvbXpmT3lse52sT0dvsBfWIjrm4YOia4rVbRiaLvfEIOGwPoJ9WDT0JqxNw/640?wx_fmt=jpeg"></span></a><br></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/yBCnMDvKuLaQ3GO1u85cqQ",target="_blank" rel="noopener noreferrer">原文链接</a>
