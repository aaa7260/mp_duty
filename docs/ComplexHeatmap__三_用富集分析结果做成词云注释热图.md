---
title: "ComplexHeatmap| 三、用富集分析结果做成词云注释热图"
date: 2022-12-06T00:25:05Z
draft: ["false"]
tags: [
  "fetched",
  "Biomamba 生信基地"
]
categories: ["Acdemic"]
---
ComplexHeatmap| 三、用富集分析结果做成词云注释热图 by Biomamba 生信基地
------
<div><section data-support="96编辑器" data-style-id="37514"><section><section><img data-ratio="1.1363636363636365" data-w="44" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9ed4OicicNpFsBE32ZzDUWcVJvdWPHICYQiaId4w7UggxaJBOrrGpqhoiciag/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9ed4OicicNpFsBE32ZzDUWcVJvdWPHICYQiaId4w7UggxaJBOrrGpqhoiciag/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section><section><section><span><strong>零、写在前面</strong></span></section><p><span>其实原作者已经开发出了<span>anno_GO_keywords()</span></span>，<span>一方面这个功能还在调试中(<span>https://github.com/jokergoo/KeywordsEnrichment</span>)；另一方面<span>anno_GO_keywords()</span>只支持GO富集分析大家肯定也有做KEGG注释的需求，因此我就DIY了这么一个流程，可以在热图中以词云的形式</span><strong><span>注释</span></strong><span>上基因群</span><span><strong>富集分析</strong></span><span>的结果，并且可以按照富集的</span><strong><span>显著性调整字体大小</span></strong><span>。</span></p><p><span><br></span></p><section><span><strong><span>测试文件下载链接：</span></strong></span><br></section><p><span>不要再说我的链接失效啦，我也不知道为啥腾讯和百度云不对付，微信页面或腾讯浏览器时常打不开百度云链接，链接最好在谷歌浏览器中打开，真的失效了再提醒客服更换链接哦。也不要说我的链接里没代码，html格式的文件大家用浏览器打开就可以看到整理好的笔记。</span></p><p><img data-galleryid="" data-ratio="0.1477900552486188" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpxGcqzMicTLlUTjppEDY3HcAeRI8eS1xicAFEqTFV29tgduzj5nibrhuxcs2xicCD6gbyF9ptSX9liaI3w/640?wx_fmt=png" data-type="png" data-w="724" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpxGcqzMicTLlUTjppEDY3HcAeRI8eS1xicAFEqTFV29tgduzj5nibrhuxcs2xicCD6gbyF9ptSX9liaI3w/640?wx_fmt=png"></p><p><strong><span>https://pan.baidu.com/s/1QU2gNom74wdBf3fnwT-QyQ?pwd=g5ef </span></strong></p><p><img data-galleryid="" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ImlBFVOwwpxGcqzMicTLlUTjppEDY3HcA6KrwHicxexJmcbABr2ITQx0hEW3XrkkYoeaQ7zhggKvicowTSg4gPa4w/640?wx_fmt=jpeg" data-type="png" data-w="280" src="https://mmbiz.qpic.cn/mmbiz_jpg/ImlBFVOwwpxGcqzMicTLlUTjppEDY3HcA6KrwHicxexJmcbABr2ITQx0hEW3XrkkYoeaQ7zhggKvicowTSg4gPa4w/640?wx_fmt=jpeg"></p><section><span><br></span></section></section></section></section><section><img data-ratio="0.5763888888888888" data-w="144" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9etbHzsrN4I3YbicBP43PrF8o6hJDBnmPVKVqLr4mMico1SSzwQviaolWAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9etbHzsrN4I3YbicBP43PrF8o6hJDBnmPVKVqLr4mMico1SSzwQviaolWAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section></section><section><br></section><section data-support="96编辑器" data-style-id="37514"><section><section><img data-ratio="1.1363636363636365" data-w="44" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9ed4OicicNpFsBE32ZzDUWcVJvdWPHICYQiaId4w7UggxaJBOrrGpqhoiciag/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9ed4OicicNpFsBE32ZzDUWcVJvdWPHICYQiaId4w7UggxaJBOrrGpqhoiciag/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section><section><section><span><strong>一、基本数据情况</strong></span></section><section><span>这是一个normalized后的RNA-Seq表达矩阵，正好可以用来做此次的练习数据。</span></section><pre><section><code><span><span>#数据：</span></span><br><span>mydata <span>&lt;-</span> <span>read.csv</span>(<span>'mydata.csv'</span>,<span>header =</span> T,<span>row.names =</span> <span>1</span>)</span><br><span><span>head</span>(mydata)</span></code></section></pre><pre><section><code>##             GroupA_1  GroupA_2  GroupA_3  GroupB_1  GroupB_2  GroupB_3<br>## Tbc1d19     7.749670  7.934043  7.785975  7.886533  6.771363  7.735374<br>## Cfc1        2.010601  2.023136  2.063938  3.473182  2.079826  2.448522<br>## Foxo3       5.173732  5.356384  5.217325  5.392354  5.810170  6.120307<br>## Spag9       7.747689  7.870940  7.996499  7.491094  7.949187  7.735845<br>## RGD1311899 11.910350 11.832828 11.772460 11.628933 12.640646 12.273074<br>## Olr390      7.750523  7.739519  7.860533  8.587599  8.408102  7.996499</code></section></pre><pre><section><code><span><span>#分组信息就藏在样本名里啦：</span></span><br><span><span>library</span>(dplyr)</span></code></section></pre><pre><section><code>## <br>## 载入程辑包：'dplyr'</code></section></pre><pre><section><code>## The following objects are masked from 'package:stats':<br>## <br>##     filter, lag</code></section></pre><pre><section><code>## The following objects are masked from 'package:base':<br>## <br>##     intersect, setdiff, setequal, union</code></section></pre><pre><section><code><span>group4diff <span>&lt;-</span> <span>strsplit</span>(<span>colnames</span>(mydata),<span>'_'</span>)  <span>%&gt;%</span> </span><br><span>   <span>lapply</span>(., <span>function</span>(x){<span>unlist</span>(x)[<span>1</span>]}) <span>%&gt;%</span> <span>unlist</span>()</span><br><span>group4diff</span></code></section></pre><pre><section><code>## [1] "GroupA" "GroupA" "GroupA" "GroupB" "GroupB" "GroupB"</code></section></pre></section></section></section><section><img data-ratio="0.5763888888888888" data-w="144" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9etbHzsrN4I3YbicBP43PrF8o6hJDBnmPVKVqLr4mMico1SSzwQviaolWAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9etbHzsrN4I3YbicBP43PrF8o6hJDBnmPVKVqLr4mMico1SSzwQviaolWAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section></section><section><br></section><section data-support="96编辑器" data-style-id="37514"><section data-support="96编辑器" data-style-id="37514"><section><section><img data-ratio="1.1363636363636365" data-w="44" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9ed4OicicNpFsBE32ZzDUWcVJvdWPHICYQiaId4w7UggxaJBOrrGpqhoiciag/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9ed4OicicNpFsBE32ZzDUWcVJvdWPHICYQiaId4w7UggxaJBOrrGpqhoiciag/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section><section><section><span><strong>二、差异分析</strong></span></section><pre><section><code><span><span>library</span>(limma)</span><br><span>mod <span>&lt;-</span> <span>model.matrix</span>(<span>~</span> <span>factor</span>(group4diff))</span><br><span>  <span>colnames</span>(mod) <span>&lt;-</span> <span>c</span>(<span>unique</span>(group4diff)[<span>1</span>], </span><br><span>                     <span>paste0</span>(<span>unique</span>(group4diff)[<span>1</span>],<span>'_vs_'</span>,</span><br><span>                            <span>unique</span>(group4diff)[<span>2</span>]))</span><br><span>  <span>colnames</span>(mod)</span></code></section></pre><pre><section><code>## [1] "GroupA"           "GroupA_vs_GroupB"</code></section></pre><pre><section><code><span>  fit <span>&lt;-</span> <span>lmFit</span>(mydata, mod)</span><br><span>  fit <span>&lt;-</span> <span>eBayes</span>(fit)</span><br><span>  res <span>&lt;-</span> <span>decideTests</span>(fit, <span>p.value=</span><span>0.01</span>)</span><br><span>  <span>summary</span>(res)</span></code></section></pre><pre><section><code>##        GroupA GroupA_vs_GroupB<br>## Down        0             1912<br>## NotSig     52            16479<br>## Up      20218             1879</code></section></pre><pre><section><code><span>  tt <span>&lt;-</span> <span>topTable</span>(fit, <span>coef=</span><span>2</span>, <span>n=</span><span>Inf</span>)</span><br><span>  <span>head</span>(tt)</span></code></section></pre><pre><section><code>##              logFC   AveExpr         t      P.Value    adj.P.Val        B<br>## Lipg      5.981587  4.929710  99.85876 9.574700e-10 1.940792e-05 11.06382<br>## Pde6a.1   6.264585  5.045929  81.06664 2.831943e-09 2.870174e-05 10.72319<br>## Adra1b    7.916472  8.844697  65.71015 8.440524e-09 4.610638e-05 10.26517<br>## Lgi2     -5.866347  4.905960 -64.76827 9.098446e-09 4.610638e-05 10.22902<br>## Tmem9     4.004675  9.735786  60.08272 1.344310e-08 4.700143e-05 10.03094<br>## Adam19.1  3.654913 11.428474  59.68721 1.391261e-08 4.700143e-05 10.01270</code></section></pre><pre><section><code><span>  res.name <span>&lt;-</span> <span>paste0</span>(<span>unique</span>(group4diff)[<span>2</span>],<span>'vs'</span>,</span><br><span>                     <span>unique</span>(group4diff)[<span>1</span>],<span>'.csv'</span>)</span><br><span>  res.name</span></code></section></pre><pre><section><code>## [1] "GroupBvsGroupA.csv"</code></section></pre><pre><section><code><span>  <span>write.csv</span>(tt,res.name)</span></code></section></pre></section></section></section><section><img data-ratio="0.5763888888888888" data-w="144" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9etbHzsrN4I3YbicBP43PrF8o6hJDBnmPVKVqLr4mMico1SSzwQviaolWAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9etbHzsrN4I3YbicBP43PrF8o6hJDBnmPVKVqLr4mMico1SSzwQviaolWAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section></section><section><br></section><section data-support="96编辑器" data-style-id="37514"><section><br></section></section><section data-support="96编辑器" data-style-id="37514"><section><section><img data-ratio="1.1363636363636365" data-w="44" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9ed4OicicNpFsBE32ZzDUWcVJvdWPHICYQiaId4w7UggxaJBOrrGpqhoiciag/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9ed4OicicNpFsBE32ZzDUWcVJvdWPHICYQiaId4w7UggxaJBOrrGpqhoiciag/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section><section><section><span><strong>三、浅画个火山图看看</strong></span></section><pre><section><code><span>  m <span>&lt;-</span> tt</span><br><span>  m<span>$</span>Gene <span>&lt;-</span> <span>rownames</span>(m)</span><br><span>  m<span>$</span>type[m<span>$</span>P.Value <span>&lt;</span> <span>0.05</span> <span>&amp;</span> m<span>$</span>logFC <span>&gt;</span> <span>1</span>] <span>=</span> <span>"up"</span></span><br><span>  m<span>$</span>type[m<span>$</span>P.Value <span>&lt;</span> <span>0.05</span> <span>&amp;</span> m<span>$</span>logFC <span>&lt;</span> <span>-</span><span>1</span>] <span>=</span> <span>"down"</span></span><br><span>  m<span>$</span>type[m<span>$</span>P.Value <span>&lt;</span> <span>0.05</span> <span>&amp;</span> <span>abs</span>(m<span>$</span>logFC) <span>&lt;=</span><span>1</span>] <span>=</span> <span>"non"</span>     <span>##abs绝对值</span></span><br><span>  m<span>$</span>type[m<span>$</span>P.Value <span>&gt;=</span> <span>0.05</span>] <span>=</span> <span>"non"</span></span><br><span>  <span>library</span>(ggplot2)</span><br><span>  <span>library</span>(ggthemes)</span><br><span>  m<span>$</span>P.Value[<span>-</span><span>log10</span>(m<span>$</span>P.Value)<span>&gt;</span><span>200</span>]<span>&lt;-</span><span>10</span><span>**</span>(<span>-</span><span>200</span>)<span>#将p值超出范围的值同意等于200</span></span><br><span>  p<span>&lt;-</span><span>ggplot</span>(m,<span>aes</span>(<span>x=</span>logFC,<span>y=</span><span>-</span><span>1</span><span>*</span><span>log10</span>(P.Value),<span>colour=</span>type))<span>+</span></span><br><span>    <span>xlab</span>(<span>"log2(Fold Change)"</span>)<span>+</span></span><br><span>    <span>ylab</span>(<span>"-log10(P.Value)"</span>)<span>+</span></span><br><span>    <span>geom_point</span>(<span>size=</span><span>2</span>,<span>alpha=</span><span>0.6</span>)<span>+</span>                  <span># 设定点的大小</span></span><br><span>    <span>scale_color_manual</span>(<span>values =</span><span>c</span>(<span>"blue"</span>,<span>"grey"</span>,<span>"red"</span>))<span>+</span>       <span>#设定上下调颜色 </span></span><br><span>    <span>geom_hline</span>(<span>yintercept=</span><span>1.30103</span>,<span>linetype=</span><span>3</span>)<span>+</span>                <span># 增加水平间隔线</span></span><br><span>    <span>geom_vline</span>(<span>xintercept=</span><span>c</span>(<span>-</span><span>1</span>,<span>1</span>),<span>linetype=</span><span>3</span>)<span>+</span>                <span>#增加垂直间隔线</span></span><br><span>    <span>theme_few</span>()<span>+</span>                                              <span># 去掉网格背景</span></span><br><span>    <span>theme</span>(<span>legend.title =</span> <span>element_blank</span>())                     <span># 去掉图注标签</span></span><br><span>  p</span></code></section></pre><section><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXcM7AZicakhJ3Ipfq77fwEGnkbX5cgp9t83bBtlgYwP1Zt015OcHFaGg/640?wx_fmt=png" data-type="png" data-w="1344" width="672" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXcM7AZicakhJ3Ipfq77fwEGnkbX5cgp9t83bBtlgYwP1Zt015OcHFaGg/640?wx_fmt=png"></section><section><br></section><pre><section><code><span>  <span>#标上上下调最显著的五个基因</span></span><br><span>  top_m <span>&lt;-</span> m <span>%&gt;%</span> <span>group_by</span>(type) <span>%&gt;%</span> <span>top_n</span>(<span>n =</span> <span>5</span>, <span>wt =</span> <span>-</span><span>1</span><span>*</span><span>log10</span>(P.Value)) <span>%&gt;%</span> <span>filter</span>(type <span>!=</span><span>'non'</span>)                 <span># 取上下调中显著差异表达基因前5个</span></span><br><span>  </span><br><span>  up.p <span>&lt;-</span> p <span>+</span> <span>geom_text</span>(<span>data=</span>top_m,<span>aes</span>(<span>x=</span>logFC, <span>y=</span><span>-</span><span>1</span><span>*</span><span>log10</span>(P.Value),<span>label=</span><span>as.character</span>(Gene)),<span>size=</span><span>3</span>)</span><br><span><span>print</span>(up.p)</span></code></section></pre><section><img data-ratio="0.7142857142857143" data-type="png" data-w="1344" width="672" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXPknxia0ohS8j9IG3MSxtHbAq6ORBlEuUyc5S0NIWzhibC3YtbemPT3rg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXPknxia0ohS8j9IG3MSxtHbAq6ORBlEuUyc5S0NIWzhibC3YtbemPT3rg/640?wx_fmt=png"></section></section></section></section><section><img data-ratio="0.5763888888888888" data-w="144" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9etbHzsrN4I3YbicBP43PrF8o6hJDBnmPVKVqLr4mMico1SSzwQviaolWAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9etbHzsrN4I3YbicBP43PrF8o6hJDBnmPVKVqLr4mMico1SSzwQviaolWAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section></section><section><br></section><section data-support="96编辑器" data-style-id="37514"><section><br></section></section><section data-support="96编辑器" data-style-id="37514"><section><section><img data-ratio="1.1363636363636365" data-w="44" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9ed4OicicNpFsBE32ZzDUWcVJvdWPHICYQiaId4w7UggxaJBOrrGpqhoiciag/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9ed4OicicNpFsBE32ZzDUWcVJvdWPHICYQiaId4w7UggxaJBOrrGpqhoiciag/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section><section><section><span><strong>四、画热图，<strong>画热图，<strong>画热图</strong></strong></strong></span></section><ul><li><h2><strong><span>4.1 基础的</span><code><span>pheatmap</span></code></strong></h2></li></ul><section><span>这部分内容我们也画专门的篇幅讲解过，可以看B站视频教程(</span><span>企业级pheatmap 手把手教你画热图</span><span>)，与推送(</span><a href="https://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247484837&amp;idx=1&amp;sn=02101325f6fe704a86f72a227d332966&amp;chksm=9b3f7cf5ac48f5e367129942ac7a3b6365913dbd54b14104e0cb5ed9b84ad7a1478e81ce8856&amp;token=1474918447&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2"><span>企业级pheatmap教程</span></a><span>)</span></section><pre><section><code><span><span>suppressMessages</span>(<span>library</span>(dplyr))</span><br><span>heatmapGene <span>&lt;-</span> <span>filter</span>(m,adj.P.Val<span>&lt;</span><span>0.05</span>) <span>%&gt;%</span> </span><br><span>  <span>filter</span>(type <span>%in%</span> <span>c</span>(<span>'down'</span>,<span>'up'</span>)) <span>%&gt;%</span></span><br><span>  <span>group_by</span>(type) <span>%&gt;%</span> <span>top_n</span>(<span>100</span>,<span>wt =</span> logFC)</span><br><br><span><span>library</span>(pheatmap)</span><br><span>gene4hmp <span>&lt;-</span> heatmapGene<span>$</span>Gene</span><br><span><span>pheatmap</span>(<span>as.matrix</span>(mydata[gene4hmp,]),<span>scale =</span> <span>'row'</span>,</span><br><span>         <span>fontsize_row =</span> <span>2</span>,<span>cellheight =</span> <span>3</span>)</span></code></section></pre><section><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXXekyPp1vibyH97sItneFcjHvsEaVPj5w9IHlLIaicroMxt9Klnu3M18w/640?wx_fmt=png" data-type="png" data-w="1920" width="960" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXXekyPp1vibyH97sItneFcjHvsEaVPj5w9IHlLIaicroMxt9Klnu3M18w/640?wx_fmt=png"></section><ul><li><h2><strong><span>4.2 </span><code><span>ComplexHeatmap</span></code></strong></h2></li></ul><ul><li><h3><strong><span>4.2.1 画一个单调的热图</span></strong></h3></li></ul><pre><section><code><span><span>suppressMessages</span>(<span>library</span>(ComplexHeatmap))</span><br><span><span>Heatmap</span>(mydata[gene4hmp,])<span>#显然这个过于单调，啥也看不出来</span></span></code></section></pre><pre><section><code>## Warning: The input is a data frame-like object, convert it to a matrix.</code></section></pre><section><img data-ratio="0.7142857142857143" data-type="png" data-w="1344" width="672" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXWcAPFkxvV2edYwyLDYGAD61ibAov5Wzd4pF0wia6ib8cpMKsKjEDPbIMA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXWcAPFkxvV2edYwyLDYGAD61ibAov5Wzd4pF0wia6ib8cpMKsKjEDPbIMA/640?wx_fmt=png"></section><section><br></section><pre><section><code><span><span>#我们按行scale突出组间的差别而非基因间的差异</span></span><br><span>hmp.body <span>&lt;-</span> <span>Heatmap</span>(<span>t</span>(<span>scale</span>(<span>t</span>(mydata[gene4hmp,]))),</span><br><span>        <span>column_title  =</span> <span>"I'm a ComplexHeatmap designed by Biomamba"</span> ,</span><br><span>        <span>row_km =</span> <span>2</span>,</span><br><span>        <span>column_split =</span> <span>c</span>(<span>rep</span>(<span>'GroupA'</span>,<span>3</span>), <span>rep</span>(<span>'GroupB'</span>,<span>3</span>)),</span><br><span>        <span>border =</span> <span>TRUE</span>)</span><br><span><span>draw</span>(hmp.body)</span></code></section></pre><section><img data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXYNnBkicpdXarurCTaytzaGeo6Ejw6oFBrXKdNtkJsKcRQ5opDLB4eAw/640?wx_fmt=png" data-type="png" data-w="1344" width="672" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXYNnBkicpdXarurCTaytzaGeo6Ejw6oFBrXKdNtkJsKcRQ5opDLB4eAw/640?wx_fmt=png"></section><section><span>加上分组变量的注释</span></section><pre><section><code><span>ha <span>=</span> <span>HeatmapAnnotation</span>(<span>foo =</span> <span>anno_block</span>(<span>gp =</span> <span>gpar</span>(<span>fill =</span> <span>2</span><span>:</span><span>3</span>),</span><br><span>                       <span>labels =</span> <span>c</span>(<span>'GroupA'</span>, <span>'GroupB'</span>),<span>#标签的值 </span></span><br><span>                       <span>labels_gp =</span> <span>gpar</span>(<span>col =</span> <span>"white"</span>, <span>fontsize =</span> <span>10</span>))</span><br><span>                      )</span><br><br><br><span><span>Heatmap</span>(<span>t</span>(<span>scale</span>(<span>t</span>(mydata[gene4hmp,]))),<span>#按行scale一下，突出组间的差别而非基因间的</span></span><br><span>        <span>column_title  =</span> <span>"I'm a ComplexHeatmap designed by Biomamba"</span> ,</span><br><span>        <span>row_km =</span> <span>2</span>,</span><br><span>        <span>column_split =</span> <span>c</span>(<span>rep</span>(<span>'GroupA'</span>,<span>3</span>), <span>rep</span>(<span>'GroupB'</span>,<span>3</span>)),</span><br><span>        <span>border =</span> <span>TRUE</span>,</span><br><span>        <span>top_annotation =</span> ha)</span></code></section></pre><section><img data-ratio="0.7142857142857143" data-type="png" data-w="1344" width="672" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXn1C7ozwV4ZYSZGOw0b1BicoquQry5z0XjsazGJviaL80aQ24ggux83JQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXn1C7ozwV4ZYSZGOw0b1BicoquQry5z0XjsazGJviaL80aQ24ggux83JQ/640?wx_fmt=png"></section><ul><li><h2><strong><span>4.2.2 基因标注</span></strong></h2></li></ul><section><span>从上图可以看出，差异基因有时过多，字大了叠在一起，字小了又看不清，那就挑几个重要的标注一下吧。<br>这里先做一步<strong>富集分析</strong>，没有这部分知识的同学可以看这里：</span><a href="https://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247488717&amp;idx=1&amp;sn=6ba02599dda33eb6cff751c1d92055d9&amp;chksm=9b3f6d9dac48e48ba334f031ce7874b4383a45be271acc9f0e6a714934ab7c7d945a513efdec&amp;scene=21#wechat_redirect" data-linktype="2"><span>基因集富集分析</span></a></section><pre><section><code><span><span>#富集分析，这是一个大鼠的基因集</span></span><br><span><span>suppressMessages</span>(<span>library</span>(org.Rn.eg.db))</span><br><span><span>suppressMessages</span>(<span>library</span>(clusterProfiler))</span><br><span>gene.df <span>&lt;-</span> <span>bitr</span>(<span>gsub</span>(<span>'</span><span>\\</span><span>.</span><span>\\</span><span>d$'</span>,<span>''</span>,heatmapGene<span>$</span>Gene),<span>fromType=</span><span>"SYMBOL"</span>,</span><br><span>                <span>toType=</span><span>c</span>(<span>"ENTREZID"</span>,<span>"ENSEMBL"</span>),</span><br><span>                <span>OrgDb =</span> org.Rn.eg.db)</span></code></section></pre><pre><section><code>## 'select()' returned 1:1 mapping between keys and columns</code></section></pre><pre><section><code>## Warning in bitr(gsub("\\.\\d$", "", heatmapGene$Gene), fromType = "SYMBOL", :<br>## 3.19% of input gene IDs are fail to map...</code></section></pre><pre><section><code><span>ekegg <span>&lt;-</span> <span>enrichKEGG</span>(<span>unique</span>(gene.df<span>$</span>ENTREZID), <span>organism=</span><span>'rno'</span>,</span><br><span>                    <span>pvalueCutoff=</span><span>0.05</span>,<span>pAdjustMethod=</span><span>'BH'</span>,</span><br><span>                    <span>minGSSize=</span><span>10</span>,<span>maxGSSize=</span><span>500</span>,<span>use_internal_data=</span>F)</span></code></section></pre><pre><section><code>## Reading KEGG annotation online:</code></section></pre><pre><section><code>## Warning in utils::download.file(url, quiet = TRUE, method = method, ...): the<br>## 'wininet' method is deprecated for http:// and https:// URLs</code></section></pre><pre><section><code>## Reading KEGG annotation online:</code></section></pre><pre><section><code>## Warning in utils::download.file(url, quiet = TRUE, method = method, ...): the<br>## 'wininet' method is deprecated for http:// and https:// URLs</code></section></pre><pre><section><code><span>ekegg <span>&lt;-</span> <span>setReadable</span>(ekegg,<span>'org.Rn.eg.db'</span>,<span>'ENTREZID'</span>) </span><br><span>my.kegg.res <span>&lt;-</span> <span>as.data.frame</span>(ekegg<span>@</span>result)</span><br><span><span>head</span>(my.kegg.res)</span></code></section></pre><pre><section><code>##                ID                                                Description<br>## rno00603 rno00603 Glycosphingolipid biosynthesis - globo and isoglobo series<br>## rno04610 rno04610                        Complement and coagulation cascades<br>## rno04270 rno04270                         Vascular smooth muscle contraction<br>## rno04350 rno04350                                 TGF-beta signaling pathway<br>## rno04934 rno04934                                           Cushing syndrome<br>## rno04530 rno04530                                             Tight junction<br>##          GeneRatio  BgRatio     pvalue p.adjust    qvalue<br>## rno00603      2/90  16/8964 0.01091743 0.514412 0.4912998<br>## rno04610      4/90  87/8964 0.01123072 0.514412 0.4912998<br>## rno04270      5/90 139/8964 0.01279988 0.514412 0.4912998<br>## rno04350      4/90  94/8964 0.01459563 0.514412 0.4912998<br>## rno04934      5/90 158/8964 0.02115092 0.514412 0.4912998<br>## rno04530      5/90 167/8964 0.02611845 0.514412 0.4912998<br>##                                       geneID Count<br>## rno00603                        Sec1/B3galt5     2<br>## rno04610           A2m/Serpinc1/C8b/Serpina1     4<br>## rno04270 Adra1b/Calml3/Gucy1b1/Avpr1a/Agtr1a     5<br>## rno04350               Cdkn2b/Fst/Nbl1/Tgif2     4<br>## rno04934  Cdkn1a/Cdkn2b/Wnt10b/Agtr1a/Scarb1     5<br>## rno04530    Cldn2/Runx1/Cldn4/Tuba8/Epb41l4b     5</code></section></pre><pre><section><code><span><span>#就挑富集分析里最显著通路包含的基因</span></span><br><span>marker.gene <span>&lt;-</span> <span>top_n</span>(my.kegg.res,<span>1</span>, GeneRatio) <span>%&gt;%</span> </span><br><span>  <span>pull</span>(geneID) <span>%&gt;%</span> .[<span>1</span>] <span>%&gt;%</span> </span><br><span>  <span>strsplit</span>(.,<span>'/'</span>) <span>%&gt;%</span> <span>unlist</span>()</span><br><span>marker.gene</span></code></section></pre><pre><section><code>## [1] "Adra1b" "Tac4"   "Gal"    "Chrng"  "Chrnd"  "Chrna1" "Avpr1a" "Agtr1a"</code></section></pre><pre><section><code><span><span>#加上标注：</span></span><br><span><span>Heatmap</span>(<span>t</span>(<span>scale</span>(<span>t</span>(mydata[gene4hmp,]))),</span><br><span>        <span>column_title  =</span> <span>"I'm a ComplexHeatmap designed by Biomamba"</span> ,<span>#加上标题</span></span><br><span>        <span>row_km =</span> <span>2</span>,<span>#聚为两类</span></span><br><span>        <span>column_split =</span> <span>c</span>(<span>rep</span>(<span>'GroupA'</span>,<span>3</span>), <span>rep</span>(<span>'GroupB'</span>,<span>3</span>)),<span>#按照分组拆分</span></span><br><span>        <span>border =</span> <span>TRUE</span>,<span>#加上边框</span></span><br><span>        <span>top_annotation =</span> ha,<span>#加上顶部注释</span></span><br><span>        <span>right_annotation  =</span> <span>rowAnnotation</span>(</span><br><span>         <span>most.enrich.gene=</span> <span>anno_mark</span>(<span>at =</span> </span><br><span>                     (<span>1</span><span>:</span><span>length</span>(heatmapGene<span>$</span>Gene))[heatmapGene<span>$</span>Gene <span>%in%</span> marker.gene]</span><br><span>                    , <span>labels =</span> marker.gene)),<span>#加上指定基因的标注</span></span><br><span>        <span>show_row_names =</span> F <span>#堆叠的行名咱就不要了</span></span><br><span>        )</span></code></section></pre><section><img data-ratio="0.8333333333333334" data-type="png" data-w="1152" width="576" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXhCe0mmeCokkV2xQNibSDmY8NyudeGib0jYO5lqm2CEM0Ih0WZBKIYsSg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXhCe0mmeCokkV2xQNibSDmY8NyudeGib0jYO5lqm2CEM0Ih0WZBKIYsSg/640?wx_fmt=png"></section><ul><li><h2><strong><span>4.2.3 制作文本注释</span></strong></h2></li></ul><pre><section><code><span><span>#上调基因富集到最显著的10个通路</span></span><br><span><span>#下调基因富集到的最显著的10个通路</span></span><br><span>upgene <span>&lt;-</span> <span>filter</span>(heatmapGene,type<span>==</span><span>'up'</span>) <span>%&gt;%</span> <span>pull</span>(Gene)</span><br><span>up.gene.df <span>&lt;-</span> <span>bitr</span>(<span>gsub</span>(<span>'</span><span>\\</span><span>.</span><span>\\</span><span>d$'</span>,<span>''</span>,upgene),<span>fromType=</span><span>"SYMBOL"</span>,</span><br><span>                <span>toType=</span><span>c</span>(<span>"ENTREZID"</span>,<span>"ENSEMBL"</span>),</span><br><span>                <span>OrgDb =</span> org.Rn.eg.db)</span></code></section></pre><pre><section><code>## 'select()' returned 1:1 mapping between keys and columns</code></section></pre><pre><section><code><span>up.ekegg <span>&lt;-</span> <span>enrichKEGG</span>(<span>unique</span>(up.gene.df<span>$</span>ENTREZID), <span>organism=</span><span>'rno'</span>,</span><br><span>                    <span>pvalueCutoff=</span><span>0.05</span>,<span>pAdjustMethod=</span><span>'BH'</span>,</span><br><span>                    <span>minGSSize=</span><span>10</span>,<span>maxGSSize=</span><span>500</span>,<span>use_internal_data=</span>F)</span><br><br><br><span>up.ekegg <span>&lt;-</span> <span>setReadable</span>(up.ekegg,<span>'org.Rn.eg.db'</span>,<span>'ENTREZID'</span>) </span><br><span>my.up.ekegg.res <span>&lt;-</span> <span>as.data.frame</span>(up.ekegg<span>@</span>result)</span><br><span><span>head</span>(my.up.ekegg.res)</span></code></section></pre><pre><section><code>##                ID                                                Description<br>## rno00603 rno00603 Glycosphingolipid biosynthesis - globo and isoglobo series<br>## rno05214 rno05214                                                     Glioma<br>## rno05226 rno05226                                             Gastric cancer<br>## rno05220 rno05220                                   Chronic myeloid leukemia<br>## rno04744 rno04744                                          Phototransduction<br>## rno00601 rno00601 Glycosphingolipid biosynthesis - lacto and neolacto series<br>##          GeneRatio  BgRatio      pvalue p.adjust    qvalue<br>## rno00603      2/42  16/8964 0.002467033 0.157417 0.1464344<br>## rno05214      3/42  74/8964 0.004921876 0.157417 0.1464344<br>## rno05226      4/42 151/8964 0.005268313 0.157417 0.1464344<br>## rno05220      3/42  78/8964 0.005701901 0.157417 0.1464344<br>## rno04744      2/42  26/8964 0.006486425 0.157417 0.1464344<br>## rno00601      2/42  29/8964 0.008031452 0.157417 0.1464344<br>##                             geneID Count<br>## rno00603              Sec1/B3galt5     2<br>## rno05214        Cdkn1a/Shc3/Calml3     3<br>## rno05226 Cdkn1a/Cdkn2b/Shc3/Wnt10b     4<br>## rno05220         Runx1/Cdkn1a/Shc3     3<br>## rno04744              Pde6a/Calml3     2<br>## rno00601              Sec1/B3galt5     2</code></section></pre><pre><section><code><span>up.pathway <span>&lt;-</span> <span>top_n</span>(my.up.ekegg.res,<span>-</span><span>10</span>, pvalue)</span><br><br><br><span>downgene <span>&lt;-</span> <span>filter</span>(heatmapGene,type<span>==</span><span>'down'</span>) <span>%&gt;%</span> <span>pull</span>(Gene)</span><br><span>down.gene.df <span>&lt;-</span> <span>bitr</span>(<span>gsub</span>(<span>'</span><span>\\</span><span>.</span><span>\\</span><span>d$'</span>,<span>''</span>,downgene),<span>fromType=</span><span>"SYMBOL"</span>,</span><br><span>                   <span>toType=</span><span>c</span>(<span>"ENTREZID"</span>,<span>"ENSEMBL"</span>),</span><br><span>                   <span>OrgDb =</span> org.Rn.eg.db)</span></code></section></pre><pre><section><code>## 'select()' returned 1:1 mapping between keys and columns</code></section></pre><pre><section><code><span>down.ekegg <span>&lt;-</span> <span>enrichKEGG</span>(<span>unique</span>(down.gene.df<span>$</span>ENTREZID), <span>organism=</span><span>'rno'</span>,</span><br><span>                       <span>pvalueCutoff=</span><span>0.05</span>,<span>pAdjustMethod=</span><span>'BH'</span>,</span><br><span>                       <span>minGSSize=</span><span>10</span>,<span>maxGSSize=</span><span>500</span>,<span>use_internal_data=</span>F)</span><br><br><br><span>down.ekegg <span>&lt;-</span> <span>setReadable</span>(down.ekegg,<span>'org.Rn.eg.db'</span>,<span>'ENTREZID'</span>) </span><br><span>my.down.ekegg.res <span>&lt;-</span> <span>as.data.frame</span>(down.ekegg<span>@</span>result)</span><br><span><span>head</span>(my.down.ekegg.res)</span></code></section></pre><pre><section><code>##                ID                        Description GeneRatio  BgRatio<br>## rno05415 rno05415            Diabetic cardiomyopathy      5/48 214/8964<br>## rno00020 rno00020          Citrate cycle (TCA cycle)      2/48  31/8964<br>## rno00620 rno00620                Pyruvate metabolism      2/48  46/8964<br>## rno04714 rno04714                      Thermogenesis      4/48 237/8964<br>## rno04270 rno04270 Vascular smooth muscle contraction      3/48 139/8964<br>## rno04913 rno04913            Ovarian steroidogenesis      2/48  58/8964<br>##               pvalue  p.adjust    qvalue                          geneID Count<br>## rno05415 0.005501832 0.4702128 0.4601589 Uqcr11/Ndufb4/Pdha1/Gys1/Agtr1a     5<br>## rno00020 0.011827091 0.4702128 0.4601589                        Cs/Pdha1     2<br>## rno00620 0.025021909 0.4702128 0.4601589                      Pdha1/Adh4     2<br>## rno04714 0.037417089 0.4702128 0.4601589      Uqcr11/Ndufb4/Coa7/Ndufaf4     4<br>## rno04270 0.038018231 0.4702128 0.4601589           Gucy1b1/Avpr1a/Agtr1a     3<br>## rno04913 0.038380010 0.4702128 0.4601589                    Scarb1/Acot4     2</code></section></pre><pre><section><code><span>down.pathway <span>&lt;-</span> <span>top_n</span>(my.down.ekegg.res,<span>-</span><span>10</span>, pvalue)</span><br><br><span><span>#构建文本注释</span></span><br><span>text <span>=</span> <span>list</span>(<span>'up'</span><span>=</span>up.pathway<span>$</span>Description,<span>'down'</span><span>=</span>down.pathway<span>$</span>Description)</span><br><span>text<span>#就是一个list</span></span></code></section></pre><pre><section><code>## $up<br>##  [1] "Glycosphingolipid biosynthesis - globo and isoglobo series"<br>##  [2] "Glioma"                                                    <br>##  [3] "Gastric cancer"                                            <br>##  [4] "Chronic myeloid leukemia"                                  <br>##  [5] "Phototransduction"                                         <br>##  [6] "Glycosphingolipid biosynthesis - lacto and neolacto series"<br>##  [7] "Neuroactive ligand-receptor interaction"                   <br>##  [8] "Estrogen signaling pathway"                                <br>##  [9] "Mineral absorption"                                        <br>## [10] "Adrenergic signaling in cardiomyocytes"                    <br>## [11] "Breast cancer"                                             <br>## <br>## $down<br>##  [1] "Diabetic cardiomyopathy"            "Citrate cycle (TCA cycle)"         <br>##  [3] "Pyruvate metabolism"                "Thermogenesis"                     <br>##  [5] "Vascular smooth muscle contraction" "Ovarian steroidogenesis"           <br>##  [7] "Long-term depression"               "Spinocerebellar ataxia"            <br>##  [9] "Amyotrophic lateral sclerosis"      "Glycolysis / Gluconeogenesis"      <br>## [11] "Cortisol synthesis and secretion"</code></section></pre><pre><section><code><span><span>library</span>(ggsci)<span>#答应大家的以后配色都用ggsci解决</span></span><br><span><span>Heatmap</span>(<span>t</span>(<span>scale</span>(<span>t</span>(mydata[gene4hmp,]))),<span>#按行scale一下，突出组间的差别而非基因间的</span></span><br><span>        <span>column_title  =</span> <span>"I'm a ComplexHeatmap designed by Biomamba"</span> ,</span><br><span>        <span>row_km =</span> <span>2</span>,</span><br><span>        <span>column_split =</span> <span>c</span>(<span>rep</span>(<span>'GroupA'</span>,<span>3</span>), <span>rep</span>(<span>'GroupB'</span>,<span>3</span>)),</span><br><span>        <span>border =</span> <span>TRUE</span>,</span><br><span>        <span>top_annotation =</span> ha,</span><br><span>        <span>right_annotation  =</span> <span>rowAnnotation</span>(</span><br><span>          <span>most.enrich.gene=</span> <span>anno_mark</span>(<span>at =</span> </span><br><span>                               (<span>1</span><span>:</span><span>length</span>(heatmapGene<span>$</span>Gene))[heatmapGene<span>$</span>Gene <span>%in%</span>                                           marker.gene], <span>labels =</span> marker.gene)),</span><br><span>        <span>show_row_names =</span> F,</span><br><span>        <span>left_annotation  =</span> <span>rowAnnotation</span>(</span><br><span>          <span>textbox =</span> <span>anno_textbox</span>(heatmapGene<span>$</span>type,<span>#词云注释的'break</span></span><br><span>                                 text, <span>#文本</span></span><br><span>                                 <span>by =</span> <span>"anno_block"</span>,</span><br><span>                                 <span>add_new_line =</span> T,<span>#让每一种通路都单独成行展示</span></span><br><span>                                 <span>gp =</span> <span>gpar</span>(<span>col =</span> <span>c</span>(<span>pal_npg</span>()(<span>10</span>),<span>pal_nejm</span>()(<span>10</span>))<span>#ggsci配色</span></span><br><span>                                           ),</span><br><span>                                 <span>round_corners =</span> TRUE<span>#圆角文本矩形</span></span><br><span>                                 )</span><br><span>                                          )</span><br><span>          )</span></code></section></pre><section><img data-ratio="0.6" data-type="png" data-w="1920" width="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXl6aghmY3KONLUtJYh88wxvhkqsj748Id7IgsoHeHh4JngmYrXlyTDw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXl6aghmY3KONLUtJYh88wxvhkqsj748Id7IgsoHeHh4JngmYrXlyTDw/640?wx_fmt=png"></section><section><br></section><section><span>还不能让人满意，我希望能够按显著性给这些字加上大小</span></section><pre><section><code><span>myfontsize <span>=</span> <span>c</span>(<span>-</span><span>log2</span>(up.pathway<span>$</span>pvalue),<span>-</span><span>log2</span>(up.pathway<span>$</span>pvalue))<span>*</span><span>1.7</span> <span>#按显著性分配字体大小，约显著的通路字体越大</span></span><br><span>fln.hmp <span>&lt;-</span> <span>Heatmap</span>(<span>t</span>(<span>scale</span>(<span>t</span>(mydata[gene4hmp,]))),<span>#按行scale一下，突出组间的差别而非基因间的</span></span><br><span>        <span>column_title  =</span> <span>"I'm a ComplexHeatmap designed by Biomamba"</span> ,</span><br><span>        <span>row_km =</span> <span>2</span>,</span><br><span>        <span>column_split =</span> <span>c</span>(<span>rep</span>(<span>'GroupA'</span>,<span>3</span>), <span>rep</span>(<span>'GroupB'</span>,<span>3</span>)),</span><br><span>        <span>border =</span> <span>TRUE</span>,</span><br><span>        <span>top_annotation =</span> ha,</span><br><span>        <span>right_annotation  =</span> <span>rowAnnotation</span>(</span><br><span>          <span>most.enrich.gene=</span> <span>anno_mark</span>(<span>at =</span> (<span>1</span><span>:</span><span>length</span>(heatmapGene<span>$</span>Gene))[heatmapGene<span>$</span>Gene <span>%in%</span> marker.gene]</span><br><span>                                      , <span>labels =</span> marker.gene)),</span><br><span>        <span>show_row_names =</span> F,</span><br><span>        <span>left_annotation  =</span> <span>rowAnnotation</span>(</span><br><span>          <span>textbox =</span> <span>anno_textbox</span>(heatmapGene<span>$</span>type, text, </span><br><span>                                 <span>by =</span> <span>"anno_block"</span>,</span><br><span>                                 <span>add_new_line =</span> T,</span><br><span>                                 <span>gp =</span> <span>gpar</span>(<span>col =</span> <span>c</span>(<span>pal_npg</span>()(<span>10</span>),<span>pal_nejm</span>()(<span>8</span>),<span>pal_aaas</span>()(<span>4</span>))</span><br><span>                                     ,<span>fontsize=</span>myfontsize),<span>#输入fontsize，调整字体大小</span></span><br><span>                                 <span>round_corners =</span> <span>TRUE</span>,</span><br><span>                                 <span>max_width=</span> <span>unit</span>(<span>3</span>,<span>'npc'</span>))</span><br><span>        )</span><br><span>)</span><br><span><span>draw</span>(fln.hmp)</span></code></section></pre><section><img data-ratio="0.6" data-type="png" data-w="1920" width="960" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXSzPjlj9KdKMZsV9ShW6HzwxbnXeicKxgpbN5NrCVJdAx7Pbwu96WjYg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpzsrK67HTMTTVklpFA9pksXSzPjlj9KdKMZsV9ShW6HzwxbnXeicKxgpbN5NrCVJdAx7Pbwu96WjYg/640?wx_fmt=png"></section><section><br></section></section></section></section><section><img data-ratio="0.5763888888888888" data-w="144" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9etbHzsrN4I3YbicBP43PrF8o6hJDBnmPVKVqLr4mMico1SSzwQviaolWAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9etbHzsrN4I3YbicBP43PrF8o6hJDBnmPVKVqLr4mMico1SSzwQviaolWAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section></section><section data-support="96编辑器" data-style-id="37514"><section><br></section></section><section data-support="96编辑器" data-style-id="37514"><section data-support="96编辑器" data-style-id="34892"><section><section><section><section><section><br></section><section data-support="96编辑器" data-style-id="37514"><section><section><img data-ratio="1.1363636363636365" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9ed4OicicNpFsBE32ZzDUWcVJvdWPHICYQiaId4w7UggxaJBOrrGpqhoiciag/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-w="44" src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9ed4OicicNpFsBE32ZzDUWcVJvdWPHICYQiaId4w7UggxaJBOrrGpqhoiciag/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section><section><section><span><strong>往期回顾</strong></span></section><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247492296&amp;idx=1&amp;sn=2ca85f0db3b228064e36317b04cadfc1&amp;chksm=9b3c9b98ac4b128e59c954df441e475beac60499976269256405cd76e67f34f59a53edda6d25&amp;scene=21#wechat_redirect" textvalue="热图绘制天花板：ComplexHeatmap| 一、初探" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>热图绘制天花板：ComplexHeatmap| 一、初探</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247492834&amp;idx=1&amp;sn=17654d8ab82f707e6b7275d899e8960b&amp;chksm=9b3c9db2ac4b14a4d5c395753d949477850ff6dab095eb1649c480c1766dd807ea1543e1ef67&amp;scene=21#wechat_redirect" textvalue="热图绘制天花板| 二、两万字长文探索注释功能" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>热图绘制天花板| 二、两万字长文探索注释功能</span></a></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247493291&amp;idx=1&amp;sn=1b26c7c69c929b79d46b9d1d5d0d16f5&amp;chksm=9b3c9ffbac4b16ed64ec97908007a04e57370ff2a11c568b26c286ac3ecf14d9b4d152975896&amp;scene=21#wechat_redirect" textvalue="ComplexHeatmap| 三、用富集分析结果做成词云注释热图" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">ComplexHeatmap| 三、用富集分析结果做成词云注释热图</a></p><p><br></p></section></section></section><section><img data-ratio="0.5763888888888888" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9etbHzsrN4I3YbicBP43PrF8o6hJDBnmPVKVqLr4mMico1SSzwQviaolWAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" data-w="144" src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9etbHzsrN4I3YbicBP43PrF8o6hJDBnmPVKVqLr4mMico1SSzwQviaolWAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section></section><section><br></section><section data-support="96编辑器" data-style-id="37514"><section><section><img data-ratio="1.1363636363636365" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9ed4OicicNpFsBE32ZzDUWcVJvdWPHICYQiaId4w7UggxaJBOrrGpqhoiciag/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-w="44" src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9ed4OicicNpFsBE32ZzDUWcVJvdWPHICYQiaId4w7UggxaJBOrrGpqhoiciag/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section><section><section><span><strong>最后、引用是美德</strong></span></section><section><ul><li></ul><pre data-lang="python"><code><span>Gu Z, Eils R, Schlesner M. Complex heatmaps reveal patterns <span>and</span> correlations <span>in</span> multidimensional genomic data. Bioinformatics. <span>2016</span> Sep <span>15</span>;<span>32</span>(<span>18</span>):<span>2847</span><span>-9.</span></span></code></pre></section><p><br></p></section></section></section><section><img data-ratio="0.5763888888888888" data-w="144" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9etbHzsrN4I3YbicBP43PrF8o6hJDBnmPVKVqLr4mMico1SSzwQviaolWAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjmjqT8o8geiaFwZ4uhvUb9etbHzsrN4I3YbicBP43PrF8o6hJDBnmPVKVqLr4mMico1SSzwQviaolWAg/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section></section><section><br></section><section><section data-id="124111" powered-by="xmyeditor.com" data-md5="78b0e"><section powered-by="xmyeditor.com" data-md5="78b0e"><section powered-by="xmyeditor.com" data-md5="78b0e"><section><section data-id="118344" powered-by="xmyeditor.com" data-md5="b3030"><section powered-by="xmyeditor.com" data-md5="b3030"><section powered-by="xmyeditor.com" data-md5="b3030"><section><br></section></section></section></section></section></section></section></section></section><section><section data-id="124111" powered-by="xmyeditor.com" data-md5="78b0e"><section powered-by="xmyeditor.com" data-md5="78b0e"><section powered-by="xmyeditor.com" data-md5="78b0e"><section><section data-id="118344" powered-by="xmyeditor.com" data-md5="b3030"><section powered-by="xmyeditor.com" data-md5="b3030"><section powered-by="xmyeditor.com" data-md5="b3030"><section><br></section></section></section></section></section></section></section></section></section><section><section><section><section><section data-support="96编辑器" data-style-id="34887"><section><section><section><img data-ratio="0.8372093023255814" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjsU2VMXgI8TRjfwVeo0Aj4EiaLjQXteia730VKnC0j8Tkgu6hkTs7ZO0JRFyw8riaczdNlQQKsOnfIQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="86" data-width="100%" src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjsU2VMXgI8TRjfwVeo0Aj4EiaLjQXteia730VKnC0j8Tkgu6hkTs7ZO0JRFyw8riaczdNlQQKsOnfIQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section><section><section><p>如何联系我们</p></section></section></section></section></section></section><section><br></section></section><section data-support="96编辑器" data-style-id="34892"><section><section><section><section><img data-ratio="1.1627906976744187" data-type="gif" data-w="43" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjsU2VMXgI8TRjfwVeo0Aj4z284kwxMryKUBLBbNicjxYMDvWxmosNGHmIW66jtmJuia0pe51q8hFzQ/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWjsU2VMXgI8TRjfwVeo0Aj4z284kwxMryKUBLBbNicjxYMDvWxmosNGHmIW66jtmJuia0pe51q8hFzQ/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section></section></section><section><section><section><section>公众号后台消息更新不及时，超过48h便不允许回复读者消息，这里给大家留一下领取资料、免费服务器的<span><strong>微信号</strong></span>，方便随时交流、提建议（由助理接待）。此外呼声一直很高的<span>交流群</span>也建好了，欢迎大家入群讨论：</section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247492981&amp;idx=1&amp;sn=aed903c4b853113d8c89e13848ea3365&amp;chksm=9b3c9c25ac4b1533feb5f42f94ab4b6023a160313db4bc6a2f142e54d26627e3ea94b53e9031&amp;scene=21#wechat_redirect" textvalue="永久免费的千人生信、科研交流群" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">永久免费的千人生信、科研交流群</a><br></section><section><br></section><section><span>大家可以阅读完这几篇之后添加</span></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247488966&amp;idx=1&amp;sn=9e9e7659b4cf00ac3173d21e88e1602b&amp;chksm=9b3f6c96ac48e580efe53f966430f6598785e5c5c6bcc20f5eef019e723e49baaaea6d73fb7b&amp;scene=21#wechat_redirect" textvalue="如何搜索公众号过往发布内容" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">如何搜索公众号过往发布内容</a><br></section><section><img data-galleryid="" data-ratio="0.5938945420906568" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpxD2E7IWhoq4ufKkicBibrsZDbQ2O1mgYMTkXAS1cVGMQuQmXgm9tqlyJiaysfibKgia1SKNODtpCialmQQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="1081" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpxD2E7IWhoq4ufKkicBibrsZDbQ2O1mgYMTkXAS1cVGMQuQmXgm9tqlyJiaysfibKgia1SKNODtpCialmQQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"><span></span></section></section></section></section></section></section></section></section></section><section data-support="96编辑器" data-style-id="25142"><section><section><section><img data-ratio="0.7619047619047619" data-w="84" data-width="80%" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWhFTIP7DCMLPwWh8Yhjs079f1vMqlYdExqbWaZVJyiawKkr21EDSNW740b4yMzkeHxFJULTpZGzYwQ/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWhFTIP7DCMLPwWh8Yhjs079f1vMqlYdExqbWaZVJyiawKkr21EDSNW740b4yMzkeHxFJULTpZGzYwQ/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section><section><span>您点的每个赞，我都认真当成了喜欢</span></section></section></section><section><br></section><section><br></section></section></section></section></section></section></section></section></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/JrzlRs2b65ZEiXl-61yjQg",target="_blank" rel="noopener noreferrer">原文链接</a>
