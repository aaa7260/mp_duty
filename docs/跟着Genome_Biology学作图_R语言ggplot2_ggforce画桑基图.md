---
title: "跟着Genome Biology学作图：R语言ggplot2+ggforce画桑基图"
date: 2022-09-11T10:37:34Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Acdemic"]
---
跟着Genome Biology学作图：R语言ggplot2+ggforce画桑基图 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><h2 data-tool="mdnice编辑器"><span></span><span>论文</span><span> </span></h2><blockquote data-tool="mdnice编辑器"><p>A pan-Zea genome map for enhancing maize improvement</p></blockquote><p data-tool="mdnice编辑器">https://genomebiology.biomedcentral.com/articles/10.1186/s13059-022-02742-7<span title="DOI: 10.1186/s13059-022-02742-7" es-id-type="DOI" es-id="10.1186/s13059-022-02742-7" es-collect-button-id="0"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewbox="0 0 1000 1000" enable-background="new 0 0 1000 1000" height="1em"><g><path d="M852.3,135.6l-47.7,48.3c157.6,178.7,157.4,451,0.1,631l48.8,49.5C1035.9,672.1,1035.5,327.2,852.3,135.6z M740.9,248.6l-49.3,49.9c96.1,115.5,96.1,285.8,0.5,402.1l48.8,49.6C863.4,606.1,863.6,391.5,740.9,248.6z M195.4,183.9l-47.7-48.3c-183.2,191.6-183.6,536.5-1.2,728.8l48.8-49.5C37.9,635,37.8,362.6,195.4,183.9z M259.1,248.6C136.4,391.5,136.6,606.1,259,750.3l48.8-49.6c-95.6-116.4-95.6-286.6,0.4-402.1L259.1,248.6z M499.8,340.4c-87.3,0-158.1,71.8-158.1,160.4c0,88.5,70.8,160.4,158.1,160.4c87.3,0,158.1-71.8,158.1-160.4C657.8,412.2,587,340.4,499.8,340.4z"></path></g></svg></span></p><p data-tool="mdnice编辑器"><code>s13059-022-02742-7.pdf</code></p><p data-tool="mdnice编辑器">论文中没有提供作图数据和代码，但是桑基图的作图数据相对比较简单 我们可以自己来构造数据</p><p data-tool="mdnice编辑器">今天的推文主要内容是重复一下论文中的Figure1D桑基图</p><figure data-tool="mdnice编辑器"><img data-ratio="0.9207729468599034" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmObEsEl3FqEz20vuz1Isjbj2z36ibZVx23d3hyc6ckVLVLaOsoDiaT0icRA/640?wx_fmt=png" data-type="png" data-w="1035" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmObEsEl3FqEz20vuz1Isjbj2z36ibZVx23d3hyc6ckVLVLaOsoDiaT0icRA/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">昨天的推文介绍的也是绘制桑基图，但是是借助的现成R包<code>ggalluvial</code>,暂时不知道用这个R包来做各个部分的比例如何调整。桑基图可以简单理解成两个柱子，然后柱子之间有连线，柱子可以借用<code>ggplot2</code>的<code>geom_rect()</code>函数来做,连线可以借助<code>ggforce</code>的<code>geom_diagonal_wide()</code>来做，但是相对比较繁琐，只有两列还好，像Figure4E实现起来就非常繁琐，但是暂时还想不到比较好的办法</p><h2 data-tool="mdnice编辑器"><span></span><span>首先是Figure4D</span><span> </span></h2><p data-tool="mdnice编辑器">先画两个柱子</p><pre data-tool="mdnice编辑器"><span></span><code>library(ggplot2)<br>ggplot()+<br>  geom_rect(aes(xmin=1-0.1,xmax=1+0.1,ymin=0,ymax=5.84),<br>            fill=<span>"#e3e2e2"</span>)+<br>  geom_rect(aes(xmin=1-0.1,xmax=1+0.1,ymin=5.84,ymax=100),<br>            fill=<span>"#7fa7d8"</span>)+<br>  geom_rect(aes(xmin=2-0.1,xmax=2+0.1,ymin=0,ymax=76.15),<br>            fill=<span>"#e3e2e2"</span>)+<br>  geom_rect(aes(xmin=2-0.1,xmax=2+0.1,ymin=76.15,ymax=100),<br>            fill=<span>"#af9dcc"</span>)+<br>  theme_void()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9787878787878788" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmOvloCib0vLx8DTRsBrXbdl8kPpoBHzUXahf60R38uKGdVVhKfKj5ibjdg/640?wx_fmt=png" data-type="png" data-w="990" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmOvloCib0vLx8DTRsBrXbdl8kPpoBHzUXahf60R38uKGdVVhKfKj5ibjdg/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">链接指定的区域</p><pre data-tool="mdnice编辑器"><span></span><code>library(ggforce)<br>ggplot()+<br>  geom_rect(aes(xmin=1-0.1,xmax=1+0.1,ymin=0,ymax=5.84),<br>            fill=<span>"#e3e2e2"</span>)+<br>  geom_rect(aes(xmin=1-0.1,xmax=1+0.1,ymin=5.84,ymax=100),<br>            fill=<span>"#7fa7d8"</span>)+<br>  geom_rect(aes(xmin=2-0.1,xmax=2+0.1,ymin=0,ymax=76.15),<br>            fill=<span>"#e3e2e2"</span>)+<br>  geom_rect(aes(xmin=2-0.1,xmax=2+0.1,ymin=76.15,ymax=100),<br>            fill=<span>"#af9dcc"</span>)+<br>  theme_void()+<br>  geom_diagonal_wide(aes(x=c(1.1,1.9,1.9,1.1),<br>                         y=c(5.84,76.15,100,100)),<br>                     fill=<span>"#e0eaf3"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.9989878542510121" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmOPY3nPfQNExFuGlQQbic6gzicicPVowB52ibNbMl2CKAAfUMT0QISnwWl2A/640?wx_fmt=png" data-type="png" data-w="988" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmOPY3nPfQNExFuGlQQbic6gzicicPVowB52ibNbMl2CKAAfUMT0QISnwWl2A/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">接下来是添加各部分的文字</p><pre data-tool="mdnice编辑器"><span></span><code>ggplot()+<br>  geom_rect(aes(xmin=1-0.1,xmax=1+0.1,ymin=0,ymax=5.84),<br>            fill=<span>"#e3e2e2"</span>)+<br>  geom_rect(aes(xmin=1-0.1,xmax=1+0.1,ymin=5.84,ymax=100),<br>            fill=<span>"#7fa7d8"</span>)+<br>  geom_rect(aes(xmin=2-0.1,xmax=2+0.1,ymin=0,ymax=76.15),<br>            fill=<span>"#e3e2e2"</span>)+<br>  geom_rect(aes(xmin=2-0.1,xmax=2+0.1,ymin=76.15,ymax=100),<br>            fill=<span>"#af9dcc"</span>)+<br>  <span>#theme_void()+</span><br>  geom_diagonal_wide(aes(x=c(1.1,1.9,1.9,1.1),<br>                         y=c(5.84,76.15,100,100)),<br>                     fill=<span>"#e0eaf3"</span>)+<br>  scale_x_continuous(breaks = c(1,2),<br>                     labels = c(<span>"NAM founder"</span>,<span>"Pan-Zea"</span>)) -&gt; p1<br><br>x&lt;-c(1,1,2,2)<br>y&lt;-c(5.84/2,5.84+94.16/2,<br>     76.15/2,76.15+23.85/2)<br>label&lt;-paste0(c(5.84,94.16,76.15,23.85),<span>"%"</span>)<br>x;y<br>label<br><br><span>for</span> (i <span>in</span> 1:4){<br>  p1&lt;-p1+<br>    annotate(geom = <span>"text"</span>,<br>             x=x[i],<br>             y=y[i],<br>             label=label[i])<br>}<br>p1<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.8740601503759399" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmOBrhLzuKBQV4OMTuk8aHUL0OJebhS8NEenou3pcytAC2eD4umU0bfBw/640?wx_fmt=png" data-type="png" data-w="1064" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmOBrhLzuKBQV4OMTuk8aHUL0OJebhS8NEenou3pcytAC2eD4umU0bfBw/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">对主题进行设置</p><pre data-tool="mdnice编辑器"><span></span><code>p1+<br>  theme(panel.background = element_blank(),<br>        axis.text.y = element_blank(),<br>        axis.ticks = element_blank(),<br>        axis.title = element_blank())+<br>  scale_y_continuous(expand = expansion(mult = c(0,0))) -&gt; p1.1<br></code></pre><p data-tool="mdnice编辑器">制作图例</p><pre data-tool="mdnice编辑器"><span></span><code>dflegend&lt;-data.frame(x=c(1,1,2,2),<br>                     y=c(1,1,1,1),<br>                     group=c(<span>"A"</span>,<span>"B"</span>,<span>"C"</span>,<span>"D"</span>))<br>dflegend<br><br>ggplot(data=dflegend,aes(x=x,y=y,shape=group,<br>                         color=group))+<br>  geom_point(size=10)+<br>  scale_shape_manual(values=c(<span>"\u25E4"</span>,<span>"\u25E2"</span>,<span>"\u25E4"</span>,<span>"\u25E2"</span>))+<br>  scale_color_manual(values = c(<span>"#7fa7d8"</span>,<span>"#af9dcc"</span>,<span>"#e3e2e2"</span>,<span>"#e3e2e2"</span>))+<br>  theme_void()+<br>  theme(legend.position = <span>"none"</span>)+<br>  xlim(0.5,2.5)+<br>  annotate(geom = <span>"text"</span>,x=1.1,y=1,<br>           label=<span>"Aligned"</span>,hjust=0,<br>           size=5)+<br>  annotate(geom = <span>"text"</span>,x=2.1,y=1,<br>           label=<span>"Un-aligned"</span>,hjust=0,<br>           size=5) -&gt; p2<br>p2<br></code></pre><p data-tool="mdnice编辑器">采用拼图的形式将图例和主图组合到一起</p><pre data-tool="mdnice编辑器"><span></span><code>library(patchwork)<br><br>p2/p1.1+<br>  plot_layout(heights = c(1,10))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.8820709491850431" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmOM63l36NMswI7F84zbjSgKrppCKqTe2Mic9MicicOQ69GgGBicdz9piaNdlg/640?wx_fmt=png" data-type="png" data-w="1043" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmOM63l36NMswI7F84zbjSgKrppCKqTe2Mic9MicicOQ69GgGBicdz9piaNdlg/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">这里新学到一个知识点，ggplot2做散点图，散点图的形状可以使用unicode,比如这里的两个上下三角，具体有哪些形状可以选可以参考下面这个图片</p><figure data-tool="mdnice编辑器"><img data-ratio="0.6129032258064516" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmOSfCMhraOStRRI0NwmWJQIqTdxD80ObArmdIiaH73ZWLrK7DibpKpP1icQ/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmOSfCMhraOStRRI0NwmWJQIqTdxD80ObArmdIiaH73ZWLrK7DibpKpP1icQ/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">但是遇到一个问题是导出pdf以后形状显示不出来，暂时不知道啥原因</p><figure data-tool="mdnice编辑器"><img data-ratio="0.4266129032258065" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmO7SNBdicqPM0ibic0ia0994Cyo07ibzWuBZEa6mibce348sjIpzqImlgGWVicQ/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmO7SNBdicqPM0ibic0ia0994Cyo07ibzWuBZEa6mibce348sjIpzqImlgGWVicQ/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">制作封面图</p><figure data-tool="mdnice编辑器"><img data-ratio="0.425" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmOK7KBOT4HONPice0gthBibSzsGFseF4LjMp8GnTAyIqBDEGGtR3EicAMicA/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk4JSiaYzTNjwc1wlOTAt8vmOK7KBOT4HONPice0gthBibSzsGFseF4LjMp8GnTAyIqBDEGGtR3EicAMicA/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><blockquote data-tool="mdnice编辑器"><p>这次推文没有示例数据，数据是和代码写到一起了，代码直接在推文中复制就行</p></blockquote><p data-tool="mdnice编辑器">欢迎大家关注我的公众号</p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzI3NzQ3MTcxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5t1sOnM0iabvBhnfIj5YpyqrMib0E1MGCd9ibcYxaOPZd0GWhQBDvK2BPEwsicQxd6y5MHLfphnwHnow/0?wx_fmt=png" data-nickname="小明的数据分析笔记本" data-alias="" data-signature="数据分析和数据可视化有意思的简单小例子~石榴研究生的笔记本" data-from="0" data-is_biz_ban="0"></mp-common-profile><br></section><blockquote data-tool="mdnice编辑器"><p>小明的数据分析笔记本 公众号 主要分享：1、R语言和python做数据分析和数据可视化的简单小例子；2、园艺植物相关转录组学、基因组学、群体遗传学文献阅读笔记；3、生物信息学入门学习资料及自己的学习笔记！</p></blockquote></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/DPeHCPyER9118w26DlSPHA",target="_blank" rel="noopener noreferrer">原文链接</a>
