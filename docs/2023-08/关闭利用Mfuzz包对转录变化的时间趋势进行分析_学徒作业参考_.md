---
title: "关闭利用Mfuzz包对转录变化的时间趋势进行分析（学徒作业参考）"
date: 2023-08-30T00:04:42Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
关闭利用Mfuzz包对转录变化的时间趋势进行分析（学徒作业参考） by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>学徒作业系列那么精彩，但是居然是寥寥无几的参与者，有点可惜啊！</p><p><img data-galleryid="" data-ratio="0.7006507592190889" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4ww1aiaCASxjWAr0ASMMgkeoib27u23J3ch0aa5Exd1d43xGfjPa3RYHUwcneSMsolC7icFbtSicLpk7vA/640?wx_fmt=png" data-type="png" data-w="922" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4ww1aiaCASxjWAr0ASMMgkeoib27u23J3ch0aa5Exd1d43xGfjPa3RYHUwcneSMsolC7icFbtSicLpk7vA/640?wx_fmt=png"></p></blockquote></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span>Mfuzz简介</span></h3><blockquote data-tool="mdnice编辑器"><p>Mfuzz是专门的做转录变化的时间趋势分析的方法，核心算法基于模糊c均值聚类（Fuzzy C-Means Clustering，FCM），根据时间趋势分析结果还可以挑选每个趋势分组中具有代表性基因，如发表在NaTure PLaNTS 杂志的文章：《Jasmonate-mediated wound signalling promotes plant regeneration》。</p></blockquote><p data-tool="mdnice编辑器">这里，我们利用数据集：GSE198667，<strong>对不同品种小鼠 在变老过程中基因变化的异同点进行时序分析。</strong></p><h3 data-tool="mdnice编辑器"><span>1. 下载分析数据</span></h3><p data-tool="mdnice编辑器">复制作业1的下载链接：https://ftp.ncbi.nlm.nih.gov/geo/series/GSE198nnn/GSE198667/suppl/GSE198667_processed_data.txt.gz下载数据，然后解压，就可以得到如下所示的表达量矩阵：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.3368055555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxwS1ib5oyZMUqiakyQqVLUuy26ibwW3MLu88WiahvmHxbp96tRZ1DTAnaFA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="864" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxwS1ib5oyZMUqiakyQqVLUuy26ibwW3MLu88WiahvmHxbp96tRZ1DTAnaFA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></figure><h3 data-tool="mdnice编辑器"><span>2. 读取每个样品的表达量矩阵</span></h3><p data-tool="mdnice编辑器"><strong>R读取csv文件</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>#R读取csv文件</span><br>a=read.csv(<span>"GSE198667_processed_data.csv"</span>)<br>View(a)<br>b=a[-c(1:3),]<br>colnames(b)=a[3,]<br>View(b)<br>table=b[,-1]<br>rownames(table)=b[,1]<br>View(table)<br><br></code></pre><p data-tool="mdnice编辑器">可以看到该数据包含两种不同的小鼠 （nontransgenic mice and transgenic tau SPAM mice）各自的2，4，6的时间数据：<img data-ratio="0.5659722222222222" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxkYLmjPUibrAHWeoCkVDiaAmnZRK9j60icWs5de9ApERELFe0eKdunUIdA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="864" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxkYLmjPUibrAHWeoCkVDiaAmnZRK9j60icWs5de9ApERELFe0eKdunUIdA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><p data-tool="mdnice编辑器">提取nTg/Tg这一小鼠的数据做Mfuzz的时间序列趋势分析。</p><pre data-tool="mdnice编辑器"><span></span><code>test1=table[c(grep(<span>"nTg"</span>,colnames(table)))] <span>#提取nTg这一小鼠所涉所有数据</span><br>colnames(test1) &lt;- c(<span>"M6"</span>,<span>"M6"</span>,<span>"M6"</span>,<span>"M2"</span>,<br>                     <span>"M2"</span>, <span>"M2"</span>,<span>"M4"</span>,<span>"M4"</span>,<span>"M4"</span>)<br>head(test1)<br><span>#test2=table[-c(grep("nTg",colnames(table)))] ##提取Tg这一小鼠所涉所有数据</span><br><span>#head(test2)</span><br></code></pre><p data-tool="mdnice编辑器">原始的FPKM矩阵，而且每个时间点有3个样品，需要进行一些简单的处理：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.4930555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxiap5FJolYlRKWicPTszPx06Maib9kH1xUffL448CCFXibkQNjyNaTqnpxw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="864" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxiap5FJolYlRKWicPTszPx06Maib9kH1xUffL448CCFXibkQNjyNaTqnpxw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"><figcaption>原始矩阵信息</figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code>data1=test1[,-c(1:3)]<br>View(data1)<br>data2=test1[,-c(4:9)]<br>View(data2)<br><span>test</span>=cbind(data1,data2)<span>#按列的方式将矩阵连接到一起；rbind按行的方式将矩阵连接到一起</span><br>View(<span>test</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span>3. 计算平均值</span></h3><pre data-tool="mdnice编辑器"><span></span><code>library(limma)<br>avereps_df&lt;- t(limma::avereps(t(<span>test</span>), ID = colnames(<span>test</span>)))<br>View(avereps_df)<br>colnames(avereps_df)<br>avereps_df = avereps_df[,c( <span>"M2"</span>, <span>"M4"</span>,<span>"M6"</span>)]<br><br><span>#保存结果</span><br><br><span>#save(avereps_df,file = 'avereps_df.Rdata')</span><br>write.csv(avereps_df,<span>"avereps_df.csv"</span>)<br><br><span>#加载结果</span><br><br><span>#load(file = 'avereps_df.Rdata')</span><br>avereps_df1=read.csv(<span>"avereps_df.csv"</span>)<br>avereps_df1[1:4,1:3] <span>#行为基因，列为不同时间点</span><br>View(avereps_df1)<br><br>avereps_df=avereps_df1[,-1]<br>rownames(avereps_df)=avereps_df1[,1]<br>View(avereps_df)<br></code></pre><h3 data-tool="mdnice编辑器"><span>4. 使用Mfuzz包做时间序列分析</span></h3><h4 data-tool="mdnice编辑器"><span>4.1 首先安装R包并加载</span></h4><pre data-tool="mdnice编辑器"><span></span><code>BiocManager::install(<span>"Mfuzz"</span>)<br>library(Mfuzz)<br>library(limma)<br>library(clusterProfiler)<br><br>BiocManager::install(<span>'org.Hs.eg.db'</span>)<br>library(org.Hs.eg.db)<br>library(ggplot2)<br>library(ggstatsplot)<br>library(tidyverse)<br></code></pre><h4 data-tool="mdnice编辑器"><span>4.2 Filtering----</span></h4><p data-tool="mdnice编辑器">去除表达量太低或者在不同时间点间变化太小的基因等步骤</p><p data-tool="mdnice编辑器">Mfuzz聚类时要求是一个ExpressionSet类型的对象，所以需要先用表达量构建这样一个对象。</p><pre data-tool="mdnice编辑器"><span></span><code><span># 转化格式</span><br>gene_tpm &lt;- data.matrix(avereps_df)<br>eset &lt;- new(<span>"ExpressionSet"</span>,exprs = gene_tpm)<br>dim(eset) <span># 共29692个基因</span><br><br><span>#缺失值的处理</span><br><span>#thres参数设定阈值，如果某个基因的缺失值（NA）的百分比大于该阈值，则排除该基因</span><br>gene.r &lt;- filter.NA(eset, thres=0.25)<br><br><span>#填补缺失值</span><br><span>#上一步骤还遗留了一部分缺失值，用该基因在所有样本中的平均值替代缺失值NA，还可以是median（中位数），knn和wknn。如果没有缺失值可以跳过该步骤。</span><br>gene.f &lt;- fill.NA(gene.r,mode=<span>"mean"</span>)<br><span>## knn/wknn方法表现更好，但是计算起来比较复杂</span><br><span>#gene.f &lt;- fill.NA(gene.r,mode="knn")</span><br><span>#gene.f &lt;- fill.NA(gene.r,mode="wknn")</span><br><br><span># 根据标准差去除样本间差异太小的基因</span><br>tmp &lt;- filter.std(gene.f,min.std=0.9) <span>#18285，不同的数据集去除的基因数量不一样 </span><br></code></pre><h4 data-tool="mdnice编辑器"><span>4.3 Standardisation----</span></h4><p data-tool="mdnice编辑器">聚类时需要用一个数值来表征不同基因间的距离，Mfuzz中采用的是欧式距离，</p><p data-tool="mdnice编辑器">由于普通欧式距离的定义没有考虑不同维度间量纲的不同，所以需要先进行标准化</p><pre data-tool="mdnice编辑器"><span></span><code><span>#此处标准化实际为归一化，使每个基因/蛋白的平均表达值为零，标准差为1。 此外，还有standardise2函数可以选择，此时的到的结果为 standardise函数的结果沿着y轴平移，使其起点为零。</span><br>gene.s &lt;- standardise(tmp)<br></code></pre><h4 data-tool="mdnice编辑器"><span>4.4 Setting of parameters for FCM clustering----</span></h4><p data-tool="mdnice编辑器">Mfuzz中的聚类算法需要提供两个参数，</p><pre data-tool="mdnice编辑器"><span></span><code><span># 第一个参数为希望最终得到的聚类的个数，这个参数由我们直接指定或评估</span><br>c &lt;- 9<br><br><span># 第二个参数称之为fuzzifier值，用小写字母m表示，可以通过函数评估一个最佳取值</span><br>m &lt;- mestimate(gene.s) <span>#  评估出最佳的m值</span><br>cl &lt;- mfuzz(gene.s, c = c, m = m) <span># 聚类</span><br><br></code></pre><h4 data-tool="mdnice编辑器"><span>4.5 glimpse results----</span></h4><pre data-tool="mdnice编辑器"><span></span><code><span># 在cl这个对象中就保存了聚类的完整结果，对于这个对象的常见操作如下</span><br>cl<span>$size</span> <span># 查看每个cluster中的基因个数</span><br>cl<span>$cluster</span>[cl<span>$cluster</span> == 1] <span># 提取某个cluster下的基因</span><br><br><span>## cluster cores</span><br><span># membership values can also indicate the similarity of vectors to each other.</span><br>gene.s<br><br>cl.thres &lt;- acore(gene.s,cl,min.acore=0.5)  <span>## a posteriori</span><br>head(cl.thres[[1]])<br>table(cl<span>$cluster</span>)<br>unlist(lapply(cl.thres, nrow))<br></code></pre><h3 data-tool="mdnice编辑器"><span>5. 可视化</span></h3><pre data-tool="mdnice编辑器"><span></span><code>library(RColorBrewer)<br>color.2 &lt;- colorRampPalette(rev(c(<span>"#ff0000"</span>, <span>"Yellow"</span>, <span>"OliveDrab1"</span>)))(1000)<br>pdf(<span>'mfuzz_clusters_plot.pdf'</span>,height = 7,width = 12)<br>mfuzz.plot(gene.s,cl,mfrow=c(3,3),<br>           new.window= FALSE,<br>           time.labels= colnames(gene.s) ,<br>           colo = color.2)<br>dev.off()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5914351851851852" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxbaO0Cc9eeQh5dAkWopIUcMlgOvib1puyuHiaoQspw5OibgYhkuRHEcmiaQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="864" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyXPzImgnf2glTXVGAlKdWxbaO0Cc9eeQh5dAkWopIUcMlgOvib1puyuHiaoQspw5OibgYhkuRHEcmiaQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"><figcaption>可视化结果</figcaption></figure></section><p><br></p><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524240&amp;idx=1&amp;sn=94c9ef8c3d8080c30c8372d4fb5999ab&amp;chksm=9b4bdf2bac3c563def9232bb78f43bcaa13d7c3442b00cf83aaa32ae98f4500883fa8803fb98&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉松授课（买一‍得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a> ，你的生物信息学入门课</section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">时隔5年，我们的生信技能树VIP学徒继续招生啦</a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247522831&amp;idx=2&amp;sn=1744efdf428465425a145ff3a982198b&amp;chksm=9b4bdab4ac3c53a28fbecbbff4f254f470b54a7a20468bb753b295b930315e1ec45bcbabc10b&amp;scene=21#wechat_redirect" textvalue="144线程640Gb内存服务器共享一年‍仍然是仅需800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">144线程640Gb内存服务器共享一年仍然是仅需800</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">千呼万唤始出来的独享生物信息学云服务器</a></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247519765&amp;idx=1&amp;sn=ce5a8c8182f854c88043059f8c2cb9ff&amp;chksm=9b4bceaeac3c47b88c19941d43dbb1401f3a92206481a0afc41159927868199643f795d62a7e&amp;scene=21#wechat_redirect" textvalue="千呼万唤始出来的独享生物信息学云服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"></a><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524275&amp;idx=1&amp;sn=fa592ee29f636f34387491d0fceadd8e&amp;chksm=9b4bdf08ac3c561e0881974b3817beb0a0e514dc1a8df4c34c2b6653da6fa78e09acb03c70c2&amp;scene=21#wechat_redirect" textvalue="生信技能树知识整理实习生又又又开放申请啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信技能树知识整理实习生又又又开放申请啦</a></section></li></ul><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/EyiVXem3T_53wQMG3vRNNw",target="_blank" rel="noopener noreferrer">原文链接</a>
