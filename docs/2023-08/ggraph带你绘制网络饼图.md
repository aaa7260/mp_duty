---
title: "ggraph带你绘制网络饼图"
date: 2023-08-09T19:18:39Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
ggraph带你绘制网络饼图 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span><span></span>欢迎关注R语言数据分析指南</span><span></span></h3><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节来介绍如何使用igraph+scatterpie来绘制网络饼图，下面小编就通过一个案例来进行展示数据为随意构建无实际意义仅作图形展示用，添加了详细的注释希望各位观众老爷能够喜欢，<strong>「数据+代码已经上传2023VIP群，加群的观众老爷请自行下载」</strong>。</p><span>❞</span></blockquote><h3 data-tool="mdnice编辑器"><span></span><span><span></span>关注下方公众号下回更新不迷路</span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg3MzQzNTYzMw==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><h3 data-tool="mdnice编辑器"><span></span><span><span></span>加载R包</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><span>library</span>(igraph)<br><span>library</span>(ggraph)<br><span>library</span>(graphlayouts)<br><span>library</span>(ggforce)<br><span>library</span>(scatterpie)<br><span>library</span>(ggsci)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>案例一</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 设置随机种子，确保结果的可复现性</span><br>set.seed(<span>1439</span>)<br><span># 使用sample_pa函数生成一个包含20个节点的随机无标度网络</span><br>g &lt;- sample_pa(<span>20</span>, <span>1</span>)<br><span># 为网络中的每个节点添加名为"A"的属性，属性值为从均值为0，标准差为1的正态分布中随机生成的绝对值</span><br>V(g)$A &lt;- abs(rnorm(<span>20</span>, sd = <span>1</span>))<br><span># 为网络中的每个节点添加名为"B"的属性，属性值为从均值为0，标准差为2的正态分布中随机生成的绝对值</span><br>V(g)$B &lt;- abs(rnorm(<span>20</span>, sd = <span>2</span>))<br><span># 为网络中的每个节点添加名为"C"的属性，属性值为从均值为0，标准差为3的正态分布中随机生成的绝对值</span><br>V(g)$C &lt;- abs(rnorm(<span>20</span>, sd = <span>3</span>))<br><span># 使用layout_with_stress函数计算节点的布局坐标</span><br>xy &lt;- layout_with_stress(g)<br><span># 将计算得到的节点布局坐标分别赋值给节点属性"x"和"y"</span><br>V(g)$x &lt;- xy[, <span>1</span>]<br>V(g)$y &lt;- xy[, <span>2</span>]<br><br><span># 使用ggraph函数绘制图形，使用"manual"布局，节点的x和y坐标从属性中获取</span><br>ggraph(g, <span>"manual"</span>, x = V(g)$x, y = V(g)$y) +<br>  <span># 添加边的可视化，使用geom_edge_link0函数</span><br>  geom_edge_link0() +<br>  <span># 添加饼图散点，表示节点属性"A"、"B"和"C"的比例</span><br>  geom_scatterpie(cols = c(<span>"A"</span>, <span>"B"</span>, <span>"C"</span>),<br>    data = as_data_frame(g, <span>"vertices"</span>),<br>    colour = <span>NA</span>, pie_scale = <span>2</span>) +<br>  coord_fixed() +   <span># 设置坐标系为等比例缩放</span><br>  theme_graph() +<br>  theme(legend.position = <span>"bottom"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6351851851851852" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvEZicVZPGhYqIpIyBYG3rnRMvdW5C8BWAP3w8sqVDT2unQ6I5FLaaZqrw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvEZicVZPGhYqIpIyBYG3rnRMvdW5C8BWAP3w8sqVDT2unQ6I5FLaaZqrw/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>案例二</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 生成一个包含9个岛屿、40个节点、连接概率为0.4、平均度数为15的网络图</span><br>g &lt;- sample_islands(<span>9</span>, <span>40</span>, <span>0.4</span>, <span>15</span>)<br><span># 使用igraph包中的simplify函数简化网络图，去除重复边和自环</span><br>g &lt;- igraph::simplify(g)<br><span># 为每个节点添加名为"grp"的属性，属性值为重复的1到9，每个值重复40次</span><br>V(g)$grp &lt;- as.character(rep(<span>1</span>:<span>9</span>, each = <span>40</span>))<br><span># 为每个节点添加名为"cat"的属性，属性值从"A"、"B"、"C"中随机采样得到，有放回</span><br>V(g)$cat &lt;- sample(c(<span>"A"</span>, <span>"B"</span>, <span>"C"</span>), vcount(g), replace = <span>TRUE</span>)<br><span># 合并同一组内的节点，形成新的图g_clu，并使用"concat"方式合并节点属性</span><br>g_clu &lt;- contract(g, V(g)$grp, vertex.attr.comb = <span>"concat"</span>)<br><br><span># 为新图g_clu的边添加名为"weight"的属性，所有边的权重设置为1</span><br>E(g_clu)$weight &lt;- <span>1</span><br><span># 使用simplify函数简化新图g_clu，对边的属性使用"sum"方式合并</span><br>g_clu &lt;- simplify(g_clu, edge.attr.comb = <span>"sum"</span>)<br><br><span># 根据节点属性"cat"计算每个组内各个类别（"A"、"B"、"C"）的数量，分别添加为"A"、"B"、"C"的属性</span><br>V(g_clu)$A &lt;- sapply(V(g_clu)$cat, <span>function</span>(x)<br>  sum(x == <span>"A"</span>))<br>V(g_clu)$B &lt;- sapply(V(g_clu)$cat, <span>function</span>(x)<br>  sum(x == <span>"B"</span>))<br>V(g_clu)$C &lt;- sapply(V(g_clu)$cat, <span>function</span>(x)<br>  sum(x == <span>"C"</span>))<br><span># 使用layout_with_stress函数计算节点的布局坐标</span><br>xy &lt;- layout_with_stress(g_clu)<br><span># 将计算得到的节点布局坐标分别赋值给节点属性"x"和"y"</span><br>V(g_clu)$x &lt;- xy[, <span>1</span>]<br>V(g_clu)$y &lt;- xy[, <span>2</span>]<br><br><span># 使用ggraph函数绘制图形，使用"manual"布局，节点的x和y坐标从属性中获取</span><br>ggraph(g_clu, <span>"manual"</span>, x = V(g_clu)$x, y = V(g_clu)$y) +<br>  <span># 添加边的可视化，使用geom_edge_link0函数</span><br>  geom_edge_link0() +<br>  <span># 添加饼图散点，表示节点属性"A"、"B"和"C"的比例，填充颜色为白色，饼图比例尺度为3</span><br>  geom_scatterpie(cols = c(<span>"A"</span>, <span>"B"</span>, <span>"C"</span>),<br>    data = as_data_frame(g_clu, <span>"vertices"</span>),<br>    colour = <span>"white"</span>, pie_scale = <span>3</span>) +<br>  scale_fill_npg() +<br>  coord_fixed() +   <span># 设置坐标系为等比例缩放</span><br>  theme_graph() +<br>  theme(legend.position = <span>"bottom"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6351851851851852" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvEGjuyhfj1aO7ial1GBuPDPL9XFK6BOFlibCvwicuulTiaE8dJwZIDDDiayuw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvEGjuyhfj1aO7ial1GBuPDPL9XFK6BOFlibCvwicuulTiaE8dJwZIDDDiayuw/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>本节介绍到此结束，有需要学习个性化数据可视化的朋友，欢迎到小编的<strong>「淘宝店铺」</strong> <strong>「R语言数据分析指南」</strong>购买<strong>「2023年度会员文档」</strong>同步更新中<strong>「售价149元」</strong>，内容主要包括各种<strong>「高分论文的图表分析复现以及一些个性化图表的绘制」</strong>均包含数据+代码；按照往年数据小编年产出约在150+以上</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">购买后微信发小编订单截图即邀请进新的会员交流群，小编的文档为按年售卖，只包含当年度的<strong>「除系列课程外」</strong>的文档，有需要往年文档的朋友也可下单购买，需要了解更多信息的朋友欢迎交流咨询。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>淘宝扫一扫</span><span></span></h3><figure data-tool="mdnice编辑器"><img data-ratio="1.5751295336787565" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvELiaDk1y3xB88PsPXIu4K75DWamu20IYZAC7tZMyAhnU7eCicFhdgQQRQ/640?wx_fmt=png" data-type="png" data-w="386" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvELiaDk1y3xB88PsPXIu4K75DWamu20IYZAC7tZMyAhnU7eCicFhdgQQRQ/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span><span></span>2023会员群案例展示</span><span></span></h3><p data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvEgZibibYqwsNXSsoyDQrWp7lfFFqxe2bKhZ0XloIoECmxmGic5t8JC97qw/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvEgZibibYqwsNXSsoyDQrWp7lfFFqxe2bKhZ0XloIoECmxmGic5t8JC97qw/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvEDm2pshBVZftpLRUxQhPicxLnP9rtGtnNDY3oZicVibG4FyOh5LGKprl2w/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvEDm2pshBVZftpLRUxQhPicxLnP9rtGtnNDY3oZicVibG4FyOh5LGKprl2w/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvEia979M1bPWt2rlAF1lU7yCqgV9JCdicc3RHVxjlIqSz4JCGaUg5QO5OQ/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvEia979M1bPWt2rlAF1lU7yCqgV9JCdicc3RHVxjlIqSz4JCGaUg5QO5OQ/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvENQgMuvOuRYzO5Bbianbdh9YCkQL6QyjwgibtfRVkHNW03sSwd5YAXu9A/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvENQgMuvOuRYzO5Bbianbdh9YCkQL6QyjwgibtfRVkHNW03sSwd5YAXu9A/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvEkVYHibibComLPkENYC1558ZEDXymQickqZqyextoQXaibNNHibzrta5P3KA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvEkVYHibibComLPkENYC1558ZEDXymQickqZqyextoQXaibNNHibzrta5P3KA/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvE2HI7Ku2ZaBKAr7uic1pdCS9GicJ8cOQMPlrB3nQTbSgruhMlnfx6fjRg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvE2HI7Ku2ZaBKAr7uic1pdCS9GicJ8cOQMPlrB3nQTbSgruhMlnfx6fjRg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvErU7cbN07epWkH2dNPvXxO6LShwNPSr6I3txWkGrEHnuGAhsP9eXvNg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvErU7cbN07epWkH2dNPvXxO6LShwNPSr6I3txWkGrEHnuGAhsP9eXvNg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvEmx0zoL48qOicrDnK1QRY5fcF9xicice9VibWZuUNqEFbzgSKYB9ia3tu4fg/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvEmx0zoL48qOicrDnK1QRY5fcF9xicice9VibWZuUNqEFbzgSKYB9ia3tu4fg/640?wx_fmt=png"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvE8duZjL3iboFwP7BIQaLrsOMibaz7WH9GribDpnicZIrYwQJ74ChC7dcWQA/640?wx_fmt=png" data-type="png" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbr1mGIz2cgdS05HPSNXmvE8duZjL3iboFwP7BIQaLrsOMibaz7WH9GribDpnicZIrYwQJ74ChC7dcWQA/640?wx_fmt=png"></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/GK1aa7J-m7P2rqeGO7Fwhg",target="_blank" rel="noopener noreferrer">原文链接</a>
