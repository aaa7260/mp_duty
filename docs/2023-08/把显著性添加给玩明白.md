---
title: "把显著性添加给玩明白"
date: 2023-08-25T08:55:13Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
把显著性添加给玩明白 by 生信星球
------
<div><section data-mpa-powered-by="yiban.io"><span>‍</span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png"><span> 今天是生信星球陪你的<span><strong>第925天</strong></span></span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="64" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"></section><hr><section><span><span>   </span><span>大神一句话，菜鸟跑半年。我不是大神，但我可以缩短你走弯路的半年~</span></span></section><section><span>   就像歌儿唱的那样，如果你不知道该往哪儿走，就留在这学点生信好不好~</span></section><p><span>   这里有豆豆和花花的学习历程，从新手到进阶，生信路上有你有我！</span></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><span>最近发现简书上传图片的功能。。。失灵了。可能距离倒闭又近了一步。</span></p><p><img data-galleryid="" data-ratio="0.5314814814814814" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbuJhE3ibUhZEgSOvBTYOTYYSIIFhtk6qX0t9drU8QcOXicxaRSQtiapQ20w/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbuJhE3ibUhZEgSOvBTYOTYYSIIFhtk6qX0t9drU8QcOXicxaRSQtiapQ20w/640?wx_fmt=png"></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><br></p><h3 data-tool="mdnice编辑器"><span></span><span>1.编示例数据</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>set.seed(10086)<br>exp = matrix(rnorm(480,mean = 6),ncol = 120)<br>exp = round(exp,2)<br>rownames(exp) = paste0(<span>"gene"</span>,1:4)<br>colnames(exp) = paste0(<span>"test"</span>,1:120)<br>exp[,50:80] = exp[,50:80]+2<br>exp[,90:120] = exp[,90:120]+4<br>exp[1:4,1:4]<br></code></pre><p data-tool="mdnice编辑器">到这一步，拿到了一个编的表达矩阵。</p><h3 data-tool="mdnice编辑器"><span></span><span>2.格式转换</span><span></span></h3><p data-tool="mdnice编辑器">表达矩阵要画ggplot2箱线图，肯定是要先转变格式的，否则ggplot2代码无法下手写。</p><pre data-tool="mdnice编辑器"><span></span><code>library(tidyr)<br>library(tibble)<br>library(dplyr)<br>dat = t(exp) %&gt;% <br>  as.data.frame() %&gt;% <br>  rownames_to_column() %&gt;% <br>  mutate(group = rep(c(<span>"control"</span>,<span>"treat1"</span>,<span>"treat2"</span>),each = 40))<br><br>pdat = dat%&gt;% <br>  pivot_longer(cols = starts_with(<span>"gene"</span>),<br>               names_to = <span>"gene"</span>,<br>               values_to = <span>"value"</span>)<br>head(pdat)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>3.画箱线图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>library(ggplot2)<br>p1 = ggplot(pdat, aes(y=value, x=gene))+<br>  geom_boxplot(aes(fill=group),outlier.shape = NA)+<br>  theme_bw()+<br>  scale_fill_manual(values = c(<span>"#2fa1dd"</span>, <span>"#f87669"</span>, <span>"#e6b707"</span>))<br>p1<br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.7138888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbumS8IpdP3aibSRDlFkrgJwuKz7oySezeRevpRtT3MFjBkI51XOJuFLiag/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbumS8IpdP3aibSRDlFkrgJwuKz7oySezeRevpRtT3MFjBkI51XOJuFLiag/640?wx_fmt=png"><img data-ratio="0.7138888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbuX8YadicibUia6YVe8bgIVYoib7f5KBhpzXU6u2Rr3G0SPsnYHfTO6lDicjg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbuX8YadicibUia6YVe8bgIVYoib7f5KBhpzXU6u2Rr3G0SPsnYHfTO6lDicjg/640?wx_fmt=png"></p><h3 data-tool="mdnice编辑器"><span></span><span>4.加显著性标记</span><span></span></h3><h4 data-tool="mdnice编辑器"><span><span> </span></span><span><span> </span>4.1习以为常版</span><span><span> </span></span></h4><pre data-tool="mdnice编辑器"><span></span><code>library(ggpubr)<br>p1 + <br>  stat_compare_means(aes(group = group, label = after_stat(p.signif)),method = <span>"wilcox.test"</span>)<br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.7138888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbulwe23ShbDnhEC2SAvMevG1iczSGfsXmrTC32yB0Mvy5YF8SI0hWX3ug/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbulwe23ShbDnhEC2SAvMevG1iczSGfsXmrTC32yB0Mvy5YF8SI0hWX3ug/640?wx_fmt=png"><img data-ratio="0.7138888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbuzb6nRysGyibRGHgjghYzQXJBlicu2O4Jo67bSXicDjcfcibatXicEZCQqGA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbuzb6nRysGyibRGHgjghYzQXJBlicu2O4Jo67bSXicDjcfcibatXicEZCQqGA/640?wx_fmt=png">这个超级简单，但显著性统一在头顶上，然后也不支持每个基因在两两分组中的显著性单独计算。</p><h4 data-tool="mdnice编辑器"><span><span> </span></span><span><span> </span>4.2 错落有致版</span><span><span> </span></span></h4><p data-tool="mdnice编辑器">用rstatix里的函数计算出显著性和添加显著性的横纵坐标位置，再用stat_pvalue_manual添加上去。</p><pre data-tool="mdnice编辑器"><span></span><code>library(rstatix)<br>stat.test &lt;- pdat %&gt;% <br>  group_by(gene) %&gt;% <br>  wilcox_test(value ~ group) %&gt;%<br>  adjust_pvalue() %&gt;% <br>  add_significance(<span>"p.adj"</span>) %&gt;% <br>  add_xy_position(x=<span>"gene"</span>)<br>p1 + stat_pvalue_manual(stat.test,label = <span>"p.adj.signif"</span>,hide.ns = F,<br>                   tip.length = 0.01)<br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.7138888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbuyrqeToIEFRKqwE3C3BzEHb313WSYFTH5ib909pCb2XicLUaWzMG3Ekag/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbuyrqeToIEFRKqwE3C3BzEHb313WSYFTH5ib909pCb2XicLUaWzMG3Ekag/640?wx_fmt=png"><img data-ratio="0.7138888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbuHbCOAVYmgQwEicvWdosZ4xZNafcrBc25w2E5jsWNb7LiaeI8Ie4Cviajw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbuHbCOAVYmgQwEicvWdosZ4xZNafcrBc25w2E5jsWNb7LiaeI8Ie4Cviajw/640?wx_fmt=png"></p><h4 data-tool="mdnice编辑器"><span><span> </span></span><span><span> </span>4.3 手动添加版</span><span><span> </span></span></h4><p data-tool="mdnice编辑器">例如上次画的<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247493702&amp;idx=1&amp;sn=fac8689b99aa40b90378307d1b5456b4&amp;chksm=fdfba004ca8c29120b262a1342865c0d42ce86d4bcc5475c7ede1918c10b5e7ebe77ddf4b027&amp;scene=21#wechat_redirect" textvalue="AUC值柱状图" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><strong>AUC值柱状图</strong></a>，它的纵坐标和误差棒不是画图时计算出来的，而是拿了现成的数值来画，就无法用上面的方法计算。如果能自行用其他方法计算出组间比较的显著性如何，可以手动添加。</p><p data-tool="mdnice编辑器">这里的dats数据来自点他👉<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247493702&amp;idx=1&amp;sn=fac8689b99aa40b90378307d1b5456b4&amp;chksm=fdfba004ca8c29120b262a1342865c0d42ce86d4bcc5475c7ede1918c10b5e7ebe77ddf4b027&amp;scene=21#wechat_redirect" textvalue="AUC值柱状图" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><strong>AUC值柱状图</strong></a></p><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br>load(<span>"dats.Rdata"</span>)<br>p = ggplot(dats, aes(x = category, y = y, fill = x)) +<br>  geom_bar(<span>stat</span> = <span>"identity"</span>, position = <span>"dodge"</span>) +<br>  geom_text(aes(label = round(y,2)), vjust = 4, size = 3,<br>            position = position_dodge(width = 0.9)) +<br>  geom_errorbar(aes(ymin = min, ymax = max), <br>                width = 0.2,<br>                position = position_dodge(width = 0.9)) +<br>  scale_fill_manual(values = c(<span>"#2fa1dd"</span>, <span>"#f87669"</span>, <span>"#e6b707"</span>))+<br>  theme_bw()<br>p<br></code></pre><p data-tool="mdnice编辑器"><img data-ratio="0.7138888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbukicPBGws3VPcktX5HCia8xgAO2Sc77DDvGApvickmXwkLF1oaUaSWUdkw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbukicPBGws3VPcktX5HCia8xgAO2Sc77DDvGApvickmXwkLF1oaUaSWUdkw/640?wx_fmt=png"><img data-ratio="0.7138888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbujQlfR6sxHmOg3jDllrcxdrF1MlibibI9vZtjtEAM1y9YhdEYxunnRNicA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHqMEVlBZlDqT1icPCqUCiarbujQlfR6sxHmOg3jDllrcxdrF1MlibibI9vZtjtEAM1y9YhdEYxunnRNicA/640?wx_fmt=png"></p></section></section><p><span></span></p><section><blockquote><section><span>如果因为代码看不懂，而跟不上正文的节奏，可以来找我，相当于来一个新手保护期。我的</span><span>课程都是循环开课。</span><span>下一期的时间，点进去咨询微信咯</span><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247493441&amp;idx=1&amp;sn=95e2cc24fda53117ae312d6644c1b221&amp;chksm=fdfbaf03ca8c2615d80969e56cf8863219c0afd2efd0dca01b907a3c815b73ef9f77d90bdb0c&amp;scene=21#wechat_redirect" textvalue="新的一年，你要不要来找我‍们学‍习生信" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">找我们学习生信</a></section></blockquote></section><section><section><br></section></section><section><br></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/d7fnlFwA-s0Ck8woAJHbuw",target="_blank" rel="noopener noreferrer">原文链接</a>
