---
title: "泛癌的免疫浸润可视化（附小豆花讲课视频）"
date: 2022-11-20T05:27:49Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
泛癌的免疫浸润可视化（附小豆花讲课视频） by 生信星球
------
<div><section data-mpa-powered-by="yiban.io"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png"><span> 今天是生信星球陪你的<span><strong>第880天</strong></span></span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-type="png" data-w="20" width="20px" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"></section><hr><p><span><span>   </span><span>大神一句话，菜鸟跑半年。我不是大神，但我可以缩短你走弯路的半年~</span></span></p><p><span>   就像歌儿唱的那样，如果你不知道该往哪儿走，就留在这学点生信好不好~</span></p><p><span>   这里有豆豆和花花的学习历程，从新手到进阶，生信路上有你有我!</span></p><section><blockquote><p>好久不见！我的产假还剩一个多月，小娃娃两个半月了，天使宝宝，省爹省妈，所以我也有些时间了，陆续开始学习和备课，整理资料咯。</p></blockquote><p>从Timer2.0的主页发现了一个优秀的资源：</p><figure><img data-ratio="0.5298387096774193" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDuzHDiakHoEKD6MazBfBGLhvqWu4MxrOjLK1c9eDiaf44dppLMOxNRaRchrXfFKZC3u7O8oqJJvWg/640?wx_fmt=png" data-type="png" data-w="1240" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDuzHDiakHoEKD6MazBfBGLhvqWu4MxrOjLK1c9eDiaf44dppLMOxNRaRchrXfFKZC3u7O8oqJJvWg/640?wx_fmt=png"><figcaption></figcaption></figure><figure><img data-ratio="0.44193548387096776" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDuzHDiakHoEKD6MazBfBGLUibIib4KF8eohc1IZGZJBy28GONiaxAe2iaSYHcs4Iocm7icUoZTvtJynxA/640?wx_fmt=png" data-type="png" data-w="1240" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDuzHDiakHoEKD6MazBfBGLUibIib4KF8eohc1IZGZJBy28GONiaxAe2iaSYHcs4Iocm7icUoZTvtJynxA/640?wx_fmt=png"><figcaption></figcaption></figure><blockquote><p>http://timer.comp-genomics.org/infiltration_estimation_for_tcga.csv.gz</p></blockquote><p>这里面是各种方法计算出的TCGA免疫浸润结果。有现成的结果，做图就完全是R语言技巧的输出咯。</p><p>可以做接下来的几件事：</p><p>1.将某一方法计算出来的免疫浸润结果拆分成单独的数据框。</p><p>2.绘制箱线图，展示某种免疫细胞在所有癌症中，tumor和normal的丰度比较。</p><p>3.绘制箱线图，展示某种免疫细胞在所有癌症中，tumor样本的丰度，并按照中位数从小到大排好顺序。</p><p>你可以先自己试试，再看我写的答案。</p><h4><span><span> </span>1.拆分</span></h4><pre><code>rm(list = ls())<br>a = read.csv("infiltration_estimation_for_tcga.csv.gz",<br>             row.names = 1,<br>             check.names = F)<br>head(colnames(a))<br><span>#</span><span># [1] "B cell_TIMER"                 "T cell CD4+_TIMER"           </span><br><span>#</span><span># [3] "T cell CD8+_TIMER"            "Neutrophil_TIMER"            </span><br><span>#</span><span># [5] "Macrophage_TIMER"             "Myeloid dendritic cell_TIMER"</span><br>library(stringr)<br>b = str_split(colnames(a),"_",simplify = T) %&gt;% as.data.frame()<br>colnames(b) = c("cell","method")<br><span>table(b$</span><span>method)</span><br><span>#</span><span># </span><br><span>#</span><span>#     CIBERSORT CIBERSORT-ABS          EPIC    MCPCOUNTER     QUANTISEQ </span><br><span>#</span><span>#            22            22             8            11            11 </span><br><span>#</span><span>#         TIMER         XCELL </span><br><span>#</span><span>#             6            39</span><br>k = b$method=="CIBERSORT";table(k)<br><span>#</span><span># k</span><br><span>#</span><span># FALSE  TRUE </span><br><span>#</span><span>#    97    22</span><br>ciber = a[,k]<br>colnames(ciber) = str_remove(colnames(ciber),"_CIBERSORT")<br>ciber[1:4,1:4]<br><span>#</span><span>#                 B cell naive B cell memory B cell plasma T cell CD8+</span><br><span>#</span><span># TCGA-OR-A5J1-01  0.002937309   0.002282572    0.00000000  0.11294112</span><br><span>#</span><span># TCGA-OR-A5J2-01  0.046380291   0.000000000    0.15149520  0.07351904</span><br><span>#</span><span># TCGA-OR-A5J3-01  0.061034875   0.000000000    0.19053762  0.01649453</span><br><span>#</span><span># TCGA-OR-A5J5-01  0.253704390   0.000000000    0.03964469  0.03734717</span><br></code></pre><h4><span><span> </span>2.泛癌的tumor和normal某种细胞丰度比较</span></h4><p>需要泛癌临床信息，才能知道每个样本属于哪种癌症。可以从xena下载</p><blockquote><p>https://tcga-pancan-atlas-hub.s3.us-east-1.amazonaws.com/download/Survival_SupplementalTable_S1_20171025_xena_sp</p></blockquote><pre><code><span>#整理临床信息，使其与免疫细胞丰度矩阵行名一致</span><br>m = read.delim(<span>"Survival_SupplementalTable_S1_20171025_xena_sp"</span>,row.names = 1)<br>y = intersect(rownames(ciber) , rownames(m));length(y)<br><span>## [1] 11031</span><br>ciber = ciber[y,]<br>m = m[y,]<br>identical(rownames(ciber),rownames(m))<br><span>## [1] TRUE</span><br><span>#做图</span><br>library(ggplot2)<br>ciber$type = m$cancer.type.abbreviation<br>ciber$Group =  ifelse(str_sub(rownames(ciber),14,15)&lt;10,<span>"tumor"</span>,<span>"normal"</span>)<br>ggplot(ciber,aes(x = type,y = `B cell naive`))+<br>  geom_boxplot(aes(fill = Group),alpha = 0.7)+<br>  scale_fill_manual(values = c(<span>"navy"</span>,<span>"firebrick3"</span>))+<br>  theme_bw()+<br>  theme(axis.text.x = element_text(angle = 90,vjust = 0.5))<br></code></pre><figure><img data-ratio="0.714516129032258" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDuzHDiakHoEKD6MazBfBGLhsBduAT7J36sE4jMtbia4BuaSB5LVoqGocPzZ2pBwBbpazcm6m3WwcA/640?wx_fmt=png" data-type="png" data-w="1240" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDuzHDiakHoEKD6MazBfBGLhsBduAT7J36sE4jMtbia4BuaSB5LVoqGocPzZ2pBwBbpazcm6m3WwcA/640?wx_fmt=png"><figcaption></figcaption></figure><h4><span><span> </span>3.某种免疫细胞的丰度在所有tumor中的比较</span></h4><p>随便拿一个细胞B cell naive来画。</p><pre><code>library(dplyr)<br>dat = ciber[ciber<span>$Group</span>==<span>"tumor"</span>,]<br><span>#利用因子，调整横坐标顺序</span><br>dat2 = group_by(dat,<span>type</span>) %&gt;% <br>  summarise(median = median(`B cell naive`)) %&gt;% <br>  arrange(median)<br>dat<span>$type</span>=factor(dat<span>$type</span>,levels = dat2<span>$type</span>)<br>library(ggplot2)<br>ggplot(dat,aes(<span>type</span>,`B cell naive`))+<br>  geom_boxplot(outlier.size = 0.5)+<br>  theme_bw()+<br>  theme(axis.text.x = element_text(angle = 90,vjust = 0.5))<br></code></pre><figure><img data-ratio="0.714516129032258" data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDuzHDiakHoEKD6MazBfBGL90dfyOayRMeOrgicAmL6Cu619xKogk4iatjvCLtiaUh27O6JibBs0rEaVQ/640?wx_fmt=png" data-type="png" data-w="1240" title="" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDuzHDiakHoEKD6MazBfBGL90dfyOayRMeOrgicAmL6Cu619xKogk4iatjvCLtiaUh27O6JibBs0rEaVQ/640?wx_fmt=png"><span>具体的代码让小豆花老师讲讲吧。</span></figure><section><mpvideosnap data-pluginname="videosnap" data-id="export/UzFfAgtgekIEAQAAAAAAgdk61t8NCwAAAAstQy6ubaLX4KHWvLEZgBPE74FYeDxefvyBzNPgMIsYqjGxK5ZnDTozC_nBSXDV" data-url="https://findermp.video.qq.com/251/20304/stodownload?encfilekey=oibeqyX228riaCwo9STVsGLIBn9G5YG8ZnFwVVE97z6HyuwNIoDEjhNltLZvgAVHMxc9bW0J4U8HGMhAibfpj9q9dA2Lcnwy4qkst6zZ246rZBNRpRV2QKd5nNny2DictXLnA6WARxgTbp0&amp;adaptivelytrans=0&amp;bizid=1023&amp;dotrans=0&amp;hy=SZ&amp;idx=1&amp;m=daf986676504e3c6ca73c2619507b0eb&amp;token=x5Y29zUxcibCTLKTibqke3OS0WuTuuaZ7RK7OYLCzDbPhlfZd4iaVL3jVkBf0syNI6oFtLD1exc3CQ" data-headimgurl="http://wx.qlogo.cn/finderhead/YCOL3hU8ffXkWkMgVonmk1IkU7GYhLtQca5KCUhYGX4su7HIhjKZEg/0" data-username="v2_060000231003b20faec8c5e48b1acad4cf07e431b07759bd83114e64cb0c5fcc965453218e44@finder" data-nickname="小洁忘了怎么分身" data-desc="小豆花老师上线啦" data-nonceid="5476976623119552663" data-type="video" data-authiconurl="" data-width="1920" data-height="1080"></mpvideosnap></section><figure><span></span></figure></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><figure data-tool="mdnice编辑器"><span></span></figure></section></section><section><blockquote><section><span>如果因为代码看不懂，而跟不上正文的节奏，可以来找我，系统学习。</span><span>以下课程都是循环开课。</span><span>下一期的时间，点进去咨询微信咯</span><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247491811&amp;idx=1&amp;sn=4cc080b01f8b7d6a2459927b567c8c63&amp;chksm=fdfba8a1ca8c21b75d168d643003f9f68d5fe3b3e6dfb836288fe4ebc70abe749b83ae49455f&amp;scene=21#wechat_redirect" textvalue="生信零基础入门‍学习小组" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2"><span>生信零基础入门学习小组</span></a></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247492124&amp;idx=3&amp;sn=c8e409575fa147f90e961281d44a6800&amp;chksm=fdfbaa5eca8c23488eef4fa0411a1cf96ac25708de0e21ea4133a5f9f90e2955021273eb9063&amp;scene=21#wechat_redirect" textvalue="生信入门班（四周线‍上直播课）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2"><span>生信入门班（四周线上直播课）</span></a></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247492124&amp;idx=2&amp;sn=cc1935138c0888bd9c78dcbe1b7f79f5&amp;chksm=fdfbaa5eca8c23488dbb592fe35c1cae887b528402641b04edea1db4baf3fee31283d961556e&amp;scene=21#wechat_redirect" textvalue="数据挖掘班（医生‍/医学生首选）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2"><span>数据挖掘班（医生/医学生首选）</span></a></section></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/NYnjfWPvjsQVlGnZlFxryg",target="_blank" rel="noopener noreferrer">原文链接</a>
