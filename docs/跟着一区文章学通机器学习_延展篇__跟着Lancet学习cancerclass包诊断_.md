---
title: "跟着一区文章学通机器学习（延展篇）：跟着Lancet学习cancerclass包诊断！"
date: 2022-11-30T06:41:57Z
draft: ["false"]
tags: [
  "fetched",
  "生信作曲家"
]
categories: ["Acdemic"]
---
跟着一区文章学通机器学习（延展篇）：跟着Lancet学习cancerclass包诊断！ by 生信作曲家
------
<div><section><h3><span>前言</span><br></h3><blockquote><p><span></span><span>生信作曲家一直致力于构建国内</span><span><strong>和谐、开放、可持续</strong></span><span><strong>的生物信息交流平台</strong>。生信作曲家的目标是<strong>为每个科研人扫清科研路上的一切障碍，让生物信息学人人可做</strong>。目前，生信作曲家已推出</span><span><strong>"</strong><strong>跟着一区文章学通机器学习</strong><strong>"</strong></span><span>，<strong>"</strong><strong>跟着一区文章学通单细胞</strong><strong>"</strong><strong>，Bootstrap，CIBERSORTx, NTP, TICPE，metaVIPER算法</strong></span><span>等多种强力教程，同时也兼具</span><strong><span>GEO数据库</span></strong><span>，</span><span><strong>ICGC数据库</strong></span><span>数据整理等核心入门技术教学，开办</span><span><strong>发文计划RS，暑期</strong><strong>发文计划max,ultra，7天发文A计划</strong><strong>，五一创新发文计划pro</strong></span><span><strong>，生信中秋分享会、小年夜分享会、暑期集训营和冬季集训营</strong>等多次。辅导同学实现纯生信SCI发表硕果累累，帮助同学实现医学事业路上的理想与追求。</span><span></span></p></blockquote><p><span>机器学习的诊断模型，包括逻辑回归、NB,SVM想必大家都已学会，<strong>今天我们向大家介绍cancerclass方法，这也是一种可以用于疾病诊断的算法</strong></span><span><strong>，最早被lancet提出。，</strong></span><span><strong>尤其适用于</strong></span><span><strong>高维</strong></span><span><strong>的高通量数据。</strong></span></p><p><img data-galleryid="" data-ratio="0.5953488372093023" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB3Ye0xqgKEzkFPeac9chicntoq5aWz7UByh4ZAnKnym3fGmWkxicnM0PKRzUF7oAO5YM7TKLNbsXiaw/640?wx_fmt=png" data-type="png" data-w="1075" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB3Ye0xqgKEzkFPeac9chicntoq5aWz7UByh4ZAnKnym3fGmWkxicnM0PKRzUF7oAO5YM7TKLNbsXiaw/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.6102409638554217" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB3Ye0xqgKEzkFPeac9chicnXjpreiciatPmmibJXBb7FtS7DbXt23mibsedCrPIoibQzsxdK8EZekfs9fw/640?wx_fmt=png" data-type="png" data-w="1660" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB3Ye0xqgKEzkFPeac9chicnXjpreiciatPmmibJXBb7FtS7DbXt23mibsedCrPIoibQzsxdK8EZekfs9fw/640?wx_fmt=png"></p><h3><span>代码实操</span></h3><pre><code><span>#####################cancerclass###########################</span><br>setwd(<span>'e:/work/benke/pan_scRNA/'</span>)<br><br><span>###===loading data===###</span><br><span>library</span>(stringr)<br><span>library</span>(gridExtra)<br><span>library</span>(future)<br><span>library</span>(sva)<br><span>library</span>(e1071)<br><span>library</span>(pROC)<br><span>library</span>(ROCit)<br><span>library</span>(caret)<br><span>library</span>(doParallel)<br><span>#BiocManager::install('cancerclass')</span><br><span>library</span>(cancerclass)<br><br>load(<span>'train_validation_set.Rdata'</span>)<br><br><br><span>## 普通逻辑回归作为参照</span><br><span>##################普通逻辑回归############################</span><br><span>#训练</span><br>model_logi=glm(data=training,formula = response ~ .,family= binomial(link=<span>'logit'</span>))<br><br><span># 验证</span><br><span># 基于概率</span><br>prob &lt;- predict(model_logi,validation[,-<span>1</span>],type = <span>"response"</span>)<br><br>pROC::plot.roc(validation$response,prob,print.auc=<span>T</span>)<br><br><span>### 强大的逻辑回归表现并不好！！！</span><br></code></pre><figure><figcaption><img data-ratio="1.0330459770114941" data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB3Ye0xqgKEzkFPeac9chicnxdEUXMlINMq1NjYY8cSM4O4NIWIRFEiah789X2UG8vv9kgDBol1HBAw/640?wx_fmt=png" data-type="png" data-w="696" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB3Ye0xqgKEzkFPeac9chicnxdEUXMlINMq1NjYY8cSM4O4NIWIRFEiah789X2UG8vv9kgDBol1HBAw/640?wx_fmt=png"></figcaption></figure><pre><code><span>###### 对cancerclass#################</span><br><span>###训练</span><br><span># 结局变量</span><br><span>library</span>(cancerclass)<br>pData &lt;- data.frame(class = training$response, sample = rownames(training),row.names = rownames(training))<br>phenoData &lt;- new(<span>"AnnotatedDataFrame"</span>,data=pData)<br><span># 预测变量</span><br>Exp &lt;- t(training[,-<span>1</span>])<br>Exp.train &lt;- ExpressionSet(assayData=as.matrix(Exp),phenoData=phenoData)<br><br>predictor &lt;- cancerclass::fit(Exp.train, method = <span>"welch.test"</span>) <br>model.tune &lt;- predictor<br><br><br><span>### 预测##################</span><br><br>pData_test &lt;- data.frame(class = validation$response, sample = rownames(validation),row.names = rownames(validation))<br>phenoData_test &lt;- new(<span>"AnnotatedDataFrame"</span>,data=pData_test)<br>Exp &lt;- t(validation[,-<span>1</span>])<br>Exp.test &lt;- ExpressionSet(assayData=as.matrix(Exp),phenoData=phenoData_test)<br>prediction &lt;- predict(model.tune, Exp.test,<span>"NR"</span>, ngenes=nrow(Exp), dist = <span>"cor"</span>)<br>roc &lt;- roc(response  = prediction@prediction[,<span>'class_membership'</span>],<br>           predictor = as.numeric(prediction@prediction[,<span>'z'</span>])<br>)<br>plot.roc(roc,print.auc=<span>T</span>,print.thres=<span>T</span>)<br>roc_result &lt;- coords(roc, <span>"best"</span>)<br><br><span>##ROC得到了一定的提升，</span><strong><span>相比于逻辑回归有提升，这是很不容易的</span></strong><br></code></pre><figure><figcaption><img data-ratio="1.0231362467866323" data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB3Ye0xqgKEzkFPeac9chicnNku1b5d5MLxLn6pLQkGGYSGzsOLGlkfibEc7YoPkAfB2kbPOSYX1jlw/640?wx_fmt=png" data-type="png" data-w="778" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB3Ye0xqgKEzkFPeac9chicnNku1b5d5MLxLn6pLQkGGYSGzsOLGlkfibEc7YoPkAfB2kbPOSYX1jlw/640?wx_fmt=png"></figcaption></figure><h3><span>后记</span></h3><p>交流更多，加交流群，备注 加群</p><p><img data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB9Vq4TQbMtR81HOfuhy7jkZsUypgwNYHTiaEFuvXNqI8z2nlDYc7tbrJ4o7W7dAgqRQPp2lDqfLbA/640?wx_fmt=png" data-type="png" data-w="512" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB9Vq4TQbMtR81HOfuhy7jkZsUypgwNYHTiaEFuvXNqI8z2nlDYc7tbrJ4o7W7dAgqRQPp2lDqfLbA/640?wx_fmt=png"></p><p><br></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/nBJdRRjbZ_UOrswOdWUF9w",target="_blank" rel="noopener noreferrer">原文链接</a>
