---
title: "R 利用美元符号$进行自动补全是怎么实现的？"
date: 2023-01-11T14:33:45Z
draft: ["false"]
tags: [
  "fetched",
  "优雅R"
]
categories: ["Acdemic"]
---
R 利用美元符号$进行自动补全是怎么实现的？ by 优雅R
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">我们知道在使用 R 的过程中，当我们访问列表、数据框等对象时，在对象后键入美元符号 <code>$</code> 会弹出关于自动补全的提示，这在 RStduio 中编写代码时非常方便好用，那么它是如何实现的呢？</p><p data-tool="mdnice编辑器">首先，这跟 RStduio 无关，因为如果你在终端中使用 R 的话，键入美元符号后再使用 <code>&lt;Tab&gt;</code> 键，也是会有自动提示的。所以，R 本身通过某种实现完成了这一提示。</p><p data-tool="mdnice编辑器">这里我们利用网上的一个简单例子来了解这一过程。</p><pre data-tool="mdnice编辑器"><span></span><code><span># Define class</span><br>setClass(<span>"customList"</span>,<br>         representation(<span>"list"</span>)<br>)<br> <br><span># Make example</span><br>tmp &lt;- new(<span>"customList"</span>,<br>           list(<br>             <span>test</span>=<span>'a'</span>,<br>             b=1:3<br>           )        <br>)<br> <br>tmp<br></code></pre><p data-tool="mdnice编辑器">上面创建了一个简单的类和相应的实例 <code>tmp</code>。</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; tmp<br>An object of class <span>"customList"</span><br>[[1]]<br>[1] <span>"a"</span><br> <br>[[2]]<br>[1] 1 2 3<br></code></pre><p data-tool="mdnice编辑器">当我们键入 <code>tmp$</code> 后，编辑器很智能地弹出了自动补全提示：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.6" data-src="https://mmbiz.qpic.cn/mmbiz_png/mPqFmhtlSJwC6u57QDcW7ABNUVjFj6WbibsFFN3n1iaicjtFQBfPibMVZOFaUaRAzZR7SkQBVJ5LRKxDbFkA34yqiaw/640?wx_fmt=png" data-type="png" data-w="290" src="https://mmbiz.qpic.cn/mmbiz_png/mPqFmhtlSJwC6u57QDcW7ABNUVjFj6WbibsFFN3n1iaicjtFQBfPibMVZOFaUaRAzZR7SkQBVJ5LRKxDbFkA34yqiaw/640?wx_fmt=png"><figcaption>image</figcaption></figure><p data-tool="mdnice编辑器">实际上在这一过程中，R 调用了一个默认的隐藏泛型函数 <code>.DollarNames()</code>。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5219399538106235" data-src="https://mmbiz.qpic.cn/mmbiz_png/mPqFmhtlSJwC6u57QDcW7ABNUVjFj6WbV0whLf5G6moPUwJnAqbicUPqRk6ttkxPGd2ibmElEZIroEUp3eHILCwA/640?wx_fmt=png" data-type="png" data-w="866" src="https://mmbiz.qpic.cn/mmbiz_png/mPqFmhtlSJwC6u57QDcW7ABNUVjFj6WbV0whLf5G6moPUwJnAqbicUPqRk6ttkxPGd2ibmElEZIroEUp3eHILCwA/640?wx_fmt=png"><figcaption>image-1673428611201</figcaption></figure><p data-tool="mdnice编辑器">现在我们构造了一个新的类，那么添加新的匹配方法是可以更改自动补全的。</p><pre data-tool="mdnice编辑器"><span></span><code>.DollarNames.customList &lt;- <span>function</span>(x, pattern=<span>""</span>) {<br>  grep(pattern, names(x), value=TRUE)[1]<br>}<br></code></pre><p data-tool="mdnice编辑器">运行完上面的代码后，我们再来看补全，它就变成了只返回第一个元素的名字：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.4380165289256198" data-src="https://mmbiz.qpic.cn/mmbiz_png/mPqFmhtlSJwC6u57QDcW7ABNUVjFj6WbcHlJAj3sbwYXIPuXU3ibygmoqA3uNibYPZiax3j2KBoml3MdtgfQoSSwg/640?wx_fmt=png" data-type="png" data-w="242" src="https://mmbiz.qpic.cn/mmbiz_png/mPqFmhtlSJwC6u57QDcW7ABNUVjFj6WbcHlJAj3sbwYXIPuXU3ibygmoqA3uNibYPZiax3j2KBoml3MdtgfQoSSwg/640?wx_fmt=png"><figcaption>image-1673432084352</figcaption></figure><p data-tool="mdnice编辑器">了解了这个之后，我们就算要魔改也是 okay 的！</p><p data-tool="mdnice编辑器">试着改不存在的名称：</p><pre data-tool="mdnice编辑器"><span></span><code>.DollarNames.customList &lt;- <span>function</span>(x, pattern=<span>""</span>) {<br>  c(<span>"a"</span>, <span>"b"</span>, <span>"c"</span>)<br>}<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.3414634146341464" data-src="https://mmbiz.qpic.cn/mmbiz_png/mPqFmhtlSJwC6u57QDcW7ABNUVjFj6WbJPqqXEFQdSSlyh7Jg84c0hDzMlLlt780g0vcU2IZszcWjRT4C25wicQ/640?wx_fmt=png" data-type="png" data-w="164" src="https://mmbiz.qpic.cn/mmbiz_png/mPqFmhtlSJwC6u57QDcW7ABNUVjFj6WbJPqqXEFQdSSlyh7Jg84c0hDzMlLlt780g0vcU2IZszcWjRT4C25wicQ/640?wx_fmt=png"><figcaption>image-1673432170893</figcaption></figure><p data-tool="mdnice编辑器">R 就是这么任性啊。</p><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">参考：https://stackoverflow.com/questions/31938567/r-enable-autocompletion-in-custom-class</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/RArQA0Xp6C1MykijgRWtxA",target="_blank" rel="noopener noreferrer">原文链接</a>
