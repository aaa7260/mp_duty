---
title: "差异分析不是这样做的……"
date: 2022-12-20T06:05:05Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
差异分析不是这样做的…… by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">那天在<em><strong>Frontiers in Immunology</strong></em> 偶然一瞥，看到一篇新鲜出炉的纯生信文章</p><p data-tool="mdnice编辑器">大喜？！纯生信文章还能往这里投？赶紧学习学习，然后……我就看到了这张神奇的图⬇</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5507776761207686" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicueoQ6cDUkevibf7SEgdqU4kb2zLcJRc7u77mkliaZBrYB4KRLfLRjyZG6rwjChYPe0UicaZhyKlRsA/640?wx_fmt=png" data-type="png" data-w="1093" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicueoQ6cDUkevibf7SEgdqU4kb2zLcJRc7u77mkliaZBrYB4KRLfLRjyZG6rwjChYPe0UicaZhyKlRsA/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><p>原文对差异分析是这么描述的：Using R software’s limma package , differentially expressed genes (DEGs) between septic shock cohort and control cohort were analyzed, with the following criterion: <strong>p&lt;0.05 and |fold change (FC)| &gt; 1</strong>.</p></blockquote><p data-tool="mdnice编辑器">竟然是直接用fold change来作为阈值的，一般差异分析用的更多的是log2FC,这样数字不会特别离谱。</p><p data-tool="mdnice编辑器">毕竟，log2FC中的FC即 fold change，表示两个样本/组间表达量的比值，对其取以2为底的对数之后才是log2FC。</p><blockquote data-tool="mdnice编辑器"><p>举几个例子：基因A 在肿瘤和正常组织中的表达量分别为2和4，那么比值为2，即FC=2，此时log2FC=1；</p><p>基因B 在肿瘤和正常组织中的表达量<strong>均为2，此时比值为1，即FC=1</strong>，此时log2FC=0；</p><p>基因C 在肿瘤和正常组织中的表达量分别为2和64，那么比值为32，即FC=32，此时log2FC=5。</p><p>最后夸张一下！！</p><p>基因D 在肿瘤和正常组织中的表达量分别为2和1024，那么比值为512，即FC=512，此时log2FC=9。</p></blockquote><p data-tool="mdnice编辑器">这样一算，你大概就能明白上面那张图问题出在哪里了吧~</p><p data-tool="mdnice编辑器">但是光说不练，纸上谈兵，我们还是自己上手分析一下这个数据集，验证一下自己的猜想——</p><p data-tool="mdnice编辑器">这里的上下调基因取得是top30的哈~,代码放在下面：</p><pre data-tool="mdnice编辑器"><code>cg = rownames(deg)[deg$change != <span>"stable"</span>]<br>deg1 &lt;- deg[cg,] <br><span>library</span>(dplyr)<br>top_up &lt;- deg1 %&gt;%  top_n(n=<span>30</span>,wt=logFC) %&gt;% rownames() <br>top_down &lt;- deg1 %&gt;%  top_n(n=-<span>30</span>,wt=logFC) %&gt;% rownames()<br>top_all &lt;- c(top_up,top_down)<br>n1 &lt;- n[top_all,]<br><br><span># 由于 ComplexHeatmap 包并不会对数据进行标准化，为了让图形更好看，我们先手动对数据进行标准化</span><br>exp &lt;- apply(n1, <span>1</span>, scale)<br>rownames(exp) &lt;- colnames(n1)<br>exp &lt;- t(exp)<br></code></pre><p data-tool="mdnice编辑器">然后是画图参数的设置：</p><pre data-tool="mdnice编辑器"><code>col_fun = colorRamp2(c(-<span>2</span>, <span>0</span>, <span>2</span>), c(<span>"#2fa1dd"</span>, <span>"white"</span>, <span>"#f87669"</span>))<br>top_annotation = HeatmapAnnotation(<br>  cluster = anno_block(gp = gpar(fill = c(<span>"#2fa1dd"</span>, <span>"#f87669"</span>)),<br>                       labels = c(<span>"normal"</span>,<span>"case"</span>),<br>                       labels_gp = gpar(col = <span>"white"</span>, fontsize = <span>12</span>)))<br>p4 &lt;- pheatmap(exp,name = <span>"expression"</span>,<br>               col = col_fun,<br>               column_split = group_list,<br>               top_annotation=top_annotation,<br>               row_split = rep(c(<span>"UP"</span>,<span>"DOWN"</span>), each = <span>30</span>),<br>               fontsize_row=<span>5</span>,<br>               column_title = <span>NULL</span>,<br>               show_colnames = <span>F</span>)<br>p4                <br>p4 &lt;- as.ggplot(p4)<br></code></pre><p data-tool="mdnice编辑器">最后是拼图的基操：</p><pre data-tool="mdnice编辑器"><code><span>library</span>(patchwork)<br>p &lt;- p3+p4 <span>##p3就是火山图</span><br>ggsave(p,filename = <span>"../outputs/article.pdf"</span>,width = <span>15</span>,height = <span>9</span>)<br><br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5901253918495298" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicueoQ6cDUkevibf7SEgdqU4hNmiazHNQcy2D4c16e3BhAWv4QO5ynLZAyr44HPDrdXbiaibwKunP9ECQ/640?wx_fmt=png" data-type="png" data-w="1276" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicueoQ6cDUkevibf7SEgdqU4hNmiazHNQcy2D4c16e3BhAWv4QO5ynLZAyr44HPDrdXbiaibwKunP9ECQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">为什么我的图和文章里的图迥然不同呢？</p><p data-tool="mdnice编辑器">相信大家只要对表达量矩阵有一定的熟悉，就应该知道，有的数据集下载以后，需要先观察探针在每一个样本中的表达量数据，一般数值不大于20的话，说明这个矩阵已经是被取过log的，否则的话是需要先取log再做分析的。</p><pre data-tool="mdnice编辑器"><code>options(timeout = <span>99999999</span>)<br><br>getwd()<br>rm(list = ls())<br><span>library</span>(GEOquery)<br><span>library</span>(stringr)<br><br>gse &lt;- <span>"GSE26440"</span><br><span># 1.获得表达矩阵 ----------------------------------------------------------------</span><br>eSet1 &lt;- getGEO(gse, <br>                destdir = <span>'.'</span>, <br>                getGPL = <span>F</span>)<br><span>#(1)提取表达矩阵exp</span><br>exp1 &lt;- exprs(eSet1[[<span>1</span>]])<br>exp1[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>range(exp1)<br><span># [1]  0.01 1208.00</span><br>exp1 &lt;- log2(exp1+<span>1</span>)<br>range(exp1)<br></code></pre><p data-tool="mdnice编辑器">有点惊讶这样的错误编辑竟然没有发现，而且还大大方方地出现在文章正文中，哪怕作为补充材料出现都值得质疑吧？~</p><blockquote data-tool="mdnice编辑器"><p>PS：我们并不是为了针对文章作者，而是仅就文章中的问题作出合理的质疑。当然，我们的观点可能并不正确，希望大家从学术讨论的角度出发<br>peace &amp; love 🌹</p></blockquote></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/op0bMhIGBt76hYKMkUpVsw",target="_blank" rel="noopener noreferrer">原文链接</a>
