---
title: "EpiDISH-根据甲基化信号值推断样品的细胞成分"
date: 2022-12-31T01:40:21Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
EpiDISH-根据甲基化信号值推断样品的细胞成分 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>传统的甲基化信号值通常是芯片，比如illumina公司的27K,450K,850K的甲基化芯片，它们检查的通常是细胞混合物，比如绝大部分肿瘤组织样品其实是混合了上皮细胞，基质细胞和免疫细胞。如果我们感兴趣肿瘤组织的纯度，或者说肿瘤的免疫浸润情况，就可以使用同样的反卷积方法来。这个时候EpiDISH包就可以派上用场：</p></blockquote><h3 data-tool="mdnice编辑器"><span></span>集成3大算法<span></span></h3><p data-tool="mdnice编辑器">EpiDISH 包的例子倾向于使用   RPC 方法，全部的3个算法是：</p><ul data-tool="mdnice编辑器"><li><section>(Robust Partial Correlations-RPC(Teschendorff et al. 2017),</section></li><li><section>Cibersort-CBS(Newman et al. 2015),</section></li><li><section>Constrained Projection-CP(Houseman et al. 2012)),</section></li></ul><h3 data-tool="mdnice编辑器"><span></span>自带4个参考数据集<span></span></h3><p data-tool="mdnice编辑器">看 <em>BMC Bioinformatics</em> 发表于2017的文章：《A comparison of reference-based algorithms for correcting cell-type heterogeneity in Epigenome-Wide Association Studies 》，里面有详细介绍这4个参考数据集如何制作的</p><ul data-tool="mdnice编辑器"><li><section>two whole blood subtypes reference,</section></li><li><section>one generic epithelial reference with epithelial cells, fibroblasts, and total immune cells,</section></li><li><section>one reference for breast tissue</section></li></ul><p data-tool="mdnice编辑器">可以很容易看到这些参考数据集都被打包好了，data(package = 'EpiDISH')</p><pre data-tool="mdnice编辑器"><span></span><code>Data sets <span>in</span> package ‘EpiDISH’:<br><br>DummyBeta.m                Dummy beta value matrix<br>LiuDataSub.m               Whole blood example beta value matrix<br>centBloodSub.m             Whole blood reference of 188 tsDHS-DMCs and 7 blood<br>                           cell subtypes<br>                           <br>centDHSbloodDMC.m          Whole blood reference of 333 tsDHS-DMCs and 7 blood<br>                           cell subtypes<br>centEpiFibFatIC.m          Reference <span>for</span> breast tissue<br>centEpiFibIC.m             Reference <span>for</span> genenric epithelial tissue<br></code></pre><p data-tool="mdnice编辑器">我们首先看看上皮细胞的参考数据集，在EpiDISH 包给命名为 centEpiFibIC.m</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(EpiDISH)<br>data(centEpiFibIC.m)<br><span># 可以看到是3个细胞类型的716个甲基化探针</span><br>dim(centEpiFibIC.m)<br>head(centEpiFibIC.m)<br>pheatmap::pheatmap(centEpiFibIC.m,<br>                   show_rownames = <span>F</span>)<br></code></pre><p data-tool="mdnice编辑器">可以看到是每个细胞亚群都有自己的特异性甲基化芯片探针：</p><p><img data-galleryid="" data-ratio="0.4816272965879265" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwNqYfOicojag4B4Zdo7damJ0Bh5KOibuBn602K1AEvpHDE9w1snnRIhVX7Gh1DTuTia7n48ZNTYbkZA/640?wx_fmt=png" data-type="png" data-w="1524" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwNqYfOicojag4B4Zdo7damJ0Bh5KOibuBn602K1AEvpHDE9w1snnRIhVX7Gh1DTuTia7n48ZNTYbkZA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>上皮细胞的参考数据集</figcaption></figure><p data-tool="mdnice编辑器">感兴趣的可以去看文献，这些探针是如何得到的。</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; dim(centEpiFibIC.m)<br>[1] 716   3<br>&gt; head(centEpiFibIC.m)<br>                  Epi        Fib          IC<br>cg16509569 0.97905062 0.97827048 0.006030438<br>cg05596756 0.97643990 0.98184238 0.006086343<br>cg11802899 0.97407930 0.97413265 0.006219681<br>cg02026204 0.96812178 0.97424952 0.005418776<br>cg16622899 0.01658659 0.01585706 0.984393223<br>cg24002183 0.02297836 0.02369267 0.975103840<br></code></pre><p data-tool="mdnice编辑器">再看看 其中一个血液组成评价数据集，centDHSbloodDMC.m</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; data(centDHSbloodDMC.m)<br>&gt; dim(centDHSbloodDMC.m)<br>[1] 333   7<br>&gt; head(centDHSbloodDMC.m)<br>               B    NK  CD4T  CD8T  Mono Neutro Eosino<br>cg01024458 0.034 0.962 0.969 0.958 0.987  0.992  0.991<br>cg11661493 0.037 0.954 0.971 0.964 0.958  0.962  0.962<br>cg21596498 0.060 0.980 0.989 0.989 0.980  0.976  0.984<br>cg05205074 0.049 0.954 0.967 0.961 0.967  0.979  0.986<br>cg17232476 0.045 0.962 0.969 0.958 0.932  0.980  0.976<br>cg14936008 0.065 0.976 0.980 0.983 0.977  0.983  0.986<br>&gt; pheatmap::pheatmap(centDHSbloodDMC.m,show_rownames = F)<br></code></pre><p data-tool="mdnice编辑器">可以看到也是基本上符合认知，NK,CD4,CD8会比较接近，都是T细胞。</p><p><img data-galleryid="" data-ratio="0.4776902887139108" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwNqYfOicojag4B4Zdo7damJH3P3fNVQzywq09xavl7cWnMF2m26LW0aB6R2YHU9G8FouY4xicvs53w/640?wx_fmt=png" data-type="png" data-w="1524" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwNqYfOicojag4B4Zdo7damJH3P3fNVQzywq09xavl7cWnMF2m26LW0aB6R2YHU9G8FouY4xicvs53w/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>血液组成评价数据集</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span>上皮细胞混合物的分解<span></span></h3><p data-tool="mdnice编辑器">使用起来非常简单，就是 epidish 函数调用即可，它需要一个甲基化信号值矩阵，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>data(DummyBeta.m)<br><span># 可以看到是10个甲基化样品，每个都是节选了 2000个甲基化探针</span><br>dim(DummyBeta.m)<br>DummyBeta.m[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>] <br>out.l &lt;- epidish(beta.m = DummyBeta.m, <br>                 ref.m = centEpiFibIC.m, <br>                 method = <span>"RPC"</span><br>                 )  <br>out.l$estF<br><span># 各个样品的各个细胞比例</span><br>pheatmap::pheatmap(out.l$estF)<br>rowSums(out.l$estF)<br></code></pre><p data-tool="mdnice编辑器">3种细胞比例之和在每个样品都是1，可以看到10个样品各自的细胞组成差异很大：</p><p><img data-galleryid="" data-ratio="0.7614107883817427" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwNqYfOicojag4B4Zdo7damJzUXFic5BVWDYSBufwicyuVN2HEYFkqtzkVBDkrs7iaYy7wxibHmxoPeIOg/640?wx_fmt=png" data-type="png" data-w="964" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwNqYfOicojag4B4Zdo7damJzUXFic5BVWDYSBufwicyuVN2HEYFkqtzkVBDkrs7iaYy7wxibHmxoPeIOg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>10个样品各自的细胞组成</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span>免疫细胞混合物的分解<span></span></h3><p data-tool="mdnice编辑器">使用起来非常简单，就是 epidish 函数调用即可，它需要一个甲基化信号值矩阵，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>data(LiuDataSub.m)<br>BloodFrac.m &lt;- epidish(beta.m = LiuDataSub.m, <br>                       ref.m = centDHSbloodDMC.m, <br>                       method = <span>"RPC"</span>)$estF <br>head(BloodFrac.m)<br>pheatmap::pheatmap(BloodFrac.m)<br>boxplot(BloodFrac.m)<br></code></pre><p data-tool="mdnice编辑器">可以看到绝大部分样品都是以  Neutro 为主，占比超80% ，剩余的6种免疫细胞比例含量都很低：</p><p><img data-galleryid="" data-ratio="0.359612724757953" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwNqYfOicojag4B4Zdo7damJV1JE02MVnONQQicuoXMDicQmGkQhfqeelMAotamIqOgMib8upwor8ldibQ/640?wx_fmt=png" data-type="png" data-w="1446" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwNqYfOicojag4B4Zdo7damJV1JE02MVnONQQicuoXMDicQmGkQhfqeelMAotamIqOgMib8upwor8ldibQ/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>免疫细胞含量分解</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span>高级函数hepidish做两次分解<span></span></h3><p data-tool="mdnice编辑器">第一次分解可以把肿瘤样品区分成为上皮细胞，基质细胞和免疫细胞，第二次分解就针对免疫细胞进行细分亚群，使用方法如下：</p><pre data-tool="mdnice编辑器"><span></span><code>data(centBloodSub.m)<br>frac.m &lt;- hepidish(beta.m = DummyBeta.m, <br>                   ref1.m = centEpiFibIC.m, <br>                   ref2.m = centBloodSub.m[,c(<span>1</span>, <span>2</span>, <span>5</span>)], <br>                   h.CT.idx = <span>3</span>, method = <span>'RPC'</span>)<br>frac.m<br>boxplot(frac.m)<br></code></pre><p data-tool="mdnice编辑器">这个其实挺适合肿瘤免疫微环境的分解，值得试试看！</p><h3 data-tool="mdnice编辑器"><span></span>最高级用法 <strong>CellDMC</strong><span></span></h3><p data-tool="mdnice编辑器">这个看起来是做Epigenome-Wide Association Studies(EWAS)，有点超纲了，下次再讲解！</p><h3 data-tool="mdnice编辑器"><span></span>甲基化背景知识<span></span></h3><p data-tool="mdnice编辑器">甲基化测序的 WGBS和RRBS，还有 芯片是最高频的3种甲基化技术，其中甲基化芯片数据处理我是有视频课程的，首先需要阅读我在生信技能树的甲基化系列教程，<strong>目录如下</strong>：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247492739&amp;idx=1&amp;sn=c044bb55fe19d48f3b8299e3b41949d6&amp;scene=21#wechat_redirect" data-linktype="2">01-甲基化的一些基础知识.pdf</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247492747&amp;idx=1&amp;sn=4edfdd4404bd85ef9a5439b01ee51ece&amp;scene=21#wechat_redirect" data-linktype="2">02-甲基化芯片的一般分析流程.pdf</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247492863&amp;idx=1&amp;sn=807ec9cd3df2f5c4069f2d19ccc50fb9&amp;scene=21#wechat_redirect" data-linktype="2">03-甲基化芯片数据下载的多种技巧.pdf</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247492863&amp;idx=2&amp;sn=6739846b541e1999c13f05b0b6ef35d1&amp;scene=21#wechat_redirect" data-linktype="2">04-甲基化芯片数据下载如何读入到R里面.pdf</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247492872&amp;idx=2&amp;sn=32a38bfd069d5fc9f342b9be1db27094&amp;scene=21#wechat_redirect" data-linktype="2">05-甲基化芯片数据的一些质控指标.pdf</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247492979&amp;idx=2&amp;sn=4072c2f045693bb02cf05ff32056da14&amp;scene=21#wechat_redirect" data-linktype="2">06-甲基化信号值矩阵差异分析哪家强.pdf</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247489833&amp;idx=1&amp;sn=e3a72b0087dd38080cb9b502e2e5c8de&amp;scene=21#wechat_redirect" data-linktype="2">07-甲基化芯片信号值矩阵差异分析的标准代码.pdf</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247492970&amp;idx=2&amp;sn=213ee35045452b45722fb2473646619c&amp;scene=21#wechat_redirect" data-linktype="2">08-TCGA数据库的各个癌症甲基化芯片数据重新分析.pdf</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247490092&amp;idx=1&amp;sn=a9f9e5d2a997f9bcdacee6a46006cfec&amp;scene=21#wechat_redirect" data-linktype="2">09-TCGA数据库的癌症甲基化芯片数据重分析.pdf</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247488265&amp;idx=1&amp;sn=39bdf7ec77efd9f2fc15f680968fa9a4&amp;scene=21#wechat_redirect" data-linktype="2">10-TCGA数据辅助甲基化区域的功能研究.pdf</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247487877&amp;idx=1&amp;sn=a89e9429e02766e57c1ccff6ddf03820&amp;scene=21#wechat_redirect" data-linktype="2">11-按基因在染色体上的顺序画差异甲基化热图.pdf</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247485301&amp;idx=1&amp;sn=bd9b9f08d0fcbf69fa6096815abe0b08&amp;scene=21#wechat_redirect" data-linktype="2">850K甲基化芯片数据的分析.pdf</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484324&amp;idx=1&amp;sn=d64c042927e70c4b91839759d8bd2a2b&amp;scene=21#wechat_redirect" data-linktype="2">使用DSS包多种方式检验差异甲基化信号区域.pdf</a></section></li></ul><p data-tool="mdnice编辑器">然后就可以看我在<strong>B站免费分享的视频课程《甲基化芯片（450K或者850K）数据处理 》</strong></p><ul data-tool="mdnice编辑器"><li><section>教学视频免费在：https://www.bilibili.com/video/BV177411U7oj</section></li><li><section>课程配套思维导图：https://mubu.com/doc/1cwlFgcXMg</section></li></ul><h3 data-tool="mdnice编辑器"><span></span>肿瘤免疫细胞比例推断背景知识<span></span></h3><p data-tool="mdnice编辑器">肿瘤微环境是肿瘤细胞生存和发展的土壤，其中浸润到肿瘤局部的免疫细胞介导了肿瘤免疫微环境，tumor immune microenvironment, 简称TIME。肿瘤的免疫疗法作用于免疫微环境， 肿瘤免疫微环境的异质性与免疫疗法的不同响应率必然存在这密切的关系，免疫微环境有望作为一种biomaker来指导临床治疗，筛选能够从免疫疗法中获益的肿瘤患者群体。</p><p data-tool="mdnice编辑器">研究肿瘤免疫微环境组成的技术手段有很多，基于测序技术和生物信息学分析的方法是目前较为流程的一种策略。通过转录组测序，可以获得肿瘤样本中不同基因的表达量数据，通过对应的生物信息学软件，可以得到肿瘤免疫微环境中各种细胞的表达量，从而对肿瘤微环境进行分型，识别浸润的免疫细胞亚群，比较不同亚群的表达情况，结合生存分析，进一步筛选某种微环境亚型或者免疫细胞亚群作为biomarker。</p><h4 data-tool="mdnice编辑器"><span></span>基于转录组的算法策略<span></span></h4><p data-tool="mdnice编辑器">基于基因表达谱数据，分析肿瘤免疫微环境组分的软件有很多，大致分成了以下3种策略</p><h5 data-tool="mdnice编辑器"><span></span>1. marker gene<span></span></h5><p data-tool="mdnice编辑器">将不同免疫细胞对应的marker genes作为基因集合, 采用类似GSEA的算法来评估样本中高表达的基因在不同免疫细胞的基因集合中是否富集,该策略对应的软件如下</p><ol data-tool="mdnice编辑器"><li><section>TIminer</section></li><li><section><strong>xCell</strong></section></li><li><section>MCP-counter</section></li></ol><h5 data-tool="mdnice编辑器"><span></span>2.  反卷积<span></span></h5><p data-tool="mdnice编辑器">卷积和反卷积是深度学习中常见的算法，将每个样本看做是多种免疫细胞的混合，采用线性回归拟合出每种免疫细胞的组分和表达量与最终混合后的关系，通过反卷积算法，提取每种免疫细胞的表达特征,该策略对应的软件如下</p><ol data-tool="mdnice编辑器"><li><section><strong>CIBERSORT</strong></section></li><li><section>TIMER</section></li><li><section>EPIC</section></li><li><section><strong>quanTIseq</strong></section></li></ol><h5 data-tool="mdnice编辑器"><span></span>3. NMF非负矩阵分解<span></span></h5><p data-tool="mdnice编辑器">类似突变特征分析，NMF算法也可以用于从基因表达谱中提取免疫细胞表达谱特征，该策略对应的软件如下</p><ol data-tool="mdnice编辑器"><li><section>deconf</section></li><li><section>ssKL</section></li><li><section>ssFrobenius</section></li></ol><p data-tool="mdnice编辑器"><strong>参考文献：</strong></p><p data-tool="mdnice编辑器">1. Hackl H, Charoentong P, Finotello F, et al. Computational genomics tools for dissecting tumour-immune cell interactions. Nat Rev Genet 2016;17:441-58.</p><p data-tool="mdnice编辑器">2. Finotello, Francesca, and Zlatko Trajanoski. Quantifying Tumor-Infiltrating Immune Cells from Transcriptomics Data. Cancer Immunology, Immunotherapy: CII 67, no. 7 (2018): 1031–40.</p></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/X-Tcces8aEdkpGOuEZvBmQ",target="_blank" rel="noopener noreferrer">原文链接</a>
