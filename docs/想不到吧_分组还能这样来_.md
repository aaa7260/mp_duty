---
title: "想不到吧，分组还能这样来~"
date: 2022-11-15T06:19:07Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
想不到吧，分组还能这样来~ by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><ul><li><section><p>Title：Whole exome sequencing and transcriptome-wide profiling identify  potentially subtype-relevant genes of nasopharyngeal carcinoma</p></section></li><li><section><p>[PMID: 33113455 <span></span>]</p></section></li><li><section><p>DOI: 10.1016/j.prp.2020.153244<span></span></p></section></li></ul></blockquote><p data-tool="mdnice编辑器">乍一看这题目，全外显子测序！！这是我应该会的吗？</p><p data-tool="mdnice编辑器">没事，生信技能树全外显子课堂开课啦——<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247518508&amp;idx=1&amp;sn=a342dd13613954c1e9273f26182e238a&amp;chksm=9b4bc997ac3c40815735ad7141aef6f4e87eb0c314e8d8f604071237bbfd8723b6f9dd7270fd&amp;scene=21#wechat_redirect" textvalue="重磅课程来袭-专注于肿瘤外显子数据处理" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">重磅课程来袭-专注于肿瘤外显子数据处理</a></p><p data-tool="mdnice编辑器">其实文章是用了geo数据集和自己的临床样本的全外显子测序数据做联合分析，我们今天只是浅看一下geo部分的分析思路啦</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5248493975903614" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8BkqakKt1nRP2doclbE3MPicw8eGBCLJ5wqGVFZsaCicTh8iacFHpLg6jfDYSBoicyVFyBiawnS7WuDrw/640?wx_fmt=png" data-type="png" data-w="1328" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8BkqakKt1nRP2doclbE3MPicw8eGBCLJ5wqGVFZsaCicTh8iacFHpLg6jfDYSBoicyVFyBiawnS7WuDrw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">框起来的部分是我们要做的。</p><p data-tool="mdnice编辑器">我们来看看这个公共数据集的设计</p><blockquote data-tool="mdnice编辑器"><p>[<strong>GSE12452</strong>]</p><p>Overall design：Total RNA extracted from laser-captured epithelium from <strong>31 nasopharyngeal carcinomas</strong> and <strong>10 normal</strong> healthy nasopharyngeal tissue specimens.</p></blockquote><p data-tool="mdnice编辑器">很明显的二分组数据啊，还能怎么分呢？头秃啊</p><p data-tool="mdnice编辑器">先下载数据来看看</p><pre data-tool="mdnice编辑器"><code>rm(list = ls())  <span>## 魔幻操作，一键清空~</span><br>options(stringsAsFactors = <span>F</span>)<span>#</span><br><br><span>library</span>(AnnoProbe)<br><span>library</span>(GEOquery) <br>gset &lt;- geoChina(<span>"GSE12452"</span>)<br><br>a=gset[[<span>1</span>]] <span>#表达矩阵和临床信息都在a里面</span><br>dat=exprs(a) <span>#a现在是一个对象，取a这个对象通过看说明书知道要用exprs这个函数</span><br>dim(dat)  <span>#54675    41</span><br><span>#   GPL570 [HG-U133_Plus_2] Affymetrix Human Genome U133 Plus 2.0 Array</span><br>dat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>] <span>#查看dat这个矩阵的1至4行和1至4列，逗号前为行，逗号后为列</span><br>range(dat) <span>##查看数值范围</span><br>boxplot(dat[,<span>1</span>:<span>4</span>],las=<span>2</span>) <span>#定位 bplot 组的轴标签。如果组数小于 7，则默认将它们水平放置（las=1），否则使它们垂直（las=2）以防止标签相互碰撞</span><br>dev.off()<br><br><span># dat=log2(dat)#如果数字在20以下 就不需要取log2</span><br>boxplot(dat[,<span>1</span>:<span>4</span>],las=<span>2</span>) <span>#上下还是有离群值</span><br><br><span>library</span>(limma)<span>#</span><br>dat=normalizeBetweenArrays(dat)<span>#https://www.jianshu.com/p/56b79156a2cb  这部什么时候要做？</span><br>boxplot(dat[,<span>1</span>:<span>4</span>],las=<span>2</span>) <span>#发现normalizeBetweenArrays 之后 箱线图上下离群值均衡了</span><br> <br><br><span>#通过查看说明书知道取对象a里的临床信息用pData</span><br><span>## 挑选一些感兴趣的临床表型。</span><br>pd=pData(a)<br><span>library</span>(stringr)  <br>head(pd)<br>colnames(pd) <span>##看看pd，我们就知道，其实分组思路还可以这样啊！</span><br></code></pre><p data-tool="mdnice编辑器">跟着文章思路走的话，分组就是这样的：</p><pre data-tool="mdnice编辑器"><code><span>####分组 </span><br>table(pd$`characteristics_ch1.1`)<br>group_list = pd$`characteristics_ch1.1`<br>table(group_list)<br>group&lt;- ifelse(str_detect(group_list,<span>"IIA"</span>),<span>"IIA"</span>,<br>                       ifelse(str_detect(group_list,<span>"IIB"</span>),<span>"IIB"</span>,<span>"normal"</span>))<br>table(group)<br><br></code></pre><p data-tool="mdnice编辑器">后续的基因注释很常规，芯片【 GPL570】也是非常常见的。。。</p><pre data-tool="mdnice编辑器"><code><span>##完成注释后，将矩阵和分组信息存放到Main文件夹下</span><br>save(dat,group_list,<br>     file = <span>'step1-output.Rdata'</span>)<br></code></pre><h2 data-tool="mdnice编辑器"></h2><p data-tool="mdnice编辑器">接下来是简化我们分析的一些小技巧，其实就是文件夹布置的规范，简单的几步会让你的分析过程和结果更清晰，不会被两次分组绕进去~</p><figure data-tool="mdnice编辑器"><img data-ratio="0.32033898305084746" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8BkqakKt1nRP2doclbE3MP1Fd0hWvulnEXJHXTzwQBiaBhDMSp6YI6UPia5sAdxicCLI41Du8ZfTbGw/640?wx_fmt=png" data-type="png" data-w="590" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8BkqakKt1nRP2doclbE3MP1Fd0hWvulnEXJHXTzwQBiaBhDMSp6YI6UPia5sAdxicCLI41Du8ZfTbGw/640?wx_fmt=png"></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.7450523864959255" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8BkqakKt1nRP2doclbE3MPRQH9Dc8VIEXovIrgzQW4oJNkCRU7UxBO4nbvnQvhZyBNYHzuTicjUjA/640?wx_fmt=png" data-type="png" data-w="859" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8BkqakKt1nRP2doclbE3MPRQH9Dc8VIEXovIrgzQW4oJNkCRU7UxBO4nbvnQvhZyBNYHzuTicjUjA/640?wx_fmt=png"><figcaption>image-20221115110727785</figcaption></figure><p data-tool="mdnice编辑器">在两个子文件夹里，只需存放“step1-get-data.R‘，主成分分析、差异分析、富集分析的结果都可以通过这部分的代码得到。</p><figure data-tool="mdnice编辑器"><img data-ratio="1.12453300124533" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8BkqakKt1nRP2doclbE3MPhtOIkgQsBcAcZYoU3fUmRTKPvCkxuNMFWtYJzyjYRlcH43q8B9A05Q/640?wx_fmt=png" data-type="png" data-w="803" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8BkqakKt1nRP2doclbE3MPhtOIkgQsBcAcZYoU3fUmRTKPvCkxuNMFWtYJzyjYRlcH43q8B9A05Q/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">那么”step1-get-data.R“里究竟存了几行代码才能跑出这么多的东西呢？</p><p data-tool="mdnice编辑器">以 ⅡB vs normal 的比较为例：</p><pre data-tool="mdnice编辑器"><code>load(<span>'../step1-output.Rdata'</span>)<br>table(group_list) <br>kp =  group_list !=<span>"IIA"</span><br>dat=dat[,kp]<br>group_list=group_list[kp]<br>table(group_list) <br>group_list = ifelse(group_list==<span>'normal'</span>,<span>'control'</span>,<span>'case'</span>)<br>table(group_list) <br>getwd()<br>save(dat,group_list,<br>     file = <span>'step1-output.Rdata'</span>)<br><br><span>source</span>(<span>'../step2-check.R'</span>)<br><span>source</span>(<span>'../step3-DEG.R'</span>)<br><span>source</span>(<span>'../step4-anno-go-kegg.R'</span>)<br></code></pre><p data-tool="mdnice编辑器">就是这么简单！</p><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">最后是我们暗黑系的图：<img data-ratio="0.7048759623609923" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8BkqakKt1nRP2doclbE3MP5DCuqvbtYUZkDASRQcwPI14duHt9RHvI16DG3zNbZSGJYzZffHTs4g/640?wx_fmt=png" data-type="png" data-w="1169" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los8BkqakKt1nRP2doclbE3MP5DCuqvbtYUZkDASRQcwPI14duHt9RHvI16DG3zNbZSGJYzZffHTs4g/640?wx_fmt=png"><img data-ratio="0.5625" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los8BkqakKt1nRP2doclbE3MPXpycrPlysuOwMOJrMIQ3gIdDVulQtSeSpiatMj0jLlEibDFWKSKTEuCg/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los8BkqakKt1nRP2doclbE3MPXpycrPlysuOwMOJrMIQ3gIdDVulQtSeSpiatMj0jLlEibDFWKSKTEuCg/640?wx_fmt=jpeg"></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/zQunqR9RbrFbjxfHmetgEw",target="_blank" rel="noopener noreferrer">原文链接</a>
