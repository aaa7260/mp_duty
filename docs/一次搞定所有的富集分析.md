---
title: "一次搞定所有的富集分析"
date: 2022-10-11T03:31:32Z
draft: ["false"]
tags: [
  "fetched",
  "YuLabSMU"
]
categories: ["Acdemic"]
---
一次搞定所有的富集分析 by YuLabSMU
------
<div><p data-mpa-powered-by="yiban.io">故事先从<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzI5NjUyNzkxMg==&amp;mid=2247492102&amp;idx=1&amp;sn=b1778d9bc8061d88d1f348cd82f8e6b1&amp;chksm=ec405341db37da57d2b122574ed6b1d186d0deb12c34d69d59c2364e6eea01414469c7791f73&amp;token=25869798&amp;lang=zh_CN&amp;scene=21#wechat_redirect" textvalue="gson包" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2">gson包</a>说起，有了这个格式之后，一切就方便多了。</p><ol><li><p>新格式</p></li></ol><p>我们定义了gson这个新的格式，它的信息比较全，且在R里有相应的类定义来存储相应的信息。<br></p><p>2. 能够生成新格式</p><p>那么我们首先是在我们的包里面，写一些函数，把bioconductor的一些注释数据，都能够转成gson格式。这个可以在我们相应的富集分析包里用gson_打头，按tab补全，看相应的函数。</p><p>再者，你可以通过gson::gson函数，对你手工整理的数据，搞成gson对象，继而写成gson文件。</p><p>3. 欢迎分享你的文件</p><p><img data-ratio="0.8218623481781376" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4npbuV39dgnN9mcVdjlsWRkep7uajFmEEN8A8kJwP6MlfTPKAQqOVV7Cmg9S8sx3TosqiatZTKzP0w/640?wx_fmt=png" data-type="png" data-w="988" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4npbuV39dgnN9mcVdjlsWRkep7uajFmEEN8A8kJwP6MlfTPKAQqOVV7Cmg9S8sx3TosqiatZTKzP0w/640?wx_fmt=png"></p><p>首先我们整理了一部分文件，放在https://yulab-smu.top/gson-files/，你可以通过它去下载相应的文件，然后做富集分析，当然非常欢迎大家来分享你的文件，这样有些冷门的物种，或许有了你的分享，将受益很多人。</p><p>4. 新玩法</p><p>我们首先是让enricher, GSEA两个通用的函数支持gson，也就是说直接enricher(de, gson=gson)，就能够富集分析了。但这只是换种玩法而已，只能说clusterProfiler有自己的玩法。这还不算新玩法。</p><p>那么新玩法就是我们可以一次做很多的基因集的富集。<br></p><p><img data-ratio="0.3393213572854291" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4npbuV39dgnN9mcVdjlsWRkdXGib38IibDn1OzEtsVhq9xWcV69sBhAyiaBxbXsL34lUEJVGmKLOV8HA/640?wx_fmt=png" data-type="png" data-w="501" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4npbuV39dgnN9mcVdjlsWRkdXGib38IibDn1OzEtsVhq9xWcV69sBhAyiaBxbXsL34lUEJVGmKLOV8HA/640?wx_fmt=png"></p><p>用gsonList函数，随便给几个对象都可以。然后我们把它可以传给enricher看看。</p><p><img data-ratio="0.660300136425648" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4npbuV39dgnN9mcVdjlsWRkJIHrQcAzug0IYfWQReQjyicfZxv5YfTNAMjDBc18buuPazVOXt3hogA/640?wx_fmt=png" data-type="png" data-w="733" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4npbuV39dgnN9mcVdjlsWRkJIHrQcAzug0IYfWQReQjyicfZxv5YfTNAMjDBc18buuPazVOXt3hogA/640?wx_fmt=png"></p><p>结果基本上可以看做是个list，你可以用位置或基因集名称去访问相应的基因集的富集分析结果。所以呢，你给了多少个基因集，就有多少个富集分析结果。也就是说，你可以收集一些gson文件，然后很简单地一条指令，把所有你想做的富集分析一次做了。</p><p>画个图吧，当前直接可以用dotplot来画，其它函数还不支持，但你可以去github上提要求嘛，我们的包总是这样，不断迭代的。<br></p><p><img data-ratio="0.8594059405940594" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4npbuV39dgnN9mcVdjlsWRkjN1Y74FhtWgo6zshyiajkncIu1U1KJByevZlpKcz2jomTHvPicq4VsYw/640?wx_fmt=png" data-type="png" data-w="1010" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4npbuV39dgnN9mcVdjlsWRkjN1Y74FhtWgo6zshyiajkncIu1U1KJByevZlpKcz2jomTHvPicq4VsYw/640?wx_fmt=png"></p><p>dotplot画出来这样，你想分面？按不同的基因集，我想到了你的这个需求，所以我把分面这一块给改进了一下，写了一个叫autofacet的函数，你只要这样子，dotplot(res) + autofacet()，它就会自动分面。<br></p><p><img data-ratio="0.8898898898898899" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4npbuV39dgnN9mcVdjlsWRkosn1IJXAozH9UQAjArfzLEFsIr21d9VHs8A0vSCVcHLs3gILxj8aDQ/640?wx_fmt=png" data-type="png" data-w="999" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4npbuV39dgnN9mcVdjlsWRkosn1IJXAozH9UQAjArfzLEFsIr21d9VHs8A0vSCVcHLs3gILxj8aDQ/640?wx_fmt=png"></p><p>图画好了，你可能不曾这样子画在一起，当我们画在一起的时候，还是可以看出点别的信息的，比如说GO里都是细胞周期的，而KEGG除了细胞周期，还有别的通路，这可能是GO富集分析具有冗余性，所以你只看到头部的原因，试试去冗余吧。再者，你看这些点的GeneRatio，明显GO的要大于KEGG啊，这是因为GO的注释覆盖度要远大于KEGG，KEGG只有八九千个人类基因是有注释的，而GO几乎全都有。你不画一起，可能也不会留意到。<br></p><p>一次搞定所有的富集分析，每一个你可以单独访问到，要怎么画图，怎么搞还怎么搞，整体上出图，我们慢慢再完善。然后像去冗余这些，你完全可以针对GO的，搞一波之后，再去它塞回去这个结果的list。</p><p>更为重要的是，《<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzI5NjUyNzkxMg==&amp;mid=2247487604&amp;idx=1&amp;sn=6f3b778ed80bb1a714ab79b2a8b4cb71&amp;scene=21#wechat_redirect" textvalue="不靠谱的富集分析软件太多了" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2">不靠谱的富集分析软件太多了</a>》一文中说到的情况，是不会在这里发生的。<br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/17ItITYzILmWv_Hcs80fAA",target="_blank" rel="noopener noreferrer">原文链接</a>
