---
title: "一些单细胞转录组R包的对象"
date: 2022-12-31T01:34:51Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
一些单细胞转录组R包的对象 by 生信技能树
------
<div><blockquote><p>对象应该是很重要的，至少是在R语言里面</p></blockquote><h3><span>ExpressionSet</span></h3><p>Bioconductor的ExpressionSet是基石，多次讲解过，GEO数据库在R里面下载的就是这个对象。</p><figure><img data-ratio="0.8430717863105175" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzlMng3v2EzaoJlhf8OW0brnt2EpG5pntvy2OGMMJjm1tvdLRvmjickBp6WBsrvJN9UhsBXJnLgr7g/640?wx_fmt=png" data-type="png" data-w="1198" title="" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wzlMng3v2EzaoJlhf8OW0brnt2EpG5pntvy2OGMMJjm1tvdLRvmjickBp6WBsrvJN9UhsBXJnLgr7g/640?wx_fmt=png"></figure><p>通常不需要自己从头创建。</p><p>而单细胞转录组本质上也是转录组，即表达量矩阵的分析，所以后面的R包的对象，其实或多或少借鉴了这个Bioconductor的ExpressionSet对象。</p><h3><span>CellDataSet</span></h3><p>来自于monocle这个R包，使用其提供的 newCellDataSet() 函数即可创建，创建后的对象组成成分如下</p><ul><li><p><span>表达矩阵：rows as features (usually genes) and columns as cells</span></p></li><li><p><span>使用 featureData and phenoData 函数可以获取基因和样本信息</span></p></li><li><p><span>其中 expressionFamily指定表达矩阵的归一化形式</span></p></li></ul><p>归一化形式通常是3种</p><ul><li><p><span>tobit() FPKM, TPM</span></p></li><li><p><span>negbinomial.size() UMIs, Transcript counts from experiments with spike-ins or relative2abs(), raw read counts</span></p></li><li><p><span>gaussianff() log-transformed FPKM/TPMs, Ct values from single-cell qPCR</span></p></li></ul><p>先介绍一下monocle需要的用来构建 CellDataSet 对象的三个数据集</p><ul><li><p>表达量矩阵<code>exprs</code>:数值矩阵 行名是基因, 列名是细胞编号.</p></li><li><p>细胞的表型信息<code>phenoData</code>: 第一列是细胞编号，其他列是细胞的相关信息</p></li><li><p>基因注释<code>featureData</code>: 第一列是基因编号, 其他列是基因对应的信息</p></li></ul><p>并且这三个数据集要满足如下要求:</p><p>表达量矩阵<strong>必须</strong>：</p><ul><li><p>保证它的列数等于<code>phenoData</code>的行数</p></li><li><p>保证它的行数等于<code>featureData</code>的行数</p></li></ul><p>而且</p><ul><li><p><code>phenoData</code>的行名需要和表达矩阵的列名匹配</p></li><li><p><code>featureData</code>和表达矩阵的行名要匹配</p></li><li><p><code>featureData</code>至少要有一列"gene_short_name", 就是基因的symbol</p></li></ul><p>准备Monocle对象需要的phenotype data 和 feature data 以及表达矩阵，从 scRNAseq 这个R包里面提取这三种数据。</p><pre><code><span>library</span>(scRNAseq)<br><span>## ----- Load Example Data -----</span><br>data(fluidigm)<br><span># Set assay to RSEM estimated counts</span><br>assay(fluidigm)  &lt;-  assays(fluidigm)$rsem_counts<br>ct &lt;- floor(assays(fluidigm)$rsem_counts)<br>ct[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>] <br>sample_ann &lt;- as.data.frame(colData(fluidigm))<br><br>gene_ann &lt;- data.frame(<br>  gene_short_name = row.names(ct), <br>  row.names = row.names(ct)<br>)<br><br>pd &lt;- new(<span>"AnnotatedDataFrame"</span>,<br>          data=sample_ann)<br>fd &lt;- new(<span>"AnnotatedDataFrame"</span>,<br>          data=gene_ann)<br><br>sc_cds &lt;- newCellDataSet(<br>  ct, <br>  phenoData = pd,<br>  featureData =fd,<br>  expressionFamily = negbinomial.size(),<br>  lowerDetectionLimit=<span>1</span>)<br>sc_cds<br></code></pre><p>这样就完成了CellDataSet对象的从头构建，它是后续分析的基石。</p><h3><span>SingleCellExperiment</span></h3><p>同样的也是那些信息：Different quantifications (e.g., counts, CPMs, log-expression) can be stored simultaneously in the <code>assays</code> slot. Row and column metadata can be attached using <code>rowData</code> and <code>colData</code>, respectively.</p><p>主要是scater包采用，也是可以从头构建。</p><p>创建代码如下：</p><pre><code><span>library</span>(scRNAseq)<br><span>## ----- Load Example Data -----</span><br>data(fluidigm)<br><span># Set assay to RSEM estimated counts</span><br>assay(fluidigm)  &lt;- assays(fluidigm)$rsem_counts<br>ct &lt;- floor(assays(fluidigm)$rsem_counts)<br>ct[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>table(rowSums(ct)==<span>0</span>)<br><span># 这里使用原始表达矩阵，所以有很多基因在所有细胞均无表达量，即表现为没有被检测到，这样的基因是需要过滤掉的。</span><br><br>pheno_data &lt;- as.data.frame(colData(fluidigm))<br><span>## 这里需要把Pollen的表达矩阵做成我们的 scater 要求的对象</span><br><span>#data("sc_example_counts")</span><br><span>#data("sc_example_cell_info") </span><br><span># 你也可以尝试该R包自带的数据集。</span><br><span># 参考 https://bioconductor.org/packages/release/bioc/vignettes/scater/inst/doc/vignette-intro.R</span><br>sce &lt;- SingleCellExperiment(<br>    assays = list(counts = ct), <br>    colData = pheno_data<br>    )<br>sce<br><span># </span><br><span># </span><br></code></pre><p>后面所有的分析都是基于 sce 这个变量 ，是一个 SingleCellExperiment 对象，被很多单细胞R包采用。</p><h3><span>seurat 对象</span></h3><p>主要是seurat包采用该对象，个人觉得并不是很方便，并不是上面的SingleCellExperiment 对象。</p><pre><code><span>library</span>(scRNAseq)<br><span>## ----- Load Example Data -----</span><br>data(fluidigm)<br><span># Set assay to RSEM estimated counts</span><br>assay(fluidigm) &lt;- assays(fluidigm)$rsem_counts<br>ct &lt;- floor(assays(fluidigm)$rsem_counts)<br>ct[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>names(metadata(fluidigm))<br>meta &lt;- as.data.frame(colData(fluidigm))<br>counts &lt;- ct<br>identical(rownames(meta),colnames(counts))<br>Pollen &lt;- CreateSeuratObject(raw.data = counts, <br>                             meta.data =meta,<br>                             min.cells = <span>3</span>, <br>                             min.genes = <span>200</span>, <br>                             project = <span>"Pollen"</span>)<br>Pollen<br></code></pre><h3><span>并不一定要对象</span></h3><p>有些单细胞转录组R包，就没有封装为特殊的对象，而是简单的list即可，比如M3Drop这个单细胞转录组R包：</p><pre><code><span>library</span>(scRNAseq)<br><span>## ----- Load Example Data -----</span><br>data(fluidigm) <br>ct &lt;- floor(assays(fluidigm)$rsem_counts)<br>ct[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>] <br>sample_ann &lt;- as.data.frame(colData(fluidigm))<br>counts=ct<br><span>library</span>(M3Drop) <br>Normalized_data &lt;- M3DropCleanData(counts, <br>                                   labels = sample_ann$Biological_Condition , <br>                                   is.counts=<span>TRUE</span>, min_detected_genes=<span>2000</span>)<br>dim(Normalized_data$data)<br>length(Normalized_data$labels)<br>class(Normalized_data)<br>str(Normalized_data)<br></code></pre><h3><span>那你需要对象吗</span></h3><p>你觉得对象重要吗，需要嘛？</p><section><section><p>扩展阅读</p></section><section></section></section><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247489021&amp;idx=1&amp;sn=41e95d03cc53a562098cf8c1eac67b55&amp;chksm=9b485546ac3fdc50acead78f53127ea93897bff968e987cd8fbca8cc0ec973f7f2c301cce3b2&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2">全网第一个单细胞转录组数据分析实战视频教程(预售第二波通知)</a><br></p><p><br></p><p><br></p><section data-tools="135编辑器" data-id="94450"><section><section><section data-autoskip="1"><section><p><span><strong>全国巡讲</strong></span></p><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247488803&amp;idx=1&amp;sn=96b8642121587d5c3a782998a601dcf0&amp;chksm=9b485598ac3fdc8edf0bfe90d6b20811bdbae6d93c966939712e1f229399c932e3576c78fba1&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2">生信技能树（爆款入门培训课）全国巡讲约你</a></p><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247488873&amp;idx=2&amp;sn=5981e4addaa57886ad573f35103401cb&amp;chksm=9b4855d2ac3fdcc4da261d113248b4e95e51d79e31bf8e2fa2ad5fb3efc3c238d616bc3c59d7&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2">生信技能树（爆款入门培训课）巡讲第一站-重庆</a> (已经结束)</p><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247488902&amp;idx=2&amp;sn=23c4bdd19db2e140f104372e3299d3c8&amp;chksm=9b48553dac3fdc2b48a141c53eb4b7568e0286a9da32659caf0c67fd87e2a4146dacced0c23c&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2">生信技能树（爆款入门培训课）全国巡讲免费大放送-赶快告诉你导师吧</a></p><p>……未完待续……</p></section></section></section></section></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/8keKxz_Q_DHt9ASNKHFjtg",target="_blank" rel="noopener noreferrer">原文链接</a>
