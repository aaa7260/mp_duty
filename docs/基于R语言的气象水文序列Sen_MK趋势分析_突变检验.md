---
title: "基于R语言的气象水文序列Sen+MK趋势分析、突变检验"
date: 2022-10-19T04:17:07Z
draft: ["false"]
tags: [
  "fetched",
  "气象水文科研猫"
]
categories: ["Acdemic"]
---
基于R语言的气象水文序列Sen+MK趋势分析、突变检验 by 气象水文科研猫
------
<div><p data-mpa-powered-by="yiban.io"><strong><span>一、往期经典推文回顾：</span></strong><strong><span></span></strong><br></p><p><strong><span>1、</span></strong><span><strong><span>《</span></strong></span><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzIwODY3MzIxMQ==&amp;mid=2247491362&amp;idx=1&amp;sn=a0c6c7315a45ab097302a970efd4b932&amp;chksm=977edff6a00956e0a32b0b4b6e1740ddc61e2bded058d0d84e170e593eef5e6ff7c9df9d4053&amp;token=1996642426&amp;lang=zh_CN&amp;scene=21#wechat_redirect" textvalue="Mann-Kendall(MK)去趋势预置白" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span><strong><span>Mann-Kendall(MK)去趋势预置白</span></strong><strong></strong></span></a><span><strong><span>》</span></strong></span></p><p><strong><span>2、</span></strong><span><strong><span>《</span></strong></span><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzIwODY3MzIxMQ==&amp;mid=2247492740&amp;idx=1&amp;sn=03e4fef2f1c10ac61186bd105c9b6d83&amp;chksm=977d2450a00aad466ef28d5f6eb800caa930639811c2055cb23593ceccb1cbf709553d4987b6&amp;token=1996642426&amp;lang=zh_CN&amp;scene=21#wechat_redirect" textvalue="气象水文突变检验及Python的实现1" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><strong><span>气象水文突变检验及Python的实现</span></strong><strong></strong></a><span><strong><span>》</span></strong></span></p><p><strong><span>3、</span></strong><span><strong><span>《</span></strong></span><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzIwODY3MzIxMQ==&amp;mid=2247492649&amp;idx=1&amp;sn=ff9fe2519f00e81fd859d8a8fbed5797&amp;chksm=977d24fda00aadeb7afc04fff8ab8db383c39875c4e80323ad9eb4bd0e956171a2c453468877&amp;token=1996642426&amp;lang=zh_CN&amp;scene=21#wechat_redirect" textvalue="气象水文数据分析之突变检验" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><strong><span>气象水文数据分析之突变检验</span></strong><strong></strong></a><span><strong><span>》</span></strong></span></p><p><strong><span>4、</span></strong><span><strong><span>《</span></strong></span><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzIwODY3MzIxMQ==&amp;mid=2247494887&amp;idx=1&amp;sn=21b02d5565e2acc6e984aaa7b32fb7c9&amp;chksm=977d2c33a00aa52558b5685d7862cf66e0a34df43d3400f691bbfbedfccde7c05e8e7c88ba78&amp;token=2019843737&amp;lang=zh_CN&amp;scene=21#wechat_redirect" textvalue="气象水文序列的趋势、突变检验" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span><strong><span>气象水文序列的趋势、突变检验</span></strong><strong></strong></span></a><span><strong><span>》</span></strong></span></p><hr><h1><strong><span><span>二、使用t</span></span><span><span>rend包进行MK趋势检验：</span></span></strong><span><span></span><strong><span></span></strong></span></h1><section><ul><li><li><li><li><li></ul><pre data-lang="makefile"><p><code><span>library("trend")</span></code><code><span>df&lt;- read.csv("F:/Rpython/lp37/data821/sun1012.csv")</span></code><code><span>data=df$sun</span></code><code><span>date=df$year</span></code><code><span>mk.test(data,continuity=TRUE)</span></code></p></pre></section><p><img data-galleryid="" data-ratio="0.44495412844036697" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/VQj38bogwOJPoKlyiaKXYgp4GoqTZIPyIrRmH3gTic6icfdjWlnxrIu7RRCsDVjBibOibFILKjGSMZyJjKG5VXEDryw/640?wx_fmt=png" data-type="png" data-w="436" src="https://mmbiz.qpic.cn/mmbiz_png/VQj38bogwOJPoKlyiaKXYgp4GoqTZIPyIrRmH3gTic6icfdjWlnxrIu7RRCsDVjBibOibFILKjGSMZyJjKG5VXEDryw/640?wx_fmt=png"></p><p><span>z值小于0，表明呈下降趋势，</span></p><p><span>相反z值大于0，表明呈上升趋势。</span></p><p><span>本例中，z小于0。</span></p><p><span>p&lt;0.01，我们拒绝零假设，表明数据存在明显的趋势变化。</span></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="makefile"><p><code><span>library(trend)</span></code><code><span>df&lt;- read.csv("F:/Rpython/lp37/data821/sun1012.csv")</span></code><code><span>test=df$sun</span></code><code><span>date=df$year</span></code><code><span>slope=sens.slope(na.omit(test))</span></code><code><span>print(slope)</span></code></p></pre></section><p><img data-galleryid="" data-ratio="0.5835240274599542" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/VQj38bogwOJPoKlyiaKXYgp4GoqTZIPyIiarjCgeZNQKbqEU5PFBcnL0fArnKYaQicye0bPtvS0Gy6ltiaIAucQfkg/640?wx_fmt=png" data-type="png" data-w="437" src="https://mmbiz.qpic.cn/mmbiz_png/VQj38bogwOJPoKlyiaKXYgp4GoqTZIPyIiarjCgeZNQKbqEU5PFBcnL0fArnKYaQicye0bPtvS0Gy6ltiaIAucQfkg/640?wx_fmt=png"></p><hr><h1><strong><span><span><span>三、使用rkt包进行MK趋势检验：</span></span></span></strong><span><span><span></span><strong><span></span></strong></span></span></h1><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><p><code><span>library(tidyverse)</span></code><code><span>library(pheno)</span></code><code><span>library(rkt)</span></code><code><span>df&lt;- read.csv("F:/Rpython/lp37/data821/sun1012.csv")</span></code><code><span>x=df$sun</span></code><code><span>date=df$year</span></code><code><span>seqMK.series &lt;- seqMK(x) %&gt;% as.data.frame() %&gt;% mutate(date=date)</span></code><code><span>MK_Mutation &lt;- ggplot(data = seqMK.series, aes(x = date, y = prog)) +</span></code><code><span>  geom_line(color = "red",size=1.2) +</span></code><code><span>  geom_line(aes(y = -retr), color = "blue",size=1.2) +</span></code><code><span>  geom_hline(yintercept = c(-1.96, 1.96), linetype = "dashed",size=1.2) +</span></code><code><span>  geom_hline(yintercept = 0,color = "black",size=1.2) +</span></code><code><span>  ggtitle("MK突变分析")+labs(x="Year",y="Kendall's normalized tau's")</span></code><code><span>MK_Mutation+theme_bw()+</span></code><code><span>  theme(panel.grid.major=element_blank(),</span></code><code><span>        panel.grid.minor=element_blank(),</span></code><code><span>        panel.background = element_blank(),</span></code><code><span>        legend.key=element_blank())+</span></code><code><span>   theme(panel.border=element_rect(fill=NA,color="black", size=1.5, linetype="solid"))+</span></code><code><span>   theme(axis.ticks.y=element_line(color="black",size=1.5,lineend=8))+</span></code><code><span>   theme(axis.ticks.x=element_line(color="black",size=1.5,lineend=8))+</span></code><code><span>   theme(axis.text.x=element_text(face="bold",color="blue",size=14))+</span></code><code><span>   theme(axis.text.y=element_text(face="bold",color="blue",size=14))+</span></code><code><span>   theme(plot.title=element_text(hjust=0.5,size=14),</span></code><code><span>        axis.text=element_text(size=14),axis.title.x=element_text(size = 24),</span></code><code><span>        legend.title=element_text(size=14),legend.text=element_text(size=14))+</span></code><code><span>   theme(plot.title=element_text(hjust=0.5,size=14,face="bold",color="black"))+</span></code><code><span>   theme(axis.title.x=element_text(vjust=1,face="bold",size=14),  # X axis title</span></code><code><span>              axis.title.y=element_text(size=14,face="bold",color="black"),  # Y axis title</span></code><code><span>              axis.text.x=element_text(size=14,face="bold",angle=0,color="black",vjust=.5),  # X axis text</span></code><code><span>              axis.text.y=element_text(size=14,face="bold",color="black"))  # Y axis text</span></code></p></pre></section><p><img data-ratio="0.603125" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/VQj38bogwOJPoKlyiaKXYgp4GoqTZIPyI7euiaTibMNRcGSicibgkBUxmib1kibsXpUxhlIOQL2QMSFnMWXEu1Wf3fKPg/640?wx_fmt=png" data-type="png" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_png/VQj38bogwOJPoKlyiaKXYgp4GoqTZIPyI7euiaTibMNRcGSicibgkBUxmib1kibsXpUxhlIOQL2QMSFnMWXEu1Wf3fKPg/640?wx_fmt=png"></p><hr><p><span><strong><span>自定义<strong><span>MK</span></strong>函数计算气象水文序列的突变点：</span></strong></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><p><code><span>df&lt;- read.csv("F:/Rpython/lp37/data821/sun1012.csv")</span></code><code><span>data=df$sun</span></code><code><span>date=df$year</span></code><code><span>data&lt;-as.matrix(data)</span></code><code><span>#####对数据求倒序#####</span></code><code><span>data_dx&lt;-rev(data)</span></code><code><span>data_dx&lt;-matrix(data_dx)</span></code><code><span>n&lt;-length(data)</span></code><code><span>#######MK检验#######</span></code><code><span>Q&lt;-matrix(0,1,n)</span></code><code><span>UF&lt;-matrix(0,1,n)</span></code><code><span>UB&lt;-matrix(0,1,n)</span></code><code><span>h&lt;-matrix(0,n,n)</span></code><code><span>for (i in 1:n) {</span></code><code><span>  for (j in 1:n) {</span></code><code><span>    if(data[i,1]&gt;data[j,1]){</span></code><code><span>      h[i,j]&lt;-1</span></code><code><span>    }</span></code><code><span>    else</span></code><code><span>      h[i,j]&lt;-0</span></code><code><span>  }</span></code><code><span>  Q[1,i]&lt;-sum(h[lower.tri(h)])</span></code><code><span>  UF[1,i]&lt;-(Q[1,i]-(i*(i-1)/4))/sqrt((i*(i-1)*(2*i+5))/72)</span></code><code><span>}</span></code><code><span>#####计算UB#####</span></code><code><span>h&lt;-matrix(0,n,n)</span></code><code><span>for (i in 1:n) {</span></code><code><span>  for (j in 1:n) {</span></code><code><span>    if(data_dx[i,1]&gt;data_dx[j,1]){</span></code><code><span>      h[i,j]&lt;-1</span></code><code><span>    }</span></code><code><span>    else</span></code><code><span>      h[i,j]&lt;-0</span></code><code><span>  }</span></code><code><span>  Q[1,i]&lt;-sum(h[lower.tri(h)])</span></code><code><span>  UB[1,i]&lt;-(Q[1,i]-(i*(i-1)/4))/sqrt((i*(i-1)*(2*i+5))/72)</span></code><code><span>}</span></code><code><span>#####绘图#####</span></code><code><span>UF[1,1]&lt;-0</span></code><code><span>UB[1,1]&lt;-0</span></code><code><span>plot(x=1960:2020,y=UF,ylim = c(-5,3),type = "l",ylab = "",xaxt="n",lwd="2.0",col=2)</span></code><code><span>lines(x=1960:2020,y=-rev(UB),type = "l",lty=2,lwd="2.0",col=4)</span></code><code><span>lines(x=1960:2020,y=rep(1.96,61),type = "l",lty=5)</span></code><code><span>lines(x=1960:2020,y=rep(-1.96,61),type = "l",lty=5)</span></code><code><span>lines(x=1960:2020,y=rep(0,61),type = "l")</span></code><code><span>title("MK突变分析")</span></code><code><span>axis(1,1960:2020,1960:2020,las=1)</span></code><code><span>#####输出突变年份#####</span></code><code><span>year_mk&lt;-1960:2020</span></code><code><span>year_point&lt;-year_mk[which((as.numeric(UF)-(-rev(UB)))&gt;0)[1]-1]</span></code><code><span>print(year_point)</span></code></p></pre></section><p><img data-ratio="0.53671875" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/VQj38bogwOJPoKlyiaKXYgp4GoqTZIPyIjia1Vf95MRarxplRJvRHYhfe39jWPXtq9iaZ6kAXlrqIXOzEneQxZgXQ/640?wx_fmt=png" data-type="png" data-w="1280" src="https://mmbiz.qpic.cn/mmbiz_png/VQj38bogwOJPoKlyiaKXYgp4GoqTZIPyIjia1Vf95MRarxplRJvRHYhfe39jWPXtq9iaZ6kAXlrqIXOzEneQxZgXQ/640?wx_fmt=png"></p><hr><p><strong><span>*****************************************</span></strong></p><p><strong><span>欢迎加气象水文科研猫主编微信，</span></strong></p><p><strong><span>获取更多免费代码和科研数据。</span></strong></p><p><strong><span>*****************************************</span></strong></p><p><img data-ratio="1.271444082519001" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/VQj38bogwOLcCicYKkeicTyNzS6uzEJUf34xIQibLaqQeslF3ajIJctM8wYTTibKUqs3iblnBPaqib1AJs0YPnuCwb6g/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="jpeg" data-w="921" src="https://mmbiz.qpic.cn/mmbiz_jpg/VQj38bogwOLcCicYKkeicTyNzS6uzEJUf34xIQibLaqQeslF3ajIJctM8wYTTibKUqs3iblnBPaqib1AJs0YPnuCwb6g/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><section><section><br></section></section><section><section><br></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/83Q-B55wgYDYwvohrTNhXQ",target="_blank" rel="noopener noreferrer">原文链接</a>
